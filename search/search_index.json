{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-]","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u9996\u9875","text":""},{"location":"#devops\u8fd0\u7ef4\u5f00\u53d1\u624b\u8bb0","title":"DevOps\u8fd0\u7ef4\u5f00\u53d1\u624b\u8bb0","text":"<p>\u5305\u542b\u77e5\u8bc6\u4e14\u4e0d\u4ec5\u9650\u4e8e </p> <ul> <li>\u4e91\u539f\u751f</li> <li>Devops</li> <li>Golang</li> <li>Python</li> <li>Shell</li> <li>\u4e91\u67b6\u6784</li> <li>kubernetes</li> </ul>"},{"location":"#\u4e2a\u4eba\u4fe1\u606f","title":"\u4e2a\u4eba\u4fe1\u606f\uff1a","text":"<p>Info<ul> <li> <p>GitHub</p> </li> <li> <p>\u6398\u91d1</p> </li> <li> <p>\u6155\u8bfe\u7f51</p> </li> <li> <p>51CTO</p> </li> <li> <p>InfoQ</p> </li> </ul> </p>"},{"location":"#\u5176\u4ed6\u53c2\u8003\u7b14\u8bb0","title":"\u5176\u4ed6\u53c2\u8003\u7b14\u8bb0","text":"<p>Info<ul> <li> <p>Linux 101 Docs</p> </li> <li> <p>awesome-kubernetes-notes</p> </li> <li> <p>kubectl-img</p> </li> <li> <p>shell-scripts</p> </li> </ul> </p>"},{"location":"#\u4e00\u4e9b\u63d0\u793a\u7b26","title":"\u4e00\u4e9b\u63d0\u793a\u7b26","text":"<p>\u672c\u6587\u5df2\u5b8c\u7a3f\u5e76\u901a\u8fc7\u5ba1\u9605\uff0c\u662f\u6b63\u5f0f\u7248\u672c\u3002</p> <p>\u672c\u6587\u5df2\u57fa\u672c\u5b8c\u7a3f\uff0c\u6b63\u5728\u5ba1\u9605\u548c\u4fee\u8ba2\u4e2d\uff0c\u4e0d\u662f\u6b63\u5f0f\u7248\u672c\u3002</p> <p>\u5bfc\u8a00</p> <p>\u672c\u7ae0\u8282\u5c06\u4ecb\u7ecd\u4e00\u4e9b\u5e38\u7528\u7684 shell \u6587\u672c\u5904\u7406\u5de5\u5177\uff0c\u5b83\u4eec\u53ef\u4ee5\u5e2e\u52a9\u4f60\u66f4\u52a0\u5f97\u5fc3\u5e94\u624b\u5730\u5904\u7406\u5927\u91cf\u6709\u89c4\u5f8b\u7684\u6587\u672c\u3002</p> <p>\u4e3a\u4fdd\u6301\u7b80\u6d01\uff0c\u5404\u5de5\u5177\u7684\u4ecb\u7ecd\u7686\u70b9\u5230\u5373\u6b62\uff0c\u8fdb\u4e00\u6b65\u7684\u7528\u6cd5\u8bf7\u81ea\u884c\u67e5\u627e\u3002</p> <p>\u5e2e\u52a9\u7406\u89e3\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5de5\u5177</p> <p>Regex101 \u7f51\u7ad9\u96c6\u6210\u4e86\u5e38\u89c1\u7f16\u7a0b\u8bed\u8a00\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u89e3\u6790\u5de5\u5177\uff0c\u5728\u7f16\u5199\u6b63\u5219\u65f6\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u4e0d\u9519\u7684\u53c2\u8003\u3002</p> <p>Shell \u6587\u672c\u5904\u7406\u5de5\u5177\u7ec3\u4e60 1\uff1a\u6587\u4ef6\u5185\u5bb9\u66ff\u6362</p> <p>\u67d0 shell \u811a\u672c\u4f1a\u968f\u7740\u56fe\u5f62\u754c\u9762\u542f\u52a8\u800c\u542f\u52a8\uff0c\u542f\u52a8\u540e\u4f1a\u6839\u636e\u73af\u5883\u53d8\u91cf\u66ff\u6362\u67d0\u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\u7684\u5185\u5bb9\u3002\u8be5\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>[settings]\nhomepage=http://example.com/\nlocation-entry-search=http://cn.bing.com/search?q=%s\n</code></pre> <p>\u6211\u4eec\u5e0c\u671b\u7f16\u5199\u4e00\u6761\u6216\u591a\u6761 sed \u547d\u4ee4\uff0c\u4f7f\u5f97\u811a\u672c\u8fd0\u884c\u540e\u914d\u7f6e\u6587\u4ef6\u88ab\u4fee\u6539\u4e3a\uff1a</p> <pre><code>[settings]\nhomepage=http://example.com/index_new.html\nlocation-entry-search=http://www.wolframalpha.com/input/?i=%s\n</code></pre> <p>\u4e0d\u6b62\u5982\u6b64\uff01</p> <p>grep \u4e8b\u5b9e\u4e0a\u662f\u975e\u5e38\u5f3a\u5927\u7684\u67e5\u627e\u5de5\u5177\uff0c\u7b2c\u4e5d\u7ae0\u5c06\u5728\u4ecb\u7ecd\u6b63\u5219\u8868\u8fbe\u5f0f\u8bed\u6cd5\u4e4b\u540e\u8fdb\u4e00\u6b65\u4ecb\u7ecd grep\u3002</p> <p>\u5c0f\u77e5\u8bc6</p> <p>\u9664\u4e86 stdin \u548c stdout \u8fd8\u6709\u6807\u51c6\u9519\u8bef\uff08stderr\uff09\uff0c\u4ed6\u4eec\u7684\u7f16\u53f7\u5206\u522b\u662f 0\u30011\u30012\u3002stderr \u53ef\u4ee5\u7528 <code>2&gt;</code> \u91cd\u5b9a\u5411\uff08\u6ce8\u610f\u6570\u5b57 2 \u548c &gt; \u4e4b\u95f4\u6ca1\u6709\u7a7a\u683c\uff09\u3002</p> <p>\u4f7f\u7528 <code>2&gt;&amp;1</code> \u53ef\u4ee5\u5c06 stderr \u5408\u5e76\u5230 stdout\u3002</p> \u8303\u4f8b <p>\u8f93\u51fa\u5fc5\u5e94\u4e3b\u9875\u7684\u4ee3\u7801\uff1a</p> <pre><code>$ curl \"http://cn.bing.com\"\n</code></pre> <p>\u4f7f\u7528\u91cd\u5b9a\u5411\u628a\u5fc5\u5e94\u9875\u9762\u4fdd\u5b58\u81f3 <code>bing.html</code> \u672c\u5730\uff1a</p> <pre><code>$ curl \"http://cn.bing.com\" &gt; bing.html\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>-o</code> \u9009\u9879\u6307\u5b9a\u8f93\u51fa\u6587\u4ef6\uff1a</p> <pre><code>$ curl -o bing.html \"http://cn.bing.com\"\n</code></pre> <p>\u4e0b\u8f7d USTCLUG \u7684 logo\uff1a</p> <pre><code>$ curl -O \"https://ftp.lug.ustc.edu.cn/misc/logo-whiteback-circle.png\"\n</code></pre> <p>\u53ea\u5c55\u793a HTTP \u54cd\u5e94\u5934\u5185\u5bb9\uff1a</p> <p>```shell $ curl -I \"http://cn.bing.com\"</p> <p>\u53d8\u91cf\u4f7f\u7528\u793a\u4f8b</p> <p>\u53d8\u91cf\u5b9a\u4e49\uff1a</p> <pre><code>for skill in Ada Coffee Action Java; do\necho \"I am good at ${skill}Script\"\ndone\n</code></pre> <p>\u8868\u683c</p> <p>\u5e38\u7528\u7684\u9009\u9879</p> \u9009\u9879 \u542b\u4e49 <code>-i</code>, <code>--input-file=\u6587\u4ef6</code> \u4e0b\u8f7d\u672c\u5730\u6216\u5916\u90e8\u6587\u4ef6\u4e2d\u7684 URL <code>-O</code>, <code>--output-document=\u6587\u4ef6</code> \u5c06\u8f93\u51fa\u5199\u5165\u6587\u4ef6 <code>-b</code>, <code>--background</code> \u5728\u540e\u53f0\u8fd0\u884c wget <code>-d</code>, <code>--debug</code> \u8c03\u8bd5\u6a21\u5f0f\uff0c\u6253\u5370\u51fa wget \u8fd0\u884c\u65f6\u7684\u8c03\u8bd5\u4fe1\u606f"},{"location":"#\u7ae0\u8282\u7f16\u5199\u6307\u5bfc\u6807\u9898\u8bf7\u7528-h1-\u7b49\u7ea7\u7f16\u5199","title":"\u7ae0\u8282\u7f16\u5199\u6307\u5bfc\uff08\u6807\u9898\u8bf7\u7528 h1 \u7b49\u7ea7\u7f16\u5199\u3002\uff09","text":"<p>\u672c\u6587\u9762\u5411\u7f16\u5199\u7ec4\u63d0\u4f9b\u6307\u5bfc\u548c\u89c4\u8303\uff0c\u4e0d\u9762\u5411\u8bfb\u8005\u9605\u8bfb\uff0c\u4e0d\u5c5e\u4e8e\u672c\u4e66\u6b63\u6587\u3002</p> <p>\u5bfc\u8a00</p> <p>\u5728\u6bcf\u4e00\u7ae0\u7684\u5f00\u59cb\u90fd\u9700\u8981\u7f16\u5199\u7ae0\u8282\u5bfc\u8a00\u3002\u5bfc\u8a00\u7684\u76ee\u7684\u6709\u4e24\u4e2a\uff1a\u4e00\u662f\u4e3a\u4e86\u94fa\u57ab\u4e00\u4e9b\u524d\u7f6e\u77e5\u8bc6\u4ee5\u65b9\u4fbf\u540e\u7eed\u5c55\u5f00\u6b63\u6587\uff1b\u4e8c\u662f\u5199\u51fa\u4e00\u4e2a\u5185\u5bb9\u6458\u8981\u6765\u8f85\u52a9\u8bfb\u8005\u548c\u7f16\u8005\u81ea\u5df1\u5feb\u901f\u4e86\u89e3\u8be5\u7ae0\u8282\u7684\u6838\u5fc3\u5185\u5bb9\u548c\u8109\u7edc\u3002\u7f16\u5199\u5bfc\u8a00\u65f6\u53ef\u4ee5\u81ea\u5df1\u7ec4\u7ec7\u8bed\u8a00\uff0c\u4ee5\u7b80\u7ec3\u4e3a\u4e3b\uff0c\u4e0d\u9700\u8981\u9762\u9762\u4ff1\u5230\u3002</p> <p>\u201c\u7ae0\u8282\u7f16\u5199\u6307\u5bfc\u201d\u662f\u4e00\u4efd\u5199\u7ed9\u8be5\u8bb2\u4e49\u7684\u521b\u4f5c\u8005\u6240\u7528\u7684\u53c2\u8003\u6559\u7a0b\u3002\u5728\u63a5\u4e0b\u6765\u7684\u7f16\u5199\u4e2d\uff0c\u63a8\u8350\u5728\u672c\u5730\u4e5f\u5b89\u88c5\u4e00\u4e2a MkDocs \u6765\u5b9e\u65f6\u9884\u89c8\u9879\u76ee\u3002MkDocs \u57fa\u4e8e Python\uff0c\u6545\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982 <code>pip install mkdocs</code> \u7b49\u547d\u4ee4\u5b8c\u6210\u5b89\u88c5\u3002\u66f4\u5168\u9762\u7684\u5b89\u88c5\u6d41\u7a0b\u8bf7\u53c2\u8003 MkDocs \u5b98\u7f51\u5b89\u88c5\u8bf4\u660e \u5b9e\u73b0\u3002</p> <p>\u4f7f\u7528\u5f62\u5982 <code>!!! abstract \"\u5bfc\u8a00\"</code> \u7684\u65b9\u5f0f\u6dfb\u52a0\u4e00\u4e2a\u5bfc\u8a00\u6846\uff0c\u5e76\u5728\u4e0b\u9762\u82e5\u5e72\u884c\u901a\u8fc7\u7f29\u8fdb 1 \u4e2a\u5236\u8868\u7b26\u6216 4 \u4e2a\u7a7a\u683c\u7684\u65b9\u5f0f\u586b\u5199\u5bfc\u8a00\u91cc\u7684\u5185\u5bb9\uff0c\u884c\u4e0e\u884c\u4e4b\u95f4\u8bf7\u7a7a 1 \u884c\u3002</p> <p>Markdown \u683c\u5f0f\u6ce8\u610f\u4e8b\u9879</p> <p>\u76ee\u524d CI (GitHub Actions) \u5728\u90e8\u7f72\u6587\u6863\u65f6\uff0c\u989d\u5916\u6dfb\u52a0\u4e86\u4f7f\u7528 Prettier \u68c0\u67e5 Markdown \u98ce\u683c\u7684\u6b65\u9aa4\uff0c\u5982\u679c\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u4f60\u7684\u4fee\u6539\u4f1a\u88ab\u62d2\u7edd\u3002\u8bf7\u5728\u7f16\u8f91\u5b8c\u6210\u540e\u4f7f\u7528 Prettier \u68c0\u67e5\u5e76\u4fee\u590d Markdown \u683c\u5f0f\u3002</p> <p>\u53ef\u4ee5\u5728\u4ed3\u5e93\u6839\u76ee\u5f55\u4f7f\u7528 <code>npm install</code> \u5b89\u88c5 Prettier\uff0c\u4f7f\u7528 <code>npm run check</code> \u68c0\u67e5\u6587\u4ef6\u683c\u5f0f\uff0c\u4f7f\u7528 <code>npm run fix</code> \u4fee\u590d\u3002</p>"},{"location":"#main-content","title":"\u7ae0\u8282\u4e3b\u4f53\uff08\u4e3b\u4f53\u5185\u5bb9\u8bf7\u4ece h2 \u7b49\u7ea7\u4ee5\u4e0b\u6309\u5c42\u6b21\u7f16\u5199\u3002\uff09","text":"<p>\u7ae0\u8282\u91cc\u7684\u4e3b\u8981\u5185\u5bb9\u90fd\u5e94\u8be5\u5199\u5728\u4e3b\u4f53\u91cc\u3002\u4e3b\u4f53\u5305\u62ec\u6807\u9898\u548c\u6b63\u6587\uff1a\u6807\u9898\u90fd\u4ece h2 \u7b49\u7ea7\u4ee5\u4e0b\u6309\u5c42\u6b21\u7f16\u5199\uff0c\u800c\u6b63\u6587\u5219\u76f4\u63a5\u4f7f\u7528\u666e\u901a\u6587\u672c\u5373\u53ef\u3002</p> <p>\u4e3b\u4f53\u91cc\u5e94\u5f53\u5305\u62ec\u4e0e\u8be5\u7ae0\u8282\u4e3b\u9898\u76f8\u5173\u7684\u8be6\u7ec6\u5185\u5bb9\uff0c\u5177\u4f53\u5185\u5bb9\u4f9d\u8d56\u4e8e\u8bfe\u7eb2\u3002\u5efa\u8bae\u6bcf\u4e2a h2 \u7b49\u7ea7\u7684\u6807\u9898\u90fd\u5305\u542b\u4e00\u4e2a\u5b8c\u6574\u7684\u5b50\u6a21\u5757\uff0c\u4e0d\u540c\u7684 h2 \u5b50\u6a21\u5757\u7684\u5185\u5bb9\u5c3d\u53ef\u80fd\u6ca1\u6709\u5f3a\u70c8\u7684\u4f9d\u8d56\u3002\u8fd9\u4e2a\u6807\u51c6\u540c\u6837\u9002\u7528\u4e8e h3 \u53ca\u4ee5\u4e0b\u7684\u5b50\u6bb5\u843d\u3002</p> <p>\u6bcf\u4e00\u6bb5\u4e3b\u4f53\u5e94\u5f53\u6709\u5b8c\u6574\u7684\u5185\u5bb9\u3001\u6b63\u786e\u7684\u903b\u8f91\u548c\u901a\u987a\u7684\u6587\u5b57\u3002\u8bf7\u5c3d\u529b\u907f\u514d\u8bf8\u5982\u77e5\u8bc6\u70b9\u4f9d\u8d56\u94fe\u7f3a\u5931\u3001\u903b\u8f91\u9519\u8bef\u548c\u6587\u7b14\u96f6\u788e\u7b49\u5f71\u54cd\u8bfb\u8005\u9605\u8bfb\u4f53\u9a8c\u7684\u95ee\u9898\u3002\u5efa\u8bae\u6bcf\u6b21\u5199\u5b8c\u4ee5\u540e\u901a\u8fc7\u60f3\u8c61\u81ea\u5df1\u6b63\u662f\u8bfb\u8005\u8fdb\u884c\u9605\u8bfb\u7684\u65b9\u5f0f\u6765\u67e5\u6f0f\u8865\u7f3a\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u540c\u884c\u4ea4\u53c9\u5ba1\u9605\u7684\u65b9\u5f0f\u83b7\u53d6\u5b9d\u8d35\u7684\u5efa\u8bae\u3002</p>"},{"location":"#local-preview","title":"\u5728\u672c\u5730\u968f\u65f6\u9884\u89c8\u5f53\u524d\u4e3b\u9898\u4e0b\u7684\u683c\u5f0f","text":"<p>\u76ee\u524d\u5f53\u524d\u7684\u4e3b\u9898\u5df2\u7ecf\u786e\u5b9a\u4e3a Material\uff0c\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982 <code>pip install mkdocs-material</code> \u7b49\u547d\u4ee4\u5b8c\u6210\u4e3b\u9898\u7684\u5b89\u88c5\uff0c\u5e76\u5728\u5de5\u4f5c\u6839\u76ee\u5f55\u4e0b\u4f7f\u7528 <code>mkdocs serve</code> \u547d\u4ee4\u5e76\u8bbf\u95ee http://127.0.0.1:8000 \u6765\u5b9e\u65f6\u9884\u89c8\uff0c\u8fd9\u5bf9\u8bb2\u4e49\u7684\u7f16\u5199\u5341\u5206\u6709\u5e2e\u52a9\u3002</p> <p>\u66f4\u5168\u9762\u7684\u5b89\u88c5\u548c\u914d\u7f6e\u4fe1\u606f\u8bf7\u53c2\u8003 MkDocs \u5b98\u7f51 \u548c Material for MkDocs \u5b98\u7f51\u3002</p>"},{"location":"#use-admonitions","title":"\u5584\u7528\u63d0\u793a\u6846\u8ba9\u6b63\u6587\u4e3b\u6b21\u5206\u660e","text":"<p>\u901a\u5e38\u6765\u8bf4\uff0c\u4e3b\u4f53\u8981\u5305\u542b\u7684\u5185\u5bb9\u5982\u679c\u9700\u8981\u5199\u5f97\u5f88\u8be6\u5c3d\uff0c\u4e0d\u514d\u4f1a\u5e26\u6765\u4e3b\u6b21\u4e0d\u5206\u7684\u95ee\u9898\u3002\u56e0\u4e3a\u5f88\u591a\u77e5\u8bc6\u70b9\u7684\u7ed3\u6784\u5f88\u63a5\u8fd1\u6709\u5411\u65e0\u73af\u56fe\uff0c\u800c\u6587\u5b57\u6bd5\u7adf\u90fd\u662f\u7ebf\u6027\u7684\u3002\u975e\u8981\u8bf4\u4f7f\u7528\u62d3\u6251\u6392\u5e8f\u867d\u7136\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u77e5\u8bc6\u70b9\u4f9d\u8d56\u7f16\u5199\u98a0\u5012\u7684\u95ee\u9898\uff0c\u4f46\u4e5f\u96be\u4ee5\u8ba9\u8bfb\u8005\u5feb\u901f\u5206\u6790\u51fa\u4e3b\u5e72\u548c\u679d\u8282\u3002</p> <p>\u8bf7\u5584\u7528\u63d0\u793a\u6846\uff0c\u8ba9\u8bfb\u8005\u5bf9\u5185\u5bb9\u7684\u4e3b\u6b21\u3001\u6210\u5206\u4e00\u76ee\u4e86\u7136\uff0c\u4e5f\u80fd\u8ba9\u4f60\u7684\u4f5c\u54c1\u5c42\u6b21\u66f4\u52a0\u4e30\u5bcc\u3002</p> <p>\u91cd\u70b9</p> <p>\u5efa\u8bae\u7528\u8fd9\u79cd\u63d0\u793a\u6846\u6765\u5212\u51fa\u91cd\u8981\u7684\u77e5\u8bc6\u70b9\uff0c\u53ef\u4ee5\u662f\u4e00\u6bb5\u5185\u5bb9\u7684\u6838\u5fc3\u603b\u7ed3\u3002</p> <p>\u4f7f\u7528\u5f62\u5982 <code>!!! info \"\u91cd\u70b9\"</code> \u7684\u65b9\u5f0f\u6dfb\u52a0\u4e00\u4e2a\u91cd\u70b9\u6846\u3002</p> <p>\u8303\u4f8b</p> <p>\u5efa\u8bae\u7528\u8fd9\u79cd\u63d0\u793a\u6846\u6765\u5217\u51fa\u4e00\u4e2a\u8303\u4f8b\u3002</p> <p>\u4f7f\u7528\u5f62\u5982 <code>!!! example \"\u8303\u4f8b\"</code> \u7684\u65b9\u5f0f\u6dfb\u52a0\u4e00\u4e2a\u8303\u4f8b\u6846\u3002</p> <p>\u5c0f\u77e5\u8bc6</p> <p>\u5efa\u8bae\u7528\u8fd9\u79cd\u63d0\u793a\u6846\u6765\u5728\u4fdd\u7559\u6b63\u6587\u8fde\u8d2f\u6027\u7684\u540c\u65f6\u6dfb\u52a0\u7ec6\u679d\u672b\u8282\u7684\u77e5\u8bc6\u3002</p> <p>\u4f7f\u7528\u5f62\u5982 <code>!!! tip \"\u5c0f\u77e5\u8bc6\"</code> \u7684\u65b9\u5f0f\u6dfb\u52a0\u4e00\u4e2a\u5c0f\u77e5\u8bc6\u6846\u3002</p> <p>\u6ce8\u610f\uff1a\u8bf7\u52ff\u62fc\u5199\u4e3a tips\uff0c\u5426\u5219\u683c\u5f0f\u4f1a\u88ab\u8bc6\u522b\u4e3a\u63d0\u793a\uff08note\uff09\u6846\u3002</p> <p>\u8bf7\u5728\u63d0\u793a\u6846\u7684\u6807\u9898\u884c\u540e\u9762\u7559\u4e00\u4e2a\u7a7a\u884c</p> <p>\u7531\u4e8e Prettier \u7684\u89e3\u6790\u65b9\u5f0f\u95ee\u9898\uff0c\u8bf7\u5728\u6240\u6709\u63d0\u793a\u6846\u7684\u8d77\u59cb\u884c\u540e\u9762\u6dfb\u52a0\u4e00\u4e2a\u7a7a\u884c\uff0c\u4e0d\u8981\u50cf Material \u4e3b\u9898\u5b98\u7f51\u90a3\u6837\u6ca1\u6709\u7a7a\u884c\u76f4\u63a5\u5f00\u59cb\u63d0\u793a\u6846\u5185\u5bb9\u3002</p> <p> **\u9519\u8bef**\u683c\u5f0f\uff1a</p> <pre><code>!!! note\n    \u63d0\u793a\u6846\u5185\u5bb9\n</code></pre> <p> **\u6b63\u786e**\u683c\u5f0f\uff1a</p> <pre><code>!!! note\n\n    \u63d0\u793a\u6846\u5185\u5bb9\n</code></pre> <p>\u66f4\u591a\u79cd\u7c7b\u7684\u63d0\u793a\u6846\u8bf7\u53c2\u8003 \u63d0\u793a\u6846\u4e00\u89c8\u3002</p>"},{"location":"#heading-ids","title":"\u4e3a\u6807\u9898\u548c\u5c0f\u6807\u9898\u6dfb\u52a0 ID","text":"<p>\u7531\u4e8e\u6587\u7ae0\u7bc7\u76ee\u8f83\u957f\uff0c\u4f7f\u7528\u65f6\u4f1a\u7ecf\u5e38\u9047\u5230\u9700\u8981\u94fe\u63a5\u5230\u6587\u7ae0\u67d0\u4e00\u6bb5\u7684\u60c5\u51b5\u3002\u53d7\u9650\u4e8e MkDocs \u81ea\u52a8\u751f\u6210 Anchor ID \u7684\u529f\u80fd\uff08\u53ea\u652f\u6301\u82f1\u6587\u5b57\u7b26\uff09\uff0c\u7eaf\u4e2d\u6587\u7684\u6807\u9898\u4f1a\u5bfc\u81f4\u751f\u6210 <code>_1</code>, <code>_2</code> \u8fd9\u6837\u7684 ID\u3002\u4e00\u65b9\u9762\u8fd9\u6837\u7684 ID \u770b\u8d77\u6765\u4e0d\u76f4\u89c2\uff0c\u53e6\u4e00\u65b9\u9762\u6bcf\u5f53\u6807\u9898\u53d1\u751f\u589e\u51cf\u65f6\u8fd9\u4e9b ID \u90fd\u4f1a\u53d8\uff0c\u56e0\u6b64\u8bf7\u4e3a\u6bcf\u4e2a\u6807\u9898\u624b\u52a8\u6dfb\u52a0\u4e00\u4e2a\u6709\u610f\u4e49\u7684 ID\uff08\u6700\u5f00\u59cb\u7684\u6807\u9898 H1 \u9664\u5916\uff09\uff0c\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>### \u4e3a\u6807\u9898\u548c\u5c0f\u6807\u9898\u6dfb\u52a0 ID {#heading-ids}\n</code></pre> <p>\u5efa\u8bae ID \u53ea\u5305\u542b\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u6a2a\u7ebf <code>-</code>\uff0c\u5fc5\u8981\u65f6\u4f7f\u7528\u53e5\u70b9\uff08\u4e0d\u4f7f\u7528\u5927\u5199\u5b57\u6bcd\u548c\u5176\u4ed6\u6807\u70b9\u7b26\u53f7\uff09\u3002</p> <p>\u6ce8\u610f</p> <p><code>{#</code> **\u524d\u9762**\u9700\u8981\u6709\u4e00\u4e2a\u7a7a\u683c\uff0c\u5426\u5219\u4f60\u4f1a\u50cf\u4e0b\u9762\u8fd9\u4f4d\u540c\u5b66\u4e00\u6837\u7ffb\u8f66\uff1a</p> <p></p> <p>\u51fa\u4e8e\u98ce\u683c\u4e00\u81f4\u6027\u8003\u8651\uff0c\u8bf7\u4e0d\u8981\u5728 <code>{#</code> **\u540e\u9762**\u52a0\u7a7a\u683c\uff1a</p> <pre><code>\u2714 ### \u4e3a\u6807\u9898\u548c\u5c0f\u6807\u9898\u6dfb\u52a0 ID {#heading-ids}\n\u274c ### \u4e3a\u6807\u9898\u548c\u5c0f\u6807\u9898\u6dfb\u52a0 ID {# heading-ids}\n</code></pre> <p>\u6ce8\u610f 2</p> <p>\u8bf7\u4e0d\u8981\u5728\u6bcf\u9875\u6700\u5f00\u59cb\u7684\u6807\u9898\uff08\u552f\u4e00\u4e00\u4e2a H1\uff09\u540e\u6dfb\u52a0 <code>{#id-tag}</code>\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e00\u4e9b\u610f\u6599\u4e4b\u5916\u7684\u663e\u793a\u9519\u8bef\u3002</p>"},{"location":"#image-caption","title":"\u4e3a\u56fe\u7247\u6dfb\u52a0\u914d\u5b57","text":"<p>\u5728\u56fe\u7247\u4e0b\u65b9\u5199\u4e00\u884c\u6587\u5b57\u4f5c\u4e3a\u914d\u5b57\uff0c\u5e76\u5728\u8fd9\u884c\u5b57**\u7d27\u63a5\u7740\u7684\u4e0b\u4e00\u884c**\uff08\u4e0d\u80fd\u6709\u7a7a\u884c\uff09\u5199\u4e0a <code>{: .caption }</code>\uff0c\u8fd9\u6837\u914d\u7684\u8fd9\u884c\u5b57\u6e32\u67d3\u6210 HTML \u65f6\u5c31\u52a0\u4e0a\u4e86 <code>class=\"caption\"</code>\uff0c\u663e\u793a\u4e3a 0.94 \u500d\u7684\u5b57\u4f53\u3001\u7070\u8272\u3001\u8d34\u8fd1\u56fe\u7247\u3002</p> <pre><code>![image](url)\n\n\u56fe 1. \u8fd9\u5f20\u56fe\u7247\u7684\u4e00\u884c\u914d\u5b57\n{: .caption }\n</code></pre>"},{"location":"#extra-reading","title":"\u81ea\u4e3b\u9605\u8bfb\u8282 *","text":"<p>\u53ef\u4ee5\u5728\u7ae0\u8282\u4e3b\u4f53\u4e2d\u5305\u62ec\u82e5\u5e72\u81ea\u4e3b\u9605\u8bfb\u8282\uff0c\u539f\u5219\u4e0a\u8fd9\u4e00\u90e8\u5206\u7684\u7ed3\u6784\u4e0e\u5176\u5b83\u7ae0\u8282\u4e3b\u4f53\u5e76\u65e0\u4e0d\u540c\uff0c\u53ea\u662f\u4e0d\u4f1a\u5728\u8bfe\u5802\u4e0a\u8bb2\u6388\u3002</p> <p>\u5728\u6240\u6709\u81ea\u4e3b\u9605\u8bfb\u8282\u7684\u6807\u9898\u540e\u9762\u6253\u4e0a\u661f\u53f7 * \uff0c\u5e76\u5efa\u8bae\u5c3d\u53ef\u80fd\u653e\u5728\u540e\u9762\u3002</p>"},{"location":"#thinking-question","title":"\u601d\u8003\u9898","text":"<p>\u5efa\u8bae\u5728\u6bcf\u4e00\u7ae0\u540e\u8bbe\u8ba1\u82e5\u5e72\u601d\u8003\u9898\uff0c\u6765\u5e2e\u52a9\u8bfb\u8005\u6295\u5165\u5230\u4e00\u4e9b\u5b9e\u9645\u95ee\u9898\u7684\u601d\u8003\u4e2d\u3002\u597d\u7684\u601d\u8003\u9898\u63a8\u8350\u4ece\u5b9e\u9645\u9700\u6c42\u4e2d\u91c7\u96c6\u7075\u611f\uff0c\u5e76\u4e14\u62e5\u6709\u7b80\u5355\u7684\u9898\u5e72\u548c\u5178\u578b\u7684\u89e3\u51b3\u601d\u8def\u3002</p> <p>\u5982\u4f55\u5f97\u5230\u4ee3\u8868\u601d\u8003\u9898\u7684\u63d0\u793a\u6846\uff1f</p> <p>\u5efa\u8bae\u4f7f\u7528\u8fd9\u6837\u7684\u63d0\u793a\u6846\u53ef\u4ee5\u7528\u6765\u8868\u8fbe\u4e00\u4e2a\u601d\u8003\u9898\u3002</p> <p>\u56e0\u6b64\u4f7f\u7528\u4ec0\u4e48\u6837\u7684\u547d\u4ee4\u80fd\u751f\u6210\u8fd9\u6837\u7684\u63d0\u793a\u6846\u5462\uff1f\uff08\u8bf7\u53c2\u8003\u6e90\u7801\uff0c\u6216\u8005\u4e0a\u6587\u7ed9\u51fa\u7684\u63d0\u793a\u6846\u4e00\u89c8\u94fe\u63a5\u3002\uff09</p> <p>\u5efa\u8bae\u4e0d\u8981\u76f4\u63a5\u628a\u7b54\u6848\u653e\u5728\u6bcf\u4e2a\u95ee\u9898\u4e0b\u65b9\uff0c\u53ef\u4ee5\u4e13\u95e8\u7f16\u5199\u4e00\u4efd\u601d\u8003\u9898\u89e3\u7b54\u9875\u9762\u96c6\u4e2d\u653e\u7f6e\u3002</p>"},{"location":"#further-reading","title":"\u62d3\u5c55\u9605\u8bfb","text":"<p>Linux \u7684\u77e5\u8bc6\u7ed3\u6784\u5448\u975e\u7ebf\u6027\uff0c\u4ec5\u6709\u5355\u7ebf\u7684\u6b63\u6587\u662f\u4e0d\u8db3\u7684\u3002\u8bf7\u5e7f\u6cdb\u67e5\u9605\u4e0e\u672c\u7ae0\u76f8\u5173\u7684\u8d44\u6599\uff0c\u6839\u636e\u5b9e\u9645\u9700\u8981\u4e3a\u8bfb\u8005\u9002\u5f53\u89c4\u5212\u4e00\u4e9b\u4e0e\u672c\u7ae0\u76f8\u5173\u7684\u989d\u5916\u77e5\u8bc6\uff0c\u5e76\u968f\u9644\u4f18\u8d28\u7684\u6559\u7a0b\u3001\u767e\u79d1\u7b49\u8d44\u6e90\uff08\u5982\u6709\uff09\uff0c\u4f9b\u611f\u5174\u8da3\u7684\u8bfb\u8005\u8fdb\u4e00\u6b65\u9605\u8bfb\u3002\u62d3\u5c55\u9605\u8bfb\u653e\u7f6e\u5728\u4e0e\u6b63\u6587\u5e73\u7ea7\u7684 <code>supplement.md</code> \u4e2d\uff0c\u6bcf\u4e2a\u72ec\u7acb\u7684\u989d\u5916\u77e5\u8bc6\u70b9\u90fd\u662f\u4e00\u4e2a h2 \u7b49\u7ea7\u8282\u3002</p> <p>\u989d\u5916\u524d\u7f6e\u77e5\u8bc6\u8b66\u544a</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u7f16\u5199\u601d\u8def\u4e0d\u53d7\u9650\uff0c\u4ee5\u53ca\u9f13\u52b1\u8bfb\u8005\u591a\u591a\u81ea\u884c\u5b66\u4e60\uff0c\u62d3\u5c55\u9605\u8bfb\u53ef\u4ee5\u4f9d\u8d56\u540e\u7eed\u7ae0\u8282\u548c\u672c\u4e66\u89c4\u5212\u5185\u5bb9\u4ee5\u5916\u7684\u77e5\u8bc6\u3002\u5982\u679c\u5b58\u5728\u8fd9\u79cd\u60c5\u51b5\uff0c\u8bf7\u5728\u5bf9\u5e94\u7684\u8282\u6807\u9898\u4e0b\u9762\u7d27\u8ddf\u4e00\u4e2a\u8b66\u544a\u63d0\u793a\u6846\uff0c\u6307\u51fa\u6240\u4f9d\u8d56\u7684\u77e5\u8bc6\uff08\u4e66\u5185\u6216\u4e66\u5916\uff09\u3002\u8b66\u544a\u5f62\u5f0f\u5982\u4e0b\uff1a</p> <p>\u672c\u8282\u62d3\u5c55\u5185\u5bb9\u4f9d\u8d56\u5982\u4e0b\u989d\u5916\u7684\u524d\u7f6e\u77e5\u8bc6\uff0c\u5efa\u8bae\u5148\u9605\u8bfb\u5e76\u638c\u63e1\u5bf9\u5e94\u5185\u5bb9\u540e\u518d\u7814\u8bfb\u672c\u8282\uff1a</p> <ul> <li>\u7b2c\u4e00\u7ae0 \u4e2d\u79d1\u5927\u5f00\u6e90\u793e\u7fa4\uff1aLUG@USTC</li> <li>LUG@USTC \u5b98\u65b9\u7f51\u7ad9</li> </ul>"},{"location":"#reference-footnote","title":"\u5f15\u7528\u4e0e\u811a\u6ce8","text":"<p>\u811a\u6ce8\u7528\u4e8e\u5728\u6b63\u6587\u5c3e\u90e8\u6ce8\u660e\u4e00\u5c0f\u6bb5\u5185\u5bb9\u7684\u7684\u6765\u6e90\u5f15\u7528\u94fe\u63a5\u6216\u8005\u662f\u8fdb\u884c**\u4e0d\u91cd\u8981**\u7684\u8bf4\u660e\u3002<sup>1</sup>\u56e0\u4e3a\u91cd\u8981\u7684\u8bf4\u660e\u6700\u597d\u76f4\u63a5\u8ddf\u5728\u540e\u9762\u89e3\u91ca\u6216\u8005\u5728\u6bb5\u843d\u540e\u9762\u7528\u63d0\u793a\u6846\uff0c\u4ee5\u514d\u7834\u574f\u8bfb\u8005\u9605\u8bfb\u7684\u8fde\u8d2f\u6027\u3002</p> <p>\u5f15\u7528\u6846\u5219\u7528\u4e8e\u5728\u6b63\u6587\u548c\u62d3\u5c55\u5185\u5bb9\u4e2d\u5f15\u7528\u4ed6\u4eba\u7684\u8a00\u8bba\u6216\u6307\u51fa\u5916\u94fe\u3002</p> <p>\u4e2d\u6587\u6587\u6848\u6392\u7248\u89c4\u8303</p> <p>\u8bf7\u53c2\u8003 \u8be5\u89c4\u8303 \u6765\u7edf\u4e00\u6700\u57fa\u672c\u7684\u4e2d\u82f1\u6587\u6392\u7248\u683c\u5f0f\u3002</p> <p>\u4f7f\u7528\u5f62\u5982 <code>!!! quote \"\u5c0f\u77e5\u8bc6\"</code> \u7684\u65b9\u5f0f\u6dfb\u52a0\u4e00\u4e2a\u5f15\u7528\u6846\u3002</p>"},{"location":"#\u5176\u4ed6\u53c2\u8003\u7b14\u8bb0_1","title":"\u5176\u4ed6\u53c2\u8003\u7b14\u8bb0","text":"<p>Mkdocs \u6559\u7a0b<ul> <li> <p>Material for MkDocs</p> </li> <li> <p>Mkdocs Material\u4f7f\u7528\u8bb0\u5f55</p> </li> <li> <p>MkDocs \u6587\u6863\u5f00\u53d1\u6559\u7a0b</p> </li> <li> <p>mkdocs \u6559\u7a0b</p> </li> <li> <p>Markdown\u8bed\u6cd5\u5b66\u4e60 \u7cbe\u7b80\u7248</p> </li> <li> <p>\u5229\u7528mkdocs\u90e8\u7f72\u9759\u6001\u7f51\u9875\u81f3GitHub pages</p> </li> <li> <p>MkDocs: \u6784\u5efa\u4f60\u81ea\u5df1\u7684\u77e5\u8bc6\u5e93 </p> </li> <li> <p>\u5feb\u6765\u7f8e\u5316\u4f60\u7684MKDocs\u5427</p> </li> </ul> </p> <p>\u4ed6\u4eba mkdocs\u793a\u4f8b<ul> <li> <p>Linux 101 Docs</p> </li> <li> <p>CS\u81ea\u5b66\u6307\u5357</p> </li> <li> <p>Mkdocs Material\u4f7f\u7528\u8bb0\u5f55</p> </li> <li> <p>Material for MkDocs</p> </li> </ul> </p> <p>\u4e00\u4e9b\u9879\u76ee<ul> <li> <p>awesome-kubernetes-notes</p> </li> <li> <p>kubectl-img</p> </li> <li> <p>shell-scripts</p> </li> </ul> </p>"},{"location":"#blog","title":"Blog","text":""},{"location":"#mkdocs\u5e38\u7528\u547d\u4ee4","title":"mkdocs\u5e38\u7528\u547d\u4ee4","text":"<pre><code>mkdocs new [dir-name] # - \u521b\u5efa\u65b0\u9879\u76ee\uff1b\nmkdocs serve # - \u542f\u52a8\u672c\u5730\u670d\u52a1\u5e76\u5b9e\u65f6\u66f4\u65b0\u7ad9\u70b9\u6587\u4ef6\u4fee\u6539\uff1b\nmkdocs build # - \u6784\u5efa\u9759\u6001\u7ad9\u70b9\u6587\u4ef6\uff1b\nmkdocs build --clean # \u521b\u5efa\u7f16\u8bd1\u540e\u7684\u9759\u6001\u9875\u9762\u4ee5\u53ca\u6837\u5f0f\u6587\u4ef6\nmkdocs gh-deploy # - \u5c06\u7ad9\u70b9\u6587\u4ef6\u90e8\u7f72\u5230Github\u4ed3\u5e93\uff1b\n</code></pre> <ol> <li> <p>\u4e0d\u91cd\u8981\u7684\u8bf4\u660e\u5982\uff1a\u67d0\u4e9b\u540d\u8bcd\u7684\u6765\u5386\u3001\u89e3\u91ca\uff08\u7f29\u5199\u7684\uff09\u672f\u8bed\u3001\u4e00\u4e9b\u9898\u5916\u8f76\u4e8b\u548c\u63d2\u66f2\u7b49\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/","title":"Docker","text":"<p>\u7cfb\u7edf\u5168\u9762\u7684\u5b66\u4e60Docker</p>"},{"location":"Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/#\u4e66\u7c4d\u5c01\u9762","title":"\u4e66\u7c4d\u5c01\u9762","text":""},{"location":"Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/#\u5185\u5bb9\u76ee\u5f55","title":"\u5185\u5bb9\u76ee\u5f55","text":""},{"location":"Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/#1docker\u57fa\u7840","title":"1.Docker\u57fa\u7840","text":""},{"location":"Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/#2\u5b9e\u6218\u6848\u4f8b","title":"2.\u5b9e\u6218\u6848\u4f8b","text":""},{"location":"Docker/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Docker/#3devops","title":"3.Devops","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/","title":"1.\u5b89\u88c5Docker","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#1-docker\u5b89\u88c5","title":"1. Docker\u5b89\u88c5","text":"Centos\u7cfb\u7edfUbuntu\u7cfb\u7edfdebain\u4e8c\u8fdb\u5236\u5305\u5b89\u88c5\u4e00\u952e\u5b89\u88c5docker-compose\u5b89\u88c5 <p>\u7cfb\u7edf\u8981\u6c42 Docker \u652f\u6301 64 \u4f4d\u7248\u672c CentOS \u215e\uff0c\u5e76\u4e14\u8981\u6c42\u5185\u6838\u7248\u672c\u4e0d\u4f4e\u4e8e 3.10\u3002  CentOS 7 \u6ee1\u8db3\u6700\u4f4e\u5185\u6838\u7684\u8981\u6c42\uff0c\u4f46\u7531\u4e8e\u5185\u6838\u7248\u672c\u6bd4\u8f83\u4f4e\uff0c\u90e8\u5206\u529f\u80fd\uff08\u5982 overlay2 \u5b58\u50a8\u5c42\u9a71\u52a8\uff09\u65e0\u6cd5\u4f7f\u7528\uff0c\u5e76\u4e14\u90e8\u5206\u529f\u80fd\u53ef\u80fd\u4e0d\u592a\u7a33\u5b9a\u3002</p> <p>\u5378\u8f7d\u65e7\u7248\u672c <pre><code>sudo yum remove docker \\\ndocker-client \\\ndocker-client-latest \\\ndocker-common \\\ndocker-latest \\\ndocker-latest-logrotate \\\ndocker-logrotate \\\ndocker-selinux \\\ndocker-engine-selinux \\\ndocker-engine\n</code></pre></p> <pre><code>curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo\nsed -i 's#download.docker.com#mirrors.ustc.edu.cn/docker-ce#g' /etc/yum.repos.d/docker-ce.repo\nyum -y install docker-ce bash-completion\ncp /usr/share/bash-completion/completions/docker /etc/bash_completion.d/\n\nmkdir  /etc/docker\ncat &gt; /etc/docker/daemon.json &lt;&lt;EOF\n{\n  \"data-root\": \"/var/lib/docker\",\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"200m\",\n    \"max-file\": \"5\"\n  },\n  \"default-ulimits\": {\n    \"nofile\": {\n      \"Name\": \"nofile\",\n      \"Hard\": 655360,\n      \"Soft\": 655360\n    },\n    \"nproc\": {\n      \"Name\": \"nproc\",\n      \"Hard\": 655360,\n      \"Soft\": 655360\n    }\n  },\n  \"live-restore\": true,\n  \"oom-score-adjust\": -1000,\n  \"max-concurrent-downloads\": 10,\n  \"max-concurrent-uploads\": 10,\n  \"storage-driver\": \"overlay2\",\n  \"storage-opts\": [\"overlay2.override_kernel_check=true\"],\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"registry-mirrors\": [\n    \"https://yssx4sxy.mirror.aliyuncs.com/\"\n  ]\n}\nEOF\nsystemctl enable --now docker\n\n# \u5efa\u7acb docker \u7528\u6237\u7ec4\nsudo groupadd docker\n# \u5c06\u5f53\u524d\u7528\u6237\u52a0\u5165 docker \u7ec4\uff1a\nsudo usermod -aG docker $USER\n# \u5220\u9664\nyum autoremove docker-ce\nrm -rf /var/lib/docker\n\n\u6dfb\u52a0\u5185\u6838\u53c2\u6570\n\u5982\u679c\u5728 CentOS \u4f7f\u7528 Docker \u770b\u5230\u4e0b\u9762\u7684\u8fd9\u4e9b\u8b66\u544a\u4fe1\u606f\uff1a\n```shell\nWARNING: bridge-nf-call-iptables is disabled\nWARNING: bridge-nf-call-ip6tables is disabled\n</code></pre> <p>\u8bf7\u6dfb\u52a0\u5185\u6838\u914d\u7f6e\u53c2\u6570\u4ee5\u542f\u7528\u8fd9\u4e9b\u529f\u80fd\u3002 <pre><code>sudo tee -a /etc/sysctl.conf &lt;&lt;-EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n</code></pre> \u7136\u540e\u91cd\u65b0\u52a0\u8f7d sysctl.conf \u5373\u53ef <pre><code>sudo sysctl -p\n</code></pre></p> <p>\u53c2\u8003\u6587\u6863 Docker \u5b98\u65b9 CentOS \u5b89\u88c5\u6587\u6863\u3002</p> <p>https://firewalld.org/2018/07/nftables-backend https://github.com/moby/libnetwork/issues/2496 ```</p> <p>\u7cfb\u7edf\u8981\u6c42 Docker \u652f\u6301\u4ee5\u4e0b\u7248\u672c\u7684 Ubuntu \u64cd\u4f5c\u7cfb\u7edf\uff1a</p> <ul> <li>Ubuntu Groovy 20.10</li> <li>Ubuntu Focal 20.04 (LTS)</li> <li>Ubuntu Bionic 18.04 (LTS)</li> <li>Ubuntu Xenial 16.04 (LTS)</li> </ul> <p>Docker \u53ef\u4ee5\u5b89\u88c5\u5728 64 \u4f4d\u7684 x86 \u5e73\u53f0\u6216 ARM \u5e73\u53f0\u4e0a\u3002 Ubuntu \u53d1\u884c\u7248\u4e2d\uff0cLTS\uff08Long-Term-Support\uff09\u957f\u671f\u652f\u6301\u7248\u672c\uff0c\u4f1a\u83b7\u5f97 5 \u5e74\u7684\u5347\u7ea7\u7ef4\u62a4\u652f\u6301\uff0c\u8fd9\u6837\u7684\u7248\u672c\u4f1a\u66f4\u7a33\u5b9a\uff0c\u56e0\u6b64\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u63a8\u8350\u4f7f\u7528 LTS \u7248\u672c\u3002</p> <p>\u5378\u8f7d\u65e7\u7248\u672c <pre><code>sudo apt-get remove docker \\\ndocker-engine \\\ndocker.io </code></pre></p> <pre><code>sudo apt-get update\nsudo apt-get -y install \\\napt-transport-https \\\nca-certificates \\\ncurl \\\ngnupg \\\nlsb-release\ncurl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n# \u5b98\u65b9\u6e90\n# curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n# \u6211\u4eec\u9700\u8981\u5411 sources.list \u4e2d\u6dfb\u52a0 Docker \u8f6f\u4ef6\u6e90\necho \\\n\"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://mirrors.aliyun.com/docker-ce/linux/ubuntu \\\n$(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\n# \u5b98\u65b9\u6e90\n# echo \\\n#   \"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\\n#   $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\nsudo apt-get update   sudo apt-get install docker-ce docker-ce-cli containerd.io bash-completion\ncp /usr/share/bash-completion/completions/docker /etc/bash_completion.d/\n\ncat &gt; /etc/docker/daemon.json &lt;&lt;EOF\n{\n  \"data-root\": \"/var/lib/docker\",\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"200m\",\n    \"max-file\": \"5\"\n  },\n  \"default-ulimits\": {\n    \"nofile\": {\n      \"Name\": \"nofile\",\n      \"Hard\": 655360,\n      \"Soft\": 655360\n    },\n    \"nproc\": {\n      \"Name\": \"nproc\",\n      \"Hard\": 655360,\n      \"Soft\": 655360\n    }\n  },\n  \"live-restore\": true,\n  \"oom-score-adjust\": -1000,\n  \"max-concurrent-downloads\": 10,\n  \"max-concurrent-uploads\": 10,\n  \"storage-driver\": \"overlay2\",\n  \"storage-opts\": [\"overlay2.override_kernel_check=true\"],\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"registry-mirrors\": [\n    \"https://yssx4sxy.mirror.aliyuncs.com/\"\n  ]\n}\nEOF\nsystemctl enable docker &amp;&amp; systemctl restart docker\n\n# \u5efa\u7acb docker \u7528\u6237\u7ec4\nsudo groupadd docker\n# \u5c06\u5f53\u524d\u7528\u6237\u52a0\u5165 docker \u7ec4\uff1a\nsudo usermod -aG docker $USER\n# \u5220\u9664\napt-get remove -y docker docker-engine docker.io containerd runc\nrm -rf /var/lib/docker\n</code></pre> <p>\u7cfb\u7edf\u8981\u6c42 Docker \u652f\u6301\u4ee5\u4e0b\u7248\u672c\u7684 Debian \u64cd\u4f5c\u7cfb\u7edf\uff1a</p> <ul> <li>Debian Buster 10</li> <li>Debian Stretch 9</li> </ul> <p>\u5378\u8f7d\u65e7\u7248\u672c <pre><code>sudo apt-get remove docker \\\ndocker-engine \\\ndocker.io\n</code></pre></p> <pre><code>apt-get update\napt-get install -y apt-transport-https ca-certificates curl gnupg2 software-properties-common\ncurl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/debian/gpg | sudo apt-key add -\nadd-apt-repository \\\n\"deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/debian \\\n$(lsb_release -cs) \\\n   stable\"\napt-get update\napt-get install -y docker-ce bash-completion\ncp /usr/share/bash-completion/completions/docker /etc/bash_completion.d/\n\ncat &gt; /etc/docker/daemon.json &lt;&lt;EOF\n{\n  \"data-root\": \"/var/lib/docker\",\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"200m\",\n    \"max-file\": \"5\"\n  },\n  \"default-ulimits\": {\n    \"nofile\": {\n      \"Name\": \"nofile\",\n      \"Hard\": 655360,\n      \"Soft\": 655360\n    },\n    \"nproc\": {\n      \"Name\": \"nproc\",\n      \"Hard\": 655360,\n      \"Soft\": 655360\n    }\n  },\n  \"live-restore\": true,\n  \"oom-score-adjust\": -1000,\n  \"max-concurrent-downloads\": 10,\n  \"max-concurrent-uploads\": 10,\n  \"storage-driver\": \"overlay2\",\n  \"storage-opts\": [\"overlay2.override_kernel_check=true\"],\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"registry-mirrors\": [\n    \"https://yssx4sxy.mirror.aliyuncs.com/\"\n  ]\n}\nEOF\nsystemctl enable docker &amp;&amp; systemctl restart docker\n\n# \u5220\u9664\napt-get remove -y docker docker-engine docker.io containerd runc\nrm -rf /var/lib/docker\n</code></pre> <p>\u79bb\u7ebf\u5b89\u88c5</p> <p>https://www.cnblogs.com/superlinux/p/14070141.html</p> <pre><code>$ wget wget https://download.docker.com/linux/static/stable/x86_64/docker-23.0.4.tgz\n$ tar zxf docker-23.0.4.tgz\n$ cp docker/* /usr/bin\n$ cat &gt;/etc/systemd/system/docker.service &lt;&lt;EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service\nWants=network-online.target\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd\nExecReload=/bin/kill -s HUP $MAINPID\nLimitNOFILE=infinity\nLimitNPROC=infinity\nTimeoutStartSec=0\nDelegate=yes\nKillMode=process\nRestart=on-failure\nStartLimitBurst=3\nStartLimitInterval=60s\n[Install]\nWantedBy=multi-user.target\nEOF\n# \u589e\u52a0\u53ef\u6267\u884c\u6743\u9650\n$ sudo chmod +x /etc/systemd/system/docker.service\n# \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\n$ sudo systemctl daemon-reload\n\n# \u542f\u52a8\u5bb9\u5668\u548c\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\n$ sudo systemctl enable --now docker.service\n# \u67e5\u770b\u72b6\u6001\n$ sudo systemctl status docker\n\n$ docker version\n# \u914d\u7f6e\u955c\u50cf\u52a0\u901f\u5668\n$ cat &gt; /etc/docker/daemon.json &lt;&lt;'EOF'\n{\n  \"data-root\": \"/data/docker\",\n  \"storage-driver\": \"overlay2\",\n  \"insecure-registries\": [\"hub.gitee.com\"],\n  \"registry-mirrors\": [\"https://25bxwt20.mirror.aliyuncs.com\"],\n  \"live-restore\": true,\n  \"bip\": \"172.16.200.1/24\",\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"hosts\": [\"tcp://0.0.0.0:2375\", \"unix:///var/run/docker.sock\"],\n  \"log-opts\": {\n    \"max-size\":\"100M\",\n    \"max-file\":\"3\"\n  }\n}\nEOF\n$ systemctl restart docker\n</code></pre> <p>\u8bf4\u660e</p> <p>\u8bf4\u660e\uff1a\u4f7f\u7528\u963f\u91cc\u4e91\u955c\u50cf\u52a0\u901f\uff0c\u9700\u8981\u6ce8\u518c\u963f\u91cc\u4e91\u8d26\u53f7\uff0c\u901a\u8fc7\u8fdb\u5165\u529f\u80fd\u83dc\u5355\u201c\u5f39\u6027\u8ba1\u7b97\u201d-&gt;\u201c\u5bb9\u5668\u955c\u50cf\u670d\u52a1\u201d-&gt;\u201c\u7ba1\u7406\u63a7\u5236\u53f0\u201d-&gt;\u201c\u955c\u50cf\u4e2d\u5fc3\u201d-&gt;\u201c\u955c\u50cf\u52a0\u901f\u5668\u201d\uff0c\u627e\u5230\u64cd\u4f5c\u6307\u5f15\u3002</p> <p>Docker\u6743\u9650\u914d\u7f6e</p> <p>Docker\u8fdb\u7a0b\u4f7f\u7528Unix Socket\u800c\u4e0d\u662fTCP\u7aef\u53e3\u3002\u800c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cUnix socket\u5c5e\u4e8eroot\u7528\u6237\uff0c\u56e0\u6b64\u9700\u8981root\u6743\u9650\u624d\u80fd\u8bbf\u95ee\u3002\u6240\u4ee5\u9700\u8981\u521b\u5efa\u7528\u6237\u7ec4\u6765\u8bbf\u95ee\u548c\u4f7f\u7528\u3002</p> <pre><code># \u6dfb\u52a0docker\u7528\u6237\u7ec4\uff0c\u5982\u679cdocker\u7528\u6237\u7ec4\u5b58\u5728\uff0c\u5219\u4f1a\u63d0\u793a\u201cdocker\u7ec4\u5df2\u5b58\u5728\u201d\nsudo groupadd docker\n\n# \u5c06\u5f53\u524d\u7528\u6237\uff08\u81ea\u5b9a\u4e49\u7528\u6237\uff0c\u5982\uff1avagrant\uff09\u6dfb\u52a0\u81f3docker\u7528\u6237\u7ec4\u4e2d\uff08\u8bed\u6cd5\uff1agpasswd -a $USER docker\uff09\n# \u68c0\u6d4b\u5f53\u524d\u7528\u6237\uff08vagrant\uff09\u662f\u5426\u5df2\u7ecf\u5728docker\u7ec4\u4e2d\uff0c\u68c0\u6d4b\u4e0d\u5b58\u5728\uff0c\u5219\u53ef\u5c06\u5f53\u524d\u7528\u6237\uff08USER=vagrant\uff09\u6dfb\u52a0\u81f3docker\u7ec4\nsudo gpasswd -a vagrant docker # \u66f4\u65b0docker\u7528\u6237\u7ec4\nnewgrp docker\n</code></pre> <p>\u5378\u8f7dDocker</p> <pre><code># 1. \u67e5\u627e\u5df2\u5b89\u88c5\u4ecb\u8d28\nyum list installed | grep docker\n# 2. \u5220\u9664\u5b89\u88c5\u7684\u8f6f\u4ef6\u5305\nyum -y remove docker-ce.x86_64\nyum -y remove docker-ce-cli.x86_64\n# 3. \u5220\u9664\u955c\u50cf/\u5bb9\u5668\u7b49\nrm -rf /var/lib/docker\n</code></pre> <p>\u5b98\u65b9\u63d0\u4f9b\u7684shell\u811a\u672c</p> <pre><code>$ curl -fsSL https://get.docker.com/ | sh\n\n# \u6216\u8005\n$ wget -qO- https://get.docker.com/ | sh\n\n# \u5982\u679c\u60f3\u5c1d\u9c9c\u4f7f\u7528\u6700\u65b0\u529f\u80fd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u811a\u672c\u6765\u5b89\u88c5\u9884\u53d1\u5e03\u7248\u672c\u3002\u4f46\u8981\u6ce8\u610f\uff0c\u9884\u53d1\u5e03\u7248\u672c\u5f80\u5f80\u610f\u5473\u7740\u529f\u80fd\u8fd8\u4e0d\u591f\u7a33\u5b9a\uff0c\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\uff1a\n$ curl -fsSL https://test.docker.com/ | sh\n\n# $ curl -fsSL test.docker.com -o get-docker.sh\n$ curl -fsSL get.docker.com -o get-docker.sh\n$ sudo sh get-docker.sh --mirror Aliyun\n# $ sudo sh get-docker.sh --mirror AzureChinaCloud\n</code></pre> <p>\u963f\u91cc\u4e91\u5b89\u88c5\u811a\u672c</p> <pre><code>$ curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -\n</code></pre> <p>DaoCloud \u7684\u5b89\u88c5\u811a\u672c</p> <pre><code>$ curl -sSL https://get.daocloud.io/docker | sh\n</code></pre> <p>docker-compose v1</p> <pre><code>$ curl -L \"https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n$ chmod +x /usr/local/bin/docker-compose\n$ ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\n$ docker-compose version\nDocker Compose version v2.16.0\n</code></pre> <p>docker compose v2</p> <p>Docker \u5b98\u65b9\u7528 GO \u8bed\u8a00\u91cd\u5199\u4e86 Docker Compose\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u4e86 docker cli \u7684\u5b50\u547d\u4ee4\uff0c\u79f0\u4e3a Compose V2</p> <pre><code># 1\u3001\u4ece\u9879\u76ee\u53d1\u5e03\u9875\u9762\u4e0b\u8f7d\u9002\u5408\u4f60\u7684\u7cfb\u7edf\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u590d\u5236\u5230$HOME/.docker/cli-plugins\uff0c\u4f5c\u4e3adocker-compose\u6765\u5b89\u88c5Compose V2\n#\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4e0b\u8f7dDocker Compose\u7684\u5f53\u524d\u7a33\u5b9a\u7248\u672c\n# \u8be5\u547d\u4ee4\u4e3a$HOME\u76ee\u5f55\u4e0b\u7684\u7528\u6237\u5b89\u88c5Compose V2\u3002\n$ mkdir -p ~/.docker/cli-plugins/\n$ curl -SL https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o ~/.docker/cli-plugins/docker-compose\n$ chmod +x ~/.docker/cli-plugins/docker-compose\n\n#\u4e3a\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u7528\u6237\u5b89\u88c5Docker Compose\n$ mkdir -p /usr/local/lib/docker/cli-plugins\n$ curl -SL https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o /usr/local/lib/docker/cli-plugins/docker-compose\n$ chmod +x /usr/local/lib/docker/cli-plugins/docker-compose\n\n# \u8bbe\u7f6edocker-compose\u547d\u4ee4\u517c\u5bb9v1\n$ sudo ln -s  /usr/local/lib/docker/cli-plugins/docker-compose /usr/local/bin/docker-compose\n\n# 3\u3001\u6d4b\u8bd5\u5b89\u88c5\n$ docker compose version\nDocker Compose version v2.16.0\n\n$ docker-compose version\nDocker Compose version v2.16.0\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#2-\u955c\u50cf\u52a0\u901f\u5668","title":"2. \u955c\u50cf\u52a0\u901f\u5668","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.bookstack.cn/read/docker_practice-1.3.0/install-mirror.md</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#3-\u5f00\u542fdocker\u670d\u52a1\u5668\u7684\u7aef\u53e3","title":"3. \u5f00\u542fDocker\u670d\u52a1\u5668\u7684\u7aef\u53e3","text":"\u65b9\u5f0f1 <p>\u4e0a\u9762\u662f\u9ed8\u8ba4\u542f\u52a8 docker\uff0c\u6b64\u65f6 docker \u751f\u6210\u7684\u6587\u4ef6\u90fd\u5728 <code>/var/lib/docker</code>\u4e0b\u9762\u3002</p> <p>\u4e3a\u4e86\u4fbf\u4e8e\u7ba1\u7406\uff0c\u53ef\u4ee5\u505a\u4e0b\u9762\u51e0\u4e2a\u65b9\u9762\u7684\u4f18\u5316\uff1a - \u6307\u5b9a\u65b0\u7684\u6570\u636e\u76ee\u5f55\u3002  - \u6307\u5b9a\u65b0\u7684\u5b58\u50a8\u5f15\u64ce\u3002  - \u6ce8\u518c\u70b9\u8bbe\u7f6e\uff0c\u5e76\u6307\u5b9a\u56fd\u5185\u7684\u6ce8\u518c\u70b9\uff0c\u52a0\u901f\u955c\u50cf\u4e0b\u8f7d\u3002  - \u8bbe\u7f6e docker \u7f51\u7edc\uff0c\u9ed8\u8ba4 docker \u7f51\u7edc\u6307\u5b9a\u7684\u672c\u5730 docker0 \u7f51\u5361\u7684\u7f51\u6bb5\u4e3a 172.17 \u3002  - \u8bbe\u7f6e\u65e5\u5fd7\u548c\u5176\u5b83\u3002</p> <p>\u914d\u7f6e\u65b9\u6cd5\uff0c\u65b0\u589e\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>$ cat &gt; /etc/docker/daemon.json &lt;&lt; EOF\n{\n  \"graph\": \"/data/docker\",\n  \"storage-driver\": \"overlay2\",\n  \"insecure-registries\": [\"registry.access.redhat.com\", \"quay.io\"],\n  \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"],\n  \"bip\": \"172.16.200.1/24\",\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"hosts\": [\"tcp://0.0.0.0:2375\", \"unix:///var/run/docker.sock\"],\n  \"log-opts\": {\n    \"max-size\":\"100M\",\n    \"max-file\":\"3\"\n  }\n}\nEOF\n</code></pre> <p>\u4fee\u6539\u542f\u52a8\u53c2\u6570\uff1a</p> <p><code>vim /usr/lib/systemd/system/docker.service</code> \u5185\u5bb9\u5982\u4e0b\uff1a\u5220\u9664\u6389\u542f\u52a8\u53c2\u6570\u540e\u9762\u7684\u90e8\u5206</p> <p><code>ExecStart=/usr/bin/dockerd</code></p> <p>\u6b64\u65f6\u91cd\u542fdocker\uff1a <pre><code>$ systemctl daemon-reload\n$ systemctl restart docker\n</code></pre></p> <p>Docker\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e</p> <p>https://www.cnblogs.com/wt645631686/p/13356743.html</p> \u65b9\u5f0f2 <pre><code># 1.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u6267\u884c\u547d\u4ee4\uff1a \nvim /lib/systemd/system/docker.service\n# \u6ce8\u91ca\u6389\u8fd9\u884c\n#ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\nExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\n\n# 2.\u5c06\u7ba1\u7406\u5730\u5740\u5199\u5165 /etc/profile\n# \u6267\u884c\u547d\u4ee4\uff1a\necho 'export DOCKER_HOST=tcp://0.0.0.0:2375' &gt;&gt; /etc/profile\nsource /etc/profile\n\n# 3.\u91cd\u542f\u670d\u52a1\n# \u6267\u884c\u547d\u4ee4\uff1a \nsystemctl daemon-reload &amp;&amp; systemctl restart docker\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#4\u5f00\u542f\u5b9e\u9a8c\u7279\u6027","title":"4.\u5f00\u542f\u5b9e\u9a8c\u7279\u6027","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.bookstack.cn/read/docker_practice-1.3.0/install-experimental.md</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#5docker\u521d\u59cb\u4f18\u5316","title":"5.docker\u521d\u59cb\u4f18\u5316","text":"<p>\u4e0a\u9762\u662f\u9ed8\u8ba4\u542f\u52a8 docker\uff0c\u6b64\u65f6 docker \u751f\u6210\u7684\u6587\u4ef6\u90fd\u5728 <code>/var/lib/docker</code> \u4e0b\u9762\u3002</p> <p>\u4e3a\u4e86\u4fbf\u4e8e\u7ba1\u7406\uff0c\u53ef\u4ee5\u505a\u4e0b\u9762\u51e0\u4e2a\u65b9\u9762\u7684\u4f18\u5316\uff1a</p> <ul> <li>\u6307\u5b9a\u65b0\u7684\u6570\u636e\u76ee\u5f55\u3002</li> <li>\u6307\u5b9a\u65b0\u7684\u5b58\u50a8\u5f15\u64ce\u3002</li> <li>\u6ce8\u518c\u70b9\u8bbe\u7f6e\uff0c\u5e76\u6307\u5b9a\u56fd\u5185\u7684\u6ce8\u518c\u70b9\uff0c\u52a0\u901f\u955c\u50cf\u4e0b\u8f7d\u3002</li> <li>\u8bbe\u7f6e docker \u7f51\u7edc\uff0c\u9ed8\u8ba4 docker \u7f51\u7edc\u6307\u5b9a\u7684\u672c\u5730 <code>docker0</code> \u7f51\u5361\u7684\u7f51\u6bb5\u4e3a <code>172.17</code> \u3002</li> <li>\u8bbe\u7f6e\u65e5\u5fd7\u548c\u5176\u5b83\u3002</li> </ul>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#51-\u4fee\u6539\u9ed8\u8ba4\u6570\u636e\u5b58\u50a8\u76ee\u5f55","title":"5.1 \u4fee\u6539\u9ed8\u8ba4\u6570\u636e\u5b58\u50a8\u76ee\u5f55","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5b89\u88c5\u7684 docker \u6570\u636e\u5b58\u50a8\u76ee\u5f55\u5728 /var/lib/docker\u4e0b\uff0c\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\uff1a <pre><code>$ docker info |grep \"Docker Root Dir\"\nDocker Root Dir: /var/lib/docker\n</code></pre></p> <p>\u4fee\u6539\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e\uff0c\u6709\u4e24\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#1\u4fee\u6539\u542f\u52a8\u914d\u7f6e","title":"1.\u4fee\u6539\u542f\u52a8\u914d\u7f6e","text":"<pre><code>vim /usr/lib/systemd/system/docker.service\nExecStart=/usr/bin/dockerd --data-root=/data/opt/docker/data --config-file=/data/opt/docker/conf/daemon.json\n</code></pre> <p>\u7136\u540e\u91cd\u8f7d\u914d\u7f6e\u91cd\u542f\u670d\u52a1\uff0c\u518d\u6b21\u67e5\u770b</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#2\u4fee\u6539\u914d\u7f6e\u6587\u4ef6","title":"2.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>vim /etc/docker/daemon.json\n{\n\"registry-mirrors\": [\"http://hub-mirror.c.163.com\"],\n  \"data-root\": \"/data/docker/data\"\n}\n</code></pre> <p>\u914d\u7f6e\u65b9\u6cd5\uff0c\u65b0\u589e\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>cat &gt; /etc/docker/daemon.json &lt;&lt; EOF\n{\n  \"graph\": \"/data/docker\",\n  \"storage-driver\": \"overlay2\",\n  \"insecure-registries\": [\"registry.access.redhat.com\", \"quay.io\"],\n  \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"],\n  \"bip\": \"172.16.200.1/24\",\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"hosts\": [\"tcp://0.0.0.0:2375\", \"unix:///var/run/docker.sock\"],\n  \"log-opts\": {\n    \"max-size\":\"100M\",\n    \"max-file\":\"3\"\n  }\n}\nEOF\n</code></pre> <p>\u4fee\u6539\u542f\u52a8\u53c2\u6570\uff1a</p> <pre><code>vim /usr/lib/systemd/system/docker.service\n</code></pre> <p>\u5185\u5bb9\u5982\u4e0b\uff1a\u5220\u9664\u6389\u542f\u52a8\u53c2\u6570\u540e\u9762\u7684\u90e8\u5206</p> <pre><code>ExecStart=/usr/bin/dockerd\n</code></pre> <p>\u6b64\u65f6\u91cd\u542f docker\uff1a</p> <pre><code>systemctl daemon-reload\nsystemctl restart docker\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#6docker\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e","title":"6.Docker\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e","text":"<p>https://www.cnblogs.com/wt645631686/p/13356743.html</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Docker/#7pycharm\u8fde\u63a5docker\u5f00\u53d1","title":"7.pycharm\u8fde\u63a5docker\u5f00\u53d1","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.cnblogs.com/Mr-shen/p/12833142.html</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","title":"10.Docker\u5e38\u7528\u547d\u4ee4","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u5e38\u7528\u547d\u4ee4","title":"\u5e38\u7528\u547d\u4ee4","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u57fa\u672c","title":"\u57fa\u672c","text":"<pre><code># \u67e5\u770b\u5f53\u524ddocker\u7248\u672c\ndocker -v\ndocker verison\n\n# \u67e5\u770bdocker\u7cfb\u7edf\u4fe1\u606f\ndocker info\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u5f00\u53d1\u5e38\u7528","title":"\u5f00\u53d1\u5e38\u7528","text":"<pre><code># \u5217\u51fa\u5bb9\u5668 -- \u4ec5\u8fd0\u884c\u7684\u5bb9\u5668\ndocker ps # \u5217\u51fa\u5bb9\u5668 -- \u5305\u542b\u505c\u6b62\u7684\u5bb9\u5668\ndocker ps -a\n\n# \u67e5\u770b\u5f53\u524d\u672c\u5730\u6240\u6709\u955c\u50cf\ndocker images\n\n# \u641c\u7d22\u955c\u50cf\ndocker search \u955c\u50cf\n# \u83b7\u53d6\u955c\u50cf\ndocker pull \u955c\u50cf\u4ed3\u5e93\u5730\u5740\n# \u4e0a\u4f20\u955c\u50cf\ndocker push \u955c\u50cf\u4ed3\u5e93\u5730\u5740\n\n# \u8fd0\u884c\u5bb9\u5668\n# \u2013name \u5b9a\u4e49\u4e00\u4e2a\u5bb9\u5668\u7684\u540d\u5b57\uff0c\u5982\u679c\u5728\u6267\u884cdocker run\u65f6\u6ca1\u6709\u6307\u5b9aName\uff0c\u90a3\u4e48deamon\u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\u5b57\u7b26\u4e32\u5f53\u505aUUID\u3002\n# -d \u6807\u8bc6\u662f\u8ba9 docker \u5bb9\u5668\u5728\u540e\u53f0\u8fd0\u884c\u3002\n# -p \u6807\u8bc6\u901a\u77e5 Docker \u5c06\u5bb9\u5668\u5185\u90e8\u4f7f\u7528\u7684\u7f51\u7edc\u7aef\u53e3\u6620\u5c04\u5230\u6211\u4eec\u4f7f\u7528\u7684\u4e3b\u673a\u4e0a\u3002\n# -m \u9650\u5236\u5bb9\u5668\u5185\u5b58100m\ndocker run --name nginx -d -p 8080:80 -m 100m nginx\n\n# \u505c\u6b62\u5bb9\u5668 \ndocker stop \u5bb9\u5668ID/\u5bb9\u5668\u540d\n# \u542f\u52a8\u5bb9\u5668\ndocker start \u5bb9\u5668ID/\u5bb9\u5668\u540d\n# \u91cd\u542f\u5bb9\u5668\ndocker restart \u5bb9\u5668ID/\u5bb9\u5668\u540d\n\n# \u6740\u6389\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\ndocker kill -s KILL \u5bb9\u5668ID/\u5bb9\u5668\u540d\n\n# \u5220\u9664\u5bb9\u5668\ndocker rm \u5bb9\u5668ID/\u5bb9\u5668\u540d\n# \u5220\u9664\u4e00\u4e2a\u6216\u591a\u5c11\u5bb9\u5668\u3002-f :\u901a\u8fc7SIGKILL\u4fe1\u53f7\u5f3a\u5236\u5220\u9664\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668-l :\u79fb\u9664\u5bb9\u5668\u95f4\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u800c\u975e\u5bb9\u5668\u672c\u8eab-v :-v \u5220\u9664\u4e0e\u5bb9\u5668\u5173\u8054\u7684\u5377\ndocker rm -f xx\u3001xx2\n\n# \u5220\u9664\u955c\u50cf \u3010 \u987a\u5e8f\uff1a\u505c\u6b62\u955c\u50cf\u91cc\u7684\u5bb9\u5668\uff0c\u518d\u5220\u9664\u5bb9\u5668\uff0c\u6700\u540e\u518d\u5220\u9664\u955c\u50cf \u3011\ndocker rmi \u955c\u50cfid/\u955c\u50cf\u540d\n\n# \u8fdb\u5165\u5bb9\u5668\ndocker exec -it \u5bb9\u5668ID/\u5bb9\u5668\u540d /bin/bash\n# \u4ee5\u4ea4\u4e92\u6a21\u5f0f\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668,\u5728\u5bb9\u5668\u5185\u6267\u884c/bin/bash\u547d\u4ee4\ndocker run -i -t \u5bb9\u5668ID/\u5bb9\u5668\u540d /bin/bash\n\n# \u67e5\u770b\u5bb9\u5668\u65e5\u5fd7 -t:\u663e\u793a\u65f6\u95f4\u6233\ndocker logs -f -t \u5bb9\u5668ID/\u5bb9\u5668\u540d\ndocker logs -fn10 -t \u5bb9\u5668ID/\u5bb9\u5668\u540d\n\n# \u6784\u9020\u955c\u50cf\n# \u7528\u6cd5 docker build -t \u955c\u50cf\u540d\u79f0 .\ndocker build -t docker_demo .\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u5bb9\u5668\u4fe1\u606f","title":"\u5bb9\u5668\u4fe1\u606f","text":"<pre><code># \u67e5\u770b \u5bb9\u5668/\u955c\u50cf \u5143\u6570\u636e\ndocker inspect \u5bb9\u5668ID/\u5bb9\u5668\u540d\n# \u67e5\u8be2\u5bb9\u5668\u5185\u90e8ip\u5730\u5740\ndocker inspect \u5bb9\u5668ID/\u5bb9\u5668\u540d | grep IPAddress\n# \u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\u8def\u5f84\ndocker inspect --format='{{.LogPath}}' \u5bb9\u5668ID/\u5bb9\u5668\u540d\n# \u67e5\u770b\u5bb9\u5668\u5728 `/var/lib/docker/overlay2/` \u4e0b\u7684\u6570\u636e\u76ee\u5f55\ndocker inspect -f '{{ .GraphDriver.Data.MergedDir }}' \u5bb9\u5668ID/\u5bb9\u5668\u540d\n# \u67e5\u770b\u5bb9\u5668\u6620\u5c04\u7684\u6570\u636e\u5b58\u653e\u76ee\u5f55 -- \u4e3b\u8981\u662f\u770bMounts\u8282\u70b9\u4fe1\u606f\ndocker inspect -f '{{ .Mounts }}' \u5bb9\u5668ID/\u5bb9\u5668\u540d\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u8fd0\u7ef4\u5e38\u7528","title":"\u8fd0\u7ef4\u5e38\u7528","text":"<pre><code># \u5217\u51fa\u6240\u6709\u7684\u5bb9\u5668 ID\ndocker ps -aq\n# \u505c\u6b62\u6240\u6709\u7684\u5bb9\u5668\ndocker stop $(docker ps -aq)\n# \u5220\u9664\u6240\u6709\u7684\u5bb9\u5668\ndocker rm $(docker ps -aq)\n# \u5220\u9664\u6240\u6709\u7684\u955c\u50cf\ndocker rmi $(docker images -q)\n# \u505c\u6b62\u5e76\u5220\u9664\u6307\u5b9a\u5bb9\u5668\ndocker ps -a | grep \u5bb9\u5668ID/\u5bb9\u5668\u540d | awk '{print $1}' | xargs -i docker stop {} | xargs -i docker rm {}\n# \u5220\u9664\u955c\u50cf\n# docker images \u83b7\u53d6\u6240\u6709images\n# grep -E \"xxxxx\" \u7b5b\u9009\u5230\u7279\u5b9a\u7684images\n# awk \u2018 {print $3}\u2019 \u6253\u5370\u7b2c\u4e09\u5217 \u5373image id\u5217\n# uniq \u68c0\u67e5\u53ca\u5220\u9664\u6587\u672c\u6587\u4ef6\u4e2d\u91cd\u590d\u51fa\u73b0\u7684\u884c\u5217\n# xargs -I {} \u591a\u884c\u8f6c\u5355\u884c\n# docker rmi --force {} \u5220\u9664\u6240\u6709\u6307\u5b9a\u955c\u50cfid\ndocker images | grep -E \"\u955c\u50cfid/\u955c\u50cf\u540d\" | awk '{print $3}' | uniq | xargs -I {} docker rmi --force {}\n# ex: \u5220\u9664\u955c\u50cf `nginx:latest`\ndocker images | grep -E nginx | grep latest| awk '{print $3}' | uniq | xargs -I {} docker rmi --force {}\n# \u5220\u9664\u6240\u6709\u505c\u6b62\u7684\u5bb9\u5668\ndocker container prune\n\n# \u5220\u9664\u6240\u6709\u4e0d\u4f7f\u7528\u7684\u955c\u50cf\ndocker image prune --force --all\n# \u6216\ndocker image prune -f -a\n\n# \u67e5\u770b\u5bb9\u5668\u8fd0\u884c\u5185\u5b58\u4fe1\u606f  \u3010\u53c2\u6570`mem_limit: 300m` # \u6700\u5927\u4f7f\u7528\u5185\u5b58\u3011\ndocker stats nginx\n# CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT   MEM %     NET I/O     BLOCK I/O     PIDS\n# 385a15a9724d   nginx     0.00%     1.961MiB / 100MiB   1.96%     656B / 0B   0B / 8.19kB   3\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u5176\u5b83","title":"\u5176\u5b83","text":"<pre><code># \u67e5\u770b\u955c\u50cf\u7684\u521b\u5efa\u5386\u53f2\ndocker history \u955c\u50cf\u4ed3\u5e93\u5730\u5740\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u955c\u50cf\u5bfc\u5165\u5bfc\u51fa","title":"\u955c\u50cf\u5bfc\u5165\u5bfc\u51fa","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u5bfc\u51fa\u955c\u50cf","title":"\u5bfc\u51fa\u955c\u50cf","text":"<pre><code>docker save -o my-nginx.tar my-nginx:v1\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u5bfc\u5165\u955c\u50cf","title":"\u5bfc\u5165\u955c\u50cf","text":"<pre><code># \u5148\u5220\u9664\u5df2\u5b58\u5728\u7684\u65e7\u5bb9\u5668\ndocker rm -f nginx\n# \u5220\u9664\u65e7\u955c\u50cf\ndocker rmi my-nginx:v1\ndocker rmi nginx\n\n# \u5bfc\u5165\u4f7f\u7528 `docker save` \u547d\u4ee4\u5bfc\u51fa\u7684\u955c\u50cf\ndocker load -i my-nginx.tar\n# \u67e5\u770b\u955c\u50cf\ndocker images\n# \u8fd0\u884c\ndocker run --name nginx -d -p 8080:80 my-nginx:v1\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u955c\u50cf\u63a8\u9001","title":"\u955c\u50cf\u63a8\u9001","text":"<pre><code># \u767b\u5f55\u8ba4\u8bc1\u4ed3\u5e93\ndocker login -u \u7528\u6237\u540d -p \u5bc6\u7801 \u4ed3\u5e93\u5730\u5740\n\n# \u83b7\u53d6\u955c\u50cf\ndocker pull \u955c\u50cf\u4ed3\u5e93\u5730\u5740\n\n# \u5c06\u672c\u5730\u955c\u50cf\u540d \u6539\u4e3a \u4e00\u4e2a\u65b0\u955c\u50cf\u4ed3\u5e93\u5730\u5740\ndocker tag \u955c\u50cf\u540d \u65b0\u955c\u50cf\u4ed3\u5e93\u5730\u5740\n\n# \u63a8\u9001\u955c\u50cf\ndocker push \u65b0\u955c\u50cf\u4ed3\u5e93\u5730\u5740\n</code></pre> <p>\u4e3e\u4f8b</p> <pre><code># \u8ba4\u8bc1harbor\u79c1\u670d\ndocker login -u admin -p Harbor12345 harbor.zhengqingya.com:11000\n\ndocker pull nginx\n\ndocker tag nginx harbor.zhengqingya.com:11000/zhengqing/nginx:latest\n\ndocker push harbor.zhengqingya.com:11000/zhengqing/nginx:latest\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#docker\u914d\u7f6e\u8fdc\u7a0b\u8fde\u63a5\u7aef\u53e3","title":"Docker\u914d\u7f6e\u8fdc\u7a0b\u8fde\u63a5\u7aef\u53e3","text":"<pre><code>2375\uff1a\u672a\u52a0\u5bc6\u7684docker socket,\u8fdc\u7a0broot\u65e0\u5bc6\u7801\u8bbf\u95ee\u4e3b\u673a\n2376\uff1atls\u52a0\u5bc6\u5957\u63a5\u5b57,\u5f88\u53ef\u80fd\u8fd9\u662f\u60a8\u7684CI\u670d\u52a1\u56684243\u7aef\u53e3\u4f5c\u4e3ahttps 443\u7aef\u53e3\u7684\u4fee\u6539\n2377\uff1a\u7fa4\u96c6\u6a21\u5f0f\u5957\u63a5\u5b57,\u9002\u7528\u4e8e\u7fa4\u96c6\u7ba1\u7406\u5668,\u4e0d\u9002\u7528\u4e8edocker\u5ba2\u6237\u7aef\n5000\uff1adocker\u6ce8\u518c\u670d\u52a1\n4789\u548c7946\uff1a\u8986\u76d6\u7f51\u7edc\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#1\u4fee\u6539\u5bbf\u4e3b\u673a\u914d\u7f6e\u6587\u4ef6","title":"1.\u4fee\u6539\u5bbf\u4e3b\u673a\u914d\u7f6e\u6587\u4ef6","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u65b9\u6cd5\u4e00","title":"\u65b9\u6cd5\u4e00","text":"<pre><code>vim /lib/systemd/system/docker.service\n</code></pre> <p>\u5728 <code>ExecStart</code> \u5f00\u5934\u7684\u8fd9\u4e00\u884c\u672b\u5c3e\u6dfb\u52a0 <code>-H tcp://0.0.0.0:2375</code></p> <pre><code>ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u65b9\u6cd5\u4e8c","title":"\u65b9\u6cd5\u4e8c","text":"<pre><code>vim /etc/docker/daemon.json\n\n{\n\"hosts\": [\"tcp://0.0.0.0:2375\", \"unix:///var/run/docker.sock\"]\n}\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u65b9\u6cd5\u4e09","title":"\u65b9\u6cd5\u4e09","text":"<pre><code>vim /etc/default/docker\n\n# \u52a0\u5165\u4e0b\u9762\u4e00\u884c\nDOCKER_OPTS=\"-H tcp://0.0.0.0:2375\"\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#2\u91cd\u542fdocker","title":"2.\u91cd\u542fdocker","text":"<pre><code>systemctl daemon-reload &amp;&amp; systemctl restart docker\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#3\u9632\u706b\u5899\u5f00\u653e2375\u7aef\u53e3","title":"3.\u9632\u706b\u5899\u5f00\u653e2375\u7aef\u53e3","text":"<pre><code>firewall-cmd --zone=public --add-port=2375/tcp --permanent\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#4\u901a\u8fc7\u5916\u7f51\u8bbf\u95ee\u6d4b\u8bd5\u6210\u529f","title":"4.\u901a\u8fc7\u5916\u7f51\u8bbf\u95ee\u6d4b\u8bd5\u6210\u529f","text":"<pre><code># \u67e5\u770bdocker\u7248\u672c\ndocker -H tcp://192.168.240.2:2375 version\n# \u67e5\u770b\u955c\u50cf\u5305\ndocker -H tcp://192.168.240.2:2375 images\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#\u5bb9\u5668\u548c\u5bbf\u4e3b\u673a\u6587\u4ef6\u4e92\u4f20","title":"\u5bb9\u5668\u548c\u5bbf\u4e3b\u673a\u6587\u4ef6\u4e92\u4f20","text":"<pre><code># \u4ece\u5bb9\u5668\u91cc\u9762\u62f7\u6587\u4ef6\u5230\u5bbf\u4e3b\u673a  \u524d\uff1a\u5bb9\u5668\u6587\u4ef6\u8def\u5f84  \u540e\uff1a\u5bbf\u4e3b\u673a\u8def\u5f84\ndocker cp \u5bb9\u5668ID/\u5bb9\u5668\u540d:\u5bb9\u5668\u6587\u4ef6\u8def\u5f84 \u5bbf\u4e3b\u673a\u6587\u4ef6\u8def\u5f84\n\n# \u4ece\u5bbf\u4e3b\u673a\u62f7\u6587\u4ef6\u5230\u5bb9\u5668\u91cc\u9762  \u524d\uff1a\u5bbf\u4e3b\u673a\u6587\u4ef6\u8def\u5f84 \u540e\uff1a\u5bb9\u5668\u8def\u5f84\ndocker cp \u5bbf\u4e3b\u673a\u6587\u4ef6\u8def\u5f84 \u5bb9\u5668ID/\u5bb9\u5668\u540d:\u5bb9\u5668\u6587\u4ef6\u8def\u5f84\n</code></pre> <p>ex:</p> <pre><code># \u4ece\u5bb9\u5668`mysql`\u91cc\u9762\u62f7\u6587\u4ef6\u5230\u5bbf\u4e3b\u673a  \u524d\uff1a\u5bb9\u5668\u6587\u4ef6\u8def\u5f84  \u540e\uff1a\u5bbf\u4e3b\u673a\u8def\u5f84\ndocker cp mysql:/tmp/all.sql /tmp/all.sql\n\n# \u4ece\u5bbf\u4e3b\u673a\u62f7\u6587\u4ef6\u5230\u5bb9\u5668`mysql`\u91cc\u9762  \u524d\uff1a\u5bbf\u4e3b\u673a\u6587\u4ef6\u8def\u5f84 \u540e\uff1a\u5bb9\u5668\u8def\u5f84\ndocker cp /tmp/all.sql mysql:/tmp/all.sql\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#docker\u6e05\u7406\u547d\u4ee4","title":"docker\u6e05\u7406\u547d\u4ee4","text":"<pre><code># ~/.bash_aliases\n# \u6740\u6b7b\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668.\ndocker kill $(docker ps -a -q)\n# \u5220\u9664\u6240\u6709\u5df2\u7ecf\u505c\u6b62\u7684\u5bb9\u5668.\ndocker rm $(docker ps -a -q)\n# \u5220\u9664\u6240\u6709\u672a\u6253 dangling \u6807\u7b7e\u7684\u955c\u50cf\ndocker rmi $(docker images -q -f dangling=true)\n# \u901a\u8fc7\u955c\u50cf\u7684id\u6765\u5220\u9664\u6307\u5b9a\u955c\u50cf\ndocker rmi &lt;image id&gt;\n\n# \u5220\u9664\u6240\u6709\u672a\u6253 tag \u7684\u955c\u50cf\ndocker rmi $(docker images -q | awk '/^&lt;none&gt;/ { print $3 }')\n# \u5220\u9664\u6240\u6709\u955c\u50cf\ndocker rmi $(docker images -q)\n###### \u4e3a\u8fd9\u4e9b\u547d\u4ee4\u521b\u5efa\u522b\u540d\nvim  ~/.bash_aliases # \u6740\u6b7b\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668. \nalias dockerkill='docker kill $(docker ps -a -q)' # \u5220\u9664\u6240\u6709\u5df2\u7ecf\u505c\u6b62\u7684\u5bb9\u5668. \nalias dockercleanc='docker rm $(docker ps -a -q)' # \u5220\u9664\u6240\u6709\u672a\u6253\u6807\u7b7e\u7684\u955c\u50cf. \nalias dockercleani='docker rmi $(docker images -q -f dangling=true)' # \u5220\u9664\u6240\u6709\u5df2\u7ecf\u505c\u6b62\u7684\u5bb9\u5668\u548c\u672a\u6253\u6807\u7b7e\u7684\u955c\u50cf. \nalias dockerclean='dockercleanc || true &amp;&amp; dockercleani'\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/10.Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#docker\u5bb9\u5668\u4e2d\u5b89\u88c5curltelnetvim\u57fa\u7840\u5de5\u5177","title":"Docker\u5bb9\u5668\u4e2d\u5b89\u88c5curl\u3001telnet\u3001vim\u57fa\u7840\u5de5\u5177","text":"<p>\u56e0\u5728\u5bb9\u5668\u4e2d\u6392\u67e5\u6545\u969c\u9700\u8981\uff0c\u5b89\u88c5\u57fa\u7840\u5de5\u5177</p> <p>\u67e5\u770b\u7cfb\u7edf\u7248\u672c\uff1a cat /etc/os-releas</p> <p>Debian\u57fa\u7840\u955c\u50cf \u5148\u6dfb\u52a0163\u6e90</p> <pre><code>tee /etc/apt/sources.list &lt;&lt; EOF\ndeb http://mirrors.163.com/debian/ jessie main non-ffree contrib\ndeb http://mirrirs.163.com/debian/ jessie-updates main non-free contrib\nEOF\n#\u5b89\u88c5 curl telnet\napt-get update &amp;&amp; apt-get install -y curl telnet vim\n</code></pre> <p>Alpine\u57fa\u7840\u955c\u50cf \u5148\u6dfb\u52a0\u963f\u91cc\u6e90</p> <pre><code>cat &gt; /etc/apk/repositories &lt;&lt; EOF\nhttp://mirrors.aliyun.com/alpine/v3.12/main/\nhttp://mirrors.aliyun.com/alpine/v3.12/community\nEOF\n#\u5b89\u88c5 curl scp telnet vim\napk update &amp;&amp; apk add curl openssh-client busybox-extras vim\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/","title":"2.Docker\u955c\u50cf","text":"<p>\u955c\u50cf \u662fDocker\u4e09\u5927\u6838\u5fc3\u6982\u5ff5\u4e2d\u6700\u91cd\u8981\u7684\uff0c\u81eaDocker\u8bde\u751f\u4e4b\u65e5\u8d77\u955c\u50cf\u5c31\u662f\u76f8\u5173\u793e\u533a\u6700\u4e3a\u70ed\u95e8\u7684\u5173\u952e\u8bcd\u3002</p> <p>Docker\u8fd0\u884c\u5bb9\u5668\u524d\u9700\u8981\u672c\u5730\u5b58\u5728\u5bf9\u5e94\u7684\u955c\u50cf\uff0c\u5982\u679c\u955c\u50cf\u4e0d\u5b58\u5728\uff0cDocker\u4f1a\u5c1d\u8bd5\u5148\u4ece\u9ed8\u8ba4\u955c\u50cf\u4ed3\u5e93\u4e0b\u8f7d\uff08\u9ed8\u8ba4\u4f7f\u7528Docker Hub\u516c\u5171\u6ce8\u518c\u670d\u52a1\u5668\u4e2d\u7684\u4ed3\u5e93\uff09\uff0c\u7528\u6237\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\uff0c\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u955c\u50cf\u4ed3\u5e93\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#1-\u955c\u50cf\u5199\u65f6\u590d\u5236\u673a\u5236","title":"1. \u955c\u50cf\u5199\u65f6\u590d\u5236\u673a\u5236","text":"<p>\u901a\u8fc7 docker run \u547d\u4ee4\u6307\u5b9a\u955c\u50cf\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u8be5\u955c\u50cf\u4e4b\u4e0a\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u53ef\u8bfb\u5199\u6587\u4ef6\u7cfb\u7edf\u5c42\u7ea7\u3002</p> <p>\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u6587\u4ef6\u7cfb\u7edf\u5f53\u6210\u4e00\u4e2a\u65b0\u7684\u4e34\u65f6\u955c\u50cf\uff0c\u800c\u547d\u4ee4\u91cc\u6240\u6307\u5b9a\u7684\u955c\u50cf\u79f0\u4e3a\u7236\u955c\u50cf\u3002\u7236\u955c\u50cf\u7684\u5185\u5bb9\u90fd\u662f\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6302\u8f7d\u8fdb\u6765\u7684\uff0c\u5bb9\u5668\u4f1a\u8bfb\u53d6\u5171\u4eab\u7236\u955c\u50cf\u7684\u5185\u5bb9\u3002</p> <p>\u4e0d\u8fc7\u4e00\u65e6\u9700\u8981\u4fee\u6539\u7236\u955c\u50cf\u6587\u4ef6\uff0c\u4fbf\u4f1a\u89e6\u53d1Docker\u4ece\u7236\u955c\u50cf\u4e2d\u590d\u5236\u8fd9\u4e2a\u6587\u4ef6\u5230\u4e34\u65f6\u955c\u50cf\u4e2d\u6765\uff0c\u6240\u6709\u7684\u4fee\u6539\u5747\u53d1\u751f\u4f60\u7684\u6587 \u4ef6\u7cfb\u7edf\u4e2d\uff0c\u800c\u4e0d\u4f1a\u5bf9\u7236\u955c\u50cf\u9020\u6210\u4efb\u4f55\u5f71\u54cd\uff0c\u8fd9\u5c31\u662fDocker\u955c\u50cf\u7684\u5199\u65f6\u590d\u5236\u673a\u5236\u3002</p> <p>docker\u955c\u50cf\u7684\u5206\u5c42</p> <pre><code># \u542f\u52a8\u4e00\u4e2anginx\u5bb9\u5668\n$ docker run -d -p 80:80 --name webserver nginx\n\n# \u4eceDocker Hub\u7684Ubuntu\u4ed3\u5e93\u4e0b\u8f7d\u4e00\u4e2a\u6700\u65b0\u7684Ubuntu\u64cd\u4f5c\u7cfb\u7edf\u7684\u955c\u50cf\u3002\n$ docker pull ubuntu\n\n#*  \u955c\u50cf\u7684latest\u6807\u7b7e\u610f\u5473\u7740\u8be5\u955c\u50cf\u7684\u5185\u5bb9\u4f1a\u8ddf\u8e2a\u6700\u65b0\u7684\u975e\u7a33\u5b9a\u7248\u672c\u800c\u53d1\u5e03\uff0c\u5185\u5bb9\u662f\u4e0d\u7a33\u5b9a\u7684\u3002\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5ffd\u7565\u955c\u50cf\u7684\u6807\u7b7e\u4fe1\u606f\u6216\u4f7f\u7528\u9ed8\u8ba4\u7684latest\u6807\u8bb0\u7684\u955c\u50cf\u3002\n\u4f8b\u5982\uff0cdocker pull ubuntu\uff1a14.04\u547d\u4ee4\u76f8\u5f53\u4e8edocker pull registry.hub.docker.com/ubuntu\uff1a14.04\u547d\u4ee4\uff0c\u5373\u4ece\u9ed8\u8ba4\u7684\u6ce8\u518c\u670d\u52a1\u5668Docker Hub Registry\u4e2d\u7684ubuntu\u4ed3\u5e93\u6765\u4e0b\u8f7d\u6807\u8bb0\u4e3a14.04\u7684\u955c\u50cf\u3002 \u5982\u679c\u4ece\u975e\u5b98\u65b9\u7684\u4ed3\u5e93\u4e0b\u8f7d\uff0c\u5219\u9700\u8981\u5728\u4ed3\u5e93\u540d\u79f0\u524d\u6307\u5b9a\u5b8c\u6574\u7684\u4ed3\u5e93\u5730\u5740\u3002\n\n#\u4f8b\u5982\u4ece\u7f51\u6613\u8702\u5de2\u7684\u955c\u50cf\u6e90\u6765\u4e0b\u8f7dubuntu\uff1a14.04\u955c\u50cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u6b64\u65f6\u4e0b\u8f7d\u7684\u955c\u50cf\u540d\u79f0\u4e3ahub.c.163.com/public/ubuntu\uff1a14.04\uff1a\n# \u4e0b\u8f7d\u963f\u91cc\u4e91\u7684\u955c\u50cf\n$ docker pull registry.cn-beijing.aliyuncs.com/mysqld/mysql\n\n# \u4f7f\u7528tag\u547d\u4ee4\u6dfb\u52a0\u955c\u50cf\u6807\u7b7e\n$ docker tag ubuntu:latest myubuntu:latest\n\n#\u4f7f\u7528inspect\u547d\u4ee4\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f\n$ docker inspect ubuntu\n\n#\u8fd4\u56de\u7684\u662f\u4e00\u4e2aJSON\u683c\u5f0f\u7684\u6d88\u606f\uff0c\u5982\u679c\u6211\u4eec\u53ea\u8981\u5176\u4e2d\u4e00\u9879\u5185\u5bb9\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u53c2\u6570-f\u6765\u6307\u5b9a\n$ docker inspect -f {{\".Architecture\"}} ubuntu\n\n#\u4f7f\u7528history\u547d\u4ee4\u67e5\u770b\u955c\u50cf\u5386\u53f2\n$ docker history ubuntu\n\n# \u641c\u5bfb\u955c\u50cf,\u5728Docker Hub\u4e0a\u641c\u7d22\u7b26\u5408\u8981\u6c42\u7684\u955c\u50cf\n$ docker search nginx\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#2-\u672c\u5730\u955c\u50cf\u7ba1\u7406","title":"2. \u672c\u5730\u955c\u50cf\u7ba1\u7406","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#21-\u83b7\u53d6\u955c\u50cf","title":"2.1 \u83b7\u53d6\u955c\u50cf","text":"<p>\u955c\u50cf\u662f\u8fd0\u884c\u5bb9\u5668\u7684\u524d\u63d0\uff0c\u5b98\u65b9\u7684Docker Hub\u7f51\u7ad9\u5df2\u7ecf\u63d0\u4f9b\u4e86\u6570\u5341\u4e07\u4e2a\u955c\u50cf\u4f9b\u5927\u5bb6\u5f00\u653e\u4e0b\u8f7d\u3002\u672c\u8282\u4e3b\u8981\u4ecb\u7ecdDocker\u955c\u50cf\u7684pull\u5b50\u547d\u4ee4\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528docker[image]pull\u547d\u4ee4\u76f4\u63a5\u4eceDocker Hub\u955c\u50cf\u6e90\u6765\u4e0b\u8f7d\u955c\u50cf\u3002\u8be5\u547d\u4ee4\u7684\u683c\u5f0f\u4e3adocker[image]pull NAME[\uff1aTAG]\u3002</p> <p>\u5176\u4e2d\uff0cNAME\u662f\u955c\u50cf\u4ed3\u5e93\u540d\u79f0\uff08\u7528\u6765\u533a\u5206\u955c\u50cf\uff09\uff0cTAG\u662f\u955c\u50cf\u7684\u6807\u7b7e\uff08\u5f80\u5f80\u7528\u6765\u8868\u793a\u7248\u672c\u4fe1\u606f\uff09\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u63cf\u8ff0\u4e00\u4e2a\u955c\u50cf\u9700\u8981\u5305\u62ec\u201c\u540d\u79f0+\u6807\u7b7e\u201d\u4fe1\u606f\u3002</p> <p>\u4f8b\u5982\uff0c\u83b7\u53d6\u4e00\u4e2aUbuntu 18.04\u7cfb\u7edf\u7684\u57fa\u7840\u955c\u50cf\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u7684\u547d\u4ee4\uff1a</p> <pre><code>$ docker pull ubuntu:18.04\n</code></pre> <p>\u5bf9\u4e8eDocker\u955c\u50cf\u6765\u8bf4\uff0c\u5982\u679c\u4e0d\u663e\u5f0f\u6307\u5b9aTAG\uff0c\u5219\u9ed8\u8ba4\u4f1a\u9009\u62e9latest\u6807\u7b7e\uff0c\u8fd9\u4f1a\u4e0b\u8f7d\u4ed3\u5e93\u4e2d\u6700\u65b0\u7248\u672c\u7684\u955c\u50cf\u3002</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u5c06\u4eceDocker Hub\u7684Ubuntu\u4ed3\u5e93\u4e0b\u8f7d\u4e00\u4e2a\u6700\u65b0\u7248\u672c\u7684Ubuntu\u64cd\u4f5c\u7cfb\u7edf\u7684\u955c\u50cf\uff1a</p> <pre><code>$ docker pull ubuntu\n</code></pre> <p>\u8be5\u547d\u4ee4\u5b9e\u9645\u4e0a\u4e0b\u8f7d\u7684\u5c31\u662fubuntu\uff1alatest\u955c\u50cf\u3002</p> <p>\u4e0b\u8f7d\u955c\u50cf\u5230\u672c\u5730\u540e\uff0c\u5373\u53ef\u968f\u65f6\u4f7f\u7528\u8be5\u955c\u50cf\u4e86\uff0c\u4f8b\u5982\u5229\u7528\u8be5\u955c\u50cf\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u5728\u5176\u4e2d\u8fd0\u884cbash\u5e94\u7528\uff0c\u6267\u884c\u6253\u5370\u201cHello World\u201d\u547d\u4ee4\uff1a</p> <pre><code>$ docker run -it ubuntu:18.04 bash\nroot@65663247040f:/# echo \"Hello World\"\nHello World\nroot@65663247040f:/# exit\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#22-\u67e5\u770b\u955c\u50cf","title":"2.2 \u67e5\u770b\u955c\u50cf","text":"<p>1.\u4f7f\u7528images\u547d\u4ee4\u5217\u51fa\u955c\u50cf</p> <pre><code>docker image ls # \u6216\u8005\ndocker images\ndocker images ubun*\n\n# \u7b5b\u9009\u6307\u5b9a\u6807\u7b7e\u7684\u955c\u50cf\ndocker images ubuntu\n# \u8bed\u6cd5\u652f\u6301\u901a\u914d\u7b26\u7b5b\u9009\ndocker image ls ubunt*\ndocker image ls ubunt*:14*\n\n# \u7b5b\u9009\u60ac\u7a7a\u955c\u50cf\ndocker images --filter \"dangling=true\"\n# \u8be5\u547d\u4ee4\u53ef\u7528\u4e8e\u67e5\u8be2\u955c\u50cf\uff08Images\uff09\u3001\u5bb9\u5668\uff08Containers\uff09\u548c\u672c\u5730\u5377\uff08LocalVolumes\uff09\u7b49\u7a7a\u95f4\u4f7f\u7528\u5927\u6237\u7684\u7a7a\u95f4\u5360\u7528\u60c5\u51b5\n$ docker system df\nTYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE\nImages              13                  0                   1.763GB             1.763GB (100%)\nContainers          0                   0                   0B                  0B\nLocal Volumes       0                   0                   0B                  0B\nBuild Cache         0                   0                   0B                  0B\n\n# \u5177\u4f53\u662f\u54ea\u4e2a\u955c\u50cf\u3001\u54ea\u4e2a\u6570\u636e\u5377\u5360\u7528\u4e86\u7a7a\u95f4\uff0c\u8fd9\u65f6\u53ef\u4ee5\u901a\u8fc7-v\u53c2\u6570\u6765\u5b9e\u73b0\uff1a\n$ docker system df -v\n</code></pre> <p>2.\u4f7f\u7528tag\u547d\u4ee4\u6dfb\u52a0\u955c\u50cf\u6807\u7b7e</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u5728\u540e\u7eed\u5de5\u4f5c\u4e2d\u4f7f\u7528\u7279\u5b9a\u955c\u50cf\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528docker tag\u547d\u4ee4\u6765\u4e3a\u672c\u5730\u955c\u50cf\u4efb\u610f\u6dfb\u52a0\u65b0\u7684\u6807\u7b7e\u3002\u4f8b\u5982\uff0c\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684myubuntu\uff1alatest\u955c\u50cf\u6807\u7b7e\uff1a</p> <pre><code> $ docker tag ubuntu:latest myubuntu:latest\n</code></pre> <p>\u518d\u6b21\u4f7f\u7528docker images\u5217\u51fa\u672c\u5730\u4e3b\u673a\u4e0a\u955c\u50cf\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u591a\u4e86\u4e00\u4e2amyubuntu\uff1alatest\u6807\u7b7e\u7684\u955c\u50cf\uff1a</p> <pre><code>$ docker images\nREPOSITORY           TAG           IMAGE ID           CREATED             SIZE\nubuntu               18.04         452a96d81c30       2 weeks ago         79.6MB\nubuntu               latest        452a96d81c30       2 weeks ago         79.6MB\nmyubuntu             latest        452a96d81c30       2 weeks ago         79.6MB\n</code></pre> <p>3.\u4f7f\u7528inspect\u547d\u4ee4\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f</p> <pre><code>$ docker image inspect ubuntu:18.04\n[\n{\n\"Id\": \"sha256:452a96d81c30a1e426bc250428263ac9ca3f47c9bf086f876d11cb39cf57aeec\",\n        \"RepoTags\": [\n\"ubuntu:18.04\",\n            \"ubuntu:latest\"\n],\n        \"RepoDigests\": [\n\"ubuntu@sha256:c8c275751219dadad8fa56b3ac41ca6cb22219ff117ca98fe82b42f24e1ba64e\"\n],\n        \"Parent\": \"\",\n        \"Comment\": \"\",\n        \"Created\": \"2018-04-27T23:28:36.319694807Z\",\n        ...\n]\n</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u8fd4\u56de\u7684\u662f\u4e00\u4e2aJSON\u683c\u5f0f\u7684\u6d88\u606f\uff0c\u5982\u679c\u6211\u4eec\u53ea\u8981\u5176\u4e2d\u4e00\u9879\u5185\u5bb9\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528-f\u6765\u6307\u5b9a\uff0c\u4f8b\u5982\uff0c\u83b7\u53d6\u955c\u50cf\u7684Architecture\uff1a</p> <pre><code>$ docker image inspect -f {{\".Architecture\"}} ubuntu:14.04\namd64\n</code></pre> <p>4.\u4f7f\u7528history\u547d\u4ee4\u67e5\u770b\u955c\u50cf\u5386\u53f2</p> <p>\u65e2\u7136\u955c\u50cf\u6587\u4ef6\u7531\u591a\u4e2a\u5c42\u7ec4\u6210\uff0c\u90a3\u4e48\u600e\u4e48\u77e5\u9053\u5404\u4e2a\u5c42\u7684\u5185\u5bb9\u5177\u4f53\u662f\u4ec0\u4e48\u5462\uff1f\u8fd9\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528history\u5b50\u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u5c06\u5217\u51fa\u5404\u5c42\u7684\u521b\u5efa\u4fe1\u606f\u3002</p> <p>\u4f8b\u5982\uff0c\u67e5\u770bubuntu\uff1a18.04\u955c\u50cf\u7684\u521b\u5efa\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>$ docker history ubuntu:18.04\nIMAGE        CREATED       CREATED BY              SIZE                   COMMENT\n452a96d81c30 5 weeks ago   /bin/sh -c #(nop)  CMD [\"/bin/bash\"]           0B\n&lt;missing&gt;    5 weeks ago   /bin/sh -c mkdir -p /run/systemd &amp;&amp; echo 'do\u2026 7B\n</code></pre> <p><code>\u6ce8\u610f\uff0c\u8fc7\u957f\u7684\u547d\u4ee4\u88ab\u81ea\u52a8\u622a\u65ad\u4e86\uff0c\u53ef\u4ee5\u4f7f\u7528\u524d\u9762\u63d0\u5230\u7684--no-trunc\u9009\u9879\u6765\u8f93\u51fa\u5b8c\u6574\u547d\u4ee4\u3002</code></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#23-\u641c\u5bfb\u955c\u50cf","title":"2.3 \u641c\u5bfb\u955c\u50cf","text":"<p>\u4f7f\u7528docker search\u547d\u4ee4\u53ef\u4ee5\u641c\u7d22Docker Hub\u5b98\u65b9\u4ed3\u5e93\u4e2d\u7684\u955c\u50cf\u3002\u8bed\u6cd5\u4e3adocker search[option]keyword\u3002\u652f\u6301\u7684\u547d\u4ee4\u9009\u9879\u4e3b\u8981\u5305\u62ec\uff1a</p> <pre><code>\u00b7-f\uff0c--filter filter\uff1a\u8fc7\u6ee4\u8f93\u51fa\u5185\u5bb9\uff1b\n\n\u00b7--format string\uff1a\u683c\u5f0f\u5316\u8f93\u51fa\u5185\u5bb9\uff1b\n\n\u00b7--limit int\uff1a\u9650\u5236\u8f93\u51fa\u7ed3\u679c\u4e2a\u6570\uff0c\u9ed8\u8ba4\u4e3a25\u4e2a\uff1b\n\n\u00b7--no-trunc\uff1a\u4e0d\u622a\u65ad\u8f93\u51fa\u7ed3\u679c\u3002\n</code></pre> <p>\u4f8b\u5982\uff0c\u641c\u7d22\u5b98\u65b9\u63d0\u4f9b\u7684\u5e26nginx\u5173\u952e\u5b57\u7684\u955c\u50cf\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ docker search --filter=is-official=true nginx\nNAME DESCRIPTION STARS OFFICIAL AUTOMATED\nnginx Official build of Nginx. 7978 [OK]\nkong Open-source Microservice &amp; API Management la\u2026 159 [OK]\n</code></pre> <p>\u518d\u6bd4\u5982\uff0c\u641c\u7d22\u6240\u6709\u6536\u85cf\u6570\u8d85\u8fc74\u7684\u5173\u952e\u8bcd\u5305\u62ectensorflow\u7684\u955c\u50cf\uff1a</p> <pre><code>$ docker search --filter=stars=4 tensorflow\nNAME DESCRIPTION STARS OFFICIAL AUTOMATED\ntensorflow/tensorflow Official docker images for deep learning fra\u2026   760\nxblaster/tensorflow-jupyter Dockerized Jupyter with tensorflow 47 [OK]\njupyter/tensorflow-notebook Jupyter Notebook Scientific Python Stack w/ \u2026   46\nromilly/rpi-docker-tensorflow Tensorflow and Jupyter running in docker con\u2026   16\nfloydhub/tensorflow tensorflow 8 [OK]\nerroneousboat/tensorflow-python3-jupyter Docker container with python 3 version of te\u2026   8 [OK]\ntensorflow/tf_grpc_server Server for TensorFlow GRPC Distributed Runti\u2026   5\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u4e86\u5f88\u591a\u5305\u542b\u5173\u952e\u5b57\u7684\u955c\u50cf\uff0c\u5176\u4e2d\u5305\u62ec\u955c\u50cf\u540d\u5b57\u3001\u63cf\u8ff0\u3001\u6536\u85cf\u6570\uff08\u8868\u793a\u8be5\u955c\u50cf\u7684\u53d7\u6b22\u8fce\u7a0b\u5ea6\uff09\u3001\u662f\u5426\u5b98\u65b9\u521b\u5efa\u3001\u662f\u5426\u81ea\u52a8\u521b\u5efa\u7b49\u3002\u9ed8\u8ba4\u7684\u8f93\u51fa\u7ed3\u679c\u5c06\u6309\u7167\u661f\u7ea7\u8bc4\u4ef7\u8fdb\u884c\u6392\u5e8f\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#24-\u4e0b\u8f7d\u955c\u50cf","title":"2.4 \u4e0b\u8f7d\u955c\u50cf","text":"<pre><code># \u9996\u5148\u672c\u5730\u641c\u7d22ubuntu\u955c\u50cf\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u53bbDocker Hub\u4e0a\u62c9\u53d6ubuntu\u955c\u50cf\n$ docker run ubuntu echo \"hello docker\"\n# \u641c\u7d22\u7b26\u5408\u8981\u6c42\u7684\u955c\u50cf\n$ docker serach wordpress # \u53ef\u4ee5\u9884\u5148\u62c9\u53d6\u955c\u50cf\uff0c\u653e\u7f6e\u5230\u672c\u5730\n$ docker pull ubuntu\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#25-\u5220\u9664\u955c\u50cf","title":"2.5 \u5220\u9664\u955c\u50cf","text":"<pre><code>#1.\u4f7f\u7528\u6807\u7b7e\u5220\u9664\u955c\u50cf\n$ docker rmi myubuntu:latest\n# \u6216\u8005\n$ docker image rm 172.16.32.12:9090/jenkinsci/citest:50\n\n#2.\u4f7f\u7528\u955c\u50cfID\u5220\u9664\u955c\u50cf\n$ docker rmi 91e7d180c6a3\n\n#\u60f3\u5f3a\u884c\u5220\u9664\u955c\u50cf\uff0c\u53ef\u4ee5\u4f7f\u7528-f\u53c2\u6570\n$ docker rmi -f 47b19964fb50\n\n#\u901a\u5e38\u5e76\u4e0d\u63a8\u8350\u4f7f\u7528-f\u53c2\u6570\u6765\u5f3a\u5236\u5220\u9664\u4e00\u4e2a\u5b58\u5728\u5bb9\u5668\u4f9d\u8d56\u7684\u955c\u50cf\u3002\u6b63\u786e\u7684\u505a\u6cd5\u662f\uff0c\u5148\u5220\u9664\u4f9d\u8d56\u8be5\u955c\u50cf\u7684\u6240\u6709\u5bb9\u5668\uff0c\u518d\u6765\u5220\u9664\u955c\u50cf\n$ docker rm e90b01fe1248\ne90b01fe1248\n\n# \u5220\u9664\u672c\u5730\u505c\u6b62\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u4e00\u6b21\u6027\u5220\u9664\u65e0\u7528\u7684\u5bb9\u5668\u5bf9\u955c\u50cf\u7684\u4f9d\u8d56\n$ docker rm $(docker ps -a -q)\n# \u5220\u9664\u6240\u6709\u955c\u50cf\n$ docker rmi -f $(docker images|grep -v REPOSITORY|awk '{print $1\":\"$2}')\n# \u6e05\u7406\u60ac\u7a7a\u955c\u50cf\n$ docker rmi $(docker images -f \"dangling=true\" -q)\n# \u6279\u91cf\u6e05\u7406\u6309label\u7b5b\u9009\u7684\u955c\u50cf\n$ docker rmi $(docker images --filter \"label=MAINTAINER=hujianli@qq.com\" -q)\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684\u955c\u50cf\n$ docker system prune\n\n# \u7b5b\u9009\u7740\u8fdb\u884c\u5220\u9664\n$ docker stop $(docker ps -a | grep \"Exited\" | awk '{print $1 }')  //\u505c\u6b62\u5bb9\u5668\n$ docker rm $(docker ps -a | grep \"Exited\" | awk '{print $1 }')  //\u5220\u9664\u5bb9\u5668\n$ docker rmi $(docker images | grep \"none\" | awk '{print $3}')  //\u5220\u9664\u955c\u50cf\n\n# \u6e05\u7406\u65e0\u5bb9\u5668\u4f7f\u7528\u7684\u955c\u50cf\n$ docker image prune -a\n</code></pre> <p>\u4f7f\u7528Docker\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u7cfb\u7edf\u4e2d\u53ef\u80fd\u4f1a\u9057\u7559\u4e00\u4e9b\u4e34\u65f6\u7684\u955c\u50cf\u6587\u4ef6\uff0c\u4ee5\u53ca\u4e00\u4e9b\u6ca1\u6709\u88ab\u4f7f\u7528\u7684\u955c\u50cf\uff0c\u53ef\u4ee5\u901a\u8fc7docker image prune\u547d\u4ee4\u6765\u8fdb\u884c\u6e05\u7406\u3002</p> <pre><code>\u652f\u6301\u9009\u9879\u5305\u62ec\uff1a\n\u00b7-a\uff0c-all\uff1a\u5220\u9664\u6240\u6709\u65e0\u7528\u955c\u50cf\uff0c\u4e0d\u5149\u662f\u4e34\u65f6\u955c\u50cf\uff1b\n\u00b7-filter filter\uff1a\u53ea\u6e05\u7406\u7b26\u5408\u7ed9\u5b9a\u8fc7\u6ee4\u5668\u7684\u955c\u50cf\uff1b\n\u00b7-f\uff0c-force\uff1a\u5f3a\u5236\u5220\u9664\u955c\u50cf\uff0c\u800c\u4e0d\u8fdb\u884c\u63d0\u793a\u786e\u8ba4\u3002\n</code></pre> <p>\u4f8b\u5982\uff0c\u5982\u4e0b\u547d\u4ee4\u4f1a\u81ea\u52a8\u6e05\u7406\u4e34\u65f6\u7684\u9057\u7559\u955c\u50cf\u6587\u4ef6\u5c42\uff0c\u6700\u540e\u4f1a\u63d0\u793a\u91ca\u653e\u7684\u5b58\u50a8\u7a7a\u95f4\uff1a</p> <pre><code>$ docker image prune -f\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#\u6e05\u7406\u5220\u9664\u672a\u88ab\u4f7f\u7528\u7684\u955c\u50cf","title":"\u6e05\u7406\u5220\u9664\u672a\u88ab\u4f7f\u7528\u7684\u955c\u50cf","text":"<p>\u63cf\u8ff0 cicd \u6301\u4e45\u5316\u90e8\u7f72\u8282\u70b9\u8d8a\u6765\u8d8a\u591a\u7684\u955c\u50cf\uff0c\u78c1\u76d8\u7a7a\u95f4\u8d8a\u6765\u8d8a\u4e0d\u591f\uff0c\u8fd9\u65f6\u9700\u8981\u505a\u4e00\u4e2a\u5b9a\u65f6\u6e05\u7406\u6ca1\u6709\u4f7f\u7528\u7684\u955c\u50cf\u3002</p> <pre><code>\u9009\u9879\n\u53c2\u6570  \u63cf\u8ff0\n--all , -a  Remove all unused images, not just dangling ones -----\u5220\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684\u6620\u50cf\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u60ac\u7a7a\u6620\u50cf\n--filter    Provide filter values (e.g. \u2018until=') -----\u63d0\u4f9b\u8fc7\u6ee4\u503c\uff08\u4f8b\u5982'until =\u201c\uff09\n--force , -f    Do not prompt for confirmation -----\u4e0d\u8981\u63d0\u793a\u786e\u8ba4\nuntil           \u4ec5\u5220\u9664\u5728\u7ed9\u5b9a\u65f6\u95f4\u6233\u4e4b\u524d\u521b\u5efa\u7684\u6620\u50cf\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#\u5b9a\u65f6\u4efb\u52a1\u6e05\u7406","title":"\u5b9a\u65f6\u4efb\u52a1\u6e05\u7406","text":"<p>\u6e05\u740610\u5929\u524d\u521b\u5efa\u4e14\u5f53\u524d\u65e0\u5bb9\u5668\u5b9e\u4f8b\u4f7f\u7528\u7684\u955c\u50cf <pre><code>$ cat &gt;&gt; /var/spool/cron/crontabs/root &lt;&lt; EOF\n# \u6bcf\u5468\u4e00\u6e05\u7406\u65e0\u6548\u955c\u50cf\n* * * * 1 /usr/bin/docker image prune -a --force --filter \"until=240h\" 2&gt;&amp;1\nEOF\n</code></pre></p> <p>\u53c2\u8003\u6587\u732e\uff1a</p> <p>https://www.akiraka.net/linux/docker/502.html</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#26-\u521b\u5efa\u672c\u5730\u955c\u50cf","title":"2.6 \u521b\u5efa\u672c\u5730\u955c\u50cf","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#1\u57fa\u4e8e\u5df2\u6709\u5bb9\u5668commit\u521b\u5efa","title":"1.\u57fa\u4e8e\u5df2\u6709\u5bb9\u5668commit\u521b\u5efa","text":"<pre><code>[root@hujianli-docker01 centos]# docker run -it ubuntu\nroot@d78a1c4c8541:/# apt-get update\n\n#\u5b89\u88c5sqlite3\nroot@d78a1c4c8541:/# apt-get install sqlite3\nroot@d78a1c4c8541:/# echo \"test docker commit\" &gt;&gt; hellodocker\nroot@d78a1c4c8541:/# cat hellodocker test docker commit\nroot@d78a1c4c8541:/# exit\nexit\n#\u8bb0\u4f4f\u4e0a\u9762\u9000\u51fa\u65f6\u5019\u7684\u5bb9\u5668id\uff1ad78a1c4c8541\n# \u4f7f\u7528 commit \u547d\u4ee4\u5c06\u5bb9\u5668\u91cc\u7684\u6240\u6709\u4fee\u6539\u63d0\u4ea4\u5230\u672c\u5730\u5e93\u4e2d\uff0c\u5f62\u6210\u4e00\u4e2a\u5168\u65b0\u7684\u955c\u50cf\n[root@hujianli-docker01 centos]# docker commit -m=\"Message\" --author=\"hujianli\" d78a1c4c8541 hjl_ubuntu/sqlite3:v1\nsha256:3b450d854758de25b3b90fe30692d55bce75a318136ea7ec48dddbe38fc059a1\n\n[root@hujianli-docker01 centos]# docker images\nREPOSITORY               TAG                 IMAGE ID            CREATED             SIZE\nhjl_ubuntu/sqlite3       v1                  3b450d854758        54 seconds ago      95.6MB\nubuntu                   latest              4c108a37151f        2 weeks ago         64.2MB\nportworx/px-enterprise   2.0.3.7             a63b970ac332        2 weeks ago         2.51GB\nquay.io/coreos/etcd      latest              61ad63875109        12 months ago       39.5MB\n\n# \u6211\u4eec\u4f7f\u7528\u521a\u624d\u521b\u5efa\u7684\u955c\u50cf\u6765\u6784\u5efa\u4e00\u4e2a\u5bb9\u5668\u5e76\u8fd0\u884c\uff0c\u4ee5\u68c0\u89c6\u6240\u505a\u7684\u4fee\u6539\n[root@hujianli-docker01 centos]# docker run -it hjl_ubuntu/sqlite3:v1\nroot@aa51b9edac11:/# cat hellodocker test docker commit\n\nroot@aa51b9edac11:/# sqlite3 -version\n3.22.0 2018-01-22 18:45:57 0c55d179733b46d8d0ba4d88e01a25e10677046ee3da1d5b1581e86726f2alt1\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#2\u57fa\u4e8e\u672c\u5730\u6a21\u677f\u5bfc\u5165","title":"2.\u57fa\u4e8e\u672c\u5730\u6a21\u677f\u5bfc\u5165","text":"<p>\u7528\u6237\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4ece\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u6a21\u677f\u6587\u4ef6\u5bfc\u5165\u4e00\u4e2a\u955c\u50cf\uff0c\u4e3b\u8981\u4f7f\u7528docker[container]import\u547d\u4ee4\u3002</p> <p>\u547d\u4ee4\u683c\u5f0f\u4e3adocker[image]import[OPTIONS]file|URL|-[REPOSITORY[\uff1aTAG]]</p> <p>\u8981\u76f4\u63a5\u5bfc\u5165\u4e00\u4e2a\u955c\u50cf\uff0c\u53ef\u4ee5\u4f7f\u7528OpenVZ\u63d0\u4f9b\u7684\u6a21\u677f\u6765\u521b\u5efa\uff0c\u6216\u8005\u7528\u5176\u4ed6\u5df2\u5bfc\u51fa\u7684\u955c\u50cf\u6a21\u677f\u6765\u521b\u5efa\u3002</p> <p>OPENVZ\u6a21\u677f\u7684\u4e0b\u8f7d\u5730\u5740\u4e3ahttp://download.openvz.org/template/precreated/</p> <p>\u4f8b\u5982\uff0c\u4e0b\u8f7d\u4e86centos-7-x86_64\u7684\u6a21\u677f\u538b\u7f29\u5305\uff0c\u4e4b\u540e\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5bfc\u5165\u5373\u53ef\uff1a</p> <pre><code>$ wget -c https://download.openvz.org/template/precreated/centos-7-x86_64.tar.gz\n$ cat centos-7-x86_64.tar.gz | docker import - centos:7\n</code></pre> <p>\u7136\u540e\u67e5\u770b\u65b0\u5bfc\u5165\u7684\u955c\u50cf\uff0c\u5df2\u7ecf\u5728\u672c\u5730\u5b58\u5728\u4e86\uff1a</p> <pre><code>$ docker images\nREPOSITORY                                                 TAG        IMAGE ID       CREATED         SIZE\ncentos                                                     7          7c5119718b64   8 seconds ago   589MB\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#3\u57fa\u4e8edockerfile\u521b\u5efa","title":"3.\u57fa\u4e8eDockerfile\u521b\u5efa","text":"<p>\u57fa\u4e8eDockerfile\u521b\u5efa\u662f\u6700\u5e38\u89c1\u7684\u65b9\u5f0f\u3002Dockerfile\u662f\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5229\u7528\u7ed9\u5b9a\u7684\u6307\u4ee4\u63cf\u8ff0\u57fa\u4e8e\u67d0\u4e2a\u7236\u955c\u50cf\u521b\u5efa\u65b0\u955c\u50cf\u7684\u8fc7\u7a0b\u3002</p> <p>\u4e0b\u9762\u7ed9\u51faDockerfile\u7684\u4e00\u4e2a\u7b80\u5355\u793a\u4f8b\uff0c\u57fa\u4e8edebian\uff1astretch-slim\u955c\u50cf\u5b89\u88c5Python 3\u73af\u5883\uff0c\u6784\u6210\u4e00\u4e2a\u65b0\u7684python\uff1a3\u955c\u50cf\uff1a</p> <p><code>Dockerfile</code></p> <pre><code>FROM debian:stretch-slim\nLABEL version=\"1.0\" maintainer=\"docker user &lt;docker_user@github&gt;\"\nRUN apt-get update &amp;&amp; \\\napt-get install -y python3 &amp;&amp; \\\napt-get clean &amp;&amp; \\\nrm -rf /var/lib/apt/lists/*\n</code></pre> <p>\u521b\u5efa\u955c\u50cf\u7684\u8fc7\u7a0b\u53ef\u4ee5\u4f7f\u7528docker[image]build\u547d\u4ee4\uff0c\u7f16\u8bd1\u6210\u529f\u540e\u672c\u5730\u5c06\u591a\u51fa\u4e00\u4e2apython\uff1a3\u955c\u50cf\uff1a</p> <pre><code>$ docker [image] build -t python:3 .\n...\nSuccessfully built 4b10f46eacc8\nSuccessfully tagged python:3\n$ docker images|grep python\npython 3 4b10f46eacc8 About a minute ago   95.1MB\n</code></pre> <p>\u63a8\u8350\u4f7f\u7528Dockerfile\u6765\u6784\u5efa\u955c\u50cf\u3002\u5c06\u9700\u8981\u5bf9\u955c\u50cf\u8fdb\u884c\u7684\u64cd\u4f5c\u5168\u90e8 \u5199\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u4f7f\u7528 docker build \u547d\u4ee4\u4ece\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u521b\u5efa\u955c\u50cf\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u955c\u50cf\u7684\u521b \u5efa\u53d8\u5f97\u900f\u660e\u548c\u72ec\u7acb\u5316\uff0c\u5e76\u4e14\u521b\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u88ab\u91cd\u590d\u6267\u884c\u3002</p> <pre><code># Version: 1.0.1\nFROM ubuntu:latest\nMAINTAINER xxh \"xxh@qq.com\"\n#\u8bbe\u7f6eroot\u7528\u6237\u4e3a\u540e\u7eed\u547d\u4ee4\u7684\u6267\u884c\u8005\nUSER root\n#\u6267\u884c\u64cd\u4f5c\nRUN apt-get update\nRUN apt-get install -y nginx\n\n#\u4f7f\u7528&amp;&amp;\u62fc\u63a5\u547d\u4ee4\nRUN touch test.txt &amp;&amp; echo \"abc\" &gt;&gt; abc.txt\n\n#\u5bf9\u5916\u66b4\u9732\u7aef\u53e3\nEXPOSE 80 8080 1038\n#\u6dfb\u52a0\u6587\u4ef6\nADD abc.txt /opt/\n\n#\u6dfb\u52a0\u6587\u4ef6\u5939\nADD /webapp /opt/webapp\n\n#\u6dfb\u52a0\u7f51\u7edc\u6587\u4ef6\nADD https://www.baidu.com/img/bd_logo1.png /opt/\n\n#\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\nENV WEBAPP_PORT=9090\n#\u8bbe\u7f6e\u5de5\u4f5c\u76ee\u5f55\nWORKDIR /opt/\n#\u8bbe\u7f6e\u542f\u52a8\u547d\u4ee4\nENTRYPOINT [\"ls\"]\n#\u8bbe\u7f6e\u542f\u52a8\u53c2\u6570\nCMD [\"-a\", \"-l\" ]\n#\u8bbe\u7f6e\u5377\nVOLUME [\"/data\", \"/var/www\"]\n#\u8bbe\u7f6e\u5b50\u955c\u50cf\u7684\u89e6\u53d1\u64cd\u4f5c\nONBUILD ADD . /app/src\nONBUILD RUN echo \"on build excuted\" &gt;&gt; onbuild.txt\n</code></pre> <p><code>docker build -t xixihe/test:v1 .</code></p> <p>\u5176\u4e2d -t \u53c2\u6570\u7528\u6765\u6307\u5b9a\u955c\u50cf\u7684\u547d\u540d\u7a7a\u95f4\u3001\u4ed3\u5e93\u540d\u53ca TAG \u3002\u8fd9\u4e2a\u503c\u53ef\u4ee5\u5728\u955c\u50cf\u521b\u5efa\u6210\u529f\u4e4b\u540e\u901a\u8fc7 tag \u547d \u4ee4\u4fee\u6539\uff0c\u4e8b\u5b9e\u4e0a\u662f\u521b\u5efa\u4e00\u4e2a\u955c\u50cf\u7684\u4e24\u4e2a\u540d\u79f0\u5f15\u7528\uff0c\u5982\u4e0b\u6240\u793a\u7684 xixihe/test:v1 \u548c xixihe/test:v2\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u955c\u50cf\u5b9e\u4f53 8758374dc545 \uff1a</p> <pre><code>docker tag xixihe/test:v1 xixihe/test:v2\n\n# docker images\nREPOSITORY TAG IMAGE ID CREATED VIRTUAL SIZE\nxixihe/test v2 8758374dc545 5 minutes ago 192.7 MB\nxixihe/test v1 8758374dc545 5 minutes ago 192.7 MB\nubuntu latest 9bd07e480c5b 6 days ago 192.7 MB\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#3-\u5b58\u51fa\u548c\u8f7d\u5165\u955c\u50cf","title":"3. \u5b58\u51fa\u548c\u8f7d\u5165\u955c\u50cf","text":"<p>\u5b58\u51fa\u955c\u50cf</p> <pre><code>$ docker save -o ubuntu_14.04.tar ubuntu:14.04\n#\u7528\u6237\u5c31\u53ef\u4ee5\u901a\u8fc7\u590d\u5236ubuntu_14.04.tar\u6587\u4ef6\u5c06\u8be5\u955c\u50cf\u5206\u4eab\u7ed9\u4ed6\u4eba\u4f7f\u7528\u4e86\n</code></pre> <p>\u8f7d\u5165\u955c\u50cf</p> <pre><code>$ docker load --input ubuntu_14.04.tar #\u6216\u8005\n$ docker load &lt; ubuntu_14.04.tar </code></pre> <p>\u8fd9\u5c06\u5bfc\u5165\u955c\u50cf\u53ca\u5176\u76f8\u5173\u7684\u5143\u6570\u636e\u4fe1\u606f\uff08\u5305\u62ec\u6807\u7b7e\u7b49\uff09\u3002\u5bfc\u5165\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528docker images\u547d\u4ee4\u8fdb\u884c\u67e5\u770b\uff0c\u4e0e\u539f\u955c\u50cf\u4e00\u81f4\u3002</p> <p>Docker \u955c\u50cf\u7684\u5bfc\u5165\u548c\u5bfc\u51fa <code>docker save</code> \u548c <code>docker load</code> Docker \u8fd8\u63d0\u4f9b\u4e86 <code>docker save</code> \u548c <code>docker load</code>\u547d\u4ee4\uff0c\u7528\u4ee5\u5c06\u955c\u50cf\u4fdd\u5b58\u4e3a\u4e00\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u4f20\u8f93\u5230\u53e6\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\uff0c\u518d\u52a0\u8f7d\u8fdb\u6765\u3002</p> <p>\u8fd9\u662f\u5728\u6ca1\u6709 Docker Registry \u65f6\u7684\u505a\u6cd5\uff0c\u73b0\u5728\u5df2\u7ecf\u4e0d\u63a8\u8350\uff0c\u955c\u50cf\u8fc1\u79fb\u5e94\u8be5\u76f4\u63a5\u4f7f\u7528 Docker Registry\uff0c\u65e0\u8bba\u662f\u76f4\u63a5\u4f7f\u7528 Docker Hub \u8fd8\u662f\u4f7f\u7528\u5185\u7f51\u79c1\u6709 Registry \u90fd\u53ef\u4ee5\u3002</p> <p>\u4fdd\u5b58\u955c\u50cf \u4f7f\u7528 docker save \u547d\u4ee4\u53ef\u4ee5\u5c06\u955c\u50cf\u4fdd\u5b58\u4e3a\u5f52\u6863\u6587\u4ef6\u3002</p> <p>\u6bd4\u5982\u6211\u4eec\u5e0c\u671b\u4fdd\u5b58\u8fd9\u4e2a alpine \u955c\u50cf\u3002 <pre><code>$ docker image ls alpine\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nalpine              latest              baa5d63471ea        5 weeks ago         4.803 MB\n</code></pre></p> <p>\u4fdd\u5b58\u955c\u50cf\u7684\u547d\u4ee4\u4e3a\uff1a <pre><code>$ docker save alpine -o filename\n$ file filename\nfilename: POSIX tar archive\n</code></pre></p> <p>\u8fd9\u91cc\u7684 filename \u53ef\u4ee5\u4e3a\u4efb\u610f\u540d\u79f0\u751a\u81f3\u4efb\u610f\u540e\u7f00\u540d\uff0c\u4f46\u6587\u4ef6\u7684\u672c\u8d28\u90fd\u662f\u5f52\u6863\u6587\u4ef6</p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u540c\u540d\u5219\u4f1a\u8986\u76d6\uff08\u6ca1\u6709\u8b66\u544a\uff09</p> <p>\u82e5\u4f7f\u7528 gzip \u538b\u7f29\uff1a <pre><code>$ docker save alpine | gzip &gt; alpine-latest.tar.gz\n</code></pre> \u7136\u540e\u6211\u4eec\u5c06 alpine-latest.tar.gz \u6587\u4ef6\u590d\u5236\u5230\u4e86\u5230\u4e86\u53e6\u4e00\u4e2a\u673a\u5668\u4e0a\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u52a0\u8f7d\u955c\u50cf\uff1a <pre><code>$ docker load -i alpine-latest.tar.gz\nLoaded image: alpine:latest\n</code></pre></p> <p>\u5982\u679c\u6211\u4eec\u7ed3\u5408\u8fd9\u4e24\u4e2a\u547d\u4ee4\u4ee5\u53ca ssh \u751a\u81f3 pv \u7684\u8bdd\uff0c\u5229\u7528 Linux \u5f3a\u5927\u7684\u7ba1\u9053\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2a\u547d\u4ee4\u5b8c\u6210\u4ece\u4e00\u4e2a\u673a\u5668\u5c06\u955c\u50cf\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u673a\u5668\uff0c\u5e76\u4e14\u5e26\u8fdb\u5ea6\u6761\u7684\u529f\u80fd\uff1a <pre><code>docker save &lt;\u955c\u50cf\u540d&gt; | bzip2 | pv | ssh &lt;\u7528\u6237\u540d&gt;@&lt;\u4e3b\u673a\u540d&gt; 'cat | docker load'\n</code></pre></p> <p>\u4fdd\u5b58\u955c\u50cf\u53ca\u52a0\u8f7d\u955c\u50cf</p> <pre><code>[root@linux-node1 ~]# docker image save centos &gt; centos.tar        #\u4fdd\u5b58centos\u955c\u50cf\u5230\u5f52\u6863tar\n[root@linux-node1 ~]# du -sh centos.tar \n201M    centos.tar\n[root@linux-node1 ~]# docker image rm centos:latest             #\u5220\u9664centos\u955c\u50cf\nUntagged: centos:latest\nUntagged: centos@sha256:38777a4106f0072649128ea4236241345a3ed21c55abbbd53bad5342549f6126\nDeleted: sha256:1e1148e4cc2c148c6890a18e3b2d2dde41a6745ceb4e5fe94a923d811bf82ddb\nDeleted: sha256:071d8bd765171080d01682844524be57ac9883e53079b6ac66707e192ea25956\n[root@linux-node1 ~]# docker image load &lt; centos.tar             #\u52a0\u8f7d\u5df2\u5f52\u6863\u7684\u955c\u50cf\n071d8bd76517: Loading layer [==================================================&gt;]  210.2MB/210.2MB\nLoaded image: centos:latest\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#4\u4e0a\u4f20\u955c\u50cf","title":"4.\u4e0a\u4f20\u955c\u50cf","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#41-\u63a8\u9001\u5230docker-hub","title":"4.1 \u63a8\u9001\u5230Docker Hub","text":"<pre><code>1. \u767b\u5f55Docker Hub\n2. \u63a8\u9001\u955c\u50cf\uff08\u5982\u679c\u547d\u540d\u7a7a\u95f4\u4e0d\u4e00\u81f4\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u201cdocker tag\u201d\u547d\u4ee4\u4fee\u6539\u540d\u79f0\u548c\u6807\u7b7e\uff09\u3002\n3. docker push 1879324764/myubuntu:latest\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#42-\u63a8\u9001\u5230\u817e\u8baf\u4e91\u955c\u50cf\u4ed3\u5e93","title":"4.2 \u63a8\u9001\u5230\u817e\u8baf\u4e91\u955c\u50cf\u4ed3\u5e93","text":"<pre><code>$ docker login --username {\u7528\u6237\u540d} ccr.ccs.tencentyun.com\n$ docker tag dingtalk.net ccr.css.tencentyun.com/xinlai/dingtalk.net\n$ docker images ccr.ccs.tencentyun.com/xinlai/ding*\n$ docker push ccr.css.tencentyun.com/xinlai/dingtalk.net\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#43\u63a8\u9001\u5230\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93","title":"4.3\u63a8\u9001\u5230\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93","text":"<pre><code>1. \u767b\u5f55\u963f\u91cc\u4e91Docker Registry\n$ sudo docker login --username=hujianli_722 registry.cn-hangzhou.aliyuncs.com   // \u5bc6\u7801\u63d0\u793a\uff1aadminXXXX\n\n2. \u4eceRegistry\u4e2d\u62c9\u53d6\u955c\u50cf\n$ sudo docker pull registry.cn-hangzhou.aliyuncs.com/devops_hu/devops_hu:[\u955c\u50cf\u7248\u672c\u53f7]\n3. \u5c06\u955c\u50cf\u63a8\u9001\u5230Registry\n$ sudo docker login --username=hujianli_722 registry.cn-hangzhou.aliyuncs.com\n$ sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/devops_hu/devops_hu:[\u955c\u50cf\u7248\u672c\u53f7]\n$ sudo docker push registry.cn-hangzhou.aliyuncs.com/devops_hu/devops_hu:[\u955c\u50cf\u7248\u672c\u53f7]\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#5-docker-hub","title":"5. Docker Hub","text":"<p>Docker Hub\u7684\u7f51\u5740\u662fhttps://hub.docker.com\uff0c\u5b83\u4e0e\u63d0\u4f9b\u6e90\u4ee3\u7801\u6258\u7ba1\u670d\u52a1\u7684GitHub\u7c7b\u4f3c\uff0c</p> <p>\u4e0d\u540c\u7684\u662fDocker Hub\u63d0\u4f9b\u7684\u662f\u955c\u50cf\u6258\u7ba1\u670d\u52a1\u3002\u5229\u7528Docker Hub\uff0c\u6211\u4eec\u53ef\u4ee5\u641c\u7d22\u3001\u521b\u5efa\u3001\u5206\u4eab\u548c\u7ba1\u7406\u955c\u50cf\uff0c \u8fd8\u53ef\u4ee5\u5229\u7528\u5176\u63d0\u4f9b\u7684\u81ea\u52a8\u5316\u6784\u5efa\u6280\u672f\u76f4\u63a5\u5728\u96c6\u7fa4\u4e91\u670d\u52a1\u5668\u4e0a\u6784\u5efa\u955c\u50cf</p> <p>Docker Hub\u4e0a\u7684\u955c\u50cf\u5206\u4e3a\u4e24\u7c7b\u3002\u4e00\u7c7b\u662f\u5b98\u65b9\u955c\u50cf\uff0c\u6bd4\u5982 ubuntu \u3001 nginx \u3001 redis \u3001 mysql \u3001 wordpress \u7b49\uff0c\u6b64\u7c7b\u955c\u50cf\u4e00\u822c\u7531\u6743\u5a01\u7684\u7b2c\u4e09\u65b9\uff08\u6bd4\u5982Canonical\u3001Oracle\u3001Red Hat\u7b49\u6781\u5177\u80cc\u666f\u7684\u5927\u516c\u53f8\uff09\u8fdb\u884c \u5f00\u53d1\u7ef4\u62a4\uff0c\u6700\u540e\u8fd8\u9700\u8981Docker\u5b98\u65b9\u8ba4\u8bc1\u901a\u8fc7\u3002\u53e6\u4e00\u7c7b\u4e3a\u666e\u901a\u7528\u6237\u955c\u50cf\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#51-\u767b\u5f55","title":"5.1 \u767b\u5f55","text":"<p><pre><code># \u767b\u5f55Docker Hub\u8d26\u53f7\n$ docker login\n\n# \u767b\u5f55\u4fe1\u606f\u90fd\u4fdd\u5b58\u5728/root/.docker/config.json\u6587\u4ef6\u4e2d\uff1a\n$ cat ~/.docker/config.json {\n\"auths\": {\n\"https://index.docker.io/v1/\": {\n\"auth\": \"MTg3OTMyNDc2NDphZG1pbiMxMjM=\"\n}\n},\n    \"HttpHeaders\": {\n\"User-Agent\": \"Docker-Client/18.09.7 (linux)\"\n}\n</code></pre> \u767b\u5f55\u6210\u529f\u4e4b\u540e\uff0c\u4f7f\u7528 push \u547d\u4ee4\u4e0a\u4f20\u955c\u50cf\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u955c\u50cf TAG \uff0c\u6307\u5b9a\u7684\u4ed3\u5e93\u5728\u672c\u5730\u7684\u6240\u6709\u955c\u50cf\u90fd\u4f1a\u4e0a\u4f20\u5230Docker Hub\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#52-\u4e0a\u4f20\u955c\u50cf","title":"5.2 \u4e0a\u4f20\u955c\u50cf","text":"<pre><code>#\u53ef\u4ee5\u4f7f\u7528docker push\u547d\u4ee4\u4e0a\u4f20\u955c\u50cf\u5230\u4ed3\u5e93\uff0c\u9ed8\u8ba4\u4e0a\u4f20\u5230Docker Hub\u5b98\u65b9\u4ed3\u5e93\ndocker push NAME[:TAG] | [REGISTRY_HOST[:REGISTRY_PORT]/]NAME[:TAG]\nsudo docker login\n#\u5148\u5f97\u6dfb\u52a0\u65b0\u7684\u6807\u7b7e\ndocker tag ubuntu:14.04 1879324764/ubuntu_test:14.04\n#\u7136\u540e\u5c06\u65b0\u6dfb\u52a0\u6807\u7b7e\u7684image\u4e0a\u4f20\u5230DockerHub\u4e0a\ndocker push 1879324764/ubuntu_test:14.04\n</code></pre> <p>\u4e3e\u4f8b\u8bf4\u660e <pre><code>#\u67e5\u770b\u955c\u50cf\n[root@pxe-server ~]# docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nhu_tomcat_001       latest              fb758b420be9        4 weeks ago         1.49GB\nmariadb             latest              1813edbc6da2        4 weeks ago         1GB\n\n# \u955c\u50cf\u6539\u540d\uff0c\u6539\u4e3a DockerHubaccount/\u955c\u50cf\u540d:\u7248\u672cTag\n[root@pxe-server ~]# docker tag mariadb:latest 1879324764/mariadb:latest\n[root@pxe-server ~]# docker images\nREPOSITORY           TAG                 IMAGE ID            CREATED             SIZE\nhu_tomcat_001        latest              fb758b420be9        4 weeks ago         1.49GB\n1879324764/mariadb   latest              1813edbc6da2        4 weeks ago         1GB\nmariadb              latest              1813edbc6da2        4 weeks ago         1GB\n\n# \u767b\u5f55DcokerHub\uff0c\u4f7f\u7528DockerHubaccount\u548c\u5bc6\u7801\n[root@pxe-server ~]# docker login\nLogin with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.Username: 1879324764\nPassword: WARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n\n# \u63a8\u9001\u955c\u50cf\u5230DockerHub\u4e0a\n[root@pxe-server ~]# docker push 1879324764/mariadb\n</code></pre> \u7b2c\u4e00\u6b21\u4e0a\u4f20\u65f6\uff0c\u4f1a\u63d0\u793a\u8f93\u5165\u767b\u5f55\u4fe1\u606f\u6216\u8fdb\u884c\u6ce8\u518c\uff0c\u4e4b\u540e\u767b\u5f55\u4fe1\u606f\u4f1a\u8bb0\u5f55\u5230\u672c\u5730~/.docker\u76ee\u5f55\u4e0b\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#7-\u642d\u5efa\u81ea\u5df1\u7684\u79c1\u6709\u4ed3\u5e93","title":"7. \u642d\u5efa\u81ea\u5df1\u7684\u79c1\u6709\u4ed3\u5e93","text":"<p>\u9664\u4e86\u4f7f\u7528Docker\u5b98\u65b9\u63d0\u4f9b\u7684\u6ce8\u518c\u670d\u52a1\u5668Docker Hub\u6765\u5b58\u50a8\u7ba1\u7406\u955c\u50cf\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u642d\u5efa\u81ea \u5df1\u7684\u6ce8\u518c\u670d\u52a1\u5668\u3002Docker Hub\u6240\u4f7f\u7528\u7684\u6ce8\u518c\u670d\u52a1\u5668\u672c\u8eab\u662f\u5f00\u6e90\u7684\uff0c\u5e76\u4e14\u4ee5\u955c\u50cf\u7684\u5f62\u5f0f\u5206\u53d1\u5728 Docker Hub\u4e0a\u3002</p> <p><pre><code>\u6ce8\u518c\u670d\u52a1\u5668\u6e90\u7801\u7684\u5730\u5740\u662fhttps://github.com/docker/docker-registry\uff0c\nDocker Hub\u4e0a\u7684\u955c\u50cf\u540d\u662f registry \n</code></pre> \u6211\u4eec\u53ea\u9700\u8981\u4e24\u6b65,\u5c31\u80fd\u5b8c\u6210\u6ce8\u518c\u670d\u52a1\u5668\u7684\u521b\u5efa</p> <p>\u2460\u62c9\u53d6\u6700\u65b0\u7684registry\u5b98\u65b9\u955c\u50cf\uff1a <pre><code># docker pull registry\n</code></pre> \u2461\u8fd0\u884cregistry\uff1a <pre><code># docker run -p 5000:5000 -d -i -t registry\n</code></pre> \u8fd9\u6837\u6211\u4eec\u7684\u6ce8\u518c\u670d\u52a1\u5668\u5c31\u5df2\u7ecf\u6210\u529f\u5730\u57285000\u7aef\u53e3\u8fd0\u884c\u4e86\u3002\u63a5\u4e0b\u6765\uff0c\u53ef\u4ee5\u5c06\u6211\u4eec\u7684\u955c\u50cf\u63d0\u4ea4\u5230,\u8fd9\u4e2a\u6ce8\u518c\u670d\u52a1\u5668\u4e0a\u3002</p> <pre><code>\u6211\u4eec\u4f7f\u7528 commit \u547d\u4ee4\u5c06\u4efb\u610f\u4e00\u4e2a\u5bb9\u5668\u63d0\u4ea4\u6210\u955c\u50cf\uff0c\n\u5e76\u4e14\u6309\u7167[registry_host: registry_port\\image_name:image_tag]\u65b9\u5f0f\u6307\u5b9aTAG\uff1a\n</code></pre> <pre><code># docker ps -a\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS\nNAMES\n...\n56d26c54b98f    registry:latest \"docker-registry\" 9 minutes ago Exited (3) 9 minutes ago\npensive_davinci\n...\n\n# docker commit 56d26c54b98f 127.0.0.1:5000/my_image:v1\ne35c26122c2ada4f2fb1a84542c3a0ec9e1e0dc191949e01cf5ba43da6aef410\n\n\u63a5\u4e0b\u6765\uff0c\u63d0\u4ea4\u8fd9\u4e2a\u955c\u50cf\u5230\u6ce8\u518c\u670d\u52a1\u5668\uff1a\n# docker push 127.0.0.1:5000/my_image:v1\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#8-\u955c\u50cf\u5236\u4f5c","title":"8. \u955c\u50cf\u5236\u4f5c","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u955c\u50cf\u5236\u4f5c\u76ee\u524d\uff0c\u5177\u6709\u4e00\u5b9a\u89c4\u6a21\u7684\u4f01\u4e1a\u90fd\u4f1a\u81ea\u5df1\u5236\u4f5c\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528\u516c\u6709Hub\u4e0a\u7684\u955c\u50cf\u6216\u8005\u4ece\u955c\u50cf\u63d0\u4f9b\u5546\u7684\u7f51\u7ad9\u4e0b\u8f7d\u5e76\u76f4\u63a5\u4f7f\u7528\uff0c\u4e3b\u8981\u539f\u56e0\u5982\u4e0b\uff1a</p> <p>1\uff09\u4e0b\u8f7d\u7684\u5bb9\u5668\u955c\u50cf\u6587\u4ef6\u8fc7\u5927\uff0c\u6d6a\u8d39\u7a7a\u95f4\uff0c\u6267\u884c\u6548\u7387\u4f4e\u3002</p> <p>2\uff09\u4e0b\u8f7d\u7684\u5bb9\u5668\u955c\u50cf\u8fc7\u5c0f\uff0c\u4e0d\u5c11\u9a71\u52a8\u3001\u5de5\u5177\u6216\u6587\u4ef6\u5728\u5bb9\u5668\u955c\u50cf\u4e2d\u5e76\u6ca1\u6709\u5305\u62ec\uff0c\u4e0d\u80fd\u6ee1\u8db3\u5e94\u7528\u7684\u8981\u6c42\u3002</p> <p>3\uff09\u955c\u50cf\u6587\u4ef6\u6ca1\u6709\u9075\u5faa\u4f01\u4e1a\u7684\u89c4\u8303\u3002</p> <p>4\uff09\u5916\u90e8\u4e0b\u8f7d\u7684\u5bb9\u5668\u955c\u50cf\u5b58\u5728\u5b89\u5168\u6f0f\u6d1e\u3002</p> <p>5\uff09\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u540c\u4f01\u4e1a\u7528\u7684\u4e3b\u6d41\u7248\u672c\u4e0d\u4e00\u81f4\u3002\u56e0\u6b64\u4f01\u4e1a\u9700\u8981\u638c\u63e1\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u955c\u50cf\u7684\u5236\u4f5c\u6280\u80fd\u5e76\u5236\u5b9a\u51fa\u76f8\u5173\u7684\u89c4\u8303\uff0c\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u7684\u57fa\u672c\u8981\u6c42\u3002\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u955c\u50cf\u5c5e\u4e8e\u5bb9\u5668\u955c\u50cf\u7684base image\uff0c\u5176\u4ed6\u955c\u50cf\u90fd\u662f\u8fd9\u4e2a\u955c\u50cf\u7684\u4e0a\u5c42\u955c\u50cf\u3002\u7531\u4e8e\u5bb9\u5668\u5171\u4eab\u5bbf\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838\uff0crootfs\u4f7f\u7528\u5bbf\u4e3b\u673a\uff0c\u56e0\u6b64\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u955c\u50cf\u4e2d\u4e3b\u8981\u5305\u62ecrootfs\u3001rpm\u5de5\u5177\u5305\u53ca\u5e38\u7528\u547d\u4ee4\u7b49\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\u5236\u4f5c\u8fc7\u7a0b</p> <p>\u5236\u4f5c\u8fc7\u7a0b</p> <p>1\uff09\u91cd\u65b0\u5b89\u88c5\u6216\u5229\u7528\u73b0\u6709RHEL7.4\uff083.10.0-693.el7.86_64\uff09\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e3b\u673a\u3002</p> <p>2\uff09\u6839\u636e\u5bbf\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u7684\u5b89\u88c5\u8981\u6c42\u8fdb\u884c\u76f8\u5173\u7684\u53c2\u6570\u914d\u7f6e\uff0c\u5982\u6587\u4ef6\u53e5\u67c4\u6570\u7b49\u3002</p> <p>3\uff09\u5728\u8be5\u4e3b\u673a\u4e0a\u5b89\u88c5Docker\uff0c\u539f\u56e0\u662f\u4f7f\u7528docker import\u751f\u6210\u955c\u50cf\u65f6\u9700\u8981Docker\u3002</p> <p>4\uff09\u5728\u8be5\u673a\u5668\u6839\u76ee\u5f55\u4e0b\u521b\u5efatmp\u76ee\u5f55\uff0c\u5c06\u9700\u8981\u590d\u5236\u5230\u955c\u50cf\u7684\u539f\u59cb\u6587\u4ef6\u590d\u5236\u5230\u6b64\u76ee\u5f55\u4e0b\u3002</p> <p>5\uff09\u5728tmp\u76ee\u5f55\u4e0b\u5efa\u7acb\u4e34\u65f6\u76ee\u5f55\u3002</p> <p>6\uff09\u8bfb\u53d6rpm\u5305\u5217\u8868\uff0c\u4f7f\u7528yum\u547d\u4ee4\u5728tmp\u76ee\u5f55\u5b89\u88c5\u6587\u4ef6\u7cfb\u7edf\u548c\u8f6f\u4ef6\u5305\u3002</p> <p>7\uff09\u5c06tmp\u76ee\u5f55tar\u6253\u5305\u5e76\u901a\u8fc7docker import\u5bfc\u5165\u672c\u5730\u955c\u50cf\u6587\u4ef6\u540e\u4e0a\u4f20\u5230\u955c\u50cf\u4ed3\u5e93\u3002</p> <p>8\uff09\u6e05\u7406tmp\u4e34\u65f6\u76ee\u5f55\u3002</p> <p>\u5176\u4e2d\u7b2c6\u30017\u4e24\u6b65\u53ef\u4ee5\u901a\u8fc7\u6267\u884cmakeImageForRedhat.sh\u811a\u672c\u5b8c\u6210\u3002</p> <p>\u25a0 \u5236\u4f5c\u811a\u672cmakeImageForRedhat.sh\u4e0b\u8f7d\u5730\u5740\uff1a</p> <p>https://pan.baidu.com/s/13tm-xRJz8LjHV3KtRxPVKw\uff0c\u5bc6\u7801\uff1ajgwh\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/2.Docker%E9%95%9C%E5%83%8F/#9-\u7cfb\u7edf\u8d44\u6e90\u9650\u5236\u914d\u7f6e\u8bf4\u660e","title":"9. \u7cfb\u7edf\u8d44\u6e90\u9650\u5236\u914d\u7f6e\u8bf4\u660e","text":"<p>\u901a\u8fc7\u4fee\u6539/etc/security/limit.conf\u6587\u4ef6\u53ef\u9650\u5236\u7528\u6237\u540c\u4e00\u65f6\u523b\u6253\u5f00\u6587\u4ef6\u6570\u548c\u5f00\u542f\u8fdb\u7a0b\u6570\u7b49\u3002</p> <p>\u5bb9\u5668\u6280\u672f\u8fdb\u884c\u8d44\u6e90\u9650\u5236\u7684\u65b9\u6cd5\u6709\u4e24\u79cd\uff1a</p> <p>1\uff09\u4fee\u6539<code>/usr/lib/systemd/system/docker.service</code>\u6587\u4ef6\u53ef\u5b9e\u73b0\u5168\u5c40\u6027\u63a7\u5236\uff0cdocker deamon\u63a7\u5236\u4e0b\u7684\u5bb9\u5668\u90fd\u662f\u6309\u7167\u914d\u7f6e\u6765\u9650\u5236\u8d44\u6e90\u3002</p> <p>2\uff09docker run\u63d0\u4f9b\u4e86--ulimit\u53c2\u6570\uff0c\u53ef\u9488\u5bf9\u6bcf\u4e2a\u5bb9\u5668\u4f7f\u7528\u7684\u8d44\u6e90\u8fdb\u884c\u5dee\u5f02\u5316\u9650\u5236\u3002</p> <p>\u4f46\u662f\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u7528\u6237\u90fd\u4e0d\u4f1a\u4f7f\u7528\u4e0a\u8ff0\u4e24\u79cd\u65b9\u6cd5\u8fdb\u884c\u8d44\u6e90\u9650\u5236\uff0c\u56e0\u4e3a\u6839\u636e\u5bb9\u5668\u7cfb\u7edf\u542f\u52a8\u52a0\u8f7d\u7684\u539f\u7406\uff0cbootfs\u4ec5\u4f1a\u52a0\u8f7d\u5bbf\u4e3b\u673a/etc/security/limit.conf\u914d\u7f6e\uff0c\u800c\u975e\u5bb9\u5668\u5185\u7684limit.conf\u6587\u4ef6\u6765\u9650\u5236\u8d44\u6e90\u7684\u4f7f\u7528\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u6b63\u786e\u914d\u7f6e\u5bbf\u4e3b\u673alimit.conf\u5373\u53ef\uff0c\u955c\u50cf\u4e2d\u7684limit.conf\u6587\u4ef6\u4e0d\u8d77\u4f5c\u7528\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/","title":"3.Docker\u5bb9\u5668","text":"<p>\u5bb9\u5668 \u662fDocker\u7684\u53e6\u4e00\u4e2a\u6838\u5fc3\u6982\u5ff5\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5bb9\u5668\u662f\u955c\u50cf\u7684\u4e00\u4e2a\u8fd0\u884c\u5b9e\u4f8b\u3002\u6240\u4e0d\u540c\u7684\u662f\uff0c\u955c\u50cf\u662f\u9759\u6001\u7684\u53ea\u8bfb\u6587\u4ef6\uff0c\u800c\u5bb9\u5668\u5e26\u6709\u8fd0\u884c\u65f6\u9700\u8981\u7684\u53ef\u5199\u6587\u4ef6\u5c42\uff0c\u540c\u65f6\uff0c\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u8fdb\u7a0b\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u3002</p> <p>\u5982\u679c\u8ba4\u4e3a\u865a\u62df\u673a\u662f\u6a21\u62df\u8fd0\u884c\u7684\u4e00\u6574\u5957\u64cd\u4f5c\u7cfb\u7edf\uff08\u5305\u62ec\u5185\u6838\u3001\u5e94\u7528\u8fd0\u884c\u6001\u73af\u5883\u548c\u5176\u4ed6\u7cfb\u7edf\u73af\u5883\uff09\u548c\u8dd1\u5728\u4e0a\u9762\u7684\u5e94\u7528\u3002\u90a3\u4e48Docker\u5bb9\u5668\u5c31\u662f\u72ec\u7acb\u8fd0\u884c\u7684\u4e00\u4e2a\uff08\u6216\u4e00\u7ec4\uff09\u5e94\u7528\uff0c\u4ee5\u53ca\u5b83\u4eec\u5fc5\u9700\u7684\u8fd0\u884c\u73af\u5883\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#1-\u5bb9\u5668\u7684\u5e38\u89c1\u64cd\u4f5c","title":"1. \u5bb9\u5668\u7684\u5e38\u89c1\u64cd\u4f5c","text":"<p>\u4e0b\u9762\u662f\u5bb9\u5668\u7684\u5e38\u7528\u64cd\u4f5c\u547d\u4ee4\uff1a</p> <pre><code>create      \u521b\u5efa\u5bb9\u5668  \nrun         \u8fd0\u884c\u5bb9\u5668  \npause       \u6682\u505c\u5bb9\u5668  \nunpause     \u53d6\u6d88\u6682\u505c\u7ee7\u7eed\u8fd0\u884c\u5bb9\u5668  \nstop        \u53d1\u9001 SIGTERM \u505c\u6b62\u5bb9\u5668  \nkill        \u53d1\u9001 SIGKILL \u5feb\u901f\u505c\u6b62\u5bb9\u5668  \nstart       \u542f\u52a8\u5bb9\u5668  \nrestart     \u91cd\u542f\u5bb9\u5668  \nattach      attach \u5230\u5bb9\u5668\u542f\u52a8\u8fdb\u7a0b\u7684\u7ec8\u7aef  \nexec        \u5728\u5bb9\u5668\u4e2d\u542f\u52a8\u65b0\u8fdb\u7a0b\uff0c\u901a\u5e38\u4f7f\u7528 \"-it\" \u53c2\u6570  \nlogs        \u663e\u793a\u5bb9\u5668\u542f\u52a8\u8fdb\u7a0b\u7684\u63a7\u5236\u53f0\u8f93\u51fa\uff0c\u7528 \"-f\" \u6301\u7eed\u6253\u5370  \nrm          \u4ece\u78c1\u76d8\u4e2d\u5220\u9664\u5bb9\u5668\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#2-\u521b\u5efa\u5bb9\u5668","title":"2. \u521b\u5efa\u5bb9\u5668","text":"<pre><code>1.\u65b0\u5efa\u4e00\u4e2a\u505c\u6b62\u72b6\u6001\u7684\u5bb9\u5668\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker create -it ubuntu:latest\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps  -a\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                    PORTS               NAMES\nf13492a1cba7        ubuntu:latest       \"/bin/bash\"         26 seconds ago      Created                                       infallible_lamarr\n\n2.\u521b\u5efa\u4e00\u4e2a\u4ea4\u4e92\u578b\u5bb9\u5668\ndocker run -it --name=hu_ubuntu ubuntu /bin/bash\n\n3.\u521b\u5efa\u4e00\u4e2a\u540e\u53f0\u578b\u5bb9\u5668\uff0c\u4f7f\u7528-d\u53c2\u6570\u3002\nsudo docker run --name hu_demo_ubuntu -d ubuntu /bin/bash -c \"while true; do echo hello world; sleep 1; done\"\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#3-\u67e5\u770b\u5bb9\u5668","title":"3. \u67e5\u770b\u5bb9\u5668","text":"<pre><code>#1.docker ps \u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u8fd0\u884c\u7684\u5bb9\u5668\n[root@hujianli-docker01 centos]# docker ps\nCONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS               NAMES\n7fd009ee1f86        ubuntu                \"/bin/bash -c 'while\u2026\"   11 minutes ago      Up 11 minutes                           hu_demo_ubuntu\ne1e8c619585a        quay.io/coreos/etcd   \"/usr/local/bin/etcd\u2026\"   20 hours ago        Up 20 hours                             etcd\n\n#2.Docker\u5217\u51fa\u6240\u6709\u5bb9\u5668\uff0c\u5305\u62ec\u8fd0\u884c\u7684\u548c\u505c\u6b62\u7684\u5bb9\u5668\ndocker ps -a\n\n#3.Docker\u53ea\u5217\u51fa\u6700\u540e\u521b\u5efa\u7684\u5bb9\u5668\ndocker ps -l\n\n#4.\u4f7f\u7528 -n=x \u9009\u9879\uff0c\u6b64\u65f6\u4f1a\u5217\u51fa\u6700\u540e\u521b\u5efa\u7684x\u4e2a\u5bb9\u5668\ndocker ps -n=2\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#4-\u67e5\u770b\u5bb9\u5668\u65e5\u5fd7","title":"4. \u67e5\u770b\u5bb9\u5668\u65e5\u5fd7","text":"<pre><code>[root@hujianli-docker01 centos]# docker logs -f hu_demo_ubuntu\nhello world\nhello world\n\n# --tail \u6807\u5fd7\u53ef\u4ee5\u7cbe\u786e\u63a7\u5236 logs \u8f93\u51fa\u7684\u65e5\u5fd7\u884c\u6570\u3002\u4f8b\u5982\uff0c\u67e5\u770b\u6700\u540e5\u884c\u65e5\u5fd7\n[root@hujianli-docker01 centos]# docker logs -f --tail=5 hu_demo_ubuntu\nhello world\nhello world\nhello world\nhello world\nhello world\nhello world\n\n#\u53ef\u4ee5\u901a\u8fc7 -t \u6807\u5fd7\u67e5\u770b\u65e5\u5fd7\u4ea7\u751f\u7684\u65f6\u523b\n[root@hujianli-docker01 centos]# docker logs -f --tail=5 -t hu_demo_ubuntu\n2019-07-05T02:48:53.092986363Z hello world\n2019-07-05T02:48:54.095842349Z hello world\n2019-07-05T02:48:55.098757187Z hello world\n2019-07-05T02:48:56.100865840Z hello world\n2019-07-05T02:48:57.104798046Z hello world\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#5-\u542f\u52a8\u5bb9\u5668","title":"5. \u542f\u52a8\u5bb9\u5668","text":"<pre><code>#1.\u901a\u8fc7\u5bb9\u5668id\u542f\u52a8\ndocker start 3d5e4ad6455f\n\n#2.\u901a\u8fc7\u5bb9\u5668\u540d\u79f0\u542f\u52a8\nsudo docker start inspect_shell\n\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n3d5e4ad6455f        ubuntu:14.04        \"/bin/bash\"         18 hours ago        Up 3 seconds                            wonderful_wozniak\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#6-\u65b0\u5efa\u5e76\u542f\u52a8\u5bb9\u5668","title":"6. \u65b0\u5efa\u5e76\u542f\u52a8\u5bb9\u5668","text":"<pre><code>[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker run ubuntu /bin/echo \"hello world\"\nhello world\n# \u5f53\u5229\u7528docker run\u6765\u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668\u65f6\uff0cDocker\u5728\u540e\u53f0\u8fd0\u884c\u7684\u6807\u51c6\u64cd\u4f5c\u5305\u62ec\uff1a \u00b7\u68c0\u67e5\u672c\u5730\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684\u955c\u50cf\uff0c\u4e0d\u5b58\u5728\u5c31\u4ece\u516c\u6709\u4ed3\u5e93\u4e0b\u8f7d\uff1b\n# \u542f\u52a8\u4e00\u4e2abash\u7ec8\u7aef\uff0c\u5141\u8bb8\u7528\u6237\u8fdb\u884c\u4ea4\u4e92\uff1a\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker run -it ubuntu:14.04 /bin/bash\nroot@22c6b5a012b0:/#\n\n#\uff0c-t\u9009\u9879\u8ba9Docker\u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef\uff08pseudo-tty\uff09\u5e76\u7ed1\u5b9a\u5230\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4e0a\uff0c-i\u5219\u8ba9\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4fdd\u6301\u6253\u5f00\u3002\n\u5b88\u62a4\u6001\u8fd0\u884c\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker run -d ubuntu:14.04 /bin/sh -c \"while true;do echo hello world;sleep 1;done\"\nca08bd323aecdc48e76918dd66d5e37362add12e81d43e185debc65ca4083f7b\n\n#\u83b7\u53d6\u5bb9\u5668\u7684\u8f93\u51fa\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528docker logs\u547d\u4ee4\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker logs ca08\nhello world\nhello world\nhello world\nhello world\nhello world\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#7-\u67e5\u770b\u5bb9\u5668\u8fdb\u7a0b","title":"7. \u67e5\u770b\u5bb9\u5668\u8fdb\u7a0b","text":"<pre><code>[root@hujianli-docker01 centos]# docker top hu_demo_ubuntu\nUID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD\nroot                23951               23935               0                   02:31               ?                   00:00:00            /bin\n/bash -c while true; do echo hello world; sleep 1; doneroot                25679               23951               0                   02:49               ?                   00:00:00            slee\np 1\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#8-\u67e5\u770b\u5bb9\u5668\u4fe1\u606f","title":"8. \u67e5\u770b\u5bb9\u5668\u4fe1\u606f","text":"<pre><code># \u67e5\u770b\u5bb9\u5668\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\uff08\u5bb9\u5668\u540d\u79f0\u3001\u73af\u5883\u53d8\u91cf\u3001\u8fd0\u884c\u547d\u4ee4\u3001\u4e3b\u673a\u914d\u7f6e\u3001\u6570\u636e\u5377......\u914d\u7f6e\uff09\ndocker inspect hu_demo_ubuntu\n\n# --format \u683c\u5f0f\u5316\u6807\u5fd7\uff0c\u53ef\u4ee5\u67e5\u770b\u6307\u5b9a\u90e8\u5206\u7684\u4fe1\u606f\n#\u67e5\u770b\u5bb9\u5668\u7684\u8fd0\u884c\u72b6\u6001\n[root@hujianli-docker01 centos]# docker inspect --format='{{ .State.Running }}' hu_demo_ubuntu\ntrue\n#\u67e5\u770b\u72b6\u6001\u503c\n[root@hujianli-docker01 centos]# docker inspect --format='{{ .State.Status }}' hu_demo_ubuntu\nrunning\n\n# \u67e5\u770b\u5bb9\u5668\u7684IP\u5730\u5740\n[root@hujianli-docker01 centos]# docker inspect --format='{{ .NetworkSettings.IPAddress }}' hu_demo_ubuntu\n172.17.0.2\n\n#\u67e5\u770b\u5bb9\u5668\u7684\u955c\u50cf\u7c7b\u578b\n[root@hujianli-docker01 centos]# docker inspect --format='{{ .Config.Image }}' hu_demo_ubuntu\nubuntu\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#9-\u7ec8\u6b62\u5bb9\u5668","title":"9. \u7ec8\u6b62\u5bb9\u5668","text":"<pre><code>#\u9996\u5148\u5411\u5bb9\u5668\u53d1\u9001SIGTERM\u4fe1\u53f7\uff0c\u7b49\u5f85\u4e00\u6bb5\u8d85\u65f6\u65f6\u95f4\uff08\u9ed8\u8ba4\u4e3a10\u79d2\uff09\u540e\uff0c\u518d\u53d1\u9001SIGKILL\u4fe1\u53f7\u6765\u7ec8\u6b62\u5bb9\u5668\uff1a\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps \nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\nca08bd323aec        ubuntu:14.04        \"/bin/sh -c 'while...\"   2 minutes ago       Up 2 minutes                            festive_nobel\n3d5e4ad6455f        ubuntu:14.04        \"/bin/bash\"              18 hours ago        Up 7 minutes                            wonderful_wozniak\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker stop ca08\nca08\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n3d5e4ad6455f        ubuntu:14.04        \"/bin/bash\"         18 hours ago        Up 7 minutes                            wonderful_wozniak\n\n# docker kill\u547d\u4ee4\u4f1a\u76f4\u63a5\u53d1\u9001SIGKILL\u4fe1\u53f7\u6765\u5f3a\u884c\u7ec8\u6b62\u5bb9\u5668\u3002\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker kill 3d5e\n3d5e\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n\n#\u53ef\u4ee5\u7528docker ps-qa\u547d\u4ee4\u770b\u5230\u6240\u6709\u5bb9\u5668\u7684ID\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps -qa\n22c6b5a012b0\nbdbdb0d56db9\n9339393ce470\nf13492a1cba7\n3d5e4ad6455f\n\n#\u53ef\u4ee5\u4f7f\u7528docker start\u547d\u4ee4\u6765\u91cd\u65b0\u542f\u52a8\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker start 2c53\n# docker restart\u547d\u4ee4\u4f1a\u5c06\u4e00\u4e2a\u8fd0\u884c\u6001\u7684\u5bb9\u5668\u5148\u7ec8\u6b62\uff0c\u7136\u540e\u518d\u91cd\u65b0\u542f\u52a8\u5b83\uff1a\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker restart 22c6b5a012b0\n22c6b5a012b0\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#10-\u8fdb\u5165\u5bb9\u5668","title":"10. \u8fdb\u5165\u5bb9\u5668","text":"<pre><code>#1. \u7528attach\u547d\u4ee4\u6709\u65f6\u5019\u5e76\u4e0d\u65b9\u4fbf\u3002\u5f53\u591a\u4e2a\u7a97\u53e3\u540c\u65f6\u7528attach\u547d\u4ee4\u8fde\u5230\u540c\u4e00\u4e2a\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u6240\u6709\u7a97\u53e3\u90fd\u4f1a\u540c\u6b65\u663e\u793a\u3002\u5f53\u67d0\u4e2a\u7a97\u53e3\u56e0\u547d\u4ee4\u963b\u585e\u65f6\uff0c\u5176\u4ed6\u7a97\u53e3\u4e5f\u65e0\u6cd5\u6267\u884c\u64cd\u4f5c\u4e86\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n22c6b5a012b0        ubuntu:14.04        \"/bin/bash\"         10 minutes ago      Up 57 seconds                           dazzling_dijkstra\n\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker attach 22c6\nroot@22c6b5a012b0:/# #2. Docker\u4ece1.3.0\u7248\u672c\u8d77\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u52a0\u65b9\u4fbf\u7684exec\u547d\u4ee4\uff0c\u53ef\u4ee5\u5728\u5bb9\u5668\u5185\u76f4\u63a5\u6267\u884c\u4efb\u610f\u547d\u4ee4\u3002\n#\u8fdb\u5165\u5230\u521a\u521b\u5efa\u7684\u5bb9\u5668\u4e2d\uff0c\u5e76\u542f\u52a8\u4e00\u4e2abash\uff1a\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker exec -it 22c6b5a012b0 /bin/bash\nroot@22c6b5a012b0:/# # \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u542f\u52a8\u4e00\u4e2abusybox\u955c\u50cf\u5bb9\u5668\ndocker run -itd busybox /bin/bash   #\u4e0b\u8f7d\u955c\u50cf\ndocker exec -it b47 /bin/bash       # \u8fdb\u5165\u955c\u50cf\u5bb9\u5668\n#busybox\uff1a\u662f\u4e00\u4e2amini\u7248\u672c\u7684linux\uff0c\u6709linux\u7684\u6240\u6709\u547d\u4ee4\u884c\u5de5\u5177\n#3.nsenter\u5de5\u5177(\u4e0d\u5e38\u7528)\ncd /tmp; curlh ttps://www.kernel.org/pub/linux/utils/util-linux/v2.24/util-linux-2.24.tar.gz|tar -zxf -;cd util-linux-2.24; ./configure --without-ncurses make nsenter &amp;&amp; cp nsenter /usr/local/bin\n\n# \u4f7f\u7528nsenter\u8fde\u63a5\u5230\u5bb9\u5668\uff0c\u5148\u627e\u5230\u5bb9\u5668\u8fdb\u7a0b\u7684PID\uff0c\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\n[root@iZ2ze38chylj63vuj6fqiaZ util-linux-2.24]# docker ps \nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n22c6b5a012b0        ubuntu:14.04        \"/bin/bash\"         31 minutes ago      Up 18 minutes                           dazzling_dijkstra\n\n[root@iZ2ze38chylj63vuj6fqiaZ util-linux-2.24]# docker inspect -f {{.State.Pid}} 22c6b5a012b0\n6450\n# PID=$(docker inspect --format \"{{.State.Pid}}\" &lt;container&gt;)\n[root@iZ2ze38chylj63vuj6fqiaZ util-linux-2.24]# nsenter --target 6450 --mount --uts --ipc --net --pid\nroot@22c6b5a012b0:/# #\u5982\u679c\u53ea\u662f\u4e3a\u4e86\u67e5\u770b\u542f\u52a8\u547d\u4ee4\u7684\u8f93\u51fa\uff0c\u53ef\u4ee5\u4f7f\u7528 docker logs \u547d\u4ee4\uff1a\nattach VS exec\nattach \u4e0e exec \u4e3b\u8981\u533a\u522b\u5982\u4e0b:\nattach \u76f4\u63a5\u8fdb\u5165\u5bb9\u5668 \u542f\u52a8\u547d\u4ee4 \u7684\u7ec8\u7aef\uff0c\u4e0d\u4f1a\u542f\u52a8\u65b0\u7684\u8fdb\u7a0b\u3002\nexec \u5219\u662f\u5728\u5bb9\u5668\u4e2d\u6253\u5f00\u65b0\u7684\u7ec8\u7aef\uff0c\u5e76\u4e14\u53ef\u4ee5\u542f\u52a8\u65b0\u7684\u8fdb\u7a0b\u3002\n\u5982\u679c\u60f3\u76f4\u63a5\u5728\u7ec8\u7aef\u4e2d\u67e5\u770b\u542f\u52a8\u547d\u4ee4\u7684\u8f93\u51fa\uff0c\u7528 attach\uff1b\u5176\u4ed6\u60c5\u51b5\u4f7f\u7528 exec\u3002\n</code></pre> <p>\u9000\u51fa\u5bb9\u5668\uff0c\u4fdd\u6301\u5bb9\u5668\u7ee7\u7eed\u8fd0\u884c\uff1a</p> <p>ctrl-p\u548cctrl-q\u3002 \u5982\u679c\u4f7f\u7528exit\u3002\u9000\u51fa\u5bb9\u5668\u65f6\uff0c\u5bb9\u5668\u4f1a\u81ea\u52a8\u5173\u95ed\u3002</p> <pre><code>#\u8fd0\u884c\u8fdc\u7a0b\u673a\u5668\u4e0a\u7684\u5bb9\u5668\ndocker run -it -h test.up.com daocloud.io/centos:7\n</code></pre> <p>\u6269\u5c55\uff1a\u5982\u4f55\u8fdb\u5165docker \u4f7f\u7528root\u7528\u6237\u7684\u65b9\u5f0f <pre><code>docker exec -it --user root &lt;container id&gt; /bin/bash\n</code></pre></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#11-\u5bb9\u5668\u5185\u6267\u884c\u547d\u4ee4","title":"11. \u5bb9\u5668\u5185\u6267\u884c\u547d\u4ee4","text":"<pre><code># \u4ea4\u4e92\u578b\u4efb\u52a1\u7684\u4f8b\u5b50\n[root@hujianli-docker01 centos]# docker exec -it 7fd009ee1f86 ps aux\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot         1  0.0  0.0  18364  1584 ?        Ss   02:31   0:01 /bin/bash -c wh\nroot      1617  0.0  0.0   4520   384 ?        S    02:58   0:00 sleep 1\nroot      1618  0.0  0.0  34388  1472 pts/0    Rs+  02:58   0:00 ps aux\n\n# \u540e\u53f0\u578b\u4efb\u52a1\u7684\u4f8b\u5b50\uff1a\n$ sudo docker exec -d daemon_dave touch /etc/new_config_file\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#12-\u6682\u505c\u6062\u590d\u5bb9\u5668","title":"12. (\u6682\u505c/\u6062\u590d)\u5bb9\u5668","text":"<pre><code>[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES\n350a409c2eb2        nginx               \"nginx -g 'daemon ...\"   4 seconds ago       Up 3 seconds        0.0.0.0:8080-&gt;80/tcp   epic_meninsk\n\n#\u6682\u505c\u5de5\u4f5c\uff0c\u6bd4\u5982\u5bf9\u6587\u4ef6\u7cfb\u7edf\u6253\u5feb\u7167\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker pause 350a4\n350a4\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                   PORTS                  NAMES\n350a409c2eb2        nginx               \"nginx -g 'daemon ...\"   26 seconds ago      Up 25 seconds(Paused)    0.0.0.0:8080-&gt;80/tcp   epic_menins\n\n# \u6062\u590d\u5bb9\u5668\u8fd0\u884c\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker unpause 350a4\n350a4\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES\n350a409c2eb2        nginx               \"nginx -g 'daemon ...\"   2 minutes ago       Up About a minute   0.0.0.0:8080-&gt;80/tcp   epic_menins\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#13-\u5220\u9664\u5bb9\u5668","title":"13. \u5220\u9664\u5bb9\u5668","text":"<pre><code>#\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cdocker rm\u547d\u4ee4\u53ea\u80fd\u5220\u9664\u5904\u4e8e\u7ec8\u6b62\u6216\u9000\u51fa\u72b6\u6001\u7684\u5bb9\u5668\uff0c\u5e76\u4e0d\u80fd\u5220\u9664\u8fd8\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u7684\u5bb9\u5668\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS               NAMES\n22c6b5a012b0        ubuntu:14.04        \"/bin/bash\"              35 minutes ago      Up 22 minutes                                     dazzling_dijkstra\nbdbdb0d56db9        ubuntu              \"/bin/echo 'hello ...\"   36 minutes ago      Exited (0) 36 minutes ago                         eloquent_swartz\n9339393ce470        ubuntu              \"/bin/bash echo 'h...\"   36 minutes ago      Exited (126) 36 minutes ago                       objective_blackwell\nf13492a1cba7        ubuntu:latest       \"/bin/bash\"              40 minutes ago      Created                                           infallible_lamarr\n3d5e4ad6455f        ubuntu:14.04        \"/bin/bash\"              19 hours ago        Exited (137) 29 minutes ago                       wonderful_wozniak\n\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker rm 3d5e4ad6455f\n3d5e4ad6455f\n\n# \u5982\u679c\u8981\u76f4\u63a5\u5220\u9664\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u6dfb\u52a0-f\u53c2\u6570\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker run -d ubuntu:14.04 /bin/sh -c \"while true;do echo hello world;sleep 1;done\"\nd8f004f4573f9703d3734d3f0096ff5ba209f0b16e9c7b5d6b528b166acd9b66\n\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker rm d8f00\nError response from daemon: You cannot remove a running container d8f004f4573f9703d3734d3f0096ff5ba209f0b16e9c7b5d6b528b166acd9b66. Stop the container before attempting removal or use -f[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker rm -f  d8f00\nd8f00\n\n# \u540c\u65f6\u5220\u9664\u540e\u53f0\u591a\u4e2a\u5bb9\u5668\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker rm $(docker ps -qa)\nbdbdb0d56db9\n9339393ce470\n\n\u6216\u8005\uff1a\n#docker rm \u4e00\u6b21\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u5bb9\u5668\uff0c\u5982\u679c\u5e0c\u671b\u6279\u91cf\u5220\u9664\u6240\u6709\u5df2\u7ecf\u9000\u51fa\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a\n## \u6839\u636e\u683c\u5f0f\u5220\u9664\u6240\u6709\u5bb9\u5668\uff0c\u5bb9\u5668\u7684\u72b6\u6001\u4e3a\u505c\u6b62\u7684\ndocker rm -v $(docker ps -aq -f status=exited)\ndocker rm $(docker ps -a -q)\n## \u5f3a\u5236\u6279\u91cf\u5220\u9664\ndocker rm $(docker ps -a -q) --force\n\n# \u4f7f\u7528awk\u5b9e\u73b0\ndocker rm $(docker ps -a|awk '/Exited/{print $1}')\n#\u6216\u8005\u6279\u91cf\u6e05\u7406\u4e34\u65f6\u955c\u50cf\u6587\u4ef6\ndocker rmi $(docker images -q -f dangling=true)\n#\u6279\u91cf\u5220\u9664\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\ndocker rm -f $(docker ps|grep -v \"CONTAINER\"|awk '{print $1}')\n# \u6267\u884c\u65e0\u6cd5\u5220\u9664\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\uff0c\u6211\u4eec\u9700\u8981\u5148\u505c\u6b62\u7136\u540e\u5728\u5220\u9664\ndocker stop d8f00\ndocker rm d8f00\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#14-\u5176\u4ed6\u5bb9\u5668\u64cd\u4f5c","title":"14. \u5176\u4ed6\u5bb9\u5668\u64cd\u4f5c","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#141-\u590d\u5236\u6587\u4ef6","title":"14.1 \u590d\u5236\u6587\u4ef6","text":"<pre><code># \u5bb9\u5668\u6570\u636e\u5411\u5916\u590d\u5236\nUsage:  docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-\n\n# \u5916\u90e8\u6570\u636e\u590d\u5236\u5230\u5bb9\u5668\u5185\ndocker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH\n</code></pre> <pre><code>$ docker cp 9eac3a /var/jenkins_home/gitee_workspace_parallel/ /home/\n\"docker cp\" requires exactly 2 arguments.\nSee 'docker cp --help'.\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#142-\u67e5\u770b\u53d8\u66f4","title":"14.2 \u67e5\u770b\u53d8\u66f4","text":"<p>\u67e5\u770bjenkins_jenkins_1\u5bb9\u5668\u5185\u7684\u6570\u636e\u4fee\u6539\uff1a</p> <pre><code>$ docker container diff jenkins_jenkins_1\nC /tmp\nA /tmp/hsperfdata_jenkins\nA /tmp/hsperfdata_jenkins/6\nA /tmp/jetty-0_0_0_0-8080-war-_-any-6407271552317565788.dir\nA /tmp/jetty-0_0_0_0-8080-war-_-any-6753302642276023631.dir\nA /tmp/jetty-0_0_0_0-8080-war-_-any-6829047221675530177.dir\nA /tmp/winstone3743544242970475678.jar\nA /tmp/winstone4225465649559590246.jar\nA /tmp/winstone7204593242092902219.jar\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#143-\u67e5\u770b\u7aef\u53e3\u6620\u5c04","title":"14.3 \u67e5\u770b\u7aef\u53e3\u6620\u5c04","text":"<pre><code>$ docker container port jenkins_jenkins_1\n8080/tcp -&gt; 0.0.0.0:8080\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#15\u5bfc\u5165\u548c\u5bfc\u51fa\u5bb9\u5668","title":"15.\u5bfc\u5165\u548c\u5bfc\u51fa\u5bb9\u5668","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#151-\u5bfc\u51fa\u5bb9\u5668","title":"15.1 \u5bfc\u51fa\u5bb9\u5668","text":"<pre><code>[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS               NAMES\n22c6b5a012b0        ubuntu:14.04        \"/bin/bash\"              40 minutes ago      Up 26 minutes                                     dazzling_dijkstra\nbdbdb0d56db9        ubuntu              \"/bin/echo 'hello ...\"   41 minutes ago      Exited (0) 41 minutes ago                         eloquent_swartz\n9339393ce470        ubuntu              \"/bin/bash echo 'h...\"   41 minutes ago      Exited (126) 41 minutes ago                       objective_blackwell\nf13492a1cba7        ubuntu:latest       \"/bin/bash\"              45 minutes ago      Created                                           infallible_lamarr\n\n#\u5206\u522b\u5bfc\u51fa\u5bb9\u5668f13492a1cba7\u548c\u5bb9\u566822c6b5a012b0 \u5230\u6587\u4ef6test_for_ubuntu:latest\u548c\u6587\u4ef6test_for_run_ubuntu.tar\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker export -o test_for_ubuntu:latest f13492\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker export 22c6b &gt; test_for_run_ubuntu.tar\n\u4e4b\u540e\uff0c\u53ef\u5c06\u5bfc\u51fa\u7684tar\u6587\u4ef6\u4f20\u8f93\u5230\u5176\u4ed6\u673a\u5668\u4e0a\uff0c\u7136\u540e\u518d\u901a\u8fc7\u5bfc\u5165\u547d\u4ee4\u5bfc\u5165\u5230\u7cfb\u7edf\u4e2d\uff0c\u4ece\u800c\u5b9e\u73b0\u5bb9\u5668\u7684\u8fc1\u79fb\u3002\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#152-\u5bfc\u5165\u5bb9\u5668","title":"15.2 \u5bfc\u5165\u5bb9\u5668","text":"<pre><code>[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS               NAMES\nbdbdb0d56db9        ubuntu              \"/bin/echo 'hello ...\"   48 minutes ago      Exited (0) 48 minutes ago                         eloquent_swartz\n9339393ce470        ubuntu              \"/bin/bash echo 'h...\"   49 minutes ago      Exited (126) 49 minutes ago                       objective_blackwell\n\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker import test_for_ubuntu\\:latest  test_hu/ubuntu:14.04\nsha256:d8a336bc07fd1b05266710a5d93f05d6a08dae99d0ae5afa1498ad9a78325191\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker import test_for_run_ubuntu.tar run_hu/ubuntu:14.04\nsha256:a7c21f91b4afe37b48a1abc1b15ce2cd7b5c759367579b0837a4c6f64332a65f\n\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker images\nREPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE\nrun_hu/ubuntu                      14.04               a7c21f91b4af        4 seconds ago       175 MB\ntest_hu/ubuntu                     14.04               d8a336bc07fd        11 seconds ago      69.9 MB\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#16-docker\u8d44\u6e90\u9650\u5236","title":"16. docker\u8d44\u6e90\u9650\u5236","text":"<pre><code>-m --memory      #\u9650\u5236\u5bb9\u5668\u4f7f\u7528\u7684\u5185\u5b58\n--memory-swap    #\u5141\u8bb8\u4ea4\u6362\u5206\u533a\u5230\u78c1\u76d8\u7684\u5185\u5b58\n--memory-swappiness=&lt;0-100&gt;  #\u5bb9\u5668\u4f7f\u7528swap\u7684\u767e\u5206\u6bd4,\u9ed8\u8ba4\u5173\u95ed-1\n--oom-kill-disable   #\u7981\u7528oom\n--cpus           #\u53ef\u4ee5\u4f7f\u7528cpu\u7684\u6570\u91cf[\u5e38\u7528]\n--cpuset-cpus    #\u9650\u5236\u5bb9\u5668\u4f7f\u7528\u7279\u5b9a\u7684cpu \u5982: 0-3 0,1\n--cpu-shares     #cpu\u5171\u4eab(\u76f8\u5bf9\u7684\u6743\u91cd)\n</code></pre> <p>\u8d44\u6e90\u9650\u5236\u793a\u4f8b:</p> <pre><code>#\u9650\u5236\u5185\u5b58500MB \u5f00\u542fswap600MB \u7981\u6b62\u88aboom\n$ docker run -d --name nginx01 --memory=\"500m\" --memory-swap=\"600m\" --oom-kill-disable nginx\n\n#\u9650\u5236CPU\u793a\u4f8b,\u6700\u591a\u53ef\u4ee5\u4f7f\u75281.5\u4e2acpu\n$ docker run -d --name nginx02 --cpus=\"1.5\" nginx\n\n#\u9650\u5236\u6700\u591a\u4f7f\u752850%cpu\n$ docker run -d --name nginx05 --cpus=\".5\" nginx\n</code></pre> <pre><code>#\u5185\u5b58\n$ docker run -m 200M --memory-swap=300M ubuntu\n#\u5176\u542b\u4e49\u662f\u5141\u8bb8\u8be5\u5bb9\u5668\u6700\u591a\u4f7f\u7528 200M \u7684\u5185\u5b58\u548c 100M \u7684 swap\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0a\u9762\u4e24\u7ec4\u53c2\u6570\u4e3a -1\uff0c\u5373\u5bf9\u5bb9\u5668\u5185\u5b58\u548c swap \u7684\u4f7f\u7528\u6ca1\u6709\u9650\u5236\n$ docker run -it -m 200M --memory-swap=300M progrium/stress --vm 1 --vm-bytes 280M\n# --vm 1\uff1a\u542f\u52a8 1 \u4e2a\u5185\u5b58\u5de5\u4f5c\u7ebf\u7a0b\u3002\n# --vm-bytes 280M\uff1a\u6bcf\u4e2a\u7ebf\u7a0b\u5206\u914d 280M \u5185\u5b58\u3002\n#####\u5982\u679c\u5728\u542f\u52a8\u5bb9\u5668\u65f6\u53ea\u6307\u5b9a -m \u800c\u4e0d\u6307\u5b9a --memory-swap\uff0c\u90a3\u4e48 --memory-swap \u9ed8\u8ba4\u4e3a -m \u7684\u4e24\u500d\uff0c\u6bd4\u5982\uff1a\n$ docker run -it -m 200M ubuntu\n\u5bb9\u5668\u6700\u591a\u4f7f\u7528 200M \u7269\u7406\u5185\u5b58\u548c 200M swap\u3002\n\n#CPU \n# \u6bd4\u5982\u5728 host \u4e2d\u542f\u52a8\u4e86\u4e24\u4e2a\u5bb9\u5668\uff1a\n$ docker run --name \"container_A\" -c 1024 ubuntu\n$ docker run --name \"container_B\" -c 512 ubuntu\n#container_A \u7684 cpu share 1024\uff0c\u662f container_B \u7684\u4e24\u500d\u3002\u5f53\u4e24\u4e2a\u5bb9\u5668\u90fd\u9700\u8981 CPU \u8d44\u6e90\u65f6\uff0ccontainer_A \u53ef\u4ee5\u5f97\u5230\u7684 CPU \u662f container_B \u7684\u4e24\u500d\n# Block IO \n$ docker run -it --name container_A --blkio-weight 600 ubuntu   $ docker run -it --name container_B --blkio-weight 300 ubuntu\n\n# \u9650\u5236 bps \u548c iops\n#bps \u662f byte per second\uff0c\u6bcf\u79d2\u8bfb\u5199\u7684\u6570\u636e\u91cf\u3002\n#iops \u662f io per second\uff0c\u6bcf\u79d2 IO \u7684\u6b21\u6570\u3002\n\u53ef\u901a\u8fc7\u4ee5\u4e0b\u53c2\u6570\u63a7\u5236\u5bb9\u5668\u7684 bps \u548c iops\uff1a\n--device-read-bps\uff0c\u9650\u5236\u8bfb\u67d0\u4e2a\u8bbe\u5907\u7684 bps\u3002\n--device-write-bps\uff0c\u9650\u5236\u5199\u67d0\u4e2a\u8bbe\u5907\u7684 bps\u3002\n--device-read-iops\uff0c\u9650\u5236\u8bfb\u67d0\u4e2a\u8bbe\u5907\u7684 iops\u3002\n--device-write-iops\uff0c\u9650\u5236\u5199\u67d0\u4e2a\u8bbe\u5907\u7684 iops\u3002\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#17-\u5bb9\u5668\u548c\u955c\u50cf\u8f6c\u5316\u8fc1\u79fb\u65b9\u5f0f","title":"17. \u5bb9\u5668\u548c\u955c\u50cf\u8f6c\u5316\u3001\u8fc1\u79fb\u65b9\u5f0f","text":"<pre><code>\u4e00\u3001\u5bb9\u5668\u8f6c\u5316\u4e3a\u955c\u50cf\uff08docker export\u3001docker import\uff09\n1\uff09docker export\uff1a\u8868\u793a\u5c06\u5bb9\u5668\u5bfc\u51fa\u6587\u4ef6\u5305\n\u4e24\u79cd\u547d\u4ee4\u65b9\u5f0f\uff08finhub-cms\u4e3a\u5bb9\u5668\u540d\uff09\uff1a\ndocker export finhub-cms &gt; finhub-cms.tar\ndocker export -o finhub-cms.tar finhub-cms\n\n2\uff09docker import\uff1a\u8868\u793a\u6839\u636edocker export \u5bfc\u51fa\u7684\u6587\u4ef6\u5305\u65b0\u5efa\u4e00\u4e2a\u955c\u50cf\u3002\u53ef\u4ee5\u57fa\u4e8e\u8fd9\u4e2a\u65b0\u955c\u50cf\u521b\u5efa\u5bb9\u5668\uff0c\u5b9e\u73b0\u5bb9\u5668\u8fc1\u79fb\u3002\n\u53e6\u79cd\u547d\u4ee4\u65b9\u5f0f\uff1a\ndocker import finhub-cms.tar finhub-cms:v1\ncat finhub-cms.tar | docker import - finhub-cms:v1\n\n3\uff09docker commit\uff1a\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u5c06\u5bb9\u5668\u8f6c\u5316\u4e3a\u955c\u50cf\u3002\ndocker commit finhub-cms finhub-cms:v1\n\n\u4e8c\u3001\u955c\u50cf\u8fc1\u79fb\uff08\u955c\u50cf\u5bfc\u51fa\u3001\u955c\u50cf\u5bfc\u5165\uff09\n1\uff09docker save\uff1a\u8868\u793a\u5c06\u955c\u50cf\u6253\u5305\uff0c\u65b9\u4fbf\u8fc1\u79fb\n#\u4e24\u79cd\u547d\u4ee4\u65b9\u5f0f\uff08finhub-cms:v1\u4e3a\u955c\u50cf\u540d\uff09\uff1a\ndocker save finhub-cms:v1 &gt; finhub-cms_v1.tar.gz\ndocer save -o finhub-cms_v1.tar.gz finhub-cms:v1\n\n2\uff09docker load\uff1a \u8868\u793a\u5c06docker save\u5bfc\u51fa\u7684\u955c\u50cf\u5305\u5bfc\u5165\u5230\u672c\u5730\u4ed3\u5e93\n#\u4e24\u79cd\u547d\u4ee4\u65b9\u5f0f\uff1a\ndocker load &lt; finhub-cms_v1.tar.gz\ndocker load --input finhub-cms_v1.tar.gz\n\n\u4e09\u3001\u6ce8\u610f\u7ec6\u8282\n\u4e00\u822c\u60c5\u51b5\u4e0b\uff1a\ndocker save \u5bfc\u51fa\u7684\u955c\u50cf\u5305 \u8981\u6bd4docker export\u6253\u6210\u7684\u5bb9\u5668\u6587\u4ef6\u5305\u5927\u4e00\u70b9\u3002\n\n\u8fd9\u662f\u56e0\u4e3adocker export\u5bfc\u51fa\u7684\u5bb9\u5668\u5305 \u4e22\u5931\u4e86\u5386\u53f2\u548c\u5143\u6570\u636emetadata\u3002\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>https://www.cnblogs.com/kevingrace/p/14434806.html</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/3.Docker%E5%AE%B9%E5%99%A8/#18\u4f7f\u7528kitematic\u6765\u7ba1\u7406docker\u5bb9\u5668","title":"18.\u4f7f\u7528Kitematic\u6765\u7ba1\u7406Docker\u5bb9\u5668","text":"<p>Kitematic\u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u65e8\u5728\u7b80\u5316\u5728Mac\u6216Windows PC\u4e0a\u4f7f\u7528Docker\u7684\u8fc7\u7a0b\u3002Kitematic\u81ea\u52a8\u5316Docker\u5b89\u88c5\u548c\u8bbe\u7f6e\u8fc7\u7a0b\uff0c\u5e76\u63d0\u4f9b\u76f4\u89c2\u7684\u56fe\u5f62\u7528\u6237\u754c\u9762\uff08GUI\uff09\u6765\u8fd0\u884cDocker\u5bb9\u5668\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528Kitematic\u5de5\u5177\u6765\u67e5\u770b\u548c\u7ba1\u7406\u81ea\u5df1\u7684\u5bb9\u5668\u670d\u52a1\u3002\u5982\u679c\u5c1a\u672a\u5b89\u88c5\u6b64\u5de5\u5177\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5\uff1a</p> <p>\u25cf \u4eceDocker for Mac\u6216Docker for Windows\u83dc\u5355\u4e2d\u9009\u62e9\u201cKitematic\u201d\u9009\u9879\uff0c\u5f00\u59cb\u4f7f\u7528Kitematic\u5b89\u88c5\u3002</p> <p>\u25cf \u76f4\u63a5\u4eceKitematic\u7248\u672c\u9875\u9762\u4e0b\u8f7dKitematic\uff0c\u4e0b\u8f7d\u5730\u5740\u4e3ahttps://github.com/docker/kitematic/releases/\u3002</p> <p>\u53e6\u5916\uff0cKitematic\u96c6\u6210\u4e86Docker Hub\uff0c\u5141\u8bb8\u901a\u8fc7\u641c\u7d22\u3001\u62c9\u53d6\u4efb\u4f55\u9700\u8981\u7684\u955c\u50cf\uff0c\u5e76\u5728\u4e0a\u9762\u90e8\u7f72\u5e94\u7528\uff0c\u540c\u65f6\u4e5f\u80fd\u5f88\u597d\u5730\u5207\u6362\u5230\u547d\u4ee4\u884c\u6a21\u5f0f\u3002\u76ee\u524d\u5305\u62ec\u81ea\u52a8\u6620\u5c04\u7aef\u53e3\u3001\u53ef\u89c6\u5316\u66f4\u6539\u73af\u5883\u53d8\u91cf\u3001\u914d\u7f6e\u5377\u3001\u6d41\u5f0f\u65e5\u5fd7\u7b49\u529f\u80fd\u3002</p> <p>\u5982\u679c\u5b89\u88c5\u5b8c\u6210\u540e\u65e0\u6cd5\u6253\u5f00\uff0c\u53ef\u4ee5\u5c06Kitematic\u5b89\u88c5\u540e\u7684\u6587\u4ef6\u8fc1\u79fb\u5230Docker\u6307\u5b9a\u76ee\u5f55<code>\u201cC:\\Program Files\\Docker\\Kitematic\u201d\u3002</code></p> <p>Kitematic\u662f\u5f00\u6e90\u7684\uff0c\u5982\u679c\u5927\u5bb6\u6709\u5174\u8da3\uff0c\u53ef\u4ee5\u8bbf\u95ee\u5176\u5f00\u6e90\u5e93\u4e0b\u8f7d\u5168\u90e8\u6e90\u4ee3\u7801\u8fdb\u884c\u7814\u7a76\uff0c\u4e0b\u8f7d\u5730\u5740\u4e3ahttps://github.com/docker/kitematic\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/","title":"4.\u4f01\u4e1a\u79c1\u6709\u4ed3\u5e93harbor","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/#1-\u4f01\u4e1a\u79c1\u6709\u4ed3\u5e93harbor\u90e8\u7f72","title":"1. \u4f01\u4e1a\u79c1\u6709\u4ed3\u5e93harbor\u90e8\u7f72","text":"<p>Harbor\u662f\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u548c\u5206\u53d1Docker\u955c\u50cf\u7684\u4f01\u4e1a\u7ea7registry\u670d\u52a1\u5668</p> <p>\u955c\u50cf\u5728docker distribution\uff08registry v2\u7248\u672c\uff09\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u5b89\u5168\u3001\u8bbf\u95ee\u63a7\u5236\u3001\u7ba1\u7406\u7684\u529f\u80fd\uff0c\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u5bf9\u4e8e\u955c\u50cf\u4ed3\u5e93\u7684\u9700\u6c42</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/#11-\u79bb\u7ebf\u90e8\u7f72harbor-v2","title":"1.1 \u79bb\u7ebf\u90e8\u7f72harbor v2","text":"<p>Harbor\u662f\u7531VMware\u516c\u53f8\u5f00\u6e90\u7684\u4f01\u4e1a\u7ea7\u7684Docker Registry\u7ba1\u7406\u9879\u76ee <pre><code>$ wget https://github.com/goharbor/harbor/releases/download/v2.4.2/harbor-online-installer-v2.4.2.tgz\n$ tar -zxf harbor-online-installer-v2.4.2.tgz\n$ diff harbor.yml harbor.yml.tmpl\n5c5\n&lt; hostname: hub.gitee.com\n---\n&gt; hostname: reg.mydomain.com\n10c10\n&lt;   port: 8080\n---\n&gt;   port: 80\n13c13\n&lt; #https:\n---\n&gt; https:\n15c15\n&lt;   #  port: 443\n---\n&gt;   port: 443\n17,18c17,18\n&lt;   #  certificate: /your/certificate/path\n&lt;   #  private_key: /your/private/key/path\n---\n&gt;   certificate: /your/certificate/path\n&gt;   private_key: /your/private/key/path\n29c29\n&lt; external_url: https://hub.gitee.com\n---\n&gt; # external_url: https://reg.mydomain.com:8433\n34c34\n&lt; harbor_admin_password: oschina123\n---\n&gt; harbor_admin_password: Harbor12345\n39c39\n&lt;   password: oschina\n---\n&gt;   password: root123\n47c47\n&lt; data_volume: /data/harbor\n---\n&gt; data_volume: /data\n</code></pre></p> <p>\u521b\u5efa\u6570\u636e\u6301\u4e45\u5316\u76ee\u5f55 <pre><code>$ mkdir -p /data/harbor\n</code></pre></p> <p>\u5f00\u59cb\u90e8\u7f72 <pre><code>$ sudo ./install.sh --with-chartmuseum\n</code></pre></p> <p>tips</p> <ul> <li>\u90e8\u7f72\u5b8c\u6210\u540e\u5982\u679c\u9700\u8981\u4fee\u6539 harbor.yml \uff0c\u9700\u8981\u5728\u4fee\u6539\u540e\u91cd\u65b0\u521d\u59cb\u5316\u914d\u7f6e\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a</li> </ul> <pre><code>$ docker-compose down -v\n$ vim harbor.yml\n$ sudo ./prepare --with-chartmuseum\n$ docker-compose up -d\n\n$ docker-compose ps\n      Name                     Command               State             Ports          --------------------------------------------------------------------------------------\nharbor-core         /harbor/harbor_core              Up                               harbor-db           /docker-entrypoint.sh            Up      5432/tcp                 harbor-jobservice   /harbor/harbor_jobservice  ...   Up                               harbor-log          /bin/sh -c /usr/local/bin/ ...   Up      127.0.0.1:1514-&gt;10514/tcp\nharbor-portal       nginx -g daemon off;             Up      8080/tcp                 nginx               nginx -g daemon off;             Up      0.0.0.0:9090-&gt;8080/tcp   redis               redis-server /etc/redis.conf     Up      6379/tcp                 registry            /entrypoint.sh /etc/regist ...   Up      5000/tcp                 registryctl         /harbor/start.sh                 Up      </code></pre> <p>Harbor \u9ed8\u8ba4\u7ba1\u7406\u5458\u7528\u6237\u4e3a admin \uff0c\u5bc6\u7801\u5728 harbor.cfg \u4e2d\u8bbe\u7f6e\u8fc7\uff0c\u9ed8\u8ba4\u7684\u662fHarbor12345</p> <p>Harbor\u521b\u5efa\u4e00\u4e2a\u767b\u9646\u7528\u6237\u3002\u6b64\u7528\u6237\u7528\u4e8e\u63a8\u9001\u955c\u50cf</p> <p></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/4.%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor/#12-\u6784\u5efa\u4f01\u4e1a\u7ea7\u955c\u50cf\u4ed3\u5e93","title":"1.2 \u6784\u5efa\u4f01\u4e1a\u7ea7\u955c\u50cf\u4ed3\u5e93","text":"<p>\u53c2\u8003\u6587\u732e\uff1a</p> <p>harbor\u5b89\u88c5\u4e0e\u90e8\u7f72</p> <p>harbor\u7684https\u90e8\u7f72</p> <p>docker\u4e0a\u4f20\u955c\u50cf\u5230harbor\u955c\u50cf\u4ed3\u5e93</p> <p>\u90e8\u7f72\u4f01\u4e1a\u7ea7\u79c1\u6709\u955c\u50cf\u4ed3\u5e93 Harbor</p> <p>Harbor \u9ad8\u53ef\u7528\u642d\u5efa(docker-compose)</p> <p>harbor \u6784\u5efa\u4f01\u4e1a\u7ea7\u955c\u50cf\u4ed3\u5e93</p> <p>\u5728\u672c\u5730\u5feb\u901f\u90e8\u7f72 harbor</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/","title":"5.Docker\u6570\u636e","text":"<p>\u5bb9\u5668\u4e2d\u7ba1\u7406\u6570\u636e\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>\u6570\u636e\u5377\uff08Data Volumes\uff09\uff1a\u5bb9\u5668\u5185\u6570\u636e\u76f4\u63a5\u6620\u5c04\u5230\u672c\u5730\u4e3b\u673a\u73af\u5883\uff1b </li> <li>\u6570\u636e\u5377\u5bb9\u5668\uff08Data Volume Containers\uff09\uff1a\u4f7f\u7528\u7279\u5b9a\u5bb9\u5668\u7ef4\u62a4\u6570\u636e\u5377\u3002   </li> </ul>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#1\u6570\u636e\u5377","title":"1.\u6570\u636e\u5377","text":"<p>\u6570\u636e\u5377\u662f\u4e00\u4e2a\u53ef\u4f9b\u5bb9\u5668\u4f7f\u7528\u7684\u7279\u6b8a\u76ee\u5f55\uff0c\u5b83\u5c06\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u76ee\u5f55\u76f4\u63a5\u6620\u5c04\u8fdb\u5bb9\u5668\uff0c\u7c7b\u4f3c\u4e8eLinux\u4e2d\u7684mount\u64cd\u4f5c\u3002</p> <p>\u6570\u636e\u5377\u53ef\u4ee5\u63d0\u4f9b\u5f88\u591a\u6709\u7528\u7684\u7279\u6027\uff0c\u5982\u4e0b\u6240\u793a\uff1a </p> <ul> <li>\u6570\u636e\u5377\u53ef\u4ee5\u5728\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u548c\u91cd\u7528\uff0c\u5bb9\u5668\u95f4\u4f20\u9012\u6570\u636e\u5c06\u53d8\u5f97\u9ad8\u6548\u65b9\u4fbf\uff1b </li> <li>\u5bf9\u6570\u636e\u5377\u5185\u6570\u636e\u7684\u4fee\u6539\u4f1a\u7acb\u9a6c\u751f\u6548\uff0c\u65e0\u8bba\u662f\u5bb9\u5668\u5185\u64cd\u4f5c\u8fd8\u662f\u672c\u5730\u64cd\u4f5c\uff1b </li> <li>\u5bf9\u6570\u636e\u5377\u7684\u66f4\u65b0\u4e0d\u4f1a\u5f71\u54cd\u955c\u50cf\uff0c\u89e3\u8026\u4e86\u5e94\u7528\u548c\u6570\u636e\uff1b </li> <li>\u5377\u4f1a\u4e00\u76f4\u5b58\u5728\uff0c\u76f4\u5230\u6ca1\u6709\u5bb9\u5668\u4f7f\u7528\uff0c\u53ef\u4ee5\u5b89\u5168\u5730\u5378\u8f7d\u5b83\u3002</li> </ul>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#11-\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377","title":"1.1 \u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377","text":"<pre><code># \u5728\u7528docker run\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u4f7f\u7528-v\u6807\u8bb0\u53ef\u4ee5\u5728\u5bb9\u5668\u5185\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377\u3002\n# \u591a\u6b21\u91cd\u590d\u4f7f\u7528-v\u6807\u8bb0\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u6570\u636e\u5377\u3002\u591a\u4e2a-v\u540c\u65f6\u53ef\u4ee5\u4f7f\u7528\n# \u5c06\u5bbf\u4e3b\u673a\u7684html\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\uff0c\u5b9e\u73b0\u4fee\u6539\u5bbf\u4e3b\u673a\u6587\u4ef6\uff0c\u5bb9\u5668index.html\u7f51\u9875\u4e5f\u4fee\u6539 \n# \u5b98\u7f51\u4e0b\u8f7dnginx\u955c\u50cf\ndocker pull nginx\n\n# \u521b\u5efa\u5bbf\u4e3b\u673a\u8981\u6302\u8f7d\u7684\u76ee\u5f55\nmkdir -p /home/soft/nginx/html\n\n$ docker run --name hu_nginx -d -p 8080:80 -v /home/soft/nginx/html/:/usr/share/nginx/html nginx\n34ed3bd8224c4307efbb9545f2e87545fdfc12380b2e84473712c6697b36ee6d\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES\n34ed3bd8224c        nginx               \"nginx -g 'daemon ...\"   6 seconds ago       Up 5 seconds        0.0.0.0:8080-&gt;80/tcp   hu_nginx\n\ncd /home/soft/nginx/html\necho \"testcd html/cd html/huajineli index\" &gt; index.html\n\n$ curl 127.0.0.1:8080\ntestcd html/cd html/huajineli index\n\n$ cat &gt;index.html&lt;&lt;EOF\n&gt; curl 127.0.0.1:8080\n&gt; &lt;html&gt;\n&gt; &lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;\n&gt; &lt;body&gt;\n&gt; &lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;\n&gt; &lt;hr&gt;&lt;center&gt;nginx/1.15.12&lt;/center&gt;\n&gt; &lt;/body&gt;\n&gt; &lt;/html&gt;\n&gt; test!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\nEOF\ncurl 127.0.0.1:8080 \u518d\u6b21\u67e5\u770b\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#12-\u6302\u8f7d\u4e3b\u673a\u76ee\u5f55\u4f5c\u4e3a\u6570\u636e\u5377","title":"1.2 \u6302\u8f7d\u4e3b\u673a\u76ee\u5f55\u4f5c\u4e3a\u6570\u636e\u5377","text":"<pre><code>$ docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py\n#\u4e0a\u9762\u7684\u547d\u4ee4\u52a0\u8f7d\u4e3b\u673a\u7684/src/webapp\u76ee\u5f55\u5230\u5bb9\u5668\u7684/opt/webapp\u76ee\u5f55\u3002\nDocker\u6302\u8f7d\u6570\u636e\u5377\u7684\u9ed8\u8ba4\u6743\u9650\u662f\u8bfb\u5199\uff08rw\uff09\uff0c\u7528\u6237\u4e5f\u53ef\u4ee5\u901a\u8fc7ro\u6307\u5b9a\u4e3a\u53ea\u8bfb\uff1a\n$ docker run -d -P --name web -v /src/webapp:/opt/webapp:ro training/webapp python app.py\ncc9bb6df41e1e44a7f701a2abcb4e901c4c216b1c542da6d8657abe055c3807c\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES\ncc9bb6df41e1        training/webapp     \"python app.py\"     5 seconds ago       Exited (2) 4 seconds ago                       web\n\n# \u52a0\u4e86\uff1aro\u4e4b\u540e\uff0c\u5bb9\u5668\u5185\u5bf9\u6240\u6302\u8f7d\u6570\u636e\u5377\u5185\u7684\u6570\u636e\u5c31\u65e0\u6cd5\u4fee\u6539\u4e86\u3002\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#13-\u6302\u8f7d\u672c\u5730\u4e3b\u673a\u6587\u4ef6\u4f5c\u4e3a\u6570\u636e\u5377","title":"1.3 \u6302\u8f7d\u672c\u5730\u4e3b\u673a\u6587\u4ef6\u4f5c\u4e3a\u6570\u636e\u5377","text":"<pre><code># -v\u6807\u8bb0\u4e5f\u53ef\u4ee5\u4ece\u4e3b\u673a\u6302\u8f7d\u5355\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\u4f5c\u4e3a\u6570\u636e\u5377\uff08\u4e0d\u63a8\u8350\uff09\u3002\n$ docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#2-\u6570\u636e\u5377\u5bb9\u5668","title":"2. \u6570\u636e\u5377\u5bb9\u5668","text":"<pre><code> # \u5982\u679c\u7528\u6237\u9700\u8981\u5728\u591a\u4e2a\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u4e00\u4e9b\u6301\u7eed\u66f4\u65b0\u7684\u6570\u636e\uff0c\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u4f7f\u7528\u6570\u636e\u5377\u5bb9\u5668\u3002\u6570\u636e\u5377\u5bb9\u5668\u4e5f\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u4f46\u662f\u5b83\u7684\u76ee\u7684\u662f\u4e13\u95e8\u7528\u6765\u63d0\u4f9b\u6570\u636e\u5377\u4f9b\u5176\u4ed6\u5bb9\u5668\u6302\u8f7d\u3002\n$ docker run -it -v /dbdata --name dbdata ubuntu\n\n$ ls\nbin  boot  dbdata  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n\n\u7136\u540e\uff0c\u53ef\u4ee5\u5728\u5176\u4ed6\u5bb9\u5668\u4e2d\u4f7f\u7528--volumes-from\u6765\u6302\u8f7ddbdata\u5bb9\u5668\u4e2d\u7684\u6570\u636e\u5377\uff0c\u4f8b\u5982\u521b\u5efadb1\u548cdb2\u4e24\u4e2a\u5bb9\u5668\uff0c\u5e76\u4ecedbdata\u5bb9\u5668\u6302\u8f7d\u6570\u636e\u5377\uff1a\n$ docker run -it --volumes-from dbdata --name db1 ubuntu\nroot@d3121e65cda2:/# exit\nexit\n[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker run -it --volumes-from dbdata --name db2 ubuntu\nroot@4efa5f74a404:/# exit\nexit\n#\u5728\u5bb9\u5668dbdata\u4e2d\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6\n$ docker start dbdata\ndbdata\n\n$ docker exec -it dbdata /bin/bash\n\nroot@462f17402bc3:/# cd /dbdata/\nroot@462f17402bc3:/dbdata# touch huajinli_text\n\n# \u542f\u52a8db1\u548cdb2\uff0c\u67e5\u770b/dbdata\u76ee\u5f55\u4e0b\u6587\u4ef6\u662f\u5426\u540c\u6b65\n$ docker start db1\ndb1\n\n$ docker start db2\ndb2\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n4efa5f74a404        ubuntu              \"/bin/bash\"         3 minutes ago       Up 2 seconds                            db2\nd3121e65cda2        ubuntu              \"/bin/bash\"         3 minutes ago       Up 3 seconds                            db1\n462f17402bc3        ubuntu              \"/bin/bash\"         6 minutes ago       Up About a minute                       dbdata\n\n#db1\u4e0a\u67e5\u770b\n$ docker exec -it db1 /bin/bash\nroot@d3121e65cda2:/# ll /dbdata/\ntotal 8\ndrwxr-xr-x 2 root root 4096 May 30 08:25 ./\ndrwxr-xr-x 1 root root 4096 May 30 08:23 ../\n-rw-r--r-- 1 root root    0 May 30 08:25 huajinli_text\n\n#db2\u4e0a\u67e5\u770b\n$ docker exec -it db2 /bin/bash\nroot@4efa5f74a404:/# ll /dbdata/\ntotal 8\ndrwxr-xr-x 2 root root 4096 May 30 08:25 ./\ndrwxr-xr-x 1 root root 4096 May 30 08:23 ../\n-rw-r--r-- 1 root root    0 May 30 08:25 huajinli_text\n\n\u6ce8\u610f: \u4f7f\u7528--volumes-from\u53c2\u6570\u6240\u6302\u8f7d\u6570\u636e\u5377\u7684\u5bb9\u5668\u81ea\u8eab\u5e76\u4e0d\u9700\u8981\u4fdd\u6301\u5728\u8fd0\u884c\u72b6\u6001\u3002\n#\u5982\u679c\u5220\u9664\u4e86\u6302\u8f7d\u7684\u5bb9\u5668\uff08\u5305\u62ecdbdata\u3001db1\u548cdb2\uff09\uff0c\u6570\u636e\u5377\u5e76\u4e0d\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\u3002\u5982\u679c\u8981\u5220\u9664\u4e00\u4e2a\u6570\u636e\u5377\uff0c\u5fc5\u987b\u5728\u5220\u9664\u6700\u540e\u4e00\u4e2a\u8fd8\u6302\u8f7d\u7740\u5b83\u7684\u5bb9\u5668\u65f6\u663e\u5f0f\u4f7f\u7528docker rm-v\u547d\u4ee4\u6765\u6307\u5b9a\u540c\u65f6\u5220\u9664\u5173\u8054\u7684\u5bb9\u5668\u3002\n$ docker rm db1\ndb1\n$ docker rm db2\ndb\n$ docker rm -v dbdata\ndbdata\n</code></pre> <p>\u6ce8\u610f </p> <p>\u4f7f\u7528--volumes-from\u53c2\u6570\u6240\u6302\u8f7d\u6570\u636e\u5377\u7684\u5bb9\u5668\u81ea\u8eab\u5e76\u4e0d\u9700\u8981\u4fdd\u6301\u5728\u8fd0\u884c\u72b6\u6001\u3002 \u5982\u679c\u5220\u9664\u4e86\u6302\u8f7d\u7684\u5bb9\u5668\uff08\u5305\u62ecdbdata\u3001db1\u548cdb2\uff09\uff0c\u6570\u636e\u5377\u5e76\u4e0d\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\u3002\u5982\u679c\u8981\u5220\u9664\u4e00\u4e2a\u6570\u636e\u5377\uff0c\u5fc5\u987b\u5728\u5220\u9664\u6700\u540e\u4e00\u4e2a\u8fd8\u6302\u8f7d\u7740\u5b83\u7684\u5bb9\u5668\u65f6\u663e\u5f0f\u4f7f\u7528docker rm-v\u547d\u4ee4\u6765\u6307\u5b9a\u540c\u65f6\u5220\u9664\u5173\u8054\u7684\u5bb9\u5668\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#3\u5229\u7528\u6570\u636e\u5377\u5bb9\u5668\u6765\u8fc1\u79fb\u6570\u636e","title":"3.\u5229\u7528\u6570\u636e\u5377\u5bb9\u5668\u6765\u8fc1\u79fb\u6570\u636e","text":"<p>\u5229\u7528\u6570\u636e\u5377\u5bb9\u5668\u6765\u5907\u4efd\u3001\u6062\u590d\u3001\u8fc1\u79fb\u6570\u636e\u5377</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#31-\u5907\u4efd","title":"3.1 \u5907\u4efd","text":"<pre><code>#\u4f7f\u7528  --volumes-from  \u6807\u8bb0\u6765\u521b\u5efa\u4e00\u4e2a\u52a0\u8f7d dbdata\u5bb9\u5668\u5377\u7684\u5bb9\u5668\uff0c\u5e76\u4ece\u4e3b\u673a\u6302\u8f7d\u5f53\u524d\u76ee\u5f55\u5230\u5bb9\u5668\u7684/backup\u76ee\u5f55\nsudo docker run --volumes-from dbdata -v $(pwd):/backup ubuntu tar cvf /backup/backup.tar /dbdata\n\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u4f7f\u7528\u4e86tar\u547d\u4ee4\u6765\u5c06 dbdata \u5377\u5907\u4efd\u4e3a\u5bb9\u5668\u4e2d /backup/backup.tar\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u540d\u4e3abackup.tar\u7684\u6587\u4ef6\u3002\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#32-\u6062\u590d","title":"3.2 \u6062\u590d","text":"<pre><code>#\u5982\u679c\u8981\u6062\u590d\u6570\u636e\u5230\u4e00\u4e2a\u5bb9\u5668\uff0c\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u5e26\u6709\u7a7a\u6570\u636e\u5377\u7684\u5bb9\u5668 dbdata2\u3002\nsudo docker run -v /dbdata --name dbdata2 ubuntu /bin/bash\n\n#\u7136\u540e\u521b\u5efa\u53e6\u4e00\u4e2a\u5bb9\u5668\uff0c\u6302\u8f7d dbdata2 \u5bb9\u5668\u5377\u4e2d\u7684\u6570\u636e\u5377\uff0c\u5e76\u4f7f\u7528  untar  \u89e3\u538b\u5907\u4efd\u6587\u4ef6\u5230\u6302\u8f7d\u7684\u5bb9\u5668\u5377\u4e2d\u3002\nsudo docker run --volumes-from dbdata2 -v $(pwd):/backup busybox tar xvf /backup/backup.tar\n\n#\u4e3a\u4e86\u67e5\u770b/\u9a8c\u8bc1\u6062\u590d\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u518d\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u6302\u8f7d\u540c\u6837\u7684\u5bb9\u5668\u5377\u6765\u67e5\u770b\nsudo docker run --volumes-from dbdata2 busybox /bin/ls /dbdata\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#4\u5bb9\u5668\u8fde\u63a5","title":"4.\u5bb9\u5668\u8fde\u63a5","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#41-\u5bb9\u5668\u547d\u540d","title":"4.1 \u5bb9\u5668\u547d\u540d","text":"<p>\u5bb9\u5668\u8fde\u63a5\u4f9d\u8d56\u4e8e\u5bb9\u5668\u540d\uff0c\u6240\u4ee5\u5f53\u9700\u8981\u4f7f\u7528\u5bb9\u5668\u8fde\u63a5\u65f6\uff0c\u9996\u5148\u9700\u8981\u547d\u540d\u5bb9\u5668\uff0c\u7136\u540e\u4f7f\u7528 --link \u53c2\u6570\u8fdb\u884c\u8fde\u63a5\u3002</p> <p>\u5bb9\u5668\u547d\u540d\u7684\u597d\u5904\uff1a</p> <ol> <li> <p>\u4e00\u4e2a\u6709\u610f\u4e49\u7684\u540d\u5b57\u80fd\u591f\u8868\u660e\u8be5\u5bb9\u5668\u7684\u7528\u9014\uff0c\u8fd9\u6837\u65b9\u4fbf\u8bb0\u5fc6</p> </li> <li> <p>\u547d\u540d\u540e\u7684\u5bb9\u5668\u5728\u5bb9\u5668\u8fde\u63a5\u4e2d\u80fd\u591f\u6e05\u6670\u5730\u8868\u5f81\u5bb9\u5668\u4e4b\u95f4\u7684\u903b\u8f91\u4f9d\u8d56\u5173\u7cfb\u3002</p> </li> </ol> <p>\u901a\u8fc7 --name \u53c2\u6570\u6765\u547d\u540d\u5bb9\u5668\uff0c\u5177\u4f53\u64cd\u4f5c\u4e3a\uff1a <pre><code>$ docker run -d -P --name web training/webapp python app.py\n</code></pre></p> <p>\u67e5\u770b\u5bb9\u5668\u8fd0\u884c\u72b6\u51b5 <pre><code>$ docker ps -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES\n76a4b3be32dd        training/webapp     \"python app.py\"     45 seconds ago      Up 44 seconds       0.0.0.0:32768-&gt;5000/tcp   web\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u7684 webapp \u5bb9\u5668\u5df2\u7ecf\u5df2\u7ecf\u8fd0\u884c\u8d77\u6765\u4e86</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/5.Docker%E6%95%B0%E6%8D%AE/#42-\u5bb9\u5668\u8fde\u63a5","title":"4.2 \u5bb9\u5668\u8fde\u63a5","text":"<p>\u8fde\u63a5\u7684\u683c\u5f0f\u4e3a --link name:alias \uff0c\u5176\u4e2d name \u662f\u6e90\u5bb9\u5668\u7684\u540d\u79f0\uff0c alias \u662f\u8fd9\u4e2a\u8fde\u63a5\u7684\u522b\u540d.</p> <p>\u4e3e\u4f8b\uff1a<code>web\u5bb9\u5668+dbdata\u5bb9\u5668\u8fde\u63a5\u4e92\u8054</code></p> <p>\u9996\u5148\uff0c\u5efa\u7acb\u4e00\u4e2a\u6570\u636e\u5e93\u5bb9\u5668 dbdata \uff0c\u76f8\u5173\u64cd\u4f5c\u4e3a\uff1a <pre><code>$ docker run -d --name dbdata training/postgres\n</code></pre> \u7136\u540e\uff0c\u5efa\u7acb\u4e00\u4e2aWeb\u5bb9\u5668 web \uff0c\u5c06\u5176\u8fde\u63a5\u5230 dbdata \u5bb9\u5668\uff0c\u5177\u4f53\u64cd\u4f5c\u4e3a\uff1a <pre><code>$ docker run -d -P --name web --link dbdata:db training/webapp python app.py\n</code></pre></p> <p>\u901a\u8fc7 docker inpsect \u547d\u4ee4\uff0c\u770b\u5230\u548c\u8fde\u63a5\u76f8\u5173\u7684\u5b57\u6bb5 <pre><code>$ docker inspect web\n            \"Links\": [\n\"/dbdata:/web/db\"\n],\n</code></pre></p> <p>Docker\u7ed9\u76ee\u6807\u5bb9\u5668\u63d0\u4f9b\u4e86\u5982\u4e0b\u4e24\u79cd\u65b9\u5f0f\u6765\u66b4\u9732\u8fde\u63a5\u63d0\u4f9b\u7684\u670d\u52a1\uff1a</p> <ul> <li> <p>\u73af\u5883\u53d8\u91cf\uff1b</p> </li> <li> <p>/etc/hosts\u6587\u4ef6\u3002</p> </li> </ul> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528 env \u547d\u4ee4\u6765\u67e5\u770b\u4e00\u4e2a\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\uff0c\u76f8\u5173\u4ee3\u7801\u4e3a\uff1a <pre><code>$ docker run --rm --name web2 --link dbdata:webdb training/webapp env\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nHOSTNAME=8b8f0f64203b\nWEBDB_PORT=tcp://172.17.0.2:5432\nWEBDB_PORT_5432_TCP=tcp://172.17.0.2:5432\nWEBDB_PORT_5432_TCP_ADDR=172.17.0.2\nWEBDB_PORT_5432_TCP_PORT=5432\nWEBDB_PORT_5432_TCP_PROTO=tcp\nWEBDB_NAME=/web2/webdb\nWEBDB_ENV_PG_VERSION=9.3\nHOME=/root\n</code></pre></p> <p>\u67e5\u770b\u76ee\u6807\u5bb9\u5668\u7684/etc/hosts\u914d\u7f6e\u6587\u4ef6\uff0c\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <pre><code>$ docker run -i -t --rm --name web2 --link dbdata:webdb training/webapp /bin/bash\nroot@84e1a7665c8f:/opt/webapp# cat /etc/hosts\n127.0.0.1   localhost\n::1 localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n172.17.0.2  webdb 28d40188220d dbdata\n172.17.0.4  84e1a7665c8f\n</code></pre> <p>\u5bb9\u5668\u8fde\u63a5 webdb \u5bf9\u5e94\u7684\u5730\u5740\u4e3a 172.17.0.2,\u8be5\u5730\u5740\u5b9e\u4e3a dbdata \u5bb9\u5668\u7684\u5730\u5740\uff0c\u5bb9\u5668\u5bf9webdb \u8fde\u63a5\u7684\u64cd\u4f5c\u5c06\u4f1a\u6620\u5c04\u5230\u8be5\u5730\u5740\u4e0a\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/","title":"6.Docker\u7f51\u7edc","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#1\u5355\u4e3b\u673adocker\u7f51\u7edc\u901a\u4fe1","title":"1.\u5355\u4e3b\u673aDocker\u7f51\u7edc\u901a\u4fe1","text":"<p>\u6211\u4eec\u5728\u4f7f\u7528docker run\u521b\u5efadocker\u5bb9\u5668\u65f6\uff0c\u53ef\u4ee5\u7528--net\u9009\u9879\u6307\u5b9a\u5bb9\u5668\u7684\u7f51\u7edc\u6a21\u5f0f\u3002Docker\u6709\u4ee5\u4e0b4\u4e2d\u7f51\u7edc\u6a21\u5f0f\uff1a</p> <ol> <li>host\u6a21\u5f0f\uff1a\u4f7f\u7528--net=host\u6307\u5b9a\uff0c\u4e0d\u652f\u6301\u591a\u4e3b\u673a</li> <li>container\u6a21\u5f0f\uff1a\u4f7f\u7528--net=container\uff1aNAME_or_ID\u6307\u5b9a\uff0c\u4e0d\u652f\u6301\u591a\u4e3b\u673a</li> <li>none\u6a21\u5f0f\uff1a\u4f7f\u7528--net=none\u6307\u5b9a\uff0c\u4e0d\u652f\u6301\u591a\u4e3b\u673a</li> <li>bridge\u6a21\u5f0f\uff1a\u4f7f\u7528--net=bridge\u6307\u5b9a\uff0c\u4e0d\u652f\u6301\u591a\u4e3b\u673a\uff0c\u9ed8\u8ba4\u6a21\u5f0f</li> </ol>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#11-host\u6a21\u5f0f","title":"1.1 host\u6a21\u5f0f","text":"<p>\u5bb9\u5668\u4e0d\u4f1a\u865a\u62df\u76f4\u63a5\u7684\u7f51\u5361\u3001\u914d\u7f6e\u76f4\u63a5\u7684IP\u7b49\uff0c\u4f7f\u7528\u5bbf\u4e3b\u673a\u7684IP\u548c\u7aef\u53e3\u3002</p> <p>\u5728\u5bb9\u5668\u4e2d\u6267\u884cifconfig\u547d\u4ee4\u67e5\u770b\u7f51\u7edc\u73af\u5883\u65f6\uff0c\u663e\u793a\u7684\u90fd\u662f\u5bbf\u4e3b\u673a\u7684\u4fe1\u606f\u3002</p> <p>Host\u6a21\u5f0f\u4e0b\u7684\u7f51\u7edc\u7a7a\u95f4\u4e0e\u5bbf\u4e3b\u673a\u76f8\u540c\uff0c\u6587\u4ef6\u7cfb\u7edf\u3001\u8fdb\u7a0b\u5217\u8868\u7b49\u548c\u5bbf\u4e3b\u673a\u9694\u79bb\u3002</p> <p><code>host\u6a21\u5f0f</code></p> <p></p> <pre><code># docker run -tid --net=host --name dockerhost1 ubantu\n\n# docker run -tid --net=host --name dockerhost2 ubantu\n# docker exec -it dockerhost1 /bin/bash\n# docker exec -it dockerhost2 /bin/bash\n# ifconfig -a\n# route -n\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#12-container\u6a21\u5f0f","title":"1.2 Container\u6a21\u5f0f","text":"<p>Container\u6a21\u5f0f\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u7f51\u7edc\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u4e0b\u7684\u5bb9\u5668\u4f7f\u7528\u5176\u4ed6\u5bb9\u5668\u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff0c\u9694\u79bb\u6027\u5904\u4e8ebridge\u6a21\u5f0f\u4e0eHost\u6a21\u5f0f\u4e4b\u95f4\u3002</p> <p>Container\u6a21\u5f0f\u7684\u5bb9\u5668\u53ef\u4ee5\u901a\u8fc7localhost\u6765\u4e0e\u540c\u4e00\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u5176\u4ed6\u5bb9\u5668\u901a\u4fe1\uff0c\u4f20\u8f93\u6548\u7387\u9ad8\uff0c\u53ef\u4ee5\u8282\u7ea6\u4e00\u5b9a\u6570\u91cf\u7684\u7f51\u7edc\u8d44\u6e90\uff0c\u4f46\u6ca1\u6709\u6539\u53d8\u5bb9\u5668\u4e0e\u5916\u754c\u7684\u901a\u4fe1\u65b9\u5f0f\u3002</p> <p>Kubernetes\u4e0b\u7684Pod\u4e2d\u7684\u5bb9\u5668\u4e0e\u5176\u4ed6\u5bb9\u5668\u90fd\u4ee5Container\u6a21\u5f0f\u5171\u4eab\u8fd9\u4e2a\u57fa\u7840\u8bbe\u65bd\u5bb9\u5668\u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff0c\u4e92\u76f8\u4ee5localhost\u8bbf\u95ee\uff0c\u6784\u6210\u4e00\u4e2a\u7edf\u4e00\u7684\u6574\u4f53\u3002</p> <p></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#13-none\u6a21\u5f0f","title":"1.3 None\u6a21\u5f0f","text":"<p>None\u6a21\u5f0fdocker\u5bb9\u5668\u62e5\u6709\u81ea\u5df1\u7684Network Namespace\u7a7a\u95f4\uff0c\u4f46\u5e76\u4e0d\u4e3aDocker\u5bb9\u5668\u8fdb\u884c\u7f51\u7edc\u914d\u7f6e\uff0c\u4e5f\u5c31\u662f\u8bf4Docker\u5bb9\u5668\u6ca1\u6709\u7f51\u5361\u3001IP\u3001\u8def\u7531\u7b49\u4fe1\u606f\uff0c\u9700\u8981\u7528\u6237\u4e3aDocker\u5bb9\u5668\u6dfb\u52a0\u7f51\u5361\u3001\u914d\u7f6eIP\u3002</p> <p></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#14-bridge\u6a21\u5f0f","title":"1.4 Bridge\u6a21\u5f0f","text":"<p>Bridge\u6a21\u5f0f\u662fDocker\u9ed8\u8ba4\u7684\u7f51\u7edc\u6a21\u5f0f\uff0c\u4e5f\u662f\u5f00\u53d1\u5e38\u4f7f\u7528\u7684\u7f51\u7edc\u6a21\u5f0f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0cdocker\u4e3a\u5bb9\u5668\u521b\u5efa\u72ec\u7acb\u7684\u7f51\u7edc\u6808\uff0c\u4fdd\u8bc1\u5bb9\u5668\u5185\u7684\u8fdb\u7a0b\u4f7f\u7528\u72ec\u7acb\u7684\u7f51\u7edc\u73af\u5883\uff0c\u5b9e\u73b0\u5bb9\u5668\u4e4b\u95f4\u3001\u5bb9\u5668\u4e0e\u5bbf\u4e3b\u673a\u4e4b\u95f4\u7684\u7f51\u7edc\u6808\u9694\u79bb\u3002</p> <p>\u901a\u8fc7\u5bbf\u4e3b\u673a\u7684Docker0\u7f51\u6865\uff0c\u5bb9\u5668\u53ef\u4ee5\u4e0e\u5bbf\u4e3b\u673a\u4e43\u81f3\u5916\u754c\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u3002</p> <p></p> <p>\u5e38\u89c1\u7684\u5c31\u662f\u4f7f\u7528NAT\uff0c\u5c06\u5bbf\u4e3b\u673a\u7684\u7aef\u53e3\u6d41\u91cf\u8f6c\u53d1\u5230\u5bb9\u5668\u7aef\u53e3\u4e0a\uff0c\u8fd9\u6837\u5916\u754c\u5c31\u53ef\u4ee5\u4e0e\u5bb9\u5668\u4e2d\u7684\u8fdb\u7a0b\u8fdb\u884c\u901a\u4fe1\u4e86\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#2\u5916\u90e8\u8bbf\u95ee\u7f51\u7edc","title":"2.\u5916\u90e8\u8bbf\u95ee\u7f51\u7edc","text":"<pre><code>#\u5bb9\u5668\u4e2d\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e9b\u7f51\u7edc\u5e94\u7528\uff0c\u8981\u8ba9\u5916\u90e8\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e9b\u5e94\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7  -P  \u6216-p  \u53c2\u6570\u6765\u6307\u5b9a\u7aef\u53e3\u6620\u5c04\n-P \u6807\u8bb0\u65f6\uff0cDocker \u4f1a\u968f\u673a\u6620\u5c04\u4e00\u4e2a  49000~49900  \u7684\u7aef\u53e3\u5230\u5185\u90e8\u5bb9\u5668\u5f00\u653e\u7684\u7f51\u7edc\u7aef\u53e3\n -p\uff08\u5c0f\u5199\u7684\uff09\u5219\u53ef\u4ee5\u6307\u5b9a\u8981\u6620\u5c04\u7684\u7aef\u53e3\uff0c\u5e76\u4e14\uff0c\u5728\u4e00\u4e2a\u6307\u5b9a\u7aef\u53e3\u4e0a\u53ea\u53ef\u4ee5\u7ed1\u5b9a\u4e00\u4e2a\u5bb9\u5668\u3002\u652f\u6301\u7684\u683c\u5f0f\u5982\u4e0b\uff1a\n    ip:hostPort:containerPort ip::containerPort hostPort:containerPort </code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#21-\u4f7f\u7528-p-\u6620\u5c04\u5230\u672c\u5730\u7684\u968f\u673a\u7aef\u53e3","title":"2.1 \u4f7f\u7528-P \u6620\u5c04\u5230\u672c\u5730\u7684\u968f\u673a\u7aef\u53e3","text":"<pre><code>#\u4e3e\u4f8b\n[root@bogon backup]# sudo docker run -d -P training/webapp python app.py\n[root@bogon backup]# docker ps -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES\n970c816ffcec        training/webapp     \"python app.py\"     3 minutes ago       Up 3 minutes        0.0.0.0:32768-&gt;5000/tcp   clever_thompson\n\n[root@bogon backup]# curl http://127.0.0.1:32768\nHello world!\n\n#\u4f7f\u7528docker logs\u67e5\u770b\u5e94\u7528\u4fe1\u606f\n[root@bogdocker logs  clever_thompson\n * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)\n172.17.0.1 - - [31/May/2019 02:15:23] \"GET / HTTP/1.1\" 200 -\n192.168.20.107 - - [31/May/2019 02:15:39] \"GET / HTTP/1.1\" 200 -\n192.168.20.107 - - [31/May/2019 02:15:39] \"GET /favicon.ico HTTP/1.1\" 404 -\n\n#tail -f\u7c7b\u4f3c\uff0c\u52a8\u6001\u67e5\u770b\u5bb9\u5668\u4fe1\u606f\n[root@bogon backup]# docker logs -f clever_thompson\n* Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)\n172.17.0.1 - - [31/May/2019 02:15:23] \"GET / HTTP/1.1\" 200 -\n192.168.20.107 - - [31/May/2019 02:15:39] \"GET / HTTP/1.1\" 200 -\n192.168.20.107 - - [31/May/2019 02:15:39] \"GET /favicon.ico HTTP/1.1\" 404 -\n192.168.20.107 - - [31/May/2019 02:16:51] \"GET / HTTP/1.1\" 200 -\n192.168.20.107 - - [31/May/2019 02:16:51] \"GET / HTTP/1.1\" 200 -\n192.168.20.107 - - [31/May/2019 02:16:51] \"GET / HTTP/1.1\" 200 -\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#22-\u6620\u5c04\u6240\u6709\u63a5\u53e3\u5730\u5740","title":"2.2 \u6620\u5c04\u6240\u6709\u63a5\u53e3\u5730\u5740","text":"<pre><code>\u683c\u5f0f\uff1ahostPort:containerPort # \u9ed8\u8ba4\u4f1a\u7ed1\u5b9a\u672c\u5730\u6240\u6709\u63a5\u53e3\u4e0a\u7684\u6240\u6709\u5730\u5740\n[root@bogon backup]# docker run -d -p 5000:5000 training/webapp python app.py\n98867d4e72ed8004bf6f9cae6861db4fa096ecc417a146e016401622e6b3b4b2\n\n[root@bogon backup]# docker ps -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES\n98867d4e72ed        training/webapp     \"python app.py\"     6 seconds ago       Up 5 seconds        0.0.0.0:5000-&gt;5000/tcp   mystifying_beaver\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#23-\u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u6307\u5b9a\u7aef\u53e3","title":"2.3 \u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u6307\u5b9a\u7aef\u53e3","text":"<pre><code>\u683c\u5f0f\uff1aip:hostPort:containerPort # \u53ef\u4ee5\u4f7f\u7528  ip:hostPort:containerPort  \u683c\u5f0f\u6307\u5b9a\u6620\u5c04\u4f7f\u7528\u4e00\u4e2a\u7279\u5b9a\u5730\u5740\uff0c\u6bd4\u5982localhost \u5730\u5740 127.0.0.1\n[root@bogon backup]# docker run -d -p 127.0.0.1:5000:5000 training/webapp python app.py\nf76317ec76a468bac94c27f5ce43dedc6e63529ae4d925bb9d6d203cf616c3af\n\n[root@bogon backup]# docker ps -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                      NAMES\nf76317ec76a4        training/webapp     \"python app.py\"     7 seconds ago       Up 6 seconds        127.0.0.1:5000-&gt;5000/tcp   vigilant_franklin\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#24-\u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u4efb\u610f\u7aef\u53e3","title":"2.4 \u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u4efb\u610f\u7aef\u53e3","text":"<pre><code>\u683c\u5f0f\uff1aip::containerPort #\u4f7f\u7528  ip::containerPort  \u7ed1\u5b9a localhost \u7684\u4efb\u610f\u7aef\u53e3\u5230\u5bb9\u5668\u7684 5000 \u7aef\u53e3\uff0c\u672c\u5730\u4e3b\u673a\u4f1a\u81ea\u52a8\u5206\u914d\u4e00\u4e2a\u7aef\u53e3\u3002\n[root@bogon backup]# docker run -d -p 127.0.0.1::5000 training/webapp python app.py\n4178c69e0fd8ec6f5dbcf5c0af9e6faaf23f917a0aca529a9c35ab6b04aeff4e\n[root@bogon backup]# docker ps -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                       NAMES\n4178c69e0fd8        training/webapp     \"python app.py\"     4 seconds ago       Up 3 seconds        127.0.0.1:32768-&gt;5000/tcp   eloquent_noether\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#25-\u6307\u5b9audp\u7aef\u53e3","title":"2.5 \u6307\u5b9audp\u7aef\u53e3","text":"<pre><code>[root@bogon backup]# docker run -d -p 5000:5000/udp training/webapp python app.py\n26bea2dd7daeb783a55750e07c422162b3e8d9a93eca0a9f13dca60788f1a32c\n\n[root@bogon backup]# docker ps -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                              NAMES\n26bea2dd7dae        training/webapp     \"python app.py\"     4 seconds ago       Up 3 seconds        5000/tcp, 0.0.0.0:5000-&gt;5000/udp   fervent_zhukovsky\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#26-\u67e5\u770b\u6620\u5c04\u7aef\u53e3\u914d\u7f6e","title":"2.6 \u67e5\u770b\u6620\u5c04\u7aef\u53e3\u914d\u7f6e","text":"<pre><code>[root@bogon backup]# docker port 26bea 5000/udp\n0.0.0.0:5000\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#27-\u7ed1\u5b9a\u591a\u4e2a\u7aef\u53e3","title":"2.7 \u7ed1\u5b9a\u591a\u4e2a\u7aef\u53e3","text":"<pre><code>[root@bogon backup]# sudo docker run -d -p 5000:5000 -p 3000:80 training/webapp python app.py\nda7164cb26582f37fe54be941d7fe90bde039b2c53946f105ae77123f700890a\n\n[root@bogon backup]# docker ps -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                                          NAMES\nda7164cb2658        training/webapp     \"python app.py\"     4 seconds ago       Up 3 seconds        0.0.0.0:5000-&gt;5000/tcp, 0.0.0.0:3000-&gt;80/tcp   serene_dhawan\n[root@bogon backup]#\n</code></pre> <p>\u63d0\u793a \u5bb9\u5668\u6709\u81ea\u5df1\u7684\u5185\u90e8\u7f51\u7edc\u548cIP\u5730\u5740\uff0c\u4f7f\u7528docker[container]inspect+\u5bb9\u5668ID\u53ef\u4ee5\u83b7\u53d6\u5bb9\u5668\u7684\u5177\u4f53\u4fe1\u606f\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#3\u5bb9\u5668\u4e92\u8054","title":"3.\u5bb9\u5668\u4e92\u8054","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#31-\u81ea\u5b9a\u4e49\u5bb9\u5668\u547d\u540d","title":"3.1 \u81ea\u5b9a\u4e49\u5bb9\u5668\u547d\u540d","text":"<pre><code>\u81ea\u5b9a\u4e49\u547d\u540d\u5bb9\u5668\u67092\u4e2a\u597d\u5904:\n    1.\u81ea\u5df1\u597d\u8bb0\n    2.\u8fde\u63a5\u5176\u4ed6\u5bb9\u5668\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u8003\u70b9\uff0c\u6bd4\u5982web\u5bb9\u5668\u8fde\u63a5\u5230db\u5bb9\u5668\n\n\u4f7f\u7528  --name  \u6807\u8bb0\u53ef\u4ee5\u4e3a\u5bb9\u5668\u81ea\u5b9a\u4e49\u547d\u540d.\n[root@bogon backup]# docker run -d -p 5000:5000 --name web training/webapp python app.py\n5e5578cfd316f6b7c557168578618e90503bedab7a21decb8d8087364686ae3a\n\n[root@bogon backup]# docker ps -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES\n5e5578cfd316        training/webapp     \"python app.py\"     4 seconds ago       Up 3 seconds        0.0.0.0:5000-&gt;5000/tcp   web\n\n#\u53ef\u4ee5\u4f7f\u7528docker inspect\u6765\u67e5\u770b\u5bb9\u5668\u7684\u540d\u5b57\n[root@bogon backup]# sudo docker inspect -f \"{{ .Name }}\" 5e5578c\n/web\n### \u6ce8\u610f\uff1a\u5bb9\u5668\u7684\u540d\u5b57\u662f\u552f\u4e00\u7684\uff0c\u5982\u679c\u540d\u79f0\u88ab\u5b9a\u4e49\u4e86\uff0c\u8981\u518d\u6b21\u4f7f\u7528\u9700\u5148docker rm\u6389\u4e4b\u524d\u521b\u5efa\u7684\u540c\u540d\u5bb9\u5668\n# \u4e0b\u8f7d\u4e00\u4e2a\u6570\u636e\u5e93\u5e76\u547d\u540d\u4e3adb\nsudo docker run -d --name db training/postgres\n\n### docker run  \u7684\u65f6\u5019\u5982\u679c\u6dfb\u52a0  --rm  \u6807\u8bb0\uff0c\u5219\u5bb9\u5668\u5728\u7ec8\u6b62\u540e\u4f1a\u7acb\u523b\u5220\u9664\u3002\u6ce8\u610f\uff0c--rm \u548c -d \u53c2\u6570\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\n# \u4e0b\u8f7d\u4e00\u4e2aweb\uff0c\u5c06web\u548cdb\u8fdb\u884c\u5173\u8054\n[root@bogon backup]# docker run --rm --name web2 --link db:db training/webapp\n* Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)\n^C[root@bogon backup]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS                     NAMES\nc9dbe104b1a7        training/webapp     \"python app.py\"          6 minutes ago       Up 6 minutes                  0.0.0.0:32769-&gt;5000/tcp   web\n761b5c162cc6        training/postgres   \"su postgres -c '/us\u2026\"   8 minutes ago       Up 8 minutes                  5432/tcp                  db\n26bea2dd7dae        training/webapp     \"python app.py\"          45 minutes ago      Exited (137) 41 minutes ago                             fervent_zhukovsky\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/6.Docker%E7%BD%91%E7%BB%9C/#32-\u5bb9\u5668\u4e92\u8054","title":"3.2 \u5bb9\u5668\u4e92\u8054","text":"<pre><code># \u4f7f\u7528--link\u53c2\u6570\u53ef\u4ee5\u8ba9\u5bb9\u5668\u4e4b\u95f4\u5b89\u5168\u7684\u8fdb\u884c\u4ea4\u4e92\u3002\n\u5148\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u5e93\u5bb9\u5668\u3002\n[root@bogon backup]# docker run -d --name db training/postgres\n# \u5f3a\u5236\u5220\u9664\u8fd0\u884c\u4e2d\uff0c\u4e4b\u524d\u7684web\u5bb9\u5668\n[root@bogon backup]# docker rm -f web\nweb\n\n#\u7136\u540e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 web \u5bb9\u5668\uff0c\u5e76\u5c06\u5b83\u8fde\u63a5\u5230 db \u5bb9\u5668\n[root@bogon backup]# docker run -d -P --name web --link db:db training/webapp python app.py\nc9dbe104b1a7955b7c957e07c70f98fd23913e1db95ecf219378c637845360f2\n\n#\u4f7f\u7528docker ps\u6765\u67e5\u770b\u5bb9\u5668\u7684\u8fde\u63a5\n[root@bogon backup]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES\nc9dbe104b1a7        training/webapp     \"python app.py\"          27 seconds ago      Up 25 seconds       0.0.0.0:32769-&gt;5000/tcp   web\n761b5c162cc6        training/postgres   \"su postgres -c '/us\u2026\"   2 minutes ago       Up 2 minutes        5432/tcp                  db\n</code></pre> <p>Docker\u901a\u8fc72\u79cd\u65b9\u5f0f\u4e3a\u5bb9\u5668\u516c\u5f00\u8fde\u63a5\u4fe1\u606f</p> <ol> <li> <p>\u73af\u5883\u53d8\u91cf</p> </li> <li> <p>\u66f4\u65b0/etc/hosts \u6587\u4ef6</p> </li> </ol> <p>\u4f7f\u7528env\u547d\u4ee4\u67e5\u770bweb\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf </p> <pre><code>#\u4f7f\u7528 env \u547d\u4ee4\u6765\u67e5\u770b web \u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\n[root@bogon backup]# docker run --rm --name web2 --link db:db training/webapp env\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nHOSTNAME=bb6b5ac2dfe8\nDB_PORT=tcp://172.17.0.3:5432\nDB_PORT_5432_TCP=tcp://172.17.0.3:5432\nDB_PORT_5432_TCP_ADDR=172.17.0.3\nDB_PORT_5432_TCP_PORT=5432\nDB_PORT_5432_TCP_PROTO=tcp\nDB_NAME=/web2/db\nDB_ENV_PG_VERSION=9.3\nHOME=/root\n\n# \u5176\u4e2dDB_\u5f00\u5934\u7684\u73af\u5883\u53d8\u91cf\u662f\u4f9bweb\u5bb9\u5668\u8fde\u63a5db\u5bb9\u5668\u4f7f\u7528,\u524d\u7f00\u91c7\u7528\u5927\u5199\u7684\u8fde\u63a5\u522b\u540d\n</code></pre> <p>\u67e5\u770b\u7236\u5bb9\u5668\u7684/etc/hosts\u7684\u6587\u4ef6</p> <pre><code>sudo docker run -it --rm --link db:db training/webapp /bin/bash\n\n#\u67092\u4e2ahosts\uff0c\u7b2c\u4e00\u4e2a\u662fweb\u5bb9\u5668\uff0cweb\u5bb9\u5668\u7528id\u4f5c\u4e3a\u4ed6\u7684\u4e3b\u673a\u540d,\u7b2c\u4e8c\u4e2a\u662fdb\u5bb9\u5668\u7684ip\u548c\u4e3b\u673a\u540d\nroot@3ff92a05fd63:/opt/webapp# cat /etc/hosts\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n172.17.0.3      db 761b5c162cc6\n172.17.0.4      3ff92a05fd63\n\nroot@3ff92a05fd63:/opt/webapp# ping 172.17.0.3\nPING 172.17.0.3 (172.17.0.3) 56(84) bytes of data.\n64 bytes from 172.17.0.3: icmp_seq=1 ttl=64 time=0.178 ms\n64 bytes from 172.17.0.3: icmp_seq=2 ttl=64 time=0.058 ms\n64 bytes from 172.17.0.3: icmp_seq=3 ttl=64 time=0.069 ms\n\n#\u7528\u6237\u53ef\u4ee5\u94fe\u63a5\u591a\u4e2a\u7236\u5bb9\u5668\u5230\u5b50\u5bb9\u5668\uff0c\u6bd4\u5982\u53ef\u4ee5\u94fe\u63a5\u591a\u4e2aweb\u5230db\u5bb9\u5668\u4e0a\u3002\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/","title":"7.Dockerfile","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#1-dockerfile\u6307\u4ee4","title":"1. Dockerfile\u6307\u4ee4","text":"<p>Docker Dockerfile</p> <p>https://www.runoob.com/docker/docker-dockerfile.html</p> <p>Dockerfile\u4e2d\u7684\u6307\u4ee4\u53ca\u8bf4\u660e</p> \u6307\u4ee4 \u8bf4\u660e FROM \u6307\u5b9a\u521b\u5efa\u57fa\u7840\u955c\u50cf MAINTAINER \u6307\u5b9a\u7ef4\u62a4\u8005\u4fe1\u606f RUN \u8fd0\u884c\u547d\u4ee4 CMD \u6307\u5b9a\u542f\u52a8\u5bb9\u5668\u65f6\u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4 LABEL \u6307\u5b9a\u751f\u6210\u955c\u50cf\u7684\u5143\u6570\u636e\u6807\u7b7e\u4fe1\u606f EXPOSE \u58f0\u660e\u955c\u50cf\u5185\u670d\u52a1\u6240\u76d1\u542c\u7684\u7aef\u53e3 ENV \u6307\u5b9a\u73af\u5883\u53d8\u91cf ADD \u590d\u5236\u6307\u5b9a\u7684src\u4e0b\u7684\u5185\u5bb9\u5230\u5bb9\u5668\u4e2d\u7684dest COPY \u590d\u5236\u672c\u5730\u4e3b\u673a\u7684src\u8def\u5f84\u4e0b\u7684\u5185\u5bb9\u5230\u955c\u50cf\u4e2d\u7684dest\u4e0b ENTRYPOINT \u6307\u5b9a\u955c\u50cf\u7684\u9ed8\u8ba4\u5165\u53e3 VOLUME \u521b\u5efa\u6570\u636e\u5377\u6302\u8f7d\u70b9 USER \u6307\u5b9a\u8fd0\u884c\u5bb9\u5668\u65f6\u7684\u7528\u6237\u540d\u6216UID WORKDIR \u914d\u7f6e\u5de5\u4f5c\u76ee\u5f55 ARG \u6307\u5b9a\u955c\u50cf\u5185\u4f7f\u7528\u7684\u53c2\u6570\uff08\u4f8b\u5982\u7248\u672c\u53f7\u4fe1\u606f\u7b49\uff09 ONBUILD \u5f53\u4f5c\u4e3a\u5176\u4ed6\u955c\u50cf\u7684\u57fa\u7840\u955c\u50cf\u65f6\uff0c\u6240\u6267\u884c\u7684\u521b\u5efa\u64cd\u4f5c\u6307\u4ee4 STOPSIGNAL \u5bb9\u5668\u9000\u51fa\u7684\u4fe1\u53f7\u503c HEALTHCHECK \u5982\u4f55\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5 SHELL \u6307\u5b9a\u4f7f\u7528shell\u65f6\u7684\u9ed8\u8ba4shell\u7c7b\u578b"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#2dockerfile\u81ea\u5b9a\u4e49\u955c\u50cf","title":"2.Dockerfile\u81ea\u5b9a\u4e49\u955c\u50cf","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#21-\u67e5\u770b\u8fd0\u884c\u5bb9\u5668\u7684dockerfile\u5de5\u5177","title":"2.1 \u67e5\u770b\u8fd0\u884c\u5bb9\u5668\u7684Dockerfile\u5de5\u5177","text":"<ul> <li>\u9879\u76ee\u5730\u5740\uff1aWhaler(opens new window)</li> <li>\u9879\u76ee\u8bf4\u660e\uff1a\u80fd\u591f\u67e5\u770b\u5728\u8fd0\u884c\u5bb9\u5668\u7684Dockerfile\u7684\u5de5\u5177\uff0c\u6709\u65f6\u5019\u6211\u4eec\u53ef\u80fd\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u6ca1\u6709Dockerfile\u7684\u5bb9\u5668\uff0c\u5373\u53ef\u501f\u52a9\u6b64\u5de5\u5177\u3002</li> <li>\u76f8\u5173\u6587\u7ae0\uff1a\u535a\u6587\u4ecb\u7ecd</li> </ul>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#22-\u67e5\u770bdocker\u5bb9\u5668\u8fd0\u884c\u547d\u4ee4\u7684\u6240\u6709\u53c2\u6570","title":"2.2 \u67e5\u770bdocker\u5bb9\u5668\u8fd0\u884c\u547d\u4ee4\u7684\u6240\u6709\u53c2\u6570","text":"<ul> <li>\u9879\u76ee\u5730\u5740\uff1arunlike(opens new window)</li> <li>\u9879\u76ee\u8bf4\u660e\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u73b0\u6709\u7684 docker \u5bb9\u5668\uff0c\u6253\u5370\u8fd0\u884c\u5b83\u7684\u526f\u672c\u6240\u9700\u7684\u547d\u4ee4\u884c\u3002</li> <li>\u76f8\u5173\u6587\u7ae0\uff1aREADME</li> </ul> <p>\u53ef\u4ee5\u5c06\u8fd0\u884c\u7684docker \u63a8\u5bfc\u53cd\u5199\u4e3adocker-compose\u6587\u4ef6</p> <p>\u4e00\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9879\uff1a</p> <ul> <li> <p>\u5f53 docker run \u547d\u4ee4\u4e2d\u58f0\u660e\u4e86\u53c2\u6570\u65f6\uff0cDocker \u5b88\u62a4\u7a0b\u5e8f\u4f1a\u5ffd\u7565 CMD \u547d\u4ee4\u3002</p> </li> <li> <p>\u4e0eCMD\u4e0d\u540c\u7684\u662f\uff0c\u7531ENTRYPOINT\u542f\u52a8\u7684\u7a0b\u5e8f\u4e0d\u4f1a\u88abdocker run\u547d\u4ee4\u884c\u6307\u5b9a\u7684\u53c2\u6570\u6240\u8986\u76d6\uff0c\u800c\u4e14\uff0c\u8fd9\u4e9b\u547d\u4ee4\u884c\u53c2\u6570\u4f1a\u88ab\u5f53\u4f5c\u53c2\u6570\u4f20\u9012\u7ed9ENTRYPOINT\u6307\u5b9a\u7684\u7a0b\u5e8f\u3002\u4e0d\u8fc7\uff0cdocker run \u547d\u4ee4\u7684<code>--entrypoint</code>\u9009\u9879\u7684\u53c2\u6570\u53ef\u8986\u76d6ENTRYPOINT\u6307\u4ee4\u6307\u5b9a\u7684\u7a0b\u5e8f</p> </li> <li> <p>Dockfile\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528CMD\u6307\u5b9a\u542f\u52a8\u547d\u4ee4\uff0c\u5219\u4f1a\u7ee7\u627f\u4e0a\u4e00\u4e2a\u955c\u50cf\u7684\u9ed8\u8ba4\u542f\u52a8\u547d\u4ee4\uff1bCMD \u5bb9\u5668\u7684\u9ed8\u8ba4\u542f\u52a8\u547d\u4ee4\uff0c\u6709\u4e14\u53ea\u80fd\u6709\u4e00\u6761\uff1b</p> </li> </ul> <p>\u6839\u636eDockerfile\u751f\u6210\u65b0\u7684\u955c\u50cf\u547d\u4ee4\u4e2d,build \u521b\u5efa\u65b0\u7684\u955c\u50cf\uff1b<code>-t</code>\u6307\u5b9a\u65b0\u955c\u50cf\u7684\u540d\u5b57\u548c\u6807\u7b7e\uff1b<code>.</code>\u6307\u5b9aDockerfile\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55</p> <pre><code>docker build -t imagename:latest Dockerfile\u6240\u5728\u76ee\u5f55\n</code></pre> <p>\u5bb9\u5668\u548c\u955c\u50cf\u4e4b\u95f4\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u9876\u90e8 \u53ef\u5199\u5c42\u3002\u5bf9\u5bb9\u5668\u7684\u6240\u6709\u6dfb\u52a0\u65b0\u6570\u636e\u6216\u4fee\u6539\u73b0\u6709\u6570\u636e\u7684\u5199\u5165\u90fd\u5b58\u50a8\u5728\u6b64 \u53ef\u5199\u5c42 \u4e2d\u3002\u5220\u9664\u5bb9\u5668\u65f6\uff0c\u53ef\u5199\u5c42\u4e5f\u4f1a\u88ab\u5220\u9664\u3002\u57fa\u7840\u955c\u50cf\u4fdd\u6301\u4e0d\u53d8\u3002</p> <p>\u8fd9\u91cc\u5229\u7528\u4e86<code>\u5199\u65f6\u590d\u5236\u6280\u672f(COW,copy on write)</code> , \u5bf9\u4e8e\u5f00\u53d1\u7684\u5c0f\u4f19\u4f34\uff0c\u53ef\u4ee5\u7ed3\u5408\u4eab\u5143\u8bbe\u8ba1\u6a21\u5f0f\u7406\u89e3\uff0c\u5bf9\u4e8e\u8fd0\u7ef4\u7684\u5c0f\u4f19\u4f34\uff0c\u53ef\u4ee5\u7ed3\u5408 Openstack \u7ec4\u4ef6 Glance \u539f\u7406\u6765\u7406\u89e3</p> <p>\u7528\u901a\u4fd7\u7684\u8bdd\u8bb2\uff0c\u5f53\u4fee\u6539\u65f6\uff0c\u4f1a\u628a\u6570\u636e\u590d\u5236\u5230\u5bb9\u5668\u5c42\u4fee\u6539\u3002\u5f53\u65b0\u589e\u7684\u65f6\u5019\u76f4\u63a5\u5728\u5bb9\u5668\u5c42\u65b0\u589e\uff0c\u5f53\u5220\u9664\u65f6\uff0c\u4f1a\u5c4f\u853d\u955c\u50cf\u5c42\u3002</p> <p>Docker \u901a\u8fc7\u8bfb\u53d6\u7ed9\u5b9a\u7684\u6307\u4ee4\u6765\u81ea\u52a8\u6784\u5efa\u955c\u50cf\u3002<code>\u9075\u5faa\u7279\u5b9a\u7684\u683c\u5f0f\u548c\u6307\u4ee4\u96c6\uff0c\u5176\u4e2d\u7684 \u6bcf\u4e00\u6761\u6307\u4ee4\u5728\u5bb9\u5668\u955c\u50cf\u4e2d\u521b\u5efa\u4e00\u4e2a\u5c42\u3002\u8fd9\u4e9b\u5c42\u662f\u5806\u53e0\u7684\uff0c\u6bcf\u4e2a\u5c42\u90fd\u662f\u4e0e\u524d\u4e00\u5c42\u76f8\u6bd4\u7684\u53d8\u5316\u7684\u589e\u91cf</code></p> <p>\u8fd9\u91cc\u6211\u4eec\u4ee5 redis:7 \u8fd9\u4e2a\u5b98\u65b9\u955c\u50cf\u4e3a\u4f8b,\u770b\u770b\u4e00\u4e2a\u6807\u51c6\u7684 Dockerfile \u5982\u4f55\u4e66\u5199\uff0c\u53ef\u4ee5\u770b\u5230\u955c\u50cf\u6784\u5efa\u4e86 16 \u5c42\u3002</p> <pre><code>$ docker history --human=true  redis:7\nIMAGE          CREATED       CREATED BY                                      SIZE      COMMENT\n19c51d4327cf   6 weeks ago   /bin/sh -c #(nop)  CMD [\"redis-server\"]         0B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c #(nop)  EXPOSE 6379                  0B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c #(nop)  ENTRYPOINT [\"docker-entry\u2026   0B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c #(nop) COPY file:e873a0e3c13001b5\u2026   661B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c #(nop) WORKDIR /data                 0B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c #(nop)  VOLUME [/data]               0B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c mkdir /data &amp;&amp; chown redis:redis \u2026   0B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c set -eux;   savedAptMark=\"$(apt-m\u2026   32MB\n&lt;missing&gt;      6 weeks ago   /bin/sh -c #(nop)  ENV REDIS_DOWNLOAD_SHA=06\u2026   0B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c #(nop)  ENV REDIS_DOWNLOAD_URL=ht\u2026   0B\n&lt;missing&gt;      6 weeks ago   /bin/sh -c #(nop)  ENV REDIS_VERSION=7.0.8      0B\n&lt;missing&gt;      7 weeks ago   /bin/sh -c set -eux;  savedAptMark=\"$(apt-ma\u2026   4.13MB\n&lt;missing&gt;      7 weeks ago   /bin/sh -c #(nop)  ENV GOSU_VERSION=1.14        0B\n&lt;missing&gt;      7 weeks ago   /bin/sh -c groupadd -r -g 999 redis &amp;&amp; usera\u2026   329kB\n&lt;missing&gt;      7 weeks ago   /bin/sh -c #(nop)  CMD [\"bash\"]                 0B\n&lt;missing&gt;      7 weeks ago   /bin/sh -c #(nop) ADD file:e2398d0bf516084b2\u2026   80.5MB\n\u250c\u2500\u2500[root@vms107.liruilongs.github.io]-[/etc/systemd]\n\u2514\u2500$docker history --human=true  redis:7 | wc -l\n17\n</code></pre> <p>\u6d89\u53ca \u4e24\u4e2aDockerfile\u6587\u4ef6\u6784\u5efa\u7684\u955c\u50cf</p> <p>\u57fa\u7840\u955c\u50cf\u6784\u5efa</p> <pre><code>FROM scratch\nADD rootfs.tar.xz /\nCMD [\"bash\"]\n</code></pre> <p>reids\u955c\u50cf\u6784\u5efa <pre><code>FROM debian:bullseye-slim\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r -g 999 redis &amp;&amp; useradd -r -g redis -u 999 redis\n\n# grab gosu for easy step-down from root\n# https://github.com/tianon/gosu/releases\nENV GOSU_VERSION 1.16\nRUN set -eux; \\\nsavedAptMark=\"$(apt-mark showmanual)\"; \\\napt-get update; \\\napt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \\\nrm -rf /var/lib/apt/lists/*; \\\ndpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \\\nwget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \\\nwget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \\\nexport GNUPGHOME=\"$(mktemp -d)\"; \\\ngpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \\\ngpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \\\ngpgconf --kill all; \\\nrm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \\\napt-mark auto '.*' &gt; /dev/null; \\\n[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark &gt; /dev/null; \\\napt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\nchmod +x /usr/local/bin/gosu; \\\ngosu --version; \\\ngosu nobody true\n\nENV REDIS_VERSION 7.0.9\nENV REDIS_DOWNLOAD_URL http://download.redis.io/releases/redis-7.0.9.tar.gz\nENV REDIS_DOWNLOAD_SHA f77135c2a47c9151d4028bfea3b34470ab4d324d1484f79a84c6f32a3cfb9f65\n\nRUN set -eux; \\\n\\\nsavedAptMark=\"$(apt-mark showmanual)\"; \\\napt-get update; \\\napt-get install -y --no-install-recommends \\\nca-certificates \\\nwget \\\n\\\ndpkg-dev \\\ngcc \\\nlibc6-dev \\\nlibssl-dev \\\nmake \\\n; \\\nrm -rf /var/lib/apt/lists/*; \\\n\\\nwget -O redis.tar.gz \"$REDIS_DOWNLOAD_URL\"; \\\necho \"$REDIS_DOWNLOAD_SHA *redis.tar.gz\" | sha256sum -c -; \\\nmkdir -p /usr/src/redis; \\\ntar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1; \\\nrm redis.tar.gz; \\\n\\\n# disable Redis protected mode [1] as it is unnecessary in context of Docker\n# (ports are not automatically exposed when running inside Docker, but rather explicitly by specifying -p / -P)\n# [1]: https://github.com/redis/redis/commit/edd4d555df57dc84265fdfb4ef59a4678832f6da\ngrep -E '^ *createBoolConfig[(]\"protected-mode\",.*, *1 *,.*[)],$' /usr/src/redis/src/config.c; \\\nsed -ri 's!^( *createBoolConfig[(]\"protected-mode\",.*, *)1( *,.*[)],)$!\\10\\2!' /usr/src/redis/src/config.c; \\\ngrep -E '^ *createBoolConfig[(]\"protected-mode\",.*, *0 *,.*[)],$' /usr/src/redis/src/config.c; \\\n# for future reference, we modify this directly in the source instead of just supplying a default configuration flag because apparently \"if you specify any argument to redis-server, [it assumes] you are going to specify everything\"\n# see also https://github.com/docker-library/redis/issues/4#issuecomment-50780840\n# (more exactly, this makes sure the default behavior of \"save on SIGTERM\" stays functional by default)\n\\\n# https://github.com/jemalloc/jemalloc/issues/467 -- we need to patch the \"./configure\" for the bundled jemalloc to match how Debian compiles, for compatibility\n# (also, we do cross-builds, so we need to embed the appropriate \"--build=xxx\" values to that \"./configure\" invocation)\ngnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"; \\\nextraJemallocConfigureFlags=\"--build=$gnuArch\"; \\\n# https://salsa.debian.org/debian/jemalloc/-/blob/c0a88c37a551be7d12e4863435365c9a6a51525f/debian/rules#L8-23\n dpkgArch=\"$(dpkg --print-architecture)\"; \\\ncase \"${dpkgArch##*-}\" in \\\namd64 | i386 | x32) extraJemallocConfigureFlags=\"$extraJemallocConfigureFlags --with-lg-page=12\" ;; \\\n*) extraJemallocConfigureFlags=\"$extraJemallocConfigureFlags --with-lg-page=16\" ;; \\\nesac; \\\nextraJemallocConfigureFlags=\"$extraJemallocConfigureFlags --with-lg-hugepage=21\"; \\\ngrep -F 'cd jemalloc &amp;&amp; ./configure ' /usr/src/redis/deps/Makefile; \\\nsed -ri 's!cd jemalloc &amp;&amp; ./configure !&amp;'\"$extraJemallocConfigureFlags\"' !' /usr/src/redis/deps/Makefile; \\\ngrep -F \"cd jemalloc &amp;&amp; ./configure $extraJemallocConfigureFlags \" /usr/src/redis/deps/Makefile; \\\n\\\nexport BUILD_TLS=yes; \\\nmake -C /usr/src/redis -j \"$(nproc)\" all; \\\nmake -C /usr/src/redis install; \\\n\\\n# TODO https://github.com/redis/redis/pull/3494 (deduplicate \"redis-server\" copies)\nserverMd5=\"$(md5sum /usr/local/bin/redis-server | cut -d' ' -f1)\"; export serverMd5; \\\nfind /usr/local/bin/redis* -maxdepth 0 \\\n-type f -not -name redis-server \\\n-exec sh -eux -c ' \\\n   md5=\"$(md5sum \"$1\" | cut -d\" \" -f1)\"; \\\n   test \"$md5\" = \"$serverMd5\"; \\\n  ' -- '{}' ';' \\\n-exec ln -svfT 'redis-server' '{}' ';' \\\n; \\\n\\\nrm -r /usr/src/redis; \\\n\\\napt-mark auto '.*' &gt; /dev/null; \\\n[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark &gt; /dev/null; \\\nfind /usr/local -type f -executable -exec ldd '{}' ';' \\\n| awk '/=&gt;/ { print $(NF-1) }' \\\n| sort -u \\\n| xargs -r dpkg-query --search \\\n| cut -d: -f1 \\\n| sort -u \\\n| xargs -r apt-mark manual \\\n; \\\napt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n\\\nredis-cli --version; \\\nredis-server --version\n\nRUN mkdir /data &amp;&amp; chown redis:redis /data\nVOLUME /data\nWORKDIR /data\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\nEXPOSE 6379\nCMD [\"redis-server\"]\n</code></pre></p> <p>\u8fd0\u884c\u6b64\u955c\u50cf\u5e76\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u65f6\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u5728\u5e95\u5c42\u4e4b\u4e0a\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u53ef\u5199\u5c42\uff08\u5bb9\u5668\u5c42\uff09\u3002\u5bf9\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u6240\u505a\u7684\u6240\u6709\u66f4\u6539\uff08\u4f8b\u5982\u5199\u5165\u65b0\u6587\u4ef6\u3001\u4fee\u6539\u73b0\u6709\u6587\u4ef6\u548c\u5220\u9664\u6587\u4ef6\uff09\u90fd\u5c06\u5199\u5165\u6b64\u53ef\u5199\u5bb9\u5668\u5c42\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u4e0a\u9762\u7684 Dockerfile \u6587\u4ef6\u5f88\u5e9e\u5927\uff0c\u901a\u8fc7\u8fd9\u4e2a\u6587\u4ef6\u6211\u4eec\u6765\u603b\u7ed3\u4e00\u4e9b \u5728\u7f16\u5199\u65f6\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#23-\u70ed\u95e8dockerfile\u793a\u4f8b","title":"2.3 \u70ed\u95e8Dockerfile\u793a\u4f8b","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#nginx","title":"Nginx","text":"debian-nginxcentos7-nginx <p>\u57fa\u4e8edebian:jessie\u57fa\u7840\u955c\u50cf</p> <pre><code>FROM debian:jessie\nLABEL maintainer docker_user&lt;docker_user@email.com&gt;\nENV NGINX_VERSION 1.10.1-1~jessie\nRUN apt-key adv --keyserver hkp://pgp.mit.edu:80 --recv-keys 573BFD6B3D8FBC64107\n    9A6ABABF5BD827BD9BF62 \\\n&amp;&amp; echo \"deb http://nginx.org/packages/debian/ jessie nginx\" &gt;&gt; /etc/apt/sources.list \\\n&amp;&amp; apt-get update \\\n&amp;&amp; apt-get install --no-install-recommends --no-install-suggests -y \\\nca-certificates \\\nnginx=${NGINX_VERSION} \\\nnginx-module-xslt \\\nnginx-module-geoip \\\nnginx-module-image-filter \\\nnginx-module-perl \\\nnginx-module-njs \\\ngettext-base \\\n&amp;&amp; rm -rf /var/lib/apt/lists/*\n\n# forward request and error logs to docker log collector\nRUN ln -sf /dev/stdout /var/log/nginx/access.log \\\n&amp;&amp; ln -sf /dev/stderr /var/log/nginx/error.log\nEXPOSE 80 443\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n</code></pre> <p>Nginx\u7684\u5b98\u65b9\u4ed3\u5e93\u8fd8\u63d0\u4f9b\u4e86Dockerfile\u6784\u5efaNginx\u955c\u50cf\uff0c\u76ee\u524d\u7684\u7248\u672c\u662f1.7.9\uff0c\u5176\u5185\u5bb9\u4e3a\uff1a</p> <pre><code>FROM debian:wheezy\nMAINTAINER NGINX Docker Maintainers \"docker-maint@nginx.com\"\nRUN apt-key adv --keyserver pgp.mit.edu --recv-keys 573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62\nRUN echo \"deb http://nginx.org/packages/mainline/debian/ wheezy nginx\" &gt;&gt; /etc/apt/sources.list\nENV NGINX_VERSION 1.7.9-1~wheezy\nRUN apt-get update &amp;&amp; apt-get install -y nginx=${NGINX_VERSION} &amp;&amp; rm -rf /var/lib/apt/lists/*\n# forward request and error logs to docker log collector\nRUN ln -sf /dev/stdout /var/log/nginx/access.log\nRUN ln -sf /dev/stderr /var/log/nginx/error.log\nVOLUME [\"/var/cache/nginx\"]\nEXPOSE 80 443\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n</code></pre> <p>\u57fa\u4e8ecentos7\u955c\u50cf</p> <pre><code>FROM centos:7\nMAINTAINER shichao@scajy.cn\nRUN yum install -y gcc gcc-c++ make pcre \\\npcre-devel openssl openssl-devel  \\\npcre-davel gd-devel iproute net-tools \\\ntelnet wget curl \\\n&amp;&amp; yum clean all \\\n&amp;&amp; rm -rf /var/cache/yum/*\n\nRUN useradd -M -s /sbin/nologin nginx\nRUN  wget http://nginx.org/download/nginx-1.17.6.tar.gz &amp;&amp; tar zxf  nginx-1.17.6.tar.gz &amp;&amp; \\\ncd nginx-1.17.6  &amp;&amp; \\\n./configure --prefix=/usr/local/nginx  \\\n--with-http_stub_status_module \\\n--with-http_ssl_module \\\n--with-http_gzip_static_module  \\\n--with-http_flv_module \\\n--with-http_mp4_module \\\n--with-http_gunzip_module &amp;&amp; \\\nmake &amp;&amp; make install\nENV PATH /usr/local/nginx/sbin:$PATH\nEXPOSE 80\nENTRYPOINT [\"nginx\"]\nCMD [\"-g\",\"daemon off;\"]\n</code></pre> <p>\u5b98\u65b9\u63d0\u4f9b\u7684Dockerfile \u8bf7\u5230<code>https://github.com/docker-library/docs/tree/master/nginx</code> </p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#python","title":"Python","text":"alpineCentosUbuntuDebian <pre><code>FROM python:3.9-alpine\nMAINTAINER Logan &lt;admin@attacker.club&gt;\nWORKDIR /opt/app\nCOPY requirements.txt /opt/app\n\n## \u56fd\u5185\u52a0\u901f\u6e90\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories ## \u5de5\u5177\u5305\nRUN apk --no-cache add curl vim busybox-extras\n## ldap\u4f9d\u8d56\nRUN apk --no-cache add gcc \\ \nlibldap \\\nlibc-dev \\\nopenldap-dev # python3-dev \n## Pillow\u56fe\u7247\u5e93\u4f9d\u8d56\nRUN apk --no-cache add libjpeg  jpeg-dev musl-dev zlib-dev libffi-dev # python3-dev \nRUN pip --no-cache-dir install -i https://mirrors.aliyun.com/pypi/simple -r requirements.txt\nCOPY . /opt/app\n\n## \u6e05\u7406\u6570\u636e\nRUN apk del \\\ngcc \\\nlibc-dev \\\nopenldap-dev\n# RUN apk del libjpeg  jpeg-dev musl-dev zlib-dev libffi-dev \nRUN rm -rf  /tmp/* /opt/app/env /opt/app/db.sqlite3 /opt/app/logs/* /root/.cache/pip  /var/cache/apk/*\n\nEXPOSE 8000\nCMD [\"/bin/sh\",\"run.sh\"]\n## \u6784\u5efa\u955c\u50cf\n# docker build -t lghost/python:3.9 . -f Dockerfile-alpine\n## \u7b80\u6d01\u542f\u52a8\n# docker run  -d -p8000:8000  --name cmdb  lghost/python:3.9\n## \u521d\u59cb\u5316\u6570\u636e\n# docker exec -it cmdb python init.py\n</code></pre> <p><code>python.Dockerfile-centos</code></p> <pre><code>FROM centos:7\nRUN rm /etc/yum.repos.d/* \\\n&amp;&amp; curl -s -o ./Centos-7.repo https://mirrors.aliyun.com/repo/Centos-7.repo \\\n&amp;&amp; curl -s -o ./epel.repo https://mirrors.aliyun.com/repo/epel-7.repo \\\n&amp;&amp; sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' Centos-7.repo \\\n&amp;&amp; yum install  -y wget openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel python-devel \\\nlibffi-devel  tk-devel\n\nRUN wget -c https://www.python.org/ftp/python/3.9.16/Python-3.9.16.tar.xz \\\n&amp;&amp; tar xf Python*.xz \\\n&amp;&amp; cd Python-3.9.16 \\\n&amp;&amp; ./configure prefix=/usr/local/python3 \\\n&amp;&amp; make  -j 2 &amp;&amp; make  altinstall  &amp;&amp; ln -s /usr/local/python3/bin/python3.9 /usr/bin/python3\n\n#  docker build -t lghost/python:3.9 . -f Dockerfile-alpine\n</code></pre> <pre><code>FROM centos:7\nLABEL auther=\"hjl@oschina.com\"\nENV container docker\nRUN yum -y swap -- remove fakesystemd -- install systemd systemd-libs\nRUN yum -y update; yum clean all; \\\n(cd /lib/systemd/system/sysinit.target.wants/; for i in *; do [ $i ==systemd-tmpfiles-setup.service ] || rm -f $i; done); \\\nrm -f /lib/systemd/system/multi-user.target.wants/*;\\\nrm -f /etc/systemd/system/*.wants/*;\\\nrm -f /lib/systemd/system/local-fs.target.wants/*; \\\nrm -f /lib/systemd/system/sockets.target.wants/*udev*; \\\nrm -f /lib/systemd/system/sockets.target.wants/*initctl*; \\\nrm -f /lib/systemd/system/basic.target.wants/*;\\\nrm -f /lib/systemd/system/anaconda.target.wants/*;\nVOLUME [ \"/sys/fs/cgroup\" ]\nCMD [\"/usr/sbin/init\"]\n</code></pre> <p>\u5b98\u65b9\u63d0\u4f9b\u7684Dockerfile \u8bf7\u5230<code>https://github.com/docker-library/docs/tree/master/centos</code></p> <p>\u5b98\u65b9\u63d0\u4f9b\u7684Dockerfile \u8bf7\u5230<code>https://github.com/docker-library/docs/tree/master/ubuntu</code> \u67e5\u770b\u3002</p> <p><code>python.Dockerfile-ubuntu</code></p> <pre><code>FROM ubuntu:22.04\nMAINTAINER Logan &lt;admin@attacker.club&gt;\nWORKDIR /opt\n## \u4f9d\u8d56\u5305\nRUN  sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list  \\\n&amp;&amp; apt update \\\n&amp;&amp; apt install nload iftop net-tools curl git -y \\\n&amp;&amp; apt install python3 python3-pip -y\n\n## \u6e05\u7406\u6570\u636e\nRUN rm -rf /var/lib/apt/lists/*  \\\n&amp;&amp; apt  clean \\\n&amp;&amp; apt autoclean EXPOSE 8000\n# docker build -t lghost/python3 . -f Dockerfile-ubuntu-python3\n</code></pre> <pre><code>FROM python:3.9.13-slim\nENV PYTHONUNBUFFERED 1\n# RUN sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list # \u56fd\u5185\u6e90\nWORKDIR /opt/app\nRUN apt-get update \\\n&amp;&amp; apt-get install -y  net-tools apt-utils \\\nlibtiff5-dev libjpeg8-dev zlib1g-dev\nCOPY requirements.txt /opt/app\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#django","title":"Django","text":"<p><code>dockerfile-django</code></p> <pre><code>FROM python:3.4\nRUN apt-get update \\\n&amp;&amp; apt-get install -y --no-install-recommends \\\npostgresql-client \\\n&amp;&amp; rm -rf /var/lib/apt/lists/*\n\nWORKDIR /usr/src/app\nCOPY requirements.txt ./\nRUN pip install -r requirements.txt\nCOPY . .\n\nEXPOSE 8000\nCMD [\"python\", \"manage.py\", \"runserver\", \"0.0.0.0:8000\"]\n# docker build -t python-django:3.4.\n</code></pre> <p><code>django_python.dockerfile</code></p> <pre><code>FROM python:3.8-alpine\nWORKDIR /home\nCOPY . /home\n\nRUN pip install -i http://mirrors.aliyun.com/pypi/simple --trusted-host mirrors.aliyun.com -r requirements.txt\nRUN  rm -rf /home/venv # RUN  python manage.py makemigrations  &amp;&amp;  python manage.py migrate\n# CMD [ \"python\", \"./manage.py\", \"runserver\", \"0.0.0.0:8000\"]\nRUN chmod +x run.sh\nEXPOSE 8000\nCMD [\"/bin/sh\",\"run.sh\"]  # \u5bb9\u5668\u542f\u52a8\u65f6\u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4\n# docker build -t lghost/bind9:latest . # build images\n# docker push lghost/bind9:latest # \u63a8\u9001\u5230dockerhub\n</code></pre> <p><code>run.sh</code></p> <pre><code>#!/bin/bash\n###\ndb_init() {\npip3  install -i http://mirrors.aliyun.com/pypi/simple  --trusted-host mirrors.aliyun.com  -r requirements.txt\npython manage.py makemigrations\npython manage.py migrate\n# \u521d\u59cb\u5316\u6570\u636e\npython init.py\n# \u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u5bc6\u7801\n}\n# shellcheck disable=SC2120\nreplace_settings() {\nif [ $1x == \"debug\"x ]; then\nsed -i  's/DEBUG = False/DEBUG = True/'g  website/settings.py\n  echo -e \"Enable Debug ......\"\nelse\nsed -i  's/DEBUG = True/DEBUG = False/'g  website/settings.py\n  echo -e \"Disable Debug ......\"\n# \u5173\u95ed\u8c03\u8bd5\u6a21\u5f0f\nfi\n}\nrun_server() {\ndb_init\nreplace_settings\npython manage.py runserver 0.0.0.0:8000\n}\nrun_server # \u542f\u52a8\u670d\u52a1\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#golang","title":"Golang","text":"<pre><code>FROM golang:alpine AS builder\n# Set necessary environmet variables needed for our image\nENV GO111MODULE=on \\\nGOPROXY=https://goproxy.cn,direct \\\nCGO_ENABLED=0 \\\nGOOS=linux \\\nGOARCH=amd64\n# Move to working directory /build\nWORKDIR /build\n# Copy and download dependency using go mod\nCOPY go.mod .\nCOPY go.sum .\nRUN go mod download\n# Copy the code into the container\nCOPY . .\n# Run test\n#RUN go test ./...\n# Build the application\nRUN go build -o main .\n\n# Move to /dist directory as the place for resulting binary folder\nWORKDIR /dist\n# Copy binary from build to main folder\nRUN cp /build/main .\n\n############################\n# STEP 2 build a small image\n############################\nFROM scratch\nCOPY --from=builder /dist/main /\nCOPY ./env/demo.env /env/demo.env\nCOPY ./logs /logs\n\n# Command to run the executable\nENTRYPOINT [\"/main\"]\n</code></pre> <pre><code># start from golang base image\nFROM golang:1.16-alpine as builder\nWORKDIR /usr/src/app\nCOPY go.mod go.sum ./\n# RUN echo \"nameserver 114.114.114.114\" &gt;&gt; /etc/resolv.conf\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories\nRUN apk add --no-cache git\nENV GO111MODULE=on \\\nGOPROXY=https://goproxy.cn \\\nGOSUMDB=off \\\nGIN_MODE=release\n\nRUN go mod download -x\nRUN go mod tidy\nCOPY . .\nRUN go build -v -o /usr/local/bin ./...\nWORKDIR /usr/src/tool\nRUN git clone https://gitee.com/edmondfrank/tern.git\nWORKDIR /usr/src/tool/tern\nRUN go mod download -x\nRUN go mod tidy\nRUN go build -v -o /usr/local/bin ./...\n\nFROM alpine\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories\nRUN apk add --no-cache ca-certificates &amp;&amp; update-ca-certificates\nCOPY --from=builder /usr/local/bin/forudad /usr/bin/forudad\nCOPY ./cmd/migrations /usr/migrations\nCOPY --from=builder /usr/local/bin/tern /usr/bin/tern\nCOPY ./examples/config/postgre-example.toml /usr/bin/config.toml\nCOPY ./migration.sh .\nEXPOSE 4200 4200\nENTRYPOINT [\"./migration.sh\"]\nCMD [\"/usr/bin/forudad\", \"-config\", \"/usr/bin/config.toml\"]\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>Golang/Python\u5e94\u7528\u90e8\u7f72\u5230Docker</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#nodejs","title":"Node.js","text":"<p>\u5b98\u65b9\u63d0\u4f9b\u7684Dockerfile \u8bf7\u5230<code>https://github.com/docker-library/docs/tree/master/node</code> \u67e5\u770b\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#redis","title":"Redis","text":"<p>\u901a\u8fc7Dockerfile\u4e5f\u53ef\u4ee5\u6784\u5efa\u548c\u5b98\u65b9\u4e00\u6837\u7684Redis\u955c\u50cf\u3002\u8fd9\u91cc\u4ee52.8\u7248\u672c\u4e3a\u4f8b\uff0c\u5176Dockerfile\u4e3a\uff1a <pre><code>FROM debian:wheezy\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r redis &amp;&amp; useradd -r -g redis redis\nRUN apt-get update \\\n&amp;&amp; apt-get install -y curl \\\n&amp;&amp; rm -rf /var/lib/apt/lists/*\n# grab gosu for easy step-down from root\nRUN gpg --keyserver pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4\n\nRUN curl -o /usr/local/bin/gosu -SL \"https://github.com/tianon/gosu/releases/download/1.2/gosu-$(dpkg --print-architecture)\" \\\n&amp;&amp; curl -o /usr/local/bin/gosu.asc -SL\"https://github.com/tianon/gosu/releases/download/1.2/gosu-$(dpkg --print-architecture).asc\" \\\n&amp;&amp; gpg --verify /usr/local/bin/gosu.asc \\\n&amp;&amp; rm /usr/local/bin/gosu.asc \\\n&amp;&amp; chmod +x /usr/local/bin/gosu\nENV REDIS_VERSION 2.8.19\nENV REDIS_DOWNLOAD_URL http://download.redis.io/releases/redis-2.8.19.tar.gz\nENV REDIS_DOWNLOAD_SHA1 3e362f4770ac2fdbdce58a5aa951c1967e0facc8\n# for redis-sentinel see: http://redis.io/topics/sentinel\nRUN buildDeps='gcc libc6-dev make'; \\\nset -x \\\n&amp;&amp; apt-get update &amp;&amp; apt-get install -y $buildDeps --no-install-recommends \\\n&amp;&amp; rm -rf /var/lib/apt/lists/* \\\n&amp;&amp; mkdir -p /usr/src/redis \\\n&amp;&amp; curl -sSL \"$REDIS_DOWNLOAD_URL\" -o redis.tar.gz \\\n&amp;&amp; echo \"$REDIS_DOWNLOAD_SHA1 *redis.tar.gz\" | sha1sum -c - \\\n&amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\\n&amp;&amp; rm redis.tar.gz \\\n&amp;&amp; make -C /usr/src/redis \\\n&amp;&amp; make -C /usr/src/redis install \\\n&amp;&amp; rm -r /usr/src/redis \\\n&amp;&amp; apt-get purge -y --auto-remove $buildDeps\nRUN mkdir /data &amp;&amp; chown redis:redis /data\nVOLUME /data\nWORKDIR /data\nCOPY docker-entrypoint.sh /entrypoint.sh\nENTRYPOINT [\"/entrypoint.sh\"]\nEXPOSE 6379\nCMD [ \"redis-server\" ]\n</code></pre></p> <p>\u5b98\u65b9\u63d0\u4f9b\u7684Dockerfile \u8bf7\u5230<code>https://github.com/docker-library/docs/tree/master/redis</code> \u67e5\u770b\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#mysql","title":"MySQL","text":"<p>\u901a\u8fc7Dockerfile\u6765\u521b\u5efamysql <pre><code>FROM debian:wheezy\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r mysql &amp;&amp; useradd -r -g mysql mysql\n# FATAL ERROR: please install the following Perl modules before executing /usr/local/mysql/scripts/mysql_install_db:\n# File::Basename\n# File::Copy\n# Sys::Hostname\n# Data::Dumper\nRUN apt-get update &amp;&amp; apt-get install -y perl --no-install-recommends &amp;&amp; rm -rf /var/lib/apt/lists/*\n# gpg: key 5072E1F5: public key \"MySQL Release Engineering &lt;mysql-build@oss.oracle.com&gt;\" imported\nRUN apt-key adv --keyserver pool.sks-keyservers.net --recv-keys A4A9406876FCBD3C456770C88C718D3B5072E1F5\nENV MYSQL_MAJOR 5.7\nENV MYSQL_VERSION 5.7.5-m15\nRUN echo \"deb http://repo.mysql.com/apt/debian/ wheezy mysql-${MYSQL_MAJOR}-dmr\" &gt; /etc/apt/sources.list.d/mysql.list\n# the \"/var/lib/mysql\" stuff here is because the mysql-server postinst doesn't have an explicit way\n# to disable the mysql_install_db codepath besides having a database already \"configured\" (ie, stuff in /var/lib/mysql/mysql)\n# also, we set debconf keys to make APT a little quieter\nRUN { \\\necho mysql-community-server mysql-community-server/data-dir select ''; \\\necho mysql-community-server mysql-community-server/root-pass password ''; \\\necho mysql-community-server mysql-community-server/re-root-pass password ''; \\\necho mysql-community-server mysql-community-server/remove-test-db select false; \\\n} | debconf-set-selections \\\n&amp;&amp; apt-get update &amp;&amp; apt-get install -y mysql-server=\"${MYSQL_VERSION}\"* &amp;&amp; rm -rf /var/lib/apt/lists/* \\\n&amp;&amp; rm -rf /var/lib/mysql &amp;&amp; mkdir -p /var/lib/mysql\n# comment out a few problematic configuration values\nRUN sed -Ei 's/^(bind-address|log)/#&amp;/' /etc/mysql/my.cnf\nVOLUME /var/lib/mysql\nCOPY docker-entrypoint.sh /entrypoint.sh\nENTRYPOINT [\"/entrypoint.sh\"]\nEXPOSE 3306\nCMD [\"mysqld\"]\n</code></pre></p> <p>\u5b98\u65b9\u63d0\u4f9b\u7684Dockerfile \u8bf7\u5230<code>https://github.com/docker-library/docs/tree/master/mysql</code> \u67e5\u770b</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#mongodb","title":"Mongodb","text":"<pre><code>FROM debian:wheezy\nRUN groupadd -r mongodb &amp;&amp; useradd -r -g mongodb mongodb\nRUN apt-get update \\\n&amp;&amp; apt-get install -y curl numactl \\\n&amp;&amp; rm -rf /var/lib/apt/lists/*\n# grab gosu for easy step-down from root\nRUN gpg --keyserver pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4\nRUN curl -o /usr/local/bin/gosu -SL \"https://github.com/tianon/gosu/releases/download/1.2/gosu-$(dpkg--print-architecture)\" \\\n&amp;&amp; curl -o /usr/local/bin/gosu.asc -SL \"https://github.com/tianon/gosu/releases/download/1.2/gosu-$(dpkg --print-architecture).asc\" \\\n&amp;&amp; gpg --verify /usr/local/bin/gosu.asc \\\n&amp;&amp; rm /usr/local/bin/gosu.asc \\\n&amp;&amp; chmod +x /usr/local/bin/gosu\nENV MONGO_RELEASE_FINGERPRINT BDC0DB28022D7DEA1490DC3E7085801C857FD301\nRUN gpg --keyserver pool.sks-keyservers.net --recv-keys $MONGO_RELEASE_FINGERPRINT\nENV MONGO_VERSION 3.0.0-rc6\nRUN curl -SL \"https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-$MONGO_VERSION.tgz\" -o mongo.tgz \\\n&amp;&amp; curl -SL \"https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-$MONGO_VERSION.tgz.sig\" \u2013o mongo.tgz.sig \\\n&amp;&amp; gpg --verify mongo.tgz.sig \\\n&amp;&amp; tar -xvf mongo.tgz -C /usr/local --strip-components=1 \\\n&amp;&amp; rm mongo.tgz*\nVOLUME /data/db\nCOPY docker-entrypoint.sh /entrypoint.sh\nENTRYPOINT [\"/entrypoint.sh\"]\nEXPOSE 27017\nCMD [\"mongod\"]\n</code></pre> <p>\u5b98\u65b9\u63d0\u4f9b\u7684Dockerfile \u8bf7\u5230 <code>https://github.com/docker-library/docs/tree/master/mongo</code> \u67e5\u770b\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#postgres","title":"Postgres","text":"<pre><code>FROM debian:wheezy\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r postgres &amp;&amp; useradd -r -g postgres postgres\n# grab gosu for easy step-down from root\nRUN gpg --keyserver pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4\nRUN apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/* \\\n&amp;&amp; curl -o /usr/local/bin/gosu \u2013SL \"https://github.com/tianon/gosu/releases/download/1.2/gosu-$(dpkg --print-architecture)\" \\\n&amp;&amp; curl -o /usr/local/bin/gosu.asc -SL \"https://github.com/tianon/gosu/releases/download/1.2/gosu-$(dpkg --print-architecture).asc\" \\\n&amp;&amp; gpg --verify /usr/local/bin/gosu.asc \\\n&amp;&amp; rm /usr/local/bin/gosu.asc \\\n&amp;&amp; chmod +x /usr/local/bin/gosu \\\n&amp;&amp; apt-get purge -y --auto-remove curl\n# make the \"en_US.UTF-8\" locale so postgres will be utf-8 enabled by default\nRUN apt-get update &amp;&amp; apt-get install -y locales &amp;&amp; rm -rf /var/lib/apt/lists/* \\\n&amp;&amp; localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8\nENV LANG en_US.utf8\nRUN mkdir /docker-entrypoint-initdb.d\nRUN apt-key adv --keyserver pool.sks-keyservers.net --recv-keys B97B0AFCAA1A47F044F244A07FCC7D46ACCC4CF8\nENV PG_MAJOR 9.4\nENV PG_VERSION 9.4.0-1.pgdg70+1\nRUN echo 'deb http://apt.postgresql.org/pub/repos/apt/ wheezy-pgdg main' $PG_MAJOR &gt; /etc/apt/sources.list.d/pgdg.list\nRUN apt-get update \\\n&amp;&amp; apt-get install -y postgresql-common \\\n&amp;&amp; sed -ri 's/#(create_main_cluster) .*$/\\1 = false/' /etc/postgresql-common/createcluster.conf \\\n&amp;&amp; apt-get install -y \\\npostgresql-$PG_MAJOR=$PG_VERSION \\\npostgresql-contrib-$PG_MAJOR=$PG_VERSION \\\n&amp;&amp; rm -rf /var/lib/apt/lists/*\nRUN mkdir -p /var/run/postgresql &amp;&amp; chown -R postgres /var/run/postgresql\nENV PATH /usr/lib/postgresql/$PG_MAJOR/bin:$PATH\nENV PGDATA /var/lib/postgresql/data\nVOLUME /var/lib/postgresql/data\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nEXPOSE 5432\nCMD [\"postgres\"]\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#httpd","title":"httpd","text":"<pre><code>FROM debian:jessie\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\n#RUN groupadd -r www-data &amp;&amp; useradd -r --create-home -g www-data www-data\nENV HTTPD_PREFIX /usr/local/apache2\nENV PATH $PATH:$HTTPD_PREFIX/bin\nRUN mkdir -p \"$HTTPD_PREFIX\" \\\n&amp;&amp; chown www-data:www-data \"$HTTPD_PREFIX\"\nWORKDIR $HTTPD_PREFIX\n# install httpd runtime dependencies\n# https://httpd.apache.org/docs/2.4/install.html#requirements\nRUN apt-get update \\\n&amp;&amp; apt-get install -y --no-install-recommends \\\nlibapr1 \\\nlibaprutil1 \\\nlibpcre++0 \\\nlibssl1.0.0 \\\n&amp;&amp; rm -r /var/lib/apt/lists/*\n# see https://httpd.apache.org/download.cgi#verify\nRUN gpg --keyserver pool.sks-keyservers.net --recv-keys A93D62ECC3C8EA12DB220EC934EA76E6791485A8\nENV HTTPD_VERSION 2.4.12\nENV HTTPD_BZ2_URL https://www.apache.org/dist/httpd/httpd-$HTTPD_VERSION.tar.bz2\nRUN buildDeps=' \\\n  ca-certificates \\\n  curl \\\n  bzip2 \\\n  gcc \\\n  libapr1-dev \\\n  libaprutil1-dev \\\n  libc6-dev \\\n  libpcre++-dev \\\n  libssl-dev \\\n  make \\\n  ' \\\nset -x \\\n&amp;&amp; apt-get update \\\n&amp;&amp; apt-get install -y --no-install-recommends $buildDeps \\\n&amp;&amp; rm -r /var/lib/apt/lists/* \\\n&amp;&amp; curl -SL \"$HTTPD_BZ2_URL\" -o httpd.tar.bz2 \\\n&amp;&amp; curl -SL \"$HTTPD_BZ2_URL.asc\" -o httpd.tar.bz2.asc \\\n&amp;&amp; gpg --verify httpd.tar.bz2.asc \\\n&amp;&amp; mkdir -p src/httpd \\\n&amp;&amp; tar -xvf httpd.tar.bz2 -C src/httpd --strip-components=1 \\\n&amp;&amp; rm httpd.tar.bz2* \\\n&amp;&amp; cd src/httpd \\\n&amp;&amp; ./configure --enable-so --enable-ssl --prefix=$HTTPD_PREFIX \\\n&amp;&amp; make -j\"$(nproc)\" \\\n&amp;&amp; make install \\\n&amp;&amp; cd ../../ \\\n&amp;&amp; rm -r src/httpd \\\n&amp;&amp; sed -ri ' \\\n  s!^(\\s*CustomLog)\\s+\\S+!\\1 /proc/self/fd/1!g; \\\n  s!^(\\s*ErrorLog)\\s+\\S+!\\1 /proc/self/fd/2!g; \\\n  ' /usr/local/apache2/conf/httpd.conf \\\n&amp;&amp; apt-get purge -y --auto-remove $buildDeps\nCOPY httpd-foreground /usr/local/bin/\nEXPOSE 80\nCMD [\"httpd-foreground\"]\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#3dockerfile\u7f16\u5199\u4f18\u5316","title":"3.Dockerfile\u7f16\u5199\u4f18\u5316","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#31-\u4f7f\u7528\u5c0f\u7684\u57fa\u7840\u955c\u50cf","title":"3.1 \u4f7f\u7528\u5c0f\u7684\u57fa\u7840\u955c\u50cf","text":"<p>Docker\u7684\u57fa\u7840\u955c\u50cf\u9009\u62e9</p> <p>\u6211\u4eec\u5728\u4f7f\u7528Docker hub\u6311\u9009Docker\u7684\u57fa\u7840\u955c\u50cf\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u4e86\u5f88\u591a\u7248\u672c\uff0c\u5305\u62ecAlpine\u3001Slim\u3001Stretch\u3001Buster\u3001Jessie\u3001Bullseye\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#\u5b8c\u6574\u955c\u50cf","title":"\u5b8c\u6574\u955c\u50cf","text":"<p>\u6211\u5c06\u4f7f\u7528python\u548cnode\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u662f\u6211\u6700\u5e38\u7528\u7684docker\u955c\u50cf\uff0c\u8fd9\u4e5f\u540c\u6837\u9002\u7528\u4e8e\u4efb\u4f55\u955c\u50cf\u3002</p> <p>\u6839\u636eDockerHub\uff0c\u8fd9\u662f\u4e8b\u5b9e\u4e0a\u7684\u6807\u51c6\u955c\u50cf\uff0c\u5982\u679c\u4f60\u4e0d\u786e\u5b9a\uff0c\u4f60\u5e94\u8be5\u4f7f\u7528\u5b83\u3002</p> <ul> <li> <p>python:3.8.3</p> </li> <li> <p>node:14.1.1</p> </li> </ul> <p>\u8fd9\u4e9b\u955c\u50cf\u57fa\u4e8e\u6700\u65b0\u7684\u7a33\u5b9aDebian\u64cd\u4f5c\u7cfb\u7edf\u53d1\u884c\u7248\u3002 </p> <p>\u5f53\u6211\u8bd5\u56fe\u8ba9\u4e00\u4e2a\u9879\u76ee\u5feb\u901f\u542f\u52a8\u548c\u8fd0\u884c\u65f6\uff0c\u6211\u901a\u5e38\u4f1a\u4ece\u5176\u4e2d\u7684\u4e00\u4e2a\u5f00\u59cb\uff0c\u6211\u5e76\u4e0d\u5173\u5fc3\u6700\u7ec8\u955c\u50cf\u7684\u5927\u5c0f\u3002\u5b8c\u6574\u955c\u50cf\u662f\u6700\u5b89\u5168\u7684\u9009\u62e9</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#busterstretchjessie","title":"buster/stretch/jessie","text":"<ul> <li> <p>buster:Debian 10</p> </li> <li> <p>stretch:Debian 9</p> </li> <li> <p>jessie:Debian 8</p> </li> </ul> <p>\u5e26\u6709stretch\u3001buster\u6216jessie\u6807\u7b7e\u7684\u955c\u50cf\u662f\u4e0d\u540cDebian\u53d1\u884c\u7248\u7684\u4ee3\u53f7\u3002</p> <p>\u6b63\u5728\u5f00\u53d1\u7684\u672a\u6765\u7248\u672c\u662f\u201cbullseye \u201d\u548c\u201cbookworm\u201d\uff0c\u4f46\u8fd8\u4e0d\u7a33\u5b9a\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u5728DockerHub\u4e0a\u7684\u955c\u50cf\u7248\u672c\u5217\u8868\u4e2d\u770b\u5230\u8fd9\u4e9b\u6807\u7b7e\u3002</p> <p>\u5982\u679c\u60a8\u7684\u4ee3\u7801\u4e0eDebian\u64cd\u4f5c\u7cfb\u7edf\u7684\u7279\u5b9a\u7248\u672c\u517c\u5bb9\uff0c\u8bf7\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u955c\u50cf\u3002</p> <p>\u5728\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee\u65f6\uff0c\u4f60\u5f88\u5c11\u9700\u8981\u4f7f\u7528\u65e7\u7248\u672c\u7684Debian\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#slim","title":"slim","text":"<p>slim\u7684\u955c\u50cf\u662f\u5b8c\u6574\u955c\u50cf\u7684\u914d\u5bf9\u7248\u672c\u3002</p> <p>\u8fd9\u4e2a\u955c\u50cf\u901a\u5e38\u53ea\u5b89\u88c5\u8fd0\u884c\u7279\u5b9a\u5de5\u5177\u6240\u9700\u7684\u6700\u5c0f\u5305\u3002</p> <p>\u4ee5python\u4e3a\u4f8b\uff0c\u5c31\u662f\u8fd0\u884cpython\u7684\u6700\u5c0f\u5305\uff0cnode.js\u540c\u7406\u3002</p> <p>\u901a\u8fc7\u7701\u53bb\u8f83\u5c11\u4f7f\u7528\u7684\u5de5\u5177\uff0c\u955c\u50cf\u4f1a\u66f4\u5c0f\u3002\u5982\u679c\u6709\u7a7a\u95f4\u9650\u5236\u4e14\u4e0d\u9700\u8981\u5b8c\u6574\u7248\u672c\uff0c\u8bf7\u4f7f\u7528\u6b64\u955c\u50cf\u3002</p> <p>**\u4f46\u662f\uff0c\u5728\u4f7f\u7528\u8fd9\u4e2a\u955c\u50cf\u65f6\uff0c\u4e00\u5b9a\u8981\u8fdb\u884c\u5f7b\u5e95\u7684\u6d4b\u8bd5\uff01**\u5982\u679c\u60a8\u9047\u5230\u65e0\u6cd5\u89e3\u91ca\u7684\u9519\u8bef\uff0c\u8bf7\u5c1d\u8bd5\u5207\u6362\u5230\u5b8c\u6574\u7684\u955c\u50cf\uff0c\u770b\u770b\u662f\u5426\u80fd\u591f\u89e3\u51b3\u95ee\u9898\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#alpine","title":"alpine","text":"<p>\u8fd9\u4e9b\u662f\u6700\u53d7\u6b22\u8fce\u7684\u955c\u50cf\u53d8\u4f53\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u5c3a\u5bf8\u5f88\u5c0f\u3002</p> <p>\u7136\u800c\uff0c\u4e00\u4e9b\u56e2\u961f\u6b63\u5728\u5f03\u7528alpine\u955c\u50cf\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u955c\u50cf\u53ef\u80fd\u4f1a\u5bfc\u81f4\u96be\u4ee5\u8c03\u8bd5\u7684\u517c\u5bb9\u6027\u95ee\u9898\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5982\u679c\u4f7f\u7528python\u955c\u50cf\uff0c\u4e00\u4e9b wheels\u5c06\u88ab\u6784\u5efa\u6210\u4e0eDebian\u517c\u5bb9\uff0c\u5e76\u4e14\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\uff0c\u624d\u80fd\u4e0e\u57fa\u4e8eapline\u7684\u955c\u50cf\u4e00\u8d77\u5de5\u4f5c\u3002</p> <p>\u4f7f\u7528alpine\u955c\u50cf\u7684\u4e3b\u8981\u539f\u56e0\u662f\u4f7f\u4f60\u5f97\u5230\u7684\u955c\u50cf\u5c3d\u53ef\u80fd\u5c0f\u3002\u57fa\u7840\u955c\u50cf\u5c06\u5c0f\u4e8e5MB\u3002</p> <p>python\u57fa\u7840\u955c\u50cf(\u5c06python\u6dfb\u52a0\u5230\u57fa\u7840alpine\u955c\u50cf)\u76ee\u524d\u662f78.9MB\u3002\u8fd9\u4ecd\u7136\u5f88\u5c0f\u3002</p> <p>\u5982\u679c\u8003\u8651\u5230\u7a7a\u95f4\u95ee\u9898\uff0c\u5f3a\u70c8\u63a8\u8350\u4f7f\u7528\u6b64\u955c\u50cf\u3002</p> <p>\u5b83\u7684\u7f3a\u70b9\u662f\u4e0d\u5305\u542b\u4e00\u4e9b\u4f60\u53ef\u80fd\u4f1a\u9700\u8981\u7684\u5305\u3002</p> <p>\u4e3b\u8981\u662f\uff0c\u5b83\u4f7f\u7528\u4e86\u4e00\u4e2a\u66f4\u5c0f\u7684musl lib\u4ee3\u66ffglibc\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6709\u7279\u5b9a\u7684libc\u9700\u6c42\uff0c\u60a8\u53ef\u80fd\u4f1a\u9047\u5230\u95ee\u9898\u3002</p> <p>\u5982\u679c\u4f60\u53d1\u73b0Alpine\u955c\u50cf\u7f3a\u5c11\u4f60\u9700\u8981\u7684\u4e1c\u897f\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728Dockerfile\u4e2d\u5b89\u88c5\u5b83\uff0c\u8fd9\u6837\u80fd\u786e\u4fdd\u955c\u50cf\u53ea\u5305\u542b\u4f60\u9700\u8981\u7684\u5185\u5bb9\u3002\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u6b63\u5728\u5b89\u88c5\u5916\u90e8\u5305\uff0c\u60a8\u7684Dockerfile\u5c06\u4f1a\u66f4\u6539\u3002</p> <p>\u4e3b\u8981\u7684\u533a\u522b\u662f\uff0c\u60a8\u5c06\u4f7f\u7528apk\u800c\u4e0d\u662fapt-get\u6765\u5b89\u88c5\u5305\u3002</p> <p>\u5bf9alpine\u955c\u50cf\u7684\u4f7f\u7528\u6709\u5f88\u591a\u62c5\u5fc3\u4e4b\u5904\uff0c\u6240\u4ee5\u4f60\u9700\u8981\u5145\u5206\u4e86\u89e3\u5b83\u3002</p> <p>\u9700\u8981\u5145\u5206\u9605\u8bfb\u6587\u6863\u5e76\u7814\u7a76\u3002 \u540c\u6837\uff0c\u5982\u679c\u60a8\u5728\u6784\u5efaDockerfile\u65f6\u9047\u5230\u4e86\u65e0\u6cd5\u89e3\u91ca\u7684\u95ee\u9898\uff0c\u8bf7\u5c1d\u8bd5\u5207\u6362\u5230\u5b8c\u6574\u7684\u955c\u50cf\uff0c\u770b\u770b\u662f\u5426\u80fd\u89e3\u51b3\u95ee\u9898\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#\u5982\u4f55\u9009\u62e9\u955c\u50cf","title":"\u5982\u4f55\u9009\u62e9\u955c\u50cf","text":"<p>\u4ee5\u4e0b\u662f\u6211\u4f7f\u7528\u7684\u901a\u7528\u51c6\u5219\uff1a</p> <ul> <li> <p>\u5982\u679c\u6211\u9700\u8981\u5feb\u901f\u542f\u52a8\u5e76\u8fd0\u884c\u9879\u76ee\uff0c\u6ca1\u6709\u7a7a\u95f4\u9650\u5236\uff0c\u5e76\u4e14\u6ca1\u6709\u65f6\u95f4\u8fdb\u884c\u592a\u591a\u6d4b\u8bd5\uff0c\u90a3\u4e48\u6211\u5c31\u4f7f\u7528\u5b9e\u9645\u7684\u6807\u51c6\u955c\u50cf\u3002 \u6211\u6700\u5173\u5fc3\u7684\u662f\u955c\u50cf\u6709\u6211\u9700\u8981\u7684\u6240\u6709\u4e1c\u897f\uff0c\u955c\u50cf\u5927\u5c0f\u5e76\u4e0d\u5173\u5fc3\u3002</p> </li> <li> <p>\u5982\u679c\u7a7a\u95f4\u662f\u4e00\u4e2a\u95ee\u9898\uff0c\u5e76\u4e14\u6211\u77e5\u9053\u6211\u53ea\u9700\u8981\u6700\u5c0f\u7684\u5305\u6765\u8fd0\u884c\u7279\u5b9a\u7684\u8bed\u8a00\uff0c\u5982python\uff0c\u6211\u4f1a\u9009\u62e9slim</p> </li> <li> <p>\u5bf9\u4e8e\u4e00\u4e9b\u6211\u6709\u65f6\u95f4\u5f7b\u5e95\u6d4b\u8bd5\u7684\u9879\u76ee\uff0c\u5e76\u4e14\u6709\u6781\u7aef\u7684\u7a7a\u95f4\u9650\u5236\uff0c\u6211\u5c06\u4f7f\u7528alpine\u955c\u50cf\u3002\u4f46\u662f\u8981\u6ce8\u610f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u66f4\u957f\u7684\u6784\u5efa\u65f6\u95f4\u548c\u4e0d\u786e\u5b9a\u7684bug\u3002 \u5982\u679c\u60a8\u5728\u5c06docker\u5bb9\u5668\u79fb\u690d\u5230\u65b0\u73af\u5883\u65f6\u9047\u5230\u4e86\u56f0\u96be\uff0c\u6216\u8005\u5728\u6dfb\u52a0\u65b0\u5305\u65f6\u51fa\u73b0\u4e86\u6545\u969c\uff0c\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3aAlpine\u955c\u50cf\u3002</p> </li> <li> <p>\u6700\u540e\uff0c\u6eda\u52a8\u5230\u7279\u5b9a\u955c\u50cf\u7684DockerHub\u9875\u9762\u5e95\u90e8\uff0c\u9605\u8bfb\u6709\u5173\u9009\u62e9\u955c\u50cf\u7684\u5efa\u8bae\u3002</p> </li> </ul>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#\u5173\u4e8e\u7248\u672c\u7684\u8bf4\u660e","title":"\u5173\u4e8e\u7248\u672c\u7684\u8bf4\u660e","text":"<p>\u4e0d\u8981\u5728\u751f\u4ea7\u7cfb\u7edfDockerfile\u4e2d\u4f7f\u7528<code>&lt;image&gt;:latest</code>\u3002</p> <p>\u8fd9\u6837\u505a\u5c06\u603b\u662f\u83b7\u53d6\u6700\u65b0\u7684\u955c\u50cf\uff0c\u5e76\u4e14\u5e94\u7528\u7a0b\u5e8f\u7684\u4f9d\u8d56\u9879\u53ef\u80fd\u4e0e\u672a\u6765\u7684\u7248\u672c\u4e0d\u517c\u5bb9\u3002</p> <p>\u5f53\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee\u65f6\uff0c\u6211\u901a\u5e38\u4f1a\u4ece\u6700\u8fd1\u6807\u8bb0\u7684\u7248\u672c\u5f00\u59cb\uff0c\u8fdb\u884c\u5f7b\u5e95\u7684\u6d4b\u8bd5\uff0c\u7136\u540e\u6839\u636e\u9700\u8981\u5347\u7ea7\uff0c\u5728\u6295\u5165\u751f\u4ea7\u4e4b\u524d\u8fdb\u884c\u5f7b\u5e95\u7684\u6d4b\u8bd5\u3002</p> <p>\u5728\u4e0a\u9762\u7684 Dockerfile\u4e2d\u57fa\u7840\u955c\u50cf\u4f7f\u7528\u6709FROM debian:bullseye-slim, FROM scratch</p> <ul> <li> <p>scratch \u662f\u4e00\u4e2a\u7a7a\u955c\u50cf\uff0c\u4e00\u822c\u7528\u4e0d\u5230\uff0c\u5728\u6784\u5efa\u6700\u57fa\u7840\u7684\u955c\u50cf\u7684\u65f6\u5019\u4f1a\u7528\u5230\u3002</p> </li> <li> <p>debian:bullseye-slim \u662f\u4e00\u4e2a debian \u7cfb\u7edf\u7684 bullseye \u7248\u672c\u7684\u7cbe\u7b80\u7248\u955c\u50cf\u3002\u770b\u7684\u51fa\u6765\uff0c\u4f7f\u7528\u7684\u955c\u50cf\u5f88\u5c0f\u3002</p> </li> </ul> <p>\u4f7f\u7528\u8f83\u5c0f\u7684\u955c\u50cf\u53ef\u4ee5\u66f4\u5feb\u5730\u6784\u5efa\u3001\u63a8\u9001\u548c\u62c9\u53d6 \u955c\u50cf\u3002\u5f80\u5f80\u66f4\u5b89\u5168\uff0c\u56e0\u4e3a\u53ea\u5305\u542b\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u5fc5\u8981\u5e93\u548c\u7cfb\u7edf\u4f9d\u8d56\u9879\u3002</p> <p>\u5c24\u5176\u662f\u5728 CI/CD \u7b49\u6d41\u6c34\u7ebf\u4e2d\uff0c\u5e9e\u5927\u7684 \u57fa\u7840\u955c\u50cf \u5728\u6bcf\u4e2a\u73af\u8282\u90fd\u8981\u6d88\u8017\u4e00\u4e9b\u65f6\u95f4\uff0c\u4ece\u800c\u4f7f\u6d41\u6c34\u7ebf\u7684\u65f6\u95f4\u53d8\u5f97\u5f88\u957f\u3002</p> <p>\u955c\u50cf\u4e4b\u95f4\u7684\u533a\u522b\u4e3b\u8981\u5728\u4e8e\u5e95\u5c42\u7684\u64cd\u4f5c\u7cfb\u7edf</p> <p>\u955c\u50cf\u9009\u62e9\u7c7b\u578b</p> <ul> <li> <p><code>Official Image</code>\uff1a\u5b98\u65b9\u955c\u50cf\uff0c\u6216\u8005\u53eb\u6807\u51c6\u955c\u50cf\uff0c\u4e00\u822c\u7531\u5b98\u65b9\u7ef4\u62a4\u7684\u955c\u50cf\uff0c\u5b83\u662f\u6b63\u786e\u7684\u9009\u62e9\uff0c\u4f46\u662f\u53ef\u80fd\u4e0d\u662f\u6700\u4f18\u7684\u3002\u955c\u50cf\u57fa\u4e8e\u6700\u65b0\u7684\u7a33\u5b9a Debian \u64cd\u4f5c\u7cfb\u7edf\u53d1\u884c\u7248\uff0c\u4e0a\u9762\u7684 \u6709 Dockerfile \u6784\u5efa\u5b8c\u6210\u7684\u955c\u50cf\u5373\u4e3a redis:7 \u7684\u4e00\u4e2a\u5b98\u7f51\u955c\u50cf\u3002</p> </li> <li> <p><code>Debian(bullseye/buster/stretch/jessie)</code>\uff1a\u4e0d\u540c\u7684 Debian Linux \u53d1\u884c\u7248\u955c\u50cf\uff0cjessie(8.0)\uff0cstretch(9.0) \u662f\u6bd4\u8f83\u8001\u65e7\u7684\u7248\u672c,buster(10.0) ,bullseye(11.0)\u4e3a\u8f83\u65b0\u7684\u7248\u672c</p> </li> <li> <p><code>slim</code>\uff1a\u7cbe\u7b80\u7248\uff0c\u5b83\u901a\u5e38\u4f1a\u5b89\u88c5\u8fd0\u884c\u7279\u5b9a\u5de5\u5177\u6240\u9700\u7684\u6700\u5c0f\u5305</p> </li> <li> <p><code>alpine</code>\uff1a\u57fa\u4e8e Alpine Linux\u9879\u76ee\uff0c\u4e13\u95e8\u4e3a\u5728\u5bb9\u5668\u5185\u90e8\u4f7f\u7528\u800c\u6784\u5efa\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002\u76f8\u6bd4\u8f83 Debian \u6765\u8bf4 Alpine \u5f88\u5c0f\u5f88\u5c0f\uff0c\u4f46\u662f\u9700\u8981\u8003\u8651\u4e00\u4e9b\u65f6\u533a\uff0c\u517c\u5bb9\u6027\u95ee\u9898\u3002</p> </li> </ul> <p>\u53c2\u8003\u6587\u732e</p> <p>\u7f16\u5199Dockerfile\u7684\u4e00\u4e9b\u5b9e\u8df5\u7ecf\u9a8c</p> <ul> <li><code>scratch</code>: \u4e00\u4e2a\u660e\u786e\u7684\u7a7a\u955c\u50cf\uff0c\u7279\u522b\u662f\u7528\u4e8e\u5efa\u7acb \"\u4ece\u5934\u5f00\u59cb\" \u7684\u955c\u50cf\u3002</li> </ul> <p>\u5728\u9009\u62e9\u6700\u5c0f\u57fa\u7840\u955c\u50cf\u7684\u540c\u65f6\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u5b89\u88c5\u4e0d\u5fc5\u8981\u7684\u8f6f\u4ef6\u5305</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#32-\u6307\u4ee4\u94fe\u5f0f\u8fd0\u884c","title":"3.2 \u6307\u4ee4\u94fe\u5f0f\u8fd0\u884c","text":"<p>\u53ef\u4ee5\u5f88\u660e\u663e\u7684\u53d1\u73b0\uff0c\u4e0a\u9762 Dockerfile \u4e2d\u7684 RUN \u6307\u4ee4\u5f88\u957f</p> <p>\u8fd9\u662f\u7531\u4e8e\u6bcf\u4e2a\u6307\u4ee4\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u53ef\u7f13\u5b58\u5355\u5143\u5e76\u6784\u5efa\u4e00\u4e2a\u65b0\u7684\u4e2d\u95f4\u955c\u50cf\u5c42\u3002 \u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u94fe\u63a5\u6240\u6709\u547d\u4ee4\u6765\u907f\u514d\u8fc7\u591a\u5c42\u7ea7\u3002</p> <p>\u6b64\u5916\uff0c\u5c3d\u91cf\u907f\u514d\u94fe\u63a5\u8fc7\u591a\u7684\u53ef\u7f13\u5b58 RUN \u547d\u4ee4\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5bfc\u81f4\u521b\u5efa\u5927\u578b\u7f13\u5b58\u5e76\u6700\u7ec8\u5bfc\u81f4\u7f13\u5b58\u7a81\u53d1\u3002</p> <p>\u5c06\u6240\u6709\u7684RUN\u6307\u4ee4\u5408\u5e76\u4e3a\u4e00\u4e2a</p> <pre><code>FROM ubuntu\nADD . /app\nRUN apt-get update \\  &amp;&amp; apt-get install -y nodejs \\\n&amp;&amp; cd /app \\\n&amp;&amp; npm install\nCMD npm start\n</code></pre> <pre><code>RUN set -eux; \\\n\\\nsavedAptMark=\"$(apt-mark showmanual)\"; \\\napt-get update; \\\napt-get install -y --no-install-recommends \\\nca-certificates \\\nwget \\\n\\\ndpkg-dev \\\ngcc \\\nlibc6-dev \\\nlibssl-dev \\\nmake \\\n; \\\nrm -rf /var/lib/apt/lists/*; \\\n\\\nwget -O redis.tar.gz \"$REDIS_DOWNLOAD_URL\"; \\\n..................\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#33-\u53d8\u52a8\u7684\u6307\u4ee4\u653e\u5230\u6700\u540e","title":"3.3 \u53d8\u52a8\u7684\u6307\u4ee4\u653e\u5230\u6700\u540e","text":"<p>\u5728 RUN \u4e4b\u540e\u653e\u7f6e COPY \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u5bf9\u4ee3\u7801\u8fdb\u884c\u4e86\u7ec6\u5fae\u7684\u66f4\u6539\uff0c\u5e76\u4e14\u9700\u8981\u53cd\u590d\u4ece dockerfile \u6784\u5efa\u955c\u50cf\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06 COPY \u547d\u4ee4\u653e\u5728 RUN \u547d\u4ee4\u4e4b\u540e\u5c06\u6709\u52a9\u4e8e\u51cf\u5c0f\u955c\u50cf\u5927\u5c0f\uff0c\u56e0\u4e3a\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b docker \u5c06\u80fd\u591f\u66f4\u597d\u5730\u4f7f\u7528\u7f13\u5b58\u529f\u80fd\u3002</p> <p>\u5b83\u5c06\u4e3a\u5b89\u88c5\u4e86\u4f9d\u8d56\u9879\u7684\u955c\u50cf\u521b\u5efa\u7f13\u5b58\uff0c\u6bcf\u6b21\u66f4\u6539\u4ee3\u7801\u65f6\uff0cdocker \u90fd\u4f1a\u4f7f\u7528\u8be5\u7f13\u5b58\u5e76\u521b\u5efa\u955c\u50cf\u3002\u5b83\u8fd8\u5c06\u51cf\u5c11 docker \u6784\u5efa\u65f6\u95f4\u3002</p> <p>\u6240\u4ee5 <code>\u59cb\u7ec8\u5c06\u6700\u5e38\u66f4\u6539\u7684\u6307\u4ee4\u653e\u5728\u672b\u5c3e</code>\u3002\u4f1a\u63d0\u9ad8\u6784\u5efa\u901f\u5ea6.</p> <pre><code>FROM python:3.9-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install -r /requirements.txt\nCOPY app.py .\n</code></pre> <pre><code>FROM ubuntu:latest\nRUN apt update -y &amp;&amp; \\\napt install unzip -y --no-install-recommends &amp;&amp; \\\napt install curl --no-install-recommends -y &amp;&amp; \\\napt install python3 -y --no-install-recommends &amp;&amp; \\\nrm -rf /var/lib/apt/lists/*\nCOPY file /home/ubuntu\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#34-\u9996\u9009\u6570\u7ec4\u800c\u4e0d\u662f\u5b57\u7b26\u4e32\u8bed\u6cd5","title":"3.4 \u9996\u9009\u6570\u7ec4\u800c\u4e0d\u662f\u5b57\u7b26\u4e32\u8bed\u6cd5","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u7f16\u5199 \u6700\u540e\u7684\u8fdb\u7a0b\u542f\u52a8 \u547d\u4ee4 ENTRYPOINT</p> <p>\u6570\u7ec4\uff1a<code>ENTRYPOINT [\"python\",\"-m\",\"http.server\",\"33333\"]</code> \u5b57\u7b26\u4e32\uff1a<code>ENTRYPOINT \"python -m http.server 33333\"</code></p> <p>\u6570\u7ec4\u5f62\u5f0f\u662f\u9996\u9009\u3002 \u8fd9\u662f\u56e0\u4e3a\u4f7f\u7528\u5b57\u7b26\u4e32\u5f62\u5f0f\u4f1a\u5bfc\u81f4 Docker \u4f7f\u7528 bash \u8fd0\u884c\u60a8\u7684\u8fdb\u7a0b\uff0c\u8fd9\u65e0\u6cd5\u6b63\u786e\u5904\u7406\u4fe1\u53f7\u3002 \u7531\u4e8e\u5927\u591a\u6570 shell \u4e0d\u5904\u7406\u5b50\u8fdb\u7a0b\u7684\u4fe1\u53f7\uff0c\u56e0\u6b64\u5982\u679c\u4f7f\u7528 shell \u683c\u5f0f\uff0cCTRL-C\uff08\u751f\u6210 SIGTERM\uff09\u53ef\u80fd\u4e0d\u4f1a\u505c\u6b62\u5b50\u8fdb\u7a0b\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#35-\u6bcf\u4e2arun\u6307\u4ee4\u540e\u5220\u9664\u591a\u4f59\u6587\u4ef6","title":"3.5 \u6bcf\u4e2aRUN\u6307\u4ee4\u540e\u5220\u9664\u591a\u4f59\u6587\u4ef6","text":"<p>\u793a\u4f8bDockerfile\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5220\u9664/var/lib/apt/lists/\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\uff08\u5b83\u4eec\u662f\u7531apt-get update\u751f\u6210\u7684\uff09\u3002</p> <pre><code>FROM ubuntu:20.04\nRUN apt-get update \\  &amp;&amp; apt-get install -y nodejs \\\n# added lines\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\nADD . /app  RUN cd /app &amp;&amp; npm install\nCMD npm start\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#36-copy\u800c\u4e0d\u662fadd","title":"3.6 COPY\u800c\u4e0d\u662fADD","text":"<pre><code># \u683c\u5f0f\nCOPY &lt;src&gt; &lt;dest&gt;\nCOPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;\u6e90\u8def\u5f841&gt;...  &lt;\u76ee\u6807\u8def\u5f84&gt;\nCOPY [--chown=&lt;user&gt;:&lt;group&gt;] [\"&lt;\u6e90\u8def\u5f841&gt;\",...  \"&lt;\u76ee\u6807\u8def\u5f84&gt;\"]\n# [--chown=&lt;user&gt;:&lt;group&gt;]\uff1a\u53ef\u9009\u53c2\u6570\uff0c\u7528\u6237\u6539\u53d8\u590d\u5236\u5230\u5bb9\u5668\u5185\u6587\u4ef6\u7684\u62e5\u6709\u8005\u548c\u5c5e\u7ec4\u3002\n# \u590d\u5236\u672c\u5730\u4e3b\u673a\u7684 `&lt;src&gt;`\uff08\u4e3a Dockerfile \u6240\u5728\u76ee\u5f55\u7684\u76f8\u5bf9\u8def\u5f84\uff09\u5230\u5bb9\u5668\u4e2d\u7684 `&lt;dest&gt;`\n</code></pre> <p>\u5982\u679c\u6709\u591a\u4e2a\u6b65\u9aa4\u4f7f\u7528\u4e0a\u4e0b\u6587\u4e2d\u7684\u4e0d\u540c\u6587\u4ef6\uff0c\u8bf7\u5355\u72ec\u590d\u5236\u5b83\u4eec\uff0c\u800c\u4e0d\u662f\u4e00\u6b21\u5168\u90e8\u590d\u5236\u3002</p> <p>\u8fd9\u53ef\u786e\u4fdd\u6bcf\u4e2a\u6b65\u9aa4\u7684\u751f\u6210\u7f13\u5b58\u4ec5\u5931\u6548\uff0c\u5e76\u5728\u7279\u522b\u9700\u8981\u7684\u6587\u4ef6\u53d1\u751f\u66f4\u6539\u65f6\u5f3a\u5236\u91cd\u65b0\u8fd0\u884c\u8be5\u6b65\u9aa4\u3002</p> <pre><code>COPY requirements.txt /tmp/\nRUN pip install --requirement /tmp/requirements.txt\nCOPY . /tmp/\n</code></pre> <p>\u62f7\u8d1d\u76ee\u5f55\u7684\u4e00\u4e2a\u5751</p> <p>\u62f7\u8d1d\u6587\u4ef6\u4e0d\u9700\u8981\u5199\u76ee\u6807 <pre><code># \u62f7\u8d1d\u6587\u4ef6\nFROM centos\nCOPY 2.txt /usr/local/\n</code></pre></p> <p>\u62f7\u8d1d\u76ee\u5f55\u5219\u9700\u8981\u8fd9\u6837\u5199,\u76ee\u6807,\u4e0d\u7136\u62f7\u8d1d\u4e0d\u8fdb\u53bb</p> <pre><code># \u62f7\u8d1d\u76ee\u5f55\nFROM centos\nCOPY mysql /usr/local/mysql\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#37-\u4f7f\u7528dockerignore","title":"3.7 \u4f7f\u7528.dockerignore","text":"<p><code>.dockerignore</code>\u6587\u4ef6\u7684\u4f5c\u7528\u7c7b\u4f3c\u4e8egit\u5de5\u7a0b\u4e2d\u7684 .gitignore \u3002\u4e0d\u540c\u7684\u662f .dockerignore \u5e94\u7528\u4e8e docker \u955c\u50cf\u7684\u6784\u5efa\uff0c\u5b83\u5b58\u5728\u4e8e docker \u6784\u5efa\u4e0a\u4e0b\u6587\u7684\u6839\u76ee\u5f55\uff0c\u7528\u6765\u5ffd\u7565\u4e0d\u9700\u8981\u6253\u5165\u955c\u50cf\u7684\u6587\u4ef6</p> <p><code>.dockerignore</code>\u6587\u4ef6\u7684\u5199\u6cd5\u548c .gitignore \u7c7b\u4f3c\uff0c\u652f\u6301\u6b63\u5219\u548c\u901a\u914d\u7b26\uff0c\u5177\u4f53\u89c4\u5219\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u6bcf\u884c\u4e3a\u4e00\u4e2a\u6761\u76ee\uff1b</p> </li> <li> <p>\u4ee5 # \u5f00\u5934\u7684\u884c\u4e3a\u6ce8\u91ca\uff1b</p> </li> <li> <p>\u7a7a\u884c\u88ab\u5ffd\u7565\uff1b</p> </li> <li> <p>\u6784\u5efa\u4e0a\u4e0b\u6587\u8def\u5f84\u4e3a\u6240\u6709\u6587\u4ef6\u7684\u6839\u8def\u5f84\uff1b</p> </li> </ul> \u89c4\u5219 \u884c\u4e3a /temp \u5339\u914d\u6839\u8def\u5f84\u4e0b\u4e00\u7ea7\u76ee\u5f55\u4e0b\u6240\u6709\u4ee5 temp \u5f00\u5934\u7684\u6587\u4ef6\u6216\u76ee\u5f55 //temp* \u5339\u914d\u6839\u8def\u5f84\u4e0b\u4e24\u7ea7\u76ee\u5f55\u4e0b\u6240\u6709\u4ee5 temp \u5f00\u5934\u7684\u6587\u4ef6\u6216\u76ee\u5f55 temp? \u5339\u914d\u6839\u8def\u5f84\u4e0b\u4ee5 temp \u5f00\u5934\uff0c\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u7ed3\u5c3e\u7684\u6587\u4ef6\u6216\u76ee\u5f55 **/*.go \u5339\u914d\u6240\u6709\u8def\u5f84\u4e0b\u4ee5 .go \u7ed3\u5c3e\u7684\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u5373\u9012\u5f52\u641c\u7d22\u6240\u6709\u8def\u5f84 *.md !README.md \u5339\u914d\u6839\u8def\u5f84\u4e0b\u6240\u6709\u4ee5 .md \u7ed3\u5c3e\u7684\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u4f46 README.md \u9664\u5916"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#38-\u5229\u7528\u591a\u9636\u6bb5\u6784\u5efa","title":"3.8 \u5229\u7528\u591a\u9636\u6bb5\u6784\u5efa","text":"<p>\u591a\u9636\u6bb5\u6784\u5efa\u53ef\u4ee5\u8ba9\u6211\u4eec\u5927\u5e45\u5ea6\u51cf\u5c0f\u6700\u7ec8\u7684\u955c\u50cf\u5927\u5c0f\uff0c\u800c\u4e0d\u9700\u8981\u53bb\u60f3\u529e\u6cd5\u51cf\u5c11\u4e2d\u95f4\u5c42\u548c\u6587\u4ef6\u7684\u6570\u91cf\u3002\u56e0\u4e3a\u955c\u50cf\u662f\u5728\u751f\u6210\u8fc7\u7a0b\u7684\u6700\u540e\u9636\u6bb5\u751f\u6210\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5229\u7528\u751f\u6210\u7f13\u5b58\u6765\u6700\u5c0f\u5316\u955c\u50cf\u5c42\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u7684\u6784\u5efa\u5305\u542b\u591a\u4e2a\u5c42\uff0c\u5219\u53ef\u4ee5\u5c06\u5b83\u4eec\u4ece\u53d8\u5316\u9891\u7387\u8f83\u4f4e\uff08\u4ee5\u786e\u4fdd\u751f\u6210\u7f13\u5b58\u53ef\u91cd\u7528\uff09\u5230\u53d8\u5316\u9891\u7387\u8f83\u9ad8\u7684\u987a\u5e8f\u6392\u5e8f\uff1a</p> <ul> <li>\u5b89\u88c5\u6784\u5efa\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u4f9d\u8d56\u5de5\u5177</li> <li>\u5b89\u88c5\u6216\u66f4\u65b0\u4f9d\u8d56\u9879</li> <li>\u6784\u5efa\u4f60\u7684\u5e94\u7528</li> </ul> <p>\u6bd4\u5982\u6211\u4eec\u6784\u5efa\u4e00\u4e2a Go \u5e94\u7528\u7a0b\u5e8f\u7684 Dockerfile \u53ef\u80fd\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a</p> <pre><code>FROM golang:1.11-alpine AS build\n# \u5b89\u88c5\u9879\u76ee\u9700\u8981\u7684\u5de5\u5177\n# \u8fd0\u884c `docker build --no-cache .` \u6765\u66f4\u65b0\u4f9d\u8d56\nRUN apk add --no-cache git\nRUN go get github.com/golang/dep/cmd/dep\n\n# \u901a\u8fc7 Gopkg.toml \u548c Gopkg.lock \u83b7\u53d6\u9879\u76ee\u7684\u4f9d\u8d56\n# \u4ec5\u5728\u66f4\u65b0 Gopkg \u6587\u4ef6\u65f6\u624d\u91cd\u65b0\u6784\u5efa\u8fd9\u4e9b\u5c42\nCOPY Gopkg.lock Gopkg.toml /go/src/project/\nWORKDIR /go/src/project/\n# \u5b89\u88c5\u4f9d\u8d56\u5e93\nRUN dep ensure -vendor-only\n\n# \u62f7\u8d1d\u6574\u4e2a\u9879\u76ee\u8fdb\u884c\u6784\u5efa\n# \u5f53\u9879\u76ee\u4e0b\u9762\u6709\u6587\u4ef6\u53d8\u5316\u7684\u65f6\u5019\u8be5\u5c42\u624d\u4f1a\u91cd\u65b0\u6784\u5efa\nCOPY . /go/src/project/\nRUN go build -o /bin/project\n\n# \u5c06\u6253\u5305\u540e\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u62f7\u8d1d\u5230 scratch \u955c\u50cf\u4e0b\u9762\uff0c\u5c06\u955c\u50cf\u5927\u5c0f\u964d\u5230\u6700\u4f4e\nFROM scratch\nCOPY --from=build /bin/project /bin/project\nENTRYPOINT [\"/bin/project\"]\nCMD [\"--help\"]\n</code></pre> <p>\u5176\u4ed6\u793a\u4f8bDockerfile</p> <pre><code># \u6784\u5efa\uff1a\u4f7f\u7528golang:1.13\u7248\u672c\nFROM golang:1.13 as build\n# \u5bb9\u5668\u73af\u5883\u53d8\u91cf\u6dfb\u52a0\uff0c\u4f1a\u8986\u76d6\u9ed8\u8ba4\u7684\u53d8\u91cf\u503c\nENV GO111MODULE=on\nENV GOPROXY=https://goproxy.cn,direct\n\n# \u8bbe\u7f6e\u5de5\u4f5c\u533a\nWORKDIR /go/release\n# \u628a\u5168\u90e8\u6587\u4ef6\u6dfb\u52a0\u5230/go/release\u76ee\u5f55\nADD . .\n\n# \u7f16\u8bd1\uff1a\u628acmd/main.go\u7f16\u8bd1\u6210\u53ef\u6267\u884c\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u547d\u540d\u4e3aapp\nRUN GOOS=linux CGO_ENABLED=0 GOARCH=amd64 go build -ldflags=\"-s -w\" -installsuffix cgo -o app cmd/main.go\n\n# \u8fd0\u884c\uff1a\u4f7f\u7528scratch\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\nFROM scratch as prod\n# \u5728build\u9636\u6bb5\u590d\u5236\u65f6\u533a\u5230\nCOPY --from=build /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n# \u5728build\u9636\u6bb5\u590d\u5236\u53ef\u6267\u884c\u7684go\u4e8c\u8fdb\u5236\u6587\u4ef6app\nCOPY --from=build /go/release/app /\n# \u5728build\u9636\u6bb5\u590d\u5236\u914d\u7f6e\u6587\u4ef6\nCOPY --from=build /go/release/config ./config\n\n# \u542f\u52a8\u670d\u52a1\nCMD [\"/app\"]\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u8bed\u53e5\u3002\u6bcf\u4e2a\u6307\u4ee4\u90fd\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u57fa\u7840\uff0c\u5e76\u4e14\u6bcf\u4e2a\u6307\u4ee4\u90fd\u5f00\u59cb\u6784\u5efa\u7684\u65b0\u9636\u6bb5\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6709\u9009\u62e9\u5730\u5c06\u4f2a\u5f71\u4ece\u4e00\u4e2a\u9636\u6bb5\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u9636\u6bb5\uff0c\u5728\u6700\u7ec8\u955c\u50cf\u4e2d\u7559\u4e0b\u6211\u4eec\u4e0d\u60f3\u8981\u7684\u6240\u6709\u5185\u5bb9\u3002</p> <pre><code>#syntax=docker/dockerfile:1.4\nFROM \u2026 AS build1\nCOPY \u2013from=app1 . /src\n\nFROM \u2026 AS build2\nCOPY \u2013from=app2 . /src\n\nFROM \u2026\nCOPY --from=build1 /out/app1 /bin/\nCOPY \u2013-from=build2 /out/app2 /bin/\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>\u591a\u9636\u6bb5\u6784\u5efaGolang\u7a0b\u5e8fDocker\u955c\u50cf</p> <pre><code># Official docker build image, Using  node:14.17-alpine3.14 image for stage-1.\n# Stage-1\nFROM node:14.17-alpine3.14 as build\n# Copy Required files\nCOPY public /home/app/public/\nCOPY src /home/app/src/\n# dockerfile install multiple packages\nRUN apk add g++ make python2\nRUN npm install --silent\n# Create Build\nRUN npm run build\nRUN apk --purge del python2\n#Run the build by copying the files form previous stage.\n# Stage-2\nFROM nginx:stable-alpine\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\nCOPY --from=build /home/app/build /usr/share/nginx/html\nEXPOSE 80\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#39-\u5199dockerfile\u7684\u4e00\u4e9b\u6280\u5de7","title":"3.9 \u5199Dockerfile\u7684\u4e00\u4e9b\u6280\u5de7","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#1\u7528-python--m-pip-\u800c\u4e0d\u662f-pip","title":"1.\u7528 python -m pip \u800c\u4e0d\u662f pip","text":"<pre><code># \u5347\u7ea7 pip,\u8ba9 pip install \u66f4\u5b89\u9759,--quiet \u53c2\u6570\n$ python -m pip install --quiet --upgrade pip\n\n# pip\u4f7f\u7528\u56fd\u5185\u6e90\n$ python -m pip install --quiet --upgrade pip \\\n&amp;&amp; pip install -i https://pypi.tuna.tsinghua.edu.cn/simple --no-cache-dir -r requirements.txt\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#2\u8ba9-apt-get-install-\u66f4\u5b89\u9759","title":"2.\u8ba9 apt-get install \u66f4\u5b89\u9759","text":"<pre><code>#\u6211\u4eec\u7528 -qq \u547d\u4ee4\uff0c\u751a\u81f3\u91cd\u5b9a\u5411\u8f93\u51fa\u5230 /dev/null \u8ba9\u5b83\u66f4\u5b89\u9759\u3002\n$ apt-get -qq update\n$ apt-get -qq install -y curl &gt; /dev/null\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#3\u8ba9-curl-\u548c-wget-\u66f4\u5b89\u9759","title":"3.\u8ba9 curl \u548c wget \u66f4\u5b89\u9759","text":"<pre><code># \u9996\u5148\uff0c\u5982\u679c\u8981\u4e0b\u8f7d\u6587\u4ef6\uff0ccurl \u548c wget \u4e8c\u9009\u4e00\u5373\u53ef\u3002\u5982\u679c\u7528 curl\uff0c\u53ef\u4ee5\u7528 --silent \u53c2\u6570\u3002\n$ curl -sLO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64\n\n#wget \u6709 --quiet \u53c2\u6570\u3002\n$ wget -q https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#4\u7528axel\u800c\u4e0d\u662fcurl\u6216\u8005wget","title":"4.\u7528axel\u800c\u4e0d\u662fcurl\u6216\u8005wget","text":"<p>\u5bf9\u4e8e\u8eab\u5904\u56fd\u5185\u7684\u5f00\u53d1\u8005\uff0caxel \u5b8c\u5168\u53ef\u4ee5\u53d6\u4ee3 curl \u4ee5\u53ca wget <pre><code>echo \"Install Go compiler ...\"\nGO_MIRROR_0=\"http://mirrors.ustc.edu.cn/golang/go1.13.4.linux-amd64.tar.gz\"\nGO_MIRROR_1=\"https://dl.google.com/go/go1.13.4.linux-amd64.tar.gz\"\naxel --quiet --output go.tar.gz $GO_MIRROR_0 $GO_MIRROR_1\n</code></pre></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#5\u8bbe\u7f6e\u5bb9\u5668\u65f6\u95f4\u540c\u6b65","title":"5.\u8bbe\u7f6e\u5bb9\u5668\u65f6\u95f4\u540c\u6b65","text":"<pre><code>#\u8bbe\u7f6e\u5bb9\u5668\u65f6\u95f4\u4e0e\u5bbf\u4e3b\u673a\u65f6\u95f4\u540c\u6b65\nRUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo 'Asia/Shanghai' &gt;/etc/timezone\n</code></pre> <p>Dockerfile\u4e2d\u914d\u7f6e\u65f6\u533a <pre><code>FROM docker.io/centos\nMAINTAINER DAVID\n# \u4f7f\u7528RUN\u547d\u4ee4\u8bbe\u7f6e\u65f6\u533a\nRUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo 'Asia/Shanghai'&gt;/etc/timezone\n</code></pre></p> <p>docker-compose.yaml\u8bbe\u7f6e\u65f6\u533a</p> <pre><code>\u65b9\u5f0f\u4e00\uff1a\nenvironment:\n- SET_CONTAINER_TIMEZONE=true\n- CONTAINER_TIMEZONE=Asia/Shanghai\n</code></pre> <pre><code>\u65b9\u5f0f\u4e8c\uff1a\nenvironment:\n- TZ=Asia/Shanghai\n</code></pre> <p>\u5199 Dockerfile \u7684\u4e00\u4e9b\u6280\u5de7</p> <p>https://zhuanlan.zhihu.com/p/147995194</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#310-docker-build\u955c\u50cf\u521b\u5efa","title":"3.10 docker build\u955c\u50cf\u521b\u5efa","text":"<p>\u901a\u8fc7Dockerfile\u521b\u5efadocker\u955c\u50cf</p> <pre><code>docker build [OPTIONS] PATH | URL | -\n</code></pre> <pre><code>--build-arg=[] :\u8bbe\u7f6e\u955c\u50cf\u521b\u5efa\u65f6\u7684\u53d8\u91cf\uff1b\n--cpu-shares :\u8bbe\u7f6e cpu \u4f7f\u7528\u6743\u91cd\uff1b\n--cpu-period :\u9650\u5236 CPU CFS\u5468\u671f\uff1b\n--cpu-quota :\u9650\u5236 CPU CFS\u914d\u989d\uff1b\n--cpuset-cpus :\u6307\u5b9a\u4f7f\u7528\u7684CPU id\uff1b\n--cpuset-mems :\u6307\u5b9a\u4f7f\u7528\u7684\u5185\u5b58 id\uff1b\n--disable-content-trust :\u5ffd\u7565\u6821\u9a8c\uff0c\u9ed8\u8ba4\u5f00\u542f\uff1b\n-f :\u6307\u5b9a\u8981\u4f7f\u7528\u7684Dockerfile\u8def\u5f84\uff1b\n--force-rm :\u8bbe\u7f6e\u955c\u50cf\u8fc7\u7a0b\u4e2d\u5220\u9664\u4e2d\u95f4\u5bb9\u5668\uff1b\n--isolation :\u4f7f\u7528\u5bb9\u5668\u9694\u79bb\u6280\u672f\uff1b\n--label=[] :\u8bbe\u7f6e\u955c\u50cf\u4f7f\u7528\u7684\u5143\u6570\u636e\uff1b\n-m :\u8bbe\u7f6e\u5185\u5b58\u6700\u5927\u503c\uff1b\n--memory-swap :\u8bbe\u7f6eSwap\u7684\u6700\u5927\u503c\u4e3a\u5185\u5b58+swap\uff0c\"-1\"\u8868\u793a\u4e0d\u9650swap\uff1b\n--no-cache :\u521b\u5efa\u955c\u50cf\u7684\u8fc7\u7a0b\u4e0d\u4f7f\u7528\u7f13\u5b58\uff1b\n--pull :\u5c1d\u8bd5\u53bb\u66f4\u65b0\u955c\u50cf\u7684\u65b0\u7248\u672c\uff1b\n--quiet, -q :\u5b89\u9759\u6a21\u5f0f\uff0c\u6210\u529f\u540e\u53ea\u8f93\u51fa\u955c\u50cf ID\uff1b\n--rm :\u8bbe\u7f6e\u955c\u50cf\u6210\u529f\u540e\u5220\u9664\u4e2d\u95f4\u5bb9\u5668\uff1b\n--shm-size :\u8bbe\u7f6e/dev/shm\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c\u662f64M\uff1b\n--ulimit :Ulimit\u914d\u7f6e\u3002\n--tag, -t: \u955c\u50cf\u7684\u540d\u5b57\u53ca\u6807\u7b7e\uff0c\u901a\u5e38 name:tag \u6216\u8005 name \u683c\u5f0f\uff1b\u53ef\u4ee5\u5728\u4e00\u6b21\u6784\u5efa\u4e2d\u4e3a\u4e00\u4e2a\u955c\u50cf\u8bbe\u7f6e\u591a\u4e2a\u6807\u7b7e\u3002\n--network: \u9ed8\u8ba4 default\u3002\u5728\u6784\u5efa\u671f\u95f4\u8bbe\u7f6eRUN\u6307\u4ee4\u7684\u7f51\u7edc\u6a21\u5f0f\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#311-dockerfile\u53c2\u8003","title":"3.11 dockerfile\u53c2\u8003","text":"<pre><code>FROM buildpack-deps:jessie\n# remove several traces of debian python\nRUN apt-get purge -y python.*\n# http://bugs.python.org/issue19846\n# &gt; At the moment, setting \"LANG=C\" on a Linux system *fundamentally breaks Python 3*, and that's not OK.\nENV LANG C.UTF-8\n# gpg: key F73C700D: public key \"Larry Hastings &lt;larry@hastings.org&gt;\" imported\nENV GPG_KEY 97FC712E4C024BBEA48A61ED3A5CA953F73C700D\nENV PYTHON_VERSION 3.5.1\n# if this is called \"PIP_VERSION\", pip explodes with \"ValueError: invalid truth value '&lt;VERSION&gt;'\"\nENV PYTHON_PIP_VERSION 8.1.2\nRUN set -ex \\\n&amp;&amp; curl -fSL \"https://www.python.org/ftp/python/${PYTHON_VERSION%%[a-z]*}/Python-$PYTHON_VERSION.tar.xz\" -o python.tar.xz \\\n&amp;&amp; curl -fSL \"https://www.python.org/ftp/python/${PYTHON_VERSION%%[a-z]*}/Python-$PYTHON_VERSION.tar.xz.asc\" -o python.tar.xz.asc \\\n&amp;&amp; export GNUPGHOME=\"$(mktemp -d)\" \\\n&amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$GPG_KEY\" \\\n&amp;&amp; gpg --batch --verify python.tar.xz.asc python.tar.xz \\\n&amp;&amp; rm -r \"$GNUPGHOME\" python.tar.xz.asc \\\n&amp;&amp; mkdir -p /usr/src/python \\\n&amp;&amp; tar -xJC /usr/src/python --strip-components=1 -f python.tar.xz \\\n&amp;&amp; rm python.tar.xz \\\n\\\n&amp;&amp; cd /usr/src/python \\\n&amp;&amp; ./configure --enable-shared --enable-unicode=ucs4 \\\n&amp;&amp; make -j$(nproc) \\\n&amp;&amp; make install \\\n&amp;&amp; ldconfig \\\n&amp;&amp; pip3 install --no-cache-dir --upgrade --ignore-installed pip==$PYTHON_PIP_VERSION \\\n&amp;&amp; find /usr/local -depth \\\n\\( \\\n\\( -type d -a -name test -o -name tests \\) \\\n-o \\\n\\( -type f -a -name '*.pyc' -o -name '*.pyo' \\) \\\n\\) -exec rm -rf '{}' + \\\n&amp;&amp; rm -rf /usr/src/python ~/.cache\n# make some useful symlinks that are expected to exist\nRUN cd /usr/local/bin \\\n&amp;&amp; ln -s easy_install-3.5 easy_install \\\n&amp;&amp; ln -s idle3 idle \\\n&amp;&amp; ln -s pydoc3 pydoc \\\n&amp;&amp; ln -s python3 python \\\n&amp;&amp; ln -s python3-config python-config\nCMD [\"python3\"]\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#312-\u6dfb\u52a0healthcheck","title":"3.12 \u6dfb\u52a0HEALTHCHECK","text":"<p>\u8fd0\u884c\u5bb9\u5668\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u2014restart always\u9009\u9879\u3002 \u8fd9\u6837\u7684\u8bdd\uff0c\u5bb9\u5668\u5d29\u6e83\u65f6\uff0cDocker\u5b88\u62a4\u8fdb\u7a0b(docker daemon)\u4f1a\u91cd\u542f\u5bb9\u5668\u3002\u5bf9\u4e8e\u9700\u8981\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u8fd9\u4e2a\u9009\u9879\u975e\u5e38\u6709\u7528\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u5bb9\u5668\u7684\u786e\u5728\u8fd0\u884c\uff0c\u4f46\u662f\u4e0d\u53ef(\u9677\u5165\u6b7b\u5faa\u73af\uff0c\u914d\u7f6e\u9519\u8bef)\u7528\u600e\u4e48\u529e\uff1f</p> <p>\u4f7f\u7528HEALTHCHECK\u6307\u4ee4\u53ef\u4ee5\u8ba9Docker\u5468\u671f\u6027\u7684\u68c0\u67e5\u5bb9\u5668\u7684\u5065\u5eb7\u72b6\u51b5\u3002\u6211\u4eec\u53ea\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u547d\u4ee4\uff0c\u5982\u679c\u4e00\u5207\u6b63\u5e38\u7684\u8bdd\u8fd4\u56de0\uff0c\u5426\u5219\u8fd4\u56de1\u3002</p> <p>\u5bf9HEALTHCHECK\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u535a\u5ba2\u3002\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>FROM node:7-alpine  LABEL maintainer \"jakub.skalecki@example.com\"\nENV PROJECT_DIR=/app  WORKDIR $PROJECT_DIR\nCOPY package.json $PROJECT_DIR  RUN npm install  COPY . $PROJECT_DIR\nENV MEDIA_DIR=/media \\  NODE_ENV=production \\\nAPP_PORT=3000\nVOLUME $MEDIA_DIR  \nEXPOSE $APP_PORT  \nHEALTHCHECK CMD curl --fail http://localhost:$APP_PORT || exit 1\nENTRYPOINT [\"./entrypoint.sh\"]  CMD [\"start\"]\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#4buildkit","title":"4.BuildKit","text":"<p>\u7b80\u5355\u7684\u8bf4\u5c31\u662f\uff1a</p> <p>BuildKit\u6216DOCKER_BUILDKIT=1 \u7279\u6027\u53ef\u4ee5\u5c06docker build\u5b8c\u6210\u7684\u6570\u636e\u8f93\u51fa\u5230\u672c\u5730</p> <p>\u57fa\u4e8eBuildKit\u4f18\u5316Dockerfile\u7684\u6784\u5efa</p> <p>https://mp.weixin.qq.com/s/OjeQsalkthe-YksIe0HtVg </p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#41-\u5b89\u88c5buildx","title":"4.1 \u5b89\u88c5buildx","text":"<pre><code># Buildx 0.6+\n$ docker buildx bake \"https://github.com/docker/buildx.git\"\n$ mkdir -p ~/.docker/cli-plugins\n$ mv ./bin/buildx ~/.docker/cli-plugins/docker-buildx\n\n# Docker 19.03+\n$ DOCKER_BUILDKIT=1 docker build --platform=local -o . \"https://github.com/docker/buildx.git\"\n$ mkdir -p ~/.docker/cli-plugins\n$ mv buildx ~/.docker/cli-plugins/docker-buildx\n\n# Local\n$ git clone https://github.com/docker/buildx.git &amp;&amp; cd buildx\n$ make install\n</code></pre> <p>\u2460 \u7b2c\u4e00\u79cd\u65b9\u5f0f\u4f7f\u7528BuildKit\u7279\u6027\uff0c\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf</p> <pre><code>DOCKER_BUILDKIT=1 docker build .\n</code></pre> <p>\u4e0b\u9762\u7684\u793a\u4f8bDockerfile\u4f7f\u7528\u4e00\u4e2a\u5355\u72ec\u7684\u9636\u6bb5\u6765\u6536\u96c6\u8981\u5bfc\u51fa\u7684\u751f\u6210\u6587\u4ef6\uff1a</p> <p>\u793a\u4f8b1 <pre><code>FROM\nLearn more about the \"FROM\" Dockerfile command.\n golang AS build-stage\nRUN go get -u github.com/LK4D4/vndr\n\nFROM scratch AS export-stage\nCOPY --from=build-stage /go/bin/vndr /\n</code></pre></p> <p>\u793a\u4f8b2 <pre><code>FROM nodejs:buster-slimv1.0 AS builder\nMAINTAINER 1879324764@qq.com\n\nCOPY sources.list /etc/apt/sources.list\nCOPY gitee-ent-web /home/gitee-ent-web\n\nRUN set -eux;\\\napt-get update &amp;&amp; \\\napt-get install -y wget git &amp;&amp; \\\ncd /home/gitee-ent-web &amp;&amp; \\\nyarn install &amp;&amp; \\\nyarn run build-i18n &amp;&amp; \\\nyarn run build-vendor &amp;&amp; \\\nyarn web:prod-ci-runjs\n\nFROM scratch AS export-stage\nCOPY --from=builder /home/gitee-ent-web/dist ./dist\n</code></pre></p> <p>\u2461 \u7b2c\u4e8c\u79cd\u65b9\u5f0f\u4f7f\u7528BuildKit\u7279\u6027</p> <p><pre><code>docker buildx build -o out .\n</code></pre> \u4e0b\u9762\u547d\u4ee4\u4f1a\u5728\u5f53\u524dout\u76ee\u5f55\u4e0b\u751f\u6210\u8f93\u51fa\u7684\u6587\u4ef6\uff0cout\u5982\u679c\u4e0d\u5b58\u5728\u4f1a\u81ea\u52a8\u521b\u5efa</p> <p><pre><code>DOCKER_BUILDKIT=1 docker build -o out .\n</code></pre> \u6216\u8005 <pre><code># \u76f4\u63a5\u4f7f\u7528 docker buildx build \u547d\u4ee4\u6784\u5efa\u955c\u50cf\u3002\ndocker buildx build -o out .\n</code></pre></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#42-buildx\u793a\u4f8b","title":"4.2 buildx\u793a\u4f8b","text":"<p>\u4e00\u4e2ago\u7f16\u8bd1\u73af\u5883\u7684\u4f8b\u5b50 <pre><code>$ ls\nDockerfile  go.mod  main.go\n\n$ cat Dockerfile\nFROM golang:1.12-alpine as dev\nRUN apk add --no-cache git ca-certificates\nRUN adduser -D appuser\nWORKDIR /src\nCOPY . /src/\nCMD CGO_ENABLED=0 go build -o app . &amp;&amp; ./app\n\nFROM dev as build\nRUN CGO_ENABLED=0 go build -o app .\nUSER appuser\nCMD [ \"./app\" ]\nFROM scratch as release\nCOPY --from=build /etc/passwd /etc/group /etc/\nCOPY --from=build /src/app /app\nUSER appuser\nCMD [ \"/app\" ]\nFROM scratch as artifact\nCOPY --from=build /src/app /app\n\nFROM release\n$ DOCKER_BUILDKIT=1 docker build --target artifact --output type=local,dest=. .\n\u6216\u8005\n$ docker buildx build  --output type=local,dest=path/to/output-dir\nAfter the build was complete the app binary was exported:\n\n$ ls\nDockerfile  app  go.mod  main.go\n\n$ ./app\nReady to receive requests on port 8080\n</code></pre></p> <p>\u53c2\u8003\u6587\u732e</p> <p>https://www.yuque.com/morlay/me/docker-buildx</p> <p>\u53c2\u8003\u6587\u732e\uff1ahttps://www.cnblogs.com/yance-dev/p/16499553.html</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#5dockerfile\u5b9e\u8df5","title":"5.Dockerfile\u5b9e\u8df5","text":"<p>Golang/Python\u5e94\u7528\u90e8\u7f72\u5230Docker</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#51-\u6784\u5efanginx\u57fa\u7840\u955c\u50cf","title":"5.1 \u6784\u5efaNginx\u57fa\u7840\u955c\u50cf","text":"<pre><code>FROM centos:7\nLABEL wenlong\nRUN yum install -y gcc gcc-c++ make \\\nopenssl-devel pcre-devel gd-devel \\\niproute net-tools telnet wget curl &amp;&amp; \\\nyum clean all &amp;&amp; \\\nrm -rf /var/cache/yum/*\nRUN wget http://nginx.org/download/nginx-1.15.5.tar.gz &amp;&amp; \\\ntar zxf nginx-1.15.5.tar.gz &amp;&amp; \\\ncd nginx-1.15.5 &amp;&amp; \\\n./configure --prefix=/usr/local/nginx \\\n--with-http_ssl_module \\\n--with-http_stub_status_module &amp;&amp; \\\nmake -j 4 &amp;&amp; make install &amp;&amp; \\\nrm -rf /usr/local/nginx/html/* &amp;&amp; \\\necho \"ok\" &gt;&gt; /usr/local/nginx/html/status.html &amp;&amp; \\\ncd / &amp;&amp; rm -rf nginx-1.15.5* &amp;&amp; \\\nln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nENV PATH $PATH:/usr/local/nginx/sbin\nCOPY nginx.conf /usr/local/nginx/conf/nginx.conf\nWORKDIR /usr/local/nginx\nEXPOSE 80\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#52-\u6784\u5efaphp\u57fa\u7840\u955c\u50cf","title":"5.2 \u6784\u5efaPHP\u57fa\u7840\u955c\u50cf","text":"<pre><code>\u590d\u5236\u4ee3\u7801\nFROM centos:7\nLABEL maintainer wenlong\nRUN yum install epel-release -y &amp;&amp; \\\nyum install -y gcc gcc-c++ make gd-devel libxml2-devel \\\nlibcurl-devel libjpeg-devel libpng-devel openssl-devel \\\nlibmcrypt-devel libxslt-devel libtidy-devel autoconf \\\niproute net-tools telnet wget curl &amp;&amp; \\\nyum clean all &amp;&amp; \\\nrm -rf /var/cache/yum/*\nRUN wget http://docs.php.net/distributions/php-5.6.36.tar.gz &amp;&amp; \\\ntar zxf php-5.6.36.tar.gz &amp;&amp; \\\ncd php-5.6.36 &amp;&amp; \\\n./configure --prefix=/usr/local/php \\\n--with-config-file-path=/usr/local/php/etc \\\n--enable-fpm --enable-opcache \\\n--with-mysql --with-mysqli --with-pdo-mysql \\\n--with-openssl --with-zlib --with-curl --with-gd \\\n--with-jpeg-dir --with-png-dir --with-freetype-dir \\\n--enable-mbstring --with-mcrypt --enable-hash &amp;&amp; \\\nmake -j 4 &amp;&amp; make install &amp;&amp; \\\ncp php.ini-production /usr/local/php/etc/php.ini &amp;&amp; \\\ncp sapi/fpm/php-fpm.conf /usr/local/php/etc/php-fpm.conf &amp;&amp; \\\nsed -i \"90a \\daemonize = no\" /usr/local/php/etc/php-fpm.conf &amp;&amp; \\\nmkdir /usr/local/php/log &amp;&amp; \\\ncd / &amp;&amp; rm -rf php* &amp;&amp; \\\nln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nENV PATH $PATH:/usr/local/php/sbin\nCOPY php.ini /usr/local/php/etc/\nCOPY php-fpm.conf /usr/local/php/etc/\nWORKDIR /usr/local/php\nEXPOSE 9000\nCMD [\"php-fpm\"]\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#53-\u6784\u5efatomcat\u57fa\u7840\u955c\u50cf","title":"5.3 \u6784\u5efaTomcat\u57fa\u7840\u955c\u50cf","text":"<pre><code>FROM centos:7\nLABEL maintainer wenlong\nENV VERSION=8.0.52\nRUN yum install java-1.8.0-openjdk wget curl unzip iproute net-tools -y &amp;&amp; \\\nyum clean all &amp;&amp; \\\nrm -rf /var/cache/yum/*\nRUN wget http://mirrors.shu.edu.cn/apache/tomcat/tomcat-8/v${VERSION}/bin/apache-tomcat-${VERSION}.tar.gz &amp;&amp; \\\ntar zxf apache-tomcat-${VERSION}.tar.gz &amp;&amp; \\\nmv apache-tomcat-${VERSION} /usr/local/tomcat &amp;&amp; \\\nrm -rf apache-tomcat-${VERSION}.tar.gz /usr/local/tomcat/webapps/* &amp;&amp; \\\nmkdir /usr/local/tomcat/webapps/test &amp;&amp; \\\necho \"ok\" &gt; /usr/local/tomcat/webapps/test/status.html &amp;&amp; \\\nsed -i '1a JAVA_OPTS=\"-Djava.security.egd=file:/dev/./urandom\"' /usr/local/tomcat/bin/catalina.sh &amp;&amp; \\\nln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nENV PATH $PATH:/usr/local/tomcat/bin\nWORKDIR /usr/local/tomcat\nEXPOSE 8080\nCMD [\"catalina.sh\", \"run\"]\n</code></pre> <p>\u603b\u7ed3</p> <p>\u4e0a\u9762\u53ef\u4ee5\u770b\u51fapython\u7684\u5e94\u7528\u4e00\u822c\u76f4\u63a5\u8dd1\u5728\u67d0\u4e2apython\u7248\u672c\u7684alpine\u57fa\u7840\u73af\u5883\u4e0b\u7684\uff0c\u800cGloang\u5219\u662f\u5728GO\u7684alpine\u73af\u5883\u4e0b\u5b8c\u6210\u7f16\u8bd1\u4e0e\u6d4b\u8bd5\u540e\uff0c\u7136\u540e\u901a\u8fc7\u591a\u9636\u6bb5\u6784\u5efa\u7684\u7b56\u7565\uff0c \u6700\u540e\u5c06\u7f16\u8bd1\u5b8c\u6210Gloang\u7a0b\u5e8f\u8fd0\u884c\u5728scratch\u955c\u50cf\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c0fGolang\u7a0b\u5e8f\u6700\u7ec8\u7684\u955c\u50cf\u5927\u5c0f\uff0c\u907f\u514d\u6d6a\u8d39\u8d44\u6e90\u3002</p> <p>\u53c2\u8003\u6587\u732e</p> <p>https://www.bococ.cn/Docker/106.html</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#6dockerfile\u5de5\u5177","title":"6.Dockerfile\u5de5\u5177","text":"<p>\u67e5\u770b\u8fd0\u884c\u5bb9\u5668\u7684Dockerfile\u5de5\u5177</p> <p>\u9879\u76ee\u5730\u5740\uff1aWhaler(opens new window)</p> <p>\u9879\u76ee\u8bf4\u660e\uff1a\u80fd\u591f\u67e5\u770b\u5728\u8fd0\u884c\u5bb9\u5668\u7684Dockerfile\u7684\u5de5\u5177\uff0c\u6709\u65f6\u5019\u6211\u4eec\u53ef\u80fd\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u6ca1\u6709Dockerfile\u7684\u5bb9\u5668\uff0c\u5373\u53ef\u501f\u52a9\u6b64\u5de5\u5177\u3002</p> <p>\u76f8\u5173\u6587\u7ae0\uff1a\u535a\u6587\u4ecb\u7ecd</p> <p>\u67e5\u770bdocker\u5bb9\u5668\u8fd0\u884c\u547d\u4ee4\u7684\u6240\u6709\u53c2\u6570</p> <p>\u9879\u76ee\u5730\u5740\uff1arunlike(opens new window)</p> <p>\u9879\u76ee\u8bf4\u660e\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u73b0\u6709\u7684 docker \u5bb9\u5668\uff0c\u6253\u5370\u8fd0\u884c\u5b83\u7684\u526f\u672c\u6240\u9700\u7684\u547d\u4ee4\u884c\u3002</p> <p>\u76f8\u5173\u6587\u7ae0\uff1aREADME</p> <p>\u53ef\u4ee5\u5c06\u8fd0\u884c\u7684docker \u63a8\u5bfc\u53cd\u5199\u4e3adocker-compose\u6587\u4ef6</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/7.Dockerfile/#7\u53c2\u8003\u6587\u732e","title":"7.\u53c2\u8003\u6587\u732e","text":"<p>\u63a8\u8350\u9605\u8bfb</p> <p>Dockerfile \u6700\u4f73\u5b9e\u8df5</p> <p>Dockerfile \u5b9e\u8df5</p> <p>Dockerfile\u90a3\u4e48\u591a\uff0c\u54ea\u4e2a\u624d\u662f\u771f\u6b63\u7684\u6700\u4f73\u5b9e\u8df5\uff1f</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/","title":"8.docker-compose","text":"<p>Docker Compose v2\u5b89\u88c5</p> <p>Docker \u5b98\u65b9\u7528 GO \u8bed\u8a00\u91cd\u5199\u4e86 Docker Compose\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u4e86 docker cli \u7684\u5b50\u547d\u4ee4\uff0c\u79f0\u4e3a Compose V2</p> <pre><code># 1\u3001\u4ece\u9879\u76ee\u53d1\u5e03\u9875\u9762\u4e0b\u8f7d\u9002\u5408\u4f60\u7684\u7cfb\u7edf\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u590d\u5236\u5230$HOME/.docker/cli-plugins\uff0c\u4f5c\u4e3adocker-compose\u6765\u5b89\u88c5Compose V2\n#\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4e0b\u8f7dDocker Compose\u7684\u5f53\u524d\u7a33\u5b9a\u7248\u672c\n# \u8be5\u547d\u4ee4\u4e3a$HOME\u76ee\u5f55\u4e0b\u7684\u7528\u6237\u5b89\u88c5Compose V2\u3002\n$ mkdir -p ~/.docker/cli-plugins/\n$ curl -SL https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o ~/.docker/cli-plugins/docker-compose\n$ chmod +x ~/.docker/cli-plugins/docker-compose\n\n#\u4e3a\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u7528\u6237\u5b89\u88c5Docker Compose\n$ mkdir -p /usr/local/lib/docker/cli-plugins\n$ curl -SL https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o /usr/local/lib/docker/cli-plugins/docker-compose\n$ chmod +x /usr/local/lib/docker/cli-plugins/docker-compose\n\n# \u8bbe\u7f6edocker-compose\u547d\u4ee4\u517c\u5bb9v1\n$ sudo ln -s  /usr/local/lib/docker/cli-plugins/docker-compose /usr/local/bin/docker-compose\n\n# 3\u3001\u6d4b\u8bd5\u5b89\u88c5\n$ docker compose version\nDocker Compose version v2.16.0\n\n$ docker-compose version\nDocker Compose version v2.16.0\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#1docker-compose\u6a21\u677f\u793a\u4f8b","title":"1.docker-compose\u6a21\u677f\u793a\u4f8b","text":"\u793a\u4f8b1\u793a\u4f8b2\u793a\u4f8b3\u793a\u4f8b4docker-compose\u547d\u4ee4 <pre><code>version: '3'\n# \u5b9a\u4e49\u901a\u7528\u914d\u7f6e\nx-common-config: &amp;common-config\nrestart: unless-stopped\nenvironment:\nTZ: Asia/Shanghai\nLANG: en_US.UTF-8\n# \u7f51\u6865xx -&gt; \u65b9\u4fbf\u76f8\u4e92\u901a\u8baf\nnetworks:\nxx:\nipam:\ndriver: default\nconfig:\n- subnet: \"172.22.0.0/24\"\nname: xx # project\u540d\u79f0  eg: \u7b49\u540c\u4e8e docker-compose -f docker-compose-nginx.yml -p nginx up -d \u8fd0\u884c\u65f6\u7684 -p\nservices:\n# tips:\u4e0d\u8981\u4f7f\u7528\u5e26\u4e0b\u5212\u7ebf\u7684\u540d\u79f0 ex:zq_1   \u539f\u56e0\uff1a\u5728\u67d0\u4e9b\u7a0b\u5e8f\u91cc\uff0c\u89e3\u6790\u4e0d\u4e86\u6b64\u6570\u636e\nzq-1:\nimage: xx\n&lt;&lt;: *common-config\nzq2:\nimage: xx\nlinks:                              # \u914d\u7f6e\u6307\u5b9a\u5bb9\u5668\u4e0e\u5f53\u524d\u670d\u52a1\u8fde\u63a5\uff0c \u5e76\u6307\u5b9a\u670d\u52a1\u522b\u540d\n- \"zq1:zk\"\nnetworks:\nxx:\nipv4_address: 172.22.0.11       # \u8bbe\u7f6e\u56fa\u5b9aIP\u5730\u5740\nzq3:\nimage: xx                           # \u955c\u50cf\ncontainer_name: xx                  # \u5bb9\u5668\u540d\u4e3a'xx'\nhostname: localhost                 # \u6307\u5b9a\u5bb9\u5668hostname\n#    restart: always                    # \u6307\u5b9a\u5bb9\u5668\u9000\u51fa\u540e\u7684\u91cd\u542f\u7b56\u7565\u4e3a\u59cb\u7ec8\u91cd\u542f\nrestart: unless-stopped             # \u6307\u5b9a\u5bb9\u5668\u9000\u51fa\u540e\u7684\u91cd\u542f\u7b56\u7565\u4e3a\u59cb\u7ec8\u91cd\u542f\uff0c\u4f46\u662f\u4e0d\u8003\u8651\u5728Docker\u5b88\u62a4\u8fdb\u7a0b\u542f\u52a8\u65f6\u5c31\u5df2\u7ecf\u505c\u6b62\u4e86\u7684\u5bb9\u5668\nvolumes:                            # \u6570\u636e\u5377\u6302\u8f7d\u8def\u5f84\u8bbe\u7f6e,\u5c06\u672c\u673a\u76ee\u5f55\u6620\u5c04\u5230\u5bb9\u5668\u76ee\u5f55\n- \"/xx/my.cnf:/xx/my.cnf\"\n- \"/etc/localtime:/etc/localtime:ro\"  # \u8bbe\u7f6e\u4e0e\u5bbf\u4e3b\u673a\u65f6\u95f4\u540c\u6b65\nenvironment:                        # \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf,\u76f8\u5f53\u4e8edocker run\u547d\u4ee4\u4e2d\u7684-e\nTZ: Asia/Shanghai\nLANG: en_US.UTF-8\nports:                              # \u6620\u5c04\u7aef\u53e3\n- \"xx:xx\"\n- \"10001-10010:10001-10010\"       # \u7aef\u53e3\u7ec4\nlinks:                              # \u914d\u7f6e\u5bb9\u5668\u4e92\u76f8\u8fde\u63a5\n- zq1\n- zq2\nentrypoint: /code/entrypoint.sh     # \u6307\u5b9a\u63a5\u5165\u70b9,\u7528\u4e8e\u5b9a\u4e49\u5bb9\u5668\u542f\u52a8\u4ee5\u540e\u7684\u6267\u884c\u4f53\u7684\ncommand: bundle exec thin -p 3000   # \u8bbe\u7f6e\u5bb9\u5668\u7684\u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4\u3002`CMD/command`\u8bbe\u5b9a\u7684\u547d\u4ee4\u4f1a\u5728`entrypoint`\u4e4b\u540e\u6267\u884c\u3002\ndepends_on:                         # \u89e3\u51b3\u5bb9\u5668\u4f9d\u8d56\u542f\u52a8\u5148\u540e\u95ee\u9898\n- zq1\n- zq2\nnetwork_mode: host # \u5bb9\u5668\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc ( tips:\u6b64\u914d\u7f6e\u548c`ports`/`links`\u4e0d\u53ef\u7ed3\u5408\u4f7f\u7528 )\n# \u65e5\u5fd7\nlogging:\ndriver: \"json-file\"   # \u9ed8\u8ba4\u7684\u6587\u4ef6\u65e5\u5fd7\u9a71\u52a8\noptions:\nmax-size: \"100m\"    # \u5355\u4e2a\u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\u4e3a100m\nmax-file: \"3\"       # \u6700\u591a3\u4e2a\u65e5\u5fd7\u6587\u4ef6\n# \u5bb9\u5668\u6dfb\u52a0\u81ea\u5b9a\u4e49hosts -- \u5f80\u5bb9\u5668\u5185\u7684`/etc/hosts`\u6587\u4ef6\u4e2d\u6dfb\u52a0\u8bb0\u5f55\nextra_hosts:\n- \"test-mysql:192.168.101.91\"\n- \"test-redis:192.168.101.92\"\nzq4:\n# \u6784\u5efa\u955c\u50cf\nbuild:\ncontext: ./test # Dockerfile\u4e0a\u4e0b\u6587\u8def\u5f84\ndockerfile: Dockerfile # \u6307\u5b9a Dockerfile \u6587\u4ef6\u7684\u8def\u5f84 -- tips: Dockerfile\u4e2d\u7684\u8def\u5f84(eg:jar\u8def\u5f84) \u57fa\u4e8e\u4e0a\u9762\u914d\u7f6e\u7684`context`\u8def\u5f84\nimage: docker-compose-test:latest # \u5982\u679c\u8fd9\u4e2a\u65f6\u5019\u6307\u5b9a\u955c\u50cf\u4f1a\u53bb\u76f4\u63a5\u62c9\u53d6\u955c\u50cf\uff0c\u800c\u4e0d\u4f1a\u5148\u901a\u8fc7\u4e0a\u9762\u7684build\u6784\u5efa\u955c\u50cf \uff08 \u53ef\u4ee5\u5148\u901a\u8fc7 `docker-compose up --build` \u5148\u6784\u5efa\u51fa\u955c\u50cf \u518d `docker-compose up -d`\u8fd0\u884c \uff09\n</code></pre> <p>walle.env</p> <pre><code># Set MySQL/Rails environment\nMYSQL_USER=root\nMYSQL_PASSWORD=walle\nMYSQL_DATABASE=walle\nMYSQL_ROOT_PASSWORD=walle\nMYSQL_HOST=db\nMYSQL_PORT=3306\n</code></pre> <pre><code># docker version:  18.06.0+\n# docker-compose version: 1.23.2+\n# OpenSSL version: OpenSSL 1.1.0h\nversion: \"3.7\"\nservices:\nweb:\nimage: alenx/walle-web:2.1\ncontainer_name: walle-nginx\nhostname: nginx-web\nports:\n# \u5982\u679c\u5bbf\u4e3b\u673a80\u7aef\u53e3\u88ab\u5360\u7528\uff0c\u53ef\u81ea\u884c\u4fee\u6539\u4e3a\u5176\u4ed6port(&gt;=1024)\n# 0.0.0.0:\u8981\u7ed1\u5b9a\u7684\u5bbf\u4e3b\u673a\u7aef\u53e3:docker\u5bb9\u5668\u5185\u7aef\u53e380\n- \"80:80\"\ndepends_on:\n- python\nnetworks:\n- walle-net\nrestart: always\npython:\nimage: alenx/walle-python:2.1\ncontainer_name: walle-python\nhostname: walle-python\nenv_file:\n# walle.env\u9700\u548cdocker-compose\u5728\u540c\u7ea7\u76ee\u5f55\n- ./walle.env\ncommand: bash -c \"cd /opt/walle_home/ &amp;&amp; /bin/bash admin.sh migration &amp;&amp;  python waller.py\"\nexpose:\n- \"5000\"\nvolumes:\n- /opt/walle_home/plugins/:/opt/walle_home/plugins/\n- /opt/walle_home/codebase/:/opt/walle_home/codebase/\n- /opt/walle_home/logs/:/opt/walle_home/logs/\n- /root/.ssh:/root/.ssh/\ndepends_on:\n- db\nnetworks:\n- walle-net\nrestart: always\ndb:\nimage: mysql\ncontainer_name: walle-mysql\nhostname: walle-mysql\nenv_file:\n- ./walle.env\ncommand: [ '--default-authentication-plugin=mysql_native_password', '--character-set-server=utf8mb4', '--collation-server=utf8mb4_unicode_ci']\nports:\n- \"3306:3306\"\nexpose:\n- \"3306\"\nvolumes:\n- /data/walle/mysql:/var/lib/mysql\nnetworks:\n- walle-net\nrestart: always\nnetworks:\nwalle-net:\ndriver: bridge\n</code></pre> <pre><code>version: \"3\"\nservices:\nredis:\nimage: redis:alpine\nports:\n- \"6379\"\nnetworks:\n- frontend\ndeploy:\nreplicas: 2\nupdate_config:\nparallelism: 2\ndelay: 10s\nrestart_policy:\ncondition: on-failure\ndb:\nimage: postgres:9.4\nvolumes:\n- db-data:/var/lib/postgresql/data\nnetworks:\n- backend\ndeploy:\nplacement:\nconstraints: [node.role == manager]\nvote:\nimage: dockersamples/examplevotingapp_vote:before\nports:\n- 5000:80\nnetworks:\n- frontend\ndepends_on:\n- redis\ndeploy:\nreplicas: 2\nupdate_config:\nparallelism: 2\nrestart_policy:\ncondition: on-failure\nresult:\nimage: dockersamples/examplevotingapp_result:before\nports:\n- 5001:80\nnetworks:\n- backend\ndepends_on:\n- db\ndeploy:\nreplicas: 1\nupdate_config:\nparallelism: 2\ndelay: 10s\nrestart_policy:\ncondition: on-failure\nworker:\nimage: dockersamples/examplevotingapp_worker\nnetworks:\n- frontend\n- backend\ndeploy:\nmode: replicated\nreplicas: 1\nlabels: [APP=VOTING]\nrestart_policy:\ncondition: on-failure\ndelay: 10s\nmax_attempts: 3\nwindow: 120s\nplacement:\nconstraints: [node.role == manager]\nvisualizer:\nimage: dockersamples/visualizer:stable\nports:\n- \"8080:8080\"\nstop_grace_period: 1m30s\nvolumes:\n- \"/var/run/docker.sock:/var/run/docker.sock\"\ndeploy:\nplacement:\nconstraints: [node.role == manager]\nnetworks:\nfrontend:\nbackend:\nvolumes:\ndb-data:\n</code></pre> <pre><code># https://docs.docker.com/compose/compose-file/\n# https://docs.docker.com/compose/compose-file/compose-file-v3/\n# docker-compose.yml\nversion: '3.7'\nweb:\ncontainer_name: web\n# build from Dockerfile\nbuild: .\n# build from image\nimage: ubuntu\nimage: ubuntu:14.04\nimage: tutum/influxdb\nimage: example-registry:4000/postgresql\nimage: a4bc65fd\nports:\n- \"3000\"\n- \"8000:80\"  # guest:host\n# command to execute\ncommand: bundle exec thin -p 3000\ncommand: [bundle, exec, thin, -p, 3000]\n# override the entrypoint\nentrypoint: /app/start.sh\nentrypoint: [php, -d, vendor/bin/phpunit]\n# environment vars\nenvironment:\nRACK_ENV: development\nenvironment:\n- RACK_ENV=development\n# environment vars from file\nenv_file: .env\nenv_file: [.env, .development.env]\n# expose ports to linked services (not to host)\nexpose: [\"3000\"]\n# make this service extend another\nextends:\nfile: common.yml  # optional\nservice: webapp\n# makes the `db` service available as the hostname `database`\n# (implies depends_on)\nlinks:\n- db:database\n- redis\n# \u8bbe\u7f6edns\ndns:\n- 8.8.8.8\n# \u8bbe\u7f6e host\u5730\u5740\u7ed1\u5b9a\nextra_hosts:\n- \"somehost:192.168.1.100\"\n# \u5065\u5eb7\u68c0\u67e5\nhealthcheck:\ntest: [\"CMD\", \"curl\", \"-f\", \"http://localhost\"]\n# \u4f9d\u8d56db\uff0c\u5728db\u670d\u52a1\u540e\u542f\u52a8\ndepends_on:\n- db\n# \u6302\u8f7d\u76ee\u5f55\nvolumes:\n- db-data:/var/lib/mysql\n- ./_data:/var/lib/mysql\n# \u91cd\u542f\u7b56\u7565\nrestart: always\n# \u7cfb\u7edf\u9650\u5236\nsysctls:\nnet.core.somaxconn: 1024\nulimits:\nnproc: 65535\nnofile:\nsoft: 20000\nhard: 40000\ncap_add:\n- SYS_PTRACE\ncap_drop:\n- NET_ADMIN\nprivileged: true\nnetworks:\nfrontend:\nvolumes:\ndb-data:\n</code></pre> <p>\u5e38\u7528\u64cd\u4f5c</p> <pre><code># \u6784\u5efa\u670d\u52a1\ndocker-compose build\n# \u542f\u52a8\u670d\u52a1,\u542f\u52a8\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u76f4\u63a5\u67e5\u770b\u7ec8\u7aef\u65e5\u5fd7\uff0c\u89c2\u5bdf\u542f\u52a8\u662f\u5426\u6210\u529f\ndocker-compose up\n# \u542f\u52a8\u670d\u52a1\u5728\u540e\u53f0\uff0c\u5982\u679c\u786e\u8ba4\u90e8\u7f72\u6210\u529f\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u6b64\u547d\u4ee4\uff0c\u5c06\u5e94\u7528\u8dd1\u5728\u540e\u53f0\uff0c\u4f5c\u7528\u7c7b\u4f3c nohup python waller.py &amp;\ndocker-compose up -d\n\n# \u67e5\u770b\u65e5\u5fd7,\u6548\u679c\u7c7b\u4f3c tail -f waller.log\ndocker-compose logs -f\n# \u505c\u6b62\u670d\u52a1,\u4f1a\u505c\u6b62\u670d\u52a1\u7684\u8fd0\u884c\uff0c\u4f46\u662f\u4e0d\u4f1a\u5220\u9664\u670d\u52a1\u6240\u6240\u4f9d\u9644\u7684\u7f51\u7edc\uff0c\u4ee5\u53ca\u5b58\u50a8\u7b49\ndocker-compose stop\n\n# \u5220\u9664\u670d\u52a1\uff0c\u5e76\u5220\u9664\u670d\u52a1\u4ea7\u751f\u7684\u7f51\u7edc\uff0c\u5b58\u50a8\u7b49\uff0c\u5e76\u4e14\u4f1a\u5173\u95ed\u670d\u52a1\u7684\u5b88\u62a4\ndocker-compose down\n</code></pre> <pre><code>docker-compose up         # \u542f\u52a8yml\u5b9a\u4e49\u7684\u6240\u6709\u670d\u52a1\ndocker-compose up -d      # \u4ee5\u540e\u53f0\u7684\u5f62\u5f0f\u542f\u52a8\u670d\u52a1\ndocker-compose down       # #\u505c\u6b62\u5e76\u79fb\u9664yaml\u4e2d\u7684\u6240\u6709\u670d\u52a1\ndocker-compose ps         # \u67e5\u770b\u5df2\u7ecf\u542f\u52a8\u7684\u670d\u52a1\u72b6\u6001\ndocker-compose bundle     # #\u4eceCompose\u6587\u4ef6\u751f\u6210\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u5305\uff08DAB\uff09\ndocker-compose config     # #\u9a8c\u8bc1\u5e76\u67e5\u770bCompose\u6587\u4ef6\ndocker-compose events     # \u5c55\u793a\u9879\u76ee\u4e2d\u6bcf\u4e2a\u5bb9\u5668\u7684\u5bb9\u5668\u4e8b\u4ef6\ndocker-compose logs       # \u67e5\u770b\u670d\u52a1\u7684\u8f93\u51fa\ndocker-compose port       # \u6253\u5370\u7ed1\u5b9a\u7684\u516c\u5171\u7aef\u53e3\u3002\ndocker-compose pull       # \u62c9\u53d6\u670d\u52a1\u955c\u50cf\ndocker-compose push       # push \u670d\u52a1\u955c\u50cf\ndocker-compose version    # \u67e5\u770b\u7248\u672c\ndocker-compose build      # \u6784\u5efa\u6216\u91cd\u65b0\u6784\u5efa\u670d\u52a1\u3002\ndocker-compose start      # \u542f\u52a8\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u670d\u52a1\u5bb9\u5668\u3002\ndocker-compose stop       # \u505c\u6b62\u4e00\u4e2a\u5df2\u7ecf\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u4f46\u4e0d\u5220\u9664\u5b83\u3002\ndocker-compose pause      # \u6682\u505c\u670d\u52a1\ndocker-compose unpause    # \u6062\u590d\u5904\u4e8e\u6682\u505c\u72b6\u6001\u72b6\u6001\u4e2d\u7684\u670d\u52a1\ndocker-compose exec       # \u5728\u670d\u52a1\u4e2d\u8fd0\u884c\u547d\u4ee4\ndocker-compose help       # \u83b7\u53d6\u5e2e\u52a9\ndocker-compose kill       # \u901a\u8fc7\u53d1\u9001 SIGKILL \u4fe1\u53f7\u6765\u505c\u6b62\u6307\u5b9a\u670d\u52a1\u7684\u5bb9\u5668\ndocker-compose restart    # \u91cd\u542fyml\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u670d\u52a1\ndocker-compose rm         # \u5220\u9664\u505c\u6b62\u7684\u670d\u52a1\u5bb9\u5668\u3002\ndocker-compose top        # \u663e\u793a\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\ndocker-compose run        # \u5728\u4e00\u4e2a\u670d\u52a1\u4e0a\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u3002\ndocker-compose scale      # \u8bbe\u7f6e\u540c\u4e00\u4e2a\u670d\u52a1\u8fd0\u884c\u7684\u5bb9\u5668\u4e2a\u6570\u3002\ndocker-compose scale web=2 worker=3\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#2compose\u6a21\u677f\u6587\u4ef6","title":"2.Compose\u6a21\u677f\u6587\u4ef6","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>Compose \u6a21\u677f\u6587\u4ef6</p> <p>Docker Compose \u6a21\u677f\u6587\u4ef6</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#3docker-compose\u90e8\u7f72\u5e38\u89c1\u670d\u52a1","title":"3.docker-compose\u90e8\u7f72\u5e38\u89c1\u670d\u52a1","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#31-redis","title":"3.1 Redis","text":"docker\u547d\u4ee4docker-compose.yaml <pre><code>docker run -d -p 6379:6379 --name fudy-redis --network fudy-network --privileged=true -v /opt/docker/redis/conf/redis.conf:/etc/redis/redis.conf -v /opt/docker/redis/data:/data redis:6.0.3 redis-server /etc/redis/redis.conf\n</code></pre> <p>\u8f6c\u6362\u4e3adocker compose\u540e\u7684\u914d\u7f6e\u4e3aredis.yaml</p> <pre><code>version: '3.5'\nservices:\nredis:\nimage: redis:6.0.3\ncontainer_name: fudy-redis\nports:\n- 6379:6379\nnetworks:\n- fudy-network volumes:\n- /opt/docker/redis/conf/redis.conf:/etc/redis/redis.conf\n- /opt/docker/redis/data:/data\ncommand:\n/bin/bash -c \"redis-server /etc/redis/redis.conf\"\nnetworks:\nfudy-network:\n</code></pre> <p>\u4e3a\u4e86\u8ba9compose.yaml\u5728\u4efb\u4f55\u673a\u5668\u4e0a\u90fd\u53ef\u4ee5\u8dd1\uff0c\u6211\u5c06\u4e0a\u8282\u4e2d\u7684\u914d\u7f6e\u7a0d\u5fae\u505a\u4e86\u4e00\u4e0b\u6539\u52a8\uff0c\u5c06networks\u4e0b\u7684external: true\u53bb\u6389\u4e86\u3002\u8fd9\u6837\u5728\u8dd1\u542f\u52a8\u65f6\uff0c\u4e0d\u9700\u8981\u989d\u5916\u81ea\u5df1\u518d\u53bb\u7528docker\u521b\u5efa\u7f51\u7edc\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#32-nginx","title":"3.2 Nginx","text":"docker\u547d\u4ee4docker-compose.yaml <pre><code>docker run -d --name fudy-nginx -p 80:80 -v /opt/docker/nginx/nginx.conf:/etc/nginx/nginx.conf  -v /opt/docker/nginx/logs:/var/log/nginx  --privileged=true nginx\n</code></pre> <p>\u8f6c\u6362\u4e3adocker compose\u540e\u7684\u914d\u7f6e\u4e3anginx.yaml</p> <pre><code>version: '3.5'\nservices:\nnginx:\nimage: nginx:latest\ncontainer_name: fudy-nginx\nports:\n- 80:80\nnetworks:\n- fudy-network volumes:\n- /opt/docker/nginx/nginx.conf:/etc/nginx/nginx.conf\n- /opt/docker/nginx/logs:/var/log/nginx\nprivileged: true\nnetworks:\nfudy-network:\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#33-minio","title":"3.3 Minio","text":"docker\u547d\u4ee4docker-compose.yaml <p>\u4e4b\u524d\u7528docker\u542f\u52a8minio\u5bb9\u5668\u65f6\uff0c\u4f7f\u7528\u7684\u547d\u4ee4\u5982\u4e0b</p> <pre><code>docker run -d\n--name fudy-minio\n--network fudy-network -p 9000:9000 -p 9090:9090 -e \"MINIO_ACCESS_KEY=minioadmin\" -e \"MINIO_SECRET_KEY=minioadmin\" -v /opt/docker/minio/data:/data -v /opt/docker/minio/conf:/root/.minio minio/minio server /data --console-address \":9090\" -address \":9000\"\n</code></pre> <p>\u8f6c\u6362\u4e3adocker compose\u540e\u7684\u914d\u7f6e\u4e3anginx.yaml</p> <pre><code>version: '3.5'\nservices:\nminio:\nimage: minio/minio:latest\ncontainer_name: fudy-minio\nports:\n- 9000:9000\n- 9090:9090\nnetworks:\n- fudy-network volumes:\n- /opt/docker/minio/data:/data\n- /opt/docker/minio/conf:/root/.minio\nenvironment:\n- MINIO_ACCESS_KEY=minioadmin\n- MINIO_SECRET_KEY=minioadmin\ncommand:\nserver /data --console-address \":9090\" -address \":9000\"\nnetworks:\nfudy-network:\n</code></pre> <pre><code>version: '3.9'\nservices:\nminio:\nimage: minio/minio\ncommand: server /data --console-address \":9090\"\nrestart: unless-stopped\nvolumes:\n- minio_data:/data\nenvironment:\nMINIO_ROOT_USER: ${MINIO_ROOT_USER}\nMINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}\nnetworks:\n- default\n- proxy\nhealthcheck:\ntest: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9000/minio/health/live\"]\ninterval: 30s\ntimeout: 20s\nretries: 3\nvolumes:\nminio_data:\ndriver: local\ndriver_opts:\ntype: none\no: bind\ndevice: /data/minio\nnetworks:\nproxy:\nexternal: true\nname: nginx_proxy\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#34-mysql","title":"3.4 Mysql","text":"docker\u547d\u4ee4docker-compose.yaml <p>\u4e4b\u524d\u7528docker\u542f\u52a8mysql\u65f6\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4</p> <pre><code>docker run -d -p 3307:3306 --name fudy-mysql --network fudy-network --privileged=true -v /opt/docker/mysql/log:/var/log/mysql -v /opt/docker/mysql/data:/var/lib/mysql -v /opt/docker/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7\n</code></pre> <p>\u8f6c\u6362\u4e3adocker compose\u540e\u7684\u914d\u7f6e\u4e3amysql.yaml</p> <pre><code>version: '3.5'\nservices:\nmysql:\nimage: mysql:5.7\ncontainer_name: fudy-mysql\nports:\n- 3307:3306\nnetworks:\n- fudy-network volumes:\n- /opt/docker/mysql/log:/var/log/mysql\n- /opt/docker/mysql/data:/var/lib/mysql\n- /opt/docker/mysql/conf:/etc/mysql/conf.d\nenvironment:\n- MYSQL_ROOT_PASSWORD=123456\nprivileged: true\nnetworks:\nfudy-network:\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#35-nacos","title":"3.5 nacos","text":"docker\u547d\u4ee4docker-compose.yaml <p>\u4e4b\u524d\u7528docker\u5b89\u88c5nacos\u65f6\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4</p> <pre><code>docker run -d --privileged=true --name fudy-nacos --network fudy-network -v /opt/docker/nacos/logs:/home/nacos/logs -v /opt/docker/nacos/conf/custom.properties:/home/nacos/init.d/custom.properties  -e MODE=standalone  -p 8848:8848 -p 9848:9848 nacos/nacos-server:v2.2.0\n</code></pre> <p>\u8f6c\u6362\u4e3adocker compose\u540e\u7684\u914d\u7f6e\u4e3anacos.yaml</p> <pre><code>version: '3.5'\nservices:\nnacos:\nimage: nacos/nacos-server:v2.2.0\ncontainer_name: fudy-nacos\nports:\n- 8848:8848\n- 9848:9848\nnetworks:\n- fudy-network volumes:\n- /opt/docker/nacos/logs:/home/nacos/logs\n- /opt/docker/nacos/conf/custom.properties:/home/nacos/init.d/custom.properties\nenvironment:\n- MODE=standalone\nprivileged: true\nnetworks:\nfudy-network:\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#4\u7edf\u4e00\u7f16\u6392","title":"4.\u7edf\u4e00\u7f16\u6392","text":"<pre><code>version: '3.5'\nservices:\nredis:\nextends:\nfile: redis.yaml\nservice: redis\nmysql:\nextends:\nfile: mysql.yaml\nservice: mysql\nnacos:\ndepends_on:\n- mysql\nextends:\nfile: nacos.yaml\nservice: nacos\nnginx:\ndepends_on:\n- minio\nextends: file: nginx.yaml\nservice: nginx\nminio:\nextends:\nfile: minio.yaml\nservice: minio\nnetworks:\nfudy-network:\n</code></pre> <p>\u5728\u5199\u8fd9\u4e2a\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6765\u6821\u9a8c\u6587\u4ef6\u683c\u5f0f</p> <pre><code>$ docker-compose config\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u547d\u4ee4\uff0c\u5c06\u6240\u6709\u5bb9\u5668\u5168\u90e8\u751f\u6210</p> <pre><code>$ docker-compose up -d\n$ docker-compose stop $ docker-compose start\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/8.docker-compose/#5docker-compose-all-one","title":"5.docker-compose-all-one","text":"<p>gitee\u4ed3\u5e93</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/","title":"9.Docker\u76f8\u5173\u811a\u672c","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#1\u5907\u4efd\u8fd8\u539f\u73af\u5883","title":"1.\u5907\u4efd\u8fd8\u539f\u73af\u5883","text":"<p>docker\u5bfc\u51fa</p> <pre><code>$ docker save -o centos-binary-neutron-server-2.0.0.5.tar.gz  kollaglue/centos-binary-neutron-server:2.0.0.5\n</code></pre> <p>docker\u5bfc\u5165 <pre><code>$ docker load &lt; centos-binary-neutron-server-2.0.0.5.tar.gz\n</code></pre></p> \u793a\u4f8b1\u793a\u4f8b2 <p>docker\u5bfc\u51fa\u955c\u50cf(backup_image.sh)</p> <pre><code>#!/usr/bin/env bash\n# \u5907\u4efd\u955c\u50cf\u5217\u8868\ndocker images |awk 'NR&gt;1{print $1\":\"$2}'|sort &gt; images.list\n\n# \u5bfc\u51fa\u6240\u6709\u955c\u50cf\u4e3a\u5f53\u524d\u76ee\u5f55\u4e0b\u6587\u4ef6\nwhile read img; do\necho $img\nfile=\"${img//\\//-}\"\nsudo docker save $img &gt; $file.tar\ndone &lt; images.list\n</code></pre> <p>docker\u5bfc\u5165\u955c\u50cf(Restore_image.sh)</p> <pre><code>#!/usr/bin/env bash\nwhile read img; do\necho $img\nfile=\"${img//\\//-}\"\nsudo docker load &lt; $file.tar\ndone &lt; images.list\n</code></pre> <p>docker\u5bfc\u51fa\u955c\u50cf(backup_image.sh)</p> <pre><code>#!/bin/bash\nIMAGES_LIST=($(docker images|sed '1d'|awk '{print $1}'))\nIMAGES_NM_LIST=($(docker images|sed '1d'|awk '{print $1\"-\"$2}'|awk -F/ '{print $NF}'))\nIMAGES_NUM=${#IMAGES_LIST[*]}\nfor((i=0;i&lt;$IMAGES_NUM;i++))\ndo\ndocker save \"${IMAGES_LIST[$i]}\"  -o \"${IMAGES_NM_LIST[$i]}\".tar.gz\n    echo $i ${IMAGES_NM_LIST[$i]} is ok\ndone\n</code></pre> <p>docker\u5bfc\u5165\u955c\u50cf(Restore_image.sh)</p> <pre><code>#!/bin/bash\nfor image_name in $(ls ./*.tar.gz)\ndo\ndocker load &lt; ${image_name}\ndone\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#2docker\u955c\u50cf\u4e0a\u4f20\u4e0b\u8f7d\u811a\u672c","title":"2.docker\u955c\u50cf\u4e0a\u4f20\u4e0b\u8f7d\u811a\u672c","text":"<p>\u955c\u50cf\u4e0b\u8f7d\u4ee5\u53ca\u66ff\u6362tag</p> <pre><code>list=`cat $1`\n#\u4fee\u6539\u540e\u7684\u955c\u50cf\u4ed3\u5e93\nRegistry='harbor.zhangzhuo.org/base/'\necho &gt; images-save.txt\necho &gt; images-name.txt\nfor var in $list;do\n#\u53d6\u955c\u50cf\u540d\u79f0\u53catag\ntmp=${var##*/}\n#\u53d6\u955c\u50cf\u4ed3\u5e93url\nrepo=${var%/*}\n#\u53d6\u955c\u50cf\u540d\u79f0\nproject=${tmp%%:*}\n#\u53d6\u955c\u50cftag\ntag=${tmp##*:}\n#\u4fee\u6539\u539f\u672c\u955c\u50cf\u4ed3\u5e93url\u5730\u5740\u4e3a\u65b0\u7684\u7684\u4ed3\u5e93url\u5730\u5740\neval new_image_url=${Registry}${tmp}\n#\u62c9\u53d6\u955c\u50cf\ndocker pull ${var}\n#\u4fee\u6539\u955c\u50cftag\ndocker tag ${var} ${new_image_url}\n#\u5bfc\u51fa\u955c\u50cf\ndocker save ${new_image_url} -o ${project}-${tag}.tar.gz\n  #\u8bb0\u5f55\u5bfc\u51fa\u7684\u6587\u4ef6\u540d\u79f0\necho ${project}-${tag}.tar.gz &gt;&gt; images-save.txt\n  #\u8bb0\u5f55\u4fee\u6539\u540e\u7684\u955c\u50cf\u540d\u79f0\necho ${new_image_url} &gt;&gt;images-name.txt\ndone\n</code></pre> <p>\u4e0a\u4f20\u955c\u50cf\u811a\u672c <pre><code>#!/bin/bash\ndocker_load=`cat images-save.txt`\ndocker_push=`cat image-name.txt`\nfor load  in ${docker_load};do\ndocker load &lt; ${load}\necho '*****************\u955c\u50cf\u5bfc\u5165\u4fe1\u606f**********************'\necho \"\u955c\u50cf\u5305${load}\u5bfc\u5165\u5b8c\u6210\"\ndone\nfor push in ${docker_push};do\ndocker push ${push}\necho '*****************\u955c\u50cf\u4e0a\u4f20\u4fe1\u606f**********************'\necho \"\u955c\u50cf${push}\u4e0a\u4f20\u5b8c\u6210\"\ndone\n</code></pre></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#3\u5c06kubernetes\u955c\u50cf\u4e0a\u4f20\u5230\u963f\u91cc\u4e91","title":"3.\u5c06kubernetes\u955c\u50cf\u4e0a\u4f20\u5230\u963f\u91cc\u4e91","text":"<p>pull_all.sh</p> <pre><code>#!/usr/bin/env bash\nPWD=$(pwd)\nfor image in `docker images|grep -v \"REPOSITORY\"|grep -v \"&lt;none&gt;\"|awk '{print $1\":\"$2}'` ; do\nimg=${image##*/}\nbash ${PWD}/push_image.sh $image\n#echo  \"${PWD}/push_image.sh $image\"\ndone\n</code></pre> <p>push_image.sh</p> <pre><code>#!/usr/bin/env bash\n#This script is used to upload many images to local or private repositories\n# Usage: push_images image1 [image2...]\n# \u8fd9\u91cc\u662f\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u5730\u5740\nregistry=registry.cn-hangzhou.aliyuncs.com/hu_k8s\n\necho_r() {\n[ $# -ne 1 ] &amp;&amp; return 0\necho -e \"\\033[31m$1\\033[0m\"\n}\necho_g() {\n[ $# -ne 1 ] &amp;&amp; return 0\necho -e \"\\033[32m$1\\033[0m\"\n}\necho_b() {\n[ $# -ne 1 ] &amp;&amp; return 0\necho -e \"\\033[34m$1\\033[0m\"\n}\nusage() {\ndocker images\n    echo \"Usage: $0 registry:tag1 [registry2:tag2...]\"\n}\n[ $# -lt 1 ] &amp;&amp; usage &amp;&amp; exit\necho_b \"The registry server is $registry\"\nfor image in \"$@\" ; do\nimg=${image##*/}\necho_b \"Uploading $img\"\ndocker tag $image $registry/$img\ndocker push $registry/$img\ndocker rmi $registry/$img\nsleep 1\necho_g \"Done\"\ndone\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#4\u91cf\u6e05\u7406\u4e34\u65f6\u955c\u50cf\u6587\u4ef6","title":"4.\u91cf\u6e05\u7406\u4e34\u65f6\u955c\u50cf\u6587\u4ef6","text":"<p>\u67e5\u770b docker \u5360\u7528\u7684\u8d44\u6e90 <pre><code>docker container ls\uff1a\u9ed8\u8ba4\u53ea\u5217\u51fa\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\uff0c -a \u9009\u9879\u4f1a\u5217\u51fa\u5305\u62ec\u505c\u6b62\u7684\u6240\u6709\u5bb9\u5668\u3002 \n\ndocker image ls\uff1a\u5217\u51fa\u955c\u50cf\u4fe1\u606f\uff0c-a \u9009\u9879\u4f1a\u5217\u51fa intermediate \u955c\u50cf(\u5c31\u662f\u5176\u5b83\u955c\u50cf\u4f9d\u8d56\u7684\u5c42)\u3002\n\ndocker volume ls\uff1a\u5217\u51fa\u6570\u636e\u5377\u3002 \n\ndocker network ls\uff1a\u5217\u51fa network\u3002 \n\ndocker info\uff1a\u663e\u793a\u7cfb\u7edf\u7ea7\u522b\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u5bb9\u5668\u548c\u955c\u50cf\u7684\u6570\u91cf\u7b49\u3002\n</code></pre></p> <p>\u53ea\u5220\u9664\u90a3\u4e9b\u672a\u88ab\u4f7f\u7528\u7684\u8d44\u6e90</p> <ul> <li> <p>Docker \u63d0\u4f9b\u4e86\u65b9\u4fbf\u7684 docker system prune \u547d\u4ee4\u6765\u5220\u9664\u90a3\u4e9b\u5df2\u505c\u6b62\u7684\u5bb9\u5668\u3001dangling \u955c\u50cf\u3001\u672a\u88ab\u5bb9\u5668\u5f15\u7528\u7684 network \u548c\u6784\u5efa\u8fc7\u7a0b\u4e2d\u7684 cache\uff1a <pre><code>docker system prune\n</code></pre></p> </li> <li> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6e05\u7406\u5df2\u7ecf\u505c\u6b62\u8fd0\u884c\u7684docker\u5bb9\u5668 <pre><code>docker rm $(docker ps --all -q -f status=exited)\n</code></pre></p> </li> </ul> <p>\u901a\u8fc7\u6807\u7b7e\u5220\u9664\u955c\u50cf</p> <pre><code>docker rmi [image]\n# \u6216\u8005\ndocker image rm  [image]\n\u652f\u6301\u7684\u5b50\u547d\u4ee4\u5982\u4e0b\uff1a\n-f, -force: \u5f3a\u5236\u5220\u9664\u955c\u50cf\uff0c\u5373\u4fbf\u6709\u5bb9\u5668\u5f15\u7528\u8be5\u955c\u50cf\uff1b\n-no-prune: \u4e0d\u8981\u5220\u9664\u672a\u5e26\u6807\u7b7e\u7684\u7236\u955c\u50cf\uff1b\n</code></pre> <p>\u9664\u4e86\u901a\u8fc7\u6807\u7b7e\u540d\u79f0\u6765\u5220\u9664\u955c\u50cf\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5236\u5b9a\u955c\u50cf ID, \u6765\u5220\u9664\u955c\u50cf\uff0c\u5982\uff1a <pre><code>docker rmi ID\n</code></pre></p> <p>\u6211\u4eec\u5728\u4f7f\u7528 Docker \u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u7cfb\u7edf\u4e00\u822c\u90fd\u4f1a\u6b8b\u5b58\u4e00\u4e9b\u4e34\u65f6\u7684\u3001\u6ca1\u6709\u88ab\u4f7f\u7528\u7684\u955c\u50cf\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u6e05\u7406\uff1a <pre><code>docker image prune\n\n\u5b83\u652f\u6301\u7684\u5b50\u547d\u4ee4\u6709\uff1a\n-a, --all: \u5220\u9664\u6240\u6709\u6ca1\u6709\u7528\u7684\u955c\u50cf\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u4e34\u65f6\u6587\u4ef6;\n-f, --force\uff1a\u5f3a\u5236\u5220\u9664\u955c\u50cf\u6587\u4ef6\uff0c\u65e0\u9700\u5f39\u51fa\u63d0\u793a\u786e\u8ba4\uff1b\n</code></pre></p> <pre><code>$ docker rmi $(docker images -q -f dangling=true)\n# \u67e5\u770b\u72b6\u6001\u662f\u5173\u95ed\u7684\u955c\u50cf\ndocker ps -a --filter status=exited\n</code></pre> <p>\u505c\u6b62\u6b63\u5728\u8fd0\u884c\u7684Docker\u5bb9\u5668 <pre><code>docker stop $(docker ps -a -q)\n</code></pre></p> <p>\u5220\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684Docker\u955c\u50cf <pre><code>docker image prune -a\n</code></pre></p> <p>\u5220\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684Docker\u5bb9\u5668 <pre><code>docker container prune\n</code></pre></p> <p>\u5220\u9664\u6784\u5efa\u7f13\u5b58 <pre><code># \u67e5\u770b\u6784\u5efa\u73af\u5883\ndocker system df\n\n# \u5220\u9664\u6784\u5efa\u7f13\u5b58\necho -e \"y\\n\"|docker builder prune\n#\u6216\u8005\necho -e \"y\\n\"|docker system prune -f </code></pre></p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#5\u5220\u9664\u6240\u6709\u672c\u5730\u7684\u955c\u50cf","title":"5.\u5220\u9664\u6240\u6709\u672c\u5730\u7684\u955c\u50cf","text":"docker\u5220\u9664\u955c\u50cf\u64cd\u4f5cdocker\u5220\u9664\u65e0\u7528\u6570\u636e\u5377docker\u5783\u573e\u5904\u7406\u6279\u91cf\u5220\u9664\u6307\u5b9a repository <pre><code>$ docker rm $(docker ps -a -q)\n# \u5220\u9664none\u7684\u955c\u50cf\uff0c\u8981\u5148\u5220\u9664\u955c\u50cf\u4e2d\u7684\u5bb9\u5668\u3002\u8981\u5220\u9664\u955c\u50cf\u4e2d\u7684\u5bb9\u5668\uff0c\u5fc5\u987b\u5148\u505c\u6b62\u5bb9\u5668\ndocker stop $(docker ps -a | grep \"Exited\" | awk '{print $1 }')         //\u505c\u6b62\u5bb9\u5668\ndocker rm $(docker ps -a | grep \"Exited\" | awk '{print $1 }')           //\u5220\u9664\u5bb9\u5668\ndocker rmi $(docker images | grep \"none\" | awk '{print $3}')            //\u5220\u9664\u955c\u50cf\n\n# \u5220\u9664\u5bb9\u5668\ndocker rm container                     #\uff1a\u5220\u9664\u4e00\u4e2a\u6216\u591a\u4e2a container\ndocker rm `docker ps -aq`               #\uff1a\u5220\u9664\u6240\u6709\u7684 container\ndocker ps -aq | xargs docker rm         #\uff1a\u540c\u4e0a, \u5220\u9664\u6240\u6709\u7684 containe\u521b\u5efa\u5bb9\u5668\u57fa\u7840\u7684\u547d\u4ee4\u683c\u5f0f\n# docker \u5220\u9664\u6240\u6709none\u7684\u955c\u50cf\ndocker images|grep none|awk '{print $3}'|xargs docker rmi\n\n# Docker\u6e05\u7406\u6570\u636e\u5377volumes\n# \u53c2\u8003\u6587\u732e\uff1a\nhttps://blog.csdn.net/songxi_bo/article/details/119910471\n</code></pre> <pre><code># Docker 1.13 \u5f15\u5165\u4e86\u7c7b\u4f3c\u4e8e Linux \u4e0a df \u7684\u547d\u4ee4\uff0c\u7528\u4e8e\u67e5\u770b Docker \u7684\u78c1\u76d8\u4f7f\u7528\u60c5\u51b5\n$ docker system df\n\n# \u624b\u52a8\u5220\u9664\u547d\u4ee4\n# \u5220\u9664\u6240\u6709dangling\u6570\u636e\u5377\uff08\u5373\u65e0\u7528\u7684Volume\uff0c\u50f5\u5c38\u6587\u4ef6\uff09\ndocker volume rm $(docker volume ls -qf dangling=true)\n# \u5220\u9664\u6240\u6709dangling\u955c\u50cf\uff08\u5373\u65e0tag\u7684\u955c\u50cf\uff09\ndocker rmi $(docker images | grep \"^&lt;none&gt;\" | awk \"{print $3}\")\n# \u5220\u9664\u6240\u6709\u5173\u95ed\u7684\u5bb9\u5668\ndocker ps -a | grep Exit | cut -d ' ' -f 1 | xargs docker rm\n</code></pre> <p>\u5220\u9664\u5173\u95ed\u7684\u5bb9\u5668\u3001\u65e0\u7528\u7684\u6570\u636e\u5377\u548c\u7f51\u7edc\uff0c\u4ee5\u53cadangling\u955c\u50cf\uff08\u5373\u65e0tag\u7684\u955c\u50cf\uff09</p> <p>\u6ce8\u610f\uff0c\u6240\u6709\u5173\u95ed\u7684\u5bb9\u5668\u90fd\u4f1a\u88ab\u5220\u9664\uff0c\u8bf7\u6838\u67e5\u662f\u5426\u5b58\u5728\u5173\u95ed\u8fd0\u884c\u4f46\u662f\u9700\u8981\u4fdd\u7559\u7684\u5bb9\u5668</p> <pre><code># \u5220\u9664\u5173\u95ed\u7684\u5bb9\u5668\u3001\u65e0\u7528\u7684\u6570\u636e\u5377\u548c\u7f51\u7edc\ndocker system prune\n\n# \u5982\u4e0b\u547d\u4ee4\u4f1a\u81ea\u52a8\u6e05\u7406\u5904\u4e8e\u505c\u6b62\u72b6\u6001\u7684\u5bb9\u5668\u3001\u65e0\u7528\u7684\u7f51\u7edc\u548c\u6302\u8f7d\u5377\u3001\u4e34\u65f6\u955c\u50cf\u548c\u521b\u5efa\u955c\u50cf\u7f13\u5b58\u3002\ndocker system prune --volumes -f\n\n# \u5220\u9664\u66f4\u5f7b\u5e95\uff0c\u53ef\u4ee5\u5c06\u6ca1\u6709\u5bb9\u5668\u4f7f\u7528Docker\u955c\u50cf\u90fd\u5220\u6389\ndocker system prune -a\n</code></pre> <pre><code>1  \u67e5\u627edocker\u6587\u4ef6\u5939\nfind / -name docker\n\n2 \u5217\u4e3e\u6587\u4ef6\u5939\u5927\u5c0f\ndu -h --time --max-depth=1 .\ndf -h\ndf -TH\n\n3 Docker\u5360\u7528\u78c1\u76d8\u7a7a\u95f4\u67e5\u770b\ndocker system df\n\n4 \u5220\u9664\u6240\u6709\u672a\u8fd0\u884c\u7684\u5bb9\u5668\uff08\u4e5f\u53ef\u4ee5\u4f7f\u7528docker-gc\uff09\ndocker rm $(docker ps -a|grep Exited |awk '{print $1}')\ndocker rm $(docker ps -qf status=exited  )\n5 \u5220\u9664\u6240\u6709\u672a\u6253\u6807\u7b7e\u7684 \u955c\u50cf\ndocker rmi $(docker images -q -f dangling=true)\n6 \u5220\u9664\u6240\u6709\u65e0\u7528\u7684volume\ndocker volume rm $(docker volume ls -qf dangling=true)\n7 \u6e05\u7406\u78c1\u76d8\uff0c\u5220\u9664\u5173\u95ed\u7684\u5bb9\u5668\uff0c\u65e0\u7528\u7684\u6570\u636e\u5377\u548c\u7f51\u7edc\ndocker system prune\n\n8 \u505c\u6b62\u6240\u6709\u8fd0\u884c\u7684\u5bb9\u5668\ndocker stop $(docker ps -q)\n9 \u505c\u6b62\u6240\u6709\u5bb9\u5668\ndocker stop $(docker ps -a -q)\n10 \u5220\u9664\u6240\u6709\u5bb9\u5668\ndocker rm $(docker ps -aq)\n11 \u5220\u9664\u6240\u6709\u955c\u50cf\ndocker rmi $(docker images -q)\n12 \u5bb9\u5668\u548c\u5bbf\u4e3b\u673a\u4e4b\u95f4\u6587\u4ef6\u590d\u5236\ndocker cp [\u6587\u4ef6\u76ee\u5f55\u5bb9\u5668 ID:\u5185\u90e8\u8def\u5f84]\ndocker cp [\u5bb9\u5668 ID:\u5185\u90e8\u8def\u5f84\u6587\u4ef6\u76ee\u5f55]\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>https://www.cnblogs.com/zhuminghui/p/14566178.html</p> <p>https://blog.csdn.net/truelove12358/article/details/102949386</p> <pre><code>#!/bin/sh\n# Writed by yijian on 2020/8/31\n# \u6279\u91cf\u5220\u9664\u6307\u5b9a repository \u6240\u6709\u955c\u50cf\u5de5\u5177\n# \u8fd0\u884c\u65f6\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u53c2\u6570\uff1a\n# 1\uff09\u53c2\u65701\uff1a\u5fc5\u9009\u53c2\u6570\uff0crepository \u540d\uff0c\u5373\u201cdocker images\u201d\u7684\u7b2c\u4e00\u5217\u503c\nfunction usage()\n{\necho \"Remove all images with the given repository.\"\necho \"Usage: `basename $0` repository\"\necho \"Example1: `basename $0` \\\"&lt;none&gt;\\\"\"\necho \"Example2: `basename $0` \\\"redis\\\"\"\n}\n# \u53c2\u6570\u68c0\u67e5\nif test $# -ne 1; then\nusage\n  exit 1\nfi\nrepository=\"$1\"\nimages=(`docker images|awk -v repository=$repository '{ if ($1==repository) print $3 }'`)\nfor ((i=0; i&lt;${#images[@]}; ++i))\ndo\nimage=\"${images[$i]}\"\necho \"[$i] docker rmi \\\"$image\\\"\"\ndocker rmi \"$image\"\ndone\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#6docker\u5b58\u50a8\u4f4d\u7f6e\u4fee\u6539","title":"6.Docker\u5b58\u50a8\u4f4d\u7f6e\u4fee\u6539","text":"<p>Docker\u7684\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e\u662f/var/lib/docker\uff0c\u5982\u679c\u5e0c\u671b\u5c06Docker\u7684\u672c\u5730\u6587\u4ef6\u5b58\u50a8\u5230\u5176\u4ed6\u5206\u533a\uff0c\u53ef\u4ee5\u4f7f\u7528Linux\u8f6f\u8fde\u63a5\u7684\u65b9\u5f0f\u6765\u5b8c\u6210\uff0c\u6216\u8005\u5728\u542f\u52a8daemon\u65f6\u901a\u8fc7-g\u53c2\u6570\u6307\u5b9a\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u4e0b\u64cd\u4f5c\u5c06\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e\u8fc1\u79fb\u5230/storage/docker\uff1a</p> <pre><code>[root@s26 ~]# df -h\nFilesystem                    Size  Used Avail Use% Mounted on\n/dev/mapper/VolGroup-lv_root   50G  5.3G   42G  12% /\ntmpfs                          48G  228K   48G   1% /dev/shm\n/dev/mapper/VolGroup-lv_home  222G  188M  210G   1% /home\n/dev/sdb2                     2.7T  323G  2.3T  13% /storage\n\n[root@s26 ~]# service docker stop\n[root@s26 ~]# cd /var/lib/\n[root@s26 lib]# mv docker /storage/\n[root@s26 lib]# ln -s /storage/docker/ docker\n[root@s26 lib]# ls -la docker\nlrwxrwxrwx. 1 root root 15 11\u6708 17 13:43 docker -&gt; /storage/docker\n\n[root@s26 lib]# service docker start\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>https://blog.csdn.net/m0_37814112/article/details/115033609</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#7\u8fc1\u79fbdocker\u73af\u5883","title":"7.\u8fc1\u79fbDocker\u73af\u5883","text":"<p>\u505c\u6b62Docker\u670d\u52a1\u3002\u5c06\u6574\u4e2aDocker\u5b58\u50a8\u6587\u4ef6\u5939\uff08\u5982\u9ed8\u8ba4\u7684/var/lib/docker\uff09\u590d\u5236\u5230\u53e6\u5916\u4e00\u53f0\u5bbf\u4e3b\u4e3b\u673a\uff0c\u7136\u540e\u8c03\u6574\u53e6\u5916\u4e00\u53f0\u5bbf\u4e3b\u4e3b\u673a\u7684\u914d\u7f6e\u5373\u53ef\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#8\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\u5236\u4f5c\u811a\u672c","title":"8.\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\u5236\u4f5c\u811a\u672c","text":"<p>\u57fa\u4e8eRHEL7.4\uff083.10.0-693.el7.86_64\uff09\u865a\u62df\u673a\u64cd\u4f5c\u7cfb\u7edf\u548c\u7edf\u4e00yum\u6e90\uff0c\u81ea\u5b9a\u4e49\u57fa\u7840rpm\u5305\u540e\u901a\u8fc7makeImageForRedhat.sh\u811a\u672c\u53ef\u81ea\u52a8\u5b8c\u6210\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u955c\u50cf\u7684\u5236\u4f5c\u8fc7\u7a0b\u3002</p> <ul> <li> <p>yum\u6e90\u914d\u7f6e\u8bf4\u660e \u57fa\u7840\u955c\u50cf/etc/yum.repos.d/rhel_7_rmps.repo\u5df2\u914d\u7f6eyum\u6e90\uff0c\u8fd9\u6837\u540e\u7eed\u5e94\u7528\u5c42\u5236\u4f5c\u5bb9\u5668\u65f6\u53ef\u76f4\u63a5\u4f7f\u7528yum\u547d\u4ee4\u5b89\u88c5\u9700\u8981\u7684rpm\u5305\u3002</p> </li> <li> <p>\u5236\u4f5c\u8fc7\u7a0b</p> </li> </ul> <p>1) \u91cd\u65b0\u5b89\u88c5\u6216\u5229\u7528\u73b0\u6709RHEL7.4\uff083.10.0-693.el7.86_64\uff09\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e3b\u673a\u3002</p> <p>2) \u6839\u636e\u5bbf\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u7684\u5b89\u88c5\u8981\u6c42\u8fdb\u884c\u76f8\u5173\u7684\u53c2\u6570\u914d\u7f6e\uff0c\u5982\u6587\u4ef6\u53e5\u67c4\u6570\u7b49\u3002</p> <p>3) \u5728\u8be5\u4e3b\u673a\u4e0a\u5b89\u88c5Docker\uff0c\u539f\u56e0\u662f\u4f7f\u7528docker import\u751f\u6210\u955c\u50cf\u65f6\u9700\u8981Docker\u3002</p> <p>4) \u5728\u8be5\u673a\u5668\u6839\u76ee\u5f55\u4e0b\u521b\u5efatmp\u76ee\u5f55\uff0c\u5c06\u9700\u8981\u590d\u5236\u5230\u955c\u50cf\u7684\u539f\u59cb\u6587\u4ef6\u590d\u5236\u5230\u6b64\u76ee\u5f55\u4e0b\u3002</p> <p>5) \u5728tmp\u76ee\u5f55\u4e0b\u5efa\u7acb\u4e34\u65f6\u76ee\u5f55\u3002</p> <p>6) \u8bfb\u53d6rpm\u5305\u5217\u8868\uff0c\u4f7f\u7528yum\u547d\u4ee4\u5728tmp\u76ee\u5f55\u5b89\u88c5\u6587\u4ef6\u7cfb\u7edf\u548c\u8f6f\u4ef6\u5305\u3002</p> <p>7) \u5c06tmp\u76ee\u5f55tar\u6253\u5305\u5e76\u901a\u8fc7docker import\u5bfc\u5165\u672c\u5730\u955c\u50cf\u6587\u4ef6\u540e\u4e0a\u4f20\u5230\u955c\u50cf\u4ed3\u5e93\u3002</p> <p>8) \u6e05\u7406tmp\u4e34\u65f6\u76ee\u5f55\u3002</p> <p>\u5176\u4e2d\u7b2c6\u30017\u4e24\u6b65\u53ef\u4ee5\u901a\u8fc7\u6267\u884cmakeImageForRedhat.sh\u811a\u672c\u5b8c\u6210\u3002</p> <ul> <li>\u5236\u4f5c\u811a\u672c<code>makeImageForRedhat.sh</code> <pre><code>#!/usr/bin/env bash\n#\n# Create a base Redhat7.4 Docker image.\n#\n# This script is useful on systems with yum installed (e.g., building\n# a Redhat7image on Redhat7).  See contrib/mkimage-rinse.sh for a way\n# to build Redhat7images on other systems.\nset -e\n\nusage() {\ncat &lt;&lt;EOOPTS\n$(basename $0) [OPTIONS] &lt;name&gt; &lt;version&gt;\nOPTIONS:\n  -p \"&lt;packages&gt;\"  The list of packages to install in the container.\n                   The default is \"telnet.x86_64 telnet-server.x86_64\".\n  -g \"&lt;groups&gt;\"    The groups of packages to install in the container.\n                   The default is \"Core\".\n  -d \"&lt;packages&gt;\"  The list of packages to remove from the container.\n                   The default is blank.\n  -f \"&lt;rpm file&gt;\"  The list of packages to install in the container.(in file)\n                   The default is blank\n  -y &lt;yumconf&gt;     The path to the yum config to install packages from. The\n                   default is /etc/yum.conf for Centos/RHEL and /etc/dnf/dnf.conf for Fedora\nEOOPTS\nexit 1\n}\nset -x\n# option defaults\nyum_config=/etc/yum.conf\nif [ -f /etc/dnf/dnf.conf ] &amp;&amp; command -v dnf &amp;&gt; /dev/null; then\nyum_config=/etc/dnf/dnf.conf\n    alias yum=dnf\nfi\n#install_groups=\"Core\"\n#install_packages=\"telnet.x86_64 telnet-server.x86_64\"\n# remove_packages=\"openssh-server-7.4p1-13.el7_4.x86_64 openssh-clients-7.4p1-13.el7_4.x86_64\"\nwhile getopts \"y:p:g:h:d:f:\" opt; do\ncase $opt in\ny)\nyum_config=$OPTARG\n;;\nh)\nusage\n            ;;\np)\ninstall_packages=\"$OPTARG\"\n;;\ng)\ninstall_groups=\"$OPTARG\"\n;;\nd)\nremove_packages=\"$OPTARG\"\n;;\nf)\nrpm_file=\"$OPTARG\"\n;;\n\\?)\necho \"Invalid option: -$OPTARG\"\nusage\n            ;;\nesac\ndone\nshift $((OPTIND - 1))\nname=$1\nversion=$2\nif [[ -z $name ]]; then\nusage\nfi\nif [[ -z $version ]]; then\nusage\nfi\ntarget=$(mktemp -d --tmpdir $(basename $0).XXXXXX)\nmkdir -m 755 \"$target\"/dev\nmknod -m 600 \"$target\"/dev/console c 5 1\nmknod -m 600 \"$target\"/dev/initctl p\nmknod -m 666 \"$target\"/dev/full c 1 7\nmknod -m 666 \"$target\"/dev/null c 1 3\nmknod -m 666 \"$target\"/dev/ptmx c 5 2\nmknod -m 666 \"$target\"/dev/random c 1 8\nmknod -m 666 \"$target\"/dev/tty c 5 0\nmknod -m 666 \"$target\"/dev/tty0 c 4 0\nmknod -m 666 \"$target\"/dev/urandom c 1 9\nmknod -m 666 \"$target\"/dev/zero c 1 5\n# amazon linux yum will fail without vars set\nif [ -d /etc/yum/vars ]; then\nmkdir -p -m 755 \"$target\"/etc/yum\n    cp -a /etc/yum/vars \"$target\"/etc/yum/\nfi\nif [[ -n \"$install_groups\" ]];\nthen\nyum -c \"$yum_config\" --installroot=\"$target\" --releasever=/ --setopt=tsflags=nodocs \\\n--setopt=group_package_types=mandatory -y groupinstall $install_groups\nfi\nrm -f \"$target\"/etc/yum.repos.d/*.repo\n#mkdir -p \"$target\"/etc/yum.repos.d/\n#cp /etc/yum.repos.d/redhat.repo  \"$target\"/etc/yum.repos.d/\nif [[ -n \"$install_packages\" ]];\nthen\nyum -c \"$yum_config\" --installroot=\"$target\" -y install $install_packages\nfi\nif [[ -n \"$remove_packages\" ]];\nthen\nyum -c \"$yum_config\" --installroot=\"$target\" --releasever=/ \\\n-y remove $remove_packages\nfi\nif [[ -n \"$rpm_file\" ]];\nthen\nrpmlist=`cat \"$rpm_file\"`\n# while read rpm_name\n#do\nyum -c \"$yum_config\" --installroot=\"$target\" --releasever=/ --setopt=tsflags=nodocs \\\n--setopt=group_package_types=mandatory -y install $rpmlist\n#done &lt; $rpm_file\nfi\ncp /etc/yum.repos.d/rhel_7_rpms.repo  \"$target\"/etc/yum.repos.d/\nyum -c \"$yum_config\" --installroot=\"$target\" -y clean all\n\ncat &gt; \"$target\"/etc/sysconfig/network &lt;&lt;EOF\nNETWORKING=yes\nHOSTNAME=localhost.localdomain\nEOF\nchroot \"$target\" /bin/bash -c \"cd /usr/share/locale/; ls | grep -v zh_CN| xargs rm -rf\"\nchroot \"$target\" /bin/bash -c \"rm -f /usr/lib/locale/locale-archive;localedef -i zh_CN -f UTF-8 zh_CN.UTF-8\"\nchroot \"$target\" /bin/bash -c \"rm -rf /var/cache/yum/*\"\n# effectively: febootstrap-minimize --keep-zoneinfo --keep-rpmdb --keep-services \"$target\".\n#  locales\n#rm -rf \"$target\"/usr/{{lib,share}/locale,{lib,lib64}/gconv,bin/localedef,sbin/build-locale-archive}\n#  docs and man pages\nrm -rf \"$target\"/usr/share/{man,doc,info,gnome/help}\n#  cracklib\nrm -rf \"$target\"/usr/share/cracklib\n#  i18n\nrm -rf \"$target\"/usr/share/i18n\n#  yum cache\n#rm -rf \"$target\"/var/cache/yum\n#mkdir -p --mode=0755 \"$target\"/var/cache/yum\n#  sln\n#rm -rf \"$target\"/sbin/sln\n#  ldconfig\nrm -rf \"$target\"/etc/ld.so.cache \"$target\"/var/cache/ldconfig\nmkdir -p --mode=0755 \"$target\"/var/cache/ldconfig\n\n#version=\n#for file in \"$target\"/etc/{redhat,system}-release\n#do\n#    if [ -r \"$file\" ]; then\n#        version=\"$(sed 's/^[^0-9\\]*\\([0-9.]\\+\\).*$/\\1/' \"$file\")\"\n#        break\n#    fi\n#done\n#if [ -z \"$version\" ]; then\n#    echo &gt;&amp;2 \"warning: cannot autodetect OS version, using '$name' as tag\"\n#    version=$name\n#fi\nif [ -r \"$target\"/etc/ssh/sshd_config ]; then\nchroot \"$target\" ssh-keygen -A\n    chroot \"$target\" sed -i 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config\nfi\n#chroot \"$target\" bash -c \"echo -n 'root' | passwd --stdin root\"\n##dockerfile create &amp;&amp; build image\ncd \"$target\"\ntar cf \"$name.tar\" --numeric-owner -c -C \"$target\" .\nmkdir \"$target/dockrfile\"\nmv $name.tar \"$target/dockerfile\"\ncd dockerfile\necho \"#!/bin/sh\" &gt; run.sh\necho \"ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\" &gt; run.sh\necho \"exec /bin/bash\" &gt; run.sh\nchmod +x run.sh\necho \"FROM scratch\" &gt; dockerfile\necho \"LABEL name=\\\"CMPC Base Image\\\"\" &gt;&gt; dockerfile\necho \"ADD $name.tar /\" &gt;&gt; dockerfile\necho \"ENV LC_ALL=zh_CN.UTF-8\" &gt;&gt; dockerfile\necho \"COPY run.sh /\" &gt;&gt; dockerfile\necho \"CMD exec ./run.sh\" &gt;&gt; dockerfile\ndocker build -t $name:$version -f \"$target/dockerfile/dockerfile\"\n#tar --numeric-owner -c -C \"$target\" . | docker import - $name:$version\ndocker run -i -t --rm $name:$version /bin/bash -c 'echo success'\necho \"$target\"\nrm -rf \"$target\"\n</code></pre></li> </ul>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#9\u955c\u50cf\u540c\u6b65\u65b9\u5f0f","title":"9.\u955c\u50cf\u540c\u6b65\u65b9\u5f0f","text":""},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#91-\u4f7f\u7528docker-pull","title":"9.1 \u4f7f\u7528docker pull","text":"<p>\u6d41\u7a0b\u4e5f\u975e\u5e38\u7b80\u5355\uff0cdocker pull\u5148\u62c9\u4e0b\u6765\uff0c\u7136\u540e\u91cd\u65b0\u6253tag\uff0c\u6700\u540epush\u5230\u6211\u4eec\u81ea\u5df1\u7684\u4ed3\u5e93</p> <pre><code>sudo docker pull registry.cn-hangzhou.aliyuncs.com/lfy_ruoyi/ruoyi-visual-monitor:v2\ndocker images\ndocker tag eb5aeb93fe3b finleyma/ruoyi-visual-monitor:v2\ndocker login\ndocker push finleyma/ruoyi-visual-monitor:v2\n</code></pre> <p>\u66f4\u8fdb\u4e00\u6b65\uff0c\u521b\u5efa\u4fe9\u6587\u4ef6\u4e00\u4e2a\u662f\u5f85\u540c\u6b65\u7684\u955c\u50cf\u5217\u8868\uff0c\u4e00\u4e2a\u662f\u811a\u672c\u6587\u4ef6\uff0c\u6267\u884c\u540e\u4f1a\u540c\u6b65\u955c\u50cf</p> <p><code>run.sh</code></p> <pre><code>#!/bin/bash\nfile=\"images.txt\"\nusername=\"finleyma\"\nwhile read -r line\ndo\nnew_image=`echo ${line#*/} | sed 's|/|-|g'`\necho \"docker pull ${line}\"\necho \"docker tag ${line} ${username}/${new_image}\"\necho \"docker push v5cn/${new_image}\"\ndone &lt; \"$file\"\n</code></pre> <p><code>images.txt</code></p> <pre><code>k8s.gcr.io/defaultbackend-amd64:1.5\nk8s.gcr.io/ingress-nginx/controller:v0.46.0\nk8s.gcr.io/pause:3.2\nk8s.gcr.io/kube-controller-manager:v1.19.7\nk8s.gcr.io/kube-scheduler:v1.19.7\nk8s.gcr.io/kube-proxy:v1.19.7\nk8s.gcr.io/kube-apiserver:v1.19.7\nk8s.gcr.io/etcd:3.4.13-0\nk8s.gcr.io/coredns:1.7.0\nquay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#92-harbor\u955c\u50cf\u540c\u6b65\u529f\u80fd","title":"9.2 harbor\u955c\u50cf\u540c\u6b65\u529f\u80fd","text":"<p>\u4ee5\u4e00\u4e2a\u628adockerhub\u7684\u540d\u79f0\u4e3afinleyma/raco-bird\u7684\u955c\u50cf\u540c\u6b65\u5230harbor\u4e3a\u4f8b</p> <p>\u5de6\u4fa7\u83dc\u5355\uff1a\u4ed3\u5e93\u7ba1\u7406 - \u521b\u5efa\u76ee\u6807\uff0c\u5f39\u51fa\u7684\u5bf9\u8bdd\u6846\u4e2d</p> <p>\u76ee\u6807\u540d: hub.docker.com</p> <p>\u76ee\u6807URL: https://hub.docker.com</p> <p>\u5de6\u4fa7\u83dc\u5355\uff1a\u590d\u5236\u7ba1\u7406 - \u6dfb\u52a0\u89c4\u5219</p> <ul> <li>\u540d\u79f0: raco-bird</li> <li>\u63cf\u8ff0: \u540c\u6b65docker hub\u7684finleyma/raco-bird\u5230harbor</li> </ul> <p></p> <ul> <li>\u6e90\u8d44\u6e90\u8fc7\u6ee4\u5668: finleyma/raco-bird</li> <li>Ta: latest</li> <li>\u89e6\u53d1\u6a21\u5f0f: \u624b\u52a8</li> <li>\u52fe\u9009: \u8986\u76d6\u548c\u542f\u52a8\u89c4\u5219</li> </ul> <p>\u70b9\u51fb\"\u590d\u5236\"\u6309\u94ae </p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#93-\u4f7f\u7528image-syncer\u5de5\u5177","title":"9.3 \u4f7f\u7528image-syncer\u5de5\u5177","text":"<p>\u6d89\u53ca\u5230\u4e0b\u8f7d\u548c\u4e0a\u4f20\uff0c\u6ce8\u610f\u670d\u52a1\u5668\u4e0a\u4f20\u5e26\u5bbd\u9650\u5236</p> <p>image-syncer</p> <p>\u4f7f\u7528harbor\u4ee3\u7406\u7f13\u5b58docker hub</p> <p>https://www.lishuai.fun/2020/11/05/harbor-proxy/</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#10\u5f00\u6e90\u56fe\u5f62\u5316\u7ba1\u7406\u7cfb\u7edf","title":"10.\u5f00\u6e90\u56fe\u5f62\u5316\u7ba1\u7406\u7cfb\u7edf","text":"<p>\u4e3a\u4ec0\u4e48\u9700\u8981docker\u56fe\u5f62\u5316\u7ba1\u7406\u5e73\u53f0\uff1f</p> <p>\u547d\u4ee4\u884c\u867d\u7136\u6548\u7387\u9ad8\uff0c\u4f46\u592a\u4e13\u4e1a\uff0c\u4e0d\u591f\u76f4\u89c2\uff0c\u800c\u4e14\u591a\u4e3b\u673a\u7ba1\u7406\u4e0d\u65b9\u4fbf\u3002 \u56fe\u5f62\u5316\u7ba1\u7406\u7cfb\u7edf\u8fd8\u53ef\u4ee5\u548c\u7528\u6237\u89d2\u8272\u7ba1\u7406\u7b49\u5173\u8054\u8d77\u6765\u3002\u4e0d\u7528\u592a\u591a\u7684\u4e13\u4e1a\u77e5\u8bc6\u4e5f\u80fd\u5f88\u5feb\u4e0a\u624b\u3002</p> <p>\u90fd\u6709\u54ea\u4e9b\u5f00\u6e90\u514d\u8d39\u7684docker\u56fe\u5f62\u5316\u7ba1\u7406\u5e73\u53f0\uff1f</p> <p>\u622a\u81f3\u5f53\u524d(2018\u5e74) Rancher \u548c portainer \u6bd4\u8f83\u706b\uff0cstar\u6570\u91cf\u90fd\u5c06\u8fd11w\u3002\u8fd8\u6709\u4e2ashipyard\uff0c\u4f46\u662f\u4f5c\u8005\u5df2\u7ecf\u505c\u6b62\u7ef4\u62a4\uff0c\u5e76\u63a8\u8350\u4f7f\u7528\u524d\u9762\u4e24\u6b3e\u3002</p> <p>Portainer \u6bd4 Rancher \u8981\u8f7b\u91cf\uff0c\u5982\u679c\u521a\u63a5\u89e6 Docker\uff0c\u5efa\u8bae\u5148\u4f7f\u7528\u8fd9\u4e2a\u3002\u5982\u679c\u8981\u56fe\u5f62\u5316\u7ba1\u7406 Kubernetes \u5c31\u7528 Rancher\u3002</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#101-portainer","title":"10.1 Portainer","text":"<p>Portainer\u662f\u4e00\u4e2a\u5f00\u6e90\u3001\u8f7b\u91cf\u7ea7Docker\u7ba1\u7406\u7528\u6237\u754c\u9762\uff0c\u57fa\u4e8eDocker API\uff0c\u53ef\u7ba1\u7406Docker\u4e3b\u673a\u6216Swarm\u96c6\u7fa4\uff0c\u652f\u6301\u6700\u65b0\u7248Docker\u548cSwarm\u6a21\u5f0f\u3002</p> <p>Docker\u53ef\u89c6\u5316\u7ba1\u7406\u5de5\u5177 \u2013 Portainer</p> <pre><code>docker run -d -p 9000:9000 --restart=always --name portainer -v /var/run/docker.sock:/var/run/docker.sock registry.cn-hangzhou.aliyuncs.com/zhengqing/portainer:1.24.1\n</code></pre> <p>\u5177\u4f53\u7ec6\u8282\u53c2\u8003\uff1a </p> <p>https://portainer.readthedocs.io/en/latest/deployment.html#quick-start </p> <p>\u5173\u4e8e\u5728Windows\u8fd0\u884c\u7684\u6559\u7a0b:</p> <p>http://blog.airdesk.com/2017/10/windows-containers-portainer-gui.html</p> <p>\u5b98\u65b9\u7f51\u7ad9\uff1a</p> <p>https://www.portainer.io/</p> <pre><code># 1\u3001\u521b\u5efa\u5377\ndocker volume create portainer_data\n\n# 2\u3001\u521b\u5efaPortainer\u5bb9\u5668\ndocker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer\n</code></pre>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#102-rancher","title":"10.2 Rancher","text":"<p>\u9488\u5bf9Kubernetes\u4f01\u4e1a\u7ea7\u7ba1\u7406\u7cfb\u7edf</p> <p>\u6587\u6863\uff1a Rancher</p>"},{"location":"Docker/1.%E5%9F%BA%E7%A1%80/9.Docker%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/#103-lazydocker","title":"10.3 lazydocker","text":"<p>\u7ec8\u7aef\u7528\u6237\u754c\u9762</p> <p>lazydocker\uff0c\u4e00\u4e2a\u7b80\u5355\u7684 docker \u548c docker-compose \u7ec8\u7aef\u7528\u6237\u754c\u9762\uff0c\u7528\u66f4\u61d2\u60f0\u7684\u65b9\u5f0f\u6765\u7ba1\u7406\u6240\u6709\u7684 docker\u3002</p> <p>\u53c2\u8003\u8d44\u6e90\u94fe\u63a5</p> <p>\u5b98\u65b9\u7f51\u7ad9</p> <p>Docker\u5b98\u65b9\u4e3b\u9875\uff1ahttps://www.docker.com</p> <p>Docker\u5b98\u65b9\u535a\u5ba2\uff1ahttps://blog.docker.com/</p> <p>Docker\u5b98\u65b9\u6587\u6863\uff1ahttps://docs.docker.com/</p> <p>Docker Hub\uff1ahttps://hub.docker.com</p> <p>Docker\u516c\u53f8\u7684\u5f00\u6e90\u4ee3\u7801\u4ed3\u5e93\uff1ahttps://github.com/docker</p> <p>Docker\u7684\u5f00\u6e90\u9879\u76eeMoby\u4ed3\u5e93\uff1ahttps://github.com/moby/moby</p> <p>Docker\u53d1\u5e03\u7248\u672c\u5386\u53f2\uff1ahttps://docs.docker.com/release-notes/</p> <p>Docker\u5e38\u89c1\u95ee\u9898\uff1ahttps://docs.docker.com/engine/faq/</p> <p>Docker SDK\u548cAPI\uff1ahttps://docs.docker.com/develop/sdk/</p> <p>\u5f00\u53d1\u5bb9\u5668\u7ec4\u7ec7OCI\uff1ahttps://www.opencontainers.org/</p> <p>\u5b9e\u8df5\u53c2\u8003</p> <p>Dockerfile\u53c2\u8003\uff1ahttps://docs.docker.com/engine/reference/builder/</p> <p>Dockerfile\u6700\u4f73\u5b9e\u8df5\uff1ahttps://docs.docker.com/develop/develop-images/dockerfile_best-practices/</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/","title":"1.\u64cd\u4f5c\u7cfb\u7edf","text":"<p>\u76ee\u524d\u5e38\u7528\u7684Linux\u53d1\u884c\u7248\u4e3b\u8981\u5305\u62ecDebian/Ubuntu\u7cfb\u5217\u548cCentOS/Fedora\u7cfb\u5217\u3002\u524d\u8005\u4ee5\u81ea\u5e26\u8f6f\u4ef6\u5305\u7248\u672c\u8f83\u65b0\u800c\u51fa\u540d\uff1b\u540e\u8005\u5219\u5ba3\u79f0\u8fd0\u884c\u66f4\u7a33\u5b9a\u4e00\u4e9b\u3002\u9009\u62e9\u54ea\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u53d6\u51b3\u4e8e\u8bfb\u8005\u7684\u5177\u4f53\u9700\u6c42\u3002\u540c\u65f6\uff0c\u793e\u533a\u8fd8\u63a8\u51fa\u4e86\u7cbe\u7b80\u7248\u7684Busybox\u548cAlphine\u3002</p> <p>\u4f7f\u7528Docker\uff0c\u53ea\u9700\u8981\u4e00\u4e2a\u547d\u4ee4\u5c31\u80fd\u5feb\u901f\u83b7\u53d6\u4e00\u4e2aLinux\u53d1\u884c\u7248\u955c\u50cf\uff0c\u8fd9\u662f\u4ee5\u5f80\u5404\u79cd\u865a\u62df\u5316\u6280\u672f\u90fd\u96be\u4ee5\u5b9e\u73b0\u7684\u3002\u8fd9\u4e9b\u955c\u50cf\u4e00\u822c\u90fd\u5f88\u7cbe\u7b80\uff0c\u4f46\u662f\u53ef\u4ee5\u652f\u6301\u5b8c\u6574Linux\u7cfb\u7edf\u7684\u5927\u90e8\u5206\u529f\u80fd\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#1-busybox","title":"1 BusyBox","text":"<p>BusyBox\u662f\u4e00\u4e2a\u96c6\u6210\u4e86\u4e00\u767e\u591a\u4e2a\u6700\u5e38\u7528Linux\u547d\u4ee4\uff08\u5982cat\u3001echo\u3001grep\u3001mount\u3001telnet\u7b49\uff09\u7684\u7cbe\u7b80\u5de5\u5177\u7bb1\uff0c\u5b83\u53ea\u6709\u4e0d\u52302 MB\u5927\u5c0f\uff0c\u88ab\u8a89\u4e3a\u201cLinux\u7cfb\u7edf\u7684\u745e\u58eb\u519b\u5200\u201d\u3002BusyBox\u53ef\u8fd0\u884c\u4e8e\u591a\u6b3ePOSIX\u73af\u5883\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u5982Linux\uff08\u5305\u62ecAndroid\uff09\u3001Hurd\u3001FreeBSD\u7b49\u3002</p> <p>1.\u83b7\u53d6\u5b98\u65b9\u955c\u50cf</p> <pre><code>[root@swarm1 centos]# docker search busybox\nNAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED\nbusybox                   Busybox base image.                             1805                [OK]                progrium/busybox                                                          71                                      [OK]\nradial/busyboxplus        Full-chain, Internet enabled, busybox made f\u2026   26                                      [OK]\narm32v7/busybox           Busybox base image.                             8                                       yauritux/busybox-curl     Busybox with CURL                               6                                       armhf/busybox             Busybox base image.                             6                                       odise/busybox-curl                                                        4                                       [OK]\narm64v8/busybox           Busybox base image.                             3                                       prom/busybox              Prometheus Busybox Docker base images           2                                       [OK]\n</code></pre> <p>\u8bfb\u8005\u53ef\u4ee5\u770b\u5230\u6700\u53d7\u6b22\u8fce\u7684\u955c\u50cf\u540c\u65f6\u5e26\u6709OFFICIAL\u6807\u8bb0\uff0c\u8bf4\u660e\u5b83\u662f\u5b98\u65b9\u955c\u50cf\u3002\u53ef\u4f7f\u7528docker pull\u6307\u4ee4\u4e0b\u8f7d\u955c\u50cfbusybox\uff1alatest\uff1a <pre><code>$ docker pull busybox:latest\n</code></pre></p> <p>\u4e0b\u8f7d\u540e\uff0c\u53ef\u4ee5\u770b\u5230busybox\u955c\u50cf\u53ea\u67091.22MB\uff1a</p> <pre><code>[root@192 ~]# docker images|grep busybox\nbusybox                 latest              be5888e67be6        13 days ago         1.22MB\n</code></pre> <p>2.\u8fd0\u884cbusybox</p> <pre><code>[root@192 ~]# docker run -it busybox\n/ # grep\n</code></pre> <p>\u67e5\u770b\u5bb9\u5668\u5185\u7684\u6302\u8f7d\u4fe1\u606f <pre><code>/ # mount\nrootfs on / type rootfs (rw)\noverlay on / type overlay (rw,relatime,lowerdir=/var/lib/docker/overlay2/l/UI4OXIW6TOJHVYVGCPVHXPH6HU:/var/lib/docker/overlay2/l/NPBGQ34AKVDOUYEXCQIDYMYBNW,up\nperdir=/var/lib/docker/overlay2/a5bc45412d146530f69332687a54568484580cedd5b8ebc8b91310d5aec92e54/diff,workdir=/var/lib/docker/overlay2/a5bc45412d146530f69332687a54568484580cedd5b8ebc8b91310d5aec92e54/work)proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)\ntmpfs on /dev type tmpfs (rw,nosuid,size=65536k,mode=755)\n......\n</code></pre> bosybox\u955c\u50cf\u867d\u7136\u5c0f\u5de7\uff0c\u4f46\u5305\u62ec\u4e86\u5927\u91cf\u5e38\u89c1\u7684Linux\u547d\u4ee4\u3002\u53ef\u4ee5\u7528\u5b83\u5feb\u901f\u719f\u6089Linux\u547d\u4ee4\u3002</p> <p>\u76f8\u5173\u8d44\u6e90</p> <p>BusyBox \u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>BusyBox\u5b98\u7f51\uff1ahttps://busybox.net/</li> <li>BusyBox\u5b98\u65b9\u4ed3\u5e93\uff1ahttps://git.busybox.net/busybox/</li> <li>BusyBox\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/busybox/</li> <li>BusyBox\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/docker-library/busybox</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#2-alpine","title":"2 Alpine","text":"<p>1.\u7b80\u4ecb</p> <p>Alpine\u64cd\u4f5c\u7cfb\u7edf\u662f\u4e00\u4e2a\u9762\u5411\u5b89\u5168\u7684\u8f7b\u578bLinux\u53d1\u884c\u7248\uff0c\u5173\u6ce8\u5b89\u5168\uff0c\u6027\u80fd\u548c\u8d44\u6e90\u6548\u80fd\u3002\u4e0d\u540c\u4e8e\u5176\u4ed6\u53d1\u884c\u7248\uff0cAlpine\u91c7\u7528\u4e86musl libc\u548cBusyBox\u4ee5\u51cf\u5c0f\u7cfb\u7edf\u7684\u4f53\u79ef\u548c\u8fd0\u884c\u65f6\u8d44\u6e90\u6d88\u8017\uff0c\u6bd4BusyBox\u529f\u80fd\u4e0a\u66f4\u5b8c\u5584\u3002\u5728\u4fdd\u6301\u7626\u8eab\u7684\u540c\u65f6\uff0cAlpine\u8fd8\u63d0\u4f9b\u4e86\u5305\u7ba1\u7406\u5de5\u5177apk\u67e5\u8be2\u548c\u5b89\u88c5\u8f6f\u4ef6\u5305\u3002</p> <p>Alpine Docker\u955c\u50cf\u7ee7\u627f\u4e86Alpine Linux\u53d1\u884c\u7248\u7684\u8fd9\u4e9b\u4f18\u52bf\u3002\u76f8\u6bd4\u4e8e\u5176\u4ed6\u955c\u50cf\uff0c\u5b83\u7684\u5bb9\u91cf\u975e\u5e38\u5c0f\uff0c\u4ec5\u4ec5\u53ea\u67095 MB\u5de6\u53f3\uff08Ubuntu\u7cfb\u5217\u955c\u50cf\u63a5\u8fd1200 MB\uff09\u3002\u5b98\u65b9\u955c\u50cf\u6765\u81eadocker-alpine\u9879\u76ee\u3002</p> <p>\u76ee\u524dDocker\u5b98\u65b9\u63a8\u8350\u4f7f\u7528Alpine\u4f5c\u4e3a\u9ed8\u8ba4\u7684\u57fa\u7840\u955c\u50cf\u73af\u5883\uff0c\u8fd9\u53ef\u4ee5\u5e26\u6765\u591a\u4e2a\u4f18\u52bf\uff0c\u5982\u955c\u50cf\u4e0b\u8f7d\u901f\u5ea6\u52a0\u5feb\u3001\u955c\u50cf\u5b89\u5168\u6027\u63d0\u9ad8\u3001\u4e3b\u673a\u4e4b\u95f4\u7684\u5207\u6362\u66f4\u65b9\u4fbf\u3001\u5360\u7528\u66f4\u5c11\u78c1\u76d8\u7a7a\u95f4\u7b49\u3002</p> <p>\u4e0b\u9762\u662f\u5b98\u65b9\u955c\u50cf\u7684\u5927\u5c0f\u6bd4\u8f83\uff0c \u53ef\u4ee5\u770b\u51faAlpine \u955c\u50cf\u7684\u663e\u8457\u4f18\u52bf\uff1a</p> <pre><code>REPOSITORY          TAG           IMAGE ID          VIRTUAL SIZE\nalpine              latest        4e38e38c8ce0      4.799 MB\ndebian              latest        4d6ce913b130      84.98 MB\nubuntu              latest        b39b81afc8ca      188.3 MB\ncentos              latest        8efe422e6104      210 MB\n</code></pre> <p>2.\u83b7\u53d6\u5e76\u4f7f\u7528\u5b98\u65b9\u955c\u50cf</p> <pre><code>$ docker run alpine echo '123'\n123\n</code></pre> <p>\u672c\u5730\u5728\u6ca1\u6709\u63d0\u524dpull\u955c\u50cf\u7684\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u6267\u884cecho\u547d\u4ee4\uff0c\u4ec5\u9700\u89813\u79d2\u5de6\u53f3 <pre><code>$ time docker run alpine echo '123'\nUnable to find image 'alpine:latest' locallylatest: Pulling from library/alpine\ne110a4a17941: Pull completeDigest: sha256:3dcdb92d7432d56604d4545cbd324b14e647b313626d99b889d0626de158f73aStatus: Downloaded newer image for alpine:latest123\nreal 0m3.367s user 0m0.040s sys 0m0.007s\n</code></pre></p> <p>3.\u8fc1\u79fb\u81f3Alpine\u57fa\u7840\u955c\u50cf</p> <p>\u76ee\u524d\uff0c\u5927\u90e8\u5206Docker\u5b98\u65b9\u955c\u50cf\u90fd\u5df2\u7ecf\u652f\u6301Alpine\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\uff0c\u53ef\u4ee5\u5f88\u5bb9\u6613\u8fdb\u884c\u8fc1\u79fb\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>- ubuntu/debian-&gt;alpine\n\n- python\uff1a2.7-&gt;python\uff1a3.6-alpine\n\n- ruby\uff1a2.6-&gt;ruby\uff1a2.6-alpine\n</code></pre> <p>\u5982\u679c\u4f7f\u7528Aline\u955c\u50cf\uff0c\u5b89\u88c5\u8f6f\u4ef6\u5305\u65f6\u53ef\u4ee5\u4f7f\u7528apk\u5de5\u5177\uff0c\u5219\u5982\uff1a</p> <pre><code>$ apk add --no-cache &lt;package&gt;\n</code></pre> <p>Alpine\u4e2d\u8f6f\u4ef6\u5b89\u88c5\u5305\u7684\u540d\u5b57\u53ef\u80fd\u4f1a\u4e0e\u5176\u4ed6\u53d1\u884c\u7248\u6709\u6240\u4e0d\u540c\uff0c\u53ef\u4ee5\u5728https://pkgs.alpinelinux.org/packages \u7f51\u7ad9\u641c\u7d22\u5e76\u786e\u5b9a\u5b89\u88c5\u5305\u540d\u79f0\u3002</p> <p>\u5982\u679c\u9700\u8981\u7684\u5b89\u88c5\u5305\u4e0d\u5728\u4e3b\u7d22\u5f15\u5185\uff0c\u4f46\u662f\u5728\u6d4b\u8bd5\u6216\u793e\u533a\u7d22\u5f15\u4e2d\u3002\u90a3\u4e48\u9996\u5148\u9700\u8981\u66f4\u65b0\u4ed3\u5e93\u5217\u8868\uff0c\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>$ echo \"http://dl-4.alpinelinux.org/alpine/edge/testing\" &gt;&gt; /etc/apk/repositories\n$ apk --update add --no-cache &lt;package&gt;\n</code></pre> <p>\u4f8b\u5b50\u5982\u4e0b\uff1a</p> <pre><code>$ docker run -it alpine\n/ # echo \"http://mirrors.ustc.edu.cn/alpine/v3.5/main\" &gt;&gt; /etc/apk/repositories \n/ # apk --update add --no-cache git\n/ # apk --update add --no-cache wget\n/ # apk --update add --no-cache &lt;package&gt;\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#21-\u7cbe\u7b80\u7684ssh","title":"2.1 \u7cbe\u7b80\u7684ssh","text":"<p>\u5728\u6d41\u6c34\u7ebf\u6301\u7eed\u96c6\u6210\u4e2d\uff0c\u53ef\u80fd\u5c31\u4f1a\u7528\u5230\uff0c\u6240\u4ee5\u8fd9\u91cc\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\uff1a</p> <p>Dockerfile</p> <pre><code>FROM alpine\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories &amp;&amp; apk add --update-cache openssh rsync &amp;&amp; rm -rf /var/cache/apk/*\n</code></pre> <p>\u56e0\u4e3a\u5b98\u65b9\u7684\u6e90\u5b89\u88c5\u8f6f\u4ef6\u975e\u5e38\u6162\uff0c\u6240\u4ee5\u6362\u4e00\u4e0b\u6e90\uff0c\u7136\u540e\u5b89\u88c5\u4e00\u4e0b\u5e38\u7528\u547d\u4ee4\uff0c\u90a3\u4e48\u5728\u6d41\u6c34\u7ebf\u96c6\u6210\u4e2d\uff0c\u8c03\u7528\u8fd9\u4e2a\u955c\u50cf\uff0c\u7528\u5b8c\u5c31\u505c\u6389\u4e86\uff0c\u5f88\u65b9\u4fbf\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#22-\u7f16\u8bd1\u7528\u7684maven","title":"2.2 \u7f16\u8bd1\u7528\u7684maven","text":"<p>\u4f7f\u7528\u5982\u4e0b\u6587\u4ef6\u6784\u5efa\uff1a</p> <p>Dockerfile</p> <pre><code>FROM alpine\nMAINTAINER eryajf &lt;Linuxlql@163.com&gt;\nRUN echo \"https://mirror.tuna.tsinghua.edu.cn/alpine/v3.4/main\" &gt; /etc/apk/repositories &amp;&amp; \\\necho \"https://mirror.tuna.tsinghua.edu.cn/alpine/v3.4/community\" &gt;&gt; /etc/apk/repositories &amp;&amp; \\\necho \"http://mirrors.aliyun.com/alpine/latest-stable/main\" &gt;&gt; /etc/apk/repositories &amp;&amp; \\\necho \"http://mirrors.aliyun.com/alpine/latest-stable/community\" &gt;&gt; /etc/apk/repositories &amp;&amp; \\\napk update &amp;&amp; apk upgrade &amp;&amp; apk add openjdk8 maven ca-certificates tzdata &amp;&amp; rm -rf /var/cache/apk/*\nRUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \\\necho \"Asia/Shanghai\" &gt; /etc/timezone\n</code></pre> <p>\u76f8\u5173\u8d44\u6e90\uff1a</p> <p>Apline\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Apline\u5b98\u7f51\uff1ahttp://alpinelinux.org/</li> <li>Apline\u5b98\u65b9\u4ed3\u5e93\uff1ahttps://github.com/alpinelinux</li> <li>Apline\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/alpine/</li> <li>Apline\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/gliderlabs/docker-alpine</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#3-debianubantu","title":"3 Debian/Ubantu","text":""},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#31-debian","title":"3.1 Debian","text":"<p>Debian\u548cUbuntu\u90fd\u662f\u76ee\u524d\u8f83\u4e3a\u6d41\u884c\u7684Debian\u7cfb\u7684\u670d\u52a1\u5668\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5341\u5206\u9002\u5408\u7814\u53d1\u573a\u666f\u3002</p> <p>Docker Hub\u4e0a\u63d0\u4f9b\u4e86\u5b83\u4eec\u7684\u5b98\u65b9\u955c\u50cf\uff0c\u56fd\u5185\u5404\u5927\u5bb9\u5668\u4e91\u670d\u52a1\u90fd\u63d0\u4f9b\u4e86\u5b8c\u6574\u7684\u652f\u6301\u3002</p> <p>1.Debian\u7cfb\u7edf\u7b80\u4ecb\u53ca\u5b98\u65b9\u955c\u50cf\u4f7f\u7528</p> <p>Debian\u662f\u57fa\u4e8eGPL\u6388\u6743\u7684\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf\uff0c\u662f\u76ee\u524d\u4e2a\u4eba\u7535\u8111\u4e0e\u670d\u52a1\u5668\u4e2d\u6700\u53d7\u6b22\u8fce\u7684\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u4e00\uff0c\u7531Debian\u8ba1\u5212\uff08Debian Project\uff09\u7ec4\u7ec7\u7ef4\u62a4\u3002Debian\u4ee5\u5176\u575a\u5b88Unix\u548c\u81ea\u7531\u8f6f\u4ef6\u7684\u7cbe\u795e\uff0c\u53ca\u7ed9\u4e88\u7528\u6237\u7684\u4f17\u591a\u9009\u62e9\u800c\u95fb\u540d\u3002\u76ee\u524dDebian\u5305\u62ec\u8d85\u8fc725 000\u4e2a\u8f6f\u4ef6\u5305\u5e76\u652f\u630112\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784\u3002</p> <p>\u5728Docker Hub\u4e2d\u641c\u7d22debian\u76f8\u5173\u7684\u955c\u50cf</p> <p><pre><code>$ docker search debian\nNAME DESCRIPTION                                        STARS OFFICIAL AUTOMATED\nubuntu Ubuntu is a Debian-based Linux operating sys\u2026   7664                 [OK]\ndebian Debian is a Linux distribution that's compos\u2026   2569                 [OK]\n...\n</code></pre> \u4f7f\u7528docker run\u547d\u4ee4\u76f4\u63a5\u8fd0\u884cDebian\u955c\u50cf\u3002</p> <pre><code>$ docker run -it debian bash\nroot@668e178d8d69:/# cat /etc/issue\nDebian GNU/Linux 8\n</code></pre> <p>\u53ef\u4ee5\u5c06Debian\u955c\u50cf\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\u6765\u6784\u5efa\u81ea\u5b9a\u4e49\u955c\u50cf\u3002\u5982\u9700\u8981\u8fdb\u884c\u672c\u5730\u5316\u914d\u7f6e\uff0c\u5982UTF-8\u652f\u6301\uff0c\u53ef\u53c2\u8003:</p> <pre><code>RUN apt-get update &amp;&amp; apt-get install -y locales &amp;&amp; rm -rf /var/lib/apt/lists/* \\\n    &amp;&amp; localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8\nENV LANG en_US.utf8\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#32-ubantu","title":"3.2 Ubantu","text":"<p>Ubuntu\u662f\u4ee5\u684c\u9762\u5e94\u7528\u4e3a\u4e3b\u7684GNU/Linux\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5176\u540d\u79f0\u6765\u81ea\u975e\u6d32\u5357\u90e8\u7956\u9c81\u8bed\u6216\u8c6a\u8428\u8bed\u7684\u201cubuntu\u201d\u4e00\u8bcd\u3002\u5b98\u65b9\u8bd1\u540d\u201c\u53cb\u5e2e\u62d3\u201d\uff0c\u53e6\u6709\u201c\u4e4c\u73ed\u56fe\u201d\u7b49\u8bd1\u540d\u3002Ubuntu\u6bcf6\u4e2a\u6708\u4f1a\u53d1\u5e03\u4e00\u4e2a\u65b0\u7248\u672c\uff0c\u6bcf\u4e24\u5e74\u63a8\u51fa\u4e00\u4e2a\u957f\u671f\u652f\u6301\uff08Long Term Support\uff0cLTS\uff09\u7248\u672c\uff0c\u4e00\u822c\u652f\u63013\u5e74\u65f6\u95f4\u3002</p> <p>Ubuntu\u76f8\u5173\u7684\u955c\u50cf\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u53ea\u641c\u7d22\u90a3\u4e9b\u8bc4\u661f50\u4ee5\u4e0a\u7684\u955c\u50cf\uff1a</p> <pre><code>$ docker search --filter=stars=50 ubuntu\nroot@3b42e05dfae5:/# cat /etc/lsb-release DISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=18.04\nDISTRIB_CODENAME=bionic\nDISTRIB_DESCRIPTION=\"Ubuntu 18.04.4 LTS\"\n# \u6267\u884capt-get update\u547d\u4ee4\u66f4\u65b0\u4ed3\u5e93\u4fe1\u606f\napt-get update\n\n# \u5b89\u88c5curl\u5de5\u5177\napt-get install -y curl\n\n# \u5b89\u88c5apache\u670d\u52a1\napt-get install -y apache2\n\n# \u542f\u52a8apache\u670d\u52a1\nservice apache2 start\n</code></pre> <pre><code>$ docker run --name some-ubuntu -it ubuntu:20.04\nroot@523c70904d54:/#\n</code></pre> <p>Dockerfile \u8bf7\u5230 https://github.com/docker-library/docs/tree/master/ubuntu \u67e5\u770b\u3002</p> <p>\u914d\u5408\u4f7f\u7528-p\u53c2\u6570\u5bf9\u5916\u6620\u5c04\u670d\u52a1\u5668\u7aef\u53e3\uff0c\u53ef\u4ee5\u5141\u8bb8\u5bb9\u5668\u6765\u8bbf\u95ee\u8be5\u670d\u52a1\u3002</p> <p>\u76f8\u5173\u8d44\u6e90</p> <p>Debian \u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Debian\u5b98\u7f51\uff1ahttps://www.debian.org/</li> <li>Debian\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/debian/</li> </ul> <p>Ubuntu\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Ubuntu\u5b98\u7f51\uff1ahttp://www.ubuntu.org.cn/global</li> <li>Ubuntu\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/ubuntu/</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#4-centosfedora","title":"4 CentOS/Fedora","text":"<p>CentOS\u548cFedora\u90fd\u662f\u57fa\u4e8eRedhat\u7684Linux\u53d1\u884c\u7248\u3002</p> <p>CentOS\u662f\u76ee\u524d\u4f01\u4e1a\u7ea7\u670d\u52a1\u5668\u7684\u5e38\u7528\u64cd\u4f5c\u7cfb\u7edf\uff1bFedora\u5219\u4e3b\u8981\u9762\u5411\u4e2a\u4eba\u684c\u9762\u7528\u6237\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#41-centos","title":"4.1 CentOS","text":"<p>CentOS\uff08Community Enterprise Operating System\uff0c\u793e\u533a\u4f01\u4e1a\u64cd\u4f5c\u7cfb\u7edf\uff09\u57fa\u4e8eRed Hat Enterprise Linux\u6e90\u4ee3\u7801\u7f16\u8bd1\u800c\u6210\u3002\u7531\u4e8eCentOS\u4e0eRedHat Linux\u6e90\u4e8e\u76f8\u540c\u7684\u4ee3\u7801\u57fa\u7840\uff0c\u6240\u4ee5\u5f88\u591a\u6210\u672c\u654f\u611f\u4e14\u9700\u8981\u9ad8\u7a33\u5b9a\u6027\u7684\u516c\u53f8\u5c31\u4f7f\u7528CentOS\u6765\u66ff\u4ee3\u5546\u4e1a\u7248Red Hat Enterprise Linux\u3002CentOS\u81ea\u8eab\u4e0d\u5305\u542b\u95ed\u6e90\u8f6f\u4ef6\u3002</p> <pre><code># \u4f7f\u7528docker search\u547d\u4ee4\u6765\u641c\u7d22\u6807\u661f\u81f3\u5c1150\u7684\u76f8\u5173\u955c\u50cf\n$ docker search --filter=stars=50 centos\n\n# \u4f7f\u7528docker run \u76f4\u63a5\u8fd0\u884ccentos\uff0c\u5e76\u767b\u5f55bash\n$ docker run -it centos bash\n</code></pre> <p>Dockerfile \u8bf7\u5230 https://github.com/docker-library/docs/tree/master/centos \u67e5\u770b\u3002</p> <p>Dockerfile</p> <pre><code>#\n# Dockerizing CentOS7: Dockerfile for building CentOS images\n#\n#\u9700\u8981\u4e00\u4e2a\u57fa\u7840\u955c\u50cf\uff0c\u8fd9\u91cc\u4ece\u56fd\u5185\u7684daocloud\u4e0b\u8f7d\uff0c\u901f\u5ea6\u6bd4\u8f83\u5feb\u3002\nFROM       daocloud.io/library/centos:centos7.4.1708\n#\u7ef4\u62a4\u8005\nMAINTAINER eryajf &lt;Linuxlql@163.com&gt;\n#\u8bbe\u7f6e\u4e00\u4e2a\u65f6\u533a\u7684\u73af\u5883\u53d8\u91cf\nENV TZ \"Asia/Shanghai\"\n#\u865a\u62df\u7ec8\u7aef\nENV TERM xterm\n\n#dockerfile\u4e2d\u67092\u6761\u547d\u4ee4\u53ef\u4ee5\u590d\u5236\u6587\u4ef6\uff0c1.COPY 2.ADD\uff0c ADD\u6bd4COPY\u591a2\u4e2a\u529f\u80fd\uff0c\u53ef\u4ee5\u5199\u6210\u8fde\u63a5 \u76f4\u63a5COPY\u5230container\uff0c\u5982\u679c\u662f\u538b\u7f29\u6587\u4ef6\uff0cadd\u80fd\u81ea\u52a8\u89e3\u538b\nADD aliyun-mirror.repo /etc/yum.repos.d/CentOS-Base.repo\nADD aliyun-epel.repo /etc/yum.repos.d/epel.repo\n\nRUN yum install -y curl wget tar bzip2 unzip vim-enhanced passwd sudo yum-utils hostname net-tools rsync man &amp;&amp; \\\nyum install -y gcc gcc-c++ git make automake cmake patch logrotate python-devel libpng-devel libjpeg-devel &amp;&amp; \\\nyum install -y --enablerepo=epel pwgen python-pip python-setuptools.noarch lrzsz ntp docker-client &amp;&amp; \\\nyum clean all\n\n#\u914d\u7f6esupervisor \u8fdb\u7a0b\u7ba1\u7406\u5de5\u5177\uff0c\u8fd0\u884c\u5355\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u4e0d\u4f7f\u7528\nRUN easy_install supervisor &amp;&amp; \\\nmkdir -m 755 -p /etc/supervisor &amp;&amp; \\\nmkdir -m 755 /etc/supervisor/conf.d\nADD supervisord.conf /etc/supervisor/supervisord.conf\n\nEXPOSE 22\nENTRYPOINT [\"/usr/bin/supervisord\", \"-n\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\n</code></pre> <pre><code>FROM centos:7\nRUN cd /etc/yum.repos.d &amp;&amp; mkdir bak &amp;&amp; mv *.repo bak/ \\\n&amp;&amp; curl -s -o ./Centos-7.repo https://mirrors.aliyun.com/repo/Centos-7.repo \\\n&amp;&amp; curl -s -o ./epel.repo https://mirrors.aliyun.com/repo/epel-7.repo \\\n&amp;&amp; sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' Centos-7.repo \\\n&amp;&amp; yum clean all &amp;&amp; yum makecache \\\n&amp;&amp; yum install -y wget vim openssh-server net-tools initscripts \\\n&amp;&amp; /usr/bin/ssh-keygen -A &amp;&amp;  mkdir /var/run/sshd &amp;&amp; echo 'UseDNS no' &gt;&gt;  /etc/ssh/sshd_config &amp;&amp; sed -i -e '/pam_loginuid.so/d' /etc/pam.d/sshd \\\n&amp;&amp; yum clean all &amp;&amp; rm -rf /var/tmp/* &amp;&amp; rm -rf /var/cache/yum/* \\\n&amp;&amp; echo 'root:opsbase' |chpasswd\n\nEXPOSE 22\n# CMD [\"/usr/sbin/sshd\",\"-D\"]\nENTRYPOINT [\"/usr/sbin/sshd\",\"-D\"]\n# ## \u6784\u5efa\u955c\u50cf\n# docker build -t lghost/centos7-ssh:latest . -f sshd-centos7-dockerfile\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#42-fedora","title":"4.2 Fedora","text":"<p>Fedora\u662f\u7531Fedora Project\u793e\u533a\u5f00\u53d1\uff0cRed Hat\u516c\u53f8\u8d5e\u52a9\u7684Linux\u53d1\u884c\u7248\u3002\u5b83\u7684\u76ee\u6807\u662f\u521b\u5efa\u4e00\u5957\u65b0\u9896\u3001\u591a\u529f\u80fd\u5e76\u4e14\u81ea\u7531\u548c\u5f00\u6e90\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <pre><code># \u4f7f\u7528docker search\u547d\u4ee4\u6765\u641c\u7d22\u6807\u661f\u81f3\u5c1150\u7684\u76f8\u5173\u955c\u50cf\ndocker search --filter=stars=50 fedora\n\n# \u4f7f\u7528docker run \u76f4\u63a5\u8fd0\u884cfedora\uff0c\u5e76\u767b\u5f55bash\ndocker run -it fedora bash\n</code></pre> <p>\u76f8\u5173\u8d44\u6e90</p> <p>Fedora \u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Fedora\u5b98\u7f51\uff1ahttps://getfedora.org/</li> <li>Fedora\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/fedora/</li> </ul> <p>CentOS \u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>CentOS \u5b98\u7f51\uff1a https://www.centos.org/</li> <li>CentOS \u5b98\u65b9\u955c\u50cf\uff1a https://hub.docker.com/_/centos/</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#5-\u4e3a\u955c\u50cf\u6dfb\u52a0ssh\u670d\u52a1","title":"5 \u4e3a\u955c\u50cf\u6dfb\u52a0SSH\u670d\u52a1","text":"<p>\u4ecb\u7ecd\u4e24\u79cd\u521b\u5efa\u5bb9\u5668\u7684\u65b9\u6cd5\uff1a\u57fa\u4e8edocker commit\u547d\u4ee4\u521b\u5efa\u548c\u57fa\u4e8eDockerfile\u521b\u5efa\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#51-commit\u547d\u4ee4\u521b\u5efa","title":"5.1 commit\u547d\u4ee4\u521b\u5efa","text":"<p>1.\u51c6\u5907\u5de5\u4f5c \u9996\u5148\uff0c\u83b7\u53d6ubuntu\uff1a18.04\u955c\u50cf\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff1a</p> <pre><code>$ docker pull ubuntu:18.04\n$ docker run -it ubuntu:18.04 /bin/bash\nroot@fc1936ea8ceb:/#\n</code></pre> <p>2.\u914d\u7f6e\u8f6f\u4ef6\u6e90 \u68c0\u67e5\u8f6f\u4ef6\u6e90\uff0c\u5e76\u4f7f\u7528apt-get update\u547d\u4ee4\u6765\u66f4\u65b0\u8f6f\u4ef6\u6e90\u4fe1\u606f\uff1a</p> <pre><code>root@fc1936ea8ceb:/# apt-get update\nroot@fc1936ea8ceb:/# apt-get install vim net-tools\n</code></pre> <p>\u5982\u679c\u9ed8\u8ba4\u7684\u5b98\u65b9\u6e90\u901f\u5ea6\u6162\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u66ff\u6362\u4e3a\u56fd\u5185163\u3001sohu\u7b49\u955c\u50cf\u7684\u6e90\u3002\u4ee5163\u6e90\u4e3a\u4f8b\uff0c\u5728\u5bb9\u5668\u5185\u521b\u5efa/etc/apt/sources.list.d/163.list\u6587\u4ef6\uff1a</p> <pre><code>root@fc1936ea8ceb:/# vi /etc/apt/sources.list.d/163.list\n</code></pre> <p>\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\u5230\u6587\u4ef6\u4e2d\uff1a</p> <pre><code>deb http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse\ndeb http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse\ndeb http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse\ndeb http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse\ndeb http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse\ndeb-src http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse\ndeb-src http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse\ndeb-src http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse\ndeb-src http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse\ndeb-src http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse\n</code></pre> <p>\u4e4b\u540e\u91cd\u65b0\u6267\u884capt-get update\u547d\u4ee4\u5373\u53ef\u3002</p> <p>3.\u5b89\u88c5\u548c\u914d\u7f6eSSH\u670d\u52a1</p> <p>\u66f4\u65b0\u8f6f\u4ef6\u5305\u7f13\u5b58\u540e\u53ef\u4ee5\u5b89\u88c5SSH\u670d\u52a1\u4e86\uff0c\u9009\u62e9\u4e3b\u6d41\u7684openssh-server\u4f5c\u4e3a\u670d\u52a1\u7aef\u3002\u53ef\u4ee5\u770b\u5230\u9700\u8981\u4e0b\u8f7d\u5b89\u88c5\u4f17\u591a\u7684\u4f9d\u8d56\u8f6f\u4ef6\u5305\uff1a</p> <pre><code>root@fc1936ea8ceb:/# apt-get install openssh-server\n</code></pre> <p>\u5982\u679c\u9700\u8981\u6b63\u5e38\u542f\u52a8SSH\u670d\u52a1\uff0c\u5219\u76ee\u5f55/var/run/sshd\u5fc5\u987b\u5b58\u5728\u3002\u4e0b\u9762\u624b\u52a8\u521b\u5efa\u5b83\uff0c\u5e76\u542f\u52a8SSH\u670d\u52a1\uff1a</p> <pre><code>root@fc1936ea8ceb:/# mkdir -p /var/run/sshd\nroot@fc1936ea8ceb:/# /usr/sbin/sshd -D &amp;\n[1] 3254\n</code></pre> <p>\u6b64\u65f6\u67e5\u770b\u5bb9\u5668\u768422\u7aef\u53e3\uff08SSH\u670d\u52a1\u9ed8\u8ba4\u76d1\u542c\u7684\u7aef\u53e3\uff09\uff0c\u53ef\u89c1\u6b64\u7aef\u53e3\u5df2\u7ecf\u5904\u4e8e\u76d1\u542c\u72b6\u6001\uff1a</p> <pre><code>root@fc1936ea8ceb:/# netstat -tunlp\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address      Foreign Address     State    PID/Program name\ntcp        0      0 0.0.0.0:22         0.0.0.0:*           LISTEN   -\ntcp6       0      0 :::22              :::*                LISTEN   -\n</code></pre> <p>\u4fee\u6539SSH\u670d\u52a1\u7684\u5b89\u5168\u767b\u5f55\u914d\u7f6e\uff0c\u53d6\u6d88pam\u767b\u5f55\u9650\u5236\uff1a</p> <pre><code>root@fc1936ea8ceb:/# sed -ri 's/session    required     pam_loginuid.so/#session    required     pam_loginuid.so/g' /etc/pam.d/sshd\n\nroot@fc1936ea8ceb:/# cat /etc/pam.d/sshd | grep pam_loginuid.so\n#session    required     pam_loginuid.so\n</code></pre> <p>\u5728root\u7528\u6237\u76ee\u5f55\u4e0b\u521b\u5efa.ssh\u76ee\u5f55\uff0c\u5e76\u590d\u5236\u9700\u8981\u767b\u5f55\u7684\u516c\u94a5\u4fe1\u606f\uff08\u4e00\u822c\u4e3a\u672c\u5730\u4e3b\u673a\u7528\u6237\u76ee\u5f55\u4e0b\u7684.ssh/id_rsa.pub\u6587\u4ef6\uff0c\u53ef\u7531ssh-keygen-t rsa\u547d\u4ee4\u751f\u6210\uff09\u5230authorized_keys\u6587\u4ef6\u4e2d\uff1a</p> <pre><code>#\u914d\u7f6e\u767b\u5f55\u79d8\u94a5\n# \uff11:\u4e3b\u673a(client)\u751f\u6210\u516c\u94a5\nubuntu@ubuntu:~$ ssh-keygen -trsa\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/home/ubuntu/.ssh/id_rsa):\nEnter passphrase (empty for no passphrase):\nEnter same passphrase again:\nYour identification has been saved in /home/ubuntu/.ssh/id_rsa.\nYour public key has been saved in /home/ubuntu/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:cCJNE3EeRpucmyTAN4tJ1diGO9TVuaNJ4LkPsJisMOE ubuntu@ubuntu\nThe key's randomart image is:\n+---[RSA 3072]----+\n|   ...X=... .   |\n|    o+**=  o    |\n|   ..==*Oo   .   |\n|.   o.=*oo. o    |\n|.. . o +So o .   |\n|oE  + . o o      |\n| o .     o       |\n|  .       .      |\n|                 |\n+----[SHA256]-----+\n\n\u4e00\u76f4\u6572\u56de\u8f66\u5c31\u884c\u4e86\n</code></pre> <pre><code># \uff12\uff1a\u5728\u5bb9\u5668\u4e2d(server)\u4e2d\u521b\u5efa/root/.ssh\u76ee\u5f55\nroot@fc1936ea8ceb:/# mkdir root/.ssh\nroot@fc1936ea8ceb:/# vi /root/.ssh/authorized_keys\n</code></pre> <pre><code># \uff13\uff1a\u5c06client\u7684\u516c\u94a5\u590d\u5236\u5230server\u7684authorized_keys\u6587\u4ef6\u4e2d\nubuntu@ubuntu:~$ cat  /home/ubuntu/.ssh/id_rsa.pub\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDxEH+/DRAITMdyTkVpIiLgvEWm5g03n+1qrN0pYAc78KM/T3Ktxn7e/kO8iqS+42NQIgEtgDq7DcUryxcgizBzeNuqJfjsfUjkiQplwnj7hjC3qfsAu8Re1pRmK\n24eEtz4HxIwd9BepYakl8NLm99PCiTkOtnDFuxNh+u4BbI6tBxmfvrrqRFC8BC5pJRmr7FooOMruzhpXbOnvTLDFaOFJU5ecQX//nBI4uj8UbXoU/ytzkcGBxJ/JXza8fNxRD4sAmQZJ9tJIqeNUBHmn1+KD0y/h5\nxh6xn8LcBASI4cGHo3azGviuWNreSxarOUvxZDWDyHxT3AI+KPvvlKP8gh root@192.168.1.106\n\nroot@92cf48876d4c:~# vi /root/.ssh/authorized_keys\nroot@92cf48876d4c:~# cat /root/.ssh/authorized_keys\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDxEH+/DRAITMdyTkVpIiLgvEWm5g03n+1qrN0pYAc78KM/T3Ktxn7e/kO8iqS+42NQIgEtgDq7DcUryxcgizBzeNuqJfjsfUjkiQplwnj7hjC3qfsAu8Re1pRmK\n24eEtz4HxIwd9BepYakl8NLm99PCiTkOtnDFuxNh+u4BbI6tBxmfvrrqRFC8BC5pJRmr7FooOMruzhpXbOnvTLDFaOFJU5ecQX//nBI4uj8UbXoU/ytzkcGBxJ/JXza8fNxRD4sAmQZJ9tJIqeNUBHmn1+KD0y/h5\nxh6xn8LcBASI4cGHo3azGviuWNreSxarOUvxZDWDyHxT3AI+KPvvlKP8gh root@192.168.1.106\n</code></pre> <p>\u521b\u5efa\u81ea\u52a8\u542f\u52a8SSH\u670d\u52a1\u7684\u53ef\u6267\u884c\u6587\u4ef6run.sh\uff0c\u5e76\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\uff1a</p> <pre><code>root@fc1936ea8ceb:/# vi /run.sh\nroot@fc1936ea8ceb:/# chmod +x run.sh\n</code></pre> <p>run.sh\u811a\u672c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>#!/bin/bash\n/usr/sbin/sshd -D\n</code></pre> <p>\u6700\u540e\uff0c\u9000\u51fa\u5bb9\u5668\uff1a</p> <pre><code>root@fc1936ea8ceb:/# exit\nexit\n</code></pre> <p>4.\u4fdd\u5b58\u955c\u50cf</p> <p>\u5c06\u6240\u9000\u51fa\u7684\u5bb9\u5668\u7528docker commit\u547d\u4ee4\u4fdd\u5b58\u4e3a\u4e00\u4e2a\u65b0\u7684sshd\uff1aubuntu\u955c\u50cf\u3002</p> <pre><code>[root@192 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES\n4d8ac554cdb9        ubuntu:18.04        \"/bin/bash\"         8 minutes ago       Exited (0) 18 seconds ago                       musing_colden\n[root@192 ~]# docker commit 4d8ac sshd:ubuntu\nsha256:53edb4a83015c2f88e67c2f87199a1f72b13a563fe7902f8e0ec17e1e5964b5e\n\n#\u4f7f\u7528sshd:ubuntu\u955c\u50cf,\u6dfb\u52a0\u7aef\u53e3\u6620\u5c0410022--&gt;22\n[root@192 ~]# docker run -p 10022:22 -d sshd:ubuntu /run.sh\nd562ef6176c31d01524a47f74182a719c0f0a91e2c8c82fda063414daa7893d8\n</code></pre> <p>\u542f\u52a8\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u5728\u5bbf\u4e3b\u4e3b\u673a\u4e0a\u770b\u5230\u5bb9\u5668\u8fd0\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p> <pre><code>[root@192 ~]# docker ps -al\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                   NAMES\nd562ef6176c3        sshd:ubuntu         \"/run.sh\"           20 seconds ago      Up 19 seconds       0.0.0.0:10022-&gt;22/tcp   elegant_dubinsky\n</code></pre> <p>\u5728\u5bbf\u4e3b\u4e3b\u673a\uff08192.168.1.200\uff09\u6216\u5176\u4ed6\u4e3b\u673a\u4e0a\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7SSH\u8bbf\u95ee10022\u7aef\u53e3\u6765\u767b\u5f55\u5bb9\u5668\uff1a</p> <pre><code>$ ssh 192.168.1.200 -p 10022\nThe authenticity of host '[192.168.1.200]:10022 ([192.168.1.200]:10022)' can't be established.\nECDSA key fingerprint is 5f:6e:4c:54:8f:c7:7f:32:c2:38:45:bb:16:03:c9:e8.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '[192.168.1.200]:10022' (ECDSA) to the list of known hosts.\nroot@3ad7182aa47f:~#\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#52-\u4f7f\u7528dockerfile\u521b\u5efa","title":"5.2 \u4f7f\u7528Dockerfile\u521b\u5efa","text":"<p>1.\u521b\u5efa\u5de5\u4f5c\u76ee\u5f55 \u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2asshd_ubuntu\u5de5\u4f5c\u76ee\u5f55\uff1a</p> <pre><code>$ mkdir sshd_ubuntu\n$ ls\nsshd_ubuntu\n</code></pre> <p>\u5728\u5176\u4e2d\uff0c\u521b\u5efaDockerfile\u548crun.sh\u6587\u4ef6\uff1a</p> <pre><code>$ cd sshd_ubuntu/\n$ touch Dockerfile run.sh\n$ ls\nDockerfile run.sh\n</code></pre> <p>2.\u7f16\u5199run.sh\u811a\u672c\u548cauthorized_keys\u6587\u4ef6 \u811a\u672c\u6587\u4ef6run.sh\u7684\u5185\u5bb9\u4e0e\u4e0a\u4e00\u5c0f\u8282\u4e2d\u4e00\u81f4\uff1a</p> <pre><code>#!/bin/bash\n/usr/sbin/sshd -D\n</code></pre> <p>\u5728\u5bbf\u4e3b\u4e3b\u673a\u4e0a\u751f\u6210SSH\u5bc6\u94a5\u5bf9\uff0c\u5e76\u521b\u5efaauthorized_keys\u6587\u4ef6\uff1a</p> <pre><code>$ ssh-keygen -t rsa\n...\n$ cat ~/.ssh/id_rsa.pub &gt;authorized_keys\n</code></pre> <p>3.\u7f16\u5199Dockerfile \u4e0b\u9762\u662fDockerfile\u7684\u5185\u5bb9\u53ca\u5404\u90e8\u5206\u7684\u6ce8\u91ca\uff0c\u53ef\u4ee5\u5bf9\u6bd4\u4e0a\u4e00\u8282\u4e2d\u5229\u7528docker commit\u547d\u4ee4\u521b\u5efa\u955c\u50cf\u8fc7\u7a0b\uff0c\u6240\u8fdb\u884c\u7684\u64cd\u4f5c\u57fa\u672c\u4e00\u81f4\uff1a</p> <pre><code>#\u8bbe\u7f6e\u7ee7\u627f\u955c\u50cf\nFROM ubuntu:18.04\n#\u63d0\u4f9b\u4e00\u4e9b\u4f5c\u8005\u7684\u4fe1\u606f\nMAINTAINER docker_user (user@docker.com)\n#\u4e0b\u9762\u5f00\u59cb\u8fd0\u884c\u547d\u4ee4,\u6b64\u5904\u66f4\u6539ubuntu\u7684\u6e90\u4e3a\u56fd\u5185163\u7684\u6e90\nRUN echo \"deb http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse\" &gt; /etc/apt/sources.list\nRUN echo \"deb http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse\" &gt;&gt; /etc/apt/sources.list\nRUN echo \"deb http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse\" &gt;&gt; /etc/apt/sources.list\nRUN echo \"deb http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse\" &gt;&gt; /etc/apt/sources.list\nRUN echo \"deb http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse\" &gt;&gt; /etc/apt/sources.list\nRUN apt-get update\n#\u5b89\u88c5 ssh \u670d\u52a1\nRUN apt-get install -y openssh-server\nRUN mkdir -p /var/run/sshd\nRUN mkdir -p /root/.ssh\n#\u53d6\u6d88pam\u9650\u5236\nRUN sed -ri 's/session    required     pam_loginuid.so/#session    required     pam_loginuid.so/g' /etc/pam.d/sshd\n#\u590d\u5236\u914d\u7f6e\u6587\u4ef6\u5230\u76f8\u5e94\u4f4d\u7f6e,\u5e76\u8d4b\u4e88\u811a\u672c\u53ef\u6267\u884c\u6743\u9650\nADD authorized_keys /root/.ssh/authorized_keys\nADD run.sh /run.sh\nRUN chmod 755 /run.sh\n#\u5f00\u653e\u7aef\u53e3\nEXPOSE 22\n#\u8bbe\u7f6e\u81ea\u542f\u52a8\u547d\u4ee4\nCMD [\"/run.sh\"]\n</code></pre> <p>4.\u521b\u5efa\u955c\u50cf</p> <p>\u5728sshd_ubuntu\u76ee\u5f55\u4e0b\uff0c\u4f7f\u7528docker build\u547d\u4ee4\u6765\u521b\u5efa\u955c\u50cf\u3002\u8fd9\u91cc\u7528\u6237\u9700\u8981\u6ce8\u610f\u5728\u6700\u540e\u8fd8\u6709\u4e00\u4e2a\u201c.\u201d\uff0c\u8868\u793a\u4f7f\u7528\u5f53\u524d\u76ee\u5f55\u4e2d\u7684Dockerfile\uff1a</p> <pre><code>$ cd sshd_ubuntu\n$ docker build -t sshd:dockerfile .\n</code></pre> <p>\u5982\u679c\u8bfb\u8005\u4f7f\u7528Dockerfile\u521b\u5efa\u81ea\u5b9a\u4e49\u955c\u50cf\uff0c\u90a3\u4e48\u9700\u8981\u6ce8\u610f\u7684\u662fDocker\u4f1a\u81ea\u52a8\u5220\u9664\u4e2d\u95f4\u4e34\u65f6\u521b\u5efa\u7684\u5c42\uff0c\u8fd8\u9700\u8981\u6ce8\u610f\u6bcf\u4e00\u6b65\u7684\u64cd\u4f5c\u548c\u7f16\u5199\u7684Dockerfile\u4e2d\u547d\u4ee4\u7684\u5bf9\u5e94\u5173\u7cfb\u3002</p> <p>\u547d\u4ee4\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u5982\u679c\u8bfb\u8005\u770b\u89c1\u201cSuccessfully built XXX\u201d\u5b57\u6837\uff0c\u5219\u8bf4\u660e\u955c\u50cf\u521b\u5efa\u6210\u529f\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u4ee5\u4e0a\u547d\u4ee4\u751f\u6210\u7684\u955c\u50cfID\u662f570c26a9de68\u3002</p> <p>\u5728\u672c\u5730\u67e5\u770bsshd\uff1adockerfile\u955c\u50cf\u5df2\u5b58\u5728\uff1a</p> <pre><code>$ docker images\nREPOSITORY      TAG              IMAGE ID            CREATED             VIRTUAL SIZE\nsshd            dockerfile       570c26a9de68        4 minutes ago       246.5 MB\nsshd            ubuntu           7aef2cd95fd0        12 hours ago        255.2 MB\nbusybox         latest           e72ac664f4f0        3 weeks ago         2.433 MB\nubuntu          16.04            ba5877dc9bec        3 months ago        192.7 MB\nubuntu          latest           ba5877dc9bec        3 months ago        192.7 MB\n</code></pre> <p>5.\u6d4b\u8bd5\u955c\u50cf\uff0c\u8fd0\u884c\u5bb9\u5668</p> <p>\u4e0b\u9762\u4f7f\u7528\u521a\u624d\u521b\u5efa\u7684sshd\uff1adockerfile\u955c\u50cf\u6765\u8fd0\u884c\u4e00\u4e2a\u5bb9\u5668\u3002</p> <p>\u76f4\u63a5\u542f\u52a8\u955c\u50cf\uff0c\u6620\u5c04\u5bb9\u5668\u768422\u7aef\u53e3\u5230\u672c\u5730\u768410122\u7aef\u53e3\uff1a</p> <pre><code>$ docker run -d -p 10122:22 sshd:dockerfile\n890c04ff8d769b604386ba4475253ae8c21fc92d60083759afa77573bf4e8af1\n$ docker ps\nCONTAINER ID  IMAGE    COMMAND     CREATED      STATUS       PORTS           NAMES\n890c04ff8d76  sshd:dockerfile     \"/run.sh\"   4 seconds ago       Up 3 seconds        0.0.0.0:10122-&gt;22/tcp   high_albattani\n</code></pre> <p>\u5728\u5bbf\u4e3b\u4e3b\u673a\u65b0\u6253\u5f00\u4e00\u4e2a\u7ec8\u7aef\uff0c\u8fde\u63a5\u5230\u65b0\u5efa\u7684\u5bb9\u5668\uff1a</p> <p><pre><code>$ ssh 192.168.1.200 -p 10122\nThe authenticity of host '[192.168.1.200]:10122 ([192.168.1.200]:10122)' can't be established.\nECDSA key fingerprint is d1:59:f1:09:3b:09:79:6d:19:16:f4:fd:39:1b:be:27.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '[192.168.1.200]:10122' (ECDSA) to the list of known hosts.\nroot@890c04ff8d76:~#\n</code></pre> \u955c\u50cf\u521b\u5efa\u6210\u529f\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/","title":"2.Web\u670d\u52a1\u4e0e\u5e94\u7528","text":"<p>\u4e0b\u9762\u5c06\u91cd\u70b9\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528Docker\u6765\u8fd0\u884c\u5e38\u89c1\u7684Web\u670d\u52a1\u5668\uff08\u5305\u62ecApache\u3001Nginx\u3001Tomcat\u7b49\uff09\uff0c\u4ee5\u53ca\u4e00\u4e9b\u5e38\u7528\u5e94\u7528\uff08\u5305\u62ecLAMP\u548cCI/CD\uff09</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#1apache","title":"1.Apache","text":"<p>Apache\u662f\u4e00\u4e2a\u9ad8\u7a33\u5b9a\u6027\u7684\u3001\u5546\u4e1a\u7ea7\u522b\u7684\u5f00\u6e90Web\u670d\u52a1\u5668\uff0c\u662f\u76ee\u524d\u4e16\u754c\u4f7f\u7528\u6392\u540d\u7b2c\u4e00\u7684Web\u670d\u52a1\u5668\u8f6f\u4ef6\u3002</p> <p>\u7531\u4e8e\u5176\u826f\u597d\u7684\u8de8\u5e73\u53f0\u548c\u5b89\u5168\u6027\uff0cApache\u88ab\u5e7f\u6cdb\u5e94\u7528\u5728\u591a\u79cd\u5e73\u53f0\u548c\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u3002</p> <p>Apache\u4f5c\u4e3a\u8f6f\u4ef6\u57fa\u91d1\u4f1a\u652f\u6301\u7684\u9879\u76ee\uff0c\u5176\u5f00\u53d1\u8005\u793e\u533a\u5b8c\u5584\u800c\u9ad8\u6548\uff0c\u81ea1995\u5e74\u53d1\u5e03\u81f3\u4eca\uff0c\u4e00\u76f4\u4ee5\u9ad8\u6807\u51c6\u8fdb\u884c\u7ef4\u62a4\u4e0e\u5f00\u53d1\u3002Apache\u97f3\u8bd1\u4e3a\u963f\u5e15\u5947\uff0c\u6e90\u81ea\u7f8e\u56fd\u897f\u5357\u90e8\u4e00\u4e2a\u5370\u7b2c\u5b89\u4eba\u90e8\u843d\u7684\u540d\u79f0\uff08\u963f\u5e15\u5947\u65cf\uff09\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#11-\u4f7f\u7528dockerhub\u955c\u50cf","title":"1.1 \u4f7f\u7528DockerHub\u955c\u50cf","text":"<p>DockerHub\u5b98\u65b9\u63d0\u4f9b\u7684Apache\u955c\u50cf\uff0c\u5e76\u4e0d\u5e26PHP\u73af\u5883\u3002\u5982\u679c\u8bfb\u8005\u9700\u8981PHP\u73af\u5883\u652f\u6301\uff0c\u53ef\u4ee5\u9009\u62e9PHP\u955c\u50cf\uff08https://registry.hub.docker.com/_/php/ \uff09\uff0c\u5e76\u8bf7\u4f7f\u7528\u542b-apache\u6807\u7b7e\u7684\u955c\u50cf\uff0c\u59827.0.7-apache\u3002\u5982\u679c\u4ec5\u9700\u8981\u4f7f\u7528Apache\u8fd0\u884c\u9759\u6001HTML\u6587\u4ef6\uff0c\u5219\u4f7f\u7528\u9ed8\u8ba4\u5b98\u65b9\u955c\u50cf\u5373\u53ef\u3002</p> <p>\u7f16\u5199Dockerfile\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>FROM httpd:2.4\nCOPY ./public-html /usr/local/apache2/htdocs/\n</code></pre> <p>\u540c\u76ee\u5f55\u4e0b\uff1a<code>public-html/index.html</code></p> <p><pre><code>&lt;!DOCTYPE html&gt;\n    &lt;html&gt;\n        &lt;body&gt;\n            &lt;p&gt;Hello, Docker!&lt;/p&gt;\n        &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> \u6784\u5efa\u81ea\u5b9a\u4e49\u955c\u50cf <pre><code>$ docker build -t apache2-image .\n......\nSuccessfully built 881d3fd0d574\n</code></pre> \u542f\u52a8\u955c\u50cf(<code>-d \u5728\u540e\u53f0\u542f\u52a8</code>)</p> <pre><code>[root@192 apache]# docker run -p 80:80 -d apache2-image\n059b9d66b860583634d8001c640b34e0d1b2bc20c9c349e8ee2c424da1ec8c83\n</code></pre> <p>\u901a\u8fc7\u672c\u5730\u768480\u5373\u53ef\u8bbf\u95ee\u9759\u6001\u9875\u9762</p> <pre><code>[root@192 apache]# curl 127.0.0.1\n&lt;!DOCTYPE html&gt;\n    &lt;html&gt;\n        &lt;body&gt;\n            &lt;p&gt;Hello, Docker!&lt;/p&gt;\n        &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p></p> <p>\u4e5f\u53ef\u4ee5\u4e0d\u521b\u5efa\u81ea\u5b9a\u4e49\u955c\u50cf\uff0c\u76f4\u63a5\u901a\u8fc7\u6620\u5c04\u76ee\u5f55\u65b9\u5f0f\u8fd0\u884cApache\u5bb9\u5668\uff1a</p> <pre><code>[root@192 apache]# docker run -it --rm --name my-apache-app -p 80:80 -v \"$PWD\":/usr/local/apache2/htdocs/ httpd:2.4\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this\n messageAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this\n message[Tue Apr 28 13:37:52.753783 2020] [mpm_event:notice] [pid 1:tid 140658846499968] AH00489: Apache/2.4.43 (Unix) configured -- resuming normal operations\n[Tue Apr 28 13:37:52.754159 2020] [core:notice] [pid 1:tid 140658846499968] AH00094: Command line: 'httpd -D FOREGROUND'\n</code></pre> <p>\u518d\u6b21\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u53ef\u4ee5\u518d\u6b21\u770b\u5230\u9875\u9762\u8f93\u51fa\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#12-\u4f7f\u7528\u81ea\u5b9a\u4e49\u955c\u50cf","title":"1.2 \u4f7f\u7528\u81ea\u5b9a\u4e49\u955c\u50cf","text":"<p>\u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2aapache_ubuntu\u5de5\u4f5c\u76ee\u5f55\uff0c\u5728\u5176\u4e2d\u521b\u5efaDockerfile\u6587\u4ef6\u3001run.sh\u6587\u4ef6\u548csample\u76ee\u5f55\uff1a</p> <pre><code>$ mkdir apache_ubuntu &amp;&amp; cd apache_ubuntu\n$ touch Dockerfile run.sh\n$ mkdir sample\n</code></pre> <p>\u4e0b\u9762\u662fDockerfile\u7684\u5185\u5bb9\u548c\u5404\u4e2a\u90e8\u5206\u7684\u8bf4\u660e\uff1a</p> <pre><code>FROM sshd:dockerfile\n#\u8bbe\u7f6e\u7ee7\u627f\u81ea\u7528\u6237\u521b\u5efa\u7684 sshd \u955c\u50cf\nMAINTAINER docker_user (user@docker.com)\n#\u521b\u5efa\u8005\u7684\u57fa\u672c\u4fe1\u606f\n#\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u975e\u4ea4\u4e92\u5f0f\u7684\nENV DEBIAN_FRONTEND noninteractive\n#\u5b89\u88c5\nRUN apt-get -yq install apache2&amp;&amp;\\\nrm -rf /var/lib/apt/lists/*\nRUN echo \"Asia/Shanghai\" &gt; /etc/timezone &amp;&amp; \\\ndpkg-reconfigure -f noninteractive tzdata\n#\u6ce8\u610f\u8fd9\u91cc\u8981\u66f4\u6539\u7cfb\u7edf\u7684\u65f6\u533a\u8bbe\u7f6e\uff0c\u56e0\u4e3a\u5728Web\u5e94\u7528\u4e2d\u7ecf\u5e38\u4f1a\u7528\u5230\u65f6\u533a\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\uff0c\u9ed8\u8ba4Ubuntu\u7684\u8bbe\u7f6e\u4f1a\n\u8ba9\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u53d1\u751f\u4e0d\u53ef\u601d\u8bae\u7684\u6548\u679c\u54e6\n# \u6dfb\u52a0\u7528\u6237\u7684\u811a\u672c\uff0c\u5e76\u8bbe\u7f6e\u6743\u9650\uff0c\u8fd9\u4f1a\u8986\u76d6\u4e4b\u524d\u653e\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u811a\u672c\nADD run.sh /run.sh\nRUN chmod 755 /*.sh\n# \u6dfb\u52a0\u4e00\u4e2a\u793a\u4f8b\u7684Web\u7ad9\u70b9\uff0c\u5220\u6389\u9ed8\u8ba4\u5b89\u88c5\u5728apache\u6587\u4ef6\u5939\u4e0b\u9762\u7684\u6587\u4ef6\uff0c\u5e76\u5c06\u7528\u6237\u6dfb\u52a0\u7684\u793a\u4f8b\u7528\u8f6f\u94fe\u63a5\u94fe\n\u5230/var/www/html\u76ee\u5f55\u4e0b\u9762\nRUN mkdir -p /var/lock/apache2 &amp;&amp;mkdir -p /app &amp;&amp; rm -fr /var/www/html &amp;&amp; ln -s /app /var/www/html\nCOPY sample/ /app\n# \u8bbe\u7f6eapache\u76f8\u5173\u7684\u4e00\u4e9b\u53d8\u91cf\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u7684\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528-e\u53c2\u6570\u66ff\u4ee3\nENV APACHE_RUN_USER www-data\nENV APACHE_RUN_GROUP www-data\nENV APACHE_LOG_DIR /var/log/apache2\nENV APACHE_PID_FILE /var/run/apache2.pid\nENV APACHE_RUN_DIR /var/run/apache2\nENV APACHE_LOCK_DIR /var/lock/apache2\nENV APACHE_SERVERADMIN admin@localhost\nENV APACHE_SERVERNAME localhost\nENV APACHE_SERVERALIAS docker.localhost\nENV APACHE_DOCUMENTROOT /var/www\nEXPOSE 80\nWORKDIR /app\nCMD [\"/run.sh\"]\n</code></pre> <p>\u6b64sample\u7ad9\u70b9\u7684\u5185\u5bb9\u4e3a\u8f93\u51faHello Docker\uff01\u3002\u4e0b\u9762\u7528\u6237\u5728sample\u76ee\u5f55\u4e0b\u521b\u5efaindex.html\u6587\u4ef6\uff0c\u5185\u5bb9\u4e3a\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n    &lt;html&gt;\n        &lt;body&gt;\n            &lt;p&gt;Hello, Docker!&lt;/p&gt;\n        &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>run.sh\u811a\u672c\u5185\u5bb9\u4e5f\u5f88\u7b80\u5355\uff0c\u53ea\u662f\u542f\u52a8apache\u670d\u52a1\uff1a</p> <pre><code>$ cat run.sh\n#!/bin/bash\nexec apache2 -D FOREGROUND\n</code></pre> <p>\u6b64\u65f6\uff0capache_ubuntu\u76ee\u5f55\u4e0b\u9762\u7684\u6587\u4ef6\u7ed3\u6784\u4e3a\uff1a</p> <pre><code>[root@192 apache_ubuntu]# tree .\n.\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 run.sh\n\u2514\u2500\u2500 sample\n    \u2514\u2500\u2500 index.html\n\n1 directory, 3 files\n</code></pre> <p>\u4e0b\u9762\uff0c\u5f00\u59cb\u521b\u5efaapache\uff1aubuntu\u955c\u50cf\u3002</p> <p>\u4f7f\u7528docker build\u547d\u4ee4\u521b\u5efaapache\uff1aubuntu\u955c\u50cf\uff0c\u6ce8\u610f\u547d\u4ee4\u6700\u540e\u7684\u201c.\u201d\uff1a</p> <pre><code>$ docker build -t apache:ubuntu .\n......\nSuccessfully built 1d865e3032d\n</code></pre> <p>\u6b64\u65f6\u955c\u50cf\u5df2\u7ecf\u521b\u5efa\u6210\u529f\u4e86\u3002\u7528\u6237\u53ef\u4f7f\u7528docker images\u6307\u4ee4\u67e5\u770b\u672c\u5730\u65b0\u589e\u7684apache\uff1aubuntu\u955c\u50cf\uff1a</p> <pre><code>$ docker images\nREPOSITORY TAG IMAGE ID CREATED             VIRTUAL SIZE\napache ubuntu 1d865e3032d7 46 seconds ago      263.8 MB\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u4f7f\u7528docker run\u6307\u4ee4\u6d4b\u8bd5\u955c\u50cf\u3002\u7528\u6237\u53ef\u4ee5\u4f7f\u7528-P\u53c2\u6570\u6620\u5c04\u9700\u8981\u5f00\u653e\u7684\u7aef\u53e3\uff0822\u548c80\u7aef\u53e3\uff09\uff1a</p> <pre><code>$ docker run -d -P apache:ubuntu\n64681e2ae943f18eae9f599dbc43b5f44d9090bdca3d8af641d7b371c124acfd\n$ docker ps -a\nCONTAINER ID   IMAGE             COMMAND        CREATED    STATUS   PORTS   NAMES\n64681e2ae943 apache:ubuntu   \"/run.sh\"   2 seconds ago   Up 1 seconds   0.0.0.0:49171-&gt;22/tcp, 0.0.0.0:49172-&gt;80/tcp   naughty_poincare\n890c04ff8d76   sshd:dockerfile   \"/run.sh\"   9 hours ago   Exited (0) 3 hours ago   0.0.0.0:101-&gt;22/tcp   high_albattani\n3ad7182aa47f   sshd:ubuntu   \"/run.sh\"   21 hours ago   Exited (0) 3 hours ago   0.0.0.0:100-&gt;22/tcp   focused_ptolemy\n</code></pre> <p>\u5728\u672c\u5730\u4e3b\u673a\u4e0a\u7528curl\u6293\u53d6\u7f51\u9875\u6765\u9a8c\u8bc1\u521a\u624d\u521b\u5efa\u7684sample\u7ad9\u70b9\uff1a</p> <pre><code>$ curl 127.0.0.1:49172\nHello Docker!\n</code></pre> <p>\u8bfb\u8005\u4e5f\u53ef\u4ee5\u5728\u5176\u4ed6\u8bbe\u5907\u4e0a\u901a\u8fc7\u8bbf\u95ee\u5bbf\u4e3b\u4e3b\u673aip\uff1a49172\u6765\u8bbf\u95eesample\u7ad9\u70b9\u3002</p> <p>\u4e0b\u9762\uff0c\u7528\u6237\u770b\u770bDockerfile\u521b\u5efa\u7684\u955c\u50cf\u62e5\u6709\u7ee7\u627f\u7684\u7279\u6027\u3002\u4e0d\u77e5\u9053\u6709\u6ca1\u6709\u7ec6\u5fc3\u7684\u8bfb\u8005\u53d1\u73b0\uff0c\u5728apache\u955c\u50cf\u7684Dockerfile\u4e2d\u53ea\u7528EXPOSE\u5b9a\u4e49\u4e86\u5bf9\u5916\u5f00\u653e\u768480\u7aef\u53e3\uff0c\u800c\u5728docker ps-a\u547d\u4ee4\u7684\u8fd4\u56de\u4e2d\uff0c\u5374\u770b\u5230\u65b0\u542f\u52a8\u7684\u5bb9\u5668\u6620\u5c04\u4e862\u4e2a\u7aef\u53e3\uff1a22\u548c80\u3002</p> <p>\u4f46\u662f\u5b9e\u9645\u4e0a\uff0c\u5f53\u5c1d\u8bd5\u4f7f\u7528SSH\u767b\u5f55\u5230\u5bb9\u5668\u65f6\uff0c\u4f1a\u53d1\u73b0\u65e0\u6cd5\u767b\u5f55\u3002\u8fd9\u662f\u56e0\u4e3a\u5728run.sh\u811a\u672c\u4e2d\u5e76\u672a\u542f\u52a8SSH\u670d\u52a1\u3002\u8fd9\u8bf4\u660e\u5728\u4f7f\u7528Dockerfile\u521b\u5efa\u955c\u50cf\u65f6\uff0c\u4f1a\u7ee7\u627f\u7236\u955c\u50cf\u7684\u5f00\u653e\u7aef\u53e3\uff0c\u4f46\u5374\u4e0d\u4f1a\u7ee7\u627f\u542f\u52a8\u547d\u4ee4\u3002\u56e0\u6b64\uff0c\u9700\u8981\u5728run.sh\u811a\u672c\u4e2d\u6dfb\u52a0\u542f\u52a8sshd\u7684\u670d\u52a1\u7684\u547d\u4ee4\uff1a</p> <pre><code>$ cat run.sh\n#!/bin/bash\n/usr/sbin/sshd &amp;\nexec apache2 -D FOREGROUND\n</code></pre> <p>\u518d\u6b21\u521b\u5efa\u955c\u50cf\uff1a</p> <pre><code>$ docker build -t apache:ubuntu .\n</code></pre> <p>\u8fd9\u6b21\u521b\u5efa\u7684\u955c\u50cf\uff0c\u5c06\u9ed8\u8ba4\u4f1a\u540c\u65f6\u542f\u52a8SSH\u548cApache\u670d\u52a1\u3002</p> <p>\u4e0b\u9762\uff0c\u7528\u6237\u770b\u770b\u5982\u4f55\u6620\u5c04\u672c\u5730\u76ee\u5f55\u3002\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u6620\u5c04\u672c\u5730\u76ee\u5f55\u7684\u65b9\u5f0f\uff0c\u6765\u6307\u5b9a\u5bb9\u5668\u5185Apache\u670d\u52a1\u54cd\u5e94\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\u6620\u5c04\u672c\u5730\u4e3b\u673a\u4e0a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684www\u76ee\u5f55\u5230\u5bb9\u5668\u5185\u7684/var/www\u76ee\u5f55\uff1a</p> <pre><code>$ docker run -i -d -p 80:80 -p 103:22 -e APACHE_SERVERNAME=test  -v 'pwd'/www:/var/www:ro apache:ubuntu\n</code></pre> <p>\u5728\u5f53\u524d\u76ee\u5f55\u5185\u521b\u5efawww\u76ee\u5f55\uff0c\u5e76\u653e\u4e0a\u81ea\u5b9a\u4e49\u7684\u9875\u9762index.html\uff0c\u5185\u5bb9\u4e3a\uff1a</p> <pre><code>&lt;!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"&gt;\n&lt;html&gt;&lt;head&gt;\n&lt;title&gt;Hi Docker&lt;/title&gt;\n&lt;/head&gt;&lt;body&gt;\n&lt;h1&gt;Hi Docker&lt;/h1&gt;\n&lt;p&gt;This is the first day I meet the new world.&lt;/p&gt;\n&lt;p&gt;How are you?&lt;/p&gt;\n&lt;hr&gt;\n&lt;address&gt;Apache/2.4.7 (Ubuntu) Server at 127.0.0.1 Port 80&lt;/address&gt;\n&lt;/body&gt;&lt;/html&gt;\n</code></pre> <p>\u5728\u672c\u5730\u4e3b\u673a\u4e0a\u53ef\u8bbf\u95ee\u6d4b\u8bd5\u5bb9\u5668\u63d0\u4f9b\u7684Web\u670d\u52a1\uff0c\u67e5\u770b\u83b7\u53d6\u5185\u5bb9\u4e3a\u65b0\u914d\u7f6e\u7684index.html\u9875\u9762\u4fe1\u606f\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#13-\u76f8\u5173\u8d44\u6e90","title":"1.3 \u76f8\u5173\u8d44\u6e90","text":"<p>Apache\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Apache\u5b98\u7f51\uff1ahttps://httpd.apache.org/</li> <li>Apache\u5b98\u65b9\u4ed3\u5e93\uff1ahttps://github.com/apache/httpd</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#2-nginx","title":"2 Nginx","text":"<p>Nginx\uff08\u53d1\u97f3\u4e3a\u201cengine-x\u201d\uff09\u662f\u4e00\u6b3e\u529f\u80fd\u5f3a\u5927\u7684\u5f00\u6e90\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u652f\u6301HTTP\u3001HTTPS\u3001SMTP\u3001POP3\u3001IMAP\u7b49\u534f\u8bae\u3002 \u5b83\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u5668\u3001HTTP\u7f13\u5b58\u6216Web\u670d\u52a1\u5668\u3002Nginx\u4e00\u5f00\u59cb\u5c31\u4e13\u6ce8\u4e8e\u9ad8\u5e76\u53d1\u548c\u9ad8\u6027\u80fd\u7684\u5e94\u7528\u573a\u666f\u3002</p> <p>\u5b83\u4f7f\u7528\u7c7bBSD\u5f00\u6e90\u534f\u8bae\uff0c\u652f\u6301Linux\u3001BSD\u3001Mac\u3001Solaris\u3001AIX\u7b49\u7c7bUnix\u7cfb\u7edf\uff0c\u540c\u65f6\u4e5f\u6709Windows\u4e0a\u7684\u79fb\u690d\u7248\u672c\u3002</p> <p>Nginx\u7279\u6027\u5982\u4e0b\uff1a</p> <pre><code>\u00b7\u70ed\u90e8\u7f72\uff1a\u91c7\u7528master\u7ba1\u7406\u8fdb\u7a0b\u4e0eworker\u5de5\u4f5c\u8fdb\u7a0b\u7684\u5206\u79bb\u8bbe\u8ba1\uff0c\u652f\u6301\u70ed\u90e8\u7f72\u3002\u5728\u4e0d\u95f4\u65ad\u670d\u52a1\u7684\u524d\u63d0\u4e0b\uff0c\u53ef\u4ee5\u76f4\u63a5\u5347\u7ea7\u7248\u672c\u3002\u4e5f\u53ef\u4ee5\u5728\u4e0d\u505c\u6b62\u670d\u52a1\u7684\u60c5\u51b5\u4e0b\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u66f4\u6362\u65e5\u5fd7\u6587\u4ef6\u7b49\u3002\n\n\u00b7\u9ad8\u5e76\u53d1\u8fde\u63a5\uff1aNginx\u53ef\u4ee5\u8f7b\u677e\u652f\u6301\u8d85\u8fc7100K\u7684\u5e76\u53d1\uff0c\u7406\u8bba\u4e0a\u652f\u6301\u7684\u5e76\u53d1\u8fde\u63a5\u4e0a\u9650\u53d6\u51b3\u4e8e\u673a\u5668\u5185\u5b58\u3002\n\n\u00b7\u4f4e\u5185\u5b58\u6d88\u8017\uff1a\u5728\u4e00\u822c\u7684\u60c5\u51b5\u4e0b\uff0c10K\u4e2a\u975e\u6d3b\u8dc3\u7684HTTP Keep-Alive\u8fde\u63a5\u5728Nginx\u4e2d\u4ec5\u6d88\u80172.5 MB\u7684\u5185\u5b58\uff0c\u8fd9\u4e5f\u662fNginx\u652f\u6301\u9ad8\u5e76\u53d1\u8fde\u63a5\u7684\u57fa\u7840\u3002\n\n\u00b7\u54cd\u5e94\u5feb\uff1a\u5728\u6b63\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u5355\u6b21\u8bf7\u6c42\u4f1a\u5f97\u5230\u66f4\u5feb\u7684\u54cd\u5e94\u3002\u5728\u9ad8\u5cf0\u671f\uff0cNginx\u53ef\u4ee5\u6bd4\u5176\u4ed6\u7684Web\u670d\u52a1\u5668\u66f4\u5feb\u5730\u54cd\u5e94\u8bf7\u6c42\u3002\n\n\u00b7\u9ad8\u53ef\u9760\u6027\uff1aNginx\u662f\u4e00\u4e2a\u9ad8\u53ef\u9760\u6027\u7684Web\u670d\u52a1\u5668\uff0c\u8fd9\u4e5f\u662f\u7528\u6237\u4e3a\u4ec0\u4e48\u9009\u62e9Nginx\u7684\u57fa\u672c\u6761\u4ef6\uff0c\u73b0\u5728\u5f88\u591a\u7684\u7f51\u7ad9\u90fd\u5728\u4f7f\u7528Nginx\uff0c\u8db3\u4ee5\u8bf4\u660eNginx\u7684\u53ef\u9760\u6027\u3002\u9ad8\u53ef\u9760\u6027\u6765\u81ea\u5176\u6838\u5fc3\u6846\u67b6\u4ee3\u7801\u7684\u4f18\u79c0\u8bbe\u8ba1\u548c\u5b9e\u73b0\u3002\n</code></pre> <p>\u672c\u8282\u5c06\u9996\u5148\u4ecb\u7ecdNginx\u5b98\u65b9\u53d1\u884c\u7248\u672c\u7684\u955c\u50cf\u751f\u6210\uff0c\u7136\u540e\u4ecb\u7ecd\u7b2c\u4e09\u65b9\u53d1\u884c\u7248Tengine\u955c\u50cf\u7684\u751f\u6210\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#21\u4f7f\u7528dockerhub\u955c\u50cf","title":"2.1\u4f7f\u7528DockerHub\u955c\u50cf","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528docker run\u6307\u4ee4\u76f4\u63a5\u8fd0\u884c\u5b98\u65b9Nginx\u955c\u50cf\uff1a <pre><code>$ docker run -d -p 80:80 --name webserver nginx\n...\n34bcd01998a76f67b1b9e6abe5b7db5e685af325d6fafb1acd0ce84e81e71e5d\n</code></pre></p> <p>\u7136\u540e\u4f7f\u7528docker ps\u6307\u4ee4\u67e5\u770b\u5f53\u524d\u8fd0\u884c\u7684\u5bb9\u5668\uff1a</p> <pre><code>[root@192 Docker]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                NAMES\na3454b58a5dc        nginx               \"nginx -g 'daemon of\u2026\"   About a minute ago   Up About a minute   0.0.0.0:80-&gt;80/tcp   webserver\n</code></pre> <p>\u76ee\u524dNginx\u5bb9\u5668\u5df2\u7ecf\u57280.0.0.0\uff1a80\u542f\u52a8\uff0c\u5e76\u6620\u5c04\u4e8680\u7aef\u53e3\uff0c\u6b64\u65f6\u53ef\u4ee5\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee\u6b64\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u770b\u5230Nginx\u8f93\u51fa\u7684\u9875\u9762\u3002</p> <p></p> <p>1.9.8\u7248\u672c\u540e\u7684\u955c\u50cf\u652f\u6301debug\u6a21\u5f0f\uff0c\u955c\u50cf\u5305\u542bnginx-debug\uff0c\u53ef\u4ee5\u652f\u6301\u66f4\u4e30\u5bcc\u7684log\u4fe1\u606f\uff1a</p> <pre><code>$ docker run --name my-nginx -v /host/path/nginx.conf:/etc/nginx/nginx.conf:ro -d nginx nginx-debug -g 'daemon off;'\n</code></pre> <p>\u76f8\u5e94\u7684docker-compose.yml\u914d\u7f6e\u5982\u4e0b\uff1a</p> <pre><code>web:\n    image: nginx\n    volumes:\n        - ./nginx.conf:/etc/nginx/nginx.conf:ro\n    command: [nginx-debug, '-g', 'daemon off;']\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#22-\u81ea\u5b9a\u4e49web\u9875\u9762","title":"2.2 \u81ea\u5b9a\u4e49Web\u9875\u9762","text":"<p>\u9996\u5148\uff0c\u65b0\u5efaindex.html\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>&lt;html&gt;\n    &lt;title&gt;text&lt;title&gt;\n    &lt;body&gt;\n        &lt;div &gt;\n            hello world\n        &lt;/div &gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u7136\u540e\u4f7f\u7528docker[container]run\u6307\u4ee4\u8fd0\u884c\uff0c\u5e76\u5c06index.html\u6587\u4ef6\u6302\u8f7d\u81f3\u5bb9\u5668\u4e2d\uff0c\u5373\u53ef\u770b\u5230\u663e\u793a\u81ea\u5b9a\u4e49\u7684\u9875\u9762\u3002</p> <pre><code>$ docker run --name nginx-container -p 80:80 -v index.html:/usr/share/nginx/html:ro -d nginx\n</code></pre> <p>\u53e6\u5916\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528Dockerfile\u6765\u6784\u5efa\u65b0\u955c\u50cf\u3002Dockerfile\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>FROM nginx\nCOPY ./index.html /usr/share/nginx/html\n</code></pre> <p>\u5f00\u59cb\u6784\u5efa\u955c\u50cfmy-nginx\uff1a</p> <pre><code>$ docker build -t my-nginx .\n</code></pre> <p>\u6784\u5efa\u6210\u529f\u540e\u6267\u884cdocker[container]run\u6307\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ docker run -p 80:80 --name nginx-container -d my-nginx\n</code></pre> <p>\uff081\uff09\u4f7f\u7528\u81ea\u5b9a\u4e49Dockerfile</p> <p>\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>#\u8bbe\u7f6e\u7ee7\u627f\u81ea\u521b\u5efa\u7684sshd\u955c\u50cf\nFROM sshd:dockerfile\n#\u4e0b\u9762\u662f\u4e00\u4e9b\u521b\u5efa\u8005\u7684\u57fa\u672c\u4fe1\u606f\nMAINTAINER docker_user (user@docker.com)\n#\u5b89\u88c5nginx\uff0c\u8bbe\u7f6enginx\u4ee5\u975edaemon\u65b9\u5f0f\u542f\u52a8\u3002\nRUN \\\napt-get install -y nginx &amp;&amp; \\\nrm -rf /var/lib/apt/lists/* &amp;&amp; \\\necho \"\\ndaemon off;\" &gt;&gt; /etc/nginx/nginx.conf &amp;&amp; \\\nchown -R www-data:www-data /var/lib/nginx\nRUN echo \"Asia/Shanghai\" &gt; /etc/timezone &amp;&amp; \\\ndpkg-reconfigure -f noninteractive tzdata\n# \u6ce8\u610f\u8fd9\u91cc\u8981\u66f4\u6539\u7cfb\u7edf\u7684\u65f6\u533a\u8bbe\u7f6e\uff0c\u56e0\u4e3a\u5728Web\u5e94\u7528\u4e2d\u7ecf\u5e38\u4f1a\u7528\u5230\u65f6\u533a\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\uff0c\u9ed8\u8ba4ubuntu\u7684\u8bbe\u7f6e\n\u4f1a\u8ba9\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u53d1\u751f\u4e0d\u53ef\u601d\u8bae\u7684\u6548\u679c\u54e6\n# \u6dfb\u52a0\u7528\u6237\u7684\u811a\u672c\uff0c\u5e76\u8bbe\u7f6e\u6743\u9650\uff0c\u8fd9\u4f1a\u8986\u76d6\u4e4b\u524d\u653e\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u811a\u672c\nADD run.sh /run.sh\nRUN chmod 755 /*.sh\n# \u5b9a\u4e49\u53ef\u4ee5\u88ab\u6302\u8f7d\u7684\u76ee\u5f55\uff0c\u5206\u522b\u662f\u865a\u62df\u4e3b\u673a\u7684\u6302\u8f7d\u76ee\u5f55\u3001\u8bc1\u4e66\u76ee\u5f55\u3001\u914d\u7f6e\u76ee\u5f55\u3001\u548c\u65e5\u5fd7\u76ee\u5f55\nVOLUME [\"/etc/nginx/sites-enabled\", \"/etc/nginx/certs\", \"/etc/nginx/conf.d\", \"/var/log/nginx\"]\n# \u5b9a\u4e49\u5de5\u4f5c\u76ee\u5f55\nWORKDIR /etc/nginx\n# \u5b9a\u4e49\u8f93\u51fa\u547d\u4ee4\nCMD [\"/run.sh\"]\n# \u5b9a\u4e49\u8f93\u51fa\u7aef\u53e3\nEXPOSE 80\nEXPOSE 443\n</code></pre> <p>\uff082\uff09\u67e5\u770brun.sh\u811a\u672c\u6587\u4ef6\u5185\u5bb9</p> <p>\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>$ cat run.sh\n#!/bin/bash\n/usr/sbin/sshd &amp;\n/usr/sbin/nginx\n</code></pre> <p>\uff083\uff09\u521b\u5efa\u955c\u50cf</p> <p>\u4f7f\u7528docker build\u547d\u4ee4\uff0c\u521b\u5efa\u955c\u50cfnginx\uff1astable\uff1a</p> <pre><code>$ docker build -t nginx:stable .\n...\nSuccessfully built 4e3936e36e3\n</code></pre> <p>\uff084\uff09\u6d4b\u8bd5</p> <p>\u542f\u52a8\u5bb9\u5668\uff0c\u67e5\u770b\u5185\u90e8\u768480\u7aef\u53e3\u88ab\u6620\u5c04\u5230\u672c\u5730\u768449193\u7aef\u53e3\uff1a</p> <pre><code>$ docker run -d -P nginx:stable\n08c456536e69c8e36670f3bc6b496020e76d28fc9d33a8bcd01ff6d61bc72c4a\n$ docker ps\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\n08c456536e69 nginx:stable \"/run.sh\" 8 seconds ago Up 8 seconds 0.0.0.0:49191-&gt;22/tcp, 0.0.0.0:49192-&gt;443/tcp, 0.0.0.0:49193-&gt;80/tcp\n</code></pre> <p>\u8bbf\u95ee\u672c\u5730\u768449193\u7aef\u53e3\uff1a</p> <pre><code>$ curl 127.0.0.1:49193\n</code></pre> <p>\u518d\u6b21\u770b\u5230Nginx\u7684\u6b22\u8fce\u9875\u9762\uff0c\u8bf4\u660eNginx\u5df2\u7ecf\u6b63\u5e38\u542f\u52a8\u4e86\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#23-\u53c2\u6570\u4f18\u5316","title":"2.3 \u53c2\u6570\u4f18\u5316","text":"<p>\u4e3a\u4e86\u80fd\u5145\u5206\u53d1\u6325Nginx\u7684\u6027\u80fd\uff0c\u7528\u6237\u53ef\u5bf9\u7cfb\u7edf\u5185\u6838\u53c2\u6570\u505a\u4e00\u4e9b\u8c03\u6574\u3002\u4e0b\u9762\u662f\u4e00\u4efd\u5e38\u89c1\u7684\u9002\u5408\u8fd0\u884cNginx\u670d\u52a1\u5668\u7684\u5185\u6838\u4f18\u5316\u53c2\u6570\uff1a</p> <pre><code>net.ipv4.ip_forward = 0\nnet.ipv4.conf.default.rp_filter = 1\nnet.ipv4.conf.default.accept_source_route = 0\nkernel.sysrq = 0\nkernel.core_uses_pid = 1\nnet.ipv4.tcp_syncookies = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nkernel.shmmax = 68719476736\nkernel.shmall = 4294967296\nnet.ipv4.tcp_max_tw_buckets = 6000\nnet.ipv4.tcp_sack = 1\nnet.ipv4.tcp_window_scaling = 1\nnet.ipv4.tcp_rmem = 4096 87380 4194304\nnet.ipv4.tcp_wmem = 4096 16384 4194304\nnet.core.wmem_default = 8388608\nnet.core.rmem_default = 8388608\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\nnet.core.netdev_max_backlog = 262144\nnet.core.somaxconn = 262144\nnet.ipv4.tcp_max_orphans = 3276800\nnet.ipv4.tcp_max_syn_backlog = 262144\nnet.ipv4.tcp_timestamps = 0\nnet.ipv4.tcp_synack_retries = 1\nnet.ipv4.tcp_syn_retries = 1\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_mem = 94500000 915000000 927000000\nnet.ipv4.tcp_fin_timeout = 1\nnet.ipv4.tcp_keepalive_time = 30\nnet.ipv4.ip_local_port_range = 1024 65000\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#24-\u955c\u50cf\u5236\u4f5c\u6848\u4f8b","title":"2.4 \u955c\u50cf\u5236\u4f5c\u6848\u4f8b","text":"<p>\u6848\u4f8b1</p> <pre><code>FROM centos:7\nLABEL maintainer www.chenleilei.net\nRUN useradd  www -u 1200 -M -s /sbin/nologin\nRUN mkdir -p /var/log/nginx\nRUN yum install -y cmake pcre pcre-devel openssl openssl-devel gd-devel \\\nzlib-devel gcc gcc-c++ net-tools iproute telnet wget curl &amp;&amp;\\\nyum clean all &amp;&amp; \\\nrm -rf /var/cache/yum/*\nRUN wget https://www.chenleilei.net/soft/nginx-1.16.1.tar.gz\nRUN tar xf nginx-1.16.1.tar.gz\nWORKDIR nginx-1.16.1\nRUN ./configure --prefix=/usr/local/nginx --with-http_image_filter_module --user=www --group=www \\\n--with-http_ssl_module --with-http_v2_module --with-http_stub_status_module \\\n--error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log \\\n--pid-path=/var/run/nginx/nginx.pid\nRUN make -j 4 &amp;&amp; make install &amp;&amp; \\\nrm -rf /usr/local/nginx/html/*  &amp;&amp; \\\necho \"leilei hello\" &gt;/usr/local/nginx/html/index.html  &amp;&amp; \\\nrm -rf nginx* &amp;&amp; \\\nln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp;\\\nln -sf /dev/stdout /var/log/nginx/access.log &amp;&amp; \\\nln -sf /dev/stderr /var/log/nginx/error.log\nRUN chown -R www.www /var/log/nginx\nENV LOG_DIR /var/log/nginx\nENV PATH $PATH:/usr/local/nginx/sbin\n#COPY nginx.conf /usr/local/nginx/conf/nginx.conf\nEXPOSE 80\nWORKDIR /usr/local/nginx\nCMD [\"nginx\",\"-g\",\"daemon off;\"]\n</code></pre> <p>\u6848\u4f8b2</p> <pre><code>FROM centos:7\nLABEL maintainer www.chenleilei.net\nRUN yum install -y openssl &amp;&amp; \\\nuseradd  www -u 1000 -M -s /sbin/nologin &amp;&amp; \\\nrm -fr /etc/yum.repos.d/* &amp;&amp; \\\nrpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm &amp;&amp; yum clean all &amp;&amp; \\\nyum install -y nginx-1.18.0-2.el7.ngx.x86_64  &amp;&amp;  yum clean all &amp;&amp;  rm -rf /var/cache/yum/* &amp;&amp; \\\nln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \\\nln -sf /dev/stdout /var/log/nginx/access.log &amp;&amp; \\\nln -sf /dev/stderr /var/log/nginx/error.log &amp;&amp; \\\nsed -i \"1,3s#nginx#www#g\" /etc/nginx/nginx.conf\nEXPOSE 80\nEXPOSE 443\nWORKDIR /etc/nginx\nCMD [\"nginx\",\"-g\",\"daemon off;\"]\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#25-\u76f8\u5173\u8d44\u6e90","title":"2.5 \u76f8\u5173\u8d44\u6e90","text":"<p>Nginx\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Nginx\u5b98\u7f51\uff1ahttps://www.nginx.com</li> <li>Nginx\u5b98\u65b9\u4ed3\u5e93\uff1ahttps://github.com/nginx/nginx</li> <li>Nginx\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/nginx/</li> <li>Nginx\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/nginxinc/docker-nginx</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#3-tomcat","title":"3 Tomcat","text":"<p>Tomcat\u662f\u7531Apache\u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0b\u5c5e\u7684Jakarta\u9879\u76ee\u5f00\u53d1\u7684\u4e00\u4e2aServlet\u5bb9\u5668\uff0c \u6309\u7167Sun Microsystems\u63d0\u4f9b\u7684\u6280\u672f\u89c4\u8303\uff0c\u5b9e\u73b0\u4e86\u5bf9Servlet\u548cJavaServer Page\uff08JSP\uff09\u7684\u652f\u6301\u3002 \u540c\u65f6\uff0c\u5b83\u63d0\u4f9b\u4e86\u4f5c\u4e3aWeb\u670d\u52a1\u5668\u7684\u4e00\u4e9b\u7279\u6709\u529f\u80fd\uff0c\u5982Tomcat\u7ba1\u7406\u548c\u63a7\u5236\u5e73\u53f0\u3001\u5b89\u5168\u57df\u7ba1\u7406\u548cTomcat\u9600\u7b49\u3002 \u7531\u4e8eTomcat\u672c\u8eab\u4e5f\u5185\u542b\u4e86\u4e00\u4e2aHTTP\u670d\u52a1\u5668\uff0c\u4e5f\u53ef\u4ee5\u5f53\u4f5c\u5355\u72ec\u7684Web\u670d\u52a1\u5668\u6765\u4f7f\u7528\u3002</p> <p>\u4e0b\u9762\u5c06\u4ee5sun_jdk 1.6\u3001tomcat 7.0\u3001ubuntu 18.04\u73af\u5883\u4e3a\u4f8b\u4ecb\u7ecd\u5982\u4f55\u5b9a\u5236Tomcat\u955c\u50cf\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#31-\u51c6\u5907\u5de5\u4f5c","title":"3.1 \u51c6\u5907\u5de5\u4f5c","text":"<p>\u521b\u5efatomcat7.0_jdk1.6\u6587\u4ef6\u5939\uff0c\u4ecewww.oracle.com\u7f51\u7ad9\u4e0a\u4e0b\u8f7dsun_jdk 1.6\u538b\u7f29\u5305\uff0c\u89e3\u538b\u4e3ajdk\u76ee\u5f55\u3002</p> <p>\u521b\u5efaDockerfile\u548crun.sh\u6587\u4ef6\uff1a</p> <pre><code>$ mkdir tomcat7.0_jdk1.6\n$ cd tomcat7.0_jdk1.6/\n$ touch Dockerfile run.sh\n</code></pre> <p>\u4e0b\u8f7dTomcat\uff0c\u53ef\u4ee5\u5230\u5b98\u65b9\u7f51\u7ad9\u4e0b\u8f7d\u6700\u65b0\u7684\u7248\u672c\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e0b\u9762\u94fe\u63a5\u4e2d\u7ed9\u51fa\u7684\u7248\u672c\uff1a</p> <pre><code>$ wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.103/bin/apache-tomcat-7.0.103.zip\n\n--2020-04-29 16:55:22--  http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.103/bin/apache-tomcat-7.0.103.zip\n\u6b63\u5728\u89e3\u6790\u4e3b\u673a mirror.bit.edu.cn (mirror.bit.edu.cn)... 2001:da8:204:1205::22, 114.247.56.117\n\u6b63\u5728\u4fdd\u5b58\u81f3: \u201capache-tomcat-7.0.103.zip\u201d\n</code></pre> <p>\u89e3\u538b\u540e\uff0ctomcat7.0_jdk1.6\u76ee\u5f55\u7ed3\u6784\u5e94\u5982\u4e0b\u6240\u793a\uff08\u591a\u4f59\u7684\u538b\u7f29\u5305\u6587\u4ef6\u5df2\u7ecf\u88ab\u5220\u9664\uff09\uff1a</p> <pre><code>$ ls\nDockerfile  apache-tomcat-7.0.56   jdk  run.sh\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#32-dockerfile","title":"3.2 Dockerfile","text":"<p>Dockerfile\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>FROM sshd:dockerfile\n#\u8bbe\u7f6e\u7ee7\u627f\u81ea\u7528\u6237\u521b\u5efa\u7684sshd\u955c\u50cf\nMAINTAINER docker_user (user@docker.com)\n#\u4e0b\u9762\u662f\u4e00\u4e9b\u521b\u5efa\u8005\u7684\u57fa\u672c\u4fe1\u606f\n#\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u975e\u4ea4\u4e92\u5f0f\u7684\nENV DEBIAN_FRONTEND noninteractive\nRUN echo \"Asia/Shanghai\" &gt; /etc/timezone &amp;&amp; \\\ndpkg-reconfigure -f noninteractive tzdata\n#\u6ce8\u610f\u8fd9\u91cc\u8981\u66f4\u6539\u7cfb\u7edf\u7684\u65f6\u533a\u8bbe\u7f6e\uff0c\u56e0\u4e3a\u5728Web\u5e94\u7528\u4e2d\u7ecf\u5e38\u4f1a\u7528\u5230\u65f6\u533a\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\uff0c\u9ed8\u8ba4ubuntu\u7684\u8bbe\u7f6e\u4f1a\n\u8ba9\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u53d1\u751f\u4e0d\u53ef\u601d\u8bae\u7684\u6548\u679c\u54e6\n#\u5b89\u88c5\u8ddftomcat\u7528\u6237\u8ba4\u8bc1\u76f8\u5173\u7684\u8f6f\u4ef6\nRUN apt-get install -yq --no-install-recommends wget pwgen ca-certificates &amp;&amp; \\\napt-get clean &amp;&amp; \\\nrm -rf /var/lib/apt/lists/*\n#\u8bbe\u7f6etomcat\u7684\u73af\u5883\u53d8\u91cf\uff0c\u82e5\u8bfb\u8005\u6709\u5176\u4ed6\u7684\u73af\u5883\u53d8\u91cf\u9700\u8981\u8bbe\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u5728\u8fd9\u91cc\u6dfb\u52a0\nENV CATALINA_HOME /tomcat\nENV JAVA_HOME /jdk\n#\u590d\u5236tomcat\u548cjdk\u6587\u4ef6\u5230\u955c\u50cf\u4e2d\nADD apache-tomcat-7.0.56 /tomcat\nADD jdk /jdk\nADD create_tomcat_admin_user.sh /create_tomcat_admin_user.sh\nADD run.sh /run.sh\nRUN chmod +x /*.sh\nRUN chmod +x /tomcat/bin/*.sh\nEXPOSE 8080\nCMD [\"/run.sh\"]\n#\u521b\u5efatomcat\u7528\u6237\u548c\u5bc6\u7801\u811a\u672c\u6587\u4ef6create_tomcat_admin_user.sh\u6587\u4ef6\uff0c\u5185\u5bb9\u4e3a\uff1a\n#!/bin/bash\nif [ -f /.tomcat_admin_created ]; then\necho \"Tomcat 'admin' user already created\"\nexit 0\nfi\n#generate password\nPASS=${TOMCAT_PASS:-$(pwgen -s 12 1)}\n_word=$( [ ${TOMCAT_PASS} ] &amp;&amp; echo \"preset\" || echo \"random\" )\necho \"=&gt; Creating and admin user with a ${_word} password in Tomcat\"\nsed -i -r 's/&lt;\\/tomcat-users&gt;//' ${CATALINA_HOME}/conf/tomcat-users.xml\necho '&lt;role rolename=\"manager-gui\"/&gt;' &gt;&gt; ${CATALINA_HOME}/conf/tomcat-users.xml\necho '&lt;role rolename=\"manager-script\"/&gt;' &gt;&gt; ${CATALINA_HOME}/conf/tomcat-users.xml\necho '&lt;role rolename=\"manager-jmx\"/&gt;' &gt;&gt; ${CATALINA_HOME}/conf/tomcat-users.xml\necho '&lt;role rolename=\"admin-gui\"/&gt;' &gt;&gt; ${CATALINA_HOME}/conf/tomcat-users.xml\necho '&lt;role rolename=\"admin-script\"/&gt;' &gt;&gt; ${CATALINA_HOME}/conf/tomcat-users.xml\necho \"&lt;user username=\\\"admin\\\" password=\\\"${PASS}\\\" roles=\\\"manager-gui,manager-script,manager-jmx,admin-gui, admin-script\\\"/&gt;\" &gt;&gt; ${CATALINA_HOME}/conf/tomcat-users.xml\necho '&lt;/tomcat-users&gt;' &gt;&gt; ${CATALINA_HOME}/conf/tomcat-users.xml\necho \"=&gt; Done!\"\ntouch /.tomcat_admin_created\necho \"========================================================================\"\necho \"You can now configure to this Tomcat server using:\"\necho \"\"\necho \"    admin:${PASS}\"\necho \"\"\necho \"========================================================================\"\n</code></pre> <p>\u7f16\u5199run.sh\u811a\u672c\u6587\u4ef6\uff0c\u5185\u5bb9\u4e3a\uff1a</p> <pre><code>#!/bin/bash\nif [ ! -f /.tomcat_admin_created ]; then\n/create_tomcat_admin_user.sh\nfi\n/usr/sbin/sshd -D &amp;\nexec ${CATALINA_HOME}/bin/catalina.sh run\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#33-\u521b\u5efa\u548c\u6d4b\u8bd5\u955c\u50cf","title":"3.3 \u521b\u5efa\u548c\u6d4b\u8bd5\u955c\u50cf","text":"<p>\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u955c\u50cftomcat7.0\uff1ajdk1.6\uff1a</p> <pre><code>$ docker build -t tomcat7.0:jdk1.6 .\n\u2026\nSuccessfully built ce78537c247d\n</code></pre> <p>\u542f\u52a8\u4e00\u4e2atomcat\u5bb9\u5668\u8fdb\u884c\u6d4b\u8bd5\uff1a</p> <pre><code>$ docker run -d -P tomcat7.0:jdk1.6\n3cd4238cb32a713a3a1c29d93fbfc80cba150653b5eb8bd7629bee957e7378ed\n</code></pre> <p>\u901a\u8fc7docker logs\u5f97\u5230tomcat\u7684\u5bc6\u7801aBwN0CNCPckw\uff1a</p> <pre><code>$ docker logs 3cd\n=&gt; Creating and admin user with a random password in Tomcat\n=&gt; Done!\n========================================================================\nYou can now configure to this Tomcat server using:\n    admin:aBwN0CNCPckw\n========================================================================\n</code></pre> <p>\u67e5\u770b\u6620\u5c04\u7684\u7aef\u53e3\u4fe1\u606f\uff1a</p> <pre><code>$ docker ps\nCONTAINER ID   IMAGE               COMMAND     CREATED          STATUS    PORTS    NAMES\n3cd4238cb32a   tomcat7.0:jdk1.6   \"/run.sh\"   4 seconds ago   Up 3 seconds   0.0.0.0: 49157-&gt;22/tcp, 0.0.0.0:49158-&gt;8080/tcp   cranky_wright\n</code></pre> <p>\u5728\u672c\u5730\u4f7f\u7528\u6d4f\u89c8\u5668\u767b\u5f55Tomcat\u7ba1\u7406\u754c\u9762\uff0c\u8bbf\u95ee\u672c\u5730\u768449158\u7aef\u53e3\uff0c\u5373http://127.0.0.1:49158 \uff0c\u53ef\u4ee5\u770b\u89c1\u542f\u52a8\u9875\u9762\u3002</p> <p>Tomcat\u542f\u52a8\u9875\u9762 </p> <p>\u8f93\u5165\u4ecedocker logs\u4e2d\u5f97\u5230\u7684\u5bc6\u7801</p> <p>Tomcat\u767b\u5f55</p> <p></p> <p>\u6210\u529f\u8fdb\u5165\u7ba1\u7406\u754c\u9762\u3002</p> <p>\u7ba1\u7406\u754c\u9762</p> <p></p> <p><code>\u6ce8\u610f</code> \u5728\u5b9e\u9645\u73af\u5883\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528-v\u53c2\u6570\u6765\u6302\u8f7dTomcat\u7684\u65e5\u5fd7\u6587\u4ef6\u3001\u7a0b\u5e8f\u6240\u5728\u76ee\u5f55\u3001\u4ee5\u53ca\u4e0eTomcat\u76f8\u5173\u7684\u914d\u7f6e\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#34-\u76f8\u5173\u8d44\u6e90","title":"3.4 \u76f8\u5173\u8d44\u6e90","text":"<p>Tomcat\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Tomcat\u5b98\u7f51\uff1ahttp://tomcat.apache.org/</li> <li>Tomcat\u5b98\u65b9\u4ed3\u5e93\uff1ahttps://github.com/apache/tomcat</li> <li>Tomcat\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/tomcat/</li> <li>Tomcat\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/docker-library/tomcat</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#4-jetty","title":"4 Jetty","text":"<p>Jetty\u662f\u4e00\u4e2a\u4f18\u79c0\u7684\u5f00\u6e90servlet\u5bb9\u5668\uff0c\u4ee5\u5176\u9ad8\u6548\u3001\u5c0f\u5de7\u3001\u53ef\u5d4c\u5165\u5f0f\u7b49\u4f18\u70b9\u6df1\u5f97\u4eba\u5fc3\uff0c \u5b83\u4e3a\u57fa\u4e8eJava\u7684Web\u5185\u5bb9\uff08\u5982JSP\u548cservlet\uff09\u63d0\u4f9b\u8fd0\u884c\u73af\u5883\u3002 Jetty\u57fa\u4e8eJava\u8bed\u8a00\u7f16\u5199\uff0c\u5b83\u7684API\u4ee5\u4e00\u7ec4JAR\u5305\u7684\u5f62\u5f0f\u53d1\u5e03\u3002\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u5c06Jetty\u5bb9\u5668\u5b9e\u4f8b\u5316\u6210\u4e00\u4e2a\u5bf9\u8c61\uff0c\u53ef\u4ee5\u8fc5\u901f\u4e3a\u4e00\u4e9b\u72ec\u7acb\u8fd0\u884c\uff08stand-alone\uff09\u7684Java\u5e94\u7528\u63d0\u4f9bWeb\u670d\u52a1\u3002</p> <p>\u4e0e\u76f8\u5bf9\u8001\u724c\u7684Tomcat\u6bd4\uff0cJetty\u67b6\u6784\u66f4\u5408\u7406\uff0c\u6027\u80fd\u66f4\u4f18\u3002\u5c24\u5176\u5728\u542f\u52a8\u901f\u5ea6\u4e0a\uff0c\u8ba9Tomcat\u671b\u5c18\u83ab\u53ca\u3002Jetty\u76ee\u524d\u5728\u56fd\u5185\u5916\u4e92\u8054\u7f51\u4f01\u4e1a\u4e2d\u5e94\u7528\u5e7f\u6cdb\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#41-\u4f7f\u7528\u5b98\u65b9\u955c\u50cf","title":"4.1 \u4f7f\u7528\u5b98\u65b9\u955c\u50cf","text":"<p>DockerHub\u5b98\u65b9\u63d0\u4f9b\u4e86Jetty\u955c\u50cf\uff0c\u76f4\u63a5\u8fd0\u884cdocker[container]run\u6307\u4ee4\u5373\u53ef\uff1a</p> <pre><code>$ docker run -d jetty\nf7f1d70f2773be12b54c40e3222c4e658fd7c39f22337e457984b13fbc64a54c\n</code></pre> <p>\u4f7f\u7528docker ps\u6307\u4ee4\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u4e2d\u7684Jetty\u5bb9\u5668\uff1a</p> <pre><code>$ docker ps\nCONTAINER ID  IMAGE COMMAND              CREATED  STATUS PORTS      NAMES\nf7f1d70f2773  jetty \"/docker-entrypoint.b\" x ago   Up     8080/tcp    lonely_poitras\n</code></pre> <p>\u5f53\u7136\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528-p\u53c2\u6570\u6620\u5c04\u8fd0\u884c\u7aef\u53e3\uff1a</p> <pre><code>$ docker run -d -p 80:8080 -p 443:8443 jetty\n7bc629845e8b953e02e31caaac24744232e21816dcf81568c029eb8750775733\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#42-\u76f8\u5173\u8d44\u6e90","title":"4.2 \u76f8\u5173\u8d44\u6e90","text":"<p>Jetty\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Jetty\u5b98\u7f51\uff1ahttp://www.eclipse.org/jetty/</li> <li>Jetty\u5b98\u65b9\u4ed3\u5e93\uff1ahttps://github.com/eclipse/jetty.project</li> <li>Jetty\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/jetty/</li> <li>Jetty\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/appropriate/docker-jetty</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#5-lamp","title":"5 LAMP","text":"<p>LAMP\uff08Linux-Apache-MySQL-PHP\uff09\u662f\u76ee\u524d\u6d41\u884c\u7684Web\u5de5\u5177\u6808\uff0c\u5176\u4e2d\u5305\u62ec\uff1aLinux\u64cd\u4f5c\u7cfb\u7edf\uff0cApache\u7f51\u7edc\u670d\u52a1\u5668\uff0cMySQL\u6570\u636e\u5e93\uff0cPerl\u3001PHP\u6216\u8005Python\u7f16\u7a0b\u8bed\u8a00\u3002</p> <p>\u5176\u7ec4\u6210\u5de5\u5177\u5747\u662f\u6210\u719f\u7684\u5f00\u6e90\u8f6f\u4ef6\uff0c\u88ab\u5927\u91cf\u7f51\u7ad9\u6240\u91c7\u7528\u3002 \u548cJava/J2EE\u67b6\u6784\u76f8\u6bd4\uff0cLAMP\u5177\u6709Web\u8d44\u6e90\u4e30\u5bcc\u3001\u8f7b\u91cf\u3001\u5feb\u901f\u5f00\u53d1\u7b49\u7279\u70b9\uff1b \u548c\u5fae\u8f6f\u7684.NET\u67b6\u6784\u76f8\u6bd4\uff0cLAMP\u66f4\u5177\u6709\u901a\u7528\u3001\u8de8\u5e73\u53f0\u3001\u9ad8\u6027\u80fd\u3001\u4f4e\u4ef7\u683c\u7684\u4f18\u52bf\u3002\u56e0\u6b64LAMP\u6280\u672f\u6808\u5f97\u5230\u4e86\u5e7f\u6cdb\u7684\u5e94\u7528\u3002</p> <p><code>\u6ce8\u610f</code> \u73b0\u5728\u4e5f\u6709\u4eba\u7528Nginx\u66ff\u6362Apache\uff0c\u79f0\u4e3aLNMP\u6216LEMP\uff0c\u662f\u5341\u5206\u7c7b\u4f3c\u7684\u6280\u672f\u6808\uff0c\u5e76\u4e0d\u5f71\u54cd\u6574\u4e2a\u6280\u672f\u6846\u67b6\u7684\u9009\u578b\u539f\u5219\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#51-\u4f7f\u7528\u5b98\u65b9\u955c\u50cf","title":"5.1 \u4f7f\u7528\u5b98\u65b9\u955c\u50cf","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49Dockerfile\u6216\u8005Compose\u65b9\u5f0f\u8fd0\u884cLAMP\uff0c\u540c\u65f6\u793e\u533a\u4e5f\u63d0\u4f9b\u4e86\u5341\u5206\u6210\u719f\u7684linode/lamp\u548ctutum/lamp\u955c\u50cf\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#1\u4f7f\u7528linodelamp\u955c\u50cf","title":"\uff081\uff09\u4f7f\u7528linode/lamp\u955c\u50cf","text":"<p>\u9996\u5148\uff0c\u6267\u884cdocker[container]run\u6307\u4ee4\uff0c\u76f4\u63a5\u8fd0\u884c\u955c\u50cf\uff0c\u5e76\u8fdb\u5165\u5bb9\u5668\u5185\u90e8bash shell\uff1a</p> <pre><code>$ docker run -p 80:80 -t -i linode/lamp /bin/bash\nroot@e283cc3b2908:/#\n</code></pre> <p>\u5728\u5bb9\u5668\u5185\u90e8shell\u542f\u52a8Apache\u4ee5\u53caMySQL\u670d\u52a1\uff1a</p> <pre><code>$ root@e283cc3b2908:/# service apache2 start\n  * Starting web server apache2\n$ root@e283cc3b2908:/# service mysql start\n  * Starting MySQL database server mysqld                                 [ OK ]\n* Checking for tables which need an upgrade, are corrupt or were\nnot closed cleanly.\n</code></pre> <p>\u6b64\u65f6\u955c\u50cf\u4e2dApache\u3001MySQL\u670d\u52a1\u5df2\u7ecf\u542f\u52a8\uff0c\u53ef\u4f7f\u7528docker ps\u6307\u4ee4\u67e5\u770b\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\uff1a</p> <pre><code>[root@desktop-pmjtngi ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                NAMES\n52531235e745        linode/lamp         \"/bin/bash\"         46 seconds ago      Up 46 seconds       0.0.0.0:80-&gt;80/tcp   practical_meninsky\n</code></pre> <p>\u6b64\u65f6\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\u672c\u573080\u7aef\u53e3\u5373\u53ef\u770b\u5230\u9ed8\u8ba4\u9875\u9762\u3002\u5982\u56fe</p> <p>linode/lamp\u9ed8\u8ba4\u9875\u9762</p> <p></p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#2\u4f7f\u7528tutumlamp\u955c\u50cf","title":"\uff082\uff09\u4f7f\u7528tutum/lamp\u955c\u50cf","text":"<p>\u9996\u5148\uff0c\u6267\u884cdocker[container]run\u6307\u4ee4\uff0c\u76f4\u63a5\u8fd0\u884c\u955c\u50cf\uff1a</p> <pre><code>$ docker run -d -p 80:80 -p 3306:3306 tutum/lamp\n51e231878d3d61d4fd28874e22261f5cd740082826e870ac5568d6f2d77850e7\n</code></pre> <p>\u5bb9\u5668\u542f\u52a8\u6210\u529f\u540e\uff0c\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8bbf\u95eedemo\u9875\u9762\uff0c\u5982\u56fe</p> <p>LAMP\u5bb9\u5668Demo\u9875\u9762</p> <p></p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#3\u90e8\u7f72\u81ea\u5b9a\u4e49php\u5e94\u7528","title":"\uff083\uff09\u90e8\u7f72\u81ea\u5b9a\u4e49PHP\u5e94\u7528","text":"<p>\u9ed8\u8ba4\u7684\u5bb9\u5668\u542f\u52a8\u4e86\u4e00\u4e2ahelloword\u5e94\u7528\u3002\u8bfb\u8005\u53ef\u4ee5\u57fa\u4e8e\u6b64\u955c\u50cf\uff0c\u7f16\u8f91Dockerfile\u6765\u521b\u5efa\u81ea\u5b9a\u4e49LAMP\u5e94\u7528\u955c\u50cf\u3002</p> <p>\u5728\u5bbf\u4e3b\u4e3b\u673a\u4e0a\u521b\u5efa\u65b0\u7684\u5de5\u4f5c\u76ee\u5f55lamp\uff1a</p> <pre><code>$ mkdir lamp\n$ cd lamp\n$ touch Dockerfile\n</code></pre> <p>\u5728php\u76ee\u5f55\u4e0b\u91cc\u9762\u521b\u5efaDockerfile\u6587\u4ef6\uff0c\u5185\u5bb9\u4e3a\uff1a</p> <pre><code>FROM tutum/lamp:latest\nRUN rm -fr /app &amp;&amp; git clone https://github.com/username/customapp.git /app\n#\u8fd9\u91cc\u66ff\u6362 https://github.com/username/customapp.git \u5730\u5740\u4e3a\u4f60\u81ea\u5df1\u7684\u9879\u76ee\u5730\u5740\nEXPOSE 80 3306\nCMD [\"/run.sh\"]\n</code></pre> <p>\u521b\u5efa\u955c\u50cf\uff0c\u547d\u540d\u4e3amy-lamp-app\uff1a</p> <pre><code>$ docker build -t my-lamp-app .\n</code></pre> <p>\u5229\u7528\u65b0\u521b\u5efa\u955c\u50cf\u542f\u52a8\u5bb9\u5668\uff0c\u6ce8\u610f\u542f\u52a8\u65f6\u5019\u6307\u5b9a-d\u53c2\u6570\uff0c\u8ba9\u5bb9\u5668\u540e\u53f0\u8fd0\u884c\uff1a</p> <pre><code>$ docker run -d -p 8080:80 -p 3306:3306 my-lamp-app\n</code></pre> <p>\u5728\u672c\u5730\u4e3b\u673a\u4e0a\u4f7f\u7528curl\u547d\u4ee4\u6d4b\u8bd5\u5e94\u7528\u7a0b\u5e8f\u662f\u4e0d\u662f\u5df2\u7ecf\u6b63\u5e38\u54cd\u5e94\uff1a</p> <pre><code>$ curl http://127.0.0.1:8080/\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/2.Web%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BA%94%E7%94%A8/#52-\u76f8\u5173\u8d44\u6e90","title":"5.2 \u76f8\u5173\u8d44\u6e90","text":"<p>LAMP\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>tutum LAMP\u955c\u50cf\uff1ahttps://hub.docker.com/r/tutum/lamp/</li> <li>linode LAMP\u955c\u50cf\uff1ahttps://hub.docker.com/r/linode/lamp/</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/","title":"3.\u6301\u7eed\u5f00\u53d1\u4e0e\u7ba1\u7406","text":"<p>\u4fe1\u606f\u884c\u4e1a\u65e5\u65b0\u6708\u5f02\uff0c\u5982\u4f55\u54cd\u5e94\u4e0d\u65ad\u53d8\u5316\u7684\u9700\u6c42\uff0c\u5feb\u901f\u9002\u5e94\u548c\u4fdd\u8bc1\u8f6f\u4ef6\u7684\u8d28\u91cf\uff1f\u6301\u7eed\u96c6\u6210\uff08Continuous Integration\uff0cCI\uff09\u6b63\u662f\u9488\u5bf9\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\u7684\u4e00\u79cd\u5f00\u53d1\u5b9e\u8df5\uff0c\u5b83\u5021\u5bfc\u5f00\u53d1\u56e2\u961f\u5b9a\u671f\u8fdb\u884c\u96c6\u6210\u9a8c\u8bc1\u3002\u96c6\u6210\u901a\u8fc7\u81ea\u52a8\u5316\u7684\u6784\u5efa\u6765\u5b8c\u6210\uff0c\u5305\u62ec\u81ea\u52a8\u7f16\u8bd1\u3001\u53d1\u5e03\u548c\u6d4b\u8bd5\uff0c\u4ece\u800c\u5c3d\u5feb\u5730\u53d1\u73b0\u9519\u8bef\u3002</p> <p>\u6301\u7eed\u96c6\u6210\u7684\u7279\u70b9\u5305\u62ec\uff1a</p> <ul> <li> <p>\u9f13\u52b1\u81ea\u52a8\u5316\u7684\u5468\u671f\u6027\u7684\u8fc7\u7a0b\uff0c\u4ece\u68c0\u51fa\u4ee3\u7801\u3001\u7f16\u8bd1\u6784\u5efa\u3001\u8fd0\u884c\u6d4b\u8bd5\u3001\u7ed3\u679c\u8bb0\u5f55\u3001\u6d4b\u8bd5\u7edf\u8ba1\u7b49\u90fd\u662f\u81ea\u52a8\u5b8c\u6210\u7684\uff0c\u51cf\u5c11\u4eba\u5de5\u5e72\u9884\uff1b</p> </li> <li> <p>\u9700\u8981\u6709\u6301\u7eed\u96c6\u6210\u7cfb\u7edf\u7684\u652f\u6301\uff0c\u5305\u62ec\u4ee3\u7801\u6258\u7ba1\u673a\u5236\u652f\u6301\uff0c\u4ee5\u53ca\u96c6\u6210\u670d\u52a1\u5668\u7b49\u3002</p> </li> </ul> <p>\u6301\u7eed\u4ea4\u4ed8\uff08Continuous Delivery\uff0cCD\uff09\u5219\u662f\u7ecf\u5178\u7684\u654f\u6377\u8f6f\u4ef6\u5f00\u53d1\u65b9\u6cd5\u7684\u81ea\u7136\u5ef6\u4f38\uff0c\u5b83\u5f3a\u8c03\u4ea7\u54c1\u5728\u4fee\u6539\u540e\u5230\u90e8\u7f72\u4e0a\u7ebf\u7684\u6d41\u7a0b\u8981\u654f\u6377\u5316\u3001\u81ea\u52a8\u5316\u3002\u751a\u81f3\u4e00\u4e9b\u8f83\u5c0f\u7684\u6539\u53d8\u4e5f\u8981\u5c3d\u65e9\u5730\u90e8\u7f72\u4e0a\u7ebf\uff0c\u8fd9\u4e0e\u4f20\u7edf\u8f6f\u4ef6\u5728\u8f83\u5927\u7248\u672c\u66f4\u65b0\u540e\u624d\u4e0a\u7ebf\u7684\u601d\u8def\u4e0d\u540c\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/#1-jenkins\u53ca\u5b98\u65b9\u955c\u50cf","title":"1 Jenkins\u53ca\u5b98\u65b9\u955c\u50cf","text":"<p>Jenkins\u662f\u4e00\u4e2a\u5f97\u5230\u5e7f\u6cdb\u5e94\u7528\u7684\u6301\u7eed\u96c6\u6210\u548c\u6301\u7eed\u4ea4\u4ed8\u7684\u5de5\u5177\u3002\u4f5c\u4e3a\u5f00\u6e90\u8f6f\u4ef6\u9879\u76ee\uff0c\u5b83\u65e8\u5728\u63d0\u4f9b\u4e00\u4e2a\u5f00\u653e\u6613\u7528\u7684\u6301\u7eed\u96c6\u6210\u5e73\u53f0\u3002Jenkins\u80fd\u5b9e\u65f6\u76d1\u63a7\u96c6\u6210\u4e2d\u5b58\u5728\u7684\u9519\u8bef\uff0c\u63d0\u4f9b\u8be6\u7ec6\u7684\u65e5\u5fd7\u6587\u4ef6\u548c\u63d0\u9192\u529f\u80fd\uff0c\u5e76\u7528\u56fe\u8868\u7684\u5f62\u5f0f\u5f62\u8c61\u5730\u5c55\u793a\u9879\u76ee\u6784\u5efa\u7684\u8d8b\u52bf\u548c\u7a33\u5b9a\u6027\u3002Jenkins\u7279\u70b9\u5305\u62ec\u5b89\u88c5\u914d\u7f6e\u7b80\u5355\u3001\u652f\u6301\u8be6\u7ec6\u7684\u6d4b\u8bd5\u62a5\u8868\u3001\u5206\u5e03\u5f0f\u6784\u5efa\u7b49\u3002</p> <p>Jenkis\u81ea2.0\u7248\u672c\u63a8\u51fa\u4e86\u201cPipeline as Code\u201d\uff0c\u5e2e\u52a9Jenkins\u5b9e\u73b0\u5bf9CI\u548cCD\u66f4\u597d\u7684\u652f\u6301\u3002\u901a\u8fc7Pipeline\uff0c\u5c06\u539f\u672c\u72ec\u7acb\u8fd0\u884c\u7684\u591a\u4e2a\u4efb\u52a1\u8fde\u63a5\u8d77\u6765\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5341\u5206\u590d\u6742\u7684\u53d1\u5e03\u6d41\u7a0b\u3002</p> <p>Jenkins\u5b98\u65b9\u5728DockerHub\u4e0a\u63d0\u4f9b\u4e86\u5168\u529f\u80fd\u7684\u57fa\u4e8e\u5b98\u65b9\u53d1\u5e03\u7248\u7684Docker\u955c\u50cf\u3002</p> <p>\u53ef\u4ee5\u65b9\u4fbf\u5730\u4f7f\u7528docker[container]run\u6307\u4ee4\u4e00\u952e\u90e8\u7f72Jenkins\u670d\u52a1\uff1a</p> <pre><code>$ docker run -p 8080:8080 -p 50000:50000 jenkins\nApr 30, 2020 4:57:50 AM jenkins.install.SetupWizard init\nINFO: *************************************************************\n*************************************************************\n*************************************************************\n\nJenkins initial setup is required. An admin user has been created and a password generated.\nPlease use the following password to proceed to installation:\n\nf05ae5368fd74ee68b34ae41dbc4eaed\n\nThis may also be found at: /var/jenkins_home/secrets/initialAdminPassword\n</code></pre> <p>\u518d\u6253\u5f00\u4e00\u4e2a\u63a7\u5236\u53f0\u7ec8\u7aef\u67e5\u770bjenkins\u7684\u5bc6\u7801\uff1a</p> <pre><code>[root@desktop-pmjtngi lamp]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                              NAMES\n4991a17aaed0        jenkins             \"/bin/tini -- /usr/l\u2026\"   2 minutes ago       Up 2 minutes        0.0.0.0:8080-&gt;8080/tcp, 0.0.0.0:50000-&gt;50000/tcp   admiring_\neinstein[root@desktop-pmjtngi lamp]# docker exec -it 4991a17aaed0 cat /var/jenkins_home/secrets/initialAdminPassword\nf05ae5368fd74ee68b34ae41dbc4eaed\n</code></pre> <p>Jenkins\u5bb9\u5668\u542f\u52a8\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee8080\u7aef\u53e3\uff0c\u67e5\u770bJenkins\u7ba1\u7406\u754c\u9762\uff0c\u5982\u56fe:</p> <p></p> <p>\u76ee\u524d\u8fd0\u884c\u7684\u5bb9\u5668\u4e2d\uff0c\u6570\u636e\u4f1a\u5b58\u50a8\u5728\u5de5\u4f5c\u76ee\u5f55/var/jenkins_home\u4e2d\uff0c\u8fd9\u5305\u62ecJenkins\u4e2d\u6240\u6709\u7684\u6570\u636e\uff0c\u5982\u63d2\u4ef6\u548c\u914d\u7f6e\u4fe1\u606f\u7b49\u3002\u5982\u679c\u9700\u8981\u6570\u636e\u6301\u4e45\u5316\uff0c\u8bfb\u8005\u53ef\u4ee5\u4f7f\u7528\u6570\u636e\u5377\u673a\u5236\uff1a</p> <pre><code>$ docker run -p 8080:8080 -p 50000:50000 -v /your/home:/var/jenkins_home jenkins\ne25d995cc4a44d08a5d81af10aed0cf6\n</code></pre> <p>\u4ee5\u4e0a\u6307\u4ee4\u4f1a\u5c06Jenkins\u6570\u636e\u5b58\u50a8\u4e8e\u5bbf\u4e3b\u673a\u7684/your/home\u76ee\u5f55\uff08\u9700\u8981\u786e\u4fdd/your/home\u76ee\u5f55\u5bf9\u4e8e\u5bb9\u5668\u5185\u7684Jenkins\u7528\u6237\u662f\u53ef\u8bbf\u95ee\u7684\uff09\u4e0b\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6570\u636e\u5377\u5bb9\u5668\uff1a</p> <pre><code>$ docker run --name myjenkins -p 8080:8080 -p 50000:50000 -v /var/jenkins_home jenkins\n</code></pre> <p>\u53c2\u8003\u6587\u732e\uff1a</p> <p>DevOps - \u4ee5Docker\u65b9\u5f0f\u542f\u52a8Jenkins</p> <p>\u57fa\u4e8edocker\u642d\u5efajenkins</p> <p>jenkins \u8c03\u7528Rancher2.x api\u5b9e\u73b0CI/CD</p> <p>python\u8c03\u7528jenkinsAPI</p> <p>\u57fa\u4e8eJenkins+Gitlab+Harbor+Rancher+k8s CI/CD\u5b9e\u73b0</p> <p>Jenkins+harbor+gitlab+k8s \u90e8\u7f72maven\u9879\u76ee</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/#2-gitlab\u53ca\u5176\u5b98\u65b9\u955c\u50cf","title":"2 GitLab\u53ca\u5176\u5b98\u65b9\u955c\u50cf","text":"<p>GitLab\u662f\u4e00\u6b3e\u975e\u5e38\u5f3a\u5927\u7684\u5f00\u6e90\u6e90\u7801\u7ba1\u7406\u7cfb\u7edf\u3002\u5b83\u652f\u6301\u57fa\u4e8eGit\u7684\u6e90\u7801\u7ba1\u7406\u3001\u4ee3\u7801\u8bc4\u5ba1\u3001issue\u8ddf\u8e2a\u3001\u6d3b\u52a8\u7ba1\u7406\u3001wiki\u9875\u9762\u3001\u6301\u7eed\u96c6\u6210\u548c\u6d4b\u8bd5\u7b49\u529f\u80fd\u3002</p> <p>\u57fa\u4e8eGitLab\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5df1\u642d\u5efa\u4e00\u5957\u7c7b\u4f3c\u4e8eGithub\u7684\u5f00\u53d1\u534f\u540c\u5e73\u53f0\u3002</p> <p>GitLab\u5b98\u65b9\u63d0\u4f9b\u4e86\u793e\u533a\u7248\u672c\uff08GitLab CE\uff09\u7684DockerHub\u955c\u50cf\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528docker run\u6307\u4ee4\u8fd0\u884c\uff1a</p> <pre><code>$ docker run --detach \\\n--hostname gitlab.example.com \\\n--publish 443:443 --publish 80:80 --publish 23:23 \\\n--name gitlab \\\n--restart always \\\n--volume /srv/gitlab/config:/etc/gitlab \\\n--volume /srv/gitlab/logs:/var/log/gitlab \\\n--volume /srv/gitlab/data:/var/opt/gitlab \\\ngitlab/gitlab-ce:latest\n\ndbae485d24492f656d2baf18526552353cd55aac662e32491046ed7fa033be3a\n</code></pre> <p>\u6210\u529f\u8fd0\u884c\u955c\u50cf\u540e\uff0c\u53ef\u4ee5\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95eeGitLab\u670d\u52a1\u7ba1\u7406\u754c\u9762\u3002</p> <p>\u53c2\u8003\u6587\u732e\uff1a</p> <p>DevOps - \u4ee5Docker\u65b9\u5f0f\u542f\u52a8GitLab</p> <p>\u57fa\u4e8edocker\u642d\u5efagitlab</p> <p>docker-compose\u90e8\u7f72gitlab\u4e2d\u6587\u7248</p> <p>\u53c2\u8003\uff1a https://www.jianshu.com/p/2d76092ebf53</p> <p>https://www.jb51.net/article/152570.htm</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/3.%E6%8C%81%E7%BB%AD%E5%BC%80%E5%8F%91%E4%B8%8E%E7%AE%A1%E7%90%86/#3-\u76f8\u5173\u8d44\u6e90","title":"3 \u76f8\u5173\u8d44\u6e90","text":"<p>Jenkins\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Jenkins\u5b98\u7f51\uff1ahttps://jenkins.io/ </li> <li>Jenkins\u5b98\u65b9\u4ed3\u5e93\uff1ahttps://github.com/jenkinsci/jenkins/</li> <li>Jenkins\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/r/jenkinsci/jenkins/</li> <li>Jenkins\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/jenkinsci/docker</li> </ul> <p>GitLab\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>GitLab\u5b98\u7f51\uff1ahttps://github.com/gitlabhq/gitlabhq</li> <li>GitLab\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/r/gitlab/gitlab-ce/</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/","title":"4.\u6570\u636e\u5e93\u5e94\u7528","text":"<p>\u76ee\u524d\uff0c\u4e3b\u6d41\u6570\u636e\u5e93\u5305\u62ec\u5173\u7cfb\u578b\uff08SQL\uff09\u548c\u975e\u5173\u7cfb\u578b\uff08NoSQL\uff09\u4e24\u79cd\u3002 \u5173\u7cfb\u6570\u636e\u5e93\u662f\u5efa\u7acb\u5728\u5173\u7cfb\u6a21\u578b\u57fa\u7840\u4e0a\u7684\u6570\u636e\u5e93\uff0c\u501f\u52a9\u4e8e\u96c6\u5408\u4ee3\u6570\u7b49\u6570\u5b66\u6982\u5ff5\u548c\u65b9\u6cd5\u6765\u5904\u7406\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\uff0c\u652f\u6301\u590d\u6742\u7684\u4e8b\u7269\u5904\u7406\u548c\u7ed3\u6784\u5316\u67e5\u8be2\u3002 \u4ee3\u8868\u5b9e\u73b0\u6709MySQL\u3001Oracle\u3001PostGreSQL\u3001MariaDB\u3001SQLServer\u7b49\u3002</p> <p>\u975e\u5173\u7cfb\u6570\u636e\u5e93\u662f\u65b0\u5174\u7684\u6570\u636e\u5e93\u6280\u672f\uff0c\u5b83\u653e\u5f03\u4e86\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u90e8\u5206\u5f3a\u4e00\u81f4\u6027\u9650\u5236\uff0c\u5e26\u6765\u6027\u80fd\u4e0a\u7684\u63d0\u5347\uff0c\u4f7f\u5176\u66f4\u9002\u7528\u4e8e\u9700\u8981\u5927\u89c4\u6a21\u5e76\u884c\u5904\u7406\u7684\u573a\u666f\u3002\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u826f\u597d\u8865\u5145\uff0c\u4ee3\u8868\u4ea7\u54c1\u6709MongoDB\u3001Redis\u7b49\u3002</p> <p>\u672c\u7ae0\u9009\u53d6\u4e86\u6700\u5177\u4ee3\u8868\u6027\u7684\u6570\u636e\u5e93\u5982MySQL\u3001Oracle\u3001MongoDB\u3001Redis\u3001Cassandra\u7b49\uff0c\u6765\u8bb2\u89e3\u57fa\u4e8eDocker\u521b\u5efa\u76f8\u5173\u955c\u50cf\u5e76\u8fdb\u884c\u5e94\u7528\u7684\u8fc7\u7a0b\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1-mysql","title":"1 MySQL","text":"<p>MySQL\u662f\u5168\u7403\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e4b\u4e00\uff0c\u7531\u4e8e\u5176\u5177\u6709\u9ad8\u6027\u80fd\u3001\u6210\u719f\u53ef\u9760\u3001\u9ad8\u9002\u5e94\u6027\u3001\u6613\u7528\u6027\u800c\u5f97\u5230\u5e7f\u6cdb\u5e94\u7528\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1\u4f7f\u7528\u5b98\u65b9\u955c\u50cf","title":"1.\u4f7f\u7528\u5b98\u65b9\u955c\u50cf","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u5b98\u65b9\u955c\u50cf\u5feb\u901f\u542f\u52a8\u4e00\u4e2aMySQL Server\u5b9e\u4f8b\uff1a</p> <pre><code>$ docker run --name hi-mysql -e MYSQL_ROOT_PASSWORD=my-pwd -d mysql:latest\ne6cb906570549812c798b7b3ce46d669a8a4e8ac62a3f3c8997e4c53d16301b6\n</code></pre> <p>\u4ee5\u4e0a\u6307\u4ee4\u4e2d\u7684hi-mysql\u662f\u5bb9\u5668\u540d\u79f0\uff0c<code>my-pwd\u4e3a\u6570\u636e\u5e93\u7684root\u7528\u6237\u5bc6\u7801</code>\u3002</p> <p>\u4f7f\u7528docker ps\u6307\u4ee4\u53ef\u4ee5\u770b\u5230\u73b0\u5728\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\uff1a</p> <pre><code>$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                 NAMES\n6f4aa173b2aa        mysql:latest        \"docker-entrypoint.s\u2026\"   31 seconds ago      Up 30 seconds       3306/tcp, 33060/tcp   hi-mysql\n</code></pre> <p>\u5f53\u7136\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528--link\u6807\u7b7e\u5c06\u4e00\u4e2a\u5e94\u7528\u5bb9\u5668\u8fde\u63a5\u81f3MySQL\u5bb9\u5668\uff1a</p> <pre><code>$ docker run --name some-app --link some-mysql:mysql -d application-that-uses-mysql\n</code></pre> <p>MySQL\u670d\u52a1\u7684\u6807\u51c6\u7aef\u53e3\u662f3306\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7CLI\u5de5\u5177\u5bf9\u914d\u7f6e\u8fdb\u884c\u4fee\u6539\uff1a</p> <pre><code>$ docker run -it --link some-mysql:mysql --rm mysql sh -c 'exec mysql -h\"$MYSQL_PORT_3306_TCP_ADDR\" -P\"$MYSQL_PORT_3306_TCP_PORT\" -uroot -p\"$MYSQL_ENV_MYSQL_ROOT_PASSWORD\"'\n</code></pre> <p>\u5b98\u65b9MySQL\u955c\u50cf\u8fd8\u53ef\u4ee5\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff0c\u8fde\u63a5\u975eDocker\u6216\u8005\u8fdc\u7a0b\u7684MySQL\u5b9e\u4f8b\uff1a</p> <pre><code>$ docker run -it --rm mysql mysql -hsome.mysql.host -usome-mysql-user -p\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1\u7cfb\u7edf\u4e0e\u65e5\u5fd7\u8bbf\u95ee","title":"1.\u7cfb\u7edf\u4e0e\u65e5\u5fd7\u8bbf\u95ee","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528docker exec\u6307\u4ee4\u8c03\u7528\u5185\u90e8\u7cfb\u7edf\u4e2d\u7684bash shell\uff0c\u4ee5\u8bbf\u95ee\u5bb9\u5668\u5185\u90e8\u7cfb\u7edf\uff1a</p> <pre><code>$ docker exec -it some-mysql bash\n</code></pre> <p>MySQL Server\u65e5\u5fd7\u53ef\u4ee5\u4f7f\u7528docker logs\u6307\u4ee4\u67e5\u770b\uff1a</p> <pre><code>$ docker logs some-mysql\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2\u4f7f\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6","title":"2.\u4f7f\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6","text":"<p>\u5982\u679c\u7528\u6237\u5e0c\u671b\u4f7f\u7528\u81ea\u5b9a\u4e49MySQL\u914d\u7f6e\uff0c\u5219\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u5185\u7f6ecnf\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u5c06\u5176\u6302\u8f7d\u81f3\u5bb9\u5668\u7684/etc/mysql/conf.d\u76ee\u5f55\u3002\u6bd4\u5982\uff0c\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u4e3a/my/custom/config-file.cnf\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u6307\u4ee4\uff1a</p> <pre><code>$ docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag\n</code></pre> <p>\u8fd9\u65f6\u65b0\u7684\u5bb9\u5668some-mysql\u542f\u52a8\u540e\uff0c\u5c31\u4f1a\u7ed3\u5408\u4f7f\u7528/etc/mysql/my.cnf\u548c/etc/mysql/conf.d/config-file.cnf\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u53c2\u8003\u6587\u732e docker\u5c01\u88c5mysql\u955c\u50cf</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#3\u8131\u79bbcnf\u6587\u4ef6\u8fdb\u884c\u914d\u7f6e","title":"3.\u8131\u79bbcnf\u6587\u4ef6\u8fdb\u884c\u914d\u7f6e","text":"<p>\u5f88\u591a\u7684\u914d\u7f6e\u9009\u9879\u53ef\u4ee5\u901a\u8fc7\u6807\u7b7e\uff08flags\uff09\u4f20\u9012\u81f3mysqld\u8fdb\u7a0b\uff0c\u8fd9\u6837\u7528\u6237\u5c31\u53ef\u4ee5\u8131\u79bbcnf\u914d\u7f6e\u6587\u4ef6\uff0c\u5bf9\u5bb9\u5668\u8fdb\u884c\u5f39\u6027\u7684\u5b9a\u5236\u3002\u6bd4\u5982\uff0c\u7528\u6237\u9700\u8981\u6539\u53d8\u9ed8\u8ba4\u7f16\u7801\u65b9\u5f0f\uff0c\u5c06\u6240\u6709\u8868\u683c\u7684\u7f16\u7801\u65b9\u5f0f\u4fee\u6539\u4e3auft8mb4\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u6307\u4ee4\uff1a</p> <pre><code>$ docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\n</code></pre> <p>\u5982\u679c\u9700\u8981\u67e5\u770b\u53ef\u7528\u9009\u9879\u7684\u5b8c\u6574\u5217\u8868\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u6307\u4ee4\uff1a</p> <pre><code>$ docker run -it --rm mysql:tag --verbose --help\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#4\u901a\u8fc7docker-stack-deploy\u6216docker-compose\u8fd0\u884c","title":"4.\u901a\u8fc7docker stack deploy\u6216docker-compose\u8fd0\u884c","text":"<p>MySQL\u7684\u793a\u4f8b<code>stack.yml</code>\u5982\u4e0b\uff1a</p> <pre><code># Use root/example as user/password credentials\nversion: '3.1'\nservices:\ndb:\nimage: mysql\nrestart: always\nenvironment:\nMYSQL_ROOT_PASSWORD: example\nadminer:\nimage: adminer\nrestart: always\nports:\n- 8080:8080\n</code></pre> <p>docker-compose\u90e8\u7f72mysql5.6</p> <pre><code>version: '3.8'\nservices:\nmysql:\nimage: hub.gitee.cc/library/mysql:5.6.48\nrestart: always\ncommand: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\nenvironment:\n- MYSQL_ROOT_PASSWORD=oschina123\n- MYSQL_DATABASE=gitlabhq_production\n- MYSQL_USER=giteeci\n- MYSQL_PASSWORD=123456\n- MYSQL_HOST=%\nuser: 1000:1000\nports:\n- 3306:3306\nvolumes:\n- /data/mysql:/var/lib/mysql\n- ./mysql.cnf:/etc/mysql/conf.d/mysql.cnf\n</code></pre> <p>docker-compose\u90e8\u7f72mysql5.7</p> <pre><code>version: \"3\"\nservices:\nmysql:\nimage: mysql:5.7\nrestart: always\nhostname: mysql-master\ncontainer_name: \"mysql57-giteeci\"\nports:\n- 33006:3306\nenvironment:\nTZ: Asia/Shanghai\nMYSQL_ROOT_PASSWORD: oschina123\nMYSQL_DATABASE: gitlabhq_production\nMYSQL_USER: giteeci\nMYSQL_PASSWORD: 123456\nMYSQL_HOST: \"%\"\nvolumes:\n- /data/mysql57:/var/lib/mysql\n- ./mysql.cnf:/etc/mysql/conf.d/mysql.cnf\ncommand:\n--server_id=100\n--log-bin=mysql-bin\n--sync_binlog=1\n--binlog-ignore-db=mysql\n--binlog_format=mixed\n--expire_logs_days=7\n--default-authentication-plugin=mysql_native_password\n--character-set-server=utf8mb4\n--collation-server=utf8mb4_general_ci\n--explicit_defaults_for_timestamp=true\n--lower_case_table_names=1\n--sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\n#--sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\n</code></pre> <p>docker\u5b89\u88c5mysql8.0</p> <p>http://oudezhinu.site/%e6%8a%80%e6%9c%af%e6%80%bb%e7%bb%93/%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f/linux%e6%8a%80%e5%b7%a7/docker%e5%ae%89%e8%a3%85mysql8-0/</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2mysql\u4e3b\u4ece\u540c\u6b65","title":"2.Mysql\u4e3b\u4ece\u540c\u6b65","text":"<p>\u8f7b\u677e\u5b9e\u73b0mysql\u4e3b\u4ece\u540c\u6b65</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#3-pxc\u5b9e\u73b0mysql\u591a\u4e3b\u540c\u6b65","title":"3. PXC\u5b9e\u73b0Mysql\u591a\u4e3b\u540c\u6b65","text":"<p>\u5b9e\u73b0\u57fa\u4e8ePXC\u7684\u591a\u4e3b\u540c\u6b65</p> <p>Dockerfile\u8bf7\u5230 https://github.com/docker-library/docs/tree/master/mysql \u67e5\u770b</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#4\u76f8\u5173\u8d44\u6e90","title":"4.\u76f8\u5173\u8d44\u6e90","text":"<p>MySQL\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>MySQL\u5b98\u7f51\uff1ahttps://www.mysql.com/</li> <li>MySQL\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/mysql/</li> <li>MySQL\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/docker-library/mysql/</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2-oracle-database-xe","title":"2 Oracle Database XE","text":"<p>Oracle Database 11g\u5feb\u6377\u7248\uff08Oracle Database XE\uff09\u662f\u4e00\u6b3e\u57fa\u4e8eOracle Database 11g\u7b2c2\u7248\u4ee3\u7801\u5e93\u7684\u5c0f\u578b\u5165\u95e8\u7ea7\u6570\u636e\u5e93\uff0c\u5177\u5907\u4ee5\u4e0b\u4f18\u70b9\uff1a</p> <p>\u00b7\u514d\u8d39\u5f00\u53d1\u3001\u90e8\u7f72\u548c\u5206\u53d1\uff1b \u00b7\u4f53\u79ef\u8f83\u5c0f\uff0c\u4e0b\u8f7d\u901f\u5ea6\u5feb\uff1b \u00b7\u7ba1\u7406\u914d\u7f6e\u7b80\u5355\u3002</p> <p>\u4f5c\u4e3a\u4e00\u6b3e\u4f18\u79c0\u7684\u5165\u95e8\u7ea7\u6570\u636e\u5e93\uff0c\u5b83\u9002\u5408\u4ee5\u4e0b\u7528\u6237\u4f7f\u7528\uff1a</p> <p>\u00b7\u81f4\u529b\u4e8ePHP\u3001Java\u3001.NET\u3001XML\u548c\u5f00\u6e90\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u4eba\u5458\uff1b \u00b7\u9700\u8981\u514d\u8d39\u7684\u5165\u95e8\u7ea7\u6570\u636e\u5e93\u8fdb\u884c\u57f9\u8bad\u548c\u90e8\u7f72\u7684DBA\uff1b \u00b7\u9700\u8981\u5165\u95e8\u7ea7\u6570\u636e\u5e93\u8fdb\u884c\u514d\u8d39\u5206\u53d1\u7684\u72ec\u7acb\u8f6f\u4ef6\u4f9b\u5e94\u5546\uff08ISV\uff09\u548c\u786c\u4ef6\u4f9b\u5e94\u5546\uff1b \u00b7\u9700\u8981\u5728\u8bfe\u7a0b\u4e2d\u4f7f\u7528\u514d\u8d39\u6570\u636e\u5e93\u7684\u6559\u80b2\u673a\u6784\u548c\u5b66\u751f\u3002</p> <p>Oracle Database XE\u5bf9\u5b89\u88c5\u4e3b\u673a\u7684\u89c4\u6a21\u548cCPU\u6570\u91cf\u4e0d\u4f5c\u9650\u5236\uff08\u6bcf\u53f0\u8ba1\u7b97\u673a\u4e00\u4e2a\u6570\u636e\u5e93\uff09\uff0c\u4f46XE\u5c06\u6700\u591a\u5b58\u50a811 GB\u7684\u7528\u6237\u6570\u636e\uff0c\u540c\u65f6\u6700\u591a\u4f7f\u75281 GB\u5185\u5b58\u548c\u4e3b\u673a\u4e0a\u7684\u4e00\u4e2aCPU\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1\u641c\u7d22oracle\u955c\u50cf","title":"1.\u641c\u7d22Oracle\u955c\u50cf","text":"<p>\u76f4\u63a5\u5728DockerHub\u4e0a\u641c\u7d22\u955c\u50cf\uff0c\u5e76\u4e0b\u8f7dwnameless/oracle-xe-11g\u955c\u50cf\uff1a</p> <pre><code>$ docker search --filter=stars=50 oracle\nNAME                              DESCRIPTION                                STARS               OFFICIAL            AUTOMATED\noraclelinux                       Official Docker builds of Oracle Linux.    646                 [OK]                jaspeen/oracle-11g                Docker image for Oracle 11g database       157                                     [OK]\noracleinanutshell/oracle-xe-11g                                              93                                      oracle/graalvm-ce                 GraalVM Community Edition Official Image   66                                      [OK]\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2\u542f\u52a8\u548c\u4f7f\u7528\u5bb9\u5668","title":"2.\u542f\u52a8\u548c\u4f7f\u7528\u5bb9\u5668","text":"<p>\u542f\u52a8\u5bb9\u5668\uff0c\u5e76\u5206\u522b\u6620\u5c0422\u548c1521\u7aef\u53e3\u5230\u672c\u5730\u768449160\u548c49161\u7aef\u53e3\uff1a</p> <pre><code>$ docker run -d -p 49160:22 -p 49161:1521 wnameless/oracle-xe-11g\n</code></pre> <p>\u4f7f\u7528\u4e0b\u5217\u53c2\u6570\u53ef\u4ee5\u8fde\u63a5oracle\u6570\u636e\u5e93\uff1a</p> <pre><code>hostname: localhost\nport: 49161\nsid: xe\nusername: system\npassword: oracle\nPassword for SYS\n</code></pre> <p>\u4f7f\u7528SSH\u767b\u5f55\u5bb9\u5668\uff0c\u9ed8\u8ba4\u7684\u7528\u6237\u540d\u4e3aroot\uff0c\u5bc6\u7801\u4e3aadmin\uff1a</p> <pre><code>$ ssh root@localhost -p 49160\npassword: admin\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#3\u76f8\u5173\u8d44\u6e90","title":"3.\u76f8\u5173\u8d44\u6e90","text":"<p>Oracle\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <pre><code>\u00b7Oracle XE\u5b98\u7f51\uff1ahttp://www.oracle.com/technetwork/database/database-technologies/express-edition/overview/index.html\n\n\u00b7Oracle XE\u5b98\u65b9\u955c\u50cf\uff1ahttps://github.com/wnameless/docker-oracle-xe-11g\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#3-mongodb","title":"3 MongoDB","text":"<p>MongoDB\u662f\u4e00\u6b3e\u53ef\u6269\u5c55\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90\u6587\u6863\u6570\u636e\u5e93\uff08Document-Oriented\uff09\uff0c\u662f\u5f53\u4eca\u6700\u6d41\u884c\u7684NoSQL\u6570\u636e\u5e93\u4e4b\u4e00\u3002\u5b83\u91c7\u7528C++\u5f00\u53d1\uff0c\u652f\u6301\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\u548c\u5f3a\u5927\u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u63d0\u4f9b\u4e86\u5173\u7cfb\u6570\u636e\u5e93\u7684\u7edd\u5927\u90e8\u5206\u529f\u80fd\u3002\u7531\u4e8e\u5176\u9ad8\u6027\u80fd\u3001\u6613\u90e8\u7f72\u3001\u6613\u4f7f\u7528\u7b49\u7279\u70b9\uff0cMongoDB\u5df2\u7ecf\u5728\u5f88\u591a\u9886\u57df\u90fd\u5f97\u5230\u4e86\u5e7f\u6cdb\u7684\u5e94\u7528\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1\u4f7f\u7528\u5b98\u65b9\u955c\u50cf_1","title":"1.\u4f7f\u7528\u5b98\u65b9\u955c\u50cf","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528docker[container]run\u6307\u4ee4\u76f4\u63a5\u8fd0\u884c\u5b98\u65b9mongoDB\u955c\u50cf\uff1a</p> <pre><code>$ docker run --name mongo-container -d mongo\nade2b5036f457a6a2e7574fd68cf7a3298936f27280833769e93392015512735\n</code></pre> <p>\u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7docker ps\u6307\u4ee4\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684mongo-container\u7684\u5bb9\u5668ID\uff1a</p> <pre><code>$ docker ps\nCONTAINER ID IMAGE COMMAND                CREATED     STATUS      PORTS     NAMES\nade2b5036f45 mongo \"/entrypoint.sh mongo\" 1 hours ago Up 22 hours 27017/tcp mongo-container\n</code></pre> <p>\u5728\u6b64\uff0cmongo-contariner\u542f\u52a8\u4e00\u4e2abash\u8fdb\u7a0b\uff0c\u5e76\u901a\u8fc7mongo\u6307\u4ee4\u542f\u52a8mongodbDB\u4ea4\u4e92\u547d\u4ee4\u884c\uff0c\u518d\u901a\u8fc7db.stats()\u6307\u4ee4\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001\uff1a</p> <pre><code>$ docker exec -it ade2b5036f45 sh\n# mongo\nMongoDB shell version: 3.2.6\nconnecting to: test\nServer has startup warnings:\nI CONTROL  [initandlisten]\nI CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/enabled is 'always'.\nI CONTROL  [initandlisten] **        We suggest setting it to 'never'\nI CONTROL  [initandlisten]\nI CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is 'always'.\nI CONTROL  [initandlisten] **        We suggest setting it to 'never'\nI CONTROL  [initandlisten]\n&gt; show dbs\nlocal  0.000GB\n&gt; db.stats()\n{\n\"db\" : \"test\",\n    \"collections\" : 1,\n    \"objects\" : 1,\n    \"avgObjSize\" : 39,\n    \"dataSize\" : 39,\n    \"storageSize\" : 16384,\n    \"numExtents\" : 0,\n    \"indexes\" : 1,\n    \"indexSize\" : 16384,\n    \"ok\" : 1\n}\n</code></pre> <p>\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7env\u6307\u4ee4\u67e5\u770b\u73af\u5883\u53d8\u91cf\u7684\u914d\u7f6e\uff1a</p> <pre><code>root@e4e9120bb00e:/# env\nPWD=/\nHOME=/root\nGOSU_VERSION=1.12\nMONGO_VERSION=4.2.6\nMONGO_REPO=repo.mongodb.org\nTERM=xterm\nMONGO_PACKAGE=mongodb-org\nSHLVL=1\nMONGO_MAJOR=4.2\nJSYAML_VERSION=3.13.1\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n_=/usr/bin/env\n</code></pre> <p>\u955c\u50cf\u9ed8\u8ba4\u66b4\u9732\u4e86mongoDB\u7684\u670d\u52a1\u7aef\u53e3:27017\uff0c\u53ef\u4ee5\u901a\u8fc7\u8be5\u7aef\u53e3\u8bbf\u95ee\u670d\u52a1\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1\u8fde\u63a5mongodb\u5bb9\u5668","title":"1.\u8fde\u63a5mongoDB\u5bb9\u5668","text":"<p>\u4f7f\u7528--link\u53c2\u6570\uff0c\u8fde\u63a5\u65b0\u5efa\u7684mongo-container\u5bb9\u5668\uff1a</p> <pre><code>$ docker run -it --link mongo-container:db alpine sh\n/ # ls\n</code></pre> <p>\u8fdb\u5165alpine\u7cfb\u7edf\u5bb9\u5668\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528ping\u6307\u4ee4\u6d4b\u8bd5mongo-container\u5bb9\u5668\u7684\u8fde\u901a\u6027\uff1a</p> <pre><code>/ # ping db\nPING db (172.17.0.5): 56 data bytes\n64 bytes from 172.17.0.5: seq=0 ttl=64 time=0.093 ms\n64 bytes from 172.17.0.5: seq=1 ttl=64 time=0.104 ms\n^C\n--- db ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.093/0.098/0.104 ms\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2\u76f4\u63a5\u4f7f\u7528mongo-cli\u6307\u4ee4","title":"2.\u76f4\u63a5\u4f7f\u7528mongo cli\u6307\u4ee4","text":"<p>\u5982\u679c\u7528\u6237\u60f3\u76f4\u63a5\u5728\u5bbf\u4e3b\u673a\u5668\u4e0a\u4f7f\u7528mongoDB\uff0c\u53ef\u4ee5\u5728docker[container]run\u6307\u4ee4\u540e\u9762\u52a0\u5165entrypoint\u6307\u4ee4\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u76f4\u63a5\u8fdb\u5165mongo cli\u4e86\uff1a</p> <pre><code>$ docker run -it --link mongo-container:db --entrypoint mongo mongo --host db\nMongoDB shell version: 3.2.6\nconnecting to: db:27017/test\nWelcome to the MongoDB shell.\nFor interactive help, type \"help\".\nFor more comprehensive documentation, see\n    http://docs.mongodb.org/\nQuestions? Try the support group\n    http://groups.google.com/group/mongodb-user\n......\n&gt; db.version();\n3.2.6\n&gt;  db.stats();\n{\n\"db\" : \"test\",\n    \"collections\" : 0,\n    \"objects\" : 0,\n    \"avgObjSize\" : 0,\n    \"dataSize\" : 0,\n    \"storageSize\" : 0,\n    \"numExtents\" : 0,\n    \"indexes\" : 0,\n    \"indexSize\" : 0,\n    \"fileSize\" : 0,\n    \"ok\" : 1\n}\n&gt; show dbs\nlocal  0.000GB\n</code></pre> <p>\u6700\u540e\uff0c\u7528\u6237\u8fd8\u53ef\u4ee5\u4f7f\u7528--storageEngine\u53c2\u6570\u6765\u8bbe\u7f6e\u50a8\u5b58\u5f15\u64ce\uff1a</p> <pre><code>$ docker run --name mongo-container -d mongo --storageEngine wiredTiger\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2\u4f7f\u7528\u81ea\u5b9a\u4e49dockerfile","title":"2.\u4f7f\u7528\u81ea\u5b9a\u4e49Dockerfile","text":"<p>\u7b2c\u4e00\u6b65\uff0c\u51c6\u5907\u5de5\u4f5c\u3002\u65b0\u5efa\u9879\u76ee\u76ee\u5f55\uff0c\u5e76\u5728\u6839\u76ee\u5f55\u65b0\u5efaDockerfile\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code># \u8bbe\u7f6e\u4ece\u7528\u6237\u4e4b\u524d\u521b\u5efa\u7684sshd\u955c\u50cf\u7ee7\u627f\nFROM sshd\nMAINTAINER docker_user (user@docker.com)\nRUN apt-get update &amp;&amp; \\\napt-get install -y mongodb pwgen &amp;&amp; \\\napt-get clean &amp;&amp; \\\nrm -rf /var/lib/apt/lists/*\n# \u521b\u5efamongoDB\u5b58\u653e\u6570\u636e\u6587\u4ef6\u7684\u6587\u4ef6\u5939\nRUN mkdir -p /data/db\nVOLUME /data/db\nENV AUTH yes\n# \u6dfb\u52a0\u811a\u672c\nADD run.sh /run.sh\nADD set_mongodb_password.sh /set_mongodb_password.sh\nRUN chmod 755 ./*.sh\nEXPOSE 27017\nEXPOSE 28017\nCMD [\"/run.sh\"]\n</code></pre> <p>\u65b0\u5efaset_mongodb_password.sh\u811a\u672c\uff0c\u6b64\u811a\u672c\u4e3b\u8981\u8d1f\u8d23\u914d\u7f6e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff1a</p> <pre><code>#!/bin/bash\n# \u8fd9\u4e2a\u811a\u672c\u4e3b\u8981\u662f\u7528\u6765\u8bbe\u7f6e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\n# \u5224\u65ad\u662f\u5426\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u5bc6\u7801\nif [ -f /.mongodb_password_set ]; then\necho \"MongoDB password already set!\"\nexit 0\nfi\n/usr/bin/mongod --smallfiles --nojournal &amp;\nPASS=${MONGODB_PASS:-$(pwgen -s 12 1)}\n_word=$( [ ${MONGODB_PASS} ] &amp;&amp; echo \"preset\" || echo \"random\" )\nRET=1\nwhile [[ RET -ne 0 ]]; do\necho \"=&gt; Waiting for confirmation of MongoDB service startup\"\nsleep 5\nmongo admin --eval \"help\" &gt;/dev/null 2&gt;&amp;1\nRET=$?\ndone\n# \u901a\u8fc7docker logs + id\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u7684\u8f93\u51fa\necho \"=&gt; Creating an admin user with a ${_word} password in MongoDB\"\nmongo admin --eval \"db.addUser({user: 'admin', pwd: '$PASS', roles: [ 'userAdminAnyDatabase', 'dbAdminAnyDatabase' ]});\"\nmongo admin --eval \"db.shutdownServer();\"\necho \"=&gt; Done!\"\ntouch /.mongodb_password_set\necho \"========================================================================\"\necho \"You can now connect to this MongoDB server using:\"\necho \"\"\necho \"    mongo admin -u admin -p $PASS --host &lt;host&gt; --port &lt;port&gt;\"\necho \"\"\necho \"Please remember to change the above password as soon as possible!\"\necho \"========================================================================\"\n</code></pre> <p>\u65b0\u5efarun.sh\uff0c\u6b64\u811a\u672c\u662f\u4e3b\u8981\u7684mongoDB\u542f\u52a8\u811a\u672c\uff1a</p> <pre><code>#!/bin/bash\nif [ ! -f /.mongodb_password_set ]; then\n/set_mongodb_password.sh\nfi\nif [ \"$AUTH\" == \"yes\" ]; then\n# \u8fd9\u91cc\u8bfb\u8005\u53ef\u4ee5\u81ea\u5df1\u8bbe\u5b9a MongoDB \u7684\u542f\u52a8\u53c2\u6570\nexport mongodb='/usr/bin/mongod --nojournal --auth --httpinterface --rest'\nelse\nexport mongodb='/usr/bin/mongod --nojournal --httpinterface --rest'\nfi\nif [ ! -f /data/db/mongod.lock ]; then\neval $mongodb\nelse\nexport mongodb=$mongodb' --dbpath /data/db'\nrm /data/db/mongod.lock\n    mongod --dbpath /data/db --repair &amp;&amp; eval $mongodb\nfi\n</code></pre> <pre><code>chmod 755 set_mongodb_password.sh run.sh\n</code></pre> <p>\u7b2c\u4e8c\u6b65\uff0c\u4f7f\u7528docker build\u6307\u4ee4\u6784\u5efa\u955c\u50cf\uff1a</p> <pre><code>$ docker build  -t mongodb-image .\n$docker images\nREPOSITORY                TAG                 IMAGE ID            CREATED             SIZE\nmongodb-image             latest              67b174371e57        13 minutes ago      287MB\n</code></pre> <p>\u7b2c\u4e09\u6b65\uff0c\u542f\u52a8\u540e\u53f0\u5bb9\u5668\uff0c\u5e76\u5206\u522b\u6620\u5c0427017\u548c28017\u7aef\u53e3\u5230\u672c\u5730\uff1a</p> <pre><code>$ docker run -d -p 27017:27017 -p 28017:28017 mongodb-image\n</code></pre> <p>\u901a\u8fc7docker logs\u6765\u67e5\u770b\u9ed8\u8ba4\u7684admin\u8d26\u6237\u5bc6\u7801\uff1a</p> <pre><code>$ docker logs sa9\n========================================================================\nYou can now connect to this MongoDB server using:\n            mongo admin -u admin -p 5elsT6KtjrqV --host &lt;host&gt; --port &lt;port&gt;\n        Please remember to change the above password as soon as possible!\n    ========================================================================\n</code></pre> <p>\u5c4f\u5e55\u8f93\u51fa\u4e2d\u76845elsT6KtjrqV\u5c31\u662fadmin\u7528\u6237\u7684\u5bc6\u7801\u3002</p> <p>\u4e5f\u53ef\u4ee5\u5229\u7528\u73af\u5883\u53d8\u91cf\u5728\u5bb9\u5668\u542f\u52a8\u65f6\u6307\u5b9a\u5bc6\u7801\uff1a</p> <pre><code>$  docker run -d -p 27017:27017 -p 28017:28017 -e MONGODB_PASS=\"mypass\" mongodb\n</code></pre> <p>\u751a\u81f3\uff0c\u8bbe\u5b9a\u4e0d\u9700\u8981\u5bc6\u7801\u5373\u53ef\u8bbf\u95ee\uff1a</p> <pre><code>$  docker run -d -p 27017:27017 -p 28017:28017 -e AUTH=no mongodb\n</code></pre> <p>\u540c\u6837\uff0c\u8bfb\u8005\u4e5f\u53ef\u4ee5\u4f7f\u7528-v\u53c2\u6570\u6765\u6620\u5c04\u672c\u5730\u76ee\u5f55\u5230\u5bb9\u5668\u3002</p> <p>mongoDB\u7684\u542f\u52a8\u53c2\u6570\u6709\u5f88\u591a\uff0c\u5305\u62ec\uff1a</p> <pre><code>--quiet                # \u5b89\u9759\u8f93\u51fa\n--port arg             # \u6307\u5b9a\u670d\u52a1\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u7aef\u53e327017\n--bind_ip arg          # \u7ed1\u5b9a\u670d\u52a1IP\uff0c\u82e5\u7ed1\u5b9a127.0.0.1\uff0c\u5219\u53ea\u80fd\u672c\u673a\u8bbf\u95ee\uff0c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u672c\u5730\u6240\u6709IP\n--logpath arg          # \u6307\u5b9aMongoDB\u65e5\u5fd7\u6587\u4ef6\uff0c\u6ce8\u610f\u662f\u6307\u5b9a\u6587\u4ef6\u4e0d\u662f\u76ee\u5f55\n--logappend            # \u4f7f\u7528\u8ffd\u52a0\u7684\u65b9\u5f0f\u5199\u65e5\u5fd7\n--pidfilepath arg       # PID File \u7684\u5b8c\u6574\u8def\u5f84\uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c\u5219\u6ca1\u6709 PID\u6587\u4ef6\n--keyFile arg          # \u96c6\u7fa4\u7684\u79c1\u94a5\u7684\u5b8c\u6574\u8def\u5f84\uff0c\u53ea\u5bf9\u4e8eReplica Set\u67b6\u6784\u6709\u6548\n--unixSocketPrefix arg # UNIX\u57df\u5957\u63a5\u5b57\u66ff\u4ee3\u76ee\u5f55(\u9ed8\u8ba4\u4e3a /tmp)\n--fork                 # \u4ee5\u5b88\u62a4\u8fdb\u7a0b\u7684\u65b9\u5f0f\u8fd0\u884cMongoDB\uff0c\u521b\u5efa\u670d\u52a1\u5668\u8fdb\u7a0b\n--auth                 # \u542f\u7528\u9a8c\u8bc1\n--cpu                  # \u5b9a\u671f\u663e\u793aCPU\u7684\u5229\u7528\u7387\u548ciowait\n--dbpath arg           # \u6307\u5b9a\u6570\u636e\u5e93\u8def\u5f84\n--diaglog arg          # diaglog\u9009\u9879\uff1a0=off,1=W,2=R,3=both,7=W+some reads\n--directoryperdb       # \u8bbe\u7f6e\u6bcf\u4e2a\u6570\u636e\u5e93\u5c06\u88ab\u4fdd\u5b58\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u76ee\u5f55\n--journal              # \u542f\u7528\u65e5\u5fd7\u9009\u9879\uff0cMongoDB\u7684\u6570\u636e\u64cd\u4f5c\u5c06\u4f1a\u5199\u5165\u5230journal\u6587\u4ef6\u5939\u7684\u6587\u4ef6\u91cc\n--journalOptions arg   # \u542f\u7528\u65e5\u5fd7\u8bca\u65ad\u9009\u9879\n--ipv6                 # \u542f\u7528IPv6\u9009\u9879\n--jsonp                # \u5141\u8bb8JSONP\u5f62\u5f0f\u901a\u8fc7HTTP\u8bbf\u95ee\uff08\u6709\u5b89\u5168\u5f71\u54cd\uff09\n--maxConns arg         # \u6700\u5927\u540c\u65f6\u8fde\u63a5\u6570\uff0c\u9ed8\u8ba42000\n--noauth               # \u4e0d\u542f\u7528\u9a8c\u8bc1\n--nohttpinterface      # \u5173\u95edHTTP\u63a5\u53e3\uff0c\u9ed8\u8ba4\u5173\u95ed27018\u7aef\u53e3\u8bbf\u95ee\n--noprealloc           # \u7981\u7528\u6570\u636e\u6587\u4ef6\u9884\u5206\u914d(\u5f80\u5f80\u5f71\u54cd\u6027\u80fd)\n--noscripting          # \u7981\u7528\u811a\u672c\u5f15\u64ce\n--notablescan          # \u4e0d\u5141\u8bb8\u8868\u626b\u63cf\n--nounixsocket         # \u7981\u7528Unix\u5957\u63a5\u5b57\u76d1\u542c\n--nssize arg (=16)     # \u8bbe\u7f6e\u4fe1\u6570\u636e\u5e93.ns\u6587\u4ef6\u5927\u5c0f(MB)\n--objcheck             # \u5728\u6536\u5230\u5ba2\u6237\u6570\u636e\uff0c\u68c0\u67e5\u6709\u6548\u6027\n--profile arg          # \u6863\u6848\u53c2\u6570\uff1a0=off, 1=slow, 2=all\n--quota                # \u9650\u5236\u6bcf\u4e2a\u6570\u636e\u5e93\u7684\u6587\u4ef6\u6570\uff0c\u8bbe\u7f6e\u9ed8\u8ba4\u4e3a8\n--quotaFiles arg       # \u9650\u5236\u5355\u4e2a\u6570\u636e\u5e93\u5141\u8bb8\u7684\u6587\u4ef6\n--rest                 # \u5f00\u542f\u7b80\u5355\u7684 Rest API\n--repair               # \u4fee\u590d\u6240\u6709\u6570\u636e\u5e93\uff0c\u5982run repair on all dbs\n--repairpath arg       # \u4fee\u590d\u751f\u6210\u7684\u6587\u4ef6\u76ee\u5f55,\u9ed8\u8ba4\u4e3a\u76ee\u5f55\u540d\u79f0dbpath\n--slowms arg (=100)    # profile\u548c\u65e5\u5fd7\u8f93\u51fa\u5ef6\u8fdf\n--smallfiles            # \u4f7f\u7528\u8f83\u5c0f\u7684\u9ed8\u8ba4\u6587\u4ef6\n--syncdelay arg (=60)  # \u6570\u636e\u5199\u5165\u78c1\u76d8\u7684\u65f6\u95f4\u79d2\u6570(0=never,\u4e0d\u63a8\u8350)\n--sysinfo              # \u6253\u5370\u4e00\u4e9b\u8bca\u65ad\u7cfb\u7edf\u4fe1\u606f\n--upgrade              # \u5347\u7ea7\u6570\u636e\u5e93\uff0c* Replicaton \u53c2\u6570\n--------------------------------------------------------------------------------\n--fastsync # \u4ece\u4e00\u4e2adbpath\u91cc\u542f\u7528\u4ece\u5e93\u590d\u5236\u670d\u52a1\uff0c\u8be5dbpath\u7684\u6570\u636e\u5e93\u662f\u4e3b\u5e93\u7684\u5feb\u7167\uff0c\u53ef\u7528\u4e8e\u5feb\u901f\u542f\u7528\u540c\u6b65\n--autoresync       # \u5982\u679c\u4ece\u5e93\u4e0e\u4e3b\u5e93\u540c\u6b65\u6570\u636e\u5dee\u5f97\u591a\uff0c\u81ea\u52a8\u91cd\u65b0\u540c\u6b65\n--oplogSize arg   # \u8bbe\u7f6eoplog \u7684\u5927\u5c0f(MB), * \u4e3b/\u4ece\u53c2\u6570\n--------------------------------------------------------------------------------\n--master          # \u4e3b\u5e93\u6a21\u5f0f\n--slave           # \u4ece\u5e93\u6a21\u5f0f\n--source arg      # \u4ece\u5e93\u7aef\u53e3\u53f7\n--only arg        # \u6307\u5b9a\u5355\u4e00\u7684\u6570\u636e\u5e93\u590d\u5236\n--slavedelay arg  # \u8bbe\u7f6e\u4ece\u5e93\u540c\u6b65\u4e3b\u5e93\u7684\u5ef6\u8fdf\u65f6\u95f4, * Replica set\uff08\u526f\u672c\u96c6\uff09\u9009\u9879\n--------------------------------------------------------------------------------\n--replSet arg     # \u8bbe\u7f6e\u526f\u672c\u96c6\u540d\u79f0,  * Sharding(\u5206\u7247)\u9009\u9879\n--------------------------------------------------------------------------------\n--configsvr       # \u58f0\u660e\u8fd9\u662f\u4e00\u4e2a\u96c6\u7fa4\u7684config\u670d\u52a1,\u9ed8\u8ba4\u7aef\u53e327019\uff0c\u9ed8\u8ba4\u76ee\u5f55/data/configdb\n--shardsvr        # \u58f0\u660e\u8fd9\u662f\u4e00\u4e2a\u96c6\u7fa4\u7684\u5206\u7247,\u9ed8\u8ba4\u7aef\u53e327018\n--noMoveParanoia  # \u5173\u95ed\u504f\u6267\u4e3amoveChunk\u6570\u636e\u4fdd\u5b58\n</code></pre> <p>\u4e0a\u8ff0\u53c2\u6570\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728mongod.conf\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\uff0c\u4f8b\u5982\uff1a</p> <pre><code>dbpath = /data/mongodb\nlogpath = /data/mongodb/mongodb.log\nlogappend = true\nport = 27017\nfork = true\nauth = true\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#3\u76f8\u5173\u8d44\u6e90_1","title":"3.\u76f8\u5173\u8d44\u6e90","text":"<p>MongoDB\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>MongoDB\u5b98\u7f51\uff1ahttps://www.mongodb.org</li> <li>MongoDB\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/mongo/</li> <li>MongoDB\u5b98\u65b9\u955c\u50cf\u5b9e\u73b0\uff1ahttps://github.com/docker-library/mongo</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#4-redis","title":"4 Redis","text":"<p>Redis\u662f\u4e00\u4e2a\u5f00\u6e90\uff08BSD\u8bb8\u53ef\uff09\u7684\u57fa\u4e8e\u5185\u5b58\u7684\u6570\u636e\u7ed3\u6784\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528\u4f5c\u6570\u636e\u5e93\u3001\u7f13\u5b58\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002Redis\u4f7f\u7528ANSI C\u5b9e\u73b0\uff0c2013\u5e74\u8d77\u7531Pivotal\u516c\u53f8\u8d44\u52a9\u3002</p> <p>Redis\u7684\u5168\u79f0\u610f\u4e3a\uff1aREmote DIctionary Server\u3002</p> <p>Redis\u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5982string\uff08\u5b57\u7b26\u4e32\uff09\u3001hash\uff08\u6563\u5217\uff09\u3001list\uff08\u5217\u8868\uff09\u3001set\uff08\u96c6\u5408\uff09\u3001sorted set\uff08\u6709\u5e8f\u96c6\u5408\uff09\u4e0e\u8303\u56f4\u67e5\u8be2\u3001bitmaps\u3001hyperloglogs\u548cgeospatial\u7d22\u5f15\u534a\u5f84\u67e5\u8be2\uff0cRedis\u540c\u65f6\u652f\u6301replication\u3001LUA\u811a\u672c\u3001LRU\u9a71\u52a8\u4e8b\u4ef6\u3001\u4e8b\u52a1\u548c\u4e0d\u540c\u7ea7\u522b\u7684\u6301\u4e45\u5316\u652f\u6301\u7b49\uff0c\u901a\u8fc7\u54e8\u5175\u673a\u5236\u548c\u96c6\u7fa4\u673a\u5236\u63d0\u4f9b\u9ad8\u53ef\u7528\u6027\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1\u4f7f\u7528\u5b98\u65b9\u955c\u50cf_2","title":"1.\u4f7f\u7528\u5b98\u65b9\u955c\u50cf","text":"<p>\u7528\u6237\u53ef\u4ee5\u901a\u8fc7docker[container]run\u6307\u4ee4\u76f4\u63a5\u542f\u52a8\u4e00\u4e2aredis-container\u5bb9\u5668\uff1a</p> <pre><code>$ docker run --name redis-container -d redis\n6f7d16f298e9c505f35ae28b61b4015877a5b0b75c60797fa4583429e4a14e24\n</code></pre> <p>\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7docker ps\u6307\u4ee4\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684redis-container\u5bb9\u5668\u7684\u5bb9\u5668ID\uff1a</p> <pre><code>[root@desktop-pmjtngi mongodb]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n4a910eb38557        redis               \"docker-entrypoint.s\u2026\"   9 seconds ago       Up 7 seconds        6379/tcp            redis-container\n</code></pre> <p>\u4e0b\u9762\uff0c\u5728\u6b64redis\u5bb9\u5668\u542f\u52a8bash\uff0c\u5e76\u67e5\u770b\u5bb9\u5668\u7684\u8fd0\u884c\u65f6\u95f4\u548c\u5185\u5b58\u72b6\u51b5\uff1a</p> <pre><code>$ docker exec -it 4a910e /bin/bash\nroot@3010492a16cd:/# uptime\n 08:29:53 up  5:16,  0 users,  load average: 0.03, 0.11, 0.09\nroot@3010492a16cd:/# free\n              total        used        free      shared  buff/cache   available\nMem:         995732      275488      230920        2692      489324      568320\nSwap:       2097148       52992     2044156\n</code></pre> <p>\u540c\u6837\uff0c\u53ef\u4ee5\u901a\u8fc7env\u6307\u4ee4\u67e5\u770b\u73af\u5883\u53d8\u91cf\u7684\u914d\u7f6e\uff1a</p> <pre><code>root@4a910eb38557:/data# env\nHOSTNAME=4a910eb38557\nREDIS_DOWNLOAD_SHA=53d0ae164cd33536c3d4b720ae9a128ea6166ebf04ff1add3b85f1242090cb85\nPWD=/data\nHOME=/root\nREDIS_VERSION=5.0.9\nGOSU_VERSION=1.12\nTERM=xterm\nREDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-5.0.9.tar.gz\nSHLVL=1\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n_=/usr/bin/env\n</code></pre> <p>\u7528\u6237\u4e5f\u53ef\u4ee5\u901a\u8fc7ps\u6307\u4ee4\u67e5\u770b\u5f53\u524d\u5bb9\u5668\u8fd0\u884c\u7684\u8fdb\u7a0b\u4fe1\u606f\uff1a</p> <pre><code>root@6f7d16f298e9:/data# ps -ef\nUID        PID  PPID  C STIME TTY          TIME CMD\nredis        1     0  0 12:16 ?        00:00:02 redis-server *:6379\nroot        30     0  0 12:51 ?        00:00:00 sh\nroot        39    30  0 12:52 ?        00:00:00 ps -ef\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1\u8fde\u63a5redis\u5bb9\u5668","title":"1.\u8fde\u63a5Redis\u5bb9\u5668","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528--link\u53c2\u6570\uff0c\u8fde\u63a5\u521b\u5efa\u7684redis-container\u5bb9\u5668\uff1a</p> <pre><code>[root@desktop-pmjtngi mongodb]# docker run -it --link redis-container:db alpine sh\n/ # ls\nbin    dev    etc    home   lib    media  mnt    opt    proc   root   run    sbin   srv    sys    tmp    usr    var\n/ # ping db\nPING db (172.17.0.2): 56 data bytes\n64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.288 ms\n64 bytes from 172.17.0.2: seq=1 ttl=64 time=0.075 ms\n64 bytes from 172.17.0.2: seq=2 ttl=64 time=0.085 ms\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528nc\u6307\u4ee4\uff08\u5373NetCat\uff09\u68c0\u6d4bRedis\u670d\u52a1\u7684\u53ef\u7528\u6027\uff1a</p> <pre><code>/ # nc db 6379\nPING\n+PONG\n</code></pre> <p>\u5b98\u65b9\u955c\u50cf\u5185\u4e5f\u81ea\u5e26\u4e86Redis\u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u6307\u4ee4\u76f4\u63a5\u4f7f\u7528\uff1a</p> <pre><code>[root@desktop-pmjtngi mongodb]# docker run -it --link redis-container:db --entrypoint redis-cli redis -h db\ndb:6379&gt; ping\nPONG\ndb:6379&gt; set 1 2\nOK\ndb:6379&gt; get 1\n\"2\"\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2\u4f7f\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e","title":"2.\u4f7f\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e","text":"<p>\u5982\u679c\u9700\u8981\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684Redis\u914d\u7f6e\uff0c\u6709\u4ee5\u4e0b\u4e24\u79cd\u64cd\u4f5c\uff1a</p> <p>\u00b7\u901a\u8fc7Dockerfile\u6784\u5efa\u81ea\u5b9a\u4e49\u955c\u50cf\uff1b</p> <p>\u00b7\u4f7f\u7528\u6570\u636e\u5377\u3002</p> <p>\u4e0b\u9762\u9996\u5148\u4ecb\u7ecd\u7b2c\u4e00\u79cd\u65b9\u5f0f\u3002\u9996\u5148\uff0c\u65b0\u5efa\u9879\u76ee\u76ee\u5f55\u5e76\u65b0\u5efaDockerfile\u6587\u4ef6\uff1a</p> <pre><code>FROM redis\nRUN mkdir -p /var/lib/redis &amp;&amp; mkdir -p /usr/local/etc/redis &amp;&amp; mkdir -p /var/run/redis &amp;&amp; chmod 777 /var/run/redis &amp;&amp; chown -R 999 /var/run/redis &amp;&amp; chmod 777 /var/lib/redis &amp;&amp; chown -R999 /var/lib/redis\nCOPY redis.conf /usr/local/etc/redis/redis.conf\nCMD [ \"redis-server\", \"/usr/local/etc/redis/redis.conf\" ]\n</code></pre> <p><code>redis.conf</code>\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>root@3010492a16cd:/# cat /etc/redis/redis.conf | grep -v \"^#\"|sed '/^$/d'   \nprotected-mode no\nport 6379\ntcp-backlog 511\nunixsocket /var/run/redis/redis-server.sock\nunixsocketperm 777\ntimeout 0\ntcp-keepalive 300\ndaemonize no\nsupervised no\npidfile /var/run/redis/redis-server.pid\nloglevel notice\ndatabases 16\nalways-show-logo yes\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir /var/lib/redis\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nslave-priority 100\nlazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del no\nslave-lazy-flush no\nappendonly no\nappendfilename \"appendonly.aof\"\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\naof-use-rdb-preamble no\nlua-time-limit 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events \"\"\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-size -2\nlist-compress-depth 0\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\n</code></pre> <p>\u7136\u540e\u53ef\u4ee5\u4f7f\u7528docker build\u6307\u4ee4\uff0c\u6784\u5efa\u4f7f\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e\u7684Redis\u955c\u50cf\u3002</p> <pre><code>$ docker build -t redis-con .\n$ docker run --name redis-container -d redis-con\n009dac31534c676070855219a7ab9b8d690ff9c1c792507af1b7489646e3e92f\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n009dac31534c        redis-con           \"docker-entrypoint.s\u2026\"   2 seconds ago       Up 1 second         6379/tcp            redis-container\n</code></pre> <p>\u5982\u679c\u4f7f\u7528\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff0c\u5373\u901a\u8fc7\u6570\u636e\u5377\u5b9e\u73b0\u81ea\u5b9a\u4e49Redis\u914d\u7f6e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6307\u4ee4\u5b8c\u6210\uff1a</p> <pre><code>$ docker run -v /myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf --name myredis redis redis-server /usr/local/etc/redis/redis.conf\n</code></pre> <p>\u53c2\u8003\u6587\u732e docker\u5c01\u88c5redis\u955c\u50cf</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2\u76f8\u5173\u8d44\u6e90","title":"2.\u76f8\u5173\u8d44\u6e90","text":"<p>Redis\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Redis\u5b98\u65b9\u7f51\u7ad9\uff1ahttp://redis.io/</li> <li>Redis\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/redis/</li> <li>Redis\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/docker-library/redis</li> </ul>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#5-cassandra","title":"5 Cassandra","text":"<p>Apache Cassandra\u662f\u4e2a\u5f00\u6e90\uff08Apache License 2.0\uff09\u7684\u5206\u5e03\u5f0f\u6570\u636e\u5e93\uff0c\u652f\u6301\u5206\u5e03\u5f0f\u9ad8\u53ef\u7528\u6570\u636e\u5b58\u50a8\uff0c\u53ef\u4ee5\u63d0\u4f9b\u8de8\u6570\u636e\u4e2d\u5fc3\u7684\u5bb9\u9519\u80fd\u529b\u4e14\u65e0\u5355\u70b9\u6545\u969c\uff0c \u5e76\u901a\u8fc7\u5f02\u6b65\u65e0\u4e3b\u590d\u5236\u5b9e\u73b0\u6240\u6709\u5ba2\u6237\u7aef\u7684\u4f4e\u5ef6\u8fdf\u64cd\u4f5c\u3002Cassandra\u5728\u8bbe\u8ba1\u4e0a\u5f15\u5165\u4e86P2P\u6280\u672f\uff0c\u5177\u5907\u5927\u89c4\u6a21\u53ef\u5206\u533a\u884c\u5b58\u50a8\u80fd\u529b\uff0c\u5e76\u652f\u6301Spark\u3001Storm\u3001Hadoop\u7cfb\u7edf\u96c6\u6210\u3002 \u76ee\u524dFacebook\u3001Twitter\u3001Instagram\u3001eBay\u3001Github\u3001Reddit\u3001Netflix\u7b49\u591a\u5bb6\u516c\u53f8\u90fd\u5728\u4f7f\u7528Cassandra\u3002\u7c7b\u4f3c\u7cfb\u7edf\u8fd8\u6709HBase\u7b49\u3002</p>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#1\u4f7f\u7528\u5b98\u65b9\u955c\u50cf_3","title":"1.\u4f7f\u7528\u5b98\u65b9\u955c\u50cf","text":"<p>\u9996\u5148\u53ef\u4ee5\u4f7f\u7528docker run\u6307\u4ee4\u57fa\u4e8eCassandra\u5b98\u65b9\u955c\u50cf\u542f\u52a8\u5bb9\u5668\uff1a</p> <pre><code>$ docker run --name my-cassandra -d cassandra:latest\n1dde81cddc53322817f8c6e67022c501759d8d187a2de40f1a25710a5f2dfa53\n</code></pre> <p>\u8fd9\u91cc\u7684--name\u6807\u7b7e\u6307\u5b9a\u5bb9\u5668\u540d\u79f0\u3002cassandra\uff1atag\u4e2d\u7684\u6807\u7b7e\u6307\u5b9a\u7248\u672c\u53f7\uff0c\u6807\u7b7e\u540d\u79f0\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u4ed3\u5e93\u7684\u6807\u7b7e\u8bf4\u660e\uff1ahttps://hub.docker.com/r/library/cassandra/tags/ \u3002</p> <p>\u4e4b\u540e\u7528\u6237\u53ef\u4ee5\u5c06\u53e6\u4e00\u4e2a\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u4e0eCassandra\u5bb9\u5668\u8fde\u63a5\u8d77\u6765\u3002\u6b64\u5e94\u7528\u5bb9\u5668\u8981\u66b4\u9732Cassandra\u9700\u8981\u4f7f\u7528\u7684\u7aef\u53e3\uff08Cassandra\u9ed8\u8ba4\u670d\u52a1\u7aef\u53e3rpc_port\uff1a9160\uff1bCQL\u9ed8\u8ba4\u672c\u5730\u670d\u52a1\u7aef\u53e3native_transport_port\uff1a9042\uff09\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u5bb9\u5668link\u529f\u80fd\u6765\u8fde\u63a5Cassandra\u5bb9\u5668\u4e0e\u5e94\u7528\u5bb9\u5668\u3002</p> <pre><code>$ docker run --name my-app --link my-cassandra:cassandra -d app-that-uses-cassandra\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#2\u642d\u5efacassandra\u96c6\u7fa4","title":"2.\u642d\u5efaCassandra\u96c6\u7fa4","text":"<p>Cassandra\u6709\u4e24\u79cd\u96c6\u7fa4\u6a21\u5f0f\uff1a</p> <p>\u5355\u673a\u6a21\u5f0f\uff08\u6240\u6709\u5b9e\u4f8b\u96c6\u4e2d\u4e8e\u4e00\u53f0\u673a\u5668\uff09\u548c\u591a\u673a\u6a21\u5f0f\uff08\u5b9e\u4f8b\u5206\u5e03\u4e8e\u591a\u53f0\u673a\u5668\uff09\u3002\u5355\u673a\u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u6309\u7167\u4e0a\u6587\u63cf\u8ff0\u7684\u65b9\u6cd5\u542f\u52a8\u5bb9\u5668\u5373\u53ef\uff0c\u5982\u679c\u9700\u8981\u542f\u52a8\u66f4\u591a\u5b9e\u4f8b\uff0c\u5219\u9700\u8981\u5728\u6307\u4ee4\u4e2d\u914d\u7f6e\u9996\u4e2a\u5b9e\u4f8b\u4fe1\u606f\uff1a</p> <pre><code>$ docker run --name my-cassandra2 -d -e CASSANDRA_SEEDS=\"$(docker inspect --format='{{ .NetworkSettings.IPAddress }}' my-cassandra)\" cassandra:latest\n</code></pre> <p>\u5176\u4e2dmy-cassandra\u5c31\u662f\u9996\u4e2aCassandra Server\u7684\u5b9e\u4f8b\u540d\u79f0\u3002\u5728\u8fd9\u91cc\u4f7f\u7528\u4e86docker[container]inspect\u6307\u4ee4\uff0c\u4ee5\u83b7\u53d6\u9996\u4e2a\u5b9e\u4f8b\u7684IP\u5730\u5740\u4fe1\u606f\u3002\u8fd8\u53ef\u4ee5\u4f7f\u7528docker run\u7684--link\u6807\u7b7e\u6765\u8fde\u63a5\u8fd9\u4e24\u4e2aCassandra\u5b9e\u4f8b\uff1a</p> <pre><code>$ docker run --name my-cassandra2 -d --link my-cassandra:cassandra cassandra:latest\n</code></pre> <p>\u591a\u673a\u6a21\u5f0f\u4e0b\uff0c\u7531\u4e8e\u5bb9\u5668\u7f51\u7edc\u57fa\u4e8eDocker bridge\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7\u73af\u5883\u53d8\u91cf\uff0c\u914d\u7f6eCassandra Server\u5bb9\u5668\u7684IP\u5e7f\u64ad\u5730\u5740\uff08\u5373\u4f7f\u7528-e\u6807\u7b7e\uff09\u3002\u5047\u8bbe\u7b2c\u4e00\u53f0\u865a\u62df\u673a\u7684IP\u662f10.22.22.22\uff0c\u7b2c\u4e8c\u53f0\u865a\u62df\u673a\u7684IP\u662f10.23.23.23\uff0cGossip\u7aef\u53e3\u662f7000\uff0c\u90a3\u4e48\u542f\u52a8\u7b2c\u4e00\u53f0\u865a\u62df\u673a\u4e2d\u7684Cassandra\u5bb9\u5668\u65f6\u7684\u6307\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>$ docker run --name my-cassandra -d -e CASSANDRA_BROADCAST_ADDRESS=10.42.42.42 -p 7000:7000 cassandra:latest\n</code></pre> <p>\u542f\u52a8\u7b2c\u4e8c\u53f0\u865a\u62df\u673a\u7684Cassandra\u5bb9\u5668\u65f6\uff0c\u540c\u6837\u9700\u8981\u66b4\u9732Gossip\u7aef\u53e3\uff0c\u5e76\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u58f0\u660e\u7b2c\u4e00\u53f0Cassandra\u5bb9\u5668\u7684IP\u5730\u5740\uff1a</p> <pre><code>$ docker run --name my-cassandra -d -e CASSANDRA_BROADCAST_ADDRESS=10.43.43.43 -p 7000:7000 -e CASSANDRA_SEEDS=10.42.42.42 cassandra:latest\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#3\u4f7f\u7528cqlsh\u8fde\u63a5\u81f3cassandra","title":"3.\u4f7f\u7528cqlsh\u8fde\u63a5\u81f3Cassandra","text":"<p>cqlsh\u662f\u6307Cassandra Query Language Shell\u3002\u5728Cassandra 1.x\u7248\u540e\uff0c\u9664\u4e86cassandra-cli\u4e4b\u5916\uff0c\u5b98\u65b9\u5728/cassandra_install_folder/bin\u91cc\u52a0\u5165\u4e86cqlsh\u6307\u4ee4\u3002\u8be5\u6307\u4ee4\u4e0ecassandra-cli\u4e00\u6837\uff0c\u662fclient\u7aef\u5de5\u5177\uff0c\u5b83\u53ef\u8054\u673a\u81f3server\u7aef\u8fdb\u884c\u6570\u636e\u7ef4\u62a4\u4e0e\u67e5\u8be2\u3002cqlsh\u652f\u6301CQL\u64cd\u4f5c\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5730\u7ef4\u62a4\u6570\u636e\u3002</p> <p>\u4ee5\u4e0b\u6307\u4ee4\u542f\u52a8\u4e86\u4e00\u4e2aCassandra\u5bb9\u5668\u5e76\u8fd0\u884ccqlsh\uff1a</p> <pre><code>$ docker run -it --link my-cassandra:cassandra --rm cassandra sh -c 'exec cqlsh \"$CASSANDRA_PORT_9042_TCP_ADDR\"'\nConnected to Test Cluster at 172.17.0.4:9042.\n[cqlsh 5.0.1 | Cassandra 3.7 | CQL spec 3.4.2 | Native protocol v4]\nUse HELP for help.\ncqlsh&gt; CREATE KEYSPACE demodb WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 1 } AND durable_writes = true;\ncqlsh&gt; USE demodb;\ncqlsh:demodb&gt; desc demodb;\nCREATE KEYSPACE demodb WITH replication = {'class': 'SimpleStrategy', 'replication_factor': '1'}  AND durable_writes = true;\n</code></pre> <p>\u6216\u8005\u5982\u4e0b\u65b9\u5f0f\uff0cmy-cassandra\u662f\u6211\u4eec\u7684Cassandra Server\u5bb9\u5668\u7684name\uff1a</p> <pre><code>$ docker run -it --link my-cassandra:cassandra --rm cassandra cqlsh cassandra\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#4\u8bbf\u95ee\u7cfb\u7edf\u4e0e\u65e5\u5fd7","title":"4.\u8bbf\u95ee\u7cfb\u7edf\u4e0e\u65e5\u5fd7","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528docker exec\u6307\u4ee4\u76f4\u63a5\u8bbf\u95eeCassandra\u7cfb\u7edf\uff0c\u4ee5\u4e0b\u6307\u4ee4\u4f1a\u5728Cassandra\u5bb9\u5668\u4e2d\u5f00\u542fbash shell\uff1a</p> <pre><code>$ docker exec -it my-cassandra bash\nroot@1dde81cddc53:/# ls -l /etc/cassandra/\ntotal 100\n-rw-r--r-- 1 cassandra cassandra 11636 Jul 28 22:10 cassandra-env.sh\n-rw-r--r-- 1 cassandra cassandra  1200 Jun  6 18:50 cassandra-rackdc.properties\n-rw-r--r-- 1 cassandra cassandra  1358 Jun  6 18:50 cassandra-topology.properties\n-rw-r--r-- 1 cassandra cassandra 49826 Aug 30 04:35 cassandra.yaml\n-rw-r--r-- 1 cassandra cassandra  2082 Jun  6 18:50 commitlog_archiving.properties\n-rw-r--r-- 1 cassandra cassandra  9074 Jun  6 18:50 jvm.options\n-rw-r--r-- 1 cassandra cassandra  1193 Jun  6 18:50 logback-tools.xml\n-rw-r--r-- 1 cassandra cassandra  3785 Jun  6 18:50 logback.xml\ndrwxr-xr-x 2 cassandra cassandra  4096 Aug 30 04:35 triggers\n</code></pre> <p>\u4f7f\u7528docker logs\u6307\u4ee4\u8bbf\u95ee\u65e5\u5fd7\uff1a</p> <pre><code>$ docker logs my-cassandra\nocker logs my-cassandra\nINFO  04:35:36 Configuration location: file:/etc/cassandra/cassandra.yaml\n...\nINFO  04:35:37 DiskAccessMode 'auto' determined to be mmap, indexAccessMode is mmap\nINFO  04:35:37 Global memtable on-heap threshold is enabled at 245MB\nINFO  04:35:37 Global memtable off-heap threshold is enabled at 245MB\nWARN  04:35:37 Only 56.105GiB free across all data volumes. Consider adding more capacity to your cluster or removing obsolete snapshots\nINFO  04:35:38 Hostname: 1dde81cddc53\nINFO  04:35:38 JVM vendor/version: OpenJDK 64-Bit Server VM/1.8.0_91\nINFO  04:35:38 HeapINFO  04:36:08 Starting listening for CQL clients on /0.0.0.0:9042 (unencrypted)...\nINFO  04:36:08 Not starting RPC server as requested. Use JMX (StorageService-&gt;startRPCServer()) or nodetool (enablethrift) to start it\nINFO  04:36:10 Scheduling approximate time-check task with a precision of 10 milliseconds\nINFO  04:36:10 Created default superuser role 'cassandra'\nINFO  05:08:21 ConcurrentMarkSweep GC in 201ms.  CMS Old Gen: 32959928 -&gt; 11374920; Code Cache: 13636096 -&gt; 13633792; Metaspace: 38164344 -&gt; 38164408;\nINFO  05:13:32 Create new Keyspace: KeyspaceMetadata{name=demodb, params=KeyspaceParams{durable_writes=true, replication=ReplicationParams{class=org.apache.cassandra.locator.SimpleStrategy, replication_factor=1}}, tables=[], views=[], functions=[], types=[]}size: 980.000MiB/980.000MiB\n...\n</code></pre>"},{"location":"Docker/2.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/#5\u76f8\u5173\u8d44\u6e90","title":"5.\u76f8\u5173\u8d44\u6e90","text":"<p>Cassandra\u7684\u76f8\u5173\u8d44\u6e90\u5982\u4e0b\uff1a</p> <ul> <li>Cassandra\u5b98\u7f51\uff1ahttp://cassandra.apache.org/</li> <li>Cassandra\u5b98\u65b9\u6587\u6863\uff1ahttp://docs.datastax.com/</li> <li>Cassandra\u5b98\u65b9\u4ed3\u5e93\uff1ahttps://github.com/apache/cassandra</li> <li>Cassandra\u5b98\u65b9\u955c\u50cf\uff1ahttps://hub.docker.com/_/cassandra/</li> <li>Cassandra\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff1ahttps://github.com/docker-library/cassandra</li> </ul>"},{"location":"Docker/3.Devops/1.confcenter-docker/","title":"1.confcenter-docker","text":"<p>\u90e8\u7f72Web\u7248\u672c\u914d\u7f6e\u4e2d\u5fc3\uff0c\u914d\u7f6e\u4e2d\u5fc3code+\u6587\u4ef6\u670d\u52a1\u5668\uff0cdocker\u90e8\u7f72\u65b9\u5f0f</p> <p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93</p> <p>\u53c2\u8003\u6587\u732e</p> <p>https://gitee.com/hujianli94net/confcenter-docker.git</p>"},{"location":"Docker/3.Devops/10.redis-docker/","title":"10.redis-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/11.nexus3-docker/","title":"11.nexus3-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/12.openvpn-docker/","title":"12.openvpn-docker.md","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/13.nfs-docker/","title":"13.nfs-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/14.jumpserver-docker/","title":"14.jumpserver-docker.md","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u5730\u5740</p> <p>Github\u5730\u5740</p>"},{"location":"Docker/3.Devops/15.ansible-docker/","title":"15.ansible-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/16.minio-docker/","title":"16.minio-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/17.vaultwarden-docker/","title":"17.vaultwarden-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/18.kasm-docker/","title":"18.kasm-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/19.nginx-docker/","title":"19.nginx-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/2.simaple-jenkins/","title":"2.simaple-jenkins","text":"<p>\u5728\u672c\u5730\u5feb\u901f\u90e8\u7f72 Jenkins</p> <p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/20.kafka-docker/","title":"20.kafka-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/21.golang-docker/","title":"21.golang-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/22.postgres-docker/","title":"22.postgres-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/23.nginx-download-docker/","title":"23.nginx-download-docker","text":"<p>\u4ed3\u5e93\u5730\u5740:</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/","title":"24.helm\u90e8\u7f72\u5e38\u7528\u670d\u52a1","text":""},{"location":"Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/#1metrics-server","title":"1.metrics-server","text":"<p>\u4ed3\u5e93\u5730\u5740</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/#2kubernetes-dashboard","title":"2.Kubernetes-Dashboard","text":"<p>\u4ed3\u5e93\u5730\u5740</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/24.helm%E9%83%A8%E7%BD%B2%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/#3nfs-subdir-external-provisioner","title":"3.nfs-subdir-external-provisioner","text":"<p>\u4ed3\u5e93\u5730\u5740</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/25.Python%E6%93%8D%E4%BD%9CDocker/","title":"25.Python\u64cd\u4f5cDocker","text":"<p>\u7531\u4e8eDocker\u670d\u52a1\u7aef\u63d0\u4f9b\u4e86REST\u98ce\u683c\u7684API\uff0c\u901a\u8fc7\u5bf9\u8fd9\u4e9bAPI\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5\uff0c\u53ef\u4ee5\u63d0\u4f9b\u7ed9\u5404\u79cd\u5f00\u53d1\u8bed\u8a00\u4f5c\u4e3aDocker\u7684SDK\u3002\u8fd9\u91cc\u4ee5docker-py\u9879\u76ee\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u5728Python\u8bed\u8a00\u4e2d\u5bf9Docker\u76f8\u5173\u8d44\u6e90\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>1.\u5b89\u88c5docker-py</p> <p>docker-py\u9879\u76ee\u662f\u57fa\u4e8ePython\u8bed\u8a00\u7684Docker\u5ba2\u6237\u7aef\uff0c\u4ee3\u7801\u5f00\u6e90\u5728<code>https://github.com/docker/docker-py</code> \u4e0a\u3002</p> <p>\u6700\u65b0\u7684\u7a33\u5b9a\u7248\u672c\u4e5f\u5df2\u7ecf\u63a8\u9001\u5230PyPI\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7pip\u547d\u4ee4\u5feb\u901f\u5b89\u88c5\uff1a <pre><code>$ sudo pip install docker\n</code></pre></p> <p>\u5b89\u88c5\u540e\uff0c\u67e5\u770b\u6e90\u4ee3\u7801\u53ef\u4ee5\u53d1\u73b0\uff0c\u4ee3\u7801\u7ed3\u6784\u5341\u5206\u6e05\u6670\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e86Client\u7c7b\uff0c\u7528\u6765\u5c01\u88c5\u63d0\u4f9b\u7528\u6237\u53ef\u4ee5\u7528Docker\u547d\u4ee4\u6267\u884c\u7684\u5404\u79cd\u64cd\u4f5c\uff0c\u5305\u62ecbuild\u3001run\u3001commit\u3001create_container\u3001info\u7b49\u7b49\u63a5\u53e3\u3002</p> <p>\u5bf9REST\u63a5\u53e3\u7684\u8c03\u7528\u4f7f\u7528\u4e86request\u5e93\u3002\u5bf9\u4e8e\u8fd9\u4e9bAPI\uff0c\u7528\u6237\u4e5f\u53ef\u4ee5\u901a\u8fc7curl\u6765\u8fdb\u884c\u8c03\u7528\u6d4b\u8bd5\u3002</p> <p>2.\u4f7f\u7528\u793a\u4f8b</p> <p>\u6253\u5f00Python\u7684\u7ec8\u7aef\uff0c\u9996\u5148\u521b\u5efa\u4e00\u4e2aDocker\u5ba2\u6237\u7aef\u8fde\u63a5\uff1a <pre><code>$ sudo python\n&gt;&gt;&gt; import docker\n&gt;&gt;&gt; c = docker.DockerClient(base_url='unix://var/run/docker.sock',version='auto', timeout=10)\n</code></pre></p> <p>\u901a\u8fc7info()\u65b9\u6cd5\u67e5\u770bDocker\u7cfb\u7edf\u4fe1\u606f\uff1a <pre><code>&gt;&gt;&gt; c.info()\n{'ID': 'RXBF:A62S:BTI5:...:YAUG:VQ3N', 'Containers': 0, 'ContainersRunning': 0, 'ContainersPaused': 0, 'ContainersStopped': 0, 'Images': 95, 'Driver': 'overlay2', 'DriverStatus': [['Backing Filesystem', 'extfs'],...}\n</code></pre></p> <p>\u901a\u8fc7images\u548ccontainers\u5c5e\u6027\u53ef\u4ee5\u67e5\u770b\u548c\u64cd\u4f5c\u672c\u5730\u7684\u955c\u50cf\u548c\u5bb9\u5668\u8d44\u6e90\uff1a <pre><code>&gt;&gt;&gt; c.images.list()\n[&lt;Image: 'node:slim'&gt;, &lt;Image: 'node:latest'&gt;, &lt;Image: 'docs/docker.github.io:latest'&gt;, ...,]\n</code></pre></p> <p>\u901a\u8fc7create_container()\u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u4e4b\u540e\u542f\u52a8\u5b83\uff1a <pre><code>&gt;&gt;&gt; container = c.containers.create(image='ubuntu:latest', command='bash')\n&gt;&gt;&gt; print(container)\n{u'Id': u'a8439e4c8e64a94a287d408fdc3ff9a0b4a8577fe3b5e32975b790afb41414af', u'Warnings': None}\n&gt;&gt;&gt; container.start()\n</code></pre></p> <p>\u6216\u8005\u66f4\u7b80\u5355\u5730\u901a\u8fc7\u5982\u4e0b\u4ee3\u7801\u76f4\u63a5\u8fd0\u884c\u5bb9\u5668\uff1a <pre><code>import docker\nclient = docker.from_env()\nprint(client.containers.run(\"ubuntu:20.04\", [\"echo\", \"Hello\", \"World\"]))\n</code></pre> \u53ef\u89c1\uff0c\u6240\u63d0\u4f9b\u7684\u65b9\u6cd5\u4e0eDocker\u63d0\u4f9b\u7684\u547d\u4ee4\u5341\u5206\u7c7b\u4f3c\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5728\u4f7f\u7528SDK\u6267\u884cDocker\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u901a\u8fc7Docker\u670d\u52a1\u7aef\u63d0\u4f9b\u7684API\u8fdb\u884c\u4e86\u5c01\u88c5\u3002</p> <p>\u6269\u5c55\u9605\u8bfb</p> <p>http://www.weixueyuan.net/a/723.html</p>"},{"location":"Docker/3.Devops/3.docker-nginx-spa/","title":"3.docker-nginx-spa","text":"<p>\u7528\u4e8e\u4f7f\u7528 nginx \u4e3a\u5355\u9875\u5e94\u7528\u7a0b\u5e8f(\u7eaf\u524d\u7aef javascript)\u63d0\u4f9b\u670d\u52a1\uff0c\u5b83\u652f\u6301 PushState\uff0c\u5e76\u5305\u62ec\u4e00\u79cd\u5728\u8fd0\u884c\u65f6\u4f20\u9012\u914d\u7f6e\u7684\u65b9\u6cd5\u3002</p> <p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/4.fileserver-docker/","title":"4.fileserver-docker","text":"<p>nginx lua \u6587\u4ef6\u4e0a\u4f20\u4e0b\u8f7d\u670d\u52a1\u5668</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/5.haproxy-docker/","title":"5.haproxy-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Dockerfile</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p> <p><code>haproxy.cfg</code></p> <pre><code>global\n  log         127.0.0.1 local0\n  log         127.0.0.1 local1 notice\n  maxconn     20000\n  daemon\n  spread-checks 2\n\ndefaults\n  mode                    http\n  log                     global\n  option                  tcplog\n  option                  dontlognull\n  option http-server-close\n  option                  redispatch\n  timeout http-request    2s\n  timeout queue           3s\n  timeout connect         1s\n  timeout client          1h\n  timeout server          1h\n  timeout http-keep-alive 1h\n  timeout check           2s\n  maxconn                 18000\n#\u914d\u7f6eweb\u63a7\u5236\u53f0\nlisten admin_stats\n        stats   enable\n        bind    *:1080\n        mode    http\n        option  httplog\n        log     global\n        maxconn 10\n        stats   refresh 30s\n        stats   uri /admin\n        stats   realm haproxy\n      #  stats   auth admin:admin\n        stats   hide-version\n        stats   admin if TRUE\n#nginx\nfrontend nginx\n  bind *:80\n  mode tcp\n  tcp-request inspect-delay 5s\n  #tcp-request content reject if !HTTP\n  tcp-request content accept if { req.ssl_hello_type 1 }\n  default_backend nginx\nbackend nginx\n  mode tcp\n  option tcp-check\n  balance roundrobin\n  default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 2500 maxqueue 256 weight 100\n    server nginx116 192.168.200.116:80 check\n    server nginx117 192.168.200.117:80 check\n</code></pre>"},{"location":"Docker/3.Devops/6.mysql-docker/","title":"6.mysql-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/7.frp-docker/","title":"7.frp-docker","text":"<p>\u4ed3\u5e93\u5730\u5740</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/7.frp-docker/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<p>frp+openvpn+docker\u5b9e\u73b0\u5185\u7f51\u7a7f\u900f</p> <p>\u5229\u7528FRP\u548cOpenvpn\u5b9e\u73b0\u5185\u7f51\u7a7f\u900f\u5916\u7f51\u8bbf\u95ee</p>"},{"location":"Docker/3.Devops/7.frp-docker/#\u6700\u5168\u5185\u7f51\u7a7f\u900f\u5de5\u5177","title":"\u6700\u5168\u5185\u7f51\u7a7f\u900f\u5de5\u5177","text":"<p>\u6700\u5168\u5185\u7f51\u7a7f\u900f\u5de5\u5177</p>"},{"location":"Docker/3.Devops/8.coredns-docker/","title":"8.coredns-docker","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93</p> <p>\u53c2\u8003\u6587\u732e</p> <p>Linux\u7f51\u7edc\u5b66\u4e60\u7b14\u8bb0\uff08\u4e8c\uff09\uff1a\u57df\u540d\u89e3\u6790(DNS)\u2014\u2014\u4ee5 CoreDNS \u4e3a\u4f8b</p> <p>coredns\u6cdb\u57df\u540d\u89e3\u6790 \u5355\u57df\u540d\u89e3\u6790</p> <p>\u4f7f\u7528CoreDNS\u5b9e\u73b0\u81ea\u5b9a\u4e49\u57df\u540d\u89e3\u6790</p> <p>gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/9.simple-harbor/","title":"9.simple-harbor","text":"<p>\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>Gitee\u4ed3\u5e93\u5730\u5740</p>"},{"location":"Docker/3.Devops/9.simple-harbor/#\u79bb\u7ebf\u90e8\u7f72-harbor-v2","title":"\u79bb\u7ebf\u90e8\u7f72 harbor v2","text":"<p>Harbor\u662f\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u548c\u5206\u53d1Docker\u955c\u50cf\u7684\u4f01\u4e1a\u7ea7registry\u670d\u52a1\u5668</p> <p>\u955c\u50cf\u5728docker distribution\uff08registry v2\u7248\u672c\uff09\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u5b89\u5168\u3001\u8bbf\u95ee\u63a7\u5236\u3001\u7ba1\u7406\u7684\u529f\u80fd\uff0c\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u5bf9\u4e8e\u955c\u50cf\u4ed3\u5e93\u7684\u9700\u6c42</p> <p>\u79bb\u7ebf\u90e8\u7f72 harbor v2</p> <pre><code>$ wget https://github.com/goharbor/harbor/releases/download/v2.4.2/harbor-online-installer-v2.4.2.tgz\n$ tar -zxf harbor-online-installer-v2.4.2.tgz\n$ diff harbor.yml harbor.yml.tmpl\n5c5\n&lt; hostname: hub.gitee.com\n---\n&gt; hostname: reg.mydomain.com\n10c10\n&lt;   port: 8080\n---\n&gt;   port: 80\n13c13\n&lt; #https:\n---\n&gt; https:\n15c15\n&lt;   #  port: 443\n---\n&gt;   port: 443\n17,18c17,18\n&lt;   #  certificate: /your/certificate/path\n&lt;   #  private_key: /your/private/key/path\n---\n&gt;   certificate: /your/certificate/path\n&gt;   private_key: /your/private/key/path\n29c29\n&lt; external_url: https://hub.gitee.com\n---\n&gt; # external_url: https://reg.mydomain.com:8433\n34c34\n&lt; harbor_admin_password: oschina123\n---\n&gt; harbor_admin_password: Harbor12345\n39c39\n&lt;   password: oschina\n---\n&gt;   password: root123\n47c47\n&lt; data_volume: /data/harbor\n---\n&gt; data_volume: /data\n</code></pre> <p>\u521b\u5efa\u6570\u636e\u6301\u4e45\u5316\u76ee\u5f55 <pre><code>$ mkdir -p /data/harbor\n</code></pre></p> <p>\u5f00\u59cb\u90e8\u7f72 <pre><code>$ sudo ./install.sh --with-chartmuseum\n</code></pre></p> <p>tips</p> <ul> <li>\u90e8\u7f72\u5b8c\u6210\u540e\u5982\u679c\u9700\u8981\u4fee\u6539 harbor.yml \uff0c\u9700\u8981\u5728\u4fee\u6539\u540e\u91cd\u65b0\u521d\u59cb\u5316\u914d\u7f6e\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a</li> </ul> <pre><code>$ docker-compose down -v\n$ vim harbor.yml\n$ sudo ./prepare --with-chartmuseum\n# \u542f\u7528\u540e\uff0c\u9ed8\u8ba4\u9879\u76ee\u5c31\u5e26\u6709helm charts\u529f\u80fd\u4e86\u3002\u6211\u8fd9\u91cc\u521b\u5efa\u4e00\u4e2a\u540d\u4e3alc_chart\u7684\u79c1\u6709\u4ed3\u5e93\u3002\n$ docker-compose up -d\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>harbor\u79c1\u6709\u4ed3\u5e93\u5b89\u88c5</p> <p>\u79bb\u7ebf\u5b89\u88c5 Harbor v2</p> <p>\u4f01\u4e1a\u7ea7\u4ed3\u5e93harbor\u642d\u5efa</p> <p>Harbor \u9ad8\u53ef\u7528\u642d\u5efa(docker-compose)</p> <p>harbor\u642d\u5efa\u4f01\u4e1adocker\u79c1\u6709\u955c\u50cf\u4ed3\u5e93</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/","title":"Go Web\u5f00\u53d1\u5b9e\u6218","text":"<p>\u7cfb\u7edf\u5168\u9762\u7684\u5b66\u4e60Go Web\u7f16\u7a0b</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#\u4e66\u7c4d\u5c01\u9762","title":"\u4e66\u7c4d\u5c01\u9762","text":""},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#\u5185\u5bb9\u76ee\u5f55","title":"\u5185\u5bb9\u76ee\u5f55","text":""},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#1go\u57fa\u7840","title":"1.Go\u57fa\u7840","text":"<p>1.\u5b89\u88c5Go</p> <p>2.\u7b2c\u4e00\u4e2aGo\u7a0b\u5e8f.md</p> <p>3.Go\u57fa\u7840\u8bed\u6cd5</p> <p>4.Go Module\u6559\u7a0b</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#2go-web\u57fa\u7840","title":"2.Go-Web\u57fa\u7840","text":"<p>5.hello World Web</p> <p>6.Web\u7a0b\u5e8f\u8fd0\u884c\u539f\u7406\u7b80\u4ecb</p> <p>7.net-http\u5305</p> <p>8.html-template\u5305</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#3go-web\u8bf7\u6c42\u5904\u7406","title":"3.Go-Web\u8bf7\u6c42\u5904\u7406","text":"<p>9.\u7b80\u5355Go Web\u670d\u52a1\u5668</p> <p>10.\u5904\u7406\u8bf7\u6c42</p> <p>11.\u4e86\u89e3session\u548ccookie</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#4go\u8bbf\u95ee\u6570\u636e\u5e93","title":"4.Go\u8bbf\u95ee\u6570\u636e\u5e93","text":"<p>12.Go\u64cd\u4f5cMySQL</p> <p>13.Go\u64cd\u4f5cRedis</p> <p>14.Go\u64cd\u4f5cMongoDB</p> <p>15.Go\u7684\u5e38\u89c1ORM\u5e93</p> <p>16.Go\u64cd\u4f5cSQLite</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#5go\u9ad8\u7ea7\u7f51\u7edc\u7f16\u7a0b","title":"5.Go\u9ad8\u7ea7\u7f51\u7edc\u7f16\u7a0b","text":"<p>17.Go-Socket\u7f16\u7a0b</p> <p>18.Go-RPC\u7f16\u7a0b</p> <p>19.Go-\u5fae\u670d\u52a1</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#6go\u6587\u4ef6\u5904\u7406","title":"6.Go\u6587\u4ef6\u5904\u7406","text":"<p>20.\u5904\u7406\u76ee\u5f55\u4e0e\u6587\u4ef6</p> <p>21.\u5904\u7406XML\u6587\u4ef6</p> <p>22.\u5904\u7406JSON\u6587\u4ef6</p> <p>23.\u5904\u7406CSV\u6587\u4ef6</p> <p>24.\u5904\u7406\u65e5\u5fd7\u8bb0\u5f55</p> <p>25.\u5904\u7406\u6b63\u5219\u8868\u8fbe\u5f0f</p> <p>26.\u5904\u7406Excel\u6587\u4ef6</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#7go\u5e76\u53d1\u7f16\u7a0b","title":"7.Go\u5e76\u53d1\u7f16\u7a0b","text":"<p>26.\u5e76\u53d1\u4e0e\u5e76\u884c</p> <p>27.\u8fdb\u7a0b \u7ebf\u7a0b\u548c\u534f\u7a0b</p> <p>28.Go\u5e76\u53d1\u6a21\u578b\u7b80\u4ecb</p> <p>29.gogoroutine\u548cchannel\u5b9e\u73b0\u5e76\u53d1</p> <p>30.sync\u5b9e\u73b0\u5e76\u53d1</p> <p>31.Go\u5e76\u53d1\u7684Web\u5e94\u7528</p>"},{"location":"Golang/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Go-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/#8go-restful-api\u63a5\u53e3\u5f00\u53d1","title":"8.Go-RESTful-API\u63a5\u53e3\u5f00\u53d1","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/","title":"\u5b89\u88c5Go","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#1\u8f6f\u4ef6\u5305\u4e0b\u8f7d","title":"1.\u8f6f\u4ef6\u5305\u4e0b\u8f7d","text":"<p>go 1.20.2</p> <p>\u5b98\u7f51\uff1ahttps://go.dev/</p> <p>\u5b98\u7f51\u4e0b\u8f7d\u5730\u5740\uff1ahttps://go.dev/dl/</p> <p>\u4e0b\u8f7d\u94fe\u63a5\uff08Windows\uff09\uff1ahttps://go.dev/dl/go1.20.2.windows-amd64.msi</p> <p>\u4e0b\u8f7d\u94fe\u63a5\uff08maxOS Intel\uff09\uff1ahttps://go.dev/dl/go1.20.2.darwin-amd64.pkg</p> <p>\u4e0b\u8f7d\u94fe\u63a5\uff08maxOS Apple Silicon\uff09\uff1ahttps://go.dev/dl/go1.20.2.darwin-arm64.pkg</p> <p>\u4e0b\u8f7d\u94fe\u63a5\uff08Linux\uff09\uff1ahttps://go.dev/dl/go1.20.2.linux-amd64.tar.gz</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#2windows\u7cfb\u7edf\u4e2d\u5b89\u88c5","title":"2.Windows\u7cfb\u7edf\u4e2d\u5b89\u88c5","text":"<p>\u4e0b\u8f7d\u683c\u5f0f\u4e3aMSI\u7684\u5b89\u88c5\u7a0b\u5e8f\u3002\u53cc\u51fb\u542f\u52a8\u5b89\u88c5\u5e76\u9075\u5faa\u63d0\u793a\u3002\u9ed8\u8ba4\u5728\u4f4d\u7f6eC:\uff0c\u5e76\u4e14\u6dfb\u52a0\u76ee\u5f55C:\u3002</p> <p>\u5982\u679c\u5b89\u88c5\u6587\u4ef6\u662fMSI\u683c\u5f0f\uff0cGo\u8bed\u8a00\u7684\u73af\u5883\u53d8\u91cf\u4f1a\u81ea\u52a8\u8bbe\u7f6e\u5b8c\u6210\u3002</p> <p>\u6211\u4e0b\u8f7d\u7684\u5305\u4e3a\uff1a</p> <p><code>go1.20.2.windows-amd64.msi</code></p> <p>\u65b0\u5efa\u7cfb\u7edf\u53d8\u91cf</p> <p>GOROOT\uff1aGo\u5b89\u88c5\u8def\u5f84\uff08\u4f8b\uff1aD:\\Program Files\\go\uff09\u3002</p> <p>GOPATH\uff1aGo\u5de5\u7a0b\u7684\u8def\u5f84\uff08\u4f8b\uff1aD:\\golang\\go\uff09\u3002\u8bbe\u7f6e\u4e00\u4e2a\u65b0\u7684\u73af\u5883\u53d8\u91cf\u540dGOPATH\uff0c\u53d8\u91cf\u503cD:\\golang\\go</p> <p>\u9700\u8981\u628aGOPATH\u4e2d\u7684\u53ef\u6267\u884c\u76ee\u5f55\u4e5f\u914d\u7f6e\u5230\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u5426\u5219\u81ea\u884c\u4e0b\u8f7d\u7684\u7b2c\u4e09\u65b9Go\u8bed\u8a00\u5de5\u5177\u5c06\u65e0\u6cd5\u4f7f\u7528\u3002</p> <p>Path\uff1a\u5728Path\u4e2d\u589e\u52a0<code>D:\\Program Files\\go\\bin;%GOPATH%\\bin</code></p> <p>\u5de5\u4f5c\u76ee\u5f55\u7528\u6765\u5b58\u653e\u5f00\u53d1\u8005\u7684\u4ee3\u7801\uff0c\u5bf9\u5e94Golang\u91cc\u7684GOPATH\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\u3002\u8be5\u73af\u5883\u53d8\u91cf\u88ab\u6307\u5b9a\u4e4b\u540e\uff0c\u7f16\u8bd1\u6e90\u4ee3\u7801\u6240\u751f\u6210\u7684\u6587\u4ef6\u90fd\u4f1a\u653e\u5230\u6b64\u76ee\u5f55\u4e0b\u3002</p> <p>GOPATH\u4e3b\u8981\u5305\u542b\u4e09\u4e2a\u76ee\u5f55\uff1abin\u3001pkg\u3001src\u3002bin\u76ee\u5f55\u4e3b\u8981\u5b58\u653e\u53ef\u6267\u884c\u6587\u4ef6\uff1b</p> <p>pkg\u76ee\u5f55\u4e3b\u8981\u5b58\u653e\u7f16\u8bd1\u597d\u7684\u5e93\u6587\u4ef6\uff0c\u5982*.a\u6587\u4ef6\uff1b</p> <p>src\u76ee\u5f55\u4e3b\u8981\u5b58\u653eGo\u7684\u6e90\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\u67e5\u770b\u5b89\u88c5\u914d\u7f6e\u662f\u5426\u6210\u529f\uff0c\u4f7f\u7528\u5feb\u6377\u952eWin+R\uff0c\u8f93\u5165cmd\uff0c\u6253\u5f00\u547d\u4ee4\u884c\u63d0\u793a\u7b26\u7a97\u53e3\uff0c\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165go env\uff0c\u67e5\u770b\u914d\u7f6e\u4fe1\u606f\uff0c\u4e0d\u540c\u73af\u5883\u4e0b\u663e\u793a\u4f1a\u7565\u6709\u5dee\u5f02\u3002</p> <pre><code>C:\\Users\\18793&gt;go env\nset GO111MODULE=on\nset GOARCH=amd64\nset GOBIN=\nset GOCACHE=C:\\Users\\18793\\AppData\\Local\\go-build\nset GOENV=C:\\Users\\18793\\AppData\\Roaming\\go\\env\nset GOEXE=.exe\nset GOEXPERIMENT=\nset GOFLAGS=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOINSECURE=\nset GOMODCACHE=D:\\golang\\go\\pkg\\mod\nset GONOPROXY=\nset GONOSUMDB=\nset GOOS=windows\nset GOPATH=D:\\golang\\go\nset GOPRIVATE=\nset GOPROXY=https://goproxy.cn,direct\nset GOROOT=D:\\Program Files\\go\nset GOSUMDB=off\nset GOTMPDIR=\nset GOTOOLDIR=D:\\Program Files\\go\\pkg\\tool\\windows_amd64\nset GOVCS=\nset GOVERSION=go1.20.2\nset GCCGO=gccgo\nset GOAMD64=v1\nset AR=ar\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=0\nset GOMOD=NUL\nset GOWORK=\nset CGO_CFLAGS=-O2 -g\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-O2 -g\nset CGO_FFLAGS=-O2 -g\nset CGO_LDFLAGS=-O2 -g\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -fno-caret-diagnostics -Qunused-arguments -Wl,--no-gc-sections -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\18793\\AppData\\Local\\Temp\\go-build2755047470=/tmp/go-build -gno-record-gcc-switches\n</code></pre> <p>\u8f93\u5165go version\u67e5\u770b\u7248\u672c\u53f7 <pre><code>C:\\Users\\18793&gt;go version\ngo version go1.20.2 windows/amd64\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#3linux\u7cfb\u7edf\u4e2d\u5b89\u88c5","title":"3.Linux\u7cfb\u7edf\u4e2d\u5b89\u88c5","text":"<p>\u8bbf\u95eeGo\u5b98\u65b9\u7f51\u7ad9</p> <p>1.\u4e0b\u8f7d\u5b89\u88c5\u5305</p> <pre><code>$ wget https://golang.google.cn/dl/go1.20.2.linux-amd64.tar.gz\n</code></pre> <p>2.\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u89e3\u538b\u5b89\u88c5\u5305 <pre><code>$ tar zxvf go1.20.2.linux-amd64.tar.gz\n</code></pre></p> <p>3.\u5c06\u201cgo\u201d\u6587\u4ef6\u5939\u79fb\u52a8\u5230\u5e38\u7528\u7684\u76ee\u5f55\u4e0b(/usr/local)\u3002 <pre><code>$ mv ./go /usr/local/\n</code></pre></p> <p>4.\u914d\u7f6ego\u73af\u5883\u53d8\u91cf <pre><code>$ mkdir -p /data/goworkdir/go\n\n$ cat &gt;&gt; /etc/profile &lt;&lt;-'EOF'\nexport GOROOT=/usr/local/go\nexport GOPATH=/data/goworkdir/go\nexport PATH=$PATH:$GOROOT/bin:$GOPATH/bin\nEOF\n</code></pre></p> <p>5.\u8fd0\u884c\u547d\u4ee4\u8ba9\u73af\u5883\u53d8\u91cf\u751f\u6548 <pre><code>$ source /etc/profile\n</code></pre></p> <p>6.\u67e5\u770bgo\u7248\u672c <pre><code>$ go version\ngo version go1.20.2 linux/amd64\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#4mac-os\u7248\u672c\u5b89\u88c5","title":"4.Mac OS\u7248\u672c\u5b89\u88c5","text":"<p>Mac OS\u73af\u5883\u4e0b\uff0c\u4e0b\u8f7d\u683c\u5f0f\u4e3aosx\u7684\u5b89\u88c5\u7a0b\u5e8f\u3002\u53cc\u51fb\u542f\u52a8\u5b89\u88c5\u3002</p> <p>\u6309\u7167\u63d0\u793a\uff0c\u5728/usr/local/go\u4e2d\u5b89\u88c5Golang\uff0c\u5e76\u4e14\u5c06\u6587\u4ef6\u5939/usr/local/go/bin\u6dfb\u52a0\u5230PATH\u73af\u5883\u53d8\u91cf\u4e2d\u3002</p> <p>1\uff0eMac\u7cfb\u7edf\u4e0b\u5b89\u88c5\u53cc\u51fbpkg\u5305\uff0c\u987a\u7740\u6307\u5f15\uff0c\u5373\u53ef\u5b89\u88c5\u6210\u529f\u3002\u5728\u547d\u4ee4\u884c\u8f93\u5165go version\u540e\uff0c\u5982\u679c\u83b7\u53d6\u5230Go\u8bed\u8a00\u7684\u7248\u672c\u53f7\uff0c\u5219\u4ee3\u8868\u5b89\u88c5\u6210\u529f\u3002</p> <p>2\uff0eMac\u7cfb\u7edf\u4e0b\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> <p>\uff081\uff09\u6253\u5f00\u7ec8\u7aef\u8f93\u5165cd ~\u8fdb\u5165\u7528\u6237\u4e3b\u76ee\u5f55\u3002</p> <p>\uff082\uff09\u8f93\u5165ls -all\u547d\u4ee4\u67e5\u770b\u662f\u5426\u5b58\u5728.bash_profile\u3002</p> <p>\uff083\uff09\u4f7f\u7528vim .bash_profile\u6253\u5f00\u6587\u4ef6\u3002</p> <p>\uff084\uff09\u8f93\u5165i\u8fdb\u5165vim\u7f16\u8f91\u6a21\u5f0f\u3002</p> <p>\uff085\uff09\u8f93\u5165\u4e0b\u9762\u4ee3\u7801\uff0c\u5176\u4e2dGOPATH\u662f\u65e5\u5e38\u5f00\u53d1\u7684\u6839\u76ee\u5f55\u3002</p> <p>GOBIN\u662fGOPATH\u4e0b\u7684bin\u76ee\u5f55\u3002</p> <pre><code>export GOPATH=/Users/steven/Documents/go_project\nexport GOROOT= /Usr/local/go\nexport GOBIN=$GOROOT/bin\nexport PATH=$PATH:$GOBIN\n</code></pre> <p>\uff086\uff09\u6309esc\u952e\uff0c\u5e76\u8f93\u5165wq\u4fdd\u5b58\u5e76\u9000\u51fa\u7f16\u8f91\u3002\u53ef\u8f93\u5165vim .bash_profile\u67e5\u770b\u662f\u5426\u4fdd\u5b58\u6210\u529f\u3002</p> <p>\uff087\uff09\u8f93\u5165source ~/.bash_profile\u5b8c\u6210\u5bf9Golang\u73af\u5883\u53d8\u91cf\u7684\u914d\u7f6e\uff0c\u914d\u7f6e\u6210\u529f\u6ca1\u6709\u63d0\u793a\u3002</p> <p>\uff088\uff09\u8f93\u5165go env\u67e5\u770b\u914d\u7f6e\u7ed3\u679c\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#5liteide\u5f00\u6e90\u5f00\u53d1\u5de5\u5177","title":"5.LiteIDE\u5f00\u6e90\u5f00\u53d1\u5de5\u5177","text":"<p>LiteIDE\u662f\u4e00\u6b3e\u5f00\u6e90\u3001\u8de8\u5e73\u53f0\u7684\u8f7b\u91cf\u7ea7 Go \u8bed\u8a00\u96c6\u6210\u5f00\u53d1\u73af\u5883\uff08IDE\uff09\u3002\u5728\u5b89\u88c5LiteIDE\u4e4b\u524d\u4e00\u5b9a\u8981\u5148\u5b89\u88c5Go\u8bed\u8a00\u73af\u5883\u3002LiteIDE\u652f\u6301\u4ee5\u4e0b\u7684\u64cd\u4f5c\u7cfb\u7edf\uff1a</p> <ul> <li>Windows x86 (32-bit or 64-bit)</li> <li>Linux x86 (32-bit or 64-bit)</li> </ul> <p>LiteIDE\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u9014\u5f84\u4e0b\u8f7d\uff1a</p> <ul> <li>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://sourceforge.net/projects/liteide/files/</li> <li>\u6e90\u7801\u5730\u5740\uff1ahttps://github.com/visualfc/liteide</li> </ul> <p>\u7f16\u8bd1-&gt;\u7f16\u8bd1\u914d\u7f6e\uff0c\u8bbe\u7f6e\u7f16\u8bd1\u53c2\u6570\u3002\u5728BUILDARGS\u6dfb\u52a0-gcflags \"-N -l\"\uff0c\u76ee\u7684\u662f\u53bb\u6389\u7f16\u8bd1\u4f18\u5316\uff0c\u65b9\u4fbf\u8c03\u8bd5\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<p>LiteIDE \u5b89\u88c5</p> <p>\u642d\u5efaGo\u8c03\u8bd5\u73af\u5883\uff08LiteIDE)</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#\u5b89\u88c5\u5e38\u7528\u5de5\u5177","title":"\u5b89\u88c5\u5e38\u7528\u5de5\u5177","text":"<pre><code>go install  golang.org/x/lint/golint\ngo install github.com/spf13/cobra-cli@latest\ngo install golang.org/x/tools/cmd/goimports@latest\n.....\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#\u5e38\u7528\u5feb\u6377\u952e","title":"\u5e38\u7528\u5feb\u6377\u952e","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#build","title":"Build","text":"<ul> <li>Build Ctrl+B, F7</li> <li>Build and Run Ctrl+R</li> <li>Build and Run Ctrl+R</li> <li>File Run Alt+F6</li> <li>Run Ctrl+F5</li> <li>Test Ctrl+T</li> <li>Install Ctrl+F8</li> <li>Run in Term Ctrl+Shift+F5</li> </ul>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#debug","title":"Debug","text":"<ul> <li>Debug F5</li> <li>Continue F5</li> <li>Insert/Remove BreakPoint F9</li> <li>Stop Debug Shift+F5</li> <li>Step Info F11</li> <li>Step Over F10</li> <li>Step Out Shift+F11</li> <li>Run to Line Shift+F10</li> </ul>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#6vscode\u914d\u7f6egolang\u73af\u5883","title":"6.Vscode\u914d\u7f6eGolang\u73af\u5883","text":"<p>1\u3001vscode\u63d2\u4ef6\u4e2d\u641c\u7d22<code>go</code>\u5b89\u88c5google\u5b98\u65b9go\u63d2\u4ef6 </p> <p>2\u3001\u7531\u4e8ego\u63d2\u4ef6\u66f4\u65b0\u6536great firewall \u9650\u5236\uff0c\u56e0\u6b64\u9700\u8981\u914d\u7f6ego\u7684\u56fd\u5185\u955c\u50cf</p> <p>\u5148\u6253\u5f00\u7ec8\u7aef\u6267\u884c\u4ee5\u4e0b\u6307\u4ee4\uff0c\u66f4\u65b0\u56fd\u5185\u4ee3\u7406\uff08\u6ce8\u610f\uff1a\u66f4\u65b0\u5b8c\u8bb0\u5f97\u91cd\u542fVSCode\uff09</p> <pre><code>go env -w GO111MODULE=on\ngo env -w GOPROXY=https://proxy.golang.com.cn,direct\n</code></pre> <p>\u7136\u540e\u6253\u5f00Vscode\uff0cWindows\u5e73\u53f0\u6309\u4e0bCtrl+Shift+P\uff0cMac\u5e73\u53f0\u6309Command+Shift+P</p> <p></p> <p>\u6211\u4eec\u5728\u8fd9\u4e2a\u8f93\u5165\u6846\u4e2d\u8f93\u5165&gt;go:install\uff0c\u4e0b\u9762\u4f1a\u81ea\u52a8\u641c\u7d22\u76f8\u5173\u547d\u4ee4\uff0c\u6211\u4eec\u9009\u62e9Go:Install/Update Tools\u8fd9\u4e2a\u547d\u4ee4\uff0c\u6309\u4e0b\u56fe\u9009\u4e2d\u5e76\u4f1a\u56de\u8f66\u6267\u884c\u8be5\u547d\u4ee4\uff08\u6216\u8005\u4f7f\u7528\u9f20\u6807\u70b9\u51fb\u8be5\u547d\u4ee4\uff09\uff0c\u7b49\u5f85\u5168\u90e8\u5b89\u88c5\u6210\u529f\uff01\uff01\uff01</p> <p></p> <p>3\u3001\u4f18\u5316vscode\u8bbe\u7f6e\u81ea\u52a8\u4fdd\u5b58\u4ee3\u7801</p> <p> </p> <p>4\u3001\u6dfb\u52a0\u63d2\u4ef6\uff1acode running\uff0c\u8ba9vscode\u652f\u6301\u4e00\u952e\u76f4\u63a5\u8fd0\u884c\u6211\u4eec\u7684\u4ee3\u7801</p> <p>\u540c\u6837\u7684\u6211\u4eec\u53ef\u4ee5\u53bbVSCode\u7684\u63d2\u4ef6\u6a21\u5757\uff0c\u641c\u7d22code running\u6765\u5b89\u88c5\u63d2\u4ef6</p> <p></p> <p>\u5b89\u88c5\u597d\u540e\uff0c\u53f3\u4e0a\u89d2\u4f1a\u591a\u4e00\u4e2a\u8fd0\u884c\u56fe\u6807</p> <p></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/1.%E5%AE%89%E8%A3%85Go/#61-vscode\u914d\u7f6e\u4e2d\u6587\u754c\u9762","title":"6.1 Vscode\u914d\u7f6e\u4e2d\u6587\u754c\u9762","text":"<p>1\u3001vscode \u70b9\u51fb\u5de6\u4fa7\u83dc\u5355\u680f\u6700\u540e\u4e00\u9879\u7ba1\u7406\u6269\u5c55\uff0c\u5728\u641c\u7d22\u6846\u4e2d\u8f93\u5165<code>chinese</code> \uff0c\u9009\u4e2d\u7ed3\u679c\u5217\u8868\u7b2c\u4e00\u9879\uff0c\u70b9\u51fb<code>install</code>\u5b89\u88c5\u3002</p> <p></p> <p>\u5b89\u88c5\u5b8c\u6bd5\u540e\u53f3\u4e0b\u89d2\u4f1a\u63d0\u793a\u91cd\u542fVS Code\uff0c\u91cd\u542f\u4e4b\u540e\u4f60\u7684VS Code\u5c31\u663e\u793a\u4e2d\u6587\u4e86</p> <p>\u5982\u679c\u542f\u52a8\u540e\u4f9d\u7136\u4e0d\u662f\u4e2d\u6587\uff0c\u5219\u6309\u5feb\u6377\u952e<code>ctrl+shift+p</code>\uff0c\u8f93\u5165\u6846\u4e2d\u8f93\u5165Configure Display Language\uff0c\u56de\u8f66\u9009\u4e2d\u4e2d\u6587\uff0c\u7136\u540e\u91cd\u542fvscode</p> <p></p> <p></p> <p></p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u66f4\u65b0\u63d2\u4ef6\u6216\u5176\u4ed6\u63d2\u4ef6\u5b89\u88c5\u4e2d\uff0c\u4f1a\u51fa\u73b0\u65b0\u5efa\u7684\u7a97\u53e3\u975e\u4e2d\u6587\u60c5\u51b5\uff0c\u5219\u5148\u5378\u8f7d\u4e2d\u6587\u63d2\u4ef6\u91cd\u65b0\u6309\u4ee5\u4e0a\u6b65\u9aa4\u5b89\u88c5\u5373\u53ef</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/","title":"\u7b2c\u4e00\u4e2aGo\u7a0b\u5e8f","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/#1hello-world","title":"1.hello world","text":"<pre><code>package main\nimport \"fmt\"\nfunc main() {\nfmt.Println(\"Hello World\uff5e\")\n}\n</code></pre> <p>\u8f93\u5165\u5982\u4e0b\u547d\u4ee4 <pre><code>$ go run 1.2-helloWorld.go\nHello World~\n</code></pre></p> <p>\u63d0\u793a\uff1a\u53ef\u4ee5\u8fd0\u884c \"go build\"\u6765\u7f16\u8bd1 <pre><code>$ go build 1.2-helloWorld.go\n$ 1.2-helloWorld.exe\nHello World~\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/#2\u5305\u7684\u58f0\u660e","title":"2.\u5305\u7684\u58f0\u660e","text":"<pre><code>package xxxx\n</code></pre> <p>\u4e00\u822c\u6765\u8bf4Go\u8bed\u8a00\u7684\u6e90\u6587\u4ef6\u4e0e\u6240\u5728\u6587\u4ef6\u5939\u6709\u4e00\u4e00\u5bf9\u5e94\u5173\u7cfb.</p> <p>Go\u8bed\u8a00\u7684\u5305\u5177\u6709\u4ee5\u4e0b\u7279\u70b9</p> <ul> <li> <p>\u4e00\u4e2a\u76ee\u5f55\u4e0b\u7684\u540c\u7ea7\u6587\u4ef6\u5c5e\u4e8e\u540c\u4e00\u4e2a\u5305 </p> </li> <li> <p>\u5305\u540d\u53ef\u4ee5\u4e0e\u5176\u76ee\u5f55\u540d\u4e0d\u540c</p> </li> <li> <p>main\u662f\u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\u6587\u4ef6\uff0c\u4e00\u4e2aGo\u8bed\u8a00\u7a0b\u5e8f\u5fc5\u987b\u6709\u4e14\u4ec5\u6709\u4e00\u4e2amain\u5305</p> </li> </ul> <p>\u5982\u679c\u7a0b\u5e8f\u6ca1\u6709main\u5305\uff0c\u7f16\u8bd1\u4f1a\u62a5\u9519\uff0c\u4e14\u65e0\u6cd5\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/#3\u5305\u7684\u5bfc\u5165","title":"3.\u5305\u7684\u5bfc\u5165","text":"<pre><code>import \"package name\"\nimport \"fmt\"\n</code></pre> <p>\u53ef\u4ee5\u7528\u4e00\u4e2aimport\u5173\u952e\u5b57\u5bfc\u5165\u591a\u4e2a\u5305\uff0c\u6b64\u65f6\u9700\u8981\u4f7f\u7528\u201c()\u201d\u5c06\u5305\u7684\u540d\u5b57\u5305\u56f4\u8d77\u6765\uff0c\u5e76\u4e14\u6bcf\u4e00\u4e2a\u5305\u5360\u7528\u4e00\u884c\uff0c\u5f62\u5f0f\u5982\u4e0b\uff1a <pre><code>import(\n\"os\"\n\"fmt\"\n)\n</code></pre></p> <p>\u4e5f\u53ef\u4ee5\u4e3a\u5bfc\u5165\u7684\u5305\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u522b\u540d</p> <pre><code>import(\nalias1 \"os\"\nalias2 \"fmt\"\n)\n</code></pre> <p>\u8fd9\u6837\u53ef\u4ee5\u7528\u522b\u540d\u201calias1\u201d\u6765\u4ee3\u66ffos\uff0c\u7528\u522b\u540d\u201calias2\u201d\u6765\u4ee3\u66fffmt\u4e86</p> <p>\u5982\u679c\u53ea\u60f3\u521d\u59cb\u5316\u67d0\u4e2a\u5305\uff0c\u4e0d\u5bfc\u5165\u5305\u4e2d\u7684\u53d8\u91cf\u6216\u51fd\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528_\u6765\u4ee3\u66ff\u522b\u540d</p> <pre><code>import(\n_ \"os\"\nalias2 \"fmt\"\n)\n</code></pre> <p>\u6b64\u65f6\u5982\u679c\u7ee7\u7eed\u8c03\u7528os\u8fd9\u4e2a\u5305\uff0c\u4f1a\u62a5\u9519\uff0cundefined\uff1a\u5305\u540d</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/2.%E7%AC%AC%E4%B8%80%E4%B8%AAGo%E7%A8%8B%E5%BA%8F/#4main\u51fd\u6570","title":"4.main()\u51fd\u6570","text":"<p>main()\u51fd\u6570\u662fgo\u8bed\u8a00\u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\u51fd\u6570\u3002</p> <p>main()\u51fd\u6570\u662f\u81ea\u5b9a\u4e49\u51fd\u6570\u7684\u4e00\u79cd\uff0c\u5728Go\u8bed\u8a00\u4e2d\uff0c\u6240\u6709\u51fd\u6570\u90fd\u662f\u4ee5\u5173\u952e\u5b57func\u5f00\u5934\u7684\uff0c\u5b9a\u4e49\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>func \u51fd\u6570\u540d (\u53c2\u6570\u5217\u8868) \uff08\u8fd4\u56de\u503c\u5217\u8868\uff09{\n    \u51fd\u6570\u4f53\n}\n</code></pre> <p>Go\u8bed\u8a00\u7684\u5de6\u5927\u62ec\u53f7\u5fc5\u987b\u548c\u51fd\u6570\u540d\u5728\u540c\u4e00\u884c\uff0c\u4e0d\u7136\u4f1a\u62a5\u9519</p> <p>Go\u8bed\u8a00\u7684\u6bcf\u4e00\u884c\u7ed3\u5c3e\u5904\u4e0d\u7528\u4f7f\u7528;\u5206\u53f7\uff0c\u5982\u679c\u52a0\u4e0a\u5206\u53f7\uff1b\u4e5f\u4e0d\u4f1a\u62a5\u9519\uff0cGo\u7f16\u8f91\u5668\u4f1a\u81ea\u52a8\u5e2e\u52a9\u6211\u4eec\u6dfb\u52a0\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/","title":"Go\u57fa\u7840\u8bed\u6cd5","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u57fa\u7840\u8bed\u6cd5","title":"1.\u57fa\u7840\u8bed\u6cd5","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#11-go\u8bed\u8a00\u6807\u8bb0","title":"1.1 Go\u8bed\u8a00\u6807\u8bb0","text":"<p>Go\u7a0b\u5e8f\u7531\u5173\u952e\u5b57\u3001\u5b57\u7b26\u4e32\u3001\u5e38\u91cf\u3001\u6807\u8bc6\u7b26\u3001\u7b26\u53f7\u7b49\u591a\u79cd\u6807\u8bb0\u7ec4\u6210\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#12-\u884c\u5206\u9694\u7b26","title":"1.2 \u884c\u5206\u9694\u7b26","text":"<p>\u5982\u679c\u591a\u884c\u8bed\u53e5\u5728\u4e00\u884c\uff0c\u5fc5\u987b\u7528\uff1b\u5206\u9694\u7b26\u9694\u5f00\uff0cGo\u7f16\u8f91\u5668\u4f1a\u81ea\u52a8\u5728\u884c\u5c3e\u52a0\u901f\uff1b\u5206\u9694\u7b26\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u624b\u52a8\u518d\u8bed\u53e5\u540e\u9762\u518d\u52a0\uff1b</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#13-\u6ce8\u91ca","title":"1.3 \u6ce8\u91ca","text":"<p>\u5355\u884c\u6ce8\u91ca <pre><code>//\n</code></pre></p> <p>\u591a\u884c\u6ce8\u518c</p> <pre><code>/*\n\u591a\u884c\u6ce8\u91ca\n\u591a\u884c\u6ce8\u91ca\n*/\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#14-\u6807\u8bc6\u7b26","title":"1.4 \u6807\u8bc6\u7b26","text":"<p>\u6807\u8bc6\u7b26\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5b57\u7b26\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf(_)\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\u5e8f\u5217\u3002</p> <p>\u6807\u8bc6\u7b26\u7684\u547d\u540d\u9700\u8981\u9075\u5b88\u4ee5\u4e0b\u89c4\u5219\uff1a</p> <ul> <li>\u7531 26 \u4e2a\u82f1\u6587\u5b57\u6bcd\u30010~9\u3001<code>_</code>\u7ec4\u6210\uff1b</li> <li>\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934\uff0c\u4f8b\u5982 var 1num int \u662f\u9519\u8bef\u7684\uff1b</li> <li>Go\u8bed\u8a00\u4e2d\u4e25\u683c\u533a\u5206\u5927\u5c0f\u5199\uff1b</li> <li>\u6807\u8bc6\u7b26\u4e0d\u80fd\u5305\u542b\u7a7a\u683c\uff1b</li> <li>\u4e0d\u80fd\u4ee5\u7cfb\u7edf\u4fdd\u7559\u5173\u952e\u5b57\u4f5c\u4e3a\u6807\u8bc6\u7b26\uff0c\u6bd4\u5982 break\uff0cif \u7b49\u7b49\u3002</li> </ul> <p>\u547d\u540d\u6807\u8bc6\u7b26\u65f6\u8fd8\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ul> <li>\u6807\u8bc6\u7b26\u7684\u547d\u540d\u8981\u5c3d\u91cf\u91c7\u53d6\u7b80\u77ed\u4e14\u6709\u610f\u4e49\uff1b</li> <li>\u4e0d\u80fd\u548c\u6807\u51c6\u5e93\u4e2d\u7684\u5305\u540d\u91cd\u590d\uff1b</li> <li>\u4e3a\u53d8\u91cf\u3001\u51fd\u6570\u3001\u5e38\u91cf\u547d\u540d\u65f6\u91c7\u7528\u9a7c\u5cf0\u547d\u540d\u6cd5\uff0c\u4f8b\u5982 stuName\u3001getVal</li> </ul> <p>\u6b63\u786e\u547d\u540d\u7684\u6807\u8bc6\u7b26</p> <pre><code>product  user add  user_name   abc_123\nresultValue name1  _tmp k\n</code></pre> <p>\u9519\u8bef\u547d\u540d\u7684\u6807\u8bc6\u7b26</p> <pre><code>switch      (\u9519\u8bef\u547d\u540d\uff0cGo\u8bed\u8a00\u7684\u5173\u952e\u5b57) \n3ab         (\u9519\u8bef\u547d\u540d: \u4ee5\u6570\u5b57\u5f00\u901a)\nc-d         (\u9519\u8bef\u547d\u540d\uff1a\u8fd0\u7b97\u7b26\u662f\u4e0d\u5141\u8bb8\u7684)\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#15-\u5b57\u7b26\u4e32\u62fc\u63a5","title":"1.5 \u5b57\u7b26\u4e32\u62fc\u63a5","text":"<p>\u5b57\u7b26\u4e32\u53ef\u4ee5\u901a\u8fc7\"+\"\u53f7\u5b9e\u73b0\u5b57\u7b26\u4e32\u8fde\u63a5\u3002</p> <p>\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>package main\nimport \"fmt\"\nfunc main () {\nfmt.Println(\"Go web \u7f16\u7a0b\u5b9e\u6218\" + \"----\u4ece\u5165\u95e8\u5230\u7cbe\u901a\")\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#16-go\u8bed\u8a00\u7684\u5173\u952e\u5b57","title":"1.6 Go\u8bed\u8a00\u7684\u5173\u952e\u5b57","text":"<p>Go\u8bed\u8a00\u4e2d\u7684\u5173\u952e\u5b57\u4e00\u5171\u6709 25 \u4e2a\uff1a</p> break default func interface select case defer go map struct chan else goto package switch const fallthrough if range type continue for import return var"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#17-go\u8bed\u8a00\u4e2d\u7684\u7a7a\u683c","title":"1.7 Go\u8bed\u8a00\u4e2d\u7684\u7a7a\u683c","text":"<p>\u7a7a\u683c\u8ba9\u4ee3\u7801\u66f4\u5bb9\u6613\u9605\u8bfb\uff0cGoland\u7f16\u8f91\u5668\u53ef\u4ee5\u4f7f\u7528\"Ctrl+Alt+L\"\u547d\u4ee4\u8fdb\u884c\u5feb\u901f\u683c\u5f0f\u5316\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2-\u53d8\u91cf","title":"2. \u53d8\u91cf","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#21-\u58f0\u660e","title":"2.1 \u58f0\u660e","text":"<p>\u58f0\u660e\u53d8\u91cf\u7684\u4e00\u822c\u5f62\u5f0f\u662f\u4f7f\u7528 var \u5173\u952e\u5b57\uff1a</p> <p>var name type</p> <p>\u5176\u4e2d\uff0cvar \u662f\u58f0\u660e\u53d8\u91cf\u7684\u5173\u952e\u5b57\uff0cname \u662f\u53d8\u91cf\u540d\uff0ctype \u662f\u53d8\u91cf\u7684\u7c7b\u578b\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#211-\u6807\u51c6\u683c\u5f0f","title":"2.1.1 \u6807\u51c6\u683c\u5f0f","text":"<p>Go\u8bed\u8a00\u7684\u53d8\u91cf\u58f0\u660e\u7684\u6807\u51c6\u683c\u5f0f\u4e3a\uff1a</p> <pre><code>var \u53d8\u91cf\u540d \u53d8\u91cf\u7c7b\u578b\n</code></pre> <p>\u53d8\u91cf\u58f0\u660e\u4ee5\u5173\u952e\u5b57 var \u5f00\u5934\uff0c\u540e\u7f6e\u53d8\u91cf\u7c7b\u578b\uff0c\u884c\u5c3e\u65e0\u987b\u5206\u53f7\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#212-\u6279\u91cf\u683c\u5f0f","title":"2.1.2 \u6279\u91cf\u683c\u5f0f","text":"<pre><code>var (\na int\nb string\nc []float32\nd func() bool\ne struct {\nx int\n}\n)\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#213-\u7b80\u77ed\u683c\u5f0f","title":"2.1.3 \u7b80\u77ed\u683c\u5f0f","text":"<p>\u9664 var \u5173\u952e\u5b57\u5916\uff0c\u8fd8\u53ef\u4f7f\u7528\u66f4\u52a0\u7b80\u77ed\u7684\u53d8\u91cf\u5b9a\u4e49\u548c\u521d\u59cb\u5316\u8bed\u6cd5\u3002</p> <pre><code>\u540d\u5b57 := \u8868\u8fbe\u5f0f\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7b80\u77ed\u6a21\u5f0f\uff08short variable declaration\uff09\u6709\u4ee5\u4e0b\u9650\u5236\uff1a</p> <ul> <li>\u5b9a\u4e49\u53d8\u91cf\uff0c\u540c\u65f6\u663e\u5f0f\u521d\u59cb\u5316\u3002</li> <li>\u4e0d\u80fd\u63d0\u4f9b\u6570\u636e\u7c7b\u578b\u3002</li> <li>\u53ea\u80fd\u7528\u5728\u51fd\u6570\u5185\u90e8\u3002</li> </ul> <p>\u548c var \u5f62\u5f0f\u58f0\u660e\u8bed\u53e5\u4e00\u6837\uff0c\u7b80\u77ed\u53d8\u91cf\u58f0\u660e\u8bed\u53e5\u4e5f\u53ef\u4ee5\u7528\u6765\u58f0\u660e\u548c\u521d\u59cb\u5316\u4e00\u7ec4\u53d8\u91cf\uff1a</p> <pre><code>i, j := 0, 1\n</code></pre> <p>\u4e0b\u9762\u901a\u8fc7\u4e00\u6bb5\u4ee3\u7801\u6765\u6f14\u793a\u7b80\u77ed\u683c\u5f0f\u53d8\u91cf\u58f0\u660e\u7684\u57fa\u672c\u6837\u5f0f\u3002</p> <pre><code>func main() {   x:=100   a,s:=1, \"abc\"\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#22-\u8d4b\u503c","title":"2.2 \u8d4b\u503c","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#221-\u5355\u4e2a\u53d8\u91cf\u8d4b\u503c","title":"2.2.1 \u5355\u4e2a\u53d8\u91cf\u8d4b\u503c","text":"<pre><code>var a int = 100\nvar b int = 200\nvar attack = 40\nvar defence = 20\nvar damageRate float32 = 0.17\n// \u77ed\u53d8\u91cf\u8d4b\u503c\nhp := 100\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#222-\u591a\u4e2a\u53d8\u91cf\u8d4b\u503c","title":"2.2.2 \u591a\u4e2a\u53d8\u91cf\u8d4b\u503c","text":"<p>\u58f0\u660e\u4e00\u4e2a\u7528\u6237\u7684\u5e74\u9f84\u3001\u540d\u5b57\u3001\u4f59\u989d</p> <pre><code>var (\nage int=18\nname string = \"shirdon\"\nbalance float32 = 99999.99\n)\n</code></pre> <p>\u53e6\u5916\u4e00\u79cd\u58f0\u660e\u5f62\u5f0f</p> <pre><code>var age,name,balance = 18,\"shirdon\",99999.99\n</code></pre> <p>\u7b80\u5355\u7684\u5f62\u5f0f</p> <pre><code>age,name,balance := 18,\"shirdon\",99999.99\n</code></pre> <p>\u53d8\u91cf\u7684\u4ea4\u6362</p> <pre><code>d,c:=\"D\",\"C\"\nc,d = d,c\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#223-\u53d8\u91cf\u4f5c\u7528\u57df","title":"2.2.3 \u53d8\u91cf\u4f5c\u7528\u57df","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1-\u5c40\u90e8\u53d8\u91cf","title":"1. \u5c40\u90e8\u53d8\u91cf","text":"<p>\u5c40\u90e8\u53d8\u91cf\u4f5c\u7528\u57df\u53ea\u5728\u51fd\u6570\u4f53\u5185\u3002</p> <p>\u5c40\u90e8\u53d8\u91cf\u4e0d\u662f\u4e00\u76f4\u5b58\u5728\u7684\uff0c\u5b83\u53ea\u5728\u5b9a\u4e49\u5b83\u7684\u51fd\u6570\u88ab\u8c03\u7528\u540e\u5b58\u5728\uff0c\u51fd\u6570\u8c03\u7528\u7ed3\u675f\u540e\u8fd9\u4e2a\u5c40\u90e8\u53d8\u91cf\u5c31\u4f1a\u88ab\u9500\u6bc1\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\n//\u58f0\u660e\u5c40\u90e8\u53d8\u91cf a \u548c b \u5e76\u8d4b\u503c\nvar a int = 3\nvar b int = 4\n//\u58f0\u660e\u5c40\u90e8\u53d8\u91cf c \u5e76\u8ba1\u7b97 a \u548c b \u7684\u548c\nc := a + b\nfmt.Printf(\"a = %d, b = %d, c = %d\\n\", a, b, c)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2-\u5168\u5c40\u53d8\u91cf","title":"2. \u5168\u5c40\u53d8\u91cf","text":"<p>\u5728\u51fd\u6570\u4f53\u5916\u58f0\u660e\u7684\u53d8\u91cf\u79f0\u4e4b\u4e3a\u5168\u5c40\u53d8\u91cf\uff0c\u5168\u5c40\u53d8\u91cf\u53ea\u9700\u8981\u5728\u4e00\u4e2a\u6e90\u6587\u4ef6\u4e2d\u5b9a\u4e49\uff0c\u5c31\u53ef\u4ee5\u5728\u6240\u6709\u6e90\u6587\u4ef6\u4e2d\u4f7f\u7528\uff0c\u5f53\u7136\uff0c\u4e0d\u5305\u542b\u8fd9\u4e2a\u5168\u5c40\u53d8\u91cf\u7684\u6e90\u6587\u4ef6\u9700\u8981\u4f7f\u7528\"import\"\u5173\u952e\u5b57\u5f15\u5165\u5168\u5c40\u53d8\u91cf\u6240\u5728\u7684\u6e90\u6587\u4ef6\u4e4b\u540e\u624d\u80fd\u4f7f\u7528\u8fd9\u4e2a\u5168\u5c40\u53d8\u91cf\u3002</p> <p>\u5168\u5c40\u53d8\u91cf\u58f0\u660e\u5fc5\u987b\u4ee5 var \u5173\u952e\u5b57\u5f00\u5934\uff0c\u5982\u679c\u60f3\u8981\u5728\u5916\u90e8\u5305\u4e2d\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u7684\u9996\u5b57\u6bcd\u5fc5\u987b\u5927\u5199\u3002</p> <pre><code>package main\nimport \"fmt\"\n//\u58f0\u660e\u5168\u5c40\u53d8\u91cf\nvar c int\nfunc main() {\n//\u58f0\u660e\u5c40\u90e8\u53d8\u91cf\nvar a, b int\n//\u521d\u59cb\u5316\u53c2\u6570\na = 3\nb = 4\nc = a + b\nfmt.Printf(\"a = %d, b = %d, c = %d\\n\", a, b, c)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#224-\u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u4eba\u673a\u4ea4\u4e92","title":"2.2.4 \u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u4eba\u673a\u4ea4\u4e92","text":"<pre><code>package main\nimport \"fmt\"\nfunc main() {\n// \u5b9a\u4e49\u53d8\u91cfname, age, addr\n// \u7528\u4e8e\u5b58\u50a8\u7528\u6237\u8f93\u5165\u7684\u6570\u636e\nvar name, age, addr string\n// \u8f93\u51fa\u64cd\u4f5c\u63d0\u793a\nfmt.Printf(\"\u8bf7\u8f93\u5165\u4f60\u7684\u540d\u5b57\uff1a\\n\")\n// \u5b58\u50a8\u7528\u6237\u8f93\u5165\u6570\u636e\nfmt.Scanln(&amp;name)\n// \u8f93\u51fa\u64cd\u4f5c\u63d0\u793a\nfmt.Printf(\"\u8bf7\u8f93\u5165\u4f60\u7684\u5e74\u9f84\uff1a\\n\")\n// \u5b58\u50a8\u7528\u6237\u8f93\u5165\u6570\u636e\nfmt.Scanln(&amp;age)\n// \u8f93\u51fa\u64cd\u4f5c\u63d0\u793a\nfmt.Printf(\"\u8bf7\u8f93\u5165\u4f60\u7684\u5c45\u4f4f\u5730\uff1a\\n\")\n// \u5b58\u50a8\u7528\u6237\u8f93\u5165\u6570\u636e\nfmt.Scanln(&amp;addr)\n// \u8f93\u51fa\u7528\u6237\u8f93\u5165\u7684\u6240\u6709\u6570\u636e\nfmt.Printf(\"\u4f60\u7684\u540d\u5b57\u662f\uff1a%v\uff0c\u5e74\u9f84\uff1a%v\uff0c\u5c45\u4f4f\u5730\uff1a%v\", name, age, addr)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3-\u5e38\u91cf","title":"3. \u5e38\u91cf","text":"<p>\u5e38\u91cf\u7684\u5b9a\u4e49\u683c\u5f0f\u548c\u53d8\u91cf\u7684\u58f0\u660e\u8bed\u6cd5\u7c7b\u4f3c\uff1a<code>const name [type] = value</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>const pi = 3.14159 // \u76f8\u5f53\u4e8e math.Pi \u7684\u8fd1\u4f3c\u503c\n</code></pre> <p>\u5728Go\u8bed\u8a00\u4e2d\uff0c\u4f60\u53ef\u4ee5\u7701\u7565\u7c7b\u578b\u8bf4\u660e\u7b26 [type]\uff0c\u56e0\u4e3a**\u7f16\u8bd1\u5668\u53ef\u4ee5\u6839\u636e\u53d8\u91cf\u7684\u503c\u6765\u63a8\u65ad\u5176\u7c7b\u578b\u3002**</p> <ul> <li>\u663e\u5f0f\u7c7b\u578b\u5b9a\u4e49\uff1a const b string = \"abc\"</li> <li>\u9690\u5f0f\u7c7b\u578b\u5b9a\u4e49\uff1a const b = \"abc\"</li> </ul> <p>\u548c\u53d8\u91cf\u58f0\u660e\u4e00\u6837\uff0c\u53ef\u4ee5\u6279\u91cf\u58f0\u660e\u591a\u4e2a\u5e38\u91cf:</p> <pre><code>const (\ne  = 2.7182818\npi = 3.1415926\n)\n</code></pre> <p>\u5982\u679c\u662f\u6279\u91cf\u58f0\u660e\u7684\u5e38\u91cf\uff0c\u9664\u4e86\u7b2c\u4e00\u4e2a\u5916\u5176\u5b83\u7684\u5e38\u91cf\u53f3\u8fb9\u7684\u521d\u59cb\u5316\u8868\u8fbe\u5f0f\u90fd\u53ef\u4ee5\u7701\u7565\uff0c\u5982\u679c\u7701\u7565\u521d\u59cb\u5316\u8868\u8fbe\u5f0f\u5219\u8868\u793a\u4f7f\u7528\u524d\u9762\u5e38\u91cf\u7684\u521d\u59cb\u5316\u8868\u8fbe\u5f0f\uff0c\u5bf9\u5e94\u7684\u5e38\u91cf\u7c7b\u578b\u4e5f\u662f\u4e00\u6837\u7684\u3002\u4f8b\u5982\uff1a</p> <pre><code>const (\na = 1\nb\nc = 2\nd\n)\nfmt.Println(a, b, c, d) // \"1 1 2 2\"\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#31-iota\u5e38\u91cf\u751f\u6210\u5668","title":"3.1 iota\u5e38\u91cf\u751f\u6210\u5668","text":"<p>\u5e38\u91cf\u58f0\u660e\u53ef\u4ee5\u4f7f\u7528 iota \u5e38\u91cf\u751f\u6210\u5668\u521d\u59cb\u5316\uff0c\u5b83\u7528\u4e8e\u751f\u6210\u4e00\u7ec4\u4ee5\u76f8\u4f3c\u89c4\u5219\u521d\u59cb\u5316\u7684\u5e38\u91cf\uff0c\u4f46\u662f\u4e0d\u7528\u6bcf\u884c\u90fd\u5199\u4e00\u904d\u521d\u59cb\u5316\u8868\u8fbe\u5f0f\u3002\u5728\u4e00\u4e2a const \u58f0\u660e\u8bed\u53e5\u4e2d\uff0c\u5728\u7b2c\u4e00\u4e2a\u58f0\u660e\u7684\u5e38\u91cf\u6240\u5728\u7684\u884c\uff0ciota \u5c06\u4f1a\u88ab\u7f6e\u4e3a 0\uff0c\u7136\u540e\u5728\u6bcf\u4e00\u4e2a\u6709\u5e38\u91cf\u58f0\u660e\u7684\u884c\u52a0\u4e00\u3002</p> <pre><code>type Weekday int\nconst (\nSunday Weekday = iota\nMonday\nTuesday\nWednesday\nThursday\nFriday\nSaturday\n)\n</code></pre> <p>\u5468\u65e5\u5c06\u5bf9\u5e94 0\uff0c\u5468\u4e00\u4e3a 1\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#32-\u5ef6\u8fdf\u660e\u786e\u5e38\u91cf\u7684\u5177\u4f53\u7c7b\u578b","title":"3.2 \u5ef6\u8fdf\u660e\u786e\u5e38\u91cf\u7684\u5177\u4f53\u7c7b\u578b","text":"<p>Go\u8bed\u8a00\u7684\u5e38\u91cf\u6709\u4e00\u4e2a\u4e0d\u540c\u5bfb\u5e38\u6307\u51fa\uff1a\u867d\u7136\u4e00\u4e2a\u5e38\u91cf\u53ef\u4ee5\u6709\u4efb\u610f\u4e00\u4e2a\u786e\u5b9a\u7684\u57fa\u7840\u7c7b\u578b\uff08\u4f8b\u5982<code>int</code>\u6216<code>float64</code>\uff0c\u6216\u8005\u662f\u7c7b\u4f3c<code>time.Duration</code>\u8fd9\u6837\u7684\u57fa\u7840\u7c7b\u578b\uff09\uff0c\u4f46\u662f\u8bb8\u591a\u5e38\u91cf\u5e76\u6ca1\u6709\u4e00\u4e2a\u660e\u786e\u7684\u57fa\u7840\u7c7b\u578b\u3002</p> <p>\u7f16\u8bd1\u5668\u4e3a\u8fd9\u4e9b\u6ca1\u6709\u660e\u786e\u7684\u57fa\u7840\u7c7b\u578b\u7684\u6570\u5b57\u5e38\u91cf\uff0c\u63d0\u4f9b\u6bd4\u57fa\u7840\u7c7b\u578b\u66f4\u9ad8\u7cbe\u5ea6\u7684\u7b97\u6570\u8fd0\u7b97\u3002</p> <p>Go\u8bed\u8a00\u67096\u79cd\u672a\u660e\u786e\u7c7b\u578b\u7684\u5e38\u91cf\u7c7b\u578b\uff1a</p> <ul> <li>\u65e0\u7c7b\u578b\u7684\u5e03\u5c14\u578b</li> <li>\u65e0\u7c7b\u578b\u7684\u6574\u6570</li> <li>\u65e0\u7c7b\u578b\u7684\u5b57\u7b26</li> <li>\u65e0\u7c7b\u578b\u7684\u6d6e\u70b9\u6570</li> <li>\u65e0\u7c7b\u578b\u7684\u590d\u6570</li> <li>\u65e0\u7c7b\u578b\u7684\u5b57\u7b26\u4e32</li> </ul> <p>\u4f8b\u5982\uff0c\u65e0\u7c7b\u578b\u7684\u6d6e\u70b9\u6570\u5e38\u91cfmath.Pi\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u4e8e\u4efb\u4f55\u9700\u8981\u6d6e\u70b9\u6570\u6216\u590d\u6570\u7684\u5730\u65b9\uff1a</p> <pre><code>var a float32 = math.Pi\nvar b float64 = math.Pi\nvar c complex128 = math.Pi\n</code></pre> <p>\u5982\u679cmath.Pi\u88ab\u786e\u5b9a\u672a\u7279\u5b9a\u7c7b\u578b\uff08\u6bd4\u5982float64\uff09\uff0c\u5219\u7ed3\u679c\u7cbe\u5ea6\u53ef\u80fd\u4f1a\u4e0d\u4e00\u6837\u3002\u540c\u65f6\u5728\u9700\u8981float32\u6216complex128\u7c7b\u578b\u503c\u5f97\u5730\u65b9\uff0c\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u4e00\u4e2a\u660e\u786e\u5f97\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff1a</p> <pre><code>const Pi64 float64 = math.Pi\nvar a float32 = float32(Pi64)\nvar b float64 = Pi64\nvar c complex128 = complex128(Pi64)\n</code></pre> <p>\u5bf9\u4e8e\u5e38\u91cf\u9762\u503c\uff0c\u4e0d\u540c\u7684\u5199\u6cd5\u4f1a\u5bf9\u5e94\u4e0d\u540c\u5f97\u7c7b\u578b\u3002\u4f8b\u5982<code>0</code>\u3001<code>0.0</code>\u3001<code>0i</code>\u548c<code>\\u0000</code>\u867d\u7136\u6709\u7740\u76f8\u540c\u7684\u5e38\u91cf\u503c\uff0c\u4f46\u662f\u5b83\u4eec\u5206\u522b\u5bf9\u5e94\u65e0\u7c7b\u578b\u7684\u6574\u6570\u3001\u65e0\u7c7b\u578b\u7684\u6d6e\u70b9\u6570\u3001\u65e0\u7c7b\u578b\u7684\u590d\u6570\u548c\u65e0\u7c7b\u578b\u7684\u5b57\u7b26\u7b49\u4e0d\u540c\u7684\u5e38\u91cf\u7c7b\u578b\u3002\u540c\u6837\uff0c<code>true</code>\u548c<code>false</code>\u4e5f\u662f\u65e0\u7c7b\u578b\u7684\u5e03\u5c14\u7c7b\u578b\uff0c\u5b57\u7b26\u4e32\u9762\u503c\u5e38\u91cf\u662f\u65e0\u7c7b\u578b\u7684\u5b57\u7b26\u4e32\u7c7b\u578b\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#4-\u8fd0\u7b97\u7b26","title":"4. \u8fd0\u7b97\u7b26","text":"<p>\u8fd0\u7b97\u7b26\u7684\u4f18\u5148\u7ea7</p> <p>\u8868\u8fbe\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>var a, b, c int = 3, 6, 9\nd := a + b * c\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main(){\nvar x, y = 8, 5\nfmt.Printf(\"\u52a0\u6cd5\u8fd0\u7b97\u7b26\uff1a%d\\n\", x+y)\nfmt.Printf(\"\u51cf\u6cd5\u8fd0\u7b97\u7b26\uff1a%d\\n\", x-y)\nfmt.Printf(\"\u4e58\u6cd5\u8fd0\u7b97\u7b26\uff1a%d\\n\", x*y)\nfmt.Printf(\"\u9664\u6cd5\u8fd0\u7b97\u7b26\uff1a%d\\n\", x/y)\nfmt.Printf(\"\u53d6\u6a21\u8fd0\u7b97\u7b26\uff1a%d\\n\", x%y)\nx++\nfmt.Printf(\"\u5e42\u8fd0\u7b97\u7b26\uff1a%d\\n\", x)\ny--\nfmt.Printf(\"\u53d6\u6574\u8fd0\u7b97\u7b26\uff1a%d\\n\", y)\nfmt.Printf(\"x\u5927\u4e8ey\uff1a%v\\n\", x &gt; y)\nfmt.Printf(\"x\u5927\u4e8e\u6216\u7b49\u4e8ey\uff1a%v\\n\", x &gt;= y)\nfmt.Printf(\"x\u5c0f\u4e8ey\uff1a%v\\n\", x &lt; y)\nfmt.Printf(\"x\u5c0f\u4e8e\u6216\u7b49\u4e8ey\uff1a%v\\n\", x &lt;= y)\nfmt.Printf(\"x\u7b49\u4e8ey\uff1a%v\\n\", x == y)\nfmt.Printf(\"x\u4e0d\u7b49\u4e8ey\uff1a%v\\n\", x != y)\nvar a, b, c, d = true, true, false, false\nfmt.Printf(\"a&amp;&amp;b\u7684\u503c\u4e3a\uff1a%v\\n\", a &amp;&amp; b)\nfmt.Printf(\"a&amp;&amp;c\u7684\u503c\u4e3a\uff1a%v\\n\", a &amp;&amp; c)\nfmt.Printf(\"c&amp;&amp;d\u7684\u503c\u4e3a\uff1a%v\\n\", c &amp;&amp; d)\nfmt.Printf(\"a||b\u7684\u503c\u4e3a\uff1a%v\\n\", a || b)\nfmt.Printf(\"a||c\u7684\u503c\u4e3a\uff1a%v\\n\", a || c)\nfmt.Printf(\"c||d\u7684\u503c\u4e3a\uff1a%v\\n\", c || d)\nfmt.Printf(\"!a\u7684\u503c\u4e3a\uff1a%v\\n\", !a)\nfmt.Printf(\"!c\u7684\u503c\u4e3a\uff1a%v\\n\", !c)\n}\n</code></pre> <p>\u4e0e\u5176\u4ed6\u8bed\u8a00\u7684\u4f18\u5148\u7ea7\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u91cc\u4e0d\u505a\u6269\u5c55\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#5-\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5","title":"5. \u6d41\u7a0b\u63a7\u5236\u8bed\u53e5","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#511-if-else","title":"5.1.1 if-else","text":"<p>\u5728Go\u8bed\u8a00\u4e2d\uff0c\u5173\u952e\u5b57<code>if</code>\u7528\u4e8e\u5224\u65ad\u67d0\u4e2a\u6761\u4ef6\uff08\u5e03\u5c14\u578b\u6216\u903b\u8f91\u578b\uff09\u3002</p> <p>\u5982\u679c\u8be5\u6761\u4ef6\u6210\u7acb\uff0c\u5219\u4f1a\u6267\u884c<code>if</code>\u540e\u9762\u7531\u5927\u62ec\u53f7<code>{}</code>\u62ec\u8d77\u6765\u7684\u4ee3\u7801\u5757\uff0c\u5426\u5219\u5c31\u5ffd\u7565\u8be5\u4ee3\u7801\u5757\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u7684\u4ee3\u7801\u3002</p> <pre><code>if b &gt; 10 {\nreturn 1\n}\n</code></pre> <p>\u5982\u679c\u5b58\u5728\u7b2c2\u4e2a\u5206\u652f\uff0c\u5219\u53ef\u4ee5\u5728\u4e0a\u9762\u4ee3\u7801\u7684\u57fa\u7840\u4e0a\u6dfb\u52a0<code>else</code>\u5173\u952e\u5b57\u53ca\u53e6\u4e00\u4ee3\u7801\u5757\uff0c\u89c1\u4e0b\u65b9\u4ee3\u7801\u3002</p> <p>\u8fd9\u4e2a\u4ee3\u7801\u5757\u4e2d\u7684\u4ee3\u7801\u53ea\u6709\u5728<code>if</code>\u6761\u4ef6\u4e0d\u6ee1\u8db3\u65f6\u624d\u4f1a\u6267\u884c\u3002</p> <p><code>if{}</code>\u548c<code>else{}</code>\u4e2d\u7684\u4e24\u4e2a\u4ee3\u7801\u5757\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u5206\u652f\uff0c\u4e24\u8005\u53ea\u80fd\u6267\u884c\u5176\u4e2d\u4e00\u4e2a\u3002</p> <pre><code>if b &gt; 10 {\nreturn 1\n}else{\nreturn 2\n}\n</code></pre> <p>\u5982\u679c\u5b58\u5728\u7b2c3\u5206\u652f\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u79cd3\u4e2a\u72ec\u7acb\u5206\u652f\u7684\u5f62\u5f0f\uff1a</p> <pre><code>if b &gt; 10 {\nreturn 1\n}else if b == 10{\nreturn 2\n}else{\nreturn 3\n}\n</code></pre> <p>\u4e00\u822c\u6765\u8bf4\uff0c<code>else-if</code>\u5206\u652f\u7684\u6570\u91cf\u662f\u6ca1\u6709\u9650\u5236\u7684\u3002</p> <p>\u4f46\u662f\u4e3a\u4e86\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\uff0c\u6700\u597d\u4e0d\u8981\u5728<code>if</code>\u540e\u9762\u52a0\u5165\u592a\u591a\u7684<code>else-if</code>\u7ed3\u6784\u3002</p> <p>\u5982\u679c\u5fc5\u987b\u4f7f\u7528\u8fd9\u79cd\u5f62\u5f0f\uff0c\u5219\u5c3d\u53ef\u80fd\u628a\u5148\u6ee1\u8db3\u7684\u6761\u4ef6\u653e\u5728\u524d\u9762\u3002</p> <p>\u5173\u952e\u5b57<code>if</code>\u548c<code>else</code>\u4e4b\u540e\u7684\u5de6\u5927\u62ec\u53f7<code>{</code>\u5fc5\u987b\u548c\u5173\u952e\u5b57\u5728\u540c\u4e00\u884c\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u4e86<code>else-if</code>\u7ed3\u6784\uff0c\u5219\u524d\u6bb5\u4ee3\u7801\u5757\u7684\u53f3\u5927\u62ec\u53f7<code>}</code>\u5fc5\u987b\u548c<code>else if</code>\u8bed\u53e5\u5728\u540c\u4e00\u884c\u3002</p> <p>\u8fd9\u4e24\u6761\u89c4\u5219\u90fd\u662f\u88ab\u7f16\u8bd1\u5668\u5f3a\u5236\u89c4\u5b9a\u7684\uff0c\u5982\u679c\u4e0d\u6ee1\u8db3\uff0c\u5219\u7f16\u8bd1\u4e0d\u80fd\u901a\u8fc7\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#512-for","title":"5.1.2 for","text":"<p>Go\u8bed\u8a00\u79cd\u7684\u5faa\u73af\u8bed\u53e5\u53ea\u652f\u6301<code>for</code>\u5173\u952e\u5b57\uff0c\u4e0d\u652f\u6301<code>while</code>\u548c<code>do-while</code>\u7ed3\u6784\u3002</p> <pre><code>package main\nimport \"fmt\"\nfunc main() {\n// \u7ec4\u5408\u65b9\u5f0f\u4e00\nfor i := 1; i &lt; 10; i++ {\nfmt.Printf(\"\u672c\u6b21\u5faa\u73af\uff1a%v\\n\", i)\n}\n// \u7ec4\u5408\u65b9\u5f0f\u4e8c\nfor i := 1; i &lt; 10; {\nfmt.Printf(\"\u672c\u6b21\u5faa\u73af\uff1a%v\\n\", i)\ni++\n}\n// \u7ec4\u5408\u65b9\u5f0f\u4e09\nvar i int = 1\nfor i &lt; 5 {\nfmt.Printf(\"\u672c\u6b21\u5faa\u73af\uff1a%v\\n\", i)\ni++\n}\n// \u7ec4\u5408\u65b9\u5f0f\u56db\nfor {\nfmt.Printf(\"\u672c\u6b21\u5faa\u73af\uff1a%v\\n\", i)\nbreak\n}\n}\n</code></pre> <pre><code>product := 1\nfor i := 1; i &lt; 5; i++{\nproduct *= i\n}\n</code></pre> <p>\u65e0\u9650\u5faa\u73af\u573a\u666f</p> <pre><code>i := 0\nfor {\ni++\nif i &gt; 50 {\nbreak\n}\n}\n</code></pre> <p>\u5728\u4f7f\u7528\u5faa\u73af\u8bed\u53e5\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ul> <li> <p>\u5de6\u82b1\u62ec\u53f7{\u5fc5\u987b\u4e0efor\u5904\u4e8e\u540c\u4e00\u884c\u3002</p> </li> <li> <p>Go\u8bed\u8a00\u79cd\u7684for\u5faa\u73af\u4e0eC\u8bed\u8a00\u4e00\u6837\uff0c\u90fd\u5141\u8bb8\u5728\u5faa\u73af\u6761\u4ef6\u4e2d\u5b9a\u4e49\u548c\u521d\u59cb\u5316\u53d8\u91cf\u3002\u552f\u4e00\u7684\u533a\u522b\u662f\uff0cGo\u8bed\u8a00\u4e0d\u652f\u6301\u4ee5\u9017\u53f7\u4e3a\u95f4\u9694\u7684\u591a\u4e2a\u8d4b\u503c\u8bed\u53e5\uff0c\u5fc5\u987b\u4f7f\u7528\u5e73\u884c\u8d4b\u503c\u7684\u65b9\u5f0f\u6765\u521d\u59cb\u5316\u591a\u4e2a\u53d8\u91cf\u3002</p> </li> <li> <p>Go\u8bed\u8a00\u7684for\u5faa\u73af\u540c\u6837\u652f\u6301\u7528continue\u548cbreak\u6765\u63a7\u5236\u5faa\u73af\uff0c\u4f46\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u9ad8\u7ea7\u7684break\u2014\u2014\u53ef\u4ee5\u9009\u62e9\u4e2d\u65ad\u54ea\u4e00\u4e2a\u5faa\u73af\uff0c\u5982\u4e0b\u4f8b\uff1a</p> </li> </ul> <pre><code>JumpLoop:\nfor j := 0; j &lt; 5; j++{\nfor i := 0; i &lt; 5; i++{\nif i &gt; 2{\nbreak JumpLoop\n}\nfmt.Println(i)\n}\n}\n</code></pre> <p>\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c<code>break</code>\u8bed\u53e5\u7ec8\u6b62\u7684\u662f<code>JumpLoop</code>\u6807\u7b7e\u5bf9\u5e94\u7684<code>for</code>\u5faa\u73af\u3002<code>for</code>\u4e2d\u7684\u521d\u59cb\u8bed\u53e5\u662f\u5728\u7b2c1\u6b21\u5faa\u73af\u524d\u6267\u884c\u7684\u8bed\u53e5\u3002</p> <p>\u4e00\u822c\u4f7f\u7528\u521d\u59cb\u8bed\u53e5\u8fdb\u884c\u53d8\u91cf\u521d\u59cb\u5316\uff0c\u4f46\u5982\u679c\u53d8\u91cf\u5728<code>for</code>\u5faa\u73af\u4e2d\u88ab\u58f0\u660e\uff0c\u5219\u5176\u4f5c\u7528\u57df\u53ea\u662f\u8fd9\u4e2a<code>for</code>\u7684\u8303\u56f4\u3002</p> <p>\u521d\u59cb\u8bed\u53e5\u53ef\u4ee5\u88ab\u5ffd\u7565\uff0c\u4f46\u662f\u521d\u59cb\u8bed\u53e5\u4e4b\u540e\u7684**\u5206\u53f7**\u5fc5\u987b\u8981\u5199\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>j := 2\nfor ; j &gt; 0; j--{\nfmt.Println(j)\n}\n</code></pre> <p>\u5728\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c\u5c06<code>j</code>\u653e\u5728<code>for</code>\u7684\u524d\u9762\u8fdb\u884c\u521d\u59cb\u5316\uff0c<code>for</code>\u4e2d\u6ca1\u6709\u521d\u59cb\u8bed\u53e5\uff0c\u6b64\u65f6<code>j</code>\u7684\u4f5c\u7528\u57df\u6bd4\u5728\u521d\u59cb\u8bed\u53e5\u4e2d\u58f0\u660e\u7684<code>j</code>\u7684\u4f5c\u7528\u57df\u8981\u5927</p> <p>for\u4e2d\u7684\u6761\u4ef6\u8868\u8fbe\u5f0f\u662f\u63a7\u5236\u662f\u5426\u5faa\u73af\u7684\u5f00\u5173\u3002</p> <p>\u5728\u6bcf\u6b21\u5faa\u73af\u5f00\u59cb\u524d\uff0c\u90fd\u4f1a\u5224\u65ad\u6761\u4ef6\u8868\u8fbe\u5f0f\uff0c\u5982\u679c\u8868\u8fbe\u5f0f\u4e3atrue\uff0c\u5219\u5faa\u73af\u7ee7\u7eed\uff1b\u5426\u5219\u7ed3\u675f\u5faa\u73af\u3002</p> <p>\u6761\u4ef6\u8868\u8fbe\u5f0f\u53ef\u4ee5\u88ab\u5ffd\u7565\uff0c\u5ffd\u7565\u6761\u4ef6\u8868\u8fbe\u5f0f\u540e\u9ed8\u8ba4\u5f62\u6210\u65e0\u9650\u5faa\u73af\u3002</p> <p>\u4e0b\u9762\u4ee3\u7801\u4f1a\u5ffd\u7565\u6761\u4ef6\u8868\u8fbe\u5f0f\uff0c\u4f46\u662f\u4fdd\u7559\u7ed3\u675f\u8bed\u53e5\uff1a</p> <pre><code>var i int JumpLoop:\nfor ; ; i++{\nif i &gt; 10 {\n// println(i)\nbreak JumpLoop\n}\n}\n</code></pre> <p>\u7f8e\u89c2\u7684\u5199\u6cd5</p> <pre><code>var i int\nfor {\nif i &gt; 10 {\nbreak\n}\ni++\n}\n</code></pre> <p>\u5728<code>for</code>\u5faa\u73af\u4e2d\uff0c\u5982\u679c\u5faa\u73af\u88ab<code>break</code>\u3001<code>goto</code>\u3001<code>return</code>\u3001<code>panic</code>\u7b49\u8bed\u53e5\u5f3a\u5236\u9000\u51fa\uff0c\u5219\u4e4b\u540e\u7684\u8bed\u53e5\u4e0d\u4f1a\u88ab\u6267\u884c\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#continue","title":"continue","text":"<pre><code>import \"fmt\"\nfunc main() {\nfor i := 0; i &lt; 10; i++ {\nif i == 5 {\ncontinue\n}\nfmt.Println(i)\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#break","title":"break","text":"<pre><code>import \"fmt\"\nfunc main() {\nfor i := 0; i &lt; 10; i++ {\nif i == 5 {\nbreak\n}\nfmt.Println(i)\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#goto","title":"goto","text":"<p>goto\u8bed\u53e5\u53ef\u4ee5\u8df3\u8f6c\u5230\u6307\u5b9a\u6807\u7b7e\uff0c\u8fdb\u884c\u4ee3\u7801\u95f4\u7684\u65e0\u6761\u4ef6\u8df3\u8f6c\u3002</p> <p>\u5728\u5feb\u901f\u8df3\u51fa\u5faa\u73af\uff0c\u907f\u514d\u91cd\u590d\u9000\u51fa\u7684\u65b9\u9762\u6709\u4e00\u5b9a\u7684\u5e2e\u52a9\uff0cgoto\u8bed\u53e5\u53ef\u4ee5\u7b80\u5316\u4ee3\u7801\u4e0a\u5b9e\u73b0\u8fc7\u7a0b\u3002</p> <p>\u4f20\u7edf\u7684\u8fde\u7eed\u9000\u51fa\u4e24\u5c42\u5faa\u73af\u7684\u4ee3\u7801\u793a\u4f8b\uff1a</p> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nvar flag = false\nfor i := 0; i &lt; 10; i++ {\nfor j := 1; j &lt; 10; j++ {\nif j == 2 {\nflag = true\nbreak\n}\nfmt.Printf(\"i:%d - j:%d\", i, j)\n}\nif flag {\nbreak\n}\n}\nfmt.Print(\"\u7ed3\u675f\u5faa\u73af\")\n}\n</code></pre> <p>\u5982\u679c\u4f7f\u7528goto \u8bed\u53e5\uff0c\u5219\u7b80\u5316\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport \"fmt\"\nfunc main() {\n// var flag = false\nfor i := 0; i &lt; 10; i++ {\nfor j := 1; j &lt; 10; j++ {\nif j == 2 {\ngoto breakTag\n}\nfmt.Printf(\"i:%d - j:%d\", i, j)\n}\n}\nbreakTag:\nfmt.Print(\"\u7ed3\u675f\u5faa\u73af\")\n}\n</code></pre> <p>\"goto breakTag\" \u6765\u8df3\u8f6c\u5230\u6307\u660e\u7684\u6807\u7b7e\u5904\uff0cbreakTag \u662f\u81ea\u5b9a\u4e49\u7684\u6807\u7b7e\u3002</p> <p>goto\u5728<code>\u591a\u9519\u8bef\u5904\u7406</code>\u4e2d\u4f18\u52bf</p> <pre><code>func main() {\nerr := getUserInfo()\nif err != nil {\nfmt.Println(err)\nexitProcess()\n}\nerr = getEmail()\nif err != nil {\nfmt.Println(err)\nexitProcess()\n}\nfmt.Println(\"over\")\n}\n</code></pre> <pre><code>func main() {\nerr := getUserInfo()\nif err != nil {\ngoto doExit\n}\nerr = getEmail()\nif err != nil {\ngoto doExit\n}\nfmt.Println(\"over\")\nreturn\ndoExit:\nfmt.Println(err)\nexitProcess()\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#513-for-range","title":"5.1.3 for-range","text":"<p><code>for-range</code>\u5faa\u73af\u7ed3\u6784\u662fGo\u8bed\u8a00\u7279\u6709\u7684\u4e00\u79cd\u7684\u8fed\u4ee3\u7ed3\u6784\uff0c\u5176\u5f15\u7528\u5341\u5206\u5e7f\u6cdb\u3002</p> <p><code>for-range</code>\u53ef\u4ee5\u904d\u5386\u6570\u7ec4\u3001\u5207\u7247\u3001\u5b57\u7b26\u4e32\u3001<code>map</code>\u53ca\u901a\u9053\uff08<code>channel</code>\uff09\u3002</p> <p><code>for-range</code>\u7684\u8bed\u6cd5\u7ed3\u6784\uff1a</p> <pre><code>for key, val := range \u590d\u5408\u53d8\u91cf\u503c {\n    // ...\u903b\u8f91\u8bed\u53e5\n}\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>val</code>\u59cb\u7ec8\u4e3a\u96c6\u5408\u4e2d\u5bf9\u5e94\u7d22\u5f15\u503c\u7684\u4e00\u4e2a\u590d\u5236\u503c\u3002\u56e0\u6b64\uff0c\u5b83\u4e00\u822c\u53ea\u5177\u6709\u201c\u53ea\u8bfb\u201d\u5c5e\u6027\uff0c\u5bf9\u5b83\u6240\u505a\u7684\u4efb\u4f55\u4fee\u6539\u90fd\u4e0d\u4f1a\u5f71\u54cd\u96c6\u5408\u4e2d\u539f\u6709\u7684\u503c\u3002\u4e00\u4e2a\u5b57\u7b26\u4e32\u662f<code>Unicode</code>\u7f16\u7801\u7684\u5b57\u7b26\uff08\u6216\u79f0\u4e4b\u4e3a<code>rune</code>\uff09\u96c6\u5408\uff0c\u56e0\u6b64\u4e5f\u53ef\u4ee5\u7528\u5b83\u6765\u8fed\u4ee3\u5b57\u7b26\u4e32\uff1a</p> <pre><code>for position, char := range str{\n    // ...\u903b\u8f91\u8bed\u53e5\n}\n</code></pre> <p>\u6bcf\u4e2a<code>rune</code>\u5b57\u7b26\u548c\u7d22\u5f15\u5728<code>for-range</code>\u5faa\u73af\u4e2d\u7684\u503c\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u5b83\u80fd\u591f\u81ea\u52a8\u6839\u636e<code>UTF-8</code>\u89c4\u5219\u8bc6\u522b<code>Unicode</code>\u7f16\u7801\u7684\u5b57\u7b26\u3002</p> <p>\u901a\u8fc7<code>for-range</code>\u904d\u5386\u7684\u8fd4\u56de\u503c\u6709\u4e00\u5b9a\u7684\u89c4\u5f8b\uff1a</p> <ul> <li>\u6570\u7ec4\u3001\u5207\u7247\u3001\u5b57\u7b26\u4e32\u8fd4\u56de\u7d22\u5f15\u548c\u503c\u3002</li> <li><code>map</code>\u8fd4\u56de\u503c\u548c\u952e\u3002</li> <li>\u901a\u9053(<code>channel</code>)\u53ea\u8fd4\u56de\u901a\u9053\u5185\u7684\u503c\u3002</li> </ul>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u904d\u5386\u6570\u7ec4","title":"1.\u904d\u5386\u6570\u7ec4","text":"<p>\u8bbf\u95ee\u6bcf\u4e00\u4e2a\u6570\u7ec4\u5143\u7d20</p> <pre><code>package main\nimport \"fmt\"\nvar arrAge = [5]int{12, 13, 14, 15, 16}\nvar arrLazy = [...]int{22, 23, 24, 25, 26}\nvar arrKeyValue = [5]string{3: \"hujian\", 4: \"xiaojian\"}\nfunc main() {\n// \u904d\u5386\u65b9\u6cd51\nfor _, i2 := range arrAge {\nfmt.Println(i2)\n}\nfmt.Println(\"----------------------------\")\n// \u904d\u5386\u65b9\u6cd52\nfor i := 0; i &lt; len(arrAge); i++ {\nfmt.Println(arrAge[i])\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u904d\u5386\u5207\u7247","title":"2.\u904d\u5386\u5207\u7247","text":"<p>\u4f7f\u7528for\u548cfor range\u7684\u65b9\u5f0f\u904d\u5386\u5207\u7247</p> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nlist := []int{1, 2, 3, 4, 5, 6}\nfor i, i2 := range list {\nfmt.Printf(\"index %d is %d\\n\", i, i2)\n}\nfmt.Println(\"-----------------------------------------------\")\nfor index := 0; index &lt; len(list); index++ {\nfmt.Printf(\"index %d is %d\\n\", index, list[index])\n}\nfmt.Println(\"-------------\u53ea\u83b7\u53d6\u503c--------------------\")\nfor _, value := range list {\nfmt.Printf(\"value is %d\\n\",value)\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3\u904d\u5386\u5b57\u7b26\u4e32","title":"3.\u904d\u5386\u5b57\u7b26\u4e32","text":"<p>Go\u8bed\u8a00\u548c\u5176\u4ed6\u8bed\u8a00\u7c7b\u4f3c\uff1a\u53ef\u4ee5\u901a\u8fc7<code>for-range</code>\u7684\u7ec4\u5408\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u904d\u5386\u3002\u5728\u904d\u5386\u65f6\uff0c<code>key</code>\u548c<code>value</code>\u5206\u522b\u4ee3\u8868\u5b57\u7b26\u4e32\u7684\u7d22\u5f15\u548c\u5b57\u7b26\u4e32\u4e2d\u7684\u4e00\u4e2a\u5b57\u7b26\u3002</p> <pre><code>var str = \"hi \u52a0\u6cb9\"\nfor key, value := range str{\nfmt.Printf(\"key:%d value:0x%x\\n\", key, value)\n}\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\u7684\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>key:0 value:0x68\nkey:1 value:0x69\nkey:2 value:0x20\nkey:3 value:0x52a0\nkey:4 value:0x6cb9\n</code></pre> <p>\u4ee3\u7801\u4e2d\u7684\u904d\u5386<code>value</code>\u7684\u5b9e\u9645\u7c7b\u578b\u662f<code>rune</code>\u7c7b\u578b\uff0c\u4ee5\u5341\u516d\u8fdb\u5236\u6253\u5370\u51fa\u6765\u5c31\u662f\u5b57\u7b26\u7684\u7f16\u7801\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#4\u904d\u5386map","title":"4.\u904d\u5386map","text":"<p>\u5bf9\u4e8e<code>map</code>\u7c7b\u578b\uff0c<code>for-range</code>\u5728\u904d\u5386\u65f6\uff0c<code>key</code>\u548c<code>value</code>\u5206\u522b\u4ee3\u8868<code>map</code>\u7684\u7d22\u5f15\u952e<code>key</code>\u548c\u7d22\u5f15\u952e\u5bf9\u5e94\u7684\u503c\u3002\u4e0b\u9762\u7684\u4ee3\u7801\u6f14\u793a\u4e86\u5982\u4f55\u904d\u5386<code>map</code>\uff1a</p> <pre><code>m := map[string]int{\n\"go\": 100,\n\"web\": 100,\n}\nfor key, value := range m {\nfmt.Println(key, value)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#5\u904d\u5386\u901a\u9053","title":"5.\u904d\u5386\u901a\u9053","text":"<p>\u901a\u9053\u53ef\u4ee5\u901a\u8fc7<code>for-range</code>\u8fdb\u884c\u904d\u5386\u3002</p> <p>\u4e0d\u540c\u4e8e<code>slice</code>\u548c<code>map</code>\uff0c\u5728\u904d\u5386\u901a\u9053\u65f6\u53ea\u8f93\u51fa\u4e00\u4e2a\u503c\uff0c\u5373\u901a\u9053\u5185\u7684\u7c7b\u578b\u5bf9\u5e94\u7684\u6570\u636e\u3002</p> <p>\u4e0b\u9762\u4ee3\u7801\u5c55\u793a\u4e86\u901a\u9053\u7684\u904d\u5386\u65b9\u6cd5\uff1a</p> <pre><code>c := make(chan int)   // \u521b\u5efa\u4e86\u4e00\u4e2a\u6574\u578b\u7c7b\u578b\u7684\u901a\u9053\ngo func(){            // \u542f\u52a8\u4e86\u4e00\u4e2agoroutine\nc &lt;- 7            // \u5c06\u6570\u636e\u63a8\u9001\u8fdb\u901a\u9053\nc &lt;- 8\nc &lt;- 9\n}()\nfor v := range c {\nfmt.Println(v)\n}\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\u7684\u903b\u8f91\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u521b\u5efa\u4e00\u4e2a\u6574\u578b\u7c7b\u578b\u7684\u901a\u9053\u5e76\u5b9e\u4f8b\u5316\uff1b</p> </li> <li> <p>\u901a\u8fc7\u5173\u952e\u5b57go\u542f\u52a8\u4e86\u4e00\u4e2agoroutine\uff1b</p> </li> <li> <p>\u5c06\u6570\u5b57\u4f20\u5165\u901a\u9053\uff0c\u5b9e\u73b0\u7684\u529f\u80fd\u662f\u5f80\u901a\u9053\u4e2d\u63a8\u9001\u6570\u636e7\u30018\u30019\uff1b</p> </li> <li> <p>\u7ed3\u675f\u5e76\u5173\u95ed\u901a\u9053\uff08\u8fd9\u6bb5goroutine\u5728\u58f0\u660e\u7ed3\u675f\u540e\u9a6c\u4e0a\u88ab\u6267\u884c\uff09\uff1b</p> </li> <li> <p>\u7528for-range\u8bed\u53e5\u5bf9\u901a\u9053c\u8fdb\u884c\u904d\u5386\uff0c\u5373\u4e0d\u65ad\u5730\u4ece\u901a\u9053\u4e2d\u63a5\u6536\u6570\u636e\u77e5\u9053\u901a\u9053\u88ab\u5173\u95ed\u3002</p> </li> </ol> <p>\u5728\u4f7f\u7528<code>for-range</code>\u5faa\u73af\u904d\u5386\u67d0\u4e2a\u5bf9\u8c61\u65f6\uff0c\u5f80\u5f80\u4e0d\u4f1a\u540c\u65f6\u4f7f\u7528<code>key</code>\u548c<code>value</code>\u7684\u503c\uff0c\u800c\u662f\u53ea\u9700\u8981\u5176\u4e2d\u4e00\u4e2a\u7684\u503c\u3002\u8fd9\u65f6\u53ef\u4ee5\u91c7\u7528\u4e00\u4e9b\u6280\u5de7\u8ba9\u4ee3\u7801\u53d8\u5f97\u66f4\u7b80\u5355\u3002</p> <pre><code>m := map[string]int{\n\"shirdon\": 100,\n\"ronger\": 98,\n}\nfor _, value := range m {\nfmt.Println(value)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#514-switch-case","title":"5.1.4 switch-case","text":"<p>Go\u8bed\u8a00\u6539\u8fdb\u4e86\u4f20\u7edf\u7684switch-case\u8bed\u53e5\u7684\u8bed\u6cd5\u8bbe\u8ba1\uff1a</p> <p>case\u4e0ecase\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\u4ee3\u7801\u5757\u3002\u4e0d\u9700\u8981break\u8df3\u51fa\u5f53\u524dcase\u4ee3\u7801\u5757\uff0c\u4ee5\u907f\u514d\u6267\u884c\u5230\u4e0b\u4e00\u884c\u3002</p> <p>\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nage := 18\nswitch age {\ncase 60:\nfmt.Print(\"\u8001\u4eba\")\ncase 30:\nfmt.Print(\"\u4e2d\u5e74\")\ncase 18:\nfmt.Print(\"\u9752\u5e74\")\ncase 6:\nfmt.Print(\"\u5c11\u5e74\")\ndefault:\nfmt.Print(\"\u4f60\u662f\u4e00\u4e2a\u4eba\u624d\")\n}\n}\n</code></pre> <p>\u6ce8\u610f  \uff1aGo\u8bed\u8a00\u89c4\u5b9a\u6bcf\u4e2aswitch\u53ea\u80fd\u6709\u4e00\u4e2adefault\u5206\u652f\u3002</p> <p>(1) \u4e00\u4e2a\u5206\u652f\u591a\u4e2a\u503c</p> <pre><code>func testSwitch3() {\nswitch n := 7; n {\ncase 1, 3, 5, 7, 9:\nfmt.Println(\"\u5947\u6570\")\ncase 2, 4, 6, 8:\nfmt.Println(\"\u5076\u6570\")\ndefault:\nfmt.Println(n)\n}\n}\n</code></pre> <p>(2) \u5206\u652f\u8868\u8fbe\u5f0f</p> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nage := 18\nswitch {\ncase age &gt; 22:\nfmt.Print(\"\u5927\u5b66\u6bd5\u4e1a\")\ncase age &gt; 18 &amp;&amp; age &lt;= 22:\nfmt.Print(\"\u9ad8\u4e2d\u6bd5\u4e1a\")\ncase age &gt; 15 &amp;&amp; age &lt;= 18:\nfmt.Print(\"\u521d\u4e2d\u6bd5\u4e1a\")\ncase age &gt; 12 &amp;&amp; age &lt;= 15:\nfmt.Print(\"\u5c0f\u5b66\u6bd5\u4e1a\")\ncase age &gt; 6 &amp;&amp; age &lt;= 12:\nfmt.Print(\"\u5e7c\u513f\u56ed\u6bd5\u4e1a\")\n}\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\n//// \u4f7f\u7528\u65b9\u6cd51\n//finger := 3\n//switch finger {\n//  // \u5f53\u53d8\u91cffinger=1\u7684\u65f6\u5019\n//  case 1:\n//      fmt.Println(\"\u5927\u62c7\u6307\")\n//  // \u5f53\u53d8\u91cffinger=2\u7684\u65f6\u5019\n//  case 2:\n//      fmt.Println(\"\u98df\u6307\")\n//  // \u5f53\u53d8\u91cffinger=3\u7684\u65f6\u5019\n//  case 3:\n//      fmt.Println(\"\u4e2d\u6307\")\n//  case 4:\n//      fmt.Println(\"\u65e0\u540d\u6307\")\n//  case 5:\n//      fmt.Println(\"\u5c0f\u62c7\u6307\")\n//  default:\n//      fmt.Println(\"\u65e0\u6548\u7684\u8f93\u5165\uff01\")\n//}\n//\n//// \u4f7f\u7528\u65b9\u6cd52\n//rand.Seed(time.Now().Unix())\n//num := rand.Intn(100)\n//switch {\n//  // \u5224\u65adnum\u662f\u5426\u5927\u4e8e20\n//  case num &lt; 20:\n//      fmt.Printf(\"\u53d8\u91cfnum\u7684\u503c\u4e3a\uff1a%v\uff0c\u5c0f\u4e8e20\\n\", num)\n//  default:\n//      fmt.Printf(\"\u53d8\u91cfnum\u7684\u503c\u4e3a\uff1a%v\uff0c\u5927\u4e8e20\\n\", num)\n//}\n//\n//// \u4f7f\u7528\u65b9\u6cd53\n//rand.Seed(time.Now().Unix())\n//switch n := rand.Intn(9); n {\n//  // \u53d8\u91cfn\u5728\uff081, 3, 5, 7, 9\uff09\u533a\u95f4\u5185\n//  case 1, 3, 5, 7, 9:\n//      fmt.Printf(\"\u5947\u6570\uff0c\u503c\u4e3a\uff1a%v\uff0c\u5c0f\u4e8e20\\n\", n)\n//  // \u53d8\u91cfn\u5728\uff082, 4, 6, 8\uff09\u533a\u95f4\u5185\n//  case 2, 4, 6, 8:\n//      fmt.Printf(\"\u5076\u6570\uff0c\u503c\u4e3a\uff1a%v\uff0c\u5c0f\u4e8e20\\n\", n)\n//  default:\n//      fmt.Printf(\"\u5565\u4e5f\u4e0d\u662f\")\n//}\nfinger := 1\nswitch finger {\n// \u5f53\u53d8\u91cffinger=1\u7684\u65f6\u5019\ncase 1:\nfmt.Println(\"\u5927\u62c7\u6307\")\nfallthrough\n// \u5f53\u53d8\u91cffinger=2\u7684\u65f6\u5019\ncase 2:\nfmt.Println(\"\u98df\u6307\")\nfallthrough\n// \u5f53\u53d8\u91cffinger=3\u7684\u65f6\u5019\ncase 3:\nfmt.Println(\"\u4e2d\u6307\")\ncase 4:\nfmt.Println(\"\u65e0\u540d\u6307\")\ncase 5:\nfmt.Println(\"\u5c0f\u62c7\u6307\")\ndefault:\nfmt.Println(\"\u65e0\u6548\u7684\u8f93\u5165\uff01\")\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#515-\u5b9e\u8df51-\u7f16\u7a0b\u5b9e\u73b0\u4e2a\u4eba\u5065\u5eb7\u8bc4\u6d4b","title":"5.1.5 \u5b9e\u8df51-\u7f16\u7a0b\u5b9e\u73b0\u4e2a\u4eba\u5065\u5eb7\u8bc4\u6d4b","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"strconv\"\n)\nfunc main() {\n// \u5b9a\u4e49\u53d8\u91cf\nvar name string\nvar weight, height float64\n// \u8f93\u5165\u540d\u5b57\nfmt.Printf(\"\u8bf7\u8f93\u5165\u4f60\u7684\u540d\u5b57\uff1a\\n\")\nfmt.Scanln(&amp;name)\n// \u8f93\u5165\u4f53\u91cd\nfmt.Printf(\"\u8bf7\u8f93\u5165\u4f60\u7684\u4f53\u91cdkg\uff1a\\n\")\nfmt.Scanln(&amp;weight)\n// \u8f93\u5165\u8eab\u9ad8\nfmt.Printf(\"\u8bf7\u8f93\u5165\u4f60\u7684\u8eab\u9ad8cm\uff1a\\n\")\nfmt.Scanln(&amp;height)\n// \u8f93\u51fa\u7528\u6237\u8f93\u5165\u4fe1\u606f\nfmt.Printf(\"%v\u7684\u4f53\u91cdkg:%v\uff0c\u8eab\u9ad8cm:%v\\n\", name, weight, height)\n// \u5355\u4f4d\u6362\u7b97\uff0c\u5c06cm\u6362\u6210m\nheight /= 100\n// \u8ba1\u7b97BMI\nresult := weight / (height * height)\n// \u5c06BMI\u4fdd\u7559\u4e24\u4f4d\u5c0f\u6570\nBMI, _ := strconv.ParseFloat(fmt.Sprintf(\"%.2f\", result), 64)\n// \u6839\u636eBMI\u5224\u65ad\u8eab\u4f53\u72b6\u6001\nif BMI &lt; 18.5 {\nfmt.Printf(\"\u4f60\u7684BMI\u4e3a%v\uff0c\u4f53\u91cd\u8fc7\u8f7b\", BMI)\n} else if 18.5 &lt;= BMI &amp;&amp; BMI &lt; 24.0 {\nfmt.Printf(\"\u4f60\u7684BMI\u4e3a%v\uff0c\u4f53\u91cd\u6b63\u5e38\", BMI)\n} else if 24 &lt;= BMI &amp;&amp; BMI &lt; 27 {\nfmt.Printf(\"\u4f60\u7684BMI\u4e3a%v\uff0c\u4f53\u91cd\u8fc7\u91cd\", BMI)\n} else if 27 &lt;= BMI &amp;&amp; BMI &lt; 30 {\nfmt.Printf(\"\u4f60\u7684BMI\u4e3a%v\uff0c\u4f53\u91cd\u8f7b\u5ea6\u80a5\u80d6\", BMI)\n} else if 30 &lt;= BMI &amp;&amp; BMI &lt; 35 {\nfmt.Printf(\"\u4f60\u7684BMI\u4e3a%v\uff0c\u4f53\u91cd\u4e2d\u5ea6\u80a5\u80d6\", BMI)\n} else {\nfmt.Printf(\"\u4f60\u7684BMI\u4e3a%v\uff0c\u4f53\u91cd\u91cd\u5ea6\u80a5\u80d6\", BMI)\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#516-\u5b9e\u8df52-\u7f16\u7a0b\u5b9e\u73b0\u7b80\u6613\u8ba1\u7b97\u5668","title":"5.1.6 \u5b9e\u8df52-\u7f16\u7a0b\u5b9e\u73b0\u7b80\u6613\u8ba1\u7b97\u5668","text":"<pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\n// \u5b9a\u4e49\u53d8\u91cfaction\uff0c\u7528\u4e8e\u529f\u80fd\u9009\u62e9\nvar action string\n// \u5b9a\u4e49\u53d8\u91cfdata\uff0c\u5b58\u50a8\u5f53\u524d\u8f93\u5165\u7684\u6570\u636e\nvar d1, d2 float64\n// \u5b9a\u4e49\u53d8\u91cfopt\uff0c\u5b58\u50a8\u8f93\u5165\u7684\u8fd0\u7b97\u7b26\nvar opt string\n// \u5b9a\u4e49\u53d8\u91cfresult\uff0c\u5b58\u50a8\u8ba1\u7b97\u7ed3\u679c\nvar result interface{}\n// \u8bbe\u7f6e\u6b7b\u5faa\u73af\uff0c\u6267\u884c\u591a\u6b21\u8ba1\u7b97\nfor {\n// \u8f93\u51fa\u64cd\u4f5c\u63d0\u793a\nfmt.Printf(\"\u8bf7\u8f93\u5165\u9009\u62e9\uff0c\u63091\u8ba1\u7b97\uff0c\u63092\u9000\u51fa\uff1a\\n\")\n// \u5b58\u50a8\u7528\u6237\u8f93\u5165\u6570\u636e\nfmt.Scanln(&amp;action)\n// \u8fdb\u5165\u8ba1\u7b97\u64cd\u4f5c\nif action == \"1\" {\nfor i := 0; i &lt; 2; i++ {\n// \u8f93\u51fa\u64cd\u4f5c\u63d0\u793a\nfmt.Printf(\"\u8bf7\u8f93\u5165\u6570\u5b57\uff1a\\n\")\n// \u5b58\u50a8\u7528\u6237\u8f93\u5165\u6570\u636e\nif i == 0 {\nfmt.Scanln(&amp;d1)\n} else {\nfmt.Scanln(&amp;d2)\n}\n}\n// \u8f93\u51fa\u64cd\u4f5c\u63d0\u793a\nfmt.Printf(\"\u8bf7\u8f93\u5165\u8fd0\u7b97\u6cd5\u5219\uff0c\u53ef\u9009\u62e9+-*/\uff1a\\n\")\n// \u5b58\u50a8\u7528\u6237\u8f93\u5165\u6570\u636e\nfmt.Scanln(&amp;opt)\n// \u6839\u636e\u8f93\u5165\u8fd0\u7b97\u7b26\u6267\u884c\u5bf9\u5e94\u8ba1\u7b97\nif opt == \"+\" {\nresult = d1 + d2\n}\nif opt == \"-\" {\nresult = d1 - d2\n}\nif opt == \"*\" {\nresult = d1 * d2\n}\nif opt == \"/\" {\nif d2 != 0.0 {\nresult = d1 / d2\n} else {\nresult = \"\u9664\u6570\u4e3a0\u65e0\u6cd5\u8ba1\u7b97\"\n}\n}\n// \u8f93\u51fa\u8ba1\u7b97\u7ed3\u679c\nfmt.Printf(\"%v %v %v = %v\\n\", d1, opt, d2, result)\n}\n// \u9000\u51fa\u6b7b\u5faa\u73af\uff0c\u7ec8\u6b62\u6b7b\u5faa\u73af\nif action == \"2\" {\nbreak\n}\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#6-go\u6570\u636e\u7c7b\u578b","title":"6. Go\u6570\u636e\u7c7b\u578b","text":"\u7c7b\u578b \u8bf4\u660e \u5e03\u5c14\u578b true\u6216false \u6570\u5b57\u7c7b\u578b uint8\u3001uint16\u3001uint32\u3001uint64\u3001int8\u3001int16\u3001int32\u3001int64 \u3001float32\uff08IEEE-754\uff09\u3001float64\uff08IEEE-754\uff09\u3001complex64\u3001complex128\u3001byte\uff08uint8\uff09\u3001rune\uff08int32\uff09\u3001uint\uff0832\u621664\uff09\u3001int\uff0832\u621664\uff09\u3001uintptr\uff08\u5b58\u653e\u6307\u9488\uff09 \u5b57\u7b26\u4e32\u7c7b\u578b \u4e00\u4e32\u56fa\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u8fde\u63a5\u8d77\u6765\u7684\u5b57\u7b26\u5e8f\u5217\uff0cutf-8\u7f16\u7801 \u590d\u5408\u7c7b\u578b \u6570\u7ec4\u3001\u5207\u7247\u3001map\u3001\u7ed3\u6784\u4f53"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#61-\u5e03\u5c14\u578b","title":"6.1 \u5e03\u5c14\u578b","text":"<p>\u53ea\u6709\u4e24\u4e2a\u76f8\u540c\u7c7b\u578b\u7684\u503c\u624d\u80fd\u6bd4\u8f83\uff1a</p> <ul> <li>\u503c\u7684\u7c7b\u578b\u662f\u63a5\u53e3\uff08interface\uff09\uff0c\u4e24\u8005\u5fc5\u987b\u90fd\u5b9e\u73b0\u4e86\u76f8\u540c\u7684\u63a5\u53e3\u3002</li> <li>\u4e00\u4e2a\u662f\u5e38\u91cf\uff0c\u53e6\u4e00\u4e2a\u4e0d\u662f\u5e38\u91cf\uff0c\u7c7b\u578b\u5fc5\u987b\u548c\u5e38\u91cf\u7c7b\u578b\u76f8\u540c\u3002</li> <li>\u7c7b\u578b\u4e0d\u540c\uff0c\u5fc5\u987b\u8f6c\u6362\u4e3a\u76f8\u540c\u7c7b\u578b\uff0c\u624d\u80fd\u6bd4\u8f83\u3002</li> </ul> <p>&amp;&amp;\u4f18\u5148\u7ea7\u9ad8\u4e8e||\uff0c\u6709\u77ed\u8def\u73b0\u8c61\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc bool2int(b bool) int {\nif b {\nreturn 1\n} else {\nreturn 0\n}\n}\nfunc int2bool(i int) bool { return i != 0 }\nfunc main() {\nfmt.Println(bool2int(true)) //1\nfmt.Println(int2bool(0))    //false\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#62-\u6570\u5b57\u7c7b\u578b","title":"6.2 \u6570\u5b57\u7c7b\u578b","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u6574\u578b","title":"1.\u6574\u578b","text":"<p>\u6574\u578b\u5206\u4e3a\u4ee5\u4e0b\u4e24\u4e2a\u5927\u7c7b\uff1a </p> <ul> <li> <p>\u6309\u957f\u5ea6\u5206\u4e3a\uff1aint8\u3001int16\u3001int32\u3001int64 </p> </li> <li> <p>\u5bf9\u5e94\u7684\u65e0\u7b26\u53f7\u6574\u578b\uff1auint8\u3001uint16\u3001uint32\u3001uint64</p> </li> </ul> <p>\u5176\u4e2d\uff0cuint8\u5c31\u662f\u6211\u4eec\u719f\u77e5\u7684byte\u578b\uff0cint16\u5bf9\u5e94C\u8bed\u8a00\u4e2d\u7684short\u578b\uff0cint64\u5bf9\u5e94C\u8bed\u8a00\u4e2d\u7684long\u578b\u3002</p> <p>\u4f4d\u8fd0\u7b97\u91c7\u7528\u8865\u7801\u3002int\u3001uint\u548cuintptr\uff0c\u957f\u5ea6\u7531\u64cd\u4f5c\u7cfb\u7edf\u7c7b\u578b\u51b3\u5b9a\u3002</p> \u7c7b\u578b \u53d6\u503c\u8303\u56f4 \u5185\u5b58\u5360\u7528\u60c5\u51b5 int8 \u6709\u7b26\u53f7 8\u4f4d\u6574\u578b (-128 \u5230 127) 8\u4f4d\uff081\u5b57\u8282\uff09 uint8 \u65e0\u7b26\u53f7 8\u4f4d\u6574\u578b (0 \u5230 255) 8\u4f4d\uff081\u5b57\u8282\uff09 int16 \u6709\u7b26\u53f7 16\u4f4d\u6574\u578b (-32768 \u5230 32767) 16\u4f4d\uff082\u5b57\u8282\uff09 uint16 \u65e0\u7b26\u53f7 16\u4f4d\u6574\u578b (0 \u5230 65535) 16\u4f4d\uff082\u5b57\u8282\uff09 int32 \u6709\u7b26\u53f7 32\u4f4d\u6574\u578b (-2147483648 \u5230 2147483647) 32\u4f4d\uff084\u5b57\u8282\uff09 uint32 \u65e0\u7b26\u53f7 32\u4f4d\u6574\u578b (0 \u5230 4294967295) 32\u4f4d\uff084\u5b57\u8282\uff09 uint64 \u65e0\u7b26\u53f7 64\u4f4d\u6574\u578b (0 \u5230 18446744073709551615) 64\u4f4d\uff088\u5b57\u8282\uff09 int64 \u6709\u7b26\u53f7 64\u4f4d\u6574\u578b (-9223372036854775808 \u5230 9223372036854775807) 64\u4f4d\uff088\u5b57\u8282\uff09 <p>\u6709\u7b26\u53f7\u548c\u65e0\u7b26\u53f7\u7684\u4f7f\u7528\u573a\u666f\uff0c\u4f8b\u5982\u6c34\u676f\u4e2d\u7684\u6c34\u91cf\u4e0d\u53ef\u80fd\u4e3a\u8d1f\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u4f7f\u7528\u53ea\u80fd\u8868\u793a\u975e\u8d1f\u6574\u6570\u7684\u65e0\u7b26\u53f7\u6574\u6570\u7c7b\u578buint\u6765\u8868\u793a\u6c34\u676f\u4e2d\u7684\u6c34\u91cf\u3002</p> <p>\u8bb0\u5fc6\u65b9\u6cd5\uff1a</p> <p>\u6709\u7b26\u53f7\u5c31\u662f\u6709\u4e2a\u8d1f\u53f7\u3002</p> <p>\u65e0\u7b26\u53f7\u5c31\u662f\u6b63\u6570\uff0c\u65e0\u8d1f\u53f7\u3002</p> <p>\u7279\u6b8a\u6574\u578b</p> \u7c7b\u578b \u63cf\u8ff0 uint 32\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5c31\u662fuint32\uff0c64\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5c31\u662fuint64 int 32\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5c31\u662fint32\uff0c64\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5c31\u662fint64 uintptr \u65e0\u7b26\u53f7\u6574\u578b\uff0c\u7528\u4e8e\u5b58\u653e\u4e00\u4e2a\u6307\u9488"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u6d6e\u70b9\u578b","title":"2.\u6d6e\u70b9\u578b","text":"<p>Go\u8bed\u8a00\u652f\u6301\u4e24\u79cd\u6d6e\u70b9\u578b\u6570\uff1afloat32\u548cfloat64\u3002</p> <p>\u8fd9\u4e24\u79cd\u6d6e\u70b9\u578b\u6570\u636e\u683c\u5f0f\u9075\u5faaIEEE 754\u6807\u51c6\uff1a </p> <ul> <li>float32 \u7684\u6d6e\u70b9\u6570\u7684\u6700\u5927\u8303\u56f4\u7ea6\u4e3a 3.4e38\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e38\u91cf\u5b9a\u4e49\uff1amath.MaxFloat32\u3002 </li> <li>float64 \u7684\u6d6e\u70b9\u6570\u7684\u6700\u5927\u8303\u56f4\u7ea6\u4e3a 1.8e308\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u5e38\u91cf\u5b9a\u4e49\uff1amath.MaxFloat64\u3002</li> </ul> <p>\u6253\u5370\u6d6e\u70b9\u6570\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528fmt\u5305\u914d\u5408\u52a8\u8bcd%f\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"math\"\n)\nfunc main() {\nfmt.Printf(\"%f\\n\", math.Pi)\nfmt.Printf(\"%.2f\\n\", math.Pi)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#63-\u5b57\u7b26\u4e32\u7c7b\u578b","title":"6.3 \u5b57\u7b26\u4e32\u7c7b\u578b","text":"<p>\u7531\u4e00\u4e32\u56fa\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u8fde\u63a5\u8d77\u6765\u7684\u5b57\u7b26\u5e8f\u5217\uff0cutf-8\u7f16\u7801\u3002\u503c\u7c7b\u578b\uff0c\u5b57\u8282\u7684\u5b9a\u957f\u6570\u7ec4\u3002</p> <pre><code>//\u58f0\u660e\u548c\u521d\u59cb\u5316\nstr := \"string\"\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u521b\u5efa\u5b57\u7b26\u4e32","title":"1.\u521b\u5efa\u5b57\u7b26\u4e32","text":"<p>\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u7528\"\u6216`\u521b\u5efa</p> <ul> <li>\"\u521b\u5efa\u53ef\u89e3\u6790\u7684\u5b57\u7b26\u4e32\uff0c\u652f\u6301\u8f6c\u4e49\uff0c\u4e0d\u80fd\u5f15\u7528\u591a\u884c</li> <li>`\u521b\u5efa\u539f\u751f\u7684\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\uff0c\u4e0d\u652f\u6301\u8f6c\u4e49\uff0c\u53ef\u591a\u884c\uff0c\u4e0d\u80fd\u5305\u542b\u53cd\u5f15\u53f7\u5b57\u7b26</li> </ul> <pre><code>str1 := \"\\\"hello\\\"\\nI love you\"\nstr2 := `\"hello\"\nI love you\n`\n</code></pre> <pre><code>//\u5b57\u7b26\u4e32\u8fde\u63a5\nstr := \"I love\" + \" Go Web\"\nstr += \" programming\"\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"unicode/utf8\"\n)\nfunc main() {\nstr := \"\u6211\u559c\u6b22Go Web\"\nfmt.Println(len(str))                    //15\nfmt.Println(utf8.RuneCountInString(str)) //9\nfmt.Println(str[9])                      //71\nfmt.Println(string(str[9]))              //G\nfmt.Println(str[:3])                     //\u6211\nfmt.Println(string(str[:3]))             //\u6211\nfmt.Println(str[3:])                     //\u559c\u6b22Go Web\nfmt.Println([]rune(str))                //[25105 21916 27426 71 111 32 87 101 98]\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nstr := \"\u6211\u559c\u6b22Go Web\"\nchars := []rune(str)\nfor ind, char := range chars {\nfmt.Printf(\"%d: %s\\n\", ind, string(char))\n}\nfor ind, char := range str {\nfmt.Printf(\"%d: %s\\n\", ind, string(char))\n}\nfor ind, char := range str {\nfmt.Printf(\"%d: %U %c\\n\", ind, char, char)\n}\n}\n</code></pre> <pre><code>var buffer bytes.Buffer\nfor {\nif piece, ok := getNextString(); ok {\nbuffer.WriteString(piece)\n} else {\nbreak\n}\n}\nfmt.Println(buffer.String())\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u5b57\u7b26\u4e32\u7684\u4fee\u6539","title":"2.\u5b57\u7b26\u4e32\u7684\u4fee\u6539","text":"<p>\u4e0d\u80fd\u901a\u8fc7str[i]\u65b9\u5f0f\u4fee\u6539\u5b57\u7b26\u4e32\u4e2d\u7684\u5b57\u7b26\u3002 \u8981\u4fee\u6539\u5b57\u7b26\u4e32\uff0c\u9700\u8981\u5148\u5c06\u5176\u8f6c\u6362\u6210[]rune\u6216[]byte\uff0c\u5b8c\u6210\u540e\u518d\u8f6c\u6362\u4e3astring\u3002\u65e0\u8bba\u54ea\u79cd\u8f6c\u6362\uff0c\u90fd\u4f1a\u91cd\u65b0\u5206\u914d\u5185\u5b58\uff0c\u5e76\u590d\u5236\u5b57\u8282\u6570\u7ec4\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nstr := \"hi \u4e16\u754c\"\nby := []byte(str)\nby[2] = ','\nfmt.Printf(\"%s\\n\", str) //hi \u4e16\u754c     \nfmt.Printf(\"%s\\n\", by)  //hi \u4e16\u754c\nfmt.Printf(\"%s\\n\", string(by))  //hi \u4e16\u754c\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\ns1 := \"hello\"\n// 1\u3001\u5f3a\u5236\u8f6c\u6362\nbyteS1 := []byte(s1)\n// 2\u3001\u8fdb\u884c\u4fee\u6539\nbyteS1[0] = 'H'\n// 3\u3001\u5f3a\u5236\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u5e76\u6253\u5370\nfmt.Println(string(byteS1))\ns2 := \"\u6211\u7231\u4f60\u4e2d\u56fd\"\n// 1\u3001\u5f3a\u5236\u8f6c\u6362\nruneS2 := []rune(s2)\n// 2\u3001\u4fee\u6539\nruneS2[3] = '\u7956'\n// 3\u3001\u5f3a\u5236\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u5e76\u6253\u5370\nfmt.Println(string(runeS2))\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3\u5b57\u7b26\u4e32\u7684\u5e38\u7528\u64cd\u4f5c","title":"3.\u5b57\u7b26\u4e32\u7684\u5e38\u7528\u64cd\u4f5c","text":"\u65b9\u6cd5 \u4f5c\u7528 len(s) \u6c42\u957f\u5ea6\uff08\u662f\u5b57\u8282\u7684\u957f\u5ea6\uff09 +\u6216\u8005fmt.Sprintf \u5b57\u7b26\u4e32\u62fc\u63a5 strings.Split \u5b57\u7b26\u4e32\u5207\u5272 strings.contains \u5224\u65ad\u5b57\u7b26\u4e32\u4e2d\u662f\u5426\u5305\u542b strings.HasPrefix,strings.HasSuffix \u5224\u65ad\u5b57\u7b26\u4e32\u7684\u524d\u7f00/\u540e\u7f00\uff08\u5e03\u5c14\u7c7b\u578b\uff09 strings.Index(),strings.LastIndex() \u8f93\u51fa\u5b50\u4e32\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u7d22\u5f15\uff09 strings.Join(a[]string, sep string) join\u64cd\u4f5c <p>\u4f8b\u5b50 <pre><code>package main\nimport \"fmt\"\nimport \"strings\"\nfunc main() {\ns := \"Hello World \u4f60\u597d\u554a\uff01\"\n// \u6c42\u957f\u5ea6\nfmt.Println(len(s))\n// \u5b57\u7b26\u4e32\u62fc\u63a5\ns1 := \"Joker\"\ns2 := \"\u4f60\u597d\"\nfmt.Println(s1 + s2)\ns12 := fmt.Sprintf(\"%s%s\", s1, s2)\nfmt.Println(s12)\n// \u5b57\u7b26\u4e32\u5207\u5272\nsSplit := strings.Split(s, \" \")\nfmt.Println(sSplit)\n// \u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u5305\u542b\nfmt.Println(strings.Contains(s, \"H\"))\nfmt.Println(strings.Contains(s, \"L\"))\n// \u5224\u65ad\u5b57\u7b26\u4e32\u7684\u524d\u7f00\nfmt.Println(strings.HasPrefix(s, \"H\"))\n// \u5224\u65ad\u5b57\u7b26\u4e32\u7684\u540e\u7f00\nfmt.Println(strings.HasSuffix(s, \"\u554a\"))\n// \u5224\u65ad\u5b57\u4e32\u51fa\u73b0\u7684\u4f4d\u7f6e\nfmt.Println(strings.Index(s, \"H\"))\n// \u5224\u65ad\u5b50\u4e32\u6700\u540e\u51fa\u73b0\u7684\u4f4d\u7f6e\nfmt.Println(strings.LastIndex(s, \"o\"))\n// join\u64cd\u4f5c\nfmt.Println(strings.Join(sSplit, \"-\"))\n}\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#4\u7c7b\u578b\u8f6c\u6362","title":"4.\u7c7b\u578b\u8f6c\u6362","text":"<p>Go\u8bed\u8a00\u4e2d\u53ea\u6709\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff0c\u6ca1\u6709\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u3002\u8be5\u8bed\u6cd5\u53ea\u80fd\u5728\u4e24\u4e2a\u7c7b\u578b\u4e4b\u95f4\u652f\u6301\u76f8\u4e92\u8f6c\u6362\u7684\u65f6\u5019\u4f7f\u7528\u3002</p> <p>\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u7684\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <p><pre><code>T(\u8868\u8fbe\u5f0f)\n</code></pre> \u5176\u4e2d\uff0cT\u8868\u793a\u8981\u8f6c\u6362\u7684\u7c7b\u578b\u3002\u8868\u8fbe\u5f0f\u5305\u62ec\u53d8\u91cf\u3001\u590d\u6742\u7b97\u5b50\u548c\u51fd\u6570\u8fd4\u56de\u503c\u7b49.</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#64-\u6307\u9488\u7c7b\u578b","title":"6.4 \u6307\u9488\u7c7b\u578b","text":"<p>\u6307\u9488\u7c7b\u578b\u6307\u5b58\u50a8\u5185\u5b58\u5730\u5740\u7684\u53d8\u91cf\u7c7b\u578b\u3002</p> <pre><code>var b int = 66\nvar p * int = &amp;b\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nvar score int = 100\nvar name string = \"barry\"\nfmt.Printf(\"%p %p\\n\", &amp;score, &amp;name) //0xc0000ac058 0xc000088230\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nvar address string = \"hangzhou, China\"\nptr := &amp;address\nfmt.Printf(\"address type: %T\\n\", address)     //address type: string\nfmt.Printf(\"address value: %v\\n\", address)    //address value: hangzhou, China\nfmt.Printf(\"address address: %p\\n\", &amp;address) //address address: 0xc00003a240\nfmt.Printf(\"ptr type: %T\\n\", ptr)             //ptr type: *string\nfmt.Printf(\"ptr value: %v\\n\", ptr)            //ptr value: 0xc00003a240\nfmt.Printf(\"ptr address: %p\\n\", &amp;ptr)         //ptr address: 0xc000006028\nfmt.Printf(\"point value of ptr : %v\\n\", *ptr) //point value of ptr : hangzhou, China\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc exchange1(c, d int) {\nt := c\nc = d\nd = t\n}\nfunc exchange2(c, d int) {\nc, d = d, c\n}\nfunc exchange3(c, d *int) {\nt := *c\n*c = *d\n*d = t\n}\nfunc exchange4(c, d *int) {\nd, c = c, d\n}\nfunc exchange5(c, d *int) {\n*d, *c = *c, *d\n}\nfunc main() {\nx, y := 6, 8\nx, y = y, x\nfmt.Println(x, y) //8 6\nx, y = 6, 8\nexchange1(x, y)\nfmt.Println(x, y) //6 8\nx, y = 6, 8\nexchange2(x, y)\nfmt.Println(x, y) //6 8\nx, y = 6, 8\nexchange3(&amp;x, &amp;y)\nfmt.Println(x, y) //8 6\nx, y = 6, 8\nexchange4(&amp;x, &amp;y)\nfmt.Println(x, y) //6 8\nx, y = 6, 8\nexchange5(&amp;x, &amp;y)\nfmt.Println(x, y) //8 6\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#65-\u590d\u5408\u7c7b\u578b","title":"6.5 \u590d\u5408\u7c7b\u578b","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u6570\u7ec4\u7c7b\u578b","title":"1.\u6570\u7ec4\u7c7b\u578b","text":"<p>\u6570\u7ec4\u662f\u5177\u6709\u76f8\u540c\u7c7b\u578b\uff08\u6574\u6570\u3001\u5b57\u7b26\u4e32\u3001\u81ea\u5b9a\u4e49\u7c7b\u578b\u7b49\uff09\u7684\u4e00\u7ec4\u957f\u5ea6\u56fa\u5b9a\u7684\u6570\u636e\u9879\u7684\u5e8f\u5217\u3002</p> <pre><code>var team [3]string\nteam[0] = \"hujianli1\"\nteam[1] = \"hujianli2\"\nteam[2] = \"hujianli3\"\nfmt.Println(team)\n// \u4f7f\u7528\u7b26\u5408\u5b57\u9762\u91cf\u521d\u59cb\u5316\u6570\u7ec4\nvar numbers = [5]float32{100.0, 8.0, 9.4, 6.8, 30.1}\n// \u8ba9\u7f16\u8bd1\u5668\u81ea\u52a8\u8ba1\u7b97\u6570\u7ec4\u5143\u7d20\u6570\u91cf\nvar numbers = [...]float32{100.0, 8.0, 9.4, 6.8, 30.1}\n// \u793a\u4f8b1\nvar name_list  = [3]string{\"xiaojian01\",\"xiaojian02\",\"xiaojian03\"}\nfmt.Printf(\"%s--%s--%s\",name_list[0],name_list[1],name_list[2])\n//xiaojian01--xiaojian02--xiaojian03\n// \u793a\u4f8b2 \"...\"\u8868\u793a\u8ba9\u7f16\u8bd1\u5668\u786e\u5b9a\u6570\u7ec4\u5927\u5c0f\nvar array_list = [...]string{\"var1\",\"var2\",\"var3\",\"var4\"}\nfmt.Println(array_list[0]) //var1\nfmt.Println(array_list[1]) //var2\nfmt.Println(array_list[2])\nfmt.Println(array_list[3])\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nvar arr [6]int\nvar i, j int\nfor i = 0; i &lt; 6; i++ {\narr[i] = i + 66\n}\nfor j = 0; j &lt; 6; j++ {\nfmt.Printf(\"arr[%d] = %d\\n\", j, arr[j])\n}\n}\n/**\narr[0] = 66\narr[1] = 67\narr[2] = 68\narr[3] = 69\narr[4] = 70\narr[5] = 71\n**/\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\n// \u5b9a\u4e49\u957f\u5ea6\u4e3a2\u7684\u6570\u7ec4\u5e76\u8bbe\u7f6e\u6bcf\u4e2a\u5143\u7d20\u503c\nvar s = [2]int{100, 200}\n// \u8f93\u51fa\u6570\u7ec4\u5143\u7d20\nfor i := 0; i &lt; len(s); i++ {\nfmt.Printf(\"\u6570\u7ec4s\u7b2c%v\u4e2a\u5143\u7d20\u662f\uff1a%v\\n\", i+1, s[i])\n}\n// \u5b9a\u4e49\u6570\u7ec4\u5e76\u8bbe\u7f6e\u6bcf\u4e2a\u5143\u7d20\u503c\uff0c\u6570\u503c\u957f\u5ea6\u6839\u636e\u5143\u7d20\u4e2a\u6570\u81ea\u52a8\u8bbe\u7f6e\nvar ss = [...]int{300, 400}\n// \u8f93\u51fa\u6570\u7ec4\u5143\u7d20\nfor i := 0; i &lt; len(ss); i++ {\nfmt.Printf(\"\u6570\u7ec4ss\u7b2c%v\u4e2a\u5143\u7d20\u662f\uff1a%v\\n\", i+1, ss[i])\n}\n// \u5b9a\u4e49\u6570\u7ec4\u5e76\u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u548c\u7b2c\u56db\u4e2a\u5143\u7d20\u503c\nvar sss = [...]int{0: 300, 3: 500}\n// \u8f93\u51fa\u6570\u7ec4\u5143\u7d20\nfor i := 0; i &lt; len(sss); i++ {\nfmt.Printf(\"\u6570\u7ec4sss\u7b2c%v\u4e2a\u5143\u7d20\u662f\uff1a%v\\n\", i+1, sss[i])\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u7ed3\u6784\u4f53\u7c7b\u578b","title":"2.\u7ed3\u6784\u4f53\u7c7b\u578b","text":"<p>\u7ed3\u6784\u4f53\u662f\u75310\u6216\u591a\u4e2a\u4efb\u610f\u7c7b\u578b\u7684\u6570\u636e\u6784\u6210\u7684\u6570\u636e\u96c6\u5408\u3002 <pre><code>type \u7c7b\u578b\u540d struct {\n    \u5b57\u6bb51 \u7c7b\u578b1\n    \u7ed3\u6784\u4f53\u6210\u54582 \u7c7b\u578b2\n}\n</code></pre></p> <pre><code>type Pointer struct {\nA float32\nB float32\n}\ntype Color struct {\nRed, Green, Blue byte\n}\nvariable_name := struct_variable_type {value1, value2, ...}\nvariable_name := struct_variable_type {key2: value2, key1: value1, ...}\n</code></pre> <pre><code>package main\nimport \"fmt\"\ntype Books struct {\ntitle   string\nauthor  string\nsubject string\npress   string\n}\nfunc printBook(book Books) {\nfmt.Printf(\"book.title: %s\\n\", book.title)\nfmt.Printf(\"book.author: %s\\n\", book.author)\nfmt.Printf(\"book.subject: %s\\n\", book.subject)\nfmt.Printf(\"book.press: %s\\n\", book.press)\n}\nfunc printBook2(book *Books) {\nfmt.Printf(\"book.title: %s\\n\", book.title)\nfmt.Printf(\"book.author: %s\\n\", book.author)\nfmt.Printf(\"book.subject: %s\\n\", book.subject)\nfmt.Printf(\"book.press: %s\\n\", book.press)\n}\nfunc main() {\nfmt.Println(Books{author: \"yx\", title: \"\u5b66\u4e60 Go Web\"})\nfmt.Println()\nvar bookGo Books\nbookGo.title = \"\u5b66\u4e60 Go Web\"\nbookGo.author = \"yx\"\nbookGo.subject = \"Go\"\nbookGo.press = \"\u7535\u529b\u5de5\u4e1a\u51fa\u7248\u793e\"\nfmt.Printf(\"bookGo.title: %s\\n\", bookGo.title)\nfmt.Printf(\"bookGo.author: %s\\n\", bookGo.author)\nfmt.Printf(\"bookGo.subject: %s\\n\", bookGo.subject)\nfmt.Printf(\"bookGo.press: %s\\n\", bookGo.press)\nfmt.Println()\nprintBook(bookGo)\nfmt.Println()\nprintBook2(&amp;bookGo)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3\u5207\u7247\u7c7b\u578b","title":"3.\u5207\u7247\u7c7b\u578b","text":"<p>slice\u662f\u5bf9\u6570\u7ec4\u6216\u5207\u7247\u8fde\u7eed\u7247\u6bb5\u7684\u5f15\u7528\u3002</p> <p>\u5207\u7247\u5185\u90e8\u7ed3\u6784\u5305\u542b**\u5185\u5b58\u5730\u5740pointer\u3001\u5927\u5c0flen\u548c\u5bb9\u91cfcap**\u3002</p> <pre><code>//\u4e0d\u542b\u7ed3\u675f\u4f4d\u7f6e,\u5de6\u5f00\u53f3\u95ed\nslice[\u5f00\u59cb\u4f4d\u7f6e:\u7ed3\u675f\u4f4d\u7f6e]\n</code></pre> <pre><code>package main\nimport \"fmt\"\nvar sliceBuilder [20]int\nfunc main() {\nfor i := 0; i &lt; 20; i++ {\nsliceBuilder[i] = i + 1\n}\nfmt.Println(sliceBuilder)       //[1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20]\nfmt.Println(sliceBuilder[5:15]) //[6 7 8 9 10 11 12 13 14 15]\nfmt.Println(sliceBuilder[15:])  //[16 17 18 19 20]\nfmt.Println(sliceBuilder[:2])   //[1 2]\n// \u590d\u5408\u5b57\u9762\u91cf\u65b9\u6cd5\u521d\u59cb\u5316\u5207\u7247\nb := []int{6, 7, 8}\nfmt.Println(b[:])   //[6 7 8]\nfmt.Println(b[0:0]) //[]\nvar sliceStr []string\nvar sliceNum []int\nvar emptySliceNum = []int{}\nfmt.Println(sliceStr, sliceNum, emptySliceNum)                      //[] [] []\nfmt.Println(len(sliceStr), len(sliceNum), (emptySliceNum))          //0 0 []\nfmt.Println(sliceStr == nil, sliceNum == nil, emptySliceNum == nil) //true true false\nslice1 := make([]int, 6)\nslice2 := make([]int, 6, 10)\nfmt.Println(slice1, slice2)           //[0 0 0 0 0 0] [0 0 0 0 0 0]\nfmt.Println(len(slice1), len(slice2)) //6 6\nfmt.Println(cap(slice1), cap(slice2)) //6 10\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nvar ss = []int{1, 2, 3, 4, 5, 6, 7}\n// \u622a\u53d6\u7b2c\u4e8c\u4e2a\u5230\u7b2c\u4e94\u4e2a\u5143\u7d20\ns1 := ss[1:4]\nfmt.Printf(\"\u622a\u53d6\u7b2c\u4e8c\u4e2a\u5230\u7b2c\u4e94\u4e2a\u5143\u7d20\uff1a%v\\n\", s1)\n// \u622a\u53d6\u7b2c\u4e09\u4e2a\u5143\u7d20\u4e4b\u540e\u7684\u6240\u6709\u5143\u7d20\ns2 := ss[2:]\nfmt.Printf(\"\u622a\u53d6\u7b2c\u4e09\u4e2a\u5143\u7d20\u4e4b\u540e\u7684\u6240\u6709\u5143\u7d20\uff1a%v\\n\", s2)\n// \u622a\u53d6\u7b2c\u4e09\u4e2a\u5143\u7d20\u4e4b\u524d\u7684\u6240\u6709\u5143\u7d20\ns3 := ss[:2]\nfmt.Printf(\"\u622a\u53d6\u7b2c\u4e09\u4e2a\u5143\u7d20\u4e4b\u524d\u7684\u6240\u6709\u5143\u7d20\uff1a%v\\n\", s3)\n// \u5982\u679c\u5207\u7247ss\u6ca1\u88ab\u8986\u76d6\uff0c\u7ecf\u8fc7\u622a\u53d6\u540e\u4e0d\u6539\u53d8\u539f\u6709\u7684\u5207\u7247\u6570\u636e\nfmt.Printf(\"\u5207\u7247\u53d8\u91cfss\u7684\u503c\uff1a%v\\n\", ss)\n//var ss = []int{1, 2, 3, 4, 5, 6, 7}\n//fmt.Printf(\"\u5207\u7247ss\u7684\u5143\u7d20\uff1a%v\\n\", ss)\n//// \u5220\u9664\u5143\u7d204\u30015\u30016\n//ss = append(ss[:2], ss[6:]...)\n//fmt.Printf(\"\u5207\u7247ss\u7684\u5143\u7d20\uff1a%v\\n\", ss)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#4map\u7c7b\u578b","title":"4.map\u7c7b\u578b","text":"<p>\u5173\u8054\u6570\u7ec4\uff0c\u5b57\u5178\uff0c\u5143\u7d20\u5bf9\uff08pair\uff09\u7684\u65e0\u5e8f\u96c6\u5408\uff0c\u5f15\u7528\u7c7b\u578b\u3002</p> <pre><code>var name map[key_type]value_type\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\n// \u53ea\u5b9a\u4e49\nvar m1 = map[string]string{}\nm1[\"name\"] = \"Tom\"\nfmt.Printf(\"\u96c6\u5408m1\uff1a%v\\n\", m1)\n// \u5b9a\u4e49\u5e76\u8d4b\u503c\nvar m2 = map[string]string{\"name\": \"Lily\"}\nfmt.Printf(\"\u96c6\u5408m2\uff1a%v\\n\", m2)\n// \u4f7f\u7528make()\u51fd\u6570\u5b9a\u4e49\nm3 := make(map[string]string)\nm3[\"name\"] = \"Tim\"\nfmt.Printf(\"\u96c6\u5408m3\uff1a%v\\n\", m3)\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\nvar literalMap map[string]string\nvar assignedMap map[string]string\nfunc main() {\n// \u4f7f\u7528\u590d\u5408\u5b57\u9762\u91cf\u4e3amap\u63d0\u4f9b\u952e\u503c\u5bf9\u3002\u7b2c\u4e00\u79cd\u58f0\u660e\u65b9\u5f0f\nliteralMap = map[string]string{\"first\": \"go\", \"second\": \"web\"}\n// \u4f7f\u7528make\u51fd\u6570\uff0c\u53ef\u5bf9map\u9884\u5206\u914d\u5730\u5740\u3002\u7b2c\u4e8c\u79cd\u58f0\u660e\u65b9\u5f0f\ncreatedMap := make(map[string]float32)\nassignedMap = literalMap //\u5f15\u7528\ncreatedMap[\"k1\"] = 99\ncreatedMap[\"k2\"] = 199\nassignedMap[\"second\"] = \"program\"\nfmt.Println(literalMap[\"first\"])  //go\nfmt.Println(literalMap[\"second\"]) //program\n// \u5224\u65adkey\u662f\u5426\u5b58\u5728\nif value, ok := literalMap[\"third\"]; ok {\nfmt.Printf(\"key third has exist.value is: %v\", value)\n} else {\nfmt.Println(\"key third has not exist\") //key third has not exist\n}\nfmt.Println(createdMap[\"k1\"]) //99\nfmt.Println(createdMap[\"k2\"]) //199\n// \u521b\u5efa\u4e00\u4e2amap\nscenesint := make(map[string]int)\n// \u5411map\u4e2d\u6dfb\u52a0\u6620\u5c04\u5173\u7cfb\nscenesint[\"route\"] = 66\nfmt.Println(scenesint[\"route\"]) //66\nv := scenesint[\"route2\"]\nfmt.Println(v) //0\n// \u5224\u65ad\u952e\u503c\u5bf9\nmydicMaps := make(map[string]string)\nmydicMaps[\"hujianli1\"] = \"A1\"\nmydicMaps[\"hujianli2\"] = \"A2\"\nmydicMaps[\"hujianli3\"] = \"A3\"\nfor k, v := range mydicMaps {\nfmt.Printf(\"%s %s\\n\", k, v)\n}\nname1, ok := mydicMaps[\"hu1\"]\nif !ok {\nfmt.Println(\"----------\", name1)\n}\n// \u6216\u8005\nif name2, ok := mydicMaps[\"hu2\"]; !ok {\nfmt.Println(\"----------\", name2)\n}\n// \u904d\u5386map\u4e2d\u7684\u952e\u503c\u5bf9\u2013\u8bbf\u95ee\u5173\u8054\u5173\u7cfb\nm := map[string]string{\n\"name\":   \"hujianli\",\n\"age\":    \"22\",\n\"sex\":    \"man\",\n\"school\": \"dianda\",\n}\nfor i, i2 := range m {\nfmt.Printf(\"key:%s value:%s\\n\", i, i2)\n}\n// \u53ea\u904d\u5386\u503c\nfor _, i2 := range m {\nfmt.Printf(\"%s\\n\", i2)\n}\n// \u53ea\u904d\u5386\u952e\nfor i := range m {\nfmt.Printf(\"%s\\n\", i)\n}\n//delete()\u51fd\u6570\u4ecemap\u4e2d\u5220\u9664\u952e\u503c\u5bf9\nscene := make(map[string]int)\n//\u51c6\u5907map\u6570\u636e\nscene[\"route\"] = 66\nscene[\"brazil\"] = 4\nscene[\"china\"] = 960\n// \u5220\u9664\u4e00\u4e2a\u952e\ndelete(scene, \"brazil\")\nfmt.Println(scene) //map[china:960 route:66]\nfor i, i2 := range scene {\nfmt.Println(i, i2)\n}\n// Go \u8bed\u8a00\u4e2d\u6ca1\u6709\u6e05\u7a7amap\u7684\u65b9\u6cd5\u548c\u51fd\u6570\u3002\u6e05\u7a7amap\u7684\u4f4d\u4e8e\u65b9\u6cd5\u662f\u91cd\u65b0make\u4e00\u4e2a\u65b0\u7684map\u3002 Go\u4e2d\u7684\u5e76\u884c\u5783\u573e\u56de\u6536\u6548\u7387\u6bd4\u5199\u4e00\u4e2a\u6e05\u7a7a\u51fd\u6570\u9ad8\u6548\u591a\u4e86\u3002\nscene = make(map[string]int)\nfmt.Println(scene) //map[]\n}\n</code></pre> <pre><code>createdMap := new(map[string]float32)\n//\u9519\u8bef\n//\u58f0\u660e\u4e86\u4e00\u4e2a\u672a\u521d\u59cb\u5316\u7684\u53d8\u91cf\u5e76\u53d6\u4e86\u5b83\u7684\u5730\u5740\n</code></pre> <pre><code>//map\u5230\u8fbe\u5bb9\u91cf\u4e0a\u9650\uff0c\u81ea\u52a8\u589e1\n// make(map[key_type]value_type, cap)\nmap := make(map[string]float32, 100)\n// \u4f7f\u7528\u590d\u5408\u5b57\u9762\u91cf\u4e3amap\u63d0\u4f9b\u952e\u503c\u5bf9\nachievement := map[string]float32{\n\"zhang\": 99.5, \"xiao\": 88,\n\"wange\": 96, \"ma\": 100,\n}\nmap1 := make(map[int][]int)\nmap2 := make(map[int]*[]int)\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#41-\u7f16\u7a0b\u5b9e\u73b0map\u4e0ejson\u4e92\u6362","title":"4.1 \u7f16\u7a0b\u5b9e\u73b0map\u4e0eJSON\u4e92\u6362","text":"<ul> <li>JSON\u8f6c\u6362map</li> </ul> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n)\nfunc main() {\n// \u5b9a\u4e49\u5b57\u7b26\u4e32\uff0c\u7528\u4e8e\u8bb0\u5f55JSON\u6570\u636e\nvar j string\nj = `{\"infos\": [{\"name\": \"Tom\", \"age\": 15}, {\"name\": \"Lily\", \"age\": 20}]}`\n// \u5b9a\u4e49\u96c6\u5408\uff0cvalue\u7684\u6570\u636e\u7c7b\u578b\u4e3a\u63a5\u53e3interface\u7c7b\u578b\nvar m1 = map[string]interface{}{}\n// \u5c06JSON\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u96c6\u5408\njson.Unmarshal([]byte(j), &amp;m1)\n// \u904d\u5386\u8f93\u51faJSON\nfor k, v := range m1 {\nfmt.Printf(\"\u96c6\u5408m1\u7684\u952e\u4e3a\uff1a%v\\n\", k)\nfmt.Printf(\"\u96c6\u5408m1\u7684\u503c\u4e3a\uff1a%v\\n\", v)\n// \u89e3\u6790JSON\u91cc\u9762\u7684\u6570\u7ec4\nvv := v.([]interface{})\nfor i := 0; i &lt; len(vv); i++ {\nfmt.Printf(\"\u6570\u7ec4vv\u7684\u503c\u4e3a\uff1a%v\\n\", vv[i])\n// \u89e3\u6790\u6570\u7ec4\u91cc\u9762\u7684\u96c6\u5408\nvvv := vv[i].(map[string]interface{})\nname := vvv[\"name\"]\nage := vvv[\"age\"]\nfmt.Printf(\"\u952e\u4e3aname\u7684\u6570\u636e\u4e3a\uff1a%v\\n\", name)\nfmt.Printf(\"\u952e\u4e3aage\u7684\u6570\u636e\u4e3a\uff1a%v\\n\", age)\n}\n}\n}\n</code></pre> <ul> <li>map\u8f6c\u6362JSON</li> </ul> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n)\nfunc main() {\n// \u5b9a\u4e49\u96c6\u5408\nvar m1 = map[string]interface{}{}\nm1[\"name\"] = \"Tom\"\nm1[\"age\"] = 10\nfmt.Printf(\"m1\u7684\u6570\u636e\u4e3a\uff1a%v\\n\", m1)\nvar m2 = map[string]interface{}{}\nm2[\"name\"] = \"Lily\"\nm2[\"age\"] = 20\nfmt.Printf(\"m2\u7684\u6570\u636e\u4e3a\uff1a%v\\n\", m2)\n// \u5b9a\u4e49\u5207\u7247\nvar s1 = []map[string]interface{}{m1, m2}\nfmt.Printf(\"s1\u7684\u6570\u636e\u4e3a\uff1a%v\\n\", s1)\n// \u5b9a\u4e49\u96c6\u5408\uff0c\u952e\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u503c\u4e3a\u63a5\u53e3\u7c7b\u578b\nvar m3 = map[string]interface{}{}\nm3[\"infos\"] = s1\ndata, _ := json.Marshal(&amp;m3)\nfmt.Printf(\"JSON\u6570\u636e\u4e3a\uff1a%v\\n\", string(data))\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#7\u51fd\u6570","title":"7.\u51fd\u6570","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#71-\u58f0\u660e\u51fd\u6570","title":"7.1 \u58f0\u660e\u51fd\u6570","text":"<pre><code>func function_name([parameter list]) [return_types] {\n    //bunction_body\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\narray := []int{6, 8, 10}\nvar ret int\nret = min(array)\nfmt.Printf(\"\u6700\u5c0f\u503c\u662f: %d \\n\", ret)\n}\nfunc min(arr []int) (m int) {\nm = arr[0]\nfor _, v := range arr {\nif v &lt; m {\nm = v\n}\n}\nreturn m\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc compute(x, y int) (int, int) {\nreturn x + y, x * y\n}\nfunc main() {\na, b := compute(6, 8)\nfmt.Println(a, b) //14 48\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc change(a, b int) (x, y int) {\nx = a + 100\ny = b + 100\nreturn\n//return x, y\n//return y, x\n}\nfunc main() {\na := 1\nb := 2\nc, d := change(a, b)\nfmt.Println(c, d) //111 102\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#72-\u51fd\u6570\u53c2\u6570","title":"7.2 \u51fd\u6570\u53c2\u6570","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u53c2\u6570\u4f7f\u7528","title":"1.\u53c2\u6570\u4f7f\u7528","text":"<ul> <li>\u5f62\u53c2\uff1a\u5b9a\u4e49\u51fd\u6570\u65f6\uff0c\u7528\u4e8e\u63a5\u6536\u5916\u90e8\u4f20\u5165\u7684\u6570\u636e\u3002</li> <li>\u5b9e\u53c2\uff1a\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u4f20\u7ed9\u5f62\u53c2\u7684\u5b9e\u9645\u7684\u6570\u636e\u3002</li> </ul>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u53ef\u53d8\u53c2\u6570","title":"2.\u53ef\u53d8\u53c2\u6570","text":"<pre><code>package main\nimport \"fmt\"\nfunc myFunc(arg ...string) {\nfor _, v := range arg {\nfmt.Printf(\"the string is: %s\\n\", v)\n}\n}\nfunc main() {\nmyFunc(\"hujianli1\", \"hujianli2\", \"hujianli3\")\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\n//func myfun(numbers ...int) {\n//  for _, k := range numbers {\n//      fmt.Printf(\"\u53c2\u6570\u503c\u4e3a\uff1a%v\\n\", k)\n//  }\n//}\nfunc myfun(numbers ...interface{}) {\nfor _, k := range numbers {\nfmt.Printf(\"\u53c2\u6570\u503c\u4e3a\uff1a%v\\n\", k)\n}\n}\nfunc main() {\nvar s = []string{\"Mary\", \"Tim\"}\nvar m = map[string]interface{}{\"name\": \"Mary\", \"age\": 10}\n// \u8c03\u7528\u51fd\u6570\nmyfun(45, \"Tom\", s, m)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3\u53c2\u6570\u4f20\u9012","title":"3.\u53c2\u6570\u4f20\u9012","text":"<ul> <li>\u503c\u4f20\u9012</li> </ul> <pre><code>package main\nimport \"fmt\"\nfunc exchange(a, b int) {\nvar tmp int\ntmp = a\na = b\nb = tmp\n}\nfunc main() {\na := 1\nb := 2\nfmt.Printf(\"\u4ea4\u6362\u524da=%d\\n\", a)\nfmt.Printf(\"\u4ea4\u6362\u524db=%d\\n\", b)\nexchange(a, b)\nfmt.Printf(\"\u4ea4\u6362\u540ea=%d\\n\", a)\nfmt.Printf(\"\u4ea4\u6362\u540eb=%d\\n\", b)\n}\n/* \u4ea4\u6362\u524da=1\n\u4ea4\u6362\u524db=2\n\u4ea4\u6362\u540ea=1\n\u4ea4\u6362\u540eb=2 */\n</code></pre> <ul> <li>\u5f15\u7528\u4f20\u9012</li> </ul> <pre><code>package main\nimport \"fmt\"\nfunc exchange(a, b *int) {\nvar tmp int\ntmp = *a\n*a = *b\n*b = tmp\n}\nfunc main() {\na := 1\nb := 2\nfmt.Printf(\"\u4ea4\u6362\u524da=%d\\n\", a)\nfmt.Printf(\"\u4ea4\u6362\u524db=%d\\n\", b)\nexchange(&amp;a, &amp;b)\nfmt.Printf(\"\u4ea4\u6362\u540ea=%d\\n\", a)\nfmt.Printf(\"\u4ea4\u6362\u540eb=%d\\n\", b)\n}\n/* \u4ea4\u6362\u524da=1\n\u4ea4\u6362\u524db=2\n\u4ea4\u6362\u540ea=2\n\u4ea4\u6362\u540eb=1 */\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#4\u51fd\u6570\u4f5c\u4e3a\u53d8\u91cf","title":"4.\u51fd\u6570\u4f5c\u4e3a\u53d8\u91cf","text":"<pre><code>package main\nimport (\n\"fmt\"\n)\nfunc myfun() {\n// \u5b9a\u4e49\u51fd\u6570\nfmt.Printf(\"\u81ea\u5b9a\u4e49\u51fd\u6570\")\n}\nfunc main() {\n// \u5b9a\u4e49\u51fd\u6570\u53d8\u91cf\nvar m func()\n// \u5c06\u51fd\u6570\u4f5c\u4e3a\u53d8\u91cfm\u7684\u503c\nm = myfun\n// \u8c03\u7528\u51fd\u6570\nm()\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#73-\u533f\u540d\u51fd\u6570","title":"7.3 \u533f\u540d\u51fd\u6570","text":"<p>\u533f\u540d\u51fd\u6570\uff08\u95ed\u5305\uff09\uff0c\u4e00\u7c7b\u65e0\u987b\u5b9a\u4e49\u6807\u8bc6\u7b26\uff08\u51fd\u6570\u540d\uff09\u7684\u51fd\u6570\u6216\u5b50\u7a0b\u5e8f\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u5b9a\u4e49","title":"1.\u5b9a\u4e49","text":"<pre><code>func (\u53c2\u6570\u5217\u8868) (\u8fd4\u56de\u503c\u5217\u8868) {\n    //\u51fd\u6570\u4f53\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main(){\n//res := func(n1 int, n2 int) int {\n//  return n1 + n2\n//}(10, 30)\n//\n//fmt.Printf(\"\u51fd\u6570\u6267\u884c\u7ed3\u679c\u4e3a\uff1a%v\\n\", res)\n//\n// \u5c06\u533f\u540d\u51fd\u6570\u8d4b\u7ed9\u51fd\u6570\u53d8\u91cfmyfun\nmyfun := func (n1 int, n2 int) int {\nreturn n1 - n2\n}\n// \u53d8\u91cfmyfun\u7684\u6570\u636e\u7c7b\u578b\u662f\u51fd\u6570\u7c7b\u578b\uff0c\u53ef\u4ee5\u7531\u8be5\u53d8\u91cf\u5b8c\u6210\u51fd\u6570\u8c03\u7528\nres2 := myfun(10, 30)\nres3 := myfun(50, 30)\nfmt.Printf(\"\u533f\u540d\u51fd\u6570\u8c03\u7528\u7b2c\u4e00\u6b21\uff1a%v\\n\", res2)\nfmt.Printf(\"\u533f\u540d\u51fd\u6570\u8c03\u7528\u7b2c\u4e8c\u6b21\uff1a%v\\n\", res3)\nfmt.Printf(\"\u51fd\u6570\u53d8\u91cfmyfun\u7684\u6570\u636e\u7c7b\u578b\uff1a%T\\n\", myfun)\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nx, y := 6, 8\ndefer func(a int) {\nfmt.Println(\"defer x, y = \", a, y) //y\u4e3a\u95ed\u5305\u5f15\u7528\n}(x)\nx += 10\ny += 100\nfmt.Println(x, y)\n}\n/*\n\u8f93\u51fa\n16 108\ndefer x,y = 6 108\n*/\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u8c03\u7528","title":"2.\u8c03\u7528","text":"<ul> <li>\u5b9a\u4e49\u65f6\u8c03\u7528</li> </ul> <p><pre><code>package main\nimport \"fmt\"\nfunc main() {\n//\u5b9a\u4e49\u533f\u540d\u51fd\u6570\u5e76\u8d4b\u503c\u7ed9f\u53d8\u91cf\nf := func(data int) {\nfmt.Println(\"closure\", data)\n}\nf(6) //closure 6\n//\u76f4\u63a5\u58f0\u660e\u5e76\u8c03\u7528\nfunc(data int) {\nfmt.Println(\"closure, directly\", data)\n}(8) //closure, directly 8\n}\n</code></pre> - \u56de\u8c03\u51fd\u6570\uff08call then back\uff09</p> <pre><code>package main\nimport \"fmt\"\nfunc visitPrint(list []int, f func(int)) {\nfor _, value := range list {\nf(value)\n}\n}\nfunc main() {\nsli := []int{1, 6, 8}\nvisitPrint(sli, func(value int) {\nfmt.Println(value)\n})\n}\n/*\n1\n6\n8 */\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#5\u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u521b\u5efa\u6587\u4ef6\u540e\u7f00\u540d","title":"5.\u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u521b\u5efa\u6587\u4ef6\u540e\u7f00\u540d","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"path\"\n)\nfunc makeSuffixFunc(suffix string) func(string) string {\nfmt.Printf(\"\u53c2\u6570suffix\u7684\u5185\u5b58\u5730\u5740\uff1a%v\\n\", &amp;suffix)\n// \u53c2\u6570suffix\u662f\u6587\u4ef6\u540e\u7f00\u540d\nreturn func(name string) string {\nfmt.Printf(\"\u53c2\u6570suffix\u5728\u533f\u540d\u51fd\u6570\u7684\u5185\u5b58\u5730\u5740\uff1a%v\\n\", &amp;suffix)\n// \u533f\u540d\u51fd\u6570\u4f7f\u7528makeSuffixFunc\u7684\u53c2\u6570suffix\n// \u53c2\u6570name\u662f\u6587\u4ef6\u540d\uff0c\u53ef\u80fd\u542b\u6709\u540e\u7f00\u540d\u6216\u6ca1\u6709\u540e\u7f00\u540d\n// path.Ext()\u83b7\u53d6\u6587\u4ef6\u540e\u7f00\u540d\uff0c\u5224\u65adpath.Ext()\u662f\u5426\u4e3a\u7a7a\n// \u5224\u65ad\u7ed3\u679c\u4e3a\u7a7a\uff0c\u8bf4\u660e\u53c2\u6570name\u6ca1\u6709\u540e\u7f00\u540d\uff0c\u6839\u636esuffix\u521b\u5efa\u540e\u7f00\u540d\n// \u5224\u65ad\u7ed3\u679c\u4e0d\u4e3a\u7a7a\uff0c\u8bf4\u660e\u53c2\u6570name\u5df2\u6709\u540e\u7f00\u540d\nif path.Ext(name) == \"\" {\nreturn name + suffix\n} else {\nreturn \"\u6587\u4ef6\u5df2\u6709\u540e\u7f00\u540d\uff1a\" + name\n}\n}\n}\nfunc main() {\n// \u5b9a\u4e49jpg\u6587\u4ef6\u7c7b\u578b\u7684\u51fd\u6570\u53d8\u91cf\njpgFunc := makeSuffixFunc(\".jpg\")\n// \u5b9a\u4e49txt\u6587\u4ef6\u7c7b\u578b\u7684\u51fd\u6570\u53d8\u91cf\ntxtFunc := makeSuffixFunc(\".txt\")\n// \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5df2\u6709\u540e\u7f00\u540d\n// \u6ca1\u6709\u540e\u7f00\u540d\u5219\u6839\u636e\u51fd\u6570\u53d8\u91cf\u81ea\u52a8\u521b\u5efa\nfmt.Println(jpgFunc(\"test.png\"))\nfmt.Println(txtFunc(\"test\"))\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#74-defer\u5ef6\u8fdf\u8bed\u53e5","title":"7.4 defer\u5ef6\u8fdf\u8bed\u53e5","text":"<p>defer\u7528\u4e8e\u51fd\u6570\u7ed3\u675f\uff08return\u6216panic\uff09\u524d\u6700\u540e\u6267\u884c\u7684\u52a8\u4f5c\uff0c\u4fbf\u4e8e\u53ca\u65f6\u7684\u91ca\u653e\u8d44\u6e90\uff08\u6570\u636e\u5e93\u8fde\u63a5\u3001\u6587\u4ef6\u53e5\u67c4\u3001\u9501\u7b49\uff09\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1defer\u8bed\u53e5\u6267\u884c\u903b\u8f91","title":"1.defer\u8bed\u53e5\u6267\u884c\u903b\u8f91\uff1a","text":"<ol> <li>\u51fd\u6570\u6267\u884c\u5230defer\u65f6\uff0c\u5c06defer\u540e\u7684\u8bed\u53e5\u538b\u5165\u4e13\u95e8\u5b58\u50a8defer\u8bed\u53e5\u7684\u6808\u4e2d\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c\u51fd\u6570\u4e0b\u4e00\u4e2a\u8bed\u53e5\u3002</li> <li>\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\uff0c\u4ecedefer\u6808\u9876\u4f9d\u6b21\u53d6\u51fa\u8bed\u53e5\u6267\u884c\uff08\u5148\u8fdb\u540e\u51fa\uff0c\u540e\u8fdb\u5148\u51fa\uff09\u3002</li> <li>defer\u8bed\u53e5\u653e\u5728defer\u6808\u65f6\uff0c\u76f8\u5173\u503c\u4f1a\u590d\u5236\u5165\u6808\u4e2d\u3002</li> </ol> <pre><code>package main\nimport \"fmt\"\nfunc main() {\ndeferCall()\n}\nfunc deferCall() {\ndefer func1()\ndefer func2()\ndefer func3()\n}\nfunc func1() {\nfmt.Println(\"A\")\n}\nfunc func2() {\nfmt.Println(\"B\")\n}\nfunc func3() {\nfmt.Println(\"C\")\n}\n//\u8f93\u51fa\n//C\n//B\n//A\n</code></pre> <pre><code>package main\nimport \"fmt\"\nvar name string = \"go\"\nfunc myfunc() string {\ndefer func() {\nname = \"python\"             //\u6700\u540e\u4e00\u4e2a\u52a8\u4f5c\uff0c\u4fee\u6539\u5168\u5c40\u53d8\u91cfname\u4e3a\"python\"\n}()\nfmt.Printf(\"myfunc()\u51fd\u6570\u91cc\u7684name: %s\\n\", name) //\u5168\u5c40\u53d8\u91cfname\uff08\"go\"\uff09\u672a\u4fee\u6539\nreturn name                                //\u5012\u6570\u7b2c\u4e8c\u4e2a\u52a8\u4f5c\uff0c\u5c06\u5168\u5c40\u53d8\u91cfname\uff08\"go\"\uff09\u8d4b\u503c\u7ed9myfunc\u51fd\u6570\u8fd4\u56de\u503c\n}\nfunc main() {\nmyname := myfunc()\nfmt.Printf(\"main()\u51fd\u6570\u91cc\u7684name: %s\\n\", name)\nfmt.Printf(\"main()\u51fd\u6570\u91cc\u7684myname: %s\\n\", myname)\n}\n//\u8f93\u51fa\n//myfunc()\u51fd\u6570\u91cc\u7684name: go\n//main()\u51fd\u6570\u91cc\u7684name: python\n//main()\u51fd\u6570\u91cc\u7684myname: go\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2defer\u5e38\u7528\u5e94\u7528\u573a\u666f","title":"2.defer\u5e38\u7528\u5e94\u7528\u573a\u666f\uff1a","text":"<ol> <li> <p>\u5173\u95ed\u8d44\u6e90\u3002 \u521b\u5efa\u8d44\u6e90\uff08\u6570\u636e\u5e93\u8fde\u63a5\u3001\u6587\u4ef6\u53e5\u67c4\u3001\u9501\u7b49\uff09\u8bed\u53e5\u4e0b\u4e00\u884c\uff0cdefer\u8bed\u53e5\u6ce8\u518c\u5173\u95ed\u8d44\u6e90\uff0c\u907f\u514d\u5fd8\u8bb0\u3002</p> </li> <li> <p>\u548crecover()\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\u3002 \u7a0b\u5e8f\u5b95\u673a\u6216panic\u65f6\uff0crecover()\u51fd\u6570\u6062\u590d\u6267\u884c\uff0c\u800c\u4e0d\u62a5\u9519\u3002</p> </li> </ol> <pre><code>package main\nimport \"fmt\"\nfunc f() {\ndefer func() {\nif r := recover(); r != nil {\nfmt.Println(\"Recovered in f\", r)\n}\n}() //func()\u51fd\u6570\u542brecover\uff0c\u4e0d\u53ef\u5c01\u88c5\u6210\u5916\u90e8\u51fd\u6570\u8c03\u7528\uff0c\u5fc5\u987bdefer func(){}()\u533f\u540d\u51fd\u6570\u8c03\u7528\nfmt.Println(\"Calling g.\")\ng(0)\nfmt.Println(\"Returned normally from g.\")\n}\nfunc g(i int) {\nif i &gt; 3 {\nfmt.Println(\"Panicking!\")\npanic(fmt.Sprintf(\"%v\", i))\n}\ndefer fmt.Println(\"Defer in g\", i)\nfmt.Println(\"Printing in g\", i)\ng(i + 1)\n}\nfunc main() {\nf()\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#8go\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b","title":"8.Go\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#81-\u5c01\u88c5","title":"8.1 \u5c01\u88c5","text":"<p>\u9690\u85cf\u5bf9\u8c61\u5c5e\u6027\u548c\u5b9e\u73b0\u7ec6\u8282\uff0c\u4ec5\u516c\u5f00\u8bbf\u95ee\u65b9\u5f0f\u3002</p> <p>Go\u4f7f\u7528\u7ed3\u6784\u4f53\u5c01\u88c5\u5c5e\u6027\u3002</p> <pre><code>type Triangle struct {\nBottom float32\nHeight float32\n}\n</code></pre> <p>\u65b9\u6cd5\uff08Methods\uff09\u662f\u4f5c\u7528\u5728\u63a5\u6536\u8005\uff08receiver\uff09\uff08\u67d0\u79cd\u7c7b\u578b\u7684\u53d8\u91cf\uff09\u4e0a\u7684\u51fd\u6570\u3002</p> <pre><code>func (recv recv_type) methodName(parameter_list) (return_value_list) {...}\n</code></pre> <pre><code>package main\nimport \"fmt\"\ntype Triangle struct {\nBottom float32\nHeight float32\n}\nfunc (t *Triangle) Area() float32 {\nreturn (t.Bottom * t.Height) / 2\n}\nfunc main() {\n/*  t := Triangle{\n            Bottom: 6,\n            Height: 4,\n        }\n    */\nt := Triangle{6, 4}\nfmt.Println(t.Area()) //12\n}\n</code></pre> <p>\u8bbf\u95ee\u6743\u9650\u6307\u7c7b\u5c5e\u6027\u662f\u516c\u5f00\u8fd8\u662f\u79c1\u6709\u7684\uff0cGo\u901a\u8fc7\u9996\u5b57\u6bcd\u5927\u5c0f\u5199\u6765\u63a7\u5236\u53ef\u89c1\u6027\u3002</p> <p>\u5e38\u91cf\u3001\u53d8\u91cf\u3001\u7c7b\u578b\u3001\u63a5\u53e3\u3001\u7ed3\u6784\u4f53\u3001\u51fd\u6570\u7b49\u82e5\u662f\u5927\u5199\u5b57\u6bcd\u5f00\u5934\uff0c\u5219\u80fd\u88ab\u5176\u4ed6\u5305\u8bbf\u95ee\u6216\u8c03\u7528\uff08public\uff09\uff1b\u975e\u5927\u5199\u5f00\u5934\u5219\u53ea\u80fd\u5305\u5185\u4f7f\u7528\uff08private\uff09\u3002</p> <pre><code>bubble/\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 person\n    \u2514\u2500\u2500 person.go\n</code></pre> <p><code>bubble/go.mod</code></p> <pre><code>module bubble\n\ngo 1.16\n</code></pre> <p><code>bubble/main.go</code> <pre><code>package main\nimport (\n\"bubble/person\"\n\"fmt\"\n)\nfunc main() {\ns := new(person.Student)\ns.SetName(\"yx\")\ns.Age = 22\n// s.name = \"hujianli\"                  \u65e0\u6cd5\u8bbe\u7f6e\u79c1\u6709\u53d8\u91cf\nfmt.Println(s.GetName())                // yx\n}\n</code></pre> <code>bubble/person/person.go</code> <pre><code>package person\ntype Student struct {\nname  string\nscore float32\nAge   int\n}\nfunc (s *Student) GetName() string {\nreturn s.name\n}\nfunc (s *Student) SetName(newName string) {\ns.name = newName\n}\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#\u6307\u9488\u65b9\u5f0f\u7684\u5b9e\u4f8b\u5316","title":"\u6307\u9488\u65b9\u5f0f\u7684\u5b9e\u4f8b\u5316","text":"<p>\u5728\u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528\u5185\u7f6e\u51fd\u6570\u65b9\u6cd5new()\u548c\u53d6\u5730\u5740\u64cd\u4f5c\u7b26\u201c&amp;\u201d\u5b9e\u73b0\uff0c\u8fd9\u4e24\u79cd\u5b9e\u4f8b\u5316\u65b9\u6cd5\u90fd\u662f\u7531\u6307\u9488\u65b9\u5f0f\u5b8c\u6210\u7684\uff0c\u5728\u8bbf\u95ee\u6210\u5458\u7684\u65f6\u5019\u4e5f\u662f\u4f7f\u7528\u5b9e\u5fc3\u70b9\uff0c\u4f46\u7f16\u8bd1\u5668\u81ea\u52a8\u5c06\u5176\u8f6c\u6362\u4e3a(*yyy).xxx\u5f62\u5f0f\u8bbf\u95ee\u3002</p> <pre><code>package main\nimport \"fmt\"\n// \u5b9a\u4e49\u7ed3\u6784\u4f53person\ntype person struct {\nname string\nage  int\n}\nfunc main() {\n// \u5b9e\u4f8b\u5316\u65b9\u6cd53\n// \u4f7f\u7528new()\u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53\nvar p3 *person = new(person)\n// \u5bf9\u7ed3\u6784\u4f53\u6210\u5458\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\n(*p3).name = \"LiLy\"\n(*p3).age = 28\n// \u7531\u5b9e\u4f8b\u5316\u5bf9\u8c61p3\u8bbf\u95ee\u6210\u5458\nfmt.Printf(\"\u7ed3\u6784\u4f53\u6210\u5458name\u7684\u503c\uff1a%v\\n\", p3.name)\nfmt.Printf(\"\u7ed3\u6784\u4f53\u6210\u5458age\u7684\u503c\uff1a%v\\n\", p3.age)\n// \u5b9e\u4f8b\u5316\u65b9\u6cd54\n// \u53d6\u7ed3\u6784\u4f53\u7684\u5730\u5740\u5b9e\u4f8b\u5316\nvar p4 *person = &amp;person{}\n// \u5bf9\u7ed3\u6784\u4f53\u6210\u5458\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\n(*p4).name = \"Mary\"\n(*p4).age = 16\n// \u7531\u5b9e\u4f8b\u5316\u5bf9\u8c61p4\u8bbf\u95ee\u6210\u5458\nfmt.Printf(\"\u7ed3\u6784\u4f53\u6210\u5458name\u7684\u503c\uff1a%v\\n\", p4.name)\nfmt.Printf(\"\u7ed3\u6784\u4f53\u6210\u5458age\u7684\u503c\uff1a%v\\n\", p4.age)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#\u7ed3\u6784\u4f53\u6807\u7b7e","title":"\u7ed3\u6784\u4f53\u6807\u7b7e","text":"<p>\u5728\u5b9a\u4e49\u7ed3\u6784\u4f53\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u6210\u5458\u6dfb\u52a0\u6807\u7b7etag\uff0c\u5b83\u662f\u4e00\u4e2a\u9644\u5c5e\u4e8e\u6210\u5458\u7684\u5b57\u7b26\u4e32\uff0c\u4ee3\u8868\u6587\u6863\u6216\u5176\u4ed6\u7684\u91cd\u8981\u6807\u8bb0\u3002</p> <p>\u6bd4\u5982\u89e3\u6790JSON\u9700\u8981\u4f7f\u7528\u5185\u7f6e\u5305encoding/json\uff0c\u8be5\u5305\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e9b\u9ed8\u8ba4\u6807\u7b7e\uff1b\u8fd8\u6709\u4e00\u4e9b\u5f00\u6e90\u7684ORM\u6846\u67b6\uff0c\u4e5f\u5e7f\u6cdb\u4f7f\u7528\u7ed3\u6784\u4f53\u7684\u6807\u7b7etag\u3002</p> <p>\u7ed3\u6784\u4f53\u6807\u7b7e\u8bbe\u7f6e\u8bf4\u660e\u5982\u4e0b\uff1a</p> <p>1\uff09\u6807\u7b7e\u5728\u6210\u5458\u7684\u6570\u636e\u7c7b\u578b\u540e\u9762\u8bbe\u7f6e\uff0c\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8868\u793a\uff0c\u5e76\u4e14\u4f7f\u7528\u53cd\u5f15\u53f7\u8868\u793a\u5b57\u7b26\u4e32\u3002</p> <p>2\uff09\u6807\u7b7e\u5185\u5bb9\u683c\u5f0f\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u952e\u503c\u5bf9\u7ec4\u6210\uff0c\u952e\u4e0e\u503c\u4f7f\u7528\u5192\u53f7\u5206\u9694\uff0c\u5e76\u4e14\u4e0d\u80fd\u7559\u6709\u7a7a\u683c\uff0c\u503c\u7528\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\uff0c\u591a\u4e2a\u952e\u503c\u5bf9\u4e4b\u95f4\u4f7f\u7528\u4e00\u4e2a\u7a7a\u683c\u5206\u9694\u3002</p> <pre><code>    type name struct {\n       field1 dataType `key1:\"value1\" key2:\"value2\"`\n       field2 dataType `key1:\"value1\" key2:\"value2\"`\n       ...\n    }\n</code></pre> <p>\u5982\u679c\u5c06\u7ed3\u6784\u4f53\u7684\u6bcf\u4e2a\u6210\u5458\u9996\u4e2a\u5b57\u6bcd\u6539\u4e3a\u5927\u5199\u683c\u5f0f\uff0c\u5185\u7f6e\u5305encoding/json\u7684Marshal()\u80fd\u5c06\u7ed3\u6784\u4f53\u8f6c\u6362\u4e3aJSON\u6570\u636e\uff0c\u4f46\u662fJSON\u6570\u636e\u7684\u952e(key)\u4e00\u822c\u4ee5\u5c0f\u5199\u683c\u5f0f\u8868\u793a\uff0c</p> <p>\u4e3a\u4e86\u4f7f\u6570\u636e\u8f6c\u6362\u6210\u529f\u4e14\u8f6c\u6362\u7ed3\u679c\u7b26\u5408\u683c\u5f0f\u8981\u6c42\uff0c\u8fd9\u65f6\u5019\u9700\u8981\u4f7f\u7528\u7ed3\u6784\u4f53\u6807\u7b7etag\u5b9e\u73b0\uff0c\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n)\ntype Student struct {\n// `json:\"name\"`\u8868\u793ajson\u5e8f\u5217\u5316\u65f6\uff0c\u7ed3\u6784\u4f53\u6210\u5458\u5c55\u793a\u5f62\u5f0f\u4e3aname\nName  string `json:\"name\"`\nAge   int `json:\"age\"`\nScore int `json:\"score\"`\n}\nfunc main() {\nvar stu Student = Student{\nName:  \"\u5f20\u4e09\",\nAge:   22,\nScore: 88,\n}\ndata, _ := json.Marshal(stu)\nfmt.Println(string(data))\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#\u533f\u540d\u7ed3\u6784\u4f53\u4e0e\u533f\u540d\u6210\u5458","title":"\u533f\u540d\u7ed3\u6784\u4f53\u4e0e\u533f\u540d\u6210\u5458","text":"<ul> <li>\u533f\u540d\u7ed3\u6784\u4f53</li> </ul> <pre><code>package main\nimport \"fmt\"\nfunc main() {\n// \u5b9a\u4e49\u533f\u540d\u7ed3\u6784\u4f53\nvar p struct {\nname string\nage  int\n}\n// \u4f7f\u7528\u533f\u540d\u7ed3\u6784\u4f53\u5e76\u4e3a\u6210\u5458\u8d4b\u503c\np.name = \"Tom\"\np.age = 10\nfmt.Printf(\"\u533f\u540d\u7ed3\u6784\u4f53\u7684\u6210\u5458name\uff1a%v\\n\", p.name)\nfmt.Printf(\"\u533f\u540d\u7ed3\u6784\u4f53\u7684\u6210\u5458age\uff1a%v\\n\", p.age)\n// \u5b9a\u4e49\u533f\u540d\u7ed3\u6784\u4f53\u5e76\u8d4b\u503c\np1 := struct {\nname string\nage  int\n}{\nname: \"Tim\",\nage: 20,\n}\nfmt.Printf(\"\u533f\u540d\u7ed3\u6784\u4f53\u7684\u6210\u5458name\uff1a%v\\n\", p1.name)\nfmt.Printf(\"\u533f\u540d\u7ed3\u6784\u4f53\u7684\u6210\u5458age\uff1a%v\\n\", p1.age)\n}\n</code></pre> <ul> <li>\u533f\u540d\u6210\u5458</li> </ul> <pre><code>package main\nimport \"fmt\"\ntype person struct {\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\nstring\nint\nfloat64\nbool\n}\nfunc main() {\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53\np := person{\"Tim\", 20, 171.1, true}\n// \u8bbf\u95ee\u533f\u540d\u6210\u5458\u5e76\u8f93\u51fa\nfmt.Printf(\"\u7ed3\u6784\u4f53\u7684\u533f\u540d\u6210\u5458string\u7684\u503c\uff1a%v\\n\", p.string)\nfmt.Printf(\"\u7ed3\u6784\u4f53\u7684\u533f\u540d\u6210\u5458int\u7684\u503c\uff1a%v\\n\", p.int)\nfmt.Printf(\"\u7ed3\u6784\u4f53\u7684\u533f\u540d\u6210\u5458float64\u7684\u503c\uff1a%v\\n\", p.float64)\nfmt.Printf(\"\u7ed3\u6784\u4f53\u7684\u533f\u540d\u6210\u5458bool\u7684\u503c\uff1a%v\\n\", p.bool)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#82-\u7ee7\u627f","title":"8.2 \u7ee7\u627f","text":"<p>\u7ed3\u6784\u4f53\u4e2d\u5185\u5d4c\u533f\u540d\u7c7b\u578b\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u7ee7\u627f\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#\u7ed3\u6784\u4f53\u5d4c\u5957","title":"\u7ed3\u6784\u4f53\u5d4c\u5957","text":"<pre><code>package main\nimport \"fmt\"\nfunc main() {\ntype cars struct {\nname  string\nprice int\n}\ntype person struct {\nname   string\nage    int\ncars   cars\nhourse struct {\nname  string\nprice int\n}\n}\nc := cars{name: \"BWM\", price: 500000}\np := person{name: \"Tim\", age: 30, cars: c}\nfmt.Printf(\"\u4e2a\u4eba\u540d\u79f0\uff1a%v\\n\", p.name)\nfmt.Printf(\"\u4e2a\u4eba\u5e74\u9f84\uff1a%v\\n\", p.age)\nfmt.Printf(\"\u4e2a\u4eba\u62e5\u6709\u8f66\u8f86\uff1a%v\\n\", p.cars.name)\nfmt.Printf(\"\u8f66\u8f86\u4ef7\u94b1\u4e3a\uff1a%v\\n\", p.cars.price)\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\ntype Engine interface {\nRun()\nStop()\n}\ntype Bus struct {\nEngine\n}\nfunc (c *Bus) Working() {\nc.Run()\nc.Stop()\n}\nfunc (c *Bus) Run() {\nfmt.Println(\"running...........\")\n}\nfunc (c *Bus) Stop() {\nfmt.Println(\"Stopping...........\")\n}\nfunc main() {\nnEw_Name := new(Bus)\nnEw_Name.Run()\nnEw_Name.Stop()\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#83-\u591a\u6001","title":"8.3 \u591a\u6001","text":"<p>\u591a\u6001\u6307\u4e0d\u540c\u5bf9\u8c61\u4e2d\u540c\u79cd\u884c\u4e3a\u7684\u4e0d\u540c\u5b9e\u73b0\u65b9\u6cd5\uff0c\u901a\u8fc7\u63a5\u53e3\u5b9e\u73b0\u3002</p> <pre><code>package main\nimport \"fmt\"\n// \u73b0\u72b6\u63a5\u53e3\ntype Shape interface {\nArea() float32\n}\n// \u6b63\u65b9\u5f62\ntype Square struct {\nsideLen float32\n}\n// \u4e09\u89d2\u5f62\ntype Triangle struct {\nBottom float32\nHeight float32\n}\n// \u6b63\u65b9\u5f62\u8ba1\u7b97\u9762\u79ef\u7684\u65b9\u6cd5\nfunc (sq Square) Area() float32 {\nreturn sq.sideLen * sq.sideLen\n}\n// \u4e09\u89d2\u5f62\u8ba1\u7b97\u9762\u79ef\u7684\u65b9\u6cd5\nfunc (t Triangle) Area() float32 {\nreturn t.Bottom * t.Height\n}\n// \u591a\u6001\u51fd\u6570\uff0c\u4f20\u5165\u63a5\u53e3\u6839\u636e\u63a5\u53e3\u5b9e\u73b0\u76f8\u5bf9\u4e8e\u7684\u65b9\u6cd5\nfunc Polymorphism(n Shape) float32 {\nreturn n.Area()\n}\nfunc main() {\nt := Triangle{6, 8}\ns := Square{8}\nshapes := []Shape{t, s}\nfor n, _ := range shapes {\nfmt.Println(\"\u56fe\u5f62\u6570\u636e\uff1a\", shapes[n])\nfmt.Println(\"\u9762\u79ef\uff1a\", shapes[n].Area())\n}\nfmt.Println()\nt1 := Polymorphism(t)\ns1 := Polymorphism(s)\nfmt.Println(t1)\nfmt.Println(s1)\n}\n</code></pre> <pre><code>package main\nimport \"fmt\"\n// \u5b9a\u4e49\u63a5\u53e3\ntype actions interface {\nspeak(content string)\n}\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\ntype duck struct {\nname string\n}\ntype cat struct {\nname string\n}\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\u65b9\u6cd5\nfunc (d *duck) speak(content string) {\nfmt.Printf(\"%v\u5728\u8bf4\u8bdd\uff1a%v\\n\", d.name, content)\n}\nfunc (c *cat) speak(content string) {\nfmt.Printf(\"%v\u5728\u8bf4\u8bdd\uff1a%v\\n\", c.name, content)\n}\n// \u5b9a\u4e49\u51fd\u6570\nfunc speaking(a actions, content string) {\na.speak(content)\n}\nfunc main() {\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53\nd := duck{name: \"\u5510\u8001\u9e2d\"}\nc := cat{name: \"\u51ef\u8482\u732b\"}\n// \u8c03\u7528\u51fd\u6570\nspeaking(&amp;d, \"\u560e\u560e\")\nspeaking(&amp;c, \"\u55b5\u55b5\")\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#84-\u5de5\u5382\u51fd\u6570","title":"8.4 \u5de5\u5382\u51fd\u6570","text":"<pre><code>package main\nimport \"fmt\"\n// \u5b9a\u4e49\u63a5\u53e3\ntype actions interface {\nspeak(content string)\n}\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\ntype duck struct {\nname string\n}\ntype cat struct {\nname string\n}\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\u65b9\u6cd5\nfunc (d *duck) speak(content string) {\nfmt.Printf(\"%v\u5728\u8bf4\u8bdd\uff1a%v\\n\", d.name, content)\n}\nfunc (c *cat) speak(content string) {\nfmt.Printf(\"%v\u5728\u8bf4\u8bdd\uff1a%v\\n\", c.name, content)\n}\n// \u5b9a\u4e49\u5de5\u5382\u51fd\u6570\nfunc factory(name string) actions {\nswitch name {\ncase \"duck\":\n// \u8fd4\u56de\u7ed3\u6784\u4f53duck\u5b9e\u4f8b\u5316\u7684\u5185\u5b58\u5730\u5740\nreturn &amp;duck{name: \"\u5510\u8001\u9e2d\"}\ncase \"cat\":\n// \u8fd4\u56de\u7ed3\u6784\u4f53cat\u5b9e\u4f8b\u5316\u7684\u5185\u5b58\u5730\u5740\nreturn &amp;cat{name: \"\u51ef\u8482\u732b\"}\ndefault:\n// \u81ea\u4e3b\u629b\u51fa\u5f02\u5e38\npanic(\"No such animal\")\n}\n}\nfunc main() {\n// \u8c03\u7528\u5de5\u5382\u51fd\u6570\nf1 := factory(\"duck\")\n// \u8c03\u7528\u63a5\u53e3\u65b9\u6cd5speak()\nf1.speak(\"\u560e\u560e\u560e\")\n// \u8c03\u7528\u5de5\u5382\u51fd\u6570\nf2 := factory(\"cat\")\n// \u8c03\u7528\u63a5\u53e3\u65b9\u6cd5speak()\nf2.speak(\"\u55b5\u55b5\u55b5\")\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#85-\u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u7ed3\u6784\u4f53\u4e0ejson\u4e92\u6362","title":"8.5 \u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u7ed3\u6784\u4f53\u4e0eJSON\u4e92\u6362","text":"<ul> <li>JSON\u8f6c\u7ed3\u6784\u4f53</li> </ul> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n)\ntype person struct {\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\n// \u6210\u5458infos\u4e3a\u5207\u7247\uff0c\u5207\u7247\u5143\u7d20\u4e3a\u7ed3\u6784\u4f53\nInfos []struct{\nName string `json:\"name\"`\nAge int `json:\"age\"`\n} `json:\"infos\"`\n}\nfunc main() {\n// \u5b9a\u4e49\u5b57\u7b26\u4e32\uff0c\u7528\u4e8e\u8bb0\u5f55JSON\u6570\u636e\nvar j string\nj=`{\"infos\":[{\"name\":\"Tom\",\"age\":15},{\"name\":\"Lily\",\"age\":20}]}`\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53\nvar p person\n// \u5c06JSON\u5b57\u7b26\u4e32\u8f6c\u4e3a\u7ed3\u6784\u4f53p\njson.Unmarshal([]byte(j),&amp;p)\n// \u904d\u5386\u8f93\u51fa\u7ed3\u6784\u4f53\u6210\u5458Infos\u7684\u503c\n// \u904d\u5386\u5207\u7247\uff0c\u5207\u7247\u5143\u7d20\u4e3a\u7ed3\u6784\u4f53\nfor _, value := range p.Infos{\nfmt.Printf(\"\u83b7\u53d6Infos\u7684\u503c\uff0c\u540d\u5b57\u4e3a\uff1a%v\\n\", value.Name)\nfmt.Printf(\"\u83b7\u53d6Infos\u7684\u503c\uff0c\u5e74\u9f84\u4e3a\uff1a%v\\n\", value.Age)\n}\n}\n</code></pre> <ul> <li>\u7ed3\u6784\u4f53\u8f6cJSON</li> </ul> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n)\ntype person struct {\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\n// \u6210\u5458infos\u4e3a\u5207\u7247\uff0c\u5207\u7247\u5143\u7d20\u4e3a\u7ed3\u6784\u4f53\nInfos []struct {\nName string `json:\"name\"`\nAge  int    `json:\"age\"`\n} `json:\"infos\"`\n}\nfunc main() {\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\u7c7b\u578b\u7684\u5207\u7247\uff0c\u5e76\u8d4b\u503c\ns := []struct {\nName string `json:\"name\"`\nAge  int    `json:\"age\"`\n}{{Name: \"Tom\", Age: 15}, {Name: \"Lily\", Age: 20}}\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53\u5e76\u8d4b\u503c\np := person{Infos: s}\n// \u8f93\u51fa\u7ed3\u6784\u4f53p\nfmt.Printf(\"\u7ed3\u6784\u4f53p\u4e3a\uff1a%v\\n\", p)\n// \u5c06\u7ed3\u6784\u4f53p\u8f6c\u6362JSON\u5b57\u7b26\u4e32\ndata, _ := json.Marshal(&amp;p)\n// \u8f93\u51faJSON\u5b57\u7b26\u4e32\nfmt.Printf(\"JSON\u6570\u636e\u4e3a\uff1a%v\\n\", string(data))\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#9\u63a5\u53e3","title":"9.\u63a5\u53e3","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#91-\u63a5\u53e3\u5b9a\u4e49","title":"9.1 \u63a5\u53e3\u5b9a\u4e49","text":"<p>\u63a5\u53e3\u7c7b\u578b\u662f\u5bf9\u5176\u4ed6\u7c7b\u578b\u884c\u4e3a\u7684\u6982\u62ec\u4e0e\u62bd\u8c61\uff0c\u5b9a\u4e49\u4e86\u96f6\u53ca\u4ee5\u4e0a\u4e2a\u65b9\u6cd5\uff0c\u4f46\u6ca1\u5177\u4f53\u5b9e\u73b0\u8fd9\u4e9b\u65b9\u6cd5\u3002 \u63a5\u53e3\u672c\u8d28\u4e0a\u662f\u6307\u9488\u7c7b\u578b\uff0c\u53ef\u4ee5\u5b9e\u73b0\u591a\u6001\u3002</p> <pre><code>//\u63a5\u53e3\u5b9a\u4e49\u683c\u5f0f\ntype \u63a5\u53e3\u540d\u79f0 interface {\n    method1(\u53c2\u6570\u5217\u8868) \u8fd4\u56de\u503c\u5217\u8868\n    method2(\u53c2\u6570\u5217\u8868) \u8fd4\u56de\u503c\u5217\u8868\n    //...\n    methodn(\u53c2\u6570\u5217\u8868) \u8fd4\u56de\u503c\u5217\u8868\n}\n</code></pre> <p>\u7a7a\u63a5\u53e3\uff08interface{}\uff09\uff0c\u65e0\u4efb\u4f55\u65b9\u6cd5\u58f0\u660e\uff0c\u7c7b\u4f3c\u9762\u5411\u5bf9\u8c61\u4e2d\u7684\u6839\u7c7b\u578b\uff0cc\u4e2d\u7684void*\uff0c\u9ed8\u8ba4\u503cnil\u3002</p> <p>\u5b9e\u73b0\u63a5\u53e3\u7684\u7c7b\u578b\u652f\u6301\u76f8\u7b49\u8fd0\u7b97\uff0c\u624d\u80fd\u6bd4\u8f83\u3002</p> <pre><code>var var1, var2 interface{}\nfmt.Println(var1 == nil, var1 == var2)\nvar1, var2 = 66, 88\nfmt.Println(var1 == var2)\n</code></pre> <pre><code>//\u6bd4\u8f83map[string]interface{}\nfunc CompareTwoMapInterface(data1 map[string]interface{}, data2 map[string]interface{}) bool {\nkeySlice := make([]string, 0)\ndataSlice1 := make([]interface{}, 0)\ndataSlice2 := make([]interface{}, 0)\nfor key, value := range data1 {\nkeySlice = append(keySlice, key)\ndataSlice1 = append(dataSlice1, value)\n}\nfor _, key := range keySlice {\nif data, ok := data2[key]; ok {\ndataSlice2 = append(dataSlice2, data)\n} else {\nreturn false\n}\n}\ndataStr1, _ := json.Marshal(dataSlice1)\ndataStr2, _ := json.Marshal(dataSlice2)\nreturn string(dataStr1) == string(dataStr2)\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#92-\u63a5\u53e3\u8d4b\u503c","title":"9.2 \u63a5\u53e3\u8d4b\u503c","text":"<p>\u63a5\u53e3\u4e0d\u652f\u6301\u76f4\u63a5\u5b9e\u4f8b\u5316\uff0c\u4f46\u652f\u6301\u8d4b\u503c\u64cd\u4f5c\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u5b9e\u73b0\u63a5\u53e3\u7684\u5bf9\u8c61\u5b9e\u4f8b\u8d4b\u503c\u7ed9\u63a5\u53e3","title":"1.\u5b9e\u73b0\u63a5\u53e3\u7684\u5bf9\u8c61\u5b9e\u4f8b\u8d4b\u503c\u7ed9\u63a5\u53e3","text":"<p>\u8981\u6c42\u8be5\u5bf9\u8c61\u5b9e\u4f8b\u5b9e\u73b0\u4e86\u63a5\u53e3\u7684\u6240\u6709\u65b9\u6cd5\u3002 <pre><code>type Num int\nfunc (x Num) Equal(i Num) bool {\nreturn x == i\n}\nfunc (x Num) LessThan(i Num) bool {\nreturn x &lt; i\n}\nfunc (x Num) MoreThan(i Num) bool {\nreturn x &gt; i\n}\nfunc (x *Num) Multiple(i Num) {\n*x = *x * i\n}\nfunc (x *Num) Divide(i Num) {\n*x = *x / i\n}\ntype NumI interface {\nEqual(i Num) bool\nLessThan(i Num) bool\nMoreThan(i Num) bool\nMultiple(i Num)\nDivide(i Num)\n}\n//&amp;Num\u5b9e\u73b0NumI\u6240\u6709\u65b9\u6cd5\n//Num\u672a\u5b9e\u73b0NumI\u6240\u6709\u65b9\u6cd5\nvar x Num = 8\nvar y NumI = &amp;x\n/*\nGo\u8bed\u8a00\u4f1a\u6839\u636e\u975e\u6307\u9488\u6210\u5458\u65b9\u6cd5\uff0c\u81ea\u52a8\u751f\u6210\u5bf9\u5e94\u7684\u6307\u9488\u6210\u5458\u65b9\u6cd5\nfunc (x Num) Equal(i Num) bool\nfunc (x *Num) Equal(i Num) bool\n*/\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u4e00\u4e2a\u63a5\u53e3\u8d4b\u503c\u7ed9\u53e6\u4e00\u4e2a\u63a5\u53e3","title":"2.\u4e00\u4e2a\u63a5\u53e3\u8d4b\u503c\u7ed9\u53e6\u4e00\u4e2a\u63a5\u53e3","text":"<p>\u4e24\u4e2a\u63a5\u53e3\u62e5\u6709\u76f8\u540c\u7684\u65b9\u6cd5\u5217\u8868\uff08\u4e0e\u987a\u5e8f\u65e0\u5173\uff09\uff0c\u5219\u7b49\u540c\uff0c\u53ef\u76f8\u4e92\u8d4b\u503c\u3002 <pre><code>package oop1\ntype NumInterface1 interface {\nEqual(i int) bool\nLessThan(i int) bool\nBiggerThan(i int) bool\n}\npackage oop2\ntype NumInterface2 interface {\nEqual(i int) bool\nBiggerThan(i int) bool\nLessThan(i int) bool\n}\ntype Num int\n//int\u4e0d\u80fd\u6539\u4e3aNum\nfunc (x Num) Equal(i int) bool {\nreturn int(x) == i\n}\nfunc (x Num) LessThan(i int) bool {\nreturn int(x) &lt; i\n}\nfunc (x Num) BiggerThan(i int) bool {\nreturn int(x) &gt; i\n}\nvar f1 Num = 6\nvar f2 oop1.NumInterface1 = f1\nvar f3 oop2.NumInterface2 = f2\n</code></pre></p> <p>\u82e5\u63a5\u53e3A\u7684\u65b9\u6cd5\u5217\u8868\u662f\u63a5\u53e3B\u7684\u65b9\u6cd5\u5217\u8868\u7684\u5b50\u96c6\uff0c\u5219\u63a5\u53e3B\u53ef\u4ee5\u76f4\u63a5\u8d4b\u503c\u7ed9\u63a5\u53e3A\u3002 <pre><code>type NumInterface1 interface {\nEqual(i int) bool\nLessThan(i int) bool\nBiggerThan(i int) bool\n}\ntype NumInterface2 interface {\nEqual(i int) bool\nBiggerThan(i int) bool\nLessThan(i int) bool\nSum(i int)\n}\ntype Num int\nfunc (x Num) Equal(i int) bool {\nreturn int(x) == i\n}\nfunc (x Num) LessThan(i int) bool {\nreturn int(x) &lt; i\n}\nfunc (x Num) BiggerThan(i int) bool {\nreturn int(x) &gt; i\n}\nfunc (x *Num) Sum(i int) {\n*x = *x + Num(i)\n}\nvar f1 Num = 6\nvar f2 NumInterface2 = &amp;f1\nvar f3 NumInterface1 = f2\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#93-\u63a5\u53e3\u67e5\u8be2","title":"9.3 \u63a5\u53e3\u67e5\u8be2","text":"<p>\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u8be2\u95ee\u63a5\u53e3\u6307\u5411\u7684\u5bf9\u8c61\u662f\u5426\u65f6\u67d0\u4e2a\u7c7b\u578b\u3002 <pre><code>var filewriter Write = ...\nif filew, ok := filewriter.(*File); ok {\n    //...\n}\n</code></pre></p> <pre><code>slice := make([]int, 0)\nslice = append(slice, 6, 7, 8)\nvar I interface{} = slice\nif res, ok := I.([]int); ok {\nfmt.Println(res) //[6 7 8]\nfmt.Println(ok) //true\n}\n</code></pre> <pre><code>func Len(array interface{}) int {\nvar length int\nswitch b := array.(type) {\ncase nil:\nlength = 0\ncase []int:\nlength = len(b)\ncase []string:\nlength = len(b)\ncase []float32:\nlength = len(b)\ndefault:\nlength = 0\n}\nreturn length\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#94-\u63a5\u53e3\u7ec4\u5408","title":"9.4 \u63a5\u53e3\u7ec4\u5408","text":"<p>\u63a5\u53e3\u95f4\u901a\u8fc7\u5d4c\u5957\u521b\u9020\u51fa\u65b0\u63a5\u53e3\u3002 <pre><code>type Interface1 interface {\nWrite(p []byte) (n int, err error)\n}\ntype Interface2 interface {\nClose() error\n}\ntype InterfaceCombine interface {\nInterface1\nInterface2\n}\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#95-\u63a5\u53e3\u5e94\u7528","title":"9.5 \u63a5\u53e3\u5e94\u7528","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u7c7b\u578b\u63a8\u65ad","title":"1.\u7c7b\u578b\u63a8\u65ad","text":"<p>\u7c7b\u578b\u63a8\u65ad\u53ef\u5c06\u63a5\u53e3\u8fd8\u539f\u4e3a\u539f\u59cb\u7c7b\u578b\uff0c\u6216\u7528\u6765\u5224\u65ad\u662f\u5426\u5b9e\u73b0\u4e86\u67d0\u79cd\u66f4\u5177\u4f53\u7684\u63a5\u53e3\u7c7b\u578b\u3002</p> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nvar a interface{} = func(a int) string {\nrteurn fmt.Sprintf(\"d:%d\", a)\n}\nswitch b := a.(type) {\ncase nil:\nfmt.Println(\"nil\")\ncase *int:\nfmt.Println(*b)\ncase func(int) string:\nfmt.Println(b(66))\ncase fmt.Stringer:\nfmt.Println(b)\ndefault:\nfmt.Println(\"unknown\")\n}\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u5b9e\u73b0\u591a\u6001\u529f\u80fd","title":"2.\u5b9e\u73b0\u591a\u6001\u529f\u80fd","text":"<pre><code>package main\nimport \"fmt\"\ntype Message interface {\nsending()\n}\ntype User struct {\nname string\nphone string\n}\nfunc (u *User) sending() {\nfmt.Printf(\"Sending user phone to %s&lt;%s&gt;\\n\", u.name, u.phone)\n}\ntype admin struct {\nname string\nphone string\n}\nfunc (a *admin) sending() {\nfmt.Printf(\"Sending admin phone to %s&lt;%s&gt;\\n\", a.name, a.phone)\n}\nfunc main() {\nbill := User{\"Barry\", \"barry@gmail.com\"}\nsendMessage(&amp;bill)\nlisa := admin{\"Barry\", \"barry@gmail.com\"}\nsendMessage(&amp;lisa)\n}\nfunc sendMessage(n Message) {\nn.sending()\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#10\u53cd\u5c04","title":"10.\u53cd\u5c04","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#101-\u53cd\u5c04\u7684\u5b9a\u4e49","title":"10.1 \u53cd\u5c04\u7684\u5b9a\u4e49","text":"<p>\u53cd\u5c04\u6307\uff0c\u7f16\u8bd1\u65f6\u4e0d\u77e5\u9053\u53d8\u91cf\u7684\u5177\u4f53\u7c7b\u578b\uff0c\u8fd0\u884c\u65f6\uff08Run time\uff09\u53ef\u4ee5\u8bbf\u95ee\u3001\u68c0\u6d4b\u548c\u4fee\u6539\u72b6\u6001\u6216\u884c\u4e3a\u7684\u80fd\u529b\u3002</p> <p>reflect\u5305\u5b9a\u4e49\u4e86\u63a5\u53e3\u548c\u7ed3\u6784\u4f53\uff0c\u83b7\u53d6\u7c7b\u578b\u4fe1\u606f\u3002</p> <ul> <li>reflect.Type\u63a5\u53e3\u63d0\u4f9b\u7c7b\u578b\u4fe1\u606f</li> <li>reflect.Value\u7ed3\u6784\u4f53\u63d0\u4f9b\u503c\u76f8\u5173\u4fe1\u606f\uff0c\u53ef\u4ee5\u83b7\u53d6\u751a\u81f3\u6539\u53d8\u7c7b\u578b\u7684\u503c</li> </ul> <pre><code>func TypeOf(i interface{}) Type\nfunc ValueOf(i interface{}) Value\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#102-\u53cd\u5c04\u7684\u4e09\u5927\u6cd5\u5219","title":"10.2 \u53cd\u5c04\u7684\u4e09\u5927\u6cd5\u5219","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u63a5\u53e3\u7c7b\u578b\u53d8\u91cf\u8f6c\u6362\u4e3a\u53cd\u5c04\u7c7b\u578b\u5bf9\u8c61","title":"1.\u63a5\u53e3\u7c7b\u578b\u53d8\u91cf\u8f6c\u6362\u4e3a\u53cd\u5c04\u7c7b\u578b\u5bf9\u8c61","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"reflect\"\n)\nfunc main() {\nvar x float64 = 3.4\nfmt.Println(\"type:\", reflect.TypeOf(x))\nfmt.Println(\"value:\", reflect.ValueOf(x))\nv := reflect.ValueOf(x)\nfmt.Println(\"type:\", v.Type())\nfmt.Println(\"kind is float64:\", v.Kind() == reflect.Float64)\nfmt.Println(\"value:\", v.Float())\n}\n//\u8f93\u51fa\n//type: float64\n//value: 3.4\n//kind is float64: true\n//type: float64\n//value: 3.4\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u53cd\u5c04\u7c7b\u578b\u5bf9\u8c61\u8f6c\u6362\u4e3a\u63a5\u53e3\u7c7b\u578b\u53d8\u91cf","title":"2.\u53cd\u5c04\u7c7b\u578b\u5bf9\u8c61\u8f6c\u6362\u4e3a\u63a5\u53e3\u7c7b\u578b\u53d8\u91cf","text":"<pre><code>func (v Value) Interface() interface{}\ny := v.Interface().(float64)\nfmt.Println(y)\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"reflect\"\n)\nfunc main() {\nvar name interface{} = \"shirdon\"\nfmt.Printf(\"\u539f\u59cb\u63a5\u53e3\u53d8\u91cf\u7c7b\u578b\u4e3a%T\uff0c\u503c\u4e3a%v\\n\", name, name)\nt := reflect.TypeOf(name)\nv := reflect.ValueOf(name)\nfmt.Printf(\"Type\u7c7b\u578b\u4e3a%T\uff0c\u503c\u4e3a%v\\n\", t, t)\nfmt.Printf(\"Value\u7c7b\u578b\u4e3a%T\uff0c\u503c\u4e3a%v\\n\", v, v)\ni := v.Interface()\nfmt.Printf(\"\u65b0\u5bf9\u8c61interface{}\u7c7b\u578b\u4e3a%T\uff0c\u503c\u4e3a%v\\n\", i, i)\n}\n//\u8f93\u51fa\n//\u539f\u59cb\u63a5\u53e3\u53d8\u91cf\u7c7b\u578b\u4e3astring\uff0c\u503c\u4e3ashirdon\n//Type\u7c7b\u578b\u4e3a*reflect.rtype\uff0c\u503c\u4e3astring\n//Value\u7c7b\u578b\u4e3areflect.Value\uff0c\u503c\u4e3ashirdon\n//\u65b0\u5bf9\u8c61interface{}\u7c7b\u578b\u4e3astring\uff0c\u503c\u4e3ashirdon\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3\u4fee\u6539\u53cd\u5c04\u7c7b\u578b\u5bf9\u8c61\u5176\u503c\u5fc5\u987b\u662f\u53ef\u5199\u7684settable","title":"3.\u4fee\u6539\u53cd\u5c04\u7c7b\u578b\u5bf9\u8c61\uff0c\u5176\u503c\u5fc5\u987b\u662f\u53ef\u5199\u7684\uff08settable\uff09","text":"<p>reflect.TypeOf()\u548creflect.ValueOf()\u51fd\u6570\u4e2d\u82e5\u4f20\u9012\u7684\u4e0d\u662f\u6307\u9488\uff0c\u5219\u53ea\u662f\u53d8\u91cf\u590d\u5236\uff0c\u5bf9\u8be5\u53cd\u5c04\u5bf9\u8c61\u4fee\u6539\uff0c\u4e0d\u4f1a\u5f71\u54cd\u539f\u59cb\u53d8\u91cf\u3002 \u53cd\u5c04\u5bf9\u8c61\u53ef\u5199\u6027\u8981\u70b9:</p> <ul> <li>\u53d8\u91cf\u6307\u9488\u521b\u5efa\u7684\u53cd\u5c04\u5bf9\u8c61</li> <li>CanSet()\u53ef\u5224\u65ad</li> <li>Elem()\u8fd4\u56de\u6307\u9488\u6307\u5411\u7684\u6570\u636e</li> </ul> <pre><code>package main\nimport (\n\"fmt\"\n\"reflect\"\n)\nfunc main() {\nvar name string = \"shirdon\"\n//var name int = 12\nv1 := reflect.ValueOf(&amp;name)\nv2 := v1.Elem()\nfmt.Println(\"\u53ef\u5199\u6027:\", v1.CanSet())\nfmt.Println(\"\u53ef\u5199\u6027:\", v2.CanSet())\n}\n//\u8f93\u51fa\n//\u53ef\u5199\u6027\uff1afalse\n//\u53ef\u5199\u6027\uff1atrue\n</code></pre> <pre><code>func (v Value) SetBool(x bool)\nfunc (v Value) SetBytes(x []byte)\nfunc (v Value) SetFloat(x float64)\nfunc (v Value) SetInt(x int64)\nfunc (v Value) SetString(x string)\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"reflect\"\n)\nfunc main() {\nvar name string = \"shirdon\"\nfmt.Println(\"name\u539f\u59cb\u503c:\", name)\nv1 := reflect.ValueOf(&amp;name)\nv2 := v1.Elem()\nv2.SetString(\"yx\")\nfmt.Println(\"\u53cd\u5c04\u5bf9\u8c61\u4fee\u6539\u540e\uff0cname\u503c:\", name)\n}\n//\u8f93\u51fa\n//name\u539f\u59cb\u503c: shirdon\n//\u53cd\u5c04\u5bf9\u8c61\u4fee\u6539\u540e\uff0cname\u503c: yx\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#11goroutine","title":"11.goroutine","text":"<p>\u5728Go\u8bed\u8a00\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u5e76\u53d1\u6267\u884c\u7684\u6d3b\u52a8\u53ebgoroutine\u3002\u4f7f\u7528go \u5173\u952e\u5b57\u53ef\u521b\u5efagoroutine\u3002\u5f62\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>go func_name()\n</code></pre> <p>\u5148\u5c06go\u5173\u952e\u5b57\u58f0\u660e\u653e\u5230\u4e00\u4e2a\u9700\u8981\u8c03\u7528\u7684\u51fd\u6570\u4e4b\u524d\uff0c\u7136\u540e\u5728\u76f8\u540c\u5730\u5740\u7a7a\u95f4\u8c03\u7528\u8fd0\u884c\u8fd9\u4e2a\u51fd\u6570\uff0c\u8fd9\u6837\u8be5\u51fd\u6570\u6267\u884c\u65f6\u4fbf\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u5e76\u53d1\u7ebf\u7a0b\u3002 \u8fd9\u79cd\u7ebf\u7a0b\u5728Go\u8bed\u8a00\u4e2d\u5219\u88ab\u79f0\u4e3agoroutine\u3002</p> <p>goroutine\u7684\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\uff1a</p> <p><pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc HelloWorld() {\nfmt.Println(\"this is a goroutine msg\")\n}\nfunc main() {\ngo HelloWorld()\ntime.Sleep(1 * time.Second)\nfmt.Println(\"end\")\n}\n</code></pre> goroutine\u5728\u591a\u6838CPU\u73af\u5883\u4e0b\u662f\u5e76\u884c\u7684\u3002\u5982\u679c\u4ee3\u7801\u5757\u5728\u591a\u4e2agoroutine\u4e2d\u6267\u884c\uff0c\u5219\u5b9e\u73b0\u4e86\u4ee3\u7801\u7684\u5e76\u884c\u3002</p> <p>goroutine\u662fGo\u8bed\u8a00\u6700\u91cd\u8981\u7684\u7279\u6027\u4e4b\u4e00\uff0c\u540c\u65f6\u4e5f\u662f\u4e00\u4e2a\u96be\u70b9\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#12\u5355\u5143\u6d4b\u8bd5go-test","title":"12.\u5355\u5143\u6d4b\u8bd5(go test)","text":"<p>Go\u8bed\u8a00\u5728\u8bbe\u8ba1\u4e4b\u521d\u5c31\u8003\u8651\u5230\u4e86\u4ee3\u7801\u7684\u53ef\u6d4b\u8bd5\u6027\u3002</p> <p>Go\u8bed\u8a00\u63d0\u4f9b\u4e86testing\u5e93\u7528\u4e8e\u5355\u5143\u6d4b\u8bd5\uff0cgo test\u662fGo\u8bed\u8a00\u7684\u7a0b\u5e8f\u6d4b\u8bd5\u5de5\u5177\u3002</p> <p>\u5728\u76ee\u5f55\u4e0b\uff0c\u5b83\u4ee5*_test.go\u7684\u6587\u4ef6\u5f62\u5f0f\u5b58\u5728\uff0c\u4e14go build\u4e0d\u4f1a\u5c06\u5176\u7f16\u8bd1\u6210\u4e3a\u6784\u5efa\u7684\u4e00\u90e8\u5206\u3002</p> <pre><code>//sum.go\npackage testexample\nfunc Min(arr []int) (min int) { //\u83b7\u53d6\u6574\u578b\u6570\u7ec4\u4e2d\u7684\u6700\u5c0f\u503c\nmin = arr[0]\nfor _, v := range arr {\nif v &lt; min {\nmin = v\n}\n}\nreturn\n}\n// Hello ...\nfunc Hello() string {\nreturn \"Hello World\"\n}\n// world ...\nfunc world() string {\nreturn \"world\"\n}\n// Add ...\nfunc Add(v1 int, v2 int) int {\nreturn v1 + v2\n}\n// FloatToString ...\nfunc FloatToString(f1 float64, f2 float64) string {\nreturn strconv.FormatFloat(f1/f2*100, 'f', 2, 32) + \"%\"\n}\n</code></pre> <pre><code>//sum_test.go\npackage testexample\nimport (\n\"fmt\"\n\"testing\"\n)\nfunc TestMin(t *testing.T) {\narray := []int{6, 8, 10}\nret := Min(array)\nfmt.Println(ret)\n}\nfunc TestHello(t *testing.T) {\nresult := Hello()\nwant := \"Hello World\"\nif result == want {\nt.Logf(\"Hello() = %v, want %v\", result, want)\n} else {\nt.Errorf(\"Hello() = %v, want %v\", result, want)\n}\nwant2 := \"Hello World\"\nif result == want2 {\nt.Logf(\"Hello() = %v, want %v\", result, want)\n} else {\nt.Errorf(\"Hello() = %v, want %v\", result, want)\n}\n}\nfunc testHello(expected string) func(t *testing.T) {\nreturn func(t *testing.T) {\nif expected == \"Hello World\" {\nt.Logf(\"Hello() = %v, want = %v\", expected, \"Hello World\")\n} else {\nt.Errorf(\"Hello() = %v, want = %v\", expected, \"Hello World\")\n}\n}\n}\nfunc TestHello2(t *testing.T) {\nt.Run(\"test for hello with run\", testHello(Hello()))\n}\nfunc TestHelloWithTable(t *testing.T) {\ntests := []struct {\nname string\nwant string\n}{\n// TODO: Add test cases.\n{\nname: \"test for hello\",\nwant: \"Hello World\",\n},\n}\nfor _, tt := range tests {\nt.Run(tt.name, func(t *testing.T) {\nif got := Hello(); got != tt.want {\nt.Errorf(\"Hello() = %v, want %v\", got, tt.want)\n}\n})\n}\n}\nfunc ExampleHello() {\nfmt.Println(Hello())\n// Output:\n// Hello World\n}\nfunc TestMain(m *testing.M) {\nfmt.Println(\"Before ====================\")\ncode := m.Run()\nfmt.Println(\"End ====================\")\nos.Exit(code)\n}\nfunc Test_world(t *testing.T) {\ntests := []struct {\nname string\nwant string\n}{\n// TODO: Add test cases.\n{},\n}\nfor _, tt := range tests {\nt.Run(tt.name, func(t *testing.T) {\nif got := world(); got != tt.want {\nt.Logf(\"world() = %v, want %v\", got, tt.want)\n}\n})\n}\n}\nfunc TestAdd(t *testing.T) {\ntype args struct {\nv1 int\nv2 int\n}\ntests := []struct {\nname string\nargs args\nwant int\n}{\n// TODO: Add test cases.\n{\nname: \"Add\",\nargs: args{1, 2},\nwant: 3,\n},\n}\nfor _, tt := range tests {\nt.Run(tt.name, func(t *testing.T) {\nif got := Add(tt.args.v1, tt.args.v2); got != tt.want {\nt.Errorf(\"Add() = %v, want %v\", got, tt.want)\n}\n})\n}\n}\nfunc TestFloatToString(t *testing.T) {\ntype args struct {\nf1 float64\nf2 float64\n}\ntests := []struct {\nname string\nargs args\nwant string\n}{\n// TODO: Add test cases.\n{\nname: \"float to string\",\nargs: args{1.0, 3.0},\nwant: \"33.33%\",\n},\n}\nfor _, tt := range tests {\nt.Run(tt.name, func(t *testing.T) {\nif got := FloatToString(tt.args.f1, tt.args.f2); got != tt.want {\nt.Errorf(\"FloatToString() = %v, want %v\", got, tt.want)\n}\n})\n}\n}\nfunc ExampleAdd() {\nfmt.Println(Add(100, 200))\n// Output:\n// 300\n}\n</code></pre> <p>\u6ce8\u610f\uff0c\u6587\u4ef6\u540d\u5fc5\u987b\u662fname_test.go\u683c\u5f0f\uff0c\u6d4b\u8bd5\u51fd\u6570\u540d\u79f0\u5fc5\u987b\u4ee5Test\u5f00\u5934\uff0c\u4f20\u5165\u53c2\u6570\u5fc5\u987b\u662f*testing.T\u3002</p> <p>\u683c\u5f0f\u5982\u4e0b\uff1a </p> <pre><code>func TestName(t *testing.T){\n//...\n}\n</code></pre> <p>\u8fd0\u884c\u6d4b\u8bd5\u7a0b\u5e8f</p> <pre><code># \u6267\u884c\u6574\u4e2a\u9879\u76ee\u6d4b\u8bd5\u6587\u4ef6\ngo test\n# \u67e5\u770b\u8be6\u7ec6\u8fd0\u884c\u7ed3\u679c\ngo test -v\n\n# \u53c2\u6570run\u5bf9\u5e94\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u7684\u51fd\u6570\u624d\u4f1a\u88ab\"go test\"\u547d\u4ee4\u8fd0\u884c\u3002\ngo test -v -run=\"Test\"\n</code></pre> <p>\"go test\"\u547d\u4ee4\u8fd8\u53ef\u4ee5\u4ece\u4e3b\u4f53\u4e2d\u5206\u79bb\u51fa\u6765\u751f\u6210\u72ec\u7acb\u7684\u6d4b\u8bd5\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u56e0\u4e3a\"go test\"\u547d\u4ee4\u4e2d\u5305\u542b\u4e86\u7f16\u8bd1\u52a8\u4f5c\uff0c\u6240\u4ee5\u5b83\u53ef\u4ee5\u63a5\u53d7\u53ef\u7528\u4e8e\"go build\"\u547d\u4ee4\u7684\u6240\u6709\u53c2\u6570\u3002</p> <p>\"go test\"\u547d\u4ee4\u5e38\u89c1\u53c2\u6570\u7684\u4f5c\u7528\u89c1\u88681-5\u3002</p> \u53c2\u6570 \u4f5c\u7528 -v \u6253\u5370\u6bcf\u4e2a\u6d4b\u8bd5\u51fd\u6570\u7684\u540d\u5b57\u548c\u8fd0\u884c\u65f6\u95f4 -c \u751f\u6210\u6d4b\u8bd5\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4f46\u4e0d\u6267\u884c\uff0c\u9ed8\u8ba4\u547d\u540dpkg.test -i \u91cd\u65b0\u5b89\u88c5\u8fd0\u884c\u6d4b\u8bd5\u4f9d\u8d56\u5305\uff0c\u4f46\u4e0d\u7f16\u8bd1\u548c\u8fd0\u884c\u6d4b\u8bd5\u4ee3\u7801 -o \u6307\u5b9a\u751f\u6210\u6d4b\u8bd5\u53ef\u6267\u884c\u6587\u4ef6\u7684\u540d\u79f0 <p>\u4f8b\u5982\uff0c\u751f\u6210\u7528\u4e8e\u6d4b\u8bd5\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\uff1a </p> <pre><code>go test -c </code></pre> <p>\u8fd0\u884c\u201cgo test\u201d\u547d\u4ee4\u751f\u6210\u6307\u5b9a\u540d\u5b57\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u7684\u793a\u4f8b\u5982\u4e0b\u3002 </p> <pre><code>go test -v -o testexample.test\n</code></pre> <p>\u8fd0\u884c\u547d\u4ee4\u540e\uff0c\u4f1a\u5728\u9879\u76ee\u6240\u5728\u76ee\u5f55\u751f\u6210\u4e00\u4e2a\u540d\u4e3atestexample.test\u7684\u6587\u4ef6\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#13-go\u7f16\u8bd1\u4e0e\u5de5\u5177","title":"13. Go\u7f16\u8bd1\u4e0e\u5de5\u5177","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#131-\u7f16\u8bd1go-build","title":"13.1 \u7f16\u8bd1(go build)","text":"<p>Go\u8bed\u8a00\u4e2d\"go build\"\u547d\u4ee4\u4e3b\u8981\u7528\u4e8e\u7f16\u8bd1\u4ee3\u7801\u3002</p> <p>\u5728\u5305\u7684\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\uff0c\u82e5\u6709\u5fc5\u8981\uff0c\u5219\u4f1a\u540c\u65f6\u7f16\u8bd1\u4e0e\u4e4b\u76f8\u5173\u8054\u7684\u5305\u3002\u201cgo build'\u201d\u547d\u4ee4\u6709\u5f88\u591a\u79cd\u7f16\u8bd1\u65b9\u6cd5\uff0c\u5982\u65e0\u53c2\u6570\u7f16\u8bd1\u3001\u6587\u4ef6\u5217\u8868\u7f16\u8bd1\u3001\u6307\u5b9a\u5305\u7f16\u8bd1\u7b49\uff0c\u4f7f\u7528\u8fd9\u4e9b \u65b9\u6cd5\u90fd\u53ef\u4ee5\u8f93\u51fa\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u6ce8\u610f\uff1a\u5728windows\u4e2d\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u540e\u7f00\u4e3a.exe\u6587\u4ef6\uff0cLinux\u4e2d\u65e0\u540e\u7f00\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1-\u65e0\u53c2\u6570\u7f16\u8bd1","title":"1. \u65e0\u53c2\u6570\u7f16\u8bd1","text":"<pre><code>//build\n//----main.go\n//----utils.go\n//main.go\npackage main\nimport (\n\"fmt\"\n)\nfunc main() {\nprintString()\nfmt.Println(\"go build\")\n}\n</code></pre> <pre><code>//utils.go\npackage main\nimport \"fmt\"\nfunc printString() {\nfmt.Println(\"test\")\n}\n</code></pre> <pre><code>cd build\ngo build\n# \u8fd0\u884c\u4ee5\u4e0a\u547d\u4ee4\uff0c\u6587\u4ef6\u5939\u4f1a\u751f\u6210\u4e00\u4e2abuild\u7684\u6587\u4ef6\uff0cwindows\u4e2d\u4e3abuild.exe\n$ ./build this is a go build test call!\nI love go build!\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2-\u6587\u4ef6\u5217\u8868\u7f16\u8bd1","title":"2. \u6587\u4ef6\u5217\u8868\u7f16\u8bd1","text":"<p>\u5728\u7f16\u8bd1\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b\u7684\u591a\u4e2a\u6e90\u7801\u6587\u4ef6\u65f6\uff0c\u53ef\u4ee5\u5728\u201cgo build\u201d\u547d\u4ee4\u7684\u540e\u9762\u52a0\u4e0a\u591a\u4e2a\u6587\u4ef6\u540d\u3002</p> <p>\u201cgo build'\u201d\u547d\u4ee4\u4f1a\u7f16\u8bd1\u8fd9\u4e9b\u6e90\u7801\uff0c\u8f93\u51fa\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u201cgo build-+\u6587\u4ef6\u5217\u8868\u201d\u7684\u683c\u5f0f\u5982\u4e0b\uff1a </p> <p><pre><code>go build filel.go file2.go......\n</code></pre> \u4f8b\u5982\uff0c\u5728\u4ee3\u7801\u6240\u5728\u6839\u76ee\u5f55\uff08chapter1/build)\u4e2d\u8fd0\u884c\u201cgo build'\u201d\u547d\u4ee4\uff0c\u5728\u201cgo build\u201d\u547d\u4ee4\u540e\u6dfb\u52a0\u8981\u7f16\u8bd1\u7684\u6e90\u7801\u7684\u6587\u4ef6\u540d\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p><pre><code>go build main.go utils.go\n</code></pre> \u5728Linux\u4e2d\u8fd0\u884c\u4ee5\u4e0a\u547d\u4ee4\u540e\uff0c\u8be5\u76ee\u5f55\u4e0b\u6709\u5982\u4e0b\u6587\u4ef6\uff1abuild\u3001utils.go\u3001main\u3001main.go\u3002</p> <p>\u5728\u4f7f\u7528\u201cgo buid+\u6587\u4ef6\u5217\u8868\u201d\u65b9\u5f0f\u7f16\u8bd1\u65f6\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u9ed8\u8ba4\u9009\u62e9\u6587\u4ef6\u5217\u8868\u4e2d\u7b2c1\u4e2a\u6e90\u7801\u6587\u4ef6\u5c06\u4f5c\u4e3a\u53ef\u6267\u884c\u6587\u4ef6\u540d\u8f93\u51fa\u3002</p> <p>\u5982\u679c\u9700\u8981\u6307\u5b9a\u8f93\u51fa\u53ef\u6267\u884c\u6587\u4ef6\u540d\uff0c\u5219\u9700\u8981\u4f7f\u7528-o\u53c2\u6570\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a <pre><code>go build main.go utils.go\n# \u8fd0\u884c\u4ee5\u4e0a\u547d\u4ee4\uff0c\u6587\u4ef6\u5939\u4f1a\u751f\u6210\u4e00\u4e2amain\u7684\u6587\u4ef6\uff0cwindows\u4e2d\u4e3amain.exe\ngo build -o file main.go utils.go\n$ ./file this is a go build test call!\nI love go build!\n</code></pre> \u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5728\u201cgo build\u201d\u548c\u6587\u4ef6\u5217\u8868\u4e2d\uff0c\u63d2\u5165\u4e86\u4e00\u4e2a-o file\u53c2\u6570\uff0c\u8868\u793a\u6307\u5b9a\u8f93\u51fa\u6587\u4ef6\u540d\u4e3afile\u3002</p> <p>\u6ce8\u610f\uff1a \u4f7f\u5728\u7528\u201cgo build+\u6587\u4ef6\u5217\u8868\u201d.\u7f16\u8bd1\u65b9\u5f0f\u7f16\u8bd1\u65f6\uff0c\u6587\u4ef6\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u5fc5\u987b\u662f\u540c\u4e00\u4e2a\u5305\u7684Go\u6e90\u7801\u3002\u5373\u4e0d\u80fd\u50cfC++\u90a3\u6837\u5c06\u6240\u6709\u5de5\u7a0b\u7684Go\u6e90\u7801\u4f7f\u7528\u6587\u4ef6\u5217\u8868\u65b9\u5f0f\u8fdb\u884c\u7f16\u8bd1\u3002 \u5728\u7f16\u8bd1\u590d\u6742\u5de5\u7a0b\u65f6\u9700\u8981\u91c7\u7528\u201c\u6307\u5b9a\u5305\u7f16\u8bd1\u201d\u7684\u65b9\u5f0f</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3-\u6307\u5b9a\u5305\u7f16\u8bd1","title":"3. \u6307\u5b9a\u5305\u7f16\u8bd1","text":"<p>\u201cgo build + \u6587\u4ef6\u5217\u8868\u201d\u7684\u65b9\u5f0f\u9002\u5408\u7f16\u8bd1\u5c11\u91cf\u6587\u4ef6\u7684\u60c5\u666f\u3002</p> <p>\u800c\"go build + \u5305\"\u5728\u8bbe\u7f6eGOPATH\u4e4b\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u6839\u636e\u5305\u540d\u8fdb\u884c\u7f16\u8bd1\uff0c\u5373\u4f7f\u5305\u5185\u6587\u4ef6\u88ab\u589e\u52a0\u6216\u8005\u5220\u9664\u4e5f\u4e0d\u5f71\u54cd\u7f16\u8bd1\u6307\u4ee4\u3002</p> <p>\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\uff0c\u4ee3\u7801\u76ee\u5f55\u7ed3\u6784\u5173\u7cfb\u5982\u4e0b\uff1a <pre><code>\u251c\u2500\u2500 build\n  \u251c\u2500\u2500 pkg\n  \u2502\u00a0\u00a0 \u251c\u2500\u2500 buildpkg.go\n  \u2502\u00a0\u00a0 \u251c\u2500\u2500 mainpkg.go\n  \u2502\u00a0\u00a0 \u2514\u2500\u2500 pkg\n</code></pre></p> <pre><code>//pkg\n//----mainpkg.go\n//----buildpkg.go\n//mainpkg.go\npackage main\nimport (\n\"fmt\"\n\"pkg\"\n)\nfunc main() {\npkg.CallFunc()\nfmt.Println(\"go build\")\n}\n//buildpkg.go\npackage pkg\nimport \"fmt\"\nfunc CallFunc() {\nfmt.Println(\"test\")\n}\n//go build .../pkg\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#4-\u4ea4\u53c9\u7f16\u8bd1","title":"4. \u4ea4\u53c9\u7f16\u8bd1","text":"<p>(1) \u521b\u5efa\u4e00\u4e2a\u540d\u4e3acompole.go\u7684\u6587\u4ef6 <pre><code>//compile.go\npackage main\nimport (\n\"fmt\"\n)\nfunc main() {\nfmt.Println(\"go build\")\n}\n</code></pre></p> <p>(2) \u5982\u679cMac OS X\u7cfb\u7edf\u4e2d\u7f16\u8bd164\u4f4d\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e3a\u4e86\u8ba9\u5b83\u80fd\u591f\u5728Linux\u7cfb\u7edf\u4e2d\u4e5f\u53ef\u4ee5\u6267\u884c\uff0c\u5219\u7f16\u8bd1\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>CGO_ENABLED=1 GOOS=linux GOARCH=amd64 go build compile.go\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u8fd9\u6bb5\u4ee3\u7801\u53ef\u4ee5\u751f\u621064\u4f4d\u7684\uff0c\u80fd\u591f\u5728Linux\u7cfb\u7edf\u4e2d\u53ef\u6267\u884c\u7684\u6587\u4ef6\uff0c\u8fd9\u91cc\u7528\u5230\u4e862\u4e2a\u53d8\u91cf\u3002</p> <ul> <li>CGO_ENABLED: \u662f\u5426\u4f7f\u7528C\u8bed\u8a00\u7684Go\u7f16\u8bd1\u5668\uff1b0\u5173\u95ed\uff0c1\u5f00\u542f</li> <li>GOOS\uff1a\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf</li> <li>GOARCH\uff1a\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u7684\u67b6\u6784</li> </ul> <p>\u5982\u679c\u8981\u7f16\u8bd1\u5176\u4ed6\u5e73\u53f0\u4e2d\u53ef\u6267\u884c\u7684\u6587\u4ef6\uff0c  \u6839\u636e\u5982\u4e0b\u8868\u6267\u884c\u7f16\u8bd1\u5373\u53ef\u3002</p> \u7cfb\u7edf\u7f16\u8bd1\u53c2\u6570 \u67b6\u6784 linux(&gt;=Linux 2.6) 386/amd64/arm darwin(OS X(Snow Lepoard + Lion)) 386/amd64 freebsd(&gt;=FreeBSD 7) 386/amd64 windows(&gt;=Windows 2000) 386/amd64 <p>\u901a\u8fc7\u4e0b\u9762\u7684\u7f16\u8bd1\u547d\u4ee4\uff0c\u53ef\u4ee5\u751f\u6210\u5728windows\u7cfb\u7edf\u4e2d\u53ef\u4ee5\u6267\u884c\u7684\u6587\u4ef6\uff1a <pre><code>CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build compile.go\n</code></pre></p> <p>\u63d0\u793a\uff1a</p> <p>1.5\u7248\u672c\u4e4b\u540e\uff0cGo\u8bed\u8a00\u5c31\u5f00\u59cb\u4f7f\u7528\u201c\u7528Go\u8bed\u8a00\u7f16\u5199\u7684\u7f16\u8bd1\u5668\u201d\u8fdb\u884c\u7f16\u8bd1\u3002 \u5728Go\u8bed\u8a001.9\u53ca\u4ee5\u540e\u7684\u7248\u672c\u4e2d\uff0c\u5982\u679c\u4e0d\u4f7f\u7528CGO ENABLED\u53c2\u6570\uff0c\u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u7f16\u8bd1\u3002 \u5f53\u7136\u4f7f\u7528\u4e86\u4e5f\u53ef\u4ee5\u6b63\u5e38\u7f16\u8bd1\u3002\u6bd4\u5982\u628aCGO ENABLED\u53c2\u6570\u8bbe\u7f6e\u62101\uff08\u5373\u5728\u7f16\u8bd1\u7684\u8fc7\u7a0b\u5f53\u4e2d\u4f7f\u7528CGO\u7f16\u8bd1\u5668\uff09\uff0c\u4f9d\u7136\u662f\u53ef\u4ee5\u6b63\u5e38\u7f16\u8bd1\u7684\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5982\u679c\u5728Go\u4e2d\u4f7f\u7528\u4e86C\u8bed\u8a00\u7684\u5e93\uff0c\u5219\u9ed8\u8ba4\u5728\u4f7f\u7528\u201cgo build'\u201d\u547d\u4ee4\u65f6\u5c31\u4f1a\u542f\u52a8CGO\u7f16\u8bd1\u5668\u3002\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528CGO_ENABLED\u6765\u63a7\u5236\u201cgo build\u201d\u547d\u4ee4\u662f\u5426\u4f7f\u7528CGO\u7f16\u8bd1\u5668\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#5-\u7f16\u8bd1\u65f6\u7684\u9644\u52a0\u53c2\u6570","title":"5. \u7f16\u8bd1\u65f6\u7684\u9644\u52a0\u53c2\u6570","text":"\u9644\u52a0\u53c2\u6570 \u4f5c\u7528 -v \u7f16\u8bd1\u65f6\u663e\u793a\u5305\u540d -p n \u5f00\u542f\u5e76\u53d1\u7f16\u8bd1\uff0c\u9ed8\u8ba4\u503c\u4e3aCPU\u903b\u8f91\u6838\u6570 -a \u5f3a\u5236\u91cd\u65b0\u6784\u5efa -n \u6253\u5370\u7f16\u8bd1\u65f6\u4f1a\u7528\u5230\u7684\u6240\u6709\u547d\u4ee4\uff0c\u4f46\u4e0d\u771f\u6b63\u6267\u884c -x \u6253\u5370\u7f16\u8bd1\u65f6\u4f1a\u7528\u5230\u7684\u6240\u6709\u547d\u4ee4 -race \u5f00\u542f\u7ade\u6001\u68c0\u6d4b"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#132-\u7f16\u8bd1\u540e\u8fd0\u884cgo-run","title":"13.2 \u7f16\u8bd1\u540e\u8fd0\u884c(go run)","text":"<p>Go\u8bed\u8a00\u867d\u7136\u4e0d\u4f7f\u7528\u865a\u62df\u673a\uff0c\u4f46\u53ef\u4ee5\u4f7f\u7528\"go run\"\u547d\u4ee4\u8fbe\u5230\u540c\u6837\u7684\u6548\u679c\uff0c</p> <p>\u7f16\u8bd1\u540e\u76f4\u63a5\u8fd0\u884cmain()\u51fd\u6570\uff0c\u4e14\u4e0d\u4fdd\u7559\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <pre><code>//hello.go\npackage main\nimport (\n\"fmt\"\n)\nfunc main() {\nfmt.Println(\"go run\")\n}\n//go run hello.go\n</code></pre> <p>\"go run\"\u547d\u4ee4\u4e0d\u4f1a\u5728\u8fd0\u884c\u76ee\u5f55\u4e0b\u751f\u6210\u4efb\u4f55\u6587\u4ef6\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u88ab\u653e\u5728\u4e34\u65f6\u6587\u4ef6\u4e2d\u88ab\u6267\u884c\uff0c\u5de5\u4f5c\u76ee\u5f55\u88ab\u8bbe\u7f6e\u4e3a\u5f53\u524d\u76ee\u5f55\uff0c\"go run\"\u547d\u4ee4\u540e\u8fb9\u53ef\u4ee5\u6dfb\u52a0\u53c2\u6570\uff0c\u8fd9\u90e8\u5206\u53c2\u6570\u53ef\u4ee5 \u4f5c\u4e3a\u4ee3\u7801\u53ef\u4ee5\u63a5\u53d7\u7684\u547d\u4ee4\u884c\u8f93\u5165\u63d0\u4f9b\u7ed9\u7a0b\u5e8f\u3002</p> <p>\"go run\"\u547d\u4ee4\u4e0d\u80fd\u91c7\u7528\"go run+\u5305\"\u7684\u65b9\u5f0f\u8fdb\u884c\u7f16\u8bd1\u3002</p> <p>\u5982\u679c\u9700\u5feb\u901f\u7f16\u8bd1\u8fd0\u884c\u5305\uff0c\u5219\u5e94\u91c7\u7528\u5982\u4e0b\u6b65\u9aa4\u6765\u4ee3\u66ff\uff1a</p> <ol> <li>\u4f7f\u7528\"go build\"\u547d\u4ee4\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002</li> <li>\u8fd0\u884c\u53ef\u6267\u884c\u6587\u4ef6\u3002</li> </ol>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#133-\u7f16\u8bd1\u5e76\u5b89\u88c5go-install","title":"13.3 \u7f16\u8bd1\u5e76\u5b89\u88c5(go install)","text":"<p>\u7c7b\u4f3cgo build\uff0c\u53ea\u662f\u7f16\u8bd1\u4e2d\u95f4\u6587\u4ef6\u653e\u5728\\(GOPATH/pkg\u76ee\u5f55\u4e0b\uff0c\u7f16\u8bd1\u7ed3\u679c\u653e\u5728\\)GOPATH/bin\u76ee\u5f55\u4e0b\u3002</p> <p>\"go install\"\u547d\u4ee4\u7684\u8f93\u51fa\u76ee\u5f55\u59cb\u7ec8\u4e3a\\(GOPATH\u4e0b\u7684bin\u76ee\u5f55\uff0c\u65e0\u6cd5\u4f7f\u7528-o\u9644\u52a0\u53c2\u6570\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002\\)GOPATH\u4e0b\u7684pkg\u76ee\u5f55\u653e\u7f6e\u7684\u662f\u7f16\u8bd1\u671f\u95f4\u7684\u4e2d\u95f4\u6587\u4ef6\u3002</p> <p>\u9879\u76ee\u4ee3\u7801\u76f8\u5bf9\u4e8e\u9879\u76ee\u7684\u6839\u76ee\u5f55\u5c42\u7ea7\u5173\u7cfb\u5982\u4e0b\uff1a</p> <pre><code>install\n|----main.go\n|----pkg\n    |----installpkg.go\n</code></pre> <pre><code>//main.go\npackage main\nimport (\n\"fmt\"\n\"pkg\"\n)\nfunc main() {\npkg.CallFunc()\nfmt.Println(\"go build\")\n}\n//installpkg.go\npackage pkg\nimport \"fmt\"\nfunc CallFunc() {\nfmt.Println(\"test\")\n}\n//go install\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#134-\u83b7\u53d6\u4ee3\u7801go-get","title":"13.4 \u83b7\u53d6\u4ee3\u7801(go get)","text":"<p>\u52a8\u6001\u8fdc\u7a0b\u62c9\u53d6\u6216\u66f4\u65b0\u4ee3\u7801\u5305\u53ca\u5176\u4f9d\u8d56\u5305\uff0c\u81ea\u52a8\u5b8c\u6210\u7f16\u8bd1\u548c\u5b89\u88c5\u3002\u6574\u4e2a\u8fc7\u7a0b\u5c31\u884c\u624b\u673a\u4e2d\u5b89\u88c5\u4e00\u4e2aAPP\u4e00\u6837\u7b80\u5355\u3002</p> <p>\u9700\u8981\u5b89\u88c5Git\uff0cSVN\uff0cHG\u7b49\u3002</p> \u6807\u8bb0\u540d\u79f0 \u6807\u8bb0\u63cf\u8ff0 -d \u53ea\u4e0b\u8f7d\uff0c\u4e0d\u5b89\u88c5 -f \u4f7f\u7528-u\u65f6\u624d\u6709\u6548\uff0c\u5ffd\u7565\u5bf9\u5df2\u4e0b\u8f7d\u4ee3\u7801\u5305\u5bfc\u5165\u8def\u5f84\u7684\u68c0\u67e5\u3002\u9002\u7528\u4e8e\u4ece\u522b\u4eba\u5904Fork\u4ee3\u7801\u5305 -fix \u4e0b\u8f7d\u4ee3\u7801\u5305\u540e\u5148\u4fee\u6b63\uff0c\u7136\u540e\u7f16\u8bd1\u548c\u5b89\u88c5 -insecure \u8fd0\u884c\u975e\u5b89\u5168scheme(\u5982HTTP)\u4e0b\u8f7d\u4ee3\u7801\u5305\u3002 -t \u540c\u65f6\u4e0b\u8f7d\u6d4b\u8bd5\u6e90\u7801\u6587\u4ef6\u4e2d\u7684\u4f9d\u8d56\u4ee3\u7801\u5305 -u \u66f4\u65b0\u5df2\u6709\u4ee3\u7801\u5305\u53ca\u5176\u4f9d\u8d56\u5305 <p>\"go get\"\u547d\u4ee4\u7684\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>go get -u github.com/shirdon1/TP-Link-HS110\n</code></pre> <p>\u8fd0\u884c\u5b8c\u6210\u540e\u5373\u53ef\u4e0b\u8f7d\u5e76\u8fdb\u884c\u7f16\u8bd1\u548c\u5b89\u88c5\u3002</p> <p>\u4f7f\u7528go get xxx\u6307\u4ee4\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u5305\uff0c\u6bd4\u5982\u4e0b\u8f7dMySQL\u6570\u636e\u5e93\u64cd\u4f5c\u5305\uff0c\u8f93\u5165</p> <p><pre><code>go get github.com/go-sql-driver/mysql\n</code></pre> \u5373\u53ef\u4e0b\u8f7d\uff0c\u7b2c\u4e09\u65b9\u5305\u4e0b\u8f7d\u540e\u5c06\u4f1a\u5b58\u653e\u5728GOPATH\u7684pkg\u6587\u4ef6\u5939\u3002</p> <p>\u5728\u9879\u76ee\u4e2d\u6267\u884cgo get\u547d\u4ee4\u53ef\u4ee5\u4e0b\u8f7d\u4f9d\u8d56\u5305\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u6307\u5b9a\u4e0b\u8f7d\u7684\u7248\u672c\u3002</p> <ul> <li>\u8fd0\u884cgo get -u\u5c06\u4f1a\u5347\u7ea7\u5230\u6700\u65b0\u7684\u6b21\u8981\u7248\u672c\u6216\u8005\u4fee\u8ba2\u7248\u672c(x.y.z, z\u662f\u4fee\u8ba2\u7248\u672c\u53f7\uff0c y\u662f\u6b21\u8981\u7248\u672c\u53f7)</li> <li>\u8fd0\u884cgo get -u=patch\u5c06\u4f1a\u5347\u7ea7\u5230\u6700\u65b0\u7684\u4fee\u8ba2\u7248\u672c</li> <li>\u8fd0\u884cgo get package@version\u5c06\u4f1a\u5347\u7ea7\u5230\u6307\u5b9a\u7684\u7248\u672c\u53f7version</li> </ul> <p>\u5982\u679c\u4e0b\u8f7d\u6240\u6709\u4f9d\u8d56\u53ef\u4ee5\u4f7f\u7528go mod download\u547d\u4ee4\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#14-\u5305","title":"14. \u5305","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1-\u4ee3\u7801","title":"1. \u4ee3\u7801","text":"<p>\u9879\u76ee\u4ee3\u7801\u76f8\u5bf9\u4e8e\u9879\u76ee\u7684\u6839\u76ee\u5f55\u5c42\u7ea7\u5173\u7cfb\u5982\u4e0b\uff1a</p> <pre><code>tree\n.\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 mathop\n\u2514\u2500\u2500 multi.go\n</code></pre> <p>mathop/multi.go</p> <pre><code>package mathop\n// \u6b64\u5904Multi\u51fd\u6570\uff0c\u5f00\u5934M\u8981\u5927\u5199\uff0c\u5426\u5219\u5916\u90e8\u4e0d\u53ef\u8bbf\u95ee\u5b83\nfunc Multi(num1 int, num2 int) int {\nreturn num1 * num2\n}\n</code></pre> <p>main.go</p> <pre><code>package main\nimport \"fmt\"\n// \u6ce8\u610f\u5728\u5f15\u7528\u672c\u5730\u5305\u7684\u5b9a\u4f4d\u683c\u5f0f\nimport \"pkg/mathop\"\nfunc main() {\nfmt.Println(mathop.Multi(8, 9)) // 72\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2-\u8f93\u51fa","title":"2. \u8f93\u51fa","text":"<pre><code>$ go run main.go\n72\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3-\u89e3\u91ca","title":"3. \u89e3\u91ca","text":"<p>Go\u8bed\u8a00\u7528\u5305\u6765\u7ec4\u7ec7\u6e90\u4ee3\u7801\u7684\uff0c\u5b9e\u73b0\u547d\u540d\u7a7a\u95f4\u7ba1\u7406\uff0c\u4efb\u4f55\u4e00\u4e2aGo\u8bed\u8a00\u7684\u7a0b\u5e8f\u5fc5\u987b\u5c5e\u4e8e\u4e00\u4e2a\u5305\uff0c\u5373\u6bcf\u4e2aGo\u8bed\u8a00\u7a0b\u5e8f\u7684\u5f00\u5934\u5fc5\u987b\u5199\u4e0apackage &lt;\u5305\u540d&gt;\u3002</p> <p>Go\u8bed\u8a00\u7684\u5305\u4e00\u822c\u9700\u8981\u6ee1\u8db33\u4e2a\u6761\u4ef6\uff1a</p> <ol> <li>\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b\u540c\u7ea7\u7684\u6240\u6709Go\u8bed\u8a00\u6587\u4ef6\u5e94\u8be5\u5c5e\u4e8e\u540c\u4e00\u4e2a\u5305\u3002</li> <li>\u5305\u7684\u540d\u79f0\u53ef\u4ee5\u8ddf\u76ee\u5f55\u4e0d\u540c\uff0c\u4e0d\u8fc7\u5efa\u8bae\u540c\u540d\u3002</li> <li>\u4e00\u4e2aGo\u8bed\u8a00\u7a0b\u5e8f\u6709\u4e14\u53ea\u6709\u4e00\u4e2amain\u51fd\u6570\uff0c\u5b83\u662fGo\u8bed\u8a00\u7684\u5165\u53e3\u51fd\u6570\uff0c\u4e14\u5fc5\u987b\u5c5e\u4e8emain\u5305\uff0c\u6ca1\u6709\u6216\u8005\u591a\u4f59\u4e00\u4e2aGo\u8bed\u8a00\u7f16\u8bd1\u65f6\u90fd\u4f1a\u62a5\u9519\u3002</li> </ol> <p>\u5982\u679c\u8981\u5728\u4e00\u4e2a\u5305\u91cc\u9762\u5f15\u7528\u53e6\u5916\u4e00\u4e2a\u5305\u7684\u6807\u8bc6\u7b26(\u5982\u53d8\u91cf\u3001\u5e38\u91cf\u3001\u7c7b\u578b\u6216\u51fd\u6570\u7b49)\uff0c\u8be5\u6807\u8bc6\u7b26\u5fc5\u987b\u662f\u5bf9\u5916\u53ef\u89c1\u7684(public)\u3002\u5728Go\u8bed\u8a00\u4e2d\u53ea\u9700\u8981\u5c06\u6807\u8bc6\u7b26\u9996\u5b57\u6bcd\u5927\u5199\u5c31\u80fd \u8ba9\u6807\u8bc6\u7b26\u5bf9\u5916\u53ef\u89c1\u4e86\u3002</p> <p>\u8981\u5728\u4ee3\u7801\u4e2d\u5f15\u7528\u5176\u4ed6\u5305\u7684\u5185\u5bb9\uff0c\u9700\u8981\u4f7f\u7528import\u5173\u952e\u5b57\u5bfc\u5165\u4f7f\u7528\u7684\u5305\uff0c\u5177\u4f53\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>import \"\u5305\u7684\u8def\u5f84\"\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/3.Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#15-go\u9879\u76ee\u7ed3\u6784","title":"15. Go\u9879\u76ee\u7ed3\u6784","text":"<p>\u53c2\u8003\uff1ahttps://github.com/golang-standards/project-layout</p> <p>Go\u9879\u76ee\u7ed3\u6784</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/","title":"Go Module","text":"<p>\u6a21\u5757(Module)\u662f\u4e00\u4e2a\u76f8\u5173Go\u5305\u7684\u96c6\u5408\uff0c\u81eaGo1.11\u7248\u5f15\u5165\uff0c\u5b83\u662f\u6e90\u4ee3\u7801\u66f4\u66ff\u548c\u7248\u672c\u63a7\u5236\u7684\u5355\u5143\uff0c\u6a21\u5757\u7531\u6e90\u6587\u4ef6\u5f62\u6210\u7684go.mod\u6587\u4ef6\u7684\u6839\u76ee\u5f55\u5b9a\u4e49\uff0c\u5305\u542bgo.mod\u6587\u4ef6\u7684\u76ee\u5f55 \u4e5f\u88ab\u79f0\u4e3a\u6a21\u5757\u6839\u3002</p> <p>modules\u53d6\u4ee3\u65e7\u7684\u57fa\u4e8eGOPATH\u65b9\u6cd5\u6765\u6307\u5b9a\u5728\u5de5\u7a0b\u4e2d\u4f7f\u7528\u54ea\u4e9b\u6e90\u6587\u4ef6\u6216\u5bfc\u5165\u5305\u3002</p> <p>\u5305\u7ba1\u7406\u5de5\u5177go mod\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a</p> <ol> <li>\u81ea\u52a8\u4e0b\u8f7d\u4f9d\u8d56\u5305\uff0c\u5373\u7b2c\u4e09\u65b9\u5305\u3002</li> <li>\u81ea\u5b9a\u4e49\u5305\u65e0\u987b\u653e\u5728GOPATH\u8bbe\u7f6e\u7684\u8def\u5f84\u3002</li> <li>\u7b2c\u4e09\u65b9\u5305\u6216\u81ea\u5b9a\u4e49\u5305\u5199\u5728go.mod\u6587\u4ef6\u4e2d\uff0c\u901a\u8fc7go.mod\u6587\u4ef6\u7ba1\u7406\u5305\u3002</li> <li>\u5df2\u7ecf\u8f6c\u79fb\u7684\u7b2c\u4e09\u65b9\u5305\u6216\u81ea\u5b9a\u4e49\u5305\uff0c\u5728go.mod\u6587\u4ef6\u4e2d\u4f7f\u7528replace\u66ff\u6362\uff0c\u4e0d\u9700\u8981\u4fee\u6539\u4ee3\u7801\u3002</li> <li>\u5bf9\u7b2c\u4e09\u65b9\u5305\u6307\u5b9a\u7248\u672c\u53f7\u3002</li> </ol>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#1-\u4f7f\u7528\u65b9\u6cd5","title":"1. \u4f7f\u7528\u65b9\u6cd5","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#11-go111module","title":"1.1 GO111MODULE","text":"<p>\u8981\u542f\u7528go module\u652f\u6301\u9996\u5148\u8981\u8bbe\u7f6e\u73af\u5883\u53d8\u91cfGO111MODULE\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u5f00\u542f\u6216\u5173\u95ed\u6a21\u5757\u652f\u6301\uff0c\u5b83\u6709\u4e09\u4e2a\u53ef\u9009\u503c\uff1aoff\u3001on\u3001auto\uff0c\u9ed8\u8ba4\u503c\u662fauto\u3002</p> <ul> <li>GO111MODULE=off\u7981\u7528\u6a21\u5757\u652f\u6301\uff0c\u7f16\u8bd1\u65f6\u4f1a\u4eceGOPATH\u548cvendor\u6587\u4ef6\u5939\u4e2d\u67e5\u627e\u5305\u3002</li> <li>GO111MODULE=on\u542f\u7528\u6a21\u5757\u652f\u6301\uff0c\u7f16\u8bd1\u65f6\u4f1a\u5ffd\u7565GOPATH\u548cvendor\u6587\u4ef6\u5939\uff0c\u53ea\u6839\u636e go.mod\u4e0b\u8f7d\u4f9d\u8d56\u3002</li> <li>GO111MODULE=auto\uff0c\u5f53\u9879\u76ee\u5728$GOPATH/src\u5916\u4e14\u9879\u76ee\u6839\u76ee\u5f55\u6709go.mod\u6587\u4ef6\u65f6\uff0c\u5f00\u542f\u6a21\u5757\u652f\u6301\u3002</li> </ul> <p><pre><code>go env -w GO111MODULE=on\n</code></pre> \u7b80\u5355\u6765\u8bf4\uff0c\u8bbe\u7f6eGO111MODULE=on\u4e4b\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528go module\u4e86\uff0c\u4ee5\u540e\u5c31\u6ca1\u6709\u5fc5\u8981\u5728GOPATH\u4e2d\u521b\u5efa\u9879\u76ee\u4e86\uff0c\u5e76\u4e14\u8fd8\u80fd\u591f\u5f88\u597d\u7684\u7ba1\u7406\u9879\u76ee\u4f9d\u8d56\u7684\u7b2c\u4e09\u65b9\u5305\u4fe1\u606f\u3002 \u4f7f\u7528 go module \u7ba1\u7406\u4f9d\u8d56\u540e\u4f1a\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u751f\u6210\u4e24\u4e2a\u6587\u4ef6go.mod\u548cgo.sum\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#12-goproxy","title":"1.2 GOPROXY","text":"<p>Go1.11\u4e4b\u540e\u8bbe\u7f6eGOPROXY\u547d\u4ee4\u4e3a\uff1a <pre><code>export GOPROXY=https://goproxy.cn\n</code></pre></p> <p>Go1.13\u4e4b\u540eGOPROXY\u9ed8\u8ba4\u503c\u4e3ahttps://proxy.golang.org\uff0c\u5728\u56fd\u5185\u662f\u65e0\u6cd5\u8bbf\u95ee\u7684\uff0c\u6240\u4ee5\u5341\u5206\u5efa\u8bae\u5927\u5bb6\u8bbe\u7f6eGOPROXY\uff0c\u8fd9\u91cc\u6211\u63a8\u8350\u4f7f\u7528goproxy.cn\u3002 <pre><code>go env -w GOPROXY=https://goproxy.cn,direct\n</code></pre></p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#13-go-mod\u547d\u4ee4","title":"1.3 go mod\u547d\u4ee4","text":"\u547d\u4ee4 \u8bf4\u660e go mod init \u5f53\u524d\u6a21\u5757\u4e0b\u521d\u59cb\u5316 go mod tidy \u6574\u7406\u6a21\u5757\uff08\u62c9\u53d6\u7f3a\u5c11\u7684\u6a21\u5757\uff0c\u79fb\u9664\u4e0d\u7528\u7684\u6a21\u5757\uff09 go mod edit \u7f16\u8f91go.mod\u6587\u4ef6 go mod verify \u9a8c\u8bc1\u4f9d\u8d56\u662f\u5426\u8fbe\u5230\u9884\u671f\u7684\u76ee\u7684 go mod vendor \u5c06\u4f9d\u8d56\u590d\u5236\u5230vendor\u4e0b\uff0c\u751f\u6210vendor\u6587\u4ef6\u5939 go mod download \u4e0b\u8f7d\u4f9d\u8d56\u7684module\u5230\u672c\u5730cache\uff08\u9ed8\u8ba4\u4e3a$GOPATH/pkg/mod\u76ee\u5f55\uff09 go mod graph \u6253\u5370\u73b0\u6709\u4f9d\u8d56\u7ed3\u6784 go mod why \u89e3\u91ca\u4e3a\u4ec0\u4e48\u9700\u8981\u4f9d\u8d56 go clean -modcache \u6e05\u7406go mod\u7f13\u5b58 go get -u \u66f4\u65b0\u73b0\u6709\u7684\u4f9d\u8d56 <pre><code>### 1.4 go.mod\u6587\u4ef6\u89e3\u6790\nmodule\uff1a     # \u6a21\u5757\u540d\u79f0\uff0c\u4f7f\u7528\u6307\u4ee4go mod init &lt;OPTIONAL_MODULE_PATH&gt;\u53ef\u8bbe\u7f6e\nrequire\uff1a        # \u4f9d\u8d56\u5305\u5217\u8868\u4ee5\u53ca\u7248\u672c\nexclude\uff1a        # \u7981\u7528\u4f9d\u8d56\u5305\u5217\u8868\nreplace\uff1a        # \u66ff\u6362\u4f9d\u8d56\u5305\u5217\u8868\ngo\uff1a           # go\u7248\u672c\u53f7\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#2-\u8be6\u7ec6\u6b65\u9aa4","title":"2. \u8be6\u7ec6\u6b65\u9aa4","text":"<p>(1) \u5347\u7ea7\u5230Go1.14</p> <p>(2) \u8fd0\u884cgo env -w GO111MODULE=on</p> <p>(3) \u8fd0\u884cgo env -w GOPROXY=https://goproxy.cn,direct \u53ef\u4ee5\u901a\u8fc7\u8fd0\u884cgo env\u67e5\u770b\u3002</p> <p>(4) \u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u6267\u884c<code>go mod init</code>\u6267\u884c\u6210\u529f\u540e\u751f\u6210go.mod\u6587\u4ef6</p> <p>\u968f\u7740Go 1.13\u53d1\u5e03\uff0cGOPROXY\u9ed8\u8ba4\u503cproxy.golang.org\u5728\u4e2d\u56fd\u5927\u9646\u4e0d\u80fd\u88ab\u8bbf\u95ee\u3002</p> <p>\u4e03\u725b\u4e91\u987a\u52bf\u63a8\u51fagoproxy.cn\uff0c\u4ee5\u5229\u4e8e\u4e2d\u56fd\u5f00\u53d1\u8005\u66f4\u597d\u4f7f\u7528Go Modules\u3002</p> <p>\u4ee3\u7406\u5730\u5740</p> <pre><code>https://goproxy.cn/\nhttps://goproxy.io/\n</code></pre> <p>Gitee GoProxy\u4ed3\u4f7f\u7528\u5e2e\u52a9</p> <pre><code>#Go 1.13 \u53ca\u4ee5\u4e0a\ngo env -w GO111MODULE=on\ngo env -w GOPROXY=http://mirrors.gitee.com/repository/go-public/\ngo env -w GOSUMDB=off\n#or\nexport GOPROXY=http://mirrors.gitee.com/repository/go-public/\n\n\u6d4b\u8bd5\n#test\ngo get github.com/valyala/fasthttp\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#3-\u4f7f\u7528go-module\u5bfc\u5165\u672c\u5730\u5305","title":"3. \u4f7f\u7528go module\u5bfc\u5165\u672c\u5730\u5305","text":"<p><code>go module</code>\u662fGo1.11\u7248\u672c\u4e4b\u540e\u5b98\u65b9\u63a8\u51fa\u7684\u7248\u672c\u7ba1\u7406\u5de5\u5177\uff0c\u5e76\u4e14\u4ece<code>Go1.13</code>\u7248\u672c\u5f00\u59cb\uff0c<code>go module</code>\u5c06\u662fGo\u8bed\u8a00\u9ed8\u8ba4\u7684\u4f9d\u8d56\u7ba1\u7406\u5de5\u5177\u3002</p> <p>\u5230\u4eca\u5929<code>Go1.14</code>\u7248\u672c\u63a8\u51fa\u4e4b\u540e<code>Go modules</code> \u529f\u80fd\u5df2\u7ecf\u88ab\u6b63\u5f0f\u63a8\u8350\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528\u4e86\u3002</p> <p>\u8fd9\u91cc\u5c31\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u5982\u4f55\u4f7f\u7528<code>go module</code>\u5bfc\u5165\u672c\u5730\u5305\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#31-\u524d\u63d0","title":"3.1 \u524d\u63d0","text":"<p>\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6709<code>moduledemo</code>\u548c<code>mypackage</code>\u4e24\u4e2a\u5305\uff0c\u5176\u4e2d<code>moduledemo</code>\u5305\u4e2d\u4f1a\u5bfc\u5165<code>mypackage</code>\u5305\u5e76\u4f7f\u7528\u5b83\u7684<code>New</code>\u65b9\u6cd5\u3002</p> <p><code>mypackage/mypackage.go</code>\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>package mypackage\nimport \"fmt\"\nfunc New(){\nfmt.Println(\"mypackage.New\")\n}\n</code></pre> <p>\u6211\u4eec\u73b0\u5728\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#32-\u5728\u540c\u4e00\u4e2a\u9879\u76ee\u4e0b","title":"3.2 \u5728\u540c\u4e00\u4e2a\u9879\u76ee\u4e0b","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#1-\u76ee\u5f55\u7ed3\u6784","title":"1 \u76ee\u5f55\u7ed3\u6784","text":"<pre><code>$ tree\n.\n\u251c\u2500\u2500 moduledemo\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 mypackage\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 mypackage.go\n|   \u251c\u2500\u2500 go.mod\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#2-\u5bfc\u5165\u5305","title":"2 \u5bfc\u5165\u5305","text":"<p><code>go.mod</code></p> <pre><code>module moduledemo\n\ngo 1.16\n</code></pre> <p><code>moduledemo/mypackage/mypackage.go</code></p> <pre><code>package mypackage\nimport \"fmt\"\nfunc New() {\nfmt.Println(\"hello world.New....\")\n}\n</code></pre> <p><code>moduledemo/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"moduledemo/mypackage\"\n)\nfunc main() {\nmypackage.New()\nfmt.Println(\"main\")\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#3-\u4e3e\u4e2a\u4f8b\u5b50","title":"3 \u4e3e\u4e2a\u4f8b\u5b50","text":"<p>\u4e3e\u4e00\u53cd\u4e09\uff0c\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6709\u6587\u4ef6\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>bubble\n\u251c\u2500\u2500 dao\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 mysql.go\n\u251c\u2500\u2500 go.mod\n\u2514\u2500\u2500 main.go\n</code></pre> <p>\u5176\u4e2d<code>bubble/go.mod</code>\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>module github.com/hujianli/bubble\ngo 1.16\n</code></pre> <p><code>bubble/dao/mysql.go</code>\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>package dao\nimport \"fmt\"\nfunc New(){\nfmt.Println(\"mypackage.New\")\n}\n</code></pre> <p><code>bubble/main.go</code>\u5185\u5bb9\u5982\u4e0b</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/hujianli/bubble\"\n)\nfunc main() {\ndao.New()\nfmt.Println(\"main\")\n}\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#33-\u4e0d\u5728\u540c\u4e00\u4e2a\u9879\u76ee\u4e0b","title":"3.3 \u4e0d\u5728\u540c\u4e00\u4e2a\u9879\u76ee\u4e0b","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#1-\u76ee\u5f55\u7ed3\u6784_1","title":"1 \u76ee\u5f55\u7ed3\u6784","text":"<pre><code>\u251c\u2500\u2500 moduledemo\n\u2502   \u251c\u2500\u2500 go.mod\n\u2502   \u2514\u2500\u2500 main.go\n\u2514\u2500\u2500 mypackage\n    \u251c\u2500\u2500 go.mod\n    \u2514\u2500\u2500 mypackage.go\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#2-\u5bfc\u5165\u5305_1","title":"2 \u5bfc\u5165\u5305","text":"<p>\u8fd9\u4e2a\u65f6\u5019\uff0c<code>mypackage</code>\u4e5f\u9700\u8981\u8fdb\u884cmodule\u521d\u59cb\u5316\uff0c\u5373\u62e5\u6709\u4e00\u4e2a\u5c5e\u4e8e\u81ea\u5df1\u7684<code>go.mod</code>\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>module mypackage\ngo 1.16\n</code></pre> <p>\u7136\u540e\u6211\u4eec\u5728<code>moduledemo/main.go</code>\u4e2d\u6309\u5982\u4e0b\u65b9\u5f0f\u5bfc\u5165\uff1a</p> <pre><code>import (\n\"fmt\"\n\"mypackage\"\n)\nfunc main() {\nmypackage.New()\nfmt.Println(\"main\")\n}\n</code></pre> <p>\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u5305\u4e0d\u5728\u540c\u4e00\u4e2a\u9879\u76ee\u8def\u5f84\u4e0b\uff0c\u4f60\u60f3\u8981\u5bfc\u5165\u672c\u5730\u5305\uff0c\u5e76\u4e14\u8fd9\u4e9b\u5305\u4e5f\u6ca1\u6709\u53d1\u5e03\u5230\u8fdc\u7a0b\u7684github\u6216\u5176\u4ed6\u4ee3\u7801\u4ed3\u5e93\u5730\u5740\u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u5728<code>go.mod</code>\u6587\u4ef6\u4e2d\u4f7f\u7528<code>replace</code>\u6307\u4ee4\u3002</p> <p>\u5728\u8c03\u7528\u65b9\u4e5f\u5c31\u662f<code>moduledemo/go.mod</code>\u4e2d\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a\u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\u6765\u5bfb\u627e<code>mypackage</code>\u8fd9\u4e2a\u5305\u3002</p> <pre><code>module moduledemo\ngo 1.16\nrequire \"mypackage\" v0.0.0\nreplace \"mypackage\" =&gt; \"../mypackage\"\n</code></pre>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#3-\u4e3e\u4e2a\u4f8b\u5b50_1","title":"3 \u4e3e\u4e2a\u4f8b\u5b50","text":"<p>\u6700\u540e\u6211\u4eec\u518d\u4e3e\u4e2a\u4f8b\u5b50\u5de9\u56fa\u4e0b\u4e0a\u9762\u7684\u5185\u5bb9\u3002</p> <p>\u6211\u4eec\u73b0\u5728\u6709\u6587\u4ef6\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>\u251c\u2500\u2500 p1\n\u2502   \u251c\u2500\u2500 go.mod\n\u2502   \u2514\u2500\u2500 main.go\n\u2514\u2500\u2500 p2\n    \u251c\u2500\u2500 go.mod\n    \u2514\u2500\u2500 p2.go\n</code></pre> <p><code>p2/go.mod</code>\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>module github.com/hujianli/p2\ngo 1.16\n</code></pre> <p><code>p1/main.go</code>\u4e2d\u6309\u5982\u4e0b\u65b9\u5f0f\u5bfc\u5165</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/hujianli/p2\"\n)\nfunc main() {\np2.New()\nfmt.Println(\"hello world\")\n}\n</code></pre> <p>\u56e0\u4e3a\u6211\u5e76\u6ca1\u6709\u628a<code>github.com/hujianli/p2</code>\u8fd9\u4e2a\u5305\u4e0a\u4f20\u5230<code>github.com</code>\u8fd9\u4e2a\u7f51\u7ad9\uff0c\u6211\u4eec\u53ea\u662f\u60f3\u5bfc\u5165\u672c\u5730\u7684\u5305\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u7528\u5230<code>replace</code>\u8fd9\u4e2a\u6307\u4ee4\u4e86\u3002</p> <p><code>p1/main.go</code>\u4e2d\u6309\u5982\u4e0b\u65b9\u5f0f\u5bfc\u5165</p> <pre><code>module github.com/hujianli/p1\ngo 1.16\nrequire \"github.com/hujianli/p2\" v0.0.0\nreplace \"github.com/hujianli/p2\" =&gt; \"../p2\"\n</code></pre> <p>\u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6b63\u5e38\u7f16\u8bd1<code>p1</code>\u8fd9\u4e2a\u9879\u76ee\u4e86\u3002</p> <p>\u8bf4\u518d\u591a\u4e5f\u6ca1\u7528\uff0c\u81ea\u5df1\u52a8\u624b\u8bd5\u8bd5\u5427\u3002</p>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#34-\u5728\u9879\u76ee\u4e2d\u4f7f\u7528go-module","title":"3.4 \u5728\u9879\u76ee\u4e2d\u4f7f\u7528go module","text":""},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#\u65e2\u6709\u9879\u76ee","title":"\u65e2\u6709\u9879\u76ee","text":"<p>\u5982\u679c\u9700\u8981\u5bf9\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u9879\u76ee\u542f\u7528go module\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u64cd\u4f5c\uff1a</p> <ol> <li>\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\u6267\u884cgo mod init\uff0c\u751f\u6210\u4e00\u4e2ago.mod\u6587\u4ef6\u3002</li> <li>\u6267\u884cgo get\uff0c\u67e5\u627e\u5e76\u8bb0\u5f55\u5f53\u524d\u9879\u76ee\u7684\u4f9d\u8d56\uff0c\u540c\u65f6\u751f\u6210\u4e00\u4e2ago.sum\u8bb0\u5f55\u6bcf\u4e2a\u4f9d\u8d56\u5e93\u7684\u7248\u672c\u548c\u54c8\u5e0c\u503c\u3002</li> </ol>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#\u65b0\u9879\u76ee","title":"\u65b0\u9879\u76ee","text":"<p>\u5bf9\u4e8e\u4e00\u4e2a\u65b0\u521b\u5efa\u7684\u9879\u76ee\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u9879\u76ee\u6587\u4ef6\u5939\u4e0b\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u64cd\u4f5c\uff1a</p> <ol> <li>\u6267\u884cgo mod init \u9879\u76ee\u540d\u547d\u4ee4\uff0c\u5728\u5f53\u524d\u9879\u76ee\u6587\u4ef6\u5939\u4e0b\u521b\u5efa\u4e00\u4e2ago.mod\u6587\u4ef6\u3002</li> <li>\u624b\u52a8\u7f16\u8f91go.mod\u4e2d\u7684require\u4f9d\u8d56\u9879\u6216\u6267\u884cgo get\u81ea\u52a8\u53d1\u73b0\u3001\u7ef4\u62a4\u4f9d\u8d56\u3002</li> </ol>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#35-\u5f3a\u5236\u66f4\u65b0\u7b2c\u4e09\u65b9\u4f9d\u8d56\u7248\u672c","title":"3.5 \u5f3a\u5236\u66f4\u65b0\u7b2c\u4e09\u65b9\u4f9d\u8d56\u7248\u672c","text":"<ol> <li> <p>\u5220\u9664go.sum</p> </li> <li> <p>\u5220\u9664go.mod\u4e2d\u8001\u4f9d\u8d56\u884c</p> </li> <li> <p><code>go mod tidy</code>\u5237\u65b0</p> </li> </ol>"},{"location":"Golang/1.Go%E5%9F%BA%E7%A1%80/4.Go-Module/#4-\u6848\u4f8b-demo","title":"4. \u6848\u4f8b-demo","text":"<p>\u76ee\u5f55\u7ed3\u6784</p> <pre><code>module-demo/\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 mpb\n    \u251c\u2500\u2500 go.mod\n    \u2514\u2500\u2500 mpb.go\n</code></pre> <p>\u5206\u522b\u5728module-demo\u548cmpb\u4e2d\u4f7f\u7528go mod init xxx\u6307\u4ee4\u521b\u5efa\u4e86go.mod\u6587\u4ef6\uff0c\u521b\u5efa\u6307\u4ee4\u6765\u81ea\u5305\u7ba1\u7406\u5de5\u5177go mod\uff0c\u6307\u4ee4\u7684xxx\u4ee3\u8868\u9879\u76ee\u6216\u5305\u540d\uff0c\u5efa\u8bae\u4f7f\u7528\u6587\u4ef6\u5939\u540d\u79f0\u3002</p> <pre><code>cd module_demo\ngo mod init module_demo\ncd mpb\ngo mod init mpb\n</code></pre> <p>module_demo/mpb/mpb.go</p> <pre><code>package mpb\nimport \"fmt\"\nvar MyVariable int = 666\nfunc Get_data() {\nfmt.Println(\"\u8fd9\u662f\u81ea\u52a8\u5305mpb\u7684\u5bfc\u51fa\u6807\u8bc6\u7b26Get_data\")\n}\n</code></pre> <p>module_demo/go.mod</p> <pre><code>module module_demo\n\ngo 1.20\n\n// require\u4ee3\u8868\u9700\u8981\u8c03\u7528\u7b2c\u4e09\u65b9\u5305\u6216\u81ea\u5b9a\u4e49\u5305\uff0c\u5c0f\u62ec\u53f7\u91cc\u9762\u4e00\u884c\u4ee3\u7801\u4ee3\u8868\u4e00\u4e2a\u5305\u4fe1\u606f\u3002\nrequire mpb v0.0.0\n\n// replace\u4e3arequire\u7684\u5305\u6307\u5b9a\u65b0\u7684\u8def\u5f84\u5730\u5740\uff0c\n// \u5e38\u7528\u4e8e\u672c\u5730\u81ea\u5b9a\u4e49\u5305\u6216\u7b2c\u4e09\u65b9\u5305\u7684\u8def\u5f84\u8fc1\u79fb\uff0c\u4f8b\u5982mpb =&gt; ./mpb\u4ee3\u8868\u81ea\u5b9a\u4e49\u5305mpb\u4e3a\u5f53\u524d\u8def\u5f84\u7684\u6587\u4ef6\u5939mpb\u3002\nreplace mpb =&gt; ./mpb\n</code></pre> <p>module_demo/main.go</p> <pre><code>package main\n// \u5bfc\u5165\u5185\u7f6e\u5305fmt\nimport (\n\"fmt\"\n\"mpb\"\n)\nfunc main() {\n// \u8f93\u51fa\u81ea\u5b9a\u4e49\u5305mpb\u7684MyVariable\nfmt.Println(mpb.MyVariable)\n// \u8c03\u7528\u81ea\u5b9a\u4e49\u5305mpb\u7684Get_data()\nmpb.Get_data()\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c</p> <pre><code>D:/Program Files/go/bin/go.exe run main.go [D:/golang/go/src/gitee/module_demo]\n666\n\u8fd9\u662f\u81ea\u52a8\u5305mpb\u7684\u5bfc\u51fa\u6807\u8bc6\u7b26Get_data\n</code></pre> <p>\u5305\u7ba1\u7406\u5de5\u5177go mod\u7684\u4f7f\u7528\u8bf4\u660e\u5982\u4e0b:</p> <ol> <li>Go\u8bed\u8a00\u7684\u73af\u5883\u5c5e\u6027GO111MODULE\u5fc5\u987b\u8bbe\u4e3aon\u6216auto\u6a21\u5f0f\u3002</li> <li>\u5305\u4ee5\u6587\u4ef6\u5939\u4e3a\u57fa\u672c\u5355\u4f4d\uff0c\u5728\u5305\u91cc\u9762\u4f7f\u7528go mod init xxx\u6307\u4ee4\u521b\u5efa\u4e86go.mod\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u7ba1\u7406\u5305\u91cc\u9762\u9700\u8981\u8c03\u7528\u7b2c\u4e09\u65b9\u5305\u6216\u81ea\u5b9a\u4e49\u5305\u7684\u4fe1\u606f\u3002</li> <li>\u5728go.mod\u6587\u4ef6\u4e2d\u7ba1\u7406\u81ea\u5b9a\u4e49\u5305\uff0c\u5fc5\u987b\u901a\u8fc7replace\u6307\u5b9a\u81ea\u5b9a\u4e49\u5305\u7684\u8def\u5f84\uff0c\u5426\u5219Go\u8bed\u8a00\u65e0\u6cd5\u627e\u5230\u81ea\u5b9a\u4e49\u5305\u3002</li> <li>\u5728go.mod\u6587\u4ef6\u4e2d\u7ba1\u7406\u7b2c\u4e09\u65b9\u5305\u65e0\u987b\u901a\u8fc7replace\u6307\u5b9a\u5305\u8def\u5f84\uff0c\u7b2c\u4e09\u65b9\u5305\u4f1a\u81ea\u52a8\u4e0b\u8f7d\u5230GOPATH\u7684pkg\u6587\u4ef6\u5939</li> </ol> <p>\u53c2\u8003\u6587\u732e:</p> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u4f9d\u8d56\u7ba1\u7406</p> <p>Go\u8bed\u8a00\u4e4b\u4f9d\u8d56\u7ba1\u7406</p> <p>\u7b2c\u4e8c\u5341\u7ae0 go module</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/5.%E7%AC%AC%E4%B8%80%E4%B8%AAGo-Web%E7%A8%8B%E5%BA%8F/","title":"\u7b2c\u4e00\u4e2aGo Web\u7a0b\u5e8f","text":"<pre><code>// \u4ed3\u5e93\u5730\u5740\uff1ahttps://gitee.com/shirdonl/goWebActualCombat\n// \u4ed3\u5e93\u5730\u5740\uff1ahttps://github.com/shirdonl/goWebActualCombat\npackage main\nimport (\n\"fmt\"\n\"net/http\"\n)\nfunc hello(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"Hello World\")\n}\nfunc main() {\nserver := &amp;http.Server{\nAddr: \"0.0.0.0:80\",\n}\nhttp.HandleFunc(\"/\", hello)\nserver.ListenAndServe()\n}\n</code></pre> <p>\u5728\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u4e0b\u6253\u5f00\u547d\u4ee4\u884c\u7ec8\u7aef\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4:</p> <pre><code>go run helloWorldWeb.go\n</code></pre>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/","title":"Web\u7a0b\u5e8f\u8fd0\u884c\u539f\u7406\u7b80\u4ecb","text":""},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#1web\u57fa\u672c\u539f\u7406","title":"1.Web\u57fa\u672c\u539f\u7406","text":"<p>1.\u8fd0\u884c\u539f\u7406 \uff081\uff09\u7528\u6237\u6253\u5f00\u5ba2\u6237\u7aef\u6d4f\u89c8\u5668\uff0c\u8f93\u5165URL\u5730\u5740\u3002</p> <p>\uff082\uff09\u5ba2\u6237\u7aef\u6d4f\u89c8\u5668\u901a\u8fc7HTTP\u534f\u8bae\u5411\u670d\u52a1\u5668\u7aef\u53d1\u9001\u6d4f\u89c8\u8bf7\u6c42\u3002</p> <p>\uff083\uff09\u670d\u52a1\u5668\u7aef\u901a\u8fc7CGI\u7a0b\u5e8f\u63a5\u6536\u8bf7\u6c42\uff0c\u8c03\u7528\u89e3\u91ca\u5f15\u64ce\u5904\u7406\"\u52a8\u6001\u5185\u5bb9\"\uff0c\u8bbf\u95ee\u6570\u636e\u5e93\u5e76\u5904\u7406\u6570\u636e\uff0c\u901a\u8fc7HTTP\u534f\u8bae\u5c06\u5f97\u5230\u7684\u5904\u7406\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u6d4f\u89c8\u5668\u3002</p> <p>\uff084\uff09\u5ba2\u6237\u7aef\u6d4f\u89c8\u5668\u89e3\u91ca\u5e76\u663e\u793aHTML\u9875\u9762\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#11-dnsdomain-name-system\u57df\u540d\u7cfb\u7edf","title":"1.1 DNS(Domain Name System\uff0c\u57df\u540d\u7cfb\u7edf)","text":"<p>\u5c06\u4e3b\u673a\u540d\u548c\u57df\u540d\u8f6c\u6362\u4e3aIP\u5730\u5740\u3002</p> <p>DNS\u89e3\u6790\u8fc7\u7a0b\uff1a</p> <p>\uff081\uff09\u7528\u6237\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8f93\u5165URL\u5730\u5740\u3002\u6d4f\u89c8\u5668\u4eceURL\u4e2d\u62bd\u53d6\u57df\u540d\uff08\u4e3b\u673a\u540d\uff09\uff0c\u4f20\u7ed9DNS\u5e94\u7528\u7a0b\u5e8f\u7684\u5ba2\u6237\u7aef\u3002</p> <p>\uff082\uff09DNS\u5ba2\u6237\u7aef\u5411DNS\u670d\u52a1\u5668\u7aef\u53d1\u9001\u67e5\u8be2\u62a5\u6587\uff0c\u5176\u4e2d\u5305\u542b\u4e3b\u673a\u540d\u3002</p> <p>\uff083\uff09DNS\u670d\u52a1\u5668\u7aef\u5411DNS\u5ba2\u6237\u7aef\u53d1\u9001\u56de\u7b54\u62a5\u6587\uff0c\u5176\u4e2d\u5305\u542b\u8be5\u4e3b\u673a\u540d\u5bf9\u5e94IP\u5730\u5740\u3002</p> <p>\uff084\uff09\u6d4f\u89c8\u5668\u6536\u5230DNS\u7684IP\u5730\u5740\u540e\uff0c\u5411\u8be5IP\u5730\u5740\u5b9a\u4f4d\u7684HTTP\u670d\u52a1\u5668\u7aef\u53d1\u8d77TCP\u8fde\u63a5\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#2http\u7b80\u4ecb","title":"2.HTTP\u7b80\u4ecb","text":"<p>HTTP\uff08Hyper Text Transfer Protocal\uff0c\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\uff09\uff0c\u7b80\u5355\u8bf7\u6c42-\u54cd\u5e94\u534f\u8bae\uff0c\u8fd0\u884c\u5728TCP\u534f\u8bae\u4e0a\uff0c\u65e0\u72b6\u6001\u3002</p> <p>\u5b83\u6307\u5b9a\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u6d88\u606f\u548c\u5f97\u5230\u7684\u54cd\u5e94\u3002\u8bf7\u6c42\u548c\u54cd\u5e94\u6d88\u606f\u5934\u662fASCII\u7801\uff1b\u6d88\u606f\u5185\u5bb9\u5219\u7c7b\u4f3cMIME\u683c\u5f0f\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#3http\u8bf7\u6c42","title":"3.HTTP\u8bf7\u6c42","text":"<p>\u5ba2\u6237\u7aef\u53d1\u9001\u5230\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u6d88\u606f\u3002</p> <p>1.\u8bf7\u6c42\u884c\uff08Request Line\uff09 \u8bf7\u6c42\u65b9\u6cd5\u3001URI\u3001HTTP\u534f\u8bae/\u534f\u8bae\u7248\u672c\u7ec4\u6210\u3002</p> \u8bf7\u6c42\u65b9\u6cd5 \u65b9\u6cd5\u63cf\u8ff0 GET \u8bf7\u6c42\u9875\u9762\uff0c\u5e76\u8fd4\u56de\u9875\u9762\u5185\u5bb9\uff0c\u8bf7\u6c42\u53c2\u6570\u5305\u542b\u5728URL\u4e2d\uff0c\u63d0\u4ea4\u6570\u636e\u6700\u591a1024byte HEAD \u7c7b\u4f3cGET\uff0c\u53ea\u83b7\u53d6\u62a5\u5934 POST \u63d0\u4ea4\u8868\u5355\u6216\u4e0a\u4f20\u6587\u4ef6\uff0c\u6570\u636e\uff08\u542b\u8bf7\u6c42\u53c2\u6570\uff09\u5305\u542b\u5728\u8bf7\u6c42\u4f53\u4e2d PUT \u53d6\u4ee3\u6307\u5b9a\u5185\u5bb9\u7684\u6587\u6863 DELETE \u5220\u9664\u6307\u5b9a\u8d44\u6e90 OPTIONS \u67e5\u770b\u670d\u52a1\u5668\u7684\u6027\u80fd CONNECT \u670d\u52a1\u5668\u5f53\u4f5c\u8df3\u677f\uff0c\u8bbf\u95ee\u5176\u4ed6\u7f51\u9875 TRACE \u56de\u663e\u670d\u52a1\u5668\u6536\u5230\u7684\u8bf7\u6c42\uff0c\u7528\u4e8e\u6d4b\u8bd5\u6216\u8bca\u65ad <p>2.\u8bf7\u6c42\u5934\uff08Request Header\uff09</p> \u8bf7\u6c42\u5934 \u793a\u4f8b \u8bf4\u660e Accept Accept: text/plain, text/html \u5ba2\u6237\u7aef\u80fd\u591f\u63a5\u6536\u7684\u5185\u5bb9\u7c7b\u578b Accept-charset Accept-charset: iso-8859-5 \u5b57\u7b26\u7f16\u7801\u96c6 Accept-Encoding Accept-Encoding: compress, gzip \u538b\u7f29\u7f16\u7801\u7c7b\u578b Accept-Language Accept-Language: en, zh \u8bed\u8a00 Accept-Ranges Accept-Ranges: bytes \u5b50\u8303\u56f4\u5b57\u6bb5 Authorization Authorization: Basic dbXleoOEpePOetpoe2Ftyd== \u6388\u6743\u8bc1\u4e66 Cache-Control Cache-Control: no-cache \u7f13\u5b58\u673a\u5236 Connection Connection: close \u662f\u5426\u9700\u8981\u6301\u4e45\u8fde\u63a5\uff08HTTP1.1\u9ed8\u8ba4\u6301\u4e45\u8fde\u63a5\uff09 Cookie Cookie: $version=1; Skin=new; \u8bf7\u6c42\u57df\u540d\u4e0b\u7684\u6240\u6709cookie\u503c Content-Length Content-Length: 348 \u5185\u5bb9\u957f\u5ea6 <p>3.\u8bf7\u6c42\u4f53\uff08Request Body\uff09</p> <p>HTTP\u8bf7\u6c42\u4e2d\u4f20\u8f93\u6570\u636e\u7684\u5b9e\u4f53,\u5e38\u7528\u4e8ePOST\u3001PUT\u8bf7\u6c42\u4e2d\u3002</p> <p>\u4f8b\u5982\u5728\u8868\u5355\u8bf7\u6c42\u4e2d\uff0c\u5f53\u6211\u4eec\u63d0\u4ea4\u4e00\u4e2aPOST\u8bf7\u6c42\u65f6\uff0c\u4f1a\u5c06\u4e00\u4e2a\u9875\u9762\u8868\u5355\u4e2d\u7684\u7ec4\u4ef6\u7684\u8868\u5355\u6570\u636e\u503c\u901a\u8fc7\"param1=value1&amp;param2=value2\"\u7684\u952e\u503c\u5bf9\u5f62\u5f0f\u7f16\u7801\u6210\u4e00\u4e2a\u683c\u5f0f\u5316\u4e32\uff0c\u5e76\u901a\u8fc7\u8bf7\u6c42\u5c06\u5176 \u4f20\u9012\u7ed9\u670d\u52a1\u5668\u7aef\u3002</p> <p>\u4e0d\u4f46\u8bf7\u6c42\u4f53\u53ef\u4ee5\u4f20\u9012\u8bf7\u6c42\u53c2\u6570\uff0cGET\u8bf7\u6c42URL\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7c7b\u4f3c\u4e8e\"/chapter1/index.html?param1=value1&amp;param2=value2\"\u7684\u65b9\u5f0f\u4f20\u9012\u8bf7\u6c42\u53c2\u6570\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#4http\u54cd\u5e94","title":"4.HTTP\u54cd\u5e94","text":"<p>\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef,\u53ef\u4ee5\u5206\u4e3a3\u90e8\u5206\u3002</p> <ul> <li>\u54cd\u5e94\u72b6\u6001\u7801\uff08Response Status Code\uff09</li> <li>\u54cd\u5e94\u5934\uff08Response Headers\uff09</li> <li>\u54cd\u5e94\u4f53\uff08Response Body\uff09</li> </ul> <p>1.\u54cd\u5e94\u72b6\u6001\u7801\uff08Response Status Code\uff09</p> <p>\u8868\u793a\u670d\u52a1\u5668\u7684\u54cd\u5e94\u72b6\u6001\u3002</p> \u72b6\u6001\u7801 \u8bf4\u660e \u8be6\u60c5 100 \u7ee7\u7eed \u670d\u52a1\u5668\u6536\u5230\u90e8\u5206\u8bf7\u6c42\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7ee7\u7eed\u63d0\u51fa\u8bf7\u6c42 101 \u5207\u6362\u534f\u8bae \u8bf7\u6c42\u8005\u5df2\u8981\u6c42\u670d\u52a1\u5668\u5207\u6362\u534f\u8bae\uff0c\u670d\u52a1\u5668\u5df2\u786e\u8ba4\u5e76\u51c6\u5907\u5207\u6362\u534f\u8bae 200 \u6210\u529f \u6210\u529f\u5904\u7406\u8bf7\u6c42 201 \u5df2\u521b\u5efa \u670d\u52a1\u5668\u521b\u5efa\u4e86\u65b0\u7684\u8d44\u6e90 202 \u5df2\u63a5\u53d7 \u5df2\u63a5\u6536\u8bf7\u6c42\uff0c\u4f46\u5c1a\u672a\u5904\u7406 203 \u975e\u6388\u6743\u4fe1\u606f \u6210\u529f\u5904\u7406\u8bf7\u6c42\uff0c\u4f46\u8fd4\u56de\u4fe1\u606f\u6765\u81ea\u53e6\u4e00\u4e2a\u6e90 204 \u65e0\u5185\u5bb9 \u6210\u529f\u5904\u7406\u8bf7\u6c42\uff0c\u65e0\u8fd4\u56de\u5185\u5bb9 205 \u91cd\u7f6e\u5185\u5bb9 \u6210\u529f\u5904\u7406\u8bf7\u6c42\uff0c\u5185\u5bb9\u91cd\u7f6e 206 \u90e8\u5206\u5185\u5bb9 \u6210\u529f\u5904\u7406\u90e8\u5206\u5185\u5bb9 300 \u591a\u79cd\u9009\u62e9 \u53ef\u6267\u884c\u591a\u79cd\u64cd\u4f5c 301 \u6c38\u4e45\u79fb\u52a8 \u6c38\u4e45\u91cd\u5b9a\u5411 302 \u4e34\u65f6\u79fb\u52a8 \u6682\u65f6\u91cd\u5b9a\u5411 303 \u67e5\u770b\u5176\u4ed6\u4f4d\u7f6e \u91cd\u5b9a\u5411\u76ee\u6807\u6587\u6863\u5e94\u901a\u8fc7GET\u83b7\u53d6 304 \u672a\u4fee\u6539 \u4f7f\u7528\u4e0a\u6b21\u7f51\u9875\u8d44\u6e90 305 \u4f7f\u7528\u4ee3\u7406 \u5e94\u4f7f\u7528\u4ee3\u7406\u8bbf\u95ee 307 \u4e34\u65f6\u91cd\u5b9a\u5411 \u4e34\u65f6\u4ece\u5176\u4ed6\u4f4d\u7f6e\u54cd\u5e94 400 \u9519\u8bef\u8bf7\u6c42 \u65e0\u6cd5\u89e3\u6790 401 \u672a\u6388\u6743 \u65e0\u8eab\u4efd\u9a8c\u8bc1\u6216\u9a8c\u8bc1\u672a\u901a\u8fc7 403 \u7981\u6b62\u8bbf\u95ee \u62d2\u7edd 404 \u672a\u627e\u5230 \u627e\u4e0d\u5230 405 \u65b9\u6cd5\u7981\u7528 \u7981\u7528\u6307\u5b9a\u65b9\u6cd5 406 \u4e0d\u63a5\u53d7 \u65e0\u6cd5\u4f7f\u7528\u5185\u5bb9\u54cd\u5e94 407 \u9700\u8981\u4ee3\u7406\u6388\u6743 \u9700\u8981\u4f7f\u7528\u4ee3\u7406\u6388\u6743 408 \u8bf7\u6c42\u8d85\u65f6 \u8bf7\u6c42\u8d85\u65f6 409 \u51b2\u7a81 \u5b8c\u6210\u8bf7\u6c42\u65f6\u53d1\u751f\u51b2\u7a81 410 \u5df2\u5220\u9664 \u8d44\u6e90\u6c38\u4e45\u5220\u9664 411 \u9700\u8981\u6709\u6548\u957f\u5ea6 \u4e0d\u63a5\u53d7\u6807\u5934\u5b57\u6bb5\u4e0d\u542b\u6709\u6548\u5185\u5bb9\u957f\u5ea6 412 \u672a\u6ee1\u8db3\u524d\u63d0\u6761\u4ef6 \u670d\u52a1\u5668\u672a\u6ee1\u8db3\u67d0\u4e2a\u524d\u63d0\u6761\u4ef6 413 \u8bf7\u6c42\u5b9e\u4f53\u8fc7\u5927 \u8d85\u51fa\u80fd\u529b 414 \u8bf7\u6c42URI\u8fc7\u957f \u7f51\u5740\u8fc7\u957f\uff0c\u65e0\u6cd5\u5904\u7406 415 \u4e0d\u652f\u6301\u7c7b\u578b \u683c\u5f0f\u4e0d\u652f\u6301 416 \u8bf7\u6c42\u8303\u56f4\u4e0d\u7b26 \u9875\u9762\u65e0\u6cd5\u63d0\u4f9b\u8bf7\u6c42\u8303\u56f4 417 \u672a\u6ee1\u8db3\u671f\u671b\u503c \u672a\u6ee1\u8db3\u671f\u671b\u8bf7\u6c42\u6807\u5934\u5b57\u6bb5 500 \u670d\u52a1\u5668\u5185\u90e8\u53d1\u751f\u9519\u8bef \u670d\u52a1\u5668\u9519\u8bef 501 \u672a\u5b9e\u73b0 \u4e0d\u5177\u5907\u529f\u80fd 502 \u9519\u8bef\u7f51\u5173 \u6536\u5230\u65e0\u6548\u54cd\u5e94 503 \u670d\u52a1\u4e0d\u53ef\u7528 \u65e0\u6cd5\u4f7f\u7528 504 \u7f51\u5173\u8d85\u65f6 \u6ca1\u53ca\u65f6\u6536\u5230\u8bf7\u6c42 505 HTTP\u7248\u672c\u4e0d\u652f\u6301 \u4e0d\u652f\u6301HTTP\u534f\u8bae\u7248\u672c <p>2.\u54cd\u5e94\u5934\uff08Response Headers\uff09</p> <p>\u5305\u542b\u670d\u52a1\u5668\u5bf9\u8bf7\u6c42\u7684\u5e94\u7b54\u4fe1\u606f\u3002</p> \u54cd\u5e94\u5934 \u8bf4\u660e Allow \u670d\u52a1\u5668\u652f\u6301\u7684\u8bf7\u6c42\u65b9\u6cd5(\u5982GET\u3001POST\u7b49) Content-Encondig \u6587\u6863\u7f16\u7801\u65b9\u6cd5\u3002 Content-Length \u5185\u5bb9\u957f\u5ea6\uff0c\u6d4f\u89c8\u5668\u6301\u4e45HTTP\u8fde\u63a5\u65f6\u9700\u8981 Content-Type \u6587\u6863\u7684MIME\u7c7b\u578b Date GMT\u65f6\u95f4 Expires \u8fc7\u671f\u65f6\u95f4\u540e\uff0c\u4e0d\u518d\u7f13\u5b58 Last-Modified \u6587\u6863\u6700\u540e\u6539\u52a8\u65f6\u95f4\u3002\u901a\u8fc7\u6bd4\u8f83\u5ba2\u6237\u7aef\u5934if-Modified-Since\uff0c\u53ef\u80fd\u8fd4\u56de304\uff08Not Modified\uff09\u3002 Location \u5ba2\u6237\u7aef\u5e94\u53bb\u54ea\u91cc\u63d0\u53d6\u6587\u6863\u3002 Refresh \u6d4f\u89c8\u5668\u5e94\u5237\u65b0\u65f6\u95f4\uff0c\u79d2 Server \u670d\u52a1\u5668\u540d\u5b57 Set-Cookie \u8bbe\u7f6e\u9875\u9762\u5173\u8054Cookie WWW-Authenticate \u5ba2\u6237\u5e94\u5728Authorization\u4e2d\u63d0\u4f9b\u6388\u6743\u4fe1\u606f\uff0c\u901a\u5e38\u8fd4\u56de401\u3002 <p>3.\u54cd\u5e94\u4f53\uff08Response Body\uff09</p> <p>HTTP\u8bf7\u6c42\u8fd4\u56de\u7684\u5185\u5bb9\u3002</p> <p>HTML\uff0c\u4e8c\u8fdb\u5236\u6570\u636e\uff0cJSON\u6587\u6863\uff0cXML\u6587\u6863\u7b49\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#5uri\u4e0eurl","title":"5.URI\u4e0eURL","text":"<p>1.URI\uff08Uniform Resource Identifier\uff0c\u7edf\u4e00\u8d44\u6e90\u6807\u8bc6\u7b26\uff09 \u7528\u6765\u6807\u8bc6Web\u4e0a\u6bcf\u4e00\u79cd\u53ef\u7528\u8d44\u6e90\uff0c\u6982\u5ff5\u3002\u7531\u8d44\u6e90\u7684\u547d\u540d\u673a\u5236\u3001\u5b58\u653e\u8d44\u6e90\u7684\u4e3b\u673a\u540d\u3001\u8d44\u6e90\u81ea\u8eab\u7684\u540d\u79f0\u7b49\u7ec4\u6210\u3002</p> <p>2.URL\uff08Uniform Resource Locator\uff0c\u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\uff09 \u7528\u4e8e\u63cf\u8ff0\u7f51\u7edc\u4e0a\u7684\u8d44\u6e90\uff08\u63cf\u8ff0\u4fe1\u606f\u8d44\u6e90\u7684\u5b57\u7b26\u4e32\uff09\uff0c\u5b9e\u73b0\u3002\u4f7f\u7528\u7edf\u4e00\u683c\u5f0f\uff0c\u5305\u62ec\u6587\u4ef6\u3001\u670d\u52a1\u5668\u5730\u5740\u548c\u76ee\u5f55\u7b49\u3002</p> <pre><code>scheme://host[:port#]/path/.../[?query-string][#anchor]\n//\u534f\u8bae\uff08\u670d\u52a1\u65b9\u5f0f\uff09\n//\u4e3b\u673a\u57df\u540d\u6216IP\u5730\u5740\uff08\u53ef\u542b\u7aef\u53e3\u53f7\uff09\n//\u5177\u4f53\u5730\u5740\uff0c\u76ee\u5f55\u548c\u6587\u4ef6\u540d\u7b49\n</code></pre> <p>3.URN\uff08Uniform Resource Name\uff0c\u7edf\u4e00\u8d44\u6e90\u540d\uff09 \u5e26\u6709\u540d\u5b57\u7684\u56e0\u7279\u7f51\u8d44\u6e90\uff0c\u662fURL\u7684\u66f4\u65b0\u5f62\u5f0f\uff0c\u4e0d\u4f9d\u8d56\u4f4d\u7f6e\uff0c\u53ef\u51cf\u5c11\u5931\u6548\u94fe\u63a5\u4e2a\u6570\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#6https\u7b80\u4ecb","title":"6.HTTPS\u7b80\u4ecb","text":"<p>HTTPS\uff08Hyper Text Transfer Protocol over SecureSocket Layer\uff09\uff0c\u5728HTTP\u57fa\u7840\u4e0a\uff0c\u901a\u8fc7\u4f20\u8f93\u52a0\u5bc6\u548c\u8eab\u4efd\u8ba4\u8bc1\u4fdd\u8bc1\u4f20\u8f93\u8fc7\u7a0b\u7684\u5b89\u5168\u578b\u3002</p> <p>HTTP + SSL/TLS\u3002</p> <p>TLS\uff08Transport Layer Security\uff0c\u4f20\u8f93\u5c42\u5b89\u5168\u6027\u534f\u8bae\uff09\uff0c\u53ca\u5176\u524d\u8eabSSL\uff08Secure Socket Layer\uff0c\u5b89\u5168\u5957\u63a5\u5b57\u5c42\uff09\uff0c\u4fdd\u969c\u901a\u4fe1\u5b89\u5168\u548c\u6570\u636e\u5b8c\u6574\u6027\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#7http2\u7b80\u4ecb","title":"7.HTTP2\u7b80\u4ecb","text":"<p>1.HTTP\u534f\u8bae\u5386\u53f2</p> <ul> <li> <p>HTTP 0.9     \u53ea\u652f\u6301GET\u65b9\u6cd5\uff0c\u4e0d\u652f\u6301MIME\u7c7b\u578b\u548cHTTP\u5404\u79cd\u5934\u4fe1\u606f\u7b49\u3002</p> </li> <li> <p>HTTP 1.0     \u589e\u52a0\u5f88\u591a\u65b9\u6cd5\u3001\u5404\u79cdHTTP\u5934\u4fe1\u606f\uff0c\u4ee5\u53ca\u5bf9\u591a\u5a92\u4f53\u5bf9\u8c61\u7684\u5904\u7406\u3002</p> </li> <li> <p>HTTP 1.1     \u4e3b\u6d41HTTP\u534f\u8bae\uff0c\u6539\u5584\u7ed3\u6784\u6027\u7f3a\u9677\uff0c\u660e\u786e\u8bed\u4e49\uff0c\u589e\u5220\u7279\u6027\uff0c\u652f\u6301\u66f4\u590d\u6742\u7684Web\u5e94\u7528\u7a0b\u5e8f\u3002</p> </li> <li> <p>HTTP 2     \u4f18\u5316\u6027\u80fd\uff0c\u517c\u5bb9HTTP 1.1\u8bed\u4e49\uff0c\u662f\u4e8c\u8fdb\u5236\u534f\u8bae\uff0c\u5934\u90e8\u91c7\u7528HPACK\u538b\u7f29\uff0c\u652f\u6301\u591a\u8def\u590d\u7528\u3001\u670d\u52a1\u5668\u63a8\u9001\u7b49\u3002</p> </li> </ul> <p>2.HTTP 1.1\u4e0eHTTP 2\u7684\u5bf9\u6bd4</p> <ul> <li> <p>\u5934\u4fe1\u606f\u538b\u7f29     HTTP 1.1\u4e2d\uff0c\u6bcf\u4e00\u6b21\u53d1\u9001\u548c\u54cd\u5e94\uff0c\u90fd\u6709HTTP\u5934\u4fe1\u606f\u3002HTTP 2\u538b\u7f29\u5934\u4fe1\u606f\uff0c\u51cf\u5c11\u5e26\u5bbd\u3002</p> </li> <li> <p>\u63a8\u9001\u529f\u80fd     HTTP 2\u4e4b\u524d\uff0c\u53ea\u80fd\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\uff0c\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u3002     HTTP2\u4e2d\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u4e3b\u52a8\u5411\u5ba2\u6237\u7aef\u53d1\u8d77\u4e00\u4e9b\u6570\u636e\u4f20\u8f93\uff08\u5982css\u548cpng\u7b49\uff09\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u5e76\u884c\u53d1\u9001html\uff0ccss\uff0cjs\u7b49\u6570\u636e\u3002</p> </li> </ul>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#8web\u5e94\u7528\u7a0b\u5e8f\u7684\u7ec4\u6210","title":"8.Web\u5e94\u7528\u7a0b\u5e8f\u7684\u7ec4\u6210","text":"<p>1.\u5904\u7406\u5668\uff08hendler\uff09 \u63a5\u6536HTTP\u8bf7\u6c42\u5e76\u5904\u7406\u3002\u8c03\u7528\u6a21\u677f\u5f15\u64ce\u751f\u6210html\u6587\u6863\u8fd4\u7ed9\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/6.Web%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B/#81-mvc\u8f6f\u4ef6\u67b6\u6784\u6a21\u578b","title":"8.1 MVC\u8f6f\u4ef6\u67b6\u6784\u6a21\u578b","text":"<ul> <li> <p>\u6a21\u578b\uff08Model\uff09     \u5904\u7406\u4e0e\u4e1a\u52a1\u903b\u8f91\u76f8\u5173\u7684\u6570\u636e\uff0c\u4ee5\u53ca\u5c01\u88c5\u5bf9\u6570\u636e\u7684\u5904\u7406\u65b9\u6cd5\u3002\u6709\u5bf9\u6570\u636e\u76f4\u63a5\u8bbf\u95ee\u7684\u6743\u529b\uff0c\u4f8b\u5982\u8bbf\u95ee\u6570\u636e\u5e93\u3002</p> </li> <li> <p>\u89c6\u56fe\uff08View\uff09     \u5b9e\u73b0\u6709\u76ee\u7684\u7684\u663e\u793a\u6570\u636e\uff0c\u4e00\u822c\u6ca1\u6709\u7a0b\u5e8f\u7684\u903b\u8f91\u3002</p> </li> <li> <p>\u63a7\u5236\u5668\uff08Controller\uff09     \u7ec4\u7ec7\u4e0d\u540c\u5c42\u9762\uff0c\u63a7\u5236\u6d41\u7a0b\uff0c\u5904\u7406\u7528\u6237\u8bf7\u6c42\uff0c\u6a21\u578b\u4ea4\u4e92\u7b49\u4e8b\u4ef6\uff0c\u5e76\u505a\u51fa\u54cd\u5e94\u3002</p> </li> <li> <p>\u6a21\u677f\u5f15\u64ce\uff08template engine\uff09</p> </li> </ul> <p>\u5206\u79bb\u754c\u9762\u4e0e\u6570\u636e\uff08\u5185\u5bb9\uff09\uff0c\u7ec4\u5408\u6a21\u677f\uff08template\uff09\u4e0e\u6570\u636e\uff08data\uff09\uff0c\u751f\u6210html\u6587\u6863\u3002</p> <p>\u5206\u4e3a\u7f6e\u6362\u578b\uff08\u6a21\u677f\u5185\u5bb9\u4e2d\u7279\u5b9a\u6807\u8bb0\u66ff\u6362\uff09\u3001\u89e3\u91ca\u578b\u548c\u7f16\u8bd1\u578b\u7b49\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/","title":"net/http\u5305","text":""},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/#1\u521b\u5efa\u7b80\u5355\u670d\u52a1\u5668\u7aef","title":"1.\u521b\u5efa\u7b80\u5355\u670d\u52a1\u5668\u7aef","text":"<p>1.\u521b\u5efa\u548c\u89e3\u6790HTTP\u670d\u52a1\u5668\u7aef</p> <p>\u5176\u5b9eGo\u8bed\u8a00\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684HTTP\u670d\u52a1\u5668\u7a0b\u5e8f\uff0c\u4e0eJava Web\u7684servlet\u5dee\u4e0d\u591a\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u8fd9\u91cc\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u6253\u5370\"Hello World\"\u7684\u7a0b\u5e8f\u3002\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p><pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\nfunc helloworld(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"Hello World\")\n}\nfunc main() {\nserver := &amp;http.Server{\nAddr: \"127.0.0.1:8888\",\n}\nhttp.HandleFunc(\"/\", helloworld)\nserver.ListenAndServe()\n}\n</code></pre> \u8fd0\u884c\u4e4b\u540e\uff0c\u5728\u6d4f\u89c8\u5668\u7684\u7f51\u9875\u8f93\u5165\u6846\u4e2d\u8f93\u5165127.0.0.1\u5c31\u4f1a\u51fa\u73b0\"Hello World\"\u7684\u7b80\u5355\u7f51\u9875\u3002</p> <p>\u8fd9\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u9700\u8981\u901a\u8fc7Go\u8bed\u8a00\u521b\u5efa\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u5c31\u9700\u8981\u4e86\u89e3net/http\u5305\u7684\u5185\u90e8\u903b\u8f91\u3002 \u6211\u4eec\u53ea\u770bmain()\u51fd\u6570\u4e2d\u7684\u4ee3\u7801\uff0c\u4f1a\u53d1\u73b0\u5176\u8c03\u7528\u4e86**HandleFunc()\u51fd\u6570**\u4ee5\u53ca**ListenAndServe()\u51fd\u6570**\u3002</p> <pre><code>// http.HandleFunc()\u51fd\u6570\n//\u8f93\u5165\u53c2\u6570\uff1a\u76d1\u542c\u7aef\u53e3\u53f7\u548c\u4e8b\u4ef6\u5904\u7406\u5668handler\n// http.ListenAndServe()\u51fd\u6570\ntype Handler interface {\nServeHTTP(ResponseWriter, *Request)\n}\ntype HandlerFunc func(ResponseWriter, *Request)\nfunc (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) {\nf(w, r)\n}\n</code></pre> <p>\u5b9e\u73b0ServeHTTP()\u65b9\u6cd5</p> <p>\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\ntype Refer struct {\nhandler http.Handler\nrefer   string\n}\nfunc (this *Refer) ServeHTTP(w http.ResponseWriter, r *http.Request) {\nif r.Referer() == this.refer {\nthis.handler.ServeHTTP(w, r)\n} else {\nw.WriteHeader(403)\n}\n}\nfunc myHandler(w http.ResponseWriter, r *http.Request) {\nw.Write([]byte(\"\u8fd9\u662fhandler\"))\n}\nfunc helloworld(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"Hello World\")\n}\nfunc main() {\nreferer := &amp;Refer{\nhandler: http.HandlerFunc(myHandler),\nrefer:   \"www.liyuanjing.com\",\n}\nhttp.HandleFunc(\"/hello\", helloworld)\nhttp.ListenAndServe(\":80\", referer)\n}\n</code></pre></p> <p>2.\u521b\u5efa\u4e00\u4e2aHTTPS\u670d\u52a1\u7aef</p> <p>\u5728Go\u8bed\u8a00\u4e2d\uff0cnet/http\u5305\u4e2d\u63d0\u4f9b\u4e86\u521b\u5efaHTTPS\u670d\u52a1\u7684\u65b9\u6cd5\uff0c\u5176\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>//\u8bc1\u4e66\u6587\u4ef6\u8def\u5f84\uff0c\u79c1\u94a5\u6587\u4ef6\u8def\u5f84\nfunc (srv *Server) ListenAndServeTLS(certFile, keyFile string) error\n</code></pre> <p>\u9996\u5148\uff0c\u4f60\u9700\u8981\u4fdd\u8bc1\u7535\u8111\u4e0b\u8f7d\uff0c\u5e76\u6b63\u786e\u914d\u7f6e\u4e86openssl\u3002\u5982\u679c\u5df2\u7ecf\u4e0b\u8f7d\u914d\u7f6e\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u884c\u8fdb\u884c\u8bc1\u4e66\u4e0e\u79c1\u94a5\u7684\u521b\u5efa\u3002 <pre><code>openssl req -newkey rsa:2048 -nodes -keyout server.key -x509 -days 365 -out server.crt\n</code></pre> \u6267\u884c\u8be5\u547d\u4ee4\u540e\uff0c\u547d\u4ee4\u884c\u7684\u8f93\u51fa\u5185\u5bb9\u5982\u4e0b\u3002\u8fd9\u91cc\uff0c\u8bfb\u8005\u53ef\u4ee5\u968f\u4fbf\u8f93\u5165\u3002</p> <p>\u6267\u884c\u5b8c\u8fd9\u4e9b\u547d\u4ee4\u540e\uff0c\u8be5\u76ee\u5f55\u4e0b\u4f1a\u81ea\u52a8\u751f\u62102\u4e2a\u6587\u4ef6server.crt\u4e0eserver.key\u3002\u4e0b\u9762\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd92\u4e2a\u6587\u4ef6\u6765\u521b\u5efa\u81ea\u5df1\u7684HTTPS\u670d\u52a1\u5668\u4e86\u3002</p> <pre><code>package main\nimport (\n\"log\"\n\"net/http\"\n)\nfunc handle(w http.ResponseWriter, r *http.Request) {\nlog.Printf(\"Got connection: %s\", r.Proto)\nw.Write([]byte(\"Hello this is a HTTP 2 message!\"))\n}\nfunc main() {\nsrv := &amp;http.Server{Addr: \":8088\", Handler: http.HandlerFunc(handle)}\nlog.Printf(\"Serving on https://0.0.0.0:8088\")\nlog.Fatal(srv.ListenAndServeTLS(\"server.crt\", \"server.key\"))\n}\n</code></pre>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/#2\u521b\u5efa\u7b80\u5355\u7684\u5ba2\u6237\u7aef","title":"2.\u521b\u5efa\u7b80\u5355\u7684\u5ba2\u6237\u7aef","text":"<pre><code>//src/net/http/client.go\nvar DefaultClient = &amp;Client{}\nfunc Get(url string) (resp *Response, err error) {\nreturn DefaultClient.Get(url)\n}\nfunc (c *Client) Get(url string) (resp *Response, err error) {\nreq, err := NewRequest(\"GET\", url, nil)\nif err != nil {\nreturn nil, err\n}\nreturn c.Do(req)\n}\nfunc Post(url, contentType string, body io.Reader) (resp *Response, err error) {\nreturn DefaultClient.Post(url, contentType, body)\n}\nfunc (c *Client) Post(url, contentType string, body io.Reader) (resp *Response, err error) {\nreq, err := NewRequest(\"POST\", url, body)\nif err != nil {\nreturn nil, err\n}\nreq.Header.set(\"Content-Type\", contentType)\nreturn c.Do(req)\n}\n</code></pre> <pre><code>func NewRequest(method, url string, body io.Reader) (*Request, error)\n//\u8bf7\u6c42\u7c7b\u578b\n//\u8bf7\u6c42\u5730\u5740\n//\u82e5body\u5b9e\u73b0io.Closer\u63a5\u53e3\uff0c\u5219Request\u8fd4\u56de\u503c\u7684Body\u5b57\u6bb5\u4f1a\u88ab\u8bbe\u7f6e\u4e3abody\u503c\uff0c\u5e76\u88abClient\u7684Do()\u3001Post()\u548cPostForm()\u65b9\u6cd5\u5173\u95ed\u3002\n</code></pre>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/#1-\u521b\u5efaget\u8bf7\u6c42","title":"1. \u521b\u5efaGET\u8bf7\u6c42","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"net/http\"\n)\nfunc main() {\nresp, err := http.Get(\"https://www.baidu.com\")\nif err != nil {\nfmt.Println(\"err:\", err)\n}\ncloser := resp.Body\nbytes, err := ioutil.ReadAll(closer)\nfmt.Println(string(bytes))\n}\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u8f7b\u677e\u83b7\u53d6\u767e\u5ea6\u9996\u9875\u7684HTML\u6587\u6863\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/#2-\u521b\u5efapost\u8bf7\u6c42","title":"2. \u521b\u5efaPOST\u8bf7\u6c42","text":"<pre><code>package main\nimport (\n\"bytes\"\n\"fmt\"\n\"io/ioutil\"\n\"net/http\"\n)\nfunc main() {\nurl := \"https://www.shirdon.com/comment/add\"\nbody := `{\"userId\": 1, \"articleId\": 1, \"comment\": \u8fd9\u662f\u4e00\u6761\u8bc4\u8bba}`\nresp, err := http.Post(url, \"application/x-www-form-urlencoded\", bytes.NewBuffer([]byte(body)))\nif err != nil {\nfmt.Println(\"err:\", err)\n}\nbytes, err := ioutil.ReadAll(resp.Body)\nfmt.Println(string(bytes))\n}\n</code></pre>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/#3-\u521b\u5efaput\u8bf7\u6c42","title":"3. \u521b\u5efaPUT\u8bf7\u6c42","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"net/http\"\n\"strings\"\n)\nfunc main() {\nurl := \"https://www.shirdon.com/comment/update\"\npayload := strings.NewReader(`{\"userId\": 1, \"articleId\": 1, \"comment\": \u8fd9\u662f\u4e00\u6761\u8bc4\u8bba}`)\nreq, _ := http.NewRequest(\"PUT\", url, payload)\nreq.Header.Add(\"Content-Type\", \"application/json\")\nres, err := http.DefaultClient.Do(req)\nif err != nil {\nfmt.Println(\"err:\", err)\n}\ndefer res.Body.Close()\nbytes, err := ioutil.ReadAll(res.Body)\nfmt.Println(string(bytes))\n}\n</code></pre> <p>PUT\u65b9\u6cd5\u5728Go\u8bed\u8a00\u4e2d\u6ca1\u6709\u88ab\u5355\u72ec\u5c01\u88c5,\u53ea\u80fd\u76f4\u63a5\u8c03\u7528http.NewRequest()\u51fd\u6570\u6765\u5b9e\u73b0\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/#4-\u521b\u5efadelete\u8bf7\u6c42","title":"4. \u521b\u5efaDELETE\u8bf7\u6c42","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"net/http\"\n\"strings\"\n)\nfunc main() {\nurl := \"https://www.shirdon.com/comment/delete\"\npayload := strings.NewReader(`{\"userId\": 1, \"articleId\": 1, \"comment\": \u8fd9\u662f\u4e00\u6761\u8bc4\u8bba}`)\nreq, _ := http.NewRequest(\"DELETE\", url, payload)\nreq.Header.Add(\"Content-Type\", \"application/json\")\nres, err := http.DefaultClient.Do(req)\nif err != nil {\nfmt.Println(\"err:\", err)\n}\ndefer res.Body.Close()\nbytes, err := ioutil.ReadAll(res.Body)\nfmt.Println(string(bytes))\n}\n</code></pre> <p>DELETE\u65b9\u6cd5\u5728Go\u8bed\u8a00\u4e2d\u6ca1\u6709\u88ab\u5355\u72ec\u5c01\u88c5,\u53ea\u80fd\u76f4\u63a5\u8c03\u7528http.NewRequest()\u51fd\u6570\u6765\u5b9e\u73b0\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/7.net-http%E5%8C%85/#5-\u8bf7\u6c42\u5934\u8bbe\u7f6e","title":"5. \u8bf7\u6c42\u5934\u8bbe\u7f6e","text":"<p>net/http\u5305\u63d0\u4f9b\u4e86Header\u7c7b\u578b\uff0c\u7528\u4e8e\u8bf7\u6c42\u5934\u4fe1\u606f\u7684\u83b7\u53d6\u548c\u586b\u5145\uff0c\u5176\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>type Header map[string][]string\n</code></pre> <pre><code>headers := http.Header{\"token\": {\"feeowiwpor23dlspweh\"}}\nheaders.Add(\"Accept-Charset\", \"UTF-8\")\nheaders.Set(\"Host\", \"www.shirdon.com\")\nheaders.Set(\"Location\", \"www.baidu.com\")\n</code></pre>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/","title":"html/template\u5305","text":"<p>text/template\u5904\u7406\u4efb\u610f\u683c\u5f0f\u7684\u6587\u672c\uff0chtml/template\u751f\u6210\u53ef\u5bf9\u6297\u4ee3\u7801\u6ce8\u5165\u7684\u5b89\u5168html\u6587\u6863\u3002</p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/#1\u6a21\u677f\u539f\u7406","title":"1.\u6a21\u677f\u539f\u7406","text":"<p>1.\u6a21\u677f\u548c\u6a21\u677f\u5f15\u64ce \u6a21\u677f\u662f\u4e8b\u5148\u5b9a\u4e49\u597d\u7684\u4e0d\u53d8\u7684html\u6587\u6863\uff0c\u6a21\u677f\u6e32\u67d3\u4f7f\u7528\u53ef\u53d8\u6570\u636e\u66ff\u6362html\u6587\u6863\u4e2d\u7684\u6807\u8bb0\u3002\u6a21\u677f\u7528\u4e8e\u663e\u793a\u548c\u6570\u636e\u5206\u79bb(\u524d\u540e\u7aef\u5206\u79bb)\u3002\u6a21\u677f\u6280\u672f\uff0c\u672c\u8d28\u662f\u6a21\u677f\u5f15\u64ce\u5229\u7528\u6a21\u677f\u6587\u4ef6\u548c\u6570\u636e\u751f\u6210html\u6587\u6863\u3002</p> <p>2.Go\u8bed\u8a00\u6a21\u677f\u5f15\u64ce</p> <ul> <li>\u6a21\u677f\u6587\u4ef6\u540e\u7f00\u540d\u901a\u5e38\u4e3a.tmpl\u548c.tpl\uff0cUTF-8\u7f16\u7801</li> <li>\u6a21\u677f\u6587\u4ef6\u4e2d{{\u548c}}\u5305\u88f9\u548c\u6807\u8bc6\u4f20\u5165\u6570\u636e</li> <li>\u70b9\u53f7\uff08.\uff09\u8bbf\u95ee\u6570\u636e\uff0c{{.FieldName}}\u8bbf\u95ee\u5b57\u6bb5</li> <li>\u9664{{\u548c}}\u5305\u88f9\u5185\u5bb9\u5916\uff0c\u5176\u4ed6\u5185\u5bb9\u539f\u6837\u8f93\u51fa</li> </ul> <p>\u4f7f\u7528\uff1a \uff081\uff09\u5b9a\u4e49\u6a21\u677f\u6587\u4ef6 \u6309\u7167\u76f8\u5e94\u8bed\u6cd5\u89c4\u5219\u53bb\u5b9a\u4e49\u3002</p> <p>\uff082\uff09\u89e3\u6790\u6a21\u677f\u6587\u4ef6</p> <p>\u521b\u5efa\u6307\u5b9a\u6a21\u677f\u540d\u79f0\u7684\u6a21\u677f\u5bf9\u8c61 <pre><code>func New(name string) *Template\n</code></pre></p> <p>\u89e3\u6790\u6a21\u677f\u5185\u5bb9 <pre><code>func (t *Template) Parse(src string) (*Template, error)\n</code></pre></p> <p>\u89e3\u6790\u6a21\u677f\u6587\u4ef6 <pre><code>func ParseFiles(filenames...string) (*Template, error)\n</code></pre></p> <p>\u6b63\u5219\u5339\u914d\u89e3\u6790\u6587\u4ef6\uff0ctemplate.ParaeGlob(\"a*\") <pre><code>func ParseGlob(pattern string) (*Template, error)\n</code></pre></p> <p>\uff083\uff09\u6e32\u67d3\u6a21\u677f\u6587\u4ef6 <pre><code>func (t *Template) Execute(wr io.Writer, data interface{}) error\n//\u914d\u5408ParseFiles()\u51fd\u6570\u4f7f\u7528\uff0c\u9700\u6307\u5b9a\u6a21\u677f\u540d\u79f0\nfunc (t *Template) ExecuteTemplate(wr io.Writer, name string, data interface{}) error\n</code></pre></p>"},{"location":"Golang/2.Go-Web%E5%9F%BA%E7%A1%80/8.html-template%E5%8C%85/#2\u4f7f\u7528htmltemplate\u5305","title":"2.\u4f7f\u7528html/template\u5305","text":"<p>\u7b2c1\u4e2a\u6a21\u677f</p> <p><code>template_example.tmpl</code></p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta charset=\"UTF-8\"&gt;\n&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n&lt;title&gt;\u6a21\u677f\u4f7f\u7528\u793a\u4f8b&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;p&gt;\u52a0\u6cb9\uff0c\u5c0f\u4f19\u4f34\uff0c {{ . }} &lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>main.go</p> <pre><code>package main\nimport (\n\"fmt\"\n\"html/template\"\n\"net/http\"\n)\nfunc helloHandleFunc(w http.ResponseWriter, r *http.Request) {\n// 1. \u89e3\u6790\u6a21\u677f\nt, err := template.ParseFiles(\"./template_example.tmpl\")\nif err != nil {\nfmt.Println(\"template parsefile failed, err:\", err)\nreturn\n}\n// 2.\u6e32\u67d3\u6a21\u677f\nname := \"\u6211\u7231Go\u8bed\u8a00\"\nt.Execute(w, name)\n}\nfunc main() {\nhttp.HandleFunc(\"/\", helloHandleFunc)\nhttp.ListenAndServe(\":8086\", nil)\n}\n</code></pre> <p>2.\u6a21\u677f\u8bed\u6cd5 \u6a21\u677f\u8bed\u6cd5\u90fd\u5305\u542b\u5728{{\u548c}}\u4e2d\u95f4\u3002 <pre><code>type UserInfo struct {\nName string\nGender string\nAge int\n}\nfunc sayHello(w http.ResponseWriter, r *http.Request) {\ntmpl, err := template.ParseFiles(\"./hello.html\")\nif err != nil {\nfmp.Println(\"create template failed, err:\", err)\nreturn\n}\nuser := UserInfo {\nName: \"\u5f20\u4e09\",\nGender: \"\u7537\",\nAge: 28,\n}\ntmpl.Execute(w, user)\n}\n</code></pre></p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta charset=\"UTF-8\"&gt;\n&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n&lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n&lt;title&gt;Hello&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;p&gt;Hello {{.Name}}&lt;/p&gt;\n&lt;p&gt;\u6027\u522b\uff1a{{.Gender}}&lt;/p&gt;\n&lt;p&gt;\u5e74\u9f84\uff1a{{.Age}}&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u5e38\u7528\u8bed\u6cd5\uff1a</p> <ul> <li> <p>\u6ce8\u91ca <pre><code>{{/* \u8fd9\u662f\u4e00\u4e2a\u6ce8\u91ca\uff0c\u4e0d\u4f1a\u89e3\u6790 */}}\n</code></pre></p> </li> <li> <p>\u7ba1\u9053\uff08pipeline\uff09 \u4ea7\u751f\u6570\u636e\u7684\u64cd\u4f5c\uff0c{{.Name}}\u7b49\u3002\u652f\u6301|\u94fe\u63a5\u591a\u4e2a\u547d\u4ee4\uff0c\u7c7b\u4f3cUNIX\u4e0b\u7ba1\u9053\u3002</p> </li> <li> <p>\u53d8\u91cf \u53d8\u91cf\u6355\u83b7\u7ba1\u9053\u7684\u6267\u884c\u7ed3\u679c\u3002</p> </li> </ul> <pre><code>$variable := pipeline\n</code></pre> <ul> <li> <p>\u6761\u4ef6\u5224\u65ad <pre><code>{{if pipeline}} T1 {{end}}\n{{if pipeline}} T1 {{else}} T0 {{end}}\n{{if pipeline}} T1 {{else if pipeline}} T0 {{end}}\n</code></pre></p> </li> <li> <p>range\u5173\u952e\u5b57 <pre><code>{{range pipeline}} T1 {{end}}\n{{range pipeline}} T1 {{else}} T0 {{end}}\n</code></pre></p> </li> </ul> <pre><code>package main\nimport (\n\"log\"\n\"os\"\n\"text/template\"\n)\nfunc main() {\n//\u521b\u5efa\u4e00\u4e2a\u6a21\u7248\nrangeTemplate := `\n{{if .Kind}}\n{{range $i, $v := .MapContent}}\n{{$i}} =&gt; {{$v}} , {{$.OutsideContent}}\n{{end}}\n{{else}}\n{{range .MapContent}}\n{{.}} , {{$.OutsideContent}}\n{{end}}    \n{{end}}`\nstr1 := []string{\"\u7b2c\u4e00\u6b21 range\", \"\u7528 index \u548c value\"}\nstr2 := []string{\"\u7b2c\u4e8c\u6b21 range\", \"\u6ca1\u6709\u7528 index \u548c value\"}\ntype Content struct {\nMapContent     []string\nOutsideContent string\nKind           bool\n}\nvar contents = []Content{\n{str1, \"\u7b2c\u4e00\u6b21\u5916\u9762\u7684\u5185\u5bb9\", true},\n{str2, \"\u7b2c\u4e8c\u6b21\u5916\u9762\u7684\u5185\u5bb9\", false},\n}\n// \u521b\u5efa\u6a21\u677f\u5e76\u5c06\u5b57\u7b26\u89e3\u6790\u8fdb\u53bb\nt := template.Must(template.New(\"range\").Parse(rangeTemplate))\n// \u63a5\u6536\u5e76\u6267\u884c\u6a21\u677f\nfor _, c := range contents {\nerr := t.Execute(os.Stdout, c)\nif err != nil {\nlog.Println(\"executing template:\", err)\n}\n}\n}\n/*\n//\u8f93\u51fa\n0 =&gt; \u7b2c\u4e00\u6b21 range, \u7b2c\u4e00\u6b21\u5916\u9762\u7684\u5185\u5bb9\n1 =&gt; \u7528 index \u548c value, \u7b2c\u4e00\u6b21\u5916\u9762\u7684\u5185\u5bb9\n\u7b2c\u4e8c\u6b21 range, \u7b2c\u4e8c\u6b21\u5916\u9762\u7684\u5185\u5bb9\n\u6ca1\u6709\u7528 index \u548c value, \u7b2c\u4e8c\u6b21\u5916\u9762\u7684\u5185\u5bb9\n*/\n</code></pre> <ul> <li> <p>with\u5173\u952e\u5b57 <pre><code>{{with pipeline}} T1 {{end}}\n{{with pipeline}} T1 {{else}} T0 {{end}}\n</code></pre></p> </li> <li> <p>\u6bd4\u8f83\u51fd\u6570</p> </li> </ul> <p>\u6bd4\u8f83\u51fd\u6570\u53ea\u9002\u7528\u4e8e\u57fa\u672c\u51fd\u6570\uff08\u6216\u91cd\u5b9a\u4e49\u7684\u57fa\u672c\u7c7b\u578b\uff0c\u5982type Banance float32\uff09\uff0c\u6574\u6570\u548c\u6d6e\u70b9\u6570\u4e0d\u80fd\u76f8\u4e92\u6bd4\u8f83\u3002</p> <p>\u5e03\u5c14\u51fd\u6570\u5c06\u4efb\u4f55\u7c7b\u578b\u7684\u96f6\u503c\u89c6\u4e3a\u5047\u3002</p> <p>\u53ea\u6709eq\u53ef\u4ee5\u63a5\u53d72\u4e2a\u4ee5\u4e0a\u53c2\u6570\u3002</p> <pre><code>{{eq arg1 arg2 arg3}}\neq\nne\nlt\nle\ngt\nge\n</code></pre> <ul> <li>\u9884\u5b9a\u4e49\u51fd\u6570</li> </ul> \u51fd\u6570\u540d \u529f\u80fd and \u8fd4\u56de\u7b2c1\u4e2a\u7a7a\u53c2\u6570\u6216\u6700\u540e\u4e00\u4e2a\u53c2\u6570\uff0c\u6240\u6709\u53c2\u6570\u90fd\u6267\u884c\u3002and x y\u7b49\u4ef7\u4e8eif x then y else x or \u8fd4\u56de\u7b2c1\u4e2a\u975e\u7a7a\u53c2\u6570\u6216\u6700\u540e\u4e00\u4e2a\u53c2\u6570\uff0c\u6240\u6709\u53c2\u6570\u90fd\u6267\u884c\u3002and x y\u7b49\u4ef7\u4e8eif x then y else x not \u975e len \u957f\u5ea6 index index y 1 2 3, index[1][2][3] print fmt.Sprint printf fmt.Sprintf println fmt.Sprintln html html\u9038\u7801\u7b49\u4ef7\u8868\u793a urlquery \u53ef\u5d4c\u5165URL\u67e5\u8be2\u7684\u9038\u7801\u7b49\u4ef7\u8868\u793a js JavaScript\u9038\u7801\u7b49\u4ef7\u8868\u793a call call func a b, func(a, b);1\u62162\u4e2a\u8fd4\u56de\u503c\uff0c\u7b2c2\u4e2a\u4e3aerror\uff0c\u975enil\u4f1a\u4e2d\u65ad\u5e76\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002 <ul> <li>\u81ea\u5b9a\u4e49\u51fd\u6570 \u6a21\u677f\u5bf9\u8c61t\u7684\u51fd\u6570\u5b57\u5178\u52a0\u5165funcMap\u5185\u7684\u952e\u503c\u5bf9\u3002funcMap\u67d0\u4e2a\u503c\u4e0d\u662f\u51fd\u6570\u7c7b\u578b\uff0c\u6216\u8be5\u51fd\u6570\u7c7b\u578b\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u4f1apanic\u3002\u8fd4\u56de*Template\u4fbf\u4e8e\u94fe\u5f0f\u8c03\u7528\u3002 <pre><code>func (t *Template) Funcs(funcMap FuncMap) *Template\n</code></pre></li> </ul> <p>FuncMap\u6620\u5c04\u51fd\u6570\u8981\u6c421\u62162\u4e2a\u8fd4\u56de\u503c\uff0c\u7b2c2\u4e2a\u4e3aerror\uff0c\u975enil\u4f1a\u4e2d\u65ad\u5e76\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002 <pre><code>type FuncMap map[string]interface{}\n</code></pre></p> <pre><code>package main\nimport (\n\"fmt\"\n\"html/template\"\n\"io/ioutil\"\n\"net/http\"\n)\nfunc Welcome() string { //\u6ca1\u53c2\u6570\nreturn \"Welcome\"\n}\nfunc Doing(name string) string { //\u6709\u53c2\u6570\nreturn name + \", Learning Go Web template \"\n}\nfunc sayHello(w http.ResponseWriter, r *http.Request) {\nhtmlByte, err := ioutil.ReadFile(\"./funcs.html\")\nif err != nil {\nfmt.Println(\"read html failed, err:\", err)\nreturn\n}\n// \u81ea\u5b9a\u4e49\u4e00\u4e2a\u533f\u540d\u6a21\u677f\u51fd\u6570\nloveGo := func() (string) {\nreturn \"\u6b22\u8fce\u4e00\u8d77\u5b66\u4e60\u300aGo Web\u7f16\u7a0b\u5b9e\u6218\u6d3e\u4ece\u5165\u95e8\u5230\u7cbe\u901a\u300b\"\n}\n// \u91c7\u7528\u94fe\u5f0f\u64cd\u4f5c\u5728Parse()\u65b9\u6cd5\u4e4b\u524d\u8c03\u7528Funcs\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684loveGo\u51fd\u6570\ntmpl1, err := template.New(\"funcs\").Funcs(template.FuncMap{\"loveGo\": loveGo}).Parse(string(htmlByte))\nif err != nil {\nfmt.Println(\"create template failed, err:\", err)\nreturn\n}\nfuncMap := template.FuncMap{\n//\u5728FuncMap\u4e2d\u58f0\u660e\u76f8\u5e94\u8981\u4f7f\u7528\u7684\u51fd\u6570\uff0c\u7136\u540e\u5c31\u80fd\u591f\u5728template\u5b57\u7b26\u4e32\u4e2d\u4f7f\u7528\u8be5\u51fd\u6570\n\"Welcome\": Welcome,\n\"Doing\":   Doing,\n}\nname := \"Shirdon\"\ntmpl2, err := template.New(\"test\").Funcs(funcMap).Parse(\"{{Welcome}}&lt;br/&gt;{{Doing .}}\")\nif err != nil {\npanic(err)\n}\n// \u4f7f\u7528user\u6e32\u67d3\u6a21\u677f\uff0c\u5e76\u5c06\u7ed3\u679c\u5199\u5165w\ntmpl1.Execute(w, name)\ntmpl2.Execute(w, name)\n}\nfunc main() {\nhttp.HandleFunc(\"/\", sayHello)\nhttp.ListenAndServe(\":8087\", nil)\n}\n</code></pre> <p>funcs.html <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta charset=\"UTF-8\"&gt;\n&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n&lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n&lt;title&gt;tmpl test&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;{{loveGo}}&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p> <ul> <li>\u6a21\u677f\u5d4c\u5957 \u53ef\u4ee5\u901a\u8fc7\u6587\u4ef6\u5d4c\u5957\u548cdefine\u5b9a\u4e49 <pre><code>{{define \"name\"}} T {{end}}\n</code></pre></li> </ul> <pre><code>{{template \"name\"}}\n{{template \"name\" pipeline}}\n</code></pre> <pre><code>{{block \"name\" pipeline}} T {{end}}\n//\u7b49\u4ef7\u4e8e\n{{define \"name\"}} T {{end}}\n{{template \"name\" pipeline}}\n</code></pre> <p>t.html <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta charset=\"UTF-8\"&gt;\n&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n&lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n&lt;title&gt;tmpl test&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;\u6d4b\u8bd5\u5d4c\u5957template\u8bed\u6cd5&lt;/h1&gt;\n&lt;hr&gt;\n{{template \"ul.html\"}}\n&lt;hr&gt;\n{{template \"ol.html\"}}\n&lt;/body&gt;\n&lt;/html&gt;\n{{define \"ol.html\"}}\n&lt;h1&gt;\u8fd9\u662fol.html&lt;/h1&gt;\n&lt;ol&gt;\n&lt;li&gt;I love Go&lt;/li&gt;\n&lt;li&gt;I love java&lt;/li&gt;\n&lt;li&gt;I love c&lt;/li&gt;\n&lt;/ol&gt;\n{{end}}\n</code></pre></p> <p>ul.html <pre><code>&lt;ul&gt;\n    &lt;li&gt;\u6ce8\u91ca&lt;/li&gt;\n    &lt;li&gt;\u65e5\u5fd7&lt;/li&gt;\n    &lt;li&gt;\u6d4b\u8bd5&lt;/li&gt;\n&lt;/ul&gt;\n</code></pre></p> <p>main.go <pre><code>package main\nimport (\n\"fmt\"\n\"html/template\"\n\"net/http\"\n)\n//\u5b9a\u4e49\u4e00\u4e2aUserInfo\u7ed3\u6784\u4f53\ntype UserInfo struct {\nName string\nGender string\nAge int\n}\nfunc tmplSample(w http.ResponseWriter, r *http.Request) {\ntmpl, err := template.ParseFiles(\"./t.html\", \"./ul.html\")\nif err != nil {\nfmt.Println(\"create template failed, err:\", err)\nreturn\n}\nuser := UserInfo{\nName:   \"\u5f20\u4e09\",\nGender: \"\u7537\",\nAge:    28,\n}\ntmpl.Execute(w, user)\nfmt.Println(tmpl)\n}\nfunc main() {\nhttp.HandleFunc(\"/\", tmplSample)\nhttp.ListenAndServe(\":8087\", nil)\n}\n</code></pre></p>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/","title":"\u5904\u7406\u8bf7\u6c42","text":""},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#1\u4e86\u89e3request\u7ed3\u6784\u4f53","title":"1.\u4e86\u89e3Request\u7ed3\u6784\u4f53","text":"<p>\u4ee5\u4e0b\u662fRequest\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\uff1a</p> <pre><code>type Request struct {\nMethod string     // \u8bf7\u6c42\u7684\u65b9\u6cd5\nURL *url.URL      // \u8bf7\u6c42\u62a5\u6587\u4e2d\u7684URL\u5730\u5740\uff0c\u662f\u6307\u9488\u7c7b\u578b\nProto string      // \u5f62\u5982\uff1a\u201cHTTP/1.0\u201d\nProtoMajor int    // 1\nProtoMinor int    // 0\nHeader Header     // \u8bf7\u6c42\u5934\u5b57\u6bb5\nBody io.ReadCloser  // \u8bf7\u6c42\u4f53\nGetBody func() (io.ReadCloser, error)\nContentLength int64\nTransferEncoding []string\nClose bool\nHost string\n// \u8bf7\u6c42\u62a5\u6587\u4e2d\u7684\u4e00\u4e9b\u53c2\u6570\uff0c\u5305\u62ec\u8868\u5355\u5b57\u6bb5\nForm url.Values\nPostForm url.Values\nMultipartForm *multipart.Form\nTrailer Header\nRemoteAddr string\nRequestURI string\nTLS *tls.ConnectionState\nCancel &lt;-chan struct{}\nResponse *Response\nctx context.Context\n}\n</code></pre> <p>Request\u7ed3\u6784\u4f53\u4e3b\u8981\u7528\u4e8e\u8fd4\u56deHTTP\u8bf7\u6c42\u7684\u54cd\u5e94\uff0c\u662fHTTP\u5904\u7406\u8bf7\u6c42\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u90e8\u5206\u3002 \u53ea\u6709\u6b63\u786e\u5730\u89e3\u6790\u8bf7\u6c42\u6570\u636e\uff0c\u624d\u80fd\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u54cd\u5e94\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"net/http\"\n\"strings\"\n)\nfunc request(w http.ResponseWriter, r *http.Request) {\n// \u8fd9\u4e9b\u4fe1\u606f\u662f\u8f93\u51fa\u5230\u670d\u52a1\u5668\u7aef\u7684\u6253\u5370\u4fe1\u606f\nfmt.Println(\"Request\u89e3\u6790\")\n// HTTP\u65b9\u6cd5\nfmt.Println(\"method\", r.Method)\n// RequestURI\u662f\u88ab\u5ba2\u6237\u7aef\u53d1\u9001\u5230\u670d\u52a1\u7aef\u7684\u8bf7\u6c42\u7684\u8bf7\u6c42\u884c\u4e2d\u672a\u4fee\u6539\u7684\u8bf7\u6c42URI\nfmt.Println(\"RequestURI:\", r.RequestURI)\n// URL\u7c7b\u578b,\u4e0b\u65b9\u5206\u522b\u5217\u51faURL\u7684\u5404\u6210\u5458\nfmt.Println(\"URL_path\", r.URL.Path)\nfmt.Println(\"URL_RawQuery\", r.URL.RawQuery)\nfmt.Println(\"URL_Fragment\", r.URL.Fragment)\n// \u534f\u8bae\u7248\u672c\nfmt.Println(\"proto\", r.Proto)\nfmt.Println(\"protomajor\", r.ProtoMajor)\nfmt.Println(\"protominor\", r.ProtoMinor)\n// HTTP\u8bf7\u6c42\u7684\u5934\u57df\nfor k, v := range r.Header {\nfor _, vv := range v {\nfmt.Println(\"header key:\" + k + \"  value:\" + vv)\n}\n}\n// \u5224\u65ad\u662f\u5426multipart\u65b9\u5f0f\nisMultipart := false\nfor _, v := range r.Header[\"Content-Type\"] {\nif strings.Index(v, \"multipart/form-data\") != -1 {\nisMultipart = true\n}\n}\n// \u89e3\u6790body\nif isMultipart == true {\nr.ParseMultipartForm(128)\nfmt.Println(\"\u89e3\u6790\u65b9\u5f0f:ParseMultipartForm\")\n} else {\nr.ParseForm()\nfmt.Println(\"\u89e3\u6790\u65b9\u5f0f:ParseForm\")\n}\n// body\u5185\u5bb9\u957f\u5ea6\nfmt.Println(\"ContentLength\", r.ContentLength)\n// \u662f\u5426\u5728\u56de\u590d\u8bf7\u6c42\u540e\u5173\u95ed\u8fde\u63a5\nfmt.Println(\"Close\", r.Close)\n// HOSt\nfmt.Println(\"host\", r.Host)\n// \u8be5\u8bf7\u6c42\u7684\u6765\u6e90\u5730\u5740\nfmt.Println(\"RemoteAddr\", r.RemoteAddr)\nfmt.Fprintf(w, \"hello, let's go!\") // \u8fd9\u4e2a\u5199\u5165\u5230w\u7684\u662f\u8f93\u51fa\u5230\u5ba2\u6237\u7aef\u7684\n}\nfunc main() {\nhttp.HandleFunc(\"/hello\", request)\nerr := http.ListenAndServe(\":8081\", nil)\nif err != nil {\nlog.Fatal(\"ListenAndServe:\", err)\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#2\u8bf7\u6c42url","title":"2.\u8bf7\u6c42URL","text":"<p>\u4e00\u4e2aURL\u7531\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a <pre><code>scheme://[userinfo@]host/path[?query][#fragment]\n</code></pre></p> <pre><code>type URL struct {\nScheme string\nOpaque string\nUser *Userinfo\nHost string\nPath string\nRawPath string\nForceQuery bool\nRawQuery string\nFragment string\n}\n</code></pre> <p>\u8be5\u7ed3\u6784\u4f53\u4e3b\u8981\u7528\u6765\u5b58\u50a8URL\u5404\u90e8\u5206\u7684\u503c\u3002net/url\u5305\u4e2d\u7684\u5f88\u591a\u65b9\u6cd5\u90fd\u662f\u5bf9URL\u7ed3\u6784\u4f53\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\uff0c\u5176\u4e2dParse0\u51fd\u6570\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>func Parse(rawurl string) (*URL, error)\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"net/url\"\n)\nfunc main() {\npath := \"http://localhost:8082/article?id=1\"\np, _ := url.Parse(path)\nfmt.Println(p.Host)\nfmt.Println(p.User)\nfmt.Println(p.RawQuery)\nfmt.Println(p.RequestURI())\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#3\u8bf7\u6c42\u5934","title":"3.\u8bf7\u6c42\u5934","text":"<p>\u8bf7\u6c42\u5934\u548c\u54cd\u5e94\u5934\u4f7f\u7528Header\u7c7b\u578b\u8868\u793a\u3002Header\u7c7b\u578b\u662f\u4e00\u4e2a\u6620\u5c04(map)\u7c7b\u578b\uff0c\u8868\u793aHTTP\u8bf7\u6c42\u5934\u4e2d\u7684\u591a\u4e2a\u952e\u503c\u5bf9\u3002\u5176\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>type Header map[string][]string\n</code></pre> <pre><code>func (h Header) Get(key string)                 //Get\u83b7\u53d6\u4e0e\u7ed9\u5b9a\u952e\u5173\u8054\u7684\u7b2c\u4e00\u4e2a\u503c\u3002\nfunc (h Header) Set(key, value string)      //Set\u5c06\u4e0e\u952e\u5173\u8054\u7684\u6807\u9898\u9879\u8bbe\u7f6e\u4e3a\u5355\u5143\u7d20\u503c\u3002\nfunc (h Header) Add(key, value string)      //Add\u5c06\u952e\u3001\u503c\u5bf9\u6dfb\u52a0\u5230\u6807\u5934\u3002\u5b83\u9644\u52a0\u5230\u4e0e\u952e\u5173\u8054\u7684\u4efb\u4f55\u73b0\u6709\u503c\u3002\nfunc (h Header) Del(key string)                 //Del\u5220\u9664\u4e0e\u952e\u5173\u8054\u7684\u503c\u3002\nfunc (h Header) Write(w io.Writer) error    //Write\u4ee5wire\u683c\u5f0f\u5199\u5165\u6807\u5934\u3002\n</code></pre> <p>\u4f8b\u5982\uff0c\u8981\u8fd4\u56de\u4e00\u4e2aJSON\u683c\u5f0f\u7684\u6570\u636e\uff0c\u5219\u9700\u8981\u4f7f\u7528Set()\u65b9\u6cd5\u8bbe\u7f6e\u201cContent-Type\u4e3a\"annlication/json\"\u7c7b\u578b\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n\"net/http\"\n)\ntype Greeting struct {\nMessage string `json:\"message\"`\n}\nfunc Hello(w http.ResponseWriter, r *http.Request) {\ngreeting := Greeting{\nMessage: \"\u4e00\u8d77\u5b66\u4e60\",\n}\nmessage, _ := json.Marshal(greeting)\nw.Header().Set(\"Content-Type\", \"application/json\")\nw.Write(message)\n}\nfunc main() {\nhttp.HandleFunc(\"/\", Hello)\nerr := http.ListenAndServe(\":8086\", nil)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#4\u8bf7\u6c42\u4f53","title":"4.\u8bf7\u6c42\u4f53","text":"<p>\u8bf7\u6c42\u4f53\u548c\u54cd\u5e94\u4f53\u90fd\u7531Request\u7ed3\u6784\u4e2d\u7684Body\u5b57\u6bb5\u8868\u793a\u3002Body\u5b57\u6bb5\u662f\u4e00\u4e2aio.ReadCloser\u63a5\u53e3\u3002ReadCloser\u63a5\u53e3\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>type ReadCloser interface {\nReader\nCloser\n}\n</code></pre> <p>Body\u5b57\u6bb5\u662fReader\u63a5\u53e3\u548cCloser\u63a5\u53e3\u7684\u7ed3\u5408\u3002Reader\u63a5\u53e3\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>type Reader interface {\nRead(p []byte) (n int, err error)\n}\n</code></pre> <p>\u901a\u8fc7Reader\u63a5\u53e3\u53ef\u4ee5\u770b\u5230\uff0cRead()\u65b9\u6cd5\u5b9e\u73b0\u4e86ReadCloser\u63a5\u53e3\u3002</p> <p>\u6240\u4ee5\uff0c\u53ef\u4ee5\u901a\u8fc7Body.Read()\u65b9\u6cd5\u6765\u8bfb\u53d6\u8bf7\u6c42\u4f53\u4fe1\u606f\u3002</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7\u793a\u4f8b\u6765\u52a0\u6df1\u5bf9Body.Read()\u65b9\u6cd5\u7684\u7406\u89e3\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\nfunc getBody(w http.ResponseWriter, r *http.Request) {\nlen := r.ContentLength\nbody := make([]byte, len)\nr.Body.Read(body)\nfmt.Fprintln(w, string(body))\n}\nfunc main() {\nhttp.HandleFunc(\"/getBody\", getBody)\nerr := http.ListenAndServe(\":8082\", nil)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#5\u5904\u7406html\u8868\u5355","title":"5.\u5904\u7406HTML\u8868\u5355","text":""},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#51-\u8868\u5355\u7684enctype\u5c5e\u6027","title":"5.1 \u8868\u5355\u7684enctype\u5c5e\u6027","text":"<p>HTML\u8868\u5355\u7684enctype\u5c5e\u6027\u51b3\u5b9a\u8868\u5355\u7684\u5185\u5bb9\u7c7b\u578b\uff08content type\uff09\u3002</p> <p>\uff081\uff09application/x-www-form-urlencoded\u8868\u5355\u7684\u9ed8\u8ba4\u7f16\u7801\uff0c\u8868\u5355\u4e2d\u7684\u6570\u636e\u7f16\u7801\u4e3a\u952e\u503c\u5bf9\uff0c\u4e14\u6240\u6709\u5b57\u7b26\u4f1a\u88ab\u7f16\u7801\uff08\u7a7a\u683c\u8f6c\u6362\u4e3a\"+\"\u53f7\uff0c\u7279\u6b8a\u7b26\u53f7\u8f6c\u6362\u4e3aASCII HEX\u503c\uff09\u3002</p> <ul> <li> <p>method\u65b9\u6cd5\u4e3aGET\u65f6\uff0c\u8868\u5355\u6570\u636e\u8f6c\u6362\u4e3a\"nam1=value1&amp;name2=value2&amp;\u2026\"\uff0c\u62fc\u63a5\u5230URL\u540e\u9762\uff0c\"?\"\u5206\u9694\u3002\u52a0\u5bc6\u91c7\u7528\u7684\u7f16\u7801\u5b57\u7b26\u96c6\u53d6\u51b3\u4e8e\u6d4f\u89c8\u5668\u3002</p> </li> <li> <p>method\u65b9\u6cd5\u4e3aPOST\u65f6\uff0c\u6570\u636e\u6dfb\u52a0\u5230HTTP Body\u4e2d\uff0c\u6d4f\u89c8\u5668\u6839\u636e\u7f51\u9875\u7684ContenrType(\"text/html; charset=UTF-8\")\u5bf9\u8868\u5355\u6570\u636e\u7f16\u7801\u3002</p> </li> </ul> <p>\uff082\uff09multipart/form-data \u4e0a\u4f20\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u4e0d\u5bf9\u5b57\u7b26\u7f16\u7801\uff0cPOST\u65b9\u5f0f\u3002\u5bf9\u8868\u5355\u4ee5\u63a7\u4ef6\u4e3a\u5355\u4f4d\u5206\u9694\uff0c\u6bcf\u90e8\u5206\u52a0\u4e0aContent-Disposition(form-data|file)\u3001Content-Type(\u9ed8\u8ba4text/plain)\u3001name(\u63a7\u4ef6name)\u7b49\u4fe1\u606f\uff0c\u5e76\u52a0\u4e0a\u5206\u9694\u7b26(\u8fb9\u754cboundary)\u3002</p> <p>\uff083\uff09text/plain \u5411\u670d\u52a1\u5668\u4f20\u9012\u5927\u91cf\u7eaf\u6587\u672c\u4fe1\u606f\uff0c\u7a7a\u683c\u8f6c\u6362\u4e3a\u52a0\u53f7\uff08+\uff09\uff0c\u4e0d\u5bf9\u7279\u6b8a\u5b57\u7b26\u7f16\u7801\u3002</p> <p>Form\u5b57\u6bb5\u652f\u6301URL\u7f16\u7801\uff0c\u952e\u503c\u6765\u6e90\u662fURL\u548c\u8868\u5355\u3002PostForm\u5b57\u6bb5\u652f\u6301URL\u7f16\u7801\uff0c\u952e\u503c\u6765\u6e90\u662f\u8868\u5355\uff0c\u53ea\u7528\u4e8e\u83b7\u53d6\u8868\u5355\u952e\u503c\u3002</p> <pre><code>func process(w http.ResponseWriter, r *http.Request) {\nr.ParseForm()\nfmt.Fprintln(w, \"\u8868\u5355\u952e\u503c\u5bf9\u548cURL\u952e\u503c\u5bf9\uff1a\", r.Form)\nfmt.Fprintln(w, \"\u8868\u5355\u952e\u503c\u5bf9\uff1a\", r.PostForm)\n}\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html\" charset=\"UTF-8\"&gt;\n&lt;title&gt;Form\u63d0\u4ea4&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;form action=\"http://127.0.0.1:8089?name=go&amp;color=green\" method=\"post\" enctype=\"application/x-www-form-urlencoded\"&gt;\n&lt;input type=\"text\" name=\"name\" value=\"shirdon\"/&gt;\n&lt;input type=\"text\" name=\"color\" value=\"green\"/&gt;\n&lt;input type=\"submit\"/&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#52-go\u8bed\u8a00\u7684multipartform\u5b57\u6bb5","title":"5.2 Go\u8bed\u8a00\u7684MultipartForm\u5b57\u6bb5","text":"<p>MultipartForm\u5b57\u6bb5\u652f\u6301multipart/form-data\u7f16\u7801\uff0c\u952e\u503c\u6765\u6e90\u662f\u8868\u5355\uff0c\u7528\u4e8e\u6587\u4ef6\u4e0a\u4f20\u3002</p> <pre><code>func dataProcess(w http.ResponseWriter, r *http.Request) {\nr.ParseMultipartForm(1024)\nfmt.Fprintln(w, \"\u8868\u5355\u952e\u503c\u5bf9\uff1a\", r.MultipartForm)\n}\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html\" charset=\"UTF-8\"&gt;\n&lt;title&gt;upload\u4e0a\u4f20\u6587\u4ef6&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;form action=\"http://localhost:8089/file\" method=\"post\" enctype=\"multipart/form-data\"&gt;\n&lt;input type=\"file\" name=\"uploaded\"/&gt;\n&lt;input type=\"submit\"/&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <pre><code>func upload(w http.ResponseWriter, r *http.Request) {\nif r.Method == \"GET\" {\nt, _ := template.ParseFiles(\"upload.html\")\nt.Execute(w, nil)\n} else {\nr.ParseMultipartForm(4096)\nfileHeader := r.MultipartForm.File[\"uploaded\"][0]\nfile, err := fileHeader.Open()\nif err != nil {\nfmt.Println(\"error\")\nreturn\n}\ndata, err := ioutil.ReadAll(file)\nif err != nil {\nfmt.Println(\"error\")\nreturn\n}\nfmt.Fprintln(w, string(data))\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#6\u4e86\u89e3responsewriter\u539f\u7406","title":"6.\u4e86\u89e3ResponseWriter\u539f\u7406","text":"<p>Go\u8bed\u8a00\u5bf9\u63a5\u53e3\u7684\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u663e\u793a\u7684\u58f0\u660e\uff0c\u53ea\u8981\u5b9e\u73b0\u4e86\u63a5\u53e3\u5b9a\u4e49\u7684\u65b9\u6cd5\uff0c\u90a3\u5c31\u5b9e\u73b0\u4e86\u76f8\u5e94\u7684\u63a5\u53e3\u3002</p> <p>io.Writer\u662f\u4e00\u4e2a\u63a5\u53e3\u7c7b\u578b\u3002\u5982\u679c\u8981\u4f7f\u7528io.Writer\u63a5\u53e3\u7684Write()\u65b9\u6cd5\uff0c\u5219\u9700\u8981\u5b9e\u73b0Write(p[byte)(n int, err error)\u65b9\u6cd5\u3002</p> <p>\u5728Go\u8bed\u8a00\u4e2d\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u4fe1\u606f\u90fd\u88ab\u5c01\u88c5\u5728Request\u5bf9\u8c61\u4e2d\u3002\u4f46\u662f\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u54cd\u5e94\u5e76\u4e0d\u662fResponse\u5bf9\u8c61\uff0c\u800c\u662fResponseWriter\u63a5\u53e3\u3002</p> <p>ResponseWriter\u63a5\u53e3\u662f\u5904\u7406\u5668\u7528\u6765\u521b\u5efaHTTP\u54cd\u5e94\u7684\u63a5\u53e3\u7684\u3002</p> <p>ResponseWriter\u63a5\u53e3\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>type ResponseWriter interface {\nHeader() Header               // \u7528\u4e8e\u8bbe\u7f6e\u6216\u8005\u83b7\u53d6\u54cd\u5e94\u5934\u4fe1\u606f\nWrite([]byte) (int, error)    // \u7528\u4e8e\u5199\u5165\u6570\u636e\u5230\u54cd\u5e94\u4f53\u4e2d\nWriteHeader(statusCode int)   // \u7528\u4e8e\u8bbe\u7f6e\u54cd\u5e94\u72b6\u6001\u7801\n}\n</code></pre> <p>\u5b9e\u9645\u4e0a\uff0c\u5728\u5e95\u5c42\u652f\u6491ResponseWriter\u63a5\u53e3\u7684\u662fhttp.response\u7ed3\u6784\u4f53\u3002</p> <p>\u5728\u8c03\u7528\u5904\u7406\u5668\u5904\u7406 HTTP\u8bf7\u6c42\u65f6\uff0c\u4f1a\u8c03\u7528readRequest()\u65b9\u6cd5\u3002 readRequest()\u65b9\u6cd5\u4f1a\u58f0\u660eresponse\u7ed3\u6784\u4f53\uff0c\u5e76\u4e14\u5176\u8fd4\u56de\u503c\u662fresponse\u6307\u9488\u3002</p> <p>\u8fd9\u4e5f\u662f\u5728\u5904\u7406\u5668\u65b9\u6cd5\u58f0\u660e\u65f6\uff0cRequest\u662f\u6307\u9488\u7c7b\u578b\uff0c\u800cResponseWriter\u4e0d\u662f\u6307\u9488\u7c7b\u578b\u7684\u539f\u56e0\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u54cd\u5e94\u5bf9\u8c61\u4e5f\u662f\u6307\u9488\u7c7b\u578b\u3002readRequest()\u65b9\u6cd5\u7684\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>func (c *conn) readRequest(ctx context.Context) (w *response, err error) {\n// \u6b64\u5904\u7701\u7565\u82e5\u5e72\u4ee3\u7801\nw = &amp;response{\nconn:   c,\ncancelCtx:  cancelCtx,\nreq:    req,\nreqBody:    req.Body,\nhandlerHeader:  make(Header),\ncontentLength:  -1,\ncloseNotifyCh:  make(chan bool, 1),\nwants10KeepAlive:   req.wantsHttp10KeepAlive(),\nwantsClose: req.wantsClose(),\n}\nif isH2Upgrade {\nw.closeAfterReply = true\n}\nw.cr.res = w\nw.w = newBufioWriterSize(&amp;w.cw, bufferBeforeChunkingSizw)\nreturn w, nil\n}\n</code></pre> <p>response\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u548cResponseWriter\u63a5\u53e3\u90fd\u4f4d\u4e8eserver.go\u6587\u4ef6\u4e2d\u3002</p> <p>\u4e0d\u8fc7\u7531\u4e8eresponse\u7ed3\u6784\u4f53\u662f\u79c1\u6709\u7684\uff0c\u5bf9\u5916\u4e0d\u53ef\u89c1\uff0c\u6240\u4ee5\u53ea\u80fd\u901a\u8fc7ResponseWriter\u63a5\u53e3\u8bbf\u95ee\u5b83\u3002</p> <p>\u4e24\u8005\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\uff1aResponseWriter\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u800cresponse\u7ed3\u6784\u4f53\u5b9e\u73b0\u4e86\u5b83\u3002</p> <p>\u6211\u4eec\u5f15\u7528ResponseWriter\u63a5\u53e3\uff0c\u5b9e\u9645\u4e0a\u5f15\u7528\u7684\u662fresponse\u7ed3\u6784\u4f53\u7684\u5b9e\u4f8b\u3002 </p> <p>ResponseWriter\u63a5\u53e3\u5305\u542bWriteHeader()\u3001Header()\u3001Write()\u4e09\u4e2a\u65b9\u6cd5\u6765\u8bbe\u7f6e\u54cd\u5e94\u72b6\u6001\u7801\u3002</p>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#61-writeheader\u65b9\u6cd5","title":"6.1 WriteHeader()\u65b9\u6cd5","text":"<p>VriteHeader()\u65b9\u6cd5\u652f\u6301\u4f20\u5165\u4e00\u4e2a\u6574\u578b\u6570\u636e\u6765\u8868\u793a\u54cd\u5e94\u72b6\u6001\u7801\u3002</p> <p>\u5982\u679c\u4e0d\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u5219\u9ed8\u8ba4\u54cd\u5e94\u72b6\u6001\u7801\u662f200\u3002WriteHeader()\u65b9\u6cd5\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5728API\u63a5\u53e3\u4e2d\u8fd4\u56de\u9519\u8bef\u7801\u3002</p> <p>\u4f8b\u5982\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u5904\u7406\u5668\u65b9\u6cd5noAuth(),\u5e76\u901a\u8fc7w.WriteHeader()\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a401\u672a\u8ba4\u8bc1\u72b6\u6001\u7801\uff08\u6ce8\u610f\uff0c\u5728\u8fd0\u884c\u65f6\uff0cw\u4ee3\u8868\u7684\u662f\u5bf9\u5e94\u7684response\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u800c\u4e0d\u662f\u63a5\u53e3)\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\nfunc noAuth(w http.ResponseWriter, r *http.Request) {\nw.WriteHeader(401)  //\u9ed8\u8ba4200\nfmt.Fprintln(w, \"\u672a\u6388\u6743\uff0c\u8ba4\u8bc1\u540e\u624d\u80fd\u8bbf\u95ee\u8be5\u63a5\u53e3\uff01\")\n}\nfunc main() {\nhttp.HandleFunc(\"/noAuth\", noAuth)\nerr := http.ListenAndServe(\":8086\", nil)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#62-header\u65b9\u6cd5","title":"6.2 Header()\u65b9\u6cd5","text":"<p>Header()\u65b9\u6cd5\u7528\u4e8e\u8bbe\u7f6e\u54cd\u5e94\u5934\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7w.Header().Set()\u65b9\u6cd5\u8bbe\u7f6e\u54cd\u5e94\u5934\u3002</p> <p>w.Header()\u65b9\u6cd5\u8fd4\u56de\u7684\u662fHeader\u54cd\u5e94\u5934\u5bf9\u8c61\uff0c\u5b83\u548c\u8bf7\u6c42\u5934\u5171\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\u3002</p> <p>\u56e0\u6b64\u5728\u8bf7\u6c42\u5934\u4e2d\u652f\u6301\u7684\u65b9\u6cd5\u8fd9\u91cc\u90fd\u652f\u6301\uff0c\u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7w.Header().Add()\u65b9\u6cd5\u65b0\u589e\u54cd\u5e94\u5934\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u8981\u8bbe\u7f6e\u4e00\u4e2a301\u91cd\u5b9a\u5411\u54cd\u5e94\uff0c\u5219\u53ea\u9700\u8981\u901a\u8fc7w.VriteHeader()\u65b9\u6cd5\u5c06\u54cd\u5e94\u72b6\u6001\u7801\u8bbe\u7f6e\u4e3a301\uff0c\u518d\u901a\u8fc7w.Header().Set()\u65b9\u6cd5\u5c06\u201cLocation\u201d\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u53ef\u8bbf\u95ee\u57df\u540d\u5373\u53ef\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\nfunc Redirect(w http.ResponseWriter, r *http.Request)  {\n// \u8bbe\u7f6e\u4e00\u4e2a 301 \u91cd\u5b9a\u5411\nw.Header().Set(\"Location\", \"https://www.shirdon.com\")\nw.WriteHeader(301)\n}\nfunc main() {\nhttp.HandleFunc(\"/redirect\", Redirect)\nerr := http.ListenAndServe(\":8086\", nil)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#63-write\u65b9\u6cd5","title":"6.3 Write()\u65b9\u6cd5","text":"<p>Write()\u65b9\u6cd5\u7528\u4e8e\u5c06\u6570\u636e\u5199\u5165HTTP\u54cd\u5e94\u4f53\u4e2d\u3002</p> <p>\u5982\u679c\u5728\u8c03\u7528Write()\u65b9\u6cd5\u65f6\u8fd8\u4e0d\u77e5\u9053 Content-Type\u7c7b\u578b\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u7684\u524d512\u4e2abyte\u8fdb\u884c\u5224\u65ad\u3002</p> <p>\u7528Write()\u65b9\u6cd5\u53ef\u4ee5\u8fd4\u56de\u5b57\u7b26\u4e32\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u8fd4\u56deHTML\u6587\u6863\u548cJSON\u7b49\u5e38\u89c1\u7684\u6587\u672c\u683c\u5f0f\u3002</p> <p>\u7531\u4e8eWite()\u65b9\u6cd5\u63a5\u53d7\u7684\u53c2\u6570\u7c7b\u578b\u662fbyte\u5207\u7247\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5b57\u8282\u5207\u7247\u7c7b\u578b\u3002\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#1-\u8fd4\u56de\u6587\u672c\u5b57\u7b26\u4e32\u6570\u636e","title":"1. \u8fd4\u56de\u6587\u672c\u5b57\u7b26\u4e32\u6570\u636e","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\nfunc Welcome(w http.ResponseWriter, r *http.Request)  {\nw.Write([]byte(\"\u4f60\u597d\uff5e\uff0c\u6b22\u8fce\u4e00\u8d77\u5b66\u4e60\u300aGo Web\u7f16\u7a0b\u5b9e\u6218\u6d3e\u4ece\u5165\u95e8\u5230\u7cbe\u901a\u300b\uff01\"))\n}\nfunc main() {\nhttp.HandleFunc(\"/welcome\", Welcome)\nerr := http.ListenAndServe(\":8086\", nil)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#2\u8fd4\u56dehtml\u6587\u6863","title":"2.\u8fd4\u56deHTML\u6587\u6863","text":"<p>\u54cd\u5e94\u5934\u4e2dContent-Type\u6839\u636e\u4f20\u5165\u6570\u636e\u81ea\u884c\u5224\u65ad</p> <pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\nfunc Home(w http.ResponseWriter, r *http.Request)  {\nhtml := `&lt;html&gt; \n        &lt;head&gt;\n            &lt;title&gt;Write\u65b9\u6cd5\u8fd4\u56deHTML\u6587\u6863&lt;/title&gt;\n        &lt;/head&gt; \n        &lt;body&gt;\n            &lt;h1&gt;\u4f60\u597d\uff0c\u6b22\u8fce\u4e00\u8d77\u5b66\u4e60\u300aGo Web\u7f16\u7a0b\u5b9e\u6218\u6d3e\u4ece\u5165\u95e8\u5230\u7cbe\u901a\u300b\n        &lt;/body&gt; \n    &lt;/html&gt;`\nw.Write([]byte(html))\n}\nfunc main() {\nhttp.HandleFunc(\"/\", Home)\nerr := http.ListenAndServe(\":8086\", nil)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/10.%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#3\u8fd4\u56dejson\u6570\u636e","title":"3.\u8fd4\u56deJSON\u6570\u636e","text":"<pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n\"net/http\"\n)\ntype Greeting struct {\nMessage string `json:\"message\"`\n}\nfunc Hello(w http.ResponseWriter, r *http.Request)  {\n// \u8fd4\u56de JSON \u683c\u5f0f\u6570\u636e\ngreeting := Greeting{\n\"\u6b22\u8fce\u4e00\u8d77\u5b66\u4e60\u300aGo Web\u7f16\u7a0b\u5b9e\u6218\u6d3e\u4ece\u5165\u95e8\u5230\u7cbe\u901a\u300b\",\n}\nmessage, _ := json.Marshal(greeting)\nw.Header().Set(\"Content-Type\", \"application/json\")\nw.Write(message)\n}\nfunc main() {\nhttp.HandleFunc(\"/\", Hello)\nerr := http.ListenAndServe(\":8086\", nil)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/","title":"session\u548ccookie","text":""},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#1session\u548ccookie\u7b80\u4ecb","title":"1.session\u548ccookie\u7b80\u4ecb","text":""},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#11-session\u548ccookie","title":"1.1 session\u548ccookie","text":"<p>session\u548ccookie\u7528\u4e8e\u5f25\u8865HTTP\u7684\u65e0\u72b6\u6001\u7279\u6027\uff08\u6bcf\u6b21\u8bf7\u6c42\u65e0\u8bb0\u5f55\uff09\u3002</p> <p>\uff081\uff09session\u662f\u4ec0\u4e48</p> <p>\u670d\u52a1\u5668\u7aef\u4e3a\u5ba2\u6237\u7aef\u8bf7\u6c42\u5f00\u8f9f\u7684\u5185\u5b58\u7a7a\u95f4\u662fsession\u5bf9\u8c61\uff0c\u5b58\u50a8\u7ed3\u6784\u4e3aConcurrentHashMap\uff0c\u53ef\u4ee5\u5b58\u50a8\u4f1a\u8bdd\u64cd\u4f5c\u8bb0\u5f55\u3002</p> <p>\uff082\uff09session\u5224\u65ad\u540c\u4e00\u4f1a\u8bdd</p> <p>\u670d\u52a1\u5668\u7aef\u7b2c\u4e00\u6b21\u6536\u5230\u8bf7\u6c42\uff0c\u5f00\u8f9fsession\u7a7a\u95f4\uff08\u521b\u5efasession\u5bf9\u8c61\uff09\uff0c\u540c\u65f6\u751f\u6210sessionId\uff0c\u901a\u8fc7\"Set-Cookie: JSESSIONID=XXXXXX\"\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u5ba2\u6237\u7aef\u6536\u5230\u54cd\u5e94\u540e\uff0c\u8bbe\u7f6eJSESSIONID=XXXXXX\u7684cookie\u4fe1\u606f\uff0ccookie\u8fc7\u671f\u65f6\u95f4\u4e3a\u6d4f\u89c8\u5668\u4f1a\u8bdd\u7ed3\u675f\u3002</p> <p>\u4ee5\u540e\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6dfb\u52a0cookie\u4fe1\u606f\uff08\u542bsessionId\uff09\uff0c\u670d\u52a1\u5668\u7aef\u8bfb\u53d6\u8bf7\u6c42\u5934\u4e2dcookie\u4fe1\u606f\uff0c\u83b7\u5f97JSESSIONID\uff0csessionId\u3002</p> <p>\uff083\uff09session\u7f3a\u70b9</p> <p>\u82e5\u670d\u52a1\u5668A\u5b58\u50a8session\uff08\u8d1f\u8f7d\u5747\u8861\uff09\uff0c\u8bbf\u95ee\u8f6c\u53d1\u5230\u670d\u52a1\u5668B\uff0csession\u5931\u6548\u3002</p> <p>\uff084\uff09cookie\u662f\u4ec0\u4e48</p> <p>\u670d\u52a1\u5668\u7aef\u53d1\u9001\u5230\u5ba2\u6237\u7aefWeb\u6d4f\u89c8\u5668\u7684\u4e00\u5c0f\u5757\u6570\u636e\uff0c\u542bWeb cookie\u548c\u6d4f\u89c8\u5668cookie\u3002</p> <p>\u7528\u9014\uff1a</p> <p>\u4f1a\u8bdd\u7ba1\u7406\uff1a\u767b\u5f55\u3001\u8d2d\u7269\u8f66\u3001\u6e38\u620f\u5f97\u5206\u7b49\u4e2a\u6027\u5316\uff1a\u7528\u6237\u504f\u597d\u3001\u4e3b\u9898\u7b49\u8bbe\u7f6e\u3002</p> <p>\u8ffd\u8e2a\uff1a\u8bb0\u5f55\u548c\u5206\u6790\u7528\u6237\u884c\u4e3a</p> <p>cookie\u7528\u4f5c\u4e00\u822c\u5ba2\u6237\u7aef\u5b58\u50a8\uff0c\u968f\u6bcf\u4e2a\u8bf7\u6c42\u53d1\u9001\uff0c\u964d\u4f4e\u6027\u80fd\u3002</p> <p>\uff085\uff09session\u548ccookie\u533a\u522b</p> <p>\u5ba2\u6237\u7aef\u53ef\u4ee5\u9009\u62e9\u7981\u7528cookie\uff0c\u65e0\u6cd5\u7981\u7528\u670d\u52a1\u5668\u7aef\u7684session\u3002</p> <p>session\u80fd\u591f\u5b58\u50a8\u4efb\u610f\u7c7b\u578b\u7684\u5bf9\u8c61\uff0ccookie\u53ea\u80fd\u5b58\u50a8String\u7c7b\u578b\u5bf9\u8c61\u3002</p>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#12-\u521b\u5efacookie","title":"1.2 \u521b\u5efacookie","text":"<p>\uff081\uff09Set-Cookie</p> <p>Set-Cookie\u5c06cookie\u4ece\u670d\u52a1\u5668\u7aef\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u3002</p> <p>\uff082\uff09\u4f1a\u8bddcookie</p> <p>\u5ba2\u6237\u7aef\u5173\u95ed\u65f6cookie\u4f1a\u88ab\u5220\u9664\uff0c\u4f46Web\u6d4f\u89c8\u5668\u53ef\u80fd\u4f1a\u4f7f\u7528\u4f1a\u8bdd\u8fd8\u539f\u3002</p> <p>\uff083\uff09\u6c38\u4e45\u6027cookie</p> <p>\u4e0d\u4f1a\u5728\u5ba2\u6237\u7aef\u5173\u95ed\u65f6\u8fc7\u671f\uff0c\u800c\u662f\u5230\u8fbe\u6307\u5b9a\u65e5\u671f\uff08Expires\uff09\u6216\u7279\u5b9a\u65f6\u95f4\u957f\u5ea6 \uff08Max-Ae\uff09\u540e\u8fc7\u671f\u3002</p> <p>\uff084\uff09\u5b89\u5168cookie</p> <p>HTPPS\u534f\u8bae\u901a\u8fc7\u52a0\u5bc6\u53d1\u9001\u5230\u670d\u52a1\u5668\u3002</p>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#13-cookie\u7684\u4f5c\u7528\u57df","title":"1.3 cookie\u7684\u4f5c\u7528\u57df","text":"<p>Domain\u548cPath\u6807\u8bc6\u5b9a\u4e49cookie\u5e94\u88ab\u53d1\u7ed9\u54ea\u4e9bURL\u3002Domain\u6307\u5b9a\u4e3b\u673a\uff0c\u4e00\u822c\u5305\u542b\u5b50\u57df\u540d\uff08Domain=baidu.com\uff0c\u5305\u542bnews.baidu.com\uff09\uff0c\u9ed8\u8ba4\u5f53\u524d\u4e3b\u673a\uff08\u4e0d\u542b\u5b50\u57df\u540d\uff09\uff1bPath=/test,\u5339\u914d/test, /test/news/, /test/news/id\u3002</p>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#2cookie","title":"2.cookie","text":"<pre><code>type Cookie struct {\nName string\nValue string\nPath string\nDomain string\nExpires time.Time\nRawExpires string\nMaxAge int\nsecure bool\nHttpOnly bool\nRaw string\nUnparsed []string\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#21-\u8bbe\u7f6ecookie","title":"2.1 \u8bbe\u7f6ecookie","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\nfunc testHandle(w http.ResponseWriter, r *http.Request) {\nc, err := r.Cookie(\"test_cookie\")\nfmt.Printf(\"cookie:%#v, err:%v\\n\", c, err)\ncookie := &amp;http.Cookie{\nName:   \"test_cookie\",\nValue:  \"krrsklHhefUUUFSSKLAkaLlJGGQEXZLJP\",\nMaxAge: 3600,\nDomain: \"localhost\",\nPath:   \"/\",\n}\nhttp.SetCookie(w, cookie)\n//\u5728\u5177\u4f53\u6570\u636e\u8fd4\u56de\u4e4b\u524d\u8bbe\u7f6ecookie\uff0c\u5426\u5219cookie\u79cd\u4e0d\u4e0a\nw.Write([]byte(\"hello\"))\n}\nfunc main() {\nhttp.HandleFunc(\"/\", testHandle)\nhttp.ListenAndServe(\":8085\", nil)\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#22-\u83b7\u53d6cookie","title":"2.2 \u83b7\u53d6cookie","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"net/http\"\n\"net/url\"\n\"strings\"\n)\nfunc main() {\nCopeHandle(\"GET\", \"https://www.baidu.com\", \"\")\n}\n//http\u8bf7\u6c42\u5904\u7406\nfunc CopeHandle(method, urlVal, data string) {\nclient := &amp;http.Client{}\nvar req *http.Request\nif data == \"\" {\nurlArr := strings.Split(urlVal, \"?\")\nif len(urlArr) == 2 {\nurlVal = urlArr[0] + \"?\" + getParseParam(urlArr[1])\n}\nreq, _ = http.NewRequest(method, urlVal, nil)\n} else {\nreq, _ = http.NewRequest(method, urlVal, strings.NewReader(data))\n}\ncookie := &amp;http.Cookie{Name: \"X-Xsrftoken\", Value: \"abccadf41ba5fasfasjijalkjaqezgbea3ga\", HttpOnly: true}\nreq.AddCookie(cookie)\n//\u6dfb\u52a0header\nreq.Header.Add(\"X-Xsrftoken\", \"aaab6d695bbdcd111e8b681002324e63af81\")\nresp, err := client.Do(req)\nif err != nil {\nfmt.Println(err)\n}\ndefer resp.Body.Close()\nb, _ := ioutil.ReadAll(resp.Body)\nfmt.Println(string(b))\n}\n//\u5c06get\u8bf7\u6c42\u7684\u53c2\u6570\u8fdb\u884c\u8f6c\u4e49\nfunc getParseParam(param string) string {\nreturn url.PathEscape(param)\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#3session","title":"3.session","text":""},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#31-\u5b9a\u4e49session\u63a5\u53e3","title":"3.1 \u5b9a\u4e49Session\u63a5\u53e3","text":"<pre><code>type Session interface {\nSet(key, value interface{}) error\nGet(key interface{}) interface{}\nDelete(key interface{}) error\nSeeeionID() string\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#32-\u521b\u5efasessiong\u7ba1\u7406\u5668","title":"3.2 \u521b\u5efaSessiong\u7ba1\u7406\u5668","text":"<pre><code>type Provider interface {\nSessionInit(sessionId string) (Session, error)\nSessionRead(sessionId string) (Session, error)\nSessionDestroy(sessionId string) error\nGarbageCollector(maxLifeTime int64)\n}\n</code></pre> <pre><code>var providers = make(map[string]Provider)\nfunc RegisterProvider(name string, provider Provider) {\nif provider == nil {\npanic(\"session: Register provider is nil\")\n}\nif _, p := providers[name]; p {\npanic(\"session: Register provider is existed\")\n}\nprovider[name] = provider\n}\n</code></pre> <pre><code>type SessionManager struct {\ncookieName string\nlock sync.Mutex\nprovider Provider\nmaxLifeTime int64\n}\nfunc NewSessionMaanger(providerName, cookieName string, maxLifetime int64) (*SessionManager, error) {\nprovider, ok := providers[providerName]\nif !ok {\nreturn nil, fmt.Errorf(\"session: unknown provide %q (forgotten import?)\", providerName)\n}\nreturn &amp;SessionManager{\ncookieName: cookieName,\nmaxLifeTime: maxLifetime,\nprovider: provider,\n}, nil\n}\n</code></pre> <pre><code>var globalSession *SessionManager\nfunc init() {\nglovalSession, _ = NewSessionManager(\"memory\", \"sessionId\", 3600)\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#33-\u521b\u5efa\u5168\u5c40\u552f\u4e00sessionid","title":"3.3 \u521b\u5efa\u5168\u5c40\u552f\u4e00sessionId","text":"<pre><code>func (manager *SessionManager) GetSessionId() string {\nb := make([]byte, 32)\nif _, err := io.ReadFull(rand.Reader, b); err != nil {\nreturn \"\"\n}\nreturn base64.URLEncoding.EncodeToString(b)\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#34-\u6765\u8bbf\u7528\u6237\u83b7\u53d6\u6216\u5206\u914dsession","title":"3.4 \u6765\u8bbf\u7528\u6237\u83b7\u53d6\u6216\u5206\u914dsession","text":"<pre><code>func (manager *SessionManager) SessionBegin(w http.ResponseWriter, r *http.Request) (session Session) {\nmanager.lock.Lock()\ndefer manager.lock.Unlock()\ncookie, err := r.Cookie(manager.cookieName)\nif err != nil || cookie.Value == \"\" {\nsessionId := manager.GetSessionId()\nsession, _ = manager.provider.SessionInit(sessionId)\ncookie := http.Cookie {\nName: manager.cookieName,\nValue: url.QueryEscape(sessionId),\nPath: \"/\"\nHttpOnly: true,\nMaxAge: int(manager.maxLifeTime),\n}\nhttp.SetCookie(w, &amp;cookie)\n} else {\nsessionId, _ := url.QueryUnescape(cookie.Value)\nsession, _ = manager.provider.SessionRead(sessionId)\n}\nreturn session\n}\n</code></pre> <pre><code>func login(w http.ResponseWriter, r *http.Request) {\nsession := globalSession.SessionBegin(w, r)\nr.ParseForm()\nname := session.Get(\"username\")\nif name != nil {\nsession.Set(\"username\", r.Form[\"username\"])\n}\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#35-\u6ce8\u9500session","title":"3.5 \u6ce8\u9500session","text":"<pre><code>func (manager *SessionManagre) SessionDestroy(w http.ResponseWriter, r *http.Request) {\ncookie, err := r.Cookie(manager.cookieName)\nif err != nil || cookie.Value == \"\" {\nreturn\n}\nmanager.lock.Lock()\ndefer manager.lock.Unlock()\nmanager.provider.SessionDestroy(cookie.Value)\nexporedTime := time.Now()\nnewCookie := http.Cookie{\nName: manager.cookieName,\nPath: \"/\",\nHttpOnly: true,\nExpires: expiredTime,\nMaxAge: -1,\n}\nhttp.SetCookie(w, &amp;newCookie)\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/11.session%E5%92%8Ccookie/#36-\u5220\u9664session","title":"3.6 \u5220\u9664session","text":"<pre><code>func init() {\ngo globalSession.GarbageCollector()\n}\nfunc (manager *SessionManager) GarbageCollector() {\nmanager.lock.Lock()\ndefer manager.lock.Unlock()\nmanager.provider.GargageCollector(manager.maxLifeTime)\ntime.AfterFunc(time.Duration(manager.maxLifeTime), func() {\nmanager.GarbageCollector()\n})\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/","title":"\u7b80\u5355Web\u670d\u52a1\u5668","text":"<pre><code>// Author:\u5ed6\u663e\u4e1c\uff08ShirDon\uff09\n// Blog:https://www.shirdon.com/\n// \u4ed3\u5e93\u5730\u5740\uff1ahttps://gitee.com/shirdonl/goWebActualCombat\n// \u4ed3\u5e93\u5730\u5740\uff1ahttps://github.com/shirdonl/goWebActualCombat\npackage main\nimport (\n\"fmt\"\n\"log\"\n\"net/http\"\n)\nfunc helloWorld(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"Hello Go Web!\")\n}\nfunc main() {\nhttp.HandleFunc(\"/hello\", helloWorld)\nif err := http.ListenAndServe(\":8081\", nil); err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre> <p>\u8bbf\u95ee\uff1ahttp://127.0.0.1:8081/hello</p> <p>Go Web\u670d\u52a1\u5668\u8bf7\u6c42\u548c\u54cd\u5e94\u6d41\u7a0b\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\uff1b</li> <li>\u670d\u52a1\u5668\u7aef\u7684\u591a\u8def\u590d\u7528\u5668\u6536\u5230\u8bf7\u6c42\uff1b</li> <li>\u591a\u8def\u590d\u7528\u5668\u6839\u636e\u8bf7\u6c42\u7684URL\u627e\u5230\u6ce8\u518c\u7684\u5904\u7406\u5668\uff0c\u8f6c\u4ea4\u8bf7\u6c42\u7ed9\u5904\u7406\u5668\uff1b</li> <li>\u5904\u7406\u5668\u6267\u884c\u7a0b\u5e8f\u903b\u8f91\uff0c\u5982\u5fc5\u8981\uff0c\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92\uff0c\u5f97\u5230\u5904\u7406\u7ed3\u679c\uff1b</li> <li>\u5904\u7406\u5668\u8c03\u7528\u6a21\u677f\u5f15\u64ce\u5c06\u6307\u5b9a\u6a21\u677f\u548c\u4e0a\u4e00\u6b65\u7ed3\u679c\u6e32\u67d3\u6210\u5ba2\u6237\u7aef\u53ef\u8bc6\u522b\u7684\u6570\u636e\u683c\u5f0f\uff08\u901a\u5e38HTML\uff09\uff1b</li> <li>\u670d\u52a1\u5668\u5c06\u6570\u636e\u901a\u8fc7HTTP\u54cd\u5e94\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff1b</li> <li>\u5ba2\u6237\u7aef\u62ff\u5230\u6570\u636e\uff0c\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\uff08\u4f8b\u5982\u6e32\u67d3\u51fa\u6765\u5448\u73b0\u7ed9\u7528\u6237\uff09\u3002</li> </ol>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#1\u63a5\u6536\u8bf7\u6c42","title":"1.\u63a5\u6536\u8bf7\u6c42","text":""},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#11-servemux\u548cdefaultservemux","title":"1.1 ServeMux\u548cDefaultServeMux","text":""},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#1servemux\u548cdefaultservemux\u7b80\u4ecb","title":"1.ServeMux\u548cDefaultServeMux\u7b80\u4ecb","text":"<p>\u591a\u8def\u590d\u7528\u5668\u7528\u4e8e\u8f6c\u53d1\u8bf7\u6c42\u5230\u5904\u7406\u5668\u3002</p> <p>\u7ed3\u6784\u4f53ServeMux\u4e2d\uff0c\u5305\u542bURL\u5230\u76f8\u5e94\u5904\u7406\u5668\u7684\u6620\u5c04\u3002\u5b83\u4f1a\u6839\u636e\u8bf7\u6c42URL\u627e\u51fa\u6700\u5339\u914d\u7684URL\uff0c\u7136\u540e\u8c03\u7528\u5bf9\u5e94\u5904\u7406\u5668\u7684ServeHTTP()\u65b9\u6cd5\u6765\u5904\u7406\u8bf7\u6c42\u3002</p> <p>DefaultServeMux\u662fServeMux\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u9ed8\u8ba4\u7684\u591a\u8def\u590d\u7528\u5668\u3002</p> <pre><code>var DefaultServeMux = &amp;defaultServeMux\nvar defaultServeMux ServeMux\n</code></pre> <pre><code>//\u4e3a\u6307\u5b9aURL\u6ce8\u518c\u5904\u7406\u5668\nfunc HandleFunc(pattern string, handler func(ResponseWrite, *Request)) {\nDefaultServeMux.HandleFunc(pattern, handler)\n}\n</code></pre> <pre><code>func Handle(pattern string, handler Handler) {\nDefaultServeMux.Handle(pattern, handler)\n}\n</code></pre> <pre><code>func (sh serverHandler) ServeHTTP(rw ResponseWriter, req *Request) {\nhandler := sh.srv.Handler\nif handler == nil {\nhandler = DefaultServeMux\n}\nhandler.ServeHTTP(rw, req)\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\n//\u5b9a\u4e49\u591a\u4e2a\u5904\u7406\u5668\ntype handle1 struct{}\nfunc (h1 *handle1) ServeHTTP(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"hi,handle1\")\n}\ntype handle2 struct{}\nfunc (h2 *handle2) ServeHTTP(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"hi,handle2\")\n}\nfunc main() {\nhandle1 := handle1{}\nhandle2 := handle2{}\n//nil\u8868\u660e\u670d\u52a1\u5668\u4f7f\u7528\u9ed8\u8ba4\u7684\u591a\u8def\u590d\u7528\u5668DefaultServeMux\nserver := http.Server{\nAddr:    \"0.0.0.0:8085\",\nHandler: nil,\n}\n//handle\u51fd\u6570\u8c03\u7528\u7684\u662f\u591a\u8def\u590d\u7528\u5668DefaultServeMux.Handle\u65b9\u6cd5\nhttp.Handle(\"/handle1\", &amp;handle1)\nhttp.Handle(\"/handle2\", &amp;handle2)\nserver.ListenAndServe()\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"net/http\"\n\"time\"\n)\nfunc hi(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"hi, web\")\n}\nfunc main() {\nmux := http.NewServeMux()\nmux.HandleFunc(\"/\", hi)\nserver := &amp;http.Server{\nAddr:         \"0.0.0.0:8081\",\nHandler:      mux,\nReadTimeout:  5 * time.Second,\nWriteTimeout: 5 * time.Second,\n}\nif err := server.ListenAndServe(); err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre> <p>\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0cServerMux\u5b9e\u73b0\u4e86http.Handler\u63a5\u53e3\u7684ServeHTTP(ResponseWriter,*Request)\u65b9\u6cd5\u3002</p> <p>\u5728\u521b\u5efaServer\u65f6\uff0c\u5982\u679c\u8bbe\u7f6eHandler\u4e3a\u7a7a\uff0c\u5219\u4f7f\u7528DefaultServeMux\u4f5c\u4e3a\u9ed8\u8ba4\u7684\u5904\u7406\u5668\uff0c\u800cDefaultServeMux\u662fServerMux\u7684\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u3002</p>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#2servemux\u7684url\u8def\u7531\u5339\u914d","title":"2.ServeMux\u7684URL\u8def\u7531\u5339\u914d","text":"<p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u4e00\u4e2aWb\u670d\u52a1\u5668\u5f80\u5f80\u6709\u5f88\u591a\u7684URL\u7ed1\u5b9a\uff0c\u4e0d\u540c\u7684URL\u5bf9\u5e94\u4e0d\u540c\u7684\u5904\u7406\u5668\u3002</p> <p>\u670d\u52a1\u5668\u662f\u5982\u4f55\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e2a\u5904\u7406\u5668\u7684\u5462\uff1f</p> <p>\u5047\u5982\u6211\u4eec\u73b0\u5728\u7ed1\u5b9a\u4e863\u4e2aURL,\u5206\u522b\u662f/\u3001/hi\u548c/hi/web\u3002\u663e\u7136\uff1a</p> <ul> <li>\u5982\u679c\u8bf7\u6c42\u7684URL\u4e3a/\uff0c\u5219\u8c03\u7528/\u5bf9\u5e94\u7684\u5904\u7406\u5668\u3002</li> <li>\u5982\u679c\u8bf7\u6c42\u7684URL\u4e3a/hi,\u5219\u8c03\u7528/hi\u5bf9\u5e94\u7684\u5904\u7406\u5668\u3002</li> <li>\u5982\u679c\u8bf7\u6c42\u7684URL\u4e3a/hi/web,\u5219\u8c03\u7528/hi/web\u5bf9\u5e94\u7684\u5904\u7406\u5668\u3002</li> </ul> <p>\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u793a\u4f8b\u4ee3\u7801\u52a0\u6df1\u5bf9ServeMux\u7684URL\u8def\u7531\u5339\u914d\u7684\u7406\u89e3\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"net/http\"\n)\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"\u6b22\u8fce\u6765\u5230Go Web\u9996\u9875!\u5904\u7406\u5668\u4e3a:indexHandler!\")\n}\nfunc hiHandler(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"\u6b22\u8fce\u6765\u5230Go Web\u9996\u9875!\u5904\u7406\u5668\u4e3a:hiHandler!\")\n}\nfunc webHandler(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"\u6b22\u8fce\u6765\u5230Go Web\u9996\u9875!\u5904\u7406\u5668\u4e3a:webHandler!\")\n}\nfunc main() {\nmux := http.NewServeMux()\nmux.HandleFunc(\"/\", indexHandler)     // \"/\", \"/hi/\"\nmux.HandleFunc(\"/hi\", hiHandler)      // \"/hi\"\nmux.HandleFunc(\"/hi/web\", webHandler) // \"/hi/web\"\nserver := &amp;http.Server{\nAddr:    \":8083\",\nHandler: mux,\n}\nif err := server.ListenAndServe(); err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre> <ul> <li>\u8bbf\u95ee: http://127.0.0.1:8083/\u3001http://127.0.0.1:8083/hi/</li> <li>\u8bbf\u95ee: http://127.0.0.1:8083/hi</li> <li>\u8bbf\u95ee: http://127.0.0.1:8083/hi/web</li> </ul> <p>\u5904\u7406\u5668\u548c\u5904\u7406\u5668\u51fd\u6570\u90fd\u53ef\u4ee5\u8fdb\u884cURL\u8def\u7531\u5339\u914d\u3002</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5904\u7406\u5668\u548c\u5904\u7406\u5668\u51fd\u6570\u4e2d\u7684\u4e00\u79cd\u6216\u540c\u65f6\u4f7f\u7528\u4e24\u8005\u3002\u540c\u65f6\u4f7f\u7528\u4e24\u8005\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"net/http\"\n)\nfunc hiHandler(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"Hi, Go HandleFunc\")\n}\ntype welcomeHandler struct {\nName string\n}\nfunc (h welcomeHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"hi, %s\", h.Name)\n}\nfunc main() {\nmux := http.NewServeMux()\n// \u6ce8\u518c\u5904\u7406\u5668\u51fd\u6570\nmux.HandleFunc(\"/hi\", hiHandler)\n// \u6ce8\u518c\u5904\u7406\u5668\nmux.Handle(\"/welcome/goweb\", welcomeHandler{Name: \"Hi, Go Handle\"})\nserver := &amp;http.Server {\nAddr:       \":8085\",\nHandler:    mux,\n}\nif err := server.ListenAndServe(); err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre> <ul> <li>\u8bbf\u95ee\uff1ahttp://127.0.0.1:8085/hi</li> <li>\u8bbf\u95ee\uff1ahttp://127.0.0.1:8085/welcome/goweb</li> </ul>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#3httprouter\u7b80\u4ecb","title":"3.HttpRouter\u7b80\u4ecb","text":"<p>ServeMux\u7684\u4e00\u4e2a\u7f3a\u9677\u662f\uff1a\u65e0\u6cd5\u4f7f\u7528\u53d8\u91cf\u5b9e\u73b0URL\u6a21\u5f0f\u5339\u914d\u3002\u800cHttpRouter\u5219\u53ef\u4ee5\u3002</p> <p>HttpRouter\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u3001\u53ef\u6269\u5c55\u7684\u7b2c\u4e09\u65b9HTTP\u8def\u7531\u5305\u3002</p> <p>HttpRouter\u5305\u5f25\u8865\u4e86net/http\u5305\u4e2d\u9ed8\u8ba4\u8def\u7531\u4e0d\u8db3\u7684\u95ee\u9898\u3002</p> <p>\u4e0b\u9762\u7528\u4e00\u4e2a\u4f8b\u5b50\u8ba4\u8bc6\u4e00\u4e0bHttpRouter\u8fd9\u4e2a\u5f3a\u5927\u7684HTTP\u8def\u7531\u5305\u3002</p> <p>(1)\u6253\u5f00\u547d\u4ee4\u884c\u7ec8\u7aef\uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u5b8c\u6210HttpRouter\u5b89\u88c5\uff1a</p> <pre><code>go get -u github.com/julienschmidt/httprouter\n</code></pre> <p>(2)HttpRouter\u7684\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <p>\u9996\u5148\u4f7f\u7528httprouter.New0\u51fd\u6570\u751f\u6210\u4e86\u4e00\u4e2a*Router\u8def\u7531\u5bf9\u8c61\uff0c\u7136\u540e\u4f7f\u7528GET0\u65b9\u6cd5\u6ce8\u518c\u4e00\u4e2a\u9002\u914d/\u8def\u5f84\u7684Index\u51fd\u6570\uff0c\u6700\u540e\u5c06*Router\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u4f20 \u7ed9ListenAndServe()\u51fd\u6570\u5373\u53ef\u542f\u52a8HTTP\u670d\u52a1\u3002</p> <p>HttpRouter\u5305\u7684\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"log\"\n\"net/http\"\n\"github.com/julienschmidt/httprouter\"\n)\nfunc Index(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\nw.Write([]byte(\"Index\"))\n}\nfunc main() {\nrouter := httprouter.New()\nrouter.GET(\"/\", Index)\nlog.Fatal(http.ListenAndServe(\":8082\", router))\n}\n</code></pre> <p>\u5728HttpRouter\u5305\u4e2d\u5bf9URL\u4f7f\u7528\u4e24\u79cd\u5339\u914d\u6a21\u5f0f\uff1a</p> <ol> <li>\u5f62\u5982user:name\u7684\u7cbe\u786e\u5339\u914d\uff1b</li> <li>\u5f62\u5982/employee/*name\u7684\u5339\u914d\u6240\u6709\u6a21\u5f0f;</li> </ol> <pre><code>package main\nimport (\n\"net/http\"\n\"github.com/julienschmidt/httprouter\"\n)\nfunc main() {\nrouter := httprouter.New()\nrouter.GET(\"/MainData\", func(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\nw.Write([]byte(\"default get\"))\n})\nrouter.POST(\"/MainData\", func(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\nw.Write([]byte(\"default post\"))\n})\n//\u7cbe\u786e\u5339\u914d\nrouter.GET(\"/user/name\", func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\nw.Write([]byte(\"user name:\" + p.ByName(\"name\")))\n})\n//\u5339\u914d\u6240\u6709\nrouter.GET(\"/employee/*name\", func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\nw.Write([]byte(\"employee name:\" + p.ByName(\"name\")))\n})\nhttp.ListenAndServe(\":8081\", router)\n}\n</code></pre> <p>Handler\u5305\u53ef\u4ee5\u5904\u7406\u4e0d\u540c\u7684\u4e8c\u7ea7\u57df\u540d\u3002</p> <p>\u5b83\u5148\u6839\u636e\u57df\u540d\u83b7\u53d6\u5bf9\u5e94\u7684Handler\u8def\u7531\uff0c\u7136\u540e\u8c03\u7528\u5904\u7406(\u5206\u53d1\u673a\u5236)\u3002\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"log\"\n\"net/http\"\n\"github.com/julienschmidt/httprouter\"\n)\ntype HostMap map[string]http.Handler\nfunc (hs HostMap) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n//\u6839\u636e\u57df\u540d\u83b7\u53d6\u5bf9\u5e94\u7684Handler\u8def\u7531\uff0c\u7136\u540e\u8c03\u7528\u5904\u7406\uff08\u5206\u53d1\u673a\u5236\uff09\nif handler := hs[r.Host]; handler != nil {\nhandler.ServeHTTP(w, r)\n} else {\nhttp.Error(w, \"Forbidden\", 403)\n}\n}\nfunc main() {\nuserRouter := httprouter.New()\nuserRouter.GET(\"/\", func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\nw.Write([]byte(\"sub1\"))\n})\ndataRouter := httprouter.New()\ndataRouter.GET(\"/\", func(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\nw.Write([]byte(\"sub2\"))\n})\n//\u5206\u522b\u7528\u4e8e\u5904\u7406\u4e0d\u540c\u7684\u4e8c\u7ea7\u57df\u540d\nhs := make(HostMap)\nhs[\"sub1.localhost:8888\"] = userRouter\nhs[\"sub2.localhost:8888\"] = dataRouter\nlog.Fatal(http.ListenAndServe(\":8888\", hs))\n}\n</code></pre> <p>\u4fee\u6539host </p> <pre><code>127.0.0.1 sub1.localhost\n127.0.0.1 sub2.localhost\n</code></pre> <p>\u5206\u522b\u8bbf\u95ee\uff1a</p> <ul> <li>http://sub1.localhost:8888</li> <li>http://sub2.localhost:8888</li> </ul> <p>httprouter\u63d0\u4f9b\u4e86\u5f88\u65b9\u4fbf\u7684\u9759\u6001\u6587\u4ef6\u670d\u52a1\uff0c\u53ef\u4ee5\u628a\u4e00\u4e2a\u76ee\u5f55\u6258\u7ba1\u5728\u670d\u52a1\u5668\u4e0a\u4ee5\u4f9b\u8bbf\u95ee\u3002</p> <pre><code>router.ServeFiles(\"/static/*filepath\",http.Dir(\"./\"))\n</code></pre> <p>\u5728\u4f7f\u7528ServeFiles()\u65b9\u6cd5\u65f6\u9700\u8981\u6ce8\u610f\uff1a\u7b2c1\u4e2a\u53c2\u6570\u8def\u5f84\u5fc5\u987b\u662f/*filepath\u5f62\u5f0f\uff0c\u7b2c2\u4e2a\u53c2\u6570\u4e3a\u6587\u4ef6\u76ee\u5f55\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"log\"\n\"net/http\"\n\"github.com/julienschmidt/httprouter\"\n)\nfunc main() {\nrouter := httprouter.New()\n//\u8bbf\u95ee\u9759\u6001\u6587\u4ef6\nrouter.ServeFiles(\"/static/*filepath\", http.Dir(\"./\"))\nlog.Fatal(http.ListenAndServe(\":8086\", router))\n}\n</code></pre> <p>HttpRouter\u5305\u5141\u8bb8\u4f7f\u7528\u8005\u8bbe\u7f6ePanicHandler,.\u4ee5\u5904\u7406\u5728HTTP\u8bf7\u6c42\u4e2d\u53d1\u751f\u7684panic\u5f02\u5e38\u3002</p> <p>Handler\u5305\u901a\u8fc7PanicHandler\u5904\u7406\u5f02\u5e38\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002 <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/julienschmidt/httprouter\"\n\"log\"\n\"net/http\"\n)\nfunc Index(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\npanic(\"error\")\n}\nfunc main() {\nrouter := httprouter.New()\nrouter.GET(\"/\", Index)\n//\u6355\u83b7\u5f02\u5e38\nrouter.PanicHandler = func(w http.ResponseWriter, r *http.Request, v interface{}) {\nw.WriteHeader(http.StatusInternalServerError)\nfmt.Fprintf(w, \"error:%s\", v)\n}\nlog.Fatal(http.ListenAndServe(\":8085\", router))\n}\n</code></pre></p> <p>httprouter\u8fd8\u6709\u4e0d\u5c11\u6709\u7528\u7684\u5c0f\u529f\u80fd\uff0c\u6bd4\u5982\u5bf9404\u8fdb\u884c\u5904\u7406\uff0c\u6211\u4eec\u901a\u8fc7\u8bbe\u7f6eRouter.NotFound\u6765\u5b9e\u73b0\uff0c\u6211\u4eec\u770b\u770bRouter\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u53d1\u73b0\u66f4\u591a\u6709\u7528\u7684\u529f\u80fd\u3002 <pre><code>type Router struct {\n//\u662f\u5426\u901a\u8fc7\u91cd\u5b9a\u5411\uff0c\u7ed9\u8def\u5f84\u81ea\u5b9a\u52a0\u659c\u6760\nRedirectTrailingSlash bool\n//\u662f\u5426\u901a\u8fc7\u91cd\u5b9a\u5411\uff0c\u81ea\u52a8\u4fee\u590d\u8def\u5f84\uff0c\u6bd4\u5982\u53cc\u659c\u6760\u7b49\u81ea\u52a8\u4fee\u590d\u4e3a\u5355\u659c\u6760\nRedirectFixedPath bool\n//\u662f\u5426\u68c0\u6d4b\u5f53\u524d\u8bf7\u6c42\u7684\u65b9\u6cd5\u88ab\u5141\u8bb8\nHandleMethodNotAllowed bool\n//\u662f\u5426\u81ea\u5b9a\u7b54\u590dOPTION\u8bf7\u6c42\nHandleOPTIONS bool\n//404\u9ed8\u8ba4\u5904\u7406\nNotFound http.Handler\n//\u4e0d\u88ab\u5141\u8bb8\u7684\u65b9\u6cd5\u9ed8\u8ba4\u5904\u7406\nMethodNotAllowed http.Handler\n//\u5f02\u5e38\u7edf\u4e00\u5904\u7406\nPanicHandler func(http.ResponseWriter, *http.Request, interface{})\n}\n</code></pre></p>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#12-\u5904\u7406\u5668\u548c\u5904\u7406\u5668\u51fd\u6570","title":"1.2 \u5904\u7406\u5668\u548c\u5904\u7406\u5668\u51fd\u6570","text":"<p>\u670d\u52a1\u5668\u5728\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4f1a\u6839\u636e\u5176URL\u5c06\u8bf7\u6c42\u4ea4\u7ed9\u76f8\u5e94\u7684\u591a\u8def\u590d\u7528\u5668\uff1b\u7136\u540e\uff0c\u591a\u8def\u590d\u7528\u5668\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u5904\u7406\u5668\u5904\u7406\u3002</p> <p>\u5904\u7406\u5668\u662f\u5b9e\u73b0\u4e86Handler\u63a5\u53e3\u7684\u7ed3\u6784\u3002Handler\u63a5\u53e3\u88ab\u5b9a\u4e49\u5728net/http\u5305\uff0c\u4e2d\uff1a</p> <p><pre><code>type Handler interface {\nfunc ServeHTTP(w ResponseWriter, r *Request)\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0cHandler\u63a5\u53e3\u4e2d\u53ea\u6709\u4e00\u4e2aServeHTTP()\u5904\u7406\u5668\u65b9\u6cd5\u3002\u4efb\u4f55\u5b9e\u73b0\u4e86Handler\u63a5\u53e3\u7684\u5bf9\u8c61\uff0c\u90fd\u53ef\u4ee5\u88ab\u6ce8\u518c\u5230\u591a\u8def\u590d\u7528\u5668\u4e2d\u3002</p> <p>\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u7ed3\u6784\u4f53\u6765\u5b9e\u73b0\u8be5\u63a5\u53e3\u7684\u65b9\u6cd5\uff0c\u4ee5\u6ce8\u518c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7c7b\u578b\u7684\u5bf9\u8c61\u5230\u591a\u8def\u590d\u7528\u5668\u4e2d\uff0c \u89c1\u4e0b\u65b9\u793a\u4f8b\u4ee3\u7801\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"net/http\"\n)\ntype WelcomeHandler struct {\nLanguage string\n}\n// \u5b9a\u4e49\u4e00\u4e2aServeHTTP()\u65b9\u6cd5\u4ee5\u5b9e\u73b0Handler\u63a5\u53e3\nfunc (h WelcomeHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"%s\", h.Language)\n}\nfunc main() {\nmux := http.NewServeMux()\nmux.Handle(\"/cn\", WelcomeHandler{Language: \"\u6b22\u8fce\u4e00\u8d77\u6765\u5b66Go Web!\"})\nmux.Handle(\"/en\", WelcomeHandler{Language: \"Welcome you, let's learn Go Web!\"})\nserver := &amp;http.Server {\nAddr:   \":8082\",\nHandler: mux,\n}\nif err := server.ListenAndServe(); err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre> <p>\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u5148\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b9e\u73b0Handler\u63a5\u53e3\u7684\u7ed3\u6784\u4f53VelcomeHandler,\u5b9e\u73b0\u4e86Handler\u63a5\u53e3\u7684ServeHTTP()\u65b9\u6cd5\uff1b \u7136\u540e\uff0c\u521b\u5efa\u8be5\u7ed3\u6784\u7684\u4e24\u4e2a\u5bf9\u8c61\uff0c\u5206\u522b\u5c06\u5b83\u6ce8\u518c\u5230\u591a\u8def\u590d\u7528\u5668\u7684/cn\u548c/en\u8def\u5f84\u4e0a\u3002</p> <p>\u8bbf\u95ee\uff1a http://127.0.0.1:8082/en \u8bbf\u95ee\uff1a http://127.0.0.1:8082/cn</p> <p>\u6ce8\u610f\uff1a \u8fd9\u91cc\u6ce8\u518c\u4f7f\u7528\u7684\u662fHandle()\u51fd\u6570\uff0c\u6ce8\u610f\u5176\u4e0eHandleFuncO\u51fd\u6570\u7684\u533a\u522b\u3002</p> <p>\u5904\u7406\u5668\u51fd\u6570\u5b9e\u73b0\u4e86\u533f\u540d\u51fd\u6570func(w http.ResponseWriter, r *http.Request)\u3002</p> <pre><code>func (mux *ServeMux) HandleFunc(pattern string, handler func(http.ResponseWriter, *http.Request)) {\nif handler == nil {\npanic(\"http: nil handler\")\n}\nmux.Handle(pattern, HandlerFunc(handler))\n}\n</code></pre> <pre><code>type HandlerFunc func(w ResponseWriter, r *Request)\nfunc (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) {\nf(w, r)\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#13-\u4e32\u8054\u5904\u7406\u5668\u548c\u5904\u7406\u5668\u51fd\u6570","title":"1.3 \u4e32\u8054\u5904\u7406\u5668\u548c\u5904\u7406\u5668\u51fd\u6570","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n\"reflect\"\n\"runtime\"\n)\nfunc hello(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"Hello\")\n}\nfunc log(h http.HandlerFunc) http.HandlerFunc {\nreturn func(w http.ResponseWriter, r *http.Request) {\nname := runtime.FuncForPC(reflect.ValueOf(h).Pointer()).Name()\nfmt.Println(\"Handler function called  - \" + name)\nh(w, r)\n}\n}\nfunc main() {\nserver := http.Server{\nAddr: \"127.0.0.1:8080\",\n}\nhttp.HandleFunc(\"/hello\", log(hello))\nserver.ListenAndServe()\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#14-\u6784\u5efa\u6a21\u578b","title":"1.4 \u6784\u5efa\u6a21\u578b","text":"<p>\u6784\u5efa\u6a21\u578b\u589e\u5220\u67e5\u6539\u6570\u636e\u5e93\u3002 <pre><code>create table if not exists user (\nuid bigint auto_increment primary key,\nname varchar(20) default '' null,\nphone varchar(20) default '' null\n) charset=utf8mb4 ;\n</code></pre></p> <pre><code>package model\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nvar DB *sql.DB\ntype User struct {\nUid   int\nName  string\nPhone string\n}\n//\u521d\u59cb\u5316\u6570\u636e\u5e93\u8fde\u63a5\nfunc init()  {\nDB, _ = sql.Open(\"mysql\",\n\"root:123456@tcp(127.0.0.1:3306)/chapter3\")\n}\n//\u83b7\u53d6\u7528\u6237\u4fe1\u606f\nfunc GetUser(uid int) (u User) {\n// \u975e\u5e38\u91cd\u8981\uff1a\u786e\u4fddQueryRow\u4e4b\u540e\u8c03\u7528Scan\u65b9\u6cd5\uff0c\u5426\u5219\u6301\u6709\u7684\u6570\u636e\u5e93\u94fe\u63a5\u4e0d\u4f1a\u88ab\u91ca\u653e\nerr := DB.QueryRow(\"select uid, name, phone from `user` where uid=?\", uid).Scan(&amp;u.Uid, &amp;u.Name, &amp;u.Phone)\nif err != nil {\nfmt.Printf(\"scan failed, err:%v\\n\", err)\nreturn\n}\nreturn u\n}\n</code></pre>"},{"location":"Golang/3.Go-Web%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/9.%E7%AE%80%E5%8D%95Web%E6%9C%8D%E5%8A%A1%E5%99%A8/#15-\u751f\u6210html\u8868\u5355","title":"1.5 \u751f\u6210HTML\u8868\u5355","text":"<p>view/t3.html</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt;\n&lt;title&gt;Welcome to my page&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;ul&gt;\n    {{range .}}\n        &lt;h1 style=\"text-align:center\"&gt;{{.}}&lt;/h1&gt;\n    {{end}}\n        &lt;h1 style=\"text-align:center\"&gt;Welcome to my page&lt;/h1&gt;\n&lt;p style=\"text-align:center\"&gt;this is the user info page&lt;/p&gt;\n&lt;/ul&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <pre><code>package controller\nimport (\n\"fmt\"\n\"gitee.com/shirdonl/goWebActualCombat/chapter3/model\"\n\"html/template\"\n\"net/http\"\n\"strconv\"\n)\ntype UserController struct {\n}\nfunc (c UserController) GetUser(w http.ResponseWriter, r *http.Request)  {\nquery := r.URL.Query()\nuid, _ := strconv.Atoi(query[\"uid\"][0])\n//\u6b64\u5904\u8c03\u7528\u6a21\u578b\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u6570\u636e\nuser := model.GetUser(uid)\nfmt.Println(user)\nt, _ := template.ParseFiles(\"view/t3.html\")\nuserInfo := []string{user.Name, user.Phone}\nt.Execute(w, userInfo)\n}\n</code></pre> <pre><code>package main\nimport (\n\"gitee.com/shirdonl/goWebActualCombat/chapter3/controller\"\n\"log\"\n\"net/http\"\n)\nfunc main() {\nhttp.HandleFunc(\"/getUser\", controller.UserController{}.GetUser)\nif err := http.ListenAndServe(\":8088\", nil); err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/","title":"Go\u64cd\u4f5cMySQL","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#1mysql\u7b80\u4ecb","title":"1.MySQL\u7b80\u4ecb","text":"<p>RDBMS(Relational Database Management System\uff0c\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf)\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#2mysql\u5b89\u88c5","title":"2.MySQL\u5b89\u88c5","text":"<p>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://dev.mysql.com/downloads/mysql/</p> <p>\uff081\uff09\u5220\u9664\u6240\u6709\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u53ea\u7559\u4e0bbin\u76ee\u5f55\u548cshare\u76ee\u5f55\u3002</p> <p>\uff082\uff09\u7ba1\u7406\u5458\u8eab\u4efd\u8fd0\u884cCMD\uff0c\u5207\u6362\u5230mysql\\bin\u76ee\u5f55\uff0c\u521d\u59cb\u5316\u6570\u636e\u5e93mysqld --initialize --console\uff0c\u6267\u884c\u5b8c\u6210\u540e\uff0c\u4f1a\u8f93\u51fa root \u7528\u6237\u7684\u521d\u59cb\u9ed8\u8ba4\u5bc6\u7801\uff0c\u4f1a\u51fa\u73b0data\u76ee\u5f55\u3002</p> <p>\uff083\uff09\u5b89\u88c5mysqld install\uff08\u9ed8\u8ba4\u540d\u5b57mysql\uff09\u6216mysqld --install gomysql\uff0cgomysql\u662f\u81ea\u5df1\u8d77\u7684\u6570\u636e\u5e93\u670d\u52a1\u540d\u5b57</p> <p>\uff084\uff09\u542f\u52a8\u670d\u52a1net start mysql(gomysql)</p> <p>\uff085\uff09\u767b\u5f55\u9a8c\u8bc1mysql -u root -p\uff0c\u8f93\u5165root \u7528\u6237\u7684\u521d\u59cb\u9ed8\u8ba4\u5bc6\u7801</p> <p>\uff086\uff09\u4fee\u6539\u5bc6\u7801alter user 'root'@'localhost' identified by 'root';\uff0c\u5e76\u9000\u51faexti;</p> <p>\uff087\uff09\u505c\u6b62\u670d\u52a1net stop mysql(gomysql)</p> <p>\uff088\uff09\u5378\u8f7dmysqld remove\u6216mysqld --remove gomysql</p> <p>\uff089\uff09\u5229\u7528\u914d\u7f6e\u6587\u4ef6my.ini\uff08\u6839\u76ee\u5f55\uff09\u767b\u5f55\uff0cmysql</p> <p>\u7b80\u5355\u7248\u672c</p> <p>my.conf</p> <pre><code>[mysqld]\nport=3306\nbasedir=D:\\\\soft\\\\mysql-8.0.26-winx64\nmax_connections=200\nmax_connect_errors=10\ncharacter-set-server=utf8mb4\ndefault-storage-engine=INNODB\n#default_authentication_plugin=mysql_native_password\n\n[mysql]\ndefault-character-set=utf8mb4\n\n[client]\nhost=0.0.0.0\ndefault-character-set=utf8mb4\nport=3306\nuser=root\npassword=root\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6\u8be6\u89e3</p> <pre><code>[mysqld]\n#\u8bbe\u7f6e\u65f6\u533a\u4e3a\u4e1c\u516b\u533a\uff0c\u6b64\u9879\u8bbe\u7f6e\u540e\uff0c\u5728\u8fde\u63a5MySQL\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u7528\u6bcf\u6b21\u90fd\u624b\u52a8\u8bbe\u7f6e\u65f6\u533a\n#default-time-zone = '+8:00'\n#\u89e3\u51b3\u5bfc\u5165\u811a\u672c\u662ffunction\u62a5\u9519\n#log_bin_trust_function_creators=1\n# \u8bbe\u7f6e3306\u7aef\u53e3\nport=3306\n# \u8bbe\u7f6emysql\u7684\u5b89\u88c5\u76ee\u5f55\nbasedir=D:\\\\soft\\\\mysql-8.0.26-winx64\n# \u8bbe\u7f6e mysql\u6570\u636e\u5e93\u7684\u6570\u636e\u7684\u5b58\u653e\u76ee\u5f55\uff0cMySQL 8+ \u4e0d\u9700\u8981\u4ee5\u4e0b\u914d\u7f6e\uff0c\u7cfb\u7edf\u81ea\u5df1\u751f\u6210\u5373\u53ef\uff0c\u5426\u5219\u6709\u53ef\u80fd\u62a5\u9519\n#datadir=D:\\soft\\mysql-8.0.26-winx64\\data\n# \u5141\u8bb8\u6700\u5927\u8fde\u63a5\u6570\nmax_connections=200\n# \u5141\u8bb8\u8fde\u63a5\u5931\u8d25\u7684\u6b21\u6570\u3002\nmax_connect_errors=10\n# \u670d\u52a1\u7aef\u4f7f\u7528\u7684\u5b57\u7b26\u96c6\u9ed8\u8ba4\u4e3autf8\ncharacter-set-server=utf8mb4\n# \u521b\u5efa\u65b0\u8868\u65f6\u5c06\u4f7f\u7528\u7684\u9ed8\u8ba4\u5b58\u50a8\u5f15\u64ce\ndefault-storage-engine=INNODB\n# \u9ed8\u8ba4\u4f7f\u7528\u201cmysql_native_password\u201d\u63d2\u4ef6\u8ba4\u8bc1\n#default_authentication_plugin=mysql_native_password\n\n[mysql]\n# \u8bbe\u7f6emysql\u5ba2\u6237\u7aef\u9ed8\u8ba4\u5b57\u7b26\u96c6\ndefault-character-set=utf8mb4\n\n[client]\nhost=0.0.0.0\n# \u8bbe\u7f6emysql\u5ba2\u6237\u7aef\u8fde\u63a5\u670d\u52a1\u7aef\u65f6\u9ed8\u8ba4\u4f7f\u7528\u7684\u7aef\u53e3\n# \u8bbe\u7f6emysql\u5ba2\u6237\u7aef\u9ed8\u8ba4\u5b57\u7b26\u96c6\ndefault-character-set=utf8mb4\n## mysql -hlocalhost -uroot -P3306 -p\nport=3306\nuser=root\npassword=root\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#2mysql\u57fa\u7840\u5165\u95e8","title":"2.MySQL\u57fa\u7840\u5165\u95e8","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#21-\u6570\u636e\u5e93\u7ba1\u7406","title":"2.1 \u6570\u636e\u5e93\u7ba1\u7406","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#1-\u521b\u5efa\u6570\u636e\u5e93","title":"1. \u521b\u5efa\u6570\u636e\u5e93","text":"<pre><code>#\u521b\u5efa\u6570\u636e\u5e93\nCREATE DATABASE database_name;\nCREATE DATABASE `user` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n# \u67e5\u770b\u6570\u636e\u5e93\nSHOW DATABASES;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#2\u9009\u62e9\u6570\u636e\u5e93","title":"2.\u9009\u62e9\u6570\u636e\u5e93","text":"<pre><code>#\u9009\u62e9\u6570\u636e\u5e93\nUSE database_name;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#3\u67e5\u770b\u6570\u636e\u5e93","title":"3.\u67e5\u770b\u6570\u636e\u5e93","text":"<pre><code># \u67e5\u770b\u6570\u636e\u5e93\nSHOW DATABASES [LIKE 'database_name'];\n# \u5176\u8bed\u6cd5\u8bf4\u660e\u5982\u4e0b\uff1a \n# LKE\u4ece\u53e5\u662f\u53ef\u9009\u9879\uff0c\u7528\u4e8e\u5339\u914d\u6307\u5b9a\u7684\u6570\u636e\u5e93\u540d\u79f0\u3002LKE\u4ece\u53e5\u53ef\u4ee5\u90e8\u5206\u5339\u914d\uff0c\u4e5f\u53ef\u4ee5\u5b8c\u5168\u5339\u914d\u3002\n# \u6570\u636e\u5e93\u540d\u7531\u5355\u5f15\u53f7\uff08')\u5305\u56f4\u3002\n# \u67e5\u770b\u6240\u6709\u6570\u636e\u5e93\nSHOW DATABASES;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#4\u4fee\u6539\u6570\u636e\u5e93","title":"4.\u4fee\u6539\u6570\u636e\u5e93","text":"<pre><code>#\u4fee\u6539\u6570\u636e\u5e93\u6570\u636e\u5e93\u4f7f\u7528\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\nALTER DATABASE [\u6570\u636e\u5e93\u540d] { [DEFAULT] CHARACTER SET &lt;\u5b57\u7b26\u96c6\u540d&gt; |\n[DEFAULT] COLLATE &lt;\u6821\u5bf9\u89c4\u5219\u540d&gt;\n}\n# \u4f8b\u5982\uff0c\u7528ALTER\u547d\u4ee4\u4fee\u6539\u6570\u636e\u5e93\u5bf9\u5e94\u7684\u5b57\u7b26\u96c6\uff1a\nmysql&gt; ALTER DATABASES test default character SET gb2312 collate gb2312_chinese_ci;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#5\u5220\u9664\u6570\u636e\u5e93","title":"5.\u5220\u9664\u6570\u636e\u5e93","text":"<pre><code># \u5220\u9664\u6570\u636e\u5e93\nDROP DATABASE [IF EXISTS] database_name;\nmysql&gt; DROP DATABASE mysql_db_test;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#22-\u6570\u636e\u8868\u64cd\u4f5c","title":"2.2 \u6570\u636e\u8868\u64cd\u4f5c","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#1-\u521b\u5efa\u6570\u636e\u8868","title":"1. \u521b\u5efa\u6570\u636e\u8868","text":"<pre><code>#\u521b\u5efa\u6570\u636e\u8868\nCREATE TABLE &lt;\u8868\u540d&gt; (&lt;\u5217\u540d1&gt;&lt;\u7c7b\u578b1&gt;[, ...]&lt;\u5217\u540dn&gt;&lt;\u7c7b\u578bn&gt;)[\u8868\u9009\u9879][\u5206\u533a\u9009\u9879];\nCREATE TABLE IF NOT EXISTS `runoob_tbl` (\n`runoob_id` INT UNSIGNED AUTO_INCREMENT,\n   `runoob_title` VARCHAR(100) NOT NULL,\n   `runoob_author` VARCHAR(40) NOT NULL,\n   `submission_date` DATE,\n   PRIMARY KEY ( `runoob_id` )\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\nCREATE TABLE `user` (\n`id` int(11) NOT NULL AUTO_INCREMENT,\n    `phone` varchar(30) DEFAULT '' COMMENT '\u624b\u673a\u53f7',\n    `password` varchar(80) DEFAULT '' COMMENT '\u5bc6\u7801',\n    `add_time` int(10) DEFAULT '0' COMMENT '\u6dfb\u52a0\u65f6\u95f4',\n    `last_ip` varchar(50) DEFAULT '' COMMENT '\u6700\u8fd1ip',\n    `email` varchar(50) DEFAULT '' COMMENT '\u90ae\u7f16',\n    `status` tinyint(4) DEFAULT '0' COMMENT '\u72b6\u6001',\n    PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#2\u67e5\u770b\u6570\u636e\u8868","title":"2.\u67e5\u770b\u6570\u636e\u8868","text":"<pre><code>show tables;                #\u67e5\u770b\u6570\u636e\u5e93\u4e2d\u6240\u6709\u8868\nDESC[RIBE] user;              #\u8868\u683c\u4fe1\u606f\u5c55\u793a\u8868\u7684\u5b57\u6bb5\u4fe1\u606f\nSHOW CREATE TABLE user;     #\u4ee5SQL\u8bed\u53e5\u5f62\u5f0f\u5c55\u793a\u8868\u4fe1\u606f\nselect * form user;         #\u67e5\u770b\u8868\u5185\u5bb9\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#3\u4fee\u6539\u6570\u636e\u8868","title":"3.\u4fee\u6539\u6570\u636e\u8868","text":"<pre><code>ALTER TABLE &lt;\u8868\u540d&gt; [\u4fee\u6539\u9009\u9879]\n# \u4fee\u6539\u9009\u9879\nADD &lt;\u5217\u540d&gt; &lt;\u7c7b\u578b&gt; #\u589e\u52a0\u65b0\u5217\nDROP COLUNM &lt;\u5217\u540d&gt; #\u5220\u9664\u65e7\u5217\nCHANGE COLUMN &lt;\u65e7\u5217\u540d&gt; &lt;\u65b0\u5217\u540d&gt; &lt;\u65b0\u5217\u7c7b\u578b&gt;\nALTER COLUMN &lt;\u5217\u540d&gt; {SET DEFAULT &lt;\u9ed8\u8ba4\u503c&gt;| DROP DEFAULT} MODIFY COLUMN &lt;\u5217\u540d&gt; &lt;\u7c7b\u578b&gt;\nRENAME [TO] &lt;\u65b0\u8868\u540d&gt; CHARACTER SET &lt;\u5b57\u7b26\u96c6\u540d&gt;\nCOLLATE &lt;\u6821\u5bf9\u89c4\u5219\u540d&gt;\n\n# \u4f8b\u5982\uff0c\u5728user\u8868\u4e2d\u589e\u52a0\u4e00\u4e2ausername\u5b57\u6bb5\u7684\u8bed\u6cd5\u5982\u4e0b\nALTER TABLE user ADD username varchar(30) DEFAULT '' NULL;\n# \u4fee\u6539\u8868\u540d\nALTER TABLE user RENAME TO user_new;\n# \u4fee\u6539\u8868\u5b57\u7b26\u96c6\nALTER TABLE user_new [DEFAULT] CHARACTER SET gb2312 [DEFAULT] COLLATE gb2312_chinese_ci;\n# \u5176\u4e2d\uff0cDEFAU\u513fT\u4e3a\u53ef\u9009\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u4f7f\u7528ALTER TABLE\u5c06\u6570\u636e\u8868user_new\u7684\u5b57\u7b26\u96c6\u4fee\u6539\u4e3agb2312,\u5c06\u6821\u5bf9\u89c4\u5219\u4fee\u6539\u4e3agb2312_chinese_ci\n# SQL\u8bed\u53e5\u548c\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\uff1a \nmysql&gt; ALTER TABLE user_new CHARACTER SET gb2312 DEFAULT COLLATE gb2312 chinese ci; # \u7136\u540e\u7528show create table\u547d\u4ee4\u67e5\u770b\nmysql&gt; show create table user_new\\G;\n*************************** 1. row ***************************\n       Table: user_new\nCreate Table: CREATE TABLE `user_new` (\n`id` int(11) NOT NULL AUTO_INCREMENT,\n  `phone` varchar(30) DEFAULT '' COMMENT '\u624b\u673a\u53f7',\n  `password` varchar(80) DEFAULT '' COMMENT '\u5bc6\u7801',\n  `add_time` int(10) DEFAULT '0' COMMENT '\u6dfb\u52a0\u65f6\u95f4',\n  `last_ip` varchar(50) DEFAULT '' COMMENT '\u6700\u8fd1ip',\n  `email` varchar(50) DEFAULT '' COMMENT '\u90ae\u7f16',\n  `status` tinyint(4) DEFAULT '0' COMMENT '\u72b6\u6001',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8\n1 row in set (0.00 sec)\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#4\u5220\u9664\u6570\u636e\u8868","title":"4.\u5220\u9664\u6570\u636e\u8868","text":"<pre><code>DROP TABLE [IF EXISTS] \u88681 [, \u88682, \u88683 ...]\nDROP TABLE user_new;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#23-\u6570\u636e\u5e93\u8bed\u53e5","title":"2.3 \u6570\u636e\u5e93\u8bed\u53e5","text":"<pre><code>#\u63d2\u5165\u6570\u636e\nINSERT [INTO] \u8868\u540d [(\u5217\u540d1\uff0c\u5217\u540d2\uff0c...)] VALUES (\u503c1\uff0c\u503c2\uff0c...);\nINSERT INTO `user` (`phone`, `password`, `add_time`, `last_ip`, `email`, `status`) VALUES ('138888888', DEFAULT, DEFAULT, '123.55.66.3', 'test@163.com', 1);\n#\u67e5\u8be2\u6570\u636e\nSELECT \u5217\u540d\u79f0 FROM \u8868\u540d\u79f0 [\u67e5\u8be2\u6761\u4ef6];\nSELECT `phone`, `email` FROM user LIMIT 501;\nSELECT * FROM user;\nSELECT `phone`, `email` FROM user WHERE `status`&gt;0;\n#\u66f4\u65b0\u6570\u636e\nUPDATE \u8868\u540d\u79f0 SET \u5217\u540d\u79f0=\u65b0\u503c WHERE\u66f4\u65b0\u6761\u4ef6;\nUPDATE `user` SET `phone`='1888888' WHERE `id`=4;\n#\u5220\u9664\u6570\u636e\nDELETE FROM \u8868\u540d\u79f0 WHERE\u5220\u9664\u6761\u4ef6;\nDELETE FROM `user` WHERE `id`=4;\nDELETE FROM `user` WHERE `status`&lt;4;\nDELETE FROM `user`;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#3go\u8bbf\u95eemysql","title":"3.Go\u8bbf\u95eeMySQL","text":"<p>Go\u8bed\u8a00\u4e2d\u7684database/sql\u5305\u63d0\u4f9b\u4e86\u8fde\u63a5SQL\u6570\u636e\u5e93\u6216\u7c7bSQL\u6570\u636e\u5e93\u7684\u6cdb\u7528\u63a5\u53e3\uff0c\u4f46\u5e76\u4e0d\u63d0\u4f9b\u5177\u4f53\u7684\u6570\u636e\u5e93\u9a71\u52a8\u7a0b\u5e8f\u3002</p> <p>\u5728\u4f7f\u7528database/sql\u5305\u65f6\uff0c\u5fc5\u987b\u6ce8\u5165\u81f3\u5c11\u4e00\u4e2a\u6570\u636e\u5e93\u9a71\u52a8\u7a0b\u5e8f\u3002\u5728Go\u8bed\u8a00\u4e2d\uff0c\u5e38\u7528\u7684\u6570\u636e\u5e93\u57fa\u672c\u90fd\u6709\u5b8c\u6574\u7684\u7b2c\u4e09\u65b9\u5305\u5b9e\u73b0\u3002</p> <p>\u5728\u7528Go\u8bed\u8a00\u8bbf\u95eeMySQL\u4e4b\u524d\uff0c\u9700\u8981\u5148\u521b\u5efa\u6570\u636e\u5e93\u548c\u6570\u636e\u8868\u3002</p> <pre><code>mysql \u2013uroot \u2013p123456 -Dtest &lt; C:\\test.sql\nsource C:\\test.sql\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#31-\u521b\u5efa\u6570\u636e\u5e93\u548c\u6570\u636e\u8868","title":"3.1 \u521b\u5efa\u6570\u636e\u5e93\u548c\u6570\u636e\u8868","text":"<p>test.sql</p> <pre><code>CREATE DATABASE IF NOT EXISTS chapter4;\nUSE chapter4;\nCREATE TABLE IF NOT EXISTS `user` (\n`uid` BIGINT(20) NOT NULL AUTO_INCREMENT,\n`name` VARCHAR(20) DEFAULT '',\n`phone` VARCHAR(20) DEFAULT '',\nPRIMARY KEY(`uid`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4;\nINSERT INTO `user` (`name`, `phone`) VALUES ('yx', '138888888');\nINSERT INTO `user` (`uid`, `name`, `phone`) VALUES (111, 'yx', '138888888');\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#32-\u4e0b\u8f7dmysql\u7684\u9a71\u52a8\u7a0b\u5e8f","title":"3.2 \u4e0b\u8f7dMySQL\u7684\u9a71\u52a8\u7a0b\u5e8f","text":"<p>MySQL\u9a71\u52a8\u7a0b\u5e8f\u7684\u4e0b\u8f7d\u65b9\u6cd5\u975e\u5e38\u7b80\u5355\uff0c\u76f4\u63a5\u901a\u8fc7\u201cgo get'\u201d\u547d\u4ee4\u5373\u53ef\uff1a</p> <pre><code>go get -u \"github.com/go-sql-driver/mysql\"\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#33-\u8fde\u63a5\u6570\u636e\u5e93","title":"3.3 \u8fde\u63a5\u6570\u636e\u5e93","text":"<pre><code>package main\nimport (\n\"database/sql\"\n_ \"github.com/go-sql-driver/mysql\"\n\"log\"\n)\nfunc main() {\ndb, err := sql.Open(\"mysql\",\n\"user:password@tcp(127.0.0.1:3306)/hello\")\nif err != nil {\nlog.Fatal(err)\n}\ndefer db.Close()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#34-\u521d\u59cb\u5316\u8fde\u63a5","title":"3.4 \u521d\u59cb\u5316\u8fde\u63a5","text":"<pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4\")\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\n}\n</code></pre> <p>\u8bbe\u7f6e\u6700\u5927\u8fde\u63a5\u6570n&lt;=0\uff0c\u65e0\u9650\u5236\uff0c\u9ed8\u8ba40\u3002 \u4e0d\u4f1a\u8d85\u8fc7\u6570\u636e\u5e93\u9ed8\u8ba4\u914d\u7f6e\u3002</p> <pre><code>func (db *DB) SetMaxOpenConns(n int)\n</code></pre> <p>\u8bbe\u7f6e\u6700\u5927\u95f2\u7f6e\u8fde\u63a5\u6570n&lt;=0\uff0c\u65e0\u9650\u5236\uff0c\u9ed8\u8ba40\u3002\u4e0d\u4f1a\u8d85\u8fc7\u6570\u636e\u5e93\u9ed8\u8ba4\u914d\u7f6e\u3002 <pre><code>func (db *DB) SetMaxIdleConns(n int)\n</code></pre></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#35-sql\u589e\u5220\u6539\u67e5","title":"3.5 SQL\u589e\u5220\u6539\u67e5","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#1queryrow\u5355\u884c\u67e5\u8be2","title":"1.QueryRow()\u5355\u884c\u67e5\u8be2","text":"<p>\u6839\u636e\u4e4b\u524d\u521b\u5efa\u7684user\u8868\uff0c\u5b9a\u4e49\u4e00\u4e2auser\u7ed3\u6784\u4f53\u6765\u5b58\u50a8\u6570\u636e\u5e93\u8fd4\u56de\u7684\u6570\u636e</p> <pre><code>type User struct {\nUid   int\nName  string\nPhone string\n}\n</code></pre> <p>database/sql\u5305\u4e2d\u5355\u884c\u67e5\u8be2\u65b9\u6cd5\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>func (db *DB) QueryRow(query string, args ...interface{}) *Row\n</code></pre> <p>QueryRow()\u65b9\u6cd5\u6267\u884c\u4e00\u6b21\u67e5\u8be2\uff0c\u5e76\u8fd4\u56de\u6700\u591a\u4e00\u884c(Row)\u7ed3\u679c\u3002</p> <p>QueryRow()\u65b9\u6cd5\u603b\u662f\u8fd4\u56de\u975enil\u7684\u503c\uff0c\u76f4\u5230\u8fd4\u56de\u503c\u7684Scan()\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\u624d\u4f1a\u8fd4\u56de\u88ab\u5ef6\u8fdf\u7684\u9519\u8bef\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4\")\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\ntype User struct {\nUid   int\nName  string\nPhone string\n}\nfunc queryRow() {\nvar u User\nif err := db.QueryRow(\"select uid, name, phone from user where uid=?;\", 1).Scan(&amp;u.Uid, &amp;u.Name, &amp;u.Phone); err != nil {\nfmt.Printf(\"scan failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"uid:%d name:%s phone:%s\\n\", u.Uid, u.Name, u.Phone) //uid:1 name:yx phone:138888888\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\nqueryRow()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#2query\u591a\u884c\u67e5\u8be2","title":"2.Query()\u591a\u884c\u67e5\u8be2","text":"<p>Query()\u65b9\u6cd5\u6267\u884c\u4e00\u6b21\u67e5\u8be2\uff0c\u8fd4\u56de\u591a\u884c\uff08Rows)\u7ed3\u679c\uff0c\u4e00\u822c\u7528\u4e8e\u6267\u884cSELECT\u7c7b\u578b\u7684SQL\u547d\u4ee4\u3002</p> <p>Query()\u65b9\u6cd5\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>func (db *DB) Query(query string, args ...interface{}) (*Rows, error)\n</code></pre> <p>\u5176\u4e2dquery\u8868\u793aSQL\u8bed\u53e5\uff0c\u53c2\u6570args\u8868\u793aquery\u67e5\u8be2\u8bed\u53e5\u4e2d\u7684\u7ad9\u4f4d\u53c2\u6570\u3002</p> <pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4\")\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\ntype User struct {\nUid   int\nName  string\nPhone string\n}\nfunc queryMultiRow() {\nvar u User\nrows, err := db.Query(\"select uid, name, phone from user where uid&gt;?;\", 0)\nif err != nil {\nfmt.Printf(\"query failed, err:%v\\n\", err)\nreturn\n}\ndefer rows.Close()\nfor rows.Next() {\nerr := rows.Scan(&amp;u.Uid, &amp;u.Name, &amp;u.Phone)\nif err != nil {\nfmt.Printf(\"scan failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"uid:%d name:%s phone:%s\\n\", u.Uid, u.Name, u.Phone)\n}\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\nqueryMultiRow()\n}\n/* \nuid:1 name:yx phone:138888888\nuid:111 name:yx phone:138888888 \n*/\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#3\u63d2\u5165\u6570\u636e","title":"3.\u63d2\u5165\u6570\u636e","text":"<p>Exec()\u65b9\u6cd5\u7528\u4e8e\u6267\u884c\u4e00\u6b21\u547d\u4ee4\uff08\u5305\u62ec\u67e5\u8be2\u3001\u5220\u9664\u3001\u66f4\u65b0\u3001\u63d2\u5165\u7b49\uff09\uff0c\u8fd4\u56de\u7684Result\u662f\u5bf9\u5df2\u6267\u884c\u7684SQL\u547d\u4ee4\u7684\u6267\u884c\u7ed3\u679c\u3002</p> <p>\u5176\u4e2d\uff0c\u53c2\u6570query\u8868\u793aSQL\u8bed\u53e5\uff0c\u53c2\u6570args\u8868\u793aquery\u53c2\u6570\u4e2d\u7684\u5360\u4f4d\u53c2\u6570\u3002</p> <pre><code>func (db *DB) Exec(query string, args ...interface{}) (Result, error)\n</code></pre> <p>Exec()\u65b9\u6cd5\u63d2\u5165\u6570\u636e\u7684\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4\")\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\nfunc insertRow() {\nret, err := db.Exec(\"insert into user(name, phone) values(?, ?);\", \"ml\", \"15906693677\")\nif err != nil {\nfmt.Printf(\"insert failed, err:%v\\n\", err)\nreturn\n}\nuid, err := ret.LastInsertId()\nif err != nil {\nfmt.Printf(\"get lastinsert ID failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"insert success, the id is %d.\\n\", uid)\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\ninsertRow()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#4\u66f4\u65b0\u6570\u636e","title":"4.\u66f4\u65b0\u6570\u636e","text":"<p>Exec()\u65b9\u6cd5\u66f4\u65b0\u6570\u636e\u7684\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4\")\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\nfunc updateRow() {\nret, err := db.Exec(\"update user set name=? where uid=?;\", \"tt\", 1)\nif err != nil {\nfmt.Printf(\"update failed, err:%v\\n\", err)\nreturn\n}\nn, err := ret.RowsAffected()\nif err != nil {\nfmt.Printf(\"get lastinsert ID failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"update success, affected rows:%d\\n\", n) //update success, affected rows:1\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\nupdateRow()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#5\u5220\u9664\u6570\u636e","title":"5.\u5220\u9664\u6570\u636e","text":"<p>Exec()\u65b9\u6cd5\u5220\u9664\u6570\u636e\u7684\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4\")\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\nfunc deleteRow() {\nret, err := db.Exec(\"delete from user where uid=?;\", 2)\nif err != nil {\nfmt.Printf(\"delete failed, err:%v\\n\", err)\nreturn\n}\nn, err := ret.RowsAffected()\nif err != nil {\nfmt.Printf(\"get lastinsert ID failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"update success, affected rows:%d\\n\", n)\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\ndeleteRow()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#36-mysql\u9884\u5904\u7406","title":"3.6 MySQL\u9884\u5904\u7406","text":"<p>SQL\u6267\u884c\u8fc7\u7a0b\uff1a 1. \u5ba2\u6237\u7aef\u5bf9SQL\u8bed\u53e5\u8fdb\u884c\u5360\u4f4d\u7b26\u66ff\u6362\uff0c\u5f97\u5230\u5b8c\u6574SQL\u8bed\u53e5\uff1b</p> <ol> <li> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u5b8c\u6574SQL\u8bed\u53e5\u5230MySQL\u670d\u52a1\u5668\u7aef\uff1b</p> </li> <li> <p>MySQL\u670d\u52a1\u5668\u7aef\u6267\u884c\u5b8c\u6574SQL\u8bed\u53e5\uff0c\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef</p> </li> </ol> <p>\u9884\u5904\u7406\u6267\u884c\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5c06SQL\u8bed\u53e5\u5206\u4e3a\u547d\u4ee4\u90e8\u5206\u548c\u6570\u636e\u90e8\u5206\uff1b</li> <li>\u547d\u4ee4\u90e8\u5206\u53d1\u9001\u7ed9MySQL\u670d\u52a1\u5668\u7aef\uff0cMySQL\u670d\u52a1\u5668\u7aef\u6267\u884cSQL\u9884\u5904\u7406\uff1b</li> <li>\u6570\u636e\u90e8\u5206\u53d1\u9001\u7ed9MySQL\u670d\u52a1\u5668\u7aef\uff0cMySQL\u670d\u52a1\u5668\u7aef\u5bf9SQL\u8bed\u53e5\u8fdb\u884c\u5360\u4f4d\u7b26\u66ff\u6362\uff1b</li> <li>MySQL\u670d\u52a1\u5668\u7aef\u6267\u884c\u5b8c\u6574SQL\u8bed\u53e5\uff0c\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</li> <li>\u9884\u5904\u7406\u4f18\u5316MySQL\u670d\u52a1\u5668\u91cd\u590d\u6267\u884cSQL\u8bed\u53e5\u7684\u95ee\u9898\uff0c\u63d0\u5347\u6027\u80fd\u3002\u63d0\u524d\u8ba9\u670d\u52a1\u5668\u7f16\u8bd1\uff0c\u4e00\u6b21\u7f16\u8bd1\u591a\u6b21\u6267\u884c\u3002</li> </ol> <pre><code>func (db *DB) Prepare(query string) (*Stmt, error)\n</code></pre> <pre><code>func prepareQuery() {\nstmt, err := db.Prepare(\"select uid, name, phone from `user` where uid &gt; ?;\")\nif err != nil {\nfmt.Printf(\"prepare failed, err:%v\\n\", err)\nreturn\n}\ndefer stmt.Close()\nrows, err := stmt.Query(0)\nif err != nil {\nfmt.Printf(\"query failed, err:%v\\n\", err)\nreturn\n}\ndefer rows.Close()\n// \u5faa\u73af\u8bfb\u53d6\u7ed3\u679c\u96c6\u4e2d\u7684\u6570\u636e\nfor rows.Next() {\nerr := rows.Scan(&amp;u.Uid, &amp;u.Name, &amp;u.Phone)\nif err != nil {\nfmt.Printf(\"scan failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"uid:%d name:%s phone:%s\\n\", u.Uid, u.Name, u.Phone)\n}\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#37-\u7528go\u5b9e\u73b0mysql\u4e8b\u52a1","title":"3.7 \u7528Go\u5b9e\u73b0MySQL\u4e8b\u52a1","text":"<p>(1) \u4ec0\u4e48\u662f\u4e8b\u52a1\uff1f \u4e8b\u52a1\u662f\u4e00\u4e2a\u6700\u5c0f\u7684\u3001\u4e0d\u53ef\u518d\u5206\u7684\u5de5\u4f5c\u5355\u5143\u3002 \u901a\u5e38\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u5e94\u4e00\u4e2a\u5b8c\u6574\u7684\u4e1a\u52a1\uff08\u4f8b\u5982\u94f6\u884c\u8d26\u6237\u8f6c\u8d26\u4e1a\u52a1\uff0c\u8be5\u4e1a\u52a1\u5c31\u662f\u4e00\u4e2a\u6700\u5c0f\u7684\u5de5\u4f5c\u5355\u5143)\uff0c\u540c\u65f6\u8fd9\u4e2a\u5b8c\u6574\u7684\u4e1a\u52a1\u9700\u8981\u6267\u884c\u591a\u6b21DML\uff08INSERT\u3001 UPDATE\u3001DELETE\u7b49)\u8bed\u53e5\uff0c\u5171\u540c\u8054\u5408\u5b8c\u6210\u3002</p> <p>\u4f8b\u5982\uff0cA\u8f6c\u8d26\u7ed9B,\u5c31\u9700\u8981\u6267\u884c\u4e24\u6b21UPDATE\u64cd\u4f5c\u3002</p> <p>\u5728MySQL\u4e2d\u53ea\u6709\u4f7f\u7528\u4e86Innodb\u6570\u636e\u5e93\u5f15\u64ce\u7684\u6570\u636e\u5e93\u6216\u8868\u624d\u652f\u6301\u4e8b\u52a1\u3002</p> <p>\u4e8b\u52a1\u5904\u7406\u7528\u6765\u7ef4\u62a4\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6027\uff0c\u4fdd\u8bc1\u6210\u6279\u7684SQL\u8bed\u53e5\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c\u3002</p> <p>(2) \u4e8b\u52a1\u7684ACID\u5c5e\u6027</p> \u5c5e\u6027 \u89e3\u91ca \u539f\u5b50\u6027\uff08Atomicity\uff0c\u4e0d\u53ef\u5206\u5272\u6027\uff09 \u4e8b\u52a1\u7684\u6240\u6709\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u4e0d\u6267\u884c\u3002\u82e5\u6267\u884c\u9519\u8bef\uff0c\u4f1a\u88ab\u56de\u6eda\uff08Rollback\uff09\u5230\u4e4b\u524d\u72b6\u6001\u3002 \u4e00\u81f4\u6027\uff08Consistency\uff09 \u4e8b\u52a1\u6267\u884c\u524d\u540e\uff0c\u672a\u7834\u574f\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6027\u3002 \u9694\u79bb\u6027\uff08Isolation\uff0c\u72ec\u7acb\u6027\uff09 \u5141\u8bb8\u591a\u4e2a\u4e8b\u52a1\u540c\u65f6\u8bfb\u5199\u6570\u636e\u3002\u907f\u514d\u591a\u4e2a\u4e8b\u52a1\u4ea4\u53c9\u6267\u884c\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u3002\u5206\u4e3a\u4e0d\u540c\u7ea7\u522b\uff0c\u8bfb\u672a\u63d0\u4ea4\uff08read uncommitted\uff09\u3001\u8bfb\u63d0\u4ea4\uff08read committed\uff09\u3001\u53ef\u91cd\u590d\u8bfb\uff08repeatable\uff09\u548c\u4e32\u884c\u5316\uff08serializable\uff09\u3002 \u6301\u4e45\u6027\uff08Durability\uff09 \u4e8b\u52a1\u5904\u7406\u7ed3\u675f\uff0c\u5bf9\u6570\u636e\u7684\u4fee\u6539\u662f\u6c38\u4e45\u7684\u3002 <p>\u5f00\u59cb\u4e8b\u52a1 <pre><code>func (db *DB) Begin() (*Tx, error)\n</code></pre> \u63d0\u4ea4\u4e8b\u52a1 <pre><code>func (tx *Tx) Commit() error\n</code></pre> \u56de\u6eda\u4e8b\u52a1 <pre><code>func (tx *Tx) Rollback() error\n</code></pre></p> <pre><code>func transaction() {\ntx, err := db.Begin() // \u5f00\u542f\u4e8b\u52a1\nif err != nil {\nif tx != nil {\ntx.Rollback() // \u56de\u6eda\n}\nfmt.Printf(\"begin trans failed, err:%v\\n\", err)\nreturn\n}\n_, err = tx.Exec(\"update user set username='james' where uid=?\", 1)\nif err != nil {\ntx.Rollback() // \u56de\u6eda\nfmt.Printf(\"exec sql1 failed, err:%v\\n\", err)\nreturn\n}\n_, err = tx.Exec(\"update user set username='james' where uid=?\", 3)\nif err != nil {\ntx.Rollback() // \u56de\u6eda\nfmt.Printf(\"exec sql2 failed, err:%v\\n\", err)\nreturn\n}\nerr = tx.Commit() // \u63d0\u4ea4\u4e8b\u52a1\nif err != nil {\ntx.Rollback() // \u56de\u6eda\nfmt.Printf(\"commit failed, err:%v\\n\", err)\nreturn\n}\nfmt.Println(\"exec transaction success!\")\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#38-sql\u6ce8\u5165\u4e0e\u9632\u62a4","title":"3.8 SQL\u6ce8\u5165\u4e0e\u9632\u62a4","text":"<p>SQL\u6ce8\u5165\u662f\u4e00\u79cd\u653b\u51fb\u624b\u6bb5\uff0c\u901a\u8fc7\u6267\u884c\u6076\u610fSQL\u8bed\u53e5\uff0c\u8fdb\u800c\u5c06\u4efb\u610fSQL\u4ee3\u7801\u63d2\u5165\u6570\u636e\u5e93\u67e5\u8be2\u4e2d\uff0c\u4ece\u800c\u4f7f\u653b\u51fb\u8005\u5b8c\u5168\u63a7\u5236Web\u5e94\u7528\u7a0b\u5e8f\u540e\u53f0\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\u3002</p> <p>\u653b\u51fb\u8005\u53ef\u4ee5\u4f7f\u7528SQL\u6ce8\u5165\u6f0f\u6d1e\u7ed5\u8fc7\u5e94\u7528\u7a0b\u5e8f\u9a8c\u8bc1\uff0c\u6bd4\u5982\u7ed5\u8fc7\u767b\u5f55\u9a8c\u8bc1\u767b\u5f55\u3001Wb\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\u9875\u9762\uff1b</p> <p>\u4e5f\u53ef\u4ee5\u7ed5\u8fc7\u7f51\u9875\uff0c\u76f4\u63a5\u68c0\u7d22\u6570\u636e\u5e93\u7684\u6240\u6709\u5185\u5bb9\uff1b\u8fd8\u53ef\u4ee5\u6076\u610f\u4fee\u6539\u3001\u5220\u9664\u548c\u589e\u52a0\u6570\u636e\u5e93\u5185\u5bb9\u3002</p> <p>\u63d0\u793a:\u5728\u7f16\u5199SQL\u811a\u672c\u65f6\uff0c\u5c3d\u91cf\u4e0d\u8981\u81ea\u5df1\u62fc\u63a5SQL\u8bed\u53e5\u3002</p> <pre><code>sqlInject(\"xxx' or 1=1#\")\nsqlInject(\"xxx' union select * from user #\")\nsqlInject(\"xxx' and (select count(-) from user) &lt;10 #\")\n</code></pre> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u81ea\u884c\u62fc\u63a5SQL\u8bed\u53e5\u7684\u793a\u4f8b\u4e00\u7f16\u5199\u4e00\u4e2a\u6839\u636ename\u5b57\u6bb5\u67e5\u8be2user\u8868\u7684\u51fd\u6570\uff1a</p> <pre><code>func sqlInject(name string) {\nsqlStr := fmt.Sprintf(\"select uid, name, phone from user where name='%s'\", name)\nfmt.Printf(\"SQL:%s\\n\", sqlStr)\nret, err := db.Exec(sqlStr)\nif err != nil {\nfmt.Printf(\"update failed, err:%v\\n\", err)\nreturn\n}\nn, err := ret.RowsAffected() // \u64cd\u4f5c\u5f71\u54cd\u7684\u884c\u6570\nif err != nil {\nfmt.Printf(\"get RowsAffected failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"get success, affected rows:%d\\n\", n)\n}\n</code></pre> <p>SQL\u9632\u5fa1\u63aa\u65bd\uff1a</p> <ul> <li>\u7981\u6b62\u53d8\u91cf\u76f4\u63a5\u5199\u5165SQL\u8bed\u53e5\u3002</li> <li>\u7528\u6237\u5206\u7ea7\u7ba1\u7406\uff0c\u63a7\u5236\u7528\u6237\u6743\u9650\u3002</li> <li>\u68c0\u67e5\u7528\u6237\u8f93\u5165\uff0c\u8f6c\u6362\u6216\u8fc7\u6ee4\u5355\u5f15\u53f7\u3001\u53cc\u5f15\u53f7\u3001\u5192\u53f7\u7b49\u5b57\u7b26\u3002</li> <li>\u52a0\u5bc6\u6570\u636e\u5e93\u4fe1\u606f\u3002</li> </ul>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#4\u7efc\u5408demo","title":"4.\u7efc\u5408demo","text":"<pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nfunc main() {\n// \u5982\u679c\u5f53\u524d\u8def\u5f84\u6ca1\u6709MyDb.db\uff0c\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u521b\u5efa\ndataSourceName := \"root:123456@(127.0.0.1:3306)/test\"\ndb, _ := sql.Open(\"mysql\", dataSourceName)\n// \u901a\u8fc7\u7a0b\u5e8f\u6267\u884cSQL\u8bed\u53e5\u521b\u5efa\u6570\u636e\u8868\nsql_table := `CREATE TABLE IF NOT EXISTS userinfo (\n       id INT(11) PRIMARY KEY AUTO_INCREMENT,\n       username VARCHAR(64) NULL,\n       age INT(10) NULL,\n       created DATEtIME default CURRENT_TIMESTAMP\n        )ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;`\n// \u6267\u884cSQL\u8bed\u53e5\ndb.Exec(sql_table)\n// \u65b0\u589e\u6570\u636e\nstmt, _ := db.Prepare(\"INSERT INTO userinfo(username, age) values(?, ?)\")\n// \u4f20\u9012\u53c2\u6570\u5e76\u6267\u884cSQL\u8bed\u53e5\nres, _ := stmt.Exec(\"Tom\", \"18\")\n// \u8fd4\u56de\u65b0\u589e\u6570\u636e\u7684ID\nid, _ := res.LastInsertId()\nfmt.Printf(\"\u65b0\u589e\u6570\u636e\u7684ID\uff1a%v\\n\", id)\n// \u6279\u91cf\u65b0\u589e\u6570\u636e\nUserList := [][]interface{}{{\"Lily\", 22}, {\"Jim\", 30}}\nfor _, i := range UserList {\n// \u65b0\u589e\u6570\u636e\nstmt, _ := db.Prepare(\"INSERT INTO userinfo(username, age) values(?, ?)\")\n// \u4f20\u9012\u53c2\u6570\u5e76\u6267\u884cSQL\u8bed\u53e5\nres, _ := stmt.Exec(i[0], i[1])\n// \u8fd4\u56de\u65b0\u589e\u6570\u636e\u7684ID\nid, _ := res.LastInsertId()\nfmt.Printf(\"\u6279\u91cf\u65b0\u589e\u6570\u636e\u7684ID\uff1a%v\\n\", id)\n}\n// \u66f4\u65b0\u6570\u636e\nstmt, _ = db.Prepare(\"update userinfo set username=? where id=?\")\n// \u4f20\u9012\u53c2\u6570\u5e76\u6267\u884cSQL\u8bed\u53e5\nres, _ = stmt.Exec(\"Tim\", 1)\n// \u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff0c\u8fd4\u56deint64\u7c7b\u578b\u6570\u636e\naffect, _ := res.RowsAffected()\nfmt.Printf(\"\u66f4\u65b0\u6570\u636e\u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff1a%v\\n\", affect)\n// \u6279\u91cf\u66f4\u65b0\u6570\u636e\nUserList1 := [][]interface{}{{\"Betty\", 3}, {\"Jon\", 4}}\nfor _, i := range UserList1 {\nstmt, _ := db.Prepare(\"update userinfo set username=? where id=?\")\n// \u4f20\u9012\u53c2\u6570\u5e76\u6267\u884cSQL\u8bed\u53e5\nres, _ := stmt.Exec(i[0], i[1])\n// \u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff0c\u8fd4\u56deint64\u7c7b\u578b\u6570\u636e\naffect, _ := res.RowsAffected()\nfmt.Printf(\"\u66f4\u65b0\u6570\u636e\u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff1a%v\\n\", affect)\n}\n// \u5220\u9664\u6570\u636e\nstmt, _ = db.Prepare(\"delete from userinfo where id=?\")\n// \u5c06\u60f3\u5220\u9664\u7684id\u8f93\u5165\u8fdb\u53bb\u5c31\u53ef\u4ee5\u5220\u9664\u8f93\u5165\u7684id\nres, _ = stmt.Exec(1)\n// \u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff0c\u8fd4\u56deint64\u7c7b\u578b\u6570\u636e\naffect, _ = res.RowsAffected()\nfmt.Printf(\"\u5220\u9664\u6570\u636e\u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff1a%v\\n\", affect)\n// \u6279\u91cf\u5220\u9664\u6570\u636e\nIDList := []int{3, 4}\nfor _, i := range IDList {\n// \u901a\u8fc7\u5faa\u73af\u5220\u9664\u591a\u6761\u6570\u636e\uff0c\u6bcf\u6b21\u5faa\u73af\u5220\u9664\u4e00\u6761\u6570\u636e\nstmt, _ := db.Prepare(\"delete from userinfo where id=?\")\nres, _ := stmt.Exec(i)\n// \u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff0c\u8fd4\u56deint64\u7c7b\u578b\u6570\u636e\naffect, _ := res.RowsAffected()\nfmt.Printf(\"\u6279\u91cf\u5220\u9664\u6570\u636e\u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff1a%v\\n\", affect)\n}\n// \u67e5\u8be2\u6570\u636e\nrows, _ := db.Query(\"SELECT * FROM userinfo where id=?\", 2)\n// \u904d\u5386\u6240\u6709\u67e5\u8be2\u7ed3\u679c\nvar ids, age int\nvar un, ct string\nfor rows.Next() {\nrows.Scan(&amp;ids, &amp;un, &amp;age, &amp;ct)\nfmt.Printf(\"\u5f53\u524d\u6570\u636e\uff1a%v,%v,%v,%v\\n\", ids, un, age, ct)\n}\n// \u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\ndb.Close()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/12.Go%E6%93%8D%E4%BD%9CMySQL/#5\u53c2\u8003\u6587\u732e","title":"5.\u53c2\u8003\u6587\u732e","text":"<p>Go\u8bed\u8a00\u64cd\u4f5cMysql</p> <p>go \u64cd\u4f5c\u6570\u636e\u5e93-MYSQL</p> <p>go\u64cd\u4f5cmysql</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/","title":"Go\u64cd\u4f5cRedis","text":"<p>Rdis\u662f\u4e00\u4e2a\u5f00\u6e90\u3001\u4f7f\u7528ANSI C\u8bed\u8a00\u7f16\u5199\u3001\u9075\u5b88BSD\u534f\u8bae\u3001\u652f\u6301\u7f51\u7edc\u3001\u53ef\u57fa\u4e8e\u5185\u5b58\u4ea6\u53ef\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578b\u3001Key-Value\u578b\u6570\u636e\u5e93\uff0c\u5e76\u63d0\u4f9b\u591a\u79cd\u8bed\u8a00\u7684API\u3002</p> <p>\u5b83\u901a\u5e38\u88ab\u79f0\u4e3a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u5176\u4e2d\u7684\u503c(Value)\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32(String)\u3001\u54c8\u5e0c(Hash)\u3001\u5217\u8868(List)\u3001\u96c6\u5408\uff08Set)\u548c\u6709\u5e8f\u96c6\u5408\uff08Sorted Set)\u7b49\u7c7b\u578b\u3002\u3001</p> <p>Redis\u53ef\u7528\u4e8e\u7f13\u5b58\u3001\u4e8b\u4ef6\u53d1\u5e03\u6216\u8ba2\u9605\u3001\u9ad8\u901f\u961f\u5217\u7b49\u573a\u666f\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#1redis\u7684\u5b89\u88c5","title":"1.Redis\u7684\u5b89\u88c5","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#11-windows\u5b89\u88c5","title":"1.1 windows\u5b89\u88c5","text":"<p>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://github.com/tporadowski/redis/releases</p> <pre><code>// \u670d\u52a1\u7aef\u8fd0\u884c\nredis-server.exe redis.windows.conf\n\n// \u5ba2\u6237\u7aef\u8fde\u63a5\nredis-cli.exe -h 127.0.0.1 -p 6379\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#12-linux\u5b89\u88c5","title":"1.2 Linux\u5b89\u88c5","text":"<p>(1)\u6253\u5f00\u547d\u4ee4\u884c\u7ec8\u7aef\uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u4e0b\u8f7d\u3001\u63d0\u53d6\u548c\u7f16\u8bd1Redis:  <pre><code>wget https://download.redis.io/releases/redis-6.0.9.tar.gz tar xzf redis-6.0.9.tar.gz cd redis-6.0.9 make\n</code></pre></p> <p>\u7f16\u8bd1\u597d\u540e\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u53ef\u4ee5\u5728src\u76ee\u5f55\u4e0b\u627e\u5230\u3002</p> <p>(2)\u8fd0\u884csrc/redis-server\u5373\u53ef\u8fd0\u884cRedis: </p> <pre><code>src/redis-server\n</code></pre> <p>(3)\u8fd0\u884cRedis\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u5185\u7f6e\u5ba2\u6237\u7aef\u4e0eRedis\u4ea4\u4e92\uff1a  <pre><code>src/redis-cli redis&gt;set foo abc OK redis&gt;get foo\"abc\"\n</code></pre></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#13-docker\u5b89\u88c5","title":"1.3 Docker\u5b89\u88c5","text":"<p>Dockerfile</p> <pre><code>FROM redis\nCOPY redis.conf /usr/local/etc/redis/redis.conf\nCMD [ \"redis-server\", \"/usr/local/etc/redis/redis.conf\" ]\n</code></pre> <p>docker-compose.yaml</p> <pre><code>version: '3'\nservices:\nredis:\nimage: redis\ncontainer_name: redis\nhostname: redisServer\nnetwork_mode: bridge\nrestart: on-failure\nmem_limit: 512m\nports:\n- \"6379:6379\"\n</code></pre> <pre><code>docker-compose up -d\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#2redis\u57fa\u7840\u5165\u95e8","title":"2.Redis\u57fa\u7840\u5165\u95e8","text":"<p>\u7ba1\u7406Redis\u6570\u636e\u5e93\u65e2\u53ef\u4ee5\u7528Redis Desktop Manager\u7b49\u53ef\u89c6\u5316\u7ba1\u7406\u5de5\u5177\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u547d\u4ee4\u884c\u3002</p> <p>\u63a5\u4e0b\u6765\u6839\u636e\u4e0d\u540c\u7684\u6570\u636e\u7ed3\u6784\u6765\u4ecb\u7ecdRedis\u7684\u5e38\u7528\u547d\u4ee4\u884c\u64cd\u4f5c\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#1\u5b57\u7b26\u4e32string","title":"1.\u5b57\u7b26\u4e32(String)","text":"<p>Key\u548cValue\u7ec4\u6210\u3002\u7c7b\u6bd4\u7f16\u7a0b\u8bed\u8a00\u7684\u53d8\u91cf\u3002</p> <ol> <li>\u67e5\u8be2\u6240\u6709key\u7684\u547d\u4ee4\u5982\u4e0b</li> </ol> <pre><code>keys *              //\u67e5\u770b\u6240\u6709key\n</code></pre> <ol> <li> <p>\u521b\u5efa\u5b57\u7b26\u4e32\u7684\u547d\u4ee4\u5982\u4e0b <pre><code># set key value      \nset abc \" a b c\"\n</code></pre></p> </li> <li> <p>\u8bfb\u53d6\u5b57\u7b26\u4e32\u7684\u547d\u4ee4\u5982\u4e0b <pre><code># \u8bfb\u53d6key\uff0c\u4e0d\u5b58\u5728\u8fd4\u56denil\n# get key\n</code></pre></p> </li> <li> <p>\u4fee\u6539key\u4e2d\u7684\u503c</p> </li> </ol> <pre><code># \u4e0d\u5b58\u5728\u521b\u5efa\uff0c\u5b58\u5728\u5219\u4fee\u6539\nset key new_value\n\n# \u5047\u5982\u4e0d\u5e0c\u671bset\u547d\u4ee4\u8986\u76d6\u65e7\u503c\u600e\u4e48\u529e\uff1f\u4f7f\u7528\u201cNX\u201d\u53c2\u6570\u5373\u53ef\u3002\u8fd9\u6837\uff0c\u5f53Key\u5b58\u5728\u65f6\uff0c\u4f7f\u7528\u201cset key value NX\u201d\u5c31\u4e0d\u80fd\u8986\u76d6\u539f\u6765\u7684\u503c\u3002\n# \u4e0d\u5b58\u5728\u521b\u5efa\uff0c\u5b58\u5728\u5219\u8fd4\u56denil\nset key value NX    </code></pre> <pre><code># \u5982\u679c\u60f3\u5728Value\u7684\u672b\u5c3e\u52a0\u4e0a\u4e00\u4e9b\u5b57\u7b26\u4e32\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528append\u547d\u4ee4\uff08\u5982\u679cKey\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efaKey)\u3002\u5f53\u7136\uff0c\u5982\u679c\u503c\u6709\u7a7a\u683c\uff0c\u5219\u548cset\u7684\u5904\u7406\u65b9\u6cd5\u4e00\u6837\uff1a\nappend key value    # key\u5bf9\u5e94string\u975e\u6570\u5b57\uff0c\u62a5\u9519\n# \u6570\u5b57value+1\nincr key\n\n# \u6570\u5b57value-1\ndecr key\n\n# \u6570\u5b57value+n\nincrby key n\n\n# \u6570\u5b57value-n\ndecrby key n\n\n# \u5220\u9664\uff0c\u5b58\u5728\u8fd4\u56de1\uff0c\u4e0d\u5b58\u5728\u8fd4\u56de0\ndel key\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#2\u54c8\u5e0chash","title":"2.\u54c8\u5e0c(Hash)","text":"<p>Redis\u4e2d\u54c8\u5e0c\uff08(Hash)\u662f\u4e00\u4e2astring\u7c7b\u578b\u7684field(\u5b57\u6bb5)\u548cvalue(\u503c)\u7684\u6620\u5c04\u8868\uff0c\u7279\u522b\u9002\u5408\u7528\u4e8e\u5b58\u50a8\u5bf9\u8c61\u3002</p> <p>Redis\u4e2d\u6bcf\u4e2a\u54c8\u5e0c\u8868\u53ef\u4ee5\u5b58\u50a822-1\u4e2a\u952e\u503c\u5bf9.\u4f7f\u7528\u54c8\u5e0c\u8868\u4e0d\u4ec5\u80fd\u591f\u51cf\u5c11Redis\u4e2dKy\u7684\u4e2a\u6570\uff0c\u8fd8\u80fd\u4f18\u5316\u5b58\u50a8\u7a7a\u95f4\uff0c\u5360\u7528\u7684\u5185\u5b58\u8981\u6bd4\u5b57\u7b26\u4e32\u5c11\u5f88\u591a\u3002</p> <p>\u7c7b\u6bd4\u7ed3\u6784\u4f53\u3002</p> <pre><code># \u6dfb\u52a01\u4e2a\u952e\u503c\u5bf9\nhset key field value\n\n# \u6dfb\u52a0\u591a\u4e2a\u952e\u503c\u5bf9\nhmset key field1 value1 [field2 value2]\n# \u5df2\u5b58\u5728\u5b57\u6bb5\u5219\u4e0d\u4fee\u6539\nhsetnx key field value\n\n# \u83b7\u5f971\u4e2a\u5b57\u6bb5\u503c\nhget key field\n\n# \u83b7\u5f97\u591a\u4e2a\u5b57\u6bb5\u503c\nhmget key field1 [field2]   # \u83b7\u5f97\u6240\u6709\u5b57\u6bb5\u540d\u548c\u503c\nhgetall key\n\n# \u5b57\u6bb5\u5b58\u5728\u8fd4\u56de1\uff0c\u4e0d\u5b58\u5728\u8fd4\u56de0\nHEXISTS key field\n\n# \u83b7\u5f97\u5b57\u6bb5\u6570\u91cf\nhlen key\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#3\u5217\u8868list","title":"3.\u5217\u8868(List)","text":"<p>\u5217\u8868\u662f\u4e00\u79cd\u5f88\u72ec\u7279\u7684\u7ed3\u6784\u3002\u53ef\u4ee5\u628a\u5217\u8868\u60f3\u50cf\u6210\u4e00\u6839\u6c34\u7ba1\uff0c\u6570\u636e\u4ece\u4e00\u8fb9\u8fdb\u53bb\uff0c\u7136\u540e\u4ece\u53e6\u5916\u4e00\u8fb9\u51fa\u6765\u3002</p> <p>\u90a3\u4e48\u8fd9\u79cd\u7ed3\u6784\u6709\u4ec0\u4e48\u7528\u5904\u5462\uff1f\u4ee5\u53d1\u6d88\u606f\u4e3a\u4f8b\u3002\u53d1\u6d88\u606f\u9700\u8981\u4fdd\u8bc1\u6d88\u606f\u5230\u8fbe\u7684\u987a\u5e8f\uff0c\u90a3\u662f\u4e0d\u662f\u5c31\u53ef\u4ee5\u4f7f\u7528\u5217\u8868\u5462\uff1f</p> <p>\u4f8b\u5982\uff1a\u53d1\u9001\u6d88\u606f\u4ece\u5de6\u8fb9\u8fdb\uff0c\u63a5\u53d7\u6d88\u606f\u4ece\u53f3\u8fb9\u5f97\u5230\u3002</p> <p>\u7c7b\u6bd4\u7ba1\u9053\u3002</p> <pre><code># \u5de6\u8fb9\u63d2\u5165\u503c\nlpush key value\n\n# \u53f3\u8fb9\u63d2\u5165\u503c\nrpush key value\n\n# \u83b7\u5f97\u5217\u8868\u957f\u5ea6\nllen key\n\n# 0\u6700\u5de6\u8fb9\u6570\u636e\uff0c-1\u6700\u53f3\u8fb9\u6570\u636e\nlrange key \u5f00\u59cb\u7d22\u5f15 \u7ed3\u675f\u7d22\u5f15\n\n# \u5f39\u51fa\u6700\u5de6\u8fb9\u6570\u636e\nlpop key\n\n# \u5f39\u51fa\u6700\u53f3\u8fb9\u6570\u636e\nrpop key\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#4\u96c6\u5408set","title":"4.\u96c6\u5408(Set)","text":"<p>Rdis\u4e2d\u7684\u96c6\u5408\u548c\u6570\u5b66\u4e2d\u7684\u96c6\u5408\u6709\u70b9\u7c7b\u4f3c\uff1a\u6570\u636e\u662f\u65e0\u5e8f\u7684\uff0c\u4e0d\u80fd\u91cd\u590d\u3002</p> <pre><code># \u6dfb\u52a0set\u5143\u7d20\nsadd key value1 value2 ***\n\n# \u8fd4\u56de\u96c6\u5408\u4e2d\u5143\u7d20\u6570\u91cf\nscard key\n\n# \u8fd4\u56de\u96c6\u5408\u4e2d\u6240\u6709\u5143\u7d20\nsmembers key\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#5\u6709\u5e8f\u96c6\u5408sorted-sets","title":"5.\u6709\u5e8f\u96c6\u5408(Sorted Sets)","text":"<p>\u6709\u5e8f\u96c6\u5408\uff08Sorted Sets),\u987e\u540d\u601d\u4e49\u5c31\u662f\u96c6\u5408\u4e2d\u7684\u6570\u636e\u662f\u6709\u5e8f\u7684\u3002\u90a3\u4e48\u5b83\u6709\u4ec0\u4e48\u542b\u4e49\u5462\uff1f</p> <p>\u5728\u4e00\u4e2a\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e2d\uff0c\u6570\u636e\u662f\u4e00\u76f4\u66f4\u65b0\u7684\u3002\u5c06\u6570\u636e\u5b58\u50a8\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u5982\u679c\u9700\u8981\u5b9e\u65f6\u83b7\u53d6\u6392\u540d\uff0c\u5219\u80af\u5b9a\u4f1a\u5bf9\u6570\u636e\u7684\u6027\u80fd\u9020\u6210\u5f88\u5927\u7684\u5f71\u54cd\u3002</p> <p>\u6bd5\u7adf\u6570\u636e\u91cf\u8d8a\u5927\uff0c\u6392\u5e8f\u65f6\u95f4\u4e5f\u5c31\u8d8a\u7f13\u6162\u3002 \u548c\u96c6\u5408\u4e0d\u540c\u7684\u662f\uff0c\u6709\u5e8f\u96c6\u5408\u7684\u5143\u7d20\u4f1a\u5173\u8054\u4e00\u4e2adouble\u7c7b\u578b\u7684\u5206\u6570\uff0c\u5176\u4e2d\u5143\u7d20\u4e0d\u80fd\u91cd\u590d\uff0c\u4f46\u662f\u5206\u6570\u53ef\u4ee5\u91cd\u590d\u3002</p> <pre><code># \u6dfb\u52a0\u6570\u636e\nzadd key score1 member1 [score2 member2]\n# \u4e0d\u5b58\u5728\u5219\u4fee\u6539\u6570\u636e\uff0c\u5b58\u5728\u5219\u4e0d\u4fee\u6539\nzadd key NX score member\n\n# \u6309\u5206\u6570\u503c\u9012\u589e\u83b7\u53d6\u5206\u6570\u533a\u95f4[min max]\u7684\u6570\u636e\nzrangebyscore key min max [WITHSCORES] [LIMIT offset count]\n# \u6307\u5b9a\u6210\u5458\u6392\u540d\uff0c\u5206\u6570\u9012\u589e\nzrank key member\n\n# \u83b7\u53d6\u6210\u5458\u5206\u6570\uff0c\u4e0d\u662f\u6210\u5458\u6216key\u4e0d\u5b58\u5728\u8fd4\u56denil\nzscore key member\n\n# \u83b7\u53d6\u6307\u5b9a\u5206\u6570\u533a\u95f4\uff0c\u6210\u5458\u4e2a\u6570\nzcount key min max\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#3go\u8bbf\u95eeredis\u4f7f\u7528redigo\u5305","title":"3.Go\u8bbf\u95eeRedis\u4f7f\u7528redigo\u5305","text":"<p>\u5728Redis\u5b98\u65b9\u7f51\u7ad9(https://redis.io/clients#go)\u80fd\u770b\u5230Go\u8bed\u8a00\u8bfb\u5199Redis\u7684\u7b2c\u4e09\u65b9\u5305\uff0c\u5176\u4e2dgo-redis\u548credigo\u662f\u76ee\u524d\u6700\u5e38\u7528\u7684\u7b2c\u4e09\u65b9\u5305\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#31-redis\u8fde\u63a5","title":"3.1 Redis\u8fde\u63a5","text":"<p>Go\u8bed\u8a00\u5b98\u65b9\u5e76\u6ca1\u6709\u63d0\u4f9bRedis\u8bbf\u95ee\u5305\u3002</p> <p>\u5728Redis\u5b98\u7f51\u4e0a\u6709\u5f88\u591aGo\u8bed\u8a00\u7684\u5ba2\u6237\u7aef\u5305\uff0c\u5b83\u4eec\u90fd\u80fd\u5b9e\u73b0\u5bf9Redis\u7684\u8bbf\u95ee\u548c\u64cd\u4f5c\u3002</p> <p>\u4f5c\u8005\u4f7f\u7528\u540e\u611f\u89c9\uff0c\u76f8\u5bf9\u6765\u8bf4Redigo\u4f7f\u7528\u8d77\u6765\u66f4\u4eba\u6027\u5316\u3002</p> <p>\u91cd\u8981\u7684\u662f\uff0c\u5176\u6e90\u4ee3\u7801\u7ed3\u6784\u5f88\u6e05\u6670\uff0c\u800c\u4e14\u5176\u652f\u6301\u7ba1\u9053\u3001\u53d1\u5e03\u548c\u8ba2\u9605\u3001\u8fde\u63a5\u6c60\u7b49\u3002</p> <p>\u6240\u4ee5\u672c\u8282\u9009\u62e9Redigo\u4f5c\u4e3a\u793a\u4f8b\u8bb2\u89e3\u3002</p> <p>\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6\u9879\u76ee\u5305\uff0c\u7136\u540e\u5c06\u9879\u76ee\u5305\u5bfc\u5165\u9879\u76ee\u3002</p> <pre><code>go get github.com/gomodule/redigo/redis\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nfunc main() {\nconn, err := redis.Dial(\"tcp\", \"localhost:6379\")\nif err != nil {\nfmt.Println(\"conn redis failed, err:\", err)\nreturn\n}\ndefer conn.Close()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#32-redis\u8bbe\u7f6e\u548c\u83b7\u53d6\u5b57\u7b26\u4e32","title":"3.2 Redis\u8bbe\u7f6e\u548c\u83b7\u53d6\u5b57\u7b26\u4e32","text":"<p>Redigo\u5ba2\u6237\u7aef\u5305\u4e2d\u6700\u5e38\u7528\u7684\u662fDo()\u65b9\u6cd5\uff0c\u5b83\u53ef\u4ee5\u76f4\u63a5\u652f\u6301Redis\u7684Set\u3001Get\u3001MSet\u3001MGet\u3001 HSet\u3001HGet\u7b49\u5e38\u7528\u547d\u4ee4\u3002</p> <p>\u4e0b\u9762\u793a\u4f8b\u4ee3\u7801\u662f\u901a\u8fc7\u8c03\u7528DoO\u65b9\u6cd5\u6765\u8bbe\u7f6e\u5b57\u7b26\u4e32\uff1a <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nfunc main() {\nconn, err := redis.Dial(\"tcp\", \"localhost:6379\")\nif err != nil {\nfmt.Println(\"conn redis failed, err:\", err)\nreturn\n}\ndefer conn.Close()\nres, err := conn.Do(\"Set\", \"username\", \"jack\")\nif err != nil {\nfmt.Println(err)\nreturn\n}\nfmt.Println(res) //OK\n// \u5728Redfisgo\u5ba2\u6237\u7aef\u5305\u4e2d\uff0c\u901a\u8fc7\u8c03\u7528redis.String()\u51fd\u6570\u6765\u83b7\u53d6\u5b57\u7b26\u4e32\nres, err = redis.String(conn.Do(\"Get\", \"username\"))\nif err != nil {\nfmt.Println(err)\nreturn\n}\nfmt.Println(res) //jack\n}\n</code></pre></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#33-redis\u6279\u91cf\u8bbe\u7f6e\u548c\u83b7\u53d6\u5b57\u7b26\u4e32","title":"3.3 Redis\u6279\u91cf\u8bbe\u7f6e\u548c\u83b7\u53d6\u5b57\u7b26\u4e32","text":"<p>\u5728Redigo\u5ba2\u6237\u7aef\u5305\u4e2d\uff0c\u53ef\u4ee5\u7528Do()\u65b9\u6cd5\u6765\u8bbe\u7f6e\u6279\u91cf\u8bbe\u7f6e\u5b57\u7b26\u4e32\u548c\u83b7\u53d6\u5b57\u7b26\u4e32\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nfunc main() {\nconn, err := redis.Dial(\"tcp\", \"localhost:6379\")\nif err != nil {\nfmt.Println(\"conn redis failed, err:\", err)\nreturn\n}\ndefer conn.Close()\nres, err := conn.Do(\"MSet\", \"username\", \"jack\", \"phone\", \"123456789\")\nif err != nil {\nfmt.Println(err)\nreturn\n}\nfmt.Println(res) //OK\nres2, err := redis.Strings(conn.Do(\"MGet\", \"username\", \"phone\"))\nif err != nil {\nfmt.Println(err)\nreturn\n}\nfmt.Printf(\"%T\\n\", res2) //[]string\nfmt.Println(res2)        //[jack 123456789]\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#34-redis-hash\u64cd\u4f5c","title":"3.4 Redis hash\u64cd\u4f5c","text":"<p>\u5728Redigo\u5ba2\u6237\u7aef\u5305\u4e2d\uff0c\u53ef\u4ee5\u7528Do()\u65b9\u6cd5\u6765\u8bbe\u7f6e\u548c\u83b7\u53d6hash\u7c7b\u578b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nfunc main() {\nconn, err := redis.Dial(\"tcp\", \"localhost:6379\")\nif err != nil {\nfmt.Println(\"conn redis failed, err:\", err)\nreturn\n}\ndefer conn.Close()\nres, err := conn.Do(\"HSet\", \"names\", \"jim\", \"barry\")\nif err != nil {\nfmt.Println(err)\nreturn\n}\nfmt.Println(res)\nres2, err := conn.Do(\"HGet\", \"names\", \"jim\")\n//res2, err := redis.Strings(conn.Do(\"HGet\", \"names\", \"jim\"))\nif err != nil {\nfmt.Println(\"hget error: \", err)\nreturn\n}\nfmt.Printf(\"%T\\n\", res2)\nfmt.Println(res2)\nfmt.Println(string(res2.([]uint8)))\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#35-\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4","title":"3.5 \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4","text":"<p>\u5728Redigo\u5ba2\u6237\u7aef\u5305\u4e2d\uff0c\u53ef\u4ee5\u7528Do()\u65b9\u6cd5\u6765\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002</p> <pre><code>    res, err := conn.Do(\"expire\", \"names\", 10)\nif err != nil {\nfmt.Println(\"expire error: \", err)\nreturn\n}\nfmt.Println(res)\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#36-redis\u961f\u5217","title":"3.6 Redis\u961f\u5217","text":"<p>\u5728Redigo\u5ba2\u6237\u7aef\u5305\u4e2d\uff0c\u53ef\u4ee5\u7528Do()\u65b9\u6cd5\u6765\u8bbe\u7f6e\u961f\u5217\u7684\u793a\u4f8b\u4ee3\u7801\u3002 <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nfunc main() {\nconn, err := redis.Dial(\"tcp\", \"localhost:6379\")\nif err != nil {\nfmt.Println(\"conn redis failed, err:\", err)\nreturn\n}\ndefer conn.Close()\nres, err := conn.Do(\"lpush\", \"Queue\", \"jim\", \"barry\", 9)\nif err != nil {\nfmt.Println(\"lpush error: \", err)\nreturn\n}\nfmt.Println(res)\nfor {\nr, err := redis.String(conn.Do(\"lpop\", \"Queue\"))\nif err != nil {\nfmt.Println(\"lpop error: \", err)\nbreak\n}\nfmt.Println(r)\n}\nres4, err := redis.Int(conn.Do(\"llen\", \"Queue\"))\nif err != nil {\nfmt.Println(\"llen error: \", err)\nreturn\n}\nfmt.Println(res4)\n}\n</code></pre></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#37-redis\u8fde\u63a5\u6c60","title":"3.7 Redis\u8fde\u63a5\u6c60","text":"<p>\u4e3a\u4ec0\u4e48\u4f7f\u7528\u8fde\u63a5\u6c60\uff1fRedis\u4e5f\u662f\u4e00\u79cd\u6570\u636e\u5e93\uff0c\u5b83\u57fa\u4e8eC/S\u6a21\u5f0f\uff0c\u56e0\u6b64\u5982\u679c\u9700\u8981\u4f7f\u7528\uff0c\u5219\u5fc5\u987b\u5148\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>C/S\u6a21\u5f0f\u5c31\u662f\u4e00\u79cd\u8fdc\u7a0b\u901a\u4fe1\u7684\u4ea4\u4e92\u6a21\u5f0f\uff0c\u56e0\u6b64Redis\u670d\u52a1\u5668\u53ef\u4ee5\u5355\u72ec\u4f5c\u4e3a\u4e00\u4e2a\u6570\u636e\u5e93\u670d\u52a1\u5668\u72ec\u7acb\u5b58\u5728\u3002</p> <p>\u5047\u8bbeRedis\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u5206\u5904\u5f02\u5730\uff0c\u867d\u7136\u57fa\u4e8e\u5185\u5b58\u7684Redis\u6570\u636e\u5e93\u6709\u7740\u8d85\u9ad8\u7684\u6027\u80fd\uff0c\u4f46\u662f\u5e95\u5c42\u7684\u7f51\u7edc\u901a\u4fe1\u5374\u5360\u7528\u4e86\u4e00\u6b21\u6570\u636e\u8bf7\u6c42\u7684\u5927\u91cf\u65f6\u95f4\u3002</p> <p>\u56e0\u4e3a\uff0c\u6bcf\u6b21\u6570\u636e\u4ea4\u4e92\u90fd\u9700\u8981\u5148\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u5047\u8bbe\u4e00\u6b21\u6570\u636e\u4ea4\u4e92\u603b\u5171\u7528\u65f630ms,\u8d85\u9ad8\u6027\u80fd\u7684Redis\u6570\u636e\u5e93\u5904\u7406\u6570\u636e\u6240\u82b1\u7684\u65f6\u95f4\u53ef\u80fd\u4e0d\u52301ms,\u4e5f\u5c31\u662f\u8bf4\u524d\u671f\u7684\u8fde\u63a5\u5360\u7528\u4e8629ms\u3002</p> <p>\u8fde\u63a5\u6c60\u5219\u53ef\u4ee5\u5b9e\u73b0\u5728\u5ba2\u6237\u7aef\u5efa\u7acb\u591a\u4e2a\u4e0e\u670d\u52a1\u5668\u7684\u8fde\u63a5\u5e76\u4e14\u4e0d\u91ca\u653e\u3002</p> <p>\u5f53\u9700\u8981\u4f7f\u7528\u8fde\u63a5\u65f6\uff0c\u901a\u8fc7\u4e00\u5b9a\u7684\u7b97\u6cd5\u83b7\u53d6\u5df2\u7ecf\u5efa\u7acb\u7684\u8fde\u63a5\uff0c\u4f7f\u7528\u5b8c\u540e\u5219\u8fd8\u7ed9\u8fde\u63a5\u6c60\uff0c\u8fd9\u5c31\u514d\u53bb\u4e86\u8fde\u63a5\u670d\u52a1\u5668\u6240\u5360\u7528\u7684\u65f6\u95f4\u3002 </p> <p>\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\u8017\u65f6\uff0c\u8fde\u63a5\u6c60\u5b9e\u73b0\u591a\u4e2a\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u8fde\u63a5\u4e14\u4e0d\u91ca\u653e\uff0c\u9700\u8981\u65f6\u83b7\u53d6\u5df2\u5efa\u7acb\u7684\u8fde\u63a5\uff0c\u4f7f\u7528\u5b8c\u540e\u8fd8\u7ed9\u8fde\u63a5\u6c60\u3002</p> <p>Redigo\u5ba2\u6237\u7aef\u5305\u4e2d\u901a\u8fc7Pool\u5bf9\u8c61\u6765\u5efa\u7acb\u8fde\u63a5\u6c60\uff0c\u5176\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\u3002 <pre><code>    pool = &amp;redis.Pool{\nMaxIdle:     16,    //\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\nMaxActive:   1024,  //\u6700\u5927\u6fc0\u6d3b\u8fde\u63a5\u6570\nIdleTimeout: 300,   //\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u7b49\u5f85\u65f6\u95f4\nDial: func() (redis.Conn, error) {\nreturn redis.Dial(\"tcp\", \"localhost:6379\")\n},\n}\n</code></pre></p> <p>\u7528\u8fde\u63a5\u6c60Do()\u65b9\u6cd5\u6765\u8bbe\u7f6e\u548c\u83b7\u53d6\u5b57\u7b26\u4e32\u4ee3\u7801\u793a\u4f8b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nvar pool *redis.Pool\nfunc init() {\npool = &amp;redis.Pool{\nMaxIdle:     16,    //\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\nMaxActive:   1024,  //\u6700\u5927\u6fc0\u6d3b\u8fde\u63a5\u6570\nIdleTimeout: 300,   //\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u7b49\u5f85\u65f6\u95f4\nDial: func() (redis.Conn, error) {\nreturn redis.Dial(\"tcp\", \"localhost:6379\")\n},\n}\n}\nfunc main() {\nc := pool.Get()\ndefer c.Close()\n// \u8c03\u7528Do()\u65b9\u6cd5\u6765\u8bbe\u7f6e\u548c\u83b7\u53d6\u5b57\u7b26\u4e32\u3002\n_, err := c.Do(\"Set\", \"username\", \"jack\")\nif err != nil {\nfmt.Println(err)\nreturn\n}\nr, err := redis.String(c.Do(\"Get\", \"username\"))\nif err != nil {\nfmt.Println(err)\nreturn\n}\nfmt.Println(r)\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#38-redis\u5b9e\u73b0\u7ba1\u9053\u64cd\u4f5c","title":"3.8 Redis\u5b9e\u73b0\u7ba1\u9053\u64cd\u4f5c","text":"<p>\u8bf7\u6c42/\u54cd\u5e94\u670d\u52a1\u53ef\u4ee5\u5b9e\u73b0\u6301\u7eed\u5904\u7406\u65b0\u8bf7\u6c42\u3002\u5ba2\u6237\u7aef\u53ef\u4ee5\u53d1\u9001\u591a\u4e2a\u547d\u4ee4\u5230\u670d\u52a1\u5668\u7aef\u800c\u65e0\u987b\u7b49\u5f85\u54cd\u5e94\uff0c\u6700\u540e\u518d\u4e00\u6b21\u6027\u8bfb\u53d6\u591a\u4e2a\u54cd\u5e94\u3002</p> <p>Send()\u3001Flush()\u3001Receive()\u65b9\u6cd5\u652f\u6301\u7ba1\u9053\u5316\u64cd\u4f5c\u3002</p> <ul> <li>Send)\u65b9\u6cd5\u7528\u4e8e\u5411\u8fde\u63a5\u7684\u8f93\u51fa\u7f13\u51b2\u4e2d\u5199\u5165\u547d\u4ee4\u3002</li> <li>Fush()\u65b9\u6cd5\u7528\u4e8e\u5c06\u8fde\u63a5\u7684\u8f93\u51fa\u7f13\u51b2\u6e05\u7a7a\u5e76\u5199\u5165\u670d\u52a1\u5668\u7aef\u3002</li> <li>Recevie()\u65b9\u6cd5\u7528\u4e8e\u6309\u7167FIFO\u987a\u5e8f\u4f9d\u6b21\u8bfb\u53d6\u670d\u52a1\u5668\u7aef\u7684\u54cd\u5e94\u3002</li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nfunc main() {\nc, err := redis.Dial(\"tcp\", \"localhost:6379\")\nif err != nil {\nfmt.Println(\"conn redis failed, err:\", err)\nreturn\n}\ndefer c.Close()\nc.Send(\"SET\", \"username1\", \"jim\") //\u8f93\u51fa\u7f13\u51b2\u533a\u5199\u5165\u547d\u4ee4\nc.Send(\"SET\", \"username2\", \"jack\")\nc.Flush() //\u6e05\u7a7a\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u5e76\u5199\u5165\u670d\u52a1\u5668\u7aef\nv, err := c.Receive() //FIFO\u987a\u5e8f\u8bfb\u53d6\u670d\u52a1\u5668\u7aef\u54cd\u5e94\nfmt.Printf(\"v:%v,err:%v\\n\", v, err)\nv, err = c.Receive()\nfmt.Printf(\"v:%v,err:%v\\n\", v, err)\nv, err = c.Receive() // \u4e00\u76f4\u7b49\u5f85\nfmt.Printf(\"v:%v,err:%v\\n\", v, err)\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#39-redis\u7684\u5e76\u53d1","title":"3.9 Redis\u7684\u5e76\u53d1","text":"<p>\u5728\u65e5\u5e38\u5f00\u53d1\u4e2d\uff0c\u6709\u65f6\u4f1a\u9047\u5230\u8fd9\u6837\u7684\u573a\u666f\uff1a</p> <p>\u591a\u4e2a\u4eba\u540c\u65f6\u5bf9\u540c\u4e00\u4e2a\u6570\u636e\u8fdb\u884c\u4fee\u6539\uff0c\u5bfc\u81f4\u5e76\u53d1\u95ee\u9898\u53d1\u751f\u3002 \u4f7f\u7528Redis\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u662f\u5f88\u597d\u7684\u9009\u62e9\u3002 </p> <p>Redis\u7ba1\u9053\u4f7f\u5f97\u5ba2\u6237\u7aef\u80fd\u591f\u7528\u201c\u65e0\u7b49\u5f85\u54cd\u5e94\u201d\u7684\u65b9\u5f0f\uff0c\u6765\u8fde\u7eed\u53d1\u9001\u591a\u6761\u547d\u4ee4\u8bf7\u6c42\u81f3Redis\u670d\u52a1\u5668\u7aef\uff0c\u7136\u540e\u670d\u52a1\u5668\u7aef\u6309\u7167\u8bf7\u6c42\u987a\u5e8f\u8fd4\u56de\u76f8\u5e94\u7684\u7ed3\u679c\u3002</p> <p>\u7c7b\u4f3c\u4e8e\u5982\u4e0b\u5f62\u5f0f\uff1a</p> <pre><code>client&gt;set keyl valuel; client&gt;set key2 value2; client&gt;set key3 value3; server&gt;ok server&gt;ok server&gt;ok\n</code></pre> <p>Redis\u7ba1\u9053\uff08Pipelining)\u7684\u64cd\u4f5c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5e76\u53d1\u64cd\u4f5c\uff0c\u5e76\u901a\u8fc7Send()\u3001Flush()\u3001Receive()\u8fd93\u4e2a\u65b9\u6cd5\u5b9e\u73b0\u3002</p> <p>\u5ba2\u6237\u7aef\u53ef\u4ee5\u7528Sed()\u65b9\u6cd5\u4e00\u6b21\u6027\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2a\u6216\u591a\u4e2a\u547d\u4ee4\u3002</p> <p>\u547d\u4ee4\u53d1\u9001\u5b8c\u6bd5\u540e\uff0c\u7528Fush()\u65b9\u6cd5\u5c06\u7f13\u51b2\u533a\u7684\u547d\u4ee4\u4e00\u6b21\u6027\u53d1\u9001\u5230\u670d\u52a1\u5668\u7aef\uff0c\u5ba2\u6237\u7aef\u518d\u7528Receive()\u65b9\u6cd5\u4f9d\u6b21\u6309\u7167\u5148\u8fdb\u5148\u51fa\u7684\u987a\u5e8f\u8bfb\u53d6\u6240\u6709\u547d\u4ee4\u7684\u7ed3\u679c\u3002</p> <p>Redis\u5e76\u53d1\u7684\u793a\u4f8b\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nfunc main() {\nconn, err := redis.Dial(\"tcp\", \"localhost:6379\")\nif err != nil {\nfmt.Println(\"connect redis error :\", err)\nreturn\n}\ndefer conn.Close()\nconn.Send(\"HSET\", \"students\", \"name\", \"jim\", \"age\", \"19\")\nconn.Send(\"HSET\", \"students\", \"score\", \"100\")\nconn.Send(\"HGET\", \"students\", \"age\")\nconn.Flush()\nres1, err := conn.Receive()\nfmt.Printf(\"Receive res1:%v\\n\", res1)\nres2, err := conn.Receive()\nfmt.Printf(\"Receive res2:%v\\n\", res2)\nres3, err := conn.Receive()\nfmt.Printf(\"Receive res3:%s\\n\", res3)\n}\n</code></pre> <p>\u5728\u4ee3\u7801\u6240\u5728\u76ee\u5f55\u4e0b\u6253\u5f00\u547d\u4ee4\u884c\u7ec8\u7aef\uff0c\u8f93\u5165\u547d\u4ee4\uff0c\u8fd4\u56de\u5982\u4e0b\uff1a</p> <pre><code>$go run redis4.go Receive res1:&lt;nil&gt; Receive res2:1 Receive res3:%\uff01s(&lt;nil&gt;)\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#310-redis\u4e8b\u52a1","title":"3.10 Redis\u4e8b\u52a1","text":"<p>MULTI\u3001EXEC\u3001DISCARD\u548cVATCH\u65b9\u6cd5\u662f\u6784\u6210Redis\u4e8b\u52a1\u7684\u57fa\u7840,\u4f7f\u7528Go\u8bed\u8a00\u5bf9Redis\u8fdb\u884c\u4e8b\u52a1\u64cd\u4f5c\u7684\u672c\u8d28\u4e5f\u662f\u4f7f\u7528\u8fd9\u4e9b\u547d\u4ee4\u3002 </p> <ul> <li>MULTI:\u5f00\u542f\u4e8b\u52a1\uff1b </li> <li>EXEC:\u6267\u884c\u4e8b\u52a1\uff1b </li> <li>DISCARD:\u53d6\u6d88\u4e8b\u52a1\uff1b </li> <li>VATCH:\u76d1\u89c6\u4e8b\u52a1\u4e2d\u7684\u952e\u53d8\u5316\uff0c\u4e00\u65e6\u6709\u6539\u53d8\u5219\u53d6\u6d88\u4e8b\u52a1\u3002 </li> </ul> <p>Redis\u4e8b\u52a1\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/gomodule/redigo/redis\"\n)\nfunc main() {\nconn, err := redis.Dial(\"tcp\", \"localhost:6379\")\nif err != nil {\nfmt.Println(\"connect redis error :\", err)\nreturn\n}\ndefer conn.Close()\nconn.Send(\"MULTI\")\nconn.Send(\"INCR\", \"foo\")\nconn.Send(\"INCR\", \"bar\")\nr, err := conn.Do(\"EXEC\")\nif err != nil {\nconn.Send(\"DISCARD\")\n//conn.Do(\"DISCARD\")\n}\nfmt.Println(r) //[1 1]\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#4go\u8bbf\u95eeredis\u4f7f\u7528go-redis\u5305","title":"4.Go\u8bbf\u95eeRedis\u4f7f\u7528go-redis\u5305","text":"<p>\u6253\u5f00go-redis\u7684GitHub\u5730\u5740(https://github.com/go-redis/redis)\uff0c\u6309\u7167\u6587\u6863\u8bf4\u660e\u5728GoLand\u7684Terminal\u7a97\u53e3\u8f93\u5165\u5e76\u6267\u884c\u6307\u4ee4 <pre><code>go get github.com/go-redis/redis/v8\n</code></pre></p> <p>\u4f7f\u7528go-redis\u8bfb\u5199Redis\u5fc5\u987b\u4e86\u89e3Redis\u7684\u64cd\u4f5c\u6307\u4ee4\uff0c \u901a\u8fc7\u64cd\u4f5c\u6307\u4ee4\u627e\u5230\u5bf9\u5e94\u7ed3\u6784\u4f53\u65b9\u6cd5\uff0c\u6839\u636e\u7ed3\u6784\u4f53\u65b9\u6cd5\u7684\u5b9a\u4e49\u4e86\u89e3\u53c2\u6570\u7c7b\u578b\u4e0e\u4f5c\u7528\uff0c\u4ece\u800c\u5b8c\u6210Redis\u7684\u6570\u636e\u64cd\u4f5c\u3002</p> <pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"github.com/go-redis/redis/v8\"\n\"time\"\n)\nfunc main() {\nvar ctx = context.Background()\n// \u8fde\u63a5Redis\u6570\u636e\u5e93\nclient := redis.NewClient(&amp;redis.Options{\nAddr:     \"127.0.0.1:6379\",\nPassword: \"\", // no password set\nDB:       0,  // use default DB\n})\n// \u6d4b\u8bd5\u8fde\u63a5Redis\nping, _ := client.Ping(ctx).Result()\nfmt.Printf(\"\u6d4b\u8bd5\u8fde\u63a5Redis\uff1a%v\\n\", ping)\ndefer client.Close()\n// \u8bbe\u7f6e\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u636e\n// \u53c2\u6570ctx\u662f\u5185\u7f6e\u5305context\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\n// \u53c2\u6570key\u548cvalue\u662f\u952e\u503c\u5bf9\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\n// \u53c2\u6570expiration\u662f\u6709\u6548\u671f\uff0c\u6570\u636e\u7c7b\u578b\u4e3atime.Duration\nstrSet, _ := client.Set(ctx, \"name\", \"Tom\", time.Hour).Result()\nfmt.Printf(\"\u8bbe\u7f6e\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u636e\uff1a%v\\n\", strSet)\n// \u83b7\u53d6\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u636e\nstrGet, _ := client.Get(ctx, \"name\").Result()\nfmt.Printf(\"\u83b7\u53d6\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u636e\uff1a%v\\n\", strGet)\n// \u5220\u9664\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u636e\n// \u53c2\u6570keys\u662f\u4e0d\u56fa\u5b9a\u53c2\u6570\uff0c\u53c2\u6570\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\uff0c\u4ee3\u8868\u5b57\u7b26\u4e32\u503c\nstrDel, _ := client.Del(ctx, \"name\").Result()\nfmt.Printf(\"\u5220\u9664\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u636e\uff1a%v\\n\", strDel)\n// \u8bbe\u7f6e\u54c8\u5e0c\u7c7b\u578b\u7684\u6570\u636e\n// \u53c2\u6570ctx\u662f\u5185\u7f6e\u5305context\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\n// \u53c2\u6570key\u662f\u952e\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\n// \u53c2\u6570values\u662f\u4e0d\u56fa\u5b9a\u53c2\u6570\uff0c\u53c2\u6570\u7c7b\u578b\u4e3a\u7a7a\u63a5\u53e3\uff0c\u4ee3\u8868\u54c8\u5e0c\u6570\u503c\nhashHset, _ := client.HSet(ctx, \"Tom\", \"age\", 10).Result()\nfmt.Printf(\"\u8bbe\u7f6e\u54c8\u5e0c\u7c7b\u578b\u7684\u6570\u636e\uff1a%v\\n\", hashHset)\n// \u83b7\u53d6\u54c8\u5e0c\u7c7b\u578b\u7684\u6570\u636e\n// \u53c2\u6570field\u662f\u503c\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\nhashHGet, _ := client.HGet(ctx, \"Tom\", \"age\").Result()\nfmt.Printf(\"\u83b7\u53d6\u54c8\u5e0c\u7c7b\u578b\u7684\u6570\u636e\uff1a%v\\n\", hashHGet)\n// \u5220\u9664\u54c8\u5e0c\u7c7b\u578b\u7684\u6570\u636e\n// \u53c2\u6570fields\u662f\u4e0d\u56fa\u5b9a\u53c2\u6570\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4ee3\u8868\u54c8\u5e0c\u6570\u503c\nhashHDel, _ := client.HDel(ctx, \"Tom\", \"age\").Result()\nfmt.Printf(\"\u5220\u9664\u54c8\u5e0c\u7c7b\u578b\u7684\u6570\u636e\uff1a%v\\n\", hashHDel)\n// \u5728\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\n// \u53c2\u6570ctx\u662f\u5185\u7f6e\u5305context\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\n// \u53c2\u6570key\u662f\u952e\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\n// \u53c2\u6570values\u662f\u4e0d\u56fa\u5b9a\u53c2\u6570\uff0c\u53c2\u6570\u7c7b\u578b\u4e3a\u7a7a\u63a5\u53e3\uff0c\u4ee3\u8868\u5217\u8868\u5143\u7d20\nlitRPush, _ := client.RPush(ctx, \"Tom\", \"English\", \"Chinese\").Result()\nfmt.Printf(\"\u5728\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\uff1a%v\\n\", litRPush)\n// \u83b7\u53d6\u5217\u8868\u6307\u5b9a\u8303\u56f4\u5185\u7684\u5143\u7d20\n// \u53c2\u6570start\u548cstop\u662f\u5217\u8868\u7d22\u5f15\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u6574\u578b\nlitLRange, _ := client.LRange(ctx, \"Tom\", 0, 2).Result()\nfmt.Printf(\"\u83b7\u53d6\u5217\u8868\u6307\u5b9a\u8303\u56f4\u5185\u7684\u5143\u7d20\uff1a%v\\n\", litLRange)\n// \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\n// \u53c2\u6570timeout\u8bbe\u7f6e\u8d85\u65f6\uff0c\u6570\u636e\u7c7b\u578b\u4e3atime.Duration\n// \u53c2\u6570keys\u662f\u4e0d\u56fa\u5b9a\u53c2\u6570\uff0c\u53c2\u6570\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\uff0c\u4ee3\u8868\u5217\u8868\u5143\u7d20\nlitBLPop, _ := client.BLPop(ctx, time.Second, \"Tom\").Result()\nfmt.Printf(\"\u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff1a%v\\n\", litBLPop)\n// \u5411\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\n// \u53c2\u6570ctx\u662f\u5185\u7f6e\u5305context\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\n// \u53c2\u6570key\u662f\u952e\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\n// \u53c2\u6570members\u662f\u4e0d\u56fa\u5b9a\u53c2\u6570\uff0c\u53c2\u6570\u7c7b\u578b\u4e3a\u7a7a\u63a5\u53e3\uff0c\u4ee3\u8868\u96c6\u5408\u6210\u5458\u503c\nSetSadd, _ := client.SAdd(ctx, \"Tim\", 20, \"170CM\").Result()\nfmt.Printf(\"\u5411\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\uff1a%v\\n\", SetSadd)\n// \u83b7\u53d6\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6210\u5458\nSetSMembers, _ := client.SMembers(ctx, \"Tim\").Result()\nfmt.Printf(\"\u5411\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\uff1a%v\\n\", SetSMembers)\n// \u79fb\u9664\u5e76\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u968f\u673a\u5143\u7d20\nSetSPop, _ := client.SPop(ctx, \"Tim\").Result()\nfmt.Printf(\"\u79fb\u9664\u5e76\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u968f\u673a\u5143\u7d20\uff1a%v\\n\", SetSPop)\n// \u6709\u5e8f\u96c6\u5408\u6dfb\u52a0\u6216\u66f4\u65b0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\u548c\u6210\u5458\u7684\u5206\u6570\n// \u53c2\u6570ctx\u662f\u5185\u7f6e\u5305context\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\n// \u53c2\u6570key\u662f\u952e\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\n// \u53c2\u6570members\u662f\u4e0d\u56fa\u5b9a\u53c2\u6570\uff0c\u6570\u636e\u7c7b\u578b\u662f\u7ed3\u6784\u4f53Z\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u5305\u542b\u96c6\u5408\u6210\u5458\u548c\u5206\u6570\nz1 := redis.Z{Member: \"170CM\", Score: 5}\nz2 := redis.Z{Member: 10, Score: 10}\nZsetZAdd, _ := client.ZAdd(ctx, \"Tim\", &amp;z1, &amp;z2).Result()\nfmt.Printf(\"\u79fb\u9664\u5e76\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u968f\u673a\u5143\u7d20\uff1a%v\\n\", ZsetZAdd)\n// \u901a\u8fc7\u7d22\u5f15\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458\n// \u53c2\u6570start\u548cstop\u662f\u6709\u5e8f\u96c6\u5408\u7d22\u5f15\u533a\u95f4\uff0c\u6570\u636e\u7c7b\u578b\u4e3a\u6574\u578b\nZsetZRange, _ := client.ZRange(ctx, \"Tim\", 0, 2).Result()\nfmt.Printf(\"\u901a\u8fc7\u7d22\u5f15\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458\uff1a%v\\n\", ZsetZRange)\n// \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\nZsetZRem, _ := client.ZRem(ctx, \"Tim\", z1).Result()\nfmt.Printf(\"\u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\uff1a%v\\n\", ZsetZRem)\n// \u65b0\u589e\u6d41\u7c7b\u578b\u6570\u636e\n// \u53c2\u6570ctx\u662f\u5185\u7f6e\u5305context\u521b\u5efa\u4e0a\u4e0b\u6587\u5bf9\u8c61\n// \u53c2\u6570XAddArgs\u662f\u6307\u9488\u7c7b\u578b\u7684\u7ed3\u6784\u4f53XAddArgs\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u4ee3\u8868\u6d41\u7c7b\u578b\u7684\u6570\u636e\u7ed3\u6784\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53XAddArgs\u53ea\u9700\u8bbe\u7f6e\u6210\u5458Stream\u548cValues\nx1 := redis.XAddArgs{\nStream: \"Lily\",\nValues: map[string]interface{}{\"age\": 10, \"height\": \"160CM\"},\n}\n// \u7ed3\u6784\u4f53XAddArgs\u5b9e\u4f8b\u5316\u5bf9\u8c61\u4ee5\u6307\u9488\u65b9\u5f0f\u4f5c\u4e3a\u53c2\u6570\nstreXAdd, _ := client.XAdd(ctx, &amp;x1).Result()\nfmt.Printf(\"\u65b0\u589e\u6d41\u7c7b\u578b\u6570\u636e\uff1a%v\\n\", streXAdd)\n// \u83b7\u53d6\u6d41\u7c7b\u578b\u6240\u6709\u6570\u636e\n// \u53c2\u6570stream\u4ee3\u8868\u6d41\u6570\u636e\u540d\u79f0\uff0c\u5373\u7ed3\u6784\u4f53XAddArgs\u7684\u6210\u5458Stream\n// \u53c2\u6570start\u548cstop\u662f\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\uff0c\u4ee5\u201c-\u201d\u548c\u201c+\u201d\u8868\u793a\nstreXRange, _ := client.XRange(ctx, \"Lily\", \"-\", \"+\").Result()\nfmt.Printf(\"\u83b7\u53d6\u6d41\u7c7b\u578b\u6240\u6709\u6570\u636e\uff1a%v\\n\", streXRange)\n// \u904d\u5386\u53d8\u91cfstreXRange\uff0c\u904d\u5386\u5bf9\u8c61\u4e3a\u7ed3\u6784\u4f53XMessage\uff0c\u7ed3\u6784\u4f53\u6210\u5458ID\u662f\u6d41\u6570\u636eID\nfor _, v := range streXRange {\nfmt.Printf(\"\u83b7\u53d6\u6d41\u7c7b\u578b\u6240\u6709\u6570\u636e\u7684ID\uff1a%v\\n\", v.ID)\n// \u901a\u8fc7\u6d41\u6570\u636eID\u5220\u9664\u6570\u636e\nstreXDel, _ := client.XDel(ctx, \"Lily\", v.ID).Result()\nfmt.Printf(\"ID\uff1a%v\u5df2\u5220\u9664\uff0c\u6570\u636e\u91cf\uff1a%v\\n\", v.ID, streXDel)\n}\n// \u65b0\u589e\u5b57\u7b26\u4e32\u7c7b\u578b\u6570\u636e\nclient.Set(ctx, \"Tim\", \"ABCDEFGHIJKLMN\", 0)\n// \u5c06\u5b57\u7b26\u4e32\u7c7b\u578b\u6570\u636e\u8f6c\u4e3a\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u7136\u540e\u4fee\u6539\u4e8c\u7ea7\u5236\u7684\u4f4d\u6570\n// \u53c2\u6570key\u4ee3\u8868redis\u7684\u952e\n// \u53c2\u6570offset\u662f\u4e8c\u7ea7\u5236\u7684\u4f4d\u6570\u504f\u79fb\u91cf\uff0c0\u4ee3\u8868\u4ece\u5de6\u8fb9\u7b2c\u4e00\u4f4d\n// \u53c2\u6570value\u53ea\u67090\u548c1\uff0c\u56e0\u4e3a\u4e8c\u7ea7\u5236\u53ea\u67090\u548c1\nbitSetBit, _ := client.SetBit(ctx, \"Tim\", 0, 1).Result()\nfmt.Printf(\"\u4f4d\u56fe\u7c7b\u578b\u6570\u636e\uff1a%v\\n\", bitSetBit)\n// \u83b7\u53d6\u4f4d\u56fe\u7c7b\u578b\u6570\u636e\u67d0\u4e2a\u504f\u79fb\u91cf\u7684\u503c\nbitGetBit, _ := client.GetBit(ctx, \"Tim\", 0).Result()\nfmt.Printf(\"\u83b7\u53d6\u4f4d\u56fe\u7c7b\u578b\u6570\u636e\u67d0\u4e2a\u504f\u79fb\u91cf\u7684\u503c\uff1a%v\\n\", bitGetBit)\n// \u5220\u9664\u4f4d\u56fe\u6570\u636e\uff0c\u5373\u5220\u9664\u5b57\u7b26\u4e32\u6570\u636e\nbitDel, _ := client.Del(ctx, \"Tim\").Result()\nfmt.Printf(\"\u5220\u9664\u4f4d\u56fe\u6570\u636e\uff1a%v\\n\", bitDel)\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/13.Go%E6%93%8D%E4%BD%9CRedis/#5\u53c2\u8003\u6587\u732e","title":"5.\u53c2\u8003\u6587\u732e","text":"<p>https://www.yuque.com/coolops/golang/knfv7w</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/","title":"Go\u64cd\u4f5cMongoDB","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#1mongodb\u7684\u5b89\u88c5","title":"1.MongoDB\u7684\u5b89\u88c5","text":"<p>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.mongodb.com/try/download/community</p> <ol> <li>\u521b\u5efa/MongoDB/data/db\u76ee\u5f55</li> <li>\u8fd0\u884c MongoDB \u670d\u52a1\u5668\uff0cmongod.exe --dbpath c:\\data\\db</li> <li>\u8fde\u63a5 MongoDB \uff0cmongo.exe</li> </ol>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#2mongodb\u57fa\u7840\u5165\u95e8","title":"2.MongoDB\u57fa\u7840\u5165\u95e8","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#1mongodb\u7b80\u4ecb","title":"1.MongoDB\u7b80\u4ecb","text":"<p>\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff08NoSQL\uff09\uff0c\u4e3aWeb\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#2\u6570\u636e\u5e93\u64cd\u4f5c","title":"2.\u6570\u636e\u5e93\u64cd\u4f5c","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#1\u542f\u52a8\u6570\u636e\u5e93","title":"1.\u542f\u52a8\u6570\u636e\u5e93","text":"<p><code>mongod</code></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#2\u6570\u636e\u5e93\u8fde\u63a5","title":"2.\u6570\u636e\u5e93\u8fde\u63a5","text":"<pre><code>mongodb://[username:password@]host1[:port1][, host2[:port2], ...[/[database][?options]]\n</code></pre> <pre><code># \u8fde\u63a5\u672c\u5730\u6570\u636e\u5e93\u670d\u52a1\u5668\uff0c\u7aef\u53e3\u9ed8\u8ba4\u7684\nmongodb://localhost\n\n# \u8fde\u63a53\u53f0\u670d\u52a1\u5668\uff0c\u7aef\u53e3\u5206\u522b\u662f27017\u300127018\u300127019\u3002\nmongodb://localhost, localhost:27018, localhost:27019\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#3\u521b\u5efa\u6570\u636e\u5e93","title":"3.\u521b\u5efa\u6570\u636e\u5e93","text":"<p><code>use DATABASE_NAME</code></p> <pre><code>use mongo_db\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#4\u5220\u9664\u6570\u636e\u5e93","title":"4.\u5220\u9664\u6570\u636e\u5e93","text":"<p><code>db.dropDatabase()</code></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#3\u96c6\u5408\u64cd\u4f5c","title":"3.\u96c6\u5408\u64cd\u4f5c","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#31\u521b\u5efa\u96c6\u5408","title":"3.1\u521b\u5efa\u96c6\u5408","text":"<p><code>db.createCollection(name, options)</code></p> <pre><code>db.createCollection(\"my_collection\")\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#32\u5220\u9664\u96c6\u5408","title":"3.2\u5220\u9664\u96c6\u5408","text":"<p><code>db.collection.drop()</code></p> <pre><code>db.my_collection.drop()\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#4\u6587\u6863\u64cd\u4f5c","title":"4.\u6587\u6863\u64cd\u4f5c","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#41\u63d2\u5165\u6587\u6863","title":"4.1\u63d2\u5165\u6587\u6863","text":"<p><code>db.collection.insert(document)</code></p> <p><code>db.collection.save(document)</code></p> <pre><code>db.my_collection.insert({\"name\": \"tt\", \"address\": \"hz\"})\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#42\u67e5\u8be2\u6587\u6863","title":"4.2\u67e5\u8be2\u6587\u6863","text":"<p><code>db.collection.find(query, projection)</code></p> <pre><code>db.my_collection.find({})\ndb.my_collection.find({\"name\": \"tt\", \"address\": \"hz\"})\ndb.my_collection.find({\"name\": {\"$ne\": \"hz\"}})\ndb.my_collection.find({}).count()\ndb.my_collection.find({}).limit(1)\ndb.my_collection.find({}).sort({\"name\": 1})\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#43\u4fee\u6539\u6587\u6863","title":"4.3\u4fee\u6539\u6587\u6863","text":"<p><code>db.collection.update(&lt;query&gt;, &lt;update&gt;, {upsert: &lt;boolean&gt;, multi: &lt;boolean&gt;, writeConcern: &lt;document&gt;})</code></p> <pre><code>db.my_collection.update({'name': 'barry'}, {$set: {'address': 'hz'}})\n</code></pre> <p><code>db.collection.save(&lt;document&gt;, {writeConcern: &lt;document&gt;})</code> <pre><code>db.my_collection.save({\"_id\": ObjectId(\"deetete\"), \"name\": \"jack\", \"address\": \"hz\"})\n</code></pre></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#44\u5220\u9664\u6587\u6863","title":"4.4\u5220\u9664\u6587\u6863","text":"<p><code>db.collection.remove(&lt;query&gt;, {justOne: &lt;boolean&gt;, writeConcern: &lt;document&gt;})</code> <pre><code>do.my_collection.remove({'name': 'jack'})\n</code></pre></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#45\u53bb\u91cd\u6587\u6863","title":"4.5\u53bb\u91cd\u6587\u6863","text":"<p><code>db.collection.distinct(field, query, options)</code></p> <pre><code>db.my_collection.distinct(\"name\", {\"address\": {\"$ne\": \"sh\"}})\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#3go\u8bbf\u95eemongodb","title":"3.Go\u8bbf\u95eeMongoDB","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#31\u8fde\u63a5\u6570\u636e\u5e93","title":"3.1\u8fde\u63a5\u6570\u636e\u5e93","text":"<p>\u5728\u547d\u4ee4\u884c\u7ec8\u7aef\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6MongoDB\u9a71\u52a8\u7a0b\u5e8f\u5305\uff1a</p> <pre><code>go get go.mongodb.org/mongo-driver/mongo\n</code></pre> <p>\u6216\u8005\u5982\u4e0b</p> <p>\u4f7f\u7528go get\u548cgo mod download\u6307\u4ee4\u4e0b\u8f7dmongo-driver <pre><code>go get go.mongodb.org/mongo-driver/mongo\ngo mod download go.mongodb.org/mongo-driver\n</code></pre></p> <p>\u901a\u8fc7ApplyURI()\u65b9\u6cd5\u8fde\u63a5\u6570\u636e\u5e93\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n\"time\"\n)\nfunc main() {\nvar (\nclient     *mongo.Client\nerr        error\ndb         *mongo.Database\ncollection *mongo.Collection\n)\n//\u8fde\u63a5MongoDB\nif client, err = mongo.Connect(context.TODO(), options.Client().ApplyURI(\"mongodb://localhost:27017\").SetConnectTimeout(5*time.Second)); err != nil {\nfmt.Print(err)\nreturn\n}\n//\u68c0\u67e5\u8fde\u63a5\nerr = client.Ping(context.TODO(), nil)\nif err != nil {\nfmt.Print(err)\nreturn\n}\n//\u9009\u62e9\u6570\u636e\u5e93 my_db\ndb = client.Database(\"my_db\")\n//\u9009\u62e9\u6570\u636e\u96c6\u5408 my_collection\ncollection = db.Collection(\"my_collection\")\nfmt.Println(collection)\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#32-\u63d2\u5165\u4e00\u6761\u6570\u636e","title":"3.2 \u63d2\u5165\u4e00\u6761\u6570\u636e","text":"<p>\u9996\u5148\uff0c\u7f16\u5199\u6a21\u578b\u6587\u4ef6\uff0c\u6784\u5efa\u7ed3\u6784\u4f53ExecTime\u3001LogRecord:</p> <pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"time\"\n\"go.mongodb.org/mongo-driver/bson/primitive\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n)\ntype ExecTime struct {\nStartTime int64 `bson:\"startTime\"` //\u5f00\u59cb\u65f6\u95f4\nEndTime   int64 `bson:\"endTime\"`   //\u7ed3\u675f\u65f6\u95f4\n}\ntype LogRecord struct {\nJobName string   `bson:\"jobName\"` //\u4efb\u52a1\u540d\nCommand string   `bson:\"command\"` //shell\u547d\u4ee4\nErr     string   `bson:\"err\"`     //\u811a\u672c\u9519\u8bef\nContent string   `bson:\"content\"` //\u811a\u672c\u8f93\u51fa\nTp      ExecTime //\u6267\u884c\u65f6\u95f4\n}\nfunc main() {\nvar (\nclient     *mongo.Client\nerr        error\ncollection *mongo.Collection\niResult    *mongo.InsertOneResult\nid         primitive.ObjectID\n)\nif client, err = mongo.Connect(context.TODO(), options.Client().ApplyURI(\"mongodb://localhost:27017\").SetConnectTimeout(5*time.Second)); err != nil {\nfmt.Print(err)\nreturn\n}\n//\u9009\u62e9\u6570\u636e\u5e93my_db\u91cc\u7684\u67d0\u4e2a\u8868\ncollection = client.Database(\"my_db\").Collection(\"my_collection\")\n//\u63d2\u5165\u67d0\u4e00\u6761\u6570\u636e\nlogRecord := LogRecord{\nJobName: \"job1\",\nCommand: \"echo 1\",\nErr:     \"\",\nContent: \"1\",\nTp: ExecTime{\nStartTime: time.Now().Unix(),\nEndTime:   time.Now().Unix() + 10,\n},\n}\nif iResult, err = collection.InsertOne(context.TODO(), logRecord); err != nil {\nfmt.Print(err)\nreturn\n}\n//_id:\u9ed8\u8ba4\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00ID\nid = iResult.InsertedID.(primitive.ObjectID)\nfmt.Println(\"\u81ea\u589eID\", id.Hex())\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#33-\u6279\u91cf\u63d2\u5165\u6570\u636e","title":"3.3 \u6279\u91cf\u63d2\u5165\u6570\u636e","text":"<p>\u5728\u6279\u91cf\u63d2\u5165\u6570\u636e\u65f6\uff0c\u53ea\u9700\u8c03\u7528InsertMany()\u65b9\u6cd5\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"log\"\n\"time\"\n\"go.mongodb.org/mongo-driver/bson/primitive\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n)\ntype ExecTime struct {\nStartTime int64 `bson:\"startTime\"` //\u5f00\u59cb\u65f6\u95f4\nEndTime   int64 `bson:\"endTime\"`   //\u7ed3\u675f\u65f6\u95f4\n}\ntype LogRecord struct {\nJobName string   `bson:\"jobName\"` //\u4efb\u52a1\u540d\nCommand string   `bson:\"command\"` //shell\u547d\u4ee4\nErr     string   `bson:\"err\"`     //\u811a\u672c\u9519\u8bef\nContent string   `bson:\"content\"` //\u811a\u672c\u8f93\u51fa\nTp      ExecTime //\u6267\u884c\u65f6\u95f4\n}\nfunc main() {\nvar (\nclient     *mongo.Client\nerr        error\ncollection *mongo.Collection\nresult     *mongo.InsertManyResult\nid         primitive.ObjectID\n)\nif client, err = mongo.Connect(context.TODO(), options.Client().ApplyURI(\"mongodb://localhost:27017\").SetConnectTimeout(5*time.Second)); err != nil {\nfmt.Print(err)\nreturn\n}\n//\u9009\u62e9\u6570\u636e\u5e93my_db\u91cc\u7684\u67d0\u4e2a\u8868\ncollection = client.Database(\"my_db\").Collection(\"test\")\n//\u6279\u91cf\u63d2\u5165\nresult, err = collection.InsertMany(context.TODO(), []interface{}{\nLogRecord{\nJobName: \"job multil1\",\nCommand: \"echo multil1\",\nErr:     \"\",\nContent: \"1\",\nTp: ExecTime{\nStartTime: time.Now().Unix(),\nEndTime:   time.Now().Unix() + 10,\n},\n},\nLogRecord{\nJobName: \"job multil2\",\nCommand: \"echo multil2\",\nErr:     \"\",\nContent: \"2\",\nTp: ExecTime{\nStartTime: time.Now().Unix(),\nEndTime:   time.Now().Unix() + 10,\n},\n},\n})\nif err != nil {\nlog.Fatal(err)\n}\nif result == nil {\nlog.Fatal(\"result nil\")\n}\nfor _, v := range result.InsertedIDs {\nid = v.(primitive.ObjectID)\nfmt.Println(\"\u81ea\u589eID\", id.Hex())\n}\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#34-\u67e5\u8be2\u6570\u636e","title":"3.4 \u67e5\u8be2\u6570\u636e","text":"<pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"log\"\n\"time\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n)\ntype ExecTime struct {\nStartTime int64 `bson:\"startTime\"` //\u5f00\u59cb\u65f6\u95f4\nEndTime   int64 `bson:\"endTime\"`   //\u7ed3\u675f\u65f6\u95f4\n}\ntype LogRecord struct {\nJobName string   `bson:\"jobName\"` //\u4efb\u52a1\u540d\nCommand string   `bson:\"command\"` //shell\u547d\u4ee4\nErr     string   `bson:\"err\"`     //\u811a\u672c\u9519\u8bef\nContent string   `bson:\"content\"` //\u811a\u672c\u8f93\u51fa\nTp      ExecTime //\u6267\u884c\u65f6\u95f4\n}\n//\u67e5\u8be2\u5b9e\u4f53\ntype FindByJobName struct {\nJobName string `bson:\"jobName\"` //\u4efb\u52a1\u540d\n}\nfunc main() {\nvar (\nclient     *mongo.Client\nerr        error\ncollection *mongo.Collection\ncursor     *mongo.Cursor\n)\nif client, err = mongo.Connect(context.TODO(), options.Client().ApplyURI(\"mongodb://localhost:27017\").SetConnectTimeout(5*time.Second)); err != nil {\nfmt.Print(err)\nreturn\n}\n//\u9009\u62e9\u6570\u636e\u5e93my_db\u91cc\u7684\u67d0\u4e2a\u8868\ncollection = client.Database(\"my_db\").Collection(\"test\")\ncond := FindByJobName{JobName: \"job multil1\"}\nif cursor, err = collection.Find(\ncontext.TODO(),\ncond,\noptions.Find().SetSkip(0),\noptions.Find().SetLimit(2)); err != nil {\nfmt.Println(err)\nreturn\n}\ndefer func() {\nif err = cursor.Close(context.TODO()); err != nil {\nlog.Fatal(err)\n}\n}()\n//\u904d\u5386\u6e38\u6807\u83b7\u53d6\u7ed3\u679c\u6570\u636e\nfor cursor.Next(context.TODO()) {\nvar lr LogRecord\n//\u53cd\u5e8f\u5217\u5316Bson\u5230\u5bf9\u8c61\nif cursor.Decode(&amp;lr) != nil {\nfmt.Print(err)\nreturn\n}\nfmt.Println(lr)\n}\nvar results []LogRecord\nif err = cursor.All(context.TODO(), &amp;results); err != nil {\nlog.Fatal(err)\n}\nfor _, result := range results {\nfmt.Println(result)\n}\n}\n</code></pre> <pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"log\"\n\"time\"\n\"go.mongodb.org/mongo-driver/bson\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n)\ntype ExecTime struct {\nStartTime int64 `bson:\"startTime\"` //\u5f00\u59cb\u65f6\u95f4\nEndTime   int64 `bson:\"endTime\"`   //\u7ed3\u675f\u65f6\u95f4\n}\ntype LogRecord struct {\nJobName string   `bson:\"jobName\"` //\u4efb\u52a1\u540d\nCommand string   `bson:\"command\"` //shell\u547d\u4ee4\nErr     string   `bson:\"err\"`     //\u811a\u672c\u9519\u8bef\nContent string   `bson:\"content\"` //\u811a\u672c\u8f93\u51fa\nTp      ExecTime //\u6267\u884c\u65f6\u95f4\n}\n//\u67e5\u8be2\u5b9e\u4f53\ntype FindByJobName struct {\nJobName string `bson:\"jobName\"` //\u4efb\u52a1\u540d\n}\nfunc main() {\nvar (\nclient     *mongo.Client\nerr        error\ncollection *mongo.Collection\ncursor     *mongo.Cursor\n)\nif client, err = mongo.Connect(context.TODO(), options.Client().ApplyURI(\"mongodb://localhost:27017\").SetConnectTimeout(5*time.Second)); err != nil {\nfmt.Print(err)\nreturn\n}\n//\u9009\u62e9\u6570\u636e\u5e93my_db\u91cc\u7684\u67d0\u4e2a\u8868\ncollection = client.Database(\"my_db\").Collection(\"test\")\nfilter := bson.M{\"jobName\": \"job multil1\"}\nif cursor, err = collection.Find(\ncontext.TODO(),\nfilter,\noptions.Find().SetSkip(0),\noptions.Find().SetLimit(2)); err != nil {\nlog.Fatal(err)\n}\ndefer func() {\nif err = cursor.Close(context.TODO()); err != nil {\nlog.Fatal(err)\n}\n}()\nvar results []LogRecord\nif err = cursor.All(context.TODO(), &amp;results); err != nil {\nlog.Fatal(err)\n}\nfor _, result := range results {\nfmt.Println(result)\n}\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#35-\u7efc\u5408demo","title":"3.5 \u7efc\u5408demo","text":"<pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"go.mongodb.org/mongo-driver/bson\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n\"go.mongodb.org/mongo-driver/mongo/readpref\"\n\"time\"\n)\nfunc main() {\nuri := \"mongodb://localhost:27017\"\nclient, err := mongo.NewClient(options.Client().ApplyURI(uri))\nif err != nil {\nfmt.Printf(\"\u8fde\u63a5\u5bf9\u8c61\u521b\u5efa\u5931\u8d25\uff1a%v\\n\", err)\n}\n// \u5b9a\u4e49\u4e0a\u4e0b\u6587\u5bf9\u8c61ctx\uff0c\u5b83\u6765\u81ea\u5185\u7f6e\u5305context\uff0c\u8fd9\u662f\u7ba1\u7406\u4e0a\u4e0b\u6587\nctx, _ := context.WithTimeout(context.Background(), 10*time.Second)\n// \u4f7f\u7528\u8fde\u63a5\u5bf9\u8c61\u8fde\u63a5\u6570\u636e\u5e93\nerr = client.Connect(ctx)\nif err != nil {\nfmt.Printf(\"\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25\uff1a%v\\n\", err)\n}\n// \u5173\u95ed\u8fde\u63a5\ndefer client.Disconnect(ctx)\n// \u901a\u8fc7ping\u6d4b\u8bd5\u662f\u5426\u8fde\u63a5\u6210\u529f\nerr = client.Ping(ctx, readpref.Primary())\nif err != nil {\nfmt.Printf(\"ping\u6d4b\u8bd5\u662f\u5426\u8fde\u63a5\u6210\u529f\uff1a%v\\n\", err)\n}\n// \u83b7\u53d6\u5f53\u524d\u5df2\u6709\u7684\u6570\u636e\u5e93\ndatabases, err := client.ListDatabaseNames(ctx, bson.M{})\nif err != nil {\nfmt.Printf(\"\u5f53\u524d\u5df2\u6709\u6570\u636e\u5e93\u83b7\u53d6\u5931\u8d25\uff1a%v\\n\", err)\n}\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u5df2\u6709\u7684\u6570\u636e\u5e93\uff1a%v\\n\", databases)\n// \u521b\u5efa\u6570\u636e\u5e93DB\nDBDatabase := client.Database(\"DB\")\n// \u5728\u6570\u636e\u5e93DB\u521b\u5efa\u96c6\u5408user\nuser := DBDatabase.Collection(\"user\")\n// \u65b0\u589e\u96c6\u5408user\u4e00\u884c\u6570\u636e\nuserInsert, _ := user.InsertOne(ctx, bson.D{\n{\"name\", \"Tim\"},\n{\"age\", 20},\n})\nfmt.Printf(\"\u65b0\u589e\u96c6\u5408user\u4e00\u884c\u6570\u636e\uff1a%v\\n\", userInsert)\n// \u65b0\u589e\u96c6\u5408user\u591a\u884c\u6570\u636e\nuserInserts, _ := user.InsertMany(ctx, []interface{}{\nbson.D{{\"name\", \"Tom\"}, {\"age\", 20}},\nbson.D{{\"name\", \"Lily\"}, {\"age\", 30}},\n})\nfmt.Printf(\"\u65b0\u589e\u96c6\u5408user\u591a\u884c\u6570\u636e\uff1a%v\\n\", userInserts)\n// \u66f4\u65b0\u96c6\u5408user\u66f4\u65b0\u4e00\u884c\u6570\u636e\n// \u5c06name=Tom\u7684\u6570\u636e\u6539\u4e3aRaboy\nuserUpdate, _ := user.UpdateOne(\nctx,\nbson.M{\"name\": \"Tom\"},\nbson.D{\n{\"$set\", bson.D{{\"name\", \"Raboy\"}}},\n},\n)\nfmt.Printf(\"\u66f4\u65b0\u96c6\u5408user\u66f4\u65b0\u4e00\u884c\u6570\u636e\uff1a%v\\n\", userUpdate)\n// \u66f4\u65b0\u96c6\u5408user\u591a\u884c\u6570\u636e\n// \u5c06age=20\u7684\u6240\u6709\u6570\u636e\u6539\u4e3a25\nuserUpdates, _ := user.UpdateMany(\nctx,\nbson.M{\"age\": 20},\nbson.D{\n{\"$set\", bson.D{{\"age\", 25}}},\n},\n)\nfmt.Printf(\"\u66f4\u65b0\u96c6\u5408user\u591a\u884c\u6570\u636e\uff1a%v\\n\", userUpdates)\n// \u66ff\u6362\u96c6\u5408user\u67d0\u884c\u6570\u636e\u7684\u6240\u6709\u6570\u636e\nuserReplace, _ := user.ReplaceOne(\nctx,\nbson.M{\"name\": \"Lily\"},\nbson.M{\n\"name\": \"Lucy\",\n\"age\":  29,\n},\n)\nfmt.Printf(\"\u66ff\u6362\u96c6\u5408user\u67d0\u884c\u6570\u636e\u7684\u6240\u6709\u6570\u636e\uff1a%v\\n\", userReplace)\n// \u8bfb\u53d6\u96c6\u5408user\u7684\u6240\u6709\u6570\u636e\nuserFinds, _ := user.Find(ctx, bson.M{})\ndefer userFinds.Close(ctx)\n// \u904d\u5386\u8f93\u51fa\u6bcf\u884c\u6570\u636e\nfor userFinds.Next(ctx) {\nvar datas bson.M\n// \u6bcf\u884c\u6570\u636e\u52a0\u8f7d\u5230\u53d8\u91cfdatas\nuserFinds.Decode(&amp;datas)\nfmt.Printf(\"\u8bfb\u53d6\u96c6\u5408user\u5f53\u524d\u6570\u636e\uff1a%v\\n\", datas)\n}\n// \u8bfb\u53d6\u96c6\u5408user\u7684\u67d0\u884c\u6570\u636e\nuserFind, _ := user.Find(ctx, bson.M{\"age\": 25})\ndefer userFind.Close(ctx)\nvar data []bson.M\n// \u6570\u636e\u52a0\u8f7d\u5230\u53d8\u91cfdata\nuserFind.All(ctx, &amp;data)\nfmt.Printf(\"\u8bfb\u53d6\u96c6\u5408user\u7684\u67d0\u884c\u6570\u636e\uff1a%v\\n\", data)\n// \u5220\u9664\u96c6\u5408user\u67d0\u884c\u6570\u636e\nuserDelete, _ := user.DeleteOne(ctx, bson.M{\"name\": \"Tom\"})\nfmt.Printf(\"\u5220\u9664\u96c6\u5408user\u67d0\u884c\u6570\u636e\uff1a%v\\n\", userDelete)\n// \u5220\u9664\u96c6\u5408user\u591a\u884c\u6570\u636e\nuserDeletes, _ := user.DeleteMany(ctx, bson.M{\"age\": 25})\nfmt.Printf(\"\u5220\u9664\u96c6\u5408user\u591a\u884c\u6570\u636e\uff1a%v\\n\", userDeletes)\n// \u5220\u9664\u96c6\u5408user\u548c\u6240\u6709\u6570\u636e\nerr = user.Drop(ctx)\nif err != nil {\nfmt.Printf(\"\u5220\u9664\u96c6\u5408user\u548c\u6240\u6709\u6570\u636e\u5931\u8d25\uff1a%v\\n\", err)\n} else {\nfmt.Printf(\"\u5220\u9664\u96c6\u5408user\u548c\u6240\u6709\u6570\u636e\u6210\u529f\\n\")\n}\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#36-\u7528bson\u8fdb\u884c\u590d\u5408\u67e5\u8be2","title":"3.6 \u7528BSON\u8fdb\u884c\u590d\u5408\u67e5\u8be2","text":"<p>\u590d\u5408\u67e5\u8be2\u4f1a\u4f7f\u7528\u5230BSON\u5305\u3002MongoDB\u4e2d\u7684JSON\u6587\u6863\u5b58\u50a8\u5728\u540d\u4e3aBSON(\u4e8c\u8fdb\u5236\u7f16\u7801\u7684JSON)\u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d\u3002</p> <p>\u4e0e\u5176\u4ed6\u7f16\u7801\u5c06JSON\u6570\u636e\u5b58\u50a8\u4e3a\u7b80\u5355\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u7684\u6570\u636e\u5e93\u4e0d\u540c\uff0cBSON\u7f16\u7801\u6269\u5c55\u4e86JSON\u8868\u793a\uff0c\u4f7f\u5176\u5305\u542b\u989d\u5916\u7684\u7c7b\u578b\uff0c\u5982int\u3001long\u3001date\u3001decimal128\u7b49\u3002\u8fd9\u4f7f\u5f97\u5e94\u7528 \u7a0b\u5e8f\u66f4\u5bb9\u6613\u53ef\u9760\u5730\u5904\u7406\u3001\u6392\u5e8f\u548c\u6bd4\u8f83\u6570\u636e\u3002</p> <p>\u5728\u8fde\u63a5MongoDB\u7684Go\u9a71\u52a8\u7a0b\u5e8f\u4e2d\uff0c\u6709\u4e24\u5927\u7c7b\u578b\u8868\u793aBSON\u6570\u636e\uff1aD\u7c7b\u578b\u548cRaw\u7c7b\u578b\u3002</p> <p>(1)D\u7c7b\u578b\u3002</p> <p>D\u7c7b\u578b\u88ab\u7528\u6765\u7b80\u6d01\u5730\u6784\u5efa\u4f7f\u7528\u672c\u5730Go\u7c7b\u578b\u7684BSON\u5bf9\u8c61\u3002\u8fd9\u5bf9\u4e8e\u6784\u9020\u4f20\u9012\u7ed9MongoDB\u7684\u547d\u4ee4\u7279\u522b\u6709\u7528\u3002D\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b4\u4e2a\u5b50\u7c7b\u3002</p> <ul> <li>D:\u4e00\u4e2aBSON\u6587\u6863\u3002\u8fd9\u79cd\u7c7b\u578b\u5e94\u8be5\u5728\u987a\u5e8f\u91cd\u8981\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\uff0c\u6bd4\u5982MongoDB\u547d\u4ee4\u3002</li> <li>M:\u4e00\u5f20\u65e0\u5e8f\u7684map\u3002\u5b83\u548cD\u7c7b\u4f3c\uff0c\u53ea\u662f\u5b83\u4e0d\u4fdd\u6301\u987a\u5e8f\u3002</li> <li>A:\u4e00\u4e2aBSON\u6570\u7ec4\u3002</li> <li>E:D\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\u3002</li> </ul> <p>\u4f7f\u7528BSON\u53ef\u4ee5\u66f4\u65b9\u4fbf\u5730\u7528Go\u5b8c\u6210\u5bf9\u6570\u636e\u5e93\u7684CURD\u64cd\u4f5c\u3002\u8981\u4f7f\u7528BSON,\u9700\u8981\u5148\u5bfc\u5165\u4e0b\u9762\u7684\u5305\uff1a <pre><code>import \"go.mongodb.org/mongo-driver/bson\"\n</code></pre></p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528D\u7c7b\u578b\u6784\u5efa\u7684\u8fc7\u6ee4\u5668\u6587\u6863\u7684\u4f8b\u5b50\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u67e5\u627ename\u5b57\u6bb5\u4e0e\"Jim\"\u6216\"JaCk\"\u5339\u914d\u7684\u6587\u6863\uff1a <pre><code>bson.D{{\n\"name\",\nbson.D{{\n\"$in\",\nbson.A{\"Jim\",\"Jack\"},\n}}\n}}\n</code></pre></p> <p>(2)Raw\u7c7b\u578b\u3002</p> <p>Raw\u7c7b\u578b\u7528\u4e8e\u9a8c\u8bc1\u5b57\u8282\u5207\u7247\u3002Raw\u7c7b\u578b\u8fd8\u53ef\u4ee5\u5c06BSON\u53cd\u5e8f\u5217\u5316\u6210\u53e6\u4e00\u79cd\u7c7b\u578b\u3002</p> <p>\u4e0b\u9762\u662f\u7528Raw\u7c7b\u578b\u5c06BSON\u53cd\u5e8f\u5217\u5316\u6210JSON\u7684\u793a\u4f8b\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"go.mongodb.org/mongo-driver/bson\"\n)\nfunc main() {\ntestM := bson.M{\n\"jobName\": \"job multi1\",\n}\nvar raw bson.Raw\ntmp, _ := bson.Marshal(testM)\nbson.Unmarshal(tmp, &amp;raw)\nfmt.Println(testM)\nfmt.Println(raw)\n}\n</code></pre> <p>\u5bf9\u4e8e\u590d\u5408\u67e5\u8be2\u6765\u8bf4\uff0cD\u7c7b\u578b\u66f4\u52a0\u5f3a\u5927\u3002\u4e0b\u9762\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528D\u7c7b\u578b\u8fdb\u884c\u5e38\u7528\u7684\u590d\u5408\u67e5\u8be2\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#\u805a\u5408\u67e5\u8be2","title":"\u805a\u5408\u67e5\u8be2","text":"<p>\u5982\u679c\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u805a\u5408\u67e5\u8be2\uff0c\u5219\u8981\u7528\u5230group()\u7b49\u805a\u5408\u65b9\u6cd5\u3002\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"gitee.com/shirdonl/goWebActualCombat/chapter4/mongodb\"\n\"go.mongodb.org/mongo-driver/bson\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"log\"\n)\nfunc main() {\nvar (\nclient     = mongodb.MgoCli()\ncollection *mongo.Collection\nerr        error\ncursor     *mongo.Cursor\n)\ncollection = client.Database(\"my_db\").Collection(\"table1\")\n//\u6309\u7167jobName\u5206\u7ec4,countJob\u4e2d\u5b58\u50a8\u6bcf\u7ec4\u7684\u6570\u76ee\ngroupStage := mongo.Pipeline{bson.D{\n{\"$group\", bson.D{\n{\"_id\", \"$jobName\"},\n{\"countJob\", bson.D{\n{\"$sum\", 1},\n}},\n}},\n}}\nif cursor, err = collection.Aggregate(context.TODO(), groupStage, ); err != nil {\nlog.Fatal(err)\n}\ndefer func() {\nif err = cursor.Close(context.TODO()); err != nil {\nlog.Fatal(err)\n}\n}()\nvar results []bson.M\nif err = cursor.All(context.TODO(), &amp;results); err != nil {\nlog.Fatal(err)\n}\nfor _, result := range results {\nfmt.Println(result)\n}\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#\u66f4\u65b0\u6570\u636e","title":"\u66f4\u65b0\u6570\u636e","text":"<p>\u540c\u6837\u7684\uff0c\u66f4\u65b0\u6570\u636e\u4e5f\u9700\u8981\u5efa\u7acb\u4e13\u95e8\u7528\u4e8e\u66f4\u65b0\u7684\u7ed3\u6784\u4f53\u3002\u7ed3\u6784\u4f53\u6709Command\u3001Content\u4e24\u4e2a\u5b57\u6bb5\u3002</p> <p>\u66f4\u65b0\u65f6\u9700\u8981\u540c\u65f6\u5bf9\u8fd9\u4e24\u4e2a\u5b57\u6bb5\u8fdb\u884c\u8d4b\u503c\uff0c\u5426\u5219\u672a\u88ab\u8d4b\u503c\u7684\u5b57\u6bb5\u4f1a\u88ab\u66f4\u65b0\u4e3aG0\u7684\u6570\u636e\u7c7b\u578b\u521d\u59cb\u503c\u3002</p> <p>\u4e3a\u66f4\u65b0\u66f4\u65b9\u4fbf\u4e9b\uff0c\u53ef\u91c7\u7528bson.M{\"$set\":bson.M{\"command\":\"ByBsonM\",}}\u6765\u8fdb\u884c\u66f4\u65b0\u3002</p> <pre><code>package main\nimport (\n\"context\"\n\"gitee.com/shirdonl/goWebActualCombat/chapter4/model\"\n\"gitee.com/shirdonl/goWebActualCombat/chapter4/mongodb\"\n\"go.mongodb.org/mongo-driver/bson\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"log\"\n)\nfunc main() {\nvar (\nclient     = mongodb.MgoCli()\ncollection *mongo.Collection\nerr        error\nuResult    *mongo.UpdateResult\n)\ncollection = client.Database(\"my_db\").Collection(\"table1\")\nfilter := bson.M{\"jobName\": \"job multi1\"}\nupdate := bson.M{\"$set\": model.\nUpdateByJobName{Command: \"byModel\",Content:\"model\"}}\nif uResult, err = collection.\nUpdateMany(context.TODO(), filter, update); err != nil {\nlog.Fatal(err)\n}\n//uResult.MatchedCount\u8868\u793a\u7b26\u5408\u8fc7\u6ee4\u6761\u4ef6\u7684\u8bb0\u5f55\u6570\uff0c\u5373\u66f4\u65b0\u4e86\u591a\u5c11\u6761\u6570\u636e\u3002\nlog.Println(uResult.MatchedCount)\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#\u5220\u9664\u6570\u636e","title":"\u5220\u9664\u6570\u636e","text":"<p>\u53ef\u4ee5\u7528DeleteMany()\u65b9\u6cd5\u6765\u5220\u9664\u6570\u636e\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"context\"\n\"gitee.com/shirdonl/goWebActualCombat/chapter4/mongodb\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"log\"\n\"time\"\n)\ntype DeleteCond struct {\nBeforeCond TimeBeforeCond `bson:\"tp.startTime\"`\n}\n//startTime\u5c0f\u4e8e\u67d0\u65f6\u95f4\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5bf9\u60f3\u8981\u8fdb\u884c\u7684\u64cd\u4f5c($set\u3001$group\u7b49)\u63d0\u524d\u5b9a\u4e49\ntype TimeBeforeCond struct {\nBeforeTime int64 `bson:\"$lt\"`\n}\nfunc main() {\nvar (\nclient     = mongodb.MgoCli()\ncollection *mongo.Collection\nerr        error\nuResult    *mongo.DeleteResult\ndelCond    *DeleteCond\n)\ncollection = client.Database(\"my_db\").Collection(\"table1\")\n//\u5220\u9664jobName\u4e3ajob0\u7684\u6570\u636e\ndelCond = &amp;DeleteCond{\nBeforeCond: TimeBeforeCond{\nBeforeTime: time.Now().Unix()}}\nif uResult, err = collection.DeleteMany(context.TODO(),\ndelCond); err != nil {\nlog.Fatal(err)\n}\nlog.Println(uResult.DeletedCount)\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/14.Go%E6%93%8D%E4%BD%9CMongoDB/#4\u53c2\u8003\u6587\u732e","title":"4.\u53c2\u8003\u6587\u732e","text":"<p>https://www.liwenzhou.com/posts/Go/go_mongodb/</p> <p>https://www.yuque.com/wslynn/ivwx9d/ldkvkf</p> <p>https://docs.mongodb.com/manual/mongo/</p> <p>https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/","title":"Go\u7684\u5e38\u89c1ORM\u5e93","text":"<ul> <li>grom</li> <li>Beego-ORM</li> </ul>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#1\u4ec0\u4e48\u662form","title":"1.\u4ec0\u4e48\u662fORM","text":"<p>ORM(Object--Relation Mapping,\u5bf9\u8c61\u5173\u7cfb\u6620\u5c04)\u7684\u4f5c\u7528\u662f\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u548c\u5bf9\u8c61\u4e4b\u95f4\u505a\u4e2a\u6620\u5c04\u3002</p> <p>\u8fd9\u6837\u5728\u5177\u4f53\u64cd\u4f5c\u6570\u636e\u5e93\u65f6\uff0c\u5c31\u4e0d\u9700\u8981\u518d\u53bb\u548c\u590d\u6742\u7684SQL\u8bed\u53e5\u6253\u4ea4\u9053\uff0c\u53ea\u9700\u8981\u50cf\u5e73\u65f6\u64cd\u4f5c\u5bf9\u8c61\u4e00\u6837\u64cd\u4f5c\u5b83\u5373\u53ef\u3002</p> <ul> <li>O\uff08Object,\u5bf9\u8c61\u6a21\u578b)\uff1a\u5b9e\u4f53\u5bf9\u8c61\uff0c\u5373\u5728\u7a0b\u5e8f\u4e2d\u6839\u636e\u6570\u636e\u5e93\u8868\u7ed3\u6784\u5efa\u7acb\u7684\u4e00\u4e2a\u4e2a\u5b9e\u4f53(Entity)\u3002 </li> <li>R\uff08Relation,\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u6570\u636e\u7ed3\u6784)\uff1a\u5efa\u7acb\u7684\u6570\u636e\u5e93\u8868\u3002 </li> <li>M(Mapping,\u6620\u5c04)\uff1a\u4eceR(\u6570\u636e\u5e93)\u5230O(\u5bf9\u8c61\u6a21\u578b)\u7684\u6620\u5c04\uff0c\u5e38\u7528XML\u6587\u4ef6\u6765\u8868\u793a\u6620\u5c04\u5173\u7cfb\u3002</li> </ul> <p>ORM(Object-relational mapping)\uff0c\u4e2d\u6587\u7ffb\u8bd1\u4e3a\u5bf9\u8c61\u5173\u7cfb\u6620\u5c04\uff0c\u662f\u4e00\u79cd\u4e3a\u4e86\u89e3\u51b3\u9762\u5411\u5bf9\u8c61\u4e0e\u5173\u7cfb\u6570\u636e\u5e93\u5b58\u5728\u7684\u4e92\u4e0d\u5339\u914d\u7684\u73b0\u8c61\u7684\u6280\u672f\u3002</p> <p>\u7b80\u5355\u7684\u8bf4\uff0cORM\u662f\u901a\u8fc7\u4f7f\u7528\u63cf\u8ff0\u5bf9\u8c61\u548c\u6570\u636e\u5e93\u4e4b\u95f4\u6620\u5c04\u7684\u5143\u6570\u636e\uff0c\u5c06\u7a0b\u5e8f\u4e2d\u7684\u5bf9\u8c61\u81ea\u52a8\u6301\u4e45\u5316\u5230\u5173\u7cfb\u6570\u636e\u5e93\u4e2d</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#2\u4e3a\u4ec0\u4e48\u8981\u7528orm","title":"2.\u4e3a\u4ec0\u4e48\u8981\u7528ORM","text":"<p>\u60f3\u5fc5\u6709\u8bfb\u8005\u4f1a\u60f3\uff0c\u65e2\u7136G0\u672c\u8eab\u5c31\u6709MySQL\u7b49\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u5305\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u505a\u6301\u4e45\u5316\u548cORM\u8bbe\u8ba1\u5462\uff1f</p> <p>\u90a3\u662f\u56e0\u4e3a\uff0c\u5728\u7a0b\u5e8f\u5f00\u53d1\u4e2d\uff0c\u5728\u6570\u636e\u5e93\u4fdd\u5b58\u7684\u8868\u4e2d\uff0c\u5b57\u6bb5\u4e0e\u7a0b\u5e8f\u4e2d\u7684\u5b9e\u4f53\u7c7b\u4e4b\u95f4\u662f\u6ca1\u6709\u5173\u8054\u7684\uff0c\u8fd9\u6837\u5728\u5b9e\u73b0\u6301\u4e45\u5316\u65f6\u5c31\u6bd4\u8f83\u4e0d\u65b9\u4fbf\u3002</p> <p>\u90a3\u5230\u5e95\u5982\u4f55\u5b9e\u73b0\u6301\u4e45\u5316\u5462\uff1f</p> <p>\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u6848\u662f\uff1a\u91c7\u7528\u786c\u7f16\u7801\u65b9\u5f0f\uff0c\u4e3a\u6bcf\u4e00\u79cd\u53ef\u80fd\u7684\u6570\u636e\u5e93\u8bbf\u95ee\u64cd\u4f5c\u63d0\u4f9b\u5355\u72ec\u7684\u65b9\u6cd5\u3002</p> <p>\u8fd9\u79cd\u65b9\u6848\u5b58\u5728\u4ee5\u4e0b\u4e0d\u8db3\u3002</p> <ul> <li>\u6301\u4e45\u5316\u5c42\u7f3a\u4e4f\u5f39\u6027\u3002\u4e00\u65e6\u51fa\u73b0\u4e1a\u52a1\u9700\u6c42\u7684\u53d8\u66f4\uff0c\u5c31\u5fc5\u987b\u4fee\u6539\u6301\u4e45\u5316\u5c42\u7684\u63a5\u53e3\u3002</li> <li>\u6301\u4e45\u5316\u5c42\u540c\u65f6\u4e0e\u57df\u6a21\u578b\u548c\u5173\u7cfb\u6570\u636e\u5e93\u6a21\u578b\u7ed1\u5b9a\uff0c\u4e0d\u7ba1\u57df\u6a21\u578b\u8fd8\u662f\u5173\u7cfb\u6570\u636e\u5e93\u6a21\u578b\u53d1\u751f\u53d8\u5316\uff0c\u90fd\u8981\u4fee\u6539\u6301\u4e45\u5316\u5c42\u7684\u76f8\u5173\u7a0b\u5e8f\u4ee3\u7801\u3002\u8fd9\u589e\u52a0\u4e86\u8f6f\u4ef6\u7684\u7ef4\u62a4\u96be\u5ea6\u3002</li> </ul> <p>ORM\u63d0\u4f9b\u4e86\u5b9e\u73b0\u6301\u4e45\u5316\u5c42\u7684\u53e6\u4e00\u79cd\u6a21\u5f0f\uff1a\u5b83\u91c7\u7528\u6620\u5c04\u5143\u6570\u636e\u6765\u63cf\u8ff0\u5bf9\u8c61\u5173\u7cfb\u7684\u6620\u5c04\uff0c\u4f7f\u5f97 ORM\u4e2d\u95f4\u4ef6\u80fd\u5728\u4efb\u4f55\u4e00\u4e2a\u5e94\u7528\u7684\u4e1a\u52a1\u903b\u8f91\u5c42\u548c\u6570\u636e\u5e93\u5c42\u4e4b\u95f4\u5145\u5f53\u6865\u6881\u3002 </p> <p>ORM\u7684\u65b9\u6cd5\u8bba\u57fa\u4e8e\u4ee5\u4e0b3\u4e2a\u6838\u5fc3\u539f\u5219\u3002 - \u7b80\u5355\uff1a\u4ee5\u6700\u57fa\u672c\u7684\u5f62\u5f0f\u5efa\u6a21\u6570\u636e\u3002 - \u4f20\u8fbe\u6027\uff1a\u6570\u636e\u5e93\u7ed3\u6784\u8981\u4f7f\u7528\u5c3d\u53ef\u80fd\u88ab\u4eba\u7406\u89e3\u7684\u8bed\u8a00\u8fdb\u884c\u6587\u6863\u5316\u3002 - \u7cbe\u786e\u6027\uff1a\u57fa\u4e8e\u6570\u636e\u6a21\u578b\u521b\u5efa\u6b63\u786e\u6807\u51c6\u5316\u4e86\u7684\u7ed3\u6784\u3002</p> <p>\u5728\u76ee\u524d\u7684\u4f01\u4e1a\u5e94\u7528\u7cfb\u7edf\u8bbe\u8ba1\u4e2d\uff0cMVC\u662f\u4e3b\u8981\u7684\u7cfb\u7edf\u67b6\u6784\u6a21\u5f0f\u3002MVC\u4e2d\u7684Mod!\u5305\u542b\u4e86\u590d\u6742\u7684\u4e1a\u52a1\u903b\u8f91\u548c\u6570\u636e\u903b\u8f91\uff0c\u4ee5\u53ca\u6570\u636e\u5b58\u53d6\u673a\u5236\uff08\u5982\u6570\u636e\u5e93\u7684\u8fde\u63a5\u3001SQL\u751f\u6210\u548cStatement\u521b\u5efa\u3001 ResultSet\u7ed3\u679c\u96c6\u7684\u8bfb\u53d6\u7b49)\u7b49\u3002</p> <p>\u5c06\u8fd9\u4e9b\u590d\u6742\u7684\u4e1a\u52a1\u903b\u8f91\u548c\u6570\u636e\u903b\u8f91\u5206\u79bb\uff0c\u53ef\u4ee5\u5c06\u7cfb\u7edf\u7684\u7d27\u8026\u5408\u5173\u7cfb\u8f6c\u5316\u4e3a\u677e\u8026\u5408\u5173\u7cfb\uff08\u5373\u89e3\u8026\u5408)\uff0c\u662f\u964d\u4f4e\u7cfb\u7edf\u8026\u5408\u5ea6\u8feb\u5207\u8981\u505a\u7684\uff0c\u4e5f\u662f\u6301\u4e45\u5316\u8981\u505a\u7684\u5de5\u4f5c\u3002 MVC\u6a21\u5f0f\u5b9e\u73b0\u4e86\u5728\u67b6\u6784\u4e0a\u5c06\u8868\u73b0\u5c42(\u5373View)\u548c\u6570\u636e\u5904\u7406\u5c42\uff08\u5373Model)\u5206\u79bb\u7684\u89e3\u8026\u5408\uff0c\u800c\u6301\u4e45\u5316\u7684\u8bbe\u8ba1\u5219\u5b9e\u73b0\u4e86\u6570\u636e\u5904\u7406\u5c42\u5185\u90e8\u7684\u4e1a\u52a1\u903b\u8f91\u548c\u6570\u636e\u903b\u8f91\u5206\u79bb\u7684\u89e3\u8026\u5408\u3002</p> <p>ORM\u4f5c\u4e3a\u6301\u4e45\u5316\u8bbe\u8ba1\u4e2d\u7684\u6700\u91cd\u8981\u4e5f\u6700\u590d\u6742\u7684\u6280\u672f\uff0c\u662f\u76ee\u524d\u4e1a\u754c\u7684\u70ed\u70b9\u6280\u672f\u3002</p> <p>\u63a5\u4e0b\u6765\u4e00\u8d77\u63a2\u7a76\u4ee5\u4e0bG0\u8bed\u8a00\u4e2d\u5e38\u89c1\u7684ORM\u6846\u67b6\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#3gorm\u7684\u5b89\u88c5\u53ca\u4f7f\u7528","title":"3.Gorm\u7684\u5b89\u88c5\u53ca\u4f7f\u7528","text":"<p>Gorm\u7684\u5b89\u88c5 Gorm\u7684\u5b89\u88c5\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u5728Liux\u7cfb\u7edf\u4e2d\u76f4\u63a5\u6253\u5f00\u547d\u4ee4\u884c\u7ec8\u7aef\uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\uff1a</p> <pre><code>go get -u github.com/jinzhu/gorm\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#31-gormmysql","title":"3.1 gorm+mysql","text":"<p>\u4f7f\u7528gorm\u548cmysql\u8fde\u63a5\u521d\u59cb\u5316</p> <pre><code>package main\nimport (\n_ \"github.com/go-sql-driver/mysql\"\n\"github.com/jinzhu/gorm\"\n)\nfunc main() {\ndb, err := gorm.Open(\"mysql\", \"root:123456@(127.0.0.1:3306)/chapter4?\"+\n\"charset=utf8mb4&amp;parseTime=True&amp;loc=Local\")\nif err != nil {\npanic(err)\n}\ndefer db.Close()\ndb.DB().SetMaxIdleConns(10)\ndb.DB().SetMaxOpenConns(100)\n}\n</code></pre> <p>\u4f7f\u7528gorm+mysql\u8fdb\u884c\u589e\u5220\u6539\u67e5</p> <pre><code>package main\nimport (\n\"github.com/jinzhu/gorm\"\n_ \"github.com/jinzhu/gorm/dialects/mysql\"\n)\n// User2 \u7528\u6237\u4fe1\u606f\ntype User2 struct {\n//gorm.Model\nId    int\nName  string\nPhone string\n}\nvar (\ndb            *gorm.DB\nsqlConnection = \"root:123456@tcp(127.0.0.1:3306)/chapter4?\" +\n\"charset=utf8&amp;parseTime=true\"\n)\n//\u521d\u59cb\u5316\nfunc init() {\n//\u6253\u5f00\u6570\u636e\u5e93\u8fde\u63a5\nvar err error\ndb, err = gorm.Open(\"mysql\", sqlConnection)\nif err != nil {\npanic(\"failed to connect database\")\n}\ndb.AutoMigrate(&amp;User2{})\n}\nfunc main() {\ndefer db.Close()\ndb.DB().SetMaxIdleConns(10)\ndb.DB().SetMaxOpenConns(100)\n// \u81ea\u52a8\u8fc1\u79fb\n//db.AutoMigrate(&amp;UserInfo{})\nu1 := &amp;User2{3, \"laoshu\", \"18888888888\"}\n//u2 := UserInfo{7,\"hunya\", \"18777777777\"}\n// \u521b\u5efa\u8bb0\u5f55\ndb.Save(&amp;u1)   //\u4fdd\u5b58\u5230\u6570\u636e\u5e93\ndb.Create(&amp;u1) //\u4fdd\u5b58\u5230\u6570\u636e\u5e93\n//db.Create(&amp;u2)\n// \u67e5\u8be2\n//var u = new(UserInfo)\n//db.First(u)\n//fmt.Printf(\"%#v\\n\", u)\n//var uu UserInfo\n//db.Find(&amp;uu, \"name=?\", \"laoshu\")\n//fmt.Printf(\"%#v\\n\", uu)\n//// \u66f4\u65b0\n//db.Model(&amp;u).Update(\"name\", \"milaoshu\")\n//// \u5220\u9664\n//db.Delete(&amp;u)\n}\n</code></pre> <pre><code>package main\nimport (\n\"crypto/md5\"\n\"encoding/hex\"\n\"log\"\n\"os\"\n_ \"github.com/go-sql-driver/mysql\"\n\"github.com/jinzhu/gorm\"\n)\nvar (\ndb            *gorm.DB\nsqlConnection = \"root:123456@tcp(127.0.0.1:3306)/chapter4?\" +\n\"charset=utf8&amp;parseTime=true\"\n)\n// \u6570\u636e\u8868\u7ed3\u6784\u4f53\u7c7b\ntype GormUser struct {\nID       uint   `json:\"id\"`\nPhone    string `json:\"phone\"`\nName     string `json:\"name\"`\nPassword string `json:\"password\"`\n}\n//\u521d\u59cb\u5316\nfunc init() {\n//\u6253\u5f00\u6570\u636e\u5e93\u8fde\u63a5\nvar err error\ndb, err = gorm.Open(\"mysql\", sqlConnection)\nif err != nil {\npanic(\"failed to connect database\")\n}\ndb.AutoMigrate(&amp;GormUser{})\n}\nfunc main() {\ndefer db.Close()\n// \u521b\u5efa\u7528\u6237\nGormUser := GormUser{\nPhone:    \"13888888888\",\nName:     \"Shirdon\",\nPassword: md5Password(\"666666\"), //\u7528\u6237\u5bc6\u7801\n}\ndb.Save(&amp;GormUser)   //\u4fdd\u5b58\u5230\u6570\u636e\u5e93\ndb.Create(&amp;GormUser) //\u4fdd\u5b58\u5230\u6570\u636e\u5e93\n//\u67e5\u8be2\u7528\u6237\n// var GormUser = new(GormUser)\n// db.Where(\"phone = ?\", \"13888888888\").Find(&amp;GormUser)\n// db.First(&amp;GormUser, \"phone = ?\", \"13888888888\")\n// fmt.Println(GormUser)\n////\u66f4\u65b0\u7528\u6237\n//var GormUser = new(GormUser)\n//err:=db.Model(&amp;GormUser).Where(\"phone = ?\", \"18888888888\").\n//  Update(\"phone\", \"13888888888\").Error\n//if err !=nil {\n//  //\n//}\n//\n////\u5220\u9664\u7528\u6237\n//var GormUser = new(GormUser)\n//db.Where(\"phone = ?\", \"13888888888\").Delete(&amp;GormUser)\n//// Gorm\u4e2d\u4e8b\u52a1\u7684\u5904\u7406\u4e5f\u5f88\u7b80\u5355\uff1a\u7528db.Begin()\u65b9\u6cd5\u58f0\u660e\u5f00\u542f\u4e8b\u52a1\uff0c\u7528tx.Commit()\u65b9\u6cd5\u7ed3\u675f\u4e8b\u52a1\uff0c\u5728\u5f02\u5e38\u65f6\u8c03\u7528tx.Rollback()\u65b9\u6cd5\u56de\u6eda\u3002\u4e8b\u52a1\u5904\u7406\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a\n////\u5f00\u542f\u4e8b\u52a1\n//tx := db.Begin()\n//\n//GormUser := GormUser{\n//  Phone:    \"18888888888\",\n//  Name:     \"Shirdon\",\n//  Password: md5Password(\"666666\"), //\u7528\u6237\u5bc6\u7801\n//}\n//if err := tx.Create(&amp;GormUser).Error; err != nil {\n//  //\u4e8b\u52a1\u56de\u6eda\n//  tx.Rollback()\n//  fmt.Println(err)\n//}\n//db.First(&amp;GormUser, \"phone = ?\", \"18888888888\")\n////\u4e8b\u52a1\u63d0\u4ea4\n//tx.Commit()\n// Gom\u4e2d\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\u65e5\u5fd7\u8f93\u51fa\u7ea7\u522b\uff0c\u4ee5\u53ca\u6539\u53d8\u65e5\u5fd7\u7684\u8f93\u51fa\u5730\u65b9\uff1a\ndb.LogMode(true)\ndb.SetLogger(log.New(os.Stdout, \"\\r\\n\", 0))\n}\n//md5\u52a0\u5bc6\nfunc md5Password(str string) string {\nh := md5.New()\nh.Write([]byte(str))\nreturn hex.EncodeToString(h.Sum(nil))\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#32-gorm\u5b9e\u73b0\u589e\u5220\u6539\u67e5","title":"3.2 gorm\u5b9e\u73b0\u589e\u5220\u6539\u67e5","text":"<p>gorm\u5b9e\u73b0\u589e\u5220\u6539\u67e5</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#33-gormmysql-demo","title":"3.3 Gorm+MySQL demo","text":"<p>\u4ee5Gorm+MySQL\u4e3a\u4f8b\u8bb2\u8ff0\u5982\u4f55\u4f7f\u7528Gorm\u5b9e\u73b0MySQL\u7684\u6570\u636e\u64cd\u4f5c\u3002\u9996\u5148\u5728\u672c\u5730\u7cfb\u7edf\u4f7f\u7528go get\u6307\u4ee4\u642d\u5efaGorm\u5f00\u53d1\u73af\u5883\uff0c\u6253\u5f00GoLand\u7684Terminal\u7a97\u53e3\uff0c\u8f93\u5165\u5e76\u6267\u884c\u4ee5\u4e0b\u6307\u4ee4\uff1a <pre><code># \u4e0b\u8f7dGorm\u6846\u67b6\ngo get gorm.io/gorm\n# \u4e0b\u8f7dGorm\u7684MySQL\u9a71\u52a8\ngo get gorm.io/driver/mysql\n</code></pre></p> <p>\u4e0a\u8ff0\u6307\u4ee4\u5206\u522b\u5b89\u88c5Gorm\u6846\u67b6\u548cGorm\u6846\u67b6\u5b9a\u4e49\u7684MySQL\u9a71\u52a8\uff0c\u4f7f\u7528\u4e0d\u540c\u6570\u636e\u5e93\u9700\u8981\u4e0b\u8f7d\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u9a71\u52a8\uff0c \u76ee\u524dGorm\u5b98\u65b9\u652f\u6301\u7684\u6570\u636e\u5e93\u7c7b\u578b\u6709MySQL\u3001PostgreSQL\u3001SQLite\u548cSQL Server\uff0c\u4e0d\u540c\u6570\u636e\u5e93\u9a71\u52a8\u7684\u4e0b\u8f7d\u6307\u4ee4\u5982\u4e0b\uff1a</p> <pre><code># \u4e0b\u8f7dGorm\u7684MySQL\u9a71\u52a8\ngo get gorm.io/driver/mysql\n\n# \u4e0b\u8f7dGorm\u7684PostgreSQL\u9a71\u52a8\ngo get gorm.io/driver/postgres\n\n# \u4e0b\u8f7dGorm\u7684SQLite\u9a71\u52a8\ngo get gorm.io/driver/sqlite\n\n# \u4e0b\u8f7dGorm\u7684SQL Server\u9a71\u52a8\ngo get gorm.io/driver/sqlserver\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"gorm.io/driver/mysql\"\n\"gorm.io/gorm\"\n\"time\"\n)\n/** \u5b98\u65b9\u6587\u6863\uff1a\nhttp://gorm.io/docs/models.html\n**/\n// gorm.Model\u662f\u57fa\u672c\u7ed3\u6784\u4f53\n// \u7ed3\u6784\u4f53\u6210\u5458\uff1aID\uff0cCreatedAt\uff0cUpdatedAt\uff0cDeletedAt\ntype User struct {\ngorm.Model\nName string `gorm:\"type:varchar(10)\"`\nAge int\nAddress string `gorm:\"type:varchar(255);default:'GZ'\"`\n}\n/** \u5b98\u65b9\u6587\u6863\uff1a\nhttps://gorm.io/zh_CN/docs/conventions.html\n**/\n// \u7ed3\u6784\u4f53User\u9ed8\u8ba4\u7684\u6570\u636e\u8868\u540d\u4e3aUsers\n// \u5982\u679c\u81ea\u5b9a\u4e49\u6570\u636e\u8868\u540d\uff0c\u53ef\u81ea\u5b9a\u4e49\u7684TableName\u65b9\u6cd5\nfunc (User) TableName() string{\nreturn \"my_user\"\n}\nfunc main(){\n/** \u5b98\u65b9\u6587\u6863\uff1a\n    https://gorm.io/zh_CN/docs/connecting_to_the_database.html\n    **/\n// \u8fde\u63a5\u6570\u636e\u5e93\n// \u8fde\u63a5\u65b9\u5f0f1\uff1a\u4f7f\u7528database/sql\u548cgo-sql-driver/mysql\u8fde\u63a5\u6570\u636e\u5e93\n//dataSourceName := \"root:1234@(127.0.0.1:3306)/test\"\n//mydb, _ := sql.Open(\"mysql\", dataSourceName)\n//db, _ := gorm.Open(mysql.New(mysql.Config{\n//  Conn: mydb,\n//}), &amp;gorm.Config{})\n// \u8fde\u63a5\u65b9\u5f0f2\uff1a\u4f7f\u7528gorm.io/driver/mysql\u8fde\u63a5\u6570\u636e\u5e93\ndsn := `root:1234@tcp(127.0.0.1:3306)/test?charset=utf8mb4&amp;parseTime=True&amp;loc=Local`\ndb, _ := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})\nsqlDB, _ := db.DB()\n// \u5173\u95ed\u6570\u636e\u5e93\uff0c\u91ca\u653e\u8d44\u6e90\ndefer sqlDB.Close()\n// \u8bbe\u7f6e\u8fde\u63a5\u6c60\n// SetMaxIdleConns\u8bbe\u7f6e\u7a7a\u95f2\u8fde\u63a5\u6c60\u4e2d\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\nsqlDB.SetMaxIdleConns(10)\n// SetMaxOpenConns\u8bbe\u7f6e\u6253\u5f00\u6570\u636e\u5e93\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\nsqlDB.SetMaxOpenConns(100)\n// SetConnMaxLifetime\u8bbe\u7f6e\u8fde\u63a5\u53ef\u590d\u7528\u7684\u6700\u5927\u65f6\u95f4\nsqlDB.SetConnMaxLifetime(time.Hour)\n/** \u5b98\u65b9\u6587\u6863\uff1a\n    https://gorm.io/zh_CN/docs/migration.html\n    **/\n// \u6267\u884c\u6570\u636e\u8fc1\u79fb\ndb.AutoMigrate(&amp;User{})\n/** \u5b98\u65b9\u6587\u6863\uff1a\n    https://gorm.io/zh_CN/docs/create.html\n    **/\n// \u521b\u5efa\u6570\u636e\nu1 := User{Name: \"Tom\", Age: 10}\ndb.Create(&amp;u1)\n// \u521b\u5efa\u6570\u636e\nu2 := User{Name: \"Tim\"}\n// \u6279\u91cf\u521b\u5efa\ndb.Create(&amp;u2)\nu3 := []User{{Name: \"Lily\", Age: 18},\n{Name: \"Lucy\", Age: 22},\n{Name: \"Mary\", Age: 20}}\ndb.Create(&amp;u3)\n/** \u5b98\u65b9\u6587\u6863\uff1a\n    https://gorm.io/zh_CN/docs/query.html\n    https://gorm.io/zh_CN/docs/advanced_query.html\n    **/\n// \u67e5\u8be2\u6570\u636e\n// \u521b\u5efa\u6570\u7ec4\u5bf9\u8c61l\uff0c\u6570\u7ec4\u5143\u7d20\u4e3a\u7ed3\u6784\u4f53User\nvar l []User\n// \u67e5\u8be2my_User\u7684\u5b57\u6bb5name\u4e0d\u7b49\u4e8eTom\u7684\u6570\u636e\uff0c\u5e76\u5c06\u7ed3\u679c\u5199\u5165\u6570\u7ec4\u5bf9\u8c61l\ndb.Where(\"name &lt;&gt; ?\",\"Tom\").First(&amp;l)\n// \u8f93\u51fa\u67e5\u8be2\u7ed3\u679c\nfmt.Printf(\"\u67e5\u8be2\u7ed3\u679c\uff1a%v\\n\", l)\n// Scan\u5c06\u67e5\u8be2\u7ed3\u679c\u8f6c\u79fb\u5230\u6570\u7ec4\u5bf9\u8c61ls\nvar ls []User\ndb.Model(&amp;User{}).Where(\"id = ?\",\"1\").Scan(&amp;ls)\n// \u4e0a\u8ff0\u67e5\u8be2\u65b9\u5f0f\u7b49\u4ef7\u4e8edb.Where(\"id = ?\",\"1\").Find(&amp;ls)\nfmt.Printf(\"\u67e5\u8be2\u7ed3\u679c\uff1a%v\\n\", ls)\n/** \u5b98\u65b9\u6587\u6863\uff1a\n    https://gorm.io/zh_CN/docs/update.html\n    **/\n// \u66f4\u65b0\u6570\u636e\n// Update\u662f\u66f4\u65b0\u67d0\u4e2a\u5b57\u6bb5\u7684\u6570\u636e\ndb.Where(\"id = ?\",\"1\").Find(&amp;l).Update(\"name\", \"TomTom\")\n// Updates\u662f\u6279\u91cf\u66f4\u65b0\uff08\u66f4\u65b0\u591a\u5217\u6570\u636e\u6216\u591a\u884c\u6570\u636e\uff09\nu4 := User{Name: \"Jim\", Age: 30}\ndb.Model(&amp;User{}).Where(\"id IN ?\", []int{2, 3}).Updates(u4)\n/** \u5b98\u65b9\u6587\u6863\uff1a\n    https://gorm.io/zh_CN/docs/delete.html\n    **/\n// \u5220\u9664\u6570\u636e\u662f\u8bbe\u7f6e\u7ed3\u6784\u4f53\u6210\u5458DeletedAt\uff0c\u5e76\u4e0d\u4f1a\u771f\u6b63\u5220\u9664\u6570\u636e\n// \u56e0\u6b64\u6267\u884c\u6570\u636e\u67e5\u8be2\u4f1a\u81ea\u52a8\u7b5b\u9009\u7ed3\u6784\u4f53\u6210\u5458DeletedAt\u4e3aNull\u7684\u6570\u636e\ndb.Where(\"name = ?\",\"Jim\").Delete(&amp;User{})\n// \u901a\u8fc7\u4e3b\u952e\u5220\u9664\u6570\u636e\ndb.Delete(&amp;User{}, []int{1, 5})\n// \u4f7f\u7528Unscoped()\u80fd\u6c38\u4e45\u5220\u9664\u6570\u636e\u8868\u7684\u6570\u636e\ndb.Unscoped().Where(\"name = ?\",\"Lucy\").Delete(&amp;User{})\n/** \u5b98\u65b9\u6587\u6863\uff1a\n    https://gorm.io/zh_CN/docs/sql_builder.html\n    **/\n// \u6267\u884c\u539f\u751f\u7684SQL\u8bed\u53e5\nvar name string\n// \u67e5\u8be2\u6570\u636e\u4f7f\u7528Raw()\u65b9\u6cd5\n// \u5982\u679c\u67e5\u8be2\u5355\u884c\u6570\u636e\uff0c\u4f7f\u7528Row()\u5373\u53ef\uff0c\u5982\u679c\u591a\u884c\u6570\u636e\u5219\u4f7f\u7528Rows()\ndb.Raw(\"select name from my_User where id=5\").Row().Scan(&amp;name)\nfmt.Printf(\"\u67e5\u8be2\u7ed3\u679c\uff1a%v\\n\", name)\n// \u5220\u9664\u3001\u521b\u5efa\u6216\u66f4\u65b0\u6570\u636e\u4f7f\u7528Exec()\u65b9\u6cd5\ndb.Exec(\"delete from my_User where id=1\")\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#34-gormsqlite","title":"3.4 gorm+sqlite","text":"<pre><code>package main\nimport (\n_ \"github.com/mattn/go-sqlite3\"\n\"github.com/jinzhu/gorm\"\n\"crypto/md5\"\n\"encoding/hex\"\n\"fmt\"\n\"log\"\n\"os\"\n)\n// \u6570\u636e\u8868\u7ed3\u6784\u4f53\u7c7b\ntype GormUser struct {\nID       uint   `json:\"id\"`\nPhone    string `json:\"phone\"`\nName     string `json:\"name\"`\nPassword string `json:\"password\"`\n}\n//md5\u52a0\u5bc6\nfunc md5Password(str string) string {\nh := md5.New()\nh.Write([]byte(str))\nreturn hex.EncodeToString(h.Sum(nil))\n}\nfunc main() {\ndb, err := gorm.Open(\"sqlite3\", `D:\\soft\\sqlite\\gorm.db`)\nif err != nil {\npanic(err)\n}\ndefer db.Close()\ndb.DB().SetMaxIdleConns(10)\ndb.DB().SetMaxOpenConns(10)\ndb.AutoMigrate(&amp;GormUser{})\n//\u521b\u5efa\u7528\u6237\nGormUser := GormUser{\nPhone:    \"13888888888\",\nName:     \"Shirdon\",\nPassword: md5Password(\"666666\"), //\u7528\u6237\u5bc6\u7801\n}\ndb.Save(&amp;GormUser) //\u4fdd\u5b58\u5230\u6570\u636e\u5e93\n//db.Create(&amp;GormUser) //\u4fdd\u5b58\u5230\u6570\u636e\u5e93\n//\u5220\u9664\u7528\u6237\n//var GormUser = new(GormUser)\ndb.Where(\"phone = ?\", \"13888888888\").Delete(&amp;GormUser)\n//\u67e5\u8be2\u7528\u6237\n//var GormUser = new(GormUser)\ndb.Where(\"phone = ?\", \"18888888888\").Find(&amp;GormUser)\n//db.First(&amp;GormUser, \"phone = ?\", \"18888888888\")\nfmt.Println(GormUser)\n//\u66f4\u65b0\u7528\u6237\u53ca\u9519\u8bef\u5904\u7406\n//var GormUser = new(GormUser)\nerr = db.Model(&amp;GormUser).Where(\"phone = ?\", \"18888888888\").Update(\"phone\", \"13888888888\").Error\nif err != nil {\npanic(err)\n}\n//\u4e8b\u52a1\u5904\u7406\n//\u5f00\u542f\u4e8b\u52a1\ntx := db.Begin()\n/*\n    GormUser := GormUser{\n        Phone:    \"18888888888\",\n        Name:     \"Shirdon\",\n        Password: md5Password(\"666666\"), //\u7528\u6237\u5bc6\u7801\n    }\n    */\nif err := tx.Create(&amp;GormUser).Error; err != nil {\n//\u4e8b\u52a1\u56de\u6eda\ntx.Rollback()\nfmt.Println(err)\n}\ndb.First(&amp;GormUser, \"phone = ?\", \"18888888888\")\n//\u4e8b\u52a1\u63d0\u4ea4\ntx.Commit()\n//\u65e5\u5fd7\u5904\u7406\ndb.LogMode(true)\ndb.SetLogger(log.New(os.Stdout, \"\\r\\n\", 0))\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#35-\u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u5458\u5de5\u7ba1\u7406\u7cfb\u7edf","title":"3.5 \u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u5458\u5de5\u7ba1\u7406\u7cfb\u7edf","text":"<ol> <li>\u7528\u6237\u6839\u636e\u547d\u4ee4\u884c\u63d0\u793a\u8f93\u5165\u64cd\u4f5c\u6307\u4ee4\uff0c\u529f\u80fd\u5305\u62ec\u5458\u5de5\u7ba1\u7406\u3001\u7ec4\u7ec7\u67b6\u6784\u7ba1\u7406\u548c\u9000\u51fa\u7cfb\u7edf\u3002</li> <li>\u5458\u5de5\u7ba1\u7406\u5305\u62ec\u65b0\u589e\u5458\u5de5\u3001\u5220\u9664\u5458\u5de5\u548c\u67e5\u8be2\u5458\u5de5\u3002\u65b0\u589e\u5458\u5de5\u9700\u8981\u7528\u6237\u8f93\u5165\u540d\u5b57\u3001\u5e74\u9f84\u3001\u804c\u4f4d\u548c\u6240\u5c5e\u7ec4\u7ec7\u7f16\u53f7\uff0c\u5220\u9664\u5458\u5de5\u9700\u8981\u8f93\u5165\u5458\u5de5\u540d\u5b57\uff0c\u67e5\u8be2\u5458\u5de5\u662f\u67e5\u8be2\u6570\u636e\u8868\u6240\u6709\u5458\u5de5\u4fe1\u606f\u3002</li> <li>\u7ec4\u7ec7\u67b6\u6784\u7ba1\u7406\u5305\u62ec\u65b0\u589e\u7ec4\u7ec7\u3001\u5220\u9664\u7ec4\u7ec7\u548c\u67e5\u8be2\u7ec4\u7ec7\u3002\u65b0\u589e\u7ec4\u7ec7\u9700\u8981\u7528\u6237\u8f93\u5165\u7ec4\u7ec7\u540d\u79f0\u3001\u529e\u516c\u4f4d\u7f6e\u548c\u7b49\u7ea7\uff0c\u5220\u9664\u7ec4\u7ec7\u9700\u8981\u8f93\u5165\u7ec4\u7ec7\u540d\u79f0\uff0c\u67e5\u8be2\u7ec4\u7ec7\u662f\u67e5\u8be2\u6570\u636e\u8868\u6240\u6709\u7ec4\u7ec7\u4fe1\u606f\u3002</li> <li>\u9000\u51fa\u7cfb\u7edf\u662f\u7ec8\u6b62\u7a0b\u5e8f\uff0c\u5373\u7ec8\u6b62\u7a0b\u5e8f\u7684\u6b7b\u5faa\u73af\u529f\u80fd\u3002</li> </ol> <pre><code>package main\nimport (\n\"fmt\"\n\"gorm.io/driver/mysql\"\n\"gorm.io/gorm\"\n\"time\"\n)\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\ntype User struct {\ngorm.Model\nID         uint   `gorm:\"primary_key\"`\nName       string `gorm:\"type:varchar(255)\"`\nAge        string `gorm:\"type:varchar(255)\"`\nProfession string `gorm:\"type:varchar(255)\"`\nOrganizeID int\n// \u8bbe\u7f6eOrganizeID\u4e3a\u5916\u952e\nOrganize Organize `gorm:\"ForeignKey:OrganizeID\"`\n}\ntype Organize struct {\ngorm.Model\nID    uint   `gorm:\"primary_key\"`\nName  string `gorm:\"type:varchar(255)\"`\nSite  string `gorm:\"type:varchar(255)\"`\nGrade string `gorm:\"type:varchar(255)\"`\n}\nfunc connect_db() *gorm.DB {\n// \u4f7f\u7528gorm.io/driver/mysql\u8fde\u63a5\u6570\u636e\u5e93\ndsn := `root:1234@tcp(127.0.0.1:3306)/enterprise?charset=utf8mb4&amp;parseTime=True&amp;loc=Local`\ndb, _ := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})\nsqlDB, _ := db.DB()\n// \u8bbe\u7f6e\u8fde\u63a5\u6c60\n// SetMaxIdleConns\u8bbe\u7f6e\u7a7a\u95f2\u8fde\u63a5\u6c60\u4e2d\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\nsqlDB.SetMaxIdleConns(10)\n// SetMaxOpenConns\u8bbe\u7f6e\u6253\u5f00\u6570\u636e\u5e93\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\nsqlDB.SetMaxOpenConns(100)\n// SetConnMaxLifetime\u8bbe\u7f6e\u8fde\u63a5\u53ef\u590d\u7528\u7684\u6700\u5927\u65f6\u95f4\nsqlDB.SetConnMaxLifetime(time.Hour)\n// \u6267\u884c\u6570\u636e\u8fc1\u79fb\uff0c\u521b\u5efa\u6570\u636e\u8868\ndb.AutoMigrate(&amp;User{})\ndb.AutoMigrate(&amp;Organize{})\nreturn db\n}\nfunc main() {\ndb := connect_db()\n// \u7cfb\u7edf\u529f\u80fd\nfor {\nvar s int\nfmt.Printf(\"\u6b22\u8fce\u6765\u5230\u4f01\u4e1a\u5458\u5de5\u4fe1\u606f\u7ba1\u7406\u7cfb\u7edf\\n\")\nfmt.Printf(\"\u5458\u5de5\u7ba1\u7406\u8bf7\u63091,\u7ec4\u7ec7\u67b6\u6784\u7ba1\u7406\u8bf7\u63092,\u9000\u51fa\u8bf7\u63093\uff1a\\n\")\nfmt.Scanln(&amp;s)\nif s == 1 {\nvar u int\nfmt.Printf(\"\u65b0\u589e\u5458\u5de5\u8bf7\u63091,\u5220\u9664\u5458\u5de5\u8bf7\u63092,\u67e5\u8be2\u5458\u5de5\u8bf7\u63093\uff1a\\n\")\nfmt.Scanln(&amp;u)\nif u == 1 {\nvar name, age, profession string\nvar organizeID int\nfmt.Printf(\"\u8bf7\u8f93\u5165\u540d\u5b57\uff1a\\n\")\nfmt.Scanln(&amp;name)\nfmt.Printf(\"\u8bf7\u8f93\u5165\u5e74\u9f84\uff1a\\n\")\nfmt.Scanln(&amp;age)\nfmt.Printf(\"\u8bf7\u8f93\u5165\u804c\u4f4d\uff1a\\n\")\nfmt.Scanln(&amp;profession)\nfmt.Printf(\"\u8bf7\u8f93\u5165\u6240\u5c5e\u7ec4\u7ec7\u7f16\u53f7\uff1a\\n\")\nfmt.Scanln(&amp;organizeID)\nuser := User{Name: name, Age: age, Profession: profession, OrganizeID: organizeID}\ndb.Create(&amp;user)\nfmt.Printf(\"\u65b0\u5458\u5de5%v\u6dfb\u52a0\u6210\u529f\uff1a\\n\", name)\n} else if u == 2 {\nvar name string\nfmt.Printf(\"\u8bf7\u8f93\u5165\u9700\u8981\u5220\u9664\u7684\u540d\u5b57\uff1a\\n\")\nfmt.Scanln(&amp;name)\ndb.Where(\"name = ?\", name).Delete(&amp;User{})\nfmt.Printf(\"\u5458\u5de5%v\u5220\u9664\u6210\u529f\uff1a\\n\", name)\n} else if u == 3 {\n// \u67e5\u8be2\u6240\u6709\u5458\u5de5\u4fe1\u606f\nvar ls []User\ndb.Preload(\"Organize\").Find(&amp;ls)\nfor _, v := range ls {\nfmt.Printf(\"\u5458\u5de5%v\u7684\u804c\u4f4d:%v,\u6240\u5c5e\u7ec4\u7ec7:%v\\n\\n\", v.Name, v.Profession, v.Organize.Name)\n}\n}\n} else if s == 2 {\n// \u8bfe\u540e\u4f5c\u4e1a\n} else if s == 3 {\nreturn\n} else {\nfmt.Printf(\"\u8bf7\u6309\u7167\u63d0\u793a\u8f93\u5165\")\n}\n}\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#4beego-orm-go\u8bed\u8a00\u7684orm\u6846\u67b6","title":"4.Beego ORM-Go\u8bed\u8a00\u7684ORM\u6846\u67b6","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#41-beego-orm\u7b80\u4ecb","title":"4.1 Beego ORM\u7b80\u4ecb","text":"<p>Beego ORM\u662f\u4e00\u4e2a\u5f3a\u5927\u7684G0\u8bed\u8a00ORM\u6846\u67b6\u3002 \u5b83\u7684\u7075\u611f\u4e3b\u8981\u6765\u81eaDiango ORM\u548cSQLAlchemy\u3002</p> <p>\u5b83\u652f\u6301Go\u8bed\u8a00\u4e2d\u6240\u6709\u7684\u7c7b\u578b\u5b58\u50a8\uff0c\u5141\u8bb8\u76f4\u63a5\u4f7f\u7528\u539f\u751f\u7684SQL\u8bed\u53e5\uff0c\u91c7\u7528CRUD\u98ce\u683c\u80fd\u591f\u8f7b\u677e\u4e0a\u624b\uff0c\u80fd\u8fdb\u884c\u5173\u8054\u8868\u67e5\u8be2\uff0c\u5e76\u5141\u8bb8\u8de8\u6570\u636e\u5e93\u517c\u5bb9\u67e5\u8be2\u3002</p> <p>\u5728Beego ORM\u4e2d\uff0c\u6570\u636e\u5e93\u548cGo\u8bed\u8a00\u5bf9\u5e94\u7684\u6620\u5c04\u5173\u7cfb\u4e3a\uff1a - \u6570\u636e\u5e93\u7684\u8868\uff08table)\u2192\u7ed3\u6784\u4f53\uff08struct); - \u8bb0\u5f55\uff08record,\u884c\u6570\u636e)\u2192\u7ed3\u6784\u4f53\u5b9e\u4f8b\u5bf9\u8c61\uff08object); - \u5b57\u6bb5\uff08field)\u2192\u5bf9\u8c61\u7684\u5c5e\u6027\uff08attribute)\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#42-\u5b89\u88c5beego-orm","title":"4.2 \u5b89\u88c5Beego ORM","text":"<p>\u5b89\u88c5Beego ORM\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u547d\u4ee4\u884c\u7ec8\u7aef\u4e2d\u8f93\u5165\uff1a</p> <pre><code>go get github.com/astaxie/beego/orm\n</code></pre> <p>\u5728\u4f7f\u7528Beeg0ORM\u64cd\u4f5cMySQL\u6570\u636e\u5e93\u4e4b\u524d\uff0c\u5fc5\u987b\u5bfc\u5165MySQL\u6570\u636e\u5e93\u9a71\u52a8\u7a0b\u5e8f\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u5b89\u88c5MySQL\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5219\u5e94\u8be5\u5148\u5b89\u88c5\u3002\u5b89\u88c5\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>go get github.com/go-sql-driver/mysql\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#43-beego-orm\u8fde\u63a5\u6570\u636e\u5e93","title":"4.3 Beego ORM\u8fde\u63a5\u6570\u636e\u5e93","text":"<p>Beego ORM\u7528orm.RegisterDataBase()\u51fd\u6570\u8fdb\u884c\u6570\u636e\u5e93\u8fde\u63a5\u3002\u5fc5\u987b\u6ce8\u518c\u4e00\u4e2a\u540d\u4e3adefault\u7684\u6570\u636e\u5e93\u4f5c\u4e3a\u9ed8\u8ba4\u4f7f\u7528\u3002\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>orm.RegisterDataBase(\"default\",\"mysql\",\"root:root@/orm.test?charset=utf8\")\n</code></pre> <p>\u5982\u679c\u8981\u8bbe\u7f6e\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\u548c\u6700\u5927\u6570\u636e\u5e93\u8fde\u63a5\u6570\uff0c\u5219\u5fc5\u987b\u586b\u5199maxIdle\u548cmaxConn\u53c2\u6570\uff1a <pre><code>maxIdle :30\nmaxConn :30\norm.RegisterDataBase (\"default\",\"mysql\",\"root:root@/orm_test?charset=utf8\",maxIdle,maxConn)\n</code></pre></p> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528SetMaxldelConns()\u65b9\u6cd5\u8bbe\u7f6e\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\uff0c\u8c03\u7528SetMaxOpenConns() \u65b9\u6cd5\u8bbe\u7f6e\u6700\u5927\u6570\u636e\u5e93\u8fde\u63a5\u6570\uff1a</p> <pre><code>orm.SetMaxIdleConns(\"default\",30)\norm.SetMaxOpenConns (\"default\",30)\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#44-\u6ce8\u518c\u6a21\u578b","title":"4.4 \u6ce8\u518c\u6a21\u578b","text":"<p>\u5982\u679c\u7528orm.QuerySeter\u63a5\u53e3\u8fdb\u884c\u9ad8\u7ea7\u67e5\u8be2\uff0c\u5219\u6ce8\u518c\u6a21\u578b\u662f\u5fc5\u987b\u6709\u7684\u6b65\u9aa4\u3002 \u53cd\u4e4b\uff0c\u5982\u679c\u53ea\u7528Raw\u67e5\u8be2\u548c\u6620\u5c04\u5230struct,\u5219\u65e0\u987b\u6ce8\u518c\u6a21\u578b\u3002</p> <p>\u6ce8\u518c\u6a21\u578b\u7684\u5b9e\u8d28\u662f\uff0c\u5c06ORM\u8bed\u53e5\u8f6c\u5316\u4e3aSQL\u8bed\u53e5\u5e76\u5199\u8fdb\u6570\u636e\u5e93\u3002</p> <p>\u5c06\u5b9a\u4e49\u7684\u6a21\u578b\u8fdb\u884c\u6ce8\u518c\uff0c\u5e38\u89c1\u7684\u5199\u6cd5\u662f\uff1a\u5148\u65b0\u5efa\u4e00\u4e2a\u6a21\u578b\u6587\u4ef6\uff0c\u7136\u540e\u5728\u5b83\u7684iit()\u51fd\u6570\u4e2d\u8fdb\u884c\u6ce8\u518c\uff1a</p> <pre><code>package model\nimport \"github.com/astaxie/beego/orm\"\ntype BeegoUser struct {\nId   int //\u9ed8\u8ba4\u4e3b\u5065\u4e3aid\nName  string\nPhone string\n}\nfunc init(){\norm.RegisterModel(new(BeegoUser))\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u540c\u65f6\u6ce8\u518c\u591a\u4e2a\u6a21\u578b\uff1a <pre><code>orm.RegisterModel(new (BeegoUser),.new (Profile),new (Post))\n</code></pre></p> <p>\u5728\u6ce8\u518c\u6a21\u578b\u65f6\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6570\u636e\u8868\u7684\u524d\u7f00\u3002\u5f62\u5f0f\u5982\u4e0b\uff1a <pre><code>orm.RegisterModelwithPrefix(\"prefix \"new(User)):\n</code></pre></p> <p>\u4ee5\u4e0a\u8bed\u53e5\u521b\u5efa\u7684\u8868\u540d\u4e3aprefi_user\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/15.Go%E7%9A%84%E5%B8%B8%E8%A7%81ORM%E5%BA%93/#45-beego-orm\u7684\u4f7f\u7528","title":"4.5 Beego ORM\u7684\u4f7f\u7528","text":"<p>(1)\u5b9a\u4e49\u8868\u7ed3\u6784\u3002 \u521b\u5efa\u4e00\u4e2a\u540d\u4e3abeego_user\u7684\u8868\uff0cSQL\u8bed\u53e5\u5982\u4e0b\uff1a</p> <pre><code>CREATE DATABASE IF NOT EXISTS chapter4;\nuse chapter4;\nCREATE TABLE `beego_user` (\n`id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '\u81ea\u589eID',\n`name` VARCHAR(20) DEFAULT '' COMMENT '\u540d\u5b57',\n`phone` VARCHAR(20) DEFAULT '' COMMENT '\u7535\u8bdd',\nPRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n</code></pre> <p>(2)\u5b9a\u4e49\u7ed3\u6784\u4f53\u6a21\u578b\u3002 \u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3aBeegoUser\u7684\u7ed3\u6784\u4f53\u6a21\u578b\uff1a</p> <pre><code>type BeegoUser struct {\nId   int //\u9ed8\u8ba4\u4e3b\u5065\u4e3aid\nName  string\nPhone string\n}\n</code></pre> <p>(3)\u63d2\u5165\u6570\u636e</p> <p>\u63d2\u5165\u6570\u636e\u53ea\u9700\u8981\u8c03\u7528Insert()\u65b9\u6cd5\u5373\u53ef\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>//CREATE TABLE `beego_user` (\n// `id` bigint(20) NOT NULL AUTO_INCREMENT,\n// `name` varchar(20) DEFAULT '',\n// `phone` varchar(20) DEFAULT '',\n// PRIMARY KEY (`id`)\n//) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4\npackage main\nimport (\n\"fmt\"\n\"io\"\n\"github.com/astaxie/beego/orm\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nfunc init() {\norm.RegisterDriver(\"mysql\", orm.DRMySQL) //\u6570\u636e\u5e93\u7c7b\u578b\u8bbe\u8ba1\norm.RegisterDataBase(\"default\", \"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4?charset=utf8\")\n//\u9700\u8981\u5728init\u4e2d\u6ce8\u518c\u5b9a\u4e49\u7684model\norm.RegisterModel(new(BeegoUser))\n}\ntype BeegoUser struct {\nId    int //\u9ed8\u8ba4\u4e3b\u5065\u4e3aid\nName  string\nPhone string\n}\nfunc main() {\no := orm.NewOrm()\nuser := new(BeegoUser)\nuser.Name = \"Shirdon\"\nuser.Phone = \"199999999999\"\nfmt.Println(o.Insert(user))\norm.Debug = true\nvar w io.Writer\norm.DebugLog = orm.NewLog(w)\n}\n</code></pre> <p>(4)\u67e5\u8be2\u6570\u636e \u67e5\u8be2\u6570\u636e\u7684\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u4f7f\u7528Read()\u65b9\u6cd5\u5373\u53ef\u3002 <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/astaxie/beego/orm\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nfunc init() {\norm.RegisterDriver(\"mysql\", orm.DRMySQL) //\u6570\u636e\u5e93\u7c7b\u578b\u8bbe\u8ba1\norm.RegisterDataBase(\"default\", \"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4?charset=utf8\")\n// \u9700\u8981\u5728init\u4e2d\u6ce8\u518c\u5b9a\u4e49\u7684model\norm.RegisterModel(new(BeegoUser))\n}\ntype BeegoUser struct {\nId    int //\u9ed8\u8ba4\u4e3b\u5065\u4e3aid\nName  string\nPhone string\n}\nfunc main() {\no := orm.NewOrm()\n// \u67e5\u8be2+++++++\nuser := BeegoUser{}\n// \u5148\u5bf9\u4e3b\u952eid\u8d4b\u503c, \u67e5\u8be2\u6570\u636e\u7684\u6761\u4ef6\u5c31\u662fwhere id=2\nuser.Id = 2\n// \u901a\u8fc7Read\u51fd\u6570\u67e5\u8be2\u6570\u636e\n// \u7b49\u4ef7sql: select * from beego_user where id = 2\nerr := o.Read(&amp;user)\nif err == orm.ErrNoRows {\nfmt.Println(\"\u67e5\u8be2\u4e0d\u5230\")\n} else if err == orm.ErrMissPK {\nfmt.Println(\"\u627e\u4e0d\u5230\u4e3b\u952e\")\n} else {\nfmt.Println(user.Id, user.Name)\n}\n}\n</code></pre></p> <p>(5)\u66f4\u65b0\u6570\u636e\u3002 \u5982\u679c\u8981\u66f4\u65b0\u67d0\u884c\u6570\u636e\uff0c\u5219\u9700\u8981\u5148\u7ed9\u6a21\u578b\u8d4b\u503c\uff0c\u7136\u540e\u8c03\u7528Update()\u65b9\u6cd5\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/astaxie/beego/orm\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nfunc init() {\norm.RegisterDriver(\"mysql\", orm.DRMySQL) //\u6570\u636e\u5e93\u7c7b\u578b\u8bbe\u8ba1\norm.RegisterDataBase(\"default\", \"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4?charset=utf8\")\n// \u9700\u8981\u5728init\u4e2d\u6ce8\u518c\u5b9a\u4e49\u7684model\norm.RegisterModel(new(BeegoUser))\n}\ntype BeegoUser struct {\nId    int //\u9ed8\u8ba4\u4e3b\u5065\u4e3aid\nName  string\nPhone string\n}\nfunc main() {\no := orm.NewOrm()\n// \u66f4\u65b0++++++++++\nuser := BeegoUser{}\n// \u5148\u5bf9\u4e3b\u952eid\u8d4b\u503c, \u67e5\u8be2\u6570\u636e\u7684\u6761\u4ef6\u5c31\u662fwhere id=2\nuser.Id = 2\nuser.Name = \"James\"\nuser.Phone = \"13262662216\"\nnum, err := o.Update(&amp;user)\nif err != nil {\nfmt.Println(\"\u66f4\u65b0\u5931\u8d25\")\n} else {\nfmt.Println(\"\u66f4\u65b0\u6570\u636e\u5f71\u54cd\u7684\u884c\u6570:\", num)\n}\n}\n</code></pre> <p>(6)\u5220\u9664\u6570\u636e\u3002 \u8981\u5220\u9664\u6570\u636e\uff0c\u53ea\u9700\u8981\u5148\u5236\u5b9a\u4e3b\u952eId,\u7136\u540e\u8c03\u7528Delete()\u65b9\u6cd5\u5373\u53ef\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/astaxie/beego/orm\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nfunc init() {\norm.RegisterDriver(\"mysql\", orm.DRMySQL) //\u6570\u636e\u5e93\u7c7b\u578b\u8bbe\u8ba1\norm.RegisterDataBase(\"default\", \"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4?charset=utf8\")\n// \u9700\u8981\u5728init\u4e2d\u6ce8\u518c\u5b9a\u4e49\u7684model\norm.RegisterModel(new(BeegoUser))\n}\ntype BeegoUser struct {\nId    int //\u9ed8\u8ba4\u4e3b\u5065\u4e3aid\nName  string\nPhone string\n}\nfunc main() {\no := orm.NewOrm()\n// \u5220\u9664++++++++++\nuser := BeegoUser{}\n// \u5148\u5bf9\u4e3b\u952eid\u8d4b\u503c, \u67e5\u8be2\u6570\u636e\u7684\u6761\u4ef6\u5c31\u662fwhere id=2\nuser.Id = 2\nif num, err := o.Delete(&amp;user); err != nil {\nfmt.Println(\"\u5220\u9664\u5931\u8d25\")\n} else {\nfmt.Println(\"\u5220\u9664\u6570\u636e\u5f71\u54cd\u7684\u884c\u6570:\", num)\n}\n}\n</code></pre> <p>(7)\u539f\u751fSQL\u67e5\u8be2\u3002 \u7528SQL\u8bed\u53e5\u76f4\u63a5\u64cd\u4f5cRaw()\u65b9\u6cd5\uff0c\u5219\u8fd4\u56de\u4e00\u4e2aRawSeter\u5bf9\u8c61\uff0c\u7528\u4e8e\u5bf9\u8bbe\u7f6e\u7684SQL\u8bed\u53e5\u548c\u53c2\u6570\u8fdb\u884c\u64cd\u4f5c\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"github.com/astaxie/beego/orm\"\n_ \"github.com/go-sql-driver/mysql\"\n)\nfunc init() {\norm.RegisterDriver(\"mysql\", orm.DRMySQL) //\u6570\u636e\u5e93\u7c7b\u578b\u8bbe\u8ba1\norm.RegisterDataBase(\"default\", \"mysql\", \"root:123456@tcp(127.0.0.1:3306)/chapter4?charset=utf8\")\n//\u9700\u8981\u5728init\u4e2d\u6ce8\u518c\u5b9a\u4e49\u7684model\norm.RegisterModel(new(BeegoUser))\n}\ntype BeegoUser struct {\nId    int //\u9ed8\u8ba4\u4e3b\u5065\u4e3aid\nName  string\nPhone string\n}\nfunc main() {\no := orm.NewOrm()\nvar r orm.RawSeter\n// r = o.Raw(\"INSERT INTO `chapter4`.`beego_user` (`id`, `name`, `phone`) VALUES (2, ?, ?)\", \"hujianli\", \"1323213123\")\nr = o.Raw(\"UPDATE beego_user SET name = ? WHERE name = ?\", \"huxiaojian\", \"hujianli\")\nres, err := r.Exec()\nif err != nil {\nlog.Fatalln(\"\u63d2\u5165\u5931\u8d25\")\n} else {\n// \u63d2\u5165\u6210\u529f\nrowsAffected, _ := res.RowsAffected()\nfmt.Println(\"\u63d2\u5165\u6210\u529f\uff0c\u53d7\u5f71\u54cd\u7684\u884c\u6570\uff1a\", rowsAffected)\n}\n}\n</code></pre> <p>(8)\u4e8b\u52a1\u5904\u7406\u3002 \u8981\u8fdb\u884c\u4e8b\u52a1\u5904\u7406\uff0c\u5219\u9700\u8981\u5728SQL\u8bed\u53e5\u7684\u5f00\u5934\u4f7f\u7528Begin()\u65b9\u6cd5\u5f00\u542f\u4e8b\u52a1\uff0c\u5728Begin()\u65b9\u6cd5\u540e\u7f16\u5199\u6267\u884c\u7684SQL\u8bed\u53e5\uff0c \u6700\u540e\u8fdb\u884c\u5224\u65ad\uff1a\u5982\u679c\u5f02\u5e38\uff0c\u5219\u6267\u884cRollback(O\u65b9\u6cd5\u56de\u6eda\uff1b\u5982\u679c\u6b63\u5e38\uff0c\u5219\u6267\u884cCommit()\u65b9\u6cd5\u63d0\u4ea4\u3002</p> <p>\u89c1\u4e0b\u65b9\u4ee3\u7801\uff1a</p> <pre><code>    //\u4e8b\u52a1++++++++++\no.Begin()\nuser1 := BeegoUser{}\n// \u8d4b\u503c\nuser1.Id = 6\nuser1.Name = \"James\"\nuser2 := BeegoUser{}\n// \u8d4b\u503c\nuser2.Id = 12\nuser2.Name = \"Wade\"\n_, err1 := o.Update(&amp;user1)\n_, err2 := o.Insert(&amp;user2)\n// \u68c0\u6d4b\u4e8b\u52a1\u6267\u884c\u72b6\u6001\nif err1 != nil || err2 != nil {\n// \u5982\u679c\u6267\u884c\u5931\u8d25\uff0c\u56de\u6eda\u4e8b\u52a1\no.Rollback()\n} else {\n// \u4efb\u52a1\u6267\u884c\u6210\u529f\uff0c\u63d0\u4ea4\u4e8b\u52a1\no.Commit()\n}\n</code></pre> <p>(9)\u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\u6253\u5370\u67e5\u8be2\u8bed\u53e5\u3002 \u5982\u679c\u60f3\u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\u6253\u5370\u67e5\u8be2\u8bed\u53e5\uff0c\u5219\u53ef\u4ee5\u5c06orm.Debug\u8bbe\u7f6e\u4e3atrue\u3002\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>    // orm.Debug = true\n// orm.DebugLog = orm.NewLog(os.Stdout)\norm.Debug = true\nvar w io.Writer\n// \u8bbe\u7f6e\u4e3aio.Writer\norm.DebugLog = orm.NewLog(w)\no := orm.NewOrm()\n// \u6267\u884c\u64cd\u4f5c\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/","title":"Go\u64cd\u4f5cSQLite","text":"<p>SQLite\u662f\u4e00\u4e2a\u8fdb\u7a0b\u5185\u7684\u5e93\uff0c\u5b9e\u73b0\u4e86\u81ea\u7ed9\u81ea\u8db3\u7684\u3001\u65e0\u670d\u52a1\u5668\u7684\u3001\u96f6\u914d\u7f6e\u7684\u3001\u4e8b\u52a1\u6027\u7684SQL\u6570\u636e\u5e93\u5f15\u64ce\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#1sqlite\u7684\u5b89\u88c5","title":"1.SQLite\u7684\u5b89\u88c5","text":"<p>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.sqlite.org/download.html</p> <ol> <li>\u4e0b\u8f7dsqlite-dll-win64-x64-3360000.zip\u548csqlite-tools-win32-x86-3360000.zip\u6587\u4ef6</li> <li>\u542f\u52a8sqlite3</li> </ol>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#2sqlite\u57fa\u7840\u5165\u95e8","title":"2.SQLite\u57fa\u7840\u5165\u95e8","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#21-\u6570\u636e\u5e93\u7ba1\u7406","title":"2.1 \u6570\u636e\u5e93\u7ba1\u7406","text":"<pre><code>sqlite3 test.db -- \u521b\u5efa\u6570\u636e\u5e93\n .open test.db -- \u521b\u5efa\u6570\u636e\u5e93\n .databases -- \u67e5\u770b\u6570\u636e\u5e93\n .quit -- \u9000\u51fa\n sqlite3 testDB.db .dump &gt; testDB.sql -- \u5bfc\u51fa\u6570\u636e\u5e93\u5230txt\u6587\u4ef6\n sqlite3 testDB.db &lt; testDB.sql -- txt\u6587\u4ef6\u5bfc\u5165\u6570\u636e\u5e93\n ATTACH DATABASE 'test.db' as 'TEST'; -- \u9644\u52a0\u6570\u636e\u5e93\n DETACH DATABASE 'TEST'; -- \u5206\u79bb\u6570\u636e\u5e93\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#22-\u6570\u636e\u8868\u64cd\u4f5c","title":"2.2 \u6570\u636e\u8868\u64cd\u4f5c","text":"<pre><code>-- \u521b\u5efa\u6570\u636e\u8868\nCREATE TABLE database_name.table_name(\ncolumn1 datatype  PRIMARY KEY(one or more columns),\n   column2 datatype,\n   column3 datatype,\n   .....\n   columnN datatype,\n);\nCREATE TABLE COMPANY(\nID INT PRIMARY KEY     NOT NULL,\n   NAME           TEXT    NOT NULL,\n   AGE            INT     NOT NULL,\n   ADDRESS        CHAR(50),\n   SALARY         REAL\n);\n-- \u67e5\u770b\u6570\u636e\u8868\n .tables\n\n-- \u5f97\u5230\u8868\u7684\u5b8c\u6574\u4fe1\u606f\n.schema COMPANY\n\n-- \u5220\u9664\u6570\u636e\u8868\nDROP TABLE database_name.table_name;\nDROP TABLE COMPANY;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#23-\u6570\u636e\u5e93\u8bed\u53e5","title":"2.3 \u6570\u636e\u5e93\u8bed\u53e5","text":"<pre><code>-- \u65b0\u589e\u6570\u636e\nINSERT INTO TABLE_NAME [(column1, column2, column3,...columnN)]\nVALUES (value1, value2, value3,...valueN);\nINSERT INTO TABLE_NAME VALUES (value1,value2,value3,...valueN);\nINSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)\nVALUES (6, 'Kim', 22, 'South-Hall', 45000.00 );\nINSERT INTO COMPANY VALUES (7, 'James', 24, 'Houston', 10000.00 );\n-- \u67e5\u8be2\u6570\u636e\nSELECT column1, column2, columnN FROM table_name;\n.header on\n.mode column\nSELECT * FROM COMPANY;\nSELECT ID, NAME, SALARY FROM COMPANY;\n#\u4fee\u6539\u6570\u636e\nUPDATE table_name\nSET column1 = value1, column2 = value2...., columnN = valueN\nWHERE [condition];\nUPDATE COMPANY SET ADDRESS = 'Texas' WHERE ID = 6;\nUPDATE COMPANY SET ADDRESS = 'Texas', SALARY = 20000.00;\n#\u5220\u9664\u6570\u636e\nDELETE FROM table_name WHERE [condition];\nDELETE FROM COMPANY WHERE ID = 7;\nDELETE FROM COMPANY;\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#3go\u8bbf\u95eesqlite","title":"3.Go\u8bbf\u95eeSQLite","text":"<p>\u8bfb\u5199SQLite\u6570\u636e\u5e93\u4e4b\u524d\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u642d\u5efa\u6570\u636e\u5e93\u8fd0\u884c\u73af\u5883\uff0c\u7531\u4e8eGo\u8bed\u8a00\u5927\u90e8\u5206\u529f\u80fd\u90fd\u662fGo\u548cC\u8bed\u8a00\u6df7\u5408\u7f16\u7a0b\u7684\uff0c\u56e0\u6b64\u8fd0\u884c\u73af\u5883\u9700\u8981\u5b89\u88c5GCC\u3002</p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#31-\u5b89\u88c5msys2","title":"3.1 \u5b89\u88c5msys2","text":"<p>\u9996\u5148\u6253\u5f00https://sourceforge.net/projects/mingw-w64/files/ mingw-w64/\u5e76\u5355\u51fb\u4e0b\u8f7dMinGW-W64 GCC\u3002</p> <p>\u5c06mingw64\u7684bin\u6587\u4ef6\u5939\u6dfb\u52a0\u5230\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf</p> <pre><code>set Path=%Path%;C:\\msys64\\mingw64\\bin\n</code></pre> <p>\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u540e\uff0c\u6253\u5f00CMD\u7a97\u53e3\uff0c\u8f93\u5165\u6307\u4ee4\u201cgcc -v\u201d\u67e5\u770b\u662f\u5426\u642d\u5efa\u6210\u529f\uff0c\u5982\u679c\u642d\u5efa\u6210\u529f\u5c06\u4f1a\u663e\u793aGCC\u76f8\u5173\u4fe1\u606f</p> <p>\u5728GoLand\u7684Terminal\u7a97\u53e3\u6216CMD\u7a97\u53e3\u6267\u884c <pre><code>go get github.com/mattn/go-sqlite3\n</code></pre> \u6307\u4ee4\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u5305go-sqlite3\uff0c\u4e0b\u8f7d\u6210\u529f\u540e\uff0c\u5728GOPATH/pkg/mod/github.com/mattn/go-sqlite3\u627e\u5230\u6587\u4ef6\u4fe1\u606f</p> <pre><code>sqlite3 test.db &lt; test.sql\n</code></pre> <p>\u521b\u5efa\u6570\u636e\u5e93\u548c\u6570\u636e\u8868</p> <p>test.sql <pre><code>CREATE TABLE `user` (\n`uid` INT PRIMARY KEY NOT NULL,\n`name` TEXT NOT NULL,\n`phone` CHAR(50)\n);\nINSERT INTO `user` (`uid`, `name`, `phone`) VALUES (15, 'yx', '138888888');\nINSERT INTO `user` (`uid`, `name`, `phone`) VALUES (111, 'yx', '138888888');\n</code></pre></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#31\u8fde\u63a5\u6570\u636e\u5e93","title":"3.1\u8fde\u63a5\u6570\u636e\u5e93","text":"<pre><code>package main\nimport (\n\"database/sql\"\n_ \"github.com/mattn/go-sqlite3\"\n\"log\"\n)\nfunc main() {\ndb, err := sql.Open(\"sqlite3.exe\", `D:\\soft\\sqlite\\test.db`)\nif err != nil {\nlog.Fatal(err)\n}\ndefer db.Close()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#32\u521d\u59cb\u5316\u8fde\u63a5","title":"3.2\u521d\u59cb\u5316\u8fde\u63a5","text":"<pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/mattn/go-sqlite3\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"sqlite3\", `D:\\soft\\sqlite\\test.db`)\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\n}\n</code></pre> <p>\u8bbe\u7f6e\u6700\u5927\u8fde\u63a5\u6570n&lt;=0\uff0c\u65e0\u9650\u5236\uff0c\u9ed8\u8ba40\u3002</p> <p>\u4e0d\u4f1a\u8d85\u8fc7\u6570\u636e\u5e93\u9ed8\u8ba4\u914d\u7f6e\u3002 <pre><code>func (db *DB) SetMaxOpenConns(n int)\n</code></pre></p> <p>\u8bbe\u7f6e\u6700\u5927\u95f2\u7f6e\u8fde\u63a5\u6570n&lt;=0\uff0c\u65e0\u9650\u5236\uff0c\u9ed8\u8ba40\u3002</p> <p>\u4e0d\u4f1a\u8d85\u8fc7\u6570\u636e\u5e93\u9ed8\u8ba4\u914d\u7f6e\u3002 <pre><code>func (db *DB) SetMaxOpenConns(n int)\n</code></pre></p>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#33-sql\u67e5\u8be2","title":"3.3 SQL\u67e5\u8be2","text":""},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#queryrow\u5355\u884c\u67e5\u8be2","title":"QueryRow()\u5355\u884c\u67e5\u8be2","text":"<pre><code>func (db *DB) QueryRow(query string, args ...interface{}) *Row\n</code></pre> <pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/mattn/go-sqlite3\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"sqlite3\", `D:\\soft\\sqlite\\test.db`)\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\ntype User struct {\nUid int\nName string\nPhone string\n}\nfunc queryRow() {\nvar u User;\nif err := db.QueryRow(\"select uid, name, phone from user where uid=?;\", 111).Scan(&amp;u.Uid, &amp;u.Name, &amp;u.Phone); err != nil {\nfmt.Printf(\"scan failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"uid:%d name:%s phone:%s\\n\", u.Uid, u.Name, u.Phone)\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\nqueryRow()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#query\u591a\u884c\u67e5\u8be2","title":"Query()\u591a\u884c\u67e5\u8be2","text":"<pre><code>func (db *DB) Query(query string, args ...interface{}) (*Rows, error)\n</code></pre> <pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/mattn/go-sqlite3\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"sqlite3\", `D:\\soft\\sqlite\\test.db`)\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\ntype User struct {\nUid int\nName string\nPhone string\n}\nfunc queryMultiRow() {\nvar u User;\nrows, err := db.Query(\"select uid, name, phone from user where uid&gt;?;\", 0)\nif err != nil {\nfmt.Printf(\"query failed, err:%v\\n\", err)\nreturn\n}\ndefer rows.Close()\nfor rows.Next() {\nerr := rows.Scan(&amp;u.Uid, &amp;u.Name, &amp;u.Phone)\nif err != nil {\nfmt.Printf(\"scan failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"uid:%d name:%s phone:%s\\n\", u.Uid, u.Name, u.Phone)\n}\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\nqueryMultiRow()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#34-exec\u6267\u884c\u4e00\u6b21\u547d\u4ee4\u589e\u5220\u6539\u67e5","title":"3.4 Exec()\u6267\u884c\u4e00\u6b21\u547d\u4ee4(\u589e\u5220\u6539\u67e5)","text":"<pre><code>func (db *DB) Exec(query string, args ...interface{}) (Result, error)\n</code></pre> <pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/mattn/go-sqlite3\"\n)\nvar db *sql.DB\n// \u5b9a\u4e49\u4e00\u4e2a\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u51fd\u6570\nfunc initDB() (err error) {\n//\u8fde\u63a5\u6570\u636e\u5e93\ndb, err = sql.Open(\"sqlite3\", `D:\\soft\\sqlite\\test.db`)\nif err != nil {\nreturn err\n}\n// \u5c1d\u8bd5\u4e0e\u6570\u636e\u5e93\u5efa\u7acb\u8fde\u63a5\uff08\u6821\u9a8cdsn\u662f\u5426\u6b63\u786e\uff09\nerr = db.Ping()\nif err != nil {\nreturn err\n}\nreturn nil\n}\n//\u63d2\u5165\u6570\u636e\nfunc insertRow() {\nret, err := db.Exec(\"insert into user(uid, name, phone) values(?, ?, ?);\", 12, \"ml\", \"15906693677\")\nif err != nil {\nfmt.Printf(\"insert failed, err:%v\\n\", err)\nreturn\n}\nuid, err := ret.LastInsertId()\nif err != nil {\nfmt.Printf(\"get lastinsert ID failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"insert success, the id is %d.\\n\", uid)\n}\n//\u66f4\u65b0\u6570\u636e\nfunc updateRow() {\nret, err := db.Exec(\"update user set name=? where uid=?;\", \"tt\", 12)\nif err != nil {\nfmt.Printf(\"update failed, err:%v\\n\", err)\nreturn\n}\nn, err := ret.RowsAffected()\nif err != nil {\nfmt.Printf(\"get lastinsert ID failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"update success, affected rows:%d\\n\", n)\n}\n//\u5220\u9664\u6570\u636e\nfunc deleteRow() {\nret, err := db.Exec(\"delete from user where uid=?;\", 12)\nif err != nil {\nfmt.Printf(\"delete failed, err:%v\\n\", err)\nreturn\n}\nn, err := ret.RowsAffected()\nif err != nil {\nfmt.Printf(\"get lastinsert ID failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"delete success, affected rows:%d\\n\", n)\n}\nfunc main() {\nif err := initDB(); err != nil {\nfmt.Printf(\"init db failed, err: %v\\n\", err)\n}\ninsertRow()\nupdateRow()\ndeleteRow()\n}\n</code></pre>"},{"location":"Golang/4.Go%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93/16.Go%E6%93%8D%E4%BD%9CSQLite/#4-\u7efc\u5408demo","title":"4. \u7efc\u5408demo","text":"<pre><code>package main\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/mattn/go-sqlite3\"\n)\nfunc main() {\n// \u5982\u679c\u5f53\u524d\u8def\u5f84\u6ca1\u6709MyDb.db\uff0c\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u521b\u5efa\ndb, _ := sql.Open(\"sqlite3\", \"MyDb.db\")\n// \u901a\u8fc7\u7a0b\u5e8f\u6267\u884cSQL\u8bed\u53e5\u521b\u5efa\u6570\u636e\u8868\nsql_table := `CREATE TABLE IF NOT EXISTS \"userinfo\" (\n       \"id\" INTEGER PRIMARY KEY AUTOINCREMENT,\n       \"username\" VARCHAR(64) NULL,\n       \"age\" INT(10) NULL,\n       \"created\" TIMESTAMP default (datetime('now','localtime'))\n                )`\n// \u6267\u884cSQL\u8bed\u53e5\ndb.Exec(sql_table)\n// \u65b0\u589e\u6570\u636e\nstmt, _ := db.Prepare(\"INSERT INTO userinfo(username, age) values(?, ?)\")\n// \u4f20\u9012\u53c2\u6570\u5e76\u6267\u884cSQL\u8bed\u53e5\nres, _ := stmt.Exec(\"Tom\", \"18\")\n// \u8fd4\u56de\u65b0\u589e\u6570\u636e\u7684ID\nid, _ := res.LastInsertId()\nfmt.Printf(\"\u65b0\u589e\u6570\u636e\u7684ID\uff1a%v\\n\", id)\n// \u6279\u91cf\u65b0\u589e\u6570\u636e\nUserList := [][]interface{}{{\"Lily\", 22}, {\"Jim\", 30}}\nfor _, i := range UserList {\n// \u65b0\u589e\u6570\u636e\nstmt, _ := db.Prepare(\"INSERT INTO userinfo(username, age) values(?, ?)\")\n// \u4f20\u9012\u53c2\u6570\u5e76\u6267\u884cSQL\u8bed\u53e5\nres, _ := stmt.Exec(i[0], i[1])\n// \u8fd4\u56de\u65b0\u589e\u6570\u636e\u7684ID\nid, _ := res.LastInsertId()\nfmt.Printf(\"\u6279\u91cf\u65b0\u589e\u6570\u636e\u7684ID\uff1a%v\\n\", id)\n}\n// \u66f4\u65b0\u6570\u636e\nstmt, _ = db.Prepare(\"update userinfo set username=? where id=?\")\n// \u4f20\u9012\u53c2\u6570\u5e76\u6267\u884cSQL\u8bed\u53e5\nres, _ = stmt.Exec(\"Tim\", 1)\n// \u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff0c\u8fd4\u56deint64\u7c7b\u578b\u6570\u636e\naffect, _ := res.RowsAffected()\nfmt.Printf(\"\u66f4\u65b0\u6570\u636e\u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff1a%v\\n\", affect)\n// \u6279\u91cf\u66f4\u65b0\u6570\u636e\nUserList1 := [][]interface{}{{\"Betty\", 3}, {\"Jon\", 4}}\nfor _, i := range UserList1 {\nstmt, _ := db.Prepare(\"update userinfo set username=? where id=?\")\n// \u4f20\u9012\u53c2\u6570\u5e76\u6267\u884cSQL\u8bed\u53e5\nres, _ := stmt.Exec(i[0], i[1])\n// \u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff0c\u8fd4\u56deint64\u7c7b\u578b\u6570\u636e\naffect, _ := res.RowsAffected()\nfmt.Printf(\"\u66f4\u65b0\u6570\u636e\u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff1a%v\\n\", affect)\n}\n// \u5220\u9664\u6570\u636e\nstmt, _ = db.Prepare(\"delete from userinfo where id=?\")\n// \u5c06\u60f3\u5220\u9664\u7684id\u8f93\u5165\u8fdb\u53bb\u5c31\u53ef\u4ee5\u5220\u9664\u8f93\u5165\u7684id\nres, _ = stmt.Exec(1)\n// \u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff0c\u8fd4\u56deint64\u7c7b\u578b\u6570\u636e\naffect, _ = res.RowsAffected()\nfmt.Printf(\"\u5220\u9664\u6570\u636e\u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff1a%v\\n\", affect)\n// \u6279\u91cf\u5220\u9664\u6570\u636e\nIDList := []int{3, 4}\nfor _, i := range IDList {\n// \u901a\u8fc7\u5faa\u73af\u5220\u9664\u591a\u6761\u6570\u636e\uff0c\u6bcf\u6b21\u5faa\u73af\u5220\u9664\u4e00\u6761\u6570\u636e\nstmt, _ := db.Prepare(\"delete from userinfo where id=?\")\nres, _ := stmt.Exec(i)\n// \u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff0c\u8fd4\u56deint64\u7c7b\u578b\u6570\u636e\naffect, _ := res.RowsAffected()\nfmt.Printf(\"\u6279\u91cf\u5220\u9664\u6570\u636e\u53d7\u5f71\u54cd\u7684\u6570\u636e\u884c\u6570\uff1a%v\\n\", affect)\n}\n// \u67e5\u8be2\u6570\u636e\nrows, _ := db.Query(\"SELECT * FROM userinfo where id=?\", 2)\n// \u904d\u5386\u6240\u6709\u67e5\u8be2\u7ed3\u679c\nvar ids, age int\nvar un, ct string\nfor rows.Next() {\nrows.Scan(&amp;ids, &amp;un, &amp;age, &amp;ct)\nfmt.Printf(\"\u5f53\u524d\u6570\u636e\uff1a%v,%v,%v,%v\\n\", ids, un, age, ct)\n}\n// \u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\ndb.Close()\n}\n</code></pre> <p>\u7a0b\u5e8f\u6267\u884c\u5b8c\u6210\u540e\uff0c\u5728\u5f53\u524d\u7684\u6587\u4ef6\u5939\u81ea\u52a8\u521b\u5efaMyDb.db\u6587\u4ef6\uff0c\u4f7f\u7528Navicat Premium\u6253\u5f00MyDb.db\u6587\u4ef6\uff0c\u67e5\u770b\u6570\u636e\u8868userinfo\u7684\u6570\u636e\u60c5\u51b5\u3002</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/","title":"Go Socket\u7f16\u7a0b","text":""},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#1\u4ec0\u4e48\u662fsocket","title":"1.\u4ec0\u4e48\u662fSocket","text":"<p>Socket\u662f\u8ba1\u7b97\u673a\u7f51\u7edc\u4e2d\u7684\u5185\u90e8\u7aef\u70b9\uff0c\u7528\u4e8e\u5728\u8282\u70b9\u5185\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u3002</p> <p>\u662f\u4e00\u79cd\u7cfb\u7edf\u8d44\u6e90\uff0c\u542b\u901a\u4fe1\u534f\u8bae\u3001\u76ee\u6807\u5730\u5740\u3001\u72b6\u6001\u7b49\u3002</p> <p>\u4f4d\u4e8e\u5e94\u7528\u5c42\u548c\u4f20\u8f93\u5c42\u95f4\uff0c\u8fde\u63a5\u5e94\u7528\u5c42\u4e0e\u4f20\u8f93\u5c42\u3002</p> <p>\u672c\u8d28\u4e0a\u662f\u5bf9\u4f20\u8f93\u5c42TCP/IP\u7684\u5c01\u88c5\uff0c\u63d0\u4f9bSocket API\u7ed9\u5e94\u7528\u7a0b\u5e8f\u8c03\u7528\u3002</p> \u5e94\u7528\u5c42 Socket API \u4f20\u8f93\u5c42 \u7f51\u7edc\u5c42 \u6570\u636e\u94fe\u8def\u5c42 \u7269\u7406\u5c42"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#11-socket\u662f\u5982\u4f55\u5de5\u4f5c\u7684","title":"1.1 Socket\u662f\u5982\u4f55\u5de5\u4f5c\u7684","text":"<p>\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u901a\u8fc7Socket\u901a\u4fe1\uff0c\u670d\u52a1\u5668\u7aefSocket\u76d1\u542c\u5730\u5740\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u6765\u8fde\u63a5\u3002\u5ba2\u6237\u7aefSocket\u8fde\u63a5\u5ba2\u6237\u7aefSocket\u3002</p> <p>\u5efa\u7acbTCP/IP\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u4ea7\u751f\u4e09\u6b21\u7f51\u7edc\u901a\u4fe1\uff0c\u4e09\u6b21\u63e1\u624b\u3002</p> <p>\u5173\u95edTCP/IP\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u4ea7\u751f\u56db\u6b21\u7f51\u7edc\u901a\u4fe1\uff0c\u56db\u6b21\u63e1\u624b\u3002</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#12-c\u8bed\u8a00\u521b\u5efa\u670d\u52a1\u5668\u7aefsocket","title":"1.2 C\u8bed\u8a00\u521b\u5efa\u670d\u52a1\u5668\u7aefSocket","text":""},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#13-c\u8bed\u8a00\u521b\u5efa\u5ba2\u6237\u7aefsocket","title":"1.3 C\u8bed\u8a00\u521b\u5efa\u5ba2\u6237\u7aefSocket","text":""},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#14-go\u8bed\u8a00\u521b\u5efasocket","title":"1.4 Go\u8bed\u8a00\u521b\u5efaSocket","text":"<p>\u670d\u52a1\u5668\u7aef\u901a\u8fc7net.Listen()\u65b9\u6cd5\u5efa\u7acb\u8fde\u63a5\u5e76\u76d1\u542c\u6307\u5b9aIP\u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\u5ba2\u6237\u7aef\u901a\u8fc7net.Dial()\u51fd\u6570\u8fde\u63a5\u6307\u5b9aIP\u5730\u5740\u548c\u7aef\u53e3\u53f7\u3002</p> <p></p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#2\u5ba2\u6237\u7aefdial\u51fd\u6570\u7684\u4f7f\u7528","title":"2.\u5ba2\u6237\u7aefDial()\u51fd\u6570\u7684\u4f7f\u7528","text":"<pre><code>func Dial(net, addr string) (Conn, error)\n//\u7f51\u7edc\u534f\u8bae\n//IP\u5730\u5740\u6216\u57df\u540d\uff0c\u7aef\u53e3\u53f7\u4f4d\u4e8e\":\"\u540e\n</code></pre> <pre><code>conn, err := net.Dial(\"tcp\", \"192.168.0.1:8087\")\nconn, err := net.Dial(\"udp\", \"192.168.0.2:8088\")\nconn, err := net.Dial(\"ip4:icmp\", \"www.shirdon.com\")\nconn, err := net.Dial(\"ip4:1\", \"10.0.0.8\")\n</code></pre> <pre><code>package main\nimport (\n\"bytes\"\n\"fmt\"\n\"io\"\n\"net\"\n\"os\"\n)\nfunc main() {\nif len(os.Args) != 2 {\nfmt.Fprintf(os.Stderr, \"Usage: %s host:port\\n\", os.Args[0])\nos.Exit(1)\n}\nservice := os.Args[1]\nconn, err := net.Dial(\"tcp\", service)\nvalidateError(err)\n_, err = conn.Write([]byte(\"HEAD / HTTP/1.0\\r\\n\\r\\n\"))\nvalidateError(err)\nresult, err := fullyRead(conn)\nvalidateError(err)\nfmt.Println(string(result))\nos.Exit(0)\n}\nfunc validateError(err error) {\nif err != nil {\nfmt.Fprintf(os.Stderr, \"Fatal error: %s\", err.Error())\nos.Exit(1)\n}\n}\nfunc fullyRead(conn net.Conn) ([]byte, error) {\ndefer conn.Close()\nresult := bytes.NewBuffer(nil)\nvar buf [512]byte\nfor {\nn, err := conn.Read(buf[:])\nresult.Write(buf[:n])\nif err != nil {\nif err == io.EOF {\nbreak\n}\nreturn nil, err\n}\n}\nreturn result.Bytes(), nil\n}\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#3\u5ba2\u6237\u7aefdialtcp\u51fd\u6570\u7684\u4f7f\u7528","title":"3.\u5ba2\u6237\u7aefDialTCP()\u51fd\u6570\u7684\u4f7f\u7528","text":"<pre><code>func DialTCP(network string, laddr, raddr *TCPAddr) (*TCPConn, error)\n//network\u662ftcp\u3001tcp4\u6216tcp6\n//laddr\u672c\u5730\u5730\u5740\uff0c\u901a\u5e38\u4e3anil\n//raddr\u76ee\u6807\u5730\u5740\n</code></pre> <p>client\u793a\u4f8b</p> <pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"net\"\n\"os\"\n)\nfunc main() {\nservice := \"127.0.0.1:8088\"\ntcpAddr, err := net.ResolveTCPAddr(\"tcp\", service)\ncheckError(err)\nfmt.Println(\"tcpAddr :\")\ntypeof(tcpAddr)\nmyConn, err := net.DialTCP(\"tcp\", nil, tcpAddr)\ncheckError(err)\nfmt.Println(\"myConn :\")\ntypeof(myConn)\n_, err = myConn.Write([]byte(\"HEAD / HTTP/1.1\\r\\n\\r\\n\"))\ncheckError(err)\nresult, err := ioutil.ReadAll(myConn)\ncheckError(err)\nfmt.Println(string(result))\nos.Exit(0)\n}\nfunc typeof(v interface{}) {\nfmt.Printf(\"type is: %T\\n\", v)\n}\nfunc checkError(err error) {\nif err != nil {\nfmt.Println(\"Error:\", err.Error())\nos.Exit(1)\n}\n}\n</code></pre> <p><code>server/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n_ \"io\"\n\"log\"\n\"net\"\n)\nfunc Server() {\nl, err := net.Listen(\"tcp\", \"127.0.0.1:8088\")\nif err != nil {\nlog.Fatal(err)\n}\ndefer l.Close()\nfor {\nconn, err := l.Accept()\nif err != nil {\nlog.Fatal(err)\n}\nfmt.Printf(\"\u8bbf\u95ee\u5ba2\u6237\u7aef\u4fe1\u606f\uff1acon=%v \u5ba2\u6237\u7aefip=%v\\n\", conn, conn.RemoteAddr().String())\ngo handleConnection(conn)\n}\n}\nfunc handleConnection(c net.Conn) {\ndefer c.Close()\nfor {\nfmt.Printf(\"\")\nbuf := make([]byte, 1024)\nn, err := c.Read(buf)\nif err != nil {\nlog.Fatal(err)\nbreak\n}\nfmt.Print(string(buf[:n]))\n}\n}\nfunc main() {\nServer()\n}\n</code></pre> <p><code>client/main.go</code></p> <pre><code>package main\nimport (\n\"bufio\"\n\"fmt\"\n\"log\"\n\"net\"\n\"os\"\n\"strings\"\n)\nfunc Client() {\nconn, err := net.Dial(\"tcp\", \"127.0.0.1:8088\")\nif err != nil {\nlog.Fatal(err)\n}\ndefer conn.Close()\nreader := bufio.NewReader(os.Stdin)\nfor {\nline, err := reader.ReadString('\\n')\nif err != nil {\nlog.Fatal(err)\n}\nline = strings.Trim(line, \"\\r\\n\")\nif line == \"exit\" {\nfmt.Println(\"\u7528\u6237\u9000\u51fa\u5ba2\u6237\u7aef\")\nbreak\n}\nn, err := conn.Write([]byte(line + \"\\n\"))\nif err != nil {\nlog.Fatal(err)\n}\nfmt.Printf(\"\u5ba2\u6237\u7aef\u53d1\u9001\u4e86%d\u5b57\u8282\u7684\u6570\u636e\u5230\u670d\u52a1\u5668\u7aef\\n\", n)\n}\n}\nfunc main() {\nClient()\n}\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#4udp-socket\u7684\u4f7f\u7528","title":"4.UDP Socket\u7684\u4f7f\u7528","text":"<p>UDP\u662f\u65e0\u8fde\u63a5\u7684\uff0c\u670d\u52a1\u5668\u7aef\u53ea\u9700\u8981\u6307\u5b9aIP\u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u7136\u540e\u76d1\u542c\u8be5\u5730\u5740\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u5e76\u4e0e\u4e4b\u5efa\u7acb\u8fde\u63a5\uff0c\u4e24\u7aef\u5373\u53ef\u901a\u4fe1\u3002</p> <pre><code>func ResolveUDPAddr(network, address string) (*UDPAddr, error)\nfunc ListenUDP(network string, laddr UDPAddr) (UDPConn, error)\nfunc (c *UDPConn) ReadFromUDP(b []byte) (int, *UDPAddr, error)\nfunc (c *UDPConn) WriteToUDP(b []byte, addr *UDPAddr) (int, error)\n</code></pre> <p><code>server/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"net\"\n)\nfunc main() {\nserverUdpAddr, err := net.ResolveUDPAddr(\"udp\", \"127.0.0.1:8023\")\nif err != nil {\nfmt.Println(\"ResolveUDPAddr err:\", err)\nreturn\n}\nconn, err := net.ListenUDP(\"udp\", serverUdpAddr)\nif err != nil {\nfmt.Println(\"ListenUDP err:\", err)\nreturn\n}\ndefer conn.Close()\nbuf := make([]byte, 1024)\nfor {\nn, clientUdpAddr, err := conn.ReadFromUDP(buf)\nif err != nil {\nfmt.Println(\"ReadFromUDP err:\", err)\nreturn\n}\nfmt.Printf(\"\u63a5\u6536\u5230\u5ba2\u6237\u7aef[%s]:%s\", clientUdpAddr, string(buf[:n]))\nconn.WriteToUDP([]byte(\"I am server\"), clientUdpAddr)\n}\n}\n</code></pre> <p><code>client/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"net\"\n\"os\"\n)\nfunc main() {\nconn, err := net.Dial(\"udp\", \"127.0.0.1:8023\")\nif err != nil {\nfmt.Println(\"Dial err:\", err)\nreturn\n}\ndefer conn.Close()\ngo func() {\nstr := make([]byte, 1024)\nfor {\nn, err := os.Stdin.Read(str)\nif err != nil {\nfmt.Println(\"os.Stdin.Read err:\", err)\nreturn\n}\nconn.Write(str[:n])\n}\n}()\nbuf := make([]byte, 1024)\nfor {\nn, err := conn.Read(buf)\nif err != nil {\nfmt.Println(\"Read err:\", err)\nreturn\n}\nfmt.Println(\"\u670d\u52a1\u5668\u53d1\u9001\u6765\uff1a\", string(buf[:n]))\n}\n}\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/17.Go-Socket%E7%BC%96%E7%A8%8B/#5go-socket\u521b\u5efa\u7b80\u6613\u804a\u5929\u7a0b\u5e8f","title":"5.Go Socket\u521b\u5efa\u7b80\u6613\u804a\u5929\u7a0b\u5e8f","text":"<p><code>server/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"net\"\n\"time\"\n)\nvar ConnSlice map[net.Conn]*Heartbeat\ntype Heartbeat struct {\nendTime int64 //\u8fc7\u671f\u65f6\u95f4\n}\nfunc main() {\nConnSlice = map[net.Conn]*Heartbeat{}\nl, err := net.Listen(\"tcp\", \"127.0.0.1:8086\")\nif err != nil {\nfmt.Println(\"\u670d\u52a1\u5668\u542f\u52a8\u5931\u8d25\")\n}\ndefer l.Close()\nfor {\nconn, err := l.Accept()\nif err != nil {\nfmt.Println(\"Error accepting: \", err)\n}\nfmt.Printf(\"Received message %s -&gt; %s \\n\", conn.RemoteAddr(), conn.LocalAddr())\nConnSlice[conn] = &amp;Heartbeat{\nendTime: time.Now().Add(time.Second * 5).Unix(), //\u521d\u59cb\u5316\u8fc7\u671f\u65f6\u95f4\n}\ngo handelConn(conn)\n}\n}\nfunc handelConn(c net.Conn) {\nbuffer := make([]byte, 1024)\nfor {\nn, err := c.Read(buffer)\nif ConnSlice[c].endTime &gt; time.Now().Unix() {\nConnSlice[c].endTime = time.Now().Add(time.Second * 5).Unix() //\u66f4\u65b0\u5fc3\u8df3\u65f6\u95f4\n} else {\nfmt.Println(\"\u957f\u65f6\u95f4\u672a\u53d1\u6d88\u606f\u65ad\u5f00\u8fde\u63a5\")\nreturn\n}\nif err != nil {\nreturn\n}\n//\u5982\u679c\u662f\u5fc3\u8df3\u68c0\u6d4b\uff0c\u90a3\u5c31\u4e0d\u8981\u6267\u884c\u5269\u4e0b\u7684\u4ee3\u7801\nif string(buffer[0:n]) == \"1\" {\nc.Write([]byte(\"1\"))\ncontinue\n}\nfor conn, heart := range ConnSlice {\nif conn == c {\ncontinue\n}\n//\u5fc3\u8df3\u68c0\u6d4b \u4f7f\u7528\u61d2\u60f0\u66f4\u65b0,\u9700\u8981\u53d1\u9001\u6570\u636e\u7684\u65f6\u5019\u624d\u68c0\u67e5\u89c4\u5b9a\u65f6\u95f4\u5185\u6709\u6ca1\u6709\u6570\u636e\u5230\u8fbe\nif heart.endTime &lt; time.Now().Unix() {\ndelete(ConnSlice, conn) //\u4ece\u623f\u95f4\u5217\u8868\u4e2d\u5220\u9664\u8fde\u63a5\uff0c\u5e76\u4e14\u5173\u95ed\nconn.Close()\nfmt.Println(\"\u5220\u9664\u8fde\u63a5\", conn.RemoteAddr())\nfmt.Println(\"\u73b0\u5728\u5b58\u6709\u94fe\u63a5\", ConnSlice)\ncontinue\n}\nconn.Write(buffer[0:n])\n}\n}\n}\n</code></pre> <p><code>client/main.go</code></p> <pre><code>package main\nimport (\n\"bufio\"\n\"fmt\"\n\"net\"\n\"os\"\n\"time\"\n)\nfunc main() {\nserver := \"127.0.0.1:8086\"\ntcpAddr, err := net.ResolveTCPAddr(\"tcp4\", server)\nif err != nil {\nLog(os.Stderr, \"Fatal error:\", err.Error())\nos.Exit(1)\n}\nconn, err := net.DialTCP(\"tcp\", nil, tcpAddr)\nif err != nil {\nLog(\"Fatal error:\", err.Error())\nos.Exit(1)\n}\nLog(conn.RemoteAddr().String(), \"connect success!\")\nSender(conn)\nLog(\"end\")\n}\nfunc Sender(conn *net.TCPConn) {\ndefer conn.Close()\nsc := bufio.NewReader(os.Stdin)\ngo func() {\nt := time.NewTicker(time.Second) //\u521b\u5efa\u5b9a\u65f6\u5668,\u7528\u6765\u5b9e\u73b0\u5b9a\u671f\u53d1\u9001\u5fc3\u8df3\u5305\u7ed9\u670d\u52a1\u7aef\ndefer t.Stop()\nfor {\n&lt;-t.C\n_, err := conn.Write([]byte(\"1\"))\nif err != nil {\nfmt.Println(err.Error())\nreturn\n}\n}\n}()\nname := \"\"\nfmt.Println(\"\u8bf7\u8f93\u5165\u804a\u5929\u6635\u79f0\") //\u7528\u6237\u804a\u5929\u7684\u6635\u79f0\nfmt.Fscan(sc, &amp;name)\nmsg := \"\"\nbuffer := make([]byte, 1024)\n_t := time.NewTimer(time.Second * 5) //\u521b\u5efa\u5b9a\u65f6\u5668,\u6bcf\u6b21\u670d\u52a1\u7aef\u53d1\u9001\u6d88\u606f\u5c31\u5237\u65b0\u65f6\u95f4\ndefer _t.Stop()\ngo func() {\n&lt;-_t.C\nfmt.Println(\"\u670d\u52a1\u5668\u51fa\u73b0\u6545\u969c\uff0c\u65ad\u5f00\u94fe\u63a5\")\nreturn\n}()\nfor {\ngo func() {\nfor {\nn, err := conn.Read(buffer)\nif err != nil {\nreturn\n}\n_t.Reset(time.Second * 5)       //\u6536\u5230\u6d88\u606f\u5c31\u5237\u65b0_t\u5b9a\u65f6\u5668\uff0c\u5982\u679ctime.Second*5\u65f6\u95f4\u5230\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a&lt;-_t.C\u5c31\u4e0d\u4f1a\u963b\u585e\uff0c\u4ee3\u7801\u4f1a\u5f80\u4e0b\u8d70\uff0creturn\u7ed3\u675f\nif string(buffer[0:1]) != \"1\" { //\u5fc3\u8df3\u5305\u6d88\u606f\u5b9a\u4e49\u4e3a\u5b57\u7b26\u4e32\"1\",\u4e0d\u9700\u8981\u6253\u5370\u51fa\u6765\nfmt.Println(string(buffer[0:n]))\n}\n}\n}()\nfmt.Fscan(sc, &amp;msg)\ni := time.Now().Format(\"2006-01-02 15:04:05\")\nconn.Write([]byte(fmt.Sprintf(\"%s\\n\\t%s: %s\", i, name, msg))) //\u53d1\u9001\u6d88\u606f\n}\n}\nfunc Log(v ...interface{}) {\nfmt.Println(v...)\nreturn\n}\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/","title":"Go RPC\u7f16\u7a0b","text":""},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/#1\u4ec0\u4e48\u662frpc","title":"1.\u4ec0\u4e48\u662fRPC","text":"<p>\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff08Remote Procedure Call\uff0c\u7f29\u5199\u4e3a RPC\uff09\u662f\u4e00\u4e2a\u8ba1\u7b97\u673a\u901a\u4fe1\u534f\u8bae\u3002</p> <p>\u8be5\u534f\u8bae\u5141\u8bb8\u8fd0\u884c\u4e8e\u4e00\u53f0\u8ba1\u7b97\u673a\u7684\u7a0b\u5e8f\u8c03\u7528\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u7684\u5b50\u7a0b\u5e8f\uff0c\u800c\u7a0b\u5e8f\u5458\u65e0\u9700\u989d\u5916\u5730\u4e3a\u8fd9\u4e2a\u4ea4\u4e92\u4f5c\u7528\u7f16\u7a0b\u3002 </p> <p>\u5982\u679c\u6d89\u53ca\u7684\u8f6f\u4ef6\u91c7\u7528\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\uff0c\u90a3\u4e48\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u4ea6\u53ef\u79f0\u4f5c\u8fdc\u7a0b\u8c03\u7528\u6216\u8fdc\u7a0b\u65b9\u6cd5\u8c03\u7528\u3002</p> <p>\u7528\u901a\u4fd7\u6613\u61c2\u7684\u8bed\u8a00\u63cf\u8ff0\u5c31\u662f\uff1aRPC\u5141\u8bb8\u8de8\u673a\u5668\u3001\u8de8\u8bed\u8a00\u8c03\u7528\u8ba1\u7b97\u673a\u7a0b\u5e8f\u65b9\u6cd5\u3002</p> <p>\u6253\u4e2a\u6bd4\u65b9\uff0c\u6211\u7528go\u8bed\u8a00\u5199\u4e86\u4e2a\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u65b9\u6cd5getUserInfo\uff0c\u5e76\u628ago\u7a0b\u5e8f\u90e8\u7f72\u5728\u963f\u91cc\u4e91\u670d\u52a1\u5668\u4e0a\u9762\uff0c\u73b0\u5728\u6211\u6709\u4e00\u4e2a\u90e8\u7f72\u5728\u817e\u8baf\u4e91\u4e0a\u9762\u7684php\u9879\u76ee\uff0c\u9700\u8981\u8c03\u7528golang\u7684getUserInfo\u65b9\u6cd5\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0cphp\u8de8\u673a\u5668\u8c03\u7528go\u65b9\u6cd5\u7684\u8fc7\u7a0b\u5c31\u662fRPC\u8c03\u7528\u3002</p> <p>\u5f53\u4e00\u4e2a\u7535\u5546\u7cfb\u7edf\u4e1a\u52a1\u53d1\u5c55\u5230\u4e00\u5b9a\u7a0b\u5ea6\u65f6\uff0c\u5176\u8026\u5408\u5ea6\u5f80\u5f80\u5f88\u9ad8\uff0c\u6025\u9700\u8981\u89e3\u8026\u3002\u8fd9\u65f6\u53ef\u4ee5\u8003\u8651\u5c06\u7cfb \u7edf\u62c6\u5206\u6210\u7528\u6237\u670d\u52a1\u3001\u5546\u54c1\u670d\u52a1\u3001\u652f\u4ed8\u670d\u52a1\u3001\u8ba2\u5355\u670d\u52a1\u3001\u7269\u6d41\u670d\u52a1\u3001\u552e\u540e\u670d\u52a1\u7b49\u591a\u4e2a\u72ec\u7acb\u7684\u670d\u52a1\u3002</p> <p>\u8fd9\u4e9b\u670d\u52a1\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u8c03\u7528\uff0c\u540c\u65f6\u6bcf\u4e2a\u670d\u52a1\u90fd\u53ef\u4ee5\u72ec\u7acb\u90e8\u7f72\uff0c\u72ec\u7acb\u4e0a\u7ebf\u3002\u8fd9\u65f6\u5185\u90e8\u8c03\u7528\u6700\u597d\u4f7f\u7528RPC\u3002</p> <p>RPC\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u670d\u52a1\u4e0e\u670d\u52a1\u4e4b\u95f4\u7684\u8c03\u7528\u95ee\u9898\u3002</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/#2golang\u4e2d\u5982\u4f55\u5b9e\u73b0rpc","title":"2.golang\u4e2d\u5982\u4f55\u5b9e\u73b0RPC","text":"<p>\u5728golang\u4e2d\u5b9e\u73b0RPC\u975e\u5e38\u7b80\u5355\uff0c\u6709\u5c01\u88c5\u597d\u7684\u5b98\u65b9\u5e93\u548c\u4e00\u4e9b\u7b2c\u4e09\u65b9\u5e93\u63d0\u4f9b\u652f\u6301\u3002</p> <p>Go RPC\u53ef\u4ee5\u5229\u7528tcp\u6216http\u6765\u4f20\u9012\u6570\u636e\uff0c\u53ef\u4ee5\u5bf9\u8981\u4f20\u9012\u7684\u6570\u636e\u4f7f\u7528\u591a\u79cd\u7c7b\u578b\u7684\u7f16\u89e3\u7801\u65b9\u5f0f\u3002</p> <ul> <li> <p>gob\u7f16\u7801RPC</p> </li> <li> <p>Json\u7f16\u7801RPC</p> </li> <li> <p>\u5176\u4ed6\u4e09\u65b9RPC\u5e93</p> </li> </ul> <p>golang\u5b98\u65b9\u7684<code>net/rpc</code>\u5e93\u4f7f\u7528<code>encoding/gob</code>\u8fdb\u884c\u7f16\u89e3\u7801\uff0c\u652f\u6301<code>tcp</code>\u6216<code>http</code>\u6570\u636e\u4f20\u8f93\u65b9\u5f0f\uff0c\u7531\u4e8e\u5176\u4ed6\u8bed\u8a00\u4e0d\u652f\u6301<code>gob</code>\u7f16\u89e3\u7801\u65b9\u5f0f\uff0c\u6240\u4ee5\u4f7f\u7528<code>net/rpc</code>\u5e93\u5b9e\u73b0\u7684RPC\u65b9\u6cd5\u6ca1\u529e\u6cd5\u8fdb\u884c\u8de8\u8bed\u8a00\u8c03\u7528\u3002</p> <p>golang\u5b98\u65b9\u8fd8\u63d0\u4f9b\u4e86<code>net/rpc/jsonrpc</code>\u5e93\u5b9e\u73b0RPC\u65b9\u6cd5\uff0cJSON RPC\u91c7\u7528JSON\u8fdb\u884c\u6570\u636e\u7f16\u89e3\u7801\uff0c\u56e0\u800c\u652f\u6301\u8de8\u8bed\u8a00\u8c03\u7528\u3002</p> <p>\u4f46\u76ee\u524d\u7684jsonrpc\u5e93\u662f\u57fa\u4e8etcp\u534f\u8bae\u5b9e\u73b0\u7684\uff0c\u6682\u65f6\u4e0d\u652f\u6301\u4f7f\u7528http\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002</p> <p>\u9664\u4e86golang\u5b98\u65b9\u63d0\u4f9b\u7684rpc\u5e93\uff0c\u8fd8\u6709\u8bb8\u591a\u7b2c\u4e09\u65b9\u5e93\u4e3a\u5728golang\u4e2d\u5b9e\u73b0RPC\u63d0\u4f9b\u652f\u6301\uff0c\u5927\u90e8\u5206\u7b2c\u4e09\u65b9rpc\u5e93\u7684\u5b9e\u73b0\u90fd\u662f\u4f7f\u7528<code>protobuf</code>\u8fdb\u884c\u6570\u636e\u7f16\u89e3\u7801\uff0c\u6839\u636e<code>protobuf</code>\u58f0\u660e\u6587\u4ef6\u81ea\u52a8\u751f\u6210rpc\u65b9\u6cd5\u5b9a\u4e49\u4e0e\u670d\u52a1\u6ce8\u518c\u4ee3\u7801\uff0c \u5728golang\u4e2d\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u8fdb\u884crpc\u670d\u52a1\u8c03\u7528\u3002</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/#21-gob\u7f16\u7801rpc","title":"2.1 gob\u7f16\u7801RPC","text":"<p><code>server/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n\"net/rpc\"\n)\ntype Algorithm int\n//\u53c2\u6570\u7ed3\u6784\u4f53\ntype Args struct {\nX, Y int\n}\n//\u53c2\u6570\u7ed3\u6784\u4f53\n//type Response int\n//\u5b9a\u4e49\u4e00\u4e2a\u65b9\u6cd5\u6c42\u4e24\u4e2a\u6570\u7684\u548c\n//\u8be5\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u8f93\u5165\u53c2\u6570\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u8fd4\u56de\u503c\nfunc (t *Algorithm) Sum(args *Args, reply *int) error {\n*reply = args.X + args.Y\nfmt.Println(\"Exec Sum \", reply)\nreturn nil\n}\nfunc main() {\n//\u5b9e\u4f8b\u5316\nalgorithm := new(Algorithm)\nfmt.Println(\"Algorithm start\", algorithm)\n//\u6ce8\u518c\u670d\u52a1\nrpc.Register(algorithm)\nrpc.HandleHTTP()\nif err := http.ListenAndServe(\":8808\", nil); err != nil {\nfmt.Println(\"err=====\", err.Error())\n}\n}\n</code></pre> <p><code>client/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"net/rpc\"\n\"os\"\n\"strconv\"\n)\n//\u53c2\u6570\u7ed3\u6784\u4f53\ntype ArgsTwo struct {\nX, Y int\n}\nfunc main() {\nclient, err := rpc.DialHTTP(\"tcp\", \"127.0.0.1:8808\")\nif err != nil {\nlog.Fatal(\"\u5728\u8fd9\u91cc\u5730\u65b9\u53d1\u751f\u9519\u8bef\u4e86: DialHTTP\", err)\n}\n//\u83b7\u53d6\u7b2c\u4e00\u4e2a\u8f93\u5165\u503c\ni1, _ := strconv.Atoi(os.Args[1])\n//\u83b7\u53d6\u7b2c\u4e8c\u4e2a\u8f93\u5165\u503c\ni2, _ := strconv.Atoi(os.Args[2])\nargs := ArgsTwo{i1, i2}\nvar reply int\n//\u8c03\u7528\u547d\u540d\u51fd\u6570\uff0c\u7b49\u5f85\u5b83\u5b8c\u6210\uff0c\u5e76\u8fd4\u56de\u5176\u9519\u8bef\u72b6\u6001\u3002\nerr = client.Call(\"Algorithm.Sum\", args, &amp;reply)\nif err != nil {\nlog.Fatal(\"Call Sum algorithm error:\", err)\n}\nfmt.Printf(\"Algorithm \u548c\u4e3a: %d+%d=%d\\n\", args.X, args.Y, reply)\n}\n</code></pre> <p>\u6267\u884c\u7ed3\u679c</p> <pre><code># server\n$ go run main.go\nAlgorithm start 0xc00000ead8\nExec Sum  0xc00000ed10\n\n# client\n$ go run main.go 10 20\nAlgorithm \u548c\u4e3a: 10+20=30\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/#23-json\u7f16\u7801rpc","title":"2.3 Json\u7f16\u7801RPC","text":"<p>JSON\u7f16\u7801RPC\u662f\u6307\uff0c\u6570\u636e\u7f16\u7801\u91c7\u7528\u4e86JSON\u683c\u5f0f\u7684RPC\u3002\u63a5\u4e0b\u6765\u540c\u6837\u901a\u8fc7\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u7684\u4f8b\u5b50\u6765\u8bb2\u89e3\u3002</p> <p><code>server/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"net\"\n\"net/rpc\"\n\"net/rpc/jsonrpc\"\n)\n//\u4f7f\u7528Go\u63d0\u4f9b\u7684net/rpc/jsonrpc\u6807\u51c6\u5305\nfunc init() {\nfmt.Println(\"JSON\u7f16\u7801RPC,\u4e0d\u662fgob\u7f16\u7801,\u5176\u4ed6\u7684\u548cRPC\u6982\u5ff5\u4e00\u6a21\u4e00\u6837\u3002\")\n}\ntype ArgsLanguage struct {\nJava, Go string\n}\ntype Programmer string\nfunc (m *Programmer) GetSkill(al *ArgsLanguage, skill *string) error {\n*skill = \"Skill1:\" + al.Java + \",Skill2:\" + al.Go\nreturn nil\n}\nfunc main() {\n//\u5b9e\u4f8b\u5316\nstr := new(Programmer)\n//\u6ce8\u518c\u670d\u52a1\nrpc.Register(str)\ntcpAddr, err := net.ResolveTCPAddr(\"tcp\", \":8085\")\nif err != nil {\nfmt.Println(\"ResolveTCPAddr err=\", err)\n}\nlistener, err := net.ListenTCP(\"tcp\", tcpAddr)\nif err != nil {\nfmt.Println(\"tcp listen err=\", err)\n}\nfor {\nconn, err := listener.Accept()\nif err != nil {\ncontinue\n}\njsonrpc.ServeConn(conn)\n}\n}\n</code></pre> <p><code>client/main.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"net/rpc/jsonrpc\"\n)\n// \u53c2\u6570\u7ed3\u6784\u4f53\u53ef\u4ee5\u548c\u670d\u52a1\u7aef\u4e0d\u4e00\u6837\n// \u4f46\u662f\u7ed3\u6784\u4f53\u91cc\u7684\u5b57\u6bb5\u5fc5\u987b\u4e00\u6837\ntype Send struct {\nJava, Go string\n}\nfunc main() {\nfmt.Println(\"client start......\")\nclient, err := jsonrpc.Dial(\"tcp\", \"127.0.0.1:8085\")\nif err != nil {\nlog.Fatal(\"Dial err=\", err)\n}\nsend := Send{\"Java\", \"Go\"}\nvar receive string\nerr = client.Call(\"Programmer.GetSkill\", send, &amp;receive)\nif err != nil {\nfmt.Println(\"Call err=\", err)\n}\nfmt.Println(\"receive\", receive)\n}\n</code></pre> <p>\u8f93\u51fa</p> <pre><code># server\n$ go run main.go\nJSON\u7f16\u7801RPC,\u4e0d\u662fgob\u7f16\u7801,\u5176\u4ed6\u7684\u548cRPC\u6982\u5ff5\u4e00\u6a21\u4e00\u6837\u3002\n\n# client\n$ go run main.go\nclient start......\nreceive Skill1:Java,Skill2:Go\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/18.Go-RPC%E7%BC%96%E7%A8%8B/#3\u53c2\u8003\u6587\u732e","title":"3.\u53c2\u8003\u6587\u732e","text":"<p>go\u6846\u67b6 net/rpc</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/","title":"Go \u5fae\u670d\u52a1","text":""},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#\u4ec0\u4e48\u662f\u5fae\u670d\u52a1","title":"\u4ec0\u4e48\u662f\u5fae\u670d\u52a1","text":"<p>\uff081\uff09\u5fae\u670d\u52a1\u5c31\u662f\u4e00\u79cd\u67b6\u6784\u98ce\u683c</p> <p>\uff082\uff09\u5fae\u670d\u52a1\u5c31\u662f\u628a\u4e00\u4e2a\u9879\u76ee\u62c6\u5206\u6210\u72ec\u7acb\u7684\u591a\u4e2a\u670d\u52a1\uff0c\u5e76\u4e14\u591a\u4e2a\u670d\u52a1\u662f\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\u7684\uff0c\u800c\u6bcf\u4e2a\u670d\u52a1\u90fd\u4f1a\u5360\u7528\u7ebf\u7a0b\u3002</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#\u5fae\u670d\u52a1","title":"\u5fae\u670d\u52a1","text":"<p>\u5fae\u670d\u52a1\u7684\u51fa\u73b0\u5c31\u662f\u56e0\u4e3a\u5355\u4f53\u5e94\u7528\u67b6\u6784\u5df2\u7ecf\u65e0\u6cd5\u6ee1\u8db3\u5f53\u524d\u4e92\u8054\u7f51\u4ea7\u54c1\u7684\u6280\u672f\u9700\u6c42\u3002</p> <p>\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e4b\u524d\u8fd8\u6709\u4e00\u4e2a\u6982\u5ff5\uff1aSOA\uff08Service-Oriented Architecture,\u9762\u5411\u670d\u52a1\u7684\u4f53\u7cfb\u67b6\u6784)\u3002</p> <p>\u4ece\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u6765\u8bf4\uff0cS\u25cbA\u53ea\u662f\u4e00\u4e2a\u67b6\u6784\u6a21\u578b\u7684\u65b9\u6cd5\u8bba\uff0c\u5e76\u4e0d\u662f\u4e00\u4e2a\u660e\u786e\u800c\u4e25\u8c28\u7684\u67b6\u6784\u6807\u51c6\u3002SOA\u5df2\u7ecf\u63d0\u51fa\u4e86\u9762\u5411\u670d\u52a1\u7684\u67b6\u6784\u601d\u60f3\uff0c\u6240\u4ee5\u4e25\u683c\u610f\u4e49\u4e0a\u8bf4\uff0c\u5176\u5b9e\u5fae\u670d\u52a1\u5e94\u8be5\u7b97\u662fSOA\u7684\u4e00\u79cd\u6f14\u8fdb\u3002</p> <p>\u5355\u4f53\u5e94\u7528\u67b6\u6784\u548c\u5fae\u670d\u52a1\u67b6\u6784\u5bf9\u6bd4\u5982\u56fe5-11\u6240\u793a\u3002</p> <p></p> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u5173\u4e8e\u5fae\u670d\u52a1\u7684\u6982\u5ff5\uff0c\u6ca1\u6709\u7edf\u4e00\u7684\u5b98\u65b9\u5b9a\u4e49\u3002\u6487\u5f00\u67b6\u6784\u5148\u4e0d\u8bf4\uff0c\u4ec0\u4e48\u6837\u7684\u670d\u52a1\u624d\u7b97\u5fae \u670d\u52a1\u5462\uff1f\u4e00\u822c\u6765\u8bf4\uff0c\u5fae\u670d\u52a1\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u70b9\u3002</p> <ul> <li> <p>\u5355\u4e00\u804c\u8d23\uff1a\u4e00\u4e2a\u5fae\u670d\u52a1\u5e94\u8be5\u662f\u5177\u6709\u5355\u4e00\u804c\u8d23\u7684\uff0c\u8fd9\u624d\u662f\u201c\u5fae\u201d\u7684\u4f53\u73b0\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a\u5fae\u670d\u52a1\u7528\u6765\u89e3\u51b3\u4e00\u4e2a\u4e1a\u52a1\u95ee\u9898\uff0c\u5c3d\u91cf\u4fdd\u6301\u5176\u72ec\u7acb\u6027\u3002</p> </li> <li> <p>\u9762\u5411\u670d\u52a1\uff1a\u5c06\u81ea\u5df1\u7684\u4e1a\u52a1\u80fd\u529b\u5c01\u88c5\u5e76\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u8fd9\u662f\u7ee7\u627fSOA\u7684\u6838\u5fc3\u601d\u60f3\u3002\u4e00\u4e2a\u5fae\u670d\u52a1\u672c\u8eab\u4e5f\u53ef\u80fd\u5177\u6709\u4f7f\u7528\u5176\u4ed6\u5fae\u670d\u52a1\u7684\u80fd\u529b\u3002</p> </li> </ul> <p>\u4e00\u822c\u6ee1\u8db3\u4ee5\u4e0a\u4e24\u70b9\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u5176\u662f\u4e00\u4e2a\u5fae\u670d\u52a1\u3002</p> <p>\u5fae\u670d\u52a1\u67b6\u6784\u4e0e\u5355\u4f53\u5e94\u7528\u67b6\u6784\u5341\u5206\u4e0d\u540c\uff1a</p> <ol> <li> <p>\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u6bcf\u4e2a\u670d\u52a1\u90fd\u9700\u72ec\u7acb\u8fd0\u884c\uff0c\u8981\u907f\u514d\u4e0e\u5176\u4ed6\u670d\u52a1\u7684\u8026\u5408\u5173\u7cfb\uff1b</p> </li> <li> <p>\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u6bcf\u4e2a\u670d\u52a1\u90fd\u8981\u80fd\u591f\u81ea\u4e3b\u4e00\u5728\u5176\u4ed6\u670d\u52a1\u53d1\u751f\u9519\u8bef\u65f6\u4e0d\u53d7\u5e72\u6270\u3002</p> </li> </ol>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#\u5fae\u670d\u52a1\u5178\u578b\u67b6\u6784","title":"\u5fae\u670d\u52a1\u5178\u578b\u67b6\u6784","text":"<p>\u5e94\u7528\u5fae\u670d\u52a1\u5316\u4e4b\u540e\uff0c\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u670d\u52a1\u53d1\u73b0\u95ee\u9898\uff1a</p> <p>\u4e00\u4e2a\u5fae\u670d\u52a1\u5982\u4f55\u53d1\u73b0\u5176\u4ed6\u5fae\u670d\u52a1\u3002\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\uff1a\u5728\u6bcf\u4e2a\u5fae\u670d\u52a1\u91cc\u914d\u7f6e\u5176\u4ed6\u5fae\u670d\u52a1\u7684\u5730\u5740\u3002</p> <p>\u4f46\u662f\u5f53\u5fae\u670d\u52a1\u6570\u91cf\u4f17\u591a\u65f6\uff0c\u8fd9\u6837\u505a\u660e\u663e\u4e0d\u73b0\u5b9e\u3002\u6240\u4ee5\u9700\u8981\u7528\u5230\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u4e00\u4e2a\u6700\u91cd\u8981\u7684\u7ec4\u4ef6\u4e00\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u3002\u6240\u6709\u670d\u52a1\u90fd\u88ab\u6ce8\u518c\u5230\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\uff0c\u540c\u65f6\u53ef\u4ee5 \u4ece\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u83b7\u53d6\u5f53\u524d\u53ef\u7528\u7684\u670d\u52a1\u6e05\u5355\u3002</p> <p>\u670d\u52a1\u6ce8\u518c\u4e0e\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u7684\u5173\u7cfb\u5982\u56fe5-12\u6240\u793a\uff1a</p> <p></p> <p>\u63a5\u7740\u9700\u8981\u89e3\u51b3\u5fae\u670d\u52a1\u5206\u5e03\u5f0f\u90e8\u7f72\u5e26\u6765\u7684\u7b2c2\u4e2a\u95ee\u9898\uff1a\u670d\u52a1\u914d\u7f6e\u7ba1\u7406\u7684\u95ee\u9898\u3002\u5f53\u670d\u52a1\u8d85\u8fc7\u4e00\u5b9a\u6570\u91cf\u540e\uff0c\u5982\u679c\u9700\u8981\u5728\u6bcf\u4e2a\u670d\u52a1\u4e2d\u5206\u522b\u7ef4\u62a4\u5176\u914d\u7f6e\u6587\u4ef6\uff0c\u5219\u8fd0\u7ef4\u4eba\u5458\u7684\u4eba\u529b\u6210\u672c\u4f1a\u6025\u5267\u4e0a\u5347\u3002</p> <p>\u6b64\u65f6\u5c31\u9700\u8981\u7528\u5230\u5fae\u670d\u52a1\u67b6\u6784\u91cc\u9762\u7b2c2\u4e2a\u91cd\u8981\u7684\u7ec4\u4ef6\u4e00\u914d\u7f6e\u4e2d\u5fc3\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u6216\u5916\u90e8\u5e94\u7528\u8c03\u7528\u670d\u52a1\u65f6\u8be5\u600e\u4e48\u5904\u7406\u5462\uff1f\u670d\u52a11\u53ef\u80fd\u6709\u591a\u4e2a\u8282\u70b9\uff0c\u670d\u52a11\u3001\u670d\u52a12\u548c\u670d\u52a13\u7684\u670d\u52a1\u5730\u5740\u90fd\u4e0d\u540c\uff0c\u670d\u52a1\u6388\u6743\u9a8c\u8bc1\u5e94\u8be5\u5728\u54ea\u91cc\u505a\uff1f</p> <p>\u8fd9\u65f6\u5c31\u9700\u8981\u4f7f\u7528\u5230\u670d\u52a1\u7f51\u5173\u63d0\u4f9b\u7edf\u4e00\u7684\u670d\u52a1\u5165\u53e3\uff0c\u6700\u7ec8\u5f62\u6210\u7684\u5178\u578b\u5fae\u670d\u52a1\u67b6\u6784\u5982\u56fe5-13\u6240\u793a\u3002</p> <p></p> <p>\u56fe5-13\u662f\u4e00\u4e2a\u5178\u578b\u7684\u5fae\u670d\u52a1\u67b6\u6784\u3002\u5f53\u7136\u5fae\u670d\u52a1\u7684\u670d\u52a1\u6cbb\u7406\u8fd8\u6d89\u53ca\u5f88\u591a\u5185\u5bb9\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u901a\u8fc7\u7194\u65ad\u3001\u9650\u6d41\u7b49\u673a\u5236\u4fdd\u8bc1\u9ad8\u53ef\u7528\uff1b</li> <li>\u5fae\u670d\u52a1\u4e4b\u95f4\u8c03\u7528\u7684\u8d1f\u8f7d\u5747\u8861\uff1b</li> <li>\u5206\u5e03\u5f0f\u4e8b\u52a1(2PC\u30013PC\u3001TCC\u3001LCN\u7b49)\uff1b</li> <li>\u670d\u52a1\u8c03\u7528\u94fe\u8ddf\u8e2a\u7b49\u3002</li> </ul> <p>\u4ee5\u4e0a\u5178\u578b\u7684\u5fae\u670d\u52a1\u67b6\u6784\u53ea\u662f\u4f17\u591a\u5fae\u670d\u52a1\u67b6\u6784\u7684\u4e00\u79cd\u3002\u5fae\u670d\u52a1\u67b6\u6784\u4e0d\u662f\u552f\u4e00\u7684\uff0c\u5b83\u9700\u8981\u6839\u636e\u4f01\u4e1a\u81ea\u8eab\u7684\u5177\u4f53\u60c5\u51b5\u8fdb\u884c\u9488\u5bf9\u6027\u7684\u90e8\u7f72\u3002</p> <p>\u53c2\u8003\u6587\u732e\uff1a</p> <p>https://www.topgoer.cn/docs/golang//1091</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#\u5b9e\u6218-\u7528grpc\u6846\u67b6\u6784\u5efa\u4e00\u4e2a\u7b80\u6613\u7684\u5fae\u670d\u52a1","title":"\u5b9e\u6218-\u7528gRPC\u6846\u67b6\u6784\u5efa\u4e00\u4e2a\u7b80\u6613\u7684\u5fae\u670d\u52a1","text":""},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#1\u4ec0\u4e48\u662fgrpc\u6846\u67b6","title":"1.\u4ec0\u4e48\u662fgRPC\u6846\u67b6","text":"<p>gRPC\u662f\u8c37\u6b4c\u5f00\u6e90\u7684\u4e00\u6b3e\u8de8\u5e73\u53f0\u3001\u9ad8\u6027\u80fd\u7684RPC\u6846\u67b6\uff0c\u5b83\u53ef\u4ee5\u5728\u4efb\u4f55\u73af\u5883\u4e0b\u8fd0\u884c\u3002</p> <p>\u5728\u5b9e\u9645\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8981\u4f7f\u7528\u5b83\u6765\u8fdb\u884c\u540e\u7aef\u5fae\u670d\u52a1\u7684\u5f00\u53d1\u3002</p> <p>\u5728gRPC\u6846\u67b6\u4e2d\uff0c\u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u50cf\u672c\u5730\u5bf9\u8c61\u90a3\u6837\u76f4\u63a5\u8c03\u7528\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u7684\u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u65b9\u6cd5\uff0c\u4ece\u800c\u66f4\u5bb9\u6613\u5730\u521b\u5efa\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u3002</p> <p>\u4e0e\u8bb8\u591aRPC\u7cfb\u7edf\u4e00\u6837\uff0cgRPC\u6846\u67b6\u57fa\u4e8e\u5b9a\u4e49\u670d\u52a1\u7684\u601d\u60f3\uff0c\u901a\u8fc7\u8bbe\u7f6e\u53c2\u6570\u548c\u8fd4\u56de\u7c7b\u578b\u6765\u8fdc\u7a0b\u8c03\u7528\u65b9\u6cd5\u3002</p> <p>\u5728\u670d\u52a1\u5668\u7aef\uff0c\u5b9e\u73b0\u8fd9\u4e2a\u63a5\u53e3\u5e76\u8fd0\u884cgRPC\u670d\u52a1\u5668\u4ee5\u5904\u7406\u5ba2\u6237\u7aef\u8c03\u7528\u3002</p> <p>\u5ba2\u6237\u7aef\u63d0\u4f9b\u65b9\u6cd5(\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u7aef\u7684\u65b9\u6cd5\u76f8\u540c)\u3002</p> <p>\u5982\u56fe5-14\u6240\u793a\uff0cgRPC\u7684\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u53ef\u4ee5\u5728\u5404\u79cd\u73af\u5883\u4e2d\u8fd0\u884c\u548c\u76f8\u4e92\u901a\u4fe1\uff0c\u5e76\u4e14\u53ef\u4ee5\u7528gRPC\u652f\u6301\u7684\u4efb\u4f55\u8bed\u8a00\u7f16\u5199\u3002</p> <p>\u56e0\u6b64\uff0c\u53ef\u4ee5\u7528Go\u8bed\u8a00\u521b\u5efa\u4e00\u4e2agRPC\u670d\u52a1\u5668\uff0c\u540c\u65f6\u4f9bPHP\u5ba2\u6237\u7aef\u548cAndroid\u5ba2\u6237\u7aef\u7b49\u591a\u4e2a\u5ba2\u6237\u7aef\u8c03\u7528\uff0c\u4ece\u800c\u7a81\u7834\u5f00\u53d1\u8bed\u8a00\u7684\u9650\u5236\u3002</p> <p></p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#2grpc\u7684\u4f7f\u7528","title":"2.gRPC\u7684\u4f7f\u7528","text":"<p>\u63a5\u4e0b\u6765\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528gRPC\u6846\u67b6\u642d\u5efa\u4e00\u4e2a\u57fa\u7840\u7684RPC\u9879\u76ee\u3002</p> <p>(1)\u5b89\u88c5protobuf.\u3002</p> <p>\u8981\u4f7f\u7528gRPC,\u5fc5\u987b\u5148\u5b89\u88c5protobuf\u3002protobuf\u7684\u5b89\u88c5\u65b9\u6cd5\u5f88\u7b80\u5355\u3002</p> <p>\u8fdb\u5165\u5b98\u65b9\u7f51\u7ad9\uff0c\u9009\u62e9\u5bf9\u5e94\u7cfb\u7edf\u7684\u7248\u672c\u8fdb\u884c\u4e0b\u8f7d\u3002</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#21-grpc\u5b89\u88c5","title":"2.1 grpc\u5b89\u88c5","text":"<p>grpc\u7684\u5b89\u88c5\u76f4\u63a5\u200b\u200bgo get\u200b\u200b\u5373\u53ef</p> <pre><code>go get google.golang.org/grpc\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#22-proto","title":"2.2 proto","text":"<p>\u4e0b\u8f7dproto\uff0c\u6211\u662f\u4e0b\u8f7d\u7684\u8fd9\u4e2a: proto\u4e0b\u8f7d\u5730\u5740\u3002</p> <p>\u7136\u540e\u89e3\u538b\u51fa\u6765\u628abin\u76ee\u5f55\u653e\u5728\u76f4\u63a5\u653e\u5728\u7cfb\u7edf\u53d8\u91cf\u5f53\u4e2d\u3002</p> <pre><code>$ protoc --version\nlibprotoc 3.6.1\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#23-protobuf","title":"2.3 protobuf","text":"<p>\u5728\u5b89\u88c5\u5b8cprotobuf\u7684\u5f00\u53d1\u73af\u5883\u540e\uff0c\u8fd8\u8981\u5b89\u88c5Go\u8bed\u8a00\u5bf9\u5e94\u7684protobuf\u5305\u3002\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u5728\u547d\u4ee4\u884c\u7ec8\u7aef\u4e2d\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>$ go get -u github.com/golang/protobuf/proto\n$ go get -u github.com/golang/protobuf/protoc-gen-go\n$ go install github.com/golang/protobuf/protoc-gen-go\n</code></pre> <p>\u5728\"go get\"\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u8fdb\u5165\u521a\u624d\u4e0b\u8f7d\u7684\u76ee\u5f55src/github.com/golang/protobuf\u4e2d\uff0c\u590d\u5236protoc-gen-go\u6587\u4ef6\u5939\u5230/usr/local/bin/\u76ee\u5f55\u4e2d\uff1a</p> <p><pre><code>cp-r protoc-gen-go /usr/local/bin/\n</code></pre> \u914d\u7f6e\u597d\u73af\u5883\u53d8\u91cf\u540e\uff0cGo\u8bed\u8a00protobuf\u5f00\u53d1\u73af\u5883\u5c31\u642d\u5efa\u5b8c\u6bd5\u4e86\u3002</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#24-\u5b9a\u4e49protobuf\u6587\u4ef6","title":"2.4 \u5b9a\u4e49protobuf\u6587\u4ef6","text":"<p>\u63a5\u4e0b\u6765\u5c31\u662f\u5b9a\u4e49protobuf\u6587\u4ef6\uff0c\u9996\u5148\uff0c\u65b0\u5efa\u4e00\u4e2a\u540d\u4e3aprogrammer.proto\u7684\u6587\u4ef6\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p>programmer.proto</p> <pre><code>syntax = \"proto3\";  // \u6307\u5b9a\u8bed\u6cd5\u683c\u5f0f\uff0c\u6ce8\u610f proto3 \u4e0d\u518d\u652f\u6301 proto2 \u7684 required \u548c optional\npackage  proto;      // \u6307\u5b9a\u751f\u6210\u7684programmer.pb.go \u7684\u5305\u540d\uff0c\u9632\u6b62\u547d\u540d\u51b2\u7a81\noption go_package = \"./\";\n\n// service \u5b9a\u4e49\u5f00\u653e\u8c03\u7528\u7684\u670d\u52a1\nservice  ProgrammerService {\n// rpc \u5b9a\u4e49\u670d\u52a1\u5185\u7684 GetProgrammerInfo \u8fdc\u7a0b\u8c03\u7528\n  rpc  GetProgrammerInfo (Request) returns (Response) {\n  }\n}\n// message \u5bf9\u5e94\u751f\u6210\u4ee3\u7801\u7684 struct\n// \u5b9a\u4e49\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6570\u636e\u683c\u5f0f\n\nmessage  Request {\n// [\u4fee\u9970\u7b26] \u7c7b\u578b \u5b57\u6bb5\u540d = \u6807\u8bc6\u7b26;\n  string  name = 1;\n}\n\n// \u5b9a\u4e49\u670d\u52a1\u7aef\u54cd\u5e94\u7684\u6570\u636e\u683c\u5f0f\nmessage  Response {\n  int32  uid = 1;\n  string  username = 2;\n  string  job = 3;\n  repeated  string  goodAt = 4;  // repeated \u4fee\u9970\u7b26\u8868\u793a\u5b57\u6bb5\u662f\u53ef\u53d8\u6570\u7ec4\uff0c\u5373 slice \u7c7b\u578b\n}\n</code></pre> <p>\u7136\u540e\u901a\u8fc7protoc\u547d\u4ee4\u7f16\u8bd1proto\u6587\u4ef6\uff0c\u5728programmer.proto\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u4e2d\u751f\u6210\u5bf9\u5e94\u7684go\u6587\u4ef6\u3002\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>$ protoc --go_out=plugins=grpc:. ./programmer.proto\n</code></pre> <p>\u5982\u679c\u8fd0\u884c\u6210\u529f\uff0c\u5219\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e2d\u751f\u6210\u4e00\u4e2a\u540d\u4e3aprogrammer.pb.go\u7684\u6587\u4ef6\u3002</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#25-\u670d\u52a1\u5668\u7aef\u4ee3\u7801\u7f16\u5199","title":"2.5 \u670d\u52a1\u5668\u7aef\u4ee3\u7801\u7f16\u5199\u3002","text":"<p>\u9996\u5148\u5e94\u8be5\u660e\u786e\u5b9e\u73b0\u7684\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u5b9e\u73b0GetProgrammerInfo\u63a5\u2610\uff1b</p> </li> <li> <p>\u4f7f\u7528gRPC\u5efa\u7acb\u670d\u52a1\uff0c\u76d1\u542c\u7aef\u53e3\uff1b</p> </li> <li> <p>\u5c06\u5b9e\u73b0\u7684\u670d\u52a1\u6ce8\u518c\u5230gRPC\u4e2d\u3002</p> </li> </ol> <p>\u670d\u52a1\u5668\u7aef\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <p><pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n\"net\"\n// \u5bfc\u5165\u751f\u6210\u597d\u7684 protobuf \u5305\npb \"gitee.com/hujianli94net/grpc_demo/protobuf\"\n\"golang.org/x/net/context\"\n\"google.golang.org/grpc\"\n)\n// \u5b9a\u4e49\u670d\u52a1\u7ed3\u6784\u4f53\ntype ProgrammerServiceServer struct{}\nfunc (p *ProgrammerServiceServer) GetProgrammerInfo(ctx context.Context, req *pb.Request) (resp *pb.Response, err error) {\nname := req.Name\nif name == \"shirdon\" {\nresp = &amp;pb.Response{\nUid:      6,\nUsername: name,\nJob:      \"CTO\",\nGoodAt:   []string{\"Go\", \"Java\", \"PHP\", \"Python\"},\n}\n}\nerr = nil\nreturn\n}\nfunc main() {\nport := \":8098\"\nl, err := net.Listen(\"tcp\", port)\nif err != nil {\nlog.Fatalf(\"listen error: %v\\n\", err)\n}\nfmt.Printf(\"listen %s\\n\", port)\ns := grpc.NewServer()\n// \u5c06 ProgrammerService \u6ce8\u518c\u5230 gRPC\n// \u6ce8\u610f\u7b2c\u4e8c\u4e2a\u53c2\u6570 ProgrammerServiceServer \u662f\u63a5\u53e3\u7c7b\u578b\u7684\u53d8\u91cf\n// \u9700\u8981\u53d6\u5730\u5740\u4f20\u53c2\npb.RegisterProgrammerServiceServer(s, &amp;ProgrammerServiceServer{})\ns.Serve(l)\n}\n</code></pre> \u5728\u5199\u597d\u670d\u52a1\u5668\u7aef\u4ee3\u7801\u540e\uff0c\u5728\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u4e0b\u6253\u5f00\u547d\u4ee4\u884c\u7ec8\u7aef\uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u542f\u52a8\u670d\u52a1\u5668\u7aef\uff1a</p> <pre><code>grpc_demo/server$ go run main.g\n</code></pre>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#26-\u5ba2\u6237\u7aef\u4ee3\u7801\u7f16\u5199","title":"2.6 \u5ba2\u6237\u7aef\u4ee3\u7801\u7f16\u5199","text":"<p>\u670d\u52a1\u5668\u7aef\u542f\u52a8\u540e\uff0c\u5c31\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5229\u7528gRPC\u521b\u5efa\u7684RPC\u670d\u52a1\u3002 \u4f46\u65e0\u6cd5\u76f4\u63a5\u8c03\u7528\u5b83\uff0c\u8fd8\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u8c03\u7528\u670d\u52a1\u5668\u7aef\u7684\u5ba2\u6237\u7aef\uff0c\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"log\"\n// \u5bfc\u5165\u751f\u6210\u597d\u7684 protobuf \u5305\npb \"gitee.com/hujianli94net/grpc_demo/protobuf\"\n\"golang.org/x/net/context\"\n\"google.golang.org/grpc\"\n)\nfunc main() {\nconn, err := grpc.Dial(\":8098\", grpc.WithInsecure())\nif err != nil {\nlog.Fatalf(\"dial error: %v\\n\", err)\n}\ndefer conn.Close()\n// \u5b9e\u4f8b\u5316 ProgrammerService\nclient := pb.NewProgrammerServiceClient(conn)\n// \u8c03\u7528\u670d\u52a1\nreq := new(pb.Request)\nreq.Name = \"shirdon\"\nresp, err := client.GetProgrammerInfo(context.Background(), req)\nif err != nil {\nlog.Fatalf(\"resp error: %v\\n\", err)\n}\nfmt.Printf(\"Recevied: %v\\n\", resp)\n}\n</code></pre> <p>\u5728\u5199\u597d\u5ba2\u6237\u7aef\u4ee3\u7801\u540e\uff0c\u5728\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u4e0b\u6253\u5f00\u547d\u4ee4\u884c\u7ec8\u7aef\uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u542f\u52a8\u5ba2\u6237\u7aef\uff1a</p> <pre><code>grpc_demo/client$ go run main.go\nRecevied: uid:6  username:\"shirdon\"  job:\"CTO\"  goodAt:\"Go\"  goodAt:\"Java\"  goodAt:\"PHP\"  goodAt:\"Python\n</code></pre> <p>\u5ba2\u6237\u7aef\u8c03\u7528\u670d\u52a1\u7aef\u65b9\u6cd5\u6210\u529f,\u5219\u8f93\u51fa\u5982\u4e0a\u5185\u5bb9\u3002</p> <p>\u81f3\u6b64\u6211\u4eec\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u4f7f\u7528gRPC\u8fdb\u884c\u7b80\u5355\u5fae\u670d\u52a1\u5f00\u53d1\u7684\u65b9\u6cd5\u3002G0\u8bed\u8a00\u5df2\u7ecf\u63d0\u4f9b\u4e86\u826f\u597d\u7684RPC\u652f\u6301\u3002\u901a\u8fc7gRPC,\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5f00\u53d1\u5206\u5e03\u5f0f\u7684Web\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u5b8c\u6574demo\u7a0b\u5e8f</p>"},{"location":"Golang/5.Go%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/19.Go-%E5%BE%AE%E6%9C%8D%E5%8A%A1/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<p>\u3010Go\u8bed\u8a00\u5b9e\u6218\u3011(9) gRPC \u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u5fae\u670d\u52a1</p> <p>go\u4f7f\u7528gRPC</p> <p>go\u4e0epy\u4f7f\u7528gRPC</p> <p>gRPC</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/","title":"\u5904\u7406\u76ee\u5f55\u4e0e\u6587\u4ef6","text":""},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#1\u64cd\u4f5c\u76ee\u5f55","title":"1.\u64cd\u4f5c\u76ee\u5f55","text":"<pre><code>import (\nos\npath\n)\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#11-\u521b\u5efa\u76ee\u5f55","title":"1.1 \u521b\u5efa\u76ee\u5f55","text":"<p>\u4f7f\u7528Mkdir\u51fd\u6570\u521b\u5efa\u76ee\u5f55\u793a\u4f8b\uff1a</p> <pre><code>//func Mkdir(name string, perm FileMode) error\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n//\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\u201ctest\u201d\u7684\u76ee\u5f55\uff0cperm\u6743\u9650\u4e3a0777\nerr := os.Mkdir(\"test\", 0777)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre> <p>\u4f7f\u7528MkdirAll\u51fd\u6570\u521b\u5efa\u591a\u7ea7\u76ee\u5f55\u793a\u4f8b\uff1a</p> <pre><code>//func MkdirAll(path string, perm FileMode) error\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n//\u6839\u636epath\u521b\u5efa\u591a\u7ea7\u5b50\u76ee\u5f55\uff0c\u4f8b\u5982dir1/dir2/dir3\nerr := os.MkdirAll(\"./dir1/dir2/dir3\", 0777)\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"time\"\n)\nfunc main()  {\nuploadDir := \"static/upload/\" + time.Now().Format(\"2006/01/02/\")\nerr := os.MkdirAll(uploadDir , 777)\nif err!=nil{\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#12-\u91cd\u547d\u540d\u76ee\u5f55","title":"1.2 \u91cd\u547d\u540d\u76ee\u5f55","text":"<p>Rename\u51fd\u6570\u91cd\u547d\u540d\u76ee\u5f55\u793a\u4f8b\uff1a</p> <pre><code>//func Rename(oldpath, newpath string) error\npackage main\nimport (\n\"fmt\"\n\"log\"\n\"os\"\n)\nfunc main() {\n//\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\u201cdir_name1\u201d\u7684\u76ee\u5f55\uff0cperm\u6743\u9650\u4e3a0777\nerr := os.Mkdir(\"dir_name1\", 0777)\nif err != nil {\nfmt.Println(err)\n}\noldName := \"dir_name1\"\nnewName := \"dir_name2\"\n//\u5c06dir_name1\u91cd\u547d\u540d\u4e3adir_name2\nerr = os.Rename(oldName, newName)\nif err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#13-\u5220\u9664\u76ee\u5f55","title":"1.3 \u5220\u9664\u76ee\u5f55","text":"<p>Remove\u51fd\u6570\u5220\u9664\u76ee\u5f55\u793a\u4f8b\uff1a</p> <pre><code>//func Remove(name string) error\n//\u975e\u7a7a\u76ee\u5f55\u51fa\u9519\npackage main\nimport (\n\"log\"\n\"os\"\n)\nfunc main() {\nerr := os.Remove(\"dir1\")\nif err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre> <p>RemoveAll\u51fd\u6570\u5220\u9664\u591a\u7ea7\u76ee\u5f55\u793a\u4f8b\uff1a</p> <pre><code>//func RemoveAll(name string) error\npackage main\nimport (\n\"log\"\n\"os\"\n)\nfunc main() {\n//\u5148\u521b\u5efa\u591a\u7ea7\u5b50\u76ee\u5f55\nos.MkdirAll(\"test1/test2/test3\", 0777)\n//\u5220\u9664test1\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\nerr := os.RemoveAll(\"test1\")\nif err != nil {\nlog.Fatal(err)\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#14-\u904d\u5386\u76ee\u5f55","title":"1.4 \u904d\u5386\u76ee\u5f55","text":"<p>path/filepath\u5305\u4e2d\u7684Walk\u51fd\u6570\u6765\u904d\u5386\u76ee\u5f55\u793a\u4f8b\uff1a</p> <pre><code>//func Walk(root string, walkFn WalkFunc) error\npackage main\nimport (\n\"fmt\"\n\"os\"\n\"path/filepath\"\n)\nfunc scan(path string, f os.FileInfo, err error) error {\nfmt.Printf(\"Scaned: %s\\n\", path)\nreturn nil\n}\nfunc main() {\n//\u6839\u636epath\u521b\u5efa\u591a\u7ea7\u5b50\u76ee\u5f55\uff0c\u4f8b\u5982dir1/dir2/dir3\nerr := os.MkdirAll(\"test_walk/dir2/dir3\", 0777)\nif err != nil {\nfmt.Println(err)\n}\nroot := `./test_walk`\nerr = filepath.Walk(root, scan)\nfmt.Printf(\"filepath.Walk() returned %v\\n\", err)\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#15-\u5e38\u7528\u64cd\u4f5c\u76ee\u5f55\u6c47\u603b","title":"1.5 \u5e38\u7528\u64cd\u4f5c\u76ee\u5f55\u6c47\u603b","text":"<p>\u64cd\u4f5c\u76ee\u5f55\u548c\u6587\u4ef6\u53ef\u4ee5\u6279\u91cf\u4fee\u6539\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u5982\u5783\u573e\u6587\u4ef6\u5b9a\u65f6\u6e05\u9664\u3001\u6570\u636e\u6587\u4ef6\u5907\u4efd\u3001\u7cfb\u7edf\u78c1\u76d8\u6e05\u7406\u7b49\u573a\u666f\uff0c \u5e38\u7528\u64cd\u4f5c\u5305\u62ec\u521b\u5efa\u6587\u4ef6\u3001\u521b\u5efa\u76ee\u5f55\u3001\u4fee\u6539\u6587\u4ef6\u6743\u9650\u3001\u4fee\u6539\u6587\u4ef6\u4fe1\u606f\u3001\u5220\u9664\u6587\u4ef6\u3001\u5220\u9664\u76ee\u5f55\u3001\u6587\u4ef6\u91cd\u547d\u540d\u3001\u6587\u4ef6\u8bfb\u5199\u3001\u5224\u65ad\u6587\u4ef6\u662f\u5426\u76f8\u540c\u7b49\uff0c\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"time\"\n)\n// \u64cd\u4f5c\u76ee\u5f55\u4e0e\u6587\u4ef6\nfunc main() {\n// \u83b7\u53d6\u5f53\u524d\u76ee\u5f55\ngw, _ := os.Getwd()\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u76ee\u5f55\uff1a%v\\n\", gw)\n// \u6539\u53d8\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\nos.Chdir(\"D:/\")\ngwn, _ := os.Getwd()\nfmt.Printf(\"\u6539\u53d8\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\uff1a%v\\n\", gwn)\n// \u521b\u5efa\u6587\u4ef6\uff0c\u7531\u4e8e\u5f53\u524d\u8def\u5f84\u6539\u4e3aD\u76d8\uff0c\u56e0\u6b64\u5728D\u76d8\u521b\u5efa\u6587\u4ef6\nf1, _ := os.Create(\"./1.txt\")\nf1.Close()\n// \u4fee\u6539\u6587\u4ef6\u6743\u9650\n// \u7b2c\u4e8c\u4e2a\u53c2\u6570mode\u5728Windows\u7cfb\u7edf\u4e0b\n// mode\u4e3a0200\u4ee3\u8868\u6240\u6709\u8005\u53ef\u5199\n// mode\u4e3a0400\u4ee3\u8868\u53ea\u8bfb\n// mode\u4e3a0600\u4ee3\u8868\u8bfb\u5199\nos.Chmod(\"D:/1.txt\", 0400)\n// \u4fee\u6539\u6587\u4ef6\u7684\u8bbf\u95ee\u65f6\u95f4\u548c\u4fee\u6539\u65f6\u95f4\nnows := time.Now().Add(time.Hour)\nos.Chtimes(\"D:/1.txt\", nows, nows)\n// \u628a\u5b57\u7b26\u4e32\u4e2d\u5e26${var}\u6216$var\u66ff\u6362\u6210\u6307\u5b9a\u6307\u7b26\u4e32\ns := \"\u4f60\u597d\uff0c${1}${2}$3\"\nfmt.Printf(os.Expand(s, func(k string) string {\nmapp := map[string]string{\n\"1\": \"\u6211\u662f\",\n\"2\": \"go\",\n\"3\": \"\u8bed\u8a00\",\n}\nreturn mapp[k]\n}))\n// \u521b\u5efa\u76ee\u5f55\nos.Mkdir(\"D:/abc\", os.ModePerm)\n// \u521b\u5efa\u591a\u7ea7\u76ee\u5f55\nos.MkdirAll(\"D:/abc/d/e/f\", os.ModePerm)\n// \u5220\u9664\u6587\u4ef6\u6216\u76ee\u5f55\nos.Remove(\"D:/abc/d/e/f\")\n// \u5220\u9664\u6307\u5b9a\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\nos.RemoveAll(\"D:/abc\")\n// \u91cd\u547d\u540d\u6587\u4ef6\nos.Rename(\"D:/1.txt\", \"D:/1_new.txt\")\n// \u5224\u65ad\u6587\u4ef6\u76f8\u540c\u3002Stat()\u83b7\u53d6\u6587\u4ef6\u4fe1\u606f\uff0cSameFile()\u5224\u65ad\u6587\u4ef6\u76f8\u540c\nf2, _ := os.Create(\"D:/2.txt\")\nfs2, _ := f2.Stat()\nf3, _ := os.Create(\"D:/3.txt\")\nfs3, _ := f3.Stat()\nfmt.Printf(\"f2\u548cf3\u662f\u5426\u540c\u4e00\u6587\u4ef6\uff1a%v\\n\", os.SameFile(fs2, fs3))\n// \u8fd4\u56de\u4e34\u65f6\u76ee\u5f55\nfmt.Printf(\"\u8fd4\u56de\u4e34\u65f6\u76ee\u5f55\uff1a%v\\n\", os.TempDir())\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#2\u521b\u5efa\u6587\u4ef6","title":"2.\u521b\u5efa\u6587\u4ef6","text":"<p>Create\u51fd\u6570\u521b\u5efa\u6587\u4ef6\u793a\u4f8b\uff1a</p> <pre><code>//func Create(name string) (*File, error)\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n// \u521b\u5efa\u6587\u4ef6\n//\u6587\u4ef6\u7684\u521b\u5efa\uff0cCreate\u4f1a\u6839\u636e\u4f20\u5165\u7684\u6587\u4ef6\u540d\u521b\u5efa\u6587\u4ef6\uff0c\u9ed8\u8ba4\u6743\u9650\u662f0666\nfp, err := os.Create(\"./demo.txt\") // \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u4f1a\u5c06\u6587\u4ef6\u6e05\u7a7a\u3002\nfmt.Println(fp, err)               // &amp;{0xc000054180} &lt;nil&gt;\nfmt.Printf(\"%T\", fp)               // *os.File \u6587\u4ef6\u6307\u9488\u7c7b\u578b\nif err != nil {\nfmt.Println(\"\u6587\u4ef6\u521b\u5efa\u5931\u8d25\u3002\")\n//\u521b\u5efa\u6587\u4ef6\u5931\u8d25\u7684\u539f\u56e0\u6709\uff1a\n//1\u3001\u8def\u5f84\u4e0d\u5b58\u5728  2\u3001\u6743\u9650\u4e0d\u8db3  3\u3001\u6253\u5f00\u6587\u4ef6\u6570\u91cf\u8d85\u8fc7\u4e0a\u9650  4\u3001\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3\u7b49\nreturn\n}\n// defer\u5ef6\u8fdf\u8c03\u7528\ndefer fp.Close() //\u5173\u95ed\u6587\u4ef6\uff0c\u91ca\u653e\u8d44\u6e90\u3002\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#3\u6253\u5f00\u4e0e\u5173\u95ed\u6587\u4ef6","title":"3.\u6253\u5f00\u4e0e\u5173\u95ed\u6587\u4ef6","text":"<pre><code>//func Open(name string) (file *File, err Error)\n//func (f *File) Close() error\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n// \u6253\u5f00\u6587\u4ef6\nfile, err := os.Open(\"demo.txt\")\nif err != nil {\nfmt.Printf(\"\u6253\u5f00\u6587\u4ef6\u51fa\u9519\uff1a%v\\n\", err)\n}\nfmt.Println(file)\n// \u5173\u95ed\u6587\u4ef6\nerr = file.Close()\nif err != nil {\nfmt.Printf(\"\u5173\u95ed\u6587\u4ef6\u51fa\u9519\uff1a%v\\n\", err)\n}\n}\n</code></pre> <pre><code>//func OpenFile(name string, flag int, perm uint32) (file *File, err Error)\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n// \u8bfb\u5199\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\nfp, err := os.OpenFile(\"./demo.txt\", os.O_CREATE|os.O_APPEND, 0666)\nif err != nil {\nfmt.Println(\"\u6587\u4ef6\u6253\u5f00\u5931\u8d25\u3002\")\nreturn\n}\n// defer\u5ef6\u8fdf\u8c03\u7528\ndefer fp.Close()  //\u5173\u95ed\u6587\u4ef6\uff0c\u91ca\u653e\u8d44\u6e90\u3002\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#4\u8bfb\u5199\u6587\u4ef6","title":"4.\u8bfb\u5199\u6587\u4ef6","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>\u6587\u4ef6\u64cd\u4f5c</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#41-\u8bfb\u6587\u4ef6","title":"4.1 \u8bfb\u6587\u4ef6","text":"<p>\u5e26\u7f13\u51b2\u65b9\u5f0f\u8bfb</p> <pre><code>//\u5e26\u7f13\u51b2\u65b9\u5f0f\u8bfb\n//func NewReader(rd io.Reader) *Reader\npackage main\nimport (\n\"bufio\"\n\"fmt\"\n\"io\"\n\"os\"\n)\nfunc main() {\n// \u6253\u5f00\u6587\u4ef6\nfile, err := os.Open(\"demo.txt\")\nif err != nil {\nfmt.Printf(\"\u6253\u5f00\u6587\u4ef6\u51fa\u9519\uff1a%v\\n\", err)\n}\n// \u53ca\u65f6\u5173\u95ed\u6587\u4ef6\u53e5\u67c4\ndefer file.Close()\n// bufio.NewReader(rd io.Reader) *Reader\nreader := bufio.NewReader(file)\n// \u5faa\u73af\u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\nfor {\nline, err := reader.ReadString('\\n') // \u8bfb\u5230\u4e00\u4e2a\u6362\u884c\u7b26\u5c31\u7ed3\u675f\nif err == io.EOF {                   // io.EOF\u8868\u793a\u6587\u4ef6\u7684\u672b\u5c3e\nbreak\n}\n// \u8f93\u51fa\u5185\u5bb9\nfmt.Print(line)\n}\n}\n</code></pre> <p>\u76f4\u63a5\u8bfb\u5230\u5185\u5b58</p> <pre><code>//\u76f4\u63a5\u8bfb\u5230\u5185\u5b58\n//func ReadFile(filename string)([]byte, error)\npackage main\nimport (\n\"fmt\"\n\"io/ioutil\"\n)\nfunc main() {\n// \u4f7f\u7528 io/ioutil.ReadFile \u65b9\u6cd5\u4e00\u6b21\u6027\u5c06\u6587\u4ef6\u8bfb\u53d6\u5230\u5185\u5b58\u4e2d\nfilePath := \"read2.txt\"\ncontent, err := ioutil.ReadFile(filePath)\nif err != nil {\n// log.Fatal(err)\nfmt.Printf(\"\u8bfb\u53d6\u6587\u4ef6\u51fa\u9519\uff1a%v\", err)\n}\nfmt.Printf(\"%v\\n\", content)\nfmt.Printf(\"%v\\n\", string(content))\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#42-\u5199\u6587\u4ef6","title":"4.2 \u5199\u6587\u4ef6","text":"<pre><code>//func (file *File) Write(b []byte) (n int, err Error)\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\nfile, err := os.OpenFile(\"write1.txt\", os.O_CREATE|os.O_RDWR, 0666)\nif err != nil {\nfmt.Println(err)\n}\ndefer file.Close()\ncontent := []byte(\"\u4f60\u597d\u4e16\u754c\uff01\")\nif _, err = file.Write(content); err != nil {\nfmt.Println(err)\n}\nfmt.Println(\"\u5199\u5165\u6210\u529f\uff01\")\n}\n</code></pre> <pre><code>//func (file *File) WriteAt(b []byte, off int64) (n int, err Error)\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\nfile, err := os.Create(\"writeAt.txt\")\nif err != nil {\npanic(err)\n}\ndefer file.Close()\nfile.WriteString(\"Go Web\u7f16\u7a0b\u5b9e\u6218\u6d3e\u4ece\u5165\u95e8\u5230\u7cbe\u901a\")\nn, err := file.WriteAt([]byte(\"Go\u8bed\u8a00Web\"), 24)\nif err != nil {\npanic(err)\n}\nfmt.Println(n)\n}\n</code></pre> <pre><code>//func (file *File) WriteString(s string) (ret int, err Error)\npackage main\nimport (\n\"os\"\n)\nfunc main() {\nfile, err := os.Create(\"WriteString.txt\")\nif err != nil {\npanic(err)\n}\ndefer file.Close()\nfile.WriteString(\"Go Web\u7f16\u7a0b\u5b9e\u6218\u6d3e\u4ece\u5165\u95e8\u5230\u7cbe\u901a\")\n}\n</code></pre> <pre><code>/*\nfunc (file *File) WriteString(s string) (ret int, err Error) {\n    return f.Write([]byte(s))\n}\n*/\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n//\u65b0\u5efa\u6587\u4ef6\nfout, err := os.Create(\"./write4.txt\")\nif err != nil {\nfmt.Println(err)\nreturn\n}\ndefer fout.Close()\nfor i := 0; i &lt; 5; i++ {\noutstr := fmt.Sprintf(\"%s:%d\\r\\n\", \"Hello Go\", i) //Sprintf\u683c\u5f0f\u5316\n// \u5199\u5165\u6587\u4ef6\nfout.WriteString(outstr)            //string\u4fe1\u606f\nfout.Write([]byte(\"i love go\\r\\n\")) //byte\u7c7b\u578b\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#43-\u5199\u6587\u4ef6\u793a\u4f8b","title":"4.3 \u5199\u6587\u4ef6\u793a\u4f8b","text":"<p>\u521b\u5efa\u4e00\u4e2a\u65b0\u6587\u4ef6 golang.txt\uff0c\u5e76\u5728\u5176\u4e2d\u5199\u5165 5 \u53e5\u201chttp://c.biancheng.net/golang/\u201d\u3002</p> <pre><code>package main\nimport (\n\"bufio\"\n\"fmt\"\n\"os\"\n)\nfunc main() {\n//\u521b\u5efa\u4e00\u4e2a\u65b0\u6587\u4ef6\uff0c\u5199\u5165\u5185\u5bb9 5 \u53e5 \u201chttp://c.biancheng.net/golang/\u201d\nfilePath := \"./golang.txt\"\nfile, err := os.OpenFile(filePath, os.O_WRONLY|os.O_CREATE, 0666)\nif err != nil {\nfmt.Println(\"\u6587\u4ef6\u6253\u5f00\u5931\u8d25\", err)\n}\n//\u53ca\u65f6\u5173\u95edfile\u53e5\u67c4\ndefer file.Close()\n//\u5199\u5165\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528\u5e26\u7f13\u5b58\u7684 *Writer\nwrite := bufio.NewWriter(file)\nfor i := 0; i &lt; 5; i++ {\nwrite.WriteString(\"http://c.biancheng.net/golang/ \\n\")\n}\n//Flush\u5c06\u7f13\u5b58\u7684\u6587\u4ef6\u771f\u6b63\u5199\u5165\u5230\u6587\u4ef6\u4e2d\nwrite.Flush()\n}\n</code></pre> <p>\u5199\u6587\u4ef6\u7684\u591a\u79cd\u65b9\u5f0f\u793a\u4f8b</p> <pre><code>package main\nimport (\n\"bufio\" //\u7f13\u5b58IO\n\"fmt\"\n\"io\"\n\"io/ioutil\" //io \u5de5\u5177\u5305\n\"os\"\n)\nfunc check(e error) {\nif e != nil {\npanic(e)\n}\n}\n/**\n * \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728  \u5b58\u5728\u8fd4\u56de true \u4e0d\u5b58\u5728\u8fd4\u56defalse\n */\nfunc checkFileIsExist(filename string) bool {\nvar exist = true\nif _, err := os.Stat(filename); os.IsNotExist(err) {\nexist = false\n}\nreturn exist\n}\n/**\n  from: http://www.isharey.com/?p=143\n*/\nfunc main() {\nvar wireteString = \"\u6d4b\u8bd5n\"\nvar filename = \"./output1.txt\"\nvar f *os.File\nvar err1 error\n/***************************** \u7b2c\u4e00\u79cd\u65b9\u5f0f: \u4f7f\u7528 io.WriteString \u5199\u5165\u6587\u4ef6 ***********************************************/\nif checkFileIsExist(filename) { //\u5982\u679c\u6587\u4ef6\u5b58\u5728\nf, err1 = os.OpenFile(filename, os.O_APPEND, 0666) //\u6253\u5f00\u6587\u4ef6\nfmt.Println(\"\u6587\u4ef6\u5b58\u5728\")\n} else {\nf, err1 = os.Create(filename) //\u521b\u5efa\u6587\u4ef6\nfmt.Println(\"\u6587\u4ef6\u4e0d\u5b58\u5728\")\n}\ncheck(err1)\nn, err1 := io.WriteString(f, wireteString) //\u5199\u5165\u6587\u4ef6(\u5b57\u7b26\u4e32)\ncheck(err1)\nfmt.Printf(\"\u5199\u5165 %d \u4e2a\u5b57\u8282n\", n)\n/*****************************  \u7b2c\u4e8c\u79cd\u65b9\u5f0f: \u4f7f\u7528 ioutil.WriteFile \u5199\u5165\u6587\u4ef6 ***********************************************/\nvar d1 = []byte(wireteString)\nerr2 := ioutil.WriteFile(\"./output2.txt\", d1, 0666) //\u5199\u5165\u6587\u4ef6(\u5b57\u8282\u6570\u7ec4)\ncheck(err2)\n/*****************************  \u7b2c\u4e09\u79cd\u65b9\u5f0f:  \u4f7f\u7528 File(Write,WriteString) \u5199\u5165\u6587\u4ef6 ***********************************************/\nf, err3 := os.Create(\"./output3.txt\") //\u521b\u5efa\u6587\u4ef6\ncheck(err3)\ndefer f.Close()\nn2, err3 := f.Write(d1) //\u5199\u5165\u6587\u4ef6(\u5b57\u8282\u6570\u7ec4)\ncheck(err3)\nfmt.Printf(\"\u5199\u5165 %d \u4e2a\u5b57\u8282n\", n2)\nn3, err3 := f.WriteString(\"writesn\") //\u5199\u5165\u6587\u4ef6(\u5b57\u8282\u6570\u7ec4)\nfmt.Printf(\"\u5199\u5165 %d \u4e2a\u5b57\u8282n\", n3)\nf.Sync()\n/***************************** \u7b2c\u56db\u79cd\u65b9\u5f0f:  \u4f7f\u7528 bufio.NewWriter \u5199\u5165\u6587\u4ef6 ***********************************************/\nw := bufio.NewWriter(f) //\u521b\u5efa\u65b0\u7684 Writer \u5bf9\u8c61\nn4, err3 := w.WriteString(\"bufferedn\")\nfmt.Printf(\"\u5199\u5165 %d \u4e2a\u5b57\u8282n\", n4)\nw.Flush()\nf.Close()\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#44-\u5199\u6587\u4ef6\u8ffd\u52a0\u793a\u4f8b","title":"4.4 \u5199\u6587\u4ef6\u8ffd\u52a0\u793a\u4f8b","text":"<pre><code>package main\nimport (\n\"bufio\"\n\"fmt\"\n\"os\"\n)\nfunc main() {\nfilePath := \"./golang.txt\"\nfile, err := os.OpenFile(filePath, os.O_WRONLY|os.O_APPEND, 0666)\nif err != nil {\nfmt.Println(\"\u6587\u4ef6\u6253\u5f00\u5931\u8d25\", err)\n}\n//\u53ca\u65f6\u5173\u95edfile\u53e5\u67c4\ndefer file.Close()\n//\u5199\u5165\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528\u5e26\u7f13\u5b58\u7684 *Writer\nwrite := bufio.NewWriter(file)\nfor i := 0; i &lt; 5; i++ {\nwrite.WriteString(\"C\u8bed\u8a00\u4e2d\u6587\u7f51 \\r\\n\")\n}\n//Flush\u5c06\u7f13\u5b58\u7684\u6587\u4ef6\u771f\u6b63\u5199\u5165\u5230\u6587\u4ef6\u4e2d\nwrite.Flush()\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#45-\u8bfb\u5199\u540c\u65f6\u8fdb\u884c\u793a\u4f8b","title":"4.5 \u8bfb\u5199\u540c\u65f6\u8fdb\u884c\u793a\u4f8b","text":"<pre><code>package main\nimport (\n\"bufio\"\n\"fmt\"\n\"io\"\n\"os\"\n)\nfunc main() {\nfilePath := \"./golang.txt\"\nfile, err := os.OpenFile(filePath, os.O_RDWR|os.O_APPEND, 0666)\nif err != nil {\nfmt.Println(\"\u6587\u4ef6\u6253\u5f00\u5931\u8d25\", err)\n}\n//\u53ca\u65f6\u5173\u95edfile\u53e5\u67c4\ndefer file.Close()\n//\u8bfb\u539f\u6765\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u663e\u793a\u5728\u7ec8\u7aef\nreader := bufio.NewReader(file)\nfor {\nstr, err := reader.ReadString('\\n')\nif err == io.EOF {\nbreak\n}\nfmt.Print(str)\n}\n//\u5199\u5165\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528\u5e26\u7f13\u5b58\u7684 *Writer\nwrite := bufio.NewWriter(file)\nfor i := 0; i &lt; 5; i++ {\nwrite.WriteString(\"Hello\uff0cC\u8bed\u8a00\u4e2d\u6587\u7f51\u3002 \\r\\n\")\n}\n//Flush\u5c06\u7f13\u5b58\u7684\u6587\u4ef6\u771f\u6b63\u5199\u5165\u5230\u6587\u4ef6\u4e2d\nwrite.Flush()\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#46-\u590d\u5236\u6587\u4ef6\u5230\u53e6\u5916\u4e00\u4e2a\u6587\u4ef6","title":"4.6 \u590d\u5236\u6587\u4ef6\u5230\u53e6\u5916\u4e00\u4e2a\u6587\u4ef6","text":"<p>\uff08\u6ce8\uff1a\u8fd9\u4e24\u4e2a\u6587\u4ef6\u90fd\u5df2\u5b58\u5728\uff09</p> <pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n)\nfunc main() {\nfile1Path := \"./golang.txt\"\nfile2Path := \"./demo.txt\"\ndata, err := ioutil.ReadFile(file1Path)\nif err != nil {\nfmt.Printf(\"\u6587\u4ef6\u6253\u5f00\u5931\u8d25=%v\\n\", err)\nreturn\n}\nerr = ioutil.WriteFile(file2Path, data, 0666)\nif err != nil {\nfmt.Printf(\"\u6587\u4ef6\u6253\u5f00\u5931\u8d25=%v\\n\", err)\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#47-\u5b9e\u73b0\u4e00\u4e2a\u62f7\u8d1d\u6587\u4ef6\u51fd\u6570","title":"4.7 \u5b9e\u73b0\u4e00\u4e2a\u62f7\u8d1d\u6587\u4ef6\u51fd\u6570","text":"<pre><code>// CopyFile \u62f7\u8d1d\u6587\u4ef6\u51fd\u6570\nfunc CopyFile(dstName, srcName string) (written int64, err error) {\n// \u4ee5\u8bfb\u65b9\u5f0f\u6253\u5f00\u6e90\u6587\u4ef6\nsrc, err := os.Open(srcName)\nif err != nil {\nfmt.Printf(\"open %s failed, err:%v.\\n\", srcName, err)\nreturn\n}\ndefer src.Close()\n// \u4ee5\u5199|\u521b\u5efa\u7684\u65b9\u5f0f\u6253\u5f00\u76ee\u6807\u6587\u4ef6\ndst, err := os.OpenFile(dstName, os.O_WRONLY|os.O_CREATE, 0644)\nif err != nil {\nfmt.Printf(\"open %s failed, err:%v.\\n\", dstName, err)\nreturn\n}\ndefer dst.Close()\nreturn io.Copy(dst, src) //\u8c03\u7528io.Copy()\u62f7\u8d1d\u5185\u5bb9\n}\nfunc main() {\n_, err := CopyFile(\"dst.txt\", \"src.txt\")\nif err != nil {\nfmt.Println(\"copy file failed, err:\", err)\nreturn\n}\nfmt.Println(\"copy done!\")\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#48-\u5b9e\u73b0\u4e00\u4e2acat\u547d\u4ee4","title":"4.8 \u5b9e\u73b0\u4e00\u4e2acat\u547d\u4ee4","text":"<pre><code>package main\nimport (\n\"bufio\"\n\"flag\"\n\"fmt\"\n\"io\"\n\"os\"\n)\n// cat\u547d\u4ee4\u5b9e\u73b0\nfunc cat(r *bufio.Reader) {\nfor {\nbuf, err := r.ReadBytes('\\n') //\u6ce8\u610f\u662f\u5b57\u7b26\nif err == io.EOF {\n// \u9000\u51fa\u4e4b\u524d\u5c06\u5df2\u8bfb\u5230\u7684\u5185\u5bb9\u8f93\u51fa\nfmt.Fprintf(os.Stdout, \"%s\", buf)\nbreak\n}\nfmt.Fprintf(os.Stdout, \"%s\", buf)\n}\n}\nfunc main() {\nflag.Parse() // \u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570\nif flag.NArg() == 0 {\n// \u5982\u679c\u6ca1\u6709\u53c2\u6570\u9ed8\u8ba4\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6\u5185\u5bb9\ncat(bufio.NewReader(os.Stdin))\n}\n// \u4f9d\u6b21\u8bfb\u53d6\u6bcf\u4e2a\u6307\u5b9a\u6587\u4ef6\u7684\u5185\u5bb9\u5e76\u6253\u5370\u5230\u7ec8\u7aef\nfor i := 0; i &lt; flag.NArg(); i++ {\nf, err := os.Open(flag.Arg(i))\nif err != nil {\nfmt.Fprintf(os.Stdout, \"reading from %s failed, err:%v\\n\", flag.Arg(i), err)\ncontinue\n}\ncat(bufio.NewReader(f))\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#49-\u51e0\u79cd\u8bfb\u53d6\u6587\u4ef6\u65b9\u6cd5\u901f\u5ea6\u6bd4\u8f83","title":"4.9 \u51e0\u79cd\u8bfb\u53d6\u6587\u4ef6\u65b9\u6cd5\u901f\u5ea6\u6bd4\u8f83","text":"<pre><code>package main\nimport (\n\"bufio\"\n\"fmt\"\n\"io\"\n\"io/ioutil\"\n\"os\"\n\"time\"\n)\nfunc read0(path string) string {\nf, err := ioutil.ReadFile(path)\nif err != nil {\nfmt.Printf(\"%s\\n\", err)\npanic(err)\n}\nreturn string(f)\n}\nfunc read1(path string) string {\nfi, err := os.Open(path)\nif err != nil {\npanic(err)\n}\ndefer fi.Close()\nchunks := make([]byte, 1024, 1024)\nbuf := make([]byte, 1024)\nfor {\nn, err := fi.Read(buf)\nif err != nil &amp;&amp; err != io.EOF {\npanic(err)\n}\nif 0 == n {\nbreak\n}\nchunks = append(chunks, buf[:n]...)\n}\nreturn string(chunks)\n}\nfunc read2(path string) string {\nfi, err := os.Open(path)\nif err != nil {\npanic(err)\n}\ndefer fi.Close()\nr := bufio.NewReader(fi)\nchunks := make([]byte, 1024, 1024)\nbuf := make([]byte, 1024)\nfor {\nn, err := r.Read(buf)\nif err != nil &amp;&amp; err != io.EOF {\npanic(err)\n}\nif 0 == n {\nbreak\n}\nchunks = append(chunks, buf[:n]...)\n}\nreturn string(chunks)\n}\nfunc read3(path string) string {\nfi, err := os.Open(path)\nif err != nil {\npanic(err)\n}\ndefer fi.Close()\nfd, err := ioutil.ReadAll(fi)\nreturn string(fd)\n}\nfunc main() {\nfile := \"test.log\" //file_name\nstart := time.Now()\nread0(file)\nt0 := time.Now()\nfmt.Printf(\"Cost time %v\\n\", t0.Sub(start))\nread1(file)\nt1 := time.Now()\nfmt.Printf(\"Cost time %v\\n\", t1.Sub(t0))\nread2(file)\nt2 := time.Now()\nfmt.Printf(\"Cost time %v\\n\", t2.Sub(t1))\nread3(file)\nt3 := time.Now()\nfmt.Printf(\"Cost time %v\\n\", t3.Sub(t2))\n}\n</code></pre> <p>\u5bf9\u6bd4\uff1a</p> <ul> <li> <p>read0 \u4f7f\u7528 ioutil.ReadFile \u4e00\u6b21\u6027\u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\u5185\u5bb9\u3002\u8fd9\u79cd\u65b9\u6cd5\u7b80\u5355\u76f4\u63a5\uff0c\u9002\u7528\u4e8e\u5c0f\u6587\u4ef6\uff0c\u4f46\u5bf9\u4e8e\u5927\u6587\u4ef6\u53ef\u80fd\u4f1a\u6d88\u8017\u8f83\u591a\u7684\u5185\u5b58\u3002\u5b83\u7684\u6267\u884c\u901f\u5ea6\u8f83\u5feb\u3002</p> </li> <li> <p>read1 \u548c read2 \u90fd\u4f7f\u7528\u9010\u5757\u8bfb\u53d6\u7684\u65b9\u5f0f\u3002\u5b83\u4eec\u901a\u8fc7\u5faa\u73af\u4ee5\u4e00\u5b9a\u5927\u5c0f\u7684\u5757\u5c06\u6587\u4ef6\u5185\u5bb9\u8bfb\u53d6\u5230\u4e00\u4e2a\u5b57\u8282\u5207\u7247\u4e2d\u3002\u8fd9\u79cd\u65b9\u6cd5\u9002\u7528\u4e8e\u5904\u7406\u5927\u6587\u4ef6\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u907f\u514d\u4e00\u6b21\u6027\u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\u5bfc\u81f4\u7684\u5185\u5b58\u6d88\u8017\u8fc7\u5927\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u6bcf\u6b21\u8bfb\u53d6\u90fd\u9700\u8981\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\uff0c\u4f7f\u5f97\u6267\u884c\u65f6\u95f4\u76f8\u5bf9\u8f83\u957f\u3002</p> </li> <li> <p>read3 \u4f7f\u7528 ioutil.ReadAll \u4e00\u6b21\u6027\u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\u5185\u5bb9\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u5b57\u8282\u5207\u7247\u3002\u76f8\u6bd4\u4e8e read0\uff0c\u5b83\u5c11\u4e86\u5c06\u5b57\u8282\u5207\u7247\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u7684\u64cd\u4f5c\u3002\u540c\u6837\u9002\u7528\u4e8e\u5c0f\u6587\u4ef6\uff0c\u4f46\u5bf9\u4e8e\u5927\u6587\u4ef6\u7684\u5185\u5b58\u6d88\u8017\u4ecd\u7136\u5b58\u5728\u3002\u6267\u884c\u901f\u5ea6\u4e0e read0 \u76f8\u5f53\u3002</p> </li> </ul>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#5\u79fb\u52a8\u548c\u91cd\u547d\u540d\u6587\u4ef6","title":"5.\u79fb\u52a8\u548c\u91cd\u547d\u540d\u6587\u4ef6","text":"<p>Rename\u51fd\u6570</p> <pre><code>//func Rename(oldpath, newpath string) error\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n//\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\"test_rename.txt\"\u7684\u7a7a\u6587\u4ef6\n_, err := os.Create(\"./test_rename.txt\") // \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u4f1a\u5c06\u6587\u4ef6\u6e05\u7a7a\u3002\nif err != nil {\nfmt.Println(err)\n}\n//\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\"test_rename\"\u7684\u76ee\u5f55\uff0cperm\u6743\u9650\u4e3a0777\nerr = os.Mkdir(\"test_rename\", 0777)\n//\u5c06test_rename.txt\u79fb\u52a8\u5230test_rename\u76ee\u5f55\uff0c\u5e76\u5c06\u540d\u5b57\u91cd\u547d\u540d\u4e3atest_rename_new.txt\nerr = os.Rename(\"./test_rename.txt\", \"./test_rename/test_rename_new.txt\")\nif err != nil {\nfmt.Println(err)\nreturn\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#6\u5220\u9664\u6587\u4ef6","title":"6.\u5220\u9664\u6587\u4ef6","text":"<p>Remove\u51fd\u6570\u548cRemoveAll\u51fd\u6570\u5b9e\u73b0\u5220\u9664\u6587\u4ef6</p> <pre><code>//func Remove(name string) error\n//func RemoveAll(name string) error\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n//\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\"test_rename\"\u7684\u76ee\u5f55\uff0cperm\u6743\u9650\u4e3a0777\nerr := os.Mkdir(\"test_remove\", 0777)\nif err != nil {\nfmt.Println(err)\n}\nfmt.Println(\"created dir:test_remove\")\n//\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\"test_remove1.txt\"\u7684\u7a7a\u6587\u4ef6\n_, err = os.Create(\"./test_remove/test_remove1.txt\") // \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u4f1a\u5c06\u6587\u4ef6\u6e05\u7a7a\u3002\nif err != nil {\nfmt.Println(err)\n}\nfmt.Println(\"created file:test_remove1.txt\")\n_, err = os.Create(\"./test_remove/test_remove2.txt\")\nif err != nil {\nfmt.Println(err)\n}\nfmt.Println(\"created file:test_remove2.txt\")\n_, err = os.Create(\"./test_remove/test_remove3.txt\")\nif err != nil {\nfmt.Println(err)\n}\nfmt.Println(\"created file:test_remove3.txt\")\nerr = os.Remove(\"./test_remove/test_remove1.txt\")\nif err != nil {\nfmt.Printf(\"removed ./test_remove/test_remove1.txt err : %v\\n\", err)\n}\nfmt.Println(\"removed file:./test_remove/test_remove1.txt\")\nerr = os.RemoveAll(\"./test_remove\")\nif err != nil {\nfmt.Printf(\"remove all ./test_remove err : %v\\n\", err)\n}\nfmt.Println(\"removed all files:./test_remove\")\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#7\u590d\u5236\u6587\u4ef6","title":"7.\u590d\u5236\u6587\u4ef6","text":"<pre><code>//func Copy(dst Writer, src Reader) (written int64, err error)\npackage main\nimport (\n\"fmt\"\n\"io\"\n\"os\"\n)\nfunc main() {\n//\u5148\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\uff1atest_copy1.zip\u6587\u4ef6\n_, err := os.Create(\"./test_copy1.zip\") // \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u4f1a\u5c06\u6587\u4ef6\u6e05\u7a7a\u3002\nif err != nil {\nfmt.Println(err)\n}\n//\u6253\u5f00\u6587\u4ef6test_copy1.zip\uff0c\u83b7\u53d6\u6587\u4ef6\u6307\u9488\nsrcFile, err := os.Open(\"./test_copy1.zip\")\nif err != nil {\nfmt.Printf(\"open file err = %v\\n\", err)\nreturn\n}\ndefer srcFile.Close()\n//\u6253\u5f00\u6587\u4ef6\u8981\u590d\u5236\u7684\u65b0\u6587\u4ef6\u540dtest_copy2.zip\uff0c\u83b7\u53d6\u6587\u4ef6\u6307\u9488\ndstFile, err := os.OpenFile(\"./test_copy2.zip\", os.O_WRONLY|os.O_CREATE, 0755)\nif err != nil {\nfmt.Printf(\"open file err = %v\\n\", err)\nreturn\n}\ndefer dstFile.Close()\n//\u901a\u8fc7Copy\u65b9\u6cd5\nresult, err := io.Copy(dstFile, srcFile)\nif err == nil {\nfmt.Println(\"\u590d\u5236\u6210\u529f\uff0c\u590d\u5236\u7684\u5b57\u8282\u6570\u4e3a: \", result)\n}\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"io\"\n\"log\"\n\"os\"\n)\n//\u81ea\u5b9a\u4e49\u590d\u5236\u65b9\u6cd5\nfunc DoCopy(srcFileName string, dstFileName string) {\n//\u6253\u5f00\u6e90\u6587\u4ef6\nsrcFile, err := os.Open(srcFileName)\nif err != nil {\nlog.Fatalf(\"\u6e90\u6587\u4ef6\u8bfb\u53d6\u5931\u8d25,err:%v\\n\", err)\n}\ndefer func() {\nerr = srcFile.Close()\nif err != nil {\nlog.Fatalf(\"\u6e90\u6587\u4ef6\u5173\u95ed\u5931\u8d25,err:%v\\n\", err)\n}\n}()\n//\u521b\u5efa\u76ee\u6807\u6587\u4ef6,\u7a0d\u540e\u4f1a\u5411\u8fd9\u4e2a\u76ee\u6807\u6587\u4ef6\u5199\u5165\u62f7\u8d1d\u5185\u5bb9\ndistFile, err := os.Create(dstFileName)\nif err != nil {\nlog.Fatalf(\"\u76ee\u6807\u6587\u4ef6\u521b\u5efa\u5931\u8d25,err:%v\\n\", err)\n}\ndefer func() {\nerr = distFile.Close()\nif err != nil {\nlog.Fatalf(\"\u76ee\u6807\u6587\u4ef6\u5173\u95ed\u5931\u8d25,err:%v\\n\", err)\n}\n}()\n//\u5b9a\u4e49\u6307\u5b9a\u957f\u5ea6\u7684\u5b57\u8282\u5207\u7247,\u6bcf\u6b21\u6700\u591a\u8bfb\u53d6\u6307\u5b9a\u957f\u5ea6\nvar tmp = make([]byte, 1024*4)\n//\u5faa\u73af\u8bfb\u53d6\u5e76\u5199\u5165\nfor {\nn, err := srcFile.Read(tmp)\nn, _ = distFile.Write(tmp[:n])\nif err != nil {\nif err == io.EOF {\nreturn\n} else {\nlog.Fatalf(\"\u62f7\u8d1d\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef,\u9519\u8beferr:%v\\n\", err)\n}\n}\n}\n}\nfunc main() {\n//\u5148\u521b\u5efa\u4e00\u4e2a.zip\u6587\u4ef6\n_, err := os.Create(\"./test.zip\") // \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u4f1a\u5c06\u6587\u4ef6\u6e05\u7a7a\u3002\nif err != nil {\nfmt.Println(err)\n}\n//\u590d\u5236\u4e00\u4e2a\u540d\u4e3atest2.zip\u7684\u6587\u4ef6\nDoCopy(\"./test.zip\", \"./test2.zip\")\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#8\u4fee\u6539\u6587\u4ef6\u6743\u9650","title":"8.\u4fee\u6539\u6587\u4ef6\u6743\u9650","text":"<p>os.Chmod()\u65b9\u6cd5\u6765\u4fee\u6539\u6587\u4ef6\u6743\u9650\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n// \u521b\u5efa\u6587\u4ef6\n//\u6587\u4ef6\u7684\u521b\u5efa\uff0cCreate\u4f1a\u6839\u636e\u4f20\u5165\u7684\u6587\u4ef6\u540d\u521b\u5efa\u6587\u4ef6\uff0c\u9ed8\u8ba4\u6743\u9650\u662f0666//-rw-r--r--\nfp, err := os.Create(\"./chmod1.txt\") // \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u4f1a\u5c06\u6587\u4ef6\u6e05\u7a7a\u3002\n// defer\u5ef6\u8fdf\u8c03\u7528\ndefer fp.Close() //\u5173\u95ed\u6587\u4ef6\uff0c\u91ca\u653e\u8d44\u6e90\u3002\nif err != nil {\nfmt.Println(\"\u6587\u4ef6\u521b\u5efa\u5931\u8d25\u3002\")\n}\nfileInfo, err := os.Stat(\"./chmod1.txt\")\nfileMode := fileInfo.Mode()\nfmt.Println(fileMode)\nos.Chmod(\"./chmod1.txt\", 0777)//\u901a\u8fc7chmod\u91cd\u65b0\u8d4b\u6743\u9650//-rwxrwxrwx\nfileInfo, err =os.Stat(\"./chmod1.txt\")\nfileMode = fileInfo.Mode()\nfmt.Println(fileMode)\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#9\u6587\u4ef6\u94fe\u63a5","title":"9.\u6587\u4ef6\u94fe\u63a5","text":"<p>\u786c\u94fe\u63a5</p> <pre><code>//\u786c\u94fe\u63a5\n//func Link(oldname, newname string) error\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n// \u521b\u5efa\u6587\u4ef6\n//\u6587\u4ef6\u7684\u521b\u5efa\uff0cCreate\u4f1a\u6839\u636e\u4f20\u5165\u7684\u6587\u4ef6\u540d\u521b\u5efa\u6587\u4ef6\uff0c\u9ed8\u8ba4\u6743\u9650\u662f0666//-rw-r--r--\nfp, err := os.Create(\"./link1.txt\") // \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u4f1a\u5c06\u6587\u4ef6\u6e05\u7a7a\u3002\n// defer\u5ef6\u8fdf\u8c03\u7528\ndefer fp.Close() //\u5173\u95ed\u6587\u4ef6\uff0c\u91ca\u653e\u8d44\u6e90\u3002\nif err != nil {\nfmt.Println(\"\u6587\u4ef6\u521b\u5efa\u5931\u8d25\u3002\")\n}\nerr = os.Link(\"link1.txt\", \"link2.txt\")\nif err != nil {\nfmt.Println(\"err:\", err)\n}\n}\n</code></pre> <p>\u8f6f\u94fe\u63a5</p> <pre><code>//\u8f6f\u94fe\u63a5\n//func SymLink(oldname, newname string) error\npackage main\nimport (\n\"fmt\"\n\"os\"\n)\nfunc main() {\n// \u521b\u5efa\u6587\u4ef6\n//\u6587\u4ef6\u7684\u521b\u5efa\uff0cCreate\u4f1a\u6839\u636e\u4f20\u5165\u7684\u6587\u4ef6\u540d\u521b\u5efa\u6587\u4ef6\uff0c\u9ed8\u8ba4\u6743\u9650\u662f0666//-rw-r--r--\nfp, err := os.Create(\"./link2.txt\") // \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u4f1a\u5c06\u6587\u4ef6\u6e05\u7a7a\u3002\n// defer\u5ef6\u8fdf\u8c03\u7528\ndefer fp.Close() //\u5173\u95ed\u6587\u4ef6\uff0c\u91ca\u653e\u8d44\u6e90\u3002\nif err != nil {\nfmt.Println(\"\u6587\u4ef6\u521b\u5efa\u5931\u8d25\u3002\")\n}\nerr = os.Symlink(\"link2.txt\", \"link3.txt\")\nif err != nil {\nfmt.Println(\"err:\", err)\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#10\u8c03\u7528\u7cfb\u7edf\u4fe1\u606f","title":"10.\u8c03\u7528\u7cfb\u7edf\u4fe1\u606f","text":"<p>\u8c03\u7528\u7cfb\u7edf\u4fe1\u606f\u53ef\u7528\u4e8e\u81ea\u52a8\u5316\u5b89\u88c5\u8f6f\u4ef6\u3001\u8bbe\u7f6e\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u3001\u5f00\u53d1\u8fdb\u7a0b\u7ba1\u7406\u7cfb\u7edf\u7b49\u573a\u666f\uff0c \u5e38\u7528\u7684\u64cd\u4f5c\u5305\u62ec\u83b7\u53d6\u4e3b\u673a\u540d\u3001\u7528\u6237ID\u3001\u7528\u6237\u7ec4\u3001\u8fdb\u7a0bID\u3001\u73af\u5883\u53d8\u91cf\uff0c\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n)\n// \u8c03\u7528\u7cfb\u7edf\u4fe1\u606f\nfunc main() {\n// \u83b7\u53d6\u4e3b\u673a\u540d\nhn, _ := os.Hostname()\nfmt.Printf(\"\u83b7\u53d6\u4e3b\u673a\u540d\uff1a%v\\n\", hn)\n// \u83b7\u53d6\u7528\u6237ID\nfmt.Printf(\"\u83b7\u53d6\u7528\u6237ID\uff1a%v\\n\", os.Getuid())\n// \u83b7\u53d6\u6709\u6548\u7528\u6237ID\nfmt.Printf(\"\u83b7\u53d6\u6709\u6548\u7528\u6237ID\uff1a%v\\n\", os.Geteuid())\n// \u83b7\u53d6\u7ec4ID\nfmt.Printf(\"\u83b7\u53d6\u7ec4ID\uff1a%v\\n\", os.Getgid())\n// \u83b7\u53d6\u6709\u6548\u7ec4ID\nfmt.Printf(\"\u83b7\u53d6\u6709\u6548\u7ec4ID\uff1a%v\\n\", os.Getegid())\n// \u83b7\u53d6\u8fdb\u7a0bID\nfmt.Printf(\"\u83b7\u53d6\u8fdb\u7a0bID\uff1a%v\\n\", os.Getpid())\n// \u83b7\u53d6\u7236\u8fdb\u7a0bID\nfmt.Printf(\"\u83b7\u53d6\u7236\u8fdb\u7a0bID\uff1a%v\\n\", os.Getppid())\n// \u83b7\u53d6\u67d0\u4e2a\u73af\u5883\u53d8\u91cf\u7684\u503c\nfmt.Printf(\"\u83b7\u53d6\u73af\u5883\u53d8\u91cf\u7684\u503c\uff1a%v\\n\", os.Getenv(\"GOPATH\"))\n// \u8bbe\u7f6e\u67d0\u4e2a\u73af\u5883\u53d8\u91cf\u7684\u503c\nos.Setenv(\"TEST\", \"test\")\n// \u5220\u9664\u67d0\u4e2a\u73af\u5883\u53d8\u91cf\nos.Unsetenv(\"TEST\")\n// \u83b7\u53d6\u6240\u6709\u73af\u5883\u53d8\u91cf\nfor _, e := range os.Environ() {\nfmt.Printf(\"\u73af\u5883\u53d8\u91cf\uff1a%v\\n\", e)\n}\n// \u83b7\u53d6\u67d0\u4e2a\u73af\u5883\u53d8\u91cf\nfmt.Printf(\"\u83b7\u53d6GOPATH\u73af\u5883\u53d8\u91cf\uff1a%v\\n\", os.Getenv(\"GOPATH\"))\n// \u5220\u9664\u6240\u6709\u73af\u5883\u53d8\u91cf\n// os.Clearenv()\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#11\u4f7f\u7528path\u83b7\u53d6\u8def\u5f84\u4fe1\u606f","title":"11.\u4f7f\u7528path\u83b7\u53d6\u8def\u5f84\u4fe1\u606f","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"path\"\n)\nfunc main() {\n// \u5224\u65ad\u8def\u5f84\u662f\u4e0d\u662f\u7edd\u5bf9\u8def\u5f84\nfmt.Printf(\"IsAbs\u51fd\u6570\uff1a%v\\n\", path.IsAbs(\"./a/b\"))\n// path.IsAbs\u4ec5\u517c\u5bb9Linux\uff0c\u4e0d\u517c\u5bb9Windows\uff0c\u56e0\u6b64\u8f93\u51fafalse\nfmt.Printf(\"IsAbs\u51fd\u6570\uff1a%v\\n\", path.IsAbs(\"D:a/b\"))\n// \u8def\u5f84\u62fc\u63a5\uff0c\u8fde\u63a5\u540e\u81ea\u52a8\u8c03\u7528Clean\u51fd\u6570\nfmt.Printf(\"Join\u51fd\u6570\uff1a%v\\n\", path.Join(\"./a\", \"b/c\", \"../d/\"))\n// \u8fd4\u56de\u8def\u5f84\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\nfmt.Printf(\"Base\u51fd\u6570\uff1a%v\\n\", path.Base(\"D:/a/b/c\"))\n// \u5982\u679c\u8def\u5f84\u4e3a\u7a7a\u5b57\u7b26\u4e32\u6216\u659c\u6760\uff0c\u8fd4\u56de\u5b9e\u5fc3\u70b9\u6216\u659c\u6760\nfmt.Printf(\"Base\u51fd\u6570\uff1a%v\\n\", path.Base(\"\"))\nfmt.Printf(\"Base\u51fd\u6570\uff1a%v\\n\", path.Base(\"/\"))\n// \u8fd4\u56de\u7b49\u4ef7\u7684\u6700\u77ed\u8def\u5f84\n// 1.\u7528\u4e00\u4e2a\u659c\u7ebf\u66ff\u6362\u591a\u4e2a\u659c\u7ebf\n// 2.\u6e05\u9664\u5f53\u524d\u8def\u5f84\u7684\u5b9e\u5fc3\u70b9\n// 3.\u6e05\u9664..\u548c\u5b83\u524d\u9762\u7684\u5143\u7d20\n// 4.\u4ee5/..\u5f00\u5934\u7684\uff0c\u53d8\u6210/\nfmt.Printf(\"Clean\u51fd\u6570\uff1a%v\\n\", path.Clean(\"./a/b/c/../\"))\n// \u8fd4\u56de\u8def\u5f84\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u524d\u9762\u76ee\u5f55\n// \u8def\u5f84\u4e3a\u7a7a\u5219\u8fd4\u56de\u5b9e\u5fc3\u70b9\nfmt.Printf(\"Dir\u51fd\u6570\uff1a%v\\n\", path.Dir(\"D:/a/b/c\"))\n// \u8fd4\u56de\u8def\u5f84\u4e2d\u7684\u6587\u4ef6\u6269\u5c55\u540d\n// \u5982\u679c\u6ca1\u6709\u6587\u4ef6\u6269\u5c55\u540d\u5219\u8fd4\u56de\u7a7a\nfmt.Printf(\"Ext\u51fd\u6570\uff1a%v\\n\", path.Ext(\"D:/a/b/c/d.jpg\"))\n// \u5339\u914d\u8def\u5f84\uff0c\u5b8c\u5168\u5339\u914d\u5219\u8fd4\u56detrue\n// *\u5339\u914d0\u6216\u591a\u4e2a\u975e/\u7684\u5b57\u7b26\nmatched1, _ := path.Match(\"*\", \"abc\")\nfmt.Printf(\"Match\u51fd\u6570\uff1a%v\\n\", matched1)\n// ?\u5339\u914d\u4e00\u4e2a\u975e/\u7684\u5b57\u7b26\uff0ca?b\u7684?\u4e0d\u662f\u659c\u6760/\u5e76\u53ea\u6709\u4e00\u4e2a\u5b57\u7b26\u90fd\u80fd\u5339\u914d\nmatched2, _ := path.Match(\"a?b\", \"agb\")\nfmt.Printf(\"Match\u51fd\u6570\uff1a%v\\n\", matched2)\n// \u5339\u914d\u8def\u5f84\u662f\u5426\u7b26\u5408a/*/c\u683c\u5f0f\uff0c\u5982a/abc/c\u548ca/bbb/\u90fd\u80fd\u5339\u914d\nmatched3, _ := path.Match(\"a/*/c\", \"a/bb/c\")\nfmt.Printf(\"Match\u51fd\u6570\uff1a%v\\n\", matched3)\n// \u5206\u5272\u8def\u5f84\u4e2d\u7684\u76ee\u5f55\u4e0e\u6587\u4ef6\ndir, file := path.Split(\"./a/b/c/d.jpg\")\nfmt.Printf(\"Split\u51fd\u6570\uff1a\u76ee\u5f55\uff1a%v\u3001\u6587\u4ef6\uff1a%v\\n\", dir, file)\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#111-\u5185\u7f6e\u5305path\u76848\u4e2a\u51fd\u6570","title":"11.1 \u5185\u7f6e\u5305path\u76848\u4e2a\u51fd\u6570","text":"\u51fd\u6570\u540d \u51fd\u6570\u4ecb\u7ecd IsAbs \u5224\u65ad\u53c2\u6570<code>path</code>\u662f\u5426\u4e3a\u7edd\u5bf9\u8def\u5f84\u3002\u82e5\u4e3a\u7edd\u5bf9\u8def\u5f84\uff0c\u5219\u8fd4\u56de<code>true</code>\uff1b\u5426\u5219\u8fd4\u56de<code>false</code>\u3002\u4ec5\u517c\u5bb9Linux\u7cfb\u7edf\uff0c\u4e0d\u517c\u5bb9Windows\u7cfb\u7edf\u3002 Join \u4ece\u53ef\u9009\u53c2\u6570<code>elem</code>\u4e2d\u83b7\u53d6\u591a\u4e2a\u8def\u5f84\u62fc\u63a5\u7684\u65b0\u8def\u5f84\u3002\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u53c2\u6570<code>elem</code>\uff0c\u5219\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002 Base \u83b7\u53d6\u8def\u5f84\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u8def\u5f84<code>D:/a/b/c</code>\uff0c\u8fd4\u56de\u6587\u4ef6\u5939<code>c</code>\uff1b\u5bf9\u4e8e\u8def\u5f84<code>D:/a/b/c.jpg</code>\uff0c\u8fd4\u56de\u6587\u4ef6<code>c.jpg</code>\u3002\u5982\u679c\u8def\u5f84\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u8fd4\u56de\u5b9e\u5fc3\u70b9\u201c.\u201d\uff1b\u5982\u679c\u8def\u5f84\u53ea\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u659c\u6760\uff08\u201c//\u201d\u6216\u201c\\\u201d\uff09\uff0c\u5219\u8fd4\u56de\u8def\u5f84\u5206\u9694\u7b26\uff08\u5373\u659c\u6760\u201c/\u201d\u6216\u201c\\\u201d\uff09\u3002 Clean \u8fd4\u56de\u8def\u5f84\u7684\u6700\u77ed\u8def\u5f84\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u8be5\u51fd\u6570\u5bf9\u8def\u5f84\u8fdb\u884c\u6e05\u6d17\u5904\u7406\uff0c\u5171\u8bbe\u7f6e\u4e864\u79cd\u6e05\u6d17\u89c4\u5219\u3002 Dir \u83b7\u53d6\u8def\u5f84\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u524d\u9762\u7684\u8def\u5f84\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u53c2\u6570<code>path</code>\u8bbe\u7f6e\u4e3a<code>D:/a/b/c</code>\uff0c\u8fd4\u56de<code>D:/a/b</code>\uff0c\u53bb\u6389\u6587\u4ef6\u5939<code>c</code>\u3002 Ext \u83b7\u53d6\u6587\u4ef6\u6269\u5c55\u540d\u3002\u53c2\u6570<code>path</code>\u662f\u6587\u4ef6\u8def\u5f84\u4fe1\u606f\u3002\u5982\u679c\u53c2\u6570<code>path</code>\u4e0d\u662f\u6587\u4ef6\u8def\u5f84\uff0c\u5219\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u53c2\u6570<code>path</code>\u8bbe\u4e3a<code>D:/a/b/c</code>\uff0c\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002 Match \u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u8def\u5f84\u4fe1\u606f\u3002\u53c2\u6570<code>pattern</code>\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5339\u914d\u7b26\uff0c\u53c2\u6570<code>name</code>\u662f\u9700\u8981\u88ab\u5339\u914d\u7684\u8def\u5f84\u3002\u8fd4\u56de\u503c<code>matched</code>\u662f\u5339\u914d\u7ed3\u679c\uff0c\u8fd4\u56de\u503c<code>err</code>\u662f\u5339\u914d\u9519\u8bef\u4fe1\u606f\u3002 Split \u5206\u5272\u8def\u5f84\u4e2d\u7684\u76ee\u5f55\u4e0e\u6587\u4ef6\u3002\u53c2\u6570<code>path</code>\u662f\u9700\u8981\u88ab\u5206\u5272\u7684\u8def\u5f84\u3002\u8fd4\u56de\u503c<code>dir</code>\u662f\u5206\u5272\u540e\u7684\u8def\u5f84\uff0c\u8fd4\u56de\u503c<code>file</code>\u662f\u5206\u5272\u540e\u7684\u6587\u4ef6\u3002\u5982\u679c\u53c2\u6570<code>path</code>\u4e0d\u662f\u6587\u4ef6\u8def\u5f84\uff0c\u5219\u8fd4\u56de\u503c<code>dir</code>\u4e3a\u8def\u5f84\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u524d\u9762\u7684\u8def\u5f84\uff0c\u8fd4\u56de\u503c<code>file</code>\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e<code>./a/b/c/d</code>\uff0c\u8fd4\u56de\u503c<code>dir</code>\u4e3a<code>./a/b/c/</code>\u3002"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#12\u5185\u7f6e\u5305pathfilepath","title":"12.\u5185\u7f6e\u5305path/filepath","text":"<p>\u5b83\u542b\u6709\u5185\u7f6e\u5305path\u7684\u529f\u80fd\uff0c\u5e76\u4e14\u80fd\u517c\u5bb9\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u5185\u7f6e\u5305path/filepath\u5b9a\u4e4916\u4e2a\u529f\u80fd\u51fd\u6570\uff0c\u6bcf\u4e2a\u51fd\u6570\u7684\u529f\u80fd\u4ee5\u53ca\u4f7f\u7528\u8bf4\u660e\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"path/filepath\"\n)\nfunc main() {\n// \u5224\u65ad\u8def\u5f84\u662f\u4e0d\u662f\u7edd\u5bf9\u8def\u5f84\uff0cfilepath\u517c\u5bb9\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\nfmt.Printf(\"IsAbs\u51fd\u6570\uff1a%v\\n\", filepath.IsAbs(\"./a/b/c\"))\nfmt.Printf(\"IsAbs\u51fd\u6570\uff1a%v\\n\", filepath.IsAbs(\"C:/a/b/c\"))\n// \u8fd4\u56de\u6240\u7ed9\u8def\u5f84\u7684\u7edd\u5bf9\u8def\u5f84\npath, _ := filepath.Abs(\"go.mod\")\nfmt.Printf(\"Abs\u51fd\u6570\uff1a%v\\n\", path)\n// \u8fd4\u56de\u8def\u5f84\u6700\u540e\u4e00\u4e2a\u5143\u7d20\nfmt.Printf(\"Base\u51fd\u6570\uff1a%v\\n\", filepath.Base(\"D:/a/c/1.txt\"))\n// \u5982\u679c\u8def\u5f84\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u5b9e\u5fc3\u70b9\nfmt.Printf(\"Base\u51fd\u6570\uff1a%v\\n\", filepath.Base(\"\"))\n// \u5982\u679c\u8def\u5f84\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u659c\u6760/\uff0c\u8fd4\u56de\u5355\u4e2a\u659c\u6760/\nfmt.Printf(\"Base\u51fd\u6570\uff1a%v\\n\", filepath.Base(\"//\"))\n// \u8fd4\u56de\u7b49\u4ef7\u7684\u6700\u77ed\u8def\u5f84\n// 1.\u7528\u4e00\u4e2a\u659c\u7ebf\u66ff\u6362\u591a\u4e2a\u659c\u7ebf\n// 2.\u6e05\u9664\u5f53\u524d\u8def\u5f84\u7684\u5b9e\u5fc3\u70b9\n// 3.\u6e05\u9664..\u548c\u5b83\u524d\u9762\u7684\u5143\u7d20\n// 4.\u4ee5/..\u5f00\u5934\u7684\uff0c\u53d8\u6210/\nfmt.Printf(\"Clean\u51fd\u6570\uff1a%v\\n\", filepath.Clean(\"D:/a/b/../c\"))\nfmt.Printf(\"Clean\u51fd\u6570\uff1a%v\\n\", filepath.Clean(\"D:/a/b/../c/1.txt\"))\n// \u8fd4\u56de\u8def\u5f84\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u524d\u9762\u76ee\u5f55\n// \u8def\u5f84\u4e3a\u7a7a\u5219\u8fd4\u56de\u5b9e\u5fc3\u70b9\nfmt.Printf(\"Dir\u51fd\u6570\uff1a%v\\n\", filepath.Dir(\"./a/b/c\"))\nfmt.Printf(\"Dir\u51fd\u6570\uff1a%v\\n\", filepath.Dir(\"D:/a/b/c\"))\n// \u8fd4\u56de\u8f6f\u94fe\u63a5\u7684\u5b9e\u9645\u8def\u5f84\npath2, _ := filepath.EvalSymlinks(\"go.mod\")\nfmt.Printf(\"EvalSymlinks\u51fd\u6570\uff1a%v\\n\", path2)\n// \u8fd4\u56de\u6587\u4ef6\u8def\u5f84\u7684\u6269\u5c55\u540d\n// \u5982\u679c\u4e0d\u662f\u6587\u4ef6\u8def\u5f84\uff0c\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\nfmt.Printf(\"Ext\u51fd\u6570\uff1a%v\\n\", filepath.Ext(\"./a/b/c/d.jpg\"))\n// \u5c06\u8def\u5f84\u4e2d\u7684/\u66ff\u6362\u4e3a\u8def\u5f84\u5206\u9694\u7b26\nfmt.Printf(\"FromSlash\u51fd\u6570\uff1a%v\\n\", filepath.FromSlash(\"./a/b/c\"))\n// \u8fd4\u56de\u8def\u5f84\u4e2d\u6240\u6709\u5339\u914d\u7684\u6587\u4ef6\nmatch, _ := filepath.Glob(\"./*.go\")\nfmt.Printf(\"Glob\u51fd\u6570\uff1a%v\\n\", match)\n// \u8def\u5f84\u62fc\u63a5\uff0c\u8fde\u63a5\u540e\u81ea\u52a8\u8c03\u7528Clean\u51fd\u6570\nfmt.Printf(\"Join\u51fd\u6570\uff1a%v\\n\", filepath.Join(\"C:/a\", \"/b\", \"/c\"))\n// *\u5339\u914d0\u6216\u591a\u4e2a\u975e/\u7684\u5b57\u7b26\nmatched1, _ := filepath.Match(\"*\", \"abc\")\nfmt.Printf(\"Match\u51fd\u6570\uff1a%v\\n\", matched1)\n// ?\u5339\u914d\u4e00\u4e2a\u975e/\u7684\u5b57\u7b26\uff0ca?b\u7684?\u4e0d\u662f\u659c\u6760/\u5e76\u53ea\u6709\u4e00\u4e2a\u5b57\u7b26\u90fd\u80fd\u5339\u914d\nmatched2, _ := filepath.Match(\"a?b\", \"agb\")\nfmt.Printf(\"Match\u51fd\u6570\uff1a%v\\n\", matched2)\n// \u5339\u914d\u8def\u5f84\u662f\u5426\u7b26\u5408a/*/c\u683c\u5f0f\uff0c\u5982a/abc/c\u548ca/bbb/\u90fd\u80fd\u5339\u914d\nmatched3, _ := filepath.Match(\"a/*/c\", \"a/bb/c\")\nfmt.Printf(\"Match\u51fd\u6570\uff1a%v\\n\", matched3)\n// \u8fd4\u56de\u53c2\u6570basepath\u4e3a\u57fa\u51c6\u7684\u76f8\u5bf9\u8def\u5f84\npath3, _ := filepath.Rel(\"C:/a/b\", \"C:/a/b/../e\")\nfmt.Printf(\"Rel\u51fd\u6570\uff1a%v\\n\", path3)\n// \u5c06\u8def\u5f84\u4f7f\u7528\u8def\u5f84\u5217\u8868\u5206\u9694\u7b26\u5206\u5f00\uff0c\u89c1os.PathListSeparator\n// linux\u9ed8\u8ba4\u4e3a\u5192\u53f7\uff0cwindows\u9ed8\u8ba4\u4e3a\u5206\u53f7\nsl := filepath.SplitList(\"C:/windows;C:/windows/system\")\nfmt.Printf(\"SplitList\u51fd\u6570\uff1a%v\uff0c\u957f\u5ea6\uff1a%v\\n\", sl, len(sl))\n// \u5206\u5272\u8def\u5f84\u4e2d\u7684\u76ee\u5f55\u4e0e\u6587\u4ef6\ndir, file := filepath.Split(\"C:/a/d.jpg\")\nfmt.Printf(\"Split\u51fd\u6570\uff1a\u76ee\u5f55\uff1a%v\uff0c\u6587\u4ef6\uff1a%v\\n\", dir, file)\n// \u5c06\u8def\u5f84\u5206\u9694\u7b26\u4f7f\u7528/\u66ff\u6362\nfmt.Printf(\"ToSlash\u51fd\u6570\uff1a%v\\n\", filepath.ToSlash(\"C:\\\\a\\\\b\"))\n// \u8fd4\u56de\u5206\u533a\u540d\nvn := filepath.VolumeName(\"C:/a/b/c\")\nfmt.Printf(\"VolumeName\u51fd\u6570\uff1a%v\\n\", vn)\n// \u904d\u5386\u6307\u5b9a\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\nfilepath.Walk(\"./\", func(path string, info os.FileInfo, err error) error {\nfmt.Printf(\"Walk\u51fd\u6570\uff1a%v\\n\", path)\nreturn nil\n})\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#121-\u5185\u7f6e\u5305pathfilepath\u768416\u4e2a\u51fd\u6570","title":"12.1 \u5185\u7f6e\u5305path/filepath\u768416\u4e2a\u51fd\u6570","text":"\u51fd\u6570\u540d \u51fd\u6570\u4ecb\u7ecd IsAbs \u5224\u65ad\u53c2\u6570<code>path</code>\u662f\u5426\u4e3a\u7edd\u5bf9\u8def\u5f84\u3002\u82e5\u4e3a\u7edd\u5bf9\u8def\u5f84\uff0c\u5219\u8fd4\u56de<code>true</code>\uff1b\u5426\u5219\u8fd4\u56de<code>false</code>\u3002 Abs \u6839\u636e\u53c2\u6570<code>path</code>\u8fd4\u56de\u7edd\u5bf9\u8def\u5f84\u3002 Base \u83b7\u53d6\u8def\u5f84\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u3002 Clean \u8fd4\u56de\u8def\u5f84\u7684\u6700\u77ed\u8def\u5f84\u3002 Dir \u83b7\u53d6\u8def\u5f84\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u524d\u9762\u7684\u8def\u5f84\u3002 EvalSymlinks \u8fd4\u56de\u8f6f\u94fe\u63a5\u6587\u4ef6\u7684\u8def\u5f84\u4fe1\u606f\u3002 Ext \u83b7\u53d6\u6587\u4ef6\u6269\u5c55\u540d\u3002 Glob \u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u8def\u5f84\u4e2d\u7b26\u5408\u6761\u4ef6\u7684\u6587\u4ef6\u3002 Join \u4ece\u53ef\u9009\u53c2\u6570<code>elem</code>\u4e2d\u83b7\u53d6\u591a\u4e2a\u8def\u5f84\u62fc\u63a5\u7684\u65b0\u8def\u5f84\u3002 Match \u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u8def\u5f84\u4fe1\u606f\u3002 SplitList \u5bf9\u591a\u4e2a\u8def\u5f84\u4fe1\u606f\u8fdb\u884c\u5206\u5272\uff0c\u4ee5\u5207\u7247\u65b9\u5f0f\u8fd4\u56de\u7ed3\u679c\u3002 Split \u5206\u5272\u8def\u5f84\u4e2d\u7684\u76ee\u5f55\u4e0e\u6587\u4ef6\u3002 ToSlash \u5c06\u8def\u5f84\u5206\u9694\u7b26\uff08\u5373\u201c\\\u201d\uff09\u66ff\u6362\u4e3a\u659c\u6760\u201c/\u201d\u3002 FromSlash \u5c06\u659c\u6760\u201c/\u201d\u66ff\u6362\u4e3a\u8def\u5f84\u5206\u9694\u7b26\uff08\u5373\u201c\\\u201d\uff09\u3002 VolumeName \u8fd4\u56de\u6700\u524d\u9762\u7684\u5377\u540d\u3002 Walk \u904d\u5386\u53c2\u6570<code>root</code>\u7684\u6240\u6709\u6587\u4ef6\u540d\u3002"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/20.%E5%A4%84%E7%90%86%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6/#13-\u53c2\u8003\u6587\u732e","title":"13. \u53c2\u8003\u6587\u732e","text":"<p>go\u6587\u4ef6\u64cd\u4f5c</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/","title":"\u5904\u7406XML\u6587\u4ef6","text":"<p>XML(eXtensible Markup Language\uff0c\u53ef\u6269\u5c55\u6807\u8bb0\u8bed\u8a00)</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/#1\u89e3\u6790xml\u6587\u4ef6","title":"1.\u89e3\u6790XML\u6587\u4ef6","text":"<pre><code>func Unmarshal(data []byte, v interface{}) error\n</code></pre> <p>Go\u89e3\u6790XML\u539f\u5219\uff1a</p> <ul> <li>\u7ed3\u6784\u4f53</li> </ul> <p><code>email_config.xml</code></p> <pre><code>&lt;!--email_config.xml--&gt;\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;config&gt;\n&lt;smtpServer&gt;smtp.163.com&lt;/smtpServer&gt;\n&lt;smtpPort&gt;25&lt;/smtpPort&gt;\n&lt;sender&gt;test@163.com&lt;/sender&gt;\n&lt;senderPassword&gt;123456&lt;/senderPassword&gt;\n&lt;receivers flag=\"true\"&gt;\n&lt;user&gt;shirdonliao@gmail.com&lt;/user&gt;\n&lt;user&gt;test99999@qq.com&lt;/user&gt;\n&lt;/receivers&gt;\n&lt;/config&gt;\n</code></pre> <p><code>main.go</code></p> <pre><code>package main\nimport (\n\"encoding/xml\"\n\"fmt\"\n\"io/ioutil\"\n\"os\"\n)\ntype EmailConfig struct {\nXMLName        xml.Name       `xml:\"config\"`\nSmtpServer     string         `xml:\"smtpServer\"`\nSmtpPort       int            `xml:\"smtpPort\"`\nSender         string         `xml:\"sender\"`\nSenderPassword string         `xml:\"senderPassword\"`\nReceivers      EmailReceivers `xml:\"receivers\"`\n}\ntype EmailReceivers struct {\nFlag string   `xml:\"flag,attr\"`\nUser []string `xml:\"user\"`\n}\nfunc main() {\nfile, err := os.Open(\"email_config.xml\")\nif err != nil {\nfmt.Printf(\"error: %v\", err)\nreturn\n}\ndefer file.Close()\ndata, err := ioutil.ReadAll(file)\nif err != nil {\nfmt.Printf(\"error: %v\", err)\nreturn\n}\nv := EmailConfig{}\nerr = xml.Unmarshal(data, &amp;v)\nif err != nil {\nfmt.Printf(\"error: %v\", err)\nreturn\n}\nfmt.Println(v)\nfmt.Println(\"SmtpServer is : \", v.SmtpServer)\nfmt.Println(\"SmtpPort is : \", v.SmtpPort)\nfmt.Println(\"Sender is : \", v.Sender)\nfmt.Println(\"SenderPasswd is : \", v.SenderPassword)\nfmt.Println(\"Receivers.Flag is : \", v.Receivers.Flag)\nfor i, element := range v.Receivers.User {\nfmt.Println(i, element)\n}\n}\n/* \n{{ config} smtp.163.com 25 test@163.com 123456 {true [shirdonliao@gmail.com test99999@qq.com]}}\nSmtpServer is :  smtp.163.com\nSmtpPort is :  25\nSender is :  test@163.com\nSenderPasswd is :  123456\nReceivers.Flag is :  true\n0 shirdonliao@gmail.com\n1 test99999@qq.com \n*/\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/21.%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/#2\u751f\u6210xml\u6587\u4ef6","title":"2.\u751f\u6210XML\u6587\u4ef6","text":"<pre><code>func Marshal(v interface{}) ([]byte, error)\n//\u589e\u52a0\u524d\u7f00\u548c\u7f29\u8fdb\nfunc MarshalIndent(v interface{}, prefix, indent string) ([]byte, error)\n</code></pre> <pre><code>package main\nimport (\n\"encoding/xml\"\n\"fmt\"\n\"os\"\n)\ntype Languages struct {\nXMLName xml.Name   `xml:\"languages\"`\nVersion string     `xml:\"version,attr`\nLang    []Language `xml:\"language\"`\n}\ntype Language struct {\nName string `xml:\"name\"`\nSite string `xml:\"site`\n}\nfunc main() {\nv := &amp;Languages{Version: \"2\"}\nv.Lang = append(v.Lang, Language{\"JAVA\", \"https://www.java.com/\"})\nv.Lang = append(v.Lang, Language{\"Go\", \"https://golang.org/\"})\noutput, err := xml.MarshalIndent(v, \" \", \" \")\nif err != nil {\nfmt.Printf(\"error %v\", err)\nreturn\n}\nfile, _ := os.Create(\"languages.xml\")\ndefer file.Close()\nfile.Write([]byte(xml.Header)) //\u751f\u6210XML\u5934\nfile.Write(output)\n}\n/*\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n &lt;languages&gt;\n  &lt;Version&gt;2&lt;/Version&gt;\n  &lt;language&gt;\n   &lt;name&gt;JAVA&lt;/name&gt;\n   &lt;Site&gt;https://www.java.com/&lt;/Site&gt;\n  &lt;/language&gt;\n  &lt;language&gt;\n   &lt;name&gt;Go&lt;/name&gt;\n   &lt;Site&gt;https://golang.org/&lt;/Site&gt;\n  &lt;/language&gt;\n &lt;/languages&gt;\n*/\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/","title":"\u5904\u7406JSON\u6587\u4ef6","text":"<p>JSON\uff08JavaScript Object Notation\uff0cJavaScript\u5bf9\u8c61\u8868\u793a\u6cd5\uff09\uff0c\u57fa\u4e8e\u6587\u672c\uff0c\u72ec\u7acb\u4e8e\u8bed\u8a00\u7684\u8f7b\u91cf\u7ea7\u6570\u636e\u4ea4\u6362\u683c\u5f0f\u3002</p> <p>\u952e\u7528\uff08\"\"\uff09\u62ec\u8d77\u6765\uff0c\u503c\u662f\u4efb\u610f\u7c7b\u578b\u3002</p> <pre><code>{\n\"id\": \"888\",\n\"info\": {\n\"name\": \"jack\",\n\"age\": 18\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/#1\u8bfb\u53d6json\u6587\u4ef6","title":"1.\u8bfb\u53d6JSON\u6587\u4ef6","text":"<p><code>json_parse.json</code></p> <pre><code>{\n\"port\": \"27017\",\n\"mongo\": {\n\"mongoAddr\": \"127.0.0.1\",\n\"mongoPoolLimit\": 500,\n\"mongoDb\": \"my_db\",\n\"mongoCollection\": \"table1\"\n}\n}\n</code></pre> <p><code>main.go</code></p> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n\"io/ioutil\"\n)\n//\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u89e3\u6790\u540e\u7684\u7ed3\u6784\ntype MongoConfig struct {\nMongoAddr       string\nMongoPoolLimit  int\nMongoDb         string\nMongoCollection string\n}\ntype Config struct {\nPort  string\nMongo MongoConfig\n}\nfunc main() {\nv := Config{}\nerr := Load(\"json_parse.json\", &amp;v)\nif err != nil {\nreturn\n}\nfmt.Println(v.Port)\nfmt.Println(v.Mongo.MongoAddr)\nfmt.Println(v.Mongo.MongoPoolLimit)\nfmt.Println(v.Mongo.MongoDb)\nfmt.Println(v.Mongo.MongoCollection)\n}\nfunc Load(filename string, v interface{}) error {\n//ReadFile\u51fd\u6570\u4f1a\u8bfb\u53d6\u6587\u4ef6\u7684\u5168\u90e8\u5185\u5bb9\uff0c\u5e76\u5c06\u7ed3\u679c\u4ee5[]byte\u7c7b\u578b\u8fd4\u56de\ndata, err := ioutil.ReadFile(filename)\nif err != nil {\nreturn err\n}\n//\u8bfb\u53d6\u7684\u6570\u636e\u4e3ajson\u683c\u5f0f\uff0c\u9700\u8981\u8fdb\u884c\u89e3\u7801\nerr = json.Unmarshal(data, v)\nif err != nil {\nreturn err\n}\nreturn nil\n}\n/*\n27017\n127.0.0.1\n500\nmy_db\ntable1\n*/\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/#2\u751f\u6210json\u6587\u4ef6","title":"2.\u751f\u6210JSON\u6587\u4ef6","text":"<pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n\"os\"\n)\ntype User struct {\nUserName string\nNickName string `json:\"nickname\"`\nEmail    string\n}\nfunc main() {\nuser := User{\nUserName: \"Jack\",\nNickName: \"Ma\",\nEmail:    \"xxxxx@qq.com\",\n}\n//data, err := json.Marshal(&amp;user)\ndata, err := json.MarshalIndent(&amp;user, \"\", \"\\t\")\nif err != nil {\nfmt.Printf(\"json.Marshal failed,err:\", err)\nreturn\n}\nfmt.Printf(\"%s\\n\", string(data))\nfile, err := os.Create(\"json_write.json\")\nif err != nil {\nfmt.Printf(\"os.Create err:\", err)\nreturn\n}\ndefer file.Close()\nfile.Write(data)\n}\n/*\n{\n    \"UserName\": \"Jack\",\n    \"nickname\": \"Ma\",\n    \"Email\": \"xxxxx@qq.com\"\n}\n*/\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/#3newencoder\u51fd\u6570","title":"3.NewEncoder\u51fd\u6570","text":"<p>\u5185\u7f6e\u5305encoding/json\u7684NewEncoder()\u662f\u5de5\u5382\u51fd\u6570\uff0c\u4e3b\u8981\u5bf9\u7ed3\u6784\u4f53Encoder\u6267\u884c\u5b9e\u4f8b\u5316\u8fc7\u7a0b\uff0c Encoder\u662f\u5b9e\u73b0JSON\u6570\u636e\u5199\u5165\u6587\u4ef6\u7684\u7ed3\u6784\u4f53\uff0c\u53ea\u8981\u8c03\u7528\u7ed3\u6784\u4f53\u65b9\u6cd5Encode()\u5373\u53ef\u5b9e\u73b0\u6570\u636e\u5199\u5165\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n\"os\"\n)\ntype PersonInfo struct {\nName string `json:\"name\"`\nAge  int32  `json:\"age\"`\n}\nfunc main() {\n// \u4f7f\u7528OpenFile()\u6253\u5f00\u6587\u4ef6\uff0c\u8bbe\u7f6eO_TRUNC\u6a21\u5f0f\uff0c\u6bcf\u6b21\u5199\u5165\u5c06\u8986\u76d6\u539f\u6709\u6570\u636e\n// \u5982\u679c\u4e0d\u60f3\u4e3aOpenFile()\u8bbe\u7f6e\u53c2\u6570\uff0c\u53ef\u4ee5\u7528Create()\u4ee3\u66ff\uff0c\u5b9e\u73b0\u6548\u679c\u4e00\u6837\nf2, _ := os.OpenFile(\"output.json\", os.O_RDWR|os.O_CREATE|os.O_TRUNC, 0755)\n// \u521b\u5efaPersonInfo\u7c7b\u578b\u7684\u5207\u7247\np := []PersonInfo{{\"David\", 30}, {\"Lee\", 27}}\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Encoder\uff0c\u5b9e\u73b0\u6570\u636e\u5199\u5165\nencoder := json.NewEncoder(f2)\nencoder.SetIndent(\"\", \"\\t\")\n// \u5c06\u53d8\u91cfp\u7684\u6570\u636e\u5199\u5165JSON\u6587\u4ef6\n// \u6570\u636e\u5199\u5165\u5fc5\u987b\u4f7f\u7528\u6587\u4ef6\u5185\u5bb9\u8986\u76d6\uff0c\u5373\u8bbe\u7f6eos.O_TRUNC\u6a21\u5f0f\uff0c\u5426\u5219\u5bfc\u81f4\u5185\u5bb9\u9519\u4e71\nerr := encoder.Encode(p)\n// \u5982\u679cerr\u4e0d\u4e3a\u7a7a\u503cnil\uff0c\u5219\u8bf4\u660e\u5199\u5165\u9519\u8bef\nif err != nil {\nfmt.Printf(\"JSON\u5199\u5165\u5931\u8d25\uff1a%v\\n\", err.Error())\n} else {\nfmt.Printf(\"JSON\u5199\u5165\u6210\u529f\\n\")\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/#4newdecoder\u51fd\u6570","title":"4.NewDecoder\u51fd\u6570","text":"<p>\u8bfb\u53d6JSON\u6587\u4ef6\u7531\u5de5\u5382\u51fd\u6570NewDecoder()\u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Decoder\uff0c \u518d\u7531\u7ed3\u6784\u4f53\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8c03\u7528Decode()\u65b9\u6cd5\u5b8c\u6210\u6570\u636e\u7684\u8bfb\u53d6\u64cd\u4f5c\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n\"os\"\n)\ntype PersonInfo struct {\nName string `json:\"name\"`\nAge  int32  `json:\"age\"`\n}\nfunc main() {\n// \u4f7f\u7528OpenFile()\u6253\u5f00\u6587\u4ef6\uff0c\u8bbe\u7f6eO_CREATE\u6a21\u5f0f\uff0c\u6587\u4ef6\u4e0d\u5b58\u5728\u5219\u521b\u5efa\n// \u5982\u679c\u4e0d\u60f3\u4e3aOpenFile()\u8bbe\u7f6e\u53c2\u6570\uff0c\u53ef\u4ee5\u7528Open()\u4ee3\u66ff\uff0c\u5b9e\u73b0\u6548\u679c\u4e00\u6837\nf1, _ := os.OpenFile(\"output.json\", os.O_RDWR|os.O_CREATE, 0755)\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\u7c7b\u578b\u7684\u5207\u7247\nvar person []PersonInfo\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Decoder\uff0c\u5b9e\u73b0\u6570\u636e\u8bfb\u53d6\ndata := json.NewDecoder(f1)\n// \u5c06\u5df2\u8bfb\u53d6\u7684\u6570\u636e\u52a0\u8f7d\u5230\u5207\u7247person\nerr := data.Decode(&amp;person)\n// \u5982\u679cerr\u4e0d\u4e3a\u7a7a\u503cnil\uff0c\u5219\u8bf4\u660e\u8bfb\u53d6\u9519\u8bef\nif err != nil {\nfmt.Printf(\"JSON\u8bfb\u53d6\u5931\u8d25\uff1a%v\\n\", err.Error())\n} else {\n// \u5c06\u89e3\u7801\u540e\u7684\u6570\u636e\u8f6c\u6362\u4e3a\u5e26\u6709\u7f29\u8fdb\u7684JSON\u5b57\u7b26\u4e32\njsonStr, _ := json.MarshalIndent(person, \"\", \"    \")\nfmt.Printf(\"JSON\u8bfb\u53d6\u6210\u529f\uff1a%v\\n\", string(jsonStr))\n}\n// \u5173\u95ed\u6587\u4ef6\nf1.Close()\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/22.%E5%A4%84%E7%90%86JSON%E6%96%87%E4%BB%B6/#5\u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u5b66\u751f\u7ba1\u7406\u7cfb\u7edf","title":"5.\u5b9e\u8df5-\u7f16\u7a0b\u5b9e\u73b0\u5b66\u751f\u7ba1\u7406\u7cfb\u7edf","text":"<p>\u5b66\u751f\u7ba1\u7406\u7cfb\u7edf\u4e3a\u4f8b\uff0c\u901a\u8fc7\u547d\u4ee4\u884c\u754c\u9762\u5b9e\u73b0\u5b66\u751f\u7684\u6570\u636e\u7ba1\u7406\uff0c\u5b66\u751f\u6570\u636e\u4ee5JSON\u6587\u4ef6\u5b58\u50a8\uff0c\u6574\u4e2a\u793a\u4f8b\u529f\u80fd\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ol> <li>\u7528\u6237\u6839\u636e\u547d\u4ee4\u884c\u63d0\u793a\u8f93\u5165\u64cd\u4f5c\u6307\u4ee4\uff0c\u5305\u62ec\u5b66\u751f\u4fe1\u606f\u7684\u67e5\u8be2\u3001\u65b0\u589e\u3001\u5220\u9664\u548c\u9000\u51fa\u7cfb\u7edf\u3002</li> <li>\u67e5\u8be2\u5b66\u751f\u4fe1\u606f\u5305\u62ec\u67e5\u8be2\u5168\u90e8\u5b66\u751f\u4fe1\u606f\u548c\u67e5\u8be2\u67d0\u4e2a\u5b66\u751f\u4fe1\u606f\uff0c\u67e5\u8be2\u65b9\u5f0f\u6309\u7167\u547d\u4ee4\u884c\u63d0\u793a\u64cd\u4f5c\u5373\u53ef\u3002</li> <li>\u65b0\u589e\u5b66\u751f\u4fe1\u606f\u9700\u8981\u4f9d\u6b21\u8f93\u5165\u5b66\u751f\u7684\u5b66\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3001\u5e74\u7ea7\u548c\u4e13\u4e1a\u3002</li> <li>\u5220\u9664\u5b66\u751f\u4fe1\u606f\u9700\u8981\u8f93\u5165\u5b66\u751f\u7684\u5b66\u53f7\u5b8c\u6210\u5220\u9664\u8fc7\u7a0b\u3002</li> <li>\u9000\u51fa\u7cfb\u7edf\u662f\u7ec8\u6b62\u7a0b\u5e8f\u8fd0\u884c\u3002</li> </ol> <pre><code>package main\nimport (\n\"encoding/json\"\n\"fmt\"\n\"os\"\n)\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\ntype Student struct {\nId    int    `json:\"id\"`\nName  string `json:\"name\"`\nAge   int    `json:\"age\"`\nGrade string `json:\"grade\"`\nMajor string `json:\"major\"`\n}\nfunc data_process(style string, s ...Student) []Student {\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\u7c7b\u578b\u7684\u5207\u7247\nvar person []Student\n// \u8bfb\u53d6JSON\u6587\u4ef6\nif style == \"read\" {\nf1, _ := os.OpenFile(\"data.json\", os.O_RDWR|os.O_CREATE, 0755)\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Decoder\uff0c\u5b9e\u73b0\u6570\u636e\u8bfb\u53d6\ndata := json.NewDecoder(f1)\n// \u5c06\u5df2\u8bfb\u53d6\u7684\u6570\u636e\u52a0\u8f7d\u5230\u5207\u7247person\ndata.Decode(&amp;person)\nf1.Close()\n}\n// \u5199\u5165JSON\u6587\u4ef6\nif style == \"write\" {\nf2, _ := os.OpenFile(\"data.json\", os.O_RDWR|os.O_CREATE|os.O_TRUNC, 0755)\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Encoder\uff0c\u5b9e\u73b0\u6570\u636e\u5199\u5165\nencoder := json.NewEncoder(f2)\n// \u6570\u636e\u5199\u5165\u5fc5\u987b\u4f7f\u7528\u6587\u4ef6\u5185\u5bb9\u8986\u76d6\uff0c\u5373\u8bbe\u7f6eos.O_TRUNC\u6a21\u5f0f\uff0c\u5426\u5219\u5bfc\u81f4\u5185\u5bb9\u9519\u4e71\nencoder.Encode(s)\nf2.Close()\n}\nreturn person\n}\nfunc main() {\nvar s int\nfor {\n// \u8f93\u51fa\u64cd\u4f5c\u63d0\u793a\nfmt.Printf(\"\u6b22\u8fce\u6765\u5230\u5b66\u751f\u4fe1\u606f\u7ba1\u7406\u7cfb\u7edf\\n\")\nfmt.Printf(\"\u67e5\u8be2\u8bf7\u63091,\u65b0\u589e\u8bf7\u63092,\u5220\u9664\u8bf7\u63093,\u9000\u51fa\u8bf7\u63094\uff1a\\n\")\n// \u5b58\u50a8\u7528\u6237\u8f93\u5165\u6570\u636e\nfmt.Scanln(&amp;s)\nif s == 1 {\n// \u8bfb\u53d6JSON\u6587\u4ef6\u83b7\u53d6\u5b66\u751f\u4fe1\u606f\ndata := data_process(\"read\")\nif len(data) == 0 {\n// JSON\u6587\u4ef6\u8bfb\u53d6\u5931\u8d25\ncontinue\n}\nvar qs int\nfmt.Printf(\"\u67e5\u8be2\u5168\u90e8\u8bf7\u63091,\u67e5\u8be2\u67d0\u4e2a\u5b66\u751f\u8bf7\u63092\uff1a\\n\")\nfmt.Scanln(&amp;qs)\nif qs == 1 {\n// \u67e5\u8be2\u5168\u90e8\u5b66\u751f\u4fe1\u606f\nfor _, v := range data {\nfmt.Printf(\"\u5b66\u53f7\uff1a%v\u3001\", v.Id)\nfmt.Printf(\"\u59d3\u540d\uff1a%v\u3001\", v.Name)\nfmt.Printf(\"\u5e74\u9f84\uff1a%v\u3001\", v.Age)\nfmt.Printf(\"\u5e74\u7ea7\uff1a%v\u3001\", v.Grade)\nfmt.Printf(\"\u4e13\u4e1a\uff1a%v\\n\", v.Major)\n}\n} else if qs == 2 {\n// \u67e5\u8be2\u67d0\u4e2a\u5b66\u751f\u4fe1\u606f\nvar id int\nfmt.Printf(\"\u8bf7\u8f93\u5165\u5b66\u53f7\u67e5\u8be2\\n\")\nfmt.Scanln(&amp;id)\nfor _, v := range data {\nif v.Id == id {\nfmt.Printf(\"\u5b66\u53f7\uff1a%v\u3001\", v.Id)\nfmt.Printf(\"\u59d3\u540d\uff1a%v\u3001\", v.Name)\nfmt.Printf(\"\u5e74\u9f84\uff1a%v\u3001\", v.Age)\nfmt.Printf(\"\u5e74\u7ea7\uff1a%v\u3001\", v.Grade)\nfmt.Printf(\"\u4e13\u4e1a\uff1a%v\\n\", v.Major)\n}\n}\n}\n} else if s == 2 {\nvar id, age int\nvar name, grade, major string\nfmt.Printf(\"\u8bf7\u8f93\u5165\u5b66\u53f7\\n\")\nfmt.Scanln(&amp;id)\nfmt.Printf(\"\u8bf7\u8f93\u5165\u59d3\u540d\\n\")\nfmt.Scanln(&amp;name)\nfmt.Printf(\"\u8bf7\u8f93\u5165\u5e74\u9f84\\n\")\nfmt.Scanln(&amp;age)\nfmt.Printf(\"\u8bf7\u8f93\u5165\u5e74\u7ea7\\n\")\nfmt.Scanln(&amp;grade)\nfmt.Printf(\"\u8bf7\u8f93\u5165\u4e13\u4e1a\\n\")\nfmt.Scanln(&amp;major)\n// \u8bfb\u53d6JSON\u6587\u4ef6\u83b7\u53d6\u5b66\u751f\u4fe1\u606f\ndata := data_process(\"read\")\n// \u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Student\nstu := Student{\nId: id, Name: name, Age: age,\nGrade: grade, Major: major,\n}\n// \u5c06\u5b9e\u4f8b\u5316\u5bf9\u8c61\u5199\u5165\u5207\u7247data\ndata = append(data, stu)\n// \u5c06\u5207\u7247data\u5199\u5165JSON\u6587\u4ef6\uff0c\u5229\u7528\u5207\u7247\u7684\u89e3\u5305\u539f\u7406\ndata_process(\"write\", data...)\n} else if s == 3 {\nvar id int\nvar new_data []Student\n// \u8bfb\u53d6JSON\u6587\u4ef6\u83b7\u53d6\u5b66\u751f\u4fe1\u606f\ndata := data_process(\"read\")\nfmt.Printf(\"\u8f93\u5165\u5b66\u53f7\u5220\u9664\u5b66\u751f\u4fe1\u606f\uff1a\\n\")\nfmt.Scanln(&amp;id)\nfmt.Printf(\"\u5220\u9664\u524d\u7684\u5b66\u751f\u4fe1\u606f\uff1a%v\\n\", data)\nfor _, v := range data {\nif v.Id != id {\nnew_data = append(new_data, v)\n}\n}\ndata_process(\"write\", new_data...)\nfmt.Printf(\"\u5220\u9664\u540e\u7684\u5b66\u751f\u4fe1\u606f\uff1a%v\\n\", new_data)\n} else if s == 4 {\nbreak\n}\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/","title":"\u5904\u7406CSV\u6587\u4ef6","text":"<p>CSV\uff08Comma-Separated Values\uff0c\u9017\u53f7\u5206\u9694\u503c\uff09\u6587\u4ef6\u4ee5\u7eaf\u6587\u672c\u5f62\u5f0f\u5b58\u50a8\u8868\u683c\u6570\u636e\uff08\u6570\u5b57\u548c\u6587\u672c\uff09\uff0c\u6bcf\u884c\u6570\u636e\u7684\u5404\u4e2a\u5b57\u6bb5\u4f7f\u7528\u9017\u53f7\u6216\u5236\u8868\u7b26\u5206\u9694\uff0c\u652f\u6301Excel\u548c\u8bb0\u4e8b\u672c\u6253\u5f00\u3002</p> <p>\u6807\u51c6\u5e93<code>https://pkg.go.dev/encoding/csv</code></p> <p>\u5185\u7f6e\u5305encoding/csv\u63d0\u4f9b4\u79cd\u65b9\u5f0f\u8bfb\u5199CSV\u6587\u4ef6\uff1a \u6309\u884c\u8bfb\u53d6\u3001\u5168\u90e8\u8bfb\u53d6\u3001\u6309\u884c\u5199\u5165\u548c\u5168\u90e8\u5199\u5165\uff0c\u5206\u522b\u7531Read()\u3001ReadAll()\u3001Write()\u548cWriteAll()\u5b9e\u73b0\u3002CSV\u6587\u4ef6\u6570\u636e\u5199\u5165\u793a\u4f8b\u5982\u4e0b\uff1a</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/#\u6309\u884c\u5199\u5165\u548c\u5168\u90e8\u5199\u5165","title":"\u6309\u884c\u5199\u5165\u548c\u5168\u90e8\u5199\u5165","text":"<pre><code>package main\nimport (\n\"encoding/csv\"\n\"fmt\"\n\"os\"\n)\nfunc main() {\n// OpenFile()\u521b\u5efa\u6216\u6253\u5f00\u6587\u4ef6\uff0c\u8bbe\u7f6e\u8bfb\u5199\u6a21\u5f0f\n// \u5982\u679c\u8bbe\u7f6eO_APPEND\u6a21\u5f0f\uff0c\u5b9e\u73b0\u6587\u4ef6\u7eed\u5199\u529f\u80fd\n// \u5982\u679c\u8bbe\u7f6eO_TRUNC\u6a21\u5f0f\uff0c\u65b0\u6570\u636e\u8986\u76d6\u6587\u4ef6\u539f\u6709\u6570\u636e\nnfs, _ := os.OpenFile(\"input.csv\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0)\n// \u5c06\u6587\u4ef6\u5bf9\u8c61nfs\u52a0\u8f7d\u5230NewWriter()\uff0c\u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Writer\ncsvWriter := csv.NewWriter(nfs)\n// \u8bbe\u7f6e\u7ed3\u6784\u4f53Writer\u7684\u6210\u5458\n// Comma\u8bbe\u7f6e\u6bcf\u4e2a\u5b57\u6bb5\u4e4b\u95f4\u7684\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u9017\u53f7\ncsvWriter.Comma = ','\n// UseCRLF\u9ed8\u8ba4\u4e3atrue\uff0c\u4f7f\u7528\\r\\n\u4f5c\u4e3a\u6362\u884c\u7b26\ncsvWriter.UseCRLF = true\n// \u5199\u5165\u4e00\u884c\u6570\u636e\nrow := []string{\"1\", \"2\", \"3\", \"4\"}\nerr := csvWriter.Write(row)\nif err != nil {\nfmt.Printf(\"\u65e0\u6cd5\u5199\u5165\uff0c\u9519\u8bef\u4fe1\u606f\uff1a%v\\n\", err)\n}\n// \u4e00\u6b21\u6027\u5199\u5165\u591a\u884c\u6570\u636e\nvar newContent [][]string\nnewContent = append(newContent, []string{\"11\", \"12\", \"13\", \"14\"})\nnewContent = append(newContent, []string{\"21\", \"22\", \"23\", \"24\"})\ncsvWriter.WriteAll(newContent)\n// \u5c06\u6570\u636e\u5199\u5165\u6587\u4ef6\ncsvWriter.Flush()\n// \u5173\u95ed\u6587\u4ef6\nnfs.Close()\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/#\u6309\u884c\u8bfb\u53d6\u548c\u5168\u90e8\u8bfb\u53d6","title":"\u6309\u884c\u8bfb\u53d6\u548c\u5168\u90e8\u8bfb\u53d6","text":"<pre><code>package main\nimport (\n\"encoding/csv\"\n\"fmt\"\n\"io\"\n\"os\"\n)\nfunc main() {\n// OpenFile()\u521b\u5efa\u6216\u6253\u5f00\u6587\u4ef6\uff0c\u8bbe\u7f6e\u8bfb\u5199\u6a21\u5f0f\n// O_RDWR\u5df2\u7ecf\u652f\u6301\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c\n// O_CREATE\u5f53\u6587\u4ef6\u4e0d\u5b58\u5728\u4f1a\u81ea\u52a8\u521b\u5efa\u6587\u4ef6\nfs, _ := os.OpenFile(\"input.csv\", os.O_RDWR|os.O_CREATE, 0)\n// \u5c06\u6587\u4ef6\u5bf9\u8c61fs\u52a0\u8f7d\u5230NewReader()\uff0c\u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Reader\ncsvReader := csv.NewReader(fs)\n// \u4e00\u884c\u4e00\u884c\u7684\u8bfb\u53d6\u6587\u4ef6\uff0c\u5e38\u7528\u4e8e\u5927\u6587\u4ef6\nfor {\n// \u8c03\u7528\u7ed3\u6784\u4f53\u65b9\u6cd5Read()\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\nrow, err := csvReader.Read()\nif err == io.EOF || err != nil {\nbreak\n}\nfmt.Printf(\"Read()\u8bfb\u53d6CSV\u5185\u5bb9\uff1a%v\uff0c\u6570\u636e\u7c7b\u578b\uff1a%T\\n\", row, row)\n}\n// \u5173\u95ed\u6587\u4ef6\nfs.Close()\n// \u4e00\u6b21\u6027\u8bfb\u53d6\u6587\u4ef6\u6240\u6709\u5185\u5bb9\uff0c\u5e38\u7528\u4e8e\u5c0f\u6587\u4ef6\nfs1, _ := os.OpenFile(\"input.csv\", os.O_RDWR|os.O_CREATE, 0)\n// \u5c06\u6587\u4ef6\u5bf9\u8c61fs1\u52a0\u8f7d\u5230NewReader()\uff0c\u5b9e\u4f8b\u5316\u7ed3\u6784\u4f53Reader\ncsvReader1 := csv.NewReader(fs1)\n// \u8c03\u7528\u7ed3\u6784\u4f53\u65b9\u6cd5ReadAll()\u8bfb\u53d6\u6587\u4ef6\u6240\u6709\u5185\u5bb9\ncontent, err := csvReader1.ReadAll()\nif err != nil {\nfmt.Printf(\"ReadAll()\u8bfb\u53d6\u5931\u8d25\uff1a%v\\n\", err)\n}\n// \u904d\u5386\u8f93\u51fa\u6bcf\u4e00\u884c\u6570\u636e\nfor _, row := range content {\nfmt.Printf(\"ReadAll()\u8bfb\u53d6CSV\u5185\u5bb9\uff1a%v\uff0c\u6570\u636e\u7c7b\u578b\uff1a%T\\n\", row, row)\n}\n// \u5173\u95ed\u6587\u4ef6\nfs1.Close()\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/23.%E5%A4%84%E7%90%86CSV%E6%96%87%E4%BB%B6/#\u793a\u4f8bdemo","title":"\u793a\u4f8bdemo","text":"<p><code>main.go</code></p> <pre><code>package main\nimport (\n\"encoding/csv\"\n\"fmt\"\n\"os\"\n)\nfunc main() {\nWrite_csv()\nRead_csv()\n}\nfunc Write_csv() {\nf, err := os.Create(\"test.csv\")\nif err != nil {\nfmt.Println(err)\nreturn\n}\ndefer f.Close()\nvar data = make([][]string, 3)\ndata[0] = []string{\"\u6807\u9898\", \"\u4f5c\u8005\", \"\u65f6\u95f4\"}\ndata[1] = []string{\"\u7f8a\u76ae\u5377\", \"\u9c81\u8fc5\", \"2008\"}\ndata[2] = []string{\"\u6613\u7b4b\u7ecf\", \"\u5510\u751f\", \"665\"}\nf.WriteString(\"\\xEF\\xBB\\xBF\") //\u5199\u5165\u4e00\u4e2aUTF-8 BOM\nw := csv.NewWriter(f) //\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5199\u5165\u6587\u4ef6\u6d41\nw.WriteAll(data)\nw.Flush()\n}\nfunc Read_csv() {\nf, err := os.Open(\"test.csv\")\nif err != nil {\nfmt.Println(err)\nreturn\n}\ndefer f.Close()\nw := csv.NewReader(f)\ndata, err := w.ReadAll()\nif err != nil {\nfmt.Println(err)\nreturn\n}\nfmt.Println(data)\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/","title":"\u5904\u7406Go\u65e5\u5fd7\u8bb0\u5f55","text":"<p>log\u5305\u63d0\u4f9b3\u7c7b\u51fd\u6570\u5904\u7406\u65e5\u5fd7\uff1a</p> <ul> <li>Print\u7c7b\u51fd\u6570\uff0c\u5904\u7406\u4e00\u822c\u65e5\u5fd7\uff0c\u9000\u51fa\u78010\uff08\u6b63\u5e38\uff09\u3002</li> <li>Panic\u7c7b\u51fd\u6570\uff0c\u5904\u7406\u610f\u5916\u65e5\u5fd7\uff0c\u9000\u51fa\u78011\u3002</li> <li>Fatal\u7c7b\u51fd\u6570\uff0c\u5904\u7406\u81f4\u547d\u65e5\u5fd7\uff0c\u9000\u51fa\u78011\u3002</li> </ul>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/#1print\u7c7b\u51fd\u6570","title":"1.Print\u7c7b\u51fd\u6570","text":"<pre><code>package main\nimport (\n\"log\"\n)\nfunc main() {\nno := []int{6, 8}\nlog.Print(\"Print NO. \", no, \"\\n\")\nlog.Println(\"Println NO.\", no)\nlog.Printf(\"Printf NO. with item [%d,%d]\\n\", no[0], no[1])\n}\n/*\n2022/06/22 15:12:12 Print NO. [6 8]\n2022/06/22 15:12:12 Println NO. [6 8]\n2022/06/22 15:12:12 Printf NO. with item [6,8]\n*/\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/#2panic\u7c7b\u51fd\u6570","title":"2.Panic\u7c7b\u51fd\u6570","text":"<pre><code>package main\nimport (\n\"log\"\n)\nfunc main() {\nno := []int{6, 8}\nlog.Panicln(\"Println NO.\", no)\n}\n/* 2022/06/22 15:13:19 Println NO. [6 8]\npanic: Println NO. [6 8]\ngoroutine 1 [running]:\nlog.Panicln(0xc000153f58, 0x2, 0x2)\n        D:/Program Files/go/src/log/log.go:368 +0xb7\nmain.main()\n        D:/tmp/go_log/main.go:9 +0xc5\nexit status 2 */\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/#3fatal\u7c7b\u51fd\u6570","title":"3.Fatal\u7c7b\u51fd\u6570","text":"<pre><code>package main\nimport (\n\"log\"\n)\nfunc main() {\nno := []int{6, 8}\nlog.Fatalln(\"Println NO.\", no)\n}\n/*\n2022/06/22 15:14:15 Println NO. [6 8]\nexit status 1\n*/\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/24.%E5%A4%84%E7%90%86Go%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/#4\u81ea\u5b9a\u4e49logger\u7c7b\u578b","title":"4.\u81ea\u5b9a\u4e49Logger\u7c7b\u578b","text":"<pre><code>func New(out io.Writer, prefix string, flag int) *Logger\n</code></pre> <p>\u8be5\u51fd\u6570\u4e00\u5171\u67093\u4e2a\u53c2\u6570\uff1a</p> <ul> <li> <p>\u53c2\u6570out\u7528\u4e8e\u8f93\u51fa\u4f4d\u7f6e\uff0c\u662f\u4e00\u4e2aio.Writer\u5bf9\u8c61\u3002\u8be5\u5bf9\u8c61\u53ef\u4ee5\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u662f\u5b9e\u73b0\u4e86\u8be5\u63a5\u53e3\u7684\u5bf9\u8c61\u3002\u901a\u5e38\u6211\u4eec\u53ef\u4ee5\u7528\u5b83\u6765\u6307\u5b9a\u65e5\u5fd7\u8f93\u51fa\u5230\u54ea\u4e2a\u6587\u4ef6\u3002</p> </li> <li> <p>\u53c2\u6570prefix,\u7528\u4e8e\u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\u3002\u53ef\u4ee5\u5c06\u5176\u7f6e\u4e3a\"[lnfo]\" \"[Warning]\"\u7b49\u6765\u5e2e\u52a9\u533a\u5206\u65e5\u5fd7\u7ea7\u522b\u3002</p> </li> <li> <p>\u53c2\u6570flags\u662f\u4e00\u4e2a\u9009\u9879\uff0c\u7528\u4e8e\u663e\u793a\u65e5\u5fd7\u5f00\u5934\u7684\u90e8\u5206\u3002</p> </li> </ul> <pre><code>package main\nimport (\n\"log\"\n\"os\"\n)\nfunc main() {\nfileName := \"New.log\"\nlogFile, err := os.Create(fileName)\ndefer logFile.Close()\nif err != nil {\nlog.Fatalln(\"open file error\")\n}\ndebugLog := log.New(logFile, \"[Info]\", log.Llongfile)\ndebugLog.Println(\"Info Level Message\")\ndebugLog.SetPrefix(\"[Debug]\")\ndebugLog.Println(\"Debug Level Message\")\n}\n/*\n[Info]D:/tmp/go_log/main.go:16: Info Level Message\n[Debug]D:/tmp/go_log/main.go:18: Debug Level Message\n*/\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/","title":"\u5904\u7406\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#1\u6b63\u5219\u8868\u8fbe\u5f0f\u7b80\u4ecb","title":"1.\u6b63\u5219\u8868\u8fbe\u5f0f\u7b80\u4ecb","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u7279\u70b9\uff1a</p> <ol> <li>\u7075\u6d3b\u6027\u3001\u903b\u8f91\u6027\u548c\u529f\u80fd\u6027\u975e\u5e38\u5f3a\u3002</li> <li>\u7b80\u5355\u65b9\u5f0f\u5b9e\u73b0\u5b57\u7b26\u4e32\u7684\u590d\u6742\u63a7\u5236\u3002</li> <li>\u6666\u6da9\u96be\u61c2\u3002</li> </ol> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u9ad8\u6587\u672c\u5904\u7406\u80fd\u529b\uff0c\u7528\u4e8e\u8868\u5355\u8f93\u5165\u9a8c\u8bc1\u3001\u6587\u672c\u63d0\u53d6\u3001\u6570\u636e\u5206\u6790\u7b49\u3002</p> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u7531\u666e\u901a\u5b57\u7b26\uff08<code>a~z</code>\u3001<code>A~Z</code>\u3001<code>0~9</code>\u7b49\uff09\u548c\u7279\u6b8a\u5b57\u7b26\uff08\u5143\u5b57\u7b26\uff09\u7ec4\u6210\u3002</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#2\u4f7f\u7528go\u6b63\u5219\u8868\u8fbe\u5f0f","title":"2.\u4f7f\u7528Go\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u53c2\u8003\u6807\u51c6\u5e93\u6587\u6863\uff1a</p> <p>https://studygolang.com/pkgdoc</p> <p>https://zhuanlan.zhihu.com/p/396375666</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#21-regexp\u5305\u7684\u5e38\u7528\u51fd\u6570","title":"2.1 regexp\u5305\u7684\u5e38\u7528\u51fd\u6570","text":""},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#1\u83b7\u53d6\u6b63\u5219\u5bf9\u8c61","title":"1.\u83b7\u53d6\u6b63\u5219\u5bf9\u8c61","text":"<pre><code>func Compile(expr string) (*Regexp, error)\nfunc MustCompile(str string) *Regexp\n</code></pre> <p><code>MustCompile()</code>\u51fd\u6570\u5931\u8d25\u4f1a\u5b95\u673a\u3002</p> <pre><code>reg, err := regexp.Compile(`\\d+`)\nreg := regexp.MustCompile(`\\d+`)\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#2\u5339\u914d\u68c0\u6d4b","title":"2.\u5339\u914d\u68c0\u6d4b","text":"<pre><code>func (re *Regexp) MatchString(s string) bool\nfunc (re *Regexp) Match(b []byte) bool\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc main() {\ntext := \"Hello Gopher, Hello Go Web\"\nreg := regexp.MustCompile(`\\w+`)\nfmt.Println(reg.MatchString(text)) //true\nmatch, _ := regexp.MatchString(\"H(.*)d!\", \"Hello World!\")\nfmt.Println(match) //true\nmatch, _ = regexp.Match(\"H(.*)d!\", []byte(\"Hello World!\"))\nfmt.Println(match) //true\nr, _ := regexp.Compile(\"H(.*)d!\")\nfmt.Println(r.MatchString(\"Hello World!\")) //true\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc main() {\nre := regexp.MustCompile(`who(o*)a(a|m)i`)\nfmt.Printf(\"%q\\n\", re.FindStringSubmatch(\"-whooooaai-\")) //[\"whooooaai\" \"ooo\" \"a\"]\nfmt.Printf(\"%q\\n\", re.FindStringSubmatch(\"-whoami-\"))    //[\"whoami\" \"\" \"m\"]\n//\n//re := regexp.MustCompile(`w(a*)i`)\n//fmt.Printf(\"%q\\n\", re.FindAllStringSubmatch(\"-wi-\", -1))\n//fmt.Printf(\"%q\\n\", re.FindAllStringSubmatch(\"-waaai-\", -1))\n//fmt.Printf(\"%q\\n\", re.FindAllStringSubmatch(\"-wi-wai-\", -1))\n//fmt.Printf(\"%q\\n\", re.FindAllStringSubmatch(\"-waaaaai-wi-\", -1))\n//re := regexp.MustCompile(`wh(|o)`)\n//fmt.Println(re.FindString(\"who\"))\n//re.Longest()\n//fmt.Println(re.FindString(\"who\"))\n//re := regexp.MustCompile(`w(a*)i`)\n//re.Longest()\n//fmt.Println(re.FindString(\"-waaaaai-wi-\")) // waaaaai\uff0c\u4e0d\u4f1a\u5b58\u5728\u7b2c\u4e00\u4e2aw\u548c\u6700\u540e\u4e00\u4e2ai\u7ec4\u5408\u7684\u8fc7\u7a0b\u3002\n//re1 := regexp.MustCompile(`w.`)\n//fmt.Printf(\"%d\\n\", re1.NumSubexp())\n//\n//re2 := regexp.MustCompile(`(.*)((w)eb)(.*)w`)\n//fmt.Println(re2.NumSubexp())\n//re := regexp.MustCompile(`w(a*)i`)\n//fmt.Printf(\"%s\\n\", re.ReplaceAll([]byte(\"-wi-waaaaai-\"), []byte(\"T\")))\n//// $1\u8868\u793a\u5339\u914d\u7684\u7b2c\u4e00\u4e2a\u5b50\u4e32\uff0c\u8fd9\u662fwi\u7684\u4e2d\u95f4\u65e0\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5$1\u4e3a\u7a7a\uff0c\u7136\u540e\u4f7f\u7528\u7a7a\u53bb\u66ff\u6362\u6ee1\u8db3\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u90e8\u5206\u3002\n//fmt.Printf(\"%s\\n\", re.ReplaceAll([]byte(\"-wi-waaaaai-\"), []byte(\"$1\")))\n//// \"$1W\"\u7b49\u4ef7\u4e0e\"$(1W)\"\uff0c\u503c\u4e3a\u7a7a\uff0c\u5c06\u6ee1\u8db3\u6761\u4ef6\u7684\u90e8\u5206\u5b8c\u5168\u66ff\u6362\u4e3a\u7a7a\u3002\n//fmt.Printf(\"%s\\n\", re.ReplaceAll([]byte(\"-wi-waaaaai-\"), []byte(\"$1W\")))\n//// ${1}\u5339\u914d(x*)\uff0c\u4fdd\u7559\n//fmt.Printf(\"%s\\n\", re.ReplaceAll([]byte(\"-wi-waaaaai-\"), []byte(\"${1}W\")))\n//s := \"Hello Gopher, let's go!\"\n////\u5b9a\u4e49\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0freg\uff0c\u5339\u914dHello\u6216\u8005Go\n//reg := regexp.MustCompile(`(Hell|G)o`)\n//\n//s2 := \"2020-08-01,this is a test\"\n////\u5b9a\u4e49\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0freg2,\u5339\u914d YYYY-MM-DD \u7684\u65e5\u671f\u683c\u5f0f\n//reg2 := regexp.MustCompile(`(\\d{4})-(\\d{2})-(\\d{2})`)\n//\n////\u6700\u7b80\u5355\u7684\u60c5\u51b5\uff0c\u7528\u201cT\u66ff\u6362\u201d\"-ab-axxb-\"\u4e2d\u7b26\u5408\u6b63\u5219\"a(x*)b\"\u7684\u90e8\u5206\n//reg3 := regexp.MustCompile(\"w(a*)i\")\n//fmt.Println(reg3.ReplaceAllString(\"-wi-waai-\", \"T\"))\n//\n////${1}\u5339\u914d\"2020-08-01,this is a test\"\u4e2d\u7b26\u5408\u6b63\u5219`(Hell|G)`\u7684\u90e8\u5206\u5e76\u4fdd\u7559\uff0c\u53bb\u6389\"Hello\"\u4e0e\"Go\"\u4e2d\u7684'o'\u5e76\u7528\"hi\"\u8ffd\u52a0\n//rep1 := \"${1}hi\"\n//fmt.Printf(\"%q\\n\", reg.ReplaceAllString(s, rep1))\n//\n////\u9996\u5148\uff0c\"2020-08-01,this is a test\"\u4e2d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f`(\\d{4})-(\\d{2})-(\\d{2})`\u7684\u90e8\u5206\u662f\"2020-08-01\",\u5c06\u8be5\u90e8\u5206\u5339\u914d'(\\d{4})'\u7684'2020'\u4fdd\u7559\uff0c\u53bb\u6389\u5269\u4f59\u90e8\u5206\n//rep2 := \"${1}\"\n//fmt.Printf(\"%q\\n\", reg2.ReplaceAllString(s2,rep2))\n//\n////\u9996\u5148\uff0c\"2020-08-01,this is a test\"\u4e2d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f`(\\d{4})-(\\d{2})-(\\d{2})`\u7684\u90e8\u5206\u662f\"2020-08-01\",\u5c06\u8be5\u90e8\u5206\u5339\u914d'(\\d{2})'\u7684'08'\u4fdd\u7559\uff0c\u53bb\u6389\u5269\u4f59\u90e8\u5206\n//rep3 := \"${2}\"\n//fmt.Printf(\"%q\\n\", reg2.ReplaceAllString(s2,rep3))\n//\n////\u9996\u5148\uff0c\"2020-08-01,this is a test\"\u4e2d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f`(\\d{4})-(\\d{2})-(\\d{2})`\u7684\u90e8\u5206\u662f\"2020-08-01\",\u5c06\u8be5\u90e8\u5206\u5339\u914d'(\\d{2})'\u7684'01'\u4fdd\u7559\uff0c\u53bb\u6389\u5269\u4f59\u90e8\u5206,\u5e76\u8ffd\u52a0\"13:30:12\"\n//rep4 := \"${3}:15:25:12\"\n//fmt.Printf(\"%q\\n\", reg2.ReplaceAllString(s2,rep4))\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#3\u67e5\u627e","title":"3.\u67e5\u627e","text":"<pre><code>func (re *Regexp) FindString(s string) string       //\u8fd4\u56de\u5de6\u4fa7\u7b2c\u4e00\u4e2a\u5339\u914d\u7ed3\u679c\u3002\n</code></pre> <pre><code>func (re *Regexp) FindAllString(s string, n int) []string   //n\u9650\u5b9a\u67e5\u627e\u6570\u91cf\uff0c-1\u4e0d\u9650\u5236\u3002\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc main() {\ntext := \"Hello Gopher, Hello Go Web\"\nreg := regexp.MustCompile(`\\w+`)\nfmt.Println(reg.FindAllString(text, -1))\n}\n</code></pre> <pre><code>func (re *Regexp) FindAll(b []byte, n int) [][]byte\n</code></pre> <pre><code>func (re *Regexp) FindStringSubmatch(s string) []string //FindStringSubmatch\u8fd4\u56de\u4e00\u6bb5\u5b57\u7b26\u4e32\uff0c\u5176\u4e2d\u5305\u542bs\u4e2d\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u6700\u5de6\u4fa7\u5339\u914d\u9879\u4ee5\u53ca\u7684\u5339\u914d\u9879\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc main() {\n// re := regexp.MustCompile(`[^eovbgramin]`)\n// fmt.Println(re.ReplaceAllStringFunc(\"I love Go web programming\", strings.ToUpper))\n// re := regexp.MustCompile(`w(a*)i`)\n// fmt.Println(re.ReplaceAllLiteralString(\"-wi-waai-\", \"T\"))\n// fmt.Println(re.ReplaceAllLiteralString(\"-wi-waai-\", \"$1\"))\n// fmt.Println(re.ReplaceAllLiteralString(\"-wi-waai-\", \"${1}\"))\nreg := regexp.MustCompile(`^http://blog.sina.com.cn/([\\d]{4})/([\\d]{2})/([\\d]{2})/([\\w-]+).html$`)\nparams := reg.FindStringSubmatch(\"http://blog.sina.com.cn/2020/08/20/blog_dfcfef2f0102yyd1.html\")\n// \u8fd4\u56de[]string{}\u6570\u636e\u7c7b\u578b\nfor _, param := range params {\nfmt.Println(param)\n}\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc main() {\ntext := `Hi,Gopher,Enjoy learning Go Web,\u52a0\u6cb9\uff01`\n// \u67e5\u627e\u8fde\u7eed\u7684\u5c0f\u5199\u5b57\u6bcd\nreg := regexp.MustCompile(`[a-z]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u975e\u5c0f\u5199\u5b57\u6bcd\nreg = regexp.MustCompile(`[^a-z]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u5355\u8bcd\u5b57\u6bcd\nreg = regexp.MustCompile(`[\\w]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u975e\u5355\u8bcd\u5b57\u6bcd\u3001\u975e\u7a7a\u767d\u5b57\u7b26\nreg = regexp.MustCompile(`[^\\w\\s]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u5927\u5199\u5b57\u6bcd\nreg = regexp.MustCompile(`[[:upper:]]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u975e ASCII \u5b57\u7b26\nreg = regexp.MustCompile(`[[:^ascii:]]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u6807\u70b9\u7b26\u53f7\nreg = regexp.MustCompile(`[\\pP]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u975e\u6807\u70b9\u7b26\u53f7\u5b57\u7b26\nreg = regexp.MustCompile(`[\\PP]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u6c49\u5b57\nreg = regexp.MustCompile(`[\\p{Han}]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed\u7684\u975e\u6c49\u5b57\u5b57\u7b26\nreg = regexp.MustCompile(`[\\P{Han}]+`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e Hello \u6216 Go\nreg = regexp.MustCompile(`Hello|Go`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u884c\u9996\u4ee5 H \u5f00\u5934\uff0c\u4ee5\u7a7a\u683c\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\nreg = regexp.MustCompile(`^H.*\\s`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u884c\u9996\u4ee5 H \u5f00\u5934\uff0c\u4ee5\u7a7a\u767d\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\uff08\u975e\u8d2a\u5a6a\u6a21\u5f0f\uff09\nreg = regexp.MustCompile(`(?U)^H.*\\s`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u4ee5 hello \u5f00\u5934\uff08\u5ffd\u7565\u5927\u5c0f\u5199\uff09\uff0c\u4ee5 Go \u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\nreg = regexp.MustCompile(`(?i:^hello).*Go`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e Go.\nreg = regexp.MustCompile(`\\QGo.\\E`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u4ece\u884c\u9996\u5f00\u59cb\uff0c\u4ee5\u7a7a\u683c\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\uff08\u975e\u8d2a\u5a6a\u6a21\u5f0f\uff09\nreg = regexp.MustCompile(`(?U)^.* `)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u4ee5\u7a7a\u683c\u5f00\u5934\uff0c\u5230\u884c\u5c3e\u7ed3\u675f\uff0c\u4e2d\u95f4\u4e0d\u5305\u542b\u7a7a\u683c\u5b57\u7b26\u4e32\nreg = regexp.MustCompile(` [^ ]*$`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u201c\u5355\u8bcd\u8fb9\u754c\u201d\u4e4b\u95f4\u7684\u5b57\u7b26\u4e32\nreg = regexp.MustCompile(`(?U)\\b.+\\b`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e\u8fde\u7eed 1 \u6b21\u5230 4 \u6b21\u7684\u975e\u7a7a\u683c\u5b57\u7b26\uff0c\u5e76\u4ee5 o \u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\nreg = regexp.MustCompile(`[^ ]{1,4}o`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e Hello \u6216 Go\nreg = regexp.MustCompile(`(?:Hell|G)o`)\nfmt.Printf(\"%q\\n\", reg.FindAllString(text, -1))\n// \u67e5\u627e Hello \u6216 Go\uff0c\u66ff\u6362\u4e3a Hellooo\u3001Gooo\nreg = regexp.MustCompile(`(?:o)`)\nfmt.Printf(\"%q\\n\", reg.ReplaceAllString(text, \"${n}ooo\"))\n// \u4ea4\u6362 Hello \u548c Go\nreg = regexp.MustCompile(`(Hello)(.*)(Go)`)\nfmt.Printf(\"%q\\n\", reg.ReplaceAllString(text, \"$3$2$1\"))\n// \u7279\u6b8a\u5b57\u7b26\u7684\u67e5\u627e\nreg = regexp.MustCompile(`[\\f\\t\\n\\r\\v\\123\\x7F\\x{10FFFF}\\\\\\^\\$\\.\\*\\+\\?\\{\\}\\(\\)\\[\\]\\|]`)\nfmt.Printf(\"%q\\n\", reg.ReplaceAllString(\"\\f\\t\\n\\r\\v\\123\\x7F\\U0010FFFF\\\\^$.*+?{}()[]|\", \"-\"))\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#4\u67e5\u627e\u5339\u914d\u4f4d\u7f6e","title":"4.\u67e5\u627e\u5339\u914d\u4f4d\u7f6e","text":""},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#5\u66ff\u6362","title":"5.\u66ff\u6362","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc main() {\nre := regexp.MustCompile(`Go(\\w+)`)\nfmt.Println(re.ReplaceAllString(\"Hello Gopher,Hello GoLang\", \"Java$1\")) //Hello Javapher,Hello JavaLang\ntext := \"Hello Gopher,Hello Go Web\"\nreg := regexp.MustCompile(`\\w+`)\nfmt.Println(reg.MatchString(text)) //true\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#6\u5206\u5272","title":"6.\u5206\u5272","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"strings\"\n)\nfunc main() {\ns := \"I_Love_Go_Web\"\nres := strings.Split(s, \"_\")\nfor key, value := range res {\nfmt.Printf(\"key:%d value:%s\\n\", key, value)\n}\n}\n/*\nkey:0 value:I\nkey:1 value:Love\nkey:2 value:Go\nkey:3 value:Web\n*/\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"strings\"\n)\nfunc main() {\nvalue := \"a|b|c|d\"\n// \u5206\u5272\u62103\u90e8\u5206\nresult := strings.SplitN(value, \"|\", 3)\nfor v := range result {\nfmt.Println(result[v])\n}\n}\n/*\na\nb\nc|d\n*/\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"strings\"\n)\nfunc main() {\ns := \"I_Love_Go_Web\"\nres := strings.Split(s, \"_\")\nfor i := range res {\nfmt.Println(res[i])\n}\nres1 := strings.SplitN(s, \"_\", 2)\nfor i := range res1 {\nfmt.Println(res1[i])\n}\nres2 := strings.SplitAfter(s, \"_\")\nfor i := range res2 {\nfmt.Println(res2[i])\n}\nres3 := strings.SplitAfterN(s, \"_\", 2)\nfor i := range res3 {\nfmt.Println(res3[i])\n}\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"strings\"\n)\nfunc main() {\nvalue := \"i'm gopher\"\nresult := strings.SplitAfter(value, \"\")\nfor i := range result {\n// \u83b7\u53d6\u5b57\u6bcd\nletter := result[i]\nfmt.Println(letter)\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#3-regexp\u5305\u7684\u5e94\u7528\u793a\u4f8b","title":"3. regexp\u5305\u7684\u5e94\u7528\u793a\u4f8b","text":"<p><code>phone.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc main() {\nres2 := findPhoneNumber(\"13688888888\")\nfmt.Println(res2) // true\nres2 = findPhoneNumber(\"02888888888\")\nfmt.Println(res2) // false\nres2 = findPhoneNumber(\"123456789\")\nfmt.Println(res2) // false\n}\nfunc findPhoneNumber(str string) bool {\n// \u521b\u5efa\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u89c4\u5219\u5bf9\u8c61\nreg := regexp.MustCompile(\"^1[1-9]{10}\")\n// \u5229\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u89c4\u5219\u5bf9\u8c61\u5339\u914d\u6307\u5b9a\u5b57\u7b26\u4e32\nres := reg.FindAllString(str, -1)\nif res == nil {\nreturn false\n}\nreturn true\n}\n</code></pre> <p><code>email.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc main() {\nres := findEmail(\"8888@qq.com\")\nfmt.Println(res) // true\nres = findEmail(\"shir?don@qq.com\")\nfmt.Println(res) // false\nres = findEmail(\"8888@qqcom\")\nfmt.Println(res) // false\n}\nfunc findEmail(str string) bool {\nreg := regexp.MustCompile(\"^[a-zA-Z0-9_]+@[a-zA-Z0-9]+\\\\.[a-zA-Z0-9]+\")\nres := reg.FindAllString(str, -1)\nif res == nil {\nreturn false\n}\nreturn true\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/25.%E5%A4%84%E7%90%86%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#4-\u6839\u636e\u6b63\u5219\u8868\u8fbe\u5f0f\u751f\u6210\u4ee3\u7801","title":"4. \u6839\u636e\u6b63\u5219\u8868\u8fbe\u5f0f\u751f\u6210\u4ee3\u7801","text":"<p>\u5728\u7ebf\u7248</p> <p>https://regex101.com/</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/","title":"\u5904\u7406Excel\u6587\u4ef6","text":"<p>Go\u8bed\u8a00\u8bfb\u5199Excel\u6587\u4ef6\u5fc5\u987b\u4f9d\u8d56\u7b2c\u4e09\u65b9\u5305\u5b9e\u73b0\uff0c\u5728GitHub\u641c\u7d22\u5173\u952e\u8bcd\"go excel\"\uff0c\u7f16\u7a0b\u8bed\u8a00\u9009\u62e9Go\u5c31\u80fd\u627e\u5230\u76f8\u5173\u7684\u7b2c\u4e09\u65b9\u5305\u3002</p> <p>\u5728\u9009\u62e9\u7b2c\u4e09\u65b9\u5305\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece3\u4e2a\u7ef4\u5ea6\u5224\u65ad\u662f\u5426\u9002\u5408\u5f00\u53d1\u9700\u6c42\uff1a\u5b98\u65b9\u6587\u6863\u3001\u661f\u661f\u6570\u91cf\u548c\u793e\u533a\u6d3b\u8dc3\u60c5\u51b5\uff0c\u5404\u4e2a\u7ef4\u5ea6\u7684\u5224\u65ad\u6807\u51c6\u5982\u4e0b\uff1a</p> <ol> <li>\u5b98\u65b9\u6587\u6863\u80fd\u4f7f\u5f00\u53d1\u8005\u5feb\u901f\u4e0a\u624b\uff0c\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\uff0c\u8fd9\u662f3\u4e2a\u7ef4\u5ea6\u4e2d\u6700\u91cd\u8981\u7684\uff0c\u5982\u679c\u6ca1\u6709\u5b8c\u5584\u7684\u6587\u6863\u6559\u7a0b\uff0c\u53ea\u80fd\u4ece\u6e90\u7801\u4e2d\u5206\u6790\u603b\u7ed3\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5f88\u6f2b\u957f\u548c\u75db\u82e6\u3002\u4f7f\u7528\u7b2c\u4e09\u65b9\u5305\u7684\u76ee\u7684\u662f\u4e0d\u7528\u81ea\u5df1\u9020\u8f6e\u5b50\uff0c\u5f00\u7bb1\u5373\u7528\uff0c\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\u3002\u5982\u679c\u6ca1\u6709\u5b98\u65b9\u6587\u6863\u6307\u5bfc\uff0c\u53ea\u9760\u81ea\u5df1\u5206\u6790\u603b\u7ed3\u6e90\u7801\uff0c\u8fd8\u4e0d\u5982\u81ea\u5df1\u9020\u8f6e\u5b50\u3002\u603b\u7684\u6765\u8bf4\uff0c\u6ca1\u6709\u5b98\u65b9\u6587\u6863\u7684\u7b2c\u4e09\u65b9\u5305\uff0c\u5373\u4f7f\u662f\u795e\u5668\uff0c\u65e0\u6cd5\u5feb\u901f\u4e0a\u624b\u4e5f\u662f\u5e9f\u5668\u3002</li> <li>\u661f\u661f\u6570\u91cf\u53cd\u6620\u4e86\u5f53\u524d\u7b2c\u4e09\u65b9\u5305\u7684\u4f7f\u7528\u70ed\u5ea6\uff0c\u6570\u91cf\u8d8a\u591a\u8bf4\u660e\u4f7f\u7528\u4eba\u7fa4\u8d8a\u5e7f\u6cdb\u5e76\u4e14\u5f97\u5230\u8ba4\u540c\uff0c\u800c\u4e14\u6709\u5229\u4e8e\u53d1\u73b0\u5305\u7684bug\u3001\u6027\u80fd\u548c\u517c\u5bb9\u6027\u7b49\u95ee\u9898\u3002</li> <li>\u793e\u533a\u6d3b\u8dc3\u60c5\u51b5\u53cd\u6620\u7b2c\u4e09\u65b9\u5305\u7684bug\u3001\u6027\u80fd\u548c\u517c\u5bb9\u6027\u7b49\u95ee\u9898\u80fd\u5426\u53ca\u65f6\u4fee\u590d\uff0cGitHub\u63d0\u4f9b\u4e86Issues\u529f\u80fd\uff0c\u4e3a\u4f7f\u7528\u8005\u548c\u5f00\u53d1\u8005\u63d0\u4f9b\u4ea4\u6d41\u5e73\u53f0\u3002\u4eceIssues\u53ef\u4ee5\u770b\u5230\u5305\u7684\u5f02\u5e38\u548c\u4fee\u590d\u60c5\u51b5\uff0c\u4f7f\u7528\u8005\u63d0\u51fa\u5f02\u5e38\uff0c\u5982\u679c\u5f00\u53d1\u8005\u4ece\u4e0d\u4fee\u590d\u6216\u4fee\u590d\u65f6\u95f4\u957f\uff0c\u90a3\u4e48\u8bf4\u660e\u4e0d\u518d\u7ef4\u62a4\u6216\u7ef4\u62a4\u6548\u7387\u4f4e\u3002</li> </ol> <p>\u6839\u636e3\u4e2a\u7ef4\u5ea6\u7684\u5224\u65ad\u6807\u51c6\uff0c\u6211\u4eec\u9009\u62e9\u7b2c\u4e09\u65b9\u5305excelize\u5b9e\u73b0Excel\u7684\u8bfb\u5199\u64cd\u4f5c\u3002</p> <p>\u9996\u5148\u5728CMD\u7a97\u53e3\u6216GoLand\u7684Terminal\u7a97\u53e3\u8f93\u5165\"go get xxx\"\u6307\u4ee4\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u5305</p> <p>\u63a8\u8350\u4f7f\u7528go mod\u7ba1\u7406\u7b2c\u4e09\u65b9\u5305\uff0c\u6839\u636eexcelize\u6587\u6863\u8bf4\u660e\uff0c\u6211\u4eec\u5e94\u8be5\u8f93\u5165\u5b89\u88c5\u6307\u4ee4\uff1a</p>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/#\u5b89\u88c5\u4e09\u65b9\u5305","title":"\u5b89\u88c5\u4e09\u65b9\u5305","text":"<pre><code>go get github.com/xuri/excelize/v2\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/xuri/excelize/v2\"\n)\nfunc main() {\n// NewFile()\u521b\u5efa\u65b0\u7684Excel\u6587\u4ef6\nf := excelize.NewFile()\n// NewSheet()\u5728Excel\u91cc\u9762\u521b\u5efaSheet2\nindex, _ := f.NewSheet(\"Sheet2\")\n// \u5728Sheet2\u7684\u5355\u5143\u683c\u5199\u5165\u6570\u636e\nf.SetCellValue(\"Sheet2\", \"A2\", \"Hello world\")\nf.SetCellValue(\"Sheet1\", \"B2\", 100)\n// \u8bbe\u7f6e\u5de5\u4f5c\u7c3f\u7684\u9ed8\u8ba4\u5de5\u4f5c\u8868\nf.SetActiveSheet(index)\n// \u4eceSheet2\u83b7\u53d6\u5355\u5143\u683cA2\u7684\u503c\ncell, _ := f.GetCellValue(\"Sheet2\", \"A2\")\nfmt.Printf(\"Sheet2\u7684\u5355\u5143\u683cA2\u7684\u503c\uff1a%v\\n\", cell)\n// \u4fdd\u5b58Excel\u6587\u4ef6\nerr := f.SaveAs(\"./Book1.xlsx\")\nif err != nil {\nfmt.Println(err)\n}\n}\n</code></pre>"},{"location":"Golang/6.Go%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/26.%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/#\u5b98\u65b9\u6587\u6863","title":"\u5b98\u65b9\u6587\u6863","text":"<p>\u7b2c\u4e09\u65b9\u5305excelize\u63d0\u4f9b\u4e86\u5b8c\u5584\u7684\u5b98\u65b9\u6587\u6863\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e2d\u6587\u6587\u6863\u3002</p> <p>\u66f4\u591a\u7684Excel\u6587\u6863\u64cd\u4f5c\u6559\u7a0b\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863</p> <p>go\u5305\uff1aexcel</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/","title":"\u5e76\u53d1 \u5e76\u884c","text":""},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/#1\u5e76\u53d1","title":"1.\u5e76\u53d1","text":"<p>\u591a\u8fdb\u7a0b\u6307\u4ee4\u88abCPU\u5feb\u901f\u8f6e\u6362\u6267\u884c\u3002</p> \u611f\u5b98 \u611f\u5b98\u4e0a\u8bf4\u660e \u5b8f\u89c2\u4e0a \u591a\u4e2a\u8fdb\u7a0b\u540c\u65f6\u6267\u884c \u5fae\u89c2\u4e0a \u591a\u4e2a\u8fdb\u7a0b\u975e\u540c\u65f6\u6267\u884c\uff0c\u65f6\u95f4\u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u591a\u4e2a\u8fdb\u7a0b\u5feb\u901f\u4ea4\u66ff\u6267\u884c\uff0c\u5728\u4e00\u4e2a\u5904\u7406\u5668 <p>\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0b\u7684\u5e76\u53d1\uff1aCPU\u5212\u5206\u65f6\u95f4\u7247\u6bb5\uff08\u65f6\u95f4\u533a\u95f4\uff09\uff0c\u8fdb\u7a0b\u5728\u65f6\u95f4\u533a\u95f4\u4e4b\u95f4\u6765\u56de\u5207\u6362\u5904\u7406\u3002</p> <p>CPU\u5904\u7406\u901f\u5ea6\u5feb\uff0c\u65f6\u95f4\u95f4\u9694\u5904\u7406\u5f97\u5f53\uff0c\u7528\u6237\u611f\u89c9\u662f\u591a\u4e2a\u8fdb\u7a0b\u540c\u65f6\u8fdb\u884c\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/#2\u5e76\u884c","title":"2.\u5e76\u884c","text":"<p>\u540c\u4e00\u65f6\u523b\u591a\u6761\u6307\u4ee4\u5728\u591a\u4e2a\u5904\u7406\u5668\u4e0a\u540c\u65f6\u6267\u884c\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/#3\u4e32\u884c\u5e76\u53d1\u4e0e\u5e76\u884c","title":"3.\u4e32\u884c\u3001\u5e76\u53d1\u4e0e\u5e76\u884c","text":"<ul> <li> <p>\u4e32\u884c\uff1a\u6211\u4eec\u90fd\u662f\u5148\u8bfb\u5c0f\u5b66\uff0c\u5c0f\u5b66\u6bd5\u4e1a\u540e\u518d\u8bfb\u521d\u4e2d\uff0c\u8bfb\u5b8c\u521d\u4e2d\u518d\u8bfb\u9ad8\u4e2d\u3002</p> </li> <li> <p>\u5e76\u53d1\uff1a\u540c\u4e00\u65f6\u95f4\u6bb5\u5185\u6267\u884c\u591a\u4e2a\u4efb\u52a1\uff08\u4f60\u5728\u7528\u5fae\u4fe1\u548c\u4e24\u4e2a\u5973\u670b\u53cb\u804a\u5929\uff09\u3002</p> </li> <li> <p>\u5e76\u884c\uff1a\u540c\u4e00\u65f6\u523b\u6267\u884c\u591a\u4e2a\u4efb\u52a1\uff08\u4f60\u548c\u4f60\u670b\u53cb\u90fd\u5728\u7528\u5fae\u4fe1\u548c\u5973\u670b\u53cb\u804a\u5929\uff09</p> </li> </ul>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/26.%E5%B9%B6%E5%8F%91-%E5%B9%B6%E8%A1%8C/#4\u533a\u522b","title":"4.\u533a\u522b","text":"<ul> <li> <p>\u5e76\u53d1\u504f\u91cd\u4e8e\u591a\u4e2a\u4efb\u52a1\u4ea4\u66ff\u6267\u884c\uff0c\u800c\u591a\u4e2a\u4efb\u52a1\u95f4\u53ef\u80fd\u662f\u4e32\u884c\u7684\u3002\u5e76\u53d1\u662f\u903b\u8f91\u4e0a\u7684\u540c\u65f6\u53d1\u751f\uff08simultaneous\uff09\u3002\u4e32\u884c\u901a\u8baf\uff0c\u4f20\u8f931bit\u4fe1\u53f7\u3002</p> </li> <li> <p>\u5e76\u884c\u504f\u91cd\u4e8e\u540c\u65f6\u6267\u884c\u3002\u662f\u7269\u7406\u4e0a\u7684\u540c\u65f6\u53d1\u751f\u3002\u5e76\u884c\u901a\u8baf\uff0c\u4f20\u8f93\u591abit\u4fe1\u53f7\u3002</p> </li> </ul> <p>\u5e76\u53d1\uff08concurrency\uff09\u4e0d\u662f\u5e76\u884c\uff08parallelism\uff09\u3002</p> <p>\u5e76\u884c\u662f\u8ba9\u4e0d\u540c\u7684\u4ee3\u7801\u7247\u6bb5\u540c\u65f6\u5728\u4e0d\u540c\u7684\u7269\u7406\u5904\u7406\u5668\u4e0a\u6267\u884c\u3002\u5e76\u884c\u7684\u5173\u952e\u662f\u540c\u65f6\u505a\u5f88\u591a\u4e8b\u60c5\uff0c\u800c\u5e76\u53d1\u662f\u6307\u540c\u65f6\u7ba1\u7406\u5f88\u591a\u4e8b\u60c5\uff0c\u8fd9\u4e9b\u4e8b\u60c5\u53ef\u80fd\u53ea\u505a\u4e86\u4e00\u534a\u5c31\u88ab\u6682\u505c\u53bb\u505a\u522b\u7684\u4e8b\u60c5\u4e86\u3002</p> <p>\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u5e76\u53d1\u7684\u6548\u679c\u6bd4\u5e76\u884c\u597d\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u548c\u786c\u4ef6\u7684\u603b\u8d44\u6e90\u4e00\u822c\u5f88\u5c11\uff0c\u4f46\u80fd\u652f\u6301\u7cfb\u7edf\u540c\u65f6\u505a\u5f88\u591a\u4e8b\u60c5\u3002</p> <p>\u8fd9\u79cd\u201c\u4f7f\u7528\u8f83\u5c11\u7684\u8d44\u6e90\u505a\u66f4\u591a\u7684\u4e8b\u60c5\u201d\u7684\u54f2\u5b66\uff0c\u4e5f\u662f\u6307\u5bfcGo\u8bed\u8a00\u8bbe\u8ba1\u7684\u54f2\u5b66\u3002</p> <p>\u5e76\u53d1\u548c\u5e76\u884c\u7684\u533a\u522b</p> <p></p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/","title":"\u8fdb\u7a0b \u7ebf\u7a0b \u534f\u7a0b","text":""},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/#1\u8fdb\u7a0bprocess","title":"1.\u8fdb\u7a0b(Process)","text":"<p>\u8fdb\u7a0b\u662f\u8ba1\u7b97\u673a\u4e2d\u7684\u7a0b\u5e8f\u5173\u4e8e\u67d0\u6570\u636e\u96c6\u5408\u4e0a\u7684\u4e00\u6b21\u8fd0\u884c\u6d3b\u52a8\uff0c\u662f\u7cfb\u7edf\u8fdb\u884c\u8d44\u6e90\u5206\u914d\u548c\u8c03\u5ea6\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u662f\u64cd\u4f5c\u7cfb\u7edf\u7ed3\u6784\u7684\u57fa\u7840\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/#2\u7ebf\u7a0bthread","title":"2.\u7ebf\u7a0b(Thread)","text":"<p>\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff08Lightweight Process\uff0cLWP\uff09\uff0c\u7a0b\u5e8f\u6267\u884c\u6d41\u7684\u6700\u5c0f\u5355\u4f4d\u3002</p> <p>\u7531\u7ebf\u7a0bID\u3001\u5f53\u524d\u6307\u4ee4\u6307\u9488\uff08PC\uff09\u3001\u5bc4\u5b58\u5668\u96c6\u5408\u548c\u5806\u6808\u7ec4\u6210\u3002</p> <p>\u7ebf\u7a0b\u662f\u8fdb\u7a0b\u7684\u4e00\u4e2a\u5b9e\u4f53\uff0c\u4e0e\u540c\u5c5e\u540c\u4e00\u8fdb\u7a0b\u7684\u5176\u4ed6\u7ebf\u7a0b\u5171\u4eab\u8fdb\u7a0b\u7684\u5168\u90e8\u8d44\u6e90\u3002</p> <ul> <li> <p>\u7ebf\u7a0b\u62e5\u6709\u72ec\u7acb\u6808\uff0c\u5171\u4eab\u5806\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u5177\u67095\u79cd\u72b6\u6001\uff1a\u521d\u59cb\u5316\u3001\u53ef\u8fd0\u884c\u3001\u8fd0\u884c\u4e2d\u3001\u963b\u585e\u3001\u9500\u6bc1\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u90fd\u7531\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u3002</p> </li> </ul> <p>\u7ebf\u7a0b\u662f\u6700\u5c0f\u7684\u6267\u884c\u5355\u5143\uff0c\u8fdb\u7a0b\u662f\u6700\u5c0f\u7684\u8d44\u6e90\u7ba1\u7406\u5355\u5143\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/#3\u534f\u7a0bcoroutines","title":"3.\u534f\u7a0b(Coroutines)","text":"<p>\u534f\u7a0b\u662f\u6bd4\u7ebf\u7a0b\u66f4\u52a0\u8f7b\u91cf\u7ea7\u7684\u4e00\u79cd\u7279\u6b8a\u51fd\u6570\u3002\u534f\u7a0b\u4e0d\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7ba1\u7406\uff0c\u800c\u662f\u7a0b\u5e8f\u63a7\u5236\uff0c\u5373\u5728\u7528\u6237\u6001\u6267\u884c\u3002\u63d0\u5347\u6027\u80fd\uff0c\u4e0d\u4f1a\u50cf\u7ebf\u7a0b\u5207\u6362\u90a3\u6837\u6d88\u8017\u8d44\u6e90\u3002</p> <p>\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u534f\u7a0b\u3002</p> <p>\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u7684\u591a\u4e2a\u534f\u7a0b\u59cb\u7ec8\u662f\u4e32\u884c\u7684\uff08\u51fd\u6570\u90fd\u662f\u4e32\u884c\u8fd0\u884c\uff09\uff0c\u65e0\u8bbaCPU\u591a\u5c11\u6838\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/#4\u8fdb\u7a0b-\u7ebf\u7a0b-\u534f\u7a0b\u5bf9\u6bd4","title":"4.\u8fdb\u7a0b \u7ebf\u7a0b \u534f\u7a0b\u5bf9\u6bd4","text":"<ul> <li> <p>\u534f\u7a0b\u4ec5\u662f\u7279\u6b8a\u51fd\u6570\uff0c\u4e0e\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u4e0d\u662f\u4e00\u4e2a\u7ef4\u5ea6\u3002</p> </li> <li> <p>\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u534f\u7a0b\u3002</p> </li> <li> <p>\u4e00\u4e2a\u7ebf\u7a0b\u5185\u7684\u591a\u4e2a\u534f\u7a0b\u53ef\u4ee5\u5207\u6362\uff0c\u4f46\u534f\u7a0b\u59cb\u7ec8\u662f\u4e32\u884c\u6267\u884c\uff0c\u65e0\u6cd5\u5229\u7528CPU\u7684\u591a\u6838\u80fd\u529b\u3002</p> </li> <li> <p>\u8fdb\u7a0b\u7531\u64cd\u4f5c\u7cfb\u7edf\u81ea\u5df1\u7684\u5207\u6362\u7b56\u7565\u6765\u5207\u6362\uff0c\u7528\u6237\u65e0\u611f\u3002\u5207\u6362\u5185\u5bb9\u5305\u62ec\u9875\u5168\u5c40\u76ee\u5f55\u3001\u5185\u6838\u6808\u548c\u786c\u4ef6\u4e0a\u4e0b\u6587\uff0c\u5207\u6362\u5185\u5bb9\u88ab\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u91c7\u7528\u201c\u4ece\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u518d\u5230\u7528\u6237\u6001\u201d\u7684\u65b9\u5f0f\uff0c\u5207\u6362\u6548\u7387\u4f4e\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u7531\u64cd\u4f5c\u7cfb\u7edf\u81ea\u5df1\u7684\u5207\u6362\u7b56\u7565\u6765\u5207\u6362\uff0c\u7528\u6237\u65e0\u611f\u3002\u5207\u6362\u5185\u5bb9\u5305\u62ec\u5185\u6838\u6808\u548c\u786c\u4ef6\u4e0a\u4e0b\u6587\uff0c\u5207\u6362\u5185\u5bb9\u88ab\u4fdd\u5b58\u5728\u5185\u6838\u6808\u4e2d\u3002\u91c7\u7528\u201c\u4ece\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u518d\u5230\u7528\u6237\u6001\u201d\u7684\u65b9\u5f0f\uff0c\u5207\u6362\u6548\u7387\u4e2d\u7b49\u3002</p> </li> <li> <p>\u534f\u7a0b\u7684\u5207\u6362\u7531\u7528\u6237\uff08\u7f16\u7a0b\u8005\u6216\u5e94\u7528\u7a0b\u5e8f\uff09\u51b3\u5b9a\u3002\u5207\u6362\u5185\u5bb9\u5305\u62ec\u786c\u4ef6\u4e0a\u4e0b\u6587\uff0c\u5207\u6362\u5185\u5bb9\u88ab\u4fdd\u5b58\u5728\u7528\u6237\u81ea\u5df1\u7684\u53d8\u91cf\uff08\u7528\u6237\u6808\u6216\u5806\uff09\u4e2d\u3002\u53ea\u6709\u201c\u7528\u6237\u6001\u201d\uff0c\u5207\u6362\u6548\u7387\u9ad8\u3002</p> </li> </ul>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/27.%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/#5\u8fdb\u7a0b-\u7ebf\u7a0b\u548c\u534f\u7a0b","title":"5.\u8fdb\u7a0b \u7ebf\u7a0b\u548c\u534f\u7a0b","text":"<ul> <li> <p>\u8fdb\u7a0b(process)\uff1a\u7a0b\u5e8f\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u6b21\u6267\u884c\u8fc7\u7a0b\uff0c\u7cfb\u7edf\u8fdb\u884c\u8d44\u6e90\u5206\u914d\u548c\u8c03\u5ea6\u7684\u4e00\u4e2a\u72ec\u7acb\u5355\u4f4d\u3002</p> </li> <li> <p>\u7ebf\u7a0b(thread)\uff1a\u64cd\u4f5c\u7cfb\u7edf\u57fa\u4e8e\u8fdb\u7a0b\u5f00\u542f\u7684\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff0c\u662f\u64cd\u4f5c\u7cfb\u7edf\u8c03\u5ea6\u6267\u884c\u7684\u6700\u5c0f\u5355\u4f4d\u3002</p> </li> <li> <p>\u534f\u7a0b(coroutine)\uff1a\u975e\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u800c\u662f\u7531\u7528\u6237\u81ea\u884c\u521b\u5efa\u548c\u63a7\u5236\u7684\u7528\u6237\u6001\u2018\u7ebf\u7a0b\u2019\uff0c\u6bd4\u7ebf\u7a0b\u66f4\u8f7b\u91cf\u7ea7\u3002</p> </li> </ul>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/","title":"Go\u5e76\u53d1\u6a21\u578b","text":""},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/#1\u591a\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58\u6a21\u578b","title":"1.\u591a\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58\u6a21\u578b","text":"<p>\u8bbf\u95ee\u5171\u4eab\u6570\u636e\uff08\u6570\u7ec4\u3001map\u3001\u7ed3\u6784\u4f53\u6216\u5bf9\u8c61\u7b49\uff09\u65f6\uff0c\u901a\u8fc7\u9501\u6765\u8bbf\u95ee\u3002\u884d\u751f\u51fa\u7ebf\u7a0b\u5b89\u5168\u7684\u6570\u636e\u7ed3\u6784\uff0cGo\u901a\u8fc7sync\u5305\u6765\u5b9e\u73b0\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/#2cspcommunicating-sequential-processes\u5e76\u53d1\u6a21\u578b","title":"2.CSP\uff08Communicating Sequential Processes\uff09\u5e76\u53d1\u6a21\u578b","text":"<p>CSP\u5e76\u53d1\u6a21\u578b\u7406\u5ff5\u662f\u4e0d\u901a\u8fc7\u5171\u4eab\u5185\u5b58\u6765\u901a\u4fe1\uff0c\u800c\u662f\u901a\u8fc7\u901a\u4fe1\u6765\u5171\u4eab\u5185\u5b58\u3002</p> <p>Go\u901a\u8fc7goroutine\u548c\u901a\u9053(channel)\u6765\u5b9e\u73b0\u3002</p> <p>goroutine\u65f6\u5e76\u53d1\u6267\u884c\u5355\u4f4d\uff0c\u7c7b\u4f3c\u534f\u7a0b\u3002\u901a\u9053\u662fgoroutine\u95f4\u7684\u901a\u4fe1\u7ba1\u9053\uff0c\u7c7b\u4f3cUNIX\u4e2d\u7684\u7ba1\u9053\u3002</p> <p>goroutine\u548c\u901a\u9053\u7684\u7b80\u5355\u793a\u4f8b</p> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nch := make(chan string) // \u6784\u5efa\u4e00\u4e2a\u901a\u9053\ngo func() { // \u5f00\u542f\u4e00\u4e2a\u5e76\u53d1\u533f\u540d\u51fd\u6570\nfmt.Println(\"\u5f00\u59cb\u534f\u7a0b\") // \u901a\u8fc7\u901a\u9053\u901a\u77e5main\u7684\u534f\u7a0b\nch &lt;- \"signal\"\nfmt.Println(\"\u9000\u51fa\u534f\u7a0b\")\n}()\nfmt.Println(\"\u7b49\u5f85\u534f\u7a0b\")\n&lt;-ch // \u7b49\u5f85\u533f\u540d\u534f\u7a0b\nfmt.Println(\"\u5b8c\u6210\")\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/28.Go%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/#3\u5e38\u89c1\u7684\u5e76\u53d1\u6a21\u578b","title":"3.\u5e38\u89c1\u7684\u5e76\u53d1\u6a21\u578b","text":"<p>\u4e1a\u754c\u5c06\u5982\u4f55\u5b9e\u73b0\u5e76\u53d1\u7f16\u7a0b\u603b\u7ed3\u5f52\u7eb3\u4e3a\u5404\u5f0f\u5404\u6837\u7684\u5e76\u53d1\u6a21\u578b\uff0c\u5e38\u89c1\u7684\u5e76\u53d1\u6a21\u578b\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li> <p>\u7ebf\u7a0b&amp;\u9501\u6a21\u578b</p> </li> <li> <p>Actor\u6a21\u578b</p> </li> <li> <p>CSP\u6a21\u578b</p> </li> <li> <p>Fork&amp;Join\u6a21\u578b</p> </li> </ul> <p>Go\u8bed\u8a00\u4e2d\u7684\u5e76\u53d1\u7a0b\u5e8f\u4e3b\u8981\u662f\u901a\u8fc7\u57fa\u4e8eCSP\uff08communicating sequential processes\uff09\u7684goroutine\u548cchannel\u6765\u5b9e\u73b0\uff0c\u5f53\u7136\u4e5f\u652f\u6301\u4f7f\u7528\u4f20\u7edf\u7684\u591a\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58\u7684\u5e76\u53d1\u65b9\u5f0f\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/","title":"goroutine\u548cchannel","text":""},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#1goroutine\u7b80\u4ecb","title":"1.goroutine\u7b80\u4ecb","text":""},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#11-goroutine","title":"1.1 goroutine","text":"<p>goroutine \u662f\u4e00\u79cd\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u5b9e\u73b0\uff0c\u53ef\u5728\u5355\u4e2a\u8fdb\u7a0b\u91cc\u6267\u884c\u6210\u5343\u4e0a\u4e07\u7684\u5e76\u53d1\u4efb\u52a1\uff0c\u5b83\u662fGo\u8bed\u8a00\u5e76\u53d1\u8bbe\u8ba1\u7684\u6838\u5fc3\u3002</p> <p>\u8bf4\u5230\u5e95 goroutine \u5176\u5b9e\u5c31\u662f\u7ebf\u7a0b\uff0c\u4f46\u662f\u5b83\u6bd4\u7ebf\u7a0b\u66f4\u5c0f\uff0c\u5341\u51e0\u4e2a goroutine \u53ef\u80fd\u4f53\u73b0\u5728\u5e95\u5c42\u5c31\u662f\u4e94\u516d\u4e2a\u7ebf\u7a0b\uff0c\u800c\u4e14Go\u8bed\u8a00\u5185\u90e8\u4e5f\u5b9e\u73b0\u4e86 goroutine \u4e4b\u95f4\u7684\u5185\u5b58\u5171\u4eab\u3002</p> <p>\u4f7f\u7528 go \u5173\u952e\u5b57\u5c31\u53ef\u4ee5\u521b\u5efa goroutine\uff0c\u5c06 go \u58f0\u660e\u653e\u5230\u4e00\u4e2a\u9700\u8c03\u7528\u7684\u51fd\u6570\u4e4b\u524d\uff0c\u5728\u76f8\u540c\u5730\u5740\u7a7a\u95f4\u8c03\u7528\u8fd0\u884c\u8fd9\u4e2a\u51fd\u6570\uff0c\u8fd9\u6837\u8be5\u51fd\u6570\u6267\u884c\u65f6\u4fbf\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u5e76\u53d1\u7ebf\u7a0b\uff0c\u8fd9\u79cd\u7ebf\u7a0b\u5728Go\u8bed\u8a00\u4e2d\u5219\u88ab\u79f0\u4e3a goroutine\u3002</p> <pre><code>go func(param1, param2) {\n//...\n}(var1, var2)\n</code></pre> <p>Goroutine \u662f Go \u8bed\u8a00\u652f\u6301\u5e76\u53d1\u7684\u6838\u5fc3\uff0c\u5728\u4e00\u4e2aGo\u7a0b\u5e8f\u4e2d\u540c\u65f6\u521b\u5efa\u6210\u767e\u4e0a\u5343\u4e2agoroutine\u662f\u975e\u5e38\u666e\u904d\u7684\uff0c\u4e00\u4e2agoroutine\u4f1a\u4ee5\u4e00\u4e2a\u5f88\u5c0f\u7684\u6808\u5f00\u59cb\u5176\u751f\u547d\u5468\u671f\uff0c\u4e00\u822c\u53ea\u9700\u89812KB\u3002</p> <p>\u533a\u522b\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u7531\u7cfb\u7edf\u5185\u6838\u8fdb\u884c\u8c03\u5ea6\uff0c goroutine \u662f\u7531Go\u8fd0\u884c\u65f6\uff08runtime\uff09\u8d1f\u8d23\u8c03\u5ea6\u3002</p> <p>\u4f8b\u5982Go\u8fd0\u884c\u65f6\u4f1a\u667a\u80fd\u5730\u5c06 m\u4e2agoroutine \u5408\u7406\u5730\u5206\u914d\u7ed9n\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\uff0c\u5b9e\u73b0\u7c7b\u4f3cm:n\u7684\u8c03\u5ea6\u673a\u5236\uff0c\u4e0d\u518d\u9700\u8981Go\u5f00\u53d1\u8005\u81ea\u884c\u5728\u4ee3\u7801\u5c42\u9762\u7ef4\u62a4\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u3002</p> <p>Goroutine \u662f Go \u7a0b\u5e8f\u4e2d\u6700\u57fa\u672c\u7684\u5e76\u53d1\u6267\u884c\u5355\u5143\u3002\u6bcf\u4e00\u4e2a Go \u7a0b\u5e8f\u90fd\u81f3\u5c11\u5305\u542b\u4e00\u4e2a goroutine\u2014main goroutine\uff0c\u5f53 Go \u7a0b\u5e8f\u542f\u52a8\u65f6\u5b83\u4f1a\u81ea\u52a8\u521b\u5efa\u3002</p> <p>\u5728Go\u8bed\u8a00\u7f16\u7a0b\u4e2d\u4f60\u4e0d\u9700\u8981\u53bb\u81ea\u5df1\u5199\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u3001\u534f\u7a0b\uff0c\u4f60\u7684\u6280\u80fd\u5305\u91cc\u53ea\u6709\u4e00\u4e2a\u6280\u80fd-goroutine\uff0c</p> <p>\u5f53\u4f60\u9700\u8981\u8ba9\u67d0\u4e2a\u4efb\u52a1\u5e76\u53d1\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f60\u53ea\u9700\u8981\u628a\u8fd9\u4e2a\u4efb\u52a1\u5305\u88c5\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u5f00\u542f\u4e00\u4e2a goroutine \u53bb\u6267\u884c\u8fd9\u4e2a\u51fd\u6570\u5c31\u53ef\u4ee5\u4e86,\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\u7c97\u66b4\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc Echo(s string) {\nfor i := 0; i &lt; 3; i++ {\ntime.Sleep(100 * time.Millisecond)\nfmt.Println(s)\n}\n}\nfunc main() {\ngo Echo(\"go\")\nEcho(\"web program\")\n}\n</code></pre> <p>\u6267\u884c\u4ee5\u4e0a\u4ee3\u7801\u540e\u4f1a\u770b\u5230\uff0c\u8f93\u51fa\u7684\u201cgo\u201d\u548c\u201cweb program\u201d\u662f\u6ca1\u6709\u56fa\u5b9a\u5148\u540e\u987a\u5e8f\u3002\u56e0\u4e3a\u5b83\u4eec\u662f\u4e24\u4e2agoroutine\u5728\u5e76\u53d1\u6267\u884c\uff1a</p> <pre><code>$ go.exe run goroutine1.go\ngo\nweb program\nweb program\ngo\ngo\nweb program\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#12-goroutine\u7684\u8c03\u5ea6","title":"1.2 goroutine\u7684\u8c03\u5ea6","text":"<p>goroutine\u7684\u8c03\u5ea6\u65b9\u5f0f\u662f\u534f\u540c\u5f0f\u7684\uff0c\u6ca1\u6709\u65f6\u95f4\u7247\u6982\u5ff5\u3002</p> <p>goroutine\u5207\u6362\u65f6\u523b\uff1a</p> <ul> <li> <p>\u901a\u9053\u63a5\u6536\u6216\u53d1\u9001\u6570\u636e\u4e14\u9020\u6210\u963b\u585e\u65f6\u3002</p> </li> <li> <p>\u65b0\u7684goroutine\u88ab\u521b\u5efa\u3002</p> </li> <li> <p>\u9020\u6210\u7cfb\u7edf\u8c03\u7528\u88ab\u963b\u585e\uff0c\u5982\u64cd\u4f5c\u6587\u4ef6\u65f6\u3002</p> </li> </ul> <p>goroutine\u5728\u591a\u6838CPU\u73af\u5883\u4e0b\u53ef\u4ee5\u662f\u5e76\u884c\u7684\u3002</p> <p>\u5982\u679c\u4ee3\u7801\u5757\u5728\u591a\u4e2agoroutine\u4e2d\u6267\u884c\uff0c\u5219\u4f1a\u5b9e\u73b0\u4ee3\u7801\u7684\u5e76\u884c\u3002</p> <p>\u5728\u88ab\u8c03\u7528\u7684\u51fd\u6570\u8fd4\u56de\u65f6\uff0c\u8fd9\u4e2agoroutine\u4e5f\u81ea\u52a8\u7ed3\u675f\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u8fd9\u4e2a\u51fd\u6570\u6709\u8fd4\u56de\u503c\uff0c\u5219\u8be5\u8fd4\u56de\u503c\u4f1a\u88ab\u4e22\u5f03\u3002\u770b\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\nfor i := 0; i &lt; 5; i++ {\ngo Add(i, i) //\u8fd4\u56de\u503c\u88ab\u5ffd\u7565\n}\n}\nfunc Add(a, b int) int {\nc := a + b\nfmt.Println(c)\nreturn c\n}\n</code></pre> <p>\u5bf9\u4e8e\u4e0a\u9762\u7684\u4f8b\u5b50\uff0cmain\u51fd\u6570\u542f\u52a8\u4e865\u4e2agoroutine,\u8fd9\u65f6\u7a0b\u5e8f\u5c31\u9000\u51fa\u4e86\uff0c\u800c\u88ab\u542f\u52a8\u7684\u6267\u884cAdd()\u51fd\u6570\u7684goroutine\u6ca1\u6765\u5f97\u53ca\u6267\u884c\u3002</p> <p>\u6240\u4ee5\u6267\u884c\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u5c4f\u5e55\u4ec0\u4e48\u90fd\u6ca1\u6253\u5370\uff0c\u7a0b\u5e8f\u5c31\u9000\u51fa\u4e86\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#2\u901a\u9053","title":"2.\u901a\u9053","text":""},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#21-\u5b9a\u4e49","title":"2.1 \u5b9a\u4e49","text":"<p>channel\u662f\u7528\u6765\u4f20\u9012\u6570\u636e\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u901a\u8fc7\u901a\u9053\u5171\u4eab\u5185\u7f6e\u7c7b\u578b\u3001\u547d\u540d\u7c7b\u578b\u3001\u7ed3\u6784\u7c7b\u578b\u548c\u5f15\u7528\u7c7b\u578b\u7684\u503c\u6216\u8005\u6307\u9488\u3002\u4e00\u79cd\u7279\u6b8a\u7c7b\u578b\uff0c\u4efb\u4f55\u65f6\u5019\uff0c\u540c\u65f6\u53ea\u80fd\u6709\u4e00\u4e2agoroutine\u8bbf\u95ee\u901a\u9053\u8fdb\u884c\u53d1\u9001\u6216\u63a5\u6536\u6570\u636e\u3002</p> <p>\u7c7b\u4f3c\u961f\u5217\uff0c\u9075\u5faa\u5148\u5165\u5148\u51fa\uff08First In First out\uff09\u89c4\u5219\uff0c\u4fdd\u8bc1\u6536\u53d1\u6570\u636e\u7684\u987a\u5e8f\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#22-\u58f0\u660e","title":"2.2 \u58f0\u660e","text":"<pre><code>var channel_name chan type\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#23-\u521b\u5efa","title":"2.3 \u521b\u5efa","text":"<pre><code>//\u901a\u9053\u5b9e\u4f8b := make(chan \u6570\u636e\u7c7b\u578b)\nstrStream := make(chan string)\ndone := make(chan interface{})\nvoidStream := make(chan *struct{})\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#24-\u901a\u9053\u53d1\u9001\u6570\u636e","title":"2.4 \u901a\u9053\u53d1\u9001\u6570\u636e","text":"<pre><code>//\u901a\u9053\u53d8\u91cf &lt;- \u901a\u9053\u503c\nch := make(chan interface{})\nch &lt;- 6\nch &lt;- \"love\"\n</code></pre> <pre><code>package main\nfunc main() {\nch := make(chan interface{})\nch &lt;- \"sleep\"   //\u65e0\u7f13\u51b2\u901a\u9053\uff0c\u65e0\u63a5\u6536\u65b9\uff0c\u6c38\u8fdc\u963b\u585e\uff0c\u62a5\u9519\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#25-\u901a\u9053\u63a5\u6536\u6570\u636e","title":"2.5 \u901a\u9053\u63a5\u6536\u6570\u636e","text":"<pre><code>//\u963b\u585e\u63a5\u6536\ndata := &lt;-ch\n</code></pre> <pre><code>//\u975e\u963b\u585e\u63a5\u6536\ndata, ok := &lt;-ch\n</code></pre> <pre><code>//\u5ffd\u7565\u63a5\u6536\u6570\u636e\n&lt;-ch\n</code></pre> <pre><code>//\u5faa\u73af\u63a5\u6536\u6570\u636e\nfor data := range ch {\n//\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc Sum(s []int, ch chan int) {\nsum := 0\nfor _, v := range s {\nsum += v\n}\nch &lt;- sum\n}\nfunc main() {\ns := []int{6, 7, 8, -9, 1, 8}\nch := make(chan int)\ngo Sum(s[:len(s)/2], ch)\ngo Sum(s[len(s)/2:], ch)\na, b := &lt;-ch, &lt;-ch\nfmt.Println(a, b, a+b)\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#26-\u901a\u9053\u7f13\u51b2\u533a","title":"2.6 \u901a\u9053\u7f13\u51b2\u533a","text":"<p><code>ch := make(chan int, 6)</code> \u53ea\u8981\u7f13\u51b2\u533a\u672a\u6ee1\uff0c\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u53ef\u4ee5\u5904\u4e8e\u5f02\u6b65\u72b6\u6001\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nch := make(chan int, 3)\nch &lt;- 6\nch &lt;- 7\nch &lt;- 8\nfmt.Println(&lt;-ch)\nfmt.Println(&lt;-ch)\nfmt.Println(&lt;-ch)\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#27-select\u591a\u8def\u590d\u7528","title":"2.7 select\u591a\u8def\u590d\u7528","text":"<p>\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u6211\u4eec\u53ef\u80fd\u9700\u8981\u540c\u65f6\u4ece\u591a\u4e2a\u901a\u9053\u63a5\u6536\u6570\u636e\u3002\u901a\u9053\u5728\u63a5\u6536\u6570\u636e\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u6570\u636e\u53ef\u4ee5\u88ab\u63a5\u6536\u90a3\u4e48\u5f53\u524d goroutine \u5c06\u4f1a\u53d1\u751f\u963b\u585e\u3002\u4f60\u4e5f\u8bb8\u4f1a\u5199\u51fa\u5982\u4e0b\u4ee3\u7801\u5c1d\u8bd5\u4f7f\u7528\u904d\u5386\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u4ece\u591a\u4e2a\u901a\u9053\u4e2d\u63a5\u6536\u503c\u3002</p> <pre><code>for{\n    // \u5c1d\u8bd5\u4ecech1\u63a5\u6536\u503c\n    data, ok := &lt;-ch1\n    // \u5c1d\u8bd5\u4ecech2\u63a5\u6536\u503c\n    data, ok := &lt;-ch2\n    \u2026\n}\n</code></pre> <p>\u8fd9\u79cd\u65b9\u5f0f\u867d\u7136\u53ef\u4ee5\u5b9e\u73b0\u4ece\u591a\u4e2a\u901a\u9053\u63a5\u6536\u503c\u7684\u9700\u6c42\uff0c\u4f46\u662f\u7a0b\u5e8f\u7684\u8fd0\u884c\u6027\u80fd\u4f1a\u5dee\u5f88\u591a\u3002Go \u8bed\u8a00\u5185\u7f6e\u4e86<code>select</code>\u5173\u952e\u5b57\uff0c\u4f7f\u7528\u5b83\u53ef\u4ee5\u540c\u65f6\u54cd\u5e94\u591a\u4e2a\u901a\u9053\u7684\u64cd\u4f5c\u3002</p> <p>Select \u7684\u4f7f\u7528\u65b9\u5f0f\u7c7b\u4f3c\u4e8e\u4e4b\u524d\u5b66\u5230\u7684 switch \u8bed\u53e5\uff0c\u5b83\u4e5f\u6709\u4e00\u7cfb\u5217 case \u5206\u652f\u548c\u4e00\u4e2a\u9ed8\u8ba4\u7684\u5206\u652f\u3002\u6bcf\u4e2a case \u5206\u652f\u4f1a\u5bf9\u5e94\u4e00\u4e2a\u901a\u9053\u7684\u901a\u4fe1\uff08\u63a5\u6536\u6216\u53d1\u9001\uff09\u8fc7\u7a0b\u3002select \u4f1a\u4e00\u76f4\u7b49\u5f85\uff0c\u76f4\u5230\u5176\u4e2d\u7684\u67d0\u4e2a case \u7684\u901a\u4fe1\u64cd\u4f5c\u5b8c\u6210\u65f6\uff0c\u5c31\u4f1a\u6267\u884c\u8be5 case \u5206\u652f\u5bf9\u5e94\u7684\u8bed\u53e5\u3002\u5177\u4f53\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>select {\ncase &lt;-ch1:\n//...\ncase data := &lt;-ch2:\n//...\ncase ch3 &lt;- 10:\n//...\ndefault:\n//\u9ed8\u8ba4\u64cd\u4f5c\n}\n</code></pre> <p>Select \u8bed\u53e5\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\u3002</p> <ul> <li>\u53ef\u5904\u7406\u4e00\u4e2a\u6216\u591a\u4e2a channel \u7684\u53d1\u9001/\u63a5\u6536\u64cd\u4f5c\u3002</li> <li>\u5982\u679c\u591a\u4e2a case \u540c\u65f6\u6ee1\u8db3\uff0cselect \u4f1a**\u968f\u673a**\u9009\u62e9\u4e00\u4e2a\u6267\u884c\u3002</li> <li>\u5bf9\u4e8e\u6ca1\u6709 case \u7684 select \u4f1a\u4e00\u76f4\u963b\u585e\uff0c\u53ef\u7528\u4e8e\u963b\u585e main \u51fd\u6570\uff0c\u9632\u6b62\u9000\u51fa\u3002</li> </ul> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u4ee3\u7801\u80fd\u591f\u5728\u7ec8\u7aef\u6253\u5370\u51fa10\u4ee5\u5185\u7684\u5947\u6570\uff0c\u6211\u4eec\u501f\u52a9\u8fd9\u4e2a\u4ee3\u7801\u7247\u6bb5\u6765\u770b\u4e00\u4e0b select \u7684\u5177\u4f53\u4f7f\u7528\u3002</p> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nch := make(chan int, 1)\nfor i := 1; i &lt;= 10; i++ {\nselect {\ncase x := &lt;-ch:\nfmt.Println(x)\ncase ch &lt;- i:\n}\n}\n}\n</code></pre> <p>\u793a\u4f8b\u4e2d\u7684\u4ee3\u7801\u9996\u5148\u662f\u521b\u5efa\u4e86\u4e00\u4e2a\u7f13\u51b2\u533a\u5927\u5c0f\u4e3a1\u7684\u901a\u9053 ch\uff0c\u8fdb\u5165 for \u5faa\u73af\u540e\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b21\u5faa\u73af\u65f6 i = 1\uff0cselect \u8bed\u53e5\u4e2d\u5305\u542b\u4e24\u4e2a case \u5206\u652f\uff0c\u6b64\u65f6\u7531\u4e8e\u901a\u9053\u4e2d\u6ca1\u6709\u503c\u53ef\u4ee5\u63a5\u6536\uff0c\u6240\u4ee5<code>x := &lt;-ch</code> \u8fd9\u4e2a case \u5206\u652f\u4e0d\u6ee1\u8db3\uff0c\u800c<code>ch &lt;- i</code>\u8fd9\u4e2a\u5206\u652f\u53ef\u4ee5\u6267\u884c\uff0c\u4f1a\u628a1\u53d1\u9001\u5230\u901a\u9053\u4e2d\uff0c\u7ed3\u675f\u672c\u6b21 for \u5faa\u73af\uff1b</li> <li>\u7b2c\u4e8c\u6b21 for \u5faa\u73af\u65f6\uff0ci = 2\uff0c\u7531\u4e8e\u901a\u9053\u7f13\u51b2\u533a\u5df2\u6ee1\uff0c\u6240\u4ee5<code>ch &lt;- i</code>\u8fd9\u4e2a\u5206\u652f\u4e0d\u6ee1\u8db3\uff0c\u800c<code>x := &lt;-ch</code>\u8fd9\u4e2a\u5206\u652f\u53ef\u4ee5\u6267\u884c\uff0c\u4ece\u901a\u9053\u63a5\u6536\u503c1\u5e76\u8d4b\u503c\u7ed9\u53d8\u91cf x \uff0c\u6240\u4ee5\u4f1a\u5728\u7ec8\u7aef\u6253\u5370\u51fa 1\uff1b</li> <li>\u540e\u7eed\u7684 for \u5faa\u73af\u4ee5\u6b64\u7c7b\u63a8\u4f1a\u4f9d\u6b21\u6253\u5370\u51fa3\u30015\u30017\u30019\u3002</li> </ul>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/29.goroutine%E5%92%8Cchannel/#28-\u904d\u5386\u901a\u9053\u4e0e\u5173\u95ed\u901a\u9053","title":"2.8 \u904d\u5386\u901a\u9053\u4e0e\u5173\u95ed\u901a\u9053","text":"<p><code>v, ok := &lt;-ch</code></p> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc fibonacci(n int, ch chan int) {\na, b := 0, 1\nfor i := 0; i &lt; n; i++ {\nch &lt;- a\na, b = b, a+b\n}\nclose(ch)\n}\nfunc main() {\nch := make(chan int, 6)\ngo fibonacci(cap(ch), ch)\nfor j := range ch {\nfmt.Println(j)\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/","title":"sync\u5b9e\u73b0\u5e76\u53d1","text":""},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/#1\u7ade\u6001","title":"1.\u7ade\u6001","text":"<p>\u4f7f\u7528\u5e76\u53d1\uff0c\u53ef\u80fd\u4ea7\u751f\u6570\u636e\u4e89\u7528\u7684\u7ade\u6001\u95ee\u9898\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"sync\"\n)\nvar x int64\nvar wg sync.WaitGroup\nfunc add() {\nfor i := 0; i &lt; 5000; i++ {\nx = x + 1\n}\nwg.Done()\n}\nfunc main() {\nwg.Add(2)\ngo add()\ngo add()\nwg.Wait()\nfmt.Println(x)\n}\n</code></pre> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u6211\u4eec\u5f00\u542f\u4e86\u4e24\u4e2agoroutine\u53bb\u7d2f\u52a0\u53d8\u91cfx\u7684\u503c\uff0c\u8fd9\u4e24\u4e2agoroutine\u5728\u8bbf\u95ee\u548c\u4fee\u6539x\u53d8\u91cf\u7684\u65f6\u5019\u5c31\u4f1a\u5b58\u5728\u6570\u636e\u7ade\u4e89\uff0c\u5bfc\u81f4\u6700\u540e\u7684\u7ed3\u679c\u4e0e\u671f\u5f85\u7684\u4e0d\u7b26\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/#2\u4e92\u65a5\u9501","title":"2.\u4e92\u65a5\u9501","text":"<p>\u4e92\u65a5\u9501\u662f\u4e00\u79cd\u5e38\u7528\u7684\u63a7\u5236\u5171\u4eab\u8d44\u6e90\u8bbf\u95ee\u7684\u65b9\u6cd5\uff0c\u5b83\u80fd\u591f\u4fdd\u8bc1\u540c\u65f6\u53ea\u6709\u4e00\u4e2agoroutine\u53ef\u4ee5\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u3002Go\u8bed\u8a00\u4e2d\u4f7f\u7528sync\u5305\u7684Mutex\u7c7b\u578b\u6765\u5b9e\u73b0\u4e92\u65a5\u9501\u3002 \u4f7f\u7528\u4e92\u65a5\u9501\u6765\u4fee\u590d\u4e0a\u9762\u4ee3\u7801\u7684\u95ee\u9898\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"sync\"\n)\nvar x int64\nvar wg sync.WaitGroup\nvar lock sync.Mutex\nfunc add() {\nfor i := 0; i &lt; 5000; i++ {\nlock.Lock() // \u52a0\u9501\nx = x + 1\nlock.Unlock() // \u89e3\u9501\n}\nwg.Done()\n}\nfunc main() {\nwg.Add(2)\ngo add()\ngo add()\nwg.Wait()\nfmt.Println(x)\n}\n</code></pre> <p>\u4f7f\u7528\u4e92\u65a5\u9501\u80fd\u591f\u4fdd\u8bc1\u540c\u4e00\u65f6\u95f4\u6709\u4e14\u53ea\u6709\u4e00\u4e2agoroutine\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u5176\u4ed6\u7684goroutine\u5219\u5728\u7b49\u5f85\u9501\uff1b\u5f53\u4e92\u65a5\u9501\u91ca\u653e\u540e\uff0c\u7b49\u5f85\u7684goroutine\u624d\u53ef\u4ee5\u83b7\u53d6\u9501\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u591a\u4e2agoroutine\u540c\u65f6\u7b49\u5f85\u4e00\u4e2a\u9501\u65f6\uff0c\u5524\u9192\u7684\u7b56\u7565\u662f\u968f\u673a\u7684\u3002</p> <p>sync.Mutex\uff0c\u7528\u4e8e\u5b9e\u73b0\u4e92\u65a5\u9501\uff0c\u7528\u4e8e\u8bfb\u5199\u4e0d\u786e\u5b9a\u7684\u573a\u666f\uff0c\u5168\u5c40\u9501\u3002</p> <pre><code>type Mutex struct {\nstate int32 //\u5f53\u524d\u4e92\u65a5\u9501\u7684\u72b6\u6001\nsema uint32 //\u63a7\u5236\u9501\u72b6\u6001\u7684\u4fe1\u53f7\u91cf\n}\nfunc (m *Mutex) Lock()\nfunc (m *Mutex) Unlock()\n</code></pre> <p>\u5fc5\u987b\u5148Lock()\uff0c\u7136\u540eUnlock()\u3002 \u8fde\u7eedLock()\uff0c\u6b7b\u9501\u3002 \u5148Unlock()\uff0c\u540eLock()\uff0cpanic\u3002 \u53ef\u4ee5\u4e00\u4e2agoroutine\u5148Lock()\uff0c\u5176\u4ed6goroutine\u540eUnlock()\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n\"sync\"\n\"time\"\n)\n// \u4e92\u65a5\u9501\u6027\u80fd\u6d4b\u8bd5\uff1a\u6bd4\u8f83\u9002\u5408\u4e8e\u8bfb\u591a\u3001\u5199\u5c11\u7684\u60c5\u51b5\nfunc main() {\nch := make(chan struct{}, 2)\nvar l sync.Mutex\ngo func() {\nfmt.Println(\"groutine2: \u7b49\u5f85\u89e3\u9501\")\nl.Lock()\nfmt.Println(\"groutine2: \u5df2\u7ecf\u52a0\u9501\u4e86\")\ndefer l.Unlock()\nfmt.Println(\"goroutine2: \u6b27\u8036\uff0c\u6211\u4e5f\u89e3\u9501\u4e86\")\nch &lt;- struct{}{}\n}()\ngo func() {\nl.Lock()\nfmt.Println(\"groutine1: \u5df2\u7ecf\u52a0\u9501\u4e86\")\ndefer l.Unlock()\nfmt.Println(\"goroutine1: \u6211\u4f1a\u9501\u5b9a\u5927\u6982 2s\")\ntime.Sleep(time.Second * 2)\nfmt.Println(\"goroutine1: \u6211\u89e3\u9501\u4e86\uff0c\u4f60\u4eec\u53bb\u62a2\u5427\")\nch &lt;- struct{}{}\n}()\n// \u7b49\u5f85 goroutine \u6267\u884c\u7ed3\u675f\nfor i := 0; i &lt; 2; i++ {\n&lt;-ch\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/#3\u8bfb\u5199\u4e92\u65a5\u9501","title":"3.\u8bfb\u5199\u4e92\u65a5\u9501","text":"<p>\u4e92\u65a5\u9501\u662f\u5b8c\u5168\u4e92\u65a5\u7684\uff0c\u4f46\u662f\u6709\u5f88\u591a\u5b9e\u9645\u7684\u573a\u666f\u4e0b\u662f\u8bfb\u591a\u5199\u5c11\u7684\uff0c\u5f53\u6211\u4eec\u5e76\u53d1\u7684\u53bb\u8bfb\u53d6\u4e00\u4e2a\u8d44\u6e90\u4e0d\u6d89\u53ca\u8d44\u6e90\u4fee\u6539\u7684\u65f6\u5019\u662f\u6ca1\u6709\u5fc5\u8981\u52a0\u9501\u7684\uff0c\u8fd9\u79cd\u573a\u666f\u4e0b\u4f7f\u7528\u8bfb\u5199\u9501\u662f\u66f4\u597d\u7684\u4e00\u79cd\u9009\u62e9\u3002\u8bfb\u5199\u9501\u5728Go\u8bed\u8a00\u4e2d\u4f7f\u7528sync\u5305\u4e2d\u7684RWMutex\u7c7b\u578b\u3002</p> <p>\u8bfb\u5199\u9501\u5206\u4e3a\u4e24\u79cd\uff1a\u8bfb\u9501\u548c\u5199\u9501\u3002\u5f53\u4e00\u4e2agoroutine\u83b7\u53d6\u8bfb\u9501\u4e4b\u540e\uff0c\u5176\u4ed6\u7684goroutine\u5982\u679c\u662f\u83b7\u53d6\u8bfb\u9501\u4f1a\u7ee7\u7eed\u83b7\u5f97\u9501\uff0c\u5982\u679c\u662f\u83b7\u53d6\u5199\u9501\u5c31\u4f1a\u7b49\u5f85\uff1b\u5f53\u4e00\u4e2agoroutine\u83b7\u53d6\u5199\u9501\u4e4b\u540e\uff0c\u5176\u4ed6\u7684goroutine\u65e0\u8bba\u662f\u83b7\u53d6\u8bfb\u9501\u8fd8\u662f\u5199\u9501\u90fd\u4f1a\u7b49\u5f85\u3002</p> <p>\u8bfb\u5199\u9501\u793a\u4f8b\uff1a</p> <pre><code>type RWMutex struct {\nw           Mutex  // held if there are pending writers\nwriterSem   uint32 // semaphore for writers to wait for completing readers\nreaderSem   uint32 // semaphore for readers to wait for completing writers\nreaderCount int32  // number of pending readers\nreaderWait  int32  // number of departing readers\n}\n//\u5199\u64cd\u4f5c\nfunc (*RWMutex) Lock()\nfunc (*RWMutex) Unlock()\n//\u8bfb\u64cd\u4f5c\nfunc (*RWMutex) RLock()\nfunc (*RWMutex) RUnlock()\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"sync\"\n\"time\"\n)\nvar (\nr      int64\nw      int64\nwg     sync.WaitGroup\nlock   sync.Mutex\nrwlock sync.RWMutex\n)\nfunc write() {\n// lock.Lock()   // \u52a0\u4e92\u65a5\u9501\nrwlock.Lock() // \u52a0\u5199\u9501\nw = w + 1\nfmt.Printf(\"write rlock num: %d\\n\", w)\ntime.Sleep(10 * time.Millisecond) // \u5047\u8bbe\u8bfb\u64cd\u4f5c\u8017\u65f610\u6beb\u79d2\nrwlock.Unlock()                   // \u89e3\u5199\u9501\n// lock.Unlock()                     // \u89e3\u4e92\u65a5\u9501\nwg.Done()\n}\nfunc read() {\n// lock.Lock()                  // \u52a0\u4e92\u65a5\u9501\nrwlock.RLock() // \u52a0\u8bfb\u9501\nr = r + 1\nfmt.Printf(\"read rlock num: %d\\n\", r)\ntime.Sleep(time.Millisecond) // \u5047\u8bbe\u8bfb\u64cd\u4f5c\u8017\u65f61\u6beb\u79d2\nrwlock.RUnlock()             // \u89e3\u8bfb\u9501\n// lock.Unlock()                // \u89e3\u4e92\u65a5\u9501\nwg.Done()\n}\nfunc main() {\nstart := time.Now()\nfor i := 0; i &lt; 10; i++ {\nwg.Add(1)\ngo write()\n}\nfor i := 0; i &lt; 1000; i++ {\nwg.Add(1)\ngo read()\n}\nwg.Wait()\nend := time.Now()\nfmt.Println(end.Sub(start))\n}\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u8bfb\u5199\u9501\u975e\u5e38\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\uff0c\u5982\u679c\u8bfb\u548c\u5199\u7684\u64cd\u4f5c\u5dee\u522b\u4e0d\u5927\uff0c\u8bfb\u5199\u9501\u7684\u4f18\u52bf\u5c31\u53d1\u6325\u4e0d\u51fa\u6765\u3002</p> <pre><code>package main\nimport (\n\"fmt\"\n_ \"math/rand\"\n\"sync\"\n)\nvar count int\nvar rw sync.RWMutex\nfunc main() {\nch := make(chan struct{}, 6)\nfor i := 0; i &lt; 50; i++ {\ngo ReadCount(i, ch)\n}\nfor i := 0; i &lt; 10; i++ {\ngo WriteCount(i, ch)\n}\nfor i := 0; i &lt; 60; i++ {\n&lt;-ch\n}\n}\nfunc ReadCount(n int, ch chan struct{}) {\nrw.RLock()\nfmt.Printf(\"goroutine %d \u8fdb\u5165\u8bfb\u64cd\u4f5c...\\n\", n)\nv := count\nfmt.Printf(\"goroutine %d \u8bfb\u53d6\u7ed3\u675f\uff0c\u503c\u4e3a\uff1a%d\\n\", n, v)\nrw.RUnlock()\nch &lt;- struct{}{}\n}\nfunc WriteCount(n int, ch chan struct{}) {\nrw.Lock()\nfmt.Printf(\"goroutine %d \u8fdb\u5165\u5199\u64cd\u4f5c...\\n\", n)\n// v := rand.Intn(10)\nv := count + 1\ncount = v\nfmt.Printf(\"goroutine %d \u5199\u5165\u7ed3\u675f\uff0c\u503c\u4e3a\uff1a%d\\n\", n, v)\nrw.Unlock()\nch &lt;- struct{}{}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/#4synconce\u7ed3\u6784\u4f53","title":"4.sync.Once\u7ed3\u6784\u4f53","text":"<p>\u5728\u7f16\u7a0b\u7684\u5f88\u591a\u573a\u666f\u4e0b\u6211\u4eec\u9700\u8981\u786e\u4fdd\u67d0\u4e9b\u64cd\u4f5c\u5728\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e0b\u53ea\u6267\u884c\u4e00\u6b21\uff0c\u4f8b\u5982\u53ea\u52a0\u8f7d\u4e00\u6b21\u914d\u7f6e\u6587\u4ef6\u3001\u53ea\u5173\u95ed\u4e00\u6b21\u901a\u9053\u7b49\u3002</p> <p>Go\u8bed\u8a00\u4e2d\u7684sync\u5305\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9488\u5bf9\u53ea\u6267\u884c\u4e00\u6b21\u573a\u666f\u7684\u89e3\u51b3\u65b9\u6848\u2013sync.Once\u3002</p> <p>sync.Once\u53ea\u6709\u4e00\u4e2aDo\u65b9\u6cd5\uff0c\u5176\u7b7e\u540d\u5982\u4e0b\uff1a</p> <pre><code>func (o *Once) Do(f func()) {} </code></pre> <p>\u6ce8\u610f\uff1a\u5982\u679c\u8981\u6267\u884c\u7684\u51fd\u6570f\u9700\u8981\u4f20\u9012\u53c2\u6570\u5c31\u9700\u8981\u642d\u914d\u95ed\u5305\u6765\u4f7f\u7528\u3002</p> <p>\u591a\u6b21\u8c03\u7528<code>sync.Once.Do(f func())</code>\uff0c\u53ea\u6267\u884c\u7b2c\u4e00\u6b21\u8c03\u7528\u7684\u51fd\u6570\u3002</p> <pre><code>type Once struct {\ndone uint32\nm Mutex\n}\nfunc (o *Once) Do(f func())\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"sync\"\n)\nfunc main() {\nvar once sync.Once\nonceBody := func() {\nfmt.Println(\"test only once,\u8fd9\u91cc\u53ea\u6253\u5370\u4e00\u6b21\uff01\") //\u6253\u5370\n}\ndone := make(chan bool)\nfor i := 0; i &lt; 6; i++ {\ngo func() {\n// onceBody()       // \u6b64\u65f6\u4f1a\u6253\u53706\u6b21\nonce.Do(onceBody) //\u786e\u4fdd\u53ea\u6267\u884c\u4e00\u6b21\ndone &lt;- true\n}()\n}\nfor i := 0; i &lt; 6; i++ {\n&lt;-done\n}\n}\n</code></pre> <pre><code>var icons map[string]image.Image\nvar loadIconsOnce sync.Once\nfunc loadIcons() {\nicons = map[string]image.Image{\n\"left\":  loadIcon(\"left.png\"),\n\"up\":    loadIcon(\"up.png\"),\n\"right\": loadIcon(\"right.png\"),\n\"down\":  loadIcon(\"down.png\"),\n}\n}\n// Icon \u662f\u5e76\u53d1\u5b89\u5168\u7684\nfunc Icon(name string) image.Image {\nloadIconsOnce.Do(loadIcons)\nreturn icons[name]\n}\n</code></pre> <p>sync.Once\u5176\u5b9e\u5185\u90e8\u5305\u542b\u4e00\u4e2a\u4e92\u65a5\u9501\u548c\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u4e92\u65a5\u9501\u4fdd\u8bc1\u5e03\u5c14\u503c\u548c\u6570\u636e\u7684\u5b89\u5168\uff0c\u800c\u5e03\u5c14\u503c\u7528\u6765\u8bb0\u5f55\u521d\u59cb\u5316\u662f\u5426\u5b8c\u6210\u3002\u8fd9\u6837\u8bbe\u8ba1\u5c31\u80fd\u4fdd\u8bc1\u521d\u59cb\u5316\u64cd\u4f5c\u7684\u65f6\u5019\u662f\u5e76\u53d1\u5b89\u5168\u7684\u5e76\u4e14\u521d\u59cb\u5316\u64cd\u4f5c\u4e5f\u4e0d\u4f1a\u88ab\u6267\u884c\u591a\u6b21\u3002</p>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/#5\u540c\u6b65\u7b49\u5f85\u7ec4syncwaitgroup","title":"5.\u540c\u6b65\u7b49\u5f85\u7ec4sync.WaitGroup","text":"<p>\u7528\u4e8e\u7b49\u5f85\u4e00\u7ec4\u7ebf\u7a0b\u7684\u7ed3\u675f\u3002</p> <pre><code>func (*WaitGroup) Add(int)\nfunc (w *WaitGroup) Done() {\nw.Add(-1)\n}\nfunc (*WaitGroup) Wait()\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"sync\"\n)\nvar wg sync.WaitGroup\nfunc hello() {\ndefer wg.Done()\nfmt.Println(\"Hello Goroutine!\")\n}\nfunc main() {\nwg.Add(1)\ngo hello() // \u542f\u52a8\u53e6\u5916\u4e00\u4e2agoroutine\u53bb\u6267\u884chello\u51fd\u6570\nfmt.Println(\"main goroutine done!\")\nwg.Wait()\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"sync\"\n\"time\"\n)\nfunc main() {\nvar wg sync.WaitGroup\nwg.Add(1)\ngo func() {\ndefer wg.Done()\nfmt.Println(\"1 goroutine sleep ...\")\ntime.Sleep(2)\nfmt.Println(\"1 goroutine exit ...\")\n}()\nwg.Add(1)\ngo func() {\ndefer wg.Done()\nfmt.Println(\"2 goroutine sleep ...\")\ntime.Sleep(4)\nfmt.Println(\"2 goroutine exit ...\")\n}()\nfmt.Println(\"Waiting for all goroutine \")\nwg.Wait()\nfmt.Println(\"All goroutines finished!\")\n}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"sync\"\n\"time\"\n)\nfunc main() {\ntestFunc := func(wg *sync.WaitGroup, id int) {\ndefer wg.Done()\nfmt.Printf(\"%v goroutine start ...\\n\", id)\ntime.Sleep(2)\nfmt.Printf(\"%v goroutine exit ...\\n\", id)\n}\nvar wg sync.WaitGroup\nconst N = 3\nwg.Add(N)\nfor i := 0; i &lt; N; i++ {\ngo testFunc(&amp;wg, i)\n}\nfmt.Println(\"Waiting for all goroutine\")\nwg.Wait()\nfmt.Println(\"All goroutines finished!\")\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/30.sync%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91/#6\u7ade\u6001\u68c0\u6d4b\u5668","title":"6.\u7ade\u6001\u68c0\u6d4b\u5668","text":"<p>\u7ade\u6001\u5206\u6790\u5de5\u5177\u3002</p> <pre><code>go build -race main.go\ngo run -race main.go\ngo test -race test_main.go\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nc := make(chan bool)\nm := make(map[string]string)\ngo func() {\nm[\"a\"] = \"one\" // \u7b2c\u4e00\u4e2a\u51b2\u7a81\u8bbf\u95ee.\nc &lt;- true\n}()\nm[\"b\"] = \"two\" // \u7b2c\u4e00\u4e2a\u51b2\u7a81\u8bbf\u95ee\n&lt;-c\nfor k, v := range m {\nfmt.Println(k, v)\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/","title":"Go\u5e76\u53d1\u7684Web\u5e94\u7528","text":""},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#1\u81ea\u589e\u6574\u6570\u751f\u6210\u5668","title":"1.\u81ea\u589e\u6574\u6570\u751f\u6210\u5668","text":"<pre><code>package main\nimport \"fmt\"\nfunc IntegerGenerator() chan int {\nvar ch chan int = make(chan int)\ngo func() {\nfor i := 0; ; i++ {\nch &lt;- i\n}\n}()\nreturn ch\n}\nfunc main() {\ngenerator := IntegerGenerator()\nfor i := 0; i &lt; 100; i++ {\nfmt.Println(&lt;-generator)\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#2\u5e76\u53d1\u7684\u6d88\u606f\u53d1\u9001\u5668","title":"2.\u5e76\u53d1\u7684\u6d88\u606f\u53d1\u9001\u5668","text":"<pre><code>package main\nimport \"fmt\"\nfunc SendNotification(user string) &lt;-chan string {\nnotifications := make(chan string, 1)\ngo func() {\ndefer close(notifications)\nnotifications &lt;- fmt.Sprintf(\"Hi %s, welcome!\", user)\n}()\nreturn notifications\n}\nfunc main() {\nbarry := SendNotification(\"barry\")\nshirdon := SendNotification(\"shirdon\")\nfmt.Println(&lt;-barry)\nfmt.Println(&lt;-shirdon)\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#3\u591a\u8def\u590d\u5408\u8ba1\u7b97\u5668","title":"3.\u591a\u8def\u590d\u5408\u8ba1\u7b97\u5668","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"math/rand\"\n\"time\"\n)\nfunc doCompute(x int) int {\ntime.Sleep(time.Duration(rand.Intn(10)) * time.Millisecond)\nreturn 1 + x\n}\nfunc branch(x int) chan int {\nch := make(chan int, 1)\ngo func() {\ndefer close(ch)\nch &lt;- doCompute(x)\n}()\nreturn ch\n}\n/*\nfunc Recombination(chs... chan int) chan int {\n    ch := make(chan int)\n    for _, c := range chs {\n        go func(c chan int) {ch &lt;- &lt;-c}(c)\n    }\n    return ch\n}\n*/\nfunc Recombination(chs ...chan int) chan int {\nnum := len(chs)\nch := make(chan int, num)\ngo func() {\ndefer close(ch)\nfor i := 0; i &lt; num; i++ {\n/*\n                select {\n                case v := &lt;-chs[i]:\n                    ch &lt;- v\n                }\n            */\nch &lt;- &lt;-chs[i]\n}\n}()\nreturn ch\n}\nfunc main() {\nresult := Recombination(branch(10), branch(20), branch(30))\n/*\n        for i := 0; i &lt; 3; i++ {\n            fmt.Println(&lt;-result)\n        }\n    */\nfor v := range result {\nfmt.Println(v)\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#7select\u521b\u5efa\u591a\u901a\u9053\u76d1\u542c\u5668","title":"7.select\u521b\u5efa\u591a\u901a\u9053\u76d1\u542c\u5668","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc foo(x int) &lt;-chan int {\nch := make(chan int, 1)\ngo func() {\ndefer close(ch)\nch &lt;- x\n}()\nreturn ch\n}\nfunc main() {\nch1, ch2, ch3 := foo(3), foo(6), foo(9)\nch := make(chan int, 3)\ngo func() {\ndefer close(ch)\ntimeout := time.After(1 * time.Second)\nfor isTimeout := false; !isTimeout; {\nselect {\ncase v1, ok := &lt;-ch1:\nif ok {\nch &lt;- v1\n}\ncase v2, ok := &lt;-ch2:\nif ok {\nch &lt;- v2\n}\ncase v3, ok := &lt;-ch3:\nif ok {\nch &lt;- v3\n}\ncase &lt;-timeout:\nisTimeout = true\n}\n}\n}()\nfor v := range ch {\nfmt.Println(v)\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#8\u65e0\u7f13\u51b2\u901a\u9053\u963b\u585e\u4e3b\u7ebf","title":"8.\u65e0\u7f13\u51b2\u901a\u9053\u963b\u585e\u4e3b\u7ebf","text":"<pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nch, quit := make(chan int), make(chan int)\ngo func() {\nch &lt;- 8\nquit &lt;- 1\n}()\nfor isQuit := false; !isQuit; {\nselect {\ncase v := &lt;-ch:\nfmt.Printf(\"received %d from ch\", v)\ncase &lt;-quit:\nisQuit = true\n}\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#9\u7b5b\u9009\u6cd5\u6c42\u7d20\u6570","title":"9.\u7b5b\u9009\u6cd5\u6c42\u7d20\u6570","text":"<pre><code>package main\nimport (\n\"fmt\"\n)\nfunc IntegerGenerator() chan int {\nvar ch chan int = make(chan int)\ngo func() {\nfor i := 2; ; i++ {\nch &lt;- i\n}\n}()\nreturn ch\n}\nfunc Filter(in chan int, number int) chan int {\nout := make(chan int)\ngo func() {\nfor {\ni := &lt;-in\nif i%number != 0 {\nout &lt;- i\n}\n}\n}()\nreturn out\n}\nfunc main() {\nconst max = 100\n//\u4ea7\u751f\u6240\u6709\u7684\u8f93\u5165\u6d41\n//2 3 4 5 6 7 8 9 10\nnumbers := IntegerGenerator()\n//\u53d6\u7b2c\u4e00\u4e2a\u65702\nnumber := &lt;-numbers\nfor number &lt;= max {\nfmt.Println(number)\n//\u8fc7\u6ee4\u8f93\u5165\u6d41\uff0c\u4ea7\u751f\u65b0\u7684\u8f93\u5165\u6d41\n//\u7b2c\u4e00\u6b21\u8fc7\u6ee4\n//3 5 7 9\n//\u7b2c\u4e8c\u6b21\u8fc7\u6ee4\n//5 7\n//\u7b2c\u4e09\u6b21\u8fc7\u6ee4\n//7\nnumbers = Filter(numbers, number)\n//\u7b2c\u4e00\u6b21\u8fc7\u6ee4\u540e\u53d6\u7b2c\u4e00\u4e2a\u65703\n//\u7b2c\u4e8c\u6b21\u8fc7\u6ee4\u540e\u53d6\u7b2c\u4e00\u4e2a\u65705\n//\u7b2c\u4e09\u6b21\u8fc7\u6ee4\u540e\u53d6\u7b2c\u4e00\u4e2a\u65707\nnumber = &lt;-numbers\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#10\u968f\u673a\u6570\u751f\u6210\u5668","title":"10.\u968f\u673a\u6570\u751f\u6210\u5668","text":"<pre><code>package main\nimport (\n\"fmt\"\n)\nfunc randGenerator() chan int {\nvar ch chan int = make(chan int)\ngo func() {\nfor {\nselect {\ncase ch &lt;- 0:\ncase ch &lt;- 1:\n}\n}\n}()\nreturn ch\n}\nfunc main() {\ngenerator := randGenerator()\nfor i := 0; i &lt; 10; i++ {\nfmt.Println(&lt;-generator)\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#11\u5b9a\u65f6\u5668","title":"11.\u5b9a\u65f6\u5668","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc Timer(duration time.Duration) chan bool {\nvar ch chan bool = make(chan bool)\ngo func() {\ntime.Sleep(duration)\nch &lt;- true\n}()\nreturn ch\n}\nfunc main() {\ntimeout := Timer(2 * time.Second)\nfor {\nselect {\ncase &lt;-timeout:\nfmt.Println(\"already 2s!\")\nreturn\n}\n}\n}\n</code></pre>"},{"location":"Golang/7.Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/31.Go%E5%B9%B6%E5%8F%91%E7%9A%84Web%E5%BA%94%E7%94%A8/#12\u5e76\u53d1\u7684web\u722c\u866b","title":"12.\u5e76\u53d1\u7684Web\u722c\u866b","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"io\"\n\"net/http\"\n\"os\"\n\"strconv\"\n)\nfunc Get(url string) (result string, err error) {\nresp, err := http.Get(url)\nif err != nil {\nreturn\n}\ndefer resp.Body.Close()\nbuf := make([]byte, 4*1024)\nfor {\nn, err := resp.Body.Read(buf)\nif err != nil {\nif err == io.EOF {\nerr = nil\nfmt.Println(\"\u6587\u4ef6\u8bfb\u53d6\u5b8c\u6bd5\")\nbreak\n} else {\nfmt.Println(\"resp.Body.Read err = \", err)\nbreak\n}\n}\nresult += string(buf[:n])\n}\nreturn\n}\nfunc SpiderPage(i int, page chan&lt;- int) {\nurl := \"https://github.com/search?q=go&amp;type=Repositories&amp;p=1\" + strconv.Itoa((i-1)*50)\nfmt.Printf(\"\u6b63\u5728\u722c\u53d6\u7b2c%d\u4e2a\u7f51\u9875\\n\", i)\nresult, err := Get(url)\nif err != nil {\nfmt.Println(\"http.Get err = \", err)\nreturn\n}\nfilename := \"page\" + strconv.Itoa(i) + \".html\"\nf, err := os.Create(filename)\nif err != nil {\nfmt.Println(\"os.Create err = \", err)\nreturn\n}\nf.WriteString(result)\nf.Close()\npage &lt;- i\n}\nfunc Run(start, end int) {\nfmt.Printf(\"\u6b63\u5728\u722c\u5230\u7b2c%d\u9875\u5230\u7b2c%d\u9875\\n\", start, end)\npage := make(chan int)\nfor i := start; i &lt;= end; i++ {\ngo SpiderPage(i, page)\n}\nfor i := start; i &lt;= end; i++ {\nfmt.Printf(\"\u7b2c%d\u4e2a\u9875\u9762\u722c\u53d6\u5b8c\u6210\\n\", &lt;-page)\n}\n}\nfunc main() {\nvar start, end int\nfmt.Printf(\"\u8bf7\u8f93\u5165\u8d77\u59cb\u9875\u6570\u5b57&gt;=1: &gt; \")\nfmt.Scan(&amp;start)\nfmt.Printf(\"\u8bf7\u8f93\u5165\u7ed3\u675f\u9875\u6570\u5b57\uff1a&gt; \")\nfmt.Scan(&amp;end)\nRun(start, end)\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/","title":"time","text":"<pre><code>import \"time\"\n</code></pre> <p>time\u5305\u63d0\u4f9b\u4e86\u65f6\u95f4\u7684\u663e\u793a\u548c\u6d4b\u91cf\u7528\u7684\u51fd\u6570\u3002\u65e5\u5386\u7684\u8ba1\u7b97\u91c7\u7528\u7684\u662f\u516c\u5386\u3002</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#1\u65f6\u95f4\u6233","title":"1.\u65f6\u95f4\u6233","text":"<p>\u65e5\u671f\u548c\u65f6\u95f4\u662f\u7f16\u7a0b\u8bed\u8a00\u4e2d\u5e38\u7528\u7684\u529f\u80fd\u4e4b\u4e00\uff0c\u5982\u679c\u6ca1\u6709\u65e5\u671f\u548c\u65f6\u95f4\uff0c\u5c31\u4f1a\u5bfc\u81f4\u8bb8\u591a\u529f\u80fd\u65e0\u6cd5\u5b9e\u73b0\uff0c\u6bd4\u5982\u65e5\u5fd7\u8bb0\u5f55\u3001\u5b9a\u65f6\u4efb\u52a1\u3001\u7b49\u5f85\u5ef6\u65f6\u7b49\u3002</p> <p>\u5185\u7f6e\u5305time\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u64cd\u4f5c\u65e5\u671f\u548c\u65f6\u95f4\u7684\u51fd\u6570\u65b9\u6cd5\u3002</p> <p>\u4e0d\u540c\u5730\u533a\u7684\u65f6\u95f4\u4f1a\u5b58\u5728\u65f6\u95f4\u5dee\uff0c</p> <p>\u5982\u6cf0\u56fd\u6bd4\u5317\u4eac\u65f6\u95f4\u665a\u4e861\u5c0f\u65f6\uff0c</p> <p>UTC(Universal Time Coordinated)\u662f\u516c\u8ba4\u7684\u4e16\u754c\u534f\u8c03\u65f6\u95f4\uff0c\u4ee5GMT\uff08Greenwich Mean Time\uff0c\u683c\u6797\u5c3c\u6cbb\u65f6\u95f4\uff09\u65f6\u533a\u7684\u65f6\u95f4\u4e3a\u4e3b\uff0c</p> <p>\u6839\u636eGMT\u65f6\u95f4\u4e0e\u65f6\u533a\u4e4b\u95f4\u7684\u65f6\u95f4\u5dee\u5c31\u80fd\u8ba1\u7b97\u5f53\u524d\u65f6\u533a\u7684\u672c\u5730\u65f6\u95f4\uff0c\u5982UTC+8\u5c0f\u65f6=\u5317\u4eac\u65f6\u95f4\u3002</p> <p>\u4e00\u822c\u9ed8\u8ba4\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u7684\u5f53\u524d\u65f6\u95f4\u4e3a\u57fa\u51c6\uff0c\u5982\u679c\u5bf9\u65f6\u95f4\u6ca1\u6709\u592a\u5927\u8981\u6c42\uff0c\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u5f53\u524d\u65f6\u95f4\u5373\u53ef\u3002</p> <p>\u5728Go\u8bed\u8a00\u4e2d\uff0c\u65e5\u671f\u4e0e\u65f6\u95f4\u53ef\u4ee5\u5206\u4e3a3\u79cd\u8868\u793a\u65b9\u5f0f\uff1a\u65f6\u95f4\u6233\u3001\u7ed3\u6784\u4f53Time\u548c\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\uff0c\u4e09\u8005\u4e4b\u95f4\u7684\u6570\u636e\u7c7b\u578b\u80fd\u76f8\u4e92\u8f6c\u6362\u3002</p> <p>\u65f6\u95f4\u6233\u662f\u6307\u683c\u6797\u5c3c\u6cbb\u65f6\u95f41970\u5e741\u67081\u65e500\u65f600\u520600\u79d2\uff0c\u5373\u5317\u4eac\u65f6\u95f41970\u5e741\u67081\u65e508\u65f600\u520600\u79d2\u81f3\u73b0\u5728\u7684\u603b\u79d2\u6570\u3002</p> <p>\u5185\u7f6e\u5305time\u63d0\u4f9b\u7ed3\u6784\u4f53\u65b9\u6cd5Unix()\u548cUnixNano()\u751f\u6210\u79d2\u7ea7\u65f6\u95f4\u6233\u548c\u7eb3\u79d2\u7ea7\u65f6\u95f4\u6233\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\nnow := time.Now()\n// \u751f\u6210\u79d2\u7ea7\u65f6\u95f4\u6233\nt1 := now.Unix()\n// \u751f\u6210\u7eb3\u79d2\u7ea7\u65f6\u95f4\u6233\nt2 := now.UnixNano()\nfmt.Printf(\"\u73b0\u5728\u7684\u79d2\u7ea7\u65f6\u95f4\u6233\uff1a%v\uff0c\u7c7b\u578b\uff1a%T\\n\", t1, t1)\nfmt.Printf(\"\u73b0\u5728\u7684\u7eb3\u79d2\u7ea7\u65f6\u95f4\u6233\uff1a%v\uff0c\u7c7b\u578b\uff1a%T\\n\", t2, t2)\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#2\u7ed3\u6784\u4f53time","title":"2.\u7ed3\u6784\u4f53Time","text":"<p>\u7ed3\u6784\u4f53Time\u662fGo\u8bed\u8a00\u5bf9\u65f6\u95f4\u7684\u5177\u4f53\u8868\u73b0\uff0c\u5b83\u5c06\u65f6\u95f4\u4ee5\u7ed3\u6784\u4f53Time\u8868\u793a\uff0c\u7531\u7ed3\u6784\u4f53\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8c03\u7528\u7ed3\u6784\u4f53\u65b9\u6cd5\u6216\u7ed3\u6784\u4f53\u6210\u5458\u83b7\u53d6\u65f6\u95f4\u4fe1\u606f\uff0c</p> <p>\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\nnow := time.Now()\nfmt.Printf(\"\u5f53\u524d\u65f6\u95f4\uff1a%v\\n\", now)\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u5e74\nyear := now.Year()\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u5e74\uff1a%v\\n\", year)\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u6708\nmonth := now.Month()\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u6708\uff0c\u82f1\u6587\u683c\u5f0f\uff1a%v\\n\", month)\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u6708\uff0c\u6570\u5b57\u683c\u5f0f\uff1a%v\\n\", int(month))\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u65e5\nday := now.Day()\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u65e5\uff1a%v\\n\", day)\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u5c0f\u65f6\nhour := now.Hour()\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u5c0f\u65f6\uff1a%v\\n\", hour)\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u5206\u949f\nminute := now.Minute()\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u5206\u949f\uff1a%v\\n\", minute)\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u79d2\nsecond := now.Second()\nfmt.Printf(\"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u79d2\uff1a%v\\n\", second)\n// \u83b7\u53d6\u5f53\u5929\u662f\u661f\u671f\u51e0\nwk := now.Weekday()\nfmt.Printf(\"\u83b7\u53d6\u5f53\u5929\u662f\u661f\u671f\u51e0\uff1a%v\\n\", wk)\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#3\u5b57\u7b26\u4e32\u683c\u5f0f\u5316","title":"3.\u5b57\u7b26\u4e32\u683c\u5f0f\u5316","text":"<p>\u65f6\u95f4\u7684\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u662f\u5c06\u65f6\u95f4\u4ee5\u5b57\u7b26\u4e32\u683c\u5f0f\u8868\u793a\uff0c\u5b83\u5c06\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8f6c\u5316\u4e3a\u5b57\u7b26\u4e32\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\nnow := time.Now()\n// \u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u7684\u6a21\u677f\u4e3aGo\u7684\u51fa\u751f\u65f6\u95f42006\u5e741\u67082\u53f715\u70b904\u5206 Mon Jan\n// 24\u5c0f\u65f6\u5236\nt1 := now.Format(\"2006-01-02 15:04:05.000 Mon Jan\")\nfmt.Printf(\"24\u5c0f\u65f6\u5236\uff1a%v\\n\", t1)\n// 12\u5c0f\u65f6\u5236\nt2 := now.Format(\"2006-01-02 03:04:05.000 PM Mon Jan\")\nfmt.Printf(\"12\u5c0f\u65f6\u5236\uff1a%v\\n\", t2)\n// \u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u5e74/\u6708/\u65e5 \u65f6:\u5206\nt3 := now.Format(\"2006/01/02 15:04\")\nfmt.Printf(\"\u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u5e74/\u6708/\u65e5 \u65f6:\u5206\uff1a%v\\n\", t3)\n// \u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u65f6:\u5206 \u5e74/\u6708/\u65e5\nt4 := now.Format(\"15:04 2006/01/02\")\nfmt.Printf(\"\u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u65f6:\u5206 \u5e74/\u6708/\u65e5\uff1a%v\\n\", t4)\n// \u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u5e74/\u6708/\u65e5\nt5 := now.Format(\"2006/01/02\")\nfmt.Printf(\"\u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u5e74/\u6708/\u65e5\uff1a%v\\n\", t5)\n// \u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u5e74-\u6708-\u65e5\nt6 := now.Format(\"2006-01-02\")\nfmt.Printf(\"\u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u5e74-\u6708-\u65e5\uff1a%v\\n\", t6)\n// \u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u65e5-\u6708-\u5e74\nt7 := now.Format(\"02-01-2006\")\nfmt.Printf(\"\u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u65e5-\u6708-\u5e74\uff1a%v\\n\", t7)\n// \u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u65f6:\u5206:\u79d2\nt8 := now.Format(\"15:04:05.000\")\nfmt.Printf(\"\u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u65f6:\u5206:\u79d2\uff1a%v\\n\", t8)\n// \u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u65f6-\u5206-\u79d2\nt9 := now.Format(\"15-04-05.000\")\nfmt.Printf(\"\u65f6\u95f4\u663e\u793a\u683c\u5f0f\u4e3a\uff1a\u65f6-\u5206-\u79d2\uff1a%v\\n\", t9)\n}\n</code></pre> <p>\u4e0a\u8ff0\u793a\u4f8b\u662f\u5c06\u5f53\u524d\u65f6\u95f4\u8f6c\u4e3a\u5b57\u7b26\u4e32\u683c\u5f0f\uff0c\u8f6c\u6362\u8fc7\u7a0b\u7531\u7ed3\u6784\u4f53\u65b9\u6cd5Format()\u5b9e\u73b0\uff0c\u5b9e\u73b0\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u7531\u5185\u7f6e\u5305time\u8c03\u7528\u5de5\u5382\u51fd\u6570Now()\u751f\u6210\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u7528\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4\u3002</li> <li>\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8c03\u7528\u7ed3\u6784\u4f53\u65b9\u6cd5Format()\u5c06\u5f53\u524d\u65f6\u95f4\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u683c\u5f0f\u3002\u5b57\u7b26\u4e32\u683c\u5f0f\u6a21\u677f\u4e3aGo\u7684\u51fa\u751f\u65f6\u95f4\uff1a2006\u5e741\u67082\u65e515\u70b904\u5206Mon Jan\u3002</li> <li>\u5927\u90e8\u5206\u7f16\u7a0b\u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u683c\u5f0f\u6a21\u677f\u91c7\u7528YYYY-mm-dd HH:MM:SS\uff0c\u800cGo\u8bed\u8a00\u5219\u4f7f\u7528\u5b83\u7684\u51fa\u751f\u65f6\u95f4\uff082006\u5e741\u67082\u65e515\u70b904\u5206Mon Jan\uff09\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u7ed3\u6784\u4f53\u65b9\u6cd5Format()\u7684\u53c2\u6570layout\u8bbe\u4e3a\u5b57\u7b26\u4e322006/01/02\uff0c\u5373\u4ee3\u8868\u5f53\u524d\u65f6\u95f4\u4ee52006/01/02\u7684\u683c\u5f0f\u8868\u793a\u3002</li> <li>\u5b57\u7b26\u4e322006\u300101(1)\u300102(2)\u300115\u300104(4)\u3001Mon\u548cJan\u5728\u7ed3\u6784\u4f53\u65b9\u6cd5Format()\u4e2d\u4ee3\u8868\u65f6\u95f4\u7684\u5b57\u7b26\u4e32\u6a21\u677f\u3002</li> </ol>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#4\u65f6\u95f4\u7c7b\u578b\u7684\u76f8\u4e92\u8f6c\u6362","title":"4.\u65f6\u95f4\u7c7b\u578b\u7684\u76f8\u4e92\u8f6c\u6362","text":"<p>\u6211\u4eec\u77e5\u9053Go\u8bed\u8a00\u7684\u65f6\u95f4\u7c7b\u578b\u5206\u4e3a\u65f6\u95f4\u6233\u3001\u7ed3\u6784\u4f53Time\u548c\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\uff0c\u4e09\u8005\u4e4b\u95f4\u80fd\u901a\u8fc7\u7279\u5b9a\u65b9\u6cd5\u5b9e\u73b0\u76f8\u4e92\u8f6c\u6362\uff0c\u5177\u4f53\u7684\u8f6c\u6362\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\n/* \u65f6\u95f4\u6233 */\nvar timestamp int64 = 1630315335\n// \u65f6\u95f4\u6233\u8f6c\u6362\u7ed3\u6784\u4f53Time\ntm := time.Unix(timestamp, 0)\nfmt.Printf(\"\u65f6\u95f4\u6233\u8f6c\u6362\u7ed3\u6784\u4f53Time\uff1a%v\\n\", tm)\n// \u65f6\u95f4\u6233\u8f6c\u6362\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\ntms := time.Unix(timestamp, 0).Format(\"2006-01-02 15:04:05\")\nfmt.Printf(\"\u65f6\u95f4\u6233\u8f6c\u6362\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\uff1a%v\\n\", tms)\n/* \u7ed3\u6784\u4f53Time */\nnow := time.Now()\n// \u7ed3\u6784\u4f53Time\u8f6c\u6362\u65f6\u95f4\u6233\n// \u751f\u6210\u79d2\u7ea7\u65f6\u95f4\u6233\nfmt.Printf(\"\u7ed3\u6784\u4f53Time\u8f6c\u6362\u79d2\u7ea7\u65f6\u95f4\u6233\uff1a%v\\n\", now.Unix())\n// \u751f\u6210\u7eb3\u79d2\u7ea7\u65f6\u95f4\u6233\nfmt.Printf(\"\u7ed3\u6784\u4f53Time\u8f6c\u6362\u7eb3\u79d2\u7ea7\u65f6\u95f4\u6233\uff1a%v\\n\", now.UnixNano())\n// \u7ed3\u6784\u4f53Time\u8f6c\u6362\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\ntms1 := now.Format(\"2006-01-02 15:04:05\")\nfmt.Printf(\"\u7ed3\u6784\u4f53Time\u8f6c\u6362\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\uff1a%v\\n\", tms1)\n/* \u5b57\u7b26\u4e32\u683c\u5f0f\u5316 */\nlayout := \"2006-01-02 15:04:05\"\ntimeStr := \"2021-08-30 17:34:05.1099536\"\n// \u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f6c\u6362\u7ed3\u6784\u4f53Time\n// \u51fd\u6570Parse()\u662f\u8f6c\u6362UTC\u65f6\u95f4\u683c\u5f0f\ntimeObj, _ := time.Parse(layout, timeStr)\nfmt.Printf(\"\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f6c\u6362\u7ed3\u6784\u4f53Time\uff1a%v\\n\", timeObj)\n// \u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f6c\u6362\u7ed3\u6784\u4f53Time\n// \u51fd\u6570ParseInLocation()\u662f\u8f6c\u6362\u5f53\u5730\u65f6\u95f4\u683c\u5f0f\ntimeObj1, _ := time.ParseInLocation(layout, timeStr, time.Local)\nfmt.Printf(\"\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f6c\u6362\u7ed3\u6784\u4f53Time\uff1a%v\\n\", timeObj1)\n// \u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f6c\u6362\u65f6\u95f4\u6233\n// \u5148\u8f6c\u6362\u7ed3\u6784\u4f53Time\uff0c\u518d\u7531\u7ed3\u6784\u4f53Time\u8f6c\u6362\u65f6\u95f4\u6233\ntimeObj2, _ := time.ParseInLocation(layout, timeStr, time.Local)\n// \u8f6c\u6362\u65f6\u95f4\u6233\nt1 := timeObj2.Unix()\nfmt.Printf(\"\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f6c\u6362\u79d2\u7ea7\u65f6\u95f4\u6233\uff1a%v\\n\", t1)\nt2 := timeObj2.UnixNano()\nfmt.Printf(\"\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f6c\u6362\u7ea7\u7eb3\u79d2\u65f6\u95f4\u6233\uff1a%v\\n\", t2)\n}\n</code></pre> <p>\u6839\u636e\u4ee3\u7801\u6240\u8ff0\uff0c\u65f6\u95f4\u6233\u3001\u7ed3\u6784\u4f53Time\u548c\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u7684\u76f8\u4e92\u8f6c\u6362\u5fc5\u987b\u4ee5\u7ed3\u6784\u4f53Time\u4e3a\u4e2d\u5fc3\uff0c</p> <p>\u6bd4\u5982\u65f6\u95f4\u6233\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\uff0c\u5fc5\u987b\u5c06\u65f6\u95f4\u6233\u8f6c\u6362\u4e3a\u7ed3\u6784\u4f53Time\uff0c\u518d\u7531\u7ed3\u6784\u4f53Time\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#5\u65f6\u95f4\u8ba1\u7b97\u64cd\u4f5c","title":"5.\u65f6\u95f4\u8ba1\u7b97\u64cd\u4f5c","text":"<p>\u65f6\u95f4\u8ba1\u7b97\u662f\u5bf9\u4e24\u4e2a\u65f6\u95f4\u6216\u8005\u6839\u636e\u65f6\u95f4\u589e\u91cf\u8fdb\u884c\u52a0\u51cf\u8fd0\u7b97\u3001\u5bf9\u6bd4\u4e24\u4e2a\u65f6\u95f4\u4fe1\u606f\u7b49\u64cd\u4f5c\uff0c\u5177\u4f53\u8bf4\u660e\u5982\u4e0b\uff1a 1. \u8ba1\u7b97\u65f6\u95f4\u5dee\u503c\u662f\u4e24\u4e2a\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8fdb\u884c\u52a0\u51cf\u8fd0\u7b97\uff0c\u8ba1\u7b97\u7ed3\u679c\u4e3a\u81ea\u5b9a\u4e49\u7c7b\u578bDuration\uff0c\u5b83\u80fd\u8ba1\u7b97\u4e24\u4e2a\u65f6\u95f4\u76f8\u5dee\u7684\u5c0f\u65f6\u6570\u3001\u5206\u949f\u6570\u3001\u79d2\u6570\u3001\u6beb\u79d2\u6570\u3001\u5fae\u79d2\u6570\u548c\u7eb3\u79d2\u6570\u3002 2. \u901a\u8fc7\u65f6\u95f4\u589e\u91cf\u8ba1\u7b97\u662f\u5c06\u67d0\u4e2a\u65f6\u95f4\u589e\u52a0\u6216\u51cf\u53bb\u51e0\u5e74\u3001\u51e0\u6708\u3001\u51e0\u5929\u3001\u51e0\u5c0f\u65f6\u3001\u51e0\u5206\u949f\u3001\u51e0\u79d2\u7b49\u65f6\u95f4\u589e\u91cf\uff0c\u8ba1\u7b97\u7ed3\u679c\u4ee5\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8868\u793a\u3002 3. \u5bf9\u6bd4\u4e24\u4e2a\u65f6\u95f4\u4fe1\u606f\u5305\u62ec\uff1a\u5224\u65ad\u4e24\u4e2a\u65f6\u95f4\u662f\u5426\u76f8\u540c\u548c\u5224\u65ad\u4e24\u4e2a\u65f6\u95f4\u7684\u5148\u540e\u987a\u5e8f\uff0c\u5224\u65ad\u7ed3\u679c\u4ee5\u5e03\u5c14\u578b\uff08true\u548cfalse\uff09\u8868\u793a\u3002\u6839\u636e\u4e0a\u8ff0\u8bf4\u660e\uff0c\u6211\u4eec\u5c06\u65f6\u95f4\u8ba1\u7b97\u5206\u4e3a3\u79cd\u7c7b\u578b\uff1a\u8ba1\u7b97\u65f6\u95f4\u5dee\u503c\u3001\u901a\u8fc7\u65f6\u95f4\u589e\u91cf\u8ba1\u7b97\u548c\u5bf9\u6bd4\u4e24\u4e2a\u65f6\u95f4\u4fe1\u606f\u3002</p> <p>\u8ba1\u7b97\u65f6\u95f4\u5dee\u503c\u662f\u7531\u7ed3\u6784\u4f53\u65b9\u6cd5Sub(u)\u5b9e\u73b0\u7684\uff0c\u53c2\u6570u\u4ee3\u8868\u67d0\u4e00\u4e2a\u7ed3\u6784\u4f53Time\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\n// \u83b7\u53d6\u5f53\u524d\u672c\u5730\u65f6\u95f4\nnow := time.Now()\nfmt.Printf(\"\u5f53\u524d\u672c\u5730\u65f6\u95f4\uff1a%v\\n\", now)\n/* Sub()\u8ba1\u7b97\u4e24\u4e2a\u65f6\u95f4\u5dee\u503c */\nlayout := \"2006-01-02 15:04:05\"\ntimeStr := \"2021-07-30 17:34:05.1099536\"\n// \u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f6c\u6362\u7ed3\u6784\u4f53Time\n// \u51fd\u6570Parse()\u662f\u8f6c\u6362UTC\u65f6\u95f4\u683c\u5f0f\ntp, _ := time.Parse(layout, timeStr)\nfmt.Printf(\"\u67d0\u4e2a\u65f6\u95f4\u70b9\uff1a%v\\n\", tp)\n// \u8ba1\u7b97\u4e24\u4e2a\u65f6\u95f4\u7684\u5dee\u503c\nr := now.Sub(tp)\nfmt.Printf(\"\u4e24\u4e2a\u65f6\u95f4\u5dee\u503c\uff1a%v\\n\", r)\nfmt.Printf(\"\u4e24\u4e2a\u65f6\u95f4\u76f8\u5dee\u5c0f\u65f6\u6570\uff1a%v\\n\", r.Hours())\nfmt.Printf(\"\u4e24\u4e2a\u65f6\u95f4\u76f8\u5dee\u5206\u949f\u6570\uff1a%v\\n\", r.Minutes())\nfmt.Printf(\"\u4e24\u4e2a\u65f6\u95f4\u76f8\u5dee\u79d2\u6570\uff1a%v\\n\", r.Seconds())\nfmt.Printf(\"\u4e24\u4e2a\u65f6\u95f4\u76f8\u5dee\u6beb\u79d2\u6570\uff1a%v\\n\", r.Milliseconds())\nfmt.Printf(\"\u4e24\u4e2a\u65f6\u95f4\u76f8\u5dee\u5fae\u79d2\u6570\uff1a%v\\n\", r.Microseconds())\nfmt.Printf(\"\u4e24\u4e2a\u65f6\u95f4\u76f8\u5dee\u7eb3\u79d2\u6570\uff1a%v\\n\", r.Nanoseconds())\n}\n</code></pre> <p>\u4e0a\u8ff0\u793a\u4f8b\u662f\u8ba1\u7b97\u5f53\u524d\u65f6\u95f4\u548c\u67d0\u4e2a\u65f6\u95f4\u70b9(2021-07-30 17:34:05)\u7684\u5dee\u503c\uff0c\u5177\u4f53\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u4f7f\u7528\u5185\u7f6e\u5305time\u7684\u51fd\u6570Now()\u83b7\u53d6\u5f53\u524d\u672c\u5730\u65f6\u95f4\uff0c\u518d\u5c06\u67d0\u4e2a\u5b57\u7b26\u4e32\u683c\u5f0f\u7684\u65f6\u95f4\u8f6c\u6362\u4e3a\u7ed3\u6784\u4f53Time\uff08\u53732021-07-30 17:34:05\uff09\uff0c\u65f6\u95f4\u4ee5UTC\u65f6\u95f4\u8868\u793a\u3002</p> </li> <li> <p>\u7531\u5f53\u524d\u672c\u5730\u65f6\u95f4\u8c03\u7528\u7ed3\u6784\u4f53\u65b9\u6cd5Sub()\uff0c\u67d0\u4e2a\u65f6\u95f4\u7684\u7ed3\u6784\u4f53Time\u4f5c\u4e3aSub()\u53c2\u6570\u8ba1\u7b97\u4e24\u8005\u7684\u5dee\u503c\u3002</p> </li> <li> <p>\u8ba1\u7b97\u7ed3\u679c\u4e3a\u81ea\u5b9a\u4e49\u7c7b\u578bDuration\uff0c\u5e76\u63d0\u4f9bHours()\u3001Minutes()\u3001Seconds()\u3001Milliseconds()\u3001Microseconds()\u548cNanoseconds()\u7b49\u7ed3\u6784\u4f53\u65b9\u6cd5\u8ba1\u7b97\u76f8\u5dee\u7684\u5c0f\u65f6\u6570\u3001\u5206\u949f\u6570\u3001\u79d2\u6570\u3001\u6beb\u79d2\u6570\u3001\u5fae\u79d2\u6570\u548c\u7eb3\u79d2\u6570\u3002</p> </li> <li> <p>\u4e24\u4e2a\u65f6\u95f4\u7684\u5dee\u503c\u8ba1\u7b97\u517c\u5bb9CST\u65f6\u95f4\u548cUTC\u65f6\u95f4\uff0c\u5728\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u6839\u636e\u65f6\u533a\u8bbe\u7f6e\u8c03\u6574\u5408\u7406\u7684\u8ba1\u7b97\u65b9\u5f0f\u3002</p> </li> </ol> <p>\u65f6\u95f4\u589e\u91cf\u8ba1\u7b97\u662f\u7531\u7ed3\u6784\u4f53\u65b9\u6cd5Add()\u6216AddDate()\u5b9e\u73b0\u7684\uff0cAdd()\u8bbe\u6709\u53c2\u6570d\uff0c\u6570\u636e\u7c7b\u578b\u4e3aDuration\uff1bAddDate()\u8bbe\u6709\u53c2\u6570years\u3001months\u548cdays\uff0c\u53c2\u6570\u7c7b\u578b\u7686\u4e3a\u6574\u578b\u3002</p> <p>\u4e24\u4e2a\u7ed3\u6784\u4f53\u65b9\u6cd5\u7684\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\n// \u83b7\u53d6\u5f53\u524d\u672c\u5730\u65f6\u95f4\nnow := time.Now()\nfmt.Printf(\"\u5f53\u524d\u672c\u5730\u65f6\u95f4\uff1a%v\\n\", now)\n/* Add()\u6839\u636e\u589e\u91cf\uff08\u65f6\u5206\u79d2\uff09\u8ba1\u7b97\u65f6\u95f4 */\n// \u5f53\u524d\u65f6\u95f4\u52a01\u5c0f\u65f6\u540e\u7684\u65f6\u95f4\ntimes1 := now.Add(time.Hour)\nfmt.Printf(\"1\u5c0f\u65f6\u540e\u7684\u65f6\u95f4\uff1a%v\\n\", times1)\n// \u5f53\u524d\u65f6\u95f4\u52a02\u5c0f\u65f6\u540e\u7684\u65f6\u95f4\ntimes2 := now.Add(2 * time.Hour)\nfmt.Printf(\"2\u5c0f\u65f6\u540e\u7684\u65f6\u95f4\uff1a%v\\n\", times2)\n// \u5f53\u524d\u65f6\u95f4\u52a015\u5206\u949f\u540e\u7684\u65f6\u95f4\ntimes3 := now.Add(15 * time.Minute)\nfmt.Printf(\"15\u5206\u949f\u540e\u7684\u65f6\u95f4\uff1a%v\\n\", times3)\n// \u5f53\u524d\u65f6\u95f4\u52a015\u5206\u949f\u540e\u7684\u65f6\u95f4\ntimes4 := now.Add(-2 * time.Hour)\nfmt.Printf(\"2\u5c0f\u65f6\u524d\u7684\u65f6\u95f4\uff1a%v\\n\", times4)\n/* AddDate()\u6839\u636e\u589e\u91cf\uff08\u5e74\u6708\u65e5\uff09\u8ba1\u7b97\u65f6\u95f4 */\n// \u5f53\u524d\u65f6\u95f4\u52a01\u5e74\u540e\u7684\u65f6\u95f4\ntimes6 := now.AddDate(1, 0, 0)\nfmt.Printf(\"1\u5e74\u540e\u7684\u65f6\u95f4\uff1a%v\\n\", times6)\n// \u5f53\u524d\u65f6\u95f4\u76842\u5e74\u524d\u7684\u65f6\u95f4\ntimes7 := now.AddDate(-2, 0, 0)\nfmt.Printf(\"2\u5e74\u524d\u7684\u65f6\u95f4\uff1a%v\\n\", times7)\n// \u5f53\u524d\u65f6\u95f4\u76843\u5e742\u670810\u5929\u540e\u7684\u65f6\u95f4\ntimes8 := now.AddDate(3, 2, 10)\nfmt.Printf(\"3\u5e742\u670810\u5929\u540e\u7684\u65f6\u95f4\uff1a%v\\n\", times8)\n}\n</code></pre> <p>\u7ed3\u6784\u4f53\u65b9\u6cd5Add()\u53ea\u80fd\u5bf9\u65f6\u95f4\u6267\u884c\u65f6\u3001\u5206\u3001\u79d2\u7684\u52a0\u51cf\u8fd0\u7b97\uff0cAddDate()\u53ea\u80fd\u5bf9\u65f6\u95f4\u6267\u884c\u5e74\u3001\u6708\u3001\u65e5\u7684\u52a0\u51cf\u8fd0\u7b97\uff0c\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ol> <li> <p>Add()\u662f\u7531\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8c03\u7528\u7684\uff0c\u5b83\u4ee5\u67d0\u4e2a\u65f6\u95f4\u4e3a\u57fa\u51c6\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\u589e\u52a0\u6216\u51cf\u53bb\u67d0\u4e2a\u5c0f\u65f6\u3001\u5206\u949f\u6216\u79d2\u6570\u3002\u5b83\u7684\u53c2\u6570d\u662f\u81ea\u5b9a\u4e49\u7c7b\u578bDuration\uff0c\u5fc5\u987b\u4ee5time.Hour\u3001time.Minute\u6216time.Second\u7b49\u5e38\u91cf\u4f5c\u4e3a\u7c7b\u578b\u5355\u4f4d\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\u4e58\u4ee5\u500d\u6570\u5c31\u80fd\u5f97\u5230\u5c0f\u65f6\u6570\u3001\u5206\u949f\u6570\u6216\u79d2\u6570\uff0c\u5982-2\u00d7time.Hour\u8ba1\u7b972\u5c0f\u65f6\u524d\u7684\u65f6\u95f4\uff0c2\u00d7time.Hour\u8ba1\u7b972\u5c0f\u65f6\u540e\u7684\u65f6\u95f4\u3002</p> </li> <li> <p>AddDate()\u4e5f\u662f\u7531\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8c03\u7528\u7684\uff0c\u5b83\u4ee5\u67d0\u4e2a\u65f6\u95f4\u4e3a\u57fa\u51c6\uff0c\u5728\u8fd9\u4e2a\u65f6\u95f4\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u6216\u51cf\u53bb\u5e74\u6570\u3001\u6708\u6570\u3001\u65e5\u6570\u3002\u5b83\u7684\u53c2\u6570years\u3001months\u548cdays\u7686\u4e3a\u6574\u578b\uff0c\u5982\u679c\u6570\u503c\u5927\u4e8e0\uff0c\u5219\u8ba1\u7b97\u67d0\u4e2a\u65f6\u95f4\u4e4b\u540e\u7684\u65f6\u95f4\uff1b\u5982\u679c\u6570\u503c\u5c0f\u4e8e0\uff0c\u5219\u8ba1\u7b97\u67d0\u4e2a\u65f6\u95f4\u4e4b\u524d\u7684\u65f6\u95f4\u3002\u4f8b\u5982now.AddDate(3, 2, 10)\u662f\u5f53\u524d\u65f6\u95f4\u76843\u5e742\u670810\u5929\u540e\u7684\u65f6\u95f4\uff0cnow.AddDate(-2, 0, 0)\u662f\u5f53\u524d\u65f6\u95f4\u76842\u5e74\u524d\u7684\u65f6\u95f4\u3002</p> </li> </ol> <p>\u5bf9\u6bd4\u4e24\u4e2a\u65f6\u95f4\u4fe1\u606f\u662f\u5c06\u4e24\u4e2a\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5bf9\u6bd4\u7ed3\u679c\u4ee5\u5e03\u5c14\u578b\u8868\u793a\uff0c\u5e76\u4e14\u517c\u5bb9CST\u65f6\u95f4\u548cUTC\u65f6\u95f4\u7684\u5bf9\u6bd4\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\n// \u83b7\u53d6\u5f53\u524d\u672c\u5730CST\u65f6\u95f4\nnow := time.Now()\nfmt.Printf(\"\u5f53\u524d\u672c\u5730(CST)\u65f6\u95f4: %v\\n\", now)\nnow1 := now.UTC()\nfmt.Printf(\"\u5f53\u524dUTC\u65f6\u95f4: %v\\n\", now1)\nnow2 := time.Now().UTC()\nfmt.Printf(\"\u5f53\u524dUTC\u65f6\u95f4: %v\\n\", now2)\nr := now.Equal(now1)\nfmt.Printf(\"\u5224\u65ad\u672c\u5730(CST)\u65f6\u95f4\u548cUTC\u65f6\u95f4\u662f\u5426\u76f8\u540c: %v\\n\", r)\nr1 := now.Before(now2)\nfmt.Printf(\"\u5224\u65ad\u4e00\u4e2a\u65f6\u95f4\u662f\u5426\u5728\u53e6\u4e00\u4e2a\u65f6\u95f4\u4e4b\u524d: %v\\n\", r1)\nr2 := now.After(now2)\nfmt.Printf(\"\u5224\u65ad\u4e00\u4e2a\u65f6\u95f4\u662f\u5426\u5728\u53e6\u4e00\u4e2a\u65f6\u95f4\u4e4b\u540e: %v\\n\", r2)\n}\n</code></pre> <p>\u5bf9\u6bd4\u4e24\u4e2a\u65f6\u95f4\u4fe1\u606f\u4e3b\u8981\u7531\u7ed3\u6784\u4f53\u65b9\u6cd5Equal()\u3001Before()\u548cAfter()\u5b9e\u73b0\uff0c\u5b83\u4eec\u7684\u529f\u80fd\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ol> <li> <p>Equal()\u662f\u7531\u7ed3\u6784\u4f53Time\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff08\u79f0\u4e3aA\uff09\u8c03\u7528\u7684\uff0c\u53c2\u6570u\u662f\u53e6\u4e00\u4e2a\u7ed3\u6784\u4f53Time\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff08\u79f0\u4e3aB\uff09\uff0c\u5b83\u662f\u5728A\u7684\u57fa\u7840\u4e0a\u4e0eB\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5224\u65adA\u548cB\u662f\u5426\u4e3a\u540c\u4e00\u4e2a\u65f6\u95f4\u3002</p> </li> <li> <p>Before()\u3001After()\u548cEqual()\u7684\u5b9a\u4e49\u8fc7\u7a0b\u76f8\u540c\uff0cBefore()\u5224\u65adA\u662f\u5426\u4e3aB\u4e4b\u524d\u7684\u65f6\u95f4\uff0cAfter()\u5224\u65adA\u662f\u5426\u4e3aB\u4e4b\u540e\u7684\u65f6\u95f4\u3002</p> </li> </ol>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#6\u5ef6\u65f6\u8d85\u65f6\u4e0e\u5b9a\u65f6","title":"6.\u5ef6\u65f6\u3001\u8d85\u65f6\u4e0e\u5b9a\u65f6","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#\u5ef6\u65f6","title":"\u5ef6\u65f6","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\nfmt.Printf(\"\u5f53\u524d\u65f6\u95f4\uff1a%v\\n\", time.Now())\n// \u5ef6\u65f61\u79d2\ntime.Sleep(time.Second)\nfmt.Printf(\"\u5ef6\u65f61\u79d2\u540e\uff1a%v\\n\", time.Now())\n// \u5ef6\u65f65\u79d2\ntime.Sleep(5 * time.Second)\nfmt.Printf(\"\u5ef6\u65f65\u79d2\u540e\uff1a%v\\n\", time.Now())\n// \u5ef6\u65f61\u5206\u949f\ntime.Sleep(time.Minute)\nfmt.Printf(\"\u5ef6\u65f61\u5206\u949f\u540e\uff1a%v\\n\", time.Now())\n// \u5ef6\u65f62\u5206\u949f\ntime.Sleep(2 * time.Minute)\nfmt.Printf(\"\u5ef6\u65f62\u5206\u949f\u540e\uff1a%v\\n\", time.Now())\n// \u5ef6\u65f61\u5c0f\u65f6\ntime.Sleep(time.Hour)\nfmt.Printf(\"\u5ef6\u65f61\u5c0f\u65f6\u540e\uff1a%v\\n\", time.Now())\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#\u8d85\u65f6","title":"\u8d85\u65f6","text":"<p>\u8d85\u65f6\u662f\u7531\u5185\u7f6e\u5305time\u7684After()\u51fd\u6570\u5b9e\u73b0\u7684\uff0c\u5176\u539f\u7406\u662f\u901a\u8fc7\u8ba1\u65f6\u5668\u5b9e\u73b0\u8d85\u65f6\uff0c</p> <p>\u53c2\u6570d\u7684\u6570\u636e\u7c7b\u578b\u4e3aDuration\uff0c\u8fd4\u56de\u503c\u4e3aTime\u7c7b\u578b\uff08\u7ed3\u6784\u4f53Time\uff09\u7684\u901a\u9053\uff0c\u56e0\u6b64\u5b83\u7ecf\u5e38\u4e0e\u5173\u952e\u5b57select\u7ed3\u5408\u4f7f\u7528\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\nfmt.Printf(\"\u5f53\u524d\u65f6\u95f4\uff1a%v\\n\", time.Now())\n// \u521b\u5efa\u5e26\u7f13\u5b58\u7684\u901a\u9053\nc := make(chan int, 1)\n// \u5f80\u901a\u9053\u5199\u5165\u6570\u503c\nc &lt;- 10\n// \u6267\u884c\u6b7b\u5faa\u73af\nfor {\n// \u5173\u952e\u5b57select\u4ece\u901a\u9053\u8bfb\u53d6\u6570\u636e\nselect {\n// \u83b7\u53d6\u901a\u9053\u7684\u6570\u503c\ncase m := &lt;-c:\nfmt.Printf(\"\u901a\u9053c\u7684\u503c\uff1a%v\\n\", m)\n// \u901a\u9053\u4e3a\u7a7a\u7684\u65f6\u5019\u8bbe\u7f6e2\u79d2\u8d85\u65f6\uff0c\u5e76\u7ec8\u6b62\u5faa\u73af\ncase &lt;-time.After(2 * time.Second):\nfmt.Printf(\"2\u79d2\u540e\u7684\u65f6\u95f4\uff1a%v\\n\", time.Now())\nreturn\n}\n}\n}\n</code></pre> <p>\u4f7f\u7528select\u2026case\u8bed\u53e5\uff0c\u7531\u4e8e\u6ca1\u6709\u8bbe\u7f6edefault\u8bed\u53e5\uff0c\u5f53\u901a\u9053\u6ca1\u6709\u6570\u636e\u7684\u65f6\u5019\uff0c\u7a0b\u5e8f\u5c06\u4f1a\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c</p> <p>\u53ea\u8981\u5728\u8bed\u53e5\u4e2d\u52a0\u5165\u5185\u7f6e\u5305time\u7684After()\u51fd\u6570\u5c31\u80fd\u5728\u6307\u5b9a\u65f6\u95f4\u89e3\u9664\u963b\u585e\uff0c\u4ece\u800c\u5b9e\u73b0\u8d85\u65f6\u529f\u80fd\u3002</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#\u5b9a\u65f6","title":"\u5b9a\u65f6","text":"<p>\u5b9a\u65f6\u662f\u7531\u5185\u7f6e\u5305time\u7684NewTicker()\u51fd\u6570\u5b9e\u73b0\u7684\uff0c\u53c2\u6570d\u7684\u6570\u636e\u7c7b\u578b\u4e3aDuration\uff0c\u8fd4\u56de\u503c\u4e3a\u7ed3\u6784\u4f53Ticker\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\nticker := time.NewTicker(2 * time.Second)\ni := 0\nfor {\n// \u6267\u884c\u5b9a\u65f6\u95f4\u9694\nt := &lt;-ticker.C\nfmt.Printf(\"\u5f53\u524d\u65f6\u95f4\uff1a%v\\n\", t)\ni++\nfmt.Printf(\"\u5f53\u524d\u5faa\u73af\u6b21\u6570\uff1a%v\\n\", i)\nif i == 3 {\n// \u91cd\u7f6e\u5b9a\u65f6\u95f4\u9694\nticker.Reset(3 * time.Second)\n}\n// \u8f93\u51fa5\u6b21\u5c31\u505c\u6b62\nif i == 5 {\n// \u505c\u6b62\u8ba1\u65f6\u5668\nticker.Stop()\n// \u7ec8\u6b62\u5faa\u73af\nbreak\n}\n}\n}\n</code></pre> <p>NewTicker()\u51fd\u6570\u662f\u5de5\u5382\u51fd\u6570\uff0c\u4e3b\u8981\u5bf9\u7ed3\u6784\u4f53Ticker\u6267\u884c\u5b9e\u4f8b\u5316\u8fc7\u7a0b\uff0c\u7ed3\u6784\u4f53Ticker\u5b9a\u4e49\u4e86\u4e24\u4e2a\u7ed3\u6784\u4f53\u65b9\u6cd5\u548c\u7ed3\u6784\u4f53\u6210\u5458C\uff0c\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ol> <li>\u901a\u8fc7NewTicker()\u83b7\u53d6\u7ed3\u6784\u4f53Ticker\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u7ed3\u6784\u4f53Ticker\u521b\u5efa\u8ba1\u65f6\u5668\u5b9e\u73b0\u5b9a\u65f6\u6267\u884c\uff0c\u51fd\u6570\u53c2\u6570d\u4ee3\u8868\u5b9a\u65f6\u6267\u884c\u7684\u65f6\u95f4\u95f4\u9694\u3002</li> <li>\u7531\u7ed3\u6784\u4f53Ticker\u5b9e\u4f8b\u5316\u5bf9\u8c61\u8bbf\u95ee\u7ed3\u6784\u4f53\u6210\u5458C\u8fdb\u5165\u5ef6\u65f6\u72b6\u6001\uff0c\u7b49\u5f85\u7a0b\u5e8f\u7684\u4e0b\u4e00\u6b21\u6267\u884c\uff0c\u5e76\u4e14\u7ed3\u6784\u4f53\u6210\u5458C\u8fd4\u56de\u5f53\u524d\u65f6\u95f4\u4fe1\u606f\u3002</li> <li>\u7ed3\u6784\u4f53\u65b9\u6cd5Reset()\u91cd\u65b0\u8bbe\u7f6e\u5b9a\u65f6\u6267\u884c\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u53c2\u6570d\u4ee3\u8868\u5b9a\u65f6\u6267\u884c\u7684\u65f6\u95f4\u95f4\u9694\u3002</li> <li>\u7ed3\u6784\u4f53\u65b9\u6cd5Stop()\u505c\u6b62\u8ba1\u65f6\u5668\uff0c\u7ec8\u6b62\u5b9a\u65f6\u6267\u884c\u3002</li> </ol> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u5ef6\u65f6\u3001\u8d85\u65f6\u548c\u5b9a\u65f6\u5206\u522b\u4f7f\u7528\u5185\u7f6e\u5305time\u7684sleep()\u3001After()\u548cNewTicker()\u51fd\u6570\u5b9e\u73b0\u3002</p> <p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0csleep()+for\u5faa\u73af\u4e5f\u80fd\u5b9e\u73b0\u5b9a\u65f6\u529f\u80fd\uff0cNewTicker()\u53ef\u4ee5\u5b9e\u73b0\u5ef6\u65f6\u529f\u80fd\uff0c\u9009\u62e9\u54ea\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u5e94\u8be5\u4ece\u4e1a\u52a1\u9700\u6c42\u548c\u67b6\u6784\u8bbe\u8ba1\u7b49\u65b9\u9762\u7efc\u5408\u8003\u8651\u3002</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#7\u7efc\u5408-demo","title":"7.\u7efc\u5408-demo","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"time\"\n)\nfunc TimeUsage() {\nnow := time.Now()\n// \u83b7\u53d6\u5e74\nfmt.Println(now.Year()) //2023\n// \u83b7\u53d6\u6708\u4efd\nfmt.Println(now.Month()) //July\n// \u83b7\u53d6\u65e5\u671f\nfmt.Println(now.Date()) //2023 July 25\n// \u83b7\u53d6\u5929\nfmt.Println(now.Day()) //25\n// \u5c0f\u65f6\nfmt.Println(now.Hour()) //16\n// \u5206\nfmt.Println(now.Minute()) //26\n// \u79d2\nfmt.Println(now.Second()) //13\n// \u6beb\u79d2\nfmt.Println(now.Unix()) //1690273573\n// \u7eb3\u79d2\nfmt.Println(now.UnixNano()) //1690273573366590200\n}\nfunc TimeOperate() {\nstart := time.Now()\ntime.Sleep(1 * time.Second)\n// \u4e24\u4e2a\u65f6\u95f4\u5dee\nfmt.Println(time.Now().Sub(start)) //1.0061361s\n// \u683c\u5f0f\u5316\nfmt.Println(start.Format(\"2006-01-02 15:04:05\")) //2023-07-25 16:26:13\n// \u622a\u53d6\nfmt.Println(start.Round(time.Second))    //2023-07-25 16:26:13 +0800 CST\nfmt.Println(start.Truncate(time.Second)) //2023-07-25 16:26:13 +0800 CST\nstringTime := \"1991-12-25 19:00:00\"\nbirthday, _ := time.ParseInLocation(\"2006-01-02 15:04:05\", stringTime, time.Local)\nfmt.Println(birthday.String()) //1991-12-25 19:00:00 +0800 CST\n}\nfunc TimeAdd() {\nnow := time.Now()\n// \u4e00\u5929\u524d\noneDayBefore := now.AddDate(0, 0, -1)\nfmt.Println(now.String(), oneDayBefore.String()) //2023-07-25 16:26:14.3937817 +0800 CST m=+1.034208201 2023-07-24 16:26:14.3937817 +0800 CST\n// \u4e00\u5c0f\u65f6\u524d\noneHourBefore := now.Add(-1 * time.Hour)\nfmt.Println(oneHourBefore) //2023-07-25 15:26:14.3937817 +0800 CST m=-3598.965791799\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#2\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b","title":"2.\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestTimeUsage(test *testing.T) {\nTimeUsage()\nTimeOperate()\nTimeAdd()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/time_demo/demo1]\n=== RUN   TestTimeUsage\n2023\nJuly\n2023 July 25\n25\n16\n32\n1\n1690273921\n1690273921451134500\n1.0045019s\n2023-07-25 16:32:01\n2023-07-25 16:32:01 +0800 CST\n2023-07-25 16:32:01 +0800 CST\n1991-12-25 19:00:00 +0800 CST\n2023-07-25 16:32:02.4747409 +0800 CST m=+1.028621801 2023-07-24 16:32:02.4747409 +0800 CST\n2023-07-25 15:32:02.4747409 +0800 CST m=-3598.971378199\n--- PASS: TestTimeUsage (1.02s)\nPASS\nok      demo1   1.334s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/32.time/#8\u53c2\u8003\u6587\u732e","title":"8.\u53c2\u8003\u6587\u732e","text":"<p>go\u5305 time(\u65f6\u95f4\u5305)</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/","title":"strings","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"strings\"\n</code></pre> <p>strings\u5305\u5b9e\u73b0\u4e86\u7528\u4e8e\u64cd\u4f5c\u5b57\u7b26\u7684\u7b80\u5355\u51fd\u6570\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"strings\"\n\"unicode\"\n)\nconst Values = \"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.\"\n// \u5224\u65ad\u4e00\u4e2a\u5b50\u5b57\u7b26\u4e32\u662f\u5426\u5b58\u5728\u4e8e\u5e38\u91cf\u5b57\u7b26\u4e32 Values \u4e2d\u3002\nfunc StringsContains(subStrings string) bool {\nreturn strings.Contains(Values, subStrings)\n}\n// \u6bd4\u8f83\u4e24\u4e2a\u5b57\u7b26\u4e32\u7684\u5927\u5c0f\uff0c\u8fd4\u56de\u4e00\u4e2a\u6574\u6570\u503c\u3002\n// \u5982\u679c\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5c0f\u4e8e\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u8d1f\u6570\uff1b\u5982\u679c\u4e24\u4e2a\u5b57\u7b26\u4e32\u76f8\u7b49\uff0c\u8fd4\u56de 0\uff1b\n// \u5982\u679c\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5927\u4e8e\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u6b63\u6570\u3002\nfunc StringsCompare(values string, subString string) int {\nreturn strings.Compare(values, subString)\n}\n// \u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5927\u5199\u5b57\u6bcd\u5f62\u5f0f\u3002\nfunc StringsToUpper(subStrings string) string {\nreturn strings.ToUpper(subStrings)\n}\n// \u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5c0f\u5199\u5b57\u6bcd\u5f62\u5f0f\u3002\nfunc StringsToLower(subStrings string) string {\nreturn strings.ToLower(subStrings)\n}\n// \u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6807\u9898\u683c\u5f0f\uff0c\u5373\u6bcf\u4e2a\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\u5927\u5199\uff0c\u5176\u4ed6\u5b57\u6bcd\u5c0f\u5199\u3002\nfunc StringsToTitle(subStrings string) string {\n// \u4f7f\u7528 FieldsFunc \u5c06\u5b57\u7b26\u4e32\u6309\u7167\u7a7a\u683c\u5206\u5272\u6210\u5355\u8bcd\u5207\u7247\nwords := strings.FieldsFunc(subStrings, unicode.IsSpace)\n// \u904d\u5386\u5355\u8bcd\u5207\u7247\uff0c\u5c06\u6bcf\u4e2a\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\u5927\u5199\nfor i, word := range words {\nwords[i] = strings.Title(word)\n}\n// \u4f7f\u7528 Join \u5c06\u5355\u8bcd\u5207\u7247\u6309\u7167\u7a7a\u683c\u8fde\u63a5\u8d77\u6765\nreturn strings.Join(words, \" \")\n}\nvar UpperCase = map[string]string{\n\"a\": \"A\",\n\"b\": \"B\",\n}\nvar LowerCase = map[string]string{\n\"A\": \"a\",\n\"B\": \"b\",\n}\n// \u7edf\u8ba1\u4e00\u4e2a\u5b50\u5b57\u7b26\u4e32\u5728\u5e38\u91cf\u5b57\u7b26\u4e32 Values \u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u3002\nfunc StringsCount(subStrings string) int {\nreturn strings.Count(Values, subStrings)\n}\n// \u5c06\u5e38\u91cf\u5b57\u7b26\u4e32 Values \u6309\u7167\u7ed9\u5b9a\u7684\u5206\u9694\u7b26 split \u8fdb\u884c\u62c6\u5206\uff0c\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u5207\u7247\u3002\nfunc StringsSplit(split string) []string {\nreturn strings.Split(Values, split)\n}\n// \u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u5207\u7247 subStrings \u4e2d\u7684\u5b57\u7b26\u4e32\u6309\u7167\u7a7a\u683c\u8fde\u63a5\u8d77\u6765\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32\u3002\nfunc StringsJoin(subStrings []string) string {\nreturn strings.Join(subStrings, \" \")\n}\n// \u8fd4\u56de\u5b50\u5b57\u7b26\u4e32\u5728\u5e38\u91cf\u5b57\u7b26\u4e32 Values \u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u7d22\u5f15\u4f4d\u7f6e\uff0c\u5982\u679c\u627e\u4e0d\u5230\u5219\u8fd4\u56de -1\u3002\nfunc StringsIndex(subStrings string) int {\nreturn strings.Index(Values, subStrings)\n}\n// \u5224\u65ad\u5e38\u91cf\u5b57\u7b26\u4e32 Values \u662f\u5426\u4ee5\u5b50\u5b57\u7b26\u4e32 subStrings \u5f00\u5934\u3002\nfunc StringsHasPrefix(subStrings string) bool {\nreturn strings.HasPrefix(Values, subStrings)\n}\n// \u5224\u65ad\u5e38\u91cf\u5b57\u7b26\u4e32 Values \u662f\u5426\u4ee5\u5b50\u5b57\u7b26\u4e32 subStrings \u7ed3\u5c3e\u3002\nfunc StringsHasSuffix(subStrings string) bool {\nreturn strings.HasSuffix(Values, subStrings)\n}\n// \u53bb\u9664\u5b57\u7b26\u4e32 values \u7684\u524d\u540e\u7a7a\u767d\u5b57\u7b26\u3002\nfunc StringsTrim(values string) string {\nreturn strings.TrimSpace(values)\n}\n// \u4f7f\u7528 strings.NewReplacer() \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u66ff\u6362\u5668\uff0c\u5c06\u5b57\u7b26\u4e32 values \u4e2d\u7684\u6362\u884c\u7b26\u3001\u5236\u8868\u7b26\u548c\u7a7a\u683c\u66ff\u6362\u4e3a\u7a7a\u3002\u8fd4\u56de\u66ff\u6362\u540e\u7684\u65b0\u5b57\u7b26\u4e32\u3002\nfunc StringsReplacer(values string) string {\nnewReplacer := strings.NewReplacer(\"\\n\", \"\", \"\\t\", \"\", \" \", \"\")\nreturn newReplacer.Replace(values)\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"strings\"\n\"testing\"\n)\nfunc TestAllFunction(tests *testing.T) {\n// 1\nfmt.Println(StringsContains(\"Go\"))\nfmt.Println(StringsContains(\"Java\"))\n// 2\nfmt.Println(StringsCompare(\"Java\", \"Go\"))\nfmt.Println(StringsCompare(\"Go\", \"Java\"))\nfmt.Println(StringsCompare(\"A\", \"B\"), rune('A'), rune('B'))\n// 3\nfmt.Println(StringsToUpper(\"goLang, hello world\"))\nfmt.Println(StringsToLower(\"GoLang\"))\nfmt.Println(StringsToTitle(\"goLang, hello world\"))\n// 4\nfmt.Println(StringsCount(\"Go\"))\nfmt.Println(StringsCount(\"s\"))\n// 5\nfmt.Println(StringsHasSuffix(\"software\"))\nfmt.Println(StringsHasSuffix(\"software.\"))\nfmt.Println(StringsHasPrefix(\"Java\"))\nfmt.Println(StringsHasPrefix(\"Go\"))\n// 6\nfmt.Println(StringsSplit(\",\"), len(StringsSplit(\",\")))\nfmt.Println(StringsJoin([]string{\"Go\", \"Java\", \"Python\"}))\n// 7\nfmt.Println(StringsIndex(\"o\"))\n// 8\nfmt.Println(StringsTrim(\"   hello world   \"))\n// 9\nfmt.Println(StringsReplacer(\" hello world ,\\n golang\"))\nvar a strings.Builder\na.WriteString(\"ad\")\nfmt.Println(a.String())\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/strings_demo/demo1]\n=== RUN   TestAllFunction\ntrue\nfalse\n1\n-1\n-1 65 66\nGOLANG, HELLO WORLD\ngolang\nGoLang, Hello World\n1\n6\nfalse\ntrue\nfalse\ntrue\n[Go is an open source programming language that makes it easy to build simple  reliable  and efficient software.] 3\nGo Java Python\n1\nhello world\nhelloworld,golang\nad\n--- PASS: TestAllFunction (0.00s)\nPASS\nok      demo1   0.280s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/#4string\u901f\u67e5\u8868","title":"4.string\u901f\u67e5\u8868","text":"<p>import \"strings\"</p> <p>strings\u5305\u5b9e\u73b0\u4e86\u7528\u4e8e\u64cd\u4f5c\u5b57\u7b26\u7684\u7b80\u5355\u51fd\u6570\u3002</p> <pre><code>strings.Index(\"suoning\", \"n\")        //3(\u5b50\u4e32\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de-1)\nstrings.LastIndex(\"suoning\", \"n\")    //5(\u5b50\u4e32\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de-1)\nstrings.Replace(\"suoning\", \"ning\", \"nick\", -1) //suonick(\u66ff\u6362\uff0cn\u4e3a\u66ff\u6362\u6b21\u6570\uff0c&lt;0\u66ff\u6362\u6240\u6709\u5b50\u4e32)\nstrings.HasPrefix(\"suoning\", \"suo\")            //true(\u5224\u65ads\u662f\u5426\u6709\u524d\u7f00\u5b57\u7b26\u4e32prefix)\nstrings.HasSuffix(\"suoning\", \"ning\")           //true(\u5224\u65ads\u662f\u5426\u6709\u540e\u7f00\u5b57\u7b26\u4e32suffix)\nstrings.Contains(\"suoning\", \"suoni\")           //true(\u5224\u65ad\u5b57\u7b26\u4e32s\u662f\u5426\u5305\u542b\u5b50\u4e32substr)\nstrings.Count(\"nnnnnn\", \"n\")         //6(\u5b57\u7b26\u4e32\u4e2d\u6709\u51e0\u4e2a\u4e0d\u91cd\u590d\u7684\u5b50\u4e32)\nstrings.Repeat(\"n\", 6)               //nnnnnn(\u8fd4\u56decount\u4e2as\u4e32\u8054\u7684\u5b57\u7b26\u4e32)\nstrings.ToLower(\"SuoNing\")           //suoning(\u5c06\u6240\u6709\u5b57\u6bcd\u90fd\u8f6c\u4e3a\u5bf9\u5e94\u7684\u5c0f\u5199\u7248\u672c\u7684\u62f7\u8d1d)\nstrings.ToUpper(\"suoning\")           //SUONING(\u5c06\u6240\u6709\u5b57\u6bcd\u90fd\u8f6c\u4e3a\u5bf9\u5e94\u7684\u5927\u5199\u7248\u672c\u7684\u62f7\u8d1d)\nstrings.TrimSpace(\"  \\nsuoning\\n  \") //suoning(\u53bb\u6389\u524d\u540e\u7aef\u6240\u6709\u7a7a\u767d)\nstrings.Trim(\"!!suoning!!\", \"!\")     //suoning(\u5c06s\u524d\u540e\u7aef\u6240\u6709cutset\u5305\u542b\u7684utf-8\u7801\u503c\u90fd\u53bb\u6389\u7684\u5b57\u7b26\u4e32)\nstrings.TrimLeft(\"!suoning!\", \"!\")   //suoning!(\u5c06s\u524d\u7aef\u6240\u6709cutset\u5305\u542b\u7684utf-8\u7801\u503c\u90fd\u53bb\u6389\u7684\u5b57\u7b26\u4e32)\nstrings.TrimRight(\"!suoning!\", \"!\")  //!suoning(\u5c06s\u540e\u7aef\u6240\u6709cutset\u5305\u542b\u7684utf-8\u7801\u503c\u90fd\u53bb\u6389\u7684\u5b57\u7b26\u4e32)\nstrings.Fields(\" suo ning \")                   //[suo ning](\u6309\u7167\u7a7a\u767d\u5206\u5272\u7684\u591a\u4e2a\u5b57\u7b26\u4e32)\nstrings.Split(\",suo,ning,\", \",\")               //[ suo ning ](\u53bb\u6389s\u4e2d\u51fa\u73b0\u7684sep\u7684\u65b9\u5f0f\u8fdb\u884c\u5206\u5272)\nstrings.Join([]string{\"suo\", \"ning\"}, \" \")     //suo ning(\u7528sep\u6765\u62fc\u63a5\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32)\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/#5strings\u5b9e\u8df5","title":"5.strings\u5b9e\u8df5","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"strings\"\n)\nfunc main() {\nvar hustr string\nhustr = \"My name is hujianli go go go\"\nfmt.Println(strings.Index(hustr,\"g\"))       //20\nfmt.Println(strings.LastIndex(hustr,\"g\"))   //26\nfmt.Println(strings.Replace(hustr, \"hujianli\", \"huxioajian\", -1)) //hustr(\u66ff\u6362\uff0cn\u4e3a\u66ff\u6362\u6b21\u6570\uff0c&lt;0\u66ff\u6362\u6240\u6709\u5b50\u4e32)\nfmt.Println(strings.HasPrefix(hustr, \"My\"))            //true(\u5224\u65adhustr\u662f\u5426\u6709\u524d\u7f00\u5b57\u7b26\u4e32\"my\"))\nfmt.Println(strings.HasSuffix(hustr, \"go\"))           //true(\u5224\u65adhustr\u662f\u5426\u6709\u540e\u7f00\u5b57\u7b26\u4e32\"go\")\nfmt.Println(strings.Contains(hustr, \"jianli\"))           //true(\u5224\u65ad\u5b57\u7b26\u4e32hustr\u662f\u5426\u5305\u542b\u5b50\u4e32\"jianli\"))\nfmt.Println(strings.Count(\"nnnnnn\", \"n\"))        //6(\u5b57\u7b26\u4e32\u4e2d\u6709\u51e0\u4e2a\u4e0d\u91cd\u590d\u7684\u5b50\u4e32)\nfmt.Println(strings.Repeat(\"n\", 6))              //nnnnnn(\u8fd4\u56decount\u4e2as\u4e32\u8054\u7684\u5b57\u7b26\u4e32)\nfmt.Println(strings.ToLower(\"SuoNing\"))           //suoning(\u5c06\u6240\u6709\u5b57\u6bcd\u90fd\u8f6c\u4e3a\u5bf9\u5e94\u7684\u5c0f\u5199\u7248\u672c\u7684\u62f7\u8d1d)\nfmt.Println(strings.ToUpper(\"suoning\"))          //SUONING(\u5c06\u6240\u6709\u5b57\u6bcd\u90fd\u8f6c\u4e3a\u5bf9\u5e94\u7684\u5927\u5199\u7248\u672c\u7684\u62f7\u8d1d)\nfmt.Println(strings.TrimSpace(\"  \\nsuoning\\n  \")) //suoning(\u53bb\u6389\u524d\u540e\u7aef\u6240\u6709\u7a7a\u767d)\nfmt.Println(strings.Trim(\"!!suoning!!\", \"!\"))     //suoning(\u5c06s\u524d\u540e\u7aef\u6240\u6709cutset\u5305\u542b\u7684utf-8\u7801\u503c\u90fd\u53bb\u6389\u7684\u5b57\u7b26\u4e32)\nfmt.Println(strings.TrimLeft(\"!suoning!\", \"!\"))   //suoning!(\u5c06s\u524d\u7aef\u6240\u6709cutset\u5305\u542b\u7684utf-8\u7801\u503c\u90fd\u53bb\u6389\u7684\u5b57\u7b26\u4e32)\nfmt.Println(strings.TrimRight(\"!suoning!\", \"!\"))  //!suoning(\u5c06s\u540e\u7aef\u6240\u6709cutset\u5305\u542b\u7684utf-8\u7801\u503c\u90fd\u53bb\u6389\u7684\u5b57\u7b26\u4e32)\nfmt.Println(strings.Fields(\" suo ning \"))                   //[suo ning](\u6309\u7167\u7a7a\u767d\u5206\u5272\u7684\u591a\u4e2a\u5b57\u7b26\u4e32)\nfmt.Println(strings.Split(\",suo,ning,\", \",\"))               //[ suo ning ](\u53bb\u6389s\u4e2d\u51fa\u73b0\u7684sep\u7684\u65b9\u5f0f\u8fdb\u884c\u5206\u5272)\nfmt.Println(strings.Join([]string{\"suo\", \"ning\"}, \" \"))     //suo ning(\u7528sep\u6765\u62fc\u63a5\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32)\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/33.strings/#6\u53c2\u8003\u6587\u732e","title":"6.\u53c2\u8003\u6587\u732e","text":"<p>go\u5305\uff1astrings(\u5b57\u7b26\u4e32\u64cd\u4f5c)</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/","title":"bytes","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"bytes\"\n</code></pre> <p>bytes\u5305\u5b9e\u73b0\u4e86\u64cd\u4f5c[]byte\u7684\u5e38\u7528\u51fd\u6570\u3002\u672c\u5305\u7684\u51fd\u6570\u548cstrings\u5305\u7684\u51fd\u6570\u76f8\u5f53\u7c7b\u4f3c\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"bytes\"\n\"encoding/json\"\n\"fmt\"\n\"io/ioutil\"\n\"net/http\"\n\"strings\"\n)\nfunc ToString(value []byte) string {\nreturn string(value)\n}\nfunc ToBytes(value string) []byte {\nreturn []byte(value)\n}\nfunc HttpByBytes() {\nurl := \"http://httpbin.org/anything?name=xix\"\nvar body map[string]string\nbody = make(map[string]string)\nbody[\"age\"] = \"20\"\nbody[\"school\"] = \"ShangHai\"\nby, _ := json.Marshal(body)\nrequest, _ := http.NewRequest(http.MethodPost, url, bytes.NewBuffer(by))\nclient := http.DefaultClient\nresponse, err := client.Do(request)\nif err != nil {\npanic(err)\n}\ncontent, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(content))\n}\nfunc HttpByByteNewReader() {\nurl := \"http://httpbin.org/anything?name=xix\"\nvar body map[string]string\nbody = make(map[string]string)\nbody[\"age\"] = \"20\"\nbody[\"school\"] = \"ShangHai\"\nby, _ := json.Marshal(body)\nrequest, _ := http.NewRequest(http.MethodPost, url, bytes.NewReader(by))\nclient := http.DefaultClient\nresponse, err := client.Do(request)\nif err != nil {\npanic(err)\n}\ncontent, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(content))\n}\nfunc HttpByStrings() {\nurl := \"http://httpbin.org/anything?name=xix\"\nrequest, _ := http.NewRequest(http.MethodPost, url, strings.NewReader(`{\"name\":\"XieWei\", \"school\":\"ShangHai\"}`))\nclient := http.DefaultClient\nresponse, err := client.Do(request)\nif err != nil {\npanic(err)\n}\ncontent, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(content))\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"testing\"\n)\nfunc TestConvert(tests *testing.T) {\nvar A []byte\nA = []byte(\"a b\")\nvar B string\nB = \"a b\"\nfmt.Println(fmt.Sprintf(\"%T,%T\", A, B))\nfmt.Println(fmt.Sprintf(\"%T,%T\", ToString(A), ToBytes(B)))\nfmt.Println(\"1\")\nHttpByBytes()\nfmt.Println(\"2\")\nHttpByByteNewReader()\nfmt.Println(\"3\")\nHttpByStrings()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/34.bytes/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/bytes_demo/demo1]\n=== RUN   TestConvert\n[]uint8,string\nstring,[]uint8\n1\n{\n\"args\": {\n\"name\": \"xix\"\n}, \"data\": \"{\\\"age\\\":\\\"20\\\",\\\"school\\\":\\\"ShangHai\\\"}\", \"files\": {}, \"form\": {}, \"headers\": {\n\"Accept-Encoding\": \"gzip\", \"Content-Length\": \"32\", \"Host\": \"httpbin.org\", \"User-Agent\": \"Go-http-client/1.1\", \"X-Amzn-Trace-Id\": \"Root=1-64bf73e3-1fae03330c1a8bee69c5971a\"\n}, \"json\": {\n\"age\": \"20\", \"school\": \"ShangHai\"\n}, \"method\": \"POST\", \"origin\": \"14.155.159.114\", \"url\": \"http://httpbin.org/anything?name=xix\"\n}\n2\n{\n\"args\": {\n\"name\": \"xix\"\n}, \"data\": \"{\\\"age\\\":\\\"20\\\",\\\"school\\\":\\\"ShangHai\\\"}\", \"files\": {}, \"form\": {}, \"headers\": {\n\"Accept-Encoding\": \"gzip\", \"Content-Length\": \"32\", \"Host\": \"httpbin.org\", \"User-Agent\": \"Go-http-client/1.1\", \"X-Amzn-Trace-Id\": \"Root=1-64bf73e6-48aa7ea81fc26d8f4453d148\"\n}, \"json\": {\n\"age\": \"20\", \"school\": \"ShangHai\"\n}, \"method\": \"POST\", \"origin\": \"14.155.159.114\", \"url\": \"http://httpbin.org/anything?name=xix\"\n}\n3\n{\n\"args\": {\n\"name\": \"xix\"\n}, \"data\": \"{\\\"name\\\":\\\"XieWei\\\", \\\"school\\\":\\\"ShangHai\\\"}\", \"files\": {}, \"form\": {}, \"headers\": {\n\"Accept-Encoding\": \"gzip\", \"Content-Length\": \"38\", \"Host\": \"httpbin.org\", \"User-Agent\": \"Go-http-client/1.1\", \"X-Amzn-Trace-Id\": \"Root=1-64bf73e9-768cbadb67fdc1375fd3aabd\"\n}, \"json\": {\n\"name\": \"XieWei\", \"school\": \"ShangHai\"\n}, \"method\": \"POST\", \"origin\": \"14.155.159.114\", \"url\": \"http://httpbin.org/anything?name=xix\"\n}\n--- PASS: TestConvert (64.99s)\nPASS\nok      demo1   65.248s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/","title":"json","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"encoding/json\"\n</code></pre> <p>json\u5305\u5b9e\u73b0\u4e86json\u5bf9\u8c61\u7684\u7f16\u89e3\u7801\uff0c\u53c2\u89c1RFC 4627\u3002Json\u5bf9\u8c61\u548cgo\u7c7b\u578b\u7684\u6620\u5c04\u5173\u7cfb\u8bf7\u53c2\u89c1Marshal\u548cUnmarshal\u51fd\u6570\u7684\u6587\u6863\u3002</p> <p>\u53c2\u89c1\"JSON and Go\"\u83b7\u53d6\u672c\u5305\u7684\u4e00\u4e2a\u4ecb\u7ecd\uff1ahttp://golang.org/doc/articles/json_and_go.html</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"encoding/json\"\n\"fmt\"\n)\ntype JsonExample struct {\nName   string `json:\"name,omitempty\"`\nAge    int    `json:\"age\"`\nSchool string `json:\"university\"`\n}\nfunc JsonMarshal() {\nvar jex JsonExample\njex = JsonExample{\nName:   \"Go\",\nAge:    10,\nSchool: \"Google\",\n}\nby, _ := json.Marshal(jex)\nfmt.Println(string(by))\n}\nfunc JsonUnmarshal() {\nvar v JsonExample\nby := []byte(`{\"name\":\"Go\",\"age\":10, \"university\":\"google\"}`)\njson.Unmarshal(by, &amp;v)\nfmt.Println(v)\nvar vother JsonExample\nbyOther := []byte(`{\"name\":\"\",\"age\":10, \"school\":\"google\"}`)\njson.Unmarshal(byOther, &amp;vother)\nfmt.Println(vother)\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<pre><code>package demo1\nimport \"testing\"\nfunc TestJsonExample(tests *testing.T) {\nJsonMarshal()\nJsonUnmarshal()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/35.json/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/json_demo/demo1]\n=== RUN   TestJsonExample\n{\"name\":\"Go\",\"age\":10,\"university\":\"Google\"}\n{Go 10 google}\n{ 10 }\n--- PASS: TestJsonExample (0.00s)\nPASS\nok      demo1   0.332s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/","title":"io/bufio","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"io\"\n</code></pre> <p>io\u5305\u63d0\u4f9b\u4e86\u5bf9I/O\u539f\u8bed\u7684\u57fa\u672c\u63a5\u53e3\u3002</p> <pre><code>import \"bufio\"\n</code></pre> <p>bufio\u5305\u5b9e\u73b0\u4e86\u6709\u7f13\u51b2\u7684I/O\u3002\u5b83\u5305\u88c5\u4e00\u4e2aio.Reader\u6216io.Writer\u63a5\u53e3\u5bf9\u8c61\uff0c\u521b\u5efa\u53e6\u4e00\u4e2a\u4e5f\u5b9e\u73b0\u4e86\u8be5\u63a5\u53e3\uff0c\u4e14\u540c\u65f6\u8fd8\u63d0\u4f9b\u4e86\u7f13\u51b2\u548c\u4e00\u4e9b\u6587\u672cI/O\u7684\u5e2e\u52a9\u51fd\u6570\u7684\u5bf9\u8c61\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"bufio\"\n\"fmt\"\n\"io\"\n\"io/ioutil\"\n\"net/http\"\n\"os\"\n\"strings\"\n)\nfunc IoUsage() {\nurl := \"http://httpbin.org/anything?name=xix\"\nrequest, _ := http.NewRequest(http.MethodPost, url, strings.NewReader(`{\"name\":\"XieXie\"}`))\nclient := http.DefaultClient\nresponse, err := client.Do(request)\nif err != nil {\nreturn\n}\ndefer response.Body.Close()\nby, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(by))\n}\nfunc ReadFile() {\nf, err := os.Open(\"./README.txt\")\nif err != nil {\npanic(err)\n}\ndefer f.Close()\nrd := bufio.NewReader(f)\nfor {\nline, err := rd.ReadString('\\n')\nif err != nil || io.EOF == err {\nbreak\n}\nfmt.Println(line)\n}\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestIo(tests *testing.T) {\nIoUsage()\nReadFile()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/36.io-bufio/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/io_bufio_demo/demo1]\n=== RUN   TestIo\n&lt;html&gt;\n&lt;head&gt;&lt;title&gt;504 Gateway Time-out&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;\n&lt;center&gt;&lt;h1&gt;504 Gateway Time-out&lt;/h1&gt;&lt;/center&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n\u6d4b\u8bd5\u4ee3\u78011\n\nhttp://httpbin.org/anything1\n\n--- PASS: TestIo (10.58s)\nPASS\nok      demo1   10.910s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/","title":"fmt","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"fmt\"\n</code></pre> <p>fmt\u5305\u5b9e\u73b0\u4e86\u7c7b\u4f3cC\u8bed\u8a00printf\u548cscanf\u7684\u683c\u5f0f\u5316I/O\u3002\u683c\u5f0f\u5316\u52a8\u4f5c\uff08'verb'\uff09\u6e90\u81eaC\u8bed\u8a00\u4f46\u66f4\u7b80\u5355\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n)\nfunc FmtUsage() {\nvar number = 100.203\nvar numberInt = 100\nfmt.Printf(\"%d\\n\", numberInt) //100\nfmt.Printf(\"%o\\n\", numberInt) //144\nfmt.Printf(\"%x\\n\", numberInt) //64\nfmt.Printf(\"%X\\n\", numberInt) //64\nfmt.Printf(\"%b\\n\", numberInt) //1100100\nfmt.Printf(\"%f\\n\", number)    //100.203000\nfmt.Printf(\"%e\\n\", number)    //1.002030e+02\nfmt.Printf(\"%E\\n\", number)    //1.002030E+02\n}\nfunc FmtStringUsage() {\nvar values = \"golang\"\nfmt.Printf(\"%s\\n\", values) //golang\nfmt.Printf(\"%q\\n\", values) //\"golang\"\n}\nfunc FmtBoolUsage() {\nvar ok = true\nfmt.Printf(\"%t\\n\", ok) //true\n}\nfunc FmtOtherUsage() {\nvar a = 1\nvar b = 2.0\nvar ok = true\nnumber := &amp;a\nvar s = struct {\nName string `json:\"name\"`\n}{\nName: \"Go\",\n}\nfmt.Printf(\"%T\\n\", a)              //int\nfmt.Printf(\"%T\\n\", b)              //float64\nfmt.Printf(\"%T\\n\", ok)             //bool\nfmt.Printf(\"%p\\n%d\\n\", &amp;a, number) //0xc00011a190   //824634876304\nfmt.Printf(\"%v\\n\", s)              //{Go}\nfmt.Printf(\"%#v\\n\", s)             //struct { Name string \"json:\\\"name\\\"\" }{Name:\"Go\"}\n}\ntype Val struct {\nName string `json:\"name\"`\nAge  int    `json:\"age\"`\n}\nfunc (v Val) String() string {\nreturn fmt.Sprintf(\"%s + %d\", v.Name, v.Age) //go + 20\n}\nfunc (v Val) GoString() string {\nreturn fmt.Sprintf(\"%s + %d\", v.Name, v.Age) //go + 20\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"testing\"\n)\nfunc TestFmtUsage(tests *testing.T) {\nFmtUsage()\nFmtStringUsage()\nFmtBoolUsage()\nFmtOtherUsage()\nvar a = Val{\nName: \"go\",\nAge:  20,\n}\nfmt.Println(a)\nfmt.Printf(\"%#v\\n\", a)\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/fmt_demo/demo1]\n=== RUN   TestFmtUsage\n100\n144\n64\n64\n1100100\n100.203000\n1.002030e+02\n1.002030E+02\ngolang\n\"golang\"\ntrue\nint\nfloat64\nbool\n0xc00000e200\n824633778688\n{Go}\nstruct { Name string \"json:\\\"name\\\"\" }{Name:\"Go\"}\ngo + 20\ngo + 20\n--- PASS: TestFmtUsage (0.00s)\nPASS\nok      demo1   0.294s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/#4\u53c2\u8003\u6587\u732e","title":"4.\u53c2\u8003\u6587\u732e","text":"<p>go\u5305\uff1afmt(\u683c\u5f0f\u5316\u8f93\u51fa)</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/37.fmt/#5\u683c\u5f0f\u5316verb\u5e94\u7528","title":"5.\u683c\u5f0f\u5316verb\u5e94\u7528","text":"<p>\u4ee3\u7801\u793a\u4f8b <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n)\ntype User struct {\nname string\nage  int\n}\nvar valF float64 = 32.9983\nvar valI int = 89\nvar valS string = \"Go is an open source programmig language that makes it\"\nvar valB bool = true\nfunc main() {\np := User{\nname: \"John\",\nage:  18,\n}\nfmt.Printf(\"Printf struct %%v: %v\\n\", p)\nfmt.Printf(\"Printf struct %%+v: %+v\\n\", p)\nfmt.Printf(\"Printf struct %%#v: %#v\\n\", p)\nfmt.Printf(\"Printf struct %%T: %T\\n\", p)\nfmt.Printf(\"Printf struct %%p: %p\\n\", p)\nfmt.Println(\"-------------------------------------------------------\")\nfmt.Printf(\"Printf float64 %%v: %v\\n\", valF)\nfmt.Printf(\"Printf float64 %%+v: %+v\\n\", valF)\nfmt.Printf(\"Printf float64 %%#v: %#v\\n\", valF)\nfmt.Printf(\"Printf float64 %%T: %T\\n\", valF)\nfmt.Printf(\"Printf float64 %%f: %f\\n\", valF)\nfmt.Printf(\"Printf float64 %%4.3f: %4.3f\\n\", valF)\nfmt.Printf(\"Printf float64 %%8.3f: %8.3f\\n\", valF)\nfmt.Printf(\"Printf float64 %%-8.3f: %-8.3f\\n\", valF)\nfmt.Printf(\"Printf float64 %%e: %e\\n\", valF)\nfmt.Printf(\"Printf float64 %%E: %E\\n\", valF)\nfmt.Println(\"-------------------------------------------------------\")\nfmt.Printf(\"Printf int %%v: %v\\n\", valI)\nfmt.Printf(\"Printf int %%+v: %+v\\n\", valI)\nfmt.Printf(\"Printf int %%#v: %#v\\n\", valI)\nfmt.Printf(\"Printf int %%T: %T\\n\", valI)\nfmt.Printf(\"Printf int %%d: %d\\n\", valI)\nfmt.Printf(\"Printf int %%8d: %8d\\n\", valI)\nfmt.Printf(\"Printf int %%-8d: %-8d\\n\", valI)\nfmt.Printf(\"Printf int %%b: %b\\n\", valI)\nfmt.Printf(\"Printf int %%c: %c\\n\", valI)\nfmt.Printf(\"Printf int %%o: %o\\n\", valI)\nfmt.Printf(\"Printf int %%U: %U\\n\", valI)\nfmt.Printf(\"Printf int %%q: %q\\n\", valI)\nfmt.Printf(\"Printf int %%x: %x\\n\", valI)\nfmt.Println(\"-------------------------------------------------------\")\nfmt.Printf(\"Printf string %%v:%v\\n\", valS)\nfmt.Printf(\"Printf string %%+v:%+v\\n\", valS)\nfmt.Printf(\"Printf string %%#v:%#v\\n\", valS)\nfmt.Printf(\"Printf string %%T:%T\\n\", valS)\nfmt.Printf(\"Printf string %%X:%X\\n\", valS)\nfmt.Printf(\"Printf string %%200s:%200s\\n\", valS)\nfmt.Printf(\"Printf string %%-200s:%-200s\\n\", valS)\nfmt.Printf(\"Printf string %%q:%q\\n\", valS)\nfmt.Println(\"-------------------------------------------------------\")\nfmt.Printf(\"Printf bool %%v: %v\\n\", valB)\nfmt.Printf(\"Printf bool %%+v: %+v\\n\", valB)\nfmt.Printf(\"Printf bool %%#v: %#v\\n\", valB)\nfmt.Printf(\"Printf bool %%T: %T\\n\", valB)\nfmt.Printf(\"Printf bool %%t: %t\\n\", valB)\nfmt.Println(\"-------------------------------------------------------\")\ns := fmt.Sprintf(\"a %s\", \"string\")\nfmt.Println(s)\nfmt.Fprintf(os.Stderr,\"an %s\\n\",\"error\")\n}\n</code></pre></p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/","title":"strconv","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"strconv\"\n</code></pre> <p>strconv\u5305\u5b9e\u73b0\u4e86\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548c\u5176\u5b57\u7b26\u4e32\u8868\u793a\u7684\u76f8\u4e92\u8f6c\u6362\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"strconv\"\n)\nfunc ToBool() {\nvar a bool\na = true\nb := strconv.FormatBool(a)\nfmt.Println(b) //true\nc, _ := strconv.ParseBool(\"false\")\nfmt.Println(c) //false\n}\nfunc ToNumber() {\nvar (\na int\nb uint64\nc float64\n)\na = 1\nb = 2\nc = 3.14\nfmt.Println(strconv.Itoa(a))                    //1\nfmt.Println(strconv.FormatUint(b, 10))          //2\nfmt.Println(strconv.FormatFloat(c, 'f', 1, 32)) //3.1\nd := \"4.178\"\nfloatD, _ := strconv.ParseFloat(d, 64)\nfmt.Println(floatD) //4.178\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/#2\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b","title":"2.\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestStrconv(test *testing.T) {\nToBool()\nToNumber()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/strconv_demo/demo1]\n=== RUN   TestStrconv\ntrue\nfalse\n1\n2\n3.1\n4.178\n--- PASS: TestStrconv (0.00s)\nPASS\nok      demo1   0.490s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/38.strconv/#4\u53c2\u8003\u6587\u732e","title":"4.\u53c2\u8003\u6587\u732e","text":"<p>go\u5305\uff1astrconv(\u5b57\u7b26\u4e32\u8f6c\u6362)</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/","title":"regexp","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"regexp\"\n</code></pre> <p>regexp\u5305\u5b9e\u73b0\u4e86\u6b63\u5219\u8868\u8fbe\u5f0f\u641c\u7d22\u3002</p> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u91c7\u7528RE2\u8bed\u6cd5\uff08\u9664\u4e86\\c\u3001\\C\uff09\uff0c\u548cPerl\u3001Python\u7b49\u8bed\u8a00\u7684\u6b63\u5219\u57fa\u672c\u4e00\u81f4\u3002</p> <p>\u53c2\u89c1http://code.google.com/p/re2/wiki/Syntax\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"regexp\"\n)\nfunc SimpleUsage() {\nSlogan := \"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.\"\nreg, _ := regexp.Compile(\"open source programming language\")\nif reg.Match([]byte(Slogan)) {\nfmt.Println(\"byte: Match\") //byte: Match\n}\nif reg.MatchString(Slogan) {\nfmt.Println(\"string: Match\") //string: Match\n}\n}\nfunc SearchUsage() {\nSlogan := \"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.\"\nreg, _ := regexp.Compile(\"open source programming language\")\nv := reg.Find([]byte(Slogan))\nfmt.Println(string(v)) //open source programming language\nv2 := reg.FindString(Slogan)\nfmt.Println(v2) //open source programming language\n}\nfunc ReplaceUsage() {\nSlogan := \"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.\"\nreg, _ := regexp.Compile(`^Go`)\nresult := reg.ReplaceAllString(Slogan, \"Python\")\nfmt.Println(result) //Python is an open source programming language that makes it easy to build simple, reliable, and efficient software.\n}\nfunc SplitUsage() {\nSlogan := \"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.\"\nreg, _ := regexp.Compile(`\\s|\\,|\\.`) // \u6309\" \"\u3001\",\"\u3001\".\" \u5206\u5272\nresult := reg.Split(Slogan, -1)\nfmt.Println(result) //[Go is an open source programming language that makes it easy to build simple  reliable  and efficient software ]\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestRegexpUsage(test *testing.T) {\nSimpleUsage()\nSearchUsage()\nReplaceUsage()\nSplitUsage()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/39.regexp/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/regexp_demo/demo1]\n=== RUN   TestRegexpUsage\nbyte: Match\nstring: Match\nopen source programming language\nopen source programming language\nPython is an open source programming language that makes it easy to build simple, reliable, and efficient software.\n[Go is an open source programming language that makes it easy to build simple  reliable  and efficient software ]\n--- PASS: TestRegexpUsage (0.00s)\nPASS\nok      demo1   0.483s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/","title":"log","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"log\"\n</code></pre> <p>log\u5305\u5b9e\u73b0\u4e86\u7b80\u5355\u7684\u65e5\u5fd7\u670d\u52a1\u3002</p> <p>\u672c\u5305\u5b9a\u4e49\u4e86Logger\u7c7b\u578b\uff0c\u8be5\u7c7b\u578b\u63d0\u4f9b\u4e86\u4e00\u4e9b\u683c\u5f0f\u5316\u8f93\u51fa\u7684\u65b9\u6cd5\u3002</p> <p>\u672c\u5305\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9884\u5b9a\u4e49\u7684\"\u6807\u51c6\"Logger\uff0c\u53ef\u4ee5\u901a\u8fc7\u8f85\u52a9\u51fd\u6570Print[f|ln]\u3001Fatal[f|ln]\u548cPanic[f|ln]\u8bbf\u95ee\uff0c\u6bd4\u624b\u5de5\u521b\u5efa\u4e00\u4e2aLogger\u5bf9\u8c61\u66f4\u5bb9\u6613\u4f7f\u7528\u3002</p> <p>Logger\u4f1a\u6253\u5370\u6bcf\u6761\u65e5\u5fd7\u4fe1\u606f\u7684\u65e5\u671f\u3001\u65f6\u95f4\uff0c\u9ed8\u8ba4\u8f93\u51fa\u5230\u6807\u51c6\u9519\u8bef\u3002</p> <p>Fatal\u7cfb\u5217\u51fd\u6570\u4f1a\u5728\u5199\u5165\u65e5\u5fd7\u4fe1\u606f\u540e\u8c03\u7528os.Exit(1)\u3002</p> <p>Panic\u7cfb\u5217\u51fd\u6570\u4f1a\u5728\u5199\u5165\u65e5\u5fd7\u4fe1\u606f\u540epanic\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"bytes\"\n\"fmt\"\n\"log\"\n\"os\"\n)\nfunc DefaultUsageForLog() {\nlog.Print(\"Hello World, Golang\")        //2023/07/25 16:46:13 Hello World, Golang\nlog.Println(\"Hello World, Golang\")      //2023/07/25 16:46:13 Hello World, Golang\nlog.Printf(\"Hello World, %s\", \"Golang\") //2023/07/25 16:46:13 Hello World, Golang\nfmt.Println(\"log Prefix\", log.Prefix()) //log Prefix\nfmt.Println(\"log Flags\", log.Flags())   //log Flags 3\n}\nfunc SpecialUsageLog() {\n// \u5b9e\u4f8b\u5316 log.Logger \u7ed3\u6784\u4f53\nlogger := log.New(os.Stdout, \"Golang \", log.Lshortfile)\n//\nlogger.Println(\"Hello World, Golang\") //Golang demo1.go:25: Hello World, Golang\n}\nfunc SpecialUsageWithBytes() {\n// \u65e5\u5fd7\u8f93\u51fa\u5199\u5165\u4e00\u4e2aio.Writer\u63a5\u53e3\nvar buf bytes.Buffer\nlogger := log.New(&amp;buf, \"Hi! \", log.Lshortfile)\nlogger.Println(\"Hello World, Golang\")\nfmt.Println(buf.String()) //Hi! demo1.go:33: Hello World, Golang\n}\nfunc SpecialUsageWithFile() {\n// \u65e5\u5fd7\u5199\u5165\u6587\u4ef6\nfile, _ := os.Create(\"log.log\")\nlogger := log.New(file, \"Hi!\", log.Lshortfile)\nlogger.Println(\"Hello World, Golang\")\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestSimpleUsageForLog(t *testing.T) {\nDefaultUsageForLog()\nSpecialUsageLog()\nSpecialUsageWithBytes()\nSpecialUsageWithFile()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/log_demo/demo1]\n=== RUN   TestSimpleUsageForLog\n2023/07/25 16:51:41 Hello World, Golang\n2023/07/25 16:51:41 Hello World, Golang\n2023/07/25 16:51:41 Hello World, Golang\nlog Prefix log Flags 3\nGolang demo1.go:25: Hello World, Golang\nHi! demo1.go:33: Hello World, Golang\n\n--- PASS: TestSimpleUsageForLog (0.02s)\nPASS\nok      demo1   0.483s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/#4log\u7b80\u6613\u5c01\u88c5","title":"4.log\u7b80\u6613\u5c01\u88c5","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"log\"\n\"mime/multipart\"\n\"os\"\n\"path\"\n)\n// Level These are the integer logging levels used by the logger\ntype Level int\n// Comment\nconst (\nDEBUG Level = iota\nINFO\nWARNING\nERROR\nFATAL\n)\nvar (\nlogPrefix  = \"\"\nlevelFlags = []string{\"DEBG\", \"INFO\", \"WARN\", \"ERRO\", \"FATL\"}\nlogger  *log.Logger\nloggerf *log.Logger\n// curLevel ...\ncurLevel Level\n//\nlogfile *os.File\n)\nfunc init() {\ncurLevel = DEBUG\nlogger = log.New(os.Stdout, \"[default] \", log.LstdFlags)\nlogger.SetFlags(log.Ldate | log.Lmicroseconds | log.Llongfile)\n}\n// Println ..\nfunc Println(l *log.Logger, v ...interface{}) {\nif l != nil {\nl.Output(3, fmt.Sprintln(v...))\n}\n}\n// Fatalln is equivalent to l.Println() followed by a call to os.Exit(1).\nfunc Fatalln(l *log.Logger, v ...interface{}) {\nif l != nil {\nl.Output(3, fmt.Sprintln(v...))\nos.Exit(1)\n}\n}\n// Debug ...\nfunc Debug(v ...interface{}) {\nsetPrefix(DEBUG)\nif DEBUG &gt;= curLevel {\nPrintln(logger, v)\nPrintln(loggerf, v)\n}\n}\n// Info ...\nfunc Info(v ...interface{}) {\nsetPrefix(INFO)\nif INFO &gt;= curLevel {\nPrintln(logger, v)\nPrintln(loggerf, v)\n}\n}\n// Warn ...\nfunc Warn(v ...interface{}) {\nsetPrefix(WARNING)\nif WARNING &gt;= curLevel {\nPrintln(logger, v)\nPrintln(loggerf, v)\n}\n}\n// Error Warn\nfunc Error(v ...interface{}) {\nsetPrefix(ERROR)\nif ERROR &gt;= curLevel {\nPrintln(logger, v)\nPrintln(loggerf, v)\n}\n}\n// Fatal ...\nfunc Fatal(v ...interface{}) {\nsetPrefix(FATAL)\nif FATAL &gt;= curLevel {\nFatalln(logger, v)\nFatalln(loggerf, v)\n}\n}\nfunc setPrefix(level Level) {\nlogPrefix = fmt.Sprintf(\"[%s] \", levelFlags[level])\nlogger.SetPrefix(logPrefix)\nif loggerf != nil {\nloggerf.SetPrefix(logPrefix)\n}\n}\n// Config ..\nfunc Config(level Level, lfile *os.File) {\ncurLevel = level\nloggerf = log.New(lfile, \"[default] \", log.LstdFlags)\nloggerf.SetFlags(log.Ldate | log.Lmicroseconds | log.Llongfile)\n}\n// \u8981\u652f\u6301\u6587\u4ef6\uff0c\u5219\u518d\u52a0\u4e0a\u4ee5\u4e0b\u51e0\u4e2a\u64cd\u4f5c\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u51fd\u6570\uff1a\nfunc GetSize(f multipart.File) (int, error) {\ncontent, err := ioutil.ReadAll(f)\nreturn len(content), err\n}\nfunc GetExt(fileName string) string {\nreturn path.Ext(fileName)\n}\nfunc CheckNotExist(src string) bool {\n_, err := os.Stat(src)\nreturn os.IsNotExist(err)\n}\nfunc CheckPermission(src string) bool {\n_, err := os.Stat(src)\nreturn os.IsPermission(err)\n}\nfunc IsNotExistMkDir(src string) error {\nif notExist := CheckNotExist(src); notExist == true {\nif err := MkDir(src); err != nil {\nreturn err\n}\n}\nreturn nil\n}\nfunc MkDir(src string) error {\nerr := os.MkdirAll(src, os.ModePerm)\nif err != nil {\nreturn err\n}\nreturn nil\n}\nfunc Open(name string, flag int, perm os.FileMode) (*os.File, error) {\nf, err := os.OpenFile(name, flag, perm)\nif err != nil {\nreturn nil, err\n}\nreturn f, nil\n}\nfunc MustOpen(fileName, filePath string) (*os.File, error) {\ndir, err := os.Getwd()\nif err != nil {\nreturn nil, fmt.Errorf(\"os.Getwd err: %v\", err)\n}\nsrc := dir + \"/\" + filePath\nperm := CheckPermission(src)\nif perm == true {\nreturn nil, fmt.Errorf(\"file.CheckPermission Permission denied src: %s\", src)\n}\nerr = IsNotExistMkDir(src)\nif err != nil {\nreturn nil, fmt.Errorf(\"file.IsNotExistMkDir src: %s, err: %v\", src, err)\n}\nf, err := Open(src+fileName, os.O_APPEND|os.O_CREATE|os.O_RDWR, 0644)\nif err != nil {\nreturn nil, fmt.Errorf(\"Fail to OpenFile :%v\", err)\n}\nreturn f, nil\n}\nfunc main() {\nlgfile, err := MustOpen(\"log.txt\", \"mylog1/\")\nif err != nil {\nError(\"Failed to open log file:\" + err.Error())\n}\nConfig(DEBUG, lgfile)\nDebug(\"message\")\nInfo(\"message\")\nWarn(\"message\")\nError(\"message\")\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/40.log/#5\u5176\u4ed6log\u76f8\u5173\u7684\u4e09\u65b9\u5e93","title":"5.\u5176\u4ed6log\u76f8\u5173\u7684\u4e09\u65b9\u5e93","text":"<ul> <li>logrus \u4f7f\u7528\u975e\u5e38\u5e7f\u6cdb\u7684\u5f00\u6e90\u65e5\u5fd7\u5e93\u3002 Go\u7684\u7ed3\u6784\u5316\u8bb0\u5f55\u5668</li> </ul> <p>\u53c2\u8003\u6587\u732e\uff1ahttps://darjun.github.io/2020/02/07/godailylib/logrus/</p> <ul> <li>zap - Go\u4e2d\u5feb\u901f\uff0c\u7ed3\u6784\u5316\uff0c\u5206\u7ea7\u7684\u65e5\u5fd7\u8bb0\u5f55\u3002</li> </ul> <p>\u5176\u4ed6\uff1a</p> <p>https://www.topgoer.cn/docs/gokaiyuancangku/gokaiyuanLogging</p> <p>\u65e5\u5fd7\u7684\u6709\u6548\u4f7f\u7528\u80fd\u591f\u8ba9\u6211\u4eec\u5728\u9047\u5230\u95ee\u9898\u65f6\u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\uff0c\u5426\u5219\u67e5\u627e\u95ee\u9898\u7684\u6548\u7387\u5c06\u5927\u6253\u6298\u6263\u3002 \u65e5\u5fd7\u7684\u4f7f\u7528\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u4e09\u70b9\uff1a</p> <p>\uff081\uff09\u6b63\u786e\u4f7f\u7528\u65e5\u5fd7\u7684\u7ea7\u522b\uff0c\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u8f93\u51fa\u7ea7\u522b\uff0c\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u62a5\u9519\u7ea7\u522b\uff0c\u7b49\u7b49\u3002</p> <p>\uff082\uff09\u9ed8\u8ba4\u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u5b9e\u8d28\u4e0a\u9ed8\u8ba4\u521d\u59cb\u5316\u4e86log.Logger\u7ed3\u6784\u4f53\u3002</p> <p>\uff083\uff09\u5b9a\u5236\u5316\u65e5\u5fd7\u683c\u5f0f\uff0c\u9700\u8981\u5b9e\u4f8b\u5316log.Logger\u7ed3\u6784\u4f53\uff0c\u518d\u8c03\u7528\u76f8\u5e94\u7684\u65b9\u6cd5\u3002</p>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/","title":"reflect/unsafe","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"reflect\"\n</code></pre> <p>reflect\u5305\u5b9e\u73b0\u4e86\u8fd0\u884c\u65f6\u53cd\u5c04\uff0c\u5141\u8bb8\u7a0b\u5e8f\u64cd\u4f5c\u4efb\u610f\u7c7b\u578b\u7684\u5bf9\u8c61\u3002</p> <p>\u5178\u578b\u7528\u6cd5\u662f\u7528\u9759\u6001\u7c7b\u578binterface{}\u4fdd\u5b58\u4e00\u4e2a\u503c\uff0c\u901a\u8fc7\u8c03\u7528TypeOf\u83b7\u53d6\u5176\u52a8\u6001\u7c7b\u578b\u4fe1\u606f\uff0c\u8be5\u51fd\u6570\u8fd4\u56de\u4e00\u4e2aType\u7c7b\u578b\u503c\u3002</p> <p>\u8c03\u7528ValueOf\u51fd\u6570\u8fd4\u56de\u4e00\u4e2aValue\u7c7b\u578b\u503c\uff0c\u8be5\u503c\u4ee3\u8868\u8fd0\u884c\u65f6\u7684\u6570\u636e\u3002</p> <p>Zero\u63a5\u53d7\u4e00\u4e2aType\u7c7b\u578b\u53c2\u6570\u5e76\u8fd4\u56de\u4e00\u4e2a\u4ee3\u8868\u8be5\u7c7b\u578b\u96f6\u503c\u7684Value\u7c7b\u578b\u503c\u3002</p> <p>\u53c2\u89c1\"The Laws of Reflection\"\u83b7\u53d6go\u53cd\u5c04\u7684\u4ecb\u7ecd\uff1ahttp://golang.org/doc/articles/laws_of_reflection.html</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"bytes\"\n\"fmt\"\n\"reflect\"\n\"unsafe\"\n)\ntype ReflectUsage struct {\nName string `json:\"name\"`\nAge  int    `json:\"age\"`\n}\nfunc (ref ReflectUsage) String() string {\nreturn fmt.Sprintf(\"Name: %s, Age: %d\", ref.Name, ref.Age)\n}\nfunc (ref *ReflectUsage) AddAge(add int) int {\nref.Age += add\nreturn ref.Age\n}\nfunc (ref ReflectUsage) MarshalJSON() ([]byte, error) {\nvar buf bytes.Buffer\nbuf.WriteString(fmt.Sprintf(\"Name: %s\", ref.Name))\nreturn buf.Bytes(), nil\n}\nfunc Usage() {\nvar example ReflectUsage\nexample.Name = \"XieWei\"\nexample.Age = 20\n// \u83b7\u53d6\u7c7b\u578b\u7684\u4e24\u79cd\u65b9\u6cd5\ntyp := reflect.TypeOf(example)\nfmt.Printf(\"%T\\n\", example) //demo1.ReflectUsage\nfmt.Println(typ)            //demo1.ReflectUsage\n// \u83b7\u53d6\u503c\u7684\u4e24\u79cd\u65b9\u6cd5\nval := reflect.ValueOf(example)\nfmt.Printf(\"%#v\\n\", example) //demo1.ReflectUsage{Name:\"XieWei\", Age:20}\nfmt.Printf(\"%v\\n\", example)  //Name: XieWei, Age: 20\nfmt.Println(val)             //Name: XieWei, Age: 20\n// \u7ed3\u6784\u4f53\u5305\u542b\uff1a\u5b57\u6bb5(\u6807\u7b7e\u3001\u503c\uff09\u3001\u65b9\u6cd5\nfmt.Println(typ.NumField(), typ.NumMethod()) //2 2\nfmt.Println(val.NumField(), val.NumMethod()) //2 2\n// \u901a\u8fc7 type \u83b7\u53d6\u6807\u7b7e\u5c5e\u6027\nfmt.Println(typ.FieldByName(\"Name\")) //{Name  string json:\"name\" 0 [0] false} true\nfmt.Println(typ.FieldByName(\"Age\"))  //{Age  int json:\"age\" 16 [1] false} true\n// \u901a\u8fc7 value \u83b7\u53d6\u6807\u7b7e\u503c\nfmt.Println(val.FieldByName(\"Name\")) //XieWei\nfmt.Println(val.FieldByName(\"Age\"))  //20\n// \u51fd\u6570\u7684\u4e2a\u6570\u662f\u6839\u636e\u4f20\u503c\u7684\u624d\u8ba1\u6570\uff0c\u51fd\u6570\u7684\u6392\u5e8f\u6839\u636e\u51fd\u6570\u540d\u79f0\u7684\u5b57\u6bcd\uff0c\u51fd\u6570\u53ef\u4ee5\u8c03\u7528\nfmt.Println(typ.NumMethod(), typ.Method(0)) //2 {MarshalJSON  func(demo1.ReflectUsage) ([]uint8, error) &lt;func(demo1.ReflectUsage) ([]uint8, error) Value&gt; 0}\nfmt.Println(typ.NumMethod(), typ.Method(1)) //2 {String  func(demo1.ReflectUsage) string &lt;func(demo1.ReflectUsage) string Value&gt; 1}\nmethodOne := val.Method(1)\nargs := make([]reflect.Value, 0)\nresult := methodOne.Call(args)\nfmt.Println(result) //[Name: XieWei, Age: 20]\nmethodTwo := val.MethodByName(\"MarshalJSON\")\nargsTwo := make([]reflect.Value, 0)\nresultTwo := methodTwo.Call(argsTwo)\nfmt.Println(string(resultTwo[0].Bytes())) //Name: XieWei\n// \u53ef\u4ee5\u91cd\u65b0\u5bf9\u7ed3\u6784\u4f53\u8d4b\u503c\u64cd\u4f5c\uff0c\u524d\u63d0\u662f\u83b7\u5f97\u6307\u9488\nvalCanSet := reflect.ValueOf(&amp;example)\nptr := valCanSet.Elem()\nptr.FieldByName(\"Age\").SetInt(100)\nfmt.Println(example) //Name: XieWei, Age: 100\n}\nfunc UnsafeUsage() {\nvar example ReflectUsage\nexample.Name = \"XieWei\"\nexample.Age = 20\ntyp := reflect.TypeOf(unsafe.Sizeof(example))\nfmt.Println(typ) //uintptr\nfmt.Println(unsafe.Sizeof(example)) //24\nptr := unsafe.Pointer(&amp;example) //  \u7b2c\u4e00\u4e2a\u5b57\u6bb5\u5730\u5740\nfmt.Println(ptr)                //0xc0000083c0\nfmt.Println(*(*string)(ptr))    //  \u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u6210\u7b2c\u4e00\u4e2a\u5b57\u6bb5\u7c7b\u578b\uff0c\u83b7\u53d6\u503c  //XieWei\nptrOfSecondField := unsafe.Pointer(uintptr(ptr) + unsafe.Offsetof(example.Age))\nfmt.Println(ptrOfSecondField)          //0xc0000083d0\nfmt.Println(*(*int)(ptrOfSecondField)) //20\n*(*int)(ptrOfSecondField) = 32\nfmt.Println(example) //Name: XieWei, Age: 32\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestReflect(test *testing.T) {\nUsage()\nUnsafeUsage()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/41.reflect-unsafe/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/reflect_demo/demo1]\n=== RUN   TestReflect\ndemo1.ReflectUsage\ndemo1.ReflectUsage\ndemo1.ReflectUsage{Name:\"XieWei\", Age:20}\nName: XieWei, Age: 20\nName: XieWei, Age: 20\n2 2\n2 2\n{Name  string json:\"name\" 0 [0] false} true\n{Age  int json:\"age\" 16 [1] false} true\nXieWei\n20\n2 {MarshalJSON  func(demo1.ReflectUsage) ([]uint8, error) &lt;func(demo1.ReflectUsage) ([]uint8, error) Value&gt; 0}\n2 {String  func(demo1.ReflectUsage) string &lt;func(demo1.ReflectUsage) string Value&gt; 1}\n[Name: XieWei, Age: 20]\nName: XieWei\nName: XieWei, Age: 100\nuintptr\n24\n0xc0000083c0\nXieWei\n0xc0000083d0\n20\nName: XieWei, Age: 32\n--- PASS: TestReflect (0.00s)\nPASS\nok      demo1   0.475s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/","title":"os/path/filepath","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"os\"\n</code></pre> <p>os\u5305\u63d0\u4f9b\u4e86\u64cd\u4f5c\u7cfb\u7edf\u51fd\u6570\u7684\u4e0d\u4f9d\u8d56\u5e73\u53f0\u7684\u63a5\u53e3\u3002\u8bbe\u8ba1\u4e3aUnix\u98ce\u683c\u7684\uff0c\u867d\u7136\u9519\u8bef\u5904\u7406\u662fgo\u98ce\u683c\u7684\uff1b\u5931\u8d25\u7684\u8c03\u7528\u4f1a\u8fd4\u56de\u9519\u8bef\u503c\u800c\u975e\u9519\u8bef\u7801\u3002</p> <p>\u901a\u5e38\u9519\u8bef\u503c\u91cc\u5305\u542b\u66f4\u591a\u4fe1\u606f\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u67d0\u4e2a\u4f7f\u7528\u4e00\u4e2a\u6587\u4ef6\u540d\u7684\u8c03\u7528\uff08\u5982Open\u3001Stat\uff09\u5931\u8d25\u4e86\uff0c\u6253\u5370\u9519\u8bef\u65f6\u4f1a\u5305\u542b\u8be5\u6587\u4ef6\u540d\uff0c\u9519\u8bef\u7c7b\u578b\u5c06\u4e3a*PathError\uff0c\u5176\u5185\u90e8\u53ef\u4ee5\u89e3\u5305\u83b7\u5f97\u66f4\u591a\u4fe1\u606f\u3002</p> <p>os\u5305\u7684\u63a5\u53e3\u89c4\u5b9a\u4e3a\u5728\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u90fd\u662f\u4e00\u81f4\u7684\u3002\u975e\u516c\u7528\u7684\u5c5e\u6027\u53ef\u4ee5\u4ece\u64cd\u4f5c\u7cfb\u7edf\u7279\u5b9a\u7684syscall\u5305\u83b7\u53d6\u3002</p> <pre><code>import \"path\"\n</code></pre> <p>path\u5b9e\u73b0\u4e86\u5bf9\u659c\u6760\u5206\u9694\u7684\u8def\u5f84\u7684\u5b9e\u7528\u64cd\u4f5c\u51fd\u6570\u3002</p> <pre><code>import \"path/filepath\"\n</code></pre> <p>filepath\u5305\u5b9e\u73b0\u4e86\u517c\u5bb9\u5404\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u8def\u5f84\u7684\u5b9e\u7528\u64cd\u4f5c\u51fd\u6570\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"bytes\"\n\"fmt\"\n\"io/ioutil\"\n\"os\"\n\"os/exec\"\n\"path\"\n\"path/filepath\"\n)\nfunc OsUsage() {\n// \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u83b7\u53d6\u6587\u4ef6\u4fe1\u606f\nfileMode, err := os.Stat(\"log.log\")\nif os.IsNotExist(err) {\nreturn\n}\nfmt.Println(fileMode.Name(), fileMode.Mode(), fileMode.Size()) //log.log -rw-rw-rw- 35\n}\nfunc OSUsageWith() {\n// \u521b\u5efa\u6587\u4ef6\uff0c\u5e76\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u5199\u5165\u5185\u5bb9\nfile, _ := os.OpenFile(\"os.log\", os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)\nfmt.Println(file.Name())\nfile.WriteString(\"Hello\")\nfile.WriteString(\"HelloWorld\")\nioutil.ReadFile(\"os.log\")\n}\nfunc OSPathUsage() {\ndir, _ := os.Getwd()\nfmt.Println(dir, path.Base(dir)) //D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1 D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1\nfmt.Println(dir, path.Dir(dir))  //D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1 .\nparentDir := path.Dir(dir)\nfmt.Println(dir, path.Join(parentDir, \"Chapter3\")) //D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1 Chapter3\n}\nfunc OSPathWindows() {\nwindowsPath := `C:\\Windows\\System\\Chapter4`\nfmt.Println(path.Base(windowsPath)) //C:\\Windows\\System\\Chapter4\nfmt.Println(path.Dir(windowsPath))  //.\nwindowsPathFormat := filepath.FromSlash(windowsPath)\nfmt.Println(filepath.Base(windowsPathFormat)) //Chapter4\nfmt.Println(filepath.Dir(windowsPathFormat))  //C:\\Windows\\System\n}\n// \u904d\u5386\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\nfunc OSDirUsage() {\npath, _ := os.Getwd()\nfilepath.Walk(path, func(path string, info os.FileInfo, err error) error {\nif info.IsDir() {\nreturn nil\n}\nfmt.Println(\"file:\", info.Name(), \"in directory:\", path)\nreturn nil\n})\n}\nfunc OSExecUsage() {\ndockerPath, err := exec.LookPath(\"docker\")\nif err != nil {\nreturn\n}\nfmt.Println(dockerPath) // /bin/docker\npwdPath, err := exec.LookPath(\"pwd\")\nif err != nil {\nreturn\n}\nfmt.Println(pwdPath) // /bin/pwd\n// 1\ncmd := exec.Command(\"docker\", \"ps\")\nstdout, _ := cmd.StdoutPipe()\ncmd.Start()\nopBytes, err := ioutil.ReadAll(stdout)\nfmt.Println(cmd.Dir, cmd.Path, string(opBytes))\n// 2\npwd, _ := os.Getwd()\ncmd2 := exec.Command(\"ls\", pwd)\nvar buf bytes.Buffer\ncmd2.Stdout = &amp;buf\ncmd2.Run()\nfmt.Println(buf.String())\n// 3\ncmd3 := exec.Command(\"cat\", \"log.log\")\nout, _ := cmd3.Output()\n//out2, _ := cmd3.CombinedOutput()\nfmt.Println(string(out))\n// 4\ncmd4 := exec.Command(\"sh\", \"os.sh\")\nout4, _ := cmd4.CombinedOutput()\nfmt.Println(string(out4))\n// 5\ncmd5 := exec.Command(\"ls\", pwd)\nstdout5, _ := cmd5.StdoutPipe()\nif err := cmd5.Start(); err != nil {\nfmt.Println(err)\n}\nbytes, err := ioutil.ReadAll(stdout5)\nerr = ioutil.WriteFile(\"file.log\", bytes, 0644)\nif err != nil {\npanic(err)\n}\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestOS(test *testing.T) {\nOsUsage()\nOSUsageWith()\nOSPathUsage()\nOSPathWindows()\nOSDirUsage()\n// OSExecUsage()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/42.os-path-filepath/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/go-standard-lib/os_path_filepath_demo/demo1]\n=== RUN   TestOS\nlog.log -rw-rw-rw- 35\nos.log\nD:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1 D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1\nD:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1 .\nD:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1 Chapter3\nC:\\Windows\\System\\Chapter4\n.\nChapter4\nC:\\Windows\\System\nfile: demo1.go in directory: D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1\\demo1.go\nfile: demo1_test.go in directory: D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1\\demo1_test.go\nfile: go.mod in directory: D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1\\go.mod\nfile: log.log in directory: D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1\\log.log\nfile: os.log in directory: D:\\golang\\go\\src\\gitee\\go-standard-lib\\os_path_filepath_demo\\demo1\\os.log\n--- PASS: TestOS (0.00s)\nPASS\nok      demo1   0.484s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/","title":"unicode","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"unicode\"\n</code></pre> <p>Unicode\u5305\u63d0\u4f9b\u4e86\u6d4b\u8bd5unicode\u4ee3\u7801\u70b9\u7684\u67d0\u4e9b\u5c5e\u6027\u7684\u6570\u636e\u548c\u51fd\u6570\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"errors\"\n\"fmt\"\n\"unicode\"\n)\nfunc UnicodeUsage() {\nvar string = \"\u4f60\u597d Golang 123\"\nfor _, i := range string {\n// IsLetter\u62a5\u544a\u5143\u7d20\u662f\u5426\u4e3a\u5b57\u6bcd(\u7c7b\u522b)\u3002Yes:\u4f60 Yes:\u597d No:  Yes:G Yes:o Yes:l Yes:a Yes:n Yes:g No:  No:1 No:2 No:3\nif unicode.IsLetter(i) {\nfmt.Printf(\"Yes:%c \", i)\n} else {\nfmt.Printf(\"No:%c \", i)\n}\n}\nfmt.Println()\n// \u904d\u5386\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u6253\u5370\u51fa\u5176\u4e2d\u7684\u6c49\u5b57\u5b57\u7b26\nfor _, i := range string {\n// Is \u51fd\u6570\u7528\u4e8e\u5224\u65ad\u5b57\u7b26\u662f\u5426\u5c5e\u4e8e\u6307\u5b9a\u7684\u5b57\u7b26\u96c6\u3002\u5982\u679c\u5b57\u7b26 i \u662f\u6c49\u5b57\u5b57\u7b26\uff0c\u6761\u4ef6\u6210\u7acb\u3002\nif unicode.Is(unicode.Scripts[\"Han\"], i) {\nfmt.Printf(\"%c\\n\", i)\n}\n}\nfor _, i := range string {\nfmt.Printf(\"%c\", unicode.ToUpper(i)) //\u4f60\u597d GOLANG 123\n}\n}\nfunc RegisterUserName(name string, table *unicode.RangeTable) error {\nfor _, i := range name {\nif !unicode.Is(table, i) {\nreturn errors.New(\"scripts is not correct\")\n}\n}\nreturn nil\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"testing\"\n\"unicode\"\n)\nfunc TestUnicode(test *testing.T) {\nUnicodeUsage()\nfmt.Println()\nfmt.Println(RegisterUserName(\"\u6ce8\u518c\u540dHello\", unicode.Scripts[\"Han\"]))\nfmt.Println(RegisterUserName(\"\ub4f1\ub85d\uc774\ub984\", unicode.Scripts[\"Hangul\"]))\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/43.unicode/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/go-standard-lib/unicode_demo/demo1]\n=== RUN   TestUnicode\nYes:\u4f60 Yes:\u597d No:  Yes:G Yes:o Yes:l Yes:a Yes:n Yes:g No:  No:1 No:2 No:3 \u4f60\n\u597d\n\u4f60\u597d GOLANG 123\nscripts is not correct\n&lt;nil&gt;\n--- PASS: TestUnicode (0.00s)\nPASS\nok      demo1   0.289s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/","title":"flag","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"flag\"\n</code></pre> <p>flag\u5305\u5b9e\u73b0\u4e86\u547d\u4ee4\u884c\u53c2\u6570\u7684\u89e3\u6790\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"flag\"\n\"fmt\"\n\"strconv\"\n\"strings\"\n\"time\"\n)\nfunc FlagUsage() {\nvar number int\nflag.IntVar(&amp;number, \"n\", 10, \"number\")\nname := flag.String(\"name\", \"Go\", \"name of language\")\nnow := flag.Duration(\"time\", time.Second, \"time\")\nflag.Parse()\nflag.PrintDefaults()\nfmt.Println(number, *name, *now)\n}\ntype Numbers struct {\nNum []int\n}\nfunc (n *Numbers) Set(value string) error {\nsList := strings.Split(value, \"|\")\nvar num []int\nfor _, i := range sList {\nin, _ := strconv.Atoi(i)\nnum = append(num, in)\n}\nn.Num = num\nreturn nil\n}\nfunc (n *Numbers) String() string {\nreturn fmt.Sprintf(\"%#v\", n.Num)\n}\nfunc FlagSpecial() {\nvar n Numbers\nflag.Var(&amp;n, \"n\", \"number to parse\")\nflag.Parse()\nfmt.Println(n.Num)\n}\n// func main() {\n//  FlagUsage()\n// }\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestFlagUsage(t *testing.T) {\nFlagUsage()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:\\golang\\go\\src\\gitee\\go-standard-lib\\flag_demo\\demo1&gt;go run demo1.go\n  -n int\n        number (default 10)\n-name string\n        name of language (default \"Go\")\n-time duration\n        time (default 1s)\n10 Go 1s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/#4-\u793a\u4f8b","title":"4. \u793a\u4f8b","text":"<pre><code>package main\nimport (\n\"flag\"\n\"fmt\"\n)\nfunc main() {\nvar confPath string\nvar port int\nvar b bool\nflag.StringVar(&amp;confPath, \"conf\", \"\", \"input config path.\")\nflag.IntVar(&amp;port, \"p\", 8000, \"\")\nflag.BoolVar(&amp;b, \"b\", false, \"input bool.\")\n//\u6ce8\u518c\nflag.Parse()\nfmt.Println(\"configPath: \", confPath)\nfmt.Println(\"port: \", port)\nfmt.Println(\"b: \", b)\n}\n</code></pre> <pre><code>$ go build -o bin/flag.exe github.com/flag_project/src/go_dev/args\n\n$ flag.exe -conf \"/home/config\" -p 8080 -b true\nconfigPath:  /home/config\nport:  8080\nb:  true\n</code></pre> <p>Mysql\u63a5\u6536\u53c2\u6570\u7684\u4f8b\u5b50</p> <pre><code>package main\nimport (\n\"flag\"\n\"fmt\"\n)\nfunc main() {\nvar Username string\nvar Password string\nvar port int\nvar DBname string\nflag.StringVar(&amp;Username,\"u\",\"\",\"mysql User\")\nflag.StringVar(&amp;Password,\"p\",\"\",\"mysql Password\")\nflag.IntVar(&amp;port,\"port\",3306,\"MySQL port default 3306\")\nflag.StringVar(&amp;DBname,\"db\",\"\",\"MySQL database name\")\n//\u6ce8\u518c\nflag.Parse()\nfmt.Println(\"MySQL Username: \",Username)\nfmt.Println(\"MySQL Password: \",Password)\nfmt.Println(\"MySQL Port: \",port)\nfmt.Println(\"MySQL DBName: \",DBname)\nif Username != \"root\" {\nfmt.Println(\"please input mysql user root!\")\n}\n}\n</code></pre> <pre><code>D:\\go_studay\\go_path\\src\\github.com\\flag_project&gt;go build -o bin/mysql.exe  github.com/flag_project/src/go_dev/mysqlArgs\n\nD:\\go_studay\\go_path\\src\\github.com\\flag_project\\bin&gt;mysql.exe -u root -p admin#123! -db dbweb\nMySQL Username:  root\nMySQL Password:  admin#123!\nMySQL Port:  3306\nMySQL DBName:  dbweb\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/44.flag/#5-\u793a\u4f8b","title":"5. \u793a\u4f8b","text":"<pre><code>package main\nimport (\n\"flag\"\n\"fmt\"\n\"os\"\n\"strconv\"\n\"strings\"\n)\nfunc usage() {\nflag.Usage()\nfmt.Printf(\"\\n\")\nfmt.Printf(\"Format:\\nmooon_ssh -h=host1,host2,... -P=port -u=user -p=password -c=command\\n\")\nfmt.Printf(\"\\n\")\nfmt.Printf(\"Example:\\nmooon_ssh -h=192.168.31.32 -P=22 -u=root -p='root@2018' -c='whoami'\\n\")\nfmt.Printf(\"\\n\")\n}\nfunc main() {\nvar (\ng_help     = flag.Bool(\"H\", false, \"Display a help message and exit\")\ng_hosts    = flag.String(\"h\", \"\", \"Connect to the remote machines on the given hosts separated by comma, can be replaced by environment variable 'H'\")\ng_port     = flag.Int(\"P\", 22, \"Specifies the port to connect to on the remote machines, can be replaced by environment variable 'PORT'\")\ng_user     = flag.String(\"u\", \"\", \"Specifies the user to log in as on the remote machines, can be replaced by environment variable 'U'\")\ng_password = flag.String(\"p\", \"\", \"The password to use when connecting to the remote machines, can be replaced by environment variable 'P'\")\ng_command  = flag.String(\"c\", \"\", \"The command is executed on the remote machines\")\n)\nvar hosts, user, password string\nvar port int\nflag.Parse()\n// help\nif *g_help {\nusage()\nos.Exit(1)\n}\n// hosts\nif *g_hosts != \"\" {\nhosts = *g_hosts\n} else {\ns := os.Getenv(\"H\")\nif s != \"\" {\nhosts = s\n} else {\nfmt.Printf(\"Parameter[\\033[1;33m-h\\033[m] not set\\n\\n\")\nusage()\nos.Exit(1)\n}\n}\n// port\ns := os.Getenv(\"PORT\")\nif s == \"\" {\nport = *g_port\n} else {\nport_, err := strconv.Atoi(s)\nif err != nil {\nfmt.Printf(\"Parameter[\\033[1;33m-P\\033[m]: invaid port\\n\\n\")\nusage()\nos.Exit(1)\n} else {\nport = port_\n}\n}\n// user\nif *g_user != \"\" {\nuser = *g_user\n} else {\ns := os.Getenv(\"U\")\nif s != \"\" {\nuser = s\n} else {\nfmt.Printf(\"Parameter[\\033[1;33m-u\\033[m] not set\\n\\n\")\nusage()\nos.Exit(1)\n}\n}\n// password\nif *g_password != \"\" {\npassword = *g_password\n} else {\ns := os.Getenv(\"P\")\nif s != \"\" {\npassword = s\n} else {\nfmt.Printf(\"Parameter[\\033[1;33m-p\\033[m] not set\\n\\n\")\nusage()\nos.Exit(1)\n}\n}\n// command\nif *g_command == \"\" {\nfmt.Printf(\"Parameter[\\033[1;33m-c\\033[m] not set\\n\\n\")\nusage()\nos.Exit(1)\n}\nhost_array := strings.Split(hosts, \",\")\nfor _, host := range host_array {\nip_port := host + \":\" + fmt.Sprintf(\"%d\", port)\nfmt.Println(ip_port, user, password)\n}\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/","title":"net/url","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"net\"\n</code></pre> <p>net\u5305\u63d0\u4f9b\u4e86\u53ef\u79fb\u690d\u7684\u7f51\u7edcI/O\u63a5\u53e3\uff0c\u5305\u62ecTCP/IP\u3001UDP\u3001\u57df\u540d\u89e3\u6790\u548cUnix\u57dfsocket\u3002</p> <pre><code>import \"net/url\"\n</code></pre> <p>url\u5305\u89e3\u6790URL\u5e76\u5b9e\u73b0\u4e86\u67e5\u8be2\u7684\u9038\u7801\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"fmt\"\n\"net/url\"\n)\nfunc UrlUsage() {\nvar urlString = \"https://golang.org/pkg/net/url?name=xie&amp;age=20\"\nurlPath, _ := url.Parse(urlString)\nfmt.Println(fmt.Sprintf(\"%#v\", urlPath))\nv := urlPath.Query()\nv.Set(\"name\", \"Wei\")\nurlPath.RawQuery = v.Encode()\nfmt.Println(fmt.Sprintf(\"%#v\", urlPath))\n}\nfunc UrlUsageParams() {\nrawUrl := \"https://golang.org/pkg/net/url?name=xie&amp;age=20\"\nurlParsed, _ := url.Parse(rawUrl)\nfmt.Println(urlParsed.Query()) //map[age:[20] name:[xie]\nv := urlParsed.Query()\nv.Del(\"name\")\nv.Add(\"school\", \"shanghai\")\nurlParsed.RawQuery = v.Encode()\nfmt.Println(urlParsed) //https://golang.org/pkg/net/url?age=20&amp;school=shanghai\n}\nfunc UrlValues() {\nvalues := \"name=xie&amp;age=20\"\nv, _ := url.ParseQuery(values)\nfmt.Println(v) //map[age:[20] name:[xie]]\nv.Add(\"school\", \"shanghai\")\nfmt.Println(v) //map[age:[20] name:[xie] school:[shanghai]]\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestUrlUsage(t *testing.T) {\nUrlUsage()\nUrlUsageParams()\nUrlValues()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/45.net-url/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/go-standard-lib/net_url_demo/demo1]\n=== RUN   TestUrlUsage\n&amp;url.URL{Scheme:\"https\", Opaque:\"\", User:(*url.Userinfo)(nil), Host:\"golang.org\", Path:\"/pkg/net/url\", RawPath:\"\", OmitHost:false, ForceQuery:false, RawQuery:\"name=xie&amp;age=20\", Fragment:\"\", RawFragment:\"\"}\n&amp;url.URL{Scheme:\"https\", Opaque:\"\", User:(*url.Userinfo)(nil), Host:\"golang.org\", Path:\"/pkg/net/url\", RawPath:\"\", OmitHost:false, ForceQuery:false, RawQuery:\"age=20&amp;name=Wei\", Fragment:\"\", RawFragment:\"\"}\nmap[age:[20] name:[xie]]\nhttps://golang.org/pkg/net/url?age=20&amp;school=shanghai\nmap[age:[20] name:[xie]]\nmap[age:[20] name:[xie] school:[shanghai]]\n--- PASS: TestUrlUsage (0.00s)\nPASS\nok      demo1   0.478s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/","title":"net/http","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"net/http\"\n</code></pre> <p>http\u5305\u63d0\u4f9b\u4e86HTTP\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u5b9e\u73b0\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Go \u8bed\u8a00\u4e2d\u7684 net/http \u5305\u521b\u5efa\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\uff0c\u5e76\u53d1\u9001\u4e0d\u540c\u7c7b\u578b\u7684\u8bf7\u6c42\uff08GET\u3001POST\u3001POST Form\uff09\u3002</p> <p>\u540c\u65f6\u8fd8\u5c55\u793a\u4e86\u5982\u4f55\u81ea\u5b9a\u4e49\u91cd\u5b9a\u5411\u7b56\u7565\u3001\u6ce8\u518c\u8def\u7531\u5904\u7406\u5668\u548c\u542f\u52a8 HTTP \u670d\u52a1\u5668\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"bytes\"\n\"encoding/json\"\n\"errors\"\n\"fmt\"\n\"io\"\n\"io/ioutil\"\n\"log\"\n\"net/http\"\n\"net/url\"\n\"strings\"\n)\n// getHandle \u51fd\u6570\u53d1\u9001 HTTP GET \u8bf7\u6c42\uff0c\u5e76\u5c06\u54cd\u5e94\u5185\u5bb9\u6253\u5370\u5230\u63a7\u5236\u53f0\u3002\nfunc getHandle(rawString string) {\nresponse, err := http.Get(rawString)\nif err != nil {\nreturn\n}\ndefer response.Body.Close()\ncontent, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(content))\n}\n// postHandle \u51fd\u6570\u53d1\u9001 HTTP POST \u8bf7\u6c42\uff0c\u5e76\u5c06\u54cd\u5e94\u5185\u5bb9\u6253\u5370\u5230\u63a7\u5236\u53f0\u3002\nfunc postHandle(rawString string, body io.Reader) {\nresponse, err := http.Post(rawString, \"application/json\", body)\nif err != nil {\nreturn\n}\ndefer response.Body.Close()\ncontent, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(content))\n}\n// ClientUsage \u51fd\u6570\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528\u5ba2\u6237\u7aef\u53d1\u9001 HTTP \u8bf7\u6c42\uff0c\u5305\u62ec GET\u3001POST \u548c POST Form\u3002\nfunc ClientUsage() {\n// get\ngetHandle(\"http://localhost:80/headers\")\ngetHandle(\"http://localhost:80/ip\")\ngetHandle(\"http://localhost:80/user-agent\")\n// post\nvar buf bytes.Buffer\nbuf.WriteString(\"hello golang\")\npostHandle(\"http://localhost:80/anything\", &amp;buf)\nval := strings.NewReader(\"hello python\")\npostHandle(\"http://localhost:80/anything\", val)\nbytesNew := struct {\nName string `json:\"name\"`\nAge  int    `json:\"age\"`\n}{\nName: \"Golang\",\nAge:  10,\n}\nbyt, _ := json.Marshal(bytesNew)\npostHandle(\"http://localhost:80/anything\", bytes.NewReader(byt))\n// PostForm\nresponse, err := http.PostForm(\"http://localhost:80/anything\", url.Values{\n\"name\": []string{\"Golang\"},\n\"age\":  []string{\"10\"},\n})\nif err != nil {\nreturn\n}\ndefer response.Body.Close()\ncontent, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(content))\n}\n// redirectPolicyFunc \u662f\u4e00\u4e2a\u91cd\u5b9a\u5411\u7b56\u7565\u51fd\u6570\uff0c\u7528\u4e8e\u68c0\u67e5\u91cd\u5b9a\u5411\u8fc7\u7a0b\u4e2d\u7684\u8bf7\u6c42\u662f\u5426\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u3002\nfunc redirectPolicyFunc(req *http.Request, via []*http.Request) error {\nif strings.Contains(req.URL.Path, \"header\") {\nreturn errors.New(\"header\")\n}\nreturn nil\n}\n// UserClientUsage \u51fd\u6570\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u91cd\u5b9a\u5411\u7b56\u7565\u6765\u53d1\u9001 HTTP \u8bf7\u6c42\u3002\nfunc UserClientUsage() {\nrequest, _ := http.NewRequest(http.MethodGet, \"http://localhost:80/ip\", nil)\nclient := &amp;http.Client{\nCheckRedirect: redirectPolicyFunc,\n}\nresponse, err := client.Do(request)\nif err != nil {\nreturn\n}\ndefer response.Body.Close()\ncontent, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(content))\n}\n// SelfHandler \u662f\u4e00\u4e2a\u5b9e\u73b0\u4e86 ServeHTTP \u65b9\u6cd5\u7684\u81ea\u5b9a\u4e49\u5904\u7406\u5668\u3002\ntype SelfHandler struct {\n}\nfunc (SelfHandler) ServeHTTP(writer http.ResponseWriter, req *http.Request) {\nwriter.Write([]byte(\"Hello Python\"))\n}\n// ServerUsage \u51fd\u6570\u6f14\u793a\u4e86\u5982\u4f55\u521b\u5efa\u4e00\u4e2a HTTP \u670d\u52a1\u5668\u3002\n// \u5206\u522b\u6f14\u793a\u4e86\u4e09\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\uff1a\u4f7f\u7528 http.HandleFunc\u3001http.Handle \u548c\u81ea\u5b9a\u4e49\u7684 http.ServeMux \u6765\u6ce8\u518c\u8def\u7531\u5904\u7406\u5668\u3002\n// \u5176\u4e2d\u8fd8\u5305\u62ec\u4e86\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3\u53f7\u6765\u542f\u52a8\u670d\u52a1\u5668\u3002\nfunc ServerUsage() {\n// method One\nhttp.HandleFunc(\"/hello_golang\", func(writer http.ResponseWriter, request *http.Request) {\nwriter.Write([]byte(\"Hello Golang\"))\n})\n// method Two\nvar self SelfHandler\nhttp.Handle(\"/hello_python\", self)\n// method Three\nvar selfServerMux *http.ServeMux\nselfServerMux = &amp;http.ServeMux{}\nselfServerMux.HandleFunc(\"/hello_golang_2\", func(writer http.ResponseWriter, request *http.Request) {\nwriter.Write([]byte(\"Hello Golang 2\"))\n})\nvar selfServer http.Server\nvar selfHandler Self\nvar selfMux *http.ServeMux\nselfMux = &amp;http.ServeMux{}\nselfHandler = Self{}\nselfMux.Handle(\"/say\", selfHandler)\nselfServer = http.Server{\nHandler: selfHandler,\nAddr:    \"localhost:9099\",\n}\ngo func() {\nlog.Fatal(http.ListenAndServe(\":9090\", selfServerMux))\n}()\ngo func() {\nlog.Fatal(selfServer.ListenAndServe())\n}()\ngo func() {\nlog.Fatal(http.ListenAndServe(\":8080\", nil))\n}()\nselect {}\n}\n// Self \u662f\u4e00\u4e2a\u5b9e\u73b0\u4e86 ServeHTTP \u65b9\u6cd5\u7684\u81ea\u5b9a\u4e49\u5904\u7406\u5668\u3002\ntype Self struct {\n}\nfunc (Self) ServeHTTP(writer http.ResponseWriter, req *http.Request) {\nfmt.Fprintf(writer, \"Hello Self Sever 1\")\n}\nfunc (Self) Say(writer http.ResponseWriter, req *http.Request) {\nfmt.Fprintf(writer, \"Hello Self Sever 1\")\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestClientUsage(t *testing.T) {\nClientUsage()\nUserClientUsage()\n}\nfunc TestServerUsage(t *testing.T) {\nServerUsage()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/46.net-http/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/go-standard-lib/net_http_demo/demo1]\n=== RUN   TestClientUsage\n--- PASS: TestClientUsage (10.43s)\n=== RUN   TestServerUsage\n2023/07/25 18:06:01 listen tcp :8080: bind: Only one usage of each socket address (protocol/network address/port) is normally permitted.\nexit status 1\nFAIL    demo1   11.526s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/","title":"sort","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"sort\"\n</code></pre> <p>sort\u5305\u63d0\u4f9b\u4e86\u6392\u5e8f\u5207\u7247\u548c\u7528\u6237\u81ea\u5b9a\u4e49\u6570\u636e\u96c6\u7684\u51fd\u6570\u3002</p> <p>demo1/demo1.go</p> <pre><code>// demo1.go\npackage demo1\nimport (\n\"fmt\"\n\"sort\"\n)\nfunc SortIntsUsage() {\nlist := []int{10, 9, 2, 8, 3}\nsort.Ints(list)\nfmt.Println(list) //[2 3 8 9 10]\nsort.Sort(sort.Reverse(sort.IntSlice(list)))\nfmt.Println(list) //[10 9 8 3 2]\n}\nfunc SortFloatsUsage() {\nlist := []float64{10, 9, 1.2, 3.4, 12.1}\nsort.Float64s(list)\nfmt.Println(list) //[1.2 3.4 9 10 12.1]\nsort.Sort(sort.Reverse(sort.Float64Slice(list)))\nfmt.Println(list) //[12.1 10 9 3.4 1.2]\n}\nfunc SortStringsUsage() {\nlist := []string{\"a\", \"A\", \"c\", \"C\", \"B\", \"b\"}\nsort.Strings(list)\nfmt.Println(list) //[A B C a b c]\nsort.Sort(sort.Reverse(sort.StringSlice(list)))\nfmt.Println(list) //[c b a C B A]\n}\ntype Language struct {\nYear    int    `json:\"year\"`\nName    string `json:\"name\"`\nAccount string `json:\"account\"`\n}\ntype Languages []Language\nfunc (ls Languages) Len() int {\nreturn len(ls)\n}\nfunc (ls Languages) Less(i, j int) bool {\nreturn ls[i].Year &lt; ls[j].Year\n}\nfunc (ls Languages) Swap(i, j int) {\nls[i], ls[j] = ls[j], ls[i]\n}\nfunc SortStruct() {\nlist := Languages{\n{\n10, \"Golang\", \"Google\",\n}, {\n28, \"Python\", \"Google\",\n}, {\n30, \"Java\", \"***\",\n}, {\n1, \"Lua\", \"23\",\n},\n}\nfmt.Println(\"Ori\", list) //Ori [{10 Golang Google} {28 Python Google} {30 Java ***} {1 Lua 23}]\nsort.Sort(list)\nfmt.Println(\"sort\", list) //sort [{1 Lua 23} {10 Golang Google} {28 Python Google} {30 Java ***}]\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestSortUsage(test *testing.T) {\nSortIntsUsage()\nSortFloatsUsage()\nSortStringsUsage()\nSortStruct()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/47.sort/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/go-standard-lib/sort_demo/demo1]\n=== RUN   TestSortUsage\n[2 3 8 9 10]\n[10 9 8 3 2]\n[1.2 3.4 9 10 12.1]\n[12.1 10 9 3.4 1.2]\n[A B C a b c]\n[c b a C B A]\nOri [{10 Golang Google} {28 Python Google} {30 Java ***} {1 Lua 23}]\nsort [{1 Lua 23} {10 Golang Google} {28 Python Google} {30 Java ***}]\n--- PASS: TestSortUsage (0.00s)\nPASS\nok      demo1   0.475s\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/","title":"errors","text":""},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/#1\u5b9e\u73b0","title":"1.\u5b9e\u73b0","text":"<pre><code>import \"errors\"\n</code></pre> <p>errors\u5305\u5b9e\u73b0\u4e86\u521b\u5efa\u9519\u8bef\u503c\u7684\u51fd\u6570\u3002</p> <p>demo1/demo1.go</p> <pre><code>package demo1\nimport (\n\"errors\"\n\"fmt\"\n)\nfunc ErrorUsage() {\nerr := errors.New(\"err: found 1\")\nif err != nil {\nfmt.Println(err.Error()) //err: found 1\n}\nerr2 := fmt.Errorf(\"err: %s\", \"found 2\")\nif err2 != nil {\nfmt.Println(err2.Error()) //err: found 2\n}\n}\ntype SelfError struct {\nCode    int    `json:\"code\"`\nMessage string `json:\"message\"`\n}\nfunc (self SelfError) Error() string {\nreturn fmt.Sprintf(\"Code: %d, Message: %s\", self.Code, self.Message)\n}\nfunc UsageError(value string) error {\nvar self SelfError\nif value == \"\" {\nself.Code = 400\nself.Message = \"fail\"\nreturn self\n}\nreturn nil\n}\nfunc UserErrorUsage() {\nerr3 := UsageError(\"\")\nif err3 != nil {\nfmt.Println(err3.Error()) //Code: 400, Message: fail\n}\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/#2\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","title":"2.\u7f16\u5199\u5355\u5143\u6d4b\u8bd5","text":"<p>demo1/demo1_test.go</p> <pre><code>package demo1\nimport \"testing\"\nfunc TestErrorUsage(t *testing.T) {\nErrorUsage()\nUserErrorUsage()\n}\n</code></pre>"},{"location":"Golang/8.Go%E6%A0%87%E5%87%86%E5%BA%93/48.errors/#3\u6d4b\u8bd5\u7ed3\u679c","title":"3.\u6d4b\u8bd5\u7ed3\u679c","text":"<pre><code>D:/Program Files/go/bin/go.exe test -v [D:/golang/go/src/gitee/go-standard-lib/error_demo/demo1]\n=== RUN   TestErrorUsage\nerr: found 1\nerr: found 2\nCode: 400, Message: fail\n--- PASS: TestErrorUsage (0.00s)\nPASS\nok      demo1   0.478s\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/","title":"\u5f00\u6e90\u81ea\u5df1\u7684Go\u5e93","text":"<p>\u5728\u5f00\u53d1 Go \u9879\u76ee\u65f6\uff0c\u7ecf\u5e38\u4f1a\u4f7f\u7528\u5230\u4e00\u4e9b\u5916\u90e8\u4f9d\u8d56\u5305\u3002</p> <p>\u5b83\u4eec\u4e00\u822c\u90fd\u662f\u901a\u8fc7\u5f62\u5982<code>go get example.com/xxx</code>\u7684\u547d\u4ee4\u5f62\u5f0f\u83b7\u53d6\u5230\u672c\u5730\u4f7f\u7528\u3002</p> <p>\u672c\u7740\u5f00\u6e90\u7cbe\u795e\uff0c\u5982\u679c\u60f3\u5c06\u81ea\u5df1\u5f00\u53d1\u7684\u5305\u5171\u4eab\u51fa\u53bb\uff0c\u8ba9\u5176\u4ed6\u4eba\u4e5f\u80fd\u4f7f\u7528go get\u547d\u4ee4\u83b7\u53d6\u5230\u5b83\u4eec\uff0c\u5e94\u8be5\u5982\u4f55\u505a\u5462\uff1f</p> <p>\u8fd9\u91cc\u4ee5\u5f00\u6e90\u81f3<code>Github/Gitee</code>\u5e73\u53f0\u4e3a\u4f8b\uff0c\u5c55\u793a\u5176\u6d41\u7a0b\u3002</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#1github","title":"1.Github","text":""},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#11-\u5efa\u7acb\u4ed3\u5e93","title":"1.1 \u5efa\u7acb\u4ed3\u5e93","text":"<p>\u9996\u5148\uff0c\u5728github\u5e73\u53f0\u5efa\u7acb\u4ed3\u5e93\uff0c\u8bbe\u7f6e\u60f3\u8981\u5f00\u6e90\u7684Go\u5e93\u540d\u3002</p> <p>\u8fd9\u91cc\u5c06\u9879\u76ee\u540d\u53d6\u4e3a app-demo\uff0c\u72b6\u6001\u4e3a Public\u3002</p> <p>Initialize this repository with:</p> <ul> <li> <p>Add a README file</p> </li> <li> <p>Choose a license</p> </li> </ul>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#12-\u5f00\u53d1\u6a21\u5757\u4ee3\u7801","title":"1.2 \u5f00\u53d1\u6a21\u5757\u4ee3\u7801","text":"<p>\u5c06\u521b\u5efa\u597d\u7684\u4ed3\u5e93\uff0c\u901a\u8fc7 git clone \u547d\u4ee4\u62c9\u53d6\u81f3\u672c\u5730\u5f00\u53d1\u3002</p> <pre><code>$ git clone https://github.com/hujianli94/app-demo.git\n</code></pre> <p>\u4e3a\u9879\u76ee\u521d\u59cb\u5316 mod \u6587\u4ef6 <pre><code>$ go mod init github.com/hujianli94/app-demo\n</code></pre></p> <p>\u5047\u8bbe\uff0c\u60f3\u5f00\u6e90\u7684 Go \u5de5\u5177\u7c7b\u7684\u5e93\uff0c\u6b64\u65f6\u51c6\u5907\u5148\u63d0\u4f9b\u7684\u662f\u5bf9\u5b57\u7b26\u4e32\u76f8\u5173\u7684\u64cd\u4f5c\u3002</p> <p>\u56e0\u6b64\u5728app-demo/\u76ee\u5f55\u4e0b\uff0c\u65b0\u589estringutil/\u5b50\u76ee\u5f55\uff0c\u5728\u5b50\u76ee\u5f55\u4e2d\u589e\u52a0 reverse.go \u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\u3002</p> <pre><code>package stringutil\n// Reverse returns its argument string reversed rune-wise left to right.\nfunc Reverse(s string) string {\nr := []rune(s)\nfor i, j := 0, len(r)-1; i &lt; len(r)/2; i, j = i+1, j-1 {\nr[i], r[j] = r[j], r[i]\n}\nreturn string(r)\n}\n</code></pre> <p>\u5f88\u7b80\u5355\uff0c\u60f3\u63d0\u4f9b\u7684\u662f\u4e00\u4e2a\u7ffb\u8f6c\u5b57\u7b26\u4e32\u529f\u80fd\u51fd\u6570\u3002 \u5f53\u7136\uff0c\u4e5f\u5e94\u8be5\u63d0\u4f9b\u6d4b\u8bd5\u4ee3\u7801\u3002\u5728\u540c\u7ea7\u76ee\u5f55\u589e\u52a0 reverse_test.go \u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\u3002</p> <pre><code>package stringutil\nimport \"testing\"\nfunc TestReverse(t *testing.T) {\nfor _, c := range []struct {\nin, want string\n}{\n{\"Hello, world\", \"dlrow ,olleH\"},\n{\"Hello, \u4e16\u754c\", \"\u754c\u4e16 ,olleH\"},\n{\"\", \"\"},\n} {\ngot := Reverse(c.in)\nif got != c.want {\nt.Errorf(\"Reverse(%q) == %q, want %q\", c.in, got, c.want)\n}\n}\n}\n</code></pre> <p>\u56de\u5230\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u6b64\u65f6\uff0c\u4ee3\u7801\u7ed3\u6784\u5982\u4e0b</p> <pre><code>.\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 go.mod\n\u2514\u2500\u2500 stringutil\n    \u251c\u2500\u2500 reverse.go\n    \u2514\u2500\u2500 reverse_test.go\n\n1 directory, 5 files\n</code></pre> <p>\u6d4b\u8bd5\u4ee3\u7801\u4e5f\u90fd\u901a\u8fc7</p> <pre><code>$ go test ./...\nok      github.com/hujianli94/app-demo/stringutil   0.003s\n\n$ go test -v ./...\n=== RUN   TestReverse\n--- PASS: TestReverse (0.00s)\nPASS\nok      github.com/hujianli94/app-demo/stringutil   0.003s\n</code></pre> <p>\u5f00\u53d1\u5b8c\u6210\uff0c\u5c31\u53ef\u4ee5\u5c06\u5de5\u5177\u5e93\u5171\u4eab\u51fa\u53bb\u4e86\u3002</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#13-\u53d1\u5e03","title":"1.3 \u53d1\u5e03","text":"<p>\u4e3a\u4e86\u907f\u514d\u6a21\u5757\u4e2d\u8fd8\u8bb0\u5f55\u4e86\u4e0d\u518d\u9700\u8981\u7684\u4f9d\u8d56\u9879\uff0c\u6267\u884c go mod tidy \u79fb\u9664\u5b83\u4eec\u3002</p> <pre><code>$ go mod tidy\n</code></pre> <p>\u4f7f\u7528 git tag \u547d\u4ee4\u6807\u8bb0\u7248\u672c\u4fe1\u606f</p> <pre><code>$ cd /data/goworkdir/go/src/github.com/hujianli94/app-demo\n$ git add .\n$ git commit -m \"add Reverse: for v0.1.0\"\n$ git tag v0.1.0\n\n# \u5c06\u5176 push \u81f3\u8fdc\u7a0b\u4ed3\u5e93\n## github\u4e0d\u80fd\u4f7f\u7528\u7528\u6237\u540d\u5bc6\u7801\u63a8\u9001\uff0c\u9700\u8981\u8bbe\u7f6etoken\u63a8\u9001\n# \u60a8\u53ef\u4ee5\u5728GitHub\u8bbe\u7f6e\u4e2d\u521b\u5efa\u4e2a\u4eba\u8bbf\u95ee\u4ee4\u724c\uff0c\u7136\u540e\u4f7f\u7528\u8be5\u4ee4\u724c\u4f5c\u4e3a\u5bc6\u7801\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u5728\u547d\u4ee4\u884c\u4e2d\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5e76\u5c06TOKEN\u66ff\u6362\u4e3a\u60a8\u7684\u4e2a\u4eba\u8bbf\u95ee\u4ee4\u724c\uff1a\n#\u5c06&lt;your_token&gt;\u6362\u6210\u4f60\u81ea\u5df1\u5f97\u5230\u7684\u4ee4\u724c\u3002&lt;USERNAME&gt;\u662f\u4f60\u81ea\u5df1github\u7684\u7528\u6237\u540d\uff0c&lt;REPO&gt;\u662f\u4f60\u7684\u9879\u76ee\u540d\u79f0\uff0c\u6bd4\u5982\u6211\u7684\uff1a\n# $ git remote set-url origin  https://&lt;your_token&gt;@github.com/hujianli94/hujianli94.github.io.git\n# \u7136\u540e\u518d\u6267\u884cgit push\n$ git push origin main\n$ git push origin v0.1.0\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#14-\u4f7f\u7528","title":"1.4 \u4f7f\u7528","text":"<p>\u53d1\u5e03\u4e4b\u540e\uff0c\u5176\u4ed6\u9879\u76ee\u5c31\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6\u5f00\u6e90\u7684 Go \u5305\u4e86\u3002</p> <pre><code>$ go get github.com/hujianli94/app-demo@v0.1.0\n</code></pre> <p>\u6b64\u65f6\u9879\u76ee go.mod \u6587\u4ef6\u4e2d\uff0c\u5c06\u4f1a\u589e\u52a0\u4ee5\u4e0b\u4e00\u884c\u8bb0\u5f55</p> <pre><code>require github.com/hujianli94/app-demo v0.1.0 // indirect\n</code></pre> <p>\u548c\u5176\u4ed6\u4e09\u65b9\u5e93\u4e00\u6837\u7684\u65b9\u5f0f\u4f7f\u7528\u5373\u53ef</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/hujianli94/app-demo/stringutil\"\n)\nfunc main() {\ns := stringutil.Reverse(\"hello gopher\")\nfmt.Println(s)\n}\n</code></pre> <p>demo\u4ee3\u7801\u4ed3\u5e93\u793a\u4f8b</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#2gitee","title":"2.Gitee","text":""},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#21-\u5efa\u7acb\u4ed3\u5e93","title":"2.1 \u5efa\u7acb\u4ed3\u5e93","text":"<pre><code>$ git clone https://gitee.com/oscstudio/gitee.git\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#22-\u5f00\u53d1\u6a21\u5757\u4ee3\u7801","title":"2.2 \u5f00\u53d1\u6a21\u5757\u4ee3\u7801","text":"<pre><code>$ cd gitee\n$ go mod init gitee.com/oscstudio/gitee\n# \u7f16\u5199\u81ea\u5df1\u7684\u4ee3\u7801\n# coding\n</code></pre> <p>\u4ed3\u5e93\u63cf\u8ff0\uff1a</p> <pre><code>\u7528\u6765\u5b58\u653eGitee\u5185\u90e8\u4f7f\u7528\u7684golang\u5c0f\u5de5\u5177\n\n\u5305\u542b\u5b57\u7b26\u4e32\u5904\u7406\uff0c\u670d\u52a1\u5668\u76f8\u5173\u7b49\n</code></pre> <p>\u5f00\u53d1\u5b8c\u6210\uff0c\u5c31\u53ef\u4ee5\u5c06\u5de5\u5177\u5e93\u5171\u4eab\u51fa\u53bb\u4e86\u3002</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#23-\u53d1\u5e03","title":"2.3 \u53d1\u5e03","text":"<p>\u4e3a\u4e86\u907f\u514d\u6a21\u5757\u4e2d\u8fd8\u8bb0\u5f55\u4e86\u4e0d\u518d\u9700\u8981\u7684\u4f9d\u8d56\u9879\uff0c\u6267\u884c go mod tidy \u79fb\u9664\u5b83\u4eec\u3002</p> <pre><code>$ go mod tidy\n</code></pre> <p>\u4f7f\u7528 git tag \u547d\u4ee4\u6807\u8bb0\u7248\u672c\u4fe1\u606f</p> <pre><code>$ cd /data/goworkdir/go/src/gitee.com/oscstudio/gitee\n$ git add .\n$ git commit -m \"add gitee: for v0.7.9\"\n$ git tag v0.7.9\n\n# \u7136\u540e\u518d\u6267\u884cgit push\n$ git push origin master\n$ git push origin v0.7.9\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#24-\u4f7f\u7528","title":"2.4 \u4f7f\u7528","text":"<p>\u53d1\u5e03\u4e4b\u540e\uff0c\u5176\u4ed6\u9879\u76ee\u5c31\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6\u5f00\u6e90\u7684 Go \u5305\u4e86\u3002</p> <pre><code>$ go get gitee.com/oscstudio/gitee\n</code></pre> <p>\u6b64\u65f6\u9879\u76ee go.mod \u6587\u4ef6\u4e2d\uff0c\u5c06\u4f1a\u589e\u52a0\u4ee5\u4e0b\u4e00\u884c\u8bb0\u5f55</p> <pre><code>require (\ngitee.com/oscstudio/gitee v0.7.9 // indirect\n    golang.org/x/sys v0.0.0-20210616094352-59db8d763f22 // indirect\n)\n# \u5f15\u5165\nimport \"gitee.com/oscstudio/gitee\"\n</code></pre> <p>\u548c\u5176\u4ed6\u4e09\u65b9\u5e93\u4e00\u6837\u7684\u65b9\u5f0f\u4f7f\u7528\u5373\u53ef</p> <pre><code>package main\nimport (\n\"fmt\"\n\"gitee.com/oscstudio/gitee\"\n)\nfunc main() {\n// \"hello, world!\"\nfmt.Println(gitee.StrCat(\"hello, \", \"world!\"))\n// path is exists?\nfmt.Println(gitee.PathExists(\"/tmp/gitee\"))\n}\n</code></pre> <p>demo\u4ee3\u7801\u4ed3\u5e93\u793a\u4f8b</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/0.%E5%BC%80%E6%BA%90%E8%87%AA%E5%B7%B1%E7%9A%84Go%E5%BA%93/#3\u603b\u7ed3","title":"3.\u603b\u7ed3","text":"<p>\u770b\u5b8c\u4e86\u4e0a\u8ff0\u6d41\u7a0b\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a\u5f00\u6e90\u81ea\u5df1\u7684 Go \u5e93\uff0c\u5176\u5b9e\u975e\u5e38\u7b80\u5355\u3002</p> <p>\u4f46\u8fd8\u662f\u6709\u4e9b\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\uff1a</p> <ul> <li> <p>\u4e0d\u8981\u5728\u5f00\u6e90\u7684 mod \u6587\u4ef6\u4e2d\u8bb0\u5f55\u4e0d\u9700\u8981\u7684\u4f9d\u8d56\u3002</p> </li> <li> <p>\u5373\u4f7f\u53d1\u73b0 bug\uff0c\u4e5f\u4e0d\u8981\u66f4\u6539\u5df2\u53d1\u5e03\u7248\u672c\u7684\u4ee3\u7801\uff0c\u800c\u5e94\u8be5\u53d1\u5e03\u65b0\u7248\u672c\u3002 </p> </li> <li> <p>\u9075\u5faa\u7248\u672c\u547d\u540d\u89c4\u8303\uff0c\u63a8\u8350\u53c2\u8003 Module version numbering \u4e00\u6587\uff1ahttps://go.dev/doc/modules/version-numbers \u4e00\u6587</p> </li> </ul> <p></p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/","title":"Cobra","text":"<p>\u5bfc\u8a00</p> <p>\u867d\u7136\u73b0\u5728\u6211\u4eec\u4f7f\u7528\u7684\u5927\u591a\u6570\u8f6f\u4ef6\u90fd\u662f\u53ef\u89c6\u5316\u7684\uff0c\u5f88\u5bb9\u6613\u4e0a\u624b\uff0c\u4f46\u662f\u8fd9\u5e76\u4e0d\u4ee3\u8868 CLI\uff08\u547d\u4ee4\u884c\uff09\u5e94\u7528\u5c31\u6ca1\u6709\u7528\u6b66\u4e4b\u5730\u4e86\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u6765\u8bf4\uff0c\u8fd8\u662f\u4f1a\u7ecf\u5e38\u548c CLI \u5e94\u7528\u6253\u4ea4\u9053\u3002\u800c Golang \u5c31\u975e\u5e38\u9002\u5408\u7528\u6765\u6784\u5efa CLI \u5e94\u7528\uff0c\u4e0b\u9762\u6211\u4eec\u5c31\u5c06\u6765\u4ecb\u7ecd\u5982\u4f55\u5728 Golang \u4e2d\u6784\u5efa\u4e00\u4e2a CLI \u5e94\u7528\u3002</p> <p>\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u6765\u8bf4\u5e73\u65f6\u53ef\u80fd\u5c31\u9700\u8981\u4f7f\u7528\u5230\u5f88\u591a CLI \u5de5\u5177\uff0c\u6bd4\u5982 npm\u3001node\u3001go\u3001python\u3001docker\u3001kubectl \u7b49\u7b49\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u5de5\u5177\u975e\u5e38\u5c0f\u5de7\u3001\u6ca1\u6709\u4f9d\u8d56\u6027\u3001\u975e\u5e38\u9002\u5408\u7cfb\u7edf\u7ba1\u7406\u6216\u8005\u4e00\u4e9b\u81ea\u52a8\u5316\u4efb\u52a1\u7b49\u7b49\u3002</p> <p>\u6211\u4eec\u8fd9\u91cc\u9009\u62e9\u4f7f\u7528 Golang \u91cc\u9762\u975e\u5e38\u6709\u540d\u7684 Cobra \u5e93\u6765\u8fdb\u884c CLI \u5de5\u5177\u7684\u5f00\u53d1\u3002</p> <p>Cobra \u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684\u73b0\u4ee3\u5316 CLI \u5e94\u7528\u7a0b\u5e8f\u5e93\uff0c\u6709\u5f88\u591a\u77e5\u540d\u7684 Go \u9879\u76ee\u4f7f\u7528 Cobra \u8fdb\u884c\u6784\u5efa\uff0c\u6bd4\u5982\uff1aKubernetes\u3001Docker\u3001Hugo \u7b49\u7b49\u3002</p> <p>Cobra\u8bf4\u660e\u6587\u6863</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#1\u5b89\u88c5cobra","title":"1.\u5b89\u88c5Cobra","text":"<p>\u5b89\u88c5\u672c\u9879\u76ee\u4f9d\u8d56\u7684\u57fa\u7840\u5e93 Cobra\uff0c\u4ee5\u4fbf\u5feb\u901f\u642d\u5efa CLI \u5e94\u7528\u7a0b\u5e8f\u3002\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e2d\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a <pre><code>go get -u github.com/spf13/cobra/cobra\ngo install github.com/spf13/cobra/cobra\n</code></pre></p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#11-\u7279\u6027\u9884\u89c8","title":"1.1 \u7279\u6027\u9884\u89c8","text":"<ul> <li> <p>\u4f7f\u7528cobra add cmdname\u53ef\u5feb\u901f\u7684\u521b\u5efa\u5b50\u547d\u4ee4cli</p> </li> <li> <p>\u5168\u5c40\u3001\u5c40\u90e8\u548c\u7ea7\u8054\u7684\u6807\u5fd7</p> </li> <li> <p>\u81ea\u52a8\u751f\u6210commands\u548cflags\u7684\u5e2e\u52a9\u4fe1\u606f</p> </li> <li> <p>\u81ea\u52a8\u8bc6\u522b -h\u3001--help \u7b49\u5e2e\u52a9\u6807\u8bc6</p> </li> <li> <p>\u652f\u6301\u81ea\u5b9a\u4e49\u5e2e\u52a9\u4fe1\u606f\uff0c\u7528\u6cd5\u7b49\u7684\u7075\u6d3b\u6027\u3002</p> </li> <li> <p>\u53ef\u4e0eviper \u7d27\u5bc6\u96c6\u6210</p> </li> </ul>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#12-\u76f8\u5173\u6982\u5ff5","title":"1.2 \u76f8\u5173\u6982\u5ff5","text":"<p>Cobra \u7ed3\u6784\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a\u547d\u4ee4 (commands)\u3001\u53c2\u6570 (arguments)\u3001\u6807\u5fd7 (flags)\u3002\u6700\u597d\u7684\u5e94\u7528\u7a0b\u5e8f\u5728\u4f7f\u7528\u65f6\u8bfb\u8d77\u6765\u50cf\u53e5\u5b50\uff0c\u8981\u9075\u5faa\u7684\u6a21\u5f0f\uff1a</p> <pre><code># \u6ca1\u6709\u5b50\u547d\u4ee4\napp cmd --param=\uff1f:\n\n# \u6709\u5b50\u547d\u4ee4\napp cmd subCmd --param=\uff1f\n</code></pre> <p>app:\u4ee3\u8868\u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u540d, cmd:\u4ee3\u8868\u547d\u4ee4 subCmd:\u4ee3\u8868\u5b50\u547d\u4ee4 --param: \u4ee3\u8868\u8bf7\u6c42\u53c2\u6570\u3002</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#2\u5feb\u901f\u811a\u624b\u67b6\u5f00\u53d1","title":"2.\u5feb\u901f\u811a\u624b\u67b6\u5f00\u53d1","text":""},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#21-\u4f7f\u7528cobra\u7684cli\u811a\u624b\u67b6","title":"2.1 \u4f7f\u7528cobra\u7684CLI\u811a\u624b\u67b6","text":"<p>\u5feb\u901f\u5b9e\u73b0\u4e00\u4e2aCLI\u5de5\u5177\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>$ mkdir mycalc &amp;&amp; cd mycalc\n# \u5982\u679c go modules \u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f\uff0c\u9700\u8981\u6267\u884c export GO111MODULE=on \u5f00\u542f\n$ go mod init mycalc\ngo: creating new go.mod: module mycalc\n</code></pre> <p>\u521d\u59cb\u5316\u5b8c\u6210\u540e\u53ef\u4ee5\u770b\u5230\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u9762\u591a\u4e86\u4e00\u4e2a go.mod \u7684\u6587\u4ef6\uff0c\u73b0\u5728\u6211\u4eec\u8fd8\u6ca1\u6709\u5b89\u88c5 cobra \u5e93\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u5b89\u88c5\uff1a</p> <pre><code># \u5f3a\u70c8\u63a8\u8350\u914d\u7f6e\u8be5\u73af\u5883\u53d8\u91cf\n$ export GOPROXY=https://goproxy.cn\n$ go install github.com/spf13/cobra-cli@latest\n$ go get -u github.com/spf13/cobra/cobra\n</code></pre> <p>\u5b89\u88c5\u6210\u529f\u540e\uff0c\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 cobra-cli init \u547d\u4ee4\u6765\u521d\u59cb\u5316 CLI \u5e94\u7528\u7684\u811a\u624b\u67b6\uff1a</p> <pre><code>$ cobra-cli init .\n</code></pre> <p>\u4e0a\u9762\u7684 init \u547d\u4ee4\u5c31\u4f1a\u521b\u5efa\u51fa\u4e00\u4e2a\u6700\u57fa\u672c\u7684 CLI \u5e94\u7528\u9879\u76ee\uff1a</p> <pre><code>$ tree .\n.\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 cmd\n\u2502   \u2514\u2500\u2500 root.go\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u2514\u2500\u2500 main.go\n</code></pre> <p>\u5176\u4e2d main.go \u662f CLI \u5e94\u7528\u7684\u5165\u53e3\uff0c\u5728 main.go \u91cc\u9762\u8c03\u7528\u597d\u4e86 cmd/root.go \u4e0b\u9762\u7684 Execute \u51fd\u6570\uff1a</p> <p><pre><code>/*\nCopyright \u00a9 2023 NAME HERE &lt;EMAIL ADDRESS&gt;\n*/\npackage main\nimport \"mycalc/cmd\"\nfunc main() {\ncmd.Execute()\n}\n</code></pre> \u7136\u540e\u6211\u4eec\u518d\u6765\u770b\u4e0b cmd/root.go \u6587\u4ef6\u3002</p> <pre><code>var rootCmd = &amp;cobra.Command{\nUse:   \"mycalc\",\nShort: \"A brief description of your application\",\nLong: `A longer description that spans multiple lines and likely contains\nexamples and usage of using your application. For example:\nCobra is a CLI library for Go that empowers applications.\nThis application is a tool to generate the needed files\nto quickly create a Cobra application.`,\n// Uncomment the following line if your bare application\n// has an action associated with it:\n// Run: func(cmd *cobra.Command, args []string) { },\nRun: func(cmd *cobra.Command, args []string) {\nfmt.Println(\"Hello Cobra CLI\")\n},\n}\n</code></pre> <p>\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u9762\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u6784\u5efa\uff1a</p> <pre><code>$ go build -o mycalc\n</code></pre> <p>\u8be5\u547d\u4ee4\u4f1a\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a\u540d\u4e3a mycalc \u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u76f4\u63a5\u6267\u884c\u8fd9\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u6240\u793a\u7684\u8f93\u51fa\u4fe1\u606f\uff1a</p> <pre><code>D:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe\nHello Cobra CL\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#22-init","title":"2.2 init","text":"<p>\u6211\u4eec\u77e5\u9053 init \u51fd\u6570\u662f Golang \u4e2d\u521d\u59cb\u5316\u5305\u7684\u65f6\u5019\u7b2c\u4e00\u4e2a\u8c03\u7528\u7684\u51fd\u6570\u3002</p> <p>\u5728 cmd/root.go \u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230 init \u51fd\u6570\u4e2d\u8c03\u7528\u4e86 cobra.OnInitialize(initConfig)\uff0c\u4e5f\u5c31\u662f\u6bcf\u5f53\u6267\u884c\u6216\u8005\u8c03\u7528\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u5b83\u90fd\u4f1a\u5148\u6267\u884c init \u51fd\u6570\u4e2d\u7684\u6240\u6709\u51fd\u6570\uff0c\u7136\u540e\u518d\u6267\u884c execute \u65b9\u6cd5\u3002</p> <p>\u8be5\u521d\u59cb\u5316\u53ef\u7528\u4e8e\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u6216\u7528\u4e8e\u6784\u9020\u51fd\u6570\u7b49\u7b49\uff0c\u8fd9\u5b8c\u5168\u4f9d\u8d56\u4e8e\u6211\u4eec\u5e94\u7528\u7684\u5b9e\u9645\u60c5\u51b5\u3002</p> <p>\u5728\u521d\u59cb\u5316\u51fd\u6570\u91cc\u9762 cobra.OnInitialize(initConfig) \u8c03\u7528\u4e86 initConfig \u8fd9\u4e2a\u51fd\u6570\uff0c\u6240\u4ee5\uff0c\u5f53 rootCmd \u7684\u6267\u884c\u65b9\u6cd5 RUN: func \u8fd0\u884c\u7684\u65f6\u5019\uff0crootCmd \u6839\u547d\u4ee4\u5c31\u4f1a\u9996\u5148\u8fd0\u884c initConfig \u51fd\u6570\uff0c\u5f53\u6240\u6709\u7684\u521d\u59cb\u5316\u51fd\u6570\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u4f1a\u6267\u884c rootCmd \u7684 RUN: func \u6267\u884c\u51fd\u6570\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728 initConfig \u51fd\u6570\u91cc\u9762\u6dfb\u52a0\u4e00\u4e9b Debug \u4fe1\u606f\uff1a</p> <pre><code>func initConfig() {\nfmt.Println(\"I'm inside initConfig function in cmd/root.go\")\n}\nfunc init() {\ncobra.OnInitialize(initConfig)\n}\n</code></pre> <p>\u7136\u540e\u540c\u6837\u91cd\u65b0\u6784\u5efa\u4e00\u6b21\u518d\u6267\u884c\uff1a <pre><code>D:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe\nI'm inside initConfig function in cmd/root.go\nHello Cobra CLI\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\u662f\u9996\u5148\u8fd0\u884c\u7684\u662f initConfig \u51fd\u6570\u91cc\u9762\u7684\u4fe1\u606f\uff0c\u7136\u540e\u624d\u662f\u771f\u6b63\u7684\u6267\u884c\u51fd\u6570\u91cc\u9762\u7684\u5185\u5bb9\u3002</p> <p>\u4e3a\u4e86\u641e\u6e05\u695a\u6574\u4e2a CLI \u6267\u884c\u7684\u6d41\u7a0b\uff0c\u6211\u4eec\u5728 main.go \u91cc\u9762\u4e5f\u6dfb\u52a0\u4e00\u4e9b Debug \u4fe1\u606f\uff1a</p> <p>cmd/root.go</p> <pre><code>/*\nCopyright \u00a9 2023 NAME HERE &lt;EMAIL ADDRESS&gt;\n*/\npackage cmd\nimport (\n\"fmt\"\n\"os\"\n\"github.com/spf13/cobra\"\n)\nvar rootCmd = &amp;cobra.Command{\nUse:   \"mycalc\",\nShort: \"A brief description of your application\",\nLong: `A longer description that spans multiple lines and likely contains\nexamples and usage of using your application. For example:\nCobra is a CLI library for Go that empowers applications.\nThis application is a tool to generate the needed files\nto quickly create a Cobra application.`,\n// Uncomment the following line if your bare application\n// has an action associated with it:\n// Run: func(cmd *cobra.Command, args []string) { },\nRun: func(cmd *cobra.Command, args []string) {\nfmt.Println(\"Hello Cobra CLI\")\n},\n}\nfunc Execute() {\nerr := rootCmd.Execute()\nif err != nil {\nos.Exit(1)\n}\n}\nfunc initConfig() {\nfmt.Println(\"I'm inside initConfig function in cmd/root.go\")\n}\nfunc init() {\nfmt.Println(\"I'm inside init function in cmd/root.go\")\ncobra.OnInitialize(initConfig)\n}\n</code></pre> <p>main.go</p> <pre><code>/*\nCopyright \u00a9 2023 NAME HERE &lt;EMAIL ADDRESS&gt;\n*/\npackage main\nimport (\n\"fmt\"\n\"mycalc/cmd\"\n)\nfunc main() {\nfmt.Println(\"I'm inside main function in main.go\")\ncmd.Execute()\n}\n</code></pre> <p>\u7136\u540e\u540c\u6837\u91cd\u65b0\u6784\u5efa\u4e00\u6b21\u518d\u6267\u884c\uff1a</p> <pre><code>D:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe\nI'm inside init function in cmd/root.go\nI'm inside main function in main.go\nI'm inside initConfig function in cmd/root.go\nHello Cobra CLI\n</code></pre> <p>\u6839\u636e\u4e0a\u9762\u7684\u65e5\u5fd7\u4fe1\u606f\u6211\u4eec\u5c31\u53ef\u4ee5\u4e86\u89e3\u5230 CLI \u547d\u4ee4\u7684\u6d41\u7a0b\u4e86\u3002</p> <p>init \u51fd\u6570\u6700\u540e\u5904\u7406\u7684\u5c31\u662f flags \u4e86\uff0cFlags \u5c31\u7c7b\u4f3c\u4e8e\u547d\u4ee4\u7684\u6807\u8bc6\u7b26\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4ed6\u4eec\u770b\u6210\u662f\u67d0\u79cd\u6761\u4ef6\u64cd\u4f5c\uff0c\u5728 Cobra \u4e2d\u63d0\u4f9b\u4e86\u4e24\u79cd\u7c7b\u578b\u7684\u6807\u8bc6\u7b26\uff1aPersistent Flags \u548c Local Flags\u3002</p> <ul> <li>Persistent Flags: \u8be5\u6807\u5fd7\u53ef\u7528\u4e8e\u4e3a\u5176\u5206\u914d\u7684\u547d\u4ee4\u4ee5\u53ca\u8be5\u547d\u4ee4\u7684\u6240\u6709\u5b50\u547d\u4ee4\u3002</li> <li>Local Flags: \u8be5\u6807\u5fd7\u53ea\u80fd\u7528\u4e8e\u5206\u914d\u7ed9\u5b83\u7684\u547d\u4ee4\u3002</li> </ul>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#23-initconfig","title":"2.3 initConfig","text":"<p>\u8be5\u51fd\u6570\u4e3b\u8981\u7528\u4e8e\u5728 home \u76ee\u5f55\u4e0b\u9762\u8bbe\u7f6e\u4e00\u4e2a\u540d\u4e3a .my-calc \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u679c\u8be5\u6587\u4ef6\u5b58\u5728\u5219\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002</p> <pre><code>// cmd/root.go\n// initConfig \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u548c\u73af\u5883\u53d8\u91cf\nfunc initConfig() {\nif cfgFile != \"\" {\n// \u4f7f\u7528 flag \u6807\u5fd7\u4e2d\u4f20\u9012\u7684\u914d\u7f6e\u6587\u4ef6\nviper.SetConfigFile(cfgFile)\n} else {\n// \u83b7\u53d6 Home \u76ee\u5f55\nhome, err := homedir.Dir()\nif err != nil {\nfmt.Println(err)\nos.Exit(1)\n}\n// \u5728 Home \u76ee\u5f55\u4e0b\u9762\u67e5\u627e\u540d\u4e3a \".my-calc\" \u7684\u914d\u7f6e\u6587\u4ef6\nviper.AddConfigPath(home)\nviper.SetConfigName(\".my-calc\")\n}\n// \u8bfb\u53d6\u5339\u914d\u7684\u73af\u5883\u53d8\u91cf\nviper.AutomaticEnv()\n// \u5982\u679c\u6709\u914d\u7f6e\u6587\u4ef6\uff0c\u5219\u8bfb\u53d6\u5b83\nif err := viper.ReadInConfig(); err == nil {\nfmt.Println(\"Using config file:\", viper.ConfigFileUsed())\n}\n}\n</code></pre> <p><code>viper</code> \u662f\u4e00\u4e2a\u975e\u5e38\u4f18\u79c0\u7684\u7528\u4e8e\u89e3\u51b3\u914d\u7f6e\u6587\u4ef6\u7684 Golang \u5e93\uff0c\u5b83\u53ef\u4ee5\u4ece JSON\u3001TOML\u3001YAML\u3001HCL\u3001envfile \u4ee5\u53ca Java properties \u914d\u7f6e\u6587\u4ef6\u4e2d\u8bfb\u53d6\u4fe1\u606f\uff0c\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff0c\u800c\u4e14\u4e0d\u4ec5\u4ec5\u662f\u8bfb\u53d6\u914d\u7f6e\u8fd9\u4e48\u7b80\u5355\uff0c</p> <p>\u4e86\u89e3\u66f4\u591a\u76f8\u5173\u4fe1\u606f\u53ef\u4ee5\u67e5\u770b Git \u4ed3\u5e93\u76f8\u5173\u4ecb\u7ecd\uff1ahttps://github.com/spf13/viper\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u53bb\u6389\u524d\u9762\u6211\u4eec\u6dfb\u52a0\u7684\u4e00\u4e9b\u6253\u5370\u8bed\u53e5\uff0c\u6211\u4eec\u5df2\u7ecf\u521b\u5efa\u4e86\u4e00\u4e2a mycalc \u547d\u4ee4\u4f5c\u4e3a rootCmd \u547d\u4ee4\uff0c\u6267\u884c\u8be5\u6839\u547d\u4ee4\u4f1a\u6253\u5370 Hello Cobra CLI \u4fe1\u606f\uff0c\u63a5\u4e0b\u6765\u4e3a\u6211\u4eec\u7684 CLI \u5e94\u7528\u6dfb\u52a0\u4e00\u4e9b\u5176\u4ed6\u7684\u547d\u4ee4\u3002</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#24-\u6dfb\u52a0\u6570\u636e","title":"2.4 \u6dfb\u52a0\u6570\u636e","text":"<p>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u9762\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a add \u7684\u547d\u4ee4\uff0cCobra \u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u547d\u4ee4\u7684\u65b9\u5f0f\u4e3a\uff1a<code>cobra add &lt;commandName&gt;</code>\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u76f4\u63a5\u8fd9\u6837\u6267\u884c\uff1a</p> <pre><code>$ cobra-cli add add\n\n$ tree .\n.\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 cmd\n\u2502   \u251c\u2500\u2500 add.go\n\u2502   \u2514\u2500\u2500 root.go\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 mycalc.exe\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u770b\u5230 cmd/root.go \u6587\u4ef6\u4e2d\u65b0\u589e\u4e86\u4e00\u4e2a add.go \u7684\u6587\u4ef6\uff0c\u6211\u4eec\u4ed4\u7ec6\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\u8be5\u6587\u4ef6\u548c cmd/root.go \u6bd4\u8f83\u7c7b\u4f3c\u3002</p> <p>\u9996\u5148\u662f\u58f0\u660e\u4e86\u4e00\u4e2a\u540d\u4e3a addCmd \u7684\u7ed3\u6784\u4f53\u53d8\u91cf\uff0c\u7c7b\u578b\u4e3a *cobra.Command \u6307\u9488\u7c7b\u578b\uff0c*cobra.Command \u6709\u4e00\u4e2a RUN \u51fd\u6570\uff0c\u5e26\u6709 *cobra.Command \u6307\u9488\u548c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5207\u7247\u53c2\u6570\u3002</p> <p>\u7136\u540e\u5728 init \u51fd\u6570\u4e2d\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u521d\u59cb\u5316\u540e\uff0c\u5c06\u5176\u6dfb\u52a0\u5230 rootCmd \u6839\u547d\u4ee4\u4e2d rootCmd.AddCommand(addCmd)\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a addCmd \u770b\u6210\u662f rootCmd \u7684\u5b50\u547d\u4ee4\u3002</p> <p>\u540c\u6837\u73b0\u5728\u91cd\u65b0\u6784\u5efa\u5e94\u7528\u518d\u6267\u884c:</p> <pre><code>D:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe\nHello Cobra CLI\n\nD:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe add\nadd called\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 add \u547d\u4ee4\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u8ba9\u6539\u547d\u4ee4\u652f\u6301\u6dfb\u52a0\u4e00\u4e9b\u6570\u5b57\uff0c\u6211\u4eec\u77e5\u9053\u5728 RUN \u51fd\u6570\u4e2d\u662f\u7528\u6237\u5b57\u7b26\u4e32 slice \u6765\u4f5c\u4e3a\u53c2\u6570\u7684\uff0c\u6240\u4ee5\u8981\u652f\u6301\u6dfb\u52a0\u6570\u5b57\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a int \u7c7b\u578b\uff0c\u8fd4\u56de\u8fd4\u56de\u8ba1\u7b97\u7ed3\u679c\u3002</p> <p>\u5728 internal/add/add.go \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a IntAdd \u7684\u51fd\u6570\uff0c\u5b9a\u4e49\u5982\u4e0b\u6240\u793a</p> <pre><code>// add project add.go\npackage add\nimport (\n\"fmt\"\n\"strconv\"\n)\nfunc IntAdd(args []string) {\nvar sum int\n// \u5faa\u73af args \u53c2\u6570\uff0c\u5faa\u73af\u7684\u7b2c\u4e00\u4e2a\u503c\u4e3a args \u7684\u7d22\u5f15\uff0c\u8fd9\u91cc\u6211\u4eec\u4e0d\u9700\u8981\uff0c\u6240\u4ee5\u7528 _ \u5ffd\u7565\u6389\nfor _, ival := range args {\n// \u5c06 string \u8f6c\u6362\u6210 int \u7c7b\u578b\ntemp, err := strconv.Atoi(ival)\nif err != nil {\npanic(err)\n}\nsum = sum + temp\n}\nfmt.Printf(\"Addition of numbers %s is %d\\n\", args, sum)\n</code></pre> <p>cmd/add.go</p> <pre><code>package cmd\nimport (\n\"mycalc/internal/add\"\n\"github.com/spf13/cobra\"\n)\n// addCmd represents the add command\nvar addCmd = &amp;cobra.Command{\nUse:   \"add\",\nShort: \"A brief description of your application\",\nLong: `A longer description that spans multiple lines and likely contains\nexamples and usage of using your application. For example:\nCobra is a CLI library for Go that empowers applications.\nThis application is a tool to generate the needed files\nto quickly create a Cobra application.`,\nRun: func(cmd *cobra.Command, args []string) {\nadd.IntAdd(args)\n},\n}\nfunc init() {\nrootCmd.AddCommand(addCmd)\n}\n</code></pre> <p>\u7136\u540e\u91cd\u65b0\u6784\u5efa\u5e94\u7528\u6267\u884c\u5982\u4e0b\u6240\u793a\u7684\u547d\u4ee4\uff1a</p> <pre><code>D:\\golang\\go\\src\\github\\mycalc&gt;go build -o mycalc.exe\n\nD:\\golang\\go\\src\\github\\mycalc&gt;mycalc add 1 2 3\nAddition of numbers [1 2 3] is 6\n</code></pre> <p>\u7531\u4e8e RUN \u51fd\u6570\u4e2d\u7684 args \u53c2\u6570\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u5207\u7247\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f20\u9012\u4efb\u610f\u6570\u91cf\u7684\u53c2\u6570\uff0c\u4f46\u662f\u786e\u6709\u4e00\u4e2a\u7f3a\u9677\uff0c\u5c31\u662f\u53ea\u80fd\u8fdb\u884c\u6574\u6570\u8ba1\u7b97\uff0c\u4e0d\u80fd\u8ba1\u7b97\u5c0f\u6570\uff0c\u6bd4\u5982\u6211\u4eec\u6267\u884c\u5982\u4e0b\u7684\u8ba1\u7b97\u5c31\u4f1a\u76f4\u63a5 panic \u4e86:</p> <pre><code>D:\\golang\\go\\src\\github\\mycalc&gt;mycalc add 1 2 3.2\npanic: strconv.Atoi: parsing \"3.2\": invalid syntax\n\ngoroutine 1 [running]:\nmycalc/internal/add.IntAdd({0xc0000a62d0, 0x3, 0x3})\nD:/golang/go/src/github/mycalc/internal/add/add.go:16 +0x125\nmycalc/cmd.glob..func1(0x167bc20?, {0xc0000a62d0?, 0x3?, 0x3?}\n.....\n</code></pre> <p>\u56e0\u4e3a\u5728 intAdd \u51fd\u6570\u91cc\u9762\uff0c\u6211\u4eec\u53ea\u662f\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u4e86 int\uff0c\u800c\u4e0d\u662f float32/64 \u7c7b\u578b\uff0c \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4e3a addCmd \u547d\u4ee4\u6dfb\u52a0\u4e00\u4e2a flag \u6807\u8bc6\u7b26\uff0c\u901a\u8fc7\u8be5\u6807\u8bc6\u7b26\u6765\u5e2e\u52a9 CLI \u786e\u5b9a\u5b83\u662f int \u8ba1\u7b97\u8fd8\u662f float \u8ba1\u7b97\u3002 \u5728 cmd/add.go \u6587\u4ef6\u7684 init \u51fd\u6570\u5185\u90e8\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a Bool \u7c7b\u578b\u7684\u672c\u5730\u6807\u8bc6\u7b26\uff0c\u547d\u540d\u6210 float\uff0c\u7b80\u5199\u6210 f\uff0c\u9ed8\u8ba4\u503c\u4e3a false\u3002</p> <p>\u8fd9\u4e2a\u9ed8\u8ba4\u503c\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u610f\u601d\u5c31\u662f\u5373\u4f7f\u6ca1\u6709\u5728\u547d\u4ee4\u884c\u4e2d\u8c03\u7528 flag \u6807\u8bc6\u7b26\uff0c\u8be5\u6807\u8bc6\u7b26\u7684\u503c\u5c31\u5c06\u4e3a false\u3002</p> <p>\u5728 internal/add/add.go \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a FloatAdd \u7684\u51fd\u6570 <pre><code>func FloatAdd(args []string) {\nvar sum float64\nfor _, fval := range args {\n// \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210 float64 \u7c7b\u578b\ntemp, err := strconv.ParseFloat(fval, 64)\nif err != nil {\npanic(err)\n}\nsum = sum + temp\n}\nfmt.Printf(\"Sum of floating numbers %s is %f\\n\", args, sum)\n}\n</code></pre></p> <p>cmd/add.go</p> <pre><code>package cmd\nimport (\n\"mycalc/internal/add\"\n\"github.com/spf13/cobra\"\n)\n// addCmd represents the add command\nvar addCmd = &amp;cobra.Command{\nUse:   \"add\",\nShort: \"A brief description of your application\",\nLong: `A longer description that spans multiple lines and likely contains\nexamples and usage of using your application. For example:\nCobra is a CLI library for Go that empowers applications.\nThis application is a tool to generate the needed files\nto quickly create a Cobra application.`,\nRun: func(cmd *cobra.Command, args []string) {\n// \u5982\u679c create \u547d\u4ee4\u540e\u6ca1\u6709\u53c2\u6570\uff0c\u5219\u63d0\u793a\u5e2e\u52a9\u4fe1\u606f\nif len(args) == 0 {\ncmd.Help()\nreturn\n}\n// \u83b7\u53d6 float \u6807\u8bc6\u7b26\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a false\nfstatus, _ := cmd.Flags().GetBool(\"float\")\nif fstatus { // \u5982\u679c\u4e3a true\uff0c\u5219\u8c03\u7528 floatAdd \u51fd\u6570\nadd.FloatAdd(args)\n} else {\nadd.IntAdd(args)\n}\n},\n}\nfunc init() {\nrootCmd.AddCommand(addCmd)\naddCmd.Flags().BoolP(\"float\", \"f\", false, \"Add Floating Numbers\")\n}\n</code></pre> <p>\u73b0\u5728\u91cd\u65b0\u7f16\u8bd1\u6784\u5efa CLI \u5e94\u7528\uff0c\u6309\u7167\u5982\u4e0b\u65b9\u5f0f\u6267\u884c\uff1a</p> <pre><code>D:\\golang\\go\\src\\github\\mycalc&gt;go build -o mycalc.exe\n\nD:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe add 1 2 3\nAddition of numbers [1 2 3] is 6\nD:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe add 1 2 3 -f\nSum of floating numbers [1 2 3] is 6.000000\n\nD:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe add 1 2 3 --float\nSum of floating numbers [1 2 3] is 6.000000\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#25-\u6dfb\u52a0\u5076\u6570","title":"2.5 \u6dfb\u52a0\u5076\u6570","text":"<p>\u540c\u6837\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a even \u7684\u547d\u4ee4\uff1a <pre><code>cobra-cli add even\n</code></pre></p> <p>\u548c\u4e0a\u9762\u4e00\u6837\u4f1a\u5728 root \u76ee\u5f55\u4e0b\u9762\u65b0\u589e\u4e00\u4e2a\u540d\u4e3a even.go \u7684\u6587\u4ef6\uff0c\u4fee\u6539\u8be5\u6587\u4ef6\u4e2d\u7684 init \u51fd\u6570\uff0c\u5c06 rootCmd \u4fee\u6539\u4e3a addCmd\uff0c\u56e0\u4e3a\u6211\u4eec\u662f\u4e3a addCmd \u6dfb\u52a0\u5b50\u547d\u4ee4:\\</p> <p>cmd/even.go</p> <pre><code>// cmd/even.go\nfunc init() {\naddCmd.AddCommand(evenCmd)\n}\n</code></pre> <p>\u7136\u540e\u66f4\u65b0 evenCmd \u7ed3\u6784\u4f53\u53c2\u6570\u7684 RUN \u51fd\u6570:</p> <pre><code>var evenCmd = &amp;cobra.Command{\n.....\nRun: func(cmd *cobra.Command, args []string) {\nvar evenSum int\nfor _, ival := range args {\ntemp, _ := strconv.Atoi(ival)\nif temp%2 == 0 {\nevenSum = evenSum + temp\n}\n}\nfmt.Printf(\"The even addition of %s is %d\\n\", args, evenSum)\n},\n}\n</code></pre> <p>\u9996\u5148\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u6574\u6570\uff0c\u7136\u540e\u5224\u65ad\u5982\u679c\u662f\u5076\u6570\u624d\u8fdb\u884c\u7d2f\u52a0\u3002\u7136\u540e\u91cd\u65b0\u7f16\u8bd1\u6784\u5efa\u5e94\u7528:</p> <pre><code>D:\\golang\\go\\src\\github\\mycalc&gt;go build -o mycalc.exe\n\nD:\\golang\\go\\src\\github\\mycalc&gt;mycalc.exe add even 1 2 3 4 5 6\nThe even addition of [1 2 3 4 5 6] is 12\n</code></pre> <p>mycalc \u662f\u6211\u4eec\u7684\u6839\u547d\u4ee4\uff0cadd \u662f rootCmd \u7684\u5b50\u547d\u4ee4\uff0ceven \u53c8\u662f addCmd \u7684\u5b50\u547d\u4ee4\uff0c\u6240\u4ee5\u6309\u7167\u4e0a\u9762\u7684\u65b9\u5f0f\u8c03\u7528\u3002\u53ef\u4ee5\u7528\u540c\u6837\u7684\u65b9\u5f0f\u518d\u53bb\u6dfb\u52a0\u4e00\u4e2a\u5947\u6570\u76f8\u52a0\u7684\u5b50\u547d\u4ee4\u3002</p> <p>\u5230\u8fd9\u91cc\u6211\u4eec\u5c31\u5728 Golang \u91cc\u9762\u4f7f\u7528 Cobra \u521b\u5efa\u4e86\u4e00\u4e2a\u7b80\u5355\u7684 CLI \u5e94\u7528\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u6dfb\u52a0\u4e00\u4e9b\u66f4\u52a0\u51e0\u4e2a\u5b9e\u7528\u7684\u6848\u4f8b\u3002</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#3\u5b9e\u8df5-\u5355\u8bcd\u8f6c\u6362demo","title":"3.\u5b9e\u8df5-\u5355\u8bcd\u8f6c\u6362demo","text":"<p>\u4e0b\u9762\u5bf9\u9879\u76ee\u76ee\u5f55\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\u6240\u793a\uff1a <pre><code>D:\\GOLANG\\GO\\SRC\\GITHUB\\tour\n\u251c\u2500cmd\n    \u2514\u2500root.go\n    \u2514\u2500word.go\n\u251c\u2500main.go\n\u251c\u2500go.mod\n\u251c\u2500go.sum\n\u2514\u2500internal\n    \u2514\u2500word\n</code></pre></p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#31-\u5b9e\u73b0","title":"3.1 \u5b9e\u73b0","text":"<p>\u5728\u672c\u9879\u76ee\u4e2d\u521b\u5efa\u5165\u53e3\u6587\u4ef6main.go\uff0c\u5e76\u65b0\u589e\u4e09\u4e2a\u76ee\u5f55\uff0c\u5206\u522b\u662fcmd\u3001internal\u3002</p> <p>\u9996\u5148\uff0c\u5728cmd\u76ee\u5f55\u4e0b\u65b0\u5efaword.go\u6587\u4ef6\uff0c\u7528\u4e8e\u653e\u7f6e\u5355\u8bcd\u683c\u5f0f\u8f6c\u6362\u7684\u5b50\u547d\u4ee4word\uff0c\u5e76\u5728\u5176\u4e2d\u5199\u5165\u5982\u4e0b\u4ee3\u7801\uff1a</p> <p>cmd/word.go</p> <pre><code>package cmd\nimport (\n\"log\"\n\"strings\"\n\"tour/internal/word\"\n\"github.com/spf13/cobra\"\n)\n// \u5b9a\u4e49iota\u5e38\u91cf\uff0c\u6570\u5b57\u9012\u589e+1\n// \u5b9a\u4e49\u76ee\u524d\u5355\u8bcd\u6240\u652f\u6301\u7684\u8f6c\u6362\u6a21\u5f0f\u679a\u4e3e\u503c\uff0c\nconst (\nModeUpper                      = iota + 1 // \u5168\u90e8\u8f6c\u5927\u5199\nModeLower                                 // \u5168\u90e8\u8f6c\u5c0f\u5199\nModeUnderscoreToUpperCamelCase            // \u4e0b\u5212\u7ebf\u8f6c\u5927\u5199\u9a7c\u5cf0\nModeUnderscoreToLowerCamelCase            // \u4e0b\u7ebf\u7ebf\u8f6c\u5c0f\u5199\u9a7c\u5cf0\nModeCamelCaseToUnderscore                 // \u9a7c\u5cf0\u8f6c\u4e0b\u5212\u7ebf\n)\nvar str string\nvar mode int8\n// help\u547d\u4ee4\u8f93\u51fa\u5e2e\u52a9\u4fe1\u606f\nvar desc = strings.Join([]string{\n\"\u8be5\u5b50\u547d\u4ee4\u652f\u6301\u5404\u79cd\u5355\u8bcd\u683c\u5f0f\u8f6c\u6362\uff0c\u6a21\u5f0f\u5982\u4e0b\uff1a\",\n\"1\uff1a\u5168\u90e8\u8f6c\u5927\u5199\",\n\"2\uff1a\u5168\u90e8\u8f6c\u5c0f\u5199\",\n\"3\uff1a\u4e0b\u5212\u7ebf\u8f6c\u5927\u5199\u9a7c\u5cf0\",\n\"4\uff1a\u4e0b\u5212\u7ebf\u8f6c\u5c0f\u5199\u9a7c\u5cf0\",\n\"5\uff1a\u9a7c\u5cf0\u8f6c\u4e0b\u5212\u7ebf\",\n}, \"\\n\")\nvar wordCmd = &amp;cobra.Command{\nUse:   \"word\",\nShort: \"\u5355\u8bcd\u683c\u5f0f\u8f6c\u6362\",\nLong:  desc,\nRun: func(cmd *cobra.Command, args []string) {\nvar content string\nswitch mode {\ncase ModeUpper:\ncontent = word.ToUpper(str)\ncase ModeLower:\ncontent = word.ToLower(str)\ncase ModeUnderscoreToUpperCamelCase:\ncontent = word.UnderscoreToUpperCamelCase(str)\ncase ModeUnderscoreToLowerCamelCase:\ncontent = word.UnderscoreToLowerCamelCase(str)\ncase ModeCamelCaseToUnderscore:\ncontent = word.CamelCaseToUnderscore(str)\ndefault:\nlog.Fatalf(\"\u6682\u4e0d\u652f\u6301\u8be5\u8f6c\u6362\u6a21\u5f0f\uff0c\u8bf7\u6267\u884c help word \u67e5\u770b\u5e2e\u52a9\u6587\u6863\")\n}\nlog.Printf(\"\u8f93\u51fa\u7ed3\u679c: %s\", content)\n},\n}\nfunc init() {\nwordCmd.Flags().StringVarP(&amp;str, \"str\", \"s\", \"\", \"\u8bf7\u8f93\u5165\u5355\u8bcd\u5185\u5bb9\")\nwordCmd.Flags().Int8VarP(&amp;mode, \"mode\", \"m\", 0, \"\u8bf7\u8f93\u5165\u5355\u8bcd\u8f6c\u6362\u7684\u6a21\u5f0f\")\n}\n</code></pre> <p>\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u5176\u6838\u5fc3\u5728\u4e8e\u5b50\u547d\u4ee4word\u7684 cobra.Command \u8c03\u7528\u548c\u8bbe\u7f6e\uff0c\u5176\u4e00\u5171\u5305\u542b\u5982\u4e0b\u4e09\u4e2a\u5e38\u7528\u9009\u9879\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>Use\uff1a\u5b50\u547d\u4ee4\u7684\u547d\u4ee4\u6807\u8bc6\u3002</li> <li>Short\uff1a\u7b80\u77ed\u8bf4\u660e\uff0c\u5728help\u547d\u4ee4\u8f93\u51fa\u7684\u5e2e\u52a9\u4fe1\u606f\u4e2d\u5c55\u793a\u3002</li> <li>Long\uff1a\u5b8c\u6574\u8bf4\u660e\uff0c\u5728help\u547d\u4ee4\u8f93\u51fa\u7684\u5e2e\u52a9\u4fe1\u606f\u4e2d\u5c55\u793a\u3002</li> </ul> <p>init() \u51fd\u6570\u89e3\u8bfb\uff1a</p> <p>\u5728VarP\u7cfb\u5217\u7684\u65b9\u6cd5\u4e2d\uff0c</p> <ul> <li> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u9700\u8981\u7ed1\u5b9a\u7684\u53d8\u91cf</p> </li> <li> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u63a5\u6536\u8be5\u53c2\u6570\u7684\u5b8c\u6574\u7684\u547d\u4ee4\u6807\u5fd7</p> </li> <li> <p>\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a\u5bf9\u5e94\u7684\u77ed\u6807\u8bc6</p> </li> <li> <p>\u7b2c\u56db\u4e2a\u53c2\u6570\u4e3a\u9ed8\u8ba4\u503c</p> </li> <li> <p>\u7b2c\u4e94\u4e2a\u53c2\u6570\u4e3a\u4f7f\u7528\u8bf4\u660e\u3002</p> </li> </ul> <p>\u7136\u540e\uff0c\u5728cmd\u76ee\u5f55\u4e0b\u65b0\u5efaroot.go\u6587\u4ef6\uff0c\u7528\u4e8e\u653e\u7f6e\u6839\u547d\u4ee4\uff0c\u5e76\u5728\u5176\u4e2d\u5199\u5165\u5982\u4e0b\u4ee3\u7801\uff1a</p> <p>cmd/root.go</p> <pre><code>var rootCmd = &amp;cobra.Command{\nUse:   \"\",\nShort: \"\",\nLong:  \"\",\n}\nfunc Execute() error {\nreturn rootCmd.Execute()\n}\nfunc init() {\nrootCmd.AddCommand(wordCmd)\n}\n</code></pre> <p>\u6700\u540e\uff0c\u5728\u542f\u52a8main.go\u6587\u4ef6\u4e2d\uff0c\u5199\u5165\u5982\u4e0b\u8fd0\u884c\u4ee3\u7801\uff1a</p> <pre><code>func main() {\nerr := cmd.Execute()\nif err != nil {\nlog.Fatalf(\"cmd.Execute err: %v\", err)\n}\n}\n</code></pre> <p>\u6700\u540e\uff0c\u5728\u542f\u52a8main.go\u6587\u4ef6\u4e2d\uff0c\u5199\u5165\u5982\u4e0b\u8fd0\u884c\u4ee3\u7801\uff1a</p> <pre><code>package main\nimport (\n\"log\"\n\"tour/cmd\"\n)\nfunc main() {\nerr := cmd.Execute()\nif err != nil {\nlog.Fatalf(\"cmd.Execute err: %v\", err)\n}\n}\n</code></pre> <p>\u5728\u9879\u76ee\u7684internal\u76ee\u5f55\u4e0b\uff0c\u65b0\u5efaword\u76ee\u5f55\u53ca\u6587\u4ef6\uff0c\u5e76\u5728word.go\u4e2d\u5199\u5165\u5177\u4f53\u5b9e\u73b0</p> <p>\u529f\u80fd\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u5355\u8bcd\u5168\u90e8\u8f6c\u4e3a\u5c0f\u5199\u3002</p> </li> <li> <p>\u5355\u8bcd\u5168\u90e8\u8f6c\u4e3a\u5927\u5199\u3002</p> </li> <li> <p>\u4e0b\u753b\u7ebf\u5355\u8bcd\u8f6c\u4e3a\u5927\u5199\u9a7c\u5cf0\u5355\u8bcd\u3002</p> </li> <li> <p>\u4e0b\u753b\u7ebf\u5355\u8bcd\u8f6c\u4e3a\u5c0f\u5199\u9a7c\u5cf0\u5355\u8bcd\u3002</p> </li> <li> <p>\u9a7c\u5cf0\u5355\u8bcd\u8f6c\u4e3a\u4e0b\u753b\u7ebf\u5355\u8bcd\u3002</p> </li> </ol> <p>internal/word/word.go</p> <pre><code>package word\nimport (\n\"strings\"\n\"unicode\"\n)\n// \u5355\u8bcd\u5168\u90e8\u8f6c\u4e3a\u5c0f\u5199\u3002\nfunc ToUpper(s string) string {\nreturn strings.ToUpper(s)\n}\n// \u5355\u8bcd\u5168\u90e8\u8f6c\u4e3a\u5927\u5199\u3002\nfunc ToLower(s string) string {\nreturn strings.ToLower(s)\n}\n// \u4e0b\u753b\u7ebf\u5355\u8bcd\u8f6c\u4e3a\u5927\u5199\u9a7c\u5cf0\u5355\u8bcd\u3002\nfunc UnderscoreToUpperCamelCase(s string) string {\ns = strings.Replace(s, \"_\", \" \", -1)\ns = strings.Title(s)\nreturn strings.Replace(s, \" \", \"\", -1)\n}\n// \u4e0b\u753b\u7ebf\u5355\u8bcd\u8f6c\u4e3a\u5c0f\u5199\u9a7c\u5cf0\u5355\u8bcd\u3002\nfunc UnderscoreToLowerCamelCase(s string) string {\ns = UnderscoreToUpperCamelCase(s)\nreturn string(unicode.ToLower(rune(s[0]))) + s[1:]\n}\n// \u9a7c\u5cf0\u5355\u8bcd\u8f6c\u4e3a\u4e0b\u753b\u7ebf\u5355\u8bcd\u3002\nfunc CamelCaseToUnderscore(s string) string {\nvar output []rune\nfor i, r := range s {\nif i == 0 {\noutput = append(output, unicode.ToLower(r))\ncontinue\n}\nif unicode.IsUpper(r) {\noutput = append(output, '_')\n}\noutput = append(output, unicode.ToLower(r))\n}\nreturn string(output)\n}\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#32-\u9a8c\u8bc1","title":"3.2 \u9a8c\u8bc1","text":"<p>\u5728\u62ff\u5230\u4e00\u4e2aCLI\u5e94\u7528\u7a0b\u5e8f\u540e\uff0c\u6211\u4eec\u4f1a\u5148\u6267\u884chelp\u547d\u4ee4\u67e5\u770b\u5176\u5e2e\u52a9\u4fe1\u606f\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <pre><code>D:\\golang\\go\\src\\github\\tour&gt;tour.exe\nUsage:\n   [command]\nAvailable Commands:\n  completion  Generate the autocompletion script for the specified shell\n  help        Help about any command\nword        \u5355\u8bcd\u683c\u5f0f\u8f6c\u6362\n\nFlags:\n  -h, --help   help for this command\nUse \" [command] --help\" for more information about a command.\n\nD:\\golang\\go\\src\\github\\tour&gt;tour.exe help word\n\u8be5\u5b50\u547d\u4ee4\u652f\u6301\u5404\u79cd\u5355\u8bcd\u683c\u5f0f\u8f6c\u6362\uff0c\u6a21\u5f0f\u5982\u4e0b\uff1a\n1\uff1a\u5168\u90e8\u8f6c\u5927\u5199\n2\uff1a\u5168\u90e8\u8f6c\u5c0f\u5199\n3\uff1a\u4e0b\u5212\u7ebf\u8f6c\u5927\u5199\u9a7c\u5cf0\n4\uff1a\u4e0b\u5212\u7ebf\u8f6c\u5c0f\u5199\u9a7c\u5cf0\n5\uff1a\u9a7c\u5cf0\u8f6c\u4e0b\u5212\u7ebf\n\nUsage:\n   word [flags]\nFlags:\n  -h, --help         help for word\n  -m, --mode int8    \u8bf7\u8f93\u5165\u5355\u8bcd\u8f6c\u6362\u7684\u6a21\u5f0f\n  -s, --str string   \u8bf7\u8f93\u5165\u5355\u8bcd\u5185\u5bb9\n\nD:\\golang\\go\\src\\github\\tour&gt;tour.exe word -s=hujianli722 -m=1\n2023/07/27 10:04:23 \u8f93\u51fa\u7ed3\u679c: HUJIANLI722\n\nD:\\golang\\go\\src\\github\\tour&gt;tour.exe word -s=hujIANLI722 -m=2\n2023/07/27 10:04:36 \u8f93\u51fa\u7ed3\u679c: hujianli722\n\nD:\\golang\\go\\src\\github\\tour&gt;tour.exe word -s=hujianli_xiaojian -m=3\n2023/07/27 10:04:57 \u8f93\u51fa\u7ed3\u679c: HujianliXiaojian\n\nD:\\golang\\go\\src\\github\\tour&gt;tour.exe word -s=hu_jian_li -m=4\n2023/07/27 10:06:52 \u8f93\u51fa\u7ed3\u679c: huJianLi\n\nD:\\golang\\go\\src\\github\\tour&gt;tour.exe word -s=HuJianLi -m=5\n2023/07/27 10:06:59 \u8f93\u51fa\u7ed3\u679c: hu_jian_li\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#4\u5b9e\u8df5-cobra\u96c6\u6210viper","title":"4.\u5b9e\u8df5-Cobra\u96c6\u6210viper","text":"<p>app\u4ed3\u5e93\u4e0bmaster\u5206\u652f</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#5\u5b9e\u8df5-\u5f00\u53d1\u7c7b\u4f3cdocker\u7684\u547d\u4ee4\u884c","title":"5.\u5b9e\u8df5-\u5f00\u53d1\u7c7b\u4f3cdocker\u7684\u547d\u4ee4\u884c","text":"<p>app\u4ed3\u5e93\u4e0bdocker-cli\u5206\u652f</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/1.cobra/#6\u5b9e\u8df53-\u5f00\u53d1\u7c7b\u4f3ccat\u7684\u547d\u4ee4\u884c","title":"6.\u5b9e\u8df53-\u5f00\u53d1\u7c7b\u4f3ccat\u7684\u547d\u4ee4\u884c","text":"<p>app\u4ed3\u5e93\u4e0b\u7684cat-cli\u5206\u652f</p> <p>\u53c2\u8003\u6587\u732e</p> <p>Cobra \u4e2d\u6587\u6587\u6863</p> <p>go\u5305\uff1acobra\u547d\u4ee4</p> <p>Cobra \u547d\u4ee4\u884c\u5de5\u5177</p> <p>Go\u5e38\u7528\u5305(\u4e8c\u5341\u516b):\u6784\u5efa\u73b0\u4ee3CLI\u5e94\u7528\u5e93Cobra</p> <p>\u5728 Golang \u4e2d\u4f7f\u7528 Cobra \u521b\u5efa CLI \u5e94\u7528</p> <p>golang\u5e38\u7528\u5e93\u5305\uff1acli\u547d\u4ee4\u884c\u5de5\u5177-cobra\u4f7f\u7528</p> <p>\u6559\u4f60\u7528Cobra\u5f00\u53d1\u7c7b\u4f3cdocker\u7684\u547d\u4ee4\u884c</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/","title":"Viper","text":"<p>\u914d\u7f6e\u5de5\u5177\u7684\u9009\u62e9</p> <p>\u901a\u5e38\uff0c\u5728\u4e00\u4e2a\u6216\u591a\u4e2a\u9879\u76ee\u4e2d\u4f1a\u6709\u591a\u79cd\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982PHP\u7684php.ini\u6587\u4ef6\u3001Nginx\u7684server.conf\u6587\u4ef6\uff0c\u90a3\u4e48\u4f7f\u7528Golang\u600e\u4e48\u53bb\u8bfb\u53d6\u8fd9\u4e9b\u4e0d\u540c\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u5462\uff1f \u6bd4\u5982\u5e38\u89c1\u7684\u6709 JSON\u6587\u4ef6\u3001INI\u6587\u4ef6\u3001YAML\u6587\u4ef6\u548cTOML\u6587\u4ef6\u7b49\u7b49\u3002</p> <p>\u5176\u4e2d\u8fd9\u4e9b\u6587\u4ef6\uff0c\u5bf9\u5e94\u7684Golang\u5904\u7406\u5e93\u5982\u4e0b\uff1a</p> <ul> <li> <p>encoding/json \u2013 \u6807\u51c6\u5e93\u4e2d\u7684\u5305\uff0c\u53ef\u4ee5\u5904\u7406JSON\u914d\u7f6e\u6587\u4ef6\uff0c\u7f3a\u70b9\u662f\u4e0d\u80fd\u52a0\u6ce8\u91ca</p> </li> <li> <p>gcfg&amp;goconfig \u2013 \u5904\u7406INI\u914d\u7f6e\u6587\u4ef6</p> </li> <li> <p>toml \u2013 \u5904\u7406TOML\u914d\u7f6e\u6587\u4ef6</p> </li> <li> <p>viper \u2013 \u5904\u7406JSON, TOML, YAML, HCL\u4ee5\u53caJava properties\u914d\u7f6e\u6587\u4ef6</p> </li> </ul> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u63a8\u8350\u4f7f\u7528viper\u5e93\u6765\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u867d\u7136\u5b83\u4e0d\u652f\u6301ini\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528goconfig \u6216gcfg.v1\u5e93\u8bfb\u53d6ini \u683c\u5f0f\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>viper \u652f\u6301\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li> <p>\u652f\u6301Yaml\u3001Json\u3001 TOML\u3001HCL \u7b49\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6</p> </li> <li> <p>\u53ef\u4ee5\u4ece\u6587\u4ef6\u3001 io.Reader \u3001\u73af\u5883\u53d8\u91cf\u3001cli\u547d\u4ee4\u884c\u8bfb\u53d6\u914d\u7f6e</p> </li> <li> <p>\u652f\u6301\u81ea\u52a8\u8f6c\u6362\u7684\u7c7b\u578b\u89e3\u6790</p> </li> <li> <p>\u53ef\u4ee5\u8fdc\u7a0b\u4eceKey/Value\u4e2d\u8bfb\u53d6\u914d\u7f6e\uff0c\u9700\u8981\u5bfc\u5165 viper/remote \u5305</p> </li> <li> <p>\u76d1\u542c\u914d\u7f6e\u6587\u4ef6\u3002\u4ee5\u5f80\u6211\u4eec\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\u9700\u8981\u91cd\u542f\u670d\u52a1\u751f\u6548\uff0c\u800cViper\u4f7f\u7528watch\u51fd\u6570\u53ef\u4ee5\u8ba9\u914d\u7f6e\u81ea\u52a8\u751f\u6548\u3002</p> </li> </ul> <p>\u914d\u7f6e\u65b9\u5f0f\u7684\u4f18\u5148\u7ea7\u987a\u5e8f</p> <p>viper\u63d0\u4f9b\u7684\u914d\u7f6e\u65b9\u5f0f\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\u5982\u4e0b(\u7531\u9ad8\u5230\u4f4e)\uff1a</p> <ol> <li> <p>\u8bbe\u7f6e\u663e\u793a\u8c03\u7528(explicit call to Set)</p> </li> <li> <p>\u547d\u4ee4\u884c\u6807\u5fd7(flag)</p> </li> <li> <p>\u73af\u5883\u53d8\u91cf(env)</p> </li> <li> <p>\u914d\u7f6e\u6587\u4ef6(config)</p> </li> <li> <p>\u8fdc\u7a0b\u952e/\u503c\u5b58\u50a8(key/value store)</p> </li> <li> <p>\u9ed8\u8ba4\u503c(default)</p> </li> </ol>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#1\u5b89\u88c5viper","title":"1.\u5b89\u88c5viper","text":"<pre><code>go get github.com/spf13/viper\ngo get github.com/fsnotify/fsnotify\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#2\u4f7f\u7528viper\u8bfb\u53d6json\u914d\u7f6e","title":"2.\u4f7f\u7528viper\u8bfb\u53d6json\u914d\u7f6e","text":"<p>\u5047\u8bbe\u73b0\u5728\u6709\u4e00\u4efd json \u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6 config.json</p> <pre><code>{\n\"date\": \"2019-04-30\",\n\"mysql\": {\n\"url\": \"127.0.0.1:3306\",\n\"username\": \"root\",\n\"password\": \"123456\"\n}\n}\n</code></pre> <p>\u8bfb\u53d6json\u914d\u7f6e\u6587\u4ef6</p> <p>main.go</p> <pre><code>// viper_example project main.go\npackage main\nimport (\n\"fmt\"\n\"os\"\n\"github.com/spf13/viper\"\n)\nfunc main() {\nviper.SetConfigName(\"config\") //\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u7684\u540d\u5b57\nviper.AddConfigPath(\".\")      //\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u7684\u8def\u5f84\nviper.SetConfigType(\"json\")   //\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u7c7b\u578b\uff0c\u53ef\u9009\nerr := viper.ReadInConfig()\nif err != nil {\nfmt.Printf(\"config file error: %s\\n\", err)\nos.Exit(1)\n}\nurlValue := viper.Get(\"mysql.url\")\nfmt.Println(\"mysql url:\", urlValue) //mysql url: 127.0.0.1:3306\nfmt.Printf(\"mysql url: %s\\n mysql username: %s\\n mysql password: %s\", viper.Get(\"mysql.url\"), viper.Get(\"mysql.username\"), viper.Get(\"mysql.password\"))\n}\n</code></pre> <p>\u8fd0\u884c\u7a0b\u5e8f\uff0c\u67e5\u770b\u6548\u679c</p> <pre><code>D:\\golang\\go\\src\\github\\viper_example&gt;go run main.go\nmysql url: 127.0.0.1:3306\nmysql url: 127.0.0.1:3306\n mysql username: root\n mysql password: 123456\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#3\u4f7f\u7528viper\u8bfb\u53d6yaml\u914d\u7f6e\u6587\u4ef6","title":"3.\u4f7f\u7528viper\u8bfb\u53d6yaml\u914d\u7f6e\u6587\u4ef6","text":"<p>\u5047\u8bbe\u73b0\u5728\u6709\u4e00\u4efdyaml\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6 config_yaml.yaml</p> <pre><code>port: 10666\nmysql:\nurl: \"127.0.0.1:3306\"\nusername: root\npassword: 123456\n</code></pre> <p>main.go</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"github.com/fsnotify/fsnotify\"\n\"github.com/spf13/viper\"\n)\nfunc main() {\nviper.SetConfigName(\"config_yaml\") //\u628ajson\u6587\u4ef6\u6362\u6210yaml\u6587\u4ef6\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u6587\u4ef6\u540d (\u4e0d\u5e26\u540e\u7f00)\u5373\u53ef\nviper.AddConfigPath(\".\")           //\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u7684\u8def\u5f84\n//viper.SetConfigType(\"json\")       //\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u7c7b\u578b\nerr := viper.ReadInConfig()\nif err != nil {\nfmt.Printf(\"config file error: %s\\n\", err)\nos.Exit(1)\n}\nviper.WatchConfig() //\u76d1\u542c\u914d\u7f6e\u53d8\u5316\nviper.OnConfigChange(func(e fsnotify.Event) {\nfmt.Println(\"\u914d\u7f6e\u53d1\u751f\u53d8\u66f4\uff1a\", e.Name)\n})\nurlValue := viper.Get(\"mysql.url\")\nfmt.Println(\"mysql url:\", urlValue)\nfmt.Printf(\"mysql url: %s\\nmysql username: %s\\nmysql password: %s\", viper.Get(\"mysql.url\"), viper.Get(\"mysql.username\"), viper.GetString(\"mysql.password\"))\n}\n</code></pre> <p>\u8fd0\u884c\u7a0b\u5e8f\uff0c\u67e5\u770b\u6548\u679c</p> <pre><code>D:\\golang\\go\\src\\github\\viper_example&gt;go run main.go\nmysql url: 127.0.0.1:3306\nmysql url: 127.0.0.1:3306\nmysql username: root\nmysql password: 123456\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#4viper\u5176\u4ed6\u91cd\u8981\u529f\u80fd","title":"4.viper\u5176\u4ed6\u91cd\u8981\u529f\u80fd","text":""},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#41\u83b7\u53d6\u5b50\u7ea7\u914d\u7f6e","title":"4.1\u83b7\u53d6\u5b50\u7ea7\u914d\u7f6e","text":"<pre><code>app:\ncache1:\nmax-items: 100\nitem-size: 64\ncache2:\nmax-items: 200\nitem-size: 80\n</code></pre> <p>main.go</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"github.com/fsnotify/fsnotify\"\n\"github.com/spf13/viper\"\n)\nfunc main() {\nviper.SetConfigName(\"config_yaml\") //\u628ajson\u6587\u4ef6\u6362\u6210yaml\u6587\u4ef6\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u6587\u4ef6\u540d (\u4e0d\u5e26\u540e\u7f00)\u5373\u53ef\nviper.AddConfigPath(\".\")           //\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u7684\u8def\u5f84\n//viper.SetConfigType(\"json\")       //\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u7c7b\u578b\nerr := viper.ReadInConfig()\nif err != nil {\nfmt.Printf(\"config file error: %s\\n\", err)\nos.Exit(1)\n}\nviper.WatchConfig() //\u76d1\u542c\u914d\u7f6e\u53d8\u5316\nviper.OnConfigChange(func(e fsnotify.Event) {\nfmt.Println(\"\u914d\u7f6e\u53d1\u751f\u53d8\u66f4\uff1a\", e.Name)\n})\napp1Value := viper.Get(\"app.cache1.max-items\")\nfmt.Printf(\"app cache1 max-items is : %v\\n\", app1Value)\napp2Value := viper.Get(\"app.cache2.max-items\")\nfmt.Printf(\"app cache1 max-items is : %v\", app2Value)\n}\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c</p> <pre><code>D:\\golang\\go\\src\\github\\viper_example&gt;go run main.go\napp cache1 max-items is : 100\napp cache1 max-items is : 200\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#42\u89e3\u6790\u914d\u7f6e","title":"4.2\u89e3\u6790\u914d\u7f6e","text":"<p>\u53ef\u4ee5\u5c06\u914d\u7f6e\u7ed1\u5b9a\u5230\u67d0\u4e2a\u7ed3\u6784\u4f53\u3001map\u4e0a\uff0c\u6709\u4e24\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u505a\u5230\u8fd9\u4e00\u70b9\uff1a</p> <pre><code>// \u6b64\u51fd\u6570\u5c06\u6574\u4e2a\u914d\u7f6e\u6587\u4ef6\u7684\u5185\u5bb9\u89e3\u7801\u4e3a\u6307\u5b9a\u7684\u53d8\u91cf\u6216\u7ed3\u6784\u4f53\u3002\u60a8\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u5305\u542b\u5b8c\u6574\u914d\u7f6e\u6570\u636e\u7684\u53d8\u91cf\u6216\u7ed3\u6784\u4f53\u4f5c\u4e3a\u53c2\u6570\uff0c\u5e76\u4e14\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u952e\u548c\u5b57\u6bb5\u5fc5\u987b\u4e0e\u53d8\u91cf\u6216\u7ed3\u6784\u4f53\u4e2d\u7684\u540d\u79f0\u5339\u914d\u3002\nUnmarshal(rawVal interface{}) : error\n// \u6b64\u51fd\u6570\u5c06\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u952e\u7684\u503c\u89e3\u7801\u5230\u6307\u5b9a\u7684\u53d8\u91cf\u6216\u7ed3\u6784\u4f53\u3002\n// \u60a8\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u6307\u5b9a\u952e\u7684\u5b57\u7b26\u4e32\u548c\u4e00\u4e2a\u5305\u542b\u8be5\u952e\u503c\u7684\u53d8\u91cf\u6216\u7ed3\u6784\u4f53\u4f5c\u4e3a\u53c2\u6570\uff0c\u5e76\u4e14\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u952e\u548c\u5b57\u6bb5\u5fc5\u987b\u4e0e\u53d8\u91cf\u6216\u7ed3\u6784\u4f53\u4e2d\u7684\u540d\u79f0\u5339\u914d\u3002\nUnmarshalKey(key string, rawVal interface{}) : error\n</code></pre> <p>yaml\u7684\u793a\u4f8b</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"github.com/fsnotify/fsnotify\"\n\"github.com/spf13/viper\"\n)\ntype Config struct {\nPort int16\n}\ntype MySQL struct {\nUrl      string\nUsername string\nPassword string\n}\nfunc main() {\nviper.SetConfigName(\"config_yaml\") //\u628ajson\u6587\u4ef6\u6362\u6210yaml\u6587\u4ef6\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u6587\u4ef6\u540d (\u4e0d\u5e26\u540e\u7f00)\u5373\u53ef\nviper.AddConfigPath(\".\")           //\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u7684\u8def\u5f84\nviper.SetConfigType(\"yaml\")        // \u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\n//viper.SetConfigType(\"json\")       //\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u7c7b\u578b\nerr := viper.ReadInConfig()\nif err != nil {\nfmt.Printf(\"config file error: %s\\n\", err)\nos.Exit(1)\n}\nviper.WatchConfig() //\u76d1\u542c\u914d\u7f6e\u53d8\u5316\nviper.OnConfigChange(func(e fsnotify.Event) {\nfmt.Println(\"\u914d\u7f6e\u53d1\u751f\u53d8\u66f4\uff1a\", e.Name)\n})\nvar config Config\nvar mysql MySQL\nerr = viper.Unmarshal(&amp;config) // \u5c06\u914d\u7f6e\u89e3\u6790\u5230 config \u53d8\u91cf\nif err != nil {\nfmt.Printf(\"unable to decode into struct, %v\", err)\nos.Exit(1)\n}\nerr = viper.UnmarshalKey(\"mysql\", &amp;mysql) // \u5c06\u914d\u7f6e\u89e3\u6790\u5230 mysql \u53d8\u91cf\nif err != nil {\nfmt.Printf(\"unable to decode into struct, %v\", err)\nos.Exit(1)\n}\nfmt.Println(config.Port) // \u8bbf\u95eeconfig\u7ed3\u6784\u4f53\u4e2d\u7684Port\u5b57\u6bb5\u7684\u503c\nfmt.Println(mysql.Url)      // \u8bbf\u95eemysql\u7ed3\u6784\u4f53\u4e2d\u7684Url\u5b57\u6bb5\u7684\u503c\nfmt.Println(mysql.Username) // \u8bbf\u95eemysql\u7ed3\u6784\u4f53\u4e2d\u7684Username\u5b57\u6bb5\u7684\u503c\nfmt.Println(mysql.Password) // \u8bbf\u95eemysql\u7ed3\u6784\u4f53\u4e2d\u7684Password\u5b57\u6bb5\u7684\u503c\n}\n</code></pre> <p>json\u7684\u793a\u4f8b</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"github.com/spf13/viper\"\n)\ntype Config struct {\nDate string\n}\ntype MySQL struct {\nUrl      string\nUsername string\nPassword string\n}\nfunc main() {\nviper.SetConfigName(\"config\") //\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u7684\u540d\u5b57\nviper.AddConfigPath(\".\")      //\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u7684\u8def\u5f84\nviper.SetConfigType(\"json\")   //\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u7c7b\u578b\uff0c\u53ef\u9009\nerr := viper.ReadInConfig()\nif err != nil {\nfmt.Printf(\"config file error: %s\\n\", err)\nos.Exit(1)\n}\nvar config Config\nvar mysql MySQL\nerr = viper.Unmarshal(&amp;config) // \u5c06\u914d\u7f6e\u89e3\u6790\u5230 config \u53d8\u91cf\nif err != nil {\nfmt.Printf(\"unable to decode into struct, %v\", err)\nos.Exit(1)\n}\nerr = viper.UnmarshalKey(\"mysql\", &amp;mysql) // \u5c06\u914d\u7f6e\u89e3\u6790\u5230 mysql \u53d8\u91cf\nif err != nil {\nfmt.Printf(\"unable to decode into struct, %v\", err)\nos.Exit(1)\n}\nfmt.Println(config.Date)\nfmt.Println(mysql.Url)\nfmt.Println(mysql.Username)\nfmt.Println(mysql.Password)\n}\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#43\u83b7\u53d6\u503c","title":"4.3\u83b7\u53d6\u503c","text":"<p>\u5728Viper\u4e2d\uff0c\u6709\u4e00\u4e9b\u6839\u636e\u503c\u7684\u7c7b\u578b\u83b7\u53d6\u503c\u7684\u65b9\u6cd5\uff0c\u5b58\u5728\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p> <p><pre><code>Get(key string) : interface{}\nGetBool(key string) : bool\nGetFloat64(key string) : float64\nGetInt(key string) : int\nGetString(key string) : string\nGetStringMap(key string) : map[string]interface{}\nGetStringMapString(key string) : map[string]string\nGetStringSlice(key string) : []string\nGetTime(key string) : time.Time\nGetDuration(key string) : time.Duration\nIsSet(key string) : bool\n</code></pre> \u5982\u679c Get \u51fd\u6570\u672a\u627e\u5230\u503c\uff0c\u5219\u8fd4\u56de\u5bf9\u5e94\u7c7b\u578b\u7684\u4e00\u4e2a\u96f6\u503c\u3002\u53ef\u4ee5\u901a\u8fc7IsSet()\u65b9\u6cd5\u6765\u68c0\u6d4b\u4e00\u4e2a\u5065\u662f\u5426\u5b58\u5728\u3002</p> <pre><code>viper.GetString(\"logfile\") if viper.GetBool(\"verbose\") {\nfmt.Println(\"verbose enabled\")\n}\n</code></pre> <p>\u4fee\u6539\u5bf9\u5e94\u7684\u914d\u7f6e</p> <pre><code>viper.Set(\"Verbose\", true)\nviper.Set(\"LogFile\", LogFile)\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#5\u4f7f\u7528goconfig\u8bfb\u53d6ini\u914d\u7f6e\u6587\u4ef6","title":"5.\u4f7f\u7528goconfig\u8bfb\u53d6ini\u914d\u7f6e\u6587\u4ef6","text":"<p>\u5b89\u88c5goconfig</p> <pre><code>go get github.com/Unknwon/goconfig\n</code></pre> <p>\u5047\u8bbedatabase.conf\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a</p> <pre><code>[mysql]\nusername=root\npassword=123456\nurl=127.0.0.1:3306\n[redis]\naddress=127.0.0.1:6379\n</code></pre> <p>\u4f7f\u7528goconfig\u8bfb\u53d6ini\u683c\u5f0f\u914d\u7f6e\u6587\u4ef6</p> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"github.com/Unknwon/goconfig\"\n)\nvar cfg *goconfig.ConfigFile\nfunc init() {\nconfig, err := goconfig.LoadConfigFile(\"database.conf\") //\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\nif err != nil {\nfmt.Println(\"get config file error\")\nos.Exit(-1)\n}\ncfg = config\n}\nfunc GlobalConfig() {\nglob, _ := cfg.GetSection(\"mysql\") //\u8bfb\u53d6\u5168\u90e8mysql\u914d\u7f6e\nfmt.Println(glob)\n}\nfunc main() {\npassword, _ := cfg.GetValue(\"mysql\", \"password\") //\u8bfb\u53d6\u5355\u4e2a\u503c\nfmt.Println(password)\nusername, _ := cfg.GetValue(\"mysql\", \"username\") //\u8bfb\u53d6\u5355\u4e2a\u503c\nfmt.Println(username)\nerr := cfg.Reload() //\u91cd\u8f7d\u914d\u7f6e\nif err != nil {\nfmt.Printf(\"reload config file error: %s\", err)\n}\nGlobalConfig()\n}\n</code></pre> <p>\u52a0\u8f7d\u5b8c\u5168\u5c40\u914d\u7f6e\u540e\uff0c\u8be5\u914d\u7f6e\u957f\u9a7b\u5185\u5b58\uff0c\u9700\u8981\u52a8\u6001\u52a0\u8f7d\u7684\u8bdd\uff0c\u4f7f\u7528cfg.Reload()\u65b9\u6cd5\u3002 \u8fd0\u884c\u7a0b\u5e8f\uff0c\u6548\u679c\u5982\u4e0b\u3002</p> <pre><code>D:\\golang\\go\\src\\github\\viper_example&gt;go run main.go\n123456\nroot\nmap[password:123456 url:127.0.0.1:3306 username:root]\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/2.viper/#6-\u65b0\u589eyaml\u8f6cgo-struct-\u6548\u7387\u5de5\u5177","title":"6. \u65b0\u589eYAML\u8f6cGo Struct-\u6548\u7387\u5de5\u5177","text":"<p>\u73b0\u5728\u7f51\u7ad9\u603b\u5171 5 \u4e2a\u5de5\u5177\u4e86\uff0c\u5e0c\u671b\u80fd\u7528\u7684\u4e0a\uff0c\u672c\u671f\u53ea\u4ecb\u7ecd\u65b0\u589e\u7684\u5de5\u5177\u3002</p> <p>\u5de5\u5177\u5feb\u901f\u8bbf\u95ee</p> <ul> <li> <p>YAML \u8f6c GO (\u65b0\u589e): www.printlove.cn/tools/yaml2go</p> </li> <li> <p>JSON \u8f6c GO: www.printlove.cn/tools/json2go</p> </li> <li> <p>SQL \u8f6c GORM Model: www.printlove.cn/tools/sql2gorm</p> </li> <li> <p>SQL \u8f6c entgo schema: printlove.cn/tools/sql2ent</p> </li> <li> <p>SQL \u8f6c go-zero Model: printlove.cn/tools/sql2gozero</p> </li> </ul> <p>\u53c2\u8003\u6587\u732e</p> <p>Viper--\u65b9\u4fbf\u597d\u7528\u7684Golang \u914d\u7f6e\u5e93</p> <p>viper \u8bfb\u53d6\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6</p> <p>viper\u64cd\u4f5c\u6587\u6863</p> <p>\u5e94\u7528\u6784\u5efa:pflag,viper,cobra</p> <p>Gin\u96c6\u6210(\u4e00):\u96c6\u6210viper\u914d\u7f6e\u89e3\u6790\u5305</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/3.mahonia/","title":"mahonia","text":"<p>\u89e3\u51b3\u4e2d\u6587\u4e71\u7801\u95ee\u9898\u5fc5\u987b\u501f\u52a9\u7b2c\u4e09\u65b9\u5305mahonia\u7f16\u7801\u3002</p> <p>\u9996\u5148\u5728CMD\u7a97\u53e3\u6216GoLand\u7684Terminal\u7a97\u53e3\u8f93\u5165\u5982\u4e0b\uff0c\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u5305mahonia\u3002</p> <pre><code>go get github.com/axgle/mahonia\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/axgle/mahonia\"\n\"os/exec\"\n)\nfunc main() {\n// \u8bbe\u7f6egbk\u7f16\u7801\u683c\u5f0f\nenc := mahonia.NewDecoder(\"gbk\")\n// \u6267\u884cipconfig\u6307\u4ee4\ncmd := exec.Command(\"cmd\", \"/C\", \"ipconfig\")\n// \u83b7\u53d6\u6307\u4ee4\u7684\u8f93\u51fa\u7ed3\u679c\noutput, err := cmd.Output()\n// \u82e5\u6709\u9519\u8bef\u5219\u8f93\u51fa\u5f02\u5e38\u4fe1\u606f\nif err != nil {\nfmt.Println(err)\n}\n// \u56e0\u4e3a\u7ed3\u679c\u662f\u5b57\u8282\u6570\u7ec4\uff0c\u9700\u8981\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\n// enc.ConvertString\u662f\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u7f16\u7801\u5904\u7406\nfmt.Println(enc.ConvertString(string(output)))\n}\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/4.ssh/","title":"ssh","text":"<p>\u5b98\u65b9\u5730\u5740\uff1ahttps://godoc.org/golang.org/x/crypto/ssh</p> <pre><code>package main\nimport (\n\"fmt\"\n\"net\"\ngossh \"golang.org/x/crypto/ssh\"\n)\ntype Cli struct {\nuser       string\npwd        string\naddr       string\nclient     *gossh.Client\nsession    *gossh.Session\nLastResult string\n}\nfunc (c *Cli) Connect() (*Cli, error) {\nconfig := &amp;gossh.ClientConfig{}\nconfig.SetDefaults()\nconfig.User = c.user\nconfig.Auth = []gossh.AuthMethod{gossh.Password(c.pwd)}\nconfig.HostKeyCallback = func(hostname string, remote net.Addr, key gossh.PublicKey) error { return nil }\nclient, err := gossh.Dial(\"tcp\", c.addr, config)\nif nil != err {\nreturn c, err\n}\nc.client = client\nreturn c, nil\n}\nfunc (c Cli) Run(shell string) (string, error) {\nif c.client == nil {\nif _, err := c.Connect(); err != nil {\nreturn \"\", err\n}\n}\nsession, err := c.client.NewSession()\nif err != nil {\nreturn \"\", err\n}\ndefer session.Close()\nbuf, err := session.CombinedOutput(shell)\nc.LastResult = string(buf)\nreturn c.LastResult, err\n}\nfunc main() {\ncli := Cli{\nuser: \"root\",\npwd:  \"xxxxxxxxxxxx\",\naddr: \"192.168.1.12:22\",\n}\noutput, err := cli.Run(\"hostname;pwd\")\nfmt.Printf(\"%v\\n%v\", output, err)\n}\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.fsnotify/","title":"fsnotify","text":"<p>fsnotify\u76d1\u542c\u6587\u4ef6\u6216\u8005\u76ee\u5f55</p> <p>\u5728Linux\u4e2d\uff0c\u6211\u4eec\u77e5\u9053\u6709\u4e00\u4e2ainotify\u7684\u8f6f\u4ef6\uff0c\u5b83\u53ef\u4ee5\u76d1\u542c\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u7684\u53d8\u5316\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u53d8\u5316\u505a\u4e0d\u540c\u7684\u64cd\u4f5c\u3002</p> <p>\u73b0\u5728\u6709\u4e00\u4e2aGolang\u5f00\u53d1\u7684\u5de5\u5177\u4e5f\u6709\u8fd9\u4e2a\u529f\u80fd\uff0c\u53eb\u505afsnotify\u3002</p> <p>\u5b98\u65b9\u6587\u6863\uff1ahttps://godoc.org/github.com/fsnotify/fsnotify</p> <p>\u4ece\u5b98\u65b9\u6587\u6863\u770b\u5176\u5b9e\u73b0\u6d41\u7a0b\u5f88\u7b80\u5355\uff0c\u5c31\u53ea\u6709\u4e09\u4e2a\u7ed3\u6784\u4f53\uff0c\u4e00\u4e2a\u76d1\u542c\uff0c\u4e00\u4e2a\u83b7\u53d6\u4e8b\u4ef6\uff0c\u4e00\u4e2a\u5904\u7406\u3002</p> <p>\u4e0b\u9762\u7b80\u5355\u4ecb\u7ecd\u5176\u4f7f\u7528\u3002</p> <p>\u6211\u4eec\u5148\u770b\u5b98\u65b9\u7684\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>package main\nimport (\n\"log\"\n\"github.com/fsnotify/fsnotify\"\n)\nfunc main() {\nwatcher, err := fsnotify.NewWatcher()\nif err != nil {\nlog.Fatal(err)\n}\ndefer watcher.Close()\ndone := make(chan bool)\ngo func() {\nfor {\nselect {\ncase event, ok := &lt;-watcher.Events:\nif !ok {\nreturn\n}\nlog.Println(\"event:\", event)\nif event.Op&amp;fsnotify.Write == fsnotify.Write {\nlog.Println(\"modified file:\", event.Name)\n}\ncase err, ok := &lt;-watcher.Errors:\nif !ok {\nreturn\n}\nlog.Println(\"error:\", err)\n}\n}\n}()\nerr = watcher.Add(\"E:\\\\test\")\nif err != nil {\nlog.Fatal(err)\n}\n&lt;-done\n}\n</code></pre> <p>\u7136\u540e\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6\uff0c\u770b\u65e5\u5fd7\u8f93\u51fa\u5982\u4e0b\uff1a</p> <pre><code>/usr/local/go/bin/go run main.go [/data/goworkdir/go/src/github.com/hujianli94/appdemo1]\n2023/07/30 19:38:43 event: CREATE        \"/tmp/hsperfdata_hujianli/aa1.txt\"\n2023/07/30 19:38:43 event: CHMOD         \"/tmp/hsperfdata_hujianli/aa1.txt\"\n2023/07/30 19:38:43 event: CREATE        \"/tmp/hsperfdata_hujianli/aa2.txt\"\n2023/07/30 19:38:43 event: CHMOD         \"/tmp/hsperfdata_hujianli/aa2.txt\"\n2023/07/30 19:38:43 event: CREATE        \"/tmp/hsperfdata_hujianli/aa3.txt\"\n2023/07/30 19:38:43 event: CHMOD         \"/tmp/hsperfdata_hujianli/aa3.txt\"\n</code></pre> <p>\u5176\u4f7f\u7528\u6bd4\u8f83\u7b80\u5355\uff1a</p> <ul> <li> <p>\u8c03\u7528NewWatcher\u521b\u5efa\u4e00\u4e2a\u76d1\u542c\u5668</p> </li> <li> <p>\u8c03\u7528\u76d1\u542c\u5668\u7684Add\u65b9\u6cd5\u589e\u52a0\u76d1\u542c\u7684\u6587\u4ef6\u6216\u76ee\u5f55</p> </li> <li> <p>\u540c\u65f6\u4f1a\u8d77\u4e00\u4e2a\u534f\u7a0b\u4e0d\u65ad\u83b7\u53d6\u76d1\u542c\u4e8b\u4ef6\uff0c\u7136\u540e\u6839\u636e\u76d1\u542c\u4e8b\u4ef6\u505a\u4e0d\u540c\u7684\u64cd\u4f5c</p> </li> </ul> <p>\u5176\u4e8b\u4ef6\u7c7b\u578b\u5982\u4e0b\uff1a</p> <pre><code>type Event struct {\nName string // Relative path to the file or directory.\nOp   Op     // File operation that triggered the event.\n}\n</code></pre> <p>\u8be5\u7c7b\u578b\u53ea\u6709\u4e24\u4e2a\u5b57\u6bb5\uff0cName\u8868\u793a\u53d1\u751f\u4e8b\u4ef6\u7684\u6587\u4ef6\u540d\u6216\u76ee\u5f55\uff0cOp\u8868\u793a\u5177\u4f53\u7684\u4e8b\u4ef6\u3002\u5176\u4e2dOp\u4e2d\u67095\u4e2a\u503c\uff0c\u5982\u4e0b\uff1a</p> <pre><code>const (\nCreate Op  = 1 &lt;&lt; iota\nWrite\nRemove\nRename\nChmod\n)\n</code></pre> <p>\u4e0a\u9762\u662f\u76d1\u542c\u5355\u4e2a\u76ee\u5f55\u6216\u8005\u6587\u4ef6\uff0c\u5982\u679c\u8981\u76d1\u542c\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u4e86\uff0c\u5982\u4e0b\uff1a <pre><code>package main\nimport (\n\"log\"\n\"os\"\n\"path/filepath\"\n\"github.com/fsnotify/fsnotify\"\n)\nfunc watchDir(watcher *fsnotify.Watcher, dir string) {\n// \u904d\u5386\u5b50\u76ee\u5f55\nfilepath.Walk(dir, func(path string, info os.FileInfo, err error) error {\n// \u5224\u65ad\u662f\u5426\u4e3a\u76ee\u5f55\uff0c\u53ea\u9700\u8981\u76d1\u542c\u76ee\u5f55\uff0c\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u53d8\u5316\u5c31\u53ef\u4ee5\u8fdb\u884c\u76f8\u5e94\u64cd\u4f5c\nif info.IsDir() {\npath, err := filepath.Abs(path)\nif err != nil {\nlog.Println(err)\nreturn err\n}\n// \u7136\u540e\u5c06\u5176\u52a0\u5165\u76d1\u542c\nif err := watcher.Add(path); err != nil {\nlog.Printf(\"watch %s failed. err = %s\", path, err.Error())\nreturn err\n}\n}\nreturn nil\n})\n}\nfunc main() {\nwatcher, err := fsnotify.NewWatcher()\nif err != nil {\nlog.Fatal(err)\n}\ndefer watcher.Close()\ndone := make(chan bool)\ngo func() {\nfor {\nselect {\ncase event, ok := &lt;-watcher.Events:\nif !ok {\nreturn\n}\nlog.Println(\"event:\", event)\nif event.Op&amp;fsnotify.Write == fsnotify.Write {\nlog.Println(\"modified file:\", event.Name)\n}\nif event.Op&amp;fsnotify.Create != 0 {\nlog.Println(\"Created file:\", event.Name)\n}\ncase err, ok := &lt;-watcher.Errors:\nif !ok {\nreturn\n}\nlog.Println(\"error:\", err)\n}\n}\n}()\n//err = watcher.Add(\"E:\\\\test\")\n//if err != nil {\n//  log.Fatal(err)\n//}\nwatchDir(watcher, \"/tmp/hsperfdata_hujianli/\")\n&lt;-done\n}\n</code></pre></p> <p>\u7136\u540e\u6211\u4eec\u64cd\u4f5c\u5b50\u76ee\u5f55\uff0c\u4e5f\u4f1a\u6709\u76f8\u5e94\u7684\u4e8b\u4ef6\u53d1\u751f\u3002</p> <pre><code>/usr/local/go/bin/go run main.go [/data/goworkdir/go/src/github.com/hujianli94/appdemo1]\n2023/07/30 19:35:57 event: CREATE        \"/tmp/hsperfdata_hujianli/aa-1/bbb/bbb1.txt\"\n2023/07/30 19:35:57 Created file: /tmp/hsperfdata_hujianli/aa-1/bbb/bbb1.txt\n2023/07/30 19:35:57 event: CHMOD         \"/tmp/hsperfdata_hujianli/aa-1/bbb/bbb1.txt\"\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/5.fsnotify/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ol> <li> <p>https://pkg.go.dev/github.com/fsnotify/fsnotify</p> </li> <li> <p>https://github.com/fsnotify/fsnotify</p> </li> </ol>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/","title":"yaml","text":""},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/#1yaml\u8f6cgo-struct-\u6548\u7387\u5de5\u5177","title":"1.YAML\u8f6cGo Struct-\u6548\u7387\u5de5\u5177","text":"<ul> <li> <p>JSON\u8f6cGolang Struct</p> </li> <li> <p>YAML\u8f6cGolang Struct</p> </li> </ul>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/#2\u521b\u5efayaml\u6587\u4ef6","title":"2.\u521b\u5efaYAML\u6587\u4ef6","text":"<p>first.yaml</p> <pre><code>SiteName: joker\nSiteAddr: Chongqing\nHttps: true\nNginx:\nPort: 443\nLogPath:  \"/var/log//nginx/nginx.log\"\nPath: \"/opt/nginx/\"\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/6.yaml/#3\u7528go\u89e3\u6790yaml\u6587\u4ef6","title":"3.\u7528Go\u89e3\u6790YAML\u6587\u4ef6","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"gopkg.in/yaml.v2\"\n)\n// Nginx nginx  \u914d\u7f6e\ntype Nginx struct {\nPort    int    `yaml:\"Port\"`\nLogPath string `yaml:\"LogPath\"`\nPath    string `yaml:\"Path\"`\n}\n// Config   \u7cfb\u7edf\u914d\u7f6e\u914d\u7f6e\ntype Config struct {\nName      string `yaml:\"SiteName\"`\nAddr      string `yaml:\"SiteAddr\"`\nHTTPS     bool   `yaml:\"Https\"`\nSiteNginx Nginx  `yaml:\"Nginx\"`\n}\nfunc main() {\nvar setting Config\nconfig, err := ioutil.ReadFile(\"./first.yaml\")\nif err != nil {\nfmt.Print(err)\n}\nyaml.Unmarshal(config, &amp;setting)\nfmt.Println(setting.Name)\nfmt.Println(setting.Addr)\nfmt.Println(setting.HTTPS)\nfmt.Println(setting.SiteNginx.Port)\nfmt.Println(setting.SiteNginx.LogPath)\nfmt.Println(setting.SiteNginx.Path)\n}\n</code></pre> <p>\u51fd\u6570\u7b80\u4ecb\uff1a</p> <ol> <li> <p>ioutil.ReadFile(\"./first.yaml\") :\u8bfb\u53d6yaml\u6587\u4ef6\u4fe1\u606f </p> </li> <li> <p>yaml.Unmarshal()</p> </li> </ol> <p>\u7b2c\u4e00\u4e2a\u8f93\u5165\u53c2\u6570\uff1a\u83b7\u53d6 ioutil.ReadFile \u7684\u503c\uff0c\u4e3a[]byte\u7c7b\u578b</p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8f93\u51fa\u53c2\u6570\uff0c\u53ef\u4ee5\u4e3a\u4efb\u610f\u7c7b\u578b\u3002</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/7.tail/","title":"tail","text":"<p>\u5b98\u65b9\u5730\u5740\uff1ahttps://github.com/hpcloud/tail</p> <p>\u529f\u80fd\uff1a\u5b9e\u73b0\u7c7b\u4f3c\u4e8eLinux\u4e2dtail -f\u529f\u80fd</p> <p>\u6d4b\u8bd5\uff1a</p> <pre><code>package main\nimport (\n\"fmt\"\n\"github.com/hpcloud/tail\"\n\"time\"\n)\nfunc main() {\nfilename := \"./app.log\"\ntails, err := tail.TailFile(filename, tail.Config{\nReOpen: true,\nFollow: true,\n// Location:  &amp;tail.SeekInfo{Offset: 0, Whence: 2},\nMustExist: false,\nPoll:      true,\n})\nif err != nil {\nfmt.Println(\"tail file err:\", err)\nreturn\n}\nvar msg *tail.Line\nvar ok bool\nfor {\nmsg, ok = &lt;-tails.Lines\nif !ok {\nfmt.Printf(\"tail file close reopen, filename:%s\\n\", tails.Filename)\ntime.Sleep(100 * time.Millisecond)\ncontinue\n}\nfmt.Printf(\"msg(%T): %v\\n\", msg,msg.Text)\n}\n}\n</code></pre> <pre><code>go mod init\ngo build\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/","title":"gopsutil","text":"<p>gopsutil\u662fpsutil\u7684Go\u7248\u672c\u3002</p>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/#1\u5b89\u88c5","title":"1.\u5b89\u88c5","text":"<pre><code>go get github.com/shirou/gopsutil\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/#2\u4f7f\u7528","title":"2.\u4f7f\u7528","text":"<pre><code>package main\nimport (\n\"fmt\"\n\"log\"\nn \"net\"\n\"time\"\n\"github.com/shirou/gopsutil/cpu\"\n\"github.com/shirou/gopsutil/disk\"\n\"github.com/shirou/gopsutil/host\"\n\"github.com/shirou/gopsutil/load\"\n\"github.com/shirou/gopsutil/mem\"\n\"github.com/shirou/gopsutil/net\"\n)\n// cpu info \u91c7\u96c6CPU\u76f8\u5173\u4fe1\u606f\nfunc getCpuInfo() {\ncpuInfos, err := cpu.Info()\nif err != nil {\nfmt.Printf(\"get cpu info failed, err:%v\", err)\n}\nfor _, ci := range cpuInfos {\nfmt.Println(ci)\n}\n// CPU\u4f7f\u7528\u7387\nfor {\npercent, _ := cpu.Percent(time.Second, false)\nfmt.Printf(\"cpu percent:%v\\n\", percent)\n}\n}\n// \u83b7\u53d6CPU\u8d1f\u8f7d\u4fe1\u606f\nfunc getCpuLoad() {\ninfo, _ := load.Avg()\nfmt.Printf(\"%v\\n\", info)\n}\n// mem info  Memory\nfunc getMemInfo() {\nmemInfo, _ := mem.VirtualMemory()\nfmt.Printf(\"mem info:%v\\n\", memInfo)\n}\n// Host\nfunc getHostInfo() {\nhInfo, _ := host.Info()\nfmt.Printf(\"host info:%v uptime:%v boottime:%v\\n\", hInfo, hInfo.Uptime, hInfo.BootTime)\n}\n// disk info\nfunc getDiskInfo() {\nparts, err := disk.Partitions(true)\nif err != nil {\nfmt.Printf(\"get Partitions failed, err:%v\\n\", err)\nreturn\n}\nfor _, part := range parts {\nfmt.Printf(\"part:%v\\n\", part.String())\ndiskInfo, _ := disk.Usage(part.Mountpoint)\nfmt.Printf(\"disk info:used:%v free:%v\\n\", diskInfo.UsedPercent, diskInfo.Free)\n}\nioStat, _ := disk.IOCounters()\nfor k, v := range ioStat {\nfmt.Printf(\"%v:%v\\n\", k, v)\n}\n}\n// net IO\nfunc getNetInfo() {\ninfo, _ := net.IOCounters(true)\nfor index, v := range info {\nfmt.Printf(\"%v:%v send:%v recv:%v\\n\", index, v, v.BytesSent, v.BytesRecv)\n}\n}\n// net\n// \u83b7\u53d6\u672c\u673aIP\u7684\u4e24\u79cd\u65b9\u5f0f1\nfunc GetLocalIP() (ip string, err error) {\ninterfaces, err := n.Interfaces()\nif err != nil {\nreturn \"\", err\n}\nfor _, iface := range interfaces {\naddrs, err := iface.Addrs()\nif err != nil {\nreturn \"\", err\n}\nfor _, addr := range addrs {\nipNet, ok := addr.(*n.IPNet)\nif ok &amp;&amp; !ipNet.IP.IsLoopback() &amp;&amp; ipNet.IP.To4() != nil {\nreturn ipNet.IP.String(), nil\n}\n}\n}\nreturn \"\", fmt.Errorf(\"failed to get local IP\")\n}\n// \u83b7\u53d6\u672c\u673aIP\u7684\u4e24\u79cd\u65b9\u5f0f2\n// Get preferred outbound ip of this machine\nfunc GetOutboundIP() string {\nconn, err := n.Dial(\"udp\", \"8.8.8.8:80\")\nif err != nil {\nlog.Fatal(err)\n}\ndefer conn.Close()\nlocalAddr := conn.LocalAddr().(*n.UDPAddr)\nfmt.Println(localAddr.String())\nreturn localAddr.IP.String()\n}\nfunc main() {\n// getCpuInfo()\n// getCpuLoad()\n// getDiskInfo()\n// getHostInfo()\n// getMemInfo()\n// getNetInfo()\n// i, _ := GetLocalIP()\n// println(i)\n// fmt.Println(GetOutboundIP())\n}\n</code></pre>"},{"location":"Golang/9.Go%E4%B8%89%E6%96%B9%E5%BA%93/8.gopsutil/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<p>gopsutil</p> <p>gopsutil \u7b80\u4ecb</p>"},{"location":"Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/","title":"Kubernetes","text":"<p>\u7cfb\u7edf\u5168\u9762\u7684\u5b66\u4e60kubernetes\u4e91\u539f\u751f</p>"},{"location":"Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/#\u5185\u5bb9\u76ee\u5f55","title":"\u5185\u5bb9\u76ee\u5f55","text":""},{"location":"Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/#1\u5b89\u88c5\u7bc7","title":"1.\u5b89\u88c5\u7bc7","text":"<p>1.Kubeadm\u5b89\u88c5\u9ad8\u53ef\u7528K8s\u96c6\u7fa4 </p> <p>2.\u4e8c\u8fdb\u5236\u5b89\u88c5\u9ad8\u53ef\u7528K8s\u96c6\u7fa4 </p>"},{"location":"Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/#2\u57fa\u7840\u7bc7","title":"2.\u57fa\u7840\u7bc7","text":"<p>3.Docker\u57fa\u7840</p> <p>4.Kubernetes\u7684\u57fa\u7840\u6982\u5ff5</p> <p>5.Kubernetes\u8c03\u5ea6\u57fa\u7840</p> <p>6.Kubernetes\u670d\u52a1\u53d1\u5e03\u57fa\u7840</p> <p>7.Kubernetes\u914d\u7f6e\u7ba1\u7406</p>"},{"location":"Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/#3-\u8fdb\u9636\u7bc7","title":"3. \u8fdb\u9636\u7bc7","text":"<p>8.Kubernetes\u5b58\u50a8\u5165\u95e8</p> <p>9.Kubernetes\u9ad8\u7ea7\u8c03\u5ea6</p>"},{"location":"Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/#4\u9ad8\u7ea7\u7bc7","title":"4.\u9ad8\u7ea7\u7bc7","text":"<p>12.\u4e91\u539f\u751f\u5b58\u50a8Rook</p> <p>13.\u4e2d\u95f4\u4ef6\u5bb9\u5668\u5316</p>"},{"location":"Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/#5-\u8fd0\u7ef4\u7bc7","title":"5. \u8fd0\u7ef4\u7bc7","text":"<p>Kubernetes\u65e5\u5fd7\u6536\u96c6</p> <p>Kubernetes\u76d1\u63a7\u544a\u8b66</p> <p>\u670d\u52a1\u53d1\u5e03Ingress\u8fdb\u9636</p>"},{"location":"Kubernetes/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Kubernetes/#6devops\u7bc7","title":"6.DevOps\u7bc7","text":"<p>DevOps\u5b9e\u8df5</p> <p>\u672c\u6559\u7a0b\u4ece\u6982\u5ff5\u5230\u5b9e\u8df5\uff0c\u4ece\u624b\u5de5\u5230\u81ea\u52a8\u5316\uff0c\u5185\u5bb9\u7fd4\u5b9e\u4e14\u4e30\u5bcc\uff0c\u5176\u4e2d\u7684\u8303\u4f8b\u4e0e\u9879\u76ee\u5747\u5728\u5b9e\u8df5\u4e2d\u591a\u6b21\u9a8c\u8bc1\uff0c\u53ef\u76f4\u63a5\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u3002</p> <p>\u672c\u4e66\u6559\u7a0b\u9002\u5408Kubernetes\u521d\u5b66\u8005\u3001\u5f00\u53d1\u4eba\u5458\u3001\u8fd0\u7ef4\u4eba\u5458\u3001\u67b6\u6784\u5e08\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u57f9\u8bad\u673a\u6784\u548c\u5927\u4e13\u9662\u6821\u7684\u6559\u5b66\u7528\u4e66\u3002</p> <p>\u4ee3\u7801\u4ed3\u5e93\u5730\u5740</p> <p>https://github.com/dotbalo/kubernetes-guide</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/","title":"Kubeadm\u5b89\u88c5\u9ad8\u53ef\u7528\u96c6\u7fa4","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e24\u79cd\u65b9\u5f0f\u5b89\u88c5K8s\u96c6\u7fa4\uff1aKubeadm\u65b9\u5f0f\u548c\u4e8c\u8fdb\u5236\u65b9\u5f0f\u3002</p> <p>Kubeadm\u662f\u4e00\u4e2a\u7b80\u5355\u6613\u7528\u7684\u5b89\u88c5\u5de5\u5177\uff0c\u53ef\u7528\u4e8e\u5feb\u901f\u642d\u5efaKubernetes\u96c6\u7fa4\uff0c\u76ee\u524d\u662f\u6bd4\u8f83\u65b9\u4fbf\u548c\u63a8\u8350\u7684\u65b9\u5f0f\u3002</p> <p>\u4e8c\u8fdb\u5236\u5b89\u88c5\u65b9\u5f0f\u8c03\u8bd5Bug\u6bd4\u8f83\u65b9\u4fbf\uff0c\u6709\u52a9\u4e8e\u6e05\u695a\u4e86\u89e3K8s\u7ec4\u4ef6\u7684\u539f\u7406\uff0c\u5bf9\u4e8e\u5168\u9762\u7406\u89e3Kubernetes\u4f1a\u6709\u5e2e\u52a9\u3002</p> <p>\u672c\u7ae0\u9996\u5148\u4ecb\u7ecd\u4f7f\u7528Kubeadm\u5b89\u88c5K8s\u96c6\u7fa4\u7684\u5177\u4f53\u65b9\u5f0f\u548c\u6b65\u9aa4\u3002\u672c\u7ae0\u7684\u5b89\u88c5\u5185\u5bb9\u5728Kubernetes 1.14\u4ee5\u4e0a\u7248\u672c\u5747\u53ef\u4f7f\u7528\uff0c\u672c\u4e66\u5b89\u88c5\u7684\u7248\u672c\u662f1.22\uff08\u672c\u4e66\u622a\u7a3f\u524d\u7684\u6700\u65b0\u7248\u672c\uff09\u3002</p> <p>\u5c31Kubeadm\u5404\u4e2a\u7248\u672c\u7684\u5b89\u88c5\u6765\u770b\uff0c\u57fa\u672c\u4e0a\u5927\u540c\u5c0f\u5f02\uff0c\u5b89\u88c5\u6b65\u9aa4\u6539\u52a8\u4e5f\u4e0d\u5927\uff0c\u57fa\u672c\u73af\u5883\u914d\u7f6e\u548c\u57fa\u672c\u7ec4\u4ef6\u5b89\u88c5\u7c7b\u4f3c\uff0c\u6bcf\u4e2a\u7248\u672c\u7684\u533a\u522b\u53ef\u80fd\u53ea\u662f\u96c6\u7fa4\u521d\u59cb\u5316\u4e0d\u540c\u3002</p> <p>\u76f8\u4fe1\u968f\u7740\u7248\u672c\u7684\u8fed\u4ee3\uff0c\u5b89\u88c5\u6b65\u9aa4\u4f1a\u53d8\u5f97\u66f4\u52a0\u7b80\u5355\u3001\u5feb\u6377\u3002\u9488\u5bf9\u4e0d\u540c\u7684\u7248\u672c\uff0c\u8bfb\u8005\u4e5f\u53ef\u4ee5\u53c2\u8003\u5b98\u7f51\u7684\u5b89\u88c5\u6b65\u9aa4\uff1a</p> <p>\u5229\u7528 kubeadm \u521b\u5efa\u9ad8\u53ef\u7528\u96c6\u7fa4</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#1-haproxykeepalived\u642d\u5efa\u9ad8\u53ef\u7528-kubernetes-\u96c6\u7fa4centos7","title":"1. Haproxy+Keepalived\u642d\u5efa\u9ad8\u53ef\u7528 Kubernetes \u96c6\u7fa4\uff08centos7\uff09","text":""},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#11-\u57fa\u672c\u73af\u5883\u914d\u7f6e","title":"1.1 \u57fa\u672c\u73af\u5883\u914d\u7f6e","text":"<p>\u8bfb\u8005\u9700\u81ea\u884c\u51c6\u5907</p> <ul> <li>3\u53f0\u6700\u4f4e2\u6838CPU\u548c4GB\u4ee5\u4e0a\u5185\u5b58\u7684\u670d\u52a1\u5668\uff0c\u7cfb\u7edf\u4e3aCentOS 7.x,\u5b89\u88c5master\u8282\u70b9</li> <li>1\u53f0\u6700\u4f4e4\u6838CPU\u548c8GB\u4ee5\u4e0a\u5185\u5b58\u7684\u670d\u52a1\u5668\uff0c\u7cfb\u7edf\u4e3aCentOS 7.x,\u5b89\u88c5node\u8282\u70b9</li> </ul> <p>\u5982\u679c\u6ca1\u6709\u8fd9\u4e48\u591a\u7684\u673a\u5668\uff0c\u53ef\u4ee5\u53ea\u5b89\u88c53\u53f0Master\u6216\u8005\u4e00\u53f0Master\u30011\u53f0Node\u3002</p> <p>\u96c6\u7fa4\u91c7\u7528\u7684\u670d\u52a1\u5668IP\u89c4\u5212\u5982\u88681.1\u6240\u793a\u3002</p> <p>\u88681.1\u3000\u9ad8\u53ef\u7528Kubernetes\u96c6\u7fa4\u89c4\u5212</p> \u4e3b\u673a\u540d IP\u5730\u5740 \u8bf4\u660e \u670d\u52a1\u5668\u914d\u7f6e k8s-master-01~03 192.168.1.190~192 master\u8282\u70b9*3 2c4g \u7cfb\u7edf\u76d8\uff1a40G  \u6570\u636e\u76d8\uff1a100G VIP 192.168.1.193 keeplived\u865a\u62dfIP k8s-node01~n 192.168.1.200 node\u8282\u70b9*n 4c8g 100G <p>Kubernetes\u4e00\u5171\u6d89\u53ca\u4e09\u4e2a\u7f51\u6bb5\uff0c\u4e00\u4e2a\u662f\u5bbf\u4e3b\u673a\u7684\u7f51\u6bb5\uff0c\u4e5f\u5c31\u662f\u4e0a\u8ff0\u7684192.168.1.x\uff0c\u540c\u65f6\u9700\u8981Pod\u548cService\u7684\u7f51\u6bb5\uff0c\u4e09\u8005\u7684\u7f51\u6bb5\u4e0d\u53ef\u4ea4\u53c9\u3002</p> <p>\u5b89\u88c5\u914d\u7f6e\u4fe1\u606f\u5982\u88681.2\u6240\u793a\u3002</p> \u914d\u7f6e\u4fe1\u606f \u5907\u6ce8 \u7cfb\u7edf\u7248\u672c Centos7.9 Docker\u7248\u672c 20.10.x Pod\u7f51\u6bb5 172.16.0.0/12 Service\u7f51\u6bb5 192.168.0.0/16 <p>\u6ce8\u610f</p> <p>\u5bbf\u4e3b\u673a\u7f51\u6bb5\u3001K8s Service\u7f51\u6bb5\u3001Pod\u7f51\u6bb5\u4e0d\u80fd\u91cd\u590d\u3002</p> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6e\u4e3b\u673a\u540d\uff08\u5176\u4ed6\u8282\u70b9\u540d\u79f0\u53ef\u81ea\u884c\u66f4\u6539\uff09\uff1a</p> <pre><code>$ hostnamectl set-hostname k8s-master01 &amp;&amp; eval -- bash\n$ hostnamectl set-hostname k8s-master02 &amp;&amp; eval -- bash\n$ hostnamectl set-hostname k8s-master03 &amp;&amp; eval -- bash\n$ hostnamectl set-hostname k8s-node01 &amp;&amp; eval -- bash\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6ehosts\uff0c\u4fee\u6539/etc/hosts\u5982\u4e0b\uff1a</p> <pre><code>$ cat &gt;&gt;/etc/hosts&lt;&lt;'EOF'\n192.168.1.190 k8s-master01\n192.168.1.191 k8s-master02\n192.168.1.192 k8s-master03\n192.168.1.200 k8s-node01\nEOF\n</code></pre> <p>\u914d\u7f6e\u9759\u6001IP\u53c2\u8003</p> <pre><code>$ cat /etc/sysconfig/network-scripts/ifcfg-eth0\nTYPE=\"Ethernet\"\nPROXY_METHOD=\"none\"\nBROWSER_ONLY=\"no\"\nBOOTPROTO=\"static\"\nIPADDR=\"192.168.1.200\"\nPREFIX=\"24\"\nGATEWAY=\"192.168.1.1\"\nDNS1=\"192.168.1.60\"\nDNS2=\"114.114.114.114\"\nDEFROUTE=\"yes\"\nIPV4_FAILURE_FATAL=\"no\"\nIPV6INIT=\"yes\"\nIPV6_AUTOCONF=\"yes\"\nIPV6_DEFROUTE=\"yes\"\nIPV6_FAILURE_FATAL=\"no\"\nIPV6_ADDR_GEN_MODE=\"stable-privacy\"\nNAME=\"eth0\"\nDEVICE=\"eth0\"\nONBOOT=\"yes\"\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eDocker\u3001Kubernetes\u548c\u9ed8\u8ba4yum\u6e90\uff1a</p> <pre><code>$ curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo\n\n$ yum install -y yum-utils \\\ndevice-mapper-persistent-data \\\nlvm2\n\n$ yum-config-manager \\\n--add-repo \\\nhttps://download.docker.com/linux/centos/docker-ce.repo\n\n$ cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n$ sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5\u4e00\u4e9b\u5e38\u7528\u7684\u5de5\u5177\uff1a</p> <pre><code>$ yum install wget jq psmisc vim net-tools telnet git -y\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5173\u95ed\u9632\u706b\u5899\u3001SELinux\u3001DNSmasq\uff1a</p> <pre><code>$ systemctl disable --now firewalld\n$ systemctl disable --now dnsmasq\n$ systemctl disable --now NetworkManager\n\n$ setenforce 0\n$ sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/sysconfig/selinux\n$ sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5173\u95edSwap\u5206\u533a\uff1a</p> <pre><code>$ swapoff -a &amp;&amp; sysctl -w vm.swappiness=0\n$ sed -ri '/^[^#]*swap/s@^@#@' /etc/fstab\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5ntpdate\uff08\u5982\u679c\u516c\u53f8\u7684\u670d\u52a1\u5668\u5df2\u7ecf\u914d\u7f6e\u4e86\u81ea\u52a8\u540c\u6b65\u65f6\u95f4\uff0c\u5173\u4e8e\u65f6\u95f4\u7684\u914d\u7f6e\u53ef\u4ee5\u4e0d\u7528\u64cd\u4f5c\uff09\uff1a</p> <pre><code>$ rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm\n$ yum install ntpdate -y\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u540c\u6b65\u65f6\u95f4\uff1a</p> <pre><code>$ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n$ echo 'Asia/Shanghai' &gt;/etc/timezone\n$ hwclock --systohc\n$ ntpdate time2.aliyun.com\n\n$ yum install chrony -y\n$ systemctl enable --now chronyd\n$ chronyc sources\n210 Number of sources = 4\nMS Name/IP address         Stratum Poll Reach LastRx Last sample\n===============================================================================\n^+ sv1.ggsrv.de                  2   6    17    32   -823us[-1128us] +/-   98ms\n^- montreal.ca.logiplex.net      2   6    17    32    -17ms[  -17ms] +/-  179ms\n^- ntp6.flashdance.cx            2   6    17    32    -32ms[  -32ms] +/-  161ms\n^* 119.28.183.184                2   6    33    32   +661us[ +357us] +/-   38ms\n\n$ date\nTue Aug 31 14:36:14 CST 2021\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6elimit\uff1a</p> <pre><code>$ ulimit -SHn 65535\n$ cat &gt;&gt;/etc/security/limits.conf&lt;&lt;-'EOF'\n# \u672b\u5c3e\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\n* soft nofile 65536\n* hard nofile 131072\n* soft nproc 65535\n* hard nproc 655350\n* soft memlock unlimited\n* hard memlock unlimited\nEOF\n</code></pre> <p>\u5b89\u88c5\u8fc7\u7a0b\u4e2d\uff0c\u751f\u6210\u914d\u7f6e\u6587\u4ef6\u548c\u8bc1\u4e66\u5747\u5728Master01\u4e0a\u64cd\u4f5c\uff0c\u6240\u4ee5Master01\u8282\u70b9\u9700\u8981\u514d\u5bc6\u94a5\u767b\u5f55\u5176\u4ed6\u8282\u70b9\uff0c\u4e4b\u540e\u5c06\u6587\u4ef6\u4f20\u9001\u5230\u5176\u4ed6\u8282\u70b9\u3002</p> <p>\u96c6\u7fa4\u7ba1\u7406\u4e5f\u5728Master01\u4e0a\u64cd\u4f5c\uff08\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u5355\u72ec\u7684\u8282\u70b9\uff09\u3002</p> <p>\u914d\u7f6e\u5bc6\u94a5\uff08\u53ea\u5728Master01\u6216\u7ba1\u7406\u8282\u70b9\u64cd\u4f5c\uff0c\u4ee5\u4e0b\u6b65\u9aa4\u5c06\u7ba1\u7406\u8282\u70b9\u548cMaster01\u7edf\u79f0\u4e3aMaster01\uff09\uff1a</p> <pre><code>$ ssh-keygen -t rsa\n$ for i in k8s-master01 k8s-master02 k8s-master03 k8s-node01;do ssh-copy-id -i .ssh/id_rsa.pub $i;done\n</code></pre> <p>Master01\u4e0b\u8f7d\u5b89\u88c5\u6240\u6709\u7684\u6e90\u7801\u6587\u4ef6\uff1a</p> <pre><code>$ cd /root/ ; git clone https://github.com/dotbalo/k8s-ha-install.git\n\n## github \u62c9\u53d6\u53d7\u7f51\u7edc\u9650\u5236\uff0c\u53ef\u4ee5\u4f7f\u7528gitee\u4ed3\u5e93\n$ cd /root/; git clone https://gitee.com/hujianli94net/k8s-ha-install\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5347\u7ea7\u7cfb\u7edf\uff1a</p> <pre><code>$ yum update -y\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#12-\u5185\u6838\u914d\u7f6e","title":"1.2 \u5185\u6838\u914d\u7f6e","text":"<p>\u4e3a\u4e86\u96c6\u7fa4\u7684\u7a33\u5b9a\u6027\u548c\u517c\u5bb9\u6027\uff0c\u751f\u4ea7\u73af\u5883\u7684\u5185\u6838\u6700\u597d\u5347\u7ea7\u52304.18\u7248\u672c\u4ee5\u4e0a\uff0c\u672c\u793a\u4f8b\u5c06\u5347\u7ea7\u52304.19\u7248\u672c\u3002</p> <p>\u79bb\u7ebf\u5347\u7ea7\u5185\u6838</p> <p>Master01\u4e0b\u8f7d\u79bb\u7ebf\u5305\uff1a</p> <pre><code>$ cd /root\n$ wget -c http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm\n$ wget -c http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm\n</code></pre> <p>\u5c06\u5b89\u88c5\u5305\u4eceMaster01\u8282\u70b9\u4f20\u5230\u5176\u4ed6\u8282\u70b9\uff1a</p> <pre><code>$ for i in k8s-master02 k8s-master03 k8s-node01;do scp kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm $i:/root/ ; done\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5\u5185\u6838\uff1a</p> <pre><code>$ cd /root &amp;&amp; yum localinstall -y kernel-ml*\n\n## \u6240\u6709\u8282\u70b9\u66f4\u6539\u5185\u6838\u542f\u52a8\u987a\u5e8f\n$ grub2-set-default  0 &amp;&amp; grub2-mkconfig -o /etc/grub2.cfg\n\n$ grubby --args=\"user_namespace.enable=1\" --update-kernel=\"$(grubby --default-kernel)\"\n# \u68c0\u67e5\u9ed8\u8ba4\u5185\u6838\u662f\u4e0d\u662f4.19\n$ grubby --default-kernel\n/boot/vmlinuz-4.19.12-1.el7.elrepo.x86_64\n\n# \u6240\u6709\u8282\u70b9\u91cd\u542f\uff0c\u7136\u540e\u68c0\u67e5\u5185\u6838\u662f\u4e0d\u662f4.19\n$ reboot\n$ uname -a\nLinux k8s-master02 4.19.12-1.el7.elrepo.x86_64 #1 SMP Fri Dec 21 11:06:36 EST 2018 x86_64 x86_64 x86_64 GNU/Linux\n</code></pre> <p>\u5728\u7ebf\u5347\u7ea7\u5185\u6838</p> <pre><code>$ upgrade Linux kernel\n$ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\n$ yum install -y https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm\n\n## \u5347\u7ea7\u5185\u6838\u4e2d\u9014\u4e0d\u8981\u968f\u610f\u4e2d\u65ad\uff0c\u9632\u6b62\u5347\u7ea7\u5931\u8d25\n$ yum --enablerepo=elrepo-kernel install kernel-ml-devel kernel-ml -y\n$ grub2-set-default 0 &amp;&amp; grub2-mkconfig -o /etc/grub2.cfg\n$ reboot\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5ipvsadm\u548cipset\uff1a</p> <pre><code>$ yum install ipvsadm ipset sysstat conntrack libseccomp -y\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eipvs\u6a21\u5757\uff0c\u5728\u5185\u68384.19+\u7248\u672cnf_conntrack_ipv4\u5df2\u7ecf\u6539\u4e3anf_conntrack\uff0c4.18\u4ee5\u4e0b\u7248\u672c\u4f7f\u7528nf_conntrack_ipv4\u5373\u53ef\uff1a</p> <pre><code>$ cat &gt;&gt; /etc/modules-load.d/ipvs.conf&lt;&lt;'EOF'\nip_vs\nip_vs_lc\nip_vs_wlc\nip_vs_rr\nip_vs_wrr\nip_vs_lblc\nip_vs_lblcr\nip_vs_dh\nip_vs_sh\nip_vs_fo\nip_vs_nq\nip_vs_sed\nip_vs_ftp\nip_vs_sh\nnf_conntrack\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\nEOF\n</code></pre> <p>\u7136\u540e\u6267\u884c</p> <pre><code>$ systemctl enable --now systemd-modules-load.service\n</code></pre> <p>\u5373\u53ef\u3002</p> <p>\u5f00\u542f\u4e00\u4e9bK8s\u96c6\u7fa4\u4e2d\u5fc5\u9700\u7684\u5185\u6838\u53c2\u6570\uff0c\u6240\u6709\u8282\u70b9\u914d\u7f6eK8s\u5185\u6838\uff1a</p> <pre><code>$ cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nfs.may_detach_mounts = 1\nnet.ipv4.conf.all.route_localnet = 1\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.netfilter.nf_conntrack_max=2310720\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl =15\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_orphans = 327680\nnet.ipv4.tcp_orphan_retries = 3\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.ip_conntrack_max = 65536\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_timestamps = 0\nnet.core.somaxconn = 16384\nEOF\n$ sysctl --system\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6e\u5b8c\u5185\u6838\u540e\uff0c\u91cd\u542f\u670d\u52a1\u5668\uff0c\u4fdd\u8bc1\u91cd\u542f\u540e\u5185\u6838\u4f9d\u65e7\u52a0\u8f7d\uff1a</p> <pre><code>$ reboot\n$ lsmod | grep --color=auto -e ip_vs -e nf_conntrack\nip_vs_ftp              16384  0\nnf_nat                 32768  1 ip_vs_ftp\nip_vs_sed              16384  0\nip_vs_nq               16384  0\nip_vs_fo               16384  0\nip_vs_sh               16384  0\nip_vs_dh               16384  0\nip_vs_lblcr            16384  0\nip_vs_lblc             16384  0\nip_vs_wrr              16384  0\nip_vs_rr               16384  0\nip_vs_wlc              16384  0\nip_vs_lc               16384  0\nip_vs                 151552  24 ip_vs_wlc,ip_vs_rr,ip_vs_dh,ip_vs_lblcr,ip_vs_sh,ip_vs_fo,ip_vs_nq,ip_vs_lblc,ip_vs_wrr,ip_vs_lc,ip_vs_sed,ip_vs_ftp\nnf_conntrack          143360  2 nf_nat,ip_vs\nnf_defrag_ipv6         20480  1 nf_conntrack\nnf_defrag_ipv4         16384  1 nf_conntrack\nlibcrc32c              16384  3 nf_conntrack,nf_nat,ip_vs\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#13-k8s\u7ec4\u4ef6\u548cruntime\u5b89\u88c5","title":"1.3 K8s\u7ec4\u4ef6\u548cRuntime\u5b89\u88c5","text":"<p>\u672c\u8282\u4e3b\u8981\u5b89\u88c5\u7684\u662f\u96c6\u7fa4\u4e2d\u7528\u5230\u7684\u5404\u79cd\u7ec4\u4ef6\uff0c\u6bd4\u5982docker-ce\u3001containerd\u3001Kubernetes\u7ec4\u4ef6\u7b49\u3002</p> <p>\u4e66\u4e2d\u4e3a\u8bfb\u8005\u51c6\u5907\u4e86\u4e24\u79cdRuntime\uff08\u8fd0\u884c\u65f6\uff09\u7684\u5b89\u88c5\uff1a</p> <ul> <li> <p>Docker</p> </li> <li> <p>Containerd</p> </li> </ul> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u8bfb\u8005\u5b89\u88c5\u7684Kubernetes\u7248\u672c\u9ad8\u4e8e1.24\uff08\u542b1.24\uff09\uff0c\u9700\u8981\u9009\u62e9Containerd\u4f5c\u4e3aRuntime\uff1b\u5982\u679c\u7248\u672c\u4f4e\u4e8e1.24\uff0cRuntime\u9009\u62e9Docker\u548cContainerd\u5747\u53ef\u3002</p> <p>docker\u548ccontainerd\u7684\u533a\u522b</p> <p>https://docs.youdianzhishi.com/k8s/runtime/overview/</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#131-containerd\u4f5c\u4e3aruntime","title":"1.3.1 Containerd\u4f5c\u4e3aRuntime","text":"<p>\u7531\u4e8eKubernetes 1.24\u4ee5\u4e0a\u7248\u672c\u5c06\u4e0d\u518d\u76f4\u63a5\u652f\u6301Docker\uff0c\u56e0\u6b64\u9700\u8981\u5c06Kubernetes\u7684Runtime\u6539\u4e3aContainerd\u3002\u56e0\u4e3a\u5b89\u88c5Docker\u65f6\u4f1a\u81ea\u52a8\u5b89\u88c5Containerd\uff0c\u5e76\u4e14\u540e\u9762\u7684\u8bfe\u7a0b\u4e5f\u8981\u4f7f\u7528\u5230Docker\uff0c\u6240\u4ee5\u8fd8\u662f\u5728\u6bcf\u4e2a\u8282\u70b9\u5b89\u88c5Docker\u3002</p> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5docker-ce-20.10\uff1a</p> <pre><code>$ yum install docker-ce-20.10.* docker-ce-cli-20.10.* -y\n</code></pre> <p>\u7531\u4e8e\u5e76\u4e0d\u662f\u6bcf\u4e2a\u8282\u70b9\u90fd\u9700\u8981Docker\u5f15\u64ce\uff0c\u56e0\u6b64\u65e0\u987b\u542f\u52a8Docker\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u548c\u542f\u52a8Containerd\u5373\u53ef\u3002</p> <p>\u9996\u5148\u914d\u7f6eContainerd\u6240\u9700\u7684\u6a21\u5757\uff08\u6240\u6709\u8282\u70b9\uff09\uff1a</p> <pre><code>$ cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf\noverlay\nbr_netfilter\nEOF\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u52a0\u8f7d\u6a21\u5757\uff1a</p> <pre><code>$ modprobe -- overlay\n$ modprobe -- br_netfilter\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eContainerd\u6240\u9700\u7684\u5185\u6838\uff1a</p> <pre><code>$ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward               = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u52a0\u8f7d\u5185\u6838\uff1a</p> <pre><code>$ sysctl --system\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eContainerd\u7684\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>$ mkdir -p /etc/containerd\n$ containerd config default | tee /etc/containerd/config.toml\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5c06Containerd\u7684Cgroup\u6539\u4e3aSystemd\uff1a</p> <pre><code>$ vim /etc/containerd/config.toml\n\n# \u627e\u5230containerd.runtimes.runc.options\uff0c\u6dfb\u52a0SystemdCgroup = true\n# \u6240\u6709\u8282\u70b9\u5c06sandbox_image\u7684Pause\u955c\u50cf\u6539\u6210\u7b26\u5408\u81ea\u5df1\u7248\u672c\u7684\u5730\u5740:registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u542f\u52a8Containerd\uff0c\u5e76\u914d\u7f6e\u5f00\u673a\u81ea\u542f\u52a8\uff1a</p> <pre><code>$ systemctl daemon-reload\n$ systemctl enable --now containerd\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6ecrictl\u5ba2\u6237\u7aef\u8fde\u63a5\u7684Runtime\u4f4d\u7f6e\uff1a</p> <pre><code>$ cat &gt; /etc/crictl.yaml &lt;&lt;EOF\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#132-docker\u4f5c\u4e3aruntime","title":"1.3.2 Docker\u4f5c\u4e3aRuntime","text":"<p>\u5982\u679c\u8bfb\u8005\u9009\u62e9Docker\u4f5c\u4e3aRuntime\uff0c\u5b89\u88c5\u6b65\u9aa4\u8f83Containerd\u66f4\u4e3a\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5b89\u88c5\u5e76\u542f\u52a8\u5373\u53ef\u3002</p> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5docker-ce 20.10\uff1a</p> <pre><code>$ yum install docker-ce-20.10.* docker-ce-cli-20.10.* -y\n</code></pre> <p>\u7531\u4e8e\u65b0\u7248Kubelet\u5efa\u8bae\u4f7f\u7528systemd\uff0c\u56e0\u6b64\u628aDocker\u7684CgroupDriver\u4e5f\u6539\u6210systemd\uff1a</p> <pre><code>$ mkdir -p /etc/docker  # \u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u76ee\u5f55\u5148\u521b\u5efa\uff0c\u7136\u540e\u6dfb\u52a0 daemon.json \u6587\u4ef6\n$ vi /etc/docker/daemon.json\n{\n\"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"registry-mirrors\" : [\n\"https://ot2k4d59.mirror.aliyuncs.com/\"\n]\n}\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8Docker\uff1a</p> <pre><code>$ systemctl daemon-reload &amp;&amp; systemctl enable --now docker\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#133-\u5b89\u88c5kubernetes\u7ec4\u4ef6","title":"1.3.3 \u5b89\u88c5Kubernetes\u7ec4\u4ef6","text":"<p>\u63a5\u4e0b\u6765\u5b89\u88c5Kubernetes\u7684\u7cfb\u7edf\u7ec4\u4ef6\u3002</p> <p>\u6240\u6709\u8282\u70b9\u6267\u884c</p> <pre><code>$ cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n</code></pre> <p>\u9996\u5148\u5728Master01\u8282\u70b9\u67e5\u770b\u6700\u65b0\u7684Kubernetes\u7248\u672c\u662f\u591a\u5c11\uff1a</p> <pre><code>$ yum list kubeadm.x86_64 --showduplicates | sort -r\n</code></pre> <p>\u5bfc\u8a00</p> <p>\u5047\u5982\u8bfb\u8005\u770b\u5230\u76841.23.*\uff0c\u76f4\u63a5\u5b89\u88c51.23\u7248\u5373\u53ef\uff0c\u5982\u679c\u662f\u5176\u4ed6\u7248\u672c\uff0c\u5219\u76f4\u63a5\u5b89\u88c5\u6700\u65b0\u7248\u3002</p> <p>\u5982\u679c\u662f\u751f\u4ea7\u73af\u5883\uff0c\u5efa\u8bae\u5b89\u88c5\u7b2c\u4e09\u4e2a\u7248\u672c\u53f7\u5927\u4e8e5\u7684\u7248\u672c\uff0c\u6bd4\u59821.23.5\u3002</p> <p>\u5982\u679c\u6ca1\u67091.23.5\uff0c\u53ea\u67091.23.3\u7b49\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u75281.22.5+\u7b49\u3002\u5f53\u7136\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u6700\u65b0\u7684\u529f\u80fd\uff0c\u5b89\u88c51.23.3\u4e5f\u53ef\u4ee5\u3002</p> <pre><code>## # --disableexcludes \u7981\u6389\u9664\u4e86kubernetes\u4e4b\u5916\u7684\u522b\u7684\u4ed3\u5e93\n$ yum install kubeadm-1.23.5 kubelet-1.23.5 kubectl-1.23.5 -y --disableexcludes=kubernetes\n</code></pre> <p>\u5f53\u7136\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u6700\u65b0\u7684\u529f\u80fd\uff0c\u5b89\u88c51.23.3\u4e5f\u53ef\u4ee5\u3002</p> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c51.25\u6700\u65b0\u7248\u672ckubeadm\u3001kubelet\u548ckubectl\uff1a</p> <pre><code>$ yum install kubeadm-1.25* kubelet-1.25* kubectl-1.25* -y --disableexcludes=kubernetes\n</code></pre> <p>\u66f4\u6539Kubelet\u7684\u914d\u7f6e\u4f7f\u7528Containerd\u4f5c\u4e3aRuntime\uff1a</p> <pre><code>$ cat &gt;/etc/sysconfig/kubelet&lt;&lt;EOF\nKUBELET_KUBEADM_ARGS=\"--container-runtime=remote --runtime-request-timeout=15m --container-runtime-endpoint=unix:///run/containerd/containerd.sock\"\nEOF\n</code></pre> <p>\u6ce8\u610f</p> <p>\u6ce8\u610f \u5982\u679c\u8bfb\u8005\u4e0d\u662f\u91c7\u7528Containerd\u4f5c\u4e3aRuntime\uff0c\u4e0d\u9700\u8981\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u3002</p> <p>\u6240\u6709\u8282\u70b9\u8bbe\u7f6eKubelet\u5f00\u673a\u81ea\u542f\u52a8\uff08\u7531\u4e8e\u8fd8\u672a\u521d\u59cb\u5316\uff0c\u6ca1\u6709Kubelet\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6b64\u65f6Kubelet\u65e0\u6cd5\u542f\u52a8\uff0c\u65e0\u987b\u7ba1\u7406\uff09\uff1a</p> <pre><code>$ systemctl daemon-reload\n$ systemctl enable --now kubelet\n</code></pre> <p>\u67e5\u770b\u7248\u672c\u4fe1\u606f</p> <pre><code>$ kubelet --version\nKubernetes v1.25.6\n\n$ kubectl version\nWARNING: This version information is deprecated and will be replaced with the output from kubectl version --short.  Use --output=yaml|json to get the full version.\nClient Version: version.Info{Major:\"1\", Minor:\"25\", GitVersion:\"v1.25.6\", GitCommit:\"ff2c119726cc1f8926fb0585c74b25921e866a28\", GitTreeState:\"clean\", BuildDate:\"2023-01-18T19:22:09Z\", GoVersion:\"go1.19.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\nKustomize Version: v4.5.7\nThe connection to the server localhost:8080 was refused - did you specify the right host or port?\n\n$ kubeadm version\nkubeadm version: &amp;version.Info{Major:\"1\", Minor:\"25\", GitVersion:\"v1.25.6\", GitCommit:\"ff2c119726cc1f8926fb0585c74b25921e866a28\", GitTreeState:\"clean\", BuildDate:\"2023-01-18T19:20:37Z\", GoVersion:\"go1.19.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#14-\u9ad8\u53ef\u7528\u7ec4\u4ef6\u5b89\u88c5","title":"1.4 \u9ad8\u53ef\u7528\u7ec4\u4ef6\u5b89\u88c5","text":"<p>\u672c\u4e66\u91c7\u7528KeepAlived\u548cHAProxy\u5b9e\u73b0\u9ad8\u53ef\u7528\uff0c\u6240\u4ee5\u9700\u8981\u5b89\u88c5KeepAlived\u548cHAProxy\u3002</p> <p>KeepAlived\u548cHAProxy\u7684\u8282\u70b9\u53ef\u4ee5\u548cMaster\u5728\u540c\u4e00\u4e2a\u8282\u70b9\uff0c\u4e5f\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u8282\u70b9\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u662f\u5728\u516c\u6709\u4e91\u642d\u5efa\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c\u53ef\u4ee5\u91c7\u7528\u516c\u6709\u4e91\u7684\u8d1f\u8f7d\u5747\u8861\u66ff\u4ee3KeepAlived\u548cHAProxy\u3002</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\u6211\u4eec\u521b\u5efa2\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u865a\u62df\u673a\uff0c\u7136\u540e\u5206\u914d\u4e00\u4e2a VIP\uff0c\u7136\u540e\u4f7f\u7528 VIP \u4e3a\u8d1f\u8f7d\u5747\u8861\u5668\u63d0\u4f9b\u670d\u52a1\uff0c\u901a\u8fc7 VIP \u5c06\u6d41\u91cf\u91cd\u5b9a\u5411\u5230\u540e\u7aef\u7684\u67d0\u4e2a Kubernetes \u63a7\u5236\u5668\u5e73\u9762\u8282\u70b9\u4e0a\u3002</p> <p>\u63d0\u793a</p> <p>\u5982\u679c\u8bfb\u8005\u60f3\u8981\u642d\u5efa\u53ea\u6709\u4e00\u4e2aMaster\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u53ef\u4ee5\u4e0d\u5b89\u88c5\u9ad8\u53ef\u7528\u7ec4\u4ef6\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#141-\u5b89\u88c5haproxy\u548ckeepalived","title":"1.4.1 \u5b89\u88c5Haproxy\u548cKeepalived","text":"<p>\u6240\u6709Master\u8282\u70b9\u901a\u8fc7yum\u5b89\u88c5HAProxy\u548cKeepAlived\uff1a</p> <pre><code>$ yum install keepalived haproxy -y\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#142-haproxy\u914d\u7f6e","title":"1.4.2 Haproxy\u914d\u7f6e","text":"<p>\u6240\u6709Master\u8282\u70b9\u914d\u7f6eHAProxy\uff08\u8be6\u7ec6\u914d\u7f6e\u53ef\u53c2\u8003HAProxy\u5b98\u65b9\u6587\u6863\uff0c\u6240\u6709Master\u8282\u70b9\u7684HAProxy\u914d\u7f6e\u76f8\u540c\uff09\uff1a</p> <pre><code>$ cat &gt; /etc/haproxy/haproxy.cfg &lt;&lt; EOF\n#---------------------------------------------------------------------\n# Global settings\n#---------------------------------------------------------------------\nglobal\n    log         127.0.0.1 local2    \n    chroot      /var/lib/haproxy\n    pidfile     /var/run/haproxy.pid\n    maxconn     4000\n    user        haproxy\n    group       haproxy\n    daemon \n    stats socket /var/lib/haproxy/stats\ndefaults\n    mode                    http\n    log                     global\n    option                  httplog\n    option                  dontlognull\n    option http-server-close\n    option forwardfor       except 127.0.0.0/8\n    option                  redispatch\n    retries                 3\n    timeout http-request    10s\n    timeout queue           1m\n    timeout connect         10s\n    timeout client          1m\n    timeout server          1m\n    timeout http-keep-alive 10s\n    timeout check           10s\n    maxconn                 3000\n#---------------------------------------------------------------------\n# kubernetes apiserver frontend which proxys to the backends\n#--------------------------------------------------------------------- \nfrontend kubernetes-apiserver\n    mode                 tcp\n    bind                 *:16443\n    option               tcplog\n    default_backend      kubernetes-apiserver    \n#---------------------------------------------------------------------\n# round robin balancing between the various backends\n#---------------------------------------------------------------------\nbackend kubernetes-apiserver\n    mode        tcp\n    balance     roundrobin\n    server      master01.k8s.io   192.168.1.190:6443 check\n    server      master02.k8s.io   192.168.1.191:6443 check\n    server      master03.k8s.io   192.168.1.192:6443 check\n#---------------------------------------------------------------------\n# collection haproxy statistics message\n#---------------------------------------------------------------------\nlisten stats\n    bind                 *:1080\n    stats auth           admin:awesomePassword\n    stats refresh        5s\n    stats realm          HAProxy\\ Statistics\n    stats uri            /admin?stats\nEOF\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#143-keepalived\u914d\u7f6e","title":"1.4.3 Keepalived\u914d\u7f6e","text":"<p>\u6240\u6709Master\u8282\u70b9\u914d\u7f6eKeepAlived\uff0c\u7531\u4e8eKeepAlived\u9700\u8981\u914d\u7f6e\u81ea\u8eab\u7684IP\u5730\u5740\u548c\u7f51\u5361\u540d\u79f0\uff0c\u56e0\u6b64\u6bcf\u4e2aKeepAlived\u8282\u70b9\u7684\u914d\u7f6e\u4e0d\u4e00\u6837\u3002</p> <p>Master01\u8282\u70b9\u7684\u914d\u7f6e\uff08\u6ce8\u610f\u6bcf\u4e2a\u8282\u70b9\u7684IP\u548c\u7f51\u5361interface\u53c2\u6570\uff09\uff1a</p> <pre><code>Master01\u8282\u70b9\u7684\u914d\u7f6e\uff1a\n$ vim /etc/keepalived/keepalived.conf ! Configuration File for keepalived\nglobal_defs {\nrouter_id k8s\n    script_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\nscript \"/etc/keepalived/check_apiserver.sh\"\ninterval 5\nweight -5\n    fall 2  rise 1\n}\nvrrp_instance VI_1 {\nstate MASTER\n    interface eth0\n    mcast_src_ip 192.168.1.190\n    virtual_router_id 99\npriority 101\nadvert_int 2\nauthentication {\nauth_type PASS\n        auth_pass ceb1b3ec013d66163d6ab\n    }\nvirtual_ipaddress {\n192.168.1.193\n    }\ntrack_script {\nchk_apiserver\n    }\n}\n</code></pre> <p>Master02\u8282\u70b9\u7684\u914d\u7f6e\uff08\u6ce8\u610f\u66f4\u6539\u52a0\u7c97\u90e8\u5206\u7684\u914d\u7f6e\uff09\uff1a</p> <pre><code>$ vim /etc/keepalived/keepalived.conf ! Configuration File for keepalived\nglobal_defs {\nrouter_id k8s\n    script_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\nscript \"/etc/keepalived/check_apiserver.sh\"\ninterval 5\nweight -5\n    fall 2  rise 1\n}\nvrrp_instance VI_1 {\nstate BACKUP\n    interface eth0\n    mcast_src_ip 192.168.1.191\n    virtual_router_id 99\npriority 100\nadvert_int 2\nauthentication {\nauth_type PASS\n        auth_pass ceb1b3ec013d66163d6ab\n    }\nvirtual_ipaddress {\n192.168.1.193\n    }\ntrack_script {\nchk_apiserver\n    }\n}\n</code></pre> <p>Master03\u8282\u70b9\u7684\u914d\u7f6e\uff08\u6ce8\u610f\u66f4\u6539\u52a0\u7c97\u90e8\u5206\u7684\u914d\u7f6e\uff09\uff1a</p> <pre><code>$ vim /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\nglobal_defs {\nrouter_id k8s\n    script_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\nscript \"/etc/keepalived/check_apiserver.sh\"\ninterval 5\nweight -5\n    fall 2  rise 1\n}\nvrrp_instance VI_1 {\nstate BACKUP\n    interface eth0\n    mcast_src_ip 192.168.1.192\n    virtual_router_id 99\npriority 100\nadvert_int 2\nauthentication {\nauth_type PASS\n        auth_pass ceb1b3ec013d66163d6ab\n    }\nvirtual_ipaddress {\n192.168.1.193\n    }\ntrack_script {\nchk_apiserver\n    }\n}\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#144-\u5065\u5eb7\u68c0\u67e5\u811a\u672c","title":"1.4.4 \u5065\u5eb7\u68c0\u67e5\u811a\u672c","text":"<p>\u6240\u6709Master\u8282\u70b9\u914d\u7f6eKeepAlived\u5065\u5eb7\u68c0\u67e5\u6587\u4ef6\uff1a</p> <pre><code>$ cat &gt;/etc/keepalived/check_apiserver.sh&lt;&lt;EOF\n#!/bin/bash\nerr=0\nfor k in $(seq 1 3)\ndo\n    check_code=$(pgrep haproxy)\n    if [[ $check_code == \"\" ]]; then\n        err=$(expr $err + 1)\n        sleep 1\n        continue\n    else\n        err=0\n        break\n    fi\ndone\nif [[ $err != \"0\" ]]; then\n    echo \"systemctl stop keepalived\"\n    /usr/bin/systemctl stop keepalived\n    exit 1\nelse\n    exit 0\nfi\nEOF\n$ chmod +x /etc/keepalived/check_apiserver.sh\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#145-\u542f\u52a8","title":"1.4.5 \u542f\u52a8","text":"<p>\u542f\u52a8haproxy\u548ckeepalived\uff1a</p> <pre><code>$ systemctl daemon-reload\n$ systemctl enable --now haproxy\n$ systemctl enable --now keepalived\n</code></pre> <p>\u5982\u679c\u662f\u7528HAProxy\u548cKeepAlived\u5b9e\u73b0\u7684\u9ad8\u53ef\u7528\uff0c\u5219\u9700\u8981\u6d4b\u8bd5VIP\u662f\u5426\u662f\u6b63\u5e38\u7684\uff1a</p> <pre><code>## \u6240\u6709\u8282\u70b9\u8fdb\u884cping\u6d4b\u8bd5\n$ ping 192.168.1.193 -c 4\nPING 192.168.1.193 (192.168.1.193) 56(84) bytes of data.\n64 bytes from 192.168.1.193: icmp_seq=1 ttl=64 time=0.120 ms\n64 bytes from 192.168.1.193: icmp_seq=2 ttl=64 time=0.061 ms\n64 bytes from 192.168.1.193: icmp_seq=3 ttl=64 time=0.043 ms\n64 bytes from 192.168.1.193: icmp_seq=4 ttl=64 time=0.047 ms\n--- 10.0.0.236 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3106ms\nrtt min/avg/max/mdev = 0.062/0.163/0.464/0.173 ms\n\n## \u6240\u6709\u8282\u70b9\u8fdb\u884ctelnet\u6d4b\u8bd5\n$ telnet 192.168.1.193 16443\nTrying 10.0.0.236...\nConnected to 10.0.0.236.\nEscape character is '^]'.\nConnection closed by foreign host.\n</code></pre> <p>\u5982\u679cping\u4e0d\u901a\u4e14telnet\u6ca1\u6709\u51fa\u73b0\uff0c\u5219\u8ba4\u4e3aVIP\u4e0d\u53ef\u7528\u3002</p> <p>\u5982\u679cVIP\u4e0d\u53ef\u7528\uff0c\u4e0d\u53ef\u518d\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\uff0c\u9700\u8981\u6392\u67e5VIP\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u9632\u706b\u5899\u548cSELinux\u3001HAProxy\u548cKeepalived\u7684\u72b6\u6001\uff0c\u76d1\u542c\u7aef\u53e3\u662f\u5426\u6b63\u5e38\u7b49\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#15-\u96c6\u7fa4\u521d\u59cb\u5316","title":"1.5 \u96c6\u7fa4\u521d\u59cb\u5316","text":"<p>\u4f7f\u7528Kubeadm\u5b89\u88c5\u96c6\u7fa4\u65f6\uff0c\u9700\u8981\u4e00\u4e2aMaster\u8282\u70b9\u521d\u59cb\u5316\u96c6\u7fa4\uff0c\u7136\u540e\u52a0\u5165\u5176\u4ed6\u8282\u70b9\u5373\u53ef\u3002</p> <p>\u521d\u59cb\u5316\u96c6\u7fa4\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528Kubeadm\u547d\u4ee4\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u7531\u4e8e\u4f7f\u7528\u547d\u4ee4\u884c\u7684\u5f62\u5f0f\u53ef\u80fd\u9700\u8981\u914d\u7f6e\u7684\u5b57\u6bb5\u6bd4\u8f83\u591a\uff0c\u56e0\u6b64\u672c\u793a\u4f8b\u91c7\u7528\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u521d\u59cb\u5316\u3002</p> <p>\u6ce8\u610f</p> <p>\u9996\u5148\u521b\u5efa\u7684\u662fkubeadm\u914d\u7f6e\u6587\u4ef6\uff0c\u5bbf\u4e3b\u673a\u7f51\u6bb5\u3001podSubnet\u7f51\u6bb5\u3001serviceSubnet\u7f51\u6bb5\u4e0d\u80fd\u91cd\u590d\uff1b</p> <p>\u5176\u6b21\uff0ckubernetesVersion\u7684\u503c\u6539\u4e3a\u548c\u8bfb\u8005\u73af\u5883Kubeadm\u7248\u672c\u4e00\u81f4\uff0c\u53ef\u4ee5\u901a\u8fc7kubeadm version\u547d\u4ee4\u67e5\u8be2\uff1b</p> <p>\u6700\u540e\uff0c\u5982\u679c\u4e0d\u662f\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0ccontrolPlaneEndpoint\u9700\u8981\u6539\u4e3aMaster\u8282\u70b9\u7684IP\u548c6443\u7aef\u53e3\uff0ccertSANs\u4e5f\u9700\u8981\u6539\u4e3aMaster\u8282\u70b9\u7684IP\u3002</p> <p>\u6ce8\u610fcriSocket\u66f4\u6539\u4e3a\u81ea\u5df1\u7684Runtime\u3002</p> <p>Master01\u8282\u70b9\u521b\u5efakubeadm-config.yaml\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff08\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u81ea\u52a8\u751f\u6210<code>kubeadm config print init-defaults &gt; kubeadm-config.yaml</code>\uff09\uff1a</p> <p><code>kubeadm-config.yaml</code></p> <pre><code>apiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n- system:bootstrappers:kubeadm:default-node-token\ntoken: abcdef.0123456789abcdef\nttl: 24h0m0s\nusages:\n- signing\n- authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\nadvertiseAddress: 192.168.1.190\nbindPort: 6443\nnodeRegistration:\ncriSocket: unix:///var/run/containerd/containerd.sock\nimagePullPolicy: IfNotPresent\nname: k8s-master01\ntaints:\n- effect: NoSchedule\nkey: node-role.kubernetes.io/master\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: ipvs      # kube-proxy \u6a21\u5f0f\n---\napiServer:\ncertSANs:\n- 192.168.1.193\ntimeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrolPlaneEndpoint: 192.168.1.193:6443\ncontrollerManager: {}\ndns: {}\netcd:\nlocal:\ndataDir: /var/lib/etcd\nimageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: v1.25.6  # \u66f4\u6539\u6b64\u5904\u7684\u7248\u672c\u53f7\u548ckubeadm version\u4e00\u81f4\nnetworking:\ndnsDomain: cluster.local\npodSubnet: 172.16.0.0/12\nserviceSubnet: 192.168.0.0/16\nscheduler: {}\n</code></pre> <p>\u7531\u4e8e\u8bfb\u8005\u7684\u7248\u672c\u548c\u6b64\u793a\u4f8b\u53ef\u80fd\u4e0d\u592a\u4e00\u81f4\uff0c\u56e0\u6b64\u9700\u8981\u66f4\u65b0\u4e00\u4e0bkubeadm\u914d\u7f6e\u6587\u4ef6\uff08Master01\u8282\u70b9\u64cd\u4f5c\uff09\uff1a</p> <pre><code>$ kubeadm config migrate --old-config kubeadm-config.yaml --new-config new.yaml\n</code></pre> <p>\u5c06new.yaml\u6587\u4ef6\u590d\u5236\u5230\u5176\u4ed6Master\u8282\u70b9\uff1a</p> <pre><code>$ for i in k8s-master02 k8s-master03; do scp new.yaml $i:/root/; done\n</code></pre> <p>\u4e4b\u540e\u6240\u6709Master\u8282\u70b9\u63d0\u524d\u4e0b\u8f7d\u955c\u50cf\uff0c\u53ef\u4ee5\u8282\u7701\u521d\u59cb\u5316\u65f6\u95f4\uff08\u5176\u4ed6\u8282\u70b9\u4e0d\u9700\u8981\u66f4\u6539\u4efb\u4f55\u914d\u7f6e\uff0c\u5305\u62ecIP\u5730\u5740\u4e5f\u4e0d\u9700\u8981\u66f4\u6539\uff09\uff1a</p> <pre><code>$ kubeadm config images pull --config /root/new.yaml [config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.25.0\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.25.0\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.25.0\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.25.0\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.6-0\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.9.3\n</code></pre> <p>\u521d\u59cb\u5316Master01\u8282\u70b9\uff0c\u521d\u59cb\u5316\u4ee5\u540e\u4f1a\u5728/etc/kubernetes\u76ee\u5f55\u4e0b\u751f\u6210\u5bf9\u5e94\u7684\u8bc1\u4e66\u548c\u914d\u7f6e\u6587\u4ef6\uff0c\u4e4b\u540e\u5176\u4ed6Master\u8282\u70b9\u52a0\u5165Master01\u5373\u53ef\uff1a</p> <pre><code>$ kubeadm init --upload-certs --config /root/new.yaml\n</code></pre> <p>\u521d\u59cb\u5316\u6210\u529f\u4ee5\u540e\uff0c\u4f1a\u4ea7\u751fToken\u503c\uff0c\u7528\u4e8e\u5176\u4ed6\u8282\u70b9\u52a0\u5165\u65f6\u4f7f\u7528\uff0c\u56e0\u6b64\u8981\u8bb0\u5f55\u4e00\u4e0b\u521d\u59cb\u5316\u6210\u529f\u751f\u6210\u7684token\u503c\uff08\u4ee4\u724c\u503c\uff09\uff1a</p> <pre><code>Your Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\nmkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\nexport KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nYou can now join any number of the control-plane node running the following command on each as root:\n\nkubeadm join 192.168.1.193:16443 --token abcdef.0123456789abcdef \\\n--discovery-token-ca-cert-hash sha256:4967912ebd27dc2541b108fcf80f8c0310e83cf24a79361f56c89aefdb0c2043 \\\n--control-plane --certificate-key 00523d224310fbab1f4feb18e8a9376087ed4cec14634b733c5ff037fdacc4e0\n\nPlease note that the certificate-key gives access to cluster sensitive data, keep it secret!\nAs a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use\n\"kubeadm init phase upload-certs --upload-certs\" to reload certs afterward.\n\nThen you can join any number of worker nodes by running the following on each as root:\nkubeadm join 192.168.1.193:16443 --token abcdef.0123456789abcdef \\\n--discovery-token-ca-cert-hash sha256:4967912ebd27dc2541b108fcf80f8c0310e83cf24a79361f56c89aefdb0c2043\n\n# \u68c0\u67e5\u7f51\u7edc\u662f\u5426\u751f\u6548\n$ kubectl cluster-info dump | grep -m 1 cluster-cidr\n                            \"--cluster-cidr=172.16.0.0/12\"\n$ mkdir -p $HOME/.kube\n$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n$ sudo chown $(id -u):$(id -g) $HOME/.kube/config\n</code></pre> <p>\u5982\u679c\u521d\u59cb\u5316\u5931\u8d25\uff0c\u9700\u8981\u68c0\u67e5\u5404\u9879\u914d\u7f6e\u662f\u5426\u6b63\u786e\uff0c\u4e4b\u540e\u518d\u6b21\u521d\u59cb\u5316\uff0c\u6e05\u7406\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>$ kubeadm reset -f ; ipvsadm --clear  ; rm -rf ~/.kube\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#151-\u914d\u7f6ekubectl","title":"1.5.1 \u914d\u7f6ekubectl","text":"<p>\u521d\u59cb\u5316\u6210\u529f\u540e\uff0cMaster01\u8282\u70b9\u914d\u7f6eKUBECONFIG\u73af\u5883\u53d8\u91cf\uff0c\u4e4b\u540eKubectl\u5373\u53ef\u8bbf\u95eeKubernetes\u96c6\u7fa4\uff1a</p> <pre><code># \u8bbe\u7f6eKubectl \u81ea\u52a8\u8865\u5168\n$ yum install bash-completion -y\n$ source &lt;(kubectl completion bash) # \u5728 bash \u4e2d\u8bbe\u7f6e\u5f53\u524d shell \u7684\u81ea\u52a8\u8865\u5168\uff0c\u8981\u5148\u5b89\u88c5 bash-completion \u5305\u3002\n$ echo \"source &lt;(kubectl completion bash)\" &gt;&gt; ~/.bashrc # \u5728\u4f60\u7684 bash shell \u4e2d\u6c38\u4e45\u5730\u6dfb\u52a0\u81ea\u52a8\u8865\u5168\n$ kubectl completion bash &gt;/etc/bash_completion.d/kubectl\n\n$ cat &lt;&lt;EOF &gt;&gt; /root/.bashrc\nexport KUBECONFIG=/etc/kubernetes/admin.conf\necho 'alias k=kubectl'\necho 'complete -F __start_kubectl k'\nEOF\n$ source /root/.bashrc\n</code></pre> <p>\u67e5\u770b\u8282\u70b9\u72b6\u6001</p> <pre><code>$ kubectl get node\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#152-\u914d\u7f6ehelm","title":"1.5.2 \u914d\u7f6ehelm","text":"<pre><code>$ wget https://mirrors.huaweicloud.com/helm/v3.7.2/helm-v3.7.2-linux-amd64.tar.gz\n$ tar -zxvf helm-v3.7.2-linux-amd64.tar.gz $ cp linux-amd64/helm /usr/local/bin/\n$ chmod a+x  /usr/local/bin/helm\n\n#\u67e5\u770b\u7248\u672c\n$ helm version\nversion.BuildInfo{Version:\"v3.7.2\", GitCommit:\"663a896f4a815053445eec4153677ddc24a0a361\", GitTreeState:\"clean\", GoVersion:\"go1.16.10\"}\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#16-master\u5b9e\u73b0\u9ad8\u53ef\u7528","title":"1.6 Master\u5b9e\u73b0\u9ad8\u53ef\u7528","text":"<p>\u5176\u4ed6Master\u8282\u70b9\u548cNode\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\uff0c\u65b9\u6cd5\u662f\u4e00\u81f4\u7684\uff0c\u53ea\u4e0d\u8fc7Master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\u65f6\u9700\u8981\u6307\u5b9a--control-plane\u548c--certificate-key\u53c2\u6570\u3002</p> <p>\u5c06Master02\u548cMaster03\u52a0\u5165\u96c6\u7fa4\uff0c\u4e24\u4e2a\u8282\u70b9\u5206\u522b\u6267\u884c\uff1a</p> <pre><code>$ kubeadm join 192.168.1.193:16443 --token abcdef.0123456789abcdef \\\n--discovery-token-ca-cert-hash sha256:4967912ebd27dc2541b108fcf80f8c0310e83cf24a79361f56c89aefdb0c2043 \\\n--control-plane --certificate-key 00523d224310fbab1f4feb18e8a9376087ed4cec14634b733c5ff037fdacc4e0\n</code></pre> <p>3\u4e2aMaster\u8282\u70b9\u52a0\u5165\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u6b64\u65f6\u7684\u8282\u70b9\u72b6\u6001</p> <pre><code>$ kubectl get node\nUnable to connect to the server: net/http: TLS handshake timeout\n\n$ kubectl  get nodes\nNAME           STATUS     ROLES           AGE     VERSION\nk8s-master01   NotReady   control-plane   5m21s   v1.25.6\nk8s-master02   NotReady   control-plane   20s     v1.25.6\nk8s-master03   NotReady   control-plane   88s     v1.25.6\nk8s-node01     NotReady   &lt;none&gt;          2m3s    v1.25.6\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#17-\u6dfb\u52a0worker\u8282\u70b9","title":"1.7 \u6dfb\u52a0Worker\u8282\u70b9","text":"<pre><code>$ kubeadm join 192.168.1.193:16443 --token abcdef.0123456789abcdef \\\n--discovery-token-ca-cert-hash sha256:4967912ebd27dc2541b108fcf80f8c0310e83cf24a79361f56c89aefdb0c2043\n</code></pre> <p>\u63d0\u793a</p> <p>\u6240\u6709\u8282\u70b9\u52a0\u5165\u540e\uff0c\u8282\u70b9\u7684STATUS\u5b57\u6bb5\u4e3aNotReady\uff0c\u7531\u4e8e\u7248\u672c\u4e0d\u540c\uff0c\u663e\u793a\u7684\u7ed3\u679c\u53ef\u80fd\u4e5f\u4e0d\u540c\uff0c\u5982\u679c\u662fNotReady\uff0c\u5b89\u88c5\u5b8cCNI\u5373\u53ef\u53d8\u6210Ready\u72b6\u6001\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#18-token\u8fc7\u671f\u5904\u7406","title":"1.8 Token\u8fc7\u671f\u5904\u7406","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u65b0\u5efa\u7684\u96c6\u7fa4Token\u6709\u6548\u671f\u662f24\u5c0f\u65f6\uff0c\u5982\u679c\u8fc7\u671f\u7684\u8bdd\uff0c\u9700\u8981\u91cd\u65b0\u751f\u6210Token\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u751f\u6210\uff1a</p> <pre><code>$ kubeadm token create --print-join-command\n</code></pre> <p>\u5982\u679c\u9700\u8981\u6dfb\u52a0Master\uff0ccertificate-key\u4e5f\u9700\u8981\u91cd\u65b0\u751f\u6210\uff1a</p> <pre><code>$ kubeadm init phase upload-certs  --upload-certs\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#19-calico\u7ec4\u4ef6\u7684\u5b89\u88c5","title":"1.9 Calico\u7ec4\u4ef6\u7684\u5b89\u88c5","text":"<p>\u63a5\u4e0b\u6765\u5b89\u88c5CNI\u63d2\u4ef6\uff0cCNI\u63d2\u4ef6\u53ef\u4ee5\u9009\u62e9Calico\u6216\u8005Flannel\u7b49\u3002</p> <p>\u7531\u4e8e\u672c\u4e66\u540e\u671f\u6d89\u53ca\u7f51\u7edc\u7b56\u7565\uff08NetworkPolicy\uff09\u7684\u5b66\u4e60\uff0c\u9700\u8981CNI\u63d2\u4ef6\u652f\u6301NetworkPolicy\uff0c\u56e0\u6b64\u672c\u6b21\u5b89\u88c5\u7684\u662fCalico\uff08Flannel\u6682\u4e0d\u652f\u6301\uff09\u3002</p> <p>\u5728Master01\u8282\u70b9\u5b89\u88c5Calico\uff08\u6ce8\u610f\u5176\u4e2d1.23\u7684\u7248\u672c\u53f7\u9700\u8981\u6539\u6210\u8bfb\u8005\u4f7f\u7528\u7684\u7248\u672c\u53f7\uff09\uff1a</p> <pre><code>$ cd /root/k8s-ha-install &amp;&amp; git checkout manual-installation-v1.25.x &amp;&amp; cd calico/\n</code></pre> <p>\u4fee\u6539Pod\u7f51\u6bb5\uff1a</p> <pre><code>$ POD_SUBNET=`cat /etc/kubernetes/manifests/kube-controller-manager.yaml | grep cluster-cidr= | awk -F= '{print $NF}'`\n$ sed -i \"s#POD_CIDR#${POD_SUBNET}#g\" calico.yaml\n\n$ kubectl apply -f calico.yaml\n</code></pre> <p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u7b49\u5f85\u51e0\u5206\u949f\u540e\u67e5\u770b\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pod -n kube-system\nNAME                                       READY   STATUS    RESTARTS   AGE\ncalico-kube-controllers-86d8c4fb68-4wk7q   1/1     Running   0          3m50s\ncalico-node-8cqhj                          1/1     Running   0          3m50s\ncalico-node-9dq92                          1/1     Running   0          3m50s\ncalico-node-dw6tq                          1/1     Running   0          3m50s\ncalico-node-g94pp                          1/1     Running   0          3m50s\ncalico-typha-768795f74d-clpvm              1/1     Running   0          3m49s\ncoredns-7f8cbcb969-f7chc                   1/1     Running   0          10m\ncoredns-7f8cbcb969-fv9fv                   1/1     Running   0          10m\netcd-k8s-master01                          1/1     Running   0          11m\netcd-k8s-master02                          1/1     Running   0          6m\netcd-k8s-master03                          1/1     Running   0          7m7s\nkube-apiserver-k8s-master01                1/1     Running   0          11m\nkube-apiserver-k8s-master02                1/1     Running   0          5m48s\nkube-apiserver-k8s-master03                1/1     Running   0          7m\nkube-controller-manager-k8s-master01       1/1     Running   0          11m\nkube-controller-manager-k8s-master02       1/1     Running   0          6m2s\nkube-controller-manager-k8s-master03       1/1     Running   0          5m54s\nkube-proxy-jcm25                           1/1     Running   0          6m10s\nkube-proxy-q8msx                           1/1     Running   0          10m\nkube-proxy-rtwdz                           1/1     Running   0          7m53s\nkube-proxy-s2xvg                           1/1     Running   0          7m18s\nkube-scheduler-k8s-master01                1/1     Running   0          11m\nkube-scheduler-k8s-master02                1/1     Running   0          5m59s\nkube-scheduler-k8s-master03                1/1     Running   0          7m6s\n\n# kubectl  get nodes\nNAME           STATUS   ROLES           AGE     VERSION\nk8s-master01   Ready    control-plane   11m     v1.25.6\nk8s-master02   Ready    control-plane   6m25s   v1.25.6\nk8s-master03   Ready    control-plane   7m33s   v1.25.6\nk8s-node01     Ready    &lt;none&gt;          8m8s    v1.25.6\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#110-metrics\u90e8\u7f72","title":"1.10 Metrics\u90e8\u7f72","text":"<p>\u5728\u65b0\u7248\u7684Kubernetes\u4e2d\uff0c\u7cfb\u7edf\u8d44\u6e90\u7684\u91c7\u96c6\u4f7f\u7528Metrics-server\uff0c\u53ef\u4ee5\u901a\u8fc7Metrics\u91c7\u96c6\u8282\u70b9\u548cPod\u7684\u5185\u5b58\u3001\u78c1\u76d8\u3001CPU\u548c\u7f51\u7edc\u7684\u4f7f\u7528\u7387\u3002</p> <p>\u5c06Master01\u8282\u70b9\u7684front-proxy-ca.crt\u590d\u5236\u5230\u6240\u6709Node\u8282\u70b9\uff1a</p> <pre><code>$ scp /etc/kubernetes/pki/front-proxy-ca.crt k8s-node01:/etc/kubernetes/pki/front-proxy-ca.crt\n$ scp /etc/kubernetes/pki/front-proxy-ca.crt k8s-node(\u5176\u4ed6\u8282\u70b9\u81ea\u884c\u62f7\u8d1d):/etc/kubernetes/pki/front-proxy-ca.crt\n</code></pre> <p>\u5b89\u88c5metrics server\uff1a</p> <pre><code>$ cd /root/k8s-ha-install/kubeadm-metrics-server\n\n$ kubectl create -f comp.yaml serviceaccount/metrics-server created\nclusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created\nclusterrole.rbac.authorization.k8s.io/system:metrics-server created\nrolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created\nclusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created\nclusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created\nservice/metrics-server created\ndeployment.apps/metrics-server created\napiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created\n</code></pre> <p>\u67e5\u770bMetrics Server\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pod -n kube-system -l k8s-app=metrics-server\nNAME                              READY   STATUS    RESTARTS   AGE\nmetrics-server-74db45c9df-xstzf   1/1     Running   0          3m3s\n</code></pre> <p>\u72b6\u6001\u6b63\u5e38\u540e\uff0c\u67e5\u770b\u5ea6\u91cf\u6307\u6807\uff1a</p> <pre><code>$ kubectl top node\nNAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   k8s-master01   153m         3%     1701Mi          44%       k8s-master02   125m         3%     1693Mi          44%       k8s-master03   129m         3%     1590Mi          41%       k8s-node01     73m          1%     989Mi           25%       # kubectl top po -A\nNAMESPACE     NAME                                       CPU(cores)   MEMORY(bytes)\nkube-system   calico-kube-controllers-86d8c4fb68-4wk7q   3m           16Mi\nkube-system   calico-node-8cqhj                          37m          126Mi\nkube-system   calico-node-9dq92                          78m          97Mi\nkube-system   calico-node-dw6tq                          52m          111Mi\nkube-system   calico-node-g94pp                          74m          99Mi\nkube-system   calico-typha-768795f74d-clpvm              8m           23Mi\nkube-system   coredns-7f8cbcb969-f7chc                   2m           13Mi\nkube-system   coredns-7f8cbcb969-fv9fv                   3m           12Mi\nkube-system   etcd-k8s-master01                          79m          72Mi\nkube-system   etcd-k8s-master02                          77m          68Mi\nkube-system   etcd-k8s-master03                          53m          68Mi\nkube-system   kube-apiserver-k8s-master01                63m          311Mi\nkube-system   kube-apiserver-k8s-master02                64m          314Mi\nkube-system   kube-apiserver-k8s-master03                44m          389Mi\nkube-system   kube-controller-manager-k8s-master01       24m          59Mi\nkube-system   kube-controller-manager-k8s-master02       4m           29Mi\nkube-system   kube-controller-manager-k8s-master03       2m           28Mi\nkube-system   kube-proxy-jcm25                           1m           18Mi\nkube-system   kube-proxy-q8msx                           1m           19Mi\nkube-system   kube-proxy-rtwdz                           1m           21Mi\nkube-system   kube-proxy-s2xvg                           1m           18Mi\nkube-system   kube-scheduler-k8s-master01                5m           27Mi\nkube-system   kube-scheduler-k8s-master02                4m           24Mi\nkube-system   kube-scheduler-k8s-master03                4m           23Mi\nkube-system   metrics-server-74db45c9df-xstzf            11m          26Mi\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#111-dashboard\u90e8\u7f72","title":"1.11 Dashboard\u90e8\u7f72","text":"<p>Kubernetes\u5b98\u65b9\u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u56fe\u5f62\u5316\u5c55\u793a\uff0c\u53ef\u7528\u4e8e\u5c55\u793a\u96c6\u7fa4\u4e2d\u7684\u5404\u7c7b\u8d44\u6e90\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u901a\u8fc7Dashboard\u5b9e\u65f6\u67e5\u770bPod\u7684\u65e5\u5fd7\u548c\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u4e00\u4e9b\u547d\u4ee4\u7b49\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#1111-\u901a\u8fc7yaml\u90e8\u7f72","title":"1.11.1 \u901a\u8fc7YAML\u90e8\u7f72","text":""},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#1-\u5b89\u88c5dashboard","title":"1 \u5b89\u88c5Dashboard","text":"<p>\u5728Master01\u8282\u70b9\u521b\u5efaDashboard,v1.25.6 \u7248\u672c\u7684\u96c6\u7fa4\u9700\u8981\u5b89\u88c5\u6700\u65b0\u7684 2.0+ \u7248\u672c\u7684 Dashboard,\uff08\u8be5\u547d\u4ee4\u5305\u542b\u7ba1\u7406\u5458\u7528\u6237\u7684\u521b\u5efa\uff09\uff1a</p> <pre><code>$ wget https://raw.githubusercontent.com/cby-chen/Kubernetes/main/yaml/dashboard.yaml\n\n##\u76ee\u524d\u6700\u65b0\u7248\u672cv2.6.0 \n$ vim dashboard.yaml\n\n----\nspec:\n  ports:\n    - port: 443\ntargetPort: 8443\nnodePort: 30443\ntype: NodePort\n  selector:\n    k8s-app: kubernetes-dashboard\n----\n\n$ kubectl apply -f dashboard.yaml\nnamespace/kubernetes-dashboard created\nserviceaccount/kubernetes-dashboard created\nservice/kubernetes-dashboard created\nsecret/kubernetes-dashboard-certs created\nsecret/kubernetes-dashboard-csrf created\nsecret/kubernetes-dashboard-key-holder created\nconfigmap/kubernetes-dashboard-settings created\nrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created\ndeployment.apps/kubernetes-dashboard created\nservice/dashboard-metrics-scraper created\ndeployment.apps/dashboard-metrics-scraper created\n\n## \u521b\u5efa\u7528\u6237\uff1a\n$ wget https://raw.githubusercontent.com/cby-chen/Kubernetes/main/yaml/dashboard-user.yaml\n$ kubectl apply -f dashboard-user.yaml\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#2-\u767b\u5f55dashboard","title":"2 \u767b\u5f55Dashboard","text":"<p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u67e5\u770bDashboard Service\u7684\u7aef\u53e3\u53f7\uff08NodePort\uff09\uff1a</p> <pre><code>$ kubectl get svc kubernetes-dashboard -n kubernetes-dashboard\nNAME                   TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)         AGE\nkubernetes-dashboard   NodePort   192.168.250.65   &lt;none&gt;        443:30443/TCP   36s\n</code></pre> <p>\u67e5\u770b\u767b\u5f55\u7684Token\u503c\uff1a</p> <pre><code>$ kubectl -n kubernetes-dashboard create token admin-user\neyJhbGciOiJSUzI1NiIsImtpZCI6Ii1fbkh2Um5JS1VoSFRQSkEzZUJwRVNlUmFBaGwwZnVpUkVCeXk3Z2pGTkUifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjc1OTE0MjY0LCJpYXQiOjE2NzU5MTA2NjQsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJhZG1pbi11c2VyIiwidWlkIjoiNzczMDAyYmEtZmNmMS00YWI0LWE0NGItN2FlNDlmN2M5MDU4In19LCJuYmYiOjE2NzU5MTA2NjQsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDphZG1pbi11c2VyIn0.pA7B6BSvQzhCQl2t6BnUTOg6GoDRKVcKEynwTDGxHY8Zh88y2VWdXq60zs5FeaxyUFLNDrj2UWX74TM_Hw7H4hPKX_PXXvsO7Du3ykWzCeIhYV2TZCUnal5iQlsS_A83QkWgXqojL1c_s00K3PNyEqqfL8D61jJLOzb4YihTUnyOLnJ8SQq9EDTxZPsVp07hiZ76gnFijvAp8bsClS5WP0lj0riI2Oi1cL7IE0HD4aoW7oHDLEsvwqjlaon7xwA6OtQZfDOEMjptIgDLppKMdJyxeWZaw_4825ByU06_YY60OcwR8tEFv93fvSSCZadIxJhf1nmJDprEi414ATIKrg\n</code></pre> <p>\u8bbf\u95eehttps://node01IP:30443/\u5c31\u80fd\u770b\u5230\u767b\u5f55\u754c\u9762\u3002</p> <p>\u8f93\u5165token\uff1a</p> <pre><code>eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1fbImh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY........\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#1112-\u901a\u8fc7helm\u90e8\u7f72","title":"1.11.2 \u901a\u8fc7helm\u90e8\u7f72","text":"<p>Chart \u4ed3\u5e93\u5730\u5740\uff1ahttps://artifacthub.io/packages/helm/k8s-dashboard/kubernetes-dashboard</p> <pre><code>$ helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/\n$ helm repo update\n\n# \u4e0b\u8f7d\u5230\u672c\u5730\u5b89\u88c5\n$ helm search repo kubernetes-dashboard/kubernetes-dashboard\nNAME                                            CHART VERSION   APP VERSION     DESCRIPTION\nkubernetes-dashboard/kubernetes-dashboard       6.0.0           2.7.0           General-purpose web UI for Kubernetes clusters\n\n$ helm pull kubernetes-dashboard/kubernetes-dashboard --version 6.0.0 --untar\n\n$ cat &gt; values-pro.yaml&lt;&lt;EOF\nextraArgs:\n  - --token-ttl=0\n  - --system-banner=\"Welcome to Kubernetes Cluster. \u64cd\u4f5c\u9700\u8c28\u614e\uff01\uff01\uff01\"\nservice:\n  type: NodePort\n  nodePort: 30443\nrbac:\n  clusterReadOnlyRole: true\nmetricsScraper:\n  enabled: true\nEOF\n# deploy\n$ helm install kubernetes-dashboard kubernetes-dashboard -f values-pro.yaml --namespace kubernetes-dashboard --create-namespace\n\nNAME: kubernetes-dashboard\nLAST DEPLOYED: Thu Feb  9 10:52:32 2023\nNAMESPACE: kubernetes-dashboard\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\n*********************************************************************************\n*** PLEASE BE PATIENT: kubernetes-dashboard may take a few minutes to install ***\n*********************************************************************************\n\nGet the Kubernetes Dashboard URL by running:\n  export NODE_PORT=$(kubectl get -n kubernetes-dashboard -o jsonpath=\"{.spec.ports[0].nodePort}\" services kubernetes-dashboard)\nexport NODE_IP=$(kubectl get nodes -o jsonpath=\"{.items[0].status.addresses[0].address}\")\necho https://$NODE_IP:$NODE_PORT/\n</code></pre> <p>\u68c0\u67e5kubernetes-dashboard\u90e8\u7f72\u72b6\u6001</p> <pre><code>$ kubectl get pods,svc -n kubernetes-dashboard | grep kubernetes-dashboard\npod/kubernetes-dashboard-5486c8f5bf-xff6r   1/1     Running   0          45s\nservice/kubernetes-dashboard   NodePort   192.168.48.88   &lt;none&gt;        443:30443/TCP   45s\n</code></pre> <p>\u8bbe\u7f6e\u767b\u5f55\u7684token\u4fe1\u606f</p> <pre><code>$ cat &gt;kubernetes-dashboard-admin-user.yaml&lt;&lt;EOF\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: admin-user\n  namespace: kubernetes-dashboard\nEOF\n$ kubectl apply -f kubernetes-dashboard-admin-user.yaml\nserviceaccount/admin-user unchanged\nclusterrolebinding.rbac.authorization.k8s.io/admin-user unchanged\n\n$ kubectl -n kubernetes-dashboard create token admin-user\neyJhbGciOiJSUzI1NiIsImtpZCI6Ii1fbkh2Um5JS1VoSFRQSkEzZUJwRVNlUmFBaGwwZnVpUkVCeXk3Z2pGTkUifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjc1OTE2NTAwLCJpYXQiOjE2NzU5MTI5MDAsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJhZG1pbi11c2VyIiwidWlkIjoiN2VkNGQxNjItMzlkOC00ODc2LTk0ZjgtZTliYzUxNThmYmNhIn19LCJuYmYiOjE2NzU5MTI5MDAsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDphZG1pbi11c2VyIn0.CX98KwrW01fNSN0SJruN31bmflhdlueTXSfTfYh0IdvYFxuJbWGY1Zuslcb8JxowS4TW5ovqB71-3Sad9346oVwpel1fJwy2kGFopOQnK6AiY67XhuxIduDqYHqPLzETFp5n7ij4_Miv9bvt5-TG4u4arLpPEOFibUKOc4Z3k_wcRujO_re6JP8ElZzUrGh9EZ0BpdUaPrMiYFAyqXn6Uu5kC9_c5nV_ORYFXda3uX1mHxAN07_osNoYsTJsHXM46UX_5SwrQGfL3Xtgh7GiC-o9ZEawVtk9Vqkm335b8hxJEJp-bwsQrMUBUTelNYcf0KmCXHAQ8R1XilgDNZOlIg\n</code></pre> <p>\u8bbf\u95eehttps://node01IP:30443/\u5c31\u80fd\u770b\u5230\u767b\u5f55\u754c\u9762\u3002</p> <p></p> <p>\u8f93\u5165token\uff1a <pre><code>eyJhbGciOiJSUzI1........\n</code></pre></p> <p>Clean up and next steps</p> <p>Remove the admin <code>ServiceAccount</code> and <code>ClusterRoleBinding</code>.</p> <pre><code>kubectl -n kubernetes-dashboard delete serviceaccount admin-user\nkubectl -n kubernetes-dashboard delete clusterrolebinding admin-user\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#112-\u6ce8\u610f\u4e8b\u9879","title":"1.12 \u6ce8\u610f\u4e8b\u9879","text":""},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#1121-\u914d\u7f6e\u65b9\u9762","title":"1.12.1 \u914d\u7f6e\u65b9\u9762","text":"<p>\u548c\u4e8c\u8fdb\u5236\u5b89\u88c5\u65b9\u5f0f\u4e0d\u540c\u7684\u662f\uff0c\u4f7f\u7528Kubeadm\u5b89\u88c5\u7684Kubernetes\u96c6\u7fa4\uff0c</p> <p>\u5927\u90e8\u5206\u7ec4\u4ef6\u90fd\u662f\u4ee5\u5bb9\u5668\u7684\u65b9\u5f0f\u8fd0\u884c\u7684\uff0c\u6bd4\u5982kube-apiserver\u3001kube-proxy\u7b49\uff0c\u53ef\u4ee5\u901a\u8fc7kubectl get po -n kube-system\u67e5\u770b\u7cfb\u7edf\u7684Pod\u3002</p> <p>Master\u8282\u70b9\u7684\u7ec4\u4ef6kube-apiserver\u3001kube-scheduler\u3001kube-controller-manager\u3001etcd\u7684\u914d\u7f6e\u548c\u542f\u52a8\u6587\u4ef6\u9ed8\u8ba4\u90fd\u653e\u7f6e\u5728/etc/kubernetes/manifests\uff0c\u4ee5\u9759\u6001Pod\u7684\u65b9\u5f0f\u542f\u52a8\u3002</p> <p>\u6bd4\u5982apiserver\u7684kube-apiserver.yaml\uff0c\u8be5YAML\u6587\u4ef6\u66f4\u6539\u540e\uff0ckubelet\u4f1a\u81ea\u52a8\u5237\u65b0\u914d\u7f6e\uff0c\u4e5f\u5c31\u662f\u4f1a\u91cd\u542fPod\uff0c\u65e0\u987b\u5176\u4ed6\u7684\u64cd\u4f5c\u3002</p> <p>\u53e6\u5916\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0ckube-proxy\u662f\u4ee5DaemonSet\uff08\u5b88\u62a4\u8fdb\u7a0b\u96c6\uff0c\u4f1a\u5728\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u8282\u70b9\u4e0a\u90e8\u7f72\u4e00\u4e2aPod\uff09\u7684\u65b9\u5f0f\u5b89\u88c5\u7684\uff0c\u5176\u914d\u7f6e\u6587\u4ef6\u4f7f\u7528Kubernetes\u7684ConfigMap\u8fdb\u884c\u7ba1\u7406\uff0c\u5e76\u975e\u5bbf\u4e3b\u673a\u4e0a\u7684\u67d0\u4e2a\u6587\u4ef6\uff0c\u5982\u679c\u9700\u8981\u4fee\u6539kube-proxy\u7684\u914d\u7f6e\uff0c\u9700\u8981\u66f4\u6539\u8be5ConfigMap\u4e4b\u540e\uff0c\u518d\u5bf9kube-proxy\u8fdb\u884c\u6eda\u52a8\u66f4\u65b0\u624d\u4f1a\u751f\u6548\u3002</p> <p>\u6bd4\u5982\u5c06kube-proxy\u4ee3\u7406\u6a21\u5f0f\u6539\u4e3aipvs\u6a21\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7kubectl\u547d\u4ee4\u7f16\u8f91kube-proxy\u914d\u7f6e\u6587\u4ef6\u7684ConfigMap\u3002\u4ee5\u4e0b\u64cd\u4f5c\u5728Master01\u4e0a\u6267\u884c\u3002</p> <pre><code>$ kubectl edit cm kube-proxy -n kube-system\nmode: \"ipvs\" # mode\u66f4\u6539\u4e3aipvs\n</code></pre> <p>\u66f4\u65b0Kube-Proxy\u7684Pod\uff1a</p> <pre><code>$ kubectl patch daemonset kube-proxy -p \"{\\\"spec\\\":{\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"date\\\":\\\"`date +%s`\\\"}}}}}\" -n kube-system\ndaemonset.apps/kube-proxy patched\n\n# \u6216\u8005\u91cd\u542fkube-proxy\n$ kubectl get pod -n kube-system | grep kube-proxy |awk '{system(\"kubectl delete pod \"$1\" -n kube-system\")}'\n</code></pre> <p>\u9a8c\u8bc1Kube-Proxy\u6a21\u5f0f\uff1a</p> <pre><code>$ curl 127.0.0.1:10249/proxyMode\nipvs\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#1122-\u6c61\u70b9\u65b9\u9762","title":"1.12.2 \u6c61\u70b9\u65b9\u9762","text":"<p>Kubeadm\u5b89\u88c5\u540e\uff0c\u4f1a\u81ea\u52a8\u6dfb\u52a0NoSchedule\u7684\u6c61\u70b9\uff0c\u6240\u4ee5Master\u8282\u70b9\u9ed8\u8ba4\u4e0d\u5141\u8bb8\u90e8\u7f72\u975e\u7cfb\u7edfPod\uff0c\u53ef\u4ee5\u901a\u8fc7\u5220\u9664\u6c61\u70b9\u7684\u65b9\u5f0f\u5141\u8bb8\u90e8\u7f72\u3002</p> <p>\u9996\u5148\u67e5\u770b\u6c61\u70b9\uff1a</p> <pre><code>## \u67e5\u770b\u6c61\u70b9\n$ kubectl describe node -l node-role.kubernetes.io/master= | grep -B 3 Taints\n</code></pre> <p>\u7136\u540e\u5220\u9664\u6c61\u70b9\uff08\u751f\u4ea7\u73af\u5883\u6700\u597d\u4e0d\u8981\u5728Master\u8282\u70b9\u90e8\u7f72\u5176\u4ed6Pod\uff09\uff1a</p> <pre><code>## \u5220\u9664\u6c61\u70b9\n$ kubectl taint node -l node-role.kubernetes.io/master node-role.kubernetes.io/master:NoSchedule-\n\n## \u67e5\u770b\u6c61\u70b9\n$ kubectl describe node -l node-role.kubernetes.io/master= | grep Taints\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#1123-\u8bbe\u7f6e\u6807\u7b7e","title":"1.12.3 \u8bbe\u7f6e\u6807\u7b7e","text":"<pre><code>## \u8bbe\u7f6e\u6807\u7b7e\n$ kubectl label node gitee-k8s-w02 monitor=prometheus\nnode/gitee-k8s-w02 labeled\n\n## \u5e26\u6709prometheus\u6807\u8bc6\u7b26\u7684\u6807\u7b7e\n$ kubectl label nodes gitee-k8s-w02 node-role.kubernetes.io/prometheus=\"true\"\n## \u5220\u9664\u6807\u7b7e\n$ kubectl label nodes gitee-k8s-w02 monitor-\nnode/gitee-k8s-w02 labeled\n\n## \u5e26\u6709prometheus\u6807\u8bc6\u7b26\u7684\u6807\u7b7e\n$ kubectl label nodes gitee-k8s-w02 node-role.kubernetes.io/prometheus-\n\n## \u4fee\u6539\u4e00\u4e2alabel\u7684\u503c\uff0c\u9700\u8981\u52a0\u4e0a\u2013overwrite\u53c2\u6570\uff1a\n$ kubectl label nodes k8s-test01 gpu=false --overwrite\n\n## \u67e5\u770b\u6240\u6709\u7684lables\u4fe1\u606f\n$ kubectl get nodes --show-labels\n\n## \u6216\u8005\n$ kubectl describe nodes k8s-test01\n</code></pre> <p>\u9664\u4e86\u81ea\u5df1\u5b9a\u4e49\u7684\u6807\u7b7e\u4e4b\u5916\uff0cKubernetes\u8fd8\u4f1a\u4e3a\u6bcf\u4e2a\u8282\u70b9\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u7ea7\u6807\u7b7e\u3002</p> <ul> <li>Kubernetes.io/hostname\uff1a\u673a\u5668\u540d\u79f0\uff0c\u4f8b\u5982\uff0cgitee-k8s-w29\u3002</li> <li>Kubernetes.io/os\uff1a\u7cfb\u7edf\u540d\u79f0\uff0c\u4f8b\u5982\uff0cLinux/Windows\u3002</li> <li>Kubernetes.io/arch\uff1a\u67b6\u6784\u540d\u79f0\uff0c\u4f8b\u5982\uff0camd64\u3002</li> </ul> <p>\u53ea\u6709\u4f7f\u7528\u516c\u6709\u4e91\u5382\u5546\u81ea\u5bb6\u7684Kubernetes\u65f6\u624d\u4f1a\u6709\u4ee5\u4e0b\u6807\u7b7e\uff0c\u79c1\u6709Kubernetes\u96c6\u7fa4\u6ca1\u6709\u8fd9\u4e9b\u6807\u7b7e\u3002</p> <ul> <li>failure-domain.beta.Kubernetes.io/region\uff1a\u5730\u57df\u540d\u79f0\u3002</li> <li>failure-domain.beta.Kubernetes.io/zone\uff1a\u5730\u57df\u4e0b\u7684\u533a\u57df\u540d\u79f0\u3002</li> <li>beta.Kubernetes.io/instance-type\uff1a\u4f7f\u7528\u7684cloudprovider\u540d\u79f0\u3002</li> </ul>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#113\u5c0f\u7ed3","title":"1.13\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u5b8c\u6210\u4e86\u4f7f\u7528Kubeadm\u65b9\u5f0f\u5b89\u88c5\u9ad8\u53ef\u7528\u7684Kubernetes\u96c6\u7fa4\uff0c\u81f3\u6b64\u8bfb\u8005\u5df2\u7ecf\u6253\u5f00\u4e86Kubernetes\u7684\u7b2c\u4e00\u6247\u5927\u95e8\u3002</p> <p>\u5728\u5b89\u88c5\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6709\u4efb\u4f55\u7591\u95ee\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728GitHub\u4e0a\u63d0\u95ee\uff0c\u5982\u679c\u5bf9\u6982\u5ff5\u4e0d\u7406\u89e3\uff0c\u76f4\u63a5\u7ffb\u5230\u5bf9\u5e94\u7684\u57fa\u7840\u6982\u5ff5\u90e8\u5206\u5b66\u4e60\u5373\u53ef\u3002</p> <p>\u867d\u7136Kubeadm\u7684\u5b89\u88c5\u65b9\u5f0f\u6bd4\u8f83\u7b80\u5355\uff0c\u5e76\u4e14\u662f\u5b98\u65b9\u63a8\u8350\u7684\u5b89\u88c5\u65b9\u5f0f\uff0c\u4f46\u662fKubeadm\u5b89\u88c5\u7684Kubernetes\u96c6\u7fa4\u8bc1\u4e66\u6709\u6548\u671f\u9ed8\u8ba4\u53ea\u6709\u4e00\u5e74\uff0c\u5230\u671f\u540e\u9700\u8981\u8fdb\u884c\u5347\u7ea7\u6216\u8005\u66f4\u65b0\u8bc1\u4e66\uff0c\u5f53\u7136\u6709\u5174\u8da3\u7684\u8bfb\u8005\u4e5f\u53ef\u4ee5\u66f4\u6539Kubeadm\u7684\u6e90\u7801\uff0c\u5c06\u8bc1\u4e66\u66f4\u6539\u4e3a100\u5e74\uff0c\u4f46\u662f\u8fd9\u4e0d\u662f\u63a8\u8350\u7684\u65b9\u5f0f\u3002</p> <p>\u76ee\u524dKubernetes\u4fdd\u6301\u4e00\u5e743\u4e2a\u5927\u7248\u672c\u7684\u66f4\u65b0\uff0c\u63a8\u8350\u8bfb\u8005\u91c7\u7528\u5347\u7ea7\u7684\u65b9\u5f0f\u66f4\u65b0\u8bc1\u4e66\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#2-nginxkeepalived-\u642d\u5efa\u9ad8\u53ef\u7528kubernetes\u96c6\u7fa4centos7","title":"2. Nginx+Keepalived \u642d\u5efa\u9ad8\u53ef\u7528kubernetes\u96c6\u7fa4\uff08centos7\uff09","text":"<p>\u57fa\u672c\u73af\u5883\u914d\u7f6e\u4e0e\u4e0a\u9762\u4e00\u81f4</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#21-\u9ad8\u53ef\u7528\u7ec4\u4ef6\u5b89\u88c5","title":"2.1 \u9ad8\u53ef\u7528\u7ec4\u4ef6\u5b89\u88c5","text":""},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#211-\u5b89\u88c5nginx\u548ckeepalived","title":"2.1.1 \u5b89\u88c5Nginx\u548cKeepalived","text":"<pre><code>## \u57283\u4e2amaster\u8282\u70b9\u4e0a\u6267\u884c\n$ rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n$ yum install nginx keepalived -y\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#212-nginx\u914d\u7f6e","title":"2.1.2 Nginx\u914d\u7f6e","text":"<p>\u6240\u6709master \u8282\u70b9\u914d\u7f6e</p> <pre><code>$ cat &gt; /etc/nginx/nginx.conf &lt;&lt; \"EOF\"\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log;\npid /run/nginx.pid;\ninclude /usr/share/nginx/modules/*.conf;\nevents {\nworker_connections 1024;\n}\n# \u56db\u5c42\u8d1f\u8f7d\u5747\u8861\uff0c\u4e3a\u4e24\u53f0Master apiserver\u7ec4\u4ef6\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\nstream {\nlog_format  main  '$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent';\naccess_log  /var/log/nginx/k8s-access.log  main;\nupstream k8s-apiserver {\n# Master1 APISERVER IP:PORT\nserver 192.168.1.190:6443;\n# Master2 APISERVER IP:PORT\nserver 192.168.1.191:6443;\n# Master3 APISERVER IP:PORT\nserver 192.168.1.192:6443;\n}\nserver {\nlisten 16443;\nproxy_pass k8s-apiserver;\n}\n}\nhttp {\nlog_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n'$status $body_bytes_sent \"$http_referer\" '\n'\"$http_user_agent\" \"$http_x_forwarded_for\"';\naccess_log  /var/log/nginx/access.log  main;\nsendfile            on;\ntcp_nopush          on;\ntcp_nodelay         on;\nkeepalive_timeout   65;\ntypes_hash_max_size 2048;\ninclude             /etc/nginx/mime.types;\ndefault_type        application/octet-stream;\nserver {\nlisten       80 default_server;\nserver_name  _;\nlocation / {\n}\n}\n}\nEOF\n</code></pre> <p>\u6e29\u99a8\u63d0\u793a</p> <p>\u5982\u679c\u53ea\u4fdd\u8bc1\u9ad8\u53ef\u7528\uff0c\u4e0d\u914d\u7f6e k8s-apiserver \u8d1f\u8f7d\u5747\u8861\u7684\u8bdd\uff0c\u53ef\u4ee5\u4e0d\u88c5 nginx\uff0c\u4f46\u662f\u6700\u597d\u8fd8\u662f\u914d\u7f6e\u4e00\u4e0b k8s-apiserver \u8d1f\u8f7d\u5747\u8861\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#213-keepalived\u914d\u7f6e","title":"2.1.3 Keepalived\u914d\u7f6e","text":"<p>\u6240\u6709master\u8282\u70b9\u914d\u7f6e</p> <pre><code>$ cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; EOF\nglobal_defs {\n  notification_email {\n    acassen@firewall.loc\n    failover@firewall.loc\n    sysadmin@firewall.loc\n  }\n  notification_email_from fage@qq.com\n  smtp_server 127.0.0.1\n  smtp_connect_timeout 30\n  router_id NGINX_MASTER\n}\nvrrp_script check_nginx {\n   script \"/etc/keepalived/check_apiserver.sh\"\n   interval 5\n   weight -5\n   fall 2  \n   rise 1\n}\nvrrp_instance VI_1 {\n   state MASTER     # \u5907\u673a BACKUP\n   interface eth0\n   virtual_router_id 51          # VRRP \u8def\u7531 ID\u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u662f\u552f\u4e00\u7684\n   priority 100                  # \u4f18\u5148\u7ea7\uff0c\u5907\u670d\u52a1\u5668\u8bbe\u7f6e 99        master1:100  master2\u3001master3:99\n   advert_int 1                  # \u6307\u5b9aVRRP \u5fc3\u8df3\u5305\u901a\u544a\u95f4\u9694\u65f6\u95f4\uff0c\u9ed8\u8ba41\u79d2\n   authentication {\n       auth_type PASS\n       auth_pass 1111\n   }\n   # \u865a\u62dfIP\n   virtual_ipaddress {\n       192.168.1.193\n   }\n   track_script {\n       check_nginx\n   }\n}\nEOF\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#214-\u5065\u5eb7\u68c0\u67e5\u811a\u672c","title":"2.1.4 \u5065\u5eb7\u68c0\u67e5\u811a\u672c","text":"<pre><code>$ cat &gt; /etc/keepalived/check_apiserver.sh  &lt;&lt; \"EOF\"\n#!/bin/bash\ncount=$(ps -ef |grep nginx |egrep -cv \"grep|$$\")\nif [ \"$count\" -eq 0 ];then\nexit 1\nelse\nexit 0\nfi\nEOF\nchmod +x /etc/keepalived/check_apiserver.sh\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#215-\u542f\u52a8","title":"2.1.5 \u542f\u52a8","text":"<pre><code>$ systemctl daemon-reload\n$ systemctl restart nginx &amp;&amp; systemctl enable --now nginx $ systemctl restart keepalived &amp;&amp; systemctl enable --now keepalived </code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#3-kube-vip-\u642d\u5efa\u9ad8\u53ef\u7528-kubernetes-\u96c6\u7fa4","title":"3. kube-vip \u642d\u5efa\u9ad8\u53ef\u7528 Kubernetes \u96c6\u7fa4","text":"\u53c2\u8003\u6587\u732e <p>https://www.qikqiak.com/k8strain2/maintain/ha/</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#4-\u5f00\u53d1\u73af\u5883\u90e8\u7f72","title":"4. \u5f00\u53d1\u73af\u5883\u90e8\u7f72","text":""},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#41-\u5355master\u7248\u672c","title":"4.1 \u5355master\u7248\u672c","text":"\u53c2\u8003\u6587\u732e <p>\u4e24\u4e2a\u547d\u4ee4\u4ece\u7a7a\u767d\u7cfb\u7edf\u5230\u5355master\u8282\u70b9K8s\u96c6\u7fa4</p> <p>Kubernetes \u96c6\u7fa4\u73af\u5883\u5b89\u88c5</p> <p>Kubernetes \u96c6\u7fa4\u73af\u5883\u5b89\u88c5</p> <p>kubernetes\u4e4bkubeadm\u5b89\u88c51.25.+\u7248\u672c<p>https://zhangzhuo.ltd/articles/2022/01/03/1641196272692.html</p> </p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#42-\u9ad8\u53ef\u7528ha\u65b9\u6848","title":"4.2 \u9ad8\u53ef\u7528Ha\u65b9\u6848","text":"<p>\u53ef\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u7684 Kubernetes HA \u90e8\u7f72\u65b9\u6848\uff0c\u57fa\u4e8e kubeadm + Ansible + Keepalived + Haproxy</p> <p>\u53c2\u8003\u6587\u732e</p> <p>https://gitee.com/atompi/Prod-K8S-HA-Installer</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#5\u4e09\u65b9\u90e8\u7f72\u65b9\u6848","title":"5.\u4e09\u65b9\u90e8\u7f72\u65b9\u6848","text":""},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#51-kubeode","title":"5.1 kubeode","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://gitee.com/q7104475/kubeode?_from=gitee_search</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#52-kainstall","title":"5.2 kainstall","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://github.com/lework/kainstall</p> <p>https://gitee.com/uxvim/kainstall</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#53-kubeasz","title":"5.3 kubeasz","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://github.com/easzlab/kubeasz</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#54-\u57fa\u4e8esealos\u5b89\u88c5ha\u96c6\u7fa4-\u63a8\u8350","title":"5.4 \u57fa\u4e8eSealOS\u5b89\u88c5HA\u96c6\u7fa4 (\u63a8\u8350)","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.kubegems.io/docs/installation/kubernetes-install/sealos</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#55--\u57fa\u4e8ekind\u5b89\u88c5-\u5b9e\u9a8c\u6027\u8d28","title":"5.5  \u57fa\u4e8eKind\u5b89\u88c5 (\u5b9e\u9a8c\u6027\u8d28)","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.kubegems.io/docs/installation/kubernetes-install/kind</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#56-\u57fa\u4e8ekuboardspray-\u5b89\u88c5kubernetes","title":"5.6 \u57fa\u4e8eKuboardSpray \u5b89\u88c5kubernetes","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.kuboard.cn/install/install-k8s.html</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/1.Kubeadm%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#6\u6e05\u7406","title":"6.\u6e05\u7406","text":"<p>\u5982\u679c\u4f60\u7684\u96c6\u7fa4\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u5176\u4ed6\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u8fdb\u884c\u91cd\u7f6e\uff1a</p> <pre><code>\u279c  ~ kubeadm reset\n\u279c  ~ ifconfig cni0 down &amp;&amp; ip link delete cni0\n\u279c  ~ ifconfig flannel.1 down &amp;&amp; ip link delete flannel.1\n\u279c  ~ rm -rf /var/lib/cni/\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/","title":"\u4e8c\u8fdb\u5236\u5b89\u88c5\u9ad8\u53ef\u7528K8s\u96c6\u7fa4","text":"<p>\u672c\u7ae0\u91c7\u7528\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u5b89\u88c5Kubernetes\u96c6\u7fa4\uff0c\u8be5\u65b9\u5f0f\u8f83Kubeadm\u5b89\u88c5\u65b9\u5f0f\u66f4\u4e3a\u590d\u6742\uff0c\u6bd4\u5982\u8bc1\u4e66\u90e8\u5206Kubeadm\u65b9\u5f0f\u4e3a\u81ea\u52a8\u751f\u6210\uff0c\u800c\u4e8c\u8fdb\u5236\u65b9\u5f0f\u4e3a\u624b\u52a8\u521b\u5efa\uff0c\u4f46\u662f\u4e8c\u8fdb\u5236\u65b9\u5f0f\u53ef\u4ee5\u5c06\u8bc1\u4e66\u76f4\u63a5\u6539\u4e3a100\u5e74\u3002</p> <p>\u53e6\u5916\uff0c\u4e8c\u8fdb\u5236\u65b9\u5f0f\u5728\u5347\u7ea7\u65f6\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u5728\u914d\u7f6e\u6ca1\u6709\u66f4\u65b0\u7684\u524d\u63d0\u4e0b\uff0c\u53ef\u4ee5\u76f4\u63a5\u66ff\u6362\u4e8c\u8fdb\u5236\u5305\u8fdb\u884c\u66f4\u65b0\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#1-\u57fa\u672c\u73af\u5883\u914d\u7f6e","title":"1. \u57fa\u672c\u73af\u5883\u914d\u7f6e","text":"<p>\u8bfb\u8005\u9700\u81ea\u884c\u51c6\u59075\u53f0\u5177\u67092\u6838CPU\u548c4GB\u4ee5\u4e0a\u5185\u5b58\u7684\u670d\u52a1\u5668\uff0c\u7cfb\u7edf\u4e3aCentOS 7.x\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u8fd9\u4e48\u591a\u7684\u673a\u5668\uff0c\u53ef\u4ee5\u53ea\u5b89\u88c53\u53f0Master\u6216\u8005\u4e00\u53f0Master\u3001\u4e24\u53f0Node\u3002\u96c6\u7fa4\u91c7\u7528\u7684\u670d\u52a1\u5668IP\u89c4\u5212\u5982\u88682.1\u6240\u793a\u3002</p> <p>\u88682.1\u3000\u9ad8\u53ef\u7528Kubernetes\u96c6\u7fa4\u89c4\u5212</p> \u4e3b\u673a\u540d IP\u5730\u5740 \u8bf4\u660e k8s-master-01~03 10.0.0.201~203 master\u8282\u70b9*3 VIP 10.0.0.236 keeplived\u865a\u62dfIP k8s-node01~02 10.0.0.204~10.0.0.205 worker\u8282\u70b9*2 <p>kubernetes\u4e00\u5171\u6d89\u53ca\u4e09\u4e2a\u7f51\u6bb5\uff0c\u4e00\u4e2a\u662f\u5bbf\u4e3b\u673a\u7684\u7f51\u6bb5\uff0c\u4e5f\u5c31\u662f\u4e0a\u8ff0\u768410.0.0.x\uff0c\u540c\u65f6\u9700\u8981Pod\u548cService\u7684\u7f51\u6bb5\uff0c\u4e09\u8005\u7684\u7f51\u6bb5\u4e0d\u53ef\u4ea4\u53c9\u3002</p> <p>\u5b89\u88c5\u914d\u7f6e\u4fe1\u606f\u5982\u88682.2\u6240\u793a\u3002</p> <p>\u88682.2\u3000\u5b89\u88c5\u914d\u7f6e\u4fe1\u606f</p> \u914d\u7f6e\u4fe1\u606f \u5907\u6ce8 \u7cfb\u7edf\u7248\u672c Centos7.9 Docker\u7248\u672c 20.10.x Pod\u7f51\u6bb5 172.16.0.0/12 Service\u7f51\u6bb5 192.168.0.0/16 <p>\u6ce8\u610f</p> <p>\u5bbf\u4e3b\u673a\u7f51\u6bb5\u3001K8s Service\u7f51\u6bb5\u3001Pod\u7f51\u6bb5\u4e0d\u80fd\u91cd\u590d\u3002</p> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6e\u4e3b\u673a\u540d\uff08\u5176\u4ed6\u8282\u70b9\u540d\u79f0\u81ea\u884c\u66f4\u6539\uff09\uff1a</p> <pre><code>$ hostnamectl set-hostname k8s-master01 &amp;&amp; eval -- bash\n$ hostnamectl set-hostname k8s-master02 &amp;&amp; eval -- bash\n$ hostnamectl set-hostname k8s-master03 &amp;&amp; eval -- bash\n$ hostnamectl set-hostname k8s-node01 &amp;&amp; eval -- bash\n$ hostnamectl set-hostname k8s-node02 &amp;&amp; eval -- bash\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6ehosts\uff0c\u4fee\u6539/etc/hosts\u5982\u4e0b\uff1a</p> <pre><code>$ cat /etc/hosts\n10.0.0.201 k8s-master01\n10.0.0.202 k8s-master02\n10.0.0.203 k8s-master03\n10.0.0.204 k8s-node01\n10.0.0.205 k8s-node02\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eDocker\u548c\u9ed8\u8ba4yum\u6e90\uff1a</p> <pre><code>$ curl -o /etc/yum.repos.d/CentOS-Base.repo https;//mirrors.aliyun.com/repo/Centos-7.repo\n$ yum install -y yum-utils \\\ndevice-mapper-persistent-data \\\nlvm2\n\n$ yum-config-manager \\\n--add-repo \\\nhttps://download.docker.com/linux/centos/docker-ce.repo\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5\u4e00\u4e9b\u5e38\u7528\u7684\u5de5\u5177\uff1a</p> <pre><code>$ yum install wget jq psmisc vim net-tools telnet git -y\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5173\u95ed\u9632\u706b\u5899\u3001SELinux\u3001DNSmasq\uff1a</p> <pre><code>$ systemctl disable --now firewalld\n$ systemctl disable --now dnsmasq\n$ systemctl disable --now NetworkManager\n\n$ setenforce 0\n$ sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/sysconfig/selinux\n$ sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5173\u95edSwap\u5206\u533a\uff1a</p> <pre><code>$ swapoff -a &amp;&amp; sysctl -w vm.swappiness=0\n$ sed -ri '/^[^#]*swap/s@^@#@' /etc/fstab\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5ntpdate\uff08\u5982\u679c\u516c\u53f8\u7684\u670d\u52a1\u5668\u5df2\u7ecf\u914d\u7f6e\u4e86\u81ea\u52a8\u540c\u6b65\u65f6\u95f4\uff0c\u5173\u4e8e\u65f6\u95f4\u7684\u914d\u7f6e\u53ef\u4ee5\u4e0d\u7528\u64cd\u4f5c\uff09\uff1a</p> <pre><code>$ rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm\n$ yum install ntpdate -y\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u540c\u6b65\u65f6\u95f4\uff1a</p> <pre><code>$ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n$ echo 'Asia/Shanghai' &gt;/etc/timezone\n\n$ ntpdate time2.aliyun.com\n\n## \u52a0\u5165\u5230crontab\n$ */5 * * * * /usr/sbin/ntpdate time2.aliyun.com\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6elimit\uff1a</p> <pre><code>$ ulimit -SHn 65535\n$ vim /etc/security/limits.conf\n## \u672b\u5c3e\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\n* soft nofile 65536\n* hard nofile 131072\n* soft nproc 65535\n* hard nproc 655350\n* soft memlock unlimited\n* hard memlock unlimited\n</code></pre> <p>\u5b89\u88c5\u8fc7\u7a0b\u4e2d\uff0c\u751f\u6210\u914d\u7f6e\u6587\u4ef6\u548c\u8bc1\u4e66\u5747\u5728Master01\u4e0a\u64cd\u4f5c\uff0c\u6240\u4ee5Master01\u8282\u70b9\u9700\u8981\u514d\u5bc6\u94a5\u767b\u5f55\u5176\u4ed6\u8282\u70b9\uff0c\u4e4b\u540e\u5c06\u6587\u4ef6\u4f20\u9001\u5230\u5176\u4ed6\u8282\u70b9\u3002</p> <p>\u96c6\u7fa4\u7ba1\u7406\u4e5f\u5728Master01\u4e0a\u64cd\u4f5c\uff08\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u5355\u72ec\u7684\u8282\u70b9\uff09\u3002</p> <p>\u914d\u7f6e\u5bc6\u94a5\uff08\u53ea\u5728Master01\u6216\u7ba1\u7406\u8282\u70b9\u64cd\u4f5c\uff0c\u4ee5\u4e0b\u6b65\u9aa4\u5c06\u7ba1\u7406\u8282\u70b9\u548cMaster01\u7edf\u79f0\u4e3aMaster01\uff09\uff1a</p> <pre><code>$ ssh-keygen -t rsa\n$ for i in k8s-master01 k8s-master02 k8s-master03 k8s-node01 k8s-node02;do ssh-copy-id -i .ssh/id_rsa.pub $i;done\n</code></pre> <p>Master01\u4e0b\u8f7d\u5b89\u88c5\u6240\u6709\u7684\u6e90\u7801\u6587\u4ef6\uff1a</p> <pre><code>$ cd /root/ ; git clone https://github.com/dotbalo/k8s-ha-install.git\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5347\u7ea7\u7cfb\u7edf\u5e76\u91cd\u542f\uff1a</p> <pre><code>$ yum update -y  &amp;&amp; reboot\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#2-\u5185\u6838\u914d\u7f6e","title":"2. \u5185\u6838\u914d\u7f6e","text":"<p>\u4e3a\u4e86\u96c6\u7fa4\u7684\u7a33\u5b9a\u6027\u548c\u517c\u5bb9\u6027\uff0c\u751f\u4ea7\u73af\u5883\u7684\u5185\u6838\u6700\u597d\u5347\u7ea7\u52304.18\u7248\u672c\u4ee5\u4e0a\uff0c\u672c\u793a\u4f8b\u5c06\u5347\u7ea7\u52304.19\u7248\u672c\u3002</p> <p>Master01\u4e0b\u8f7d\u79bb\u7ebf\u5305\uff1a</p> <pre><code>$ cd /root\n$ wget http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm\n$ wget http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm\n</code></pre> <p>\u5c06\u5b89\u88c5\u5305\u4eceMaster01\u8282\u70b9\u4f20\u5230\u5176\u4ed6\u8282\u70b9\uff1a</p> <pre><code>$ for i in k8s-master02 k8s-master03 k8s-node01 k8s-node02;do scp kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm $i:/root/ ; done\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5\u5185\u6838\uff1a</p> <pre><code>$ cd /root &amp;&amp; yum localinstall -y kernel-ml*\n\n## \u6240\u6709\u8282\u70b9\u66f4\u6539\u5185\u6838\u542f\u52a8\u987a\u5e8f\n$ grub2-set-default  0 &amp;&amp; grub2-mkconfig -o /etc/grub2.cfg\n\n$ grubby --args=\"user_namespace.enable=1\" --update-kernel=\"$(grubby --default-kernel)\"\n# \u68c0\u67e5\u9ed8\u8ba4\u5185\u6838\u662f\u4e0d\u662f4.19\n$ grubby --default-kernel\n/boot/vmlinuz-4.19.12-1.el7.elrepo.x86_64\n\n# \u6240\u6709\u8282\u70b9\u91cd\u542f\uff0c\u7136\u540e\u68c0\u67e5\u5185\u6838\u662f\u4e0d\u662f4.19\n$ uname -a\nLinux k8s-master02 4.19.12-1.el7.elrepo.x86_64 #1 SMP Fri Dec 21 11:06:36 EST 2018 x86_64 x86_64 x86_64 GNU/Linux\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5b89\u88c5ipvsadm\u548cipset\uff1a</p> <pre><code>$ yum install ipvsadm ipset sysstat conntrack libseccomp -y\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eipvs\u6a21\u5757\uff0c\u5728\u5185\u68384.19+\u7248\u672cnf_conntrack_ipv4\u5df2\u7ecf\u6539\u4e3anf_conntrack\uff0c4.18\u4ee5\u4e0b\u7248\u672c\u4f7f\u7528nf_conntrack_ipv4\u5373\u53ef\uff1a</p> <pre><code>$ vim /etc/modules-load.d/ipvs.conf\n# \u52a0\u5165\u4ee5\u4e0b\u5185\u5bb9\nip_vs\nip_vs_lc\nip_vs_wlc\nip_vs_rr\nip_vs_wrr\nip_vs_lblc\nip_vs_lblcr\nip_vs_dh\nip_vs_sh\nip_vs_fo\nip_vs_nq\nip_vs_sed\nip_vs_ftp\nip_vs_sh\nnf_conntrack # 4.18\u6539\u4e3anf_conntrack_ipv4\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\n</code></pre> <p>\u7136\u540e\u6267\u884c<code>systemctl enable --now systemd-modules-load.service</code>\u5373\u53ef\u3002</p> <p>\u5f00\u542f\u4e00\u4e9bK8s\u96c6\u7fa4\u4e2d\u5fc5\u9700\u7684\u5185\u6838\u53c2\u6570\uff0c\u6240\u6709\u8282\u70b9\u914d\u7f6eK8s\u5185\u6838\uff1a</p> <pre><code>$ cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nfs.may_detach_mounts = 1\nnet.ipv4.conf.all.route_localnet = 1\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.netfilter.nf_conntrack_max=2310720\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl =15\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_orphans = 327680\nnet.ipv4.tcp_orphan_retries = 3\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.ip_conntrack_max = 65536\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_timestamps = 0\nnet.core.somaxconn = 16384\nEOF\n$ sysctl --system\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6e\u5b8c\u5185\u6838\u540e\uff0c\u91cd\u542f\u670d\u52a1\u5668\uff0c\u4fdd\u8bc1\u91cd\u542f\u540e\u5185\u6838\u4f9d\u65e7\u52a0\u8f7d\uff1a</p> <pre><code>$ reboot\n$ lsmod | grep --color=auto -e ip_vs -e nf_conntrack\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#3-\u57fa\u672c\u7ec4\u4ef6\u5b89\u88c5","title":"3. \u57fa\u672c\u7ec4\u4ef6\u5b89\u88c5","text":"<p>\u524d\u4e24\u8282\u7684\u5b89\u88c5\u6b65\u9aa4\u548cKubeadm\u65b9\u5f0f\u5e76\u65e0\u533a\u522b\uff0c\u63a5\u4e0b\u6765\u5bf9\u4e8eKubernetes\u3001Etcd\u7b49\u7ec4\u4ef6\u7684\u5b89\u88c5\u5c06\u91c7\u7528\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u672c\u8282\u4e3b\u8981\u5b89\u88c5\u7684\u662f\u96c6\u7fa4\u4e2d\u7528\u5230\u7684\u5404\u79cd\u7ec4\u4ef6\uff0c\u6bd4\u5982Docker-ce\u3001Containerd\u3001Kubernetes\u7ec4\u4ef6\u7b49\u3002\u540c\u6837\uff0c\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u9009\u62e9Containerd\u6216Docker\u4f5c\u4e3aKubernetes\u7684Runtime\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#31-containerd\u4f5c\u4e3aruntime","title":"3.1 Containerd\u4f5c\u4e3aRuntime","text":"<p>\u6240\u6709\u8282\u70b9\u5b89\u88c5docker-ce-20.10\uff1a</p> <pre><code>$ yum install docker-ce-20.10.* docker-ce-cli-20.10.* -y\n</code></pre> <p>\u7531\u4e8e\u5e76\u4e0d\u662f\u6bcf\u4e2a\u8282\u70b9\u90fd\u9700\u8981Docker\u5f15\u64ce\uff0c\u56e0\u6b64\u65e0\u987b\u542f\u52a8Docker\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u548c\u542f\u52a8Containerd\u5373\u53ef\u3002</p> <p>\u9996\u5148\u914d\u7f6eContainerd\u6240\u9700\u7684\u6a21\u5757\uff08\u6240\u6709\u8282\u70b9\uff09\uff1a</p> <pre><code>$ cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf\noverlay\nbr_netfilter\nEOF\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u52a0\u8f7d\u6a21\u5757\uff1a</p> <pre><code>$ modprobe -- overlay\n$ modprobe -- br_netfilter\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eContainerd\u6240\u9700\u7684\u5185\u6838\uff1a</p> <pre><code>$ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward                 = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u52a0\u8f7d\u5185\u6838\uff1a</p> <pre><code>$ sysctl --system\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eContainerd\u7684\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>$ mkdir -p /etc/containerd\n$ containerd config default | tee /etc/containerd/config.toml\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u5c06Containerd\u7684Cgroup\u6539\u4e3aSystemd\uff1a</p> <pre><code>$ vim /etc/containerd/config.toml\n# \u627e\u5230containerd.runtimes.runc.options\uff0c\u6dfb\u52a0SystemdCgroup = true\n# \u6240\u6709\u8282\u70b9\u5c06sandbox_image\u7684Pause\u955c\u50cf\u6539\u6210\u7b26\u5408\u81ea\u5df1\u7248\u672c\u7684\u5730\u5740registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u542f\u52a8Containerd\uff0c\u5e76\u914d\u7f6e\u5f00\u673a\u81ea\u542f\u52a8\uff1a</p> <pre><code>$ systemctl daemon-reload\n$ systemctl enable --now containerd\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6ecrictl\u5ba2\u6237\u7aef\u8fde\u63a5\u7684Runtime\u4f4d\u7f6e\uff1a</p> <pre><code>$ cat &gt; /etc/crictl.yaml &lt;&lt;EOF\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#32-docker\u4f5c\u4e3aruntime","title":"3.2 Docker\u4f5c\u4e3aRuntime","text":"<p>\u6240\u6709\u8282\u70b9\u5b89\u88c5docker-ce 20.10\uff1a</p> <pre><code>$ yum install docker-ce-20.10.* docker-ce-cli-20.10.* -y\n</code></pre> <p>\u7531\u4e8e\u65b0\u7248Kubelet\u5efa\u8bae\u4f7f\u7528systemd\uff0c\u56e0\u6b64\u628aDocker\u7684CgroupDriver\u4e5f\u6539\u6210systemd\uff1a</p> <pre><code>$ mkdir -p /etc/docker  # \u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u76ee\u5f55\u5148\u521b\u5efa\uff0c\u7136\u540e\u6dfb\u52a0 daemon.json \u6587\u4ef6\n$ vim /etc/docker/daemon.json\n{\n\"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"registry-mirrors\" : [\n\"https://ot2k4d59.mirror.aliyuncs.com/\"\n]\n}\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8Docker\uff1a</p> <pre><code>$ systemctl daemon-reload &amp;&amp; systemctl enable --now docker\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#33-k8s\u53caetcd\u7684\u5b89\u88c5","title":"3.3 K8s\u53caEtcd\u7684\u5b89\u88c5","text":"<p>Master01\u4e0b\u8f7dKubernetes\u5b89\u88c5\u5305\uff081.22.0\u9700\u8981\u66f4\u6539\u4e3a\u6700\u65b0\u6216\u8bfb\u8005\u60f3\u8981\u5b89\u88c5\u7684\u6307\u5b9a\u7248\u672c\uff09\uff1a</p> <pre><code>$ wget https://dl.k8s.io/v1.22.0/kubernetes-server-linux-amd64.tar.gz\n</code></pre> <p>Master01\u4e0b\u8f7dEtcd\u5b89\u88c5\u5305\uff1a</p> <pre><code>$ wget https://github.com/etcd-io/etcd/releases/download/v3.5.0/etcd-v3.5.0-linux-amd64.tar.gz\n</code></pre> <p>\u89e3\u538bKubernetes\u5b89\u88c5\u6587\u4ef6\u81f3bin\u76ee\u5f55\uff1a</p> <pre><code>$ tar -xf kubernetes-server-linux-amd64.tar.gz  --strip-components=3 -C /usr/local/bin kubernetes/server/bin/kube{let,ctl,-apiserver,-controller-manager,-scheduler,-proxy}\n</code></pre> <p>\u89e3\u538bEtcd\u5b89\u88c5\u6587\u4ef6\u81f3bin\u76ee\u5f55\uff1a</p> <pre><code>$ tar -zxvf etcd-v3.5.0-linux-amd64.tar.gz --strip-components=1 -C /usr/local/bin etcd-v3.5.0-linux-amd64/etcd{,ctl}\n</code></pre> <p>\u89e3\u538b\u540e\u5373\u4e3a\u5b89\u88c5\u6210\u529f\uff0c\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u7684\u7248\u672c\uff1a</p> <pre><code>$ kubelet --version\nKubernetes v1.22.0\n\n$ etcdctl version\netcdctl version: 3.5.0\nAPI version: 3.5\n</code></pre> <p>\u5c06\u7ec4\u4ef6\u53d1\u9001\u5230\u5176\u4ed6\u8282\u70b9\uff1a</p> <pre><code>$ MasterNodes='k8s-master02 k8s-master03'\n$ WorkNodes='k8s-node01 k8s-node02'\n$ for NODE in $MasterNodes; do echo $NODE; scp /usr/local/bin/kube{let,ctl,-apiserver,-controller-manager,-scheduler,-proxy} $NODE:/usr/local/bin/; scp /usr/local/bin/etcd* $NODE:/usr/local/bin/; done\n$ for NODE in $WorkNodes; do     scp /usr/local/bin/kube{let,-proxy} $NODE:/usr/local/bin/ ; done\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u521b\u5efa/opt/cni/bin\u76ee\u5f55\uff1a</p> <pre><code>$ mkdir -p /opt/cni/bin\n</code></pre> <p>Master01\u8282\u70b9\u5207\u6362\u52301.22.x\u5206\u652f\uff08\u5176\u4ed6\u7248\u672c\u53ef\u4ee5\u5207\u6362\u5230\u5176\u4ed6\u5206\u652f\uff0c\u4e0d\u9700\u8981\u66f4\u6539\u4e3a\u5177\u4f53\u7684\u5c0f\u7248\u672c\uff09\uff1a</p> <pre><code>$ cd k8s-ha-install &amp;&amp; git checkout manual-installation-v1.22.x\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#34-\u751f\u6210\u8bc1\u4e66","title":"3.4 \u751f\u6210\u8bc1\u4e66","text":"<p>\u548cKubeadm\u5b89\u88c5\u65b9\u5f0f\u4e0d\u540c\u7684\u662f\uff0c\u4e8c\u8fdb\u5236\u5b89\u88c5\u65b9\u5f0f\u9700\u8981\u81ea\u5df1\u751f\u6210\u6240\u6709\u7684\u8bc1\u4e66\uff0c\u5305\u62ecEtcd\u3001Kubernetes\u7ec4\u4ef6\u8bc1\u4e66\u3002</p> <p>\u7531\u4e8e\u8bc1\u4e66\u662f\u548cIP\u5730\u5740\u548c\u57df\u540d\u8fdb\u884c\u7ed1\u5b9a\u7684\uff0c\u56e0\u6b64\u5728\u751f\u6210\u8bc1\u4e66\u65f6\uff0c\u9700\u8981\u6ce8\u610fIP\u5730\u5740\u7b49\u76f8\u5173\u914d\u7f6e\u7684\u4fee\u6539\u3002\u672c\u793a\u4f8b\u91c7\u7528CFSSL\u5de5\u5177\u751f\u6210\u8bc1\u4e66\uff0c\u8bfb\u8005\u4e5f\u53ef\u4ee5\u4f7f\u7528OpenSSL\u7b49\u5de5\u5177\u751f\u6210\u3002</p> <p>\u7531\u4e8e\u751f\u6210\u8bc1\u4e66\u53ea\u9700\u8981\u5728Master01\u8fdb\u884c\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u5728Master01\u8282\u70b9\u751f\u6210\u4e0b\u8f7dCFSSL\u5de5\u5177\u5373\u53ef\u3002Master01\u4e0b\u8f7d\u751f\u6210\u8bc1\u4e66\u5de5\u5177\uff1a</p> <pre><code>$ wget \"https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\" -O /usr/local/bin/cfssl\n$ wget \"https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\" -O /usr/local/bin/cfssljson\n$ chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#341-etcd\u8bc1\u4e66","title":"3.4.1 Etcd\u8bc1\u4e66","text":"<p>\u9996\u5148\u751f\u6210Etcd\u7684\u8bc1\u4e66\uff0c\u7531\u4e8eEtcd\u662f3\u4e2a\u8282\u70b9\u7ec4\u6210\u7684\u96c6\u7fa4\uff0c\u56e0\u6b64\u8bc1\u4e66\u9700\u8981\u5305\u542b\u6bcf\u4e2a\u8282\u70b9\u7684IP\u5730\u5740\u3002</p> <p>\u6240\u6709Master\u8282\u70b9\u521b\u5efaEtcd\u8bc1\u4e66\u76ee\u5f55\uff1a</p> <pre><code>$ mkdir /etc/etcd/ssl -p\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u521b\u5efaKubernetes\u76f8\u5173\u76ee\u5f55\uff0cKubernetes\u6240\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u4f1a\u653e\u7f6e\u5728/etc/kubernetes\u4e0b\uff0c\u8bc1\u4e66\u6587\u4ef6\u4f1a\u653e\u7f6e\u5728/etc/kubernetes/pki\u4e0b\uff1a</p> <pre><code>$ mkdir -p /etc/kubernetes/pki\n</code></pre> <p>\u63a5\u4e0b\u6765\u5728Master01\u8282\u70b9\u751f\u6210Etcd\u8bc1\u4e66\uff0c\u751f\u6210\u8bc1\u4e66\u7684CSR\uff08\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42\u6587\u4ef6\uff0c\u914d\u7f6e\u4e86\u4e00\u4e9b\u57df\u540d\u3001\u516c\u53f8\u3001\u5355\u4f4d\uff09\u6587\u4ef6\u5df2\u653e\u7f6e\u5728\u524d\u6587clone\u7684k8s-ha-install\uff1a</p> <pre><code># \u8fd9\u4e2a\u76ee\u5f55\u6709\u6211\u4eec\u751f\u6210\u8bc1\u4e66\u9700\u8981\u7528\u5230\u7684csr\u6587\u4ef6\n$ cd /root/k8s-ha-install/pki\n\n#\u67e5\u770b\n[root@k8s-master01 pki]# ls\nadmin-csr.json      ca-config.json  etcd-ca-csr.json  front-proxy-ca-csr.json      kubelet-csr.json     manager-csr.json\napiserver-csr.json  ca-csr.json     etcd-csr.json     front-proxy-client-csr.json  kube-proxy-csr.json  scheduler-csr.json\n\n# \u751f\u6210etcd CA\u8bc1\u4e66\u548cCA\u8bc1\u4e66\u7684key\n$ cfssl gencert -initca etcd-ca-csr.json | cfssljson -bare /etc/etcd/ssl/etcd-ca\n\n2021/07/23 13:58:44 [INFO] generating a new CA key and certificate from CSR\n2021/07/23 13:58:44 [INFO] generate received request\n2021/07/23 13:58:44 [INFO] received CSR\n2021/07/23 13:58:44 [INFO] generating key: rsa-2048\n2021/07/23 13:58:44 [INFO] encoded CSR\n2021/07/23 13:58:44 [INFO] signed certificate with serial number 65355458767171380149641516060181865353335743374\n# \u751f\u6210tcd\u7684\u8bc1\u4e66\uff0c\u9700\u8981\u6ce8\u610f\u4fee\u6539-hostname\u7684IP\u4e3a\u81ea\u5df1\u7684IP \n# \u9881\u53d1\u8bc1\u4e66\n$ cfssl gencert \\\n-ca=/etc/etcd/ssl/etcd-ca.pem \\\n-ca-key=/etc/etcd/ssl/etcd-ca-key.pem \\\n-config=ca-config.json \\\n-hostname=127.0.0.1,k8s-master01,k8s-master02,k8s-master03,10.0.0.201,10.0.0.202,10.0.0.203 \\\n-profile=kubernetes \\\netcd-csr.json | cfssljson -bare /etc/etcd/ssl/etcd\n</code></pre> <p>\u5c06\u8bc1\u4e66\u590d\u5236\u5230\u5176\u4ed6Master\u8282\u70b9\uff1a</p> <pre><code>$ MasterNodes='k8s-master02 k8s-master03'\n$ WorkNodes='k8s-node01 k8s-node02'\n$ for NODE in $MasterNodes; do\nssh $NODE \"mkdir -p /etc/etcd/ssl\"\nfor FILE in etcd-ca-key.pem  etcd-ca.pem  etcd-key.pem  etcd.pem; do\nscp /etc/etcd/ssl/${FILE} $NODE:/etc/etcd/ssl/${FILE}\ndone\ndone\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#342-k8s\u7ec4\u4ef6\u8bc1\u4e66","title":"3.4.2 K8s\u7ec4\u4ef6\u8bc1\u4e66","text":"<p>\u76f8\u8f83\u4e8eEtcd\u7684\u8bc1\u4e66\uff0cKubernetes\u7684\u8bc1\u4e66\u66f4\u4e3a\u590d\u6742\uff0c\u56e0\u4e3aKubernetes\u8981\u6c42\u7ec4\u4ef6\u4e4b\u95f4\u53cc\u5411\u52a0\u5bc6\u901a\u4fe1\uff0c\u6240\u4ee5\u751f\u6210Kubernetes\u7684\u7ec4\u4ef6\u4f1a\u6d89\u53ca\u6bcf\u4e2a\u7ec4\u4ef6\u4e4b\u95f4\u901a\u4fe1\u7684\u8bc1\u4e66\uff0c\u540c\u65f6\u4e5f\u4f1a\u5305\u542b\u4e00\u4e9b\u805a\u5408\u8bc1\u4e66\u3002</p> <p>\u9996\u5148\u5728Master01\u8282\u70b9\u751f\u6210Kubernetes\u7684\u6839\u8bc1\u4e66\uff0c\u4e4b\u540e\u5176\u4ed6\u8bc1\u4e66\u90fd\u662f\u6839\u636e\u8be5\u8bc1\u4e66\u6765\u751f\u6210\u7684\uff1a</p> <pre><code>$ cd /root/k8s-ha-install/pki\n$ cfssl gencert -initca ca-csr.json | cfssljson -bare /etc/kubernetes/pki/ca\n</code></pre> <p>\u63a5\u4e0b\u6765\u751f\u6210kube-apiserver\u7684\u8bc1\u4e66\uff0c\u9700\u8981\u6ce8\u610f\u66f4\u6539\u5982\u4e0b\u914d\u7f6e\uff1a</p> <ul> <li>192.168.0.\u662fKubernetes Service\u7684\u7f51\u6bb5\uff0c\u5982\u679c\u9700\u8981\u66f4\u6539Kubernetes Service\u7f51\u6bb5\uff0c\u90a3\u5c31\u9700\u8981\u628a192.168.0.1\u66f4\u6539\u4e3aService\u7f51\u6bb5\u7684\u7b2c\u4e00\u4e2aIP\u3002</li> <li>10.0.0.236\u4e3a\u9ad8\u53ef\u7528\u96c6\u7fa4\u7684VIP\u5730\u5740\uff0c\u9700\u8981\u6539\u6210\u8bfb\u8005\u81ea\u5df1\u7684VIP\u5730\u5740\u6216\u8005\u5176\u4ed6\u8d1f\u8f7d\u5747\u8861\u7684\u5730\u5740\uff0c\u5982\u679c\u662f\u5355Master\u7684\u96c6\u7fa4\uff0c\u76f4\u63a5\u6539\u4e3aMaster\u8282\u70b9IP\u5373\u53ef\u3002</li> <li>10.0.0.201-203\u4e3aKubernetes Master\u8282\u70b9\u7684IP\u5730\u5740\uff0c\u9700\u8981\u66f4\u6539\u4e3a\u8bfb\u8005\u7684\u8282\u70b9IP\u3002</li> </ul> <pre><code>$ cfssl gencert   -ca=/etc/kubernetes/pki/ca.pem   \\\n-ca-key=/etc/kubernetes/pki/ca-key.pem   \\\n-config=ca-config.json   \\\n-hostname=192.168.0.1,10.0.0.236,127.0.0.1,kubernetes,kubernetes.default,kubernetes.default.svc, \\\nkubernetes.default.svc.cluster,kubernetes.default.svc.cluster.local,10.0.0.201,10.0.0.202,10.0.0.203   \\\n-profile=kubernetes   apiserver-csr.json | cfssljson -bare /etc/kubernetes/pki/apiserver\n</code></pre> <p>\u751f\u6210\u805a\u5408\u8bc1\u4e66\uff0c\u7528\u4e8e\u6269\u5c55\u7684CRD\u8bf7\u6c42\u9a8c\u8bc1\uff0c\u6bd4\u5982metrics-server\u7684metrics.k8s.io\u548capiserver\u8fdb\u884c\u901a\u4fe1\u65f6\u5c31\u4f1a\u4f7f\u7528\u5230\u8be5\u8bc1\u4e66\uff1a</p> <pre><code>$ cfssl gencert   -initca front-proxy-ca-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-ca $ cfssl gencert   -ca=/etc/kubernetes/pki/front-proxy-ca.pem   -ca-key=/etc/kubernetes/pki/front-proxy-ca-key.pem   -config=ca-config.json   -profile=kubernetes   front-proxy-client-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-client\n</code></pre> <p>\u540c\u6837\u7684\u65b9\u5f0f\u751f\u6210controller-manage\u7684\u8bc1\u4e66\uff0c\u4f7f\u7528\u7684\u8fd8\u662f\u6700\u521d\u7684CA\u6587\u4ef6\uff1a</p> <pre><code>$ cfssl gencert \\\n-ca=/etc/kubernetes/pki/ca.pem \\\n-ca-key=/etc/kubernetes/pki/ca-key.pem \\\n-config=ca-config.json \\\n-profile=kubernetes \\\nmanager-csr.json | cfssljson -bare /etc/kubernetes/pki/controller-manager\n\n# \u6ce8\u610f\uff0c\u5982\u679c\u4e0d\u662f\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c10.0.0.236:16443\u6539\u4e3amaster01\u7684\u5730\u5740\uff0c6443\u6539\u4e3aapiserver\u7684\u7aef\u53e3\uff0c\u9ed8\u8ba4\u662f6443\n$ set-cluster\uff1a\u8bbe\u7f6e\u4e00\u4e2a\u96c6\u7fa4\u9879\n$ kubectl config set-cluster kubernetes \\\n--certificate-authority=/etc/kubernetes/pki/ca.pem \\\n--embed-certs=true \\\n--server=https://10.0.0.236:16443\\\n--kubeconfig=/etc/kubernetes/controller-manager.kubeconfig\n\n# set-credentials \u8bbe\u7f6e\u4e00\u4e2a\u7528\u6237\u9879\n$ kubectl config set-credentials system:kube-controller-manager \\\n--client-certificate=/etc/kubernetes/pki/controller-manager.pem \\\n--client-key=/etc/kubernetes/pki/controller-manager-key.pem \\\n--embed-certs=true \\\n--kubeconfig=/etc/kubernetes/controller-manager.kubeconfig\n\n# \u8bbe\u7f6e\u4e00\u4e2a\u73af\u5883\u9879\uff0c\u4e00\u4e2a\u4e0a\u4e0b\u6587\n$ kubectl config set-context system:kube-controller-manager@kubernetes \\\n--cluster=kubernetes \\\n--user=system:kube-controller-manager \\\n--kubeconfig=/etc/kubernetes/controller-manager.kubeconfig\n\n# \u4f7f\u7528\u67d0\u4e2a\u73af\u5883\u5f53\u505a\u9ed8\u8ba4\u73af\u5883\n$ kubectl config use-context system:kube-controller-manager@kubernetes \\\n--kubeconfig=/etc/kubernetes/controller-manager.kubeconfig\n</code></pre> <p>\u540c\u6837\u7684\u903b\u8f91\u751f\u6210scheduler\u7684\u8bc1\u4e66\uff0c\u53c2\u6570\u4e0d\u518d\u89e3\u91ca\uff1a</p> <pre><code>$ cfssl gencert \\\n-ca=/etc/kubernetes/pki/ca.pem \\\n-ca-key=/etc/kubernetes/pki/ca-key.pem \\\n-config=ca-config.json \\\n-profile=kubernetes \\\nscheduler-csr.json | cfssljson -bare /etc/kubernetes/pki/scheduler\n\n# \u6ce8\u610f\uff0c\u5982\u679c\u4e0d\u662f\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c10.0.0.236:16443\u6539\u4e3amaster01\u7684\u5730\u5740\uff0c6443\u6539\u4e3aapiserver\u7684\u7aef\u53e3\uff0c\u9ed8\u8ba4\u662f6443\n$ kubectl config set-cluster kubernetes \\\n--certificate-authority=/etc/kubernetes/pki/ca.pem \\\n--embed-certs=true \\\n--server=https://10.0.0.236:16443 \\\n--kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n\n$ kubectl config set-credentials system:kube-scheduler \\\n--client-certificate=/etc/kubernetes/pki/scheduler.pem \\\n--client-key=/etc/kubernetes/pki/scheduler-key.pem \\\n--embed-certs=true \\\n--kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n\n$ kubectl config set-context system:kube-scheduler@kubernetes \\\n--cluster=kubernetes \\\n--user=system:kube-scheduler \\\n--kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n\n$ kubectl config use-context system:kube-scheduler@kubernetes \\\n--kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n</code></pre> <p>\u81f3\u6b64\uff0cKubernetes Master\u8282\u70b9\u7684\u7ec4\u4ef6\u8bc1\u4e66\u5df2\u7ecf\u914d\u7f6e\u5b8c\u6210\u3002\u63a5\u4e0b\u6765\u9700\u8981\u751f\u6210\u4e00\u4e2aKubectl\u8fde\u63a5API Server\u7684kubeconfig\u3002</p> <p>\u4f7f\u7528Kubeadm\u5b89\u88c5\u7684Kubernetes\u96c6\u7fa4\uff0cKubectl\u8fde\u63a5API Server\u7528\u5230\u7684kubeconfig\u6587\u4ef6\u4e3a/etc/kubernetes/admin.conf\uff0c\u7531Kubeadm\u81ea\u52a8\u751f\u6210\u3002</p> <p>\u4f7f\u7528\u4e8c\u8fdb\u5236\u5b89\u88c5\u65b9\u5f0f\u9700\u8981\u624b\u52a8\u751f\u6210\uff0c\u751f\u6210\u6b65\u9aa4\u4e0e\u4e0a\u8ff0\u65b9\u5f0f\u7c7b\u4f3c\u3002\u9996\u5148\u751f\u6210\u7ba1\u7406\u5458\u7528\u6237\u7684\u8bc1\u4e66\u6587\u4ef6\uff1a</p> <pre><code>$ cfssl gencert \\\n-ca=/etc/kubernetes/pki/ca.pem \\\n-ca-key=/etc/kubernetes/pki/ca-key.pem \\\n-config=ca-config.json \\\n-profile=kubernetes \\\nadmin-csr.json | cfssljson -bare /etc/kubernetes/pki/admin\n</code></pre> <p>\u63a5\u4e0b\u6765\u751f\u6210kubeconfig\u6587\u4ef6\u3002\u6ce8\u610f\uff0c\u5982\u679c\u4e0d\u662f\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c\u628aMaster\u7684\u5730\u5740\u6539\u4e3a10.0.0.236:16443\uff0c\u628aAPI Server\u7684\u7aef\u53e3\u6539\u4e3a16443\uff0c\u9ed8\u8ba4\u662f6443\uff1a</p> <pre><code>$ kubectl config set-cluster kubernetes     \\ \n--certificate-authority=/etc/kubernetes/pki/ca.pem     \\ \n--embed-certs=true     \\ \n--server=https://10.0.0.236:16443    \\\n--kubeconfig=/etc/kubernetes/admin.kubeconfig\n\n$ kubectl config set-credentials kubernetes-admin     \\\n--client-certificate=/etc/kubernetes/pki/admin.pem     \\\n--client-key=/etc/kubernetes/pki/admin-key.pem     \\\n--embed-certs=true     \\\n--kubeconfig=/etc/kubernetes/admin.kubeconfig\n\n$ kubectl config set-context kubernetes-admin@kubernetes     \\\n--cluster=kubernetes     \\\n--user=kubernetes-admin     \\\n--kubeconfig=/etc/kubernetes/admin.kubeconfig\n\n$ kubectl config use-context kubernetes-admin@kubernetes     \\\n--kubeconfig=/etc/kubernetes/admin.kubeconfig\n</code></pre> <p>\u751f\u6210\u7528\u4e8e\u521b\u5efaServiceAccount Secret Token\u548c\u9a8c\u8bc1Token\u7684\u5bc6\u94a5\u5bf9\uff1a</p> <pre><code>$ openssl genrsa -out /etc/kubernetes/pki/sa.key 2048\n$ openssl rsa -in /etc/kubernetes/pki/sa.key -pubout -out /etc/kubernetes/pki/sa.pub\n</code></pre> <p>\u6240\u6709\u7684\u8bc1\u4e66\u7b7e\u53d1\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5c06\u8bc1\u4e66\u53d1\u9001\u81f3\u5176\u4ed6\u8282\u70b9\uff1a</p> <pre><code>$ for NODE in k8s-master02 k8s-master03; do\nfor FILE in $(ls /etc/kubernetes/pki | grep -v etcd); do\nscp /etc/kubernetes/pki/${FILE} $NODE:/etc/kubernetes/pki/${FILE};\ndone;\nfor FILE in admin.kubeconfig controller-manager.kubeconfig scheduler.kubeconfig; do\nscp /etc/kubernetes/${FILE} $NODE:/etc/kubernetes/${FILE};\ndone;\ndone\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#35-\u9ad8\u53ef\u7528\u914d\u7f6e","title":"3.5 \u9ad8\u53ef\u7528\u914d\u7f6e","text":"<p>\u548cKubeadm\u5b89\u88c5\u65b9\u5f0f\u4e00\u81f4\uff0c\u4e8c\u8fdb\u5236\u5b89\u88c5\u65b9\u5f0f\u4ecd\u7136\u91c7\u7528\u7684\u662fKeepAlived\u548cHAProxy\u5b9e\u73b0\u7684\u9ad8\u53ef\u7528\uff0c\u6240\u4ee5\u9700\u8981\u5b89\u88c5KeepAlived\u548cHAProxy\u3002</p> <p>KeepAlived\u548cHAProxy\u7684\u8282\u70b9\u53ef\u4ee5\u548cMaster\u5728\u540c\u4e00\u4e2a\u8282\u70b9\uff0c\u4e5f\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u8282\u70b9\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u662f\u5728\u516c\u6709\u4e91\u4e0a\u642d\u5efa\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c\u53ef\u4ee5\u91c7\u7528\u516c\u6709\u4e91\u7684\u8d1f\u8f7d\u5747\u8861\u66ff\u4ee3KeepAlived\u548cHAProxy\u3002</p> <p>\u63d0\u793a</p> <p>\u5982\u679c\u8bfb\u8005\u60f3\u8981\u642d\u5efa\u53ea\u6709\u4e00\u4e2aMaster\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u53ef\u4ee5\u4e0d\u5b89\u88c5\u9ad8\u53ef\u7528\u7ec4\u4ef6\u3002</p> <p>\u5b89\u88c5\u6b65\u9aa4\u8bf7\u53c2\u8003\u672c\u4e66\u7b2c1\u7ae0\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#36-etcd\u96c6\u7fa4\u914d\u7f6e","title":"3.6 Etcd\u96c6\u7fa4\u914d\u7f6e","text":"<p>Etcd\u662fKubernetes\u7684\u6570\u636e\u5e93\uff0c\u751f\u4ea7\u73af\u5883\u6700\u5c11\u91c7\u75283\u4e2a\u4ee5\u4e0a\u8282\u70b9\u5b9e\u73b0\u9ad8\u53ef\u7528\uff0c\u5e76\u4e14\u8282\u70b9\u6570\u5fc5\u987b\u4e3a\u5947\u6570\u4e2a\u3002</p> <p>Etcd\u7684\u914d\u7f6e\u5927\u81f4\u76f8\u540c\uff0c\u4e3b\u8981\u662f\u6bcf\u4e2aMaster\u8282\u70b9\u7684Etcd\u914d\u7f6e\u7684\u4e3b\u673a\u540d\u548cIP\u5730\u5740\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#361-\u521b\u5efaetcd\u7684\u914d\u7f6e\u6587\u4ef6","title":"3.6.1 \u521b\u5efaEtcd\u7684\u914d\u7f6e\u6587\u4ef6","text":"<p>\u8fd9\u91cc\u5c06Etcd\u548cKubernetes Master\u8282\u70b9\u90e8\u7f72\u5728\u540c\u4e00\u53f0\u673a\u5668\uff0c\u5982\u679c\u8bfb\u8005\u9700\u8981\u5c06Etcd\u548cMaster\u8282\u70b9\u62c6\u5206\u6210\u4e0d\u540c\u7684\u670d\u52a1\u5668\uff0c\u53ea\u9700\u8981\u66f4\u6539\u5bf9\u5e94\u7684IP\u5730\u5740\u5373\u53ef\u3002</p> <p>3\u4e2a\u8282\u70b9\u7684Etcd\u914d\u7f6e\u5927\u81f4\u76f8\u540c\uff0c\u4e3b\u8981\u6d89\u53ca\u5982\u4e0b\u53c2\u6570\u9700\u8981\u4fee\u6539\uff08\u5b8c\u6574\u6587\u4ef6\u89c1\u672c\u4e66\u4e0b\u8f7d\u8d44\u6e90\uff09\uff1a</p> <p>vim /etc/etcd/etcd.config.yml </p> <p>\u81ea\u884c\u66f4\u6539\u76f8\u5173\u914d\u7f6e</p> <pre><code>name: 'k8s-master01'\ndata-dir: /var/lib/etcd\nwal-dir: /var/lib/etcd/wal\nsnapshot-count: 5000\nheartbeat-interval: 100\nelection-timeout: 1000\nquota-backend-bytes: 0\nlisten-peer-urls: 'https://10.103.236.201:2380'\nlisten-client-urls: 'https://10.103.236.201:2379,http://127.0.0.1:2379'\nmax-snapshots: 3\nmax-wals: 5\ncors:\ninitial-advertise-peer-urls: 'https://10.103.236.201:2380'\nadvertise-client-urls: 'https://10.103.236.201:2379'\ndiscovery:\ndiscovery-fallback: 'proxy'\ndiscovery-proxy:\ndiscovery-srv:\ninitial-cluster: 'k8s-master01=https://10.103.236.201:2380,k8s-master02=https://10.103.236.202:2380,k8s-master03=https://10.103.236.203:2380'\ninitial-cluster-token: 'etcd-k8s-cluster'\ninitial-cluster-state: 'new'\nstrict-reconfig-check: false\nenable-v2: true\nenable-pprof: true\nproxy: 'off'\nproxy-failure-wait: 5000\nproxy-refresh-interval: 30000\nproxy-dial-timeout: 1000\nproxy-write-timeout: 5000\nproxy-read-timeout: 0\nclient-transport-security:\n  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'\n  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'\n  client-cert-auth: true\n  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'\n  auto-tls: true\npeer-transport-security:\n  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'\n  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'\n  peer-client-cert-auth: true\n  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'\n  auto-tls: true\ndebug: false\nlog-package-levels:\nlog-outputs: [default]\nforce-new-cluster: false\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#362-\u521b\u5efaservice","title":"3.6.2 \u521b\u5efaService","text":"<p>\u63a5\u4e0b\u6765\u5728\u6bcf\u4e2aMaster\u8282\u70b9\u521b\u5efaEtcd Service\u5e76\u542f\u52a8\uff1a</p> <pre><code>$ vim /usr/lib/systemd/system/etcd.service\n[Unit]\nDescription=Etcd Service\nDocumentation=https://coreos.com/etcd/docs/latest/\nAfter=network.target\n\n[Service]\nType=notify\nExecStart=/usr/local/bin/etcd --config-file=/etc/etcd/etcd.config.yml\nRestart=on-failure\nRestartSec=10\nLimitNOFILE=65536\n[Install]\nWantedBy=multi-user.target\nAlias=etcd3.service\n</code></pre> <p>\u6240\u6709Master\u8282\u70b9\u521b\u5efaEtcd\u7684\u8bc1\u4e66\u76ee\u5f55\uff1a</p> <pre><code>$ mkdir /etc/kubernetes/pki/etcd\n$ ln -s /etc/etcd/ssl/* /etc/kubernetes/pki/etcd/\n$ systemctl daemon-reload\n$ systemctl enable --now etcd\n</code></pre> <p>\u67e5\u770bEtcd\u96c6\u7fa4\u72b6\u6001\uff1a</p> <pre><code>$ export ETCDCTL_API=3\n$ etcdctl --endpoints=\"10.0.0.201:2379,10.0.0.202:2379,10.0.0.203:2379\" --cacert=/etc/kubernetes/pki/etcd/etcd-ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem --key=/etc/kubernetes/pki/etcd/etcd-key.pem  endpoint status --write-out=table\n\n+--------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n|      ENDPOINT      |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |\n+--------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n| 10.0.0.203:2379 | d47768538fbe6e4f |  3.4.13 |   20 kB |      true |      false |         3 |          9 |                  9 |        |\n| 10.0.0.202:2379 | 84a44ce3d2a87a83 |  3.4.13 |   20 kB |     false |      false |         3 |          9 |                  9 |        |\n| 10.0.0.201:2379 | 5a8e242cc814d239 |  3.4.13 |   20 kB |     false |      false |         3 |          9 |                  9 |        |\n+--------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#37-k8s-master\u8282\u70b9\u914d\u7f6e","title":"3.7 K8s Master\u8282\u70b9\u914d\u7f6e","text":"<p>\u63a5\u4e0b\u6765\u5728Master\u8282\u70b9\u5b89\u88c5APIServer\u3001Controller Manager\u3001Scheduler\u7ec4\u4ef6\u3002</p> <p>\u9996\u5148\u5728\u6240\u6709\u8282\u70b9\u521b\u5efa\u76f8\u5173\u76ee\u5f55\uff1a</p> <pre><code>$ mkdir -p /etc/kubernetes/manifests/ /etc/systemd/system/kubelet.service.d /var/lib/kubelet /var/log/kubernetes\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#371-apiserver","title":"3.7.1 APIServer","text":"<p>\u9996\u5148\u914d\u7f6eAPIServer\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u914d\u7f6e\u5927\u81f4\u76f8\u540c\uff0c\u6ce8\u610f\u4fee\u6539\u7684\u5730\u65b9\u5982\u4e0b\uff08\u5b8c\u6574\u6587\u4ef6\u89c1\u672c\u4e66\u4e0b\u8f7d\u8d44\u6e90\uff09\uff1a</p> <p>vim /usr/lib/systemd/system/kube-apiserver.service </p> <p>\u914d\u7f6e\u81ea\u884c\u66f4\u6539</p> <pre><code>[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-apiserver \\\n--v=2  \\\n--logtostderr=true  \\\n--allow-privileged=true  \\\n--bind-address=0.0.0.0  \\\n--secure-port=6443  \\\n--insecure-port=0  \\\n--advertise-address=10.103.236.201 \\\n--service-cluster-ip-range=192.168.0.0/16  \\\n--service-node-port-range=30000-32767  \\\n--etcd-servers=https://10.103.236.201:2379,https://10.103.236.202:2379,https://10.103.236.203:2379 \\\n--etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \\\n--etcd-certfile=/etc/etcd/ssl/etcd.pem  \\\n--etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \\\n--client-ca-file=/etc/kubernetes/pki/ca.pem  \\\n--tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \\\n--tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \\\n--kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \\\n--kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \\\n--service-account-key-file=/etc/kubernetes/pki/sa.pub  \\\n--service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \\\n--service-account-issuer=https://kubernetes.default.svc.cluster.local \\\n--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \\\n--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \\\n--authorization-mode=Node,RBAC  \\\n--enable-bootstrap-token-auth=true  \\\n--requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \\\n--proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \\\n--proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \\\n--requestheader-allowed-names=aggregator  \\\n--requestheader-group-headers=X-Remote-Group  \\\n--requestheader-extra-headers-prefix=X-Remote-Extra-  \\\n--requestheader-username-headers=X-Remote-User\n      # --token-auth-file=/etc/kubernetes/token.csv\nRestart=on-failure\nRestartSec=10s\nLimitNOFILE=65535\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Service\u6587\u4ef6\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u6240\u6709Master\u8282\u70b9\u542f\u52a8kube-apiserver\uff1a</p> <pre><code>$ systemctl daemon-reload &amp;&amp; systemctl enable --now kube-apiserver\n</code></pre> <p>\u68c0\u6d4bAPIServer\u72b6\u6001\uff1a</p> <pre><code>$ systemctl status kube-apiserver\n\n\u25cf kube-apiserver.service - Kubernetes API Server\n   Loaded: loaded (/usr/lib/systemd/system/kube-apiserver.service; enabled; vendor preset: disabled)\nActive: active (running) since Fri 2021-07-23 16:23:47 CST; 10s ago\n     Docs: https://github.com/kubernetes/kubernetes\n Main PID: 10956 (kube-apiserver)\nTasks: 13\nMemory: 302.4M\n   CGroup: /system.slice/kube-apiserver.service\n           \u2514\u250010956 /usr/local/bin/kube-apiserver --v=2 --logtostderr=true --allow-privileged=true --bind-address=0.0.0.0 --secure-port=64...\n\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: I0723 16:23:54.176533   10956 storage_rbac.go:331] created rolebinding.rbac.aut...system\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: I0723 16:23:54.185158   10956 storage_rbac.go:331] created rolebinding.rbac.aut...system\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: I0723 16:23:54.190144   10956 healthz.go:257] poststarthook/rbac/bootstrap-role...readyz\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: [-]poststarthook/rbac/bootstrap-roles failed: not finished\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: I0723 16:23:54.192942   10956 storage_rbac.go:331] created rolebinding.rbac.aut...system\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: I0723 16:23:54.201305   10956 storage_rbac.go:331] created rolebinding.rbac.aut...system\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: I0723 16:23:54.209273   10956 storage_rbac.go:331] created rolebinding.rbac.aut...public\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: W0723 16:23:54.322312   10956 lease.go:233] Resetting endpoints for master serv...2.212]\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: I0723 16:23:54.323449   10956 controller.go:611] quota admission added evaluato...points\nJul 23 16:23:54 k8s-master01 kube-apiserver[10956]: I0723 16:23:54.334503   10956 controller.go:611] quota admission added evaluato...k8s.io\nHint: Some lines were ellipsized, use -l to show in full.\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#372-controller-manager","title":"3.7.2 Controller Manager","text":"<p>\u91c7\u7528\u540c\u6837\u7684\u6d41\u7a0b\u914d\u7f6eController Manager\uff0c\u4e0d\u540c\u7684\u662fController Manager\u7684Service\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u6240\u6709Master\u8282\u70b9\u914d\u7f6ekube-controller-manager Service\uff08\u5b8c\u6574\u6587\u4ef6\u89c1\u672c\u4e66\u4e0b\u8f7d\u8d44\u6e90):</p> <p>vim /usr/lib/systemd/system/kube-controller-manager.service </p> <p>\u914d\u7f6e\u81ea\u884c\u66f4\u6539</p> <pre><code>[Unit]\nDescription=Kubernetes Controller Manager\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-controller-manager \\\n--v=2 \\\n--logtostderr=true \\\n--address=127.0.0.1 \\\n--root-ca-file=/etc/kubernetes/pki/ca.pem \\\n--cluster-signing-cert-file=/etc/kubernetes/pki/ca.pem \\\n--cluster-signing-key-file=/etc/kubernetes/pki/ca-key.pem \\\n--service-account-private-key-file=/etc/kubernetes/pki/sa.key \\\n--kubeconfig=/etc/kubernetes/controller-manager.kubeconfig \\\n--leader-elect=true \\\n--use-service-account-credentials=true \\\n--node-monitor-grace-period=40s \\\n--node-monitor-period=5s \\\n--pod-eviction-timeout=2m0s \\\n--controllers=*,bootstrapsigner,tokencleaner \\\n--allocate-node-cidrs=true \\\n--cluster-cidr=172.16.0.0/12 \\\n--requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem \\\n--node-cidr-mask-size=24\nRestart=always\nRestartSec=10s\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>\u6240\u6709Master\u8282\u70b9\u542f\u52a8kube-controller-manager</p> <pre><code>$ systemctl daemon-reload\n$ systemctl enable --now kube-controller-manager\n</code></pre> <p>\u67e5\u770b\u542f\u52a8\u72b6\u6001</p> <pre><code>$ systemctl status kube-controller-manager\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#373-scheduler","title":"3.7.3 Scheduler","text":"<p>\u548cController Manager\u4e00\u81f4\uff0c\u6bcf\u4e2aMaster\u8282\u70b9\u7684Service\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u6240\u6709Master\u8282\u70b9\u914d\u7f6ekube-scheduler service\uff08\u5b8c\u6574\u6587\u4ef6\u89c1\u672c\u4e66\u4e0b\u8f7d\u8d44\u6e90\uff09\uff1a</p> <p>vim /usr/lib/systemd/system/kube-scheduler.service </p> <pre><code>[Unit]\nDescription=Kubernetes Scheduler\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-scheduler \\\n--v=2 \\\n--logtostderr=true \\\n--address=127.0.0.1 \\\n--leader-elect=true \\\n--kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n\nRestart=always\nRestartSec=10s\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>\u542f\u52a8Scheduler\uff1a</p> <pre><code>$ systemctl daemon-reload\n\n$ systemctl enable --now kube-scheduler\n</code></pre> <p>\u67e5\u770b\u542f\u52a8\u72b6\u6001</p> <pre><code>$ systemctl  status kube-scheduler\n</code></pre> <p>\u81f3\u6b64\uff0cKubernetes Master\u8282\u70b9\u7ec4\u4ef6\u548cEtcd\u5747\u5df2\u7ecf\u914d\u7f6e\u5b8c\u6210\uff0c\u8bfb\u8005\u53ef\u4ee5\u67e5\u770b\u7cfb\u7edf\u65e5\u5fd7\uff08CentOS\u4e3a/var/log/messages\uff0cUbuntu\u4e3a/var/log/syslog\uff09\u6709\u65e0\u62a5\u9519\u65e5\u5fd7\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#38-tls-bootstrapping\u914d\u7f6e","title":"3.8 TLS Bootstrapping\u914d\u7f6e","text":"<p>\u76f8\u5bf9\u4e8eMaster\u8282\u70b9\uff0c\u5de5\u4f5c\u8282\u70b9\u7684\u52a8\u6001\u6027\u76f8\u5bf9\u6bd4\u8f83\u7075\u6d3b\u3002</p> <p>\u5728\u7ef4\u62a4\u96c6\u7fa4\u65f6\uff0c\u7ecf\u5e38\u4f1a\u589e\u5220\u5de5\u4f5c\u8282\u70b9\uff0c\u5982\u679c\u50cf\u63a7\u5236\u8282\u70b9\u7684\u7ec4\u4ef6\u4e00\u6837\u53bb\u7ba1\u7406\u5de5\u4f5c\u8282\u70b9\u7ec4\u4ef6Kubelet\u7684\u8bc1\u4e66\uff0c\u4f1a\u663e\u5f97\u6bd4\u8f83\u9ebb\u70e6\uff0c\u5e76\u4e14\u5bb9\u6613\u51fa\u9519\uff0c\u6240\u4ee5\u672c\u8282\u5c06\u5728\u96c6\u7fa4\u4e2d\u914d\u7f6eBootstrapping\uff0cBootstrapping\u4f1a\u81ea\u52a8\u4e3a\u5de5\u4f5c\u8282\u70b9\u7684Kubelet\u9881\u53d1\u8bc1\u4e66\uff0c\u5373\u751f\u6210kubelet.kubeconfig\u6587\u4ef6\u3002</p> <p>\u6ce8\u610f</p> <p>\u63a5\u4e0b\u6765\u7684\u547d\u4ee4\uff0c\u5982\u679c\u4e0d\u662f\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c\u628aMaster\u7684\u5730\u5740\u6539\u4e3a10.0.0.236:16443\uff0c\u628aAPI Server\u7684\u7aef\u53e3\u6539\u4e3a16443\uff0c\u9ed8\u8ba4\u662f6443</p> <p>kubectl\u547d\u4ee4\u53ea\u5728Master01\u8282\u70b9\u6267\u884c\u4e00\u6b21\u3002\u63a5\u4e0b\u6765\u5728Master01\u8282\u70b9\u521b\u5efabootstrap\u6240\u7528\u7684\u6743\u9650\uff08\u914d\u7f6eBootstrap\u7684kubeconfig\u548c2.4\u8282\u7c7b\u4f3c\uff09\uff1a</p> <pre><code>$ cd /root/k8s-ha-install/bootstrap\n\n$ kubectl config set-cluster kubernetes     \\\n--certificate-authority=/etc/kubernetes/pki/ca.pem     \\\n--embed-certs=true     \\\n--server=https://10.0.0.236:16443     \\\n--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig\n\n$ kubectl config set-credentials tls-bootstrap-token-user     \\\n--token=c8ad9c.2e4d610cf3e7426e \\\n--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig\n\n$ kubectl config set-context tls-bootstrap-token-user@kubernetes     \\\n--cluster=kubernetes     \\\n--user=tls-bootstrap-token-user     \\\n--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig\n\n$ kubectl config use-context tls-bootstrap-token-user@kubernetes     \\\n--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig\n</code></pre> <p>bootstrap-kubelet.kubeconfig \u662f\u4e00\u4e2a keepalived \u7528\u6765\u5411 apiserver \u7533\u8bf7\u8bc1\u4e66\u7684\u6587\u4ef6</p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u8981\u4fee\u6539bootstrap.secret.yaml\u7684token-id\u548ctoken-secret\uff0c\u9700\u8981\u4fdd\u8bc1 c8ad9c \u5b57\u7b26\u4e32\u4e00\u81f4\u7684\uff0c\u5e76\u4e14\u4f4d\u6570\u662f\u4e00\u6837\u7684\u3002</p> <p>\u8fd8\u8981\u4fdd\u8bc1\u4e0a\u4e2a\u547d\u4ee4\u7684\u9ec4\u8272\u5b57\u4f53\uff1ac8ad9c.2e4d610cf3e7426e\u4e0e\u4f60\u4fee\u6539\u7684\u5b57\u7b26\u4e32\u8981\u4e00\u81f4</p> <pre><code>$ cat bootstrap.secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: bootstrap-token-c8ad9c\n  namespace: kube-system\ntype: bootstrap.kubernetes.io/token\nstringData:\n  description: \"The default bootstrap token generated by 'kubelet '.\"\ntoken-id: c8ad9c\n  token-secret: 2e4d610cf3e7426e\n  usage-bootstrap-authentication: \"true\"\nusage-bootstrap-signing: \"true\"\nauth-extra-groups:  system:bootstrappers:default-node-token,system:bootstrappers:worker,system:bootstrappers:ingress\n</code></pre> <p>\u524d\u6587\u63d0\u5230\uff0cadmin.kubeconfig\u662fKubectl\u64cd\u4f5c\u96c6\u7fa4\u6240\u7528\u7684\u8bc1\u4e66\uff0c\u5c06\u8be5\u6587\u4ef6\u590d\u5236\u5230/root/.kube/config\uff0cKubectl\u5373\u53ef\u9ed8\u8ba4\u4f7f\u7528\u8be5\u6587\u4ef6\u8fde\u63a5\u96c6\u7fa4\uff1a</p> <pre><code>$ mkdir -p /root/.kube ; cp /etc/kubernetes/admin.kubeconfig /root/.kube/config\n</code></pre> <p>\u63a5\u4e0b\u6765\u521b\u5efaBootstrapping\u6240\u7528\u7684\u6743\u9650\uff1a</p> <pre><code>$ kubectl create -f bootstrap.secret.yaml\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#39-node\u8282\u70b9\u914d\u7f6e","title":"3.9 Node\u8282\u70b9\u914d\u7f6e","text":"<p>\u524d\u9762\u5df2\u7ecf\u628a\u6240\u6709Master\u8282\u70b9\u7ec4\u4ef6\u5b89\u88c5\u5b8c\u6210\uff0c\u5e76\u4e14\u914d\u7f6e\u4e86Bootstrapping\u81ea\u52a8\u4e3aNode\u8282\u70b9\u7b7e\u53d1\u8bc1\u4e66\uff0c\u6240\u4ee5Node\u8282\u70b9\u7684Kubelet\u8bc1\u4e66\uff08kubelet.kubeconfig\uff09\u4e0d\u9700\u8981\u518d\u624b\u52a8\u914d\u7f6e\uff0c\u53ef\u4ee5\u91c7\u7528Bootstrap\u81ea\u52a8\u751f\u6210\u3002</p> <p>\u4f46\u662f\u6709\u4e00\u4e9b\u8bc1\u4e66\u8fd8\u662f\u9700\u8981\u624b\u52a8\u53d1\u9001\u5230Node\u8282\u70b9\uff0c\u6bd4\u5982\u8bf7\u6c42kubelet.kubeconfig\u8bc1\u4e66\u7684bootstrap.kubeconfig\u8bc1\u4e66\u7b49\u3002Master01\u8282\u70b9\u5c06Node\u8282\u70b9\u6240\u7528\u7684\u8bc1\u4e66\u590d\u5236\u5230\u5404\u4e2aNode\u8282\u70b9\uff08\u672c\u6b21\u793a\u4f8bMaster\u8282\u70b9\u4e5f\u4f1a\u90e8\u7f72kubelet\u548ckube-proxy\uff09\uff1a</p> <pre><code>$ cd /etc/kubernetes/\n\n$ for NODE in k8s-master02 k8s-master03 k8s-node01 k8s-node02; do\nssh $NODE mkdir -p /etc/kubernetes/pki /etc/etcd/ssl /etc/etcd/ssl\n     for FILE in etcd-ca.pem etcd.pem etcd-key.pem; do\nscp /etc/etcd/ssl/$FILE $NODE:/etc/etcd/ssl/\n     done\nfor FILE in pki/ca.pem pki/ca-key.pem pki/front-proxy-ca.pem bootstrap-kubelet.kubeconfig; do\nscp /etc/kubernetes/$FILE $NODE:/etc/kubernetes/${FILE}\ndone\ndone\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#391-kubelet\u914d\u7f6e","title":"3.9.1 Kubelet\u914d\u7f6e","text":"<p>\u6240\u6709\u8282\u70b9\u521b\u5efa\u76f8\u5173\u76ee\u5f55\uff1a</p> <pre><code>$ mkdir -p /var/lib/kubelet /var/log/kubernetes /etc/systemd/system/kubelet.service.d /etc/kubernetes/manifests/\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6eKubelet Service\uff1a</p> <pre><code>$ vim  /usr/lib/systemd/system/kubelet.service\n\n# \u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\n[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/local/bin/kubelet\n\nRestart=always\nStartLimitInterval=0\nRestartSec=10\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u914d\u7f6ekubelet service\u7684\u914d\u7f6e\u6587\u4ef6</p> <pre><code>[Service]\nEnvironment=\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig --kubeconfig=/etc/kubernetes/kubelet.kubeconfig\"\nEnvironment=\"KUBELET_SYSTEM_ARGS=--network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin --container-runtime=remote --runtime-request-timeout=15m --container-runtime-endpoint=unix:///run/containerd/containerd.sock --cgroup-driver=systemd\"\nEnvironment=\"KUBELET_CONFIG_ARGS=--config=/etc/kubernetes/kubelet-conf.yml\"\nEnvironment=\"KUBELET_EXTRA_ARGS=--node-labels=node.kubernetes.io/node='' \"\nExecStart=\nExecStart=/usr/local/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_SYSTEM_ARGS $KUBELET_EXTRA_ARGS\n</code></pre> <p>\u5982\u679c\u8bfb\u8005\u7684Runtime\u4e3aDocker\uff0c\u8bf7\u4f7f\u7528\u5982\u4e0bKubelet\u7684\u914d\u7f6e\uff1a</p> <p>vim /etc/systemd/system/kubelet.service.d/10-kubelet.conf</p> <pre><code>[Service]\nEnvironment=\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig --kubeconfig=/etc/kubernetes/kubelet.kubeconfig\"\nEnvironment=\"KUBELET_SYSTEM_ARGS=--network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin\"\nEnvironment=\"KUBELET_CONFIG_ARGS=--config=/etc/kubernetes/kubelet-conf.yml --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6\"\nEnvironment=\"KUBELET_EXTRA_ARGS=--node-labels=node.kubernetes.io/node='' \"\nExecStart=\nExecStart=/usr/local/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_SYSTEM_ARGS $KUBELET_EXTRA_ARGS\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u521b\u5efaKubelet\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u6ce8\u610f\u4fee\u6539\u7684\u5730\u65b9\uff0c\u5b8c\u6574\u6587\u4ef6\u89c1\u672c\u4e66\u4e0b\u8f7d\u8d44\u6e90\uff09\uff1a</p> <p>vim /etc/kubernetes/kubelet-conf.yml </p> <pre><code>apiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\naddress: 0.0.0.0\nport: 10250\nreadOnlyPort: 10255\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 2m0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.pem\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 5m0s\n    cacheUnauthorizedTTL: 30s\ncgroupDriver: systemd\ncgroupsPerQOS: true\nclusterDNS:\n- 192.168.0.10\nclusterDomain: cluster.local\ncontainerLogMaxFiles: 5\ncontainerLogMaxSize: 10Mi\ncontentType: application/vnd.kubernetes.protobuf\ncpuCFSQuota: true\ncpuManagerPolicy: none\ncpuManagerReconcilePeriod: 10s\nenableControllerAttachDetach: true\nenableDebuggingHandlers: true\nenforceNodeAllocatable:\n- pods\neventBurst: 10\neventRecordQPS: 5\nevictionHard:\n  imagefs.available: 15%\n  memory.available: 100Mi\n  nodefs.available: 10%\n  nodefs.inodesFree: 5%\nevictionPressureTransitionPeriod: 5m0s\nfailSwapOn: true\nfileCheckFrequency: 20s\nhairpinMode: promiscuous-bridge\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 20s\nimageGCHighThresholdPercent: 85\nimageGCLowThresholdPercent: 80\nimageMinimumGCAge: 2m0s\niptablesDropBit: 15\niptablesMasqueradeBit: 14\nkubeAPIBurst: 10\nkubeAPIQPS: 5\nmakeIPTablesUtilChains: true\nmaxOpenFiles: 1000000\nmaxPods: 110\nnodeStatusUpdateFrequency: 10s\noomScoreAdj: -999\npodPidsLimit: -1\nregistryBurst: 10\nregistryPullQPS: 5\nresolvConf: /etc/resolv.conf\nrotateCertificates: true\nruntimeRequestTimeout: 2m0s\nserializeImagePulls: true\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 4h0m0s\nsyncFrequency: 1m0s\nvolumeStatsAggPeriod: 1m0s\n</code></pre> <p>\u542f\u52a8\u6240\u6709\u8282\u70b9Kubelet\uff1a</p> <pre><code>$ systemctl daemon-reload\n$ systemctl enable --now kubelet\n</code></pre> <p>\u6b64\u65f6\u7cfb\u7edf\u65e5\u5fd7/var/log/messages\u663e\u793a\u53ea\u6709\u5982\u4e0b\u4fe1\u606f\u4e3a\u6b63\u5e38\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u6709\u5b89\u88c5CNI\u63d2\u4ef6\uff1a</p> <pre><code>Unable to update cni config: no networks found in /etc/cni/net.d\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u6709\u5f88\u591a\u62a5\u9519\u65e5\u5fd7\uff0c\u4e0d\u53ea\u662fCNI\u7684\u62a5\u9519\uff0c\u6216\u8005\u6709\u5927\u91cf\u770b\u4e0d\u61c2\u7684\u62a5\u9519\uff0c\u8bf4\u660eKubelet\u7684\u914d\u7f6e\u6709\u8bef\uff0c\u9700\u8981\u68c0\u67e5Kubelet\u7684\u914d\u7f6e\u3002</p> <p>\u67e5\u770b\u96c6\u7fa4\u72b6\u6001\uff1a</p> <p>\u96c6\u7fa4\u72b6\u6001NotReady\uff0c\u56e0\u4e3aCalico\u8fd8\u6ca1\u5b89\u88c5</p> <pre><code>$ kubectl get node\nNAME           STATUS     ROLES    AGE     VERSION\nk8s-master01   NotReady   &lt;none&gt;   2m23s   v1.22.0-beta.1\nk8s-master02   NotReady   &lt;none&gt;   2m16s   v1.22.0-beta.1\nk8s-master03   NotReady   &lt;none&gt;   2m16s   v1.22.0-beta.1\nk8s-node01     NotReady   &lt;none&gt;   2m16s   v1.22.0-beta.1\nk8s-node02     NotReady   &lt;none&gt;   2m16s   v1.22.0-beta.1\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#392-kube-proxy\u914d\u7f6e","title":"3.9.2 kube-proxy\u914d\u7f6e","text":"<p>\u6ce8\u610f</p> <p>\u5982\u679c\u4e0d\u662f\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c\u628aMaster\u7684\u5730\u5740\u6539\u4e3a10.0.0.236:16443\uff0c\u628aAPI Server\u7684\u7aef\u53e3\u6539\u4e3a16443\uff0c\u9ed8\u8ba4\u662f6443</p> <p>\u4ee5\u540c\u6837\u7684\u65b9\u5f0f\u751f\u6210kube-proxy\u7684\u8bc1\u4e66\u3002\u4ee5\u4e0b\u64cd\u4f5c\u53ea\u5728Master01\u6267\u884c\uff1a</p> <pre><code>$ cd /root/k8s-ha-install\n\n$ kubectl -n kube-system create serviceaccount kube-proxy\n\n$ kubectl create clusterrolebinding system:kube-proxy   \\\n--clusterrole system:node-proxier         \\\n--serviceaccount kube-system:kube-proxy\n\n$ SECRET=$(kubectl -n kube-system get sa/kube-proxy \\\n--output=jsonpath='{.secrets[0].name}')\n$ JWT_TOKEN=$(kubectl -n kube-system get secret/$SECRET \\\n--output=jsonpath='{.data.token}' | base64 -d)\n$ PKI_DIR=/etc/kubernetes/pki\n$ K8S_DIR=/etc/kubernetes\n\n$ kubectl config set-cluster kubernetes     \\\n--certificate-authority=/etc/kubernetes/pki/ca.pem    \\\n--embed-certs=true     \\\n--server=https://10.0.0.236:16443    \\\n--kubeconfig=${K8S_DIR}/kube-proxy.kubeconfig\n\n$ kubectl config set-credentials kubernetes     \\\n--token=${JWT_TOKEN}     \\\n--kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig\n\n$ kubectl config set-context kubernetes     \\\n--cluster=kubernetes     \\\n--user=kubernetes     \\\n--kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig\n\n$ kubectl config use-context kubernetes     --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig\n</code></pre> <p>\u6ce8\u610f</p> <p>\u4fee\u6539--server=https://10.0.0.236:16443\u4e3a\u8bfb\u8005\u81ea\u5df1\u7684VIP\u5730\u5740\u548c\u7aef\u53e3\uff0c\u5982\u679c\u4e0d\u662f\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c\u6539\u4e3aMaster\u8282\u70b9IP:6443\u5373\u53ef\u3002</p> <p>\u5c06kubeconfig\u53d1\u9001\u81f3\u5176\u4ed6\u8282\u70b9\uff1a</p> <pre><code>$ for NODE in k8s-master02 k8s-master03; do\nscp ${K8S_DIR}/kube-proxy.kubeconfig $NODE:/etc/kubernetes/kube-proxy.kubeconfig\n     scp kube-proxy/kube-proxy.conf $NODE:/etc/kubernetes/kube-proxy.conf\n     scp kube-proxy/kube-proxy.service $NODE:/usr/lib/systemd/system/kube-proxy.service\n done\n$ for NODE in k8s-node01 k8s-node02; do\nscp /etc/kubernetes/kube-proxy.kubeconfig $NODE:/etc/kubernetes/kube-proxy.kubeconfig\n     scp kube-proxy/kube-proxy.conf $NODE:/etc/kubernetes/kube-proxy.conf\n     scp kube-proxy/kube-proxy.service $NODE:/usr/lib/systemd/system/kube-proxy.service\n done\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u6dfb\u52a0kube-proxy\u7684\u914d\u7f6e\u548cService\u6587\u4ef6\uff1a</p> <p>vim /usr/lib/systemd/system/kube-proxy.service</p> <pre><code>[Unit]\nDescription=Kubernetes Kube Proxy\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-proxy \\\n--config=/etc/kubernetes/kube-proxy.yaml \\\n--v=2\nRestart=always\nRestartSec=10s\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u521b\u5efakube-proxy\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u679c\u66f4\u6539\u4e86\u96c6\u7fa4Pod\u7684\u7f51\u6bb5\uff0c\u5c31\u9700\u8981\u66f4\u6539kube-proxy.yaml\u7684clusterCIDR\u4e3a\u81ea\u5df1\u7684Pod\u7f51\u6bb5\uff08\u5b8c\u6574\u6587\u4ef6\u89c1\u672c\u4e66\u4e0b\u8f7d\u8d44\u6e90\uff09\uff1a</p> <p>vim /etc/kubernetes/kube-proxy.yaml</p> <pre><code>apiVersion: kubeproxy.config.k8s.io/v1alpha1\nbindAddress: 0.0.0.0\nclientConnection:\n  acceptContentTypes: \"\"\n  burst: 10\n  contentType: application/vnd.kubernetes.protobuf\n  kubeconfig: /etc/kubernetes/kube-proxy.kubeconfig\n  qps: 5\nclusterCIDR: 172.16.0.0/12 \nconfigSyncPeriod: 15m0s\nconntrack:\n  max: null\n  maxPerCore: 32768\n  min: 131072\n  tcpCloseWaitTimeout: 1h0m0s\n  tcpEstablishedTimeout: 24h0m0s\nenableProfiling: false\nhealthzBindAddress: 0.0.0.0:10256\nhostnameOverride: \"\"\niptables:\n  masqueradeAll: false\n  masqueradeBit: 14\n  minSyncPeriod: 0s\n  syncPeriod: 30s\nipvs:\n  masqueradeAll: true\n  minSyncPeriod: 5s\n  scheduler: \"rr\"\n  syncPeriod: 30s\nkind: KubeProxyConfiguration\nmetricsBindAddress: 127.0.0.1:10249\nmode: \"ipvs\"\nnodePortAddresses: null\noomScoreAdj: -999\nportRange: \"\"\nudpIdleTimeout: 250ms\n</code></pre> <p>\u6240\u6709\u8282\u70b9\u542f\u52a8kube-proxy\uff1a</p> <pre><code>$ systemctl daemon-reload\n$ systemctl enable --now kube-proxy\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#310-\u5b89\u88c5calico","title":"3.10 \u5b89\u88c5Calico","text":"<p>\u542f\u52a8Kubelet\u65f6\uff0c\u4f1a\u6709\u4e00\u4e2aCNI\u7684\u62a5\u9519\uff0c\u539f\u56e0\u662f\u6ca1\u6709\u5b89\u88c5CNI\u63d2\u4ef6\u3002\u76ee\u524d\u5e38\u7528\u7684CNI\u63d2\u4ef6\u6709Calico\u3001Flannel\u7b49\uff0c\u7531\u4e8e\u672c\u4e66\u5305\u542bNetworkPolicy\u7684\u77e5\u8bc6\uff0c\u9700\u8981CNI\u63d2\u4ef6\u652f\u6301\u7f51\u7edc\u7b56\u7565\uff0c\u56e0\u6b64\u548cKubeadm\u5b89\u88c5\u65b9\u5f0f\u4e00\u6837\uff0c\u540c\u6837\u9009\u62e9Calico\u4f5c\u4e3aCNI\u63d2\u4ef6\u3002</p> <p>\u8fdb\u5165Calico\u5b89\u88c5\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u3002\u4ee5\u4e0b\u6b65\u9aa4\u53ea\u5728master01\u6267\u884c\uff1a</p> <pre><code>$ cd /root/k8s-ha-install/calico/\n</code></pre> <p>\u66f4\u6539Calico\u7684\u7f51\u6bb5\uff0c\u6ce8\u610f\u9700\u8981\u5c06172.16.0.0/12\u7f51\u6bb5\u6539\u4e3a\u81ea\u5df1\u7684Pod\u7f51\u6bb5\uff1a</p> <pre><code>$ sed -i \"s#POD_CIDR#172.16.0.0/12#g\" calico.yaml\n</code></pre> <p>\u5b89\u88c5Calico\uff1a</p> <pre><code>$ kubectl apply -f calico.yaml\n</code></pre> <p>\u67e5\u770b\u5bb9\u5668\u72b6\u6001\uff1a</p> <pre><code>$ kubectl  get pod -n kube-system\nNAME                                      READY   STATUS    RESTARTS      AGE\ncalico-kube-controllers-cdd5755b9-4fzg9   1/1     Running   0             113s\ncalico-node-8xg62                         1/1     Running   0             113s\ncalico-node-dczxz                         1/1     Running   0             113s\ncalico-node-gn8ws                         1/1     Running   0             113s\ncalico-node-qmwkd                         1/1     Running   0             113s\ncalico-node-zfw8n                         1/1     Running   2 (78s ago)   113s\n</code></pre> <p>\u5982\u679c\u5bb9\u5668\u72b6\u6001\u5f02\u5e38\u53ef\u4ee5\u4f7f\u7528kubectl describe \u6216\u8005logs\u67e5\u770b\u5bb9\u5668\u7684\u65e5\u5fd7</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#311-\u5b89\u88c5coredns","title":"3.11 \u5b89\u88c5CoreDNS","text":"<p>\u5728Master01\u8282\u70b9\u8fdb\u5165CoreDNS\u5b89\u88c5\u6587\u4ef6\u6240\u5728\u76ee\u5f55\uff1a</p> <pre><code>$ cd /root/k8s-ha-install/CoreDNS\n</code></pre> <p>\u5982\u679c\u66f4\u6539\u4e86Service\u7684\u7f51\u6bb5\uff0c\u5c31\u9700\u8981\u5c06CoreDNS\u7684Service IP\u6539\u6210Kubernetes Service\u7f51\u6bb5\u7684\u7b2c10\u4e2aIP\uff1a</p> <pre><code>$ COREDNS_SERVICE_IP=`kubectl get svc | grep kubernetes | awk '{print $3}'`0\n$ sed -i \"s#192.168.0.10#${COREDNS_SERVICE_IP}#g\" coredns.yaml\n</code></pre> <p>\u5b89\u88c5CoreDNS\uff1a</p> <pre><code>$ kubectl  create -f coredns.yaml\nserviceaccount/coredns created\n...\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#312-\u5b89\u88c5metrics-server","title":"3.12 \u5b89\u88c5Metrics Server","text":"<p>\u5728\u65b0\u7248\u7684Kubernetes\u4e2d\uff0c\u7cfb\u7edf\u8d44\u6e90\u7684\u91c7\u96c6\u548cHPA\u529f\u80fd\u5747\u4f7f\u7528Metrics-server\uff0c\u53ef\u4ee5\u901a\u8fc7Metrics\u91c7\u96c6\u8282\u70b9\u548cPod\u7684\u5185\u5b58\u3001\u78c1\u76d8\u3001CPU\u548c\u7f51\u7edc\u7684\u4f7f\u7528\u7387\u3002</p> <p>\u5728Master01\u5b89\u88c5Metrics Server\uff1a</p> <pre><code>$ cd /root/k8s-ha-install/metrics-server\n\n$ kubectl  create -f .\nserviceaccount/metrics-server created\n...\n</code></pre> <p>\u7b49\u5f85Metrics Server\u542f\u52a8\uff0c\u7136\u540e\u67e5\u770b\u72b6\u6001\uff1a</p> <pre><code>$ kubectl  top node\nNAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   k8s-master01   263m         13%    1239Mi          66%       k8s-master02   213m         10%    1065Mi          57%       k8s-master03   207m         10%    1050Mi          56%       k8s-node01     89m          4%     514Mi           27%       k8s-node02     158m         7%     493Mi           26% </code></pre> <p>\u67e5\u770bpod\u72b6\u6001</p> <pre><code>$ kubectl  top pod -A\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#313-\u5b89\u88c5dashboard","title":"3.13 \u5b89\u88c5dashboard","text":"<ul> <li>\u5b89\u88c5\u6307\u5b9a\u7248\u672cdashboard</li> <li>\u5b89\u88c5\u6700\u65b0\u7248dashboard</li> <li>\u767b\u5f55dashboard</li> </ul> <p>Dashboard\u7528\u4e8e\u5c55\u793a\u96c6\u7fa4\u4e2d\u7684\u5404\u7c7b\u8d44\u6e90\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u901a\u8fc7Dashboard\u5b9e\u65f6\u67e5\u770bPod\u7684\u65e5\u5fd7\u548c\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u4e00\u4e9b\u547d\u4ee4\u7b49\u3002</p> <p>\uff081\uff09\u5b89\u88c5\u6307\u5b9a\u7248\u672cdashboard</p> <pre><code>$ cd /root/k8s-ha-install/dashboard/\n\n[root@k8s-master01 dashboard]# ls\ndashboard-user.yaml  dashboard.yaml\n\n# kubectl create -f .\nserviceaccount/admin-user created\nclusterrolebinding.rbac.authorization.k8s.io/admin-user created\nnamespace/kubernetes-dashboard created\nserviceaccount/kubernetes-dashboard created\nservice/kubernetes-dashboard created\nsecret/kubernetes-dashboard-certs created\nsecret/kubernetes-dashboard-csrf created\nsecret/kubernetes-dashboard-key-holder created\nconfigmap/kubernetes-dashboard-settings created\nrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrole.rbac.authorization.k8s.io/kubernetes-dashboard\ncreated\nrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard\ncreated\nclusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard\ncreated\ndeployment.apps/kubernetes-dashboard created\nservice/dashboard-metrics-scraper created\ndeployment.apps/dashboard-metrics-scraper created\n</code></pre> <p>\uff082\uff09\u5b89\u88c5\u6700\u65b0\u7248dashboard</p> <p>\u5b98\u65b9GitHub\u5730\u5740\uff1ahttps://github.com/kubernetes/dashboard</p> <p>\u53ef\u4ee5\u5728\u5b98\u65b9dashboard\u67e5\u770b\u5230\u6700\u65b0\u7248dashboard</p> <pre><code>$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml\n</code></pre> <p>\u521b\u5efa\u7ba1\u7406\u5458\u7528\u6237\uff08\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684\u65f6\u5019\uff09</p> <pre><code>$ vim admin.yaml\n# \u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: admin-user\n  namespace: kube-system\n</code></pre> <p>\u6267\u884c</p> <pre><code>$ kubectl apply -f admin.yaml -n kube-system\n</code></pre> <p>\uff083\uff09\u767b\u5f55dashboard \u5728\u8c37\u6b4c\u6d4f\u89c8\u5668\uff08Chrome\uff09\u542f\u52a8\u6587\u4ef6\u4e2d\u52a0\u5165\u542f\u52a8\u53c2\u6570\uff0c\u7528\u4e8e\u89e3\u51b3\u65e0\u6cd5\u8bbf\u95eeDashboard\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u4f7f\u7528\u7684\u8bc1\u4e66\u662f\u81ea\u7b7e\u540d\uff08\u5c5e\u6027-&gt;\u5feb\u6377\u65b9\u5f0f-&gt;\u76ee\u6807\uff0c\u7c98\u8d34\u5230\u6700\u540e\uff09</p> <pre><code> --test-type --ignore-certificate-errors\n</code></pre> <p>\u66f4\u6539dashboard\u7684svc\u4e3aNodePort\uff1a</p> <pre><code>$ kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard\n</code></pre> <p>\u4fee\u6539 type: ClusterIP \u4e3a type:NodePort</p> <p>\u4fee\u6539\u5b8c\u6210\u4e4b\u540e\u4f1a\u66b4\u9732\u4e00\u4e2a\u7aef\u53e3\u53f7\uff0c\u67e5\u770b\u7aef\u53e3\u53f7\uff1a</p> <pre><code>[root@k8s-master01 dashboard]# kubectl get svc kubernetes-dashboard -n kubernetes-dashboard\nNAME                   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE\nkubernetes-dashboard   NodePort   10.98.129.195   &lt;none&gt;        443:30711/TCP   85s\n\n[root@k8s-master01 dashboard]# kubectl get pod -A -owide | grep dashboard\nkubernetes-dashboard   dashboard-metrics-scraper-7b4bbf8954-zvgm8   1/1     Running   0          13m     172.27.14.193    k8s-node02     &lt;none&gt;           &lt;none&gt;\nkubernetes-dashboard   kubernetes-dashboard-6c65b776bd-797lx        1/1     Running   0          13m     172.18.195.1     k8s-master03   &lt;none&gt;           &lt;none&gt;\n</code></pre> <p>\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u4f8b\u7aef\u53e3\u53f7\uff0c\u901a\u8fc7\u4efb\u610f\u5b89\u88c5\u4e86kube-proxy\u7684\u5bbf\u4e3b\u673a\u6216\u8005VIP\u7684IP+\u7aef\u53e3\u5373\u53ef\u8bbf\u95ee\u5230dashboard\uff1a\u8bbf\u95eeDashboard\uff1ahttps://10.218.22.252:30711\uff08\u8bf7\u66f4\u6539\u4e3a\u81ea\u5df1\u7684\u7aef\u53e3\uff09\uff0c\u9009\u62e9\u767b\u5f55\u65b9\u5f0f\u4e3a\u4ee4\u724c\uff08\u5373token\u65b9\u5f0f\uff09</p> <p>\u67e5\u770btoken\u503c\uff1a</p> <pre><code>$ kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')\ntoken\u503c\n\nName:         admin-user-token-9c4tz\nNamespace:    kube-system\nLabels:       &lt;none&gt;\nAnnotations:  kubernetes.io/service-account.name: admin-user\n              kubernetes.io/service-account.uid: d1f2e528-0ef8-4c6b-a384-a18fbca6bc54\n\nType:  kubernetes.io/service-account-token\n\nData\n====\nca.crt:     1411 bytes\nnamespace:  11 bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IlNCbEdFa1RQZElhbTBRb29aTTNCTUE1dTJ2enBCeGZxMWJwbmpfZHBXdkEifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLTljNHR6Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJkMWYyZTUyOC0wZWY4LTRjNmItYTM4NC1hMThmYmNhNmJjNTQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.KFH5ed0kJEaU1HSpxkitJxqKJGnSNAWogNSGjGn1wEh7R9zKYkAfNLES6Vl3GU9jvxBCEZW415ZFILr96kpgl_88mD-K-AMgQxKLdpghYDx_CnsLtI6e8rLTNkaPS2Uo3sYAy9U280Niop14Yzuar5FQ3AfSbeXGcF_9Jrgyeh5XWPA0h69Au8pUEOkVdpADmuIaFSqfTnmkOSdGqCgFb_QsUqvjo4ifIxKnN6uW8wfR1s4esWkPq569xhCINaUY6g3rnT1jfVTU2XmrURrKOVok0OfSmtXTKCSs2jliEdmx7qEFTrw2KCPnTfORUtTnmdZ2ZnGGx9Fvf_hGaKk1FQ\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/2.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85%E9%AB%98%E5%8F%AF%E7%94%A8K8s%E9%9B%86%E7%BE%A4/#314-\u4f7f\u7528kuboard\u754c\u9762","title":"3.14 \u4f7f\u7528Kuboard\u754c\u9762","text":"<p>Kuboard\u662f\u56fd\u4eba\u5f00\u53d1\u7684\u53e6\u4e00\u4e2adashboard\u754c\u9762,</p> <p>\u5b98\u7f51\u5730\u5740</p> <p>https://www.kuboard.cn/install/v3/install-in-k8s.html</p> <p>\u8be6\u7ec6\u5185\u5bb9\u53ef\u4ee5\u770b\u5b98\u7f51\uff0c\u6211\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u547d\u4ee4\u5b89\u88c5</p> <pre><code>$ kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3.yaml\n</code></pre> <p>\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u94fe\u63a5 http://your-node-ip-address:30080</p> <p>\u8f93\u5165\u521d\u59cb\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5e76\u767b\u5f55</p> <pre><code>\u7528\u6237\u540d\uff1a admin\n\u5bc6\u7801\uff1a Kuboard123\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>\u4e8c\u8fdb\u5236\u5b89\u88c5k8s\u96c6\u7fa4V1.23.0</p> <p>\u4e8c\u8fdb\u5236\u9ad8\u53ef\u7528\u5b89\u88c5k8s\u96c6\u7fa4\u90e8\u7f72</p> <p>kubernetes\u4e4b\u4e8c\u8fdb\u5236\u5b89\u88c51.25.+\u7248\u672c</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/","title":"\u5b89\u88c5\u5e38\u7528\u5de5\u5177","text":"<p>Kubernetes \u547d\u4ee4\u884c\u5de5\u5177 kubectl\uff0c \u8ba9\u4f60\u53ef\u4ee5\u5bf9 Kubernetes \u96c6\u7fa4\u8fd0\u884c\u547d\u4ee4\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 kubectl \u6765\u90e8\u7f72\u5e94\u7528\u3001\u76d1\u6d4b\u548c\u7ba1\u7406\u96c6\u7fa4\u8d44\u6e90\u4ee5\u53ca\u67e5\u770b\u65e5\u5fd7\u3002</p> <p>\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u5305\u62ec kubectl \u64cd\u4f5c\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u89c1 kubectl\u53c2\u8003\u6587\u4ef6\u3002</p> <p>kubectl \u53ef\u5b89\u88c5\u5728\u5404\u79cd Linux \u5e73\u53f0\u3001 macOS \u548c Windows \u4e0a\u3002 \u5728\u4e0b\u9762\u627e\u5230\u4f60\u559c\u6b22\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u5728 Linux \u4e0a\u5b89\u88c5 kubectl</p> <p>\u5728 macOS \u4e0a\u5b89\u88c5 kubectl</p> <p>\u5728 Windows \u4e0a\u5b89\u88c5 kubectl</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#1\u5b89\u88c5kubectl","title":"1.\u5b89\u88c5kubectl","text":"<pre><code># kubectl \n$ curl -SL https://dl.k8s.io/release/v1.22.5/bin/linux/amd64/kubectl -o /usr/bin/kubectl\n$ chmod 755  /usr/bin/kubectl\n\n$ kubectl get nodes\nNAME             STATUS   ROLES    AGE    VERSION\n192.168.240.10   Ready    &lt;none&gt;   42m    v1.22.5\n192.168.240.11   Ready    &lt;none&gt;   42m    v1.22.5\n....\n\n# kubectl\u8865\u5168\n$ source &lt;(kubectl completion bash)\n$ echo \"source &lt;(kubectl completion bash)\" &gt;&gt; ~/.bashrc\n\n# \u5feb\u6377\u952e\ncat &gt;&gt; ~/.bashrc &lt;&lt;EOF\nalias k=kubectl\ncomplete -o default -F __start_kubectl k\nEOF\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#2\u5b89\u88c5helm","title":"2.\u5b89\u88c5helm","text":"<pre><code># helm\n$ wget -c https://repo.huaweicloud.com/helm/v3.8.0/helm-v3.8.0-linux-386.tar.gz\n$ tar -zxvf helm-v3.8.0-linux-386.tar.gz\n$ cp linux-386/helm /usr/local/bin/\n$ chmod a+x  /usr/local/bin/helm\n$ chmod 600 ~/.kube/config\n$ helm list -A\nNAME    NAMESPACE       REVISION        UPDATED STATUS  CHART   APP VERSION\n\n# helm\u8865\u5168\n$ helm completion bash &gt; /etc/bash_completion.d/helm\n\n$ echo \"helm completion bash &gt; /etc/bash_completion.d/helm\" &gt;&gt;  ~/.bashrc\n</code></pre>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#3kubectx-kubens-and-fzf","title":"3.Kubectx Kubens and fzf","text":"<p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u62e5\u6709\u591a\u5957\u96c6\u7fa4\uff0c\u5f00\u53d1/\u6d4b\u8bd5/\u751f\u4ea7\uff0c\u672c\u5730\u6216\u4e91\u96c6\u7fa4\u3002\u53ef\u4ee5\u4f7f\u7528 Kubectx \u548c Kubens \u5feb\u901f\u5730\u5728\u4e0d\u540c\u7684\u96c6\u7fa4\u548c namespace \u76f4\u63a5\u5207\u6362\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c fzf \u63d0\u4f9b\u4e86\u4ea4\u4e92\u7684\u65b9\u5f0f\u6765\u5207\u6362\u4e0a\u4e0b\u6587\uff0c\u56e0\u6b64\u4e0d\u5fc5\u8bb0\u4f4f\u4efb\u4f55\u96c6\u7fa4\u6216 namespace\u3002</p> <pre><code># Install kubectx, kubens, fzf\nbrew install kubectx fzf\n# Switch between namespaces\nkubens\n</code></pre> <p>\u5b89\u88c5 kubectx \u548c kubens \u7684\u4f9d\u8d56\u9879\uff1a</p> <p><pre><code># \u4e0b\u8f7d kubectx \u548c kubens \u811a\u672c\u6587\u4ef6\ngit clone https://github.com/ahmetb/kubectx.git ~/.kubectx\nsudo ln -s ~/.kubectx/kubectx /usr/local/bin/kubectx\nsudo ln -s ~/.kubectx/kubens /usr/local/bin/kubens\n\n# \u914d\u7f6e bash \u81ea\u52a8\u5b8c\u6210\necho 'source &lt;(kubectl completion bash)' &gt;&gt; ~/.bashrc\necho 'source ~/.kubectx/completion/kubectx.bash' &gt;&gt; ~/.bashrc\necho 'source ~/.kubectx/completion/kubens.bash' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n</code></pre> \u81f3\u6b64\uff0ckubectx \u548c kubens \u5df2\u6210\u529f\u5b89\u88c5\u3002</p> <p>\u8981\u5b89\u88c5 fzf\uff0c\u8bf7\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u64cd\u4f5c\uff1a</p> <pre><code># 1.\u4e0b\u8f7d\u548c\u5b89\u88c5 fzf\ngit clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf\n~/.fzf/install\n\n# 2.\u914d\u7f6e bash \u81ea\u52a8\u5b8c\u6210\uff1a\necho '[ -f ~/.fzf.bash ] &amp;&amp; source ~/.fzf.bash' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n</code></pre> <p>\u73b0\u5728\uff0cfzf \u5df2\u6210\u529f\u5b89\u88c5\u3002</p> <p>\u8bf7\u8bb0\u4f4f\uff0c\u5728\u5b89\u88c5\u4e4b\u524d\uff0c\u8bf7\u786e\u4fdd\u60a8\u7684\u7cfb\u7edf\u5df2\u7ecf\u5b89\u88c5\u4e86 git \u548c curl\u3002</p>"},{"location":"Kubernetes/1.%E5%AE%89%E8%A3%85%E7%AF%87/3.%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#4-kubectl-neat","title":"4. kubectl-neat","text":"<p>\u9879\u76ee\u5730\u5740\uff1akubectl-neat(opens new window)</p> <p>\u9879\u76ee\u8bf4\u660e\uff1a\u4e00\u6b3e\u5728\u6267\u884c kubectl \u901a\u8fc7 -o \u5bfc\u51fa yaml \u65f6\u5254\u9664\u65e0\u7528\u4fe1\u606f\u7684\u5de5\u5177</p> <p>https://github.com/itaysk/kubectl-neat</p> <p>\u76f4\u63a5\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u5230/usr/local/bin\u4e0b\u5373\u53ef\u3002</p> <pre><code>$ wget \"https://github.com/itaysk/kubectl-neat/releases/download/v2.0.3/kubectl-neat_linux_amd64.tar.gz\" \\\n$ tar zxvf kubectl-neat_linux_amd64.tar.gz\n$ mv kubectl-neat /usr/local/bin/\n</code></pre> <p>\u6216\u8005\u5982\u4e0b\u65b9\u5f0f\u5b89\u88c5,\u9700\u8981\u5b89\u88c5Go\u5f00\u53d1\u73af\u5883</p> <pre><code>$ git clone https://github.com/itaysk/kubectl-neat.git\n$ cd kubectl-neat\n$ go build .\n$ mv kubectl-neat /usr/local/bin/\n</code></pre> <p>\u7528\u4e0a\u8fd9\u4e9b\u5de5\u5177\uff0c\u8fd0\u7ef4\u6548\u7387\u55d6\u55d6\u7684</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/","title":"Docker\u57fa\u7840","text":"<p>\u5728\u516c\u53f8\u4f7f\u7528Kubernetes\u4ee5\u540e\uff0c\u5176\u5b9e\u5bf9\u4e8eDocker\u7684\u76f4\u63a5\u64cd\u4f5c\u5e76\u4e0d\u591a\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u547d\u4ee4\u5df2\u88abKubernetes\u7684\u5ba2\u6237\u7aef\u5de5\u5177Kubectl\u5c01\u88c5\uff0c\u6211\u4eec\u4f7f\u7528Kubectl\u5373 \u53ef\u5b8c\u6210Kubernetes\u7684\u65e5\u5e38\u7ba1\u7406\u548c\u8fd0\u7ef4\u5de5\u4f5c\uff0c \u5e76\u4e14Kubernetes 1.24\u4ee5\u4e0a\u7248\u672c\u4e0d\u518d\u76f4\u63a5\u652f\u6301Docker\u3002</p> <p>\u4f46\u662f\u4f5c\u4e3a\u4e00\u540dKubernetes\u7ba1\u7406\u4eba\u5458\u6216\u8005DevOps\u5de5\u7a0b\u5e08\uff0c \u5b66\u4e60Docker\u57fa\u7840\u77e5\u8bc6\u548cDocker\u955c\u50cf\u7684\u5236\u4f5c\u548c\u4f18\u5316\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u9879\u5de5\u4f5c\uff0c\u80fd\u591f\u8ba9\u6211\u4eec\u66f4\u597d\u5730\u7ba1\u7406\u548c\u8fd0\u7ef4Kubernetes\u4ee5\u53ca\u66f4\u597d\u5730\u5b9e\u73b0\u540e\u671f\u7684CICD\uff08\u6301\u7eed\u96c6\u6210/\u6301\u7eed\u90e8\u7f72\uff09\u5236\u4f5c\u4e00\u4e2a\u7b26\u5408\u751f\u4ea7\u73af\u5883\u7684\u955c\u50cf\u3002\u672c\u7ae0\u5c06\u5e26\u9886\u8bfb\u8005\u8ba4\u8bc6\u548c\u5b66\u4e60Docker\u7684\u57fa\u7840\u4ee5\u53ca\u540e\u671fDocker\u955c\u50cf\u7684\u5236\u4f5c\u548c\u4f18\u5316\u3002</p> <p>\u4f46\u662f\u4f5c\u4e3a\u4e00\u540dKubernetes\u7ba1\u7406\u4eba\u5458\u6216\u8005DevOps\u5de5\u7a0b\u5e08\uff0c\u5b66\u4e60Docker\u57fa\u7840\u77e5\u8bc6\u548cDocker\u955c\u50cf\u7684\u5236\u4f5c\u548c\u4f18\u5316\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u9879\u5de5\u4f5c\uff0c\u80fd\u591f\u8ba9\u6211\u4eec\u66f4\u597d\u5730\u7ba1\u7406\u548c\u8fd0\u7ef4Kubernetes\u4ee5\u53ca\u66f4\u597d\u5730\u5b9e\u73b0\u540e\u671f\u7684CICD\uff08\u6301\u7eed\u96c6\u6210/\u6301\u7eed\u90e8\u7f72\uff09\u5236\u4f5c\u4e00\u4e2a\u7b26\u5408\u751f\u4ea7\u73af\u5883\u7684\u955c\u50cf\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#1-docker\u4ecb\u7ecd","title":"1. Docker\u4ecb\u7ecd","text":"<p>Docker\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u8f6f\u4ef6\u9879\u76ee\uff0c\u8ba9\u6280\u672f\u4eba\u5458\u53ef\u4ee5\u6253\u5305\u4ed6\u4eec\u7684\u5e94\u7528\u53ca\u5176\u4f9d\u8d56\u5305\u5230\u4e00\u4e2a\u53ef\u79fb\u690d\u7684\u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u53d1\u5e03\u5230\u4efb\u4f55\u6d41\u884c\u7684Linux\u673a\u5668\u4e0a\u3002\u5728Linux\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0cDocker\u63d0\u4f9b\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u8f6f\u4ef6\u62bd\u8c61\u5c42\u53ca\u64cd\u4f5c\u7cfb\u7edf\u5c42\u865a\u62df\u5316\u7684\u81ea\u52a8\u7ba1\u7406\u673a\u5236\u3002</p> <p>Docker\u8fd0\u884c\u540d\u4e3a\"Container(\u5bb9\u5668)\"\u7684\u8f6f\u4ef6\u5305\uff0c\u5bb9\u5668\u4e4b\u95f4\u5f7c\u6b64\u9694\u79bb\uff0c\u5e76\u6346\u7ed1\u4e86\u81ea\u5df1\u7684\u5e94\u7528\u7a0b\u5e8f\u3001\u5de5\u5177\u3001\u5e93\u548c\u914d\u7f6e\u6587\u4ef6\u3002\u6240\u6709\u5bb9\u5668\u90fd\u7531\u5355\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u8fd0\u884c\uff0c\u56e0\u6b64\u6bd4\u865a\u62df\u673a\u66f4\u8f7b\u91cf\u7ea7\u3002</p> <p>Docker\u5229\u7528Linux\u8d44\u6e90\u5206\u79bb\u673a\u5236\uff08\u4f8b\u5982Cgroups\u53caLinux Namespace\uff09\u6765\u521b\u5efa\u76f8\u4e92\u72ec\u7acb\u7684\u5bb9\u5668\uff08Container\uff09\u3002\u53ef\u4ee5\u5728\u5355\u4e2aLinux\u5b9e\u4f53\u4e0b\u8fd0\u884c\uff0c\u907f\u514d\u4e86\u542f\u52a8\u4e00\u4e2a\u865a\u62df\u673a\u9020\u6210\u7684\u989d\u5916\u8d1f\u62c5\u3002Linux\u6838\u5fc3\u5bf9Namespace\uff08\u547d\u540d\u7a7a\u95f4\uff09\u7684\u652f\u6301\u5b8c\u5168\u9694\u79bb\u4e86\u4e0d\u540cNamespace\u4e0b\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u201c\u89c6\u91ce\u201d\uff08\u5373\u4f5c\u7528\u8303\u56f4\uff09\uff0c\u5305\u62ec\u8fdb\u7a0b\u6811\u3001\u7f51\u7edc\u3001\u7528\u6237ID\u4e0e\u6302\u8f7d\u7684\u6587\u4ef6\u7cfb\u7edf\u7b49\uff0c\u800c\u6838\u5fc3Cgroups\u5219\u63d0\u4f9b\u4e86\u8d44\u6e90\u9694\u79bb\uff0c\u5305\u62ecCPU\u3001\u5b58\u50a8\u5668\u3001Block I/O\u4e0e\u7f51\u7edc\u3002</p> <p>Docker\u5728\u903b\u8f91\u4e0a\u5206\u4e3a\u5982\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>Docker Client\uff1aDocker\u5ba2\u6237\u7aef\uff0c\u7528\u4e8e\u6267\u884cDocker\u7684\u76f8\u5173\u547d\u4ee4\uff0c\u6bd4\u5982\u955c\u50cf\u4e0b\u8f7d\u3002</li> <li>Docker Daemon\uff1aDocker\u5b88\u62a4\u8fdb\u7a0b\uff0c\u8fd0\u884c\u5728\u670d\u52a1\u5668\u6216\u8005\u5176\u4ed6\u5de5\u4f5c\u7ad9\u4e0a\u3002</li> <li>Docker Image\uff1aDocker\u955c\u50cf\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u6a21\u677f\uff0c\u53ef\u4ee5\u7528\u6765\u542f\u52a8\u5bb9\u5668\u3002</li> <li>Docker Container\uff1aDocker\u5bb9\u5668\uff0c\u7531\u955c\u50cf\u542f\u52a8\uff0c\u5bb9\u5668\u5185\u8fd0\u884c\u7740\u76f8\u5173\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</li> </ul> <p>\u901a\u4fd7\u6765\u8bb2\uff0cDocker\u7684\u8bbe\u8ba1\u7406\u5ff5\u6765\u81ea\u4e8e\u96c6\u88c5\u7bb1\uff0c\u53ef\u4ee5\u5c06\u4e0d\u540c\u7c7b\u578b\u7684\u8d27\u7269\u88c5\u5728\u4e0d\u540c\u7684\u73af\u5883\u4e2d\uff0c\u6bd4\u5982\u4e00\u4e9b\u9700\u8981\u4f4e\u6e29\u73af\u5883\u8fd0\u9001\u7684\u8d27\u7269\u9700\u8981\u88c5\u5728\u6709\u201c\u51b0\u5757\u201d\u7684\u96c6\u88c5\u7bb1\u4e2d\uff0c\u6bd4\u8f83\u5371\u9669\u7684\u5316\u5b66\u7269\u54c1\u9700\u8981\u88c5\u5728\u4e00\u4e9b\u7279\u5236\u7684\u96c6\u88c5\u7bb1\u4e2d\u8fd0\u9001\u3002</p> <p>\u76f8\u540c\u7684\u9053\u7406\uff0c\u5728\u4e00\u4e2a\u4f01\u4e1a\u5185\u90e8\uff0c\u4e00\u4e2a\u7cfb\u7edf\u53ef\u80fd\u4f1a\u6d89\u53ca\u4e0d\u540c\u7684\u73af\u5883\u548c\u4e0d\u540c\u7684\u4ee3\u7801\u8bed\u8a00\uff0c\u6bd4\u5982Java\u5e94\u7528\u7a0b\u5e8f\u9700\u8981JRE\u4f5c\u4e3a\u57fa\u7840\u73af\u5883\uff0cNodeJS\u5e94\u7528\u9700\u8981Node\u4f5c\u4e3a\u57fa\u7840\u73af\u5883\uff0c\u8fd8\u6709\u53ef\u80fd\u4e00\u4e9b\u5e94\u7528\u9700\u8981Ubuntu\u7cfb\u7edf\uff0c\u800c\u53e6\u4e00\u4e9b\u5e94\u7528\u9700\u8981CentOS\u7cfb\u7edf\uff0c\u90a3\u4e48\u6211\u4eec\u4f7f\u7528Docker\u65f6\u53ea\u8981\u5c06\u4f9d\u8d56\u7684\u7cfb\u7edf\u73af\u5883\u548c\u5f00\u53d1\u73af\u5883\u505a\u6210\u4e00\u4e2a\u201c\u96c6\u88c5\u7bb1\u201d\uff0c\u7136\u540e\u628a\u5e94\u7528\u653e\u8fdb\u8fd9\u4e2a\u201c\u96c6\u88c5\u7bb1\u201d\uff0c\u5373\u53ef\u628a\u6211\u4eec\u7684\u5e94\u7528\u201c\u8dd1\u201d\u8d77\u6765\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#2-docker\u5b89\u88c5","title":"2. Docker\u5b89\u88c5","text":"<p>\u5728\u5b66\u4e60\u4f7f\u7528Docker\u547d\u4ee4\u4e4b\u524d\uff0c\u9700\u8981\u5148\u627e\u4e00\u53f0\u670d\u52a1\u5668\u5b89\u88c5Docker\u3002 \u5982\u679c\u8bfb\u8005\u5728\u5b89\u88c5Kubernetes\u65f6\u5df2\u7ecf\u5b89\u88c5\u4e86Docker\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u6765\u5b66\u4e60\u4f7f\u7528\uff0c\u6216\u8005\u53c2\u8003\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u5b89\u88c5\uff08\u4ee5CentOS 7\u4e3a\u4f8b\uff09\uff1a</p> <pre><code>$ sudo yum update\n$ sudo yum install -y yum-utils \\\ndevice-mapper-persistent-data \\\nlvm2\n\n# \u6dfb\u52a0Docker\u7a33\u5b9a\u7248\u672c\u7684yum\u8f6f\u4ef6\u6e90\uff1a\n$ sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n$ sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo\n\n# \u4e4b\u540e\u66f4\u65b0yum\u8f6f\u4ef6\u6e90\u7f13\u5b58\uff0c\u5e76\u5b89\u88c5Docker\uff1a\n$ sudo yum update\n$ sudo yum install -y docker-ce-20.10.* docker-ce-cli-20.10.*\n\n#\u5b89\u88c5\u4e4b\u540e\u542f\u52a8 Docker \u670d\u52a1\uff0c\u5e76\u8ba9\u5b83\u968f\u7cfb\u7edf\u542f\u52a8\u81ea\u52a8\u52a0\u8f7d\u3002\n$ sudo systemctl daemon-reload &amp;&amp;  sudo systemctl start docker\n$ sudo systemctl enable docker.service --now docker\n</code></pre> <p>\u5176\u4ed6\u5b89\u88c5\u65b9\u5f0f\u53ef\u4ee5\u53c2\u8003Docker\u5b98\u65b9\u6587\u6863\uff1ahttps://docker.io/\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#21-docker\u5b89\u88c5","title":"2.1 docker\u5b89\u88c5","text":"<p>docker\u5b89\u88c5</p> <pre><code>$ apt-get update\n$ apt-get install -y apt-transport-https ca-certificates curl gnupg2 software-properties-common vim git\n$ wget wget https://download.docker.com/linux/static/stable/x86_64/docker-23.0.4.tgz\n$ tar zxf docker-23.0.4.tgz\n$ cp docker/* /usr/bin\n$ cat &gt;/etc/systemd/system/docker.service &lt;&lt;EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service\nWants=network-online.target\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd\nExecReload=/bin/kill -s HUP $MAINPID\nLimitNOFILE=infinity\nLimitNPROC=infinity\nTimeoutStartSec=0\nDelegate=yes\nKillMode=process\nRestart=on-failure\nStartLimitBurst=3\nStartLimitInterval=60s\n[Install]\nWantedBy=multi-user.target\nEOF\n# \u589e\u52a0\u53ef\u6267\u884c\u6743\u9650\n$ sudo chmod +x /etc/systemd/system/docker.service\n# \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\n$ sudo systemctl daemon-reload\n\n# \u542f\u52a8\u5bb9\u5668\u548c\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\n$ sudo systemctl enable --now docker.service\n# \u67e5\u770b\u72b6\u6001\n$ sudo systemctl status docker\n\n$ docker version\n# \u914d\u7f6e\u955c\u50cf\u52a0\u901f\u5668\n$ cat &gt; /etc/docker/daemon.json &lt;&lt;'EOF'\n{\n  \"data-root\": \"/data/docker\",\n  \"storage-driver\": \"overlay2\",\n  \"insecure-registries\": [\"hub.gitee.com\"],\n  \"registry-mirrors\": [\"https://25bxwt20.mirror.aliyuncs.com\"],\n  \"live-restore\": true,\n  \"bip\": \"172.16.200.1/24\",\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"hosts\": [\"tcp://0.0.0.0:2375\", \"unix:///var/run/docker.sock\"],\n  \"log-opts\": {\n    \"max-size\":\"100M\",\n    \"max-file\":\"3\"\n  }\n}\nEOF\n# docker\u4e2d\u542f\u7528buildx\n$ mkdir -pv ~/.docker/cli-plugins/\n$ wget -O ~/.docker/cli-plugins/docker-buildx \\\nhttps://github.com/docker/buildx/releases/download/v0.10.0/buildx-v0.10.0.linux-amd64\n\n$ chmod a+x ~/.docker/cli-plugins/docker-buildx # \u8bbe\u7f6e experimental \u53c2\u6570\n$ vim ~/.docker/config.json\n# \u6dfb\u52a0\n{\n\"auths\": {\n\"hub.gitee.com\": {\n\"auth\": \"xxxxxxx\"\n}\n},\n        \"aliases\": {\n\"builder\": \"buildx\"\n}\n}\n# \u5982\u679c\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e0a\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf DOCKER_CLI_EXPERIMENTAL \u4e0d\u751f\u6548\uff08\u6bd4\u5982 Arch Linux\uff09,\u4f60\u53ef\u4ee5\u9009\u62e9\u4ece\u6e90\u4ee3\u7801\u7f16\u8bd1\uff1a\n$ export DOCKER_BUILDKIT=1\n$ docker build --platform=local -o . git://github.com/docker/buildx\n$ mkdir -p ~/.docker/cli-plugins &amp;&amp; mv buildx ~/.docker/cli-plugins/docker-buildx\n\n$ systemctl restart docker\n\n$ docker buildx ls\nNAME/NODE DRIVER/ENDPOINT STATUS  BUILDKIT PLATFORMS\ndefault * docker\n  default default         running 23.0.4   linux/amd64, linux/amd64/v2, linux/amd64/v3, linux/amd64/v4, linux/386\n\n$ apt-get install -y bash-completion\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#22-dockerfile\u4ed3\u5e93","title":"2.2 dockerfile\u4ed3\u5e93","text":"<ul> <li>https://github.com/dockerfile/</li> <li>https://gitee.com/gaork/dockerfiles</li> <li>https://gitee.com/single_yang/Dockerfile</li> <li>https://github.com/orgs/docker-library/repositories</li> <li>https://github.com.cnpmjs.org/HariSekhon/Dockerfiles.git</li> <li>https://github.com.cnpmjs.org/CentOS/CentOS-Dockerfiles.git</li> <li>https://github.com.cnpmjs.org/ericsysmin/docker-ansible-images.git</li> </ul>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#23-docker-compose-v1\u5b89\u88c5","title":"2.3 docker-compose v1\u5b89\u88c5","text":"<pre><code>$ sudo curl -L https://get.daocloud.io/docker/compose/releases/download/v2.4.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose\n\n$ sudo chmod +x /usr/local/bin/docker-compose\n$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\n$ docker-compose version\nDocker Compose version v2.4.1\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#24-docker-compose-v2\u5b89\u88c5","title":"2.4 docker-compose v2\u5b89\u88c5","text":"<p>\u76ee\u524dDocker\u5b98\u65b9\u7528GO\u8bed\u8a00\u91cd\u5199\u4e86Docker Compose\uff0c</p> <p>\u5e76\u5c06\u5176\u4f5c\u4e3a\u4e86docker cli\u7684\u5b50\u547d\u4ee4\uff0c\u79f0\u4e3a<code>Compose V2</code>\u3002</p> <p>\u4f60\u53ef\u4ee5\u53c2\u7167\u5b98\u65b9\u6587\u6863\u5b89\u88c5\uff0c\u7136\u540e\u5c06\u719f\u6089\u7684<code>docker-compose</code> \u547d\u4ee4\u66ff\u6362\u4e3a<code>docker compose</code>\uff0c\u5373\u53ef\u4f7f\u7528Docker Compose\u3002</p> <p>\u4ed3\u5e93\u5730\u5740\uff1a https://github.com/docker/compose/releases</p> <p>\u6587\u6863\u5730\u5740\uff1a https://docs.docker.com/compose/install/linux/</p> <ol> <li> <p>\u7b2c\u4e00\u6b65\u4e0b\u8f7d \u53ef\u4ee5\u4ece\u4e0b\u9762\u9875\u4e0b\u8f7d\u7a33\u5b9a\u7248 docker-compose-linux-x86_64</p> </li> <li> <p>\u4e0a\u4f20\u5230 /usr/local/lib/docker/cli-plugins/ \u76ee\u5f55\u4e0b \u5e76\u4e14\u4fee\u6539 docker-compose-linux-x86_64 \u6587\u4ef6\u540d\u4e3a docker-compose</p> </li> </ol> <pre><code># 1\u3001\u4ece\u9879\u76ee\u53d1\u5e03\u9875\u9762\u4e0b\u8f7d\u9002\u5408\u4f60\u7684\u7cfb\u7edf\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u590d\u5236\u5230$HOME/.docker/cli-plugins\uff0c\u4f5c\u4e3adocker-compose\u6765\u5b89\u88c5Compose V2\n#\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u4e0b\u8f7dDocker Compose\u7684\u5f53\u524d\u7a33\u5b9a\u7248\u672c\n# \u8be5\u547d\u4ee4\u4e3a$HOME\u76ee\u5f55\u4e0b\u7684\u7528\u6237\u5b89\u88c5Compose V2\u3002\n$ mkdir -p ~/.docker/cli-plugins/\n$ curl -SL https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o ~/.docker/cli-plugins/docker-compose\n$ chmod +x ~/.docker/cli-plugins/docker-compose\n\n#\u4e3a\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u7528\u6237\u5b89\u88c5Docker Compose\n$ mkdir -p /usr/local/lib/docker/cli-plugins\n$ curl -SL https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o /usr/local/lib/docker/cli-plugins/docker-compose\n$ chmod +x /usr/local/lib/docker/cli-plugins/docker-compose\n\n# \u8bbe\u7f6edocker-compose\u547d\u4ee4\u517c\u5bb9v1\n$ sudo ln -s  /usr/local/lib/docker/cli-plugins/docker-compose /usr/local/bin/docker-compose\n\n# 3\u3001\u6d4b\u8bd5\u5b89\u88c5\n$ docker compose version\nDocker Compose version v2.16.0\n\n$ docker-compose version\nDocker Compose version v2.16.0\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#25-docker-compose\u5feb\u901f\u5165\u95e8","title":"2.5 docker-compose\u5feb\u901f\u5165\u95e8","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.runoob.com/docker/docker-compose.html</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#26-awesome-compose","title":"2.6 awesome-compose","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://github.com/docker/awesome-compose</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#3-docker\u57fa\u672c\u547d\u4ee4","title":"3. Docker\u57fa\u672c\u547d\u4ee4","text":"<p>\u67e5\u770bDocker\u7248\u672c\uff0c\u5305\u62ecDocker\u7248\u672c\u53f7\u3001API\u7248\u672c\u53f7\u3001\u5bf9\u5e94\u7684Git Commit\u3001Containerd\u548crunC\u7684\u7248\u672c\u4fe1\u606f\u7b49\u3002</p> <pre><code># \u67e5\u770bDocker\u7248\u672c\ndocker version\n\n# \u67e5\u770bDocker\u8be6\u7ec6\u4fe1\u606f\ndocker info\n\n# \u955c\u50cf\u641c\u7d22\ndocker search nginx\n\n# \u62c9\u53d6/\u4e0b\u8f7d\u955c\u50cf\uff0c\u9ed8\u8ba4\u662fhub.docker.com\uff08docker.io\uff09\u4e0a\u9762\u7684\u955c\u50cf\uff0c\n# \u5982\u679c\u62c9\u53d6\u516c\u53f8\u5185\u90e8\u7684\u955c\u50cf\u6216\u8005\u5176\u4ed6\u4ed3\u5e93\u4e0a\u7684\u955c\u50cf\uff0c\u9700\u8981\u5728\u955c\u50cf\u524d\u9762\u52a0\u4e0a\u4ed3\u5e93\u7684URL\uff0c\u4f8b\u5982\uff1a\ndocker pull harbor.xxx.net/frontend:v1\n\n# \u62c9\u53d6\u516c\u7f51\u4e0a\u7684Nginx\u955c\u50cf\uff1a\n# \u628a\u516c\u7f51\u4e0a\u7684\u955c\u50cf\u62c9\u53d6\u5230\u672c\u5730\u670d\u52a1\u5668\uff0c\u4e0d\u6307\u5b9a\u7248\u672c\u53f7\u4e3alatest\ndocker pull nginx\n#Using default tag: latest\n#latest: Pulling from library/nginx\n#Digest: sha256:b543f6d0983fbc25b9874e22f4fe257a567111da96fd1d8f1b44315f1236398c\n#Status: Image is up to date for nginx:latest\n\n#\u62c9\u53d6\u6307\u5b9a\u7248\u672c\ndocker pull nginx:1.15\n#1.15: Pulling from library/nginx\n#Digest: sha256:b543f6d0983fbc25b9874e22f4fe257a567111da96fd1d8f1b44315f1236398c\n#Status: Downloaded newer image for nginx:1.15\n\n\u628a\u672c\u5730\u7684\u955c\u50cf\u63a8\u9001\u5230\u516c\u7f51\u4ed3\u5e93\u4e2d\uff0c\u6216\u8005\u516c\u53f8\u5185\u90e8\u7684\u4ed3\u5e93\u4e2d\u3002\u9ed8\u8ba4\u767b\u5f55\u548c\u63a8\u9001\u7684\u662f\u516c\u7f51\u7684\u955c\u50cf\uff0c\u5982\u679c\u9700\u8981\u63a8\u9001\u5230\u516c\u53f8\u4ed3\u5e93\u6216\u8005\u5176\u4ed6\u4ed3\u5e93\uff0c\u53ea\u9700\u8981\u5728\u955c\u50cf\u524d\u9762\u4f7f\u7528tag\u5e76\u52a0\u4e0aURL\u5373\u53ef\uff1a\n\n# \u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u7ed9\u4e00\u4e2a\u4e1a\u52a1\u5bb9\u5668\u8fdb\u884c\u6d4b\u8bd5\u6216\u8005\u8fdb\u884c\u67d0\u4e2a\u8c03\u8bd5\uff0c\u53ef\u4ee5\u4f7f\u7528run -ti\u5728\u524d\u53f0\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff1a\ndocker run -ti nginx bash\nroot@23bc7ccabb09:/#\n# \u4e5f\u53ef\u4ee5\u4f7f\u7528-ti --rm\u53c2\u6570\uff0c\u8868\u793a\u524d\u53f0\u542f\u52a8\u7684\u5bb9\u5668\u9000\u51fa\u540e\u5373\u5220\u9664\n\n# \u5982\u679c\u4e00\u4e2a\u955c\u50cf\u9700\u8981\u4e00\u76f4\u8fd0\u884c\uff0c\u53ef\u4ee5\u4f7f\u7528-d\u8fdb\u884c\u540e\u53f0\u542f\u52a8\uff1a\ndocker run -tid nginx bash\n1bcf5154d5c3a57d92a6796f526eac2cefd962aaca9cf4098689bfe830bb9e5e\n# \u4e5f\u53ef\u4ee5\u4f7f\u7528--restart=always\uff0c\u5982\u679c\u5bb9\u5668\u5f02\u5e38\u81ea\u52a8\u91cd\u542f\n\n# \u5982\u679c\u9700\u8981\u901a\u8fc7\u670d\u52a1\u5668\u7684IP+\u7aef\u53e3\u8bbf\u95ee\u5bb9\u5668\u7684\u5185\u90e8\u5e94\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528-p\u8fdb\u884c\u7aef\u53e3\u6620\u5c04\uff0c\u5c06\u672c\u673a\u7684\u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684\u7aef\u53e3\uff0c\n## \u6bd4\u5982\u5c06\u672c\u673a\u76841111\u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u768480\u7aef\u53e3\uff1a\ndocker run -ti -p 1111:80 nginx bash\nroot@cd676d572188:/#\n\n# \u5982\u679c\u9700\u8981\u6302\u8f7d\u4e00\u4e2a\u672c\u5730\u7684\u76ee\u5f55\u5230\u5bb9\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528-v\u53c2\u6570\u8fdb\u884c\u6302\u8f7d\uff0c\u6bd4\u5982\u5c06hosts\u6587\u4ef6\u6302\u8f7d\u5230\u5bb9\u5668\u7684hosts\uff1a\ndocker run -ti -p 1111:80 -v /etc/hosts:/etc/hosts  nginx bash\nroot@cd676d572188:/#\n\n# \u67e5\u770b\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\uff1a\ndocker ps\n\n# \u67e5\u770b\u6240\u6709\u5bb9\u5668\uff0c\u5305\u62ec\u5df2\u7ecf\u9000\u51fa\u7684\uff1a\ndocker ps -a\n\n# \u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\uff08\u5373\u663e\u793a\u51fa\u5bb9\u5668\u7684ID\uff09\uff1a\ndocker ps -q\n\n# \u67e5\u770b\u6240\u6709\u5bb9\u5668\u7684ID\uff0c\u5305\u62ec\u5df2\u7ecf\u9000\u51fa\u7684\uff1a\ndocker ps -aq\n\n# \u8fdb\u5165\u4e00\u4e2a\u540e\u53f0\u8fd0\u884c\u7684\u5bb9\u5668\uff08\u5373\u4e4b\u524d\u7528-d\u547d\u4ee4\u53c2\u6570\u6307\u5b9a\u540e\u53f0\u8fd0\u884c\u65b9\u5f0f\u7684\u5bb9\u5668\uff09\uff1a\ndocker ps | tail -1\nb3525f505a9b   hub.gitee.cc/gitee_ci/gitaly:20201224              \"/bin/bash /home/git\u2026\"   20 months ago   Up 4 months             0.0.0.0:9236-&gt;9236/tcp, :::9236-&gt;9236/tcp, 0.0.0.0:9999-&gt;9999/tcp, :::9999-&gt;9999/tcp, 0.0.0.0:30022-&gt;22/tcp, :::30022-&gt;22/tcp   gitaly_gitaly_1\n\ndocker exec -it b3525f505a9b bash\nroot@b3525f505a9b:/home/git/gitaly#\n\n# \u5c06\u672c\u673a\u7684\u6587\u4ef6\u590d\u5236\u5230\u5bb9\u5668\uff0c\u590d\u5236\u652f\u6301\u53cc\u5411\u590d\u5236\uff0c\u4e5f\u652f\u6301\u5c06\u5bb9\u5668\u7684\u5185\u90e8\u6587\u4ef6\u590d\u5236\u5230\u5bbf\u4e3b\u673a\uff1a\ndocker cp README.md 92aceec0dcdd327a709bf0ec83:/tmp\n\n# exec\u4e5f\u53ef\u76f4\u63a5\u6267\u884c\u5bb9\u5668\u547d\u4ee4\ndocker exec 92aceec0dcdd327a709bf0ec83 ls /tmp/\nREADME.md\n\n# \u5220\u9664\u5df2\u7ecf\u9000\u51fa\u7684\u5bb9\u5668\uff1a\n# \u67e5\u770bExited\u5bb9\u5668\ndocker ps -a |grep Exited | tail -3\ncec7e3e9a4a3        0622fce024a9                       \"/bin/bash\"              2 weeks ago         Exited (0) 2 weeks ago                                                      practical_wright\n\ndocker rm cec7e3e9a4a3\n# \u518d\u6b21\u67e5\u770bExited\u5bb9\u5668\ndocker ps -a |grep Exited | tail -3\n\n# \u5220\u9664\u672c\u673a\u955c\u50cf\uff0c\u6bd4\u5982\u5220\u9664REPOSITORY\u6216TAG\u4e3anone\u7684\u955c\u50cf\uff1a\ndocker images |grep none\nregistry.baidubce.com/gitee-prod-new/helm-deploy-public                    &lt;none&gt;                      6320f1d0fb26        2 weeks ago         256MB\n\ndocker rmi 6320f1d0fb26\nUntagged: registry.baidubce.com/gitee-prod-new/helm-deploy-public@sha256:881cf8508e85f1efb1700bcc809ff702d8021020e5821cce5c53151ec20e800a\nDeleted: sha256:6320f1d0fb26f8fd59585d927f57a3aad8dd893787b6b0ef79f15c925f80677c\nDeleted: sha256:68f54a4d5fb2478062a46b26195971edc7d0dd2157ab799b01ba3401fb333468\nDeleted: sha256:dc5c8bc75bbb0e3dd768e5f96f4015de9511b4f3bc66c0d76c5afa7248e6882e\nDeleted: sha256:7d98184ca9d9d3c1a5b29792561e2f1e50a720a9171584b3ce10fd53a1ec55dc\nDeleted: sha256:74754500cc1438e2627238f6e6b838fe56e6d314fb0122c9480fde1f1e51de01\n\n# \u533a\u5206\u955c\u50cf\u7684\u7248\u672c\u53ef\u4ee5\u4f7f\u7528tag\u547d\u4ee4\u7ed9\u955c\u50cf\u6253\u6807\u7b7e\uff1a\n## \u5c06\u955c\u50cfubuntu:15.10\u6807\u8bb0\u4e3a runoob/ubuntu:v3 \u955c\u50cf\u3002\nroot@runoob:~# docker tag ubuntu:15.10 runoob/ubuntu:v3\nroot@runoob:~# docker images  runoob/ubuntu:v3\n\n# \u4f7f\u7528docker build\u901a\u8fc7Dockerfile\u5236\u4f5c\u955c\u50cf\u3002\u6ce8\u610f\u6700\u540e\u7684\u4e00\u4e2a\u70b9\uff08.\uff09\uff0c\u8868\u793a\u4f7f\u7528\u5f53\u524d\u76ee\u5f55\u6784\u5efa\u955c\u50cf\uff1a\n\n## \u4f7f\u7528\u5f53\u524d\u76ee\u5f55\u7684 Dockerfile \u521b\u5efa\u955c\u50cf\uff0c\u6807\u7b7e\u4e3a runoob/ubuntu:v1\u3002\ndocker build -t runoob/ubuntu:v1 .\n\n## \u4f7f\u7528URL github.com/creack/docker-firefox \u7684 Dockerfile \u521b\u5efa\u955c\u50cf\u3002\ndocker build github.com/creack/docker-firefox\n\n## \u4e5f\u53ef\u4ee5\u901a\u8fc7 -f Dockerfile \u6587\u4ef6\u7684\u4f4d\u7f6e\uff1a\n$ docker build -f /path/to/a/Dockerfile .\n\n##\u5728 Docker \u5b88\u62a4\u8fdb\u7a0b\u6267\u884c Dockerfile \u4e2d\u7684\u6307\u4ee4\u524d\uff0c\u9996\u5148\u4f1a\u5bf9 Dockerfile \u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\uff0c\u6709\u8bed\u6cd5\u9519\u8bef\u65f6\u4f1a\u8fd4\u56de\uff1a\n$ docker build -t test/myapp .\nSending build context to Docker daemon 2.048 kB\nError response from daemon: Unknown instruction: RUNCMD\n\n# \u53ef\u4ee5\u4f7f\u7528docker logs\u67e5\u770b\u5bb9\u5668\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u7684\u65e5\u5fd7\uff08\u7a0b\u5e8f\u65e5\u5fd7\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u662f\u5bb9\u5668\u5316\u7684\u6700\u4f73\u5b9e\u8df5\uff09\uff1a\n\n## \u8ddf\u8e2a\u67e5\u770b\u5bb9\u5668mynginx\u7684\u65e5\u5fd7\u8f93\u51fa\u3002\nrunoob@runoob:~$ docker logs -f mynginx\n192.168.239.1 - - [10/Jul/2016:16:53:33 +0000] \"GET / HTTP/1.1\" 200 612 \"-\" \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.93 Safari/537.36\" \"-\"\n...\n\n## \u67e5\u770b\u5bb9\u5668mynginx\u4ece2016\u5e747\u67081\u65e5\u540e\u7684\u6700\u65b010\u6761\u65e5\u5fd7\u3002\ndocker logs --since=\"2016-07-01\" --tail=10 mynginx\n\n# \u53ef\u4ee5\u4f7f\u7528docker inspect \u83b7\u53d6\u5bb9\u5668/\u955c\u50cf\u7684\u5143\u6570\u636e\u3002\n\n## \u6bd4\u5982\u67e5\u770b\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u7684\u7aef\u53e3\u4fe1\u606f\uff1a\nrunoob@runoob:~$ docker inspect mysql:5.6 |  grep Port\n\n## \u83b7\u53d6\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668mymysql\u7684 IP\u3002\nrunoob@runoob:~$ docker inspect --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' mymysql\n172.17.0.3\n\n## \u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528docker history\u67e5\u770b\u4e00\u4e2a\u955c\u50cf\u7684\u6784\u5efa\u4fe1\u606f\uff1a\nrunoob@runoob:~$ docker history 6320f1d0fb26\n</code></pre> <p>\u4e0a\u8ff0\u6f14\u793a\u7684\u90fd\u662fDocker\u5e38\u7528\u7684\u57fa\u672c\u547d\u4ee4\uff0c\u5df2\u53ef\u4ee5\u6ee1\u8db3\u65e5\u5e38\u5de5\u4f5c\u9700\u6c42\uff0c\u5982\u679c\u8bfb\u8005\u60f3\u8981\u6df1\u5165\u4e86\u89e3\uff0c\u53ef\u4ee5\u53c2\u8003Docker\u7684\u76f8\u5173\u8d44\u6599\u6216\u4e66\u7c4d\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#4-dockerfile\u7684\u7f16\u5199","title":"4. Dockerfile\u7684\u7f16\u5199","text":"<p>Dockerfile\u662f\u7528\u6765\u5feb\u901f\u521b\u5efa\u81ea\u5b9a\u4e49\u955c\u50cf\u7684\u4e00\u79cd\u6587\u672c\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u6301\u7eed\u96c6\u6210\u548c\u6301\u7eed\u90e8\u7f72\u65f6\uff0c\u9700\u8981\u4f7f\u7528Dockerfile\u751f\u6210\u76f8\u5173\u5e94\u7528\u7a0b\u5e8f\u7684\u955c\u50cf\uff0c\u7136\u540e\u63a8\u9001\u5230\u516c\u53f8\u5185\u90e8\u4ed3\u5e93\u4e2d\uff0c\u518d\u901a\u8fc7\u90e8\u7f72\u7b56\u7565\u628a\u955c\u50cf\u90e8\u7f72\u5230Kubernetes\u4e2d\u3002</p> <p>\u672c\u8282\u5c06\u6f14\u793a\u5982\u4f55\u4f7f\u7528Dockerfile\u6784\u5efa\u81ea\u5df1\u7684\u4e1a\u52a1\u955c\u50cf\u3002</p> <p>\u901a\u8fc7Dockerfile\u63d0\u4f9b\u7684\u547d\u4ee4\u53ef\u4ee5\u7f16\u5199Dockerfile\u6587\u4ef6\uff0cDockerfile\u7684\u5e38\u7528\u547d\u4ee4\u5982\u4e0b\uff1a</p> <ul> <li>FROM\uff1a\u7ee7\u627f\u57fa\u7840\u955c\u50cf\u3002</li> <li>MAINTAINER\uff1a\u955c\u50cf\u5236\u4f5c\u4f5c\u8005\u7684\u4fe1\u606f\uff0c\u5df2\u5f03\u7528\uff0c\u4f7f\u7528LABEL\u66ff\u4ee3\u3002</li> <li>LABEL\uff1ak=v\u5f62\u5f0f\uff0c\u5c06\u4e00\u4e9b\u5143\u6570\u636e\u6dfb\u52a0\u81f3\u955c\u50cf\u3002</li> <li>RUN\uff1a\u7528\u6765\u6267\u884cshell\u547d\u4ee4\u3002</li> <li>EXPOSE\uff1a\u66b4\u9732\u7aef\u53e3\u53f7\u3002</li> <li>CMD\uff1a\u542f\u52a8\u5bb9\u5668\u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4\uff0c\u4f1a\u88ab\u8986\u76d6\u3002</li> <li>ENTRYPOINT\uff1a\u542f\u52a8\u5bb9\u5668\u771f\u6b63\u6267\u884c\u7684\u547d\u4ee4\uff0c\u4e0d\u4f1a\u88ab\u8986\u76d6\u3002</li> <li>VOLUME\uff1a\u521b\u5efa\u6302\u8f7d\u70b9\u3002</li> <li>ENV\uff1a\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u3002</li> <li>ADD\uff1a\u590d\u5236\u6587\u4ef6\u5230\u5bb9\u5668\uff0c\u4e00\u822c\u590d\u5236\u6587\u4ef6\uff0c\u538b\u7f29\u5305\u81ea\u52a8\u89e3\u538b\u3002</li> <li>COPY\uff1a\u590d\u5236\u6587\u4ef6\u5230\u5bb9\u5668\uff0c\u4e00\u822c\u590d\u5236\u76ee\u5f55\u3002</li> <li>WORKDIR\uff1a\u8bbe\u7f6e\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55\u3002</li> <li>USER\uff1a\u5bb9\u5668\u4f7f\u7528\u7684\u7528\u6237\u3002</li> <li>ARG\uff1a\u8bbe\u7f6e\u7f16\u8bd1\u955c\u50cf\u65f6\u4f20\u5165\u7684\u53c2\u6570\u3002</li> </ul> <p>\u4ee5\u4e0b\u7b80\u5355\u6f14\u793a\u6bcf\u4e2a\u547d\u4ee4\u7684\u4f7f\u7528\u65b9\u6cd5\u3002\u4f7f\u7528RUN\u521b\u5efa\u4e00\u4e2a\u7528\u6237\uff1a</p> <p><code>Dockerfile</code></p> <pre><code># base image\nFROM centos:7\nMAINTAINER dot\nRUN useradd dot\n</code></pre> <pre><code># \u6267\u884c\u6784\u5efa\n$ docker build -t centos:user .\n</code></pre> <p>\u4f7f\u7528ENV\u5b9a\u4e49\u73af\u5883\u53d8\u91cf\u5e76\u7528CMD\u6267\u884c\u547d\u4ee4\uff1a</p> <p><code>Dockerfile</code></p> <pre><code># base image\nFROM centos:7\nMAINTAINER dot\nRUN useradd dot\nRUN mkdir dot\nENV envir=test version=1.0\nCMD echo \"envir:$envir version:$version\"\n</code></pre> <p>\u6267\u884c\u6784\u5efa\u5e76\u542f\u52a8\u6d4b\u8bd5\uff1a</p> <pre><code># \u6267\u884c\u6784\u5efa\n$ docker build -t centos:env-cmd .\n\n# \u542f\u52a8\u955c\u50cf\u9a8c\u8bc1ENV\u548cCMD\n$ docker run centos:env-cmd\nenvir:test version:1.0\n</code></pre> <p>\u5f53\u7136\uff0c\u4e0a\u8ff0CMD\u5b9e\u73b0\u7684\u529f\u80fd\uff0c\u4f7f\u7528ENTRYPOINT\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u76f8\u540c\u7684\u6548\u679c\uff0c\u5bf9\u5e94\u7684Dockerfile\u5982\u4e0b\uff1a</p> <p><code>Dockerfile</code></p> <pre><code># base image\nFROM centos:7\nMAINTAINER dot\nRUN useradd dot\nRUN mkdir dot\nENV envir=test version=1.0\n#CMD echo \"envir:$envir version:$version\"\nENTRYPOINT echo \"envir:$envir version:$version\"\n</code></pre> <p>\u6267\u884c\u6784\u5efa\u5e76\u6d4b\u8bd5\uff1a</p> <pre><code>$ docker build -t centos:entrypoint .\n\n$ docker run --rm centos:entrypoint\nenvir:test version:1.0\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u65e0\u8bba\u662f\u4f7f\u7528CMD\u8fd8\u662fENTRYPOINT\u5b9e\u73b0\u7684\u6548\u679c\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90a3\u5b83\u4eec\u7684\u533a\u522b\u662f\u4ec0\u4e48\u5462\uff1f</p> <p>\u548c\u4e0a\u8ff0\u8bb2\u7684\u4e00\u6837\uff0cCMD\u5728\u4f7f\u7528docker run\u65f6\u53ef\u4ee5\u88ab\u76f4\u63a5\u8986\u76d6\uff0c\u6bd4\u5982\u6211\u4eec\u4f7f\u7528docker run\u542f\u52a8centos:env-cmd\u955c\u50cf\uff0c\u5e76\u5728\u540e\u9762\u6307\u5b9a\u542f\u52a8\u547d\u4ee4\uff0c\u6b64\u65f6CMD\u5c31\u4f1a\u88ab\u8986\u76d6\uff1a</p> <pre><code>$ docker run --rm centos:env-cmd echo \"cover...\"\ncover...\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u65b0\u7684echo\u547d\u4ee4\u8986\u76d6\u4e86CMD\u7684echo\u547d\u4ee4\uff0c\u800c\u5728ENTRYPOINT\u6307\u5b9a\u7684\u4e0d\u80fd\u88ab\u76f4\u63a5\u8986\u76d6\uff0c\u540e\u7f6e\u7684\u547d\u4ee4\u4f1a\u88ab\u5f53\u4f5cENTRYPOINT\u7684\u53c2\u6570\uff0c\u6bd4\u5982\u76f8\u540c\u7684\u542f\u52a8\u53c2\u6570\uff1a</p> <pre><code>$ docker run --rm centos:entrypoint cannot cover...\nenvir:test version:1.0\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6253\u5370\u7684\u8fd8\u662fENTRYPOINT\u4e2d\u7684\u4fe1\u606f\uff0c\u5f53\u7136ENTRYPOINT\u4e5f\u662f\u53ef\u4ee5\u88ab\u8986\u76d6\u7684\uff0c</p> <p>\u9700\u8981\u6307\u5b9a--entrypoint\u53c2\u6570\uff0c\u6bd4\u5982\u6211\u4eec\u6307\u5b9aentrypoint\u4e3als\uff0c\u540e\u7f6e\u547d\u4ee4\u4e3a/tmp\uff0c\u5c31\u76f8\u5f53\u4e8eENTRYPOINT\u662fls\uff0cCMD\u662f/tmp\uff1a</p> <pre><code>$ docker run --rm --entrypoint=ls  centos:entrypoint /tmp\nanaconda-post.log\nyum.log\n</code></pre> <p>\u4f7f\u7528ADD\u6dfb\u52a0\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u4f7f\u7528WORKDIR\u6539\u53d8\u5de5\u4f5c\u76ee\u5f55\uff1a</p> <p><code>Dockerfile</code></p> <pre><code># base image\nFROM nginx\nMAINTAINER dot\nADD ./index.tar.gz /usr/share/nginx/html/\nWORKDIR /usr/share/nginx/html\n</code></pre> <p>\u6ce8\u610f</p> <p>\u4f7f\u7528COPY\u548cADD\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528<code>--chown=&lt;user&gt;:&lt;group&gt;</code>\u76f4\u63a5\u8fdb\u884c\u6587\u4ef6\u6743\u9650\u7684\u66f4\u6539\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u4f7f\u7528RUN\u5728\u5bb9\u5668\u91cc\u9762\u6267\u884cchown\uff0c\u4e0d\u4ec5\u65b9\u4fbf\uff0c\u8fd8\u53ef\u4ee5\u7f29\u5c0f\u955c\u50cf\u7684\u4f53\u79ef\u3002</p> <p>\u4f7f\u7528USER\u8bbe\u7f6e\u542f\u52a8\u5bb9\u5668\u7684\u7528\u6237\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4e00\u822c\u4e0d\u5efa\u8bae\u4f7f\u7528root\u542f\u52a8\u5bb9\u5668\uff0c\u6240\u4ee5\u53ef\u4ee5\u6839\u636e\u516c\u53f8\u4e1a\u52a1\u573a\u666f\u81ea\u5b9a\u4e49\u542f\u52a8\u5bb9\u5668\u7684\u7528\u6237\uff1a</p> <pre><code># base image\nFROM centos:7\nMAINTAINER dot\nADD ./index.tar.gz /usr/share/nginx/html/\nWORKDIR /usr/share/nginx/html\nCOPY webroot/ .\nRUN useradd -m tomcat -u 1001\nUSER 1001\n</code></pre> <p>\u4f7f\u7528Volume\u521b\u5efa\u5bb9\u5668\u53ef\u6302\u8f7d\u70b9\uff1a</p> <pre><code># base image\nFROM centos:7\nMAINTAINER dot\nVOLUME /data\n</code></pre> <p>\u6302\u8f7dWeb\u76ee\u5f55\u5230/data\uff0c\u6ce8\u610f\u5bf9\u4e8e\u5bbf\u4e3b\u673aWeb\u76ee\u5f55\u8981\u5199\u7edd\u5bf9\u8def\u5f84\uff1a</p> <pre><code>$ docker build -t centos:volume .\n$ docker run -ti --rm -v `pwd`/web:/data centos:volume bash\n</code></pre> <p>\u4e0a\u8ff0\u6f14\u793a\u7684Dockerfile\u4f7f\u7528MAINTAINER\u5b9a\u4e49\u4e86\u4f5c\u8005\u4fe1\u606f\uff0c\u4f46\u662f\u8fd9\u4e2a\u53c2\u6570\u5c06\u6765\u4f1a\u88ab\u5f03\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528LABEL\u8fdb\u884c\u66ff\u6362\uff1a</p> <pre><code># base image\nFROM centos:7\n# MAINTAINER dot # \u5373\u5c06\u5e9f\u5f03\nLABEL maintainer=\"dot\" version=\"demo\"\nLABEL multiple=\"true\"\n</code></pre> <p>\u5236\u4f5c\u955c\u50cf\u5e76\u67e5\u770b\u955c\u50cf\u4fe1\u606f\uff1a</p> <pre><code>$ docker build -t test:label .\n$ docker inspect test:label|grep Labels -A 10\n\"Labels\": {\n\"maintainer\": \"dot\",\n                \"multiple\": \"true\",\n                \"org.label-schema.build-date\": \"20181006\",\n                \"org.label-schema.license\": \"GPLv2\",\n                \"org.label-schema.name\": \"CentOS Base Image\",\n                \"org.label-schema.schema-version\": \"1.0\",\n                \"org.label-schema.vendor\": \"CentOS\",\n                \"version\": \"demo\"\n}\n},\n--\n            \"Labels\": {\n\"maintainer\": \"dot\",\n                \"multiple\": \"true\",\n                \"org.label-schema.build-date\": \"20181006\",\n                \"org.label-schema.license\": \"GPLv2\",\n                \"org.label-schema.name\": \"CentOS Base Image\",\n                \"org.label-schema.schema-version\": \"1.0\",\n                \"org.label-schema.vendor\": \"CentOS\",\n                \"version\": \"demo\"\n}\n},\n</code></pre> <p>\u6709\u65f6\u5019\u53ef\u80fd\u9700\u8981\u52a8\u6001\u751f\u6210Dockerfile\uff0c\u53ef\u4ee5\u4f7f\u7528ARG\u548cbuild-arg\u4f20\u5165\u52a8\u6001\u53d8\u91cf\uff1a</p> <p><code>Dockerfile</code></p> <pre><code># base image\nFROM centos:7\n# MAINTAINER dot # \u5373\u5c06\u5e9f\u5f03\nLABEL maintainer=\"dot\" version=\"demo\"\nLABEL multiple=\"true\"\nARG USERNAME\nARG DIR=\"defaultValue\"\nRUN useradd -m $USERNAME -u 1001 &amp;&amp; mkdir $DIR\n</code></pre> <pre><code>$ docker build --build-arg USERNAME=\"hujianli\" -t test:arg .\n$ docker run -it --rm test:arg bash\n[root@e2ac1faeb945 /]# ls\nanaconda-post.log  bin  defaultValue  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n[root@e2ac1faeb945 /]# tail -1 /etc/passwd\nhujianli:x:1001:1001::/home/hujianli:/bin/bash\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#5-\u955c\u50cf\u5927\u5c0f\u4f18\u5316","title":"5. \u955c\u50cf\u5927\u5c0f\u4f18\u5316","text":"<p>\u4e0a\u8ff0\u4f7f\u7528Dockerfile\u521b\u5efa\u7684\u955c\u50cf\u90fd\u662f\u4f7f\u7528CentOS\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\uff0c\u4f7f\u7528CentOS\u76f4\u63a5\u4f5c\u4e3a\u4e1a\u52a1\u5e94\u7528\u5bb9\u5668\u7684\u57fa\u7840\u955c\u50cf\u662f\u975e\u5e38\u4e0d\u5efa\u8bae\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u505a\u51fa\u6765\u7684\u955c\u50cf\uff0c\u4e0d\u4ec5\u955c\u50cf\u7684\u4f53\u79ef\u6bd4\u8f83\u5927\uff0c\u800c\u4e14CentOS\u5b89\u88c5\u4e86\u5f88\u591a\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f\u7528\u4e0d\u5230\u7684\u5305\uff0c\u53ef\u80fd\u4f1a\u6709\u66f4\u591a\u7684\u6f0f\u6d1e\u548c\u98ce\u9669\u3002</p> <p>\u6f0f\u6d1e\u548c\u98ce\u9669\u53ef\u4ee5\u4f7f\u7528\u955c\u50cf\u4ed3\u5e93\u81ea\u5e26\u7684\u6f0f\u6d1e\u626b\u63cf\u68c0\u6d4b\u51fa\u6765\uff0c\u7136\u540e\u201c\u5bf9\u75c7\u4e0b\u836f\u201d\u5373\u53ef\u89e3\u51b3\uff0c\u800c\u955c\u50cf\u7684\u5927\u5c0f\u9700\u8981\u4e00\u6b65\u6b65\u8fdb\u884c\u4f18\u5316\uff0c\u624d\u80fd\u66f4\u597d\u5730\u7528\u4e8e\u6211\u4eec\u7684\u751f\u4ea7\u73af\u5883\uff0c\u6240\u4ee5\u5148\u770b\u4e00\u4e0b\u955c\u50cf\u662f\u5982\u4f55\u751f\u6210\u7684\uff0c\u518d\u53bb\u51b3\u5b9a\u5982\u4f55\u4f18\u5316\u955c\u50cf\u4f53\u79ef\u3002</p> <p>\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u770b\u4e00\u4e0b\u4e4b\u524d\u7531CentOS\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\u751f\u6210\u7684\u955c\u50cf\u4f53\u79ef\uff0c\u6bd4\u5982\u67e5\u770b\u4e00\u4e0b\u4e0a\u8ff0\u521b\u5efa\u7528\u6237\u7684\u57fa\u7840\u955c\u50cf\u4f53\u79ef\uff1a</p> <p>\u9996\u5148\u770b\u4e00\u4e0b\u521b\u5efa\u7528\u6237\u7684Dockerfile\uff1a</p> <p><code>Dockerfile</code></p> <pre><code># base image\nFROM centos:7\nMAINTAINER dot\nRUN useradd dot\n</code></pre> <p>\u518d\u6765\u770b\u4e00\u4e0b\u6267\u884cdocker build\u751f\u6210\u955c\u50cf\u65f6\u63a7\u5236\u53f0\u7684\u65e5\u5fd7\uff1a</p> <pre><code>$ docker build --no-cache -t centos:user .\nSending build context to Docker daemon  2.048kB\nStep 1/3 : FROM centos:7\n ---&gt; 5bf9684f4720\nStep 2/3 : MAINTAINER dot\n ---&gt; Running in 3e0c4943c5c0\nRemoving intermediate container 3e0c4943c5c0\n ---&gt; 5e490e30904c\nStep 3/3 : RUN useradd dot\n ---&gt; Running in c9210984990e\nRemoving intermediate container c9210984990e\n ---&gt; ee8c7f2dda93\nSuccessfully built ee8c7f2dda93\nSuccessfully tagged centos:user\n</code></pre> <p>\u6ce8\u610f</p> <p>docker\u6267\u884cbuild\u65f6\uff0c\u4f1a\u4e3a\u6bcf\u4e2a\u6307\u4ee4\u751f\u6210\u4e00\u4e2a\u7f13\u5b58\u5c42\uff0c\u5982\u679c\u6709\u76f8\u540c\u7684\u6307\u4ee4\uff0c\u4f1a\u9ed8\u8ba4\u4f7f\u7528\u4e4b\u524d\u5df2\u7ecf\u4ea7\u751f\u7684\u7f13\u5b58\uff0c--no-cache\u8868\u793a\u4e0d\u4f7f\u7528\u672c\u5730\u7f13\u5b58\u8fdb\u884c\u6784\u5efa\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u6bcf\u4e00\u884cDockerfile\u7684\u6307\u4ee4\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u5c42\uff0c\u8fd9\u4e9b\u5c42\u201c\u645e\u201d\u5728\u4e00\u8d77\u5c31\u7ec4\u6210\u4e86\u4e00\u4e2a\u65b0\u7684\u955c\u50cf.</p> <p>\u67e5\u770b\u4e00\u4e0b\u4e0a\u8ff0\u521b\u5efa\u7528\u6237\u7684\u57fa\u7840\u955c\u50cf\u4f53\u79ef\uff1a</p> <pre><code>$ docker images centos:user\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\ncentos       user      ee8c7f2dda93   6 minutes ago   194MB\n</code></pre> <p>\u7531\u6b64\u53ef\u4ee5\u770b\u51fa\uff0c\u4e00\u4e2a\u955c\u50cf\u662f\u7531\u5f88\u591aDockerfile\u7684\u6307\u4ee4\u751f\u6210\u7684\u5c42\u7ec4\u6210\u7684\uff0c\u800c\u955c\u50cf\u7684\u4f53\u79ef\u5927\u5c0f\u5c31\u662f\u6bcf\u4e2a\u5c42\u7684\u5927\u5c0f\u51b3\u5b9a\u7684\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528docker history\u770b\u4e00\u4e0b\u6bcf\u4e2a\u5c42\u7684\u5927\u5c0f\uff1a</p> <pre><code>$ docker history centos:user\nIMAGE          CREATED         CREATED BY                                      SIZE      COMMENT\nee8c7f2dda93   7 minutes ago   /bin/sh -c useradd dot                          150kB\n5e490e30904c   7 minutes ago   /bin/sh -c #(nop)  MAINTAINER dot               0B\n5bf9684f4720   12 months ago   /bin/sh -c #(nop)  CMD [\"/bin/bash\"]            0B\n&lt;missing&gt;      12 months ago   /bin/sh -c #(nop)  LABEL org.label-schema.sc\u2026   0B\n&lt;missing&gt;      12 months ago   /bin/sh -c #(nop) ADD file:0065316a41144e95b\u2026   194MB\n&lt;missing&gt;      12 months ago   /bin/sh -c #(nop)  MAINTAINER https://github\u2026   0B\n</code></pre> <p>\u7531\u4e0a\u8ff0\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0cFROM xxx\u4e4b\u540e\u7684MAINTAINER\u548cRUN useradd\u6307\u4ee4\u5206\u522b\u5360\u7528\u4e860B\u548c150KB\uff0c\u800c\u5236\u4f5c\u51fa\u6765\u7684centos:user\u955c\u50cf\u4f53\u79ef\u5374\u8fbe\u5230\u4e86194MB\uff0c\u8fd9\u4e2a\u5927\u5c0f\u5b9e\u9645\u662fFROM\u7684\u57fa\u7840CentOS\u5360\u7528\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u57fa\u7840\u955c\u50cf\u6765\u4f18\u5316\u4e0a\u8ff0\u955c\u50cf\u7684\u5927\u5c0f\u3002</p> <p>\u5bf9\u4e8e\u57fa\u7840\u955c\u50cf\u7684\u9009\u62e9\uff0c\u6bd4\u8f83\u5e38\u7528\u7684\u6709Alpine\u3001Busybox\u3001Scratch\u3001Debian\u7b49\u3002</p> <p>\u6bcf\u79cd\u57fa\u7840\u955c\u50cf\u7684\u5305\u7ba1\u7406\u65b9\u5f0f\u53ef\u80fd\u6709\u6240\u5dee\u5f02\uff0c</p> <p>\u6bd4\u5982Alpine\u7684\u5305\u7ba1\u7406\u5de5\u5177\u662fAPK\uff08\u4f7f\u7528\u6587\u6863\uff1ahttps://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management)\uff0c</p> <p>\u5bf9\u4e8e\u6ca1\u6709\u63a5\u89e6\u8fc7Alpine\u7cfb\u7edf\u7684\u8bfb\u8005\u4f1a\u6709\u6240\u964c\u751f\uff0c\u4f46\u662fAlpine\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684\u57fa\u7840\u955c\u50cf\u4e4b\u4e00\uff0c\u56e0\u4e3aAlpine\u4e0d\u4ec5\u4f53\u79ef\u5c0f\u3001\u4f7f\u7528\u7b80\u5355\uff0c\u540c\u65f6\u4e5f\u5305\u542b\u6392\u67e5\u76f8\u5173\u95ee\u9898\u7684\u57fa\u672c\u5de5\u5177\uff0c \u6240\u4ee5\u4e0b\u9762\u4e3b\u8981\u6f14\u793a\u4f7f\u7528Alpine\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\u8fdb\u884c\u6784\u5efa\u3002</p> <p>\u9996\u5148\u5c06\u4e4b\u524d\u521b\u5efa\u7528\u6237\u7684Dockerfile\u6539\u4e3aAlpine\u955c\u50cf\uff1a</p> <p><code>Dockerfile-Alpine</code></p> <pre><code># base image\n# FROM centos:7\nFROM alpine:3.12\nMAINTAINER dot\nRUN adduser -D dot\n</code></pre> <p>\u6ce8\u610f</p> <p>Alpine\u955c\u50cf\u521b\u5efa\u7528\u6237\u7684\u547d\u4ee4\u4e3aadduser\uff0c-D\u8868\u793a\u4e0d\u8bbe\u7f6e\u5bc6\u7801\u3002</p> <p>\u6267\u884c\u6784\u5efa\u5e76\u67e5\u770b\u955c\u50cf\u5927\u5c0f\uff1a</p> <pre><code>$ docker build -t alpine:user -f Dockerfile-Alpine .\n\n$ docker images alpine:user\nREPOSITORY   TAG       IMAGE ID       CREATED          SIZE\nalpine       user      ec242dac3ba8   45 seconds ago   5.6MB\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u66f4\u6539\u4e3aAlpine\u955c\u50cf\u540e\uff0c\u6267\u884c\u76f8\u540c\u529f\u80fd\u7684\u6307\u4ee4\uff0c\u955c\u50cf\u4f53\u79ef\u51cf\u5c0f\u4e86\u5c06\u8fd1190MB\uff0c\u6240\u4ee5\u9009\u62e9\u5408\u9002\u7684\u57fa\u7840\u955c\u50cf\u51b3\u5b9a\u4e86\u540e\u671f\u4e1a\u52a1\u5e94\u7528\u955c\u50cf\u7684\u5927\u5c0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u4f18\u5316\u955c\u50cf\u5927\u5c0f\u6700\u7b80\u5355\u3001\u6700\u6709\u6210\u6548\u7684\u65b9\u6cd5\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#6-\u591a\u9636\u6bb5\u6784\u5efa","title":"6. \u591a\u9636\u6bb5\u6784\u5efa","text":"<p>\u901a\u4fd7\u6765\u8bb2\uff0c\u591a\u9636\u6bb5\u6784\u5efa\u5c31\u662f\u5728Dockerfile\u4e2d\u5b9a\u4e49\u591a\u4e2aFROM\uff0c\u6bcf\u4e2aFROM\u4e0b\u6709\u591a\u4e2a\u4e0d\u540c\u7684\u6307\u4ee4\uff0c</p> <p>\u4e00\u822c\u53ef\u7b80\u5355\u5206\u4e3a\u6784\u5efa\u6b65\u9aa4\u548c\u751f\u6210\u4e1a\u52a1\u5e94\u7528\u955c\u50cf\u6b65\u9aa4\uff0c\u4e5f\u5c31\u662f\u8bf4\u524d\u9762\u4e00\u4e2a\u6216\u591a\u4e2a\u9636\u6bb5\u7528\u4e8e\u6784\u5efa\uff0c\u4ea7\u751f\u4e1a\u52a1\u5e94\u7528\u7684\u5305\u6216\u5176\u4ed6\u4ea7\u7269\uff0c\u4e4b\u540e\u7684\u9636\u6bb5\u5c06\u4e0a\u8ff0\u9636\u6bb5\u4ea7\u751f\u7684\u5305\u6216\u5176\u4ed6\u4ea7\u7269\u518d\u6b21\u6784\u5efa\u6210\u955c\u50cf\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u6700\u540e\u4e00\u6b65\u5c31\u6ca1\u6709\u4e86\u6784\u5efa\u65f6\u4ea7\u751f\u7684\u7f13\u5b58\u6587\u4ef6\uff0c\u4e5f\u8d77\u5230\u4e86\u4f18\u5316\u955c\u50cf\u4f53\u79ef\u7684\u4f5c\u7528\u3002</p> <p>\u5047\u5982\u6709\u4e00\u4e2a\u7528Go\u8bed\u8a00\u5f00\u53d1\u7684\u5e94\u7528\uff0c\u6b64\u5904\u7528Hello World\u4ee3\u66ff\uff1a</p> <p><code>hw.go</code></p> <pre><code>package main\nimport (\n\"fmt\"\n)\nfunc main() {\nfmt.Println(\"Hello, Docker\")\n}\n</code></pre> <p>\u9996\u5148\u4f7f\u7528\u5355\u4e2a\u6b65\u9aa4\u6784\u5efa\uff0c\u770b\u4e00\u4e0b\u5236\u4f5c\u51fa\u6765\u7684\u955c\u50cf\u5927\u5c0f\uff0c\u6b64\u65f6\u7684Dockerfile\u5982\u4e0b\uff1a</p> <pre><code># build step\nFROM golang:1.14.4-alpine\nWORKDIR /opt\nCOPY main.go /opt\nRUN go build /opt/main.go\nCMD \"./main\"\n</code></pre> <p>\u6267\u884c\u6784\u5efa\u5e76\u8fd0\u884c\u6d4b\u8bd5\uff1a</p> <pre><code>$ docker build -t hw:one .\nSending build context to Docker daemon  3.072kB\nStep 1/5 : FROM golang:1.14.4-alpine\n1.14.4-alpine: Pulling from library/golang\ndf20fa9351a1: Already exists\ned8968b2872e: Pull complete\na92cc7c5fd73: Pull complete\n9e0cccf56431: Pull complete\ncbe0275821fc: Pull complete\nDigest: sha256:6042b9cfb4eb303f3bdcbfeaba79b45130d170939318de85ac5b9508cb6f0f7e\nStatus: Downloaded newer image for golang:1.14.4-alpine\n ---&gt; 3289bf11c284\nStep 2/5 : WORKDIR /opt\n ---&gt; Running in b3ad0380a523\nRemoving intermediate container b3ad0380a523\n ---&gt; c95cf0455ed8\nStep 3/5 : COPY main.go /opt\n ---&gt; 4ce646e91031\nStep 4/5 : RUN go build /opt/main.go\n ---&gt; Running in edae50f0d115\nRemoving intermediate container edae50f0d115\n ---&gt; d0461b015ac5\nStep 5/5 : CMD \"./main\"\n---&gt; Running in 50ec99c207ac\nRemoving intermediate container 50ec99c207ac\n ---&gt; f84fdae5b52e\nSuccessfully built f84fdae5b52e\nSuccessfully tagged hw:one\n\n$ docker run --rm app:one\nHello Docker!\n</code></pre> <p>\u67e5\u770b\u6b64\u65f6\u7531\u4e00\u4e2a\u9636\u6bb5\u6784\u5efa\u7684\u955c\u50cf\u5927\u5c0f\uff1a</p> <pre><code>$ docker images app:one\nREPOSITORY   TAG       IMAGE ID       CREATED          SIZE\napp           one       f84fdae5b52e   53 seconds ago   372MB\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6b64\u65f6\u955c\u50cf\u5927\u5c0f\u4e3a372MB\uff0c\u4f46\u662f\u4e0a\u8ff0\u4ee3\u7801\u6211\u4eec\u53ea\u9700\u8981\u6784\u5efa\u6b65\u9aa4\u4ea7\u751f\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6hw\u5373\u53ef\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5927\u5c0f\u53ef\u4ee5\u8fdb\u5165\u5bb9\u5668\u5185\u90e8\u770b\u4e00\u4e0b\uff1a</p> <pre><code>$ docker run --rm app:one du -sh ./hw\n2.0M    ./main\n</code></pre> <p>\u771f\u6b63\u9700\u8981\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u53ea\u67092MB\uff0c\u5982\u679c\u4f7f\u7528\u4e0a\u8ff0\u65b9\u6cd5\u6267\u884c\u6784\u5efa\u5e76\u751f\u6210\u4e1a\u52a1\u955c\u50cf\uff0c\u90a3\u4e48\u751f\u6210\u7684\u955c\u50cf\u5c06\u4f1a\u591a\u7528370MB\u7a7a\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa\uff0c\u5c06\u6784\u5efa\u6b65\u9aa4\u548c\u751f\u6210\u4e1a\u52a1\u955c\u50cf\u7684\u6b65\u9aa4\u62c6\u5206\uff0c\u4e4b\u540e\u5c06\u4e8c\u8fdb\u5236\u5305\u653e\u7f6e\u5728\u67d0\u4e2a\u53ef\u4ee5\u8fd0\u884c\u8be5\u4e8c\u8fdb\u5236\u5305\u7684\u57fa\u7840\u955c\u50cf\u4e2d\u5373\u53ef\u3002</p> <p>\u5047\u5982\u6211\u4eec\u4f7f\u7528alpine\u955c\u50cf\u5236\u4f5c\u4e1a\u52a1\u5e94\u7528\u955c\u50cf\uff0c\u6b64\u65f6\u7684\u591a\u9636\u6bb5Dockerfile\u5982\u4e0b\uff1a</p> <p><code>Dockerfile-multi</code></p> <pre><code># \u6784\u5efa\u8fc7\u7a0b\nFROM golang:1.14.4-alpine as builder\nRUN mkdir -p /go/src/test\nWORKDIR /go/src/test\nCOPY main.go .\nRUN CGO_ENABLED=0 GOOS=linux go build -o app .\n\n# \u751f\u6210\u5e94\u7528\u955c\u50cf\u8fc7\u7a0b\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nWORKDIR /root/\nCOPY --from=builder /go/src/test/app . CMD [\"./app\"]\n</code></pre> <p>\u63d0\u793a</p> <p>FROM xxx as xxx\u7528\u4e8e\u7ed9\u67d0\u4e2a\u9636\u6bb5\u8d77\u4e00\u4e2a\u522b\u540d\uff0c\u5728\u5176\u4ed6\u9636\u6bb5\u4f7f\u7528--from=\u522b\u540d\u8fdb\u884c\u5f15\u7528\uff0c\u5982\u679c\u4e0d\u7528\u522b\u540d\uff0c\u53ef\u4ee5\u4ece\u4e0a\u5f80\u4e0b\u75280/\u00bd/x\u4ee3\u66ff\u3002</p> <p>\u518d\u6b21\u6784\u5efa\u540e\uff0c\u67e5\u770b\u6b64\u65f6\u7684\u955c\u50cf\u5927\u5c0f\u548c\u8fd0\u884c\u955c\u50cf\u7684\u6548\u679c\uff1a</p> <pre><code>$ docker build -t app:multi -f Dockerfile-multi .\nSending build context to Docker daemon  4.096kB\nStep 1/10 : FROM golang:1.14.4-alpine as builder\n ---&gt; 3289bf11c284\nStep 2/10 : RUN mkdir -p /go/src/test\n ---&gt; Running in 24d124976f73\nRemoving intermediate container 24d124976f73\n ---&gt; c6538795744e\nStep 3/10 : WORKDIR /go/src/test\n ---&gt; Running in f867d3a9cd05\nRemoving intermediate container f867d3a9cd05\n ---&gt; cefb6e9a949e\nStep 4/10 : COPY main.go .\n ---&gt; c34840a6f11f\nStep 5/10 : RUN CGO_ENABLED=0 GOOS=linux go build -o app .\n ---&gt; Running in 0d9affe015fc\nRemoving intermediate container 0d9affe015fc\n ---&gt; c0585768e984\nStep 6/10 : FROM alpine:latest\n ---&gt; c059bfaa849c\nStep 7/10 : RUN apk --no-cache add ca-certificates\n ---&gt; Running in 5a4d77d1d91a\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/community/x86_64/APKINDEX.tar.gz\n(1/1) Installing ca-certificates (20220614-r0)\nExecuting busybox-1.34.1-r3.trigger\nExecuting ca-certificates-20220614-r0.trigger\nOK: 6 MiB in 15 packages\nRemoving intermediate container 5a4d77d1d91a\n ---&gt; 869318da1537\nStep 8/10 : WORKDIR /root/\n ---&gt; Running in d30a99306ee4\nRemoving intermediate container d30a99306ee4\n ---&gt; 2dd348c39395\nStep 9/10 : COPY --from=builder /go/src/test/app .\n ---&gt; 637d1aaa4553\nStep 10/10 : CMD [\"./app\"]\n---&gt; Running in bc3d7f86b549\nRemoving intermediate container bc3d7f86b549\n ---&gt; defd4f1b7ea5\nSuccessfully built defd4f1b7ea5\nSuccessfully tagged app:multi\n\n# \u67e5\u770b\u6b64\u65f6\u7684\u955c\u50cf\u5927\u5c0f\u548c\u8fd0\u884c\u955c\u50cf\u7684\u6548\u679c\n# \u67e5\u770b\u751f\u6210\u7684\u6700\u7ec8\u955c\u50cf\uff0c\u5927\u5c0f\u53ea\u67098.17MB\n$ docker images|grep multi\napp                                          multi                       defd4f1b7ea5   About a minute ago   8.17MB\n\n$ docker run --rm app:multi\nHello, Docker\n</code></pre> <p>\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa\u4e0d\u4ec5\u5b9e\u73b0\u4e86\u76f8\u540c\u7684\u6548\u679c\uff0c\u800c\u4e14\u8fd8\u8282\u7701\u4e86300\u591a\u5146\u5b57\u8282\uff08MB\uff09\u7684\u78c1\u76d8\u7a7a\u95f4\uff0c\u6240\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6784\u5efa\u81ea\u5df1\u7684\u4e1a\u52a1\u955c\u50cf\u65f6\uff0c\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u8bed\u8a00\u5236\u5b9a\u4e0d\u540c\u7684\u6784\u5efa\u8fc7\u7a0b\uff0c\u62c6\u5206\u4ee3\u7801\u7f16\u8bd1\u8fc7\u7a0b\u548c\u751f\u6210\u4e1a\u52a1\u5e94\u7528\u955c\u50cf\u8fc7\u7a0b\u3002</p> <p>\u6211\u4eec\u5728\u672c\u4e66\u7b2c18\u7ae0\u6301\u7eed\u96c6\u6210\u6301\u7eed\u90e8\u7f72\u90e8\u5206\u4e5f\u4f1a\u6839\u636e\u8fd9\u4e2a\u539f\u7406\u5c06\u4ee3\u7801\u7f16\u8bd1\u548cdocker build\u6b65\u9aa4\u62c6\u5f00\uff0c\u6bcf\u4e2a\u6b65\u9aa4\u5404\u53f8\u5176\u804c\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u4f18\u5316\u6211\u4eec\u7684\u6d41\u6c34\u7ebf\uff0c\u4e5f\u53ef\u4ee5\u964d\u4f4e\u56e0\u4e3a\u6784\u5efa\u6b65\u9aa4\u8bbe\u8ba1\u4e0d\u5408\u7406\u9020\u6210\u7684\u78c1\u76d8\u7a7a\u95f4\u7684\u6d6a\u8d39\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#7-docker-compose","title":"7. docker-compose","text":"<p>\u53c2\u8003</p> <p>https://www.bookstack.cn/read/docker_practice-1.3.0/compose-README.md</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Docker%E5%9F%BA%E7%A1%80/#8-\u5c0f\u7ed3","title":"8. \u5c0f\u7ed3","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684\u5b66\u4e60\uff0c\u5df2\u7ecf\u8db3\u4ee5\u6ee1\u8db3\u751f\u4ea7\u73af\u5883\u7684\u5404\u7c7b\u9700\u6c42\u3002\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u53ef\u80fd\u5e76\u975e\u662f\u4f7f\u7528Docker\u8fdb\u884c\u955c\u50cf\u7684\u5236\u4f5c\uff0c\u4f46\u662f\u76ee\u524dDocker\u7684\u666e\u53ca\u7387\u4f9d\u65e7\u5f88\u9ad8\uff0c\u6240\u4ee5\u5bf9Docker\u7684\u5b66\u4e60\u4e5f\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u65e0\u8bba\u4f7f\u7528\u54ea\u79cd\u65b9\u5f0f\u5236\u4f5c\u955c\u50cf\uff0c\u90fd\u9700\u8981\u57fa\u4e8e\"\u4e0d\u7528\u7684\u5de5\u5177\u4e0d\u88c5\u3001\u9009\u62e9\u5c0f\u955c\u50cf\"\u7684\u539f\u5219\uff0c\u8fd9\u6837\u505a\u51fa\u6765\u7684\u955c\u50cf\u624d\u4f1a\u66f4\u5b89\u5168\u3001\u4f53\u79ef\u66f4\u5c0f\uff0c\u624d\u80fd\u8fbe\u5230\u751f\u4ea7\u73af\u5883\u7684\u8981\u6c42\u3002</p> <p>Dockerfile \u5b9e\u8df5</p> <p>https://www.qikqiak.com/k8strain/docker/dockerfile-practice/</p> <p>https://www.qikqiak.com/k8strain2/docker/dockerfile-practice/</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/","title":"Kubernetes\u7684\u57fa\u7840\u6982\u5ff5","text":""},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#1\u4e3a\u4ec0\u4e48\u8981\u7528kubernetes","title":"1.\u4e3a\u4ec0\u4e48\u8981\u7528Kubernetes","text":"<p>\u5f88\u591a\u4eba\u4f1a\u6709\u7591\u95ee\uff0c\u6709Docker\u4e86\u4e3a\u4ec0\u4e48\u8fd8\u7528Kubernetes\uff1f</p> <p>\u5728\u4e1a\u52a1\u5f00\u59cb\u8fdb\u884c\u5bb9\u5668\u5316\u65f6\uff0c\u524d\u671f\u9700\u8981\u5bb9\u5668\u5316\u7684\u9879\u76ee\u53ef\u80fd\u5e76\u4e0d\u591a\uff0c\u6d89\u53ca\u7684\u5bb9\u5668\u4e5f\u5e76\u4e0d\u591a\uff0c\u6b64\u65f6\u57fa\u4e8eDocker\u5bb9\u5668\u76f4\u63a5\u90e8\u7f72\u81f3\u5bbf\u4e3b\u673a\u4e5f\u80fd\u5b9e\u73b0\u81ea\u5df1\u7684\u9700\u6c42\u3002</p> <p>\u4f46\u662f\u968f\u7740\u9879\u76ee\u8d8a\u6765\u8d8a\u591a\uff0c\u7ba1\u7406\u7684\u5bb9\u5668\u4e5f\u8d8a\u6765\u8d8a\u591a\uff0c\u6b64\u65f6\u4f7f\u7528\u201c\u88f8\u5bb9\u5668\u201d\u90e8\u7f72\u7684\u65b9\u5f0f\u7ba1\u7406\u8d77\u6765\u5c31\u663e\u5f97\u5f88\u5403\u529b\uff0c\u5e76\u4e14\u968f\u7740\u4e1a\u52a1\u91cf\u7684\u589e\u52a0\uff0c\u4f1a\u660e\u663e\u4f53\u4f1a\u5230\u201c\u88f8\u5bb9\u5668\u201d\u7684\u4e0d\u8db3\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5bbf\u4e3b\u673a\u5b95\u673a\u9020\u6210\u8be5\u5bbf\u4e3b\u673a\u4e0a\u7684\u5bb9\u5668\u4e0d\u53ef\u7528\uff0c\u4e14\u65e0\u6cd5\u81ea\u52a8\u6062\u590d\u3002</li> <li>\u5bb9\u5668\u660e\u660e\u5728\u8fd0\u884c\uff0c\u63a5\u53e3\u5c31\u662f\u4e0d\u901a\uff08\u5065\u5eb7\u68c0\u67e5\u505a\u5f97\u4e0d\u5230\u4f4d\uff09\u3002</li> <li>\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u3001\u56de\u6eda\u3001\u6269\u7f29\u5bb9\u56f0\u96be\u3002</li> <li>\u6210\u767e\u4e0a\u5343\u7684\u5bb9\u5668\u548c\u6d89\u53ca\u7684\u7aef\u53e3\u96be\u4ee5\u7ef4\u62a4</li> </ul> <p>\u4e0a\u9762\u7684\u95ee\u9898\u53ea\u662f\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u7f57\u5217\uff0c\u771f\u6b63\u4f7f\u7528\u65f6\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7684\u95ee\u9898\u3002</p> <p>\u53ef\u80fd\u8bfb\u8005\u4e5f\u4f53\u9a8c\u8fc7\u50cfdocker-compose\u3001docker-swarm\u7b49\u7f16\u6392\u5de5\u5177\uff0c\u4f46\u8fd9\u4e9b\u5de5\u5177\u7684\u529f\u80fd\u548cKubernetes\u7684\u529f\u80fd\u8fd8\u662f\u76f8\u5dee\u751a\u8fdc\uff0c\u6240\u4ee5\u6ce8\u5b9aKubernetes\u7f16\u6392\u5de5\u5177\u5c06\u6210\u4e3a\u4e3b\u6d41\u7684\u5bb9\u5668\u7f16\u6392\u5de5\u5177\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#11-\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458","title":"1.1 \u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458","text":"<p>\u5728\u6ca1\u6709\u7528Kubernetes\u7684\u65f6\u5019\uff0c\u67e5\u770b\u7ebf\u4e0b\u6d4b\u8bd5\u7684\u65e5\u5fd7\uff0c\u9700\u8981\u5f00\u53d1\u6216\u8005\u6d4b\u8bd5\u4eba\u5458\u627e\u5230\u5bf9\u5e94\u7684\u673a\u5668\uff0c\u518d\u627e\u5230\u5bf9\u5e94\u7684\u5bb9\u5668\uff0c\u624d\u80fd\u67e5\u770b\u65e5\u5fd7\u3002</p> <p>\u5728\u4f7f\u7528Kubernetes\u4e4b\u540e\uff0c\u5f00\u53d1\u548c\u6d4b\u8bd5\u4eba\u5458\u76f4\u63a5\u5728Kubernetes\u7684Dashboard\u4e0a\u627e\u5230\u5bf9\u5e94\u7684Namespace\uff0c\u5373\u53ef\u5b9a\u4f4d\u5230\u4e1a\u52a1\u7684\u5bb9\u5668\uff0c\u7136\u540e\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u63a7\u5236\u53f0\u67e5\u770b\u5230\u5bf9\u5e94\u7684\u65e5\u5fd7\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u64cd\u4f5c\u65f6\u95f4\u3002</p> <p>\u628a\u5e94\u7528\u90e8\u7f72\u5230Kubernetes\u4e4b\u540e\uff0c\u4ee3\u7801\u7684\u53d1\u5e03\u3001\u56de\u6eda\u4ee5\u53ca\u84dd\u7eff\u53d1\u5e03\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u7b49\u90fd\u53d8\u5f97\u7b80\u5355\u53ef\u63a7\uff0c\u4e0d\u4ec5\u52a0\u5feb\u4e86\u4e1a\u52a1\u4ee3\u7801\u7684\u8fed\u4ee3\u901f\u5ea6\uff0c\u800c\u4e14\u5168\u7a0b\u65e0\u987b\u4eba\u5de5\u5e72\u9884\u3002\u751f\u4ea7\u73af\u5883\u53ef\u4ee5\u4f7f\u7528Jenkins\u3001GitRunner\u7b49\u5de5\u5177\u8fdb\u884c\u53d1\u7248\u6216\u56de\u6eda\u7b49\u3002\u4ece\u5f00\u53d1\u73af\u5883\u5230\u6d4b\u8bd5\u73af\u5883\uff0c\u6700\u540e\u5230\u751f\u4ea7\u73af\u5883\uff0c\u5b8c\u5168\u9075\u5b88\u4e00\u6b21\u6784\u5efa\uff0c\u591a\u96c6\u7fa4\u3001\u591a\u73af\u5883\u90e8\u7f72\uff0c\u901a\u8fc7\u4e0d\u540c\u7684\u542f\u52a8\u53c2\u6570\u3001\u4e0d\u540c\u7684\u73af\u5883\u53d8\u91cf\u3001\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u533a\u5206\u4e0d\u540c\u7684\u73af\u5883\u3002</p> <p>\u5728\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u540e\uff0c\u5f00\u53d1\u4eba\u5458\u5728\u5f00\u53d1\u5e94\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u987b\u518d\u53bb\u5173\u5fc3\u4ee3\u7801\u7684\u7f51\u7edc\u90e8\u5206\uff0c\u8fd9\u4e9b\u529f\u80fd\u90fd\u88ab\u670d\u52a1\u7f51\u683c\u5b9e\u73b0\uff0c\u8ba9\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u53ea\u5173\u5fc3\u4ee3\u7801\u903b\u8f91\u90e8\u5206\uff0c\u5373\u53ef\u8f7b\u677e\u5b9e\u73b0\u7f51\u7edc\u90e8\u5206\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u65ad\u6d41\u3001\u5206\u6d41\u3001\u8def\u7531\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u9650\u901f\u548c\u89e6\u53d1\u6545\u969c\u7b49\u529f\u80fd\u3002</p> <p>\u5728\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u540c\u65f6\u5b58\u5728\u591a\u5957\u73af\u5883\uff0c\u5f53\u7136\u4e5f\u4f1a\u521b\u5efa\u5176\u4ed6\u73af\u5883\u6216\u4e34\u65f6\u73af\u5883\uff0c\u4e4b\u524d\u6d4b\u8bd5\u73af\u5883\u7684\u521b\u5efa\u9700\u8981\u627e\u8fd0\u7ef4\u4eba\u5458\u6216\u8005\u81ea\u884c\u624b\u5de5\u642d\u5efa\u3002</p> <p>\u5728\u8fc1\u79fb\u81f3Kubernetes\u96c6\u7fa4\u540e\uff0c\u5f00\u53d1\u4eba\u5458\u5982\u679c\u9700\u8981\u65b0\u7684\u73af\u5883\uff0c\u65e0\u987b\u518d\u627e\u8fd0\u7ef4\uff0c\u53ea\u9700\u8981\u5728Jenkins\u4e0a\u70b9\u70b9\u9f20\u6807\u5373\u53ef\u5728Kubernetes\u96c6\u7fa4\u4e0a\u521b\u5efa\u4e00\u5957\u65b0\u7684\u6d4b\u8bd5\u73af\u5883\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#12-\u5bf9\u4e8e\u8fd0\u7ef4\u4eba\u5458","title":"1.2 \u5bf9\u4e8e\u8fd0\u7ef4\u4eba\u5458","text":"<p>\u5bf9\u4e8e\u8fd0\u7ef4\u4eba\u5458\uff0c\u53ef\u80fd\u7ecf\u5e38\u56e0\u4e3a\u4e00\u4e9b\u91cd\u590d\u3001\u70e6\u7410\u7684\u5de5\u4f5c\u611f\u89c9\u538c\u5026\uff0c\u6bd4\u5982\u4e00\u4e2a\u9879\u76ee\u9700\u8981\u4e00\u5957\u65b0\u7684\u6d4b\u8bd5\u73af\u5883\uff0c\u53e6\u4e00\u4e2a\u9879\u76ee\u9700\u8981\u8fc1\u79fb\u6d4b\u8bd5\u73af\u5883\u81f3\u5176\u4ed6\u5e73\u53f0\u3002</p> <p>\u4f20\u7edf\u67b6\u6784\u53ef\u80fd\u9700\u8981\u88c5\u7cfb\u7edf\u3001\u88c5\u4f9d\u8d56\u73af\u5883\u3001\u90e8\u7f72\u57df\u540d\u3001\u5f00\u901a\u6743\u9650\u7b49\uff0c\u8fd9\u4e00\u6574\u5957\u4e0b\u6765\uff0c\u4e0d\u4ec5\u8017\u65f6\uff0c\u800c\u4e14\u53ef\u80fd\u4f1a\u56e0\u4e3a\u6709\u67d0\u4e9b\u9057\u6f0f\u800c\u9020\u6210\u8bf8\u591a\u95ee\u9898\u3002</p> <p>\u800c\u5982\u4eca\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528Kubernetes\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u4e00\u952e\u5f0f\u90e8\u7f72\u4e00\u5957\u65b0\u7684\u6d4b\u8bd5\u73af\u5883\uff0c\u751a\u81f3\u5168\u7a0b\u65e0\u987b\u81ea\u5df1\u5e72\u9884\uff0c\u5f00\u53d1\u4eba\u5458\u901a\u8fc7Jenkins\u6216\u8005\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\u5373\u53ef\u4e00\u952e\u5f0f\u521b\u5efa\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u8fd0\u7ef4\u6210\u672c\u3002</p> <p>\u5728\u6ca1\u6709\u4f7f\u7528Kubernetes\u65f6\uff0c\u4e1a\u52a1\u5e94\u7528\u7684\u6269\u5bb9\u548c\u7f29\u5bb9\u90fd\u9700\u8981\u4eba\u5de5\u53bb\u5904\u7406\uff0c\u4ece\u91c7\u8d2d\u670d\u52a1\u5668\u3001\u4e0a\u67b6\u5230\u90e8\u7f72\u4f9d\u8d56\u73af\u5883\uff0c\u4e0d\u4ec5\u9700\u8981\u5927\u91cf\u7684\u4eba\u529b\u7269\u529b\uff0c\u800c\u4e14\u975e\u5e38\u5bb9\u6613\u5728\u4e2d\u95f4\u8fc7\u7a0b\u51fa\u73b0\u95ee\u9898\uff0c\u53c8\u8981\u82b1\u8d39\u5927\u91cf\u7684\u65f6\u95f4\u53bb\u67e5\u627e\u95ee\u9898\u3002</p> <p>\u6210\u529f\u4e0a\u67b6\u540e\uff0c\u8fd8\u9700\u8981\u5728\u524d\u7aef\u8d1f\u8f7d\u5747\u8861\u6dfb\u52a0\u8be5\u670d\u52a1\u5668\u3002\u800c\u5982\u4eca\uff0c\u53ef\u4ee5\u5229\u7528Kubernetes\u7684\u5f39\u6027\u8ba1\u7b97\u4e00\u952e\u5f0f\u6269\u5bb9\u548c\u7f29\u5bb9\uff0c\u4e0d\u4ec5\u5927\u5927\u63d0\u9ad8\u4e86\u8fd0\u7ef4\u6548\u7387\uff0c\u800c\u4e14\u8fd8\u8282\u7701\u4e86\u4e0d\u5c11\u7684\u670d\u52a1\u5668\u8d44\u6e90\uff0c\u63d0\u9ad8\u4e86\u8d44\u6e90\u5229\u7528\u7387\u3002</p> <ul> <li> <p>\u5728\u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u65b9\u9762\uff0c\u53ef\u80fd\u5bf9Nginx\u7684\u914d\u7f6e\u89c4\u5219\u5e76\u4e0d\u719f\u6089\uff0c\u4e00\u4e9b\u9ad8\u7ea7\u7684\u529f\u80fd\u4e5f\u5f88\u96be\u5b9e\u73b0\uff0c\u4f46\u662f\u5728Kubernetes\u4e0a\uff0c\u5229\u7528Kubernetes\u7684Ingress\u5373\u53ef\u7b80\u5355\u5730\u5b9e\u73b0\u90a3\u4e9b\u590d\u6742\u7684\u903b\u8f91\uff0c\u5e76\u4e14\u4e0d\u4f1a\u518d\u9047\u5230Nginx\u5c11\u52a0\u4e00\u4e2a\u659c\u6760\u548c\u591a\u52a0\u4e00\u4e2a\u659c\u6760\u7684\u95ee\u9898\u3002</p> </li> <li> <p>\u5728\u8d1f\u8f7d\u5747\u8861\u65b9\u9762\uff0c\u4e4b\u524d\u8d1f\u8f7d\u5747\u8861\u53ef\u80fd\u662fNginx\u3001LVS\u3001HAProxy\u3001F5\u7b49\uff0c\u4e91\u4e0a\u53ef\u80fd\u662f\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u7684\u8d1f\u8f7d\u5747\u8861\u673a\u5236\u3002\u6bcf\u6b21\u6dfb\u52a0\u5220\u9664\u8282\u70b9\u65f6\uff0c\u90fd\u9700\u8981\u624b\u52a8\u53bb\u914d\u7f6e\u524d\u7aef\u8d1f\u8f7d\u5747\u8861\uff0c\u624b\u52a8\u53bb\u5339\u914d\u540e\u7aef\u8282\u70b9\u3002\u5728\u4f7f\u7528Kubernetes\u8fdb\u884c\u7f16\u6392\u670d\u52a1\u65f6\uff0c\u4f7f\u7528Kubernetes\u5185\u90e8\u7684Service\u5373\u53ef\u5b9e\u73b0\u81ea\u52a8\u7ba1\u7406\u8282\u70b9\uff0c\u5e76\u4e14\u652f\u6301\u81ea\u52a8\u6269\u5bb9\u3001\u7f29\u5bb9\u3002</p> </li> <li> <p>\u5728\u9ad8\u53ef\u7528\u65b9\u9762\uff0cKubernetes\u5929\u751f\u7684\u9ad8\u53ef\u7528\u529f\u80fd\u8ba9\u8fd0\u7ef4\u4eba\u5458\u5f7b\u5e95\u91ca\u653e\u4e86\u53cc\u624b\uff0c\u65e0\u987b\u518d\u53bb\u521b\u5efa\u5404\u7c7b\u9ad8\u53ef\u7528\u5de5\u5177\uff0c\u4ee5\u53ca\u68c0\u6d4b\u811a\u672c\u3002</p> </li> </ul> <p>Kubernetes\u652f\u6301\u8fdb\u7a0b\u3001\u63a5\u53e3\u7ea7\u522b\u7684\u5065\u5eb7\u68c0\u67e5\uff0c\u5982\u53d1\u73b0\u63a5\u53e3\u8d85\u65f6\u6216\u8005\u8fd4\u56de\u503c\u4e0d\u6b63\u786e\uff0c\u4f1a\u81ea\u52a8\u5904\u7406\u8be5\u95ee\u9898\u3002</p> <ul> <li> <p>\u5728\u4e2d\u95f4\u4ef6\u642d\u5efa\u65b9\u9762\uff0c\u6839\u636e\u5b9a\u4e49\u597d\u7684\u8d44\u6e90\u6587\u4ef6\uff0c\u53ef\u4ee5\u5b9e\u73b0\u79d2\u7ea7\u642d\u5efa\u5404\u7c7b\u4e2d\u95f4\u4ef6\u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c\u5e76\u4e14\u652f\u6301\u4e00\u952e\u5f0f\u6269\u5bb9\u3001\u7f29\u5bb9\uff0c\u5982Redis\u3001RabbitMQ\u3001Zookeeper\u7b49\uff0c\u5e76\u4e14\u5927\u5927\u51cf\u5c11\u4e86\u51fa\u9519\u7684\u6982\u7387\u3002</p> </li> <li> <p>\u5728\u5e94\u7528\u7aef\u53e3\u65b9\u9762\uff0c\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u53ef\u80fd\u8dd1\u4e86\u5f88\u591a\u8fdb\u7a0b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u7aef\u53e3\uff0c\u9700\u8981\u4eba\u4e3a\u5730\u53bb\u914d\u7f6e\u7aef\u53e3\uff0c\u5e76\u4e14\u8fd8\u9700\u8981\u8003\u8651\u7aef\u53e3\u51b2\u7a81\u7684\u95ee\u9898\uff0c\u5982\u679c\u6709\u9632\u706b\u5899\u7684\u8bdd\uff0c\u8fd8\u9700\u8981\u914d\u7f6e\u9632\u706b\u5899\u3002\u5728Kubernetes\u4e2d\uff0c\u7aef\u53e3\u7edf\u4e00\u7ba1\u7406\u3001\u7edf\u4e00\u914d\u7f6e\uff0c\u6bcf\u4e2a\u5e94\u7528\u7684\u7aef\u53e3\u90fd\u53ef\u4ee5\u8bbe\u7f6e\u6210\u4e00\u6837\u7684\uff0c\u4e4b\u540e\u901a\u8fc7Service\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u7aef\u53e3\u7ba1\u7406\u7684\u590d\u6742\u5ea6\u548c\u7aef\u53e3\u51b2\u7a81\u3002</p> </li> </ul> <p>\u65e0\u8bba\u662f\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u3001\u6d4b\u8bd5\u4eba\u5458\u8fd8\u662f\u8fd0\u7ef4\u4eba\u5458\uff0cKubernetes\u7684\u8bde\u751f\u4e0d\u4ec5\u51cf\u5c11\u4e86\u5de5\u4f5c\u7684\u590d\u6742\u5ea6\uff0c\u8fd8\u51cf\u5c11\u4e86\u5404\u79cd\u8fd0\u7ef4\u6210\u672c\u3002 \u4e0a\u8ff0\u5e26\u6765\u7684\u4fbf\u5229\u6027\u53ea\u662f\u6bd4\u8f83\u5c0f\u7684\u4e00\u90e8\u5206\uff0c\u66f4\u591a\u4f18\u70b9\u53ea\u6709\u7528\u4e86\u624d\u80fd\u771f\u6b63\u4f53\u4f1a\u5230\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#2kubernetes\u5e26\u6765\u7684\u6311\u6218","title":"2.Kubernetes\u5e26\u6765\u7684\u6311\u6218","text":"<p>Kubernetes\u4ece\u8bde\u751f\u81f3\u4eca\uff0c\u4e00\u8def\u7a81\u98de\u731b\u8fdb\uff0c\u5728\u5bb9\u5668\u7f16\u6392\u7684\u9886\u57df\u91cc\u8fc7\u4e09\u5173\u65a9\u516d\u5c06\uff0c\u6700\u7ec8\u62ff\u4e0b\u4e86\u5bb9\u5668\u7f16\u6392\u7684\u51a0\u519b\u5b9d\u5ea7\uff0c\u6210\u4e3a\u6700\u65e0\u53ef\u66ff\u4ee3\u3001\u4e0d\u53ef\u64bc\u52a8\u7684\u4f7c\u4f7c\u8005\uff0c\u4f46\u662f\u9488\u5bf9Kubernetes\u7684\u5b66\u4e60\u548c\u4f7f\u7528\u59cb\u7ec8\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u96be\u9898\u3002</p> <p>\u9996\u5148Kubernetes\u672c\u8eab\u7684\u5b66\u4e60\u5c31\u5f88\u56f0\u96be\uff0c\u56e0\u4e3aKubernetes\u6982\u5ff5\u592a\u591a\uff0c\u6d89\u53ca\u7684\u77e5\u8bc6\u9762\u4e5f\u975e\u5e38\u5e7f\u6cdb\uff0c\u53ef\u80fd\u5b66\u4e60\u4e86\u4e00\u4e2a\u6708\u4e5f\u65e0\u6cd5\u5165\u95e8\uff0c\u751a\u81f3\u8fde\u96c6\u7fa4\u4e5f\u642d\u5efa\u4e0d\u51fa\u6765\uff0c\u4f7f\u4eba\u671b\u800c\u5374\u6b65\u3002 \u5e76\u4e14Kubernetes\u5bf9\u8fd0\u7ef4\u7684\u6280\u672f\u80fd\u529b\u8981\u6c42\u4e5f\u6bd4\u8f83\u9ad8\uff0c\u56e0\u4e3a\u8fd0\u7ef4\u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8e\u4f20\u7edf\u8fd0\u7ef4\uff0c\u6709\u65f6\u5019\u53ef\u80fd\u8981\u4fee\u6539\u4e1a\u52a1\u4ee3\u7801\u3001\u5236\u5b9a\u4e1a\u52a1\u4e0a\u7ebf\u4f53\u7cfb\u3001\u7ed9\u7814\u53d1\u4eba\u5458\u5728\u5f00\u53d1\u5e94\u7528\u4e2d\u7ed9\u51fa\u66f4\u597d\u7684\u5efa\u8bae\u7b49\u3002</p> <p>\u9700\u8981\u638c\u63e1\u7684\u77e5\u8bc6\u4e5f\u6709\u5f88\u591a\uff0c\u53ef\u80fd\u9700\u8981\u638c\u63e1\u516c\u53f8\u5185\u6240\u6709\u4f7f\u7528\u5230\u7684\u4ee3\u7801\uff0c\u6bd4\u5982\u4ee3\u7801\u5982\u4f55\u8fdb\u884c\u7f16\u8bd1\u3001\u5982\u4f55\u6b63\u786e\u53d1\u5e03\u3001\u5982\u4f55\u4fee\u6539\u4ee3\u7801\u914d\u7f6e\u6587\u4ef6\u7b49\uff0c\u8fd9\u5bf9\u4e8e\u8fd0\u7ef4\u4eba\u5458\u4e5f\u662f\u4e00\u79cd\u6311\u6218\u3002</p> <p>Kubernetes\u4e4b\u6240\u4ee5\u88ab\u53eb\u4f5cK8s\uff0c\u4e1a\u754c\u6709\u4e24\u79cd\u8bf4\u6cd5\uff0c\u901a\u4fd7\u7684\u8bf4\u6cd5\u662fk\u548cs\u4e4b\u95f4\u67098\u4e2a\u5b57\u6bcd\uff1b\u53e6\u4e00\u79cd\u8bf4\u6cd5\u662fK8s\u96c6\u7fa4\u81f3\u5c11\u9700\u8981\u642d\u5efa8\u904d\u624d\u80fd\u642d\u5efa\u6210\u529f\u3002</p> <p>\u5f53\u7136\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u53ef\u80fd\u4e0d\u6b628\u904d\u3002 </p> <p>Kubernetes\u7684\u8bde\u751f\u628a\u8fd0\u7ef4\u4ece\u4f20\u7edf\u8fd0\u7ef4\u8f6c\u53d8\u5230\u4e86DevOps\u65b9\u5411\uff0c\u9700\u8981\u9762\u4e34\u7684\u95ee\u9898\u66f4\u591a\uff0c\u9700\u8981\u9762\u4e34\u7684\u65b0\u6280\u672f\u4e5f\u5f88\u591a\uff0c\u4f46\u662f\u5f53\u771f\u6b63\u638c\u63e1\u4e86Kubernetes\u7684\u6838\u5fc3\u548c\u8bbe\u8ba1\u7406\u5ff5\uff0c\u5c31\u4f1a\u53d7\u76ca\u7ec8\u8eab\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#3kubernetes\u67b6\u6784\u89e3\u6790","title":"3.Kubernetes\u67b6\u6784\u89e3\u6790","text":"<p>\u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e0bKubernetes\u7684\u67b6\u6784\u56fe\uff0c\u5982\u56fe4.1\u6240\u793a\u3002</p> <p></p> <p>\u56fe4.1 Kubernetes\u9ad8\u53ef\u7528\u67b6\u6784</p> <p>\u7531\u56fe\u53ef\u77e5\uff0c Kubernetes\u67b6\u6784\u53ef\u7b80\u5355\u5206\u4e3a\u4e3b(Master)\u8282\u70b9 \u3001 \u4ece(\u5de5\u4f5c/Worker/Node)\u8282\u70b9\u548c\u6570\u636e\u5e93Etcd\u3002</p> <p>\u5176\u4e2d\u4e3b\u8282\u70b9\u4e3a\u96c6\u7fa4\u7684\u63a7\u5236\u5355\u5143\uff0c\u4e00\u822c\u4e0d\u4f1a\u8fd0\u884c\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f \uff0c\u4e3b\u8981\u5305\u542b\u7684\u7a0b\u5e8f\u6709\u5982\u4e0b\uff1a</p> <ul> <li>Kube-APIServer</li> <li>Kube-ControllerManager</li> <li>Kube-Scheduler\u3002</li> </ul> <p>\u4ece\u8282\u70b9\u4e3a\u5de5\u4f5c\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u90e8\u7f72\u5e94\u7528 \u7a0b\u5e8f\u5bb9\u5668\u7684\u8282\u70b9\uff0c\u4e3b\u8981\u5305\u542b\u7684\u7ec4\u4ef6\u6709\uff1a - Kubelet - Kube-Proxy </p> <p>\u5f53\u7136\u5982\u679cMaster \u8282\u70b9\u4e5f\u8981\u90e8\u7f72\u5bb9\u5668\uff0c\u4e5f\u4f1a\u5305\u542b\u8fd9\u4e24\u4e2a\u7ec4\u4ef6\u3002</p> <p>\u540c\u65f6\uff0c\u53ef\u4ee5\u770b\u51fa\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u53ef\u4ee5\u6709\u5f88\u591aNode\u8282\u70b9\uff0c\u7528\u4ee5\u4fdd\u8bc1\u96c6\u7fa4\u5bb9\u5668\u7684 \u5206\u5e03\u5f0f\u90e8\u7f72\u7528\u4e8e\u5b9e\u73b0\u4e1a\u52a1\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u4e5f\u53ef\u4ee5\u6709\u5f88\u591aMaster\u8282\u70b9\uff0c\u4e4b\u540e\u901a\u8fc7\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u4fdd\u8bc1\u96c6\u7fa4\u63a7\u5236\u8282\u70b9\u7684\u9ad8\u53ef\u7528\u3002</p> <p>\u8d1f\u8f7d\u5747\u8861\u53ef\u4ee5\u4f7f\u7528\u8f6f\u4ef6\u8d1f\u8f7d\u5747\u8861Nginx/LVS/HAProxy+KeepAlived \u6216\u8005\u786c\u4ef6\u8d1f\u8f7d\u5747\u8861F5\u7b49, \u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u5bf9 Kube-APIServer\u63d0\u4f9b\u7684VIP\u5373\u53ef\u5b9e\u73b0Master\u8282\u70b9\u7684\u9ad8\u53ef\u7528\uff0c\u5176\u4ed6\u7ec4\u4ef6\u901a\u8fc7\u8be5 VIP\u8fde\u63a5\u81f3Kube-APIServer\u3002</p> <p>Etcd\u96c6\u7fa4\u53ef\u4ee5\u548cMaster\u8282\u70b9\u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u5bbf\u4e3b \u673a\uff0c\u4e5f\u53ef\u4ee5\u5355\u72ec\u90e8\u7f72\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u90e8\u7f72\u5927\u4e8e3\u7684\u5947\u6570\u53f0Etcd\u8282\u70b9\u5b9e\u73b0Etcd\u96c6\u7fa4\u7684\u9ad8\u53ef\u7528\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#4master\u8282\u70b9","title":"4.Master\u8282\u70b9","text":"<p>Master\u8282\u70b9\u662fKubernetes\u96c6\u7fa4\u7684\u63a7\u5236\u8282\u70b9\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4e0d\u5efa\u8bae\u90e8\u7f72\u96c6\u7fa4\u6838\u5fc3\u7ec4\u4ef6\u5916\u7684\u4efb\u4f55\u5bb9\u5668\uff08\u5728Kubeadm\u5b89\u88c5\u65b9\u5f0f\u4e0b\uff0c\u7cfb\u7edf\u7ec4\u4ef6\u4ee5\u5bb9\u5668\u65b9\u5f0f\u8fd0\u884c\u5728Master\u8282\u70b9\u7684\u5bbf\u4e3b\u673a\u4e0a\uff1b\u4e8c\u8fdb\u5236\u5b89\u88c5\u65b9\u5f0f\u4e0b\uff0c\u7cfb\u7edf\u7ec4\u4ef6\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u7684\u65b9\u5f0f\u8fd0\u884c\uff0cMaster\u8282\u70b9\u53ef\u4ee5\u4e0d\u8fd0\u884c\u4efb\u4f55\u5bb9\u5668\uff09\uff0c\u516c\u53f8\u4e1a\u52a1\u7a0b\u5e8f\u7684\u5bb9\u5668\u66f4\u662f\u4e0d\u5efa\u8bae\u90e8\u7f72\u5230Master\u8282\u70b9\u4e0a\uff0c\u4ee5\u514d\u5347\u7ea7\u6216\u8005\u7ef4\u62a4\u65f6\u5bf9\u4e1a\u52a1\u9020\u6210\u5f71\u54cd\u3002</p> <p>Master\u8282\u70b9\u7684\u7ec4\u4ef6\u5305\u62ec\uff1a</p> <ul> <li>APIServer\uff1a\u6574\u4e2a\u96c6\u7fa4\u7684\u63a7\u5236\u4e2d\u67a2\uff0c\u63d0\u4f9b\u96c6\u7fa4\u4e2d\u5404\u4e2a\u6a21\u5757\u4e4b\u95f4\u7684\u6570\u636e\u4ea4\u6362\uff0c\u5e76\u5c06\u96c6\u7fa4\u72b6\u6001\u548c\u4fe1\u606f\u5b58\u50a8\u5230\u5206\u5e03\u5f0f\u952e-\u503c\uff08key-value\uff09\u5b58\u50a8\u7cfb\u7edfEtcd\u96c6\u7fa4\u4e2d\u3002   \u540c\u65f6\uff0c\u5b83\u4e5f\u662f\u96c6\u7fa4\u7ba1\u7406\u3001\u8d44\u6e90\u914d\u989d\u3001\u63d0\u4f9b\u5b8c\u5907\u7684\u96c6\u7fa4\u5b89\u5168\u673a\u5236\u7684\u5165\u53e3\uff0c\u4e3a\u96c6\u7fa4\u5404\u7c7b\u8d44\u6e90\u5bf9\u8c61\u63d0\u4f9b\u589e\u5220\u6539\u67e5\u4ee5\u53cawatch\u7684REST API\u63a5\u53e3\u3002   APIServer\u4f5c\u4e3aKubernetes\u7684\u5173\u952e\u7ec4\u4ef6\uff0c\u4f7f\u7528Kubernetes API\u548cJSON over HTTP\u63d0\u4f9bKubernetes\u7684\u5185\u90e8\u548c\u5916\u90e8\u63a5\u53e3\u3002</li> </ul> <ul> <li>Scheduler\uff1a\u96c6\u7fa4Pod\u7684\u8c03\u5ea6\u4e2d\u5fc3\uff0c\u4e3b\u8981\u901a\u8fc7\u8c03\u5ea6\u7b97\u6cd5\u5c06Pod\u5206\u914d\u5230\u6700\u4f73\u7684Node\u8282\u70b9\uff0c\u5b83\u901a\u8fc7APIServer\u76d1\u542c\u6240\u6709Pod\u7684\u72b6\u6001\uff0c\u4e00\u65e6\u53d1\u73b0\u65b0\u7684\u672a\u88ab\u8c03\u5ea6\u5230\u4efb\u4f55Node\u8282\u70b9\u7684Pod\uff08PodSpec.NodeName\u4e3a\u7a7a\uff09\uff0c\u5c31\u4f1a\u6839\u636e\u4e00\u7cfb\u5217\u7b56\u7565\u9009\u62e9\u6700\u4f73\u8282\u70b9\u8fdb\u884c\u8c03\u5ea6\uff0c\u5bf9\u6bcf\u4e00\u4e2aPod\u521b\u5efa\u4e00\u4e2a\u7ed1\u5b9a\uff08Binding\uff09\uff0c\u7136\u540e\u88ab\u8c03\u5ea6\u7684\u8282\u70b9\u4e0a\u7684Kubelet\u8d1f\u8d23\u542f\u52a8\u8be5Pod\u3002Scheduler\u662f\u96c6\u7fa4\u53ef\u63d2\u62d4\u5f0f\u7ec4\u4ef6\uff0c\u5b83\u8ddf\u8e2a\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684\u8d44\u6e90\u5229\u7528\u7387\u4ee5\u786e\u4fdd\u5de5\u4f5c\u8d1f\u8f7d\u4e0d\u4f1a\u8d85\u8fc7\u53ef\u7528\u8d44\u6e90\u3002\u56e0\u6b64\uff0cScheduler\u5fc5\u987b\u77e5\u9053\u8d44\u6e90\u9700\u6c42\u3001\u8d44\u6e90\u53ef\u7528\u6027\u4ee5\u53ca\u5176\u4ed6\u7ea6\u675f\u548c\u7b56\u7565\uff0c\u4f8b\u5982\u670d\u52a1\u8d28\u91cf\u3001\u4eb2\u548c\u529b/\u53cd\u5173\u8054\u6027\u8981\u6c42\u3001\u6570\u636e\u4f4d\u7f6e\u7b49\u3002Scheduler\u5c06\u8d44\u6e90\u4f9b\u5e94\u4e0e\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u76f8\u5339\u914d\u4ee5\u7ef4\u6301\u7cfb\u7edf\u7684\u7a33\u5b9a\u548c\u53ef\u9760\u6027\uff0c\u56e0\u6b64Scheduler\u5728\u8c03\u5ea6\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u8003\u8651\u516c\u5e73\u3001\u8d44\u6e90\u9ad8\u6548\u5229\u7528\u3001\u6548\u7387\u7b49\u65b9\u9762\u7684\u95ee\u9898\u3002</li> </ul> <ul> <li>Controller Manager\uff1a\u96c6\u7fa4\u72b6\u6001\u7ba1\u7406\u5668\uff08\u5b83\u7684\u82f1\u6587\u76f4\u8bd1\u540d\u4e3a\u63a7\u5236\u5668\u7ba1\u7406\u5668\uff09\uff0c\u4ee5\u4fdd\u8bc1Pod\u6216\u5176\u4ed6\u8d44\u6e90\u8fbe\u5230\u671f\u671b\u503c\u3002   \u5f53\u96c6\u7fa4\u4e2d\u67d0\u4e2aPod\u7684\u526f\u672c\u6570\u6216\u5176\u4ed6\u8d44\u6e90\u56e0\u6545\u969c\u548c\u9519\u8bef\u5bfc\u81f4\u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c\uff0c\u6ca1\u6709\u8fbe\u5230\u8bbe\u5b9a\u7684\u503c\u65f6\uff0cController Manager\u4f1a\u5c1d\u8bd5\u81ea\u52a8\u4fee\u590d\u5e76\u4f7f\u5176\u8fbe\u5230\u671f\u671b\u72b6\u6001\u3002   Controller Manager\u5305\u542bNodeController\u3001ReplicationController\u3001EndpointController\u3001NamespaceController\u3001ServiceAccountController\u3001ResourceQuotaController\u3001ServiceController\u548cTokenController\u7b49\uff0c\u8be5\u63a7\u5236\u5668\u7ba1\u7406\u5668\u53ef\u4e0eAPI\u670d\u52a1\u5668\u8fdb\u884c\u901a\u4fe1\uff0c\u4ee5\u5728\u9700\u8981\u65f6\u521b\u5efa\u3001\u66f4\u65b0\u6216\u5220\u9664\u5b83\u6240\u7ba1\u7406\u7684\u8d44\u6e90\uff0c\u5982Pod\u3001\u670d\u52a1\u65ad\u70b9\u7b49\u3002Scheduler\u548cController Manager\u867d\u7136\u90e8\u7f72\u4e86\u591a\u4e2a\u8282\u70b9\uff0c\u4f46\u540c\u65f6\u5de5\u4f5c\u7684\u8282\u70b9\u53ea\u6709\u4e00\u4e2a\uff0c\u56e0\u4e3aScheduler\u548cController Manager\u5c5e\u4e8e\u6709\u72b6\u6001\u670d\u52a1\uff0c\u4e3a\u4e86\u9632\u6b62\u91cd\u590d\u8c03\u5ea6\uff0c\u591a\u4e2a\u8282\u70b9\u7684Scheduler\u548cController Manager\u8fdb\u884c\u4e86\u9009\u4e3b\u5de5\u4f5c\uff0c\u5de5\u4f5c\u8282\u70b9\uff08\u4e3b\u8282\u70b9\uff09\u4fe1\u606f\u4fdd\u5b58\u5728Scheduler\u548cController Manager\u7684EndPoint\u4e2d\uff0c   \u53ef\u4ee5\u901a\u8fc7<code>kubectl describe ep kube-scheduler kube-controller-manager -n kube-system</code>\u67e5\u770b\uff08Kubernetes 1.20\u7248\u672c\u4ee5\u4e0a\u9700\u8981\u5728leases\u4e2d\u67e5\u770b\uff1a<code>kubectl get leases -n kube-system</code>\uff09\u3002</li> </ul> <ul> <li>Etcd\uff1aCoreOS\u5f00\u53d1\uff0c\u7528\u4e8e\u53ef\u9760\u5730\u5b58\u50a8\u96c6\u7fa4\u7684\u914d\u7f6e\u6570\u636e\uff0c\u662f\u4e00\u79cd\u6301\u4e45\u578b\u3001\u8f7b\u91cf\u578b\u3001\u5206\u5e03\u5f0f\u7684\u952e-\u503c\uff08key-value\uff09\u6570\u636e\u5b58\u50a8\u7ec4\u4ef6\u3002   Etcd\u4f5c\u4e3aKubernetes\u96c6\u7fa4\u7684\u6301\u4e45\u5316\u5b58\u50a8\u7cfb\u7edf\uff0c\u96c6\u7fa4\u7684\u707e\u96be\u6062\u590d\u3001\u72b6\u6001\u4fe1\u606f\u5b58\u50a8\u90fd\u4e0e\u5176\u5bc6\u4e0d\u53ef\u5206\uff0c\u6240\u4ee5\u5728Kubernetes\u9ad8\u53ef\u7528\u96c6\u7fa4\u4e2d\uff0cEtcd\u7684\u9ad8\u53ef\u7528\u662f\u81f3\u5173\u91cd\u8981\u7684\u4e00\u90e8\u5206\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5efa\u8bae\u90e8\u7f72\u5927\u4e8e3\u7684\u5947\u6570\u4e2a\u6570\u7684Etcd\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u7684\u5b89\u5168\u6027\u548c\u53ef\u6062\u590d\u6027\u3002Etcd\u53ef\u4e0eMaster\u7ec4\u4ef6\u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\uff0c\u5927\u89c4\u6a21\u96c6\u7fa4\u73af\u5883\u4e0b\u5efa\u8bae\u90e8\u7f72\u5728\u96c6\u7fa4\u5916\uff0c\u5e76\u4e14\u4f7f\u7528\u9ad8\u6027\u80fd\u670d\u52a1\u5668\u6765\u63d0\u9ad8Etcd\u7684\u6027\u80fd\u548c\u964d\u4f4eEtcd\u540c\u6b65\u6570\u636e\u7684\u5ef6\u8fdf\u3002</li> </ul>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#5node\u8282\u70b9","title":"5.Node\u8282\u70b9","text":"<p>Node\u8282\u70b9\u4e5f\u88ab\u79f0\u4e3aWorker\u3001Node\u548cMinion\uff0c\u662f\u4e3b\u8981\u8d1f\u8d23\u90e8\u7f72\u5bb9\u5668\uff08\u5de5\u4f5c\u8d1f\u8f7d\uff09\u7684\u5355\u673a\uff08\u6216\u865a\u62df\u673a\uff09\uff0c\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u5fc5\u987b\u5177\u5907\u5bb9\u5668\u7684Runtime\uff08\u8fd0\u884c\u65f6\uff09\uff0c\u6bd4\u5982Docker\u6216\u5176\u4ed6\u9075\u5faaCRI\u6807\u51c6\u7684Runtime\u7b49\u3002</p> <p>Kubelet\u4f5c\u4e3a\u5b88\u62a4\u8fdb\u7a0b\u8fd0\u884c\u5728Node\u8282\u70b9\u4e0a\uff0c\u8d1f\u8d23\u76d1\u542c\u8be5\u8282\u70b9\u4e0a\u6240\u6709\u7684Pod\uff0c\u540c\u65f6\u8d1f\u8d23\u4e0a\u62a5\u8be5\u8282\u70b9\u4e0a\u6240\u6709Pod\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u786e\u4fdd\u8282\u70b9\u4e0a\u7684\u6240\u6709\u5bb9\u5668\u90fd\u80fd\u6b63\u5e38\u8fd0\u884c\u3002\u5f53Node\u8282\u70b9\u5b95\u673a\u6216\u6545\u969c\uff08NotReady\u72b6\u6001\uff09\u65f6\uff0c\u8be5\u8282\u70b9\u4e0a\u8fd0\u884c\u7684Pod\u4f1a\u88ab\u81ea\u52a8\u8f6c\u79fb\u5230\u5176\u4ed6\u8282\u70b9\u4e0a\u3002</p> <p>Node\u8282\u70b9\u5305\u62ec\uff1a</p> <ul> <li>Kubelet\uff1a\u8d1f\u8d23\u4e0eMaster\u901a\u4fe1\u534f\u4f5c\uff0c\u7ba1\u7406\u8be5\u8282\u70b9\u4e0a\u7684Pod\uff0c\u5bf9\u5bb9\u5668\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\u53ca\u76d1\u63a7\uff0c\u540c\u65f6\u8d1f\u8d23\u4e0a\u62a5\u8282\u70b9\u548c\u8282\u70b9\u4e0a\u9762Pod\u7684\u72b6\u6001\u3002</li> <li>Kube-Proxy\uff1a\u8d1f\u8d23\u5404Pod\u4e4b\u95f4\u7684\u901a\u4fe1\u548c\u8d1f\u8f7d\u5747\u8861\uff0c\u5c06\u6307\u5b9a\u7684\u6d41\u91cf\u5206\u53d1\u5230\u540e\u7aef\u6b63\u786e\u7684\u673a\u5668\u4e0a\u3002</li> <li>Docker Engine\uff1aDocker\u5f15\u64ce\uff0c \u8d1f\u8d23\u5bf9\u5bb9\u5668\u7684\u7ba1\u7406\u3002</li> </ul> <p>\u5176\u4ed6\u7ec4\u4ef6\u53ca\u5de5\u5177\uff1a</p> <ul> <li>CoreDNS\uff1a\u7528\u4e8eKubernetes\u96c6\u7fa4\u5185\u90e8Service\u7684\u89e3\u6790\uff0c\u53ef\u4ee5\u8ba9Pod\u628aService\u540d\u79f0\u89e3\u6790\u6210Service\u7684IP\uff0c\u7136\u540e\u901a\u8fc7Service\u7684IP\u5730\u5740\u8fde\u63a5\u5230\u5bf9\u5e94\u7684\u5e94\u7528\u4e0a\u3002</li> <li>Calico\uff1a\u7b26\u5408CNI\u6807\u51c6\u7684\u4e00\u4e2a\u7f51\u7edc\u63d2\u4ef6\uff0c\u5b83\u8d1f\u8d23\u7ed9\u6bcf\u4e2aPod\u5206\u914d\u4e00\u4e2a\u4e0d\u4f1a\u91cd\u590d\u7684IP\uff0c\u5e76\u4e14\u628a\u6bcf\u4e2a\u8282\u70b9\u5f53\u4f5c\u4e00\u4e2a\u201c\u8def\u7531\u5668\u201d\uff0c\u8fd9\u6837\u4e00\u4e2a\u8282\u70b9\u7684Pod\u5c31\u53ef\u4ee5\u901a\u8fc7IP\u5730\u5740\u8bbf\u95ee\u5176\u4ed6\u8282\u70b9\u7684Pod\u3002</li> </ul>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#6pod\u7684\u6982\u5ff5","title":"6.Pod\u7684\u6982\u5ff5","text":"<p>Kubernetes\u6700\u5c0f\u7684\u5355\u5143-Pod\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#61-\u4ec0\u4e48\u662fpod","title":"6.1 \u4ec0\u4e48\u662fPod","text":"<p>1\uff0e\u5148\u4ece\u4f7f\u7528\u65b9\u6765\u770b</p> <p>\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u5355\u4e2a\u5bb9\u5668\u662f\u65e0\u6cd5\u5355\u72ec\u6765\u652f\u6491\u6211\u4eec\u7684\u5e94\u7528\uff0c\u5f80\u5f80\u9700\u8981\u5f88\u591a\u5fae\u670d\u52a1\u624d\u80fd\u7ec4\u6210\u4e00\u4e2a\u7cfb\u7edf\uff0c\u5e76\u4e14\u8fd8\u4f1a\u5b58\u5728A\u670d\u52a1\u4f9d\u8d56B\u670d\u52a1\uff0cB\u670d\u52a1\u9700\u8981\u548cC\u670d\u52a1\u5171\u7528\u67d0\u4e2a\u76ee\u5f55\uff0c\u5b9e\u73b0\u6570\u636e\u5171\u4eab\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u4f7f\u7528\u88f8\u5bb9\u5668\u65f6\uff0c\u5f88\u96be\u5b9e\u73b0\u5bf9\u5bb9\u5668\u5185\u8fdb\u7a0b\u7684\u5065\u5eb7\u68c0\u67e5\u53ca\u6a2a\u5411\u6269\u5bb9\u7b49\uff0c\u800cPod\u53ef\u4ee5\u8f7b\u8f7b\u677e\u677e\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002</p> <p>2\uff0e\u518d\u4eceKubernetes\u89d2\u5ea6\u770b</p> <p>Docker\u53ea\u662f\u5bb9\u5668Runtime\uff08\u8fd0\u884c\u65f6\uff09\u4e2d\u7684\u4e00\u79cd\uff0c\u5e02\u9762\u4e0a\u8fd8\u6709\u5f88\u591a\u5bb9\u5668\u7684Runtime\uff0c\u6bd4\u5982Rkt\u3001CRI-O\u7b49\uff0c\u800cKubernetes\u4f5c\u4e3a\u76ee\u524d\u6700\u6d41\u884c\u7684\u5bb9\u5668\u7f16\u6392\u5de5\u5177\uff0c \u9700\u8981\u652f\u6301\u5404\u4e2aRuntime\u5e76\u4e14\u4e0d\u4f9d\u8d56\u4e8e\u5e95\u5c42Runtime\u7684\u5b9e\u73b0\u6280\u672f\uff0c\u4e8e\u662f\u5c31\u62bd\u8c61\u4e86Pod\u8fd9\u4e2a\u6982\u5ff5\uff0c\u7528\u4e8e\u7ba1\u7406\u591a\u4e2a\u7d27\u5bc6\u76f8\u8fde\u7684\u7b26\u5408CRI\u6807\u51c6\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u4ece\u56fe4.2\u6765\u7406\u89e3Pod\u3002</p> <p></p> <p>\u56fe4.2Pod\u56fe</p> <p>\u7531\u56fe\u53ef\u77e5\uff0cPod\u53ef\u7b80\u5355\u5730\u7406\u89e3\u4e3a\u4e00\u7ec4\u3001\u4e00\u4e2a\u6216\u591a\u4e2a\u5bb9\u5668\uff0c\u6bcf\u4e2aPod\u8fd8\u5305\u542b\u4e00\u4e2aPause\u5bb9\u5668\uff0cPause\u5bb9\u5668\u662fPod\u7684\u7236\u5bb9\u5668\uff0c\u5b83\u4e3b\u8981\u8d1f\u8d23\u50f5\u5c38\u8fdb\u7a0b\u7684\u56de\u6536\u7ba1\u7406\uff0c \u901a\u8fc7Pause\u5bb9\u5668\u53ef\u4ee5\u4f7f\u540c\u4e00\u4e2aPod\u91cc\u9762\u7684\u4e0d\u540c\u5bb9\u5668\u5171\u4eab\u5b58\u50a8\u3001\u7f51\u7edc\u3001PID\u3001IPC\u7b49\uff0c\u5bb9\u5668\u4e4b\u95f4\u53ef\u4ee5\u4f7f\u7528<code>localhost:port</code>\u76f8\u4e92\u8bbf\u95ee\uff0c\u53ef\u4ee5\u4f7f\u7528Volume\u7b49\u5b9e\u73b0\u6570\u636e\u5171\u4eab\u3002</p> <p>\u6839\u636eDocker\u7684\u6784\u9020\uff0cPod\u53ef\u88ab\u5efa\u6a21\u4e3a\u4e00\u7ec4\u5177\u6709\u5171\u4eab\u547d\u540d\u7a7a\u95f4\u3001\u5377\u3001IP\u5730\u5740\u548c\u7aef\u53e3\u7684\u5bb9\u5668\u3002</p> <p>\u4f7f\u7528\u88f8\u5bb9\u5668\u65f6\uff0c\u9700\u8981\u5c06\u5bb9\u5668\u5185\u5e94\u7528\u7a0b\u5e8f\u7684\u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\uff0c\u5982\u679c\u5bb9\u5668\u8fc7\u591a\uff0c\u7aef\u53e3\u7ba1\u7406\u5c31\u4f1a\u6bd4\u8f83\u56f0\u96be\uff0c\u800c\u4e14\u5bb9\u6613\u5f15\u8d77\u7aef\u53e3\u51b2\u7a81\u3002</p> <p>\u800cKubernetes\u4e3a\u6bcf\u4e2aPod\u90fd\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684IP\u5730\u5740\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\uff0c\u4e4b\u540e\u901a\u8fc7Kubernetes\u7684\u5185\u90e8Service\u8fdb\u884c\u8bbf\u95ee\uff0c\u8fd9\u6837\u5c31\u907f\u514d\u4e86\u53d1\u751f\u7aef\u53e3\u51b2\u7a81\u7684\u95ee\u9898\u3002</p> <p>\u548c\u88f8\u5bb9\u5668\u90e8\u7f72\u4e00\u6837\uff0cPod\u5728\u8fd0\u884c\u65f6\u4e5f\u4f1a\u6709\u4e0d\u540c\u7684\u72b6\u6001\uff0cPod\u7684\u72b6\u6001\u4fe1\u606f\u4fdd\u5b58\u5728PodStatus\u5bf9\u8c61\u4e2d\uff0c\u5728PodStatus\u4e2d\u6709\u4e00\u4e2aPhase\u5b57\u6bb5\uff0c\u7528\u4e8e\u63cf\u8ff0Pod\u5728\u5176\u751f\u547d\u5468\u671f\u4e2d\u7684\u4e0d\u540c\u72b6\u6001\u3002\u53ef\u4ee5\u4f7f\u7528Kubernetes\u7684\u5ba2\u6237\u7aef\u5de5\u5177Kubectl\u67e5\u770b\u67d0\u4e2aPod\u7684Phase\u5b57\u6bb5\uff0c\u6bd4\u5982\u67e5\u770bkube-system\u547d\u540d\u7a7a\u95f4\u4e0b\u7684metrics-server\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pod -n kube-system -l k8s-app=metrics-server\nNAME                             READY   STATUS    RESTARTS   AGE\nmetrics-server-9cb7dd7bc-88mvk   1/1     Running   0          130d\nmetrics-server-9cb7dd7bc-jfvwq   1/1     Running   0          142d\nmetrics-server-9cb7dd7bc-v9kfz   1/1     Running   0          142d\n\n$ kubectl get pod/metrics-server-9cb7dd7bc-v9kfz -n kube-system -o yaml|grep phase\nphase: Running\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6b64\u65f6Pod\u7684\u72b6\u6001\u662fRunning\uff0c\u5f53\u7136\u72b6\u6001\u4e0d\u4ec5\u4ec5\u53ea\u6709Running\uff0c\u5e38\u89c1\u7684\u72b6\u6001\u5982\u8868</p> \u72b6\u6001 \u8bf4\u660e Pending Pod \u5df2\u88ab Kubernetes \u7cfb\u7edf\u63a5\u53d7\uff0c\u4f46\u6709\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5bb9\u5668\u5c1a\u672a\u521b\u5efa\u4ea6\u672a\u8fd0\u884c\u3002\u6b64\u9636\u6bb5\u5305\u62ec\u7b49\u5f85 Pod \u88ab\u8c03\u5ea6\u7684\u65f6\u95f4\u548c\u901a\u8fc7\u7f51\u7edc\u4e0b\u8f7d\u955c\u50cf\u7684\u65f6\u95f4\uff0c Running Pod \u5df2\u7ecf\u7ed1\u5b9a\u5230\u4e86\u67d0\u4e2a\u8282\u70b9\uff0cPod \u4e2d\u6240\u6709\u7684\u5bb9\u5668\u90fd\u5df2\u88ab\u521b\u5efa\u3002\u81f3\u5c11\u6709\u4e00\u4e2a\u5bb9\u5668\u4ecd\u5728\u8fd0\u884c\uff0c\u6216\u8005\u6b63\u5904\u4e8e\u542f\u52a8\u6216\u91cd\u542f\u72b6\u6001\u3002 Succeeded Pod \u4e2d\u7684\u6240\u6709\u5bb9\u5668\u90fd\u5df2\u6210\u529f\u7ec8\u6b62\uff0c\u5e76\u4e14\u4e0d\u4f1a\u518d\u91cd\u542f\u3002 Failed Pod \u4e2d\u7684\u6240\u6709\u5bb9\u5668\u90fd\u5df2\u7ec8\u6b62\uff0c\u5e76\u4e14\u81f3\u5c11\u6709\u4e00\u4e2a\u5bb9\u5668\u662f\u56e0\u4e3a\u5931\u8d25\u7ec8\u6b62\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bb9\u5668\u4ee5\u975e 0 \u72b6\u6001\u9000\u51fa\u6216\u8005\u88ab\u7cfb\u7edf\u7ec8\u6b62\u3002 Unknown \u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u65e0\u6cd5\u53d6\u5f97 Pod \u7684\u72b6\u6001\u3002\u8fd9\u79cd\u60c5\u51b5\u901a\u5e38\u662f\u56e0\u4e3a\u4e0e Pod \u6240\u5728\u4e3b\u673a\u901a\u4fe1\u5931\u8d25\u3002 ImagePullBackOff ErrImagePull \u955c\u50cf\u62c9\u53d6\u5931\u8d25\uff0c\u4e00\u822c\u662f\u7531\u4e8e\u7f51\u7edc\u4e0d\u901a\u3001\u955c\u50cf\u4e0d\u5b58\u5728\u3001\u9700\u8981\u8ba4\u8bc1\u5f15\u8d77\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528describe\u547d\u4ee4\u67e5\u770b\u5177\u4f53\u539f\u56e0 CrashLoopBackOff \u5bb9\u5668\u542f\u52a8\u5931\u8d25\uff0c\u53ef\u4ee5\u901a\u8fc7logs\u547d\u4ee4\u67e5\u770b\u5177\u4f53\u539f\u56e0\uff0c\u4e00\u822c\u4e3a\u542f\u52a8\u547d\u4ee4\u4e0d\u6b63\u786e\u3001\u5065\u5eb7\u68c0\u67e5\u4e0d\u901a\u8fc7\u7b49 OOMkilled \u5bb9\u5668\u5185\u5b58\u6ea2\u51fa\uff0c\u4e00\u822c\u662f\u5bb9\u5668\u7684\u5185\u5b58Limit\u8bbe\u7f6e\u5f97\u8fc7\u5c0f\uff0c\u6216\u8005\u7a0b\u5e8f\u672c\u8eab\u5185\u5b58\u6ea2\u51fa\uff0c\u53ef\u4ee5\u901a\u8fc7logs\u67e5\u770b\u7a0b\u5e8f\u7684\u542f\u52a8\u65e5\u5fd7 Terminating Pod\u6b63\u5728\u88ab\u5220\u9664\uff0c\u53ef\u4ee5\u4f7f\u7528describe\u547d\u4ee4\u67e5\u770b\u72b6\u6001 SysctlForbidden Pod\u81ea\u5b9a\u4e49\u4e86\u5185\u6838\u914d\u7f6e\uff0c\u4f46kubelet\u6ca1\u6709\u6dfb\u52a0\u5185\u6838\u914d\u7f6e\u6216\u8005\u914d\u7f6e\u7684\u5185\u6838\u53c2\u6570\u4e0d\u652f\u6301\u53ef\u4ee5\u4f7f\u7528describe\u547d\u4ee4\u67e5\u770b\u5177\u4f53\u539f\u56e0 Completed \u5bb9\u5668\u5185\u90e8\u4e3b\u8fdb\u7a0b\u9000\u51fa\uff0c\u4e00\u822c\u8ba1\u5212\u4efb\u52a1\u7ed3\u675f\u4f1a\u663e\u793a\u8be5\u72b6\u6001\uff0c\u53ef\u4ee5\u901a\u8fc7logs\u67e5\u770b\u5bb9\u5668\u72b6\u6001 ContainerCreating Pod\u6b63\u5728\u521b\u5efa\uff0c\u4e00\u822c\u4e3a\u6b63\u5728\u4e0b\u8f7d\u955c\u50cf\uff0c\u6216\u8005\u6709\u914d\u7f6e\u4e0d\u5f53\u7684\u5730\u65b9\uff0c\u53ef\u4ee5\u4f7f\u7528describe\u547d\u4ee4\u67e5\u770b\u5177\u4f53\u539f\u56e0 <p>\u5c0f\u77e5\u8bc6</p> <p>Pod\u7684Phase\u5b57\u6bb5\u53ea\u6709Pending\u3001Running\u3001Succeeded\u3001Failed\u3001Unknown 5\u79cd\u72b6\u6001\uff0c\u5176\u4f59\u7684\u4e3a\u5904\u4e8e\u4e0a\u8ff0\u72b6\u6001\u7684\u539f\u56e0\uff0c\u53ef\u4ee5\u901a\u8fc7kubectl get po xxx -o yaml\u67e5\u770b</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#62-pod\u63a2\u9488","title":"6.2 Pod\u63a2\u9488","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u8fdb\u7a0b\u6b63\u5e38\u542f\u52a8\u5e76\u4e0d\u4ee3\u8868\u5e94\u7528\u80fd\u6b63\u5e38\u5904\u7406\u8bf7\u6c42\uff0c\u6240\u4ee5\u5408\u7406\u5730\u8bbe\u8ba1\u5e94\u7528\u7684\u5065\u5eb7\u68c0\u67e5\u5c24\u4e3a\u91cd\u8981\u3002\u5728\u4f7f\u7528\u88f8\u673a\u6216\u8005\u88f8\u5bb9\u5668\u90e8\u7f72\u65f6\uff0c\u4e00\u822c\u5f88\u96be\u5bf9\u5e94\u7528\u505a\u5f88\u5b8c\u5584\u7684\u5065\u5eb7\u68c0\u67e5\uff0c\u800cPod\u63d0\u4f9b\u7684\u63a2\u9488\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u7528\u6765\u68c0\u6d4b\u5bb9\u5668\u5185\u7684\u5e94\u7528\u662f\u5426\u6b63\u5e38\u3002</p> <p>\u76ee\u524d\u63a2\u9488\u67093\u79cd\u68c0\u6d4b\u65b9\u5f0f\uff0c\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u5065\u5eb7\u68c0\u67e5\u65b9\u5f0f\u3002\u68c0\u6d4b\u65b9\u5f0f\u5982\u8868\u6240\u793a\u3002</p> <p>Pod\u63a2\u9488\u7684\u5b9e\u73b0\u65b9\u5f0f</p> \u5b9e\u73b0\u65b9\u5f0f \u8bf4\u660e ExecAction \u5728\u5bb9\u5668\u5185\u6267\u884c\u6307\u5b9a\u547d\u4ee4\u3002\u5982\u679c\u547d\u4ee4\u9000\u51fa\u65f6\u8fd4\u56de\u7801\u4e3a 0 \u5219\u8ba4\u4e3a\u8bca\u65ad\u6210\u529f\u3002 TCPSocketAction \u5bf9\u5bb9\u5668\u7684 IP \u5730\u5740\u4e0a\u7684\u6307\u5b9a\u7aef\u53e3\u6267\u884c TCP \u68c0\u67e5\u3002\u5982\u679c\u7aef\u53e3\u6253\u5f00\uff0c\u5219\u8bca\u65ad\u88ab\u8ba4\u4e3a\u662f\u6210\u529f\u7684\u3002 HTTPGetAction \u5bf9\u5bb9\u5668\u7684 IP \u5730\u5740\u4e0a\u6307\u5b9a\u7aef\u53e3\u548c\u8def\u5f84\u6267\u884c HTTP Get \u8bf7\u6c42\u3002\u5982\u679c\u54cd\u5e94\u7684\u72b6\u6001\u7801\u5927\u4e8e\u7b49\u4e8e 200 \u4e14\u5c0f\u4e8e 400\uff0c\u5219\u8bca\u65ad\u88ab\u8ba4\u4e3a\u662f\u6210\u529f\u7684\u3002 <p>\u4e0a\u8ff0\u68c0\u67e5\u65b9\u5f0f\u53ef\u4ee5\u88ab\u5468\u671f\u6027\u6267\u884c\uff0c\u6bcf\u6b21\u68c0\u67e5\u5bb9\u5668\u540e\u53ef\u80fd\u5f97\u5230\u7684\u5bb9\u5668\u72b6\u6001\u5982\u8868</p> <p>Pod\u63a2\u9488\u68c0\u67e5\u5bb9\u5668\u540e\u53ef\u80fd\u5f97\u5230\u7684\u72b6\u6001</p> \u72b6\u6001 \u8bf4\u660e Success\uff08\u6210\u529f\uff09 \u5bb9\u5668\u901a\u8fc7\u4e86\u8bca\u65ad\u3002 Failure\uff08\u5931\u8d25\uff09 \u5bb9\u5668\u672a\u901a\u8fc7\u8bca\u65ad\u3002 Unknown\uff08\u672a\u77e5\uff09 \u8bca\u65ad\u5931\u8d25\uff0c\u56e0\u6b64\u4e0d\u4f1a\u91c7\u53d6\u4efb\u4f55\u884c\u52a8\u3002 <p>Kubelet\u5b9e\u73b0\u4e0a\u8ff0\u68c0\u67e5\u67093\u79cd\u68c0\u6d4b\u65b9\u5f0f\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u591a\u52a0\u5229\u7528\u53ef\u4ee5\u63d0\u9ad8\u5e94\u7528\u7684\u53ef\u7528\u7387\u3002</p> <p>\u76ee\u524d\u652f\u6301\u7684\u63a2\u6d4b\u5668\u7c7b\u578b\u67093\u79cd\uff0c\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u5bf9\u5bb9\u5668\u8fdb\u884c\u68c0\u6d4b\uff0c\u53c2\u8003\u8868</p> <p>\u63a2\u9488\u7684\u79cd\u7c7b</p> \u79cd\u7c7b \u8bf4\u660e livenessProbe \u6307\u793a\u5bb9\u5668\u662f\u5426\u6b63\u5728\u8fd0\u884c\u3002\u5982\u679c\u5b58\u6d3b\u6001\u63a2\u6d4b\u5931\u8d25\uff0c\u5219 kubelet \u4f1a\u6740\u6b7b\u5bb9\u5668\uff0c \u5e76\u4e14\u5bb9\u5668\u5c06\u6839\u636e\u5176\u91cd\u542f\u7b56\u7565\u51b3\u5b9a\u672a\u6765\u3002\u5982\u679c\u5bb9\u5668\u4e0d\u63d0\u4f9b\u5b58\u6d3b\u63a2\u9488\uff0c \u5219\u9ed8\u8ba4\u72b6\u6001\u4e3a Success\u3002 readinessProbe \u6307\u793a\u5bb9\u5668\u662f\u5426\u51c6\u5907\u597d\u4e3a\u8bf7\u6c42\u63d0\u4f9b\u670d\u52a1\u3002\u5982\u679c\u5c31\u7eea\u6001\u63a2\u6d4b\u5931\u8d25\uff0c \u7aef\u70b9\u63a7\u5236\u5668\u5c06\u4ece\u4e0e Pod \u5339\u914d\u7684\u6240\u6709\u670d\u52a1\u7684\u7aef\u70b9\u5217\u8868\u4e2d\u5220\u9664\u8be5 Pod \u7684 IP \u5730\u5740\u3002\u521d\u59cb\u5ef6\u8fdf\u4e4b\u524d\u7684\u5c31\u7eea\u6001\u7684\u72b6\u6001\u503c\u9ed8\u8ba4\u4e3a Failure\u3002 \u5982\u679c\u5bb9\u5668\u4e0d\u63d0\u4f9b\u5c31\u7eea\u6001\u63a2\u9488\uff0c\u5219\u9ed8\u8ba4\u72b6\u6001\u4e3a Success\u3002 startupProbe \u6307\u793a\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u662f\u5426\u5df2\u7ecf\u542f\u52a8\u3002\u5982\u679c\u63d0\u4f9b\u4e86\u542f\u52a8\u63a2\u9488\uff0c\u5219\u6240\u6709\u5176\u4ed6\u63a2\u9488\u90fd\u4f1a\u88ab \u7981\u7528\uff0c\u76f4\u5230\u6b64\u63a2\u9488\u6210\u529f\u4e3a\u6b62\u3002\u5982\u679c\u542f\u52a8\u63a2\u6d4b\u5931\u8d25\uff0ckubelet \u5c06\u6740\u6b7b\u5bb9\u5668\uff0c\u800c\u5bb9\u5668\u4f9d\u5176 \u91cd\u542f\u7b56\u7565\u8fdb\u884c\u91cd\u542f\u3002\u5982\u679c\u5bb9\u5668\u6ca1\u6709\u63d0\u4f9b\u542f\u52a8\u63a2\u6d4b\uff0c\u5219\u9ed8\u8ba4\u72b6\u6001\u4e3a Success\u3002"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#63-pod\u955c\u50cf\u62c9\u53d6\u7b56\u7565\u548c\u91cd\u542f\u7b56\u7565","title":"6.3 Pod\u955c\u50cf\u62c9\u53d6\u7b56\u7565\u548c\u91cd\u542f\u7b56\u7565","text":"<p>\u5728\u53d1\u5e03\u5e94\u7528\u6216\u66f4\u6539\u63a7\u5236\u5668\u914d\u7f6e\u65f6\uff0c\u4f1a\u89e6\u53d1Pod\u7684\u6eda\u52a8\u66f4\u65b0\uff0c\u6b64\u65f6\u9488\u5bf9\u5bb9\u5668\u7684\u955c\u50cf\u6709\u4e0d\u540c\u7684\u62c9\u53d6\u65b9\u5f0f</p> <p>\u955c\u50cf\u62c9\u53d6\u7b56\u7565</p> <pre><code>    spec:\ncontainers:\n- name:  copycat\nimage: hub.gitee.cc/gitee_ci/copycat:v2.0.0\nimagePullPolicy: Always\nresources:\n......\n</code></pre> \u64cd\u4f5c\u65b9\u5f0f \u8bf4\u660e Always \u4e0d\u7ba1\u955c\u50cf\u662f\u5426\u5b58\u5728\u90fd\u4f1a\u8fdb\u884c\u4e00\u6b21\u62c9\u53d6\u3002 Never \u4e0d\u7ba1\u955c\u50cf\u662f\u5426\u5b58\u5728\u90fd\u4e0d\u4f1a\u8fdb\u884c\u62c9\u53d6\u3002 IfNotPresent \u53ea\u6709\u955c\u50cf\u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u4f1a\u8fdb\u884c\u62c9\u53d6 <p>Pod\u8fdb\u884c\u90e8\u7f72\u6216\u8fd0\u884c\u65f6\uff0c\u96be\u514d\u4f1a\u51fa\u73b0\u6545\u969c\uff0c\u5bf9\u4e8e\u6545\u969cPod\u4e5f\u6709\u4e0d\u540c\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u5982\u8868</p> <p>Pod\u91cd\u542f\u7b56\u7565</p> \u64cd\u4f5c\u65b9\u5f0f \u8bf4\u660e Always \u4f46\u51e1Pod\u5bf9\u8c61\u7ec8\u6b62\u5c31\u5c06\u5176\u91cd\u542f\uff0c\u6b64\u4e3a\u9ed8\u8ba4\u8bbe\u5b9a\u3002 OnFailure \u4ec5\u5728Pod\u5bf9\u8c61\u51fa\u73b0\u9519\u8bef\u65f6\u65b9\u624d\u5c06\u5176\u91cd\u542f\u3002 Never \u4ece\u4e0d\u91cd\u542f\u3002 <p>Warning</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0crestartPolicy\u9002\u7528\u4e8ePod\u5bf9\u8c61\u4e2d\u7684\u6240\u6709\u5bb9\u5668\uff0c\u800c\u4e14\u5b83\u4ec5\u7528\u4e8e\u63a7\u5236\u5728\u540c\u4e00\u8282\u70b9\u4e0a\u91cd\u65b0\u542f\u52a8Pod\u5bf9\u8c61\u7684\u76f8\u5173\u5bb9\u5668\u3002</p> <p>\u9996\u6b21\u9700\u8981\u91cd\u542f\u7684\u5bb9\u5668\uff0c\u5c06\u5728\u5176\u9700\u8981\u65f6\u7acb\u5373\u8fdb\u884c\u91cd\u542f\uff0c\u968f\u540e\u518d\u6b21\u9700\u8981\u91cd\u542f\u7684\u64cd\u4f5c\u5c06\u7531kubelet\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u540e\u8fdb\u884c\uff0c \u4e14\u53cd\u590d\u7684\u91cd\u542f\u64cd\u4f5c\u7684\u5ef6\u8fdf\u65f6\u957f\u4f9d\u6b21\u4e3a10\u79d2\u300120\u79d2\u300140\u79d2\u300180\u79d2\u3001160\u79d2\u548c300\u79d2\uff0c300\u79d2\u662f\u6700\u5927\u5ef6\u8fdf\u65f6\u957f\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u4e00\u65e6\u7ed1\u5b9a\u5230\u4e00\u4e2a\u8282\u70b9\uff0cPod\u5bf9\u8c61\u5c06\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u91cd\u65b0\u7ed1\u5b9a\u5230\u53e6\u4e00\u4e2a\u8282\u70b9\uff0c\u5b83\u8981\u4e48\u88ab\u91cd\u542f\uff0c\u8981\u4e48\u7ec8\u6b62\uff0c\u76f4\u5230\u8282\u70b9\u53d1\u751f\u6545\u969c\u6216\u88ab\u5220\u9664\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#64-\u521b\u5efa\u4e00\u4e2apod","title":"6.4 \u521b\u5efa\u4e00\u4e2aPod","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5f88\u5c11\u5355\u72ec\u8fd0\u884c\u4e00\u4e2aPod\uff0c\u56e0\u4e3a\u5355\u72ec\u521b\u5efa\u7684Pod\u5e76\u4e0d\u80fd\u5b9e\u73b0\u4e00\u4e9b\u9ad8\u7ea7\u7684\u53d1\u5e03\u7b56\u7565\uff0c\u6240\u4ee5\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\u7ecf\u5e38\u4f1a\u7528Deployment\u3001DaemonSet\u3001StatefulSet\u7b49\u9ad8\u7ea7\u63a7\u5236\u5668\u8c03\u5ea6\u5e76\u7ba1\u7406Pod\u3002</p> <p>\u5f53\u7136\u6709\u65f6\u5019\u4e5f\u4f1a\u5355\u72ec\u542f\u52a8\u4e00\u4e2aPod\u7528\u4e8e\u6d4b\u8bd5\u4e1a\u52a1\u7b49\uff0c\u6b64\u65f6\u53ef\u4ee5\u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6Pod\u3002\u521b\u5efa\u4e00\u4e2aPod\u7684\u6807\u51c6\u683c\u5f0f\u5982\u4e0b\uff08\u4e0b\u9762\u5b9a\u4e49\u7684\u5185\u5bb9\u53ef\u4ee5\u76f4\u63a5\u7528\u5728Deployment\u3001DaemonSet\u3001StatefulSet\u4e2d\uff09\uff1a</p> <pre><code>apiVersion: v1 # \u5fc5\u9009\uff0cAPI\u7684\u7248\u672c\u53f7\nkind: Pod       # \u5fc5\u9009\uff0c\u7c7b\u578bPod\nmetadata:       # \u5fc5\u9009\uff0c\u5143\u6570\u636e\nname: nginx   # \u5fc5\u9009\uff0c\u7b26\u5408RFC 1035\u89c4\u8303\u7684Pod\u540d\u79f0\nnamespace: default # \u53ef\u9009\uff0cPod\u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u4e3adefault\uff0c\u53ef\u4ee5\u4f7f\u7528-n \u6307\u5b9anamespace\nlabels:       # \u53ef\u9009\uff0c\u6807\u7b7e\u9009\u62e9\u5668\uff0c\u4e00\u822c\u7528\u4e8e\u8fc7\u6ee4\u548c\u533a\u5206Pod\napp: nginx\nrole: frontend # \u53ef\u4ee5\u5199\u591a\u4e2a\nannotations:  # \u53ef\u9009\uff0c\u6ce8\u91ca\u5217\u8868\uff0c\u53ef\u4ee5\u5199\u591a\u4e2a\napp: nginx\nspec:   # \u5fc5\u9009\uff0c\u7528\u4e8e\u5b9a\u4e49\u5bb9\u5668\u7684\u8be6\u7ec6\u4fe1\u606f\ninitContainers: # \u521d\u59cb\u5316\u5bb9\u5668\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u6267\u884c\u7684\u4e00\u4e9b\u521d\u59cb\u5316\u64cd\u4f5c\n- command:\n- sh\n- -c\n- echo \"I am InitContainer for init some configuration\"\nimage: busybox\nimagePullPolicy: IfNotPresent\nname: init-container\ncontainers:   # \u5fc5\u9009\uff0c\u5bb9\u5668\u5217\u8868\n- name: nginx # \u5fc5\u9009\uff0c\u7b26\u5408RFC 1035\u89c4\u8303\u7684\u5bb9\u5668\u540d\u79f0\nimage: nginx:latest    # \u5fc5\u9009\uff0c\u5bb9\u5668\u6240\u7528\u7684\u955c\u50cf\u7684\u5730\u5740\nimagePullPolicy: Always     # \u53ef\u9009\uff0c\u955c\u50cf\u62c9\u53d6\u7b56\u7565\ncommand: # \u53ef\u9009\uff0c\u5bb9\u5668\u542f\u52a8\u6267\u884c\u7684\u547d\u4ee4\n- nginx\n- -g\n- \"daemon off;\"\nworkingDir: /usr/share/nginx/html       # \u53ef\u9009\uff0c\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55\nvolumeMounts:   # \u53ef\u9009\uff0c\u5b58\u50a8\u5377\u914d\u7f6e\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\n- name: webroot # \u5b58\u50a8\u5377\u540d\u79f0\nmountPath: /usr/share/nginx/html # \u6302\u8f7d\u76ee\u5f55\nreadOnly: true        # \u53ea\u8bfb\nports:  # \u53ef\u9009\uff0c\u5bb9\u5668\u9700\u8981\u66b4\u9732\u7684\u7aef\u53e3\u53f7\u5217\u8868\n- name: http    # \u7aef\u53e3\u540d\u79f0\ncontainerPort: 80     # \u7aef\u53e3\u53f7\nprotocol: TCP # \u7aef\u53e3\u534f\u8bae\uff0c\u9ed8\u8ba4TCP\nenv:    # \u53ef\u9009\uff0c\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u5217\u8868\n- name: TZ      # \u53d8\u91cf\u540d\nvalue: Asia/Shanghai # \u53d8\u91cf\u7684\u503c\n- name: LANG\nvalue: en_US.utf8\nresources:      # \u53ef\u9009\uff0c\u8d44\u6e90\u9650\u5236\u548c\u8d44\u6e90\u8bf7\u6c42\u9650\u5236\nlimits:       # \u6700\u5927\u9650\u5236\u8bbe\u7f6e\ncpu: 1000m\nmemory: 1024Mi\nrequests:     # \u542f\u52a8\u6240\u9700\u7684\u8d44\u6e90\ncpu: 100m\nmemory: 512Mi\n#    startupProbe: # \u53ef\u9009\uff0c\u68c0\u6d4b\u5bb9\u5668\u5185\u8fdb\u7a0b\u662f\u5426\u5b8c\u6210\u542f\u52a8\u3002\u6ce8\u610f\u4e09\u79cd\u68c0\u67e5\u65b9\u5f0f\u540c\u65f6\u53ea\u80fd\u4f7f\u7528\u4e00\u79cd\u3002\n#      httpGet:      # httpGet\u68c0\u6d4b\u65b9\u5f0f\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528httpGet\u5b9e\u73b0\u63a5\u53e3\u7ea7\u5065\u5eb7\u68c0\u67e5\uff0c\u5065\u5eb7\u68c0\u67e5\u7531\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u3002\n#            path: /api/successStart # \u68c0\u67e5\u8def\u5f84\n#            port: 80\nreadinessProbe: # \u53ef\u9009\uff0c\u5065\u5eb7\u68c0\u67e5\u3002\u6ce8\u610f\u4e09\u79cd\u68c0\u67e5\u65b9\u5f0f\u540c\u65f6\u53ea\u80fd\u4f7f\u7528\u4e00\u79cd\u3002\nhttpGet:      # httpGet\u68c0\u6d4b\u65b9\u5f0f\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528httpGet\u5b9e\u73b0\u63a5\u53e3\u7ea7\u5065\u5eb7\u68c0\u67e5\uff0c\u5065\u5eb7\u68c0\u67e5\u7531\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u3002\npath: / # \u68c0\u67e5\u8def\u5f84\nport: 80        # \u76d1\u63a7\u7aef\u53e3\nlivenessProbe:  # \u53ef\u9009\uff0c\u5065\u5eb7\u68c0\u67e5\n#exec:        # \u6267\u884c\u5bb9\u5668\u547d\u4ee4\u68c0\u6d4b\u65b9\u5f0f\n#command:\n#- cat\n#- /health\n#httpGet:       # httpGet\u68c0\u6d4b\u65b9\u5f0f\n#   path: /_health # \u68c0\u67e5\u8def\u5f84\n#   port: 8080\n#   httpHeaders: # \u68c0\u67e5\u7684\u8bf7\u6c42\u5934\n#   - name: end-user\n#     value: Jason\ntcpSocket:    # \u7aef\u53e3\u68c0\u6d4b\u65b9\u5f0f\nport: 80\ninitialDelaySeconds: 60       # \u521d\u59cb\u5316\u65f6\u95f4\ntimeoutSeconds: 2     # \u8d85\u65f6\u65f6\u95f4\nperiodSeconds: 5      # \u68c0\u6d4b\u95f4\u9694\nsuccessThreshold: 1   # \u68c0\u67e5\u6210\u529f\u4e3a1\u6b21\u8868\u793a\u5c31\u7eea\nfailureThreshold: 2   # \u68c0\u6d4b\u5931\u8d252\u6b21\u8868\u793a\u672a\u5c31\u7eea\nlifecycle:\npostStart: # \u5bb9\u5668\u521b\u5efa\u5b8c\u6210\u540e\u6267\u884c\u7684\u6307\u4ee4, \u53ef\u4ee5\u662fexec httpGet TCPSocket\nexec:\ncommand:\n- sh\n- -c\n- 'mkdir /data/ '\npreStop:\nhttpGet:\npath: /\nport: 80\n#  exec:\n#    command:\n#    - sh\n#    - -c\n#    - sleep 9\nrestartPolicy: Always   # \u53ef\u9009\uff0c\u9ed8\u8ba4\u4e3aAlways\n#nodeSelector: # \u53ef\u9009\uff0c\u6307\u5b9aNode\u8282\u70b9\n#      region: subnet7\nimagePullSecrets:     # \u53ef\u9009\uff0c\u62c9\u53d6\u955c\u50cf\u4f7f\u7528\u7684secret\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\n- name: default-dockercfg-86258\nhostNetwork: false    # \u53ef\u9009\uff0c\u662f\u5426\u4e3a\u4e3b\u673a\u6a21\u5f0f\uff0c\u5982\u662f\uff0c\u4f1a\u5360\u7528\u4e3b\u673a\u7aef\u53e3\nvolumes:      # \u5171\u4eab\u5b58\u50a8\u5377\u5217\u8868\n- name: webroot # \u540d\u79f0\uff0c\u4e0e\u4e0a\u8ff0\u5bf9\u5e94\nemptyDir: {}    # \u6302\u8f7d\u76ee\u5f55\n#hostPath:              # \u6302\u8f7d\u672c\u673a\u76ee\u5f55\n#  path: /etc/hosts\n</code></pre> <p>\u8303\u4f8b</p> <p>\u8be5YAML\u6587\u4ef6\u5b9a\u4e49\u7684\u662f\u4e00\u4e9b\u6bd4\u8f83\u5e38\u7528\u7684\u914d\u7f6e\uff0c\u540e\u7eed\u7684\u7ae0\u8282\u4f1a\u6269\u5c55\u66f4\u591a\u914d\u7f6e\u9879\u3002\u5bf9\u4e8eYAML\u7684\u8bed\u6cd5\u4e0d\u719f\u7684\u8bfb\u8005\u53ef\u4ee5\u7b80\u5355\u5b66\u4e60\u4e00\u4e0b\u3002</p> <p>\u53ef\u4ee5\u5728Kubernetes\u96c6\u7fa4\u4e2d\u4f7f\u7528kubectl\u521b\u5efa\u8be5Pod\uff1a</p> <pre><code>$ kubectl apply -f pod.yml\npod/nginx created\n</code></pre> <p>\u4e0a\u8ff0pod.yaml\u5b9a\u4e49\u4e86labels\u5b57\u6bb5\uff0c\u53ef\u4ee5\u6839\u636e\u8be5\u6807\u7b7e\u8fc7\u6ee4\u67e5\u770b\u8be5Pod\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pod -n default -l app=nginx\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   0/1     Running   0          86s\n</code></pre> <p>\u5f53\u4e0d\u518d\u4f7f\u7528\u8be5Pod\u65f6\uff0c\u53ef\u4ee5\u5220\u9664\u8be5Pod\uff08\u7531\u4e8e\u662f\u5355\u72ec\u521b\u5efa\u7684Pod\uff0c\u5220\u9664\u540e\u4e0d\u4f1a\u91cd\u5efa\uff0c\u9ad8\u7ea7\u63a7\u5236\u5668\u5220\u9664\u540e\u4f1a\u81ea\u52a8\u91cd\u5efa\uff09\uff1a</p> <pre><code>$ kubectl delete pod/nginx\npod \"nginx\" deleted\n\n$ kubectl get pod -n default -l app=nginx\nNo resources found in default namespace.\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#65-pod-\u6392\u9519","title":"6.5 Pod \u6392\u9519","text":"<p>\u6392\u67e5\u8fc7\u7a0b\u5e38\u7528\u7684\u547d\u540d\u5982\u4e0b:</p> <ul> <li> <p>\u67e5\u770b Pod \u72b6\u6001: <code>kubectl get pod &lt;pod-name&gt; -o wide</code></p> </li> <li> <p>\u67e5\u770b Pod \u7684 yaml \u914d\u7f6e: <code>kubectl get pod &lt;pod-name&gt; -o yaml</code></p> </li> <li> <p>\u67e5\u770b Pod \u4e8b\u4ef6: <code>kubectl describe pod &lt;pod-name&gt;</code></p> </li> <li> <p>\u67e5\u770b\u5bb9\u5668\u65e5\u5fd7: <code>kubectl logs &lt;pod-name&gt; [-c &lt;container-name&gt;]</code></p> </li> </ul> <p>\u53c2\u8003\u6587\u732e</p> <p>Pod \u6392\u9519</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Kubernetes%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/#6\u5c0f\u7ed3","title":"6.\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u4e3b\u8981\u662f\u5bf9Kubernetes\u7684\u57fa\u7840\u548cPod\u8fdb\u884c\u7b80\u5355\u7684\u4e86\u89e3\u3002 \u63a5\u4e0b\u6765\uff0c\u5bf9\u4e8e\u66f4\u9ad8\u7ea7\u8c03\u5ea6\u8d44\u6e90\u7684\u4f7f\u7528\u548c\u914d\u7f6e\u90fd\u662f\u57fa\u4e8ePod\u7684\u5b9a\u4e49\u5c55\u5f00\u7684\uff0c\u6240\u4ee5\u5bf9\u4e8ePod\u7684\u5b66\u4e60\u5c24\u4e3a\u91cd\u8981\uff0c\u540c\u65f6\u5bf9\u4e8ePod\u7684\u8d44\u6e90\u5b9a\u4e49\u5728\u540e\u9762\u7684\u8c03\u5ea6\u8d44\u6e90\u4e2d\u90fd\u662f\u901a\u7528\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u4e00\u4e2aPod\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u5bb9\u5668\uff0c\u4f46\u662f\u4e00\u4e2a\u5bb9\u5668\u4e0d\u8981\u914d\u7f6e\u591a\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u662f\u975e\u5e38\u4e0d\u63a8\u8350\u7684\u7528\u6cd5\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/","title":"Kubernetes\u8c03\u5ea6\u57fa\u7840","text":"<p>\u5bf9\u4e8eKubernetes\u7684\u5e94\u7528\u90e8\u7f72\uff0c\u6211\u4eec\u4e4b\u524d\u63d0\u5230\u8fc7Pod\u5c31\u662f\u7528\u6765\u914d\u7f6e\u5bb9\u5668\u7684\uff0c\u5bb9\u5668\u5c31\u662f\u7528\u6765\u8fd0\u884c\u5e94\u7528\u7684\u3002</p> <p>\u4e5f\u63d0\u5230\u8fc7\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u4e0d\u4f1a\u521b\u5efa\u5355\u72ec\u7684Pod\u8fd0\u884c\u5e94\u7528\uff0c\u800c\u662f\u4f7f\u7528\u66f4\u9ad8\u7ea7\u7684\u8d44\u6e90\u8fdb\u884c\u8c03\u5ea6\uff0c\u6bd4\u5982Deployment\u7b49\u3002</p> <p>\u672c\u7ae0\u7684\u5185\u5bb9\u5c31\u662f\u8bb2\u89e3Kubernetes\u539f\u751f\u7684\u8c03\u5ea6\u8d44\u6e90\uff0c \u5728\u8bb2\u89e3\u9ad8\u7ea7\u8d44\u6e90Deployment\u3001StatefulSet\u4e4b\u524d\uff0c\u9996\u5148\u4f1a\u4ecb\u7ecd\u4ec0\u4e48\u662f Replication Controller\u548cReplicaSet\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#1replication-controller\u548creplicaset","title":"1.Replication Controller\u548cReplicaSet","text":"<p>Replication Controller\uff08\u590d\u5236\u63a7\u5236\u5668\uff0cRC\uff09\u548cReplicaSet\uff08\u590d\u5236\u96c6\uff0cRS\uff09\u662f\u4e24\u79cd\u7b80\u5355\u90e8\u7f72Pod\u7684\u65b9\u5f0f\u3002</p> <p>\u56e0\u4e3a\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4e3b\u8981\u4f7f\u7528\u66f4\u9ad8\u7ea7\u7684Deployment\u7b49\u65b9\u5f0f\u8fdb\u884cPod\u7684\u7ba1\u7406\u548c\u90e8\u7f72\uff0c\u6240\u4ee5\u672c\u8282\u53ea\u5bf9Replication Controller\u548cReplica Set\u7684\u90e8\u7f72\u65b9\u5f0f\u8fdb\u884c\u7b80\u5355\u4ecb\u7ecd\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#11-replication-controller","title":"1.1 Replication Controller","text":"<p>Replication Controller\u53ef\u4ee5\u786e\u4fddPod\u526f\u672c\u6570\u8fbe\u5230\u671f\u671b\u503c\uff0c\u4e5f\u5c31\u662fRC\u5b9a\u4e49\u7684\u6570\u91cf\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cReplication Controller\u53ef\u4ee5\u786e\u4fdd\u4e00\u4e2aPod\u6216\u4e00\u7ec4\u540c\u7c7bPod\u603b\u662f\u53ef\u7528\u7684\u3002\u5982\u679c\u5b58\u5728\u7684Pod\u5927\u4e8e\u8bbe\u5b9a\u7684\u503c\uff0c\u5219Replication Controller\u5c06\u7ec8\u6b62\u989d\u5916\u7684Pod\u3002</p> <p>\u5982\u679c\u592a\u5c0f\uff0cReplication Controller\u5c06\u542f\u52a8\u66f4\u591a\u7684Pod\u7528\u4e8e\u4fdd\u8bc1\u8fbe\u5230\u671f\u671b\u503c\u3002\u4e0e\u624b\u52a8\u521b\u5efaPod\u4e0d\u540c\u7684\u662f\uff0c\u7528Replication Controller\u7ef4\u62a4\u7684Pod\u5728\u5931\u8d25\u3001\u5220\u9664\u6216\u7ec8\u6b62\u65f6\u4f1a\u81ea\u52a8\u66ff\u6362\u3002</p> <p>\u56e0\u6b64\uff0c\u5373\u4f7f\u5e94\u7528\u7a0b\u5e8f\u53ea\u9700\u8981\u4e00\u4e2aPod\uff0c\u4e5f\u5e94\u8be5\u4f7f\u7528Replication Controller\u6216\u5176\u4ed6\u65b9\u5f0f\u7ba1\u7406\u3002Replication Controller\u7c7b\u4f3c\u4e8e\u8fdb\u7a0b\u7ba1\u7406\u7a0b\u5e8f\uff0c\u4f46\u662fReplication Controller\u4e0d\u662f\u76d1\u89c6\u5355\u4e2a\u8282\u70b9\u4e0a\u7684\u5404\u4e2a\u8fdb\u7a0b\uff0c\u800c\u662f\u76d1\u89c6\u591a\u4e2a\u8282\u70b9\u4e0a\u7684\u591a\u4e2aPod\u3002</p> <p>\u5b9a\u4e49\u4e00\u4e2aReplication Controller\u7684\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: v1\nkind: ReplicationController\nmetadata:\nname: nginx\nspec:\nreplicas: 3\nselector:\napp: nginx\ntemplate:\nmetadata:\nname: nginx\nlabels:\napp: nginx\nspec:\ncontainers:\n- name: nginx\nimage: nginx\nports:\n- containerPort: 80\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#12-replicaset","title":"1.2 ReplicaSet","text":"<p>ReplicaSet\u662f\u652f\u6301\u57fa\u4e8e\u96c6\u5408\u7684\u6807\u7b7e\u9009\u62e9\u5668\u7684\u4e0b\u4e00\u4ee3Replication Controller\uff0c\u5b83\u4e3b\u8981\u7528\u4f5cDeployment\u534f\u8c03\u521b\u5efa\u3001\u5220\u9664\u548c\u66f4\u65b0Pod\uff0c\u548cReplication Controller\u552f\u4e00\u7684\u533a\u522b\u662f\uff0cReplicaSet\u652f\u6301\u6807\u7b7e\u9009\u62e9\u5668\u3002</p> <p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u867d\u7136ReplicaSet\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u4f46\u662f\u4e00\u822c\u5efa\u8bae\u4f7f\u7528Deployment\u6765\u81ea\u52a8\u7ba1\u7406ReplicaSet\uff0c\u9664\u975e\u81ea\u5b9a\u4e49\u7684Pod\u4e0d\u9700\u8981\u66f4\u65b0\u6216\u6709\u5176\u4ed6\u7f16\u6392\u7b49\u3002</p> <p>\u5b9a\u4e49\u4e00\u4e2aReplicaSet\u7684\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\nname: frontend\nlabels:\napp: guestbook\ntier: frontend\nspec:\n# modify replicas according to your case\nreplicas: 3\nselector:\nmatchLabels:\ntier: frontend\nmatchExpressions:\n- {key: tier, operator: In, values: [frontend]}\ntemplate:\nmetadata:\nlabels:\napp: guestbook\ntier: frontend\nspec:\ncontainers:\n- name: php-redis\nimage: gcr.io/google_samples/gb-frontend:v3\nresources:\nrequests:\ncpu: 100m\nmemory: 100Mi\nenv:\n- name: GET_HOSTS_FROM\nvalue: dns\n# If your cluster config does not include a dns service, then to\n# instead access environment variables to find service host\n# info, comment out the 'value: dns' line above, and uncomment the\n# line below.\n# value: env\nports:\n- containerPort: 80\n</code></pre> <p>Replication Controller\u548cReplicaSet\u7684\u521b\u5efa\u3001\u5220\u9664\u548cPod\u5e76\u65e0\u592a\u5927\u533a\u522b\uff0c</p> <p>Replication Controller\u76ee\u524d\u51e0\u4e4e\u5df2\u7ecf\u4e0d\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\uff0cReplicaSet\u4e5f\u5f88\u5c11\u5355\u72ec\u88ab\u4f7f\u7528\uff0c\u90fd\u662f\u4f7f\u7528\u66f4\u9ad8\u7ea7\u7684\u8d44\u6e90Deployment\u3001DaemonSet\u3001StatefulSet\u7ba1\u7406Pod\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#2\u65e0\u72b6\u6001\u5e94\u7528\u7ba1\u7406deployment","title":"2.\u65e0\u72b6\u6001\u5e94\u7528\u7ba1\u7406Deployment","text":"<p>\u524d\u6587\u63d0\u5230\u7684ReplicaSet\u53ef\u4ee5\u786e\u4fdd\u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u8fd0\u884c\u7684Pod\u526f\u672c\u8fbe\u5230\u6307\u5b9a\u7684\u6570\u91cf\uff0c\u4f46\u662fDeployment\u662f\u4e00\u4e2a\u66f4\u9ad8\u7ea7\u7684\u6982\u5ff5\uff0c\u5b83\u7ba1\u7406ReplicaSet\u5e76\u4e3aPod\u548cReplicaSet\u63d0\u4f9b\u58f0\u660e\u6027\u66f4\u65b0\u4ee5\u53ca\u8bb8\u591a\u5176\u4ed6\u6709\u7528\u7684\u529f\u80fd\uff0c \u6240\u4ee5\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528Deployment\u4ee3\u66ffReplicaSet\u3002</p> <p>Deployment\u4e00\u822c\u7528\u4e8e\u90e8\u7f72\u516c\u53f8\u7684\u65e0\u72b6\u6001\u670d\u52a1\uff0c\u8fd9\u4e2a\u4e5f\u662f\u6700\u5e38\u7528\u7684\u63a7\u5236\u5668\uff0c\u56e0\u4e3a\u4f01\u4e1a\u5185\u90e8\u73b0\u5728\u90fd\u662f\u4ee5\u5fae\u670d\u52a1\u4e3a\u4e3b\uff0c\u800c\u5fae\u670d\u52a1\u5b9e\u73b0\u65e0\u72b6\u6001\u5316\u4e5f\u662f\u6700\u4f73\u5b9e\u8df5\uff0c \u53ef\u4ee5\u5229\u7528Deployment\u7684\u9ad8\u7ea7\u529f\u80fd\u505a\u5230\u65e0\u7f1d\u8fc1\u79fb\u3001\u81ea\u52a8\u6269\u5bb9\u7f29\u5bb9\u3001\u81ea\u52a8\u707e\u96be\u6062\u590d\u3001\u4e00\u952e\u56de\u6eda\u7b49\u529f\u80fd\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#21-\u521b\u5efadeployment","title":"2.1 \u521b\u5efaDeployment","text":"<p>\u521b\u5efa\u4e00\u4e2aDeployment\u4e5f\u5f88\u7b80\u5355\uff0c\u5c06\u524d\u9762\u7ae0\u8282\u521b\u5efaPod\u7684YAML\u6587\u4ef6\u7a0d\u5fae\u66f4\u6539\u4e00\u4e0b\u5373\u53ef\u53d8\u6210Deployment\u7684\u8d44\u6e90\u6587\u4ef6\uff0c\u6bd4\u5982\u521b\u5efa\u4e00\u4e2a\u67093\u4e2aNginx\u526f\u672c(\u5b9e\u4f8b)\u7684Deployment\uff0c\u53ef\u4ee5\u770b\u5230\u53ea\u662fapiVersion\u548cKind\u6709\u6240\u53d8\u5316\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p>dp-nginx.yml</p> <pre><code># \u4eceKubernetes 1.16\u7248\u672c\u5f00\u59cb\uff0c\u5f7b\u5e95\u5e9f\u5f03\u4e86\u5176\u4ed6\u7684APIVersion\uff0c\u53ea\u80fd\u4f7f\u7528apps/v1\uff0c1.16\u4ee5\u4e0a\u7684\u7248\u672c\u53ef\u4ee5\u4f7f\u7528extension\u7b49\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: nginx-deployment\nlabels:\napp: nginx\nspec:\nreplicas: 3\nselector:\nmatchLabels:\napp: nginx\ntemplate:\nmetadata:\nlabels:\napp: nginx\nspec:\ncontainers:\n- name: nginx\nimage: nginx:1.7.9\nports:\n- containerPort: 80\n</code></pre> <p>\u793a\u4f8b\u89e3\u6790\uff1a</p> <ul> <li>nginx-deployment\uff1aDeployment\u7684\u540d\u79f0\u3002</li> <li>replicas\uff1a\u521b\u5efaPod\u7684\u526f\u672c\u6570\u3002</li> <li>selector\uff1a\u5b9a\u4e49Deployment\u5982\u4f55\u627e\u5230\u8981\u7ba1\u7406\u7684Pod\uff0c\u4e0etemplate\u7684</li> </ul> <p>label\uff08\u6807\u7b7e\uff09\u5bf9\u5e94\uff0capiVersion\u4e3aapps/v1\u5fc5\u987b\u6307\u5b9a\u8be5\u5b57\u6bb5\u3002 - template\u5b57\u6bb5\u5305\u542b\u4ee5\u4e0b\u5b57\u6bb5\uff1a</p> <p>\u25c6 app: nginx\u4f7f\u7528label\uff08\u6807\u7b7e\uff09\u6807\u8bb0Pod\u3002</p> <p>\u25c6 spec\uff1a\u8868\u793aPod\u8fd0\u884c\u4e00\u4e2a\u540d\u5b57\u4e3anginx\u7684\u5bb9\u5668\u3002</p> <p>\u25c6 image\uff1a\u8fd0\u884c\u6b64Pod\u4f7f\u7528\u7684\u955c\u50cf\u3002</p> <p>\u25c6 Port\uff1a\u5bb9\u5668\u7528\u4e8e\u53d1\u9001\u548c\u63a5\u6536\u6d41\u91cf\u7684\u7aef\u53e3\u3002</p> <p>\u4f7f\u7528kubectl create\u521b\u5efa\u6b64Deployment\uff1a</p> <pre><code>$ kubectl apply -f  dp-nginx.yml\ndeployment.apps/nginx-deployment created\n</code></pre> <p>\u4f7f\u7528kubectl get\u6216\u8005kubectl describe\u67e5\u770b\u6b64Deployment\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get deployment\nNAME               READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   3/3     3            3           2m45s\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528rollout\u547d\u4ee4\u67e5\u770b\u6574\u4e2aDeployment\u521b\u5efa\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl rollout status deployment/nginx-deployment\ndeployment \"nginx-deployment\" successfully rolled out\n</code></pre> <p>\u5f53rollout\u7ed3\u675f\u65f6\uff0c\u518d\u6b21\u67e5\u770b\u6b64Deployment\uff0c\u53ef\u4ee5\u770b\u5230AVAILABLE\u7684\u6570\u91cf\u548cYAML\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684replicas\u76f8\u540c\uff1a</p> <pre><code>$ kubectl get deployment\nNAME               READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   3/3     3            3           2m45s\n</code></pre> <p>\u4e4b\u524d\u8bb2\u8fc7Deployment\u901a\u8fc7ReplicaSet\u7ba1\u7406Pod\uff0c\u53ef\u4ee5\u67e5\u770b\u6b64Deployment\u5f53\u524d\u5bf9\u5e94\u7684ReplicaSet\uff1a</p> <pre><code>$ kubectl get rs -l app=nginx\nNAME                          DESIRED   CURRENT   READY   AGE\nnginx-deployment-5d59d67564   3         3         3       4m44s\n\n$ kubectl get pod -l app=nginx\nNAME                                READY   STATUS    RESTARTS   AGE\nnginx-deployment-5d59d67564-qns4q   1/1     Running   0          6m2s\nnginx-deployment-5d59d67564-vqqb9   1/1     Running   0          6m2s\nnginx-deployment-5d59d67564-xsssg   1/1     Running   0          6m2s\n</code></pre> <p>Warning</p> <p>ReplicaSet\u7684\u547d\u540d\u683c\u5f0f\u4e3a[DEPLOYMENT-NAME]-[POD-TEMPLATE-HASH-VALUE]POD-TEMPLATE-HASH-VALUE\uff0c\u662f\u81ea\u52a8\u751f\u6210\u7684\uff0c\u4e0d\u7528\u624b\u52a8\u6307\u5b9a\u3002</p> <p>\u5982\u679cDeployment\u6709\u8fc7\u66f4\u65b0\uff0c\u5bf9\u5e94\u7684ReplicaSet\u53ef\u80fd\u4e0d\u6b62\u4e00\u4e2a\uff0c\u53ef\u4ee5\u901a\u8fc7<code>-o yaml</code>\u83b7\u53d6\u5f53\u524d\u5bf9\u5e94\u7684ReplicaSet\u662f\u54ea\u4e2a\uff0c\u5176\u4f59\u7684ReplicaSet\u4e3a\u4fdd\u7559\u7684\u5386\u53f2\u7248\u672c\uff0c\u7528\u4e8e\u56de\u6eda\u7b49\u64cd\u4f5c\u3002</p> <p>\u67e5\u770b\u6b64Deployment\u521b\u5efa\u7684Pod\uff0c\u53ef\u4ee5\u770b\u5230Pod\u7684hash\u503c5d59d67564\u548c\u4e0a\u8ff0Deployment\u5bf9\u5e94\u7684ReplicaSet\u7684hash\u503c\u4e00\u81f4\uff1a</p> <pre><code>$ kubectl get pods --show-labels\nNAME                                READY   STATUS    RESTARTS   AGE   LABELS\nnginx-deployment-5d59d67564-qns4q   1/1     Running   0          14m   app=nginx,pod-template-hash=5d59d67564\nnginx-deployment-5d59d67564-vqqb9   1/1     Running   0          14m   app=nginx,pod-template-hash=5d59d67564\nnginx-deployment-5d59d67564-xsssg   1/1     Running   0          14m   app=nginx,pod-template-hash=5d59d67564\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#22-\u66f4\u65b0deployment","title":"2.2 \u66f4\u65b0Deployment","text":"<p>\u901a\u8fc7Deployment\u90e8\u7f72\u5e94\u7528\u540e\uff0c\u7ecf\u5e38\u4f1a\u6709Deployment\u6587\u4ef6\u7684\u914d\u7f6e\u66f4\u6539\u6216\u8005\u955c\u50cf\u7248\u672c\u8fed\u4ee3\u7684\u9700\u6c42\uff0c\u66f4\u6539\u914d\u7f6e\u540e\u8be5Deployment\u4f1a\u521b\u5efa\u65b0\u7684ReplicaSet\uff0c\u4e4b\u540e\u4f1a\u5bf9\u7ba1\u7406\u7684Pod\u8fdb\u884c\u6eda\u52a8\u5347\u7ea7\u3002</p> <p>Warning</p> <p>\u5f53\u4e14\u4ec5\u5f53Deployment\u7684Pod\u6a21\u677f\uff08\u5373.spec.template\uff09\u66f4\u6539\u65f6\uff0c\u624d\u4f1a\u89e6\u53d1Deployment\u66f4\u65b0\uff0c\u4f8b\u5982\u66f4\u6539\u5185\u5b58\u3001CPU\u914d\u7f6e\u6216\u8005\u5bb9\u5668\u7684image\u3002</p> <p>\u5047\u5982\u66f4\u65b0Nginx Pod\u7684image\u4f7f\u7528nginx:1.9.1\uff0c\u5e76\u4f7f\u7528--record\u8bb0\u5f55\u5f53\u524d\u66f4\u6539\u7684\u53c2\u6570\uff0c\u540e\u671f\u56de\u6eda\u65f6\u53ef\u4ee5\u67e5\u770b\u5230\u5bf9\u5e94\u7684\u4fe1\u606f\uff1a</p> <pre><code>$ kubectl set image deployment nginx-deployment nginx=nginx:1.9.1 --record\ndeployment.extensions/nginx-deployment image updated\n</code></pre> <p>\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528edit\u547d\u4ee4\u76f4\u63a5\u7f16\u8f91Deployment\uff0c\u6548\u679c\u76f8\u540c\uff1a</p> <pre><code>$ kubectl edit deployment.v1.apps/nginx-deployment\ndeployment.apps/nginx-deployment edited\n</code></pre> <p>\u540c\u6837\uff0c\u53ef\u4ee5\u4f7f\u7528kubectl rollout status\u67e5\u770b\u66f4\u65b0\u8fc7\u7a0b\uff1a</p> <pre><code>$ kubectl rollout status deployment/nginx-deployment\nWaiting for deployment \"nginx-deployment\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"nginx-deployment\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"nginx-deployment\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"nginx-deployment\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"nginx-deployment\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"nginx-deployment\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"nginx-deployment\" rollout to finish: 1 old replicas are pending termination...\nWaiting for deployment \"nginx-deployment\" rollout to finish: 1 old replicas are pending termination...\ndeployment \"nginx-deployment\" successfully rolled out\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\u66f4\u65b0\u8fc7\u7a0b\u4e3a\u65b0\u65e7\u4ea4\u66ff\u66f4\u65b0\uff0c\u9996\u5148\u65b0\u5efa\u4e00\u4e2aPod\uff0c\u5f53Pod\u72b6\u6001\u4e3aRunning\u65f6\uff0c\u5220\u9664\u4e00\u4e2a\u65e7\u7684Pod\uff0c\u540c\u65f6\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Pod\u3002</p> <p>\u5f53\u89e6\u53d1\u4e00\u4e2a\u66f4\u65b0\u540e\uff0c\u4f1a\u6709\u65b0\u7684ReplicaSet\u4ea7\u751f\uff0c\u65e7\u7684ReplicaSet\u4f1a\u88ab\u4fdd\u5b58\uff0c\u67e5\u770b\u6b64\u65f6\u7684ReplicaSet\uff0c\u53ef\u4ee5\u4eceAGE\u6216READY\u770b\u51fa\u65b0\u65e7ReplicaSet\uff1a</p> <pre><code>$ kubectl get rs\nNAME                          DESIRED   CURRENT   READY   AGE\nnginx-deployment-5d59d67564   0         0         0       19m\nnginx-deployment-69c44dfb78   3         3         3       3m25s\n</code></pre> <p>\u901a\u8fc7describe\u67e5\u770bDeployment\u7684\u8be6\u7ec6\u4fe1\u606f</p> <pre><code>$ kubectl describe deployment nginx-deployment\nName:                   nginx-deployment\nNamespace:              default\nCreationTimestamp:      Wed, 14 Sep 2022 16:35:56 +0800\nLabels:                 app=nginx\nAnnotations:            deployment.kubernetes.io/revision: 2\nkubernetes.io/change-cause: kubectl set image deployment nginx-deployment nginx=nginx:1.9.1 --record=true\nSelector:               app=nginx\nReplicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable\n....\nEvents:\n  Type    Reason             Age    From                   Message\n  ----    ------             ----   ----                   -------\n  Normal  ScalingReplicaSet  24m    deployment-controller  Scaled up replica set nginx-deployment-5d59d67564 to 3\nNormal  ScalingReplicaSet  8m22s  deployment-controller  Scaled up replica set nginx-deployment-69c44dfb78 to 1\nNormal  ScalingReplicaSet  7m47s  deployment-controller  Scaled down replica set nginx-deployment-5d59d67564 to 2\nNormal  ScalingReplicaSet  7m46s  deployment-controller  Scaled up replica set nginx-deployment-69c44dfb78 to 2\nNormal  ScalingReplicaSet  7m14s  deployment-controller  Scaled down replica set nginx-deployment-5d59d67564 to 1\nNormal  ScalingReplicaSet  7m14s  deployment-controller  Scaled up replica set nginx-deployment-69c44dfb78 to 3\nNormal  ScalingReplicaSet  6m49s  deployment-controller  Scaled down replica set nginx-deployment-5d59d67564 to 0\n</code></pre> <p>\u5728describe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u7b2c\u4e00\u6b21\u521b\u5efa\u65f6\uff0c\u5b83\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3anginx-deployment-5d59d67564\uff0c\u5e76\u76f4\u63a5\u5c06\u5176\u6269\u5c55\u4e3a3\u4e2a\u526f\u672c\u3002 \u66f4\u65b0\u90e8\u7f72\u65f6 \uff0c\u5b83\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684ReplicaSet\uff0c\u547d\u540d\u4e3anginx-deployment-6987cdb55b\uff0c\u5e76\u5c06\u5176\u526f\u672c\u6570\u6269\u5c55\u4e3a1\uff0c\u7136\u540e\u5c06\u65e7\u7684ReplicaSet\u7f29\u5c0f\u4e3a2\uff0c\u8fd9\u6837\u81f3\u5c11\u53ef\u4ee5\u6709\u4e24\u4e2aPod\u53ef\u7528\uff0c\u6700\u591a\u521b\u5efa\u4e864\u4e2aPod\u3002</p> <p>\u4ee5\u6b64\u7c7b\u63a8\uff0c\u4f7f\u7528\u76f8\u540c\u7684\u6eda\u52a8\u66f4\u65b0\u7b56\u7565\u5411\u4e0a\u548c\u5411\u4e0b\u6269\u5c55\u65b0\u65e7ReplicaSet\uff0c\u6700\u7ec8\u65b0\u7684ReplicaSet\u53ef\u4ee5\u62e5\u67093\u4e2a\u526f\u672c\uff0c\u5e76\u5c06\u65e7\u7684ReplicaSet\u7f29\u5c0f\u4e3a0\u3002</p> <p>\u66f4\u65b0\u90e8\u7f72\u65f6\uff0c\u5b83\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684ReplicaSet\uff0c\u547d\u540d\u4e3anginx-deployment-69c44dfb78\uff0c\u5e76\u5c06\u5176\u526f\u672c\u6570\u6269\u5c55\u4e3a1\uff0c\u7136\u540e\u5c06\u65e7\u7684ReplicaSet\u7f29\u5c0f\u4e3a2\uff0c\u8fd9\u6837\u81f3\u5c11\u53ef\u4ee5\u6709\u4e24\u4e2aPod\u53ef\u7528\uff0c\u6700\u591a\u521b\u5efa\u4e864\u4e2aPod\u3002</p> <p>\u4ee5\u6b64\u7c7b\u63a8\uff0c\u4f7f\u7528\u76f8\u540c\u7684\u6eda\u52a8\u66f4\u65b0\u7b56\u7565\u5411\u4e0a\u548c\u5411\u4e0b\u6269\u5c55\u65b0\u65e7ReplicaSet\uff0c\u6700\u7ec8\u65b0\u7684ReplicaSet\u53ef\u4ee5\u62e5\u67093\u4e2a\u526f\u672c\uff0c\u5e76\u5c06\u65e7\u7684ReplicaSet\u7f29\u5c0f\u4e3a0\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#23-\u56de\u6edadeployment","title":"2.3 \u56de\u6edaDeployment","text":"<p>\u5f53\u66f4\u65b0\u7684\u7248\u672c\u4e0d\u7a33\u5b9a\u6216\u914d\u7f6e\u4e0d\u5408\u7406\u65f6\uff0c\u53ef\u4ee5\u5bf9\u5176\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\uff0c\u5047\u8bbe\u6211\u4eec\u53c8\u8fdb\u884c\u4e86\u51e0\u6b21\u66f4\u65b0(\u6b64\u5904\u4ee5\u66f4\u65b0\u955c\u50cf\u7248\u672c\u89e6\u53d1\u66f4\u65b0\uff0c\u66f4\u6539\u914d\u7f6e\u6548\u679c\u7c7b)\uff1a</p> <pre><code>$ kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v1 --record\n$ kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v2 --record\n</code></pre> <p>\u4f7f\u7528kubectl rollout history\u67e5\u770b\u66f4\u65b0\u5386\u53f2\uff1a</p> <pre><code>$ kubectl rollout history deployment/nginx-deployment\ndeployment.apps/nginx-deployment\nREVISION  CHANGE-CAUSE\n1         &lt;none&gt;\n2         kubectl set image deployment nginx-deployment nginx=nginx:1.9.1 --record=true\n3         kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v1 --record=true\n4         kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v2 --record=true\n</code></pre> <p>\u67e5\u770bDeployment\u67d0\u6b21\u66f4\u65b0\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528--revision\u6307\u5b9a\u67d0\u6b21\u66f4\u65b0\u7684\u7248\u672c\u53f7\uff1a</p> <pre><code>$ kubectl rollout history deployment/nginx-deployment --revision=3\ndeployment.apps/nginx-deployment with revision #3\nPod Template:\n  Labels:       app=nginx\n        pod-template-hash=666f99dd56\n  Annotations:  kubernetes.io/change-cause: kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v1 --record=true\nContainers:\n   nginx:\n    Image:      dotbalo/canary:v1\n    Port:       80/TCP\n    Host Port:  0/TCP\n    Environment:        &lt;none&gt;\n    Mounts:     &lt;none&gt;\n  Volumes:      &lt;none&gt;\n</code></pre> <p>\u5982\u679c\u53ea\u9700\u8981\u56de\u6eda\u5230\u4e0a\u4e00\u4e2a\u7a33\u5b9a\u7248\u672c\uff0c\u4f7f\u7528kubectl rollout undo\u5373\u53ef\uff1a</p> <pre><code>$ kubectl rollout undo deployment/nginx-deployment\ndeployment.apps/nginx-deployment rolled back\n\n# \u518d\u6b21\u67e5\u770b\u66f4\u65b0\u5386\u53f2\uff0c\u53d1\u73b0REVISION5\u56de\u5230\u4e86canary:v1\uff1a\n$ kubectl rollout history deployment/nginx-deployment\ndeployment.apps/nginx-deployment\nREVISION  CHANGE-CAUSE\n1         &lt;none&gt;\n2         kubectl set image deployment nginx-deployment nginx=nginx:1.9.1 --record=true\n4         kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v2 --record=true\n5         kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v1 --record=true\n</code></pre> <p>\u5982\u679c\u8981\u56de\u6eda\u5230\u6307\u5b9a\u7248\u672c\uff0c\u4f7f\u7528--to-revision\u53c2\u6570\uff1a</p> <pre><code>$ kubectl rollout undo deployment/nginx-deployment --to-revision=2\ndeployment.extensions/nginx-deployment\n\n$ kubectl rollout history deployment/nginx-deployment\ndeployment.apps/nginx-deployment\nREVISION  CHANGE-CAUSE\n1         &lt;none&gt;\n4         kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v2 --record=true\n5         kubectl set image deployment nginx-deployment nginx=dotbalo/canary:v1 --record=true\n6         kubectl set image deployment nginx-deployment nginx=nginx:1.9.1 --record=true\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#24-\u6269\u5bb9deployment","title":"2.4 \u6269\u5bb9Deployment","text":"<p>\u5f53\u516c\u53f8\u8bbf\u95ee\u91cf\u53d8\u5927\uff0c\u6216\u8005\u6709\u9884\u671f\u5185\u7684\u6d3b\u52a8\u65f6\uff0c3\u4e2aPod\u53ef\u80fd\u5df2\u65e0\u6cd5\u652f\u6491\u4e1a\u52a1\u65f6\uff0c\u53ef\u4ee5\u63d0\u524d\u5bf9\u5176\u8fdb\u884c\u6269\u5c55\u3002</p> <p>\u4f7f\u7528kubectl scale\u52a8\u6001\u8c03\u6574Pod\u7684\u526f\u672c\u6570\uff0c\u6bd4\u5982\u589e\u52a0Pod\u4e3a5\u4e2a\uff1a</p> <pre><code>$ kubectl scale deployment.v1.apps/nginx-deployment --replicas=5\ndeployment.apps/nginx-deployment scaled\n\n$ kubectl rollout status deployment/nginx-deployment\nWaiting for deployment \"nginx-deployment\" rollout to finish: 3 of 5 updated replicas are available...\nWaiting for deployment \"nginx-deployment\" rollout to finish: 4 of 5 updated replicas are available...\ndeployment \"nginx-deployment\" successfully rolled out\n</code></pre> <p>\u67e5\u770bPod\uff0c\u6b64\u65f6Pod\u5df2\u7ecf\u53d8\u6210\u4e865\u4e2a\uff1a</p> <pre><code>$ kubectl get pod\nNAME                                READY   STATUS    RESTARTS   AGE\nnginx-deployment-69c44dfb78-cqdd7   1/1     Running   0          50s\nnginx-deployment-69c44dfb78-lnx2s   1/1     Running   0          2m44s\nnginx-deployment-69c44dfb78-qz6gw   1/1     Running   0          2m40s\nnginx-deployment-69c44dfb78-tltjh   1/1     Running   0          2m42s\nnginx-deployment-69c44dfb78-xgwk6   1/1     Running   0          50s\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#25-\u6682\u505c\u548c\u6062\u590ddeployment\u66f4\u65b0","title":"2.5 \u6682\u505c\u548c\u6062\u590dDeployment\u66f4\u65b0","text":"<p>\u4e0a\u8ff0\u6f14\u793a\u7684\u5747\u4e3a\u66f4\u6539\u67d0\u4e00\u5904\u7684\u914d\u7f6e\uff0c\u66f4\u6539\u540e\u7acb\u5373\u89e6\u53d1\u66f4\u65b0\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u53ef\u80fd\u9700\u8981\u9488\u5bf9\u4e00\u4e2a\u8d44\u6e90\u6587\u4ef6\u66f4\u6539\u591a\u5904\u5730\u65b9\uff0c\u800c\u5e76\u4e0d\u9700\u8981\u591a\u6b21\u89e6\u53d1\u66f4\u65b0\uff0c \u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528Deployment\u6682\u505c\u529f\u80fd\uff0c\u4e34\u65f6\u7981\u7528\u66f4\u65b0\u64cd\u4f5c\uff0c\u5bf9Deployment\u8fdb\u884c\u591a\u6b21\u4fee\u6539\u540e\u518d\u8fdb\u884c\u66f4\u65b0\u3002</p> <p>\u4f7f\u7528kubectl rollout pause\u547d\u4ee4\u5373\u53ef\u6682\u505cDeployment\u66f4\u65b0\uff1a</p> <pre><code>$ kubectl rollout pause deployment/nginx-deployment\ndeployment.apps/nginx-deployment paused\n</code></pre> <p>\u7136\u540e\u5bf9Deployment\u8fdb\u884c\u76f8\u5173\u66f4\u65b0\u64cd\u4f5c\uff0c\u6bd4\u5982\u5148\u66f4\u65b0\u955c\u50cf\uff0c\u7136\u540e\u5bf9\u5176\u8d44\u6e90\u8fdb\u884c\u9650\u5236\uff08\u5982\u679c\u4f7f\u7528\u7684\u662fkubectl edit\u547d\u4ee4\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u591a\u6b21\u4fee\u6539\uff0c\u65e0\u987b\u6682\u505c\u66f4\u65b0\uff0ckubectl set\u547d\u4ee4\u4e00\u822c\u4f1a\u96c6\u6210\u5728CICD\u6d41\u6c34\u7ebf\u4e2d\uff09\uff1a</p> <pre><code>$ kubectl set image deployment.v1.apps/nginx-deployment nginx=nginx:1.9.1\n\n$ kubectl set resources deployment.v1.apps/nginx-deployment -c=nginx --limits=cpu=200m,memory=512Mi\ndeployment.apps/nginx-deployment resource requirements updated\n</code></pre> <p>\u8fdb\u884c\u5b8c\u6700\u540e\u4e00\u5904\u914d\u7f6e\u66f4\u6539\u540e\uff0c\u4f7f\u7528kubectl rollout resume\u6062\u590dDeployment\u66f4\u65b0\uff1a</p> <pre><code>$ kubectl rollout resume deployment.v1.apps/nginx-deployment\ndeployment.apps/nginx-deployment resumed\n</code></pre> <p>\u53ef\u4ee5\u67e5\u770b\u5230\u6062\u590d\u66f4\u65b0\u7684Deployment\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684ReplicaSet\uff1a</p> <pre><code>$ kubectl get rs\nNAME                          DESIRED   CURRENT   READY   AGE\nnginx-deployment-5d59d67564   0         0         0       73m\nnginx-deployment-666f99dd56   0         0         0       36m\nnginx-deployment-69c44dfb78   0         0         0       58m\nnginx-deployment-79d4d8c7d5   0         0         0       35m\nnginx-deployment-f7fdb4ccd    5         5         4       113s\n</code></pre> <p>\u53ef\u4ee5\u67e5\u770b\u5230Deployment\u7684image\uff08\u955c\u50cf\uff09\u5df2\u7ecf\u53d8\u4e3anginx:1.9.1\uff1a</p> <pre><code>$ kubectl describe deploy nginx-deployment\nName:                   nginx-deployment\nNamespace:              default\n......\nRollingUpdateStrategy:  25% max unavailable, 25% max surge\nPod Template:\n  Labels:  app=nginx\n  Containers:\n   nginx:\n    Image:      nginx:1.9.1\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#26-\u66f4\u65b0deployment\u7684\u6ce8\u610f\u4e8b\u9879","title":"2.6 \u66f4\u65b0Deployment\u7684\u6ce8\u610f\u4e8b\u9879","text":"<p>\u5386\u53f2\u7248\u672c\u6e05\u7406\u7b56\u7565\uff1a</p> <p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0crevision\u4fdd\u755910\u4e2a\u65e7\u7684ReplicaSet\uff0c\u5176\u4f59\u7684\u5c06\u5728\u540e\u53f0\u8fdb\u884c\u5783\u573e\u56de\u6536\uff0c\u53ef\u4ee5\u5728.spec.revisionHistoryLimit\u8bbe\u7f6e\u4fdd\u7559ReplicaSet\u7684\u4e2a\u6570\u3002\u5f53\u8bbe\u7f6e\u4e3a0\u65f6\uff0c\u4e0d\u4fdd\u7559\u5386\u53f2\u8bb0\u5f55\u3002</p> <p>\u66f4\u65b0\u7b56\u7565\uff1a</p> <ul> <li>.spec.strategy.type==Recreate\uff1a\u8868\u793a\u91cd\u5efa\uff0c\u5148\u5220\u6389\u65e7\u7684Pod\uff0c\u518d\u521b\u5efa\u65b0\u7684Pod\u3002</li> <li> <p>.spec.strategy.type==RollingUpdate\uff1a\u8868\u793a\u6eda\u52a8\u66f4\u65b0\uff0c\u53ef\u4ee5\u6307\u5b9amaxUnavailable\u548cmaxSurge\u6765\u63a7\u5236\u6eda\u52a8\u66f4\u65b0\u8fc7\u7a0b\u3002</p> <ul> <li> <p>.spec.strategy.rollingUpdate.maxUnavailable\uff1a\u6307\u5b9a\u5728\u56de\u6eda\u66f4\u65b0\u65f6\u6700\u5927\u4e0d\u53ef\u7528\u7684Pod\u6570\u91cf\uff0c\u53ef\u9009\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u4e3a25%\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u6570\u5b57\u6216\u767e\u5206\u6bd4\uff0c\u5982\u679cmaxSurge\u4e3a0\uff0c\u5219\u8be5\u503c\u4e0d\u80fd\u4e3a0\u3002</p> </li> <li> <p>.spec.strategy.rollingUpdate.maxSurge\uff1a\u53ef\u4ee5\u8d85\u8fc7\u671f\u671b\u503c\u7684\u6700\u5927Pod\u6570\uff0c\u53ef\u9009\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u4e3a25%\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6210\u6570\u5b57\u6216\u767e\u5206\u6bd4\uff0c\u5982\u679cmaxUnavailable\u4e3a0\uff0c\u5219\u8be5\u503c\u4e0d\u80fd\u4e3a0\u3002</p> </li> </ul> </li> </ul> <p>Ready\u7b56\u7565\uff1a</p> <ul> <li>.spec.minReadySeconds\u662f\u53ef\u9009\u53c2\u6570\uff0c\u6307\u5b9a\u65b0\u521b\u5efa\u7684Pod\u5e94\u8be5\u5728\u6ca1\u6709\u4efb\u4f55\u5bb9\u5668\u5d29\u6e83\u7684\u60c5\u51b5\u4e0b\u89c6\u4e3aReady\uff08\u5c31\u7eea\uff09\u72b6\u6001\u7684\u6700\u5c0f\u79d2\u6570\uff0c\u9ed8\u8ba4\u4e3a0\uff0c\u5373\u4e00\u65e6\u88ab\u521b\u5efa\u5c31\u89c6\u4e3a\u53ef\u7528\uff0c\u901a\u5e38\u548c\u5bb9\u5668\u63a2\u9488\u8fde\u7528\u3002</li> </ul>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#3\u6709\u72b6\u6001\u5e94\u7528\u7ba1\u7406statefulset","title":"3.\u6709\u72b6\u6001\u5e94\u7528\u7ba1\u7406StatefulSet","text":"<p>StatefulSet\uff08\u6709\u72b6\u6001\u96c6\uff0c\u7f29\u5199\u4e3asts\uff09\u5e38\u7528\u4e8e\u90e8\u7f72\u6709\u72b6\u6001\u7684\u4e14\u9700\u8981\u6709\u5e8f\u542f\u52a8\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u6bd4\u5982\u5728\u8fdb\u884cSpring Cloud\u9879\u76ee\u5bb9\u5668\u5316\u65f6\uff0c Eureka\u7684\u90e8\u7f72\u662f\u6bd4\u8f83\u9002\u5408\u7528StatefulSet\u90e8\u7f72\u65b9\u5f0f\u7684\uff0c\u53ef\u4ee5\u7ed9\u6bcf\u4e2aEureka\u5b9e\u4f8b\u521b\u5efa\u4e00\u4e2a\u552f\u4e00\u4e14\u56fa\u5b9a\u7684\u6807\u8bc6\u7b26\uff0c\u5e76\u4e14\u6bcf\u4e2aEureka\u5b9e\u4f8b\u65e0\u987b\u914d\u7f6e\u591a\u4f59\u7684Service\uff0c \u5176\u4f59Spring Boot\u5e94\u7528\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7Eureka\u7684Headless Service\u8fdb\u884c\u6ce8\u518c\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#31-statefulset\u7684\u57fa\u672c\u6982\u5ff5","title":"3.1 StatefulSet\u7684\u57fa\u672c\u6982\u5ff5","text":"<p>StatefulSet\u4e3b\u8981\u7528\u4e8e\u7ba1\u7406\u6709\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f\u7684\u5de5\u4f5c\u8d1f\u8f7dAPI\u5bf9\u8c61\u3002</p> <p>\u6bd4\u5982\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u53ef\u4ee5\u90e8\u7f72ElasticSearch\u96c6\u7fa4\u3001MongoDB\u96c6\u7fa4\u6216\u8005\u9700\u8981\u6301\u4e45\u5316\u7684RabbitMQ\u96c6\u7fa4\u3001Redis\u96c6\u7fa4\u3001Kafka\u96c6\u7fa4\u548cZooKeeper\u96c6\u7fa4\u7b49\u3002</p> <p>\u548cDeployment\u7c7b\u4f3c\uff0c\u4e00\u4e2aStatefulSet\u4e5f\u540c\u6837\u7ba1\u7406\u7740\u57fa\u4e8e\u76f8\u540c\u5bb9\u5668\u89c4\u8303\u7684Pod\u3002\u4e0d\u540c\u7684\u662f\uff0cStatefulSet\u4e3a\u6bcf\u4e2aPod\u7ef4\u62a4\u4e86\u4e00\u4e2a\u9ecf\u6027\u6807\u8bc6\u3002</p> <p>\u8fd9\u4e9bPod\u662f\u6839\u636e\u76f8\u540c\u7684\u89c4\u8303\u521b\u5efa\u7684\uff0c\u4f46\u662f\u4e0d\u53ef\u4e92\u6362\uff0c\u6bcf\u4e2aPod\u90fd\u6709\u4e00\u4e2a\u6301\u4e45\u7684\u6807\u8bc6\u7b26\uff0c\u5728\u91cd\u65b0\u8c03\u5ea6\u65f6\u4e5f\u4f1a\u4fdd\u7559\uff0c\u4e00\u822c\u683c\u5f0f\u4e3aStatefulSetName-Number\u3002 \u6bd4\u5982\u5b9a\u4e49\u4e00\u4e2a\u540d\u5b57\u662fRedis-Sentinel\u7684StatefulSet\uff0c\u6307\u5b9a\u521b\u5efa3\u4e2aPod\uff0c\u90a3\u4e48\u521b\u5efa\u51fa\u6765\u7684Pod\u540d\u5b57\u5c31\u4e3aRedis-Sentinel-0\u3001Redis-Sentinel-1\u3001Redis-Sentinel-2\u3002 \u800cStatefulSet\u521b\u5efa\u7684Pod\u4e00\u822c\u4f7f\u7528Headless Service\uff08\u65e0\u5934\u670d\u52a1\uff09\u8fdb\u884c\u901a\u4fe1\uff0c\u548c\u666e\u901a\u7684Service\u7684\u533a\u522b\u5728\u4e8eHeadless Service\u6ca1\u6709ClusterIP\uff0c\u5b83\u4f7f\u7528Endpoint\u8fdb\u884c\u4e92\u76f8\u901a\u4fe1\uff0cHeadless\u4e00\u822c\u7684\u683c\u5f0f\u4e3a\uff1a</p> <pre><code>statefulSetName-{0..N-1}.serviceName.namespace.svc.cluster.local\n</code></pre> <p>\u914d\u7f6e\u8bf4\u660e\uff1a</p> <ul> <li>serviceName\u4e3aHeadless Service\u7684\u540d\u5b57\uff0c\u521b\u5efaStatefulSet\u65f6\u5fc5\u987b\u6307\u5b9aHeadless Service\u540d\u79f0\u3002</li> <li>0..N\u20121\u4e3aPod\u6240\u5728\u7684\u5e8f\u53f7\uff0c\u4ece0\u5f00\u59cb\u5230N\u20121\u3002</li> <li>statefulSetName\u4e3aStatefulSet\u7684\u540d\u5b57\u3002</li> <li>namespace\u4e3a\u670d\u52a1\u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\u3002</li> <li>.cluster.local\u4e3aCluster Domain\uff08\u96c6\u7fa4\u57df\uff09\u3002</li> </ul> <p>\u5047\u5982\u516c\u53f8\u67d0\u4e2a\u9879\u76ee\u9700\u8981\u5728Kubernetes\u4e2d\u90e8\u7f72\u4e00\u4e2a\u4e3b\u4ece\u6a21\u5f0f\u7684Redis\uff0c\u6b64\u65f6\u4f7f\u7528StatefulSet\u90e8\u7f72\u5c31\u6781\u4e3a\u5408\u9002\uff0c\u56e0\u4e3aStatefulSet\u542f\u52a8\u65f6\uff0c\u53ea\u6709\u5f53\u524d\u4e00\u4e2a\u5bb9\u5668\u5b8c\u5168\u542f\u52a8\u65f6\uff0c\u540e\u4e00\u4e2a\u5bb9\u5668\u624d\u4f1a\u88ab\u8c03\u5ea6\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5bb9\u5668\u7684\u6807\u8bc6\u7b26\u662f\u56fa\u5b9a\u7684\uff0c \u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7\u6807\u8bc6\u7b26\u6765\u65ad\u5b9a\u5f53\u524dPod\u7684\u89d2\u8272\u3002</p> <p>\u6bd4\u5982\u7528\u4e00\u4e2a\u540d\u4e3aredis-ms\u7684StatefulSet\u90e8\u7f72\u4e3b\u4ece\u67b6\u6784\u7684Redis\uff0c\u7b2c\u4e00\u4e2a\u5bb9\u5668\u542f\u52a8\u65f6\uff0c\u5b83\u7684\u6807\u8bc6\u7b26\u4e3aredis-ms-0\uff0c\u5e76\u4e14Pod\u5185\u4e3b\u673a\u540d\u4e5f\u4e3aredis-ms-0\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u6839\u636e\u4e3b\u673a\u540d\u6765\u5224\u65ad\uff0c \u5f53\u4e3b\u673a\u540d\u4e3aredis-ms-0\u7684\u5bb9\u5668\u4f5c\u4e3aRedis\u7684\u4e3b\u8282\u70b9\uff0c\u5176\u4f59\u4e3a\u4ece\u8282\u70b9\uff0c\u90a3\u4e48Slave\u8fde\u63a5Master\u4e3b\u673a\u914d\u7f6e\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0d\u4f1a\u66f4\u6539\u7684Master\u7684Headless Service\uff0c\u6b64\u65f6Redis\u4ece\u8282\u70b9\uff08Slave\uff09\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff1a</p> <pre><code> port 6379\n slaveof redis-ms-0.redis-ms.public-service.svc.cluster.local 6379\n tcp-backlog 511\n timeout 0\n tcp-keepalive 0\n ...\n</code></pre> <p>\u5176\u4e2dredis-ms-0.redis-ms.public-service.svc.cluster.local\u662fRedis Master\u7684Headless Service\uff0c\u5728\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u4e0b\u53ea\u9700\u8981\u5199redis-ms-0.redis-ms\u5373\u53ef\uff0c\u540e\u9762\u7684public-service.svc.cluster.local\u53ef\u4ee5\u7701\u7565\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#32-statefulset\u7684\u6ce8\u610f\u4e8b\u9879","title":"3.2 StatefulSet\u7684\u6ce8\u610f\u4e8b\u9879","text":"<p>\u4e00\u822cStatefulSet\u7528\u4e8e\u6709\u4ee5\u4e0b\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u9700\u6c42\u7684\u5e94\u7528\u7a0b\u5e8f\uff1a</p> <ul> <li>\u9700\u8981\u7a33\u5b9a\u7684\u72ec\u4e00\u65e0\u4e8c\u7684\u7f51\u7edc\u6807\u8bc6\u7b26\u3002</li> <li>\u9700\u8981\u6301\u4e45\u5316\u6570\u636e\u3002</li> <li>\u9700\u8981\u6709\u5e8f\u7684\u3001\u4f18\u96c5\u7684\u90e8\u7f72\u548c\u6269\u5c55\u3002</li> <li>\u9700\u8981\u6709\u5e8f\u7684\u81ea\u52a8\u6eda\u52a8\u66f4\u65b0\u3002</li> </ul> <p>\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u4e0d\u9700\u8981\u4efb\u4f55\u7a33\u5b9a\u7684\u6807\u8bc6\u7b26\u6216\u8005\u6709\u5e8f\u7684\u90e8\u7f72\u3001\u5220\u9664\u6216\u8005\u6269\u5c55\uff0c\u5e94\u8be5\u4f7f\u7528\u65e0\u72b6\u6001\u7684\u63a7\u5236\u5668\u90e8\u7f72\u5e94\u7528\u7a0b\u5e8f\uff0c\u6bd4\u5982Deployment\u6216\u8005ReplicaSet\u3002StatefulSet\u662fKubernetes 1.9\u7248\u672c\u4e4b\u524d\u7684beta\u8d44\u6e90\uff0c\u57281.5\u7248\u672c\u4e4b\u524d\u7684\u4efb\u4f55Kubernetes\u7248\u672c\u90fd\u6ca1\u6709\u3002</p> <p>Pod\u6240\u7528\u7684\u5b58\u50a8\u5fc5\u987b\u7531PersistentVolume Provisioner\uff08\u6301\u4e45\u5316\u5377\u914d\u7f6e\u5668\uff09\u6839\u636e\u8bf7\u6c42\u914d\u7f6eStorageClass\uff0c\u6216\u8005\u7531\u7ba1\u7406\u5458\u9884\u5148\u914d\u7f6e\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e0d\u914d\u7f6e\u5b58\u50a8\u3002</p> <p>\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u5b89\u5168\uff0c\u5220\u9664\u548c\u7f29\u653eStatefulSet\u4e0d\u4f1a\u5220\u9664\u4e0eStatefulSet\u5173\u8054\u7684\u5377\uff0c\u53ef\u4ee5\u624b\u52a8\u9009\u62e9\u6027\u5730\u5220\u9664PVC\u548cPV\u3002</p> <p>StatefulSet\u76ee\u524d\u4f7f\u7528Headless Service\uff08\u65e0\u5934\u670d\u52a1\uff09\u8d1f\u8d23Pod\u7684\u7f51\u7edc\u8eab\u4efd\u548c\u901a\u4fe1\uff0c\u9700\u8981\u63d0\u524d\u521b\u5efa\u6b64\u670d\u52a1\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#33-\u5b9a\u4e49\u4e00\u4e2astatefulset\u8d44\u6e90\u6587\u4ef6","title":"3.3 \u5b9a\u4e49\u4e00\u4e2aStatefulSet\u8d44\u6e90\u6587\u4ef6","text":"<p>\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684StatefulSet\u7684\u793a\u4f8b\u5982\u4e0b\uff1a</p> <p>sts-web.yml</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\nname: nginx\nlabels:\napp: nginx\nspec:\nports:\n- port: 80\nname: web\nclusterIP: None\nselector:\napp: nginx\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\nname: web\nspec:\nserviceName: \"nginx\"\nreplicas: 2\nselector:\nmatchLabels:\napp: nginx\ntemplate:\nmetadata:\nlabels:\napp: nginx\nspec:\ncontainers:\n- name: nginx\nimage: nginx\nports:\n- containerPort: 80\nname: web\n</code></pre> <p>Warning</p> <p>\u6b64\u793a\u4f8b\u6ca1\u6709\u6dfb\u52a0\u5b58\u50a8\u914d\u7f6e\uff0c\u540e\u9762\u7684\u7ae0\u8282\u4f1a\u5355\u72ec\u8bb2\u89e3\u5b58\u50a8\u76f8\u5173\u7684\u77e5\u8bc6\u70b9\u3002</p> <p>\u5176\u4e2d\uff1a</p> <ul> <li>kind: Service\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u5b57\u4e3aNginx\u7684Headless Service\uff0c\u521b\u5efa\u7684Service\u683c\u5f0f\u4e3anginx-0.nginx.default.svc.cluster.local\uff0c\u5176\u4ed6\u7684\u7c7b\u4f3c\uff0c\u56e0\u4e3a\u6ca1\u6709\u6307\u5b9aNamespace\uff08\u547d\u540d\u7a7a\u95f4\uff09\uff0c\u6240\u4ee5\u9ed8\u8ba4\u90e8\u7f72\u5728default\u3002</li> <li>kind: StatefulSet\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u5b57\u4e3aweb\u7684StatefulSet\uff0creplicas\u8868\u793a\u90e8\u7f72Pod\u7684\u526f\u672c\u6570\uff0c\u672c\u5b9e\u4f8b\u4e3a2\u3002</li> </ul> <p>\u5728StatefulSet\u4e2d\u5fc5\u987b\u8bbe\u7f6ePod\u9009\u62e9\u5668\uff08.spec.selector\uff09\u7528\u6765\u5339\u914d\u5176\u6807\u7b7e\uff08.spec.template.metadata.labels\uff09\u3002 \u57281.8\u7248\u672c\u4e4b\u524d\uff0c\u5982\u679c\u672a\u914d\u7f6e\u8be5\u5b57\u6bb5\uff08.spec.selector\uff09\uff0c\u5c06\u88ab\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c\uff0c\u57281.8\u7248\u672c\u4e4b\u540e\uff0c\u5982\u679c\u672a\u6307\u5b9a\u5339\u914dPod Selector\uff0c\u5219\u4f1a\u5bfc\u81f4StatefulSet\u521b\u5efa\u9519\u8bef\u3002</p> <p>\u5f53StatefulSet\u63a7\u5236\u5668\u521b\u5efaPod\u65f6\uff0c\u5b83\u4f1a\u6dfb\u52a0\u4e00\u4e2a\u6807\u7b7estatefulset.kubernetes.io/pod-name\uff0c\u8be5\u6807\u7b7e\u7684\u503c\u4e3aPod\u7684\u540d\u79f0\uff0c\u7528\u4e8e\u5339\u914dService\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#34-\u521b\u5efastatefulset","title":"3.4 \u521b\u5efaStatefulSet","text":"<p>\u521b\u5efaStatefulSet\uff1a</p> <pre><code>$ kubectl create -f sts-web.yml\nservice/nginx created\nstatefulset.apps/web created\n\n$ kubectl get sts\nNAME   READY   AGE\nweb    2/2     41s\n\n$ kubectl get svc\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\nkubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   142d\nnginx        ClusterIP   None         &lt;none&gt;        80/TCP    67s\n\n$ kubectl get pod -l app=nginx\nNAME    READY   STATUS    RESTARTS   AGE\nweb-0   1/1     Running   0          6m57s\nweb-1   1/1     Running   0          6m36s\n</code></pre> <p>\u6b64\u65f6\u4f7f\u7528StatefulSet\u90e8\u7f72\u4e86\u4e24\u4e2aPod\uff0c\u5206\u522b\u4e3aweb-0\u3001web-1\uff0c\u540c\u65f6\u4e5f\u521b\u5efa\u4e00\u4e2aCLUSTER-IP\u4e3aNone\u7684Headless Service\uff0c</p> <p>\u5728\u540c\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u5185\u4f7f\u7528web-0.nginx\u548cweb-1.nginx\u5373\u53ef\u8bbf\u95ee\u8fd9\u4e24\u4e2aPod\uff0c</p> <p>\u8de8\u547d\u540d\u7a7a\u95f4\u53ef\u4ee5\u4f7f\u7528web-0.nginx.default\u8bbf\u95ee\uff08\u8de8\u547d\u540d\u7a7a\u95f4\u8bbf\u95ee\u8d44\u6e90\u7684\u60c5\u51b5\u5f88\u5c11\uff0c\u5e94\u5f53\u5c3d\u91cf\u89c4\u907f\uff09\u3002</p> <p>\u5411Headless Service\u5bf9\u8c61\u8bf7\u6c42\u670d\u52a1</p> <pre><code>$ kubectl run cirros-$RANDOM --rm -it --image=cirros -- sh\nIf you don't see a command prompt, try pressing enter.\n/ # / # curl web-0.nginx\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Welcome to nginx!&lt;/title&gt;\n&lt;style&gt;\n......\n&lt;/body&gt;\n&lt;/html&gt;\n\n/ # curl web-1.nginx\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Welcome to nginx!&lt;/title&gt;\n&lt;style&gt;\n......\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#35-statefulset\u521b\u5efapod\u7684\u6d41\u7a0b","title":"3.5 StatefulSet\u521b\u5efaPod\u7684\u6d41\u7a0b","text":"<p>StatefulSet\u7ba1\u7406\u7684Pod\u90e8\u7f72\u548c\u6269\u5c55\u89c4\u5219\u5982\u4e0b\uff1a</p> <ul> <li>\u5bf9\u4e8e\u5177\u6709N\u4e2a\u526f\u672c\u7684StatefulSet\uff0c\u5c06\u6309\u987a\u5e8f\u4ece0\u5230N\u20121\u5f00\u59cb\u521b\u5efaPod\u3002</li> <li>\u5f53\u5220\u9664Pod\u65f6\uff0c\u5c06\u6309\u7167N\u20121\u52300\u7684\u53cd\u987a\u5e8f\u7ec8\u6b62\u3002</li> <li>\u5728\u7f29\u653ePod\u4e4b\u524d\uff0c\u5fc5\u987b\u4fdd\u8bc1\u5f53\u524d\u7684Pod\u662fRunning\uff08\u8fd0\u884c\u4e2d\uff09\u6216\u8005Ready\uff08\u5c31\u7eea\uff09\u3002</li> <li>\u5728\u7ec8\u6b62Pod\u4e4b\u524d\uff0c\u5b83\u6240\u6709\u7684\u7ee7\u4efb\u8005\u5fc5\u987b\u662f\u5b8c\u5168\u5173\u95ed\u72b6\u6001\u3002</li> </ul> <p>StatefulSet\u7684pod.Spec.TerminationGracePeriodSeconds\uff08\u7ec8\u6b62Pod\u7684\u7b49\u5f85\u65f6\u95f4\uff09\u4e0d\u5e94\u8be5\u6307\u5b9a\u4e3a0\uff0c \u8bbe\u7f6e\u4e3a0\u5bf9StatefulSet\u7684Pod\u662f\u6781\u5176\u4e0d\u5b89\u5168\u7684\u505a\u6cd5\uff0c\u4f18\u96c5\u5730\u5220\u9664StatefulSet\u7684Pod\u662f\u975e\u5e38\u6709\u5fc5\u8981\u7684\uff0c\u800c\u4e14\u662f\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u786e\u4fdd\u5728Kubelet\u4eceAPIServer\u5220\u9664\u4e4b\u524d\uff0c\u8ba9Pod\u6b63\u5e38\u5173\u95ed\u3002</p> <p>\u5f53\u521b\u5efa\u4e0a\u9762\u7684Nginx\u5b9e\u4f8b\u65f6\uff0cPod\u5c06\u6309web-0\u3001web-1\u3001web-2\u7684\u987a\u5e8f\u90e8\u7f723\u4e2aPod\u3002</p> <p>\u5728web-0\u5904\u4e8eRunning\u6216\u8005Ready\u4e4b\u524d\uff0cweb-1\u4e0d\u4f1a\u88ab\u90e8\u7f72\uff0c\u76f8\u540c\u7684\uff0cweb-2\u5728web-1\u672a\u5904\u4e8eRunning\u548cReady\u4e4b\u524d\u4e5f\u4e0d\u4f1a\u88ab\u90e8\u7f72\u3002</p> <p>\u5982\u679c\u5728web-1\u5904\u4e8eRunning\u548cReady\u72b6\u6001\u65f6\uff0cweb-0\u53d8\u6210Failed\uff08\u5931\u8d25\uff09\u72b6\u6001\uff0c\u90a3\u4e48web-2\u5c06\u4e0d\u4f1a\u88ab\u542f\u52a8\uff0c\u76f4\u5230web-0\u6062\u590d\u4e3aRunning\u548cReady\u72b6\u6001\u3002</p> <p>\u5982\u679c\u7528\u6237\u5c06StatefulSet\u7684replicas\u8bbe\u7f6e\u4e3a1\uff0c\u90a3\u4e48web-2\u5c06\u9996\u5148\u88ab\u7ec8\u6b62\uff0c\u5728\u5b8c\u5168\u5173\u95ed\u5e76\u5220\u9664web-2\u4e4b\u524d\uff0c\u4e0d\u4f1a\u5220\u9664web-1\u3002</p> <p>\u5982\u679cweb-2\u7ec8\u6b62\u5e76\u4e14\u5b8c\u5168\u5173\u95ed\u540e\uff0cweb-0\u7a81\u7136\u5931\u8d25\uff0c\u90a3\u4e48\u5728web-0\u672a\u6062\u590d\u6210Running\u6216\u8005Ready\u65f6\uff0cweb-1\u4e0d\u4f1a\u88ab\u5220\u9664\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#36-statefulset\u6269\u5bb9\u548c\u7f29\u5bb9","title":"3.6 StatefulSet\u6269\u5bb9\u548c\u7f29\u5bb9","text":"<p>\u548cDeployment\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u901a\u8fc7\u66f4\u65b0replicas\u5b57\u6bb5\u6269\u5bb9/\u7f29\u5bb9StatefulSet\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528kubectl scale\u3001kubectl edit\u548ckubectl patch\u6765\u6269\u5bb9/\u7f29\u5bb9\u4e00\u4e2aStatefulSet\u3002</p> <p>\uff081\uff09\u6269\u5bb9</p> <p>\u5c06\u4e0a\u8ff0\u521b\u5efa\u7684StatefulSet\u526f\u672c\u589e\u52a0\u52305\u4e2a\uff08\u5982\u679cStatefulSet\u6302\u8f7d\u7684\u4e3a\u9759\u6001PV\uff0c\u9700\u8981\u5728\u6269\u5bb9\u4e4b\u524d\u5148\u521b\u5efaPV\uff09\uff1a</p> <pre><code>$ kubectl scale sts web --replicas=5\nstatefulset.apps/web scaled\n</code></pre> <p>\u67e5\u770b\u6269\u5bb9\u540ePod\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pod\nNAME              READY   STATUS    RESTARTS   AGE\nweb-0             1/1     Running   0          34m\nweb-1             1/1     Running   0          34m\nweb-2             1/1     Running   0          2m37s\nweb-3             1/1     Running   0          2m12s\nweb-4             1/1     Running   0          109s\n</code></pre> <p>\u4e5f\u53ef\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u52a8\u6001\u67e5\u770b\uff1a</p> <pre><code>$ kubectl get pod -l app=nginx -w\nNAME    READY   STATUS    RESTARTS   AGE\nweb-0   1/1     Running   0          34m\nweb-1   1/1     Running   0          33m\nweb-2   1/1     Running   0          2m12s\nweb-3   1/1     Running   0          107s\nweb-4   1/1     Running   0          84s\n</code></pre> <p>\uff082\uff09\u7f29\u5bb9</p> <p>\u9996\u5148\u6253\u5f00\u53e6\u4e00\u4e2a\u7ec8\u7aef\u52a8\u6001\u67e5\u770b\u7f29\u5bb9\u7684\u6d41\u7a0b\uff1a</p> <pre><code>$ kubectl get pod -l app=nginx -w\n</code></pre> <p>\u5728\u53e6\u4e00\u4e2a\u7ec8\u7aef\u5c06\u526f\u672c\u6570\u6539\u4e3a3\uff08\u6b64\u5904\u6f14\u793a\u7684\u4e3apatch\u547d\u4ee4\uff0cpatch\u6bd4edit\u548cscale\u7a0d\u590d\u6742\u4e00\u4e9b\uff09\uff1a</p> <pre><code>$ kubectl patch sts web -p '{\"spec\":{\"replicas\":3}}'\nstatefulset.apps/web patched\n</code></pre> <p>\u6b64\u65f6\u53ef\u4ee5\u770b\u5230\u7b2c\u4e00\u4e2a\u7ec8\u7aef\u663e\u793aweb-4\u548cweb-3\u7684Pod\u6b63\u5728\u88ab\u6709\u5e8f\u5730\u5220\u9664\uff08\u6216\u7ec8\u6b62\uff09\uff1a</p> <pre><code>$ kubectl get pod -l app=nginx -w\nNAME    READY   STATUS    RESTARTS   AGE\nweb-0   1/1     Running   0          34m\nweb-1   1/1     Running   0          33m\nweb-2   1/1     Running   0          2m12s\nweb-3   1/1     Running   0          107s\nweb-4   1/1     Running   0          84s\nweb-4   1/1     Terminating   0          3m17s\nweb-4   0/1     Terminating   0          3m18s\nweb-4   0/1     Terminating   0          3m19s\nweb-4   0/1     Terminating   0          3m19s\nweb-3   1/1     Terminating   0          3m42s\nweb-3   0/1     Terminating   0          3m43s\nweb-3   0/1     Terminating   0          3m47s\nweb-3   0/1     Terminating   0          3m47s\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#37-statefulset\u66f4\u65b0\u7b56\u7565","title":"3.7 StatefulSet\u66f4\u65b0\u7b56\u7565","text":"<p>StatefulSet\u548cDeployment\u4e00\u6837\uff0c\u4e5f\u63d0\u4f9b\u4e86\u591a\u79cd\u66f4\u65b0\u7b56\u7565\uff0c\u53ef\u4ee5\u5728.spec.updateStrategy\u5b57\u6bb5\u4e2d\u6307\u5b9aStatefulSet\u7684\u66f4\u65b0\u7b56\u7565\u3002</p> <p>\uff081\uff09OnDelete\u7b56\u7565</p> <p>OnDelete\u66f4\u65b0\u7b56\u7565\u5b9e\u73b0\u4e86\u4f20\u7edf\uff081.7\u7248\u672c\u4e4b\u524d\uff09\u7684\u884c\u4e3a\uff0c\u5b83\u4e5f\u662f\u9ed8\u8ba4\u7684\u66f4\u65b0\u7b56\u7565\u3002 \u5f53\u6211\u4eec\u9009\u62e9\u8fd9\u4e2a\u66f4\u65b0\u7b56\u7565\u5e76\u4fee\u6539StatefulSet\u7684.spec.template\u5b57\u6bb5\u65f6\uff0cStatefulSet\u63a7\u5236\u5668\u4e0d\u4f1a\u81ea\u52a8\u66f4\u65b0Pod\uff0c\u5fc5\u987b\u624b\u52a8\u5220\u9664Pod\u624d\u80fd\u4f7f\u63a7\u5236\u5668\u521b\u5efa\u65b0\u7684Pod\u3002</p> <p>\uff082\uff09RollingUpdate\u7b56\u7565</p> <p>RollingUpdate\uff08\u6eda\u52a8\u66f4\u65b0\uff09\u7b56\u7565\u4f1a\u81ea\u52a8\u66f4\u65b0\u4e00\u4e2aStatefulSet\u4e2d\u6240\u6709\u7684Pod\uff0c\u91c7\u7528\u4e0e\u5e8f\u53f7\u7d22\u5f15\u76f8\u53cd\u7684\u987a\u5e8f\u8fdb\u884c\u6eda\u52a8\u66f4\u65b0\u3002</p> <p>\u6bd4\u5982\u66f4\u6539\u4e00\u4e2a\u540d\u79f0\u4e3aweb\u7684StatefulSet\u4f7f\u7528RollingUpdate\u65b9\u5f0f\u66f4\u65b0\uff1a</p> <pre><code>$ kubectl patch sts web -p '{\"spec\":{\"updateStrategy\":{\"type\":\"RollingUpdate\"}}}'\nstatefulset.apps/web patched (no change)\n</code></pre> <p>\u67e5\u770b\u66f4\u6539\u540e\u7684StatefulSet\uff1a</p> <pre><code>$ kubectl get sts web -o yaml|grep -A 1 \"updateStrategy\"\nupdateStrategy:\n    rollingUpdate:\n</code></pre> <p>\u7136\u540e\u6539\u53d8\u5bb9\u5668\u7684\u955c\u50cf\u89e6\u53d1\u6eda\u52a8\u66f4\u65b0\uff08\u6b64\u5904\u4f7f\u7528jsonPath\u7684\u65b9\u5f0f\u66f4\u6539\u7684\u8d44\u6e90\u914d\u7f6e\uff0c\u53ef\u4ee5\u4f7f\u7528set\u6216edit\u51cf\u5c11\u590d\u6742\u5ea6\uff09\uff1a</p> <pre><code>$ kubectl patch statefulset web --type='json' -p='[{\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/image\", \"value\":\"gcr.io/google_containers/nginx-slim:0.8\"}]'\n</code></pre> <p>\u5982\u4e0a\u6240\u8ff0\uff0cStatefulSet\u4e2d\u7684Pod\u91c7\u7528\u548c\u5e8f\u53f7\u76f8\u53cd\u7684\u987a\u5e8f\u66f4\u65b0\u3002</p> <p>\u5728\u66f4\u65b0\u4e0b\u4e00\u4e2aPod\u524d\uff0cStatefulSet\u63a7\u5236\u5668\u4f1a\u7ec8\u6b62\u6bcf\u4e00\u4e2aPod\u5e76\u7b49\u5f85\u5b83\u4eec\u53d8\u6210Running\u548cReady\u72b6\u6001\u3002 \u5728\u5f53\u524d\u987a\u5e8f\u53d8\u6210Running\u548cReady\u72b6\u6001\u4e4b\u524d\uff0cStatefulSet\u63a7\u5236\u5668\u4e0d\u4f1a\u66f4\u65b0\u4e0b\u4e00\u4e2aPod\uff0c\u4f46\u5b83\u4ecd\u7136\u4f1a\u91cd\u5efa\u4efb\u4f55\u5728\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u53d1\u751f\u6545\u969c\u7684Pod\uff0c\u4f7f\u7528\u5b83\u4eec\u5f53\u524d\u7684\u7248\u672c\u3002 \u5df2\u7ecf\u63a5\u6536\u5230\u8bf7\u6c42\u7684Pod\u5c06\u4f1a\u88ab\u6062\u590d\u4e3a\u66f4\u65b0\u7684\u7248\u672c\uff0c\u6ca1\u6709\u6536\u5230\u8bf7\u6c42\u7684Pod\u5219\u4f1a\u88ab\u6062\u590d\u4e3a\u4e4b\u524d\u7684\u7248\u672c\u3002</p> <p>\u5728\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4f7f\u7528<code>kubectl rollout status sts/&lt;name&gt;</code>\u6765\u67e5\u770b\u6eda\u52a8\u66f4\u65b0\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl rollout status sts/web\nWaiting for 1 pods to be ready...\nwaiting for statefulset rolling update to complete 1 pods at revision web-56b5798f76...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\nwaiting for statefulset rolling update to complete 2 pods at revision web-56b5798f76...\nWaiting for 1 pods to be ready...\nWaiting for 1 pods to be ready...\nstatefulset rolling update complete 3 pods at revision web-56b5798f76...\n</code></pre> <p>\u67e5\u770b\u66f4\u65b0\u540e\u7684\u955c\u50cf\uff1a</p> <pre><code>$ for p in 0 1 2; do kubectl get pod \"web-$p\" --template '{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}'; echo; done\n</code></pre> <p>\uff083\uff09\u5206\u6bb5\u66f4\u65b0</p> <p>StatefulSet\u53ef\u4ee5\u4f7f\u7528RollingUpdate\u66f4\u65b0\u7b56\u7565\u7684partition\u53c2\u6570\u6765\u5206\u6bb5\u66f4\u65b0\u4e00\u4e2aStatefulSet\u3002</p> <p>\u5206\u6bb5\u66f4\u65b0\u5c06\u4f1a\u4f7fStatefulSet\u4e2d\u5176\u4f59\u7684\u6240\u6709Pod\uff08\u5e8f\u53f7\u5c0f\u4e8e\u5206\u533a\uff09\u4fdd\u6301\u5f53\u524d\u7248\u672c\uff0c\u53ea\u66f4\u65b0\u5e8f\u53f7\u5927\u4e8e\u7b49\u4e8e\u5206\u533a\u7684Pod\uff0c\u5229\u7528\u6b64\u7279\u6027\u53ef\u4ee5\u7b80\u5355\u5b9e\u73b0\u91d1\u4e1d\u96c0\u53d1\u5e03\uff08\u7070\u5ea6\u53d1\u5e03\uff09\u6216\u8005\u5206\u9636\u6bb5\u63a8\u51fa\u65b0\u529f\u80fd\u7b49\u3002</p> <p>\u63d0\u793a</p> <p>\u91d1\u4e1d\u96c0\u53d1\u5e03\u662f\u6307\u5728\u9ed1\u4e0e\u767d\u4e4b\u95f4\u80fd\u591f\u5e73\u6ed1\u8fc7\u6e21\u7684\u4e00\u79cd\u53d1\u5e03\u65b9\u5f0f\u3002</p> <p>\u6bd4\u5982\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u5206\u533a\"partition\":3\uff0c\u53ef\u4ee5\u4f7f\u7528patch\u6216edit\u76f4\u63a5\u5bf9StatefulSet\u8fdb\u884c\u8bbe\u7f6e\uff1a</p> <pre><code>$ kubectl patch statefulset web -p '{\"spec\":{\"updateStrategy\":{\"type\":\"RollingUpdate\",\"rollingUpdate\":{\"partition\":3}}}}'\n</code></pre> <p>\u7136\u540e\u518d\u6b21\u4f7f\u7528patch\u6539\u53d8\u5bb9\u5668\u7684\u955c\u50cf\uff1a</p> <pre><code>$ kubectl patch statefulset web --type='json' -p='[{\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/image\", \"value\":\"registry.k8s.io/nginx-slim:0.7\"}]'\nstatefulset.apps/web patched\n</code></pre> <p>\u5220\u9664 StatefulSet \u4e2d\u7684 Pod \u89e6\u53d1\u66f4\u65b0\uff1a</p> <pre><code>$ kubectl delete pod web-2\npod \"web-2\" deleted\n</code></pre> <p>\u6b64\u65f6\uff0c\u56e0\u4e3aPod web-2\u7684\u5e8f\u53f7\u5c0f\u4e8e\u5206\u533a3\uff0c\u6240\u4ee5Pod\u4e0d\u4f1a\u88ab\u66f4\u65b0\uff0c\u8fd8\u662f\u4f1a\u4f7f\u7528\u4ee5\u524d\u7684\u5bb9\u5668\u6062\u590dPod\u3002</p> <p>\u7b49\u5f85Pod\u53d8\u6210Running\u548cReady\u3002</p> <pre><code>$ kubectl get pod -l app=nginx -w\nNAME      READY     STATUS              RESTARTS   AGE\nweb-0     1/1       Running             0          4m\nweb-1     1/1       Running             0          4m\nweb-2     0/1       ContainerCreating   0          11s\nweb-2     1/1       Running   0         18s\n</code></pre> <p>\u5c06\u5206\u533a\u6539\u4e3a2\uff0c\u6b64\u65f6\u4f1a\u81ea\u52a8\u66f4\u65b0web-2\uff08\u56e0\u4e3a\u4e4b\u524d\u66f4\u6539\u4e86\u66f4\u65b0\u7b56\u7565\uff09\uff0c\u4f46\u662f\u4e0d\u4f1a\u66f4\u65b0web-0\u548cweb-1\uff1a</p> <pre><code>$ kubectl patch statefulset web -p '{\"spec\":{\"updateStrategy\":{\"type\":\"RollingUpdate\",\"rollingUpdate\":{\"partition\":2}}}}'\n</code></pre> <p>\u6309\u7167\u4e0a\u8ff0\u65b9\u5f0f\u53ef\u4ee5\u5b9e\u73b0\u5206\u9636\u6bb5\u66f4\u65b0\uff0c\u7c7b\u4f3c\u4e8e\u7070\u5ea6/\u91d1\u4e1d\u96c0\u53d1\u5e03\u3002\u67e5\u770b\u6700\u7ec8\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>$ for p in 0 1 2; do kubectl get pod \"web-$p\" --template '{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}'; echo; done\nregistry.k8s.io/nginx-slim:0.8\nregistry.k8s.io/nginx-slim:0.8\nregistry.k8s.io/nginx-slim:0.8\n</code></pre> <p>\u8bf7\u6ce8\u610f</p> <p>\u867d\u7136\u66f4\u65b0\u7b56\u7565\u662fRollingUpdate\uff0cStatefulSet \u8fd8\u662f\u4f1a\u4f7f\u7528\u539f\u59cb\u7684\u5bb9\u5668\u6062\u590dPod\u3002 \u8fd9\u662f\u56e0\u4e3aPod\u7684\u5e8f\u53f7\u6bd4updateStrategy\u6307\u5b9a\u7684partition\u66f4\u5c0f\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#38-\u5220\u9664statefulset","title":"3.8 \u5220\u9664StatefulSet","text":"<p>\u5220\u9664StatefulSet\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u5373\u7ea7\u8054\u5220\u9664\u548c\u975e\u7ea7\u8054\u5220\u9664\u3002\u4f7f\u7528\u975e\u7ea7\u8054\u65b9\u5f0f\u5220\u9664StatefulSet\u65f6\uff0cStatefulSet\u7684Pod\u4e0d\u4f1a\u88ab\u5220\u9664\uff1b</p> <p>\u4f7f\u7528\u7ea7\u8054\u65b9\u5f0f\u5220\u9664StatefulSet\u65f6\uff0cStatefulSet\u548c\u5b83\u7684Pod\u90fd\u4f1a\u88ab\u5220\u9664\u3002</p> <p>\uff081\uff09\u975e\u7ea7\u8054\u5220\u9664</p> <p>\u4f7f\u7528kubectl delete sts xxx\u5220\u9664StatefulSet\u65f6\uff0c\u53ea\u9700\u63d0\u4f9b--cascade=false\u53c2\u6570\uff0c\u5c31\u4f1a\u91c7\u7528\u975e\u7ea7\u8054\u5220\u9664\uff0c\u6b64\u65f6\u5220\u9664StatefulSet\u4e0d\u4f1a\u5220\u9664\u5b83\u7684Pod\uff1a</p> <pre><code>$ kubectl delete statefulset web --cascade=false\nwarning: --cascade=false is deprecated (boolean value) and can be replaced with --cascade=orphan.\nstatefulset.apps \"web\" deleted\n\n$ kubectl get sts\nNo resources found in default namespace.\n\n$ kubectl get pod\nNAME              READY   STATUS    RESTARTS   AGE\nweb-0             1/1     Running   0          10m\nweb-1             1/1     Running   0          10m\nweb-2             1/1     Running   0          7m28s\n</code></pre> <p>\u7531\u4e8e\u6b64\u65f6\u5220\u9664\u4e86StatefulSet\uff0c\u5b83\u7ba1\u7406\u7684Pod\u53d8\u6210\u4e86\u201c\u5b64\u513f\u201dPod\uff0c\u56e0\u6b64\u5355\u72ec\u5220\u9664Pod\u65f6\uff0c\u8be5Pod\u4e0d\u4f1a\u88ab\u91cd\u5efa\uff1a</p> <pre><code>$ kubectl get pod\nNAME              READY   STATUS    RESTARTS   AGE\nweb-0             1/1     Running   0          3m11s\nweb-1             1/1     Running   0          2m51s\nweb-2             1/1     Running   0          2m34s\n\n$ kubectl delete po web-0\npod \"web-0\" deleted\n\n$ kubectl get pod\nNAME              READY   STATUS    RESTARTS   AGE\nweb-1             1/1     Running   0          3m53s\nweb-2             1/1     Running   0          3m36s\n</code></pre> <p>\u5f53\u518d\u6b21\u521b\u5efa\u6b64StatefulSet\u65f6\uff0cweb-0\u4f1a\u88ab\u91cd\u65b0\u521b\u5efa\uff0c\u7531\u4e8eweb-1\u5df2\u7ecf\u5b58\u5728\uff0c\u56e0\u6b64\u4e0d\u4f1a\u88ab\u518d\u6b21\u521b\u5efa\uff0c\u56e0\u4e3a\u6700\u521d\u6b64StatefulSet\u7684replicas\u662f2\uff0c\u6240\u4ee5web-2\u4f1a\u88ab\u5220\u9664\uff0c \u4ee3\u7801\u5982\u4e0b\uff08\u5ffd\u7565AlreadyExists\u9519\u8bef\uff0c\u56e0\u4e3a\u53ea\u5220\u9664\u4e86StatefulSet\u5e76\u6ca1\u5220\u9664Service\uff0c\u6240\u4ee5\u5728\u6b64\u521b\u5efaService\u65f6\u4f1a\u63d0\u793a\u5df2\u7ecf\u5b58\u5728\u8be5Service\uff09\uff1a</p> <pre><code>$ kubectl create -f sts-web.yml\nstatefulset.apps/web created\nError from server (AlreadyExists): error when creating \"sts-web.yml\": services \"nginx\" already exists\n\n$  kubectl get pod\nNAME              READY   STATUS    RESTARTS   AGE\nweb-0             1/1     Running   0          79s\nweb-1             1/1     Running   0          4m28s\n</code></pre> <p>\uff082\uff09\u7ea7\u8054\u5220\u9664</p> <p>\u7701\u7565--cascade=false\u53c2\u6570\u5373\u4e3a\u7ea7\u8054\u5220\u9664\uff1a</p> <pre><code>$ kubectl delete sts web\nstatefulset.apps \"web\" deleted\n\n$ kubectl get pod\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528-f\u6307\u5b9a\u521b\u5efaStatefulSet\u548cService\u7684YAML\u6587\u4ef6\uff0c\u76f4\u63a5\u5220\u9664StatefulSet\u548cService\uff08\u6b64\u6587\u4ef6\u5c06StatefulSet\u548cService\u5199\u5728\u4e86\u4e00\u8d77\uff09\uff1a</p> <pre><code>$ kubectl delete -f sts-web.yml\nservice \"nginx\" deleted\nError from server (NotFound): error when deleting \"sts-web.yml\": statefulsets.apps \"web\" not found\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>https://kubernetes.io/zh-cn/docs/tutorials/stateful-application/basic-stateful-set/</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#4\u5b88\u62a4\u8fdb\u7a0b\u96c6daemonset","title":"4.\u5b88\u62a4\u8fdb\u7a0b\u96c6DaemonSet","text":"<p>DaemonSet\uff08\u5b88\u62a4\u8fdb\u7a0b\u96c6\uff0c\u7f29\u5199\u4e3ads\uff09\u548c\u5b88\u62a4\u8fdb\u7a0b\u7c7b\u4f3c\uff0c\u5b83\u5728\u7b26\u5408\u5339\u914d\u6761 \u4ef6\u7684\u8282\u70b9\u4e0a\u5747\u90e8\u7f72\u4e00\u4e2aPod\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#41-\u4ec0\u4e48\u662fdaemonset","title":"4.1 \u4ec0\u4e48\u662fDaemonSet","text":"<p>\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u5728\u6bcf\u4e2aKubernetes\u8282\u70b9\u6216\u7b26\u5408\u6761\u4ef6\u7684\u8282\u70b9\u4e0a\u90fd\u90e8\u7f72\u67d0\u4e2a\u5e94\u7528\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u4f7f\u7528Kubernetes\u7684DaemonSet\u8c03\u5ea6Pod\u3002 DaemonSet\u786e\u4fdd\u5168\u90e8\uff08\u6216\u8005\u67d0\u4e9b\u7b26\u5408\u6761\u4ef6\uff09\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2aPod\u526f\u672c\u3002</p> <p>\u5f53\u6709\u65b0\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\u65f6\uff0c\u4e5f\u4f1a\u4e3a\u5b83\u4eec\u65b0\u589e\u4e00\u4e2aPod\uff0c\u5f53\u8282\u70b9\u4ece\u96c6\u7fa4\u4e2d\u79fb\u9664\u65f6\uff0c\u8fd9\u4e9bPod\u4e5f\u4f1a\u88ab\u56de\u6536\uff0c\u5220\u9664DaemonSet\u5c06\u4f1a\u5220\u9664\u5b83\u521b\u5efa\u7684\u6240\u6709Pod\u3002</p> <p>\u4f7f\u7528DaemonSet\u7684\u4e00\u4e9b\u5178\u578b\u7528\u6cd5\uff1a</p> <ul> <li>\u8fd0\u884c\u96c6\u7fa4\u5b58\u50a8daemon\uff08\u5b88\u62a4\u8fdb\u7a0b\uff09\uff0c\u4f8b\u5982\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884cGlusterd\u3001Ceph\u7b49\u3002</li> <li>\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u65e5\u5fd7\u6536\u96c6daemon\uff0c\u4f8b\u5982Fluentd\u3001Logstash\u3002</li> <li>\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u76d1\u63a7daemon\uff0c\u6bd4\u5982Prometheus Node Exporter\u3001Collectd\u3001Datadog\u4ee3\u7406\u3001New Relic\u4ee3\u7406\u6216Ganglia gmond\u3002</li> </ul>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#42-\u5b9a\u4e49\u4e00\u4e2adaemonset","title":"4.2 \u5b9a\u4e49\u4e00\u4e2aDaemonSet","text":"<p>\u521b\u5efa\u4e00\u4e2aDaemonSet\u548cDeployment\u7c7b\u4f3c\uff0c\u6bd4\u5982\u521b\u5efa\u4e00\u4e2afluentd\u7684DaemonSet\uff1a</p> <p>fluentd-ds.yml</p> <pre><code>apiVersion: apps/v1\nkind: DaemonSet # kind\u4e3aDaemonSet\nmetadata:\nname: fluentd-es-v2.0.4\nnamespace: logging\nlabels:\nk8s-app: fluentd-es\nversion: v2.0.4\nkubernetes.io/cluster-service: \"true\"\naddonmanager.kubernetes.io/mode: Reconcile\nspec:\nselector:\nmatchLabels:\nk8s-app: fluentd-es\nversion: v2.0.4\ntemplate:\nmetadata:\nlabels:\nk8s-app: fluentd-es\nkubernetes.io/cluster-service: \"true\"\nversion: v2.0.4\n# This annotation ensures that fluentd does not get evicted if the node\n# supports critical pod annotation based priority scheme.\n# Note that this does not guarantee admission on the nodes (#40573).\nannotations:\nscheduler.alpha.kubernetes.io/critical-pod: ''\nseccomp.security.alpha.kubernetes.io/pod: 'docker/default'\nspec:\nserviceAccountName: fluentd-es\ncontainers:\n- name: fluentd-es\nimage: k8s.gcr.io/fluentd-elasticsearch:v2.0.4\nenv:\n- name: FLUENTD_ARGS\nvalue: --no-supervisor -q\nresources:\nlimits:\nmemory: 500Mi\nrequests:\ncpu: 100m\nmemory: 200Mi\nvolumeMounts:\n- name: varlog\nmountPath: /var/log\n- name: varlibdockercontainers\nmountPath: /var/lib/docker/containers\nreadOnly: true\n- name: config-volume\nmountPath: /etc/fluent/config.d\nnodeSelector:\nbeta.kubernetes.io/fluentd-ds-ready: \"true\"\nterminationGracePeriodSeconds: 30\nvolumes:\n- name: varlog\nhostPath:\npath: /var/log\n- name: varlibdockercontainers\nhostPath:\npath: /var/lib/docker/containers\n- name: config-volume\nconfigMap:\nname: fluentd-es-config-v0.1.4\n</code></pre> <p>\uff081\uff09\u5fc5\u9700\u5b57\u6bb5</p> <p>\u548c\u5176\u4ed6\u6240\u6709Kubernetes\u914d\u7f6e\u4e00\u6837\uff0cDaemonSet\u9700\u8981apiVersion\u3001kind\u548cmetadata\u5b57\u6bb5\uff0c\u540c\u65f6\u4e5f\u9700\u8981\u4e00\u4e2a.spec\u914d\u7f6e\u6bb5\u3002</p> <p>\uff082\uff09Pod\u6a21\u677f</p> <p>.spec\u552f\u4e00\u9700\u8981\u7684\u5b57\u6bb5\u662f.spec.template\u3002.spec.template\u662f\u4e00\u4e2aPod\u6a21\u677f\uff0c\u5b83\u4e0ePod\u5177\u6709\u76f8\u540c\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u4f46\u5b83\u4e0d\u5177\u6709apiVersion\u548ckind\u5b57\u6bb5\u3002\u9664\u4e86Pod\u5fc5\u9700\u7684\u5b57\u6bb5\u5916\uff0c\u5728DaemonSet\u4e2d\u7684Pod\u6a21\u677f\u5fc5\u987b\u6307\u5b9a\u5408\u7406\u7684\u6807\u7b7e\u3002</p> <p>\u5728DaemonSet\u4e2d\u7684Pod\u6a21\u677f\u5fc5\u987b\u5177\u6709\u4e00\u4e2aRestartPolicy\uff0c\u9ed8\u8ba4\u4e3aAlways\u3002</p> <p>\uff083\uff09Pod Selector</p> <p>.spec.selector\u5b57\u6bb5\u8868\u793aPod Selector\uff0c\u5b83\u4e0e\u5176\u4ed6\u8d44\u6e90\u7684.spec.selector\u7684\u4f5c\u7528\u76f8\u540c\u3002</p> <p>.spec.selector\u8868\u793a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5b83\u7531\u5982\u4e0b\u4e24\u4e2a\u5b57\u6bb5\u7ec4\u6210\uff1a</p> <ul> <li>matchLabels\uff1a\u4e0eReplicationController\u7684.spec.selector\u7684\u4f5c\u7528\u76f8\u540c\uff0c\u7528\u4e8e\u5339\u914d\u7b26\u5408\u6761\u4ef6\u7684Pod\u3002</li> <li>matchExpressions\uff1a\u5141\u8bb8\u6784\u5efa\u66f4\u52a0\u590d\u6742\u7684Selector\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9akey\u3001value\u5217\u8868\u4ee5\u53ca\u4e0ekey\u548cvalue\u5217\u8868\u76f8\u5173\u7684\u64cd\u4f5c\u7b26\u3002</li> </ul> <p>\u5982\u679c\u4e0a\u8ff0\u4e24\u4e2a\u5b57\u6bb5\u90fd\u6307\u5b9a\uff0c\u7ed3\u679c\u8868\u793a\u7684\u662fAND\u5173\u7cfb\uff08\u903b\u8f91\u4e0e\u7684\u5173\u7cfb\uff09\u3002</p> <p>.spec.selector\u5fc5\u987b\u4e0e.spec.template.metadata.labels\u76f8\u5339\u914d\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff08APIVersion\u4e3aapps/v1\u5fc5\u987b\u6307\u5b9a\u8be5\u5b57\u6bb5\uff09\uff0c\u9ed8\u8ba4\u662f\u7b49\u4ef7\u7684\uff0c\u5982\u679c\u5b83\u4eec\u7684\u914d\u7f6e\u4e0d\u5339\u914d\uff0c\u5219\u4f1a\u88abAPI\u62d2\u7edd\u3002</p> <p>\uff084\uff09\u6307\u5b9a\u8282\u70b9\u90e8\u7f72Pod</p> <p>\u5982\u679c\u6307\u5b9a\u4e86.spec.template.spec.nodeSelector\uff0cDaemonSet Controller\u5c06\u5728\u4e0eNode Selector(\u8282\u70b9\u9009\u62e9\u5668)\u5339\u914d\u7684\u8282\u70b9\u4e0a\u521b\u5efaPod\uff0c\u6bd4\u5982\u90e8\u7f72\u5728\u78c1\u76d8\u7c7b\u578b\u4e3assd\u7684\u8282\u70b9\u4e0a(\u9700\u8981\u63d0\u524d\u7ed9\u8282\u70b9\u5b9a\u4e49\u6807\u7b7eLabel)\uff1a</p> <pre><code>      nodeSelector:\n        disktype: ssd\n</code></pre> <p>\u63d0\u793a</p> <p>Node Selector\u540c\u6837\u9002\u7528\u4e8e\u5176\u4ed6Controller\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#43-\u521b\u5efadaemonset","title":"4.3 \u521b\u5efaDaemonSet","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u516c\u53f8\u4e1a\u52a1\u7684\u5e94\u7528\u7a0b\u5e8f\u4e00\u822c\u65e0\u987b\u4f7f\u7528DaemonSet\u90e8\u7f72\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u53ea\u6709\u50cfFluentd\uff08\u65e5\u5fd7\u6536\u96c6\uff09\u3001Ingress\uff08\u96c6\u7fa4\u670d\u52a1\u5165\u53e3\uff09\u3001Calico\uff08\u96c6\u7fa4\u7f51\u7edc\u7ec4\u4ef6\uff09\u3001 Node-Exporter\uff08\u76d1\u63a7\u6570\u636e\u91c7\u96c6\uff09\u7b49\u624d\u9700\u8981\u4f7f\u7528DaemonSet\u90e8\u7f72\u5230\u6bcf\u4e2a\u8282\u70b9\uff0c\u672c\u8282\u53ea\u6f14\u793aDaemonSet\u7684\u4f7f\u7528\u3002</p> <p>\u6bd4\u5982\u521b\u5efa\u4e00\u4e2aNginx Ingress\uff08\u53ef\u4ee5\u5728\u5bf9\u5e94\u7684\u7ae0\u8282\u627e\u5230\u8be5\u6587\u4ef6\uff09</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\nname: ingress-nginx\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\nname: nginx-configuration\nnamespace: ingress-nginx\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\nname: tcp-services\nnamespace: ingress-nginx\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\nname: udp-services\nnamespace: ingress-nginx\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\nname: nginx-ingress-serviceaccount\nnamespace: ingress-nginx\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRole\nmetadata:\nname: nginx-ingress-clusterrole\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\nrules:\n- apiGroups:\n- \"\"\nresources:\n- configmaps\n- endpoints\n- nodes\n- pods\n- secrets\nverbs:\n- list\n- watch\n- apiGroups:\n- \"\"\nresources:\n- nodes\nverbs:\n- get\n- apiGroups:\n- \"\"\nresources:\n- services\nverbs:\n- get\n- list\n- watch\n- apiGroups:\n- \"extensions\"\nresources:\n- ingresses\nverbs:\n- get\n- list\n- watch\n- apiGroups:\n- \"\"\nresources:\n- events\nverbs:\n- create\n- patch\n- apiGroups:\n- \"extensions\"\nresources:\n- ingresses/status\nverbs:\n- update\n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: Role\nmetadata:\nname: nginx-ingress-role\nnamespace: ingress-nginx\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\nrules:\n- apiGroups:\n- \"\"\nresources:\n- configmaps\n- pods\n- secrets\n- namespaces\nverbs:\n- get\n- apiGroups:\n- \"\"\nresources:\n- configmaps\nresourceNames:\n- \"ingress-controller-leader-nginx\"\nverbs:\n- get\n- update\n- apiGroups:\n- \"\"\nresources:\n- configmaps\nverbs:\n- create\n- apiGroups:\n- \"\"\nresources:\n- endpoints\nverbs:\n- get\n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: RoleBinding\nmetadata:\nname: nginx-ingress-role-nisa-binding\nnamespace: ingress-nginx\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\nroleRef:\napiGroup: rbac.authorization.k8s.io\nkind: Role\nname: nginx-ingress-role\nsubjects:\n- kind: ServiceAccount\nname: nginx-ingress-serviceaccount\nnamespace: ingress-nginx\n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRoleBinding\nmetadata:\nname: nginx-ingress-clusterrole-nisa-binding\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\nroleRef:\napiGroup: rbac.authorization.k8s.io\nkind: ClusterRole\nname: nginx-ingress-clusterrole\nsubjects:\n- kind: ServiceAccount\nname: nginx-ingress-serviceaccount\nnamespace: ingress-nginx\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\nname: nginx-ingress-controller\nnamespace: ingress-nginx\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\nspec:\nselector:\nmatchLabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\nupdateStrategy:\nrollingUpdate:\nmaxUnavailable: 1\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\napp.kubernetes.io/name: ingress-nginx\napp.kubernetes.io/part-of: ingress-nginx\nannotations:\nprometheus.io/port: \"10254\"\nprometheus.io/scrape: \"true\"\nspec:\nserviceAccountName: nginx-ingress-serviceaccount\nhostNetwork: true\ncontainers:\n- name: nginx-ingress-controller\nimage: quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.22.0\nargs:\n- /nginx-ingress-controller\n- --configmap=$(POD_NAMESPACE)/nginx-configuration\n- --tcp-services-configmap=$(POD_NAMESPACE)/tcp-services\n- --udp-services-configmap=$(POD_NAMESPACE)/udp-services\n- --publish-service=$(POD_NAMESPACE)/ingress-nginx\n- --annotations-prefix=nginx.ingress.kubernetes.io\nsecurityContext:\nallowPrivilegeEscalation: true\ncapabilities:\ndrop:\n- ALL\nadd:\n- NET_BIND_SERVICE\nrunAsUser: 33\nenv:\n- name: POD_NAME\nvalueFrom:\nfieldRef:\nfieldPath: metadata.name\n- name: POD_NAMESPACE\nvalueFrom:\nfieldRef:\nfieldPath: metadata.namespace\nports:\n- name: http\ncontainerPort: 80\n- name: https\ncontainerPort: 443\nlivenessProbe:\nfailureThreshold: 3\nhttpGet:\npath: /healthz\nport: 10254\nscheme: HTTP\ninitialDelaySeconds: 10\nperiodSeconds: 10\nsuccessThreshold: 1\ntimeoutSeconds: 1\nreadinessProbe:\nfailureThreshold: 3\nhttpGet:\npath: /healthz\nport: 10254\nscheme: HTTP\nperiodSeconds: 10\nsuccessThreshold: 1\ntimeoutSeconds: 1\n---\n</code></pre> <p><pre><code>$ pwd\n$ kubectl create -f nginx-ds.yaml\nnamespace/ingress-nginx created\nconfigmap/nginx-configuration created\nconfigmap/tcp-services created\nconfigmap/udp-services created\nserviceaccount/nginx-ingress-serviceaccount created\nclusterrole.rbac.authorization.k8s.io/nginx-ingress-clusterrole\ncreated\nrole.rbac.authorization.k8s.io/nginx-ingress-role created\nrolebinding.rbac.authorization.k8s.io/nginx-ingress-role-nisa-\nbinding created\nclusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-\nclusterrole-nisa-bindi\nng created\ndaemonset.extensions/nginx-ingress-controller created\n</code></pre> \u6b64\u65f6\u4f1a\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u521b\u5efa\u4e00\u4e2aPod\uff1a <pre><code>$ kubectl get pod -n ingress-nginx\nNAME                                           READY   STATUS    RESTARTS   AGE\ningress-nginx-controller-267hs                 1/1     Running   3          60d\ningress-nginx-controller-zlwmm                 1/1     Running   2          60d\n.......\ningress-nginx-defaultbackend-b578d6c5b-svwsw   1/1     Running   19         177d\n\n# \u4f7f\u7528-o wide\u67e5\u770bpod\u6240\u5728\u8282\u70b9\n$ kubectl get pod -n ingress-nginx -o wide\nNAME                                           READY   STATUS    RESTARTS   AGE    IP             NODE           NOMINATED NODE   READINESS GATES\ningress-nginx-controller-267hs                 1/1     Running   3          60d    192.168.1.79   gitee-k8s-n2   &lt;none&gt;           &lt;none&gt;\ningress-nginx-controller-zlwmm                 1/1     Running   2          60d    192.168.1.32   gitee-k8s-n1   &lt;none&gt;           &lt;none&gt;\n.......\ningress-nginx-defaultbackend-b578d6c5b-svwsw   1/1     Running   19         177d   10.0.35.131    gitee-k8s-n2   &lt;none&gt;           &lt;none&gt;\n</code></pre></p> <p>\u6ce8\u610f</p> <p>\u6ce8\u610f \u56e0\u4e3a\u7b14\u8005\u7684Master\u8282\u70b9\u5220\u9664\u4e86Taint\uff08Taint\u548cToleration\u5185\u5bb9\u89c1\u672c\u4e669.4 \u8282\uff09\uff0c\u6240\u4ee5\u4e5f\u80fd\u90e8\u7f72Ingress\u6216\u8005\u5176\u4ed6Pod\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5728Master\u8282\u70b9\u9664\u4e86\u7cfb\u7edf\u7ec4\u4ef6\u5916\u6700\u597d\u4e0d\u8981\u90e8\u7f72\u5176\u4ed6Pod\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#44-\u66f4\u65b0\u548c\u56de\u6edadaemonset","title":"4.4 \u66f4\u65b0\u548c\u56de\u6edaDaemonSet","text":"<p>\u5982\u679c\u6dfb\u52a0\u4e86\u65b0\u8282\u70b9\u6216\u4fee\u6539\u4e86\u8282\u70b9\u6807\u7b7e\uff08Label\uff09\uff0cDaemonSet\u5c06\u7acb\u523b\u5411\u65b0\u5339\u914d\u4e0a\u7684\u8282\u70b9\u6dfb\u52a0Pod\uff0c\u540c\u65f6\u5220\u9664\u4e0d\u80fd\u5339\u914d\u7684\u8282\u70b9\u4e0a\u7684Pod\u3002</p> <p>\u5728Kubernetes 1.6\u4ee5\u540e\u7684\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u5728DaemonSet\u4e0a\u6267\u884c\u6eda\u52a8\u66f4\u65b0\uff0c\u672a\u6765\u7684Kubernetes\u7248\u672c\u5c06\u652f\u6301\u8282\u70b9\u7684\u53ef\u63a7\u66f4\u65b0\u3002</p> <p>DaemonSet\u6eda\u52a8\u66f4\u65b0\u53ef\u53c2\u8003\uff1ahttps://kubernetes.io/docs/tasks/manage-daemon/update-daemon-set/\u3002</p> <p>DaemonSet\u66f4\u65b0\u7b56\u7565\u548cStatefulSet\u7c7b\u4f3c\uff0c\u4e5f\u6709OnDelete\u548cRollingUpdate\u4e24\u79cd\u65b9\u5f0f\u3002</p> <p>\u67e5\u770b\u4e0a\u4e00\u8282\u521b\u5efa\u7684DaemonSet\u66f4\u65b0\u65b9\u5f0f\uff1a <pre><code>$ kubectl get ds nginx-ds -o go-template='{{.spec.updateStrategy.type}}{{\"\\n\"}}'\nRollingUpdate\n</code></pre></p> <p>\u547d\u4ee4\u5f0f\u66f4\u65b0\uff0c\u548c\u4e4b\u524d\u7684Deployment\u3001StatefulSet\u65b9\u5f0f\u4e00\u81f4\uff1a <pre><code>$ kubectl edit ds/&lt;daemonset-name&gt;\n$ kubectl patch ds/&lt;daemonset-name&gt; -p=&lt;strategic-merge-patch&gt;\n</code></pre></p> <p>\u66f4\u65b0\u955c\u50cf\uff1a <pre><code>$ kubectl set image ds/&lt;daemonset-name&gt;&lt;container-name&gt;=&lt;container-new-image&gt; --record=true\n</code></pre></p> <p>\u67e5\u770b\u66f4\u65b0\u72b6\u6001 <pre><code>$ kubectl rollout status ds/&lt;daemonset-name&gt;\n</code></pre></p> <p>\u5217\u51fa\u6240\u6709\u4fee\u8ba2\u7248\u672c\uff1a <pre><code>$ kubectl rollout history daemonset &lt;daemonset-name&gt;\n</code></pre></p> <p>\u56de\u6eda\u5230\u6307\u5b9arevision\uff1a <pre><code>$ kubectl rollout undo daemonset &lt;daemonset-name&gt; --to-revision=&lt;revision&gt;\n</code></pre></p> <p>DaemonSet\u7684\u66f4\u65b0\u548c\u56de\u6eda\u4e0eDeployment\u7c7b\u4f3c\uff0c\u6b64\u5904\u4e0d\u518d\u6f14\u793a\u3002</p> \u53c2\u8003\u6587\u732e <p>https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/daemonset/</p> <p>https://kubernetes.io/docs/tasks/manage-daemon/update-daemon-set/</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#5cronjob","title":"5.CronJob","text":"<p>CronJob\uff08\u8ba1\u5212\u4efb\u52a1\uff0c\u7f29\u5199\u4e3acj\uff09\u7528\u4e8e\u4ee5\u65f6\u95f4\u4e3a\u57fa\u51c6\u5468\u671f\u6027\u5730\u6267\u884c\u4efb\u52a1\uff0c\u8fd9\u4e9b\u81ea\u52a8\u5316\u4efb\u52a1\u548c\u8fd0\u884c\u5728Linux\u6216UNIX\u7cfb\u7edf\u4e0a\u7684CronJob\u4e00\u6837\u3002</p> <p>CronJob\u5bf9\u4e8e\u521b\u5efa\u5b9a\u671f\u548c\u91cd\u590d\u4efb\u52a1\u975e\u5e38\u6709\u7528\uff0c\u4f8b\u5982\u6267\u884c\u5907\u4efd\u4efb\u52a1\u3001\u5468\u671f\u6027\u8c03\u5ea6\u7a0b\u5e8f\u63a5\u53e3\u3001\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7b49\u3002</p> <p>\u5bf9\u4e8eKubernetes 1.8\u4ee5\u524d\u7684\u7248\u672c\uff0c\u9700\u8981\u6dfb\u52a0--runtime-config=batch/v2alpha1=true\u53c2\u6570\u81f3APIServer\u4e2d\uff0c\u7136\u540e\u91cd\u542fAPIServer\u548cController Manager\u624d\u53ef\u542f\u7528CronJob\u529f\u80fd\uff0c</p> <p>\u5bf9\u4e8e1.8\u4ee5\u540e\u7684\u7248\u672c\uff0c\u65e0\u987b\u4fee\u6539\u4efb\u4f55\u53c2\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u672c\u8282\u7684\u793a\u4f8b\u57fa\u4e8eKubernetes 1.8\u4ee5\u4e0a\u7684\u7248\u672c\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#51-\u521b\u5efacronjob","title":"5.1 \u521b\u5efaCronJob","text":"<p>\u521b\u5efaCronJob\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u76f4\u63a5\u4f7f\u7528kubectl\u521b\u5efa\uff0c\u53e6\u4e00\u79cd\u662f\u4f7f\u7528YAML\u6587\u4ef6\u521b\u5efa\u3002</p> <p>\u4f7f\u7528kubectl\u521b\u5efaCronJob\u7684\u547d\u4ee4\u5982\u4e0b(\u65b0\u7248\u672c\u7684run\u547d\u4ee4\u65e0\u6cd5\u521b\u5efaCronJob\uff0c\u9700\u8981\u76f4\u63a5\u4f7f\u7528YAML\u6587\u4ef6\u521b\u5efa)\uff1a</p> <pre><code>$ kubectl create cronjob hello --image=busybox   --schedule=\"*/1 * * * *\" --restart=OnFailure -- /bin/sh -c \"date; echo Hello from the Kubernetes cluster\"\ncronjob.batch/hello created\n</code></pre> <ul> <li>hello\uff1a\u8ba1\u5212\u4efb\u52a1\u7684\u540d\u79f0\u3002</li> <li>schedule\uff1a\u8c03\u5ea6\u5468\u671f\uff0c\u5206\u522b\u4e3a\u5206\u3001\u65f6\u3001\u65e5\u3001\u6708\u3001\u5468\uff0c\u548cLinux\u914d\u7f6e\u65b9\u5f0f\u4e00\u81f4\u3002</li> <li>restart\uff1a\u91cd\u542f\u7b56\u7565\u3002\u00b7\u3000image\uff1a\u6267\u884c\u8ba1\u5212\u4efb\u52a1\u7684\u955c\u50cf\uff0c\u4e00\u822c\u662f\u5305\u542b\u4f9d\u8d56\u5de5\u5177\u7684\u955c\u50cf\uff0c\u6bd4\u5982curl\u3001Xtrabackup\u3002</li> <li>/bin/sh\uff1a\u8ba1\u5212\u4efb\u52a1\u7684\u64cd\u4f5c\u3002</li> </ul> <p>\u521b\u5efa\u5b8c\u6210\u4e4b\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528kubectl get cj hello -o yaml\u67e5\u770b\u521b\u5efa\u7684CronJob\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5bf9\u5e94\u7684YAML\u6587\u4ef6\u5982\u4e0b\uff1a</p> <pre><code>$ kubectl get cj hello -o yaml\napiVersion: batch/v1\nkind: CronJob\nmetadata:\nname: hello\nnamespace: default\nspec:\nconcurrencyPolicy: Allow\nfailedJobsHistoryLimit: 1\njobTemplate:\nmetadata:\ncreationTimestamp: null\nname: hello\nspec:\ntemplate:\nmetadata:\ncreationTimestamp: null\nspec:\ncontainers:\n- command:\n- /bin/sh\n- -c\n- date; echo Hello from the Kubernetes cluster\nimage: busybox\nimagePullPolicy: Always\nname: hello\nresources: {}\nterminationMessagePath: /dev/termination-log\nterminationMessagePolicy: File\ndnsPolicy: ClusterFirst\nrestartPolicy: OnFailure\nschedulerName: default-scheduler\nsecurityContext: {}\nterminationGracePeriodSeconds: 30\nschedule: '*/1 * * * *'\nsuccessfulJobsHistoryLimit: 3\nsuspend: false\nstatus: {}\n</code></pre> <p>\u8bf4\u660e</p> <p>\u672c\u4f8b\u521b\u5efa\u4e00\u4e2a\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21\u3001\u6253\u5370\u5f53\u524d\u65f6\u95f4\u548cHello from the Kubernetes cluster\u7684\u8ba1\u5212\u4efb\u52a1\u3002</p> <p>\u67e5\u770b\u521b\u5efa\u7684CronJob\uff1a</p> <pre><code>$ kubectl get cj\nNAME    SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE\nhello   */1 * * * *   False     0        74s             106s\n</code></pre> <p>\u8ba1\u5212\u4efb\u52a1\u5728\u6267\u884c\u65f6\u4f1a\u542f\u52a8\u4e00\u4e2a\u540d\u5b57\u4e3aCRONJOB_NAME-xxxxx\u7684Job\u53bb\u8c03\u5ea6\u4efb\u52a1\uff0c\u7b49\u5f851\u5206\u949f\u53ef\u4ee5\u67e5\u770b\u6267\u884c\u7684\u4efb\u52a1\uff08Jobs\uff09\uff1a</p> <pre><code>$ kubectl get jobs\nNAME             COMPLETIONS   DURATION   AGE\nhello-27720215   1/1           2s         98s\n</code></pre> <p>CronJob\u6bcf\u6b21\u8c03\u7528\u4efb\u52a1\u7684\u65f6\u5019\u4f1a\u521b\u5efa\u4e00\u4e2aJob\uff0cJob\u4f1a\u521b\u5efa\u4e00\u4e2a\u540d\u4e3aJOB_NAME-xxx\u7684Pod\u6267\u884c\u547d\u4ee4\uff0c\u6210\u529f\u6267\u884c\u5b8c\u4efb\u52a1\u540e\uff0cPod\u72b6\u6001\u5c31\u4f1a\u53d8\u6210Completed\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ kubectl get pod\nNAME                   READY   STATUS      RESTARTS   AGE\nhello-27720215-zsk5n   0/1     Completed   0          2m22s\nhello-27720216-frh4w   0/1     Completed   0          82s\nk9s-shell-15624        1/1     Running     0          56d\n</code></pre> <p>\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7logs\u67e5\u770bPod\u7684\u6267\u884c\u65e5\u5fd7\uff1a</p> <pre><code>$ kubectl logs pod/hello-27720215-zsk5n\nThu Sep 15 03:36:13 UTC 2022\nHello from the Kubernetes cluster\n</code></pre> <p>\u5982\u679c\u8981\u5220\u9664CronJob\uff0c\u76f4\u63a5\u4f7f\u7528delete\u5373\u53ef\uff1a</p> <pre><code>$ kubectl delete cronjob hello\ncronjob.batch \"hello\" deleted\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#52-\u53ef\u7528\u53c2\u6570\u7684\u914d\u7f6e","title":"5.2 \u53ef\u7528\u53c2\u6570\u7684\u914d\u7f6e","text":"<p>\u5b9a\u4e49\u4e00\u4e2aCronJob\u7684YAML\u6587\u4ef6\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: batch/v1 # K8s\u5c0f\u4e8e1.21 batch/v1beta1\nkind: CronJob\nmetadata:\nlabels:\nrun: hello\nname: hello\nnamespace: default\nspec:\nconcurrencyPolicy: Allow\nfailedJobsHistoryLimit: 1\njobTemplate:\nmetadata:\ncreationTimestamp: null\nspec:\ntemplate:\nmetadata:\ncreationTimestamp: null\nlabels:\nrun: hello\nspec:\ncontainers:\n- args:\n- /bin/sh\n- -c\n- date; echo Hello from the Kubernetes cluster\nimage: busybox\nimagePullPolicy: Always\nname: hello\nresources: {}\nterminationMessagePath: /dev/termination-log\nterminationMessagePolicy: File\ndnsPolicy: ClusterFirst\nrestartPolicy: OnFailure\nschedulerName: default-scheduler\nsecurityContext: {}\nterminationGracePeriodSeconds: 30\nschedule: '*/1 * * * *'\nsuccessfulJobsHistoryLimit: 3\nsuspend: false\n</code></pre> <p>\u5176\u4e2d\u5404\u53c2\u6570\u7684\u8bf4\u660e\u5982\u4e0b\uff0c\u53ef\u4ee5\u6309\u9700\u4fee\u6539\uff1a</p> <ul> <li>schedule\uff1a\u8c03\u5ea6\u5468\u671f\uff0c\u548cLinux\u4e00\u81f4\uff0c\u5206\u522b\u662f\u5206\u3001\u65f6\u3001\u65e5\u3001\u6708\u3001\u5468\u3002</li> <li>restartPolicy\uff1a\u91cd\u542f\u7b56\u7565\uff0c\u548cPod\u4e00\u81f4\u3002</li> <li>concurrencyPolicy\uff1a\u5e76\u53d1\u8c03\u5ea6\u7b56\u7565\u3002\u53ef\u9009\u53c2\u6570\u5982\u4e0b\uff1a</li> <li>Allow\uff1a\u5141\u8bb8\u540c\u65f6\u8fd0\u884c\u591a\u4e2a\u4efb\u52a1\u3002</li> <li>Forbid\uff1a\u4e0d\u5141\u8bb8\u5e76\u53d1\u8fd0\u884c\uff0c\u5982\u679c\u4e4b\u524d\u7684\u4efb\u52a1\u5c1a\u672a\u5b8c\u6210\uff0c\u65b0\u7684\u4efb\u52a1\u4e0d\u4f1a\u88ab\u521b\u5efa\u3002</li> <li> <p>Replace\uff1a\u5982\u679c\u4e4b\u524d\u7684\u4efb\u52a1\u5c1a\u672a\u5b8c\u6210\uff0c\u65b0\u7684\u4efb\u52a1\u4f1a\u66ff\u6362\u4e4b\u524d\u7684\u4efb\u52a1\u3002</p> </li> <li> <p>suspend\uff1a\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u5219\u6682\u505c\u540e\u7eed\u7684\u4efb\u52a1\uff0c\u9ed8\u8ba4\u4e3afalse\u3002</p> </li> <li>successfulJobsHistoryLimit\uff1a\u4fdd\u7559\u591a\u5c11\u5df2\u5b8c\u6210\u7684\u4efb\u52a1\uff0c\u6309\u9700\u914d\u7f6e\u3002</li> <li>failedJobsHistoryLimit\uff1a\u4fdd\u7559\u591a\u5c11\u5931\u8d25\u7684\u4efb\u52a1\u3002</li> </ul> <p>\u76f8\u5bf9\u4e8eLinux\u4e0a\u7684\u8ba1\u5212\u4efb\u52a1\uff0cKubernetes\u7684CronJob\u66f4\u5177\u6709\u53ef\u914d\u7f6e\u6027\uff0c\u5e76\u4e14\u5bf9\u4e8e\u6267\u884c\u8ba1\u5212\u4efb\u52a1\u7684\u73af\u5883\u53ea\u9700\u542f\u52a8\u76f8\u5bf9\u5e94\u7684\u955c\u50cf\u5373\u53ef\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u9700\u8981Go\u6216\u8005PHP\u73af\u5883\u6267\u884c\u4efb\u52a1\uff0c\u5c31\u53ea\u9700\u8981\u66f4\u6539\u4efb\u52a1\u7684\u955c\u50cf\u4e3aGo\u6216\u8005PHP\u5373\u53ef\uff0c\u800c\u5bf9\u4e8eLinux\u4e0a\u7684\u8ba1\u5212\u4efb\u52a1\uff0c\u5219\u9700\u8981\u5b89\u88c5\u76f8\u5bf9\u5e94\u7684\u6267\u884c\u73af\u5883\u3002\u6b64\u5916\uff0cKubernetes\u7684CronJob\u662f\u521b\u5efaPod\u6765\u6267\u884c\u7684\uff0c\u66f4\u52a0\u6e05\u6670\u660e\u4e86\uff0c\u67e5\u770b\u65e5\u5fd7\u4e5f\u6bd4\u8f83\u65b9\u4fbf\u3002\u53ef\u89c1\uff0cKubernetes\u7684CronJob\u66f4\u52a0\u65b9\u4fbf\u548c\u7b80\u5355\u3002</p> <p>\u66f4\u591aCronJob\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003Kubernetes\u7684\u5b98\u65b9\u6587\u6863</p> <p>https://kubernetes.io/docs/home/</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Kubernetes%E8%B0%83%E5%BA%A6%E5%9F%BA%E7%A1%80/#6\u5c0f\u7ed3","title":"6.\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u5b66\u4e60\u4e86Kubernetes\u5f00\u7bb1\u5373\u7528\u7684\u8c03\u5ea6\u8d44\u6e90\uff0cDeployment\u662f\u5b9e\u9645\u4f7f\u7528\u65f6\u7528\u5f97\u6700\u591a\u7684\u4e00\u79cd\u7c7b\u578b\u3002</p> <p>Kubernetes\u539f\u751f\u7684\u8d44\u6e90\u8c03\u5ea6\u57fa\u672c\u4e0a\u53ef\u4ee5\u6ee1\u8db3\u5927\u90e8\u5206\u7684\u9700\u6c42\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u53ef\u80fd\u8fd8\u4f1a\u6709\u4e00\u4e9b\u5b9a\u5236\u5316\u7684\u9700\u6c42\uff0c\u6bd4\u5982\u8ba1\u5212\u4efb\u52a1\u9700\u8981\u5728\u6bcf\u53f0\u670d\u52a1\u5668\u90fd\u8981\u6267\u884c\u7b49\u3002</p> <p>\u6b64\u7c7b\u9700\u6c42\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5f00\u53d1\u5b9a\u5236\u5316\u7684\u8d44\u6e90\u8c03\u5ea6\uff0c\u7c7b\u4f3c\u7684\u6709\u963f\u91cc\u4e91\u5f00\u6e90\u7684OpenKruise\u7b49\uff0c\u6709\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u5173\u6ce8\u4e00\u4e0b\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/","title":"Kubernetes\u670d\u52a1\u53d1\u5e03\u57fa\u7840","text":"<p>\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u7528\u6237\u8bbf\u95ee\u516c\u53f8\u5185\u7684\u670d\u52a1\u53ef\u80fd\u901a\u8fc7\u4e86\u591a\u5c42\u4ee3\u7406\u3001\u7f51\u5173\u3001\u9632\u706b\u5899\u7b49\u3002\u5728Kubernetes\u4e2d\uff0c\u8bbf\u95eeKubernetes\u4e2d\u7684\u5e94\u7528\u540c\u6837\u4e5f\u4f1a\u7ecf\u8fc7\u591a\u5c42\u4ee3\u7406\u3001\u7f51\u5173\u3001\u9632\u706b\u5899\u7b49\u3002</p> <p>\u4f46\u662f\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u53ef\u80fd\u662f\u901a\u8fc7Nginx\u3001HAProxy\u3001LVS\u3001\u516c\u6709\u4e91\u7684SLB\u3001ELB\u7b49\u5b9e\u73b0\u7684\u8d1f\u8f7d\u5747\u8861\u548c\u57df\u540d\u8def\u7531\uff0c\u867d\u7136Kubernetes\u4e5f\u662f\u901a\u8fc7\u8bf8\u5982\u6b64\u7c7b\u7684\u6280\u672f\u5b9e\u73b0\u7684\u57df\u540d\u8def\u7531\u6216\u8005\u8d1f\u8f7d\u5747\u8861\uff0c\u53ea\u4e0d\u8fc7\u5bf9\u5e94\u7684\u540d\u5b57\u53eb\u6cd5\u53ef\u80fd\u6709\u6240\u53d8\u5316\uff0c\u8bfb\u8005\u4e0d\u8981\u628a\u8fd9\u4e9b\u5f53\u4f5c\u4e00\u4e2a\u6bd4\u8f83\u65b0\u9896\u7684\u4e1c\u897f\uff0c\u5176\u5b9e\u5185\u90e8\u7684\u5b9e\u73b0\u548c\u4e4b\u524d\u5e76\u65e0\u533a\u522b\u3002</p> <p>\u5728\u4f20\u7edf\u67b6\u6784\u914d\u7f6e\u591a\u4e2a\u76f8\u540c\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u53ef\u80fd\u4f7f\u7528\u7684\u662fNginx\u7684upstream\uff0c\u5728Kubernetes\u4e2d\u7528Service\u5b9e\u73b0\u3002</p> <p>\u5728\u4f20\u7edf\u67b6\u6784\u914d\u7f6e\u57df\u540d\u8bbf\u95ee\u5e94\u7528\u53ef\u80fd\u4f7f\u7528Nginx\u7684Server\u914d\u7f6e\uff0c\u5728Kubernetes\u4e2d\u7528Ingress\u5b9e\u73b0\u57df\u540d\u8def\u7531\u7684\u914d\u7f6e\uff08\u6700\u7ec8\u901a\u8fc7Ingress\u7684\u914d\u7f6e\u751f\u6210\u5bf9\u5e94\u63a7\u5236\u5668\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u4f7f\u7528Nginx\u4f5c\u4e3aIngress\u63a7\u5236\u5668\uff0cIngress\u8d44\u6e90\u6700\u7ec8\u751f\u6210\u7684\u5c31\u662fNginx\u7684\u914d\u7f6e\u6587\u4ef6\uff09\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#1\u6807\u7b7e\u548c\u9009\u62e9\u5668","title":"1.\u6807\u7b7e\u548c\u9009\u62e9\u5668","text":"<p>\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5404\u7c7b\u8d44\u6e90\u8fdb\u884c\u5206\u7ec4\u7ba1\u7406\uff0c\u6216\u8005\u540c\u4e00\u4e2a\u5e94\u7528\u7684Pod\u53ef\u80fd\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u529f\u80fd\u8fdb\u884c\u5212\u5206\uff0c\u6bd4\u5982\u6709\u4e00\u4e2a\u540e\u7aef\u7684\u5e94\u7528\uff0c \u9700\u8981\u63d0\u4f9bAPI\u63a5\u53e3\u4f9b\u524d\u7aef\u8c03\u7528\uff0c\u4e5f\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u5468\u671f\u6027\u7684\u8ba1\u5212\u4efb\u52a1\uff0c\u76f8\u5f53\u4e8e\u540c\u4e00\u4e2a\u955c\u50cf\u5206\u4e24\u4e2a\u8eab\u4efd\u8fd0\u884c\uff0c\u6240\u4ee5\u5c31\u9700\u8981\u5bf9\u8fd9\u4e24\u4e2a\u8d44\u6e90\u6587\u4ef6\u7528\u6807\u7b7e\u8fdb\u884c\u533a\u5206\uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u8ba9\u6d41\u91cf\u8fdb\u5165\u63d0\u4f9bAPI\u63a5\u53e3\u7684Pod\uff0c\u6267\u884c\u8ba1\u5212\u4efb\u52a1\u7684Pod\u4e0d\u63a5\u6536\u4efb\u4f55\u6d41\u91cf\uff0c</p> <p>\u5982\u56fe6.1\u6240\u793a\u3002</p> <p></p> <p>\u56fe6.1 \u540c\u4e00\u4e2a\u5e94\u7528\u4e0d\u540c\u7684\u8fd0\u884c\u65b9\u5f0f</p> <p>\u6b64\u65f6\u5176\u4ed6\u5e94\u7528\u8c03\u7528\u8be5\u5e94\u7528\u7684Service\uff08Service\u4e3a\u5bb9\u5668\u670d\u52a1\u7684\u5165\u53e3\uff0c\u53ef\u4ee5\u901a\u8fc7Service\u8bbf\u95ee\u7b26\u5408\u9009\u62e9\u5668\uff08Selector\uff09\u8fc7\u6ee4\u7684\u5bb9\u5668\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u7f29\u5199\u4e3asvc\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u672c\u4e666.2\u8282\uff09\u65f6\uff0c \u6d41\u91cf\u53ea\u80fd\u5230\u8fbeapi\u7684Pod\uff0c\u4e0d\u4f1a\u5230\u8fbecron\u7684Pod\uff0c\u56e0\u4e3a\u9009\u62e9\u5668\u8fdb\u884c\u5339\u914d\u65f6\u662f\u201c\u4e0e\u201d\u7684\u5173\u7cfb\uff0c\u9700\u8981\u6240\u6709\u7684\u6807\u7b7e\uff08Label\uff09\u90fd\u8981\u5339\u914d\uff0c\u6240\u4ee5role=cronjob\u7684Pod\u4e0d\u4f1a\u88ab\u63a5\u5165\u6d41\u91cf\u3002</p> <p>\u4f7f\u7528\u6807\u7b7e\u540c\u6837\u53ef\u4ee5\u5bf9Kubernetes\u7684\u5176\u4ed6\u8d44\u6e90\u8fdb\u884c\u914d\u7f6e\uff0c\u5f53Kubernetes\u5bf9\u7cfb\u7edf\u7684\u4efb\u4f55API\u5bf9\u8c61\uff08\u5982Pod\u548c\u8282\u70b9\uff09\u8fdb\u884c\u201c\u5206\u7ec4\u201d\u65f6\uff0c\u4f1a\u5bf9\u5176\u6dfb\u52a0\u6807\u7b7e \uff08key=value\u5f62\u5f0f\u7684\u201c\u952e-\u503c\u5bf9\u201d\uff09\uff0c\u7528\u4ee5\u7cbe\u51c6\u5730\u9009\u62e9\u5bf9\u5e94\u7684API\u5bf9\u8c61\u3002</p> <p>\u800c\u9009\u62e9 \u5668\u5219\u662f\u9488\u5bf9\u5339\u914d\u5bf9\u8c61\u7684\u67e5\u8be2\u65b9\u6cd5\u3002</p> <p>\u5e38\u7528\u7684\u6807\u7b7etier\u53ef\u7528\u4e8e\u533a\u5206\u5bb9\u5668\u7684\u5c5e\u6027\uff0c\u5982frontend\u3001backend\uff1b\u6216\u8005\u4e00\u4e2arelease_track\u7528\u4e8e\u533a\u5206\u5bb9\u5668\u7684\u73af\u5883\uff0c\u5982canary\u3001production\u7b49\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#11-\u5b9a\u4e49\u6807\u7b7e","title":"1.1 \u5b9a\u4e49\u6807\u7b7e","text":"<p>\u5e94\u7528\u6848\u4f8b\uff1a\u516c\u53f8\u4e0exx\u94f6\u884c\u6709\u4e00\u6761\u4e13\u5c5e\u7684\u9ad8\u901f\u5149\u7ea4\u901a\u9053\uff0c\u6b64\u901a\u9053\u53ea\u80fd\u4e0e192.168.7.0\u7f51\u6bb5\u8fdb\u884c\u901a\u4fe1\uff0c\u56e0\u6b64\u53ea\u80fd\u5c06\u4e0exx\u94f6\u884c\u901a\u4fe1\u7684\u5e94\u7528\u90e8\u7f72\u5230192.168.7.0\u7f51\u6bb5\u6240\u5728\u7684\u8282\u70b9\u4e0a\uff0c\u6b64\u65f6\u53ef\u4ee5\u5bf9\u8282\u70b9\u6dfb\u52a0\u6807\u7b7e\uff1a</p> <pre><code>$ kubectl label node k8s-node02 region=subnet7\nnode/k8s-node02 labeled\n</code></pre> <p>\u7136\u540e\u53ef\u4ee5\u901a\u8fc7\u9009\u62e9\u5668\u5bf9\u5176\u7b5b\u9009\uff1a</p> <pre><code>$ kubectl get node -l region=subnet7\nNAME             STATUS   ROLES     AGE    VERSION\nk8s-node02   Ready    ingress   321d   v1.21.3\n</code></pre> <p>\u5220\u9664\u6807\u7b7e</p> <pre><code>$ kubectl label node giteego-k8s-n2 region-\nnode/giteego-k8s-n2 labeled\n\n$ kubectl get no -l region=subnet7\nNo resources found\n</code></pre> <p>\u6700\u540e\u5728Deployment\u6216\u5176\u4ed6\u63a7\u5236\u5668\u4e2d\u6307\u5b9a\u5c06Pod\u90e8\u7f72\u5230\u8be5\u8282\u70b9\uff1a</p> <pre><code> # \u53ef\u9009\uff0c\u6307\u5b9aNode\u8282\u70b9\nnodeSelector:\nregion: subnet7\nrestartPolicy: Always\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u7528\u540c\u6837\u7684\u65b9\u5f0f\u5bf9Service\u6dfb\u52a0\u6807\u7b7e\uff1a</p> <pre><code>$ kubectl label svc canary-v1 -n canary-production env=canary version=v1\nservice/canary-v1 labeled\n</code></pre> <p>\u67e5\u770b\u8be5Service\u7684\u6807\u7b7e\uff1a</p> <pre><code>$ kubectl get svc -n canary-production --show-labels\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u67e5\u770b\u6240\u6709version\u4e3av1\u7684Service\uff1a</p> <pre><code>$ kubectl get svc --all-namespaces -l version=v1\n</code></pre> <p>\u4e0a\u8ff0\u6f14\u793a\u4e86\u5bf9\u8282\u70b9\u3001Service\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6807\u7b7e\u7684\u65b9\u6cd5\uff0c\u5bf9\u5176\u4ed6\u8d44\u6e90\u6dfb\u52a0\u6807\u7b7e\u7684\u65b9\u5f0f\u76f8\u540c\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#12-\u9009\u62e9\u5668","title":"1.2 \u9009\u62e9\u5668","text":"<p>\u9009\u62e9\u5668\u4e3b\u8981\u7528\u4e8e\u8d44\u6e90\u7684\u5339\u914d\uff0c\u53ea\u6709\u7b26\u5408\u6761\u4ef6\u7684\u8d44\u6e90\u624d\u4f1a\u88ab\u8c03\u7528\u6216\u4f7f\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u65b9\u5f0f\u5bf9\u96c6\u7fa4\u4e2d\u7684\u5404\u7c7b\u8d44\u6e90\u8fdb\u884c\u5206\u914d\u3002</p> <p>\u7531\u4e8eKubernetes\u7684\u6838\u5fc3\u8d44\u6e90Deployment\u3001StatefulSet\u7ba1\u7406\u54ea\u4e9bPod\u662f\u901a\u8fc7\u9009\u62e9\u5668\u5b57\u6bb5\u51b3\u5b9a\u7684\uff0c\u901a\u8fc7Service\u8bbf\u95ee\u54ea\u4e9b\u540e\u7aefPod\u4e5f\u662f\u901a\u8fc7\u9009\u62e9\u5668\u5b57\u6bb5\u51b3\u5b9a\u7684\uff0c \u56e0\u6b64\u672c\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u9009\u62e9\u5668\u8fc7\u6ee4\u51fa\u81ea\u5df1\u60f3\u8981\u7684\u8d44\u6e90\u3002</p> <p>\u9996\u5148\u4f7f\u7528--show-labels\u67e5\u770b\u76ee\u524d\u5df2\u6709\u7684\u6807\u7b7e\uff1a</p> <pre><code>$ kubectl get service --show-labels\nNAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE    LABELS\nkubernetes                    ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP   321d   component=apiserver,provider=kubernetes\nnginx-deployment-helm-nginx   ClusterIP   10.103.233.67   &lt;none&gt;        80/TCP    16d    app.kubernetes.io/instance=nginx-deployment,app.kubernetes.io/managed-by=Helm,app.kubernetes.io/name=helm-nginx,app.kubernetes.io/version=1.16.0,helm.sh/chart=helm-nginx-0.1.0\n</code></pre> <p>\u9009\u62e9\u5339\u914dprovider\u4e3adetails\u6216\u8005kubernetes\u7684Service\uff1a</p> <pre><code>$ kubectl get svc -l \"provider in (details,kubernetes)\" --show-labels\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE    LABELS\nkubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   321d   component=apiserver,provider=kubernetes\n</code></pre> <p>\u9009\u62e9provider\u4e3adetails\u6216kubernetes\u4f46\u4e0d\u5305\u62ecversion=v1\u7684Service\uff1a</p> <pre><code>$ kubectl get svc -l version!=v1,\"provider in (details,kubernetes)\" --show-labels\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE    LABELS\nkubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   321d   component=apiserver,provider=kubernetes\n</code></pre> <p>\u9009\u62e9label\u7684key\u540d\u4e3aapp\u7684Service\uff1a <pre><code>$ kubectl get svc -l app --show-labels\n</code></pre></p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#13-\u4fee\u6539\u6807\u7b7e","title":"1.3 \u4fee\u6539\u6807\u7b7e","text":"<p>\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u8d44\u6e90\u6807\u7b7e\u7684\u66f4\u6539\u662f\u7ecf\u5e38\u53d1\u751f\u7684\u4e8b\u60c5\uff0c\u53ef\u4ee5\u4f7f\u7528overwrite \u53c2\u6570\u4fee\u6539\u6807\u7b7e\u3002</p> <p>\u6bd4\u5982\u5c06version=v1\u6539\u4e3aversion=v2\uff1a <pre><code>$ kubectl get svc -n canary-production --show-labels\n\n$ kubectl label svc canary-v1 -n canary-production version=v2 --overwrite\n\n$ kubectl get svc -n canary-production --show-labels\n</code></pre></p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#14-\u5220\u9664\u6807\u7b7e","title":"1.4 \u5220\u9664\u6807\u7b7e","text":"<p>\u6709\u65f6\u5019\u4e5f\u4f1a\u9700\u8981\u5220\u9664\u67d0\u8d44\u6e90\u7684\u6807\u7b7e\uff0c\u5728label\u7684key\u540d\u540e\u9762\u52a0\u4e00\u4e2a\u51cf\u53f7\u5373\u53ef\u5220\u9664\uff0c\u6bd4\u5982\u5220\u9664key\u540d\u4e3aversion\u7684\u6807\u7b7e\uff1a</p> <pre><code>$ kubectl label svc canary-v1 -n canary-product version-\n\n$ kubectl get svc -n canary-production --show-labels\n</code></pre> <pre><code># \u8bbe\u7f6e\u6807\u7b7e\n$ kubectl label node gitee-k8s-w02 monitor=prometheus\nnode/gitee-k8s-w02 labeled\n\n# \u5e26\u6709prometheus\u6807\u8bc6\u7b26\u7684\u6807\u7b7e\n$ kubectl label nodes gitee-k8s-w02 node-role.kubernetes.io/prometheus=\"true\"\n# \u5220\u9664\u6807\u7b7e\n$ kubectl label nodes gitee-k8s-w02 monitor-\nnode/gitee-k8s-w02 labeled\n\n# \u5e26\u6709prometheus\u6807\u8bc6\u7b26\u7684\u6807\u7b7e\n$ kubectl label nodes gitee-k8s-w02 node-role.kubernetes.io/prometheus-\n\n# label\u4e3anode-role.kubernetes.io/prometheus=\"true\"\nnodeSelector: {\"node-role.kubernetes.io/prometheus\":\"true\"}\n# \u4fee\u6539\u4e00\u4e2alabel\u7684\u503c\uff0c\u9700\u8981\u52a0\u4e0a\u2013overwrite\u53c2\u6570\uff1a\n$ kubectl label nodes k8s-test01 gpu=false --overwrite\n</code></pre> <p>\u53c2\u8003\u6587\u732e<p>https://www.qikqiak.com/k8strain2/scheduler/usage/#nodeSelector</p> </p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#2service","title":"2.Service","text":"<p>\u4f7f\u7528\u865a\u62df\u673a\u6216\u8005\u88f8\u5bb9\u5668\u90e8\u7f72\u5e94\u7528\u65f6\uff0c\u7a0b\u5e8f\u4e4b\u524d\u7684\u4e92\u76f8\u8bbf\u95ee\u4e00\u822c\u90fd\u662f\u4f7f\u7528\u5bbf\u4e3b\u673a\u7684IP\u5730\u5740\u548c\u7aef\u53e3\u53f7\u8fdb\u884c\u8bbf\u95ee\u7684\uff0c\u56e0\u4e3a\u5bbf\u4e3b\u673a\u7684IP\u5730\u5740\u4e00\u822c\u4e0d\u4f1a\u8f7b\u6613\u6539\u53d8\uff0c\u6240\u4ee5IP+\u7aef\u53e3\u7684\u65b9\u5f0f\u5e76\u6ca1\u6709\u4ec0\u4e48\u5927\u7684\u95ee\u9898\u3002</p> <p>\u800c\u4f7f\u7528Kubernetes\u7684Pod\u90e8\u7f72\u5e94\u7528\u65f6\uff0cPod\u5927\u90e8\u5206\u90fd\u662f\u968f\u673a\u5730\u90e8\u7f72\u81f3\u6700\u4f73\u7684\u8282\u70b9\u4e0a\uff0c\u5e76\u4e14\u7ecf\u5e38\u88ab\u5220\u9664\u91cd\u5efa\uff0c \u6240\u4ee5Pod\u7684IP\u5730\u5740\u5e76\u4e0d\u662f\u4e00\u6210\u4e0d\u53d8\u7684\uff0c\u8fd9\u6837\u7684\u8bdd\u670d\u52a1\u4e4b\u524d\u7684\u8bbf\u95ee\u5c31\u4e0d\u80fd\u4f7f\u7528IP+\u7aef\u53e3\u7684\u65b9\u5f0f\uff0c \u6240\u4ee5Service\u5e94\u8fd0\u800c\u751f\u3002</p> <p>Service\u4e3b\u8981\u7528\u4e8ePod\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u5bf9\u4e8ePod\u7684IP\u5730\u5740\u800c\u8a00\uff0cService\u662f\u63d0\u524d\u5b9a\u4e49\u597d\u5e76\u4e14\u662f\u4e0d\u53d8\u7684\u8d44\u6e90\u7c7b\u578b\uff0c \u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6700\u4f73\u7684\u5b9e\u8df5\u65b9\u5f0f\u5c31\u662f\u6bcf\u4e2a\u5e94\u7528\u4e92\u76f8\u8c03\u7528\u65f6\u4f7f\u7528Service\u7684\u540d\u5b57\u8fdb\u884c\u8fde\u63a5\uff0c \u800c\u975eIP\u5730\u5740\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#21-service\u7684\u57fa\u672c\u6982\u5ff5","title":"2.1 Service\u7684\u57fa\u672c\u6982\u5ff5","text":"<p>Kubernetes\u7684Pod\u5177\u6709\u751f\u547d\u5468\u671f\u7684\u6982\u5ff5\uff0c\u5b83\u53ef\u4ee5\u88ab\u521b\u5efa\u3001\u5220\u9664\u3001\u9500\u6bc1\uff0c\u4e00\u65e6\u88ab\u9500\u6bc1\u5c31\u610f\u5473\u7740\u751f\u547d\u5468\u671f\u7684\u7ed3\u675f\u3002</p> <p>\u901a\u8fc7ReplicaSet\u80fd\u591f\u52a8\u6001\u5730\u521b\u5efa\u548c\u9500\u6bc1Pod\uff0c\u4f8b\u5982\u8fdb\u884c\u6269\u7f29\u5bb9\u548c\u6267\u884c\u6eda\u52a8\u5347\u7ea7\u3002 \u6bcf\u4e2aPod\u90fd\u4f1a\u83b7\u53d6\u5230\u5b83\u81ea\u5df1\u7684IP\u5730\u5740\uff0c\u4f46\u662f\u8fd9\u4e9bIP\u5730\u5740\u4e0d\u603b\u662f\u7a33\u5b9a\u548c\u53ef\u4f9d\u8d56\u7684\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u95ee\u9898\uff1a</p> <p>\u5728Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u5982\u679c\u4e00\u7ec4Pod\uff08\u6bd4\u5982\u540e\u7aef\u7684Pod\uff09\u4e3a\u5176\u4ed6Pod\uff08\u6bd4\u5982\u524d\u7aef\u7684Pod\uff09\u63d0\u4f9b\u670d\u52a1\uff0c\u90a3\u4e48\u5982\u679c\u5b83\u4eec\u4e4b\u95f4\u4f7f\u7528Pod\u7684IP\u5730\u5740\u8fdb\u884c\u901a\u4fe1\uff0c\u5728Pod\u91cd\u5efa\u540e\uff0c\u5c06\u65e0\u6cd5\u518d\u8fdb\u884c\u8fde\u63a5\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0cKubernetes\u5f15\u7528\u4e86Service\u8fd9\u6837\u4e00\u79cd\u62bd\u8c61\u6982\u5ff5\uff1a \u903b\u8f91\u4e0a\u7684\u4e00\u7ec4Pod\uff0c\u5373\u4e00\u79cd\u53ef\u4ee5\u8bbf\u95eePod\u7684\u7b56\u7565\uff0c\u901a\u5e38\u88ab\u79f0\u4e3a\u5fae\u670d\u52a1\u3002</p> <p>\u8fd9\u4e00\u7ec4Pod\u80fd\u591f\u88abService\u8bbf\u95ee\uff0c\u901a\u5e38\u662f\u901a\u8fc7Label Selector\uff08\u6807\u7b7e\u9009\u62e9\u5668\uff09\u5b9e\u73b0\u7684\uff0c\u5982\u56fe6.2\u6240\u793a\u3002</p> <p></p> <p>\u56fe6.2 Service\u4ee3\u7406\u6a21\u5f0f</p> <p>\u5047\u8bbe\u6709\u4e00\u4e2a\u7528\u4f5c\u56fe\u7247\u5904\u7406\u7684backend\uff08\u540e\u7aef\uff09\uff0c\u8fd0\u884c\u4e863\u4e2a\u526f\u672c\uff0c\u6bcf\u4e2a\u526f \u672c\u5177\u6709\u4e00\u4e2aapp=backend\u7684Label\uff0c\u8fd9\u4e9b\u526f\u672c\u662f\u53ef\u4e92\u6362\uff08\u65e0\u72b6\u6001\uff09\u7684\uff0c \u4e4b\u540e\u521b\u5efa\u4e00\u4e2aService\u6307\u5b9aSelector\u4e3aapp=backend\uff0c\u90a3\u4e48frontend\uff08\u524d\u7aef\uff09\u5373\u53ef\u901a\u8fc7\u8fd9\u4e2aService\u7684\u540d\u79f0\u76f4\u63a5\u8bbf\u95eebackend\uff0c\u6240\u4ee5frontend\u4e0d\u9700\u8981\u5173\u5fc3\u5b83\u8c03\u7528\u4e86\u54ea\u4e2abackend\u526f\u672c\u3002</p> <p>\u5373\u4f7f\u7ec4\u6210\u8fd9\u4e00\u7ec4backend\u7a0b\u5e8f\u7684Pod\u53d1\u751f\u4e86\u53d8\u5316\uff0cfrontend\u4e5f\u6ca1\u6709\u5fc5\u8981\u77e5\u9053\uff0c\u800c\u4e14\u4e5f\u4e0d\u9700\u8981\u8ddf\u8e2a\u8fd9\u4e00\u7ec4backend\u7684\u72b6\u6001\uff0c\u56e0\u4e3aService\u80fd\u591f\u89e3\u8026\u8fd9\u79cd\u5173\u8054\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#22-\u5b9a\u4e49service","title":"2.2 \u5b9a\u4e49Service","text":"<p>\u548c\u521b\u5efa\u5176\u4ed6\u7c7b\u578b\u7684\u8d44\u6e90\u4e00\u6837\uff0c\u5b9a\u4e49\u4e00\u4e2aYAML\u6587\u4ef6\uff0c\u5373\u53ef\u901a\u8fc7kubectl\u5ba2\u6237\u7aef\u521b\u5efa\u4e00\u4e2aService\u3002  \u4f8b\u5982\u6709\u4e00\u7ec4Pod\uff0c\u5b83\u4eec\u66b4\u9732\u4e869376\u7aef\u53e3\uff0c\u540c\u65f6\u5177\u6709<code>app=myapp</code>\u7684\u6807\u7b7e\uff0c\u6b64\u65f6\u53ef\u4ee5\u5b9a\u4e49Service\u7684YAML\u6587\u4ef6\u5982\u4e0b\uff1a</p> <pre><code>kind: Service\napiVersion: v1\nmetadata:\nname: my-service\nspec:\nselector:\napp: myapp\nports:\n- protocol: TCP\nport: 80\ntargetPort: 9376\n</code></pre> <p>\u4e0a\u8ff0\u6587\u4ef6\u914d\u7f6e\u521b\u5efa\u4e00\u4e2a\u540d\u4e3amy-service\u7684Service\u5bf9\u8c61\uff0c\u5b83\u4f1a\u5c06\u8bf7\u6c42\u4ee3\u7406 \u5230TCP\u7aef\u53e3\u4e3a9376\u5e76\u4e14\u5177\u6709\u6807\u7b7eapp=myapp\u7684Pod\u4e0a\u3002 \u8fd9\u4e2aService\u4f1a\u88ab\u5206\u914d\u4e00\u4e2aIP\u5730\u5740\uff0c\u901a\u5e38\u79f0\u4e3aClusterIP\uff0c\u5b83\u4f1a\u88ab\u670d\u52a1\u7684\u4ee3\u7406\u4f7f\u7528\uff0c \u5728\u96c6\u7fa4\u5185\u90e8\u53ef\u4ee5\u901a\u8fc7\u8be5ClusterIP\uff08\u4e0d\u5efa\u8bae\u4f7f\u7528ClusterIP\u8fdb\u884c\u8bbf\u95ee\uff09\u6216Service\u540d\u52a0\u4e0aport\u8fdb\u884c\u8bbf\u95ee\uff0c\u8be5\u793a\u4f8bmy-service:80\u5373\u53ef\u8bbf\u95ee\u5177\u6709app=myapp\u6807\u7b7e\u7684Pod\u76849376\u7aef\u53e3\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cService\u80fd\u591f\u5c06\u4e00\u4e2a\u63a5\u6536\u7aef\u53e3\u6620\u5c04\u5230\u4efb\u610f\u7684targetPort\uff0c \u5982\u679ctargetPort\u4e3a\u7a7a\uff0ctargetPort\u5c06\u88ab\u8bbe\u7f6e\u4e3a\u4e0ePort\u5b57\u6bb5\u76f8\u540c\u7684\u503c \u3002</p> <p>targetPort\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5f15\u7528backend Pod\u7684\u4e00\u4e2a\u7aef\u53e3\u7684\u540d\u79f0\uff0c\u8fd9\u6837\u7684\u8bdd\u5373\u4f7f\u66f4\u6539\u4e86Pod\u7684\u7aef\u53e3\uff0c\u4e5f\u4e0d\u4f1a\u5bf9Service\u7684\u8bbf\u95ee\u9020\u6210\u5f71\u54cd\u3002 Kubernetes Service\u80fd\u591f\u652f\u6301TCP\u3001UDP\u3001SCTP\u7b49\u534f\u8bae\uff0c\u9ed8\u8ba4\u4e3aTCP\u534f\u8bae\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#23-\u65e0\u9009\u62e9\u5668\u7684service\u548cendpoint","title":"2.3 \u65e0\u9009\u62e9\u5668\u7684Service\u548cEndpoint","text":"<p>\u4ee5\u4e0b\u60c5\u51b5\u5747\u53ef\u4f7f\u7528\u65e0\u9009\u62e9\u5668\u7684Service\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u5e0c\u671b\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u67d0\u4e2a\u56fa\u5b9a\u7684\u540d\u79f0\u800c\u975eIP\u5730\u5740\u8bbf\u95ee\u5916\u90e8\u7684\u4e2d\u95f4\u4ef6\u670d\u52a1\u3002</li> <li>\u5e0c\u671bService\u6307\u5411\u53e6\u4e00\u4e2aNamespace\u6216\u5176\u4ed6\u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u3002</li> <li>\u6b63\u5728\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u8f6c\u79fb\u5230Kubernetes\u96c6\u7fa4\uff0c\u4f46\u662f\u4e00\u90e8\u5206\u670d\u52a1\u4ecd\u8fd0\u884c\u5728Kubernetes\u96c6\u7fa4\u4e4b\u5916\u7684backend\u3002</li> </ul> <p>\u5728\u8fd9\u4e9b\u573a\u666f\u4e2d\uff0c\u90fd\u80fd\u5b9a\u4e49\u6ca1\u6709\u9009\u62e9\u5668\u7684Service\uff0c\u53ea\u9700\u8981\u628a\u4e0a\u8ff0\u7684Service\u53bb\u9664Selector\u5b57\u6bb5\u5373\u53ef\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e2aService\u6ca1\u6709\u9009\u62e9\u5668\uff0c\u5c31\u4e0d\u4f1a\u521b\u5efa\u76f8\u5173\u7684Endpoints\u5bf9\u8c61\uff0c\u53ef\u4ee5\u624b\u52a8\u521b\u5efa\u4e00\u4e2a\u540c\u540d\u7684Endpoints\uff08\u540c\u540d\u7684Service\u548cEndpoints\u4f1a\u81ea\u52a8\u5efa\u7acb\u94fe\u63a5\uff09\uff1a</p> <pre><code>kind: Service\napiVersion: v1\nmetadata:\nname: my-service\nspec:\nports:\n- protocol: TCP\nport: 80\ntargetPort: 9376\n---\nkind: Endpoints\napiVersion: v1\nmetadata:\nname: my-service\nsubsets:\n- addresses:\n- ip: 1.2.3.4\nports:\n- port: 9376\n</code></pre> <p>\u6ce8\u610f</p> <p>Endpoint IP\u5730\u5740\u4e0d\u80fd\u662floopback(127.0.0.0/8)\u3001 link-loca(l169.254.0.0/16)\u6216\u8005link-local\u591a\u64ad\u5730\u5740(224.0.0.0/24)\u3002</p> <p>\u8bbf\u95ee\u6ca1\u6709\u9009\u62e9\u5668\u7684Service\u4e0e\u6709\u9009\u62e9\u5668\u7684Service\u7684\u539f\u7406\u76f8\u540c\uff0c\u901a\u8fc7Service\u540d\u79f0\u5373\u53ef\u8bbf\u95ee\uff0c\u8bf7\u6c42\u5c06\u88ab\u8def\u7531\u5230\u7528\u6237\u5b9a\u4e49\u7684Endpoint\uff0c\u8be5\u793a\u4f8b\u4e3a 1.2.3.4:9376\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#24-externalname-service","title":"2.4 ExternalName Service","text":"<p>ExternalName Service\u662fService\u7684\u7279\u4f8b\uff0c\u5b83\u6ca1\u6709\u9009\u62e9\u5668\uff0c\u4e5f\u6ca1\u6709\u5b9a\u4e49\u4efb\u4f55\u7aef\u53e3\u548cEndpoint\uff0c\u5b83\u901a\u8fc7\u8fd4\u56de\u8be5\u5916\u90e8\u670d\u52a1\u7684\u522b\u540d\u6765\u63d0\u4f9b\u670d\u52a1\u3002</p> <p>\u6bd4\u5982\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2aService\uff0c\u540e\u7aef\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5916\u90e8\u57df\u540d\uff0c\u8fd9\u6837\u901a\u8fc7Service\u7684\u540d\u79f0\u5373\u53ef\u8bbf\u95ee\u8be5\u57df\u540d\u3002</p> <p>\u4f7f\u7528nslookup\u89e3\u6790\u4ee5\u4e0b\u6587\u4ef6\u5b9a\u4e49\u7684Service\uff0c\u96c6\u7fa4\u7684DNS\u670d\u52a1\u5c06\u8fd4\u56de\u4e00\u4e2a\u503c\u4e3amy.database.example.com\u7684CNAME\u8bb0\u5f55\uff1a</p> <pre><code>kind: Service\napiVersion: v1\nmetadata:\nname: my-service\nnamespace: prod\nspec:\ntype: ExternalName    externalName: my.database.example.com\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#25-service\u4ee3\u7406\u6a21\u5f0f","title":"2.5 Service\u4ee3\u7406\u6a21\u5f0f","text":"<p>\u5728Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u6bcf\u4e2a\u8282\u70b9\u8fd0\u884c\u4e00\u4e2akube-proxy\u8fdb\u7a0b\u3002 kube-proxy \u8d1f\u8d23\u4e3aService\u5b9e\u73b0\u4e00\u79cdVIP\uff08\u865a\u62dfIP\uff09\u7684\u5f62\u5f0f\uff0c\u800c\u4e0d\u662fExternalName\u7684\u5f62\u5f0f\u3002 \u5728Kubernetesv 1.0\u7248\u672c\u4e2d\uff0c\u4ee3\u7406\u5b8c\u5168\u662fuserspace\u3002\u5728Kubernetesv 1.1\u7248\u4e2d\u65b0\u589e\u4e86iptables\u4ee3\u7406\uff0c\u4eceKubernetesv 1.2\u7248\u8d77\uff0c\u9ed8\u8ba4\u662fiptables\u4ee3\u7406\u3002</p> <p>\u4eceKubernetesv 1.8\u7248\u5f00\u59cb\u65b0\u589e\u4e86ipvs\u4ee3\u7406\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528ipvs\u6a21\u5f0f\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#251-iptables\u4ee3\u7406\u6a21\u5f0f","title":"2.5.1 iptables\u4ee3\u7406\u6a21\u5f0f","text":"<p>\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0ckube-proxy\u4f1a\u76d1\u89c6Kubernetes master\u8282\u70b9\u5bf9Service\u5bf9\u8c61\u548cEndpoints\u5bf9\u8c61\u7684\u6dfb\u52a0\u548c\u79fb\u9664\u3002</p> <p>\u5bf9\u6bcf\u4e2aService\u5b83\u4f1a\u521b\u5efaiptables\u89c4\u5219\uff0c\u4ece\u800c\u6355\u83b7\u8be5Service\u7684ClusterIP\uff08\u865a\u62dfIP\uff09\u548c\u7aef\u53e3\u7684\u8bf7\u6c42\uff0c\u8fdb\u800c\u5c06\u8bf7\u6c42\u91cd\u5b9a\u5411 \u5230Service\u7684\u4e00\u7ec4backend\u4e2d\u7684\u67d0\u4e2aPod\u4e0a\u9762\u3002\u5bf9\u4e8e\u6bcf\u4e2aEndpoints\u5bf9\u8c61\uff0c\u5b83\u4e5f \u4f1a\u521b\u5efaiptables\u89c4\u5219\uff0c\u8fd9\u4e2a\u89c4\u5219\u4f1a\u9009\u62e9\u4e00\u4e2abackend Pod\u3002 \u9ed8\u8ba4\u7684\u7b56\u7565\u662f\u968f\u673a\u9009\u62e9\u4e00\u4e2abackend\uff0c\u5982\u679c\u8981\u5b9e\u73b0\u57fa\u4e8e\u5ba2\u6237\u7aefIP\u7684\u4f1a\u8bdd\u4eb2\u548c\u6027\uff0c\u53ef\u4ee5\u5c06service.spec.sessionAffinity\u7684\u503c\u8bbe\u7f6e\u4e3aClusterIP\uff08\u9ed8\u8ba4\u4e3a None\uff09\u3002</p> <p>\u548cuserspace\u4ee3\u7406\u7c7b\u4f3c\uff0c\u7f51\u7edc\u8fd4\u56de\u7684\u7ed3\u679c\u90fd\u662f\u5230\u8fbeService\u7684IP:Port\u8bf7\u6c42\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u4f1a\u88ab\u4ee3\u7406\u5230\u4e00\u4e2a\u5408\u9002\u7684backend\uff0c\u4e0d\u9700\u8981\u5ba2\u6237\u7aef\u77e5\u9053\u5173\u4e8e Kubernetes\u3001Service\u6216Pod\u7684\u4efb\u4f55\u4fe1\u606f\u3002\u8fd9\u6bd4userspace\u4ee3\u7406\u66f4\u5feb\u3001\u66f4\u53ef\u9760\uff0c\u5e76\u4e14\u5f53\u521d\u59cb\u9009\u62e9\u7684Pod\u6ca1\u6709\u54cd\u5e94\u65f6\uff0ciptables\u4ee3\u7406\u80fd\u591f\u81ea\u52a8\u91cd\u8bd5\u53e6\u4e00\u4e2aPod\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#252-ipvs\u4ee3\u7406\u6a21\u5f0f","title":"2.5.2 ipvs\u4ee3\u7406\u6a21\u5f0f","text":"<p>\u5728\u6b64\u6a21\u5f0f\u4e0b\uff0ckube-proxy\u76d1\u89c6Kubernetes Service\u548cEndpoint\uff0c\u8c03\u7528 netlink\u63a5\u53e3\u4ee5\u76f8\u5e94\u5730\u521b\u5efaipvs\u89c4\u5219\uff0c \u5e76\u5b9a\u671f\u4e0eKubernetes Service\u548c Endpoint\u540c\u6b65ipvs\u89c4\u5219\uff0c\u4ee5\u786e\u4fddipvs\u72b6\u6001\u4e0e\u671f\u671b\u4fdd\u6301\u4e00\u81f4\u3002\u8bbf\u95ee\u670d\u52a1\u65f6\uff0c\u6d41\u91cf\u5c06\u88ab\u91cd\u5b9a\u5411\u5230\u5176\u4e2d\u4e00\u4e2a\u540e\u7aefPod\u3002</p> <p>\u4e0eiptables\u7c7b\u4f3c\uff0cipvs\u57fa\u4e8enetfilter\u94a9\u5b50\u51fd\u6570\uff0c\u4f46\u662fipvs\u4f7f\u7528\u54c8\u5e0c\u8868\u4f5c \u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5e76\u5728\u5185\u6838\u7a7a\u95f4\u4e2d\u5de5\u4f5c\uff0c\u8fd9\u610f\u5473\u7740ipvs\u53ef\u4ee5\u66f4\u5feb\u5730\u91cd\u5b9a\u5411\u6d41\u91cf\uff0c \u5e76\u4e14\u5728\u540c\u6b65\u4ee3\u7406\u89c4\u5219\u65f6\u5177\u6709\u66f4\u597d\u7684\u6027\u80fd\uff0c\u6b64\u5916\uff0cipvs\u4e3a\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u63d0 \u4f9b\u4e86\u66f4\u591a\u7684\u9009\u9879\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>rr\uff1a\u8f6e\u8be2\u3002 </li> <li>lc\uff1a\u6700\u5c11\u8fde\u63a5\u3002</li> <li>dh\uff1a\u76ee\u6807\u54c8\u5e0c\u3002</li> <li>sh\uff1a\u6e90\u54c8\u5e0c\u3002</li> <li>sed\uff1a\u9884\u8ba1\u5ef6\u8fdf\u6700\u77ed\u3002</li> <li>nq\uff1a\u4ece\u4e0d\u6392\u961f\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>Kube-proxy\u4f7f\u7528ipvs\u6a21\u5f0f\u5fc5\u987b\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u5b89\u88c5ipvs\u6a21\u5757\uff0c\u5982\u679c\u6ca1\u6709\u5b89\u88c5 ipvs\u6a21\u5757\uff0c\u5c06\u4f1a\u9ed8\u8ba4\u4f7f\u7528iptables\u6a21\u5f0f\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#26-\u591a\u7aef\u53e3service","title":"2.6 \u591a\u7aef\u53e3Service","text":"<p>\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0cService\u53ef\u80fd\u9700\u8981\u66b4\u9732\u591a\u4e2a\u7aef\u53e3\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0cKubernetes\u652f\u6301Service\u5b9a\u4e49\u591a\u4e2a\u7aef\u53e3\uff0c\u4f46\u4f7f\u7528\u591a\u4e2a\u7aef\u53e3\u65f6\uff0c\u5fc5\u987b\u63d0\u4f9b\u6240\u6709\u7aef\u53e3\u7684\u540d\u79f0\uff0c</p> <p>\u4f8b\u5982\u5c06Service\u768480\u7aef\u53e3\u4ee3\u7406\u5230\u540e\u7aef\u76849376\uff0c443\u7aef\u53e3\u4ee3\u7406\u5230\u540e\u7aef\u76849377\uff1a</p> <pre><code>kind: Service\napiVersion: v1\nmetadata:\nname: my-service\nspec:\nselector:\napp: myapp\nports:\n- name: http\nprotocol: TCP\nport: 80\ntargetPort: 9376\n- name: https\nprotocol: TCP\nport: 443\ntargetPort: 9377\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#27-service\u7684\u7c7b\u578b","title":"2.7 Service\u7684\u7c7b\u578b","text":"<p>Kubernetes Service Type\uff08\u670d\u52a1\u7c7b\u578b\uff09\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>ClusterIP\uff1a\u5728\u96c6\u7fa4\u5185\u90e8\u4f7f\u7528\uff0c\u9ed8\u8ba4\u503c\uff0c\u53ea\u80fd\u4ece\u96c6\u7fa4\u4e2d\u8bbf\u95ee\u3002</li> <li>NodePort\uff1a\u5728\u6240\u6709\u5b89\u88c5\u4e86Kube-Proxy\u7684\u8282\u70b9\u4e0a\u6253\u5f00\u4e00\u4e2a\u7aef\u53e3\uff0c\u6b64\u7aef\u53e3\u53ef\u4ee5\u4ee3\u7406\u81f3\u540e\u7aefPod\uff0c\u53ef\u4ee5\u901a\u8fc7NodePort\u4ece\u96c6\u7fa4\u5916\u90e8\u8bbf\u95ee\u96c6\u7fa4\u5185\u7684 \u670d\u52a1\uff0c\u683c\u5f0f\u4e3aNodeIP:NodePort\u3002 </li> <li>LoadBalancer\uff1a\u4f7f\u7528\u4e91\u63d0\u4f9b\u5546\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u516c\u5f00\u670d\u52a1\uff0c\u6210\u672c\u8f83\u9ad8\u3002</li> <li>ExternalName\uff1a\u901a\u8fc7\u8fd4\u56de\u5b9a\u4e49\u7684CNAME\u522b\u540d\uff0c\u5c06Service\u6620\u5c04\u5230\u53ef\u88ab DNS\u89e3\u6790\u7684\u5176\u4ed6\u57df\u540d\uff0c\u9700\u89811.7\u6216\u66f4\u9ad8\u7248\u672ckube-dns\u7684\u652f\u6301\u3002</li> </ul> <p>\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5230Kubernetes\u540e\uff0c\u9700\u8981\u5c06\u67d0\u4e9b\u670d\u52a1\u53d1\u5e03\u81f3Kubernetes\u96c6\u7fa4 \u5916\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u88ab\u5176\u4ed6\u4eba\u8bbf\u95ee\u6216\u8005\u8c03\u7528\uff0c\u6bd4\u8f83\u5e38\u7528\u7684\u53d1\u5e03\u65b9\u5f0f\u662fIP+\u7aef\u53e3\u6216\u4f7f \u7528\u57df\u540d\u7684\u65b9\u5f0f\u3002</p> <p>IP+\u7aef\u53e3\u7684\u65b9\u5f0f\u53ef\u4ee5\u7528NodePort\u7c7b\u578bService\u8fdb\u884c\u53d1\u5e03\uff0c\u57df\u540d\u7684\u65b9\u5f0f\u53ef\u4ee5\u4f7f\u7528Ingress\uff086.3\u8282\u4ecb\u7ecd\uff09\u8fdb\u884c\u53d1\u5e03\u3002</p> <p>\u4ee5NodePort\u4e3a\u4f8b\uff0c\u5982\u679c\u5c06Service\u7684type\u5b57\u6bb5\u8bbe\u7f6e\u4e3aNodePort\uff0c\u5219Kubernetes\u5c06\u4ece--service-nodeport-range\u53c2\u6570\u6307\u5b9a\u7684\u8303\u56f4\uff08\u9ed8\u8ba4\u4e3a30000\uff5e 32767\uff09\u4e2d\u81ea\u52a8\u5206\u914d\u7aef\u53e3\uff0c \u4e5f\u53ef\u4ee5\u624b\u52a8\u6307\u5b9aNodePort\uff0c\u521b\u5efa\u8be5Service\u540e\uff0c\u96c6\u7fa4\u6bcf\u4e2a\u8282\u70b9\u90fd\u5c06\u66b4\u9732\u4e00\u4e2a\u7aef\u53e3\uff0c\u901a\u8fc7\u67d0\u4e2a\u5bbf\u4e3b\u673a\u7684IP+\u7aef\u53e3\u5373\u53ef\u8bbf\u95ee\u540e\u7aef\u7684\u5e94\u7528\uff0c \u4e5f\u53ef\u4ee5\u524d\u7aef\u91c7\u7528\u4e00\u4e2a\u53cd\u4ee3\u670d\u52a1\u5668\u4ee3\u7406\u81f3\u591a\u4e2aNode\u8282\u70b9+\u7aef\u53e3\uff0c\u9632\u6b62\u5355\u4e2aNode\u8282\u70b9\u6545\u969c\u5f15\u8d77\u7684\u670d\u52a1\u4e0d\u53ef\u7528\u3002</p> <p>\u5b9a\u4e49\u4e00\u4e2aNodePort\u7c7b\u578b\u7684Service\u683c\u5f0f\u5982\u4e0b\uff08 Kubernetes\u96c6\u7fa4\u5b89\u88c5\u65f6Dashboard\u7684\u8bbf\u95ee\u5c31\u662f\u57fa\u4e8eNodePort\u7c7b\u578b\u7684Service\u8fdb\u884c\u8bbf\u95ee\u7684\uff0c6.3\u8282\u5c06\u4f1a\u8bb2 \u5230\u5982\u4f55\u4f7f\u7528\u57df\u540d\u8bbf\u95eeKubernetes\u96c6\u7fa4\u7684\u5e94\u7528\uff09\uff1a</p> <pre><code>kind: Service\napiVersion: v1\nmetadata:\nlabels:\nk8s-app: kubernetes-dashboard\nname: kubernetes-dashboard\nnamespace: kube-system\nspec:\ntype: NodePort\nports:\n- port: 443\ntargetPort: 8443\nnodePort: 30000\nselector:\nk8s-app: kubernetes-dashboard\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>https://www.qikqiak.com/k8strain/network/service/</p> <p>\u5176\u4ed6\u670d\u52a1\u8bbf\u95ee\u65b9\u5f0f\u8be6\u60c5\u53c2\u89c1\u4ee5\u4e0b\u7f51\u5740\uff1a</p> <p>https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#28-kubernetes\u670d\u52a1\u53d1\u73b0","title":"2.8 Kubernetes\u670d\u52a1\u53d1\u73b0","text":"<p>Kubernetes\u652f\u6301\u4e24\u79cd\u7c7b\u578b\u7684\u670d\u52a1\u53d1\u73b0\uff1a\u73af\u5883\u53d8\u91cf\u548cDNS\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#281-\u57fa\u4e8e\u73af\u5883\u53d8\u91cf\u7684\u670d\u52a1\u53d1\u73b0","title":"2.8.1 \u57fa\u4e8e\u73af\u5883\u53d8\u91cf\u7684\u670d\u52a1\u53d1\u73b0","text":"<p>\u5f53Pod\u90e8\u7f72\u5230\u4e00\u4e2aNode\u8282\u70b9\u540e\uff0c\u8be5Node\u8282\u70b9\u4e0a\u7684Kubelet\u4f1a\u5728\u8be5Pod\u5185\u90e8\u8bbe\u7f6e\u4e00\u7ec4\u73af\u5883\u53d8\u91cf\uff0c  \u8fd9\u4e9b\u73af\u5883\u53d8\u91cf\u662f\u6839\u636e\u6d3b\u8dc3\u7684Service\u751f\u6210\u5e76\u4ee5{SERVICE_NAME}SERVICE_HOST\u548c{SERVICE_NAME}_SERVICE_PORT\u683c\u5f0f\u547d\u540d\u7684\u53d8\u91cf\uff0c\u5176\u4e2d\u670d\u52a1\u540d\u90fd\u8f6c\u6362\u4e3a\u5927\u5199\u5b57\u6bcd\uff0c\u201c.\u201d\u548c\u201c-\u201d\u8f6c\u6362\u4e3a\u201c\u201d\u3002 </p> <p>\u5f53\u4e00\u4e2aPod\u8fd0\u884c\u5230\u8282\u70b9\u65f6\uff0ckubelet\u4f1a\u4e3a\u6bcf\u4e2a\u5bb9\u5668\u6dfb\u52a0\u4e00\u7ec4\u73af\u5883\u53d8\u91cf\uff0cPod\u5bb9\u5668\u4e2d\u7684\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u73af\u5883\u53d8\u91cf\u53d1\u73b0Service\u3002</p> <p><code>busybox.yaml</code></p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: busybox\nnamespace: default\nspec:\ncontainers:\n- image: busybox\ncommand:\n- sleep\n- \"3600\"\nimagePullPolicy: IfNotPresent\nname: busybox\nrestartPolicy: Always\n</code></pre> <pre><code>[root@ci-base pod]# kubectl create -f busybox.yaml\npod/busybox created\n\n[root@ci-base pod]# kubectl get pod\nNAME      READY   STATUS    RESTARTS   AGE\nbusybox   1/1     Running   0          2s\n\n[root@ci-base pod]# kubectl exec -it busybox sh\n/ # env\nKUBERNETES_PORT=tcp://10.96.0.1:443\nKUBERNETES_SERVICE_PORT=443\nHOSTNAME=busybox\nSHLVL=1\nHOME=/root\nHU_NGINX_PORT_80_TCP=tcp://10.102.125.25:80\nHU_NGINX_PORT_443_TCP_ADDR=10.102.125.25\nHU_NGINX_PORT_443_TCP_PORT=443\nHU_NGINX_PORT_443_TCP_PROTO=tcp\nHU_NGINX_SERVICE_PORT_HTTP=80\nTERM=xterm\nKUBERNETES_PORT_443_TCP_ADDR=10.96.0.1\nHU_NGINX_SERVICE_PORT_HTTPS=443\nHU_NGINX_PORT_443_TCP=tcp://10.102.125.25:443\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nHU_NGINX_SERVICE_HOST=10.102.125.25\nKUBERNETES_PORT_443_TCP_PORT=443\nKUBERNETES_PORT_443_TCP_PROTO=tcp\nHU_NGINX_SERVICE_PORT=80\nHU_NGINX_PORT=tcp://10.102.125.25:80\nKUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443\nKUBERNETES_SERVICE_PORT_HTTPS=443\nKUBERNETES_SERVICE_HOST=10.96.0.1\nPWD=/\nHU_NGINX_PORT_80_TCP_ADDR=10.102.125.25\nHU_NGINX_PORT_80_TCP_PORT=80\nHU_NGINX_PORT_80_TCP_PROTO=tcp\n\n/ # echo ${HU_NGINX_SERVICE_HOST}\n10.102.125.25\n/ # echo ${HU_NGINX_SERVICE_PORT}\n80\n</code></pre> <pre><code>[root@ci-base pod]# kubectl get svc\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\nhu-nginx     ClusterIP   10.102.125.25   &lt;none&gt;        80/TCP,443/TCP   7m52s\n</code></pre> <p>\u6ce8\u610f</p> <ul> <li> <p>Pod\u548cService\u7684\u521b\u5efa\u987a\u5e8f\u662f\u6709\u8981\u6c42\u7684\uff0cService\u5fc5\u987b\u5728Pod\u521b\u5efa\u4e4b\u524d\u521b\u5efa\uff0c\u65b0\u521b\u5efa\u7684Pod\u4f1a\u81ea\u52a8\u6ce8\u5165Service\u7684\u73af\u5883\u53d8\u91cf\u3002\u5fc5\u987b\u5148\u58f0\u660eService\u4e3aPod\u505a\u4ee3\u7406\uff0c\u518d\u521b\u5efaPod\uff0c\u8fd9\u6837Pod\u5c31\u6709\u4e86Service\u7684\u73af\u5883\u53d8\u91cf</p> </li> <li> <p>Pod\u53ea\u80fd\u83b7\u53d6\u540c\u4e00Namespace\u4e2d\u7684Service\u7684\u73af\u5883\u53d8\u91cf\uff0c\u5982\u679cService\u548cPod\u8de8\u547d\u540d\u7a7a\u95f4\uff0c\u5219\u65e0\u6cd5\u83b7\u53d6\u73af\u5883\u53d8\u91cf\u3002</p> </li> </ul>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#2\u57fa\u4e8edns\u7684\u670d\u52a1\u53d1\u73b0","title":"2\uff0e\u57fa\u4e8eDNS\u7684\u670d\u52a1\u53d1\u73b0","text":"<p>Kubernetes\u8fdb\u884c\u670d\u52a1\u53d1\u73b0\u7684\u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\u57fa\u4e8eKubernetes\u5185\u90e8\u7684DNS\u8bb0 \u5f55\uff0c\u65b0\u7248Kubernetes\u9ed8\u8ba4\u4f7f\u7528CoreDNS\u4f5c\u4e3a\u96c6\u7fa4\u7684\u5185\u90e8DNS\uff0c \u4e00\u822cCoreDNS\u7684 Service\u5730\u5740\u4e3aService\u7f51\u6bb5\u7684\u7b2c10\u4e2aIP\uff0c\u6bd4\u598210.96.0.10\uff0c\u7aef\u53e353\uff0c \u96c6\u7fa4\u5185Pod\u53ef\u901a\u8fc7\u8be5\u5730\u5740\u548c\u7aef\u53e3\u8fdb\u884cKubernetes\u5185\u90e8\u7684\u670d\u52a1\u89e3\u6790\u3002</p> <p>DNS\u670d\u52a1\u5668\u76d1\u542c Kubernetes\u521b\u5efa\u7684Service\uff0c\u7136\u540e\u7ed9\u6bcf\u4e2aService\u6dfb\u52a0\u4e00\u7ec4DNS\u8bb0\u5f55\uff0c\u96c6\u7fa4\u4e2d\u7684 Pod\u5c31\u80fd\u901a\u8fc7Kubernetes\u5185\u90e8\u7684DNS\u89e3\u6790\u5230Service\u7684IP\uff0c\u4e5f\u5c31\u662fService\u7684ClusterIP\u3002</p> <p>\u4e3a\u670d\u52a1\u63d0\u4f9b\u540d\u79f0\u57df\u540d\u7684\u8bbf\u95ee\u3002</p> <ul> <li>DNS\u670d\u52a1\u76d1\u89c6Kubernetes API\uff0c\u4e3a\u6bcf\u4e00\u4e2aService\u521b\u5efaDNS\u8bb0\u5f55\u7528\u4e8e\u57df\u540d\u89e3\u6790\u3002</li> <li>ClusterIP A\u8bb0\u5f55\u683c\u5f0f\uff1a<code>&lt;service-name&gt;.&lt;namespace-name&gt;.svc.cluster.local</code> \u793a\u4f8b\uff1amy-svc.my-namespace.svc.cluster.local</li> </ul> <p>\u4f8b\u5982\u521b\u5efa\u4e00\u4e2a\u542b\u6709nslookup\u547d\u4ee4\u7684\u5bb9\u5668 \uff0c  \u6d4b\u8bd5\u89e3\u6790kube-dns\u7684Service\uff08\u6307\u5b9a\u7684Service\u540d\u4e3akube-dns.kube-system\uff0c\u540c\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\u53ef\u4ee5\u7701\u7565.kube-system\uff09\uff1a <pre><code>$ kubectl run redis --image=redis:3.2.10-alpine\n$ kubectl get pod\nNAME    READY   STATUS    RESTARTS   AGE\nredis   1/1     Running   0          28s\n\n$ kubectl exec -ti redis -- nslookup kube-dns.kube-system\nnslookup: can't resolve '(null)': Name does not resolve\n\nName:      kube-dns.kube-system\nAddress 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local\n</code></pre></p> <p>Kubernetes\u8fd8\u652f\u6301\u547d\u540d\u7aef\u53e3\u7684DNS SRV\uff08\u670d\u52a1)\u8bb0\u5f55\uff0c\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u6709\u4e00\u4e2aTCP\u7aef\u53e3\uff0c\u5e76\u4e14\u8be5\u7aef\u53e3\u7684\u540d\u79f0\u4e3ahttp\uff0c \u5219\u53ef\u4ee5\u4f7f\u7528\"_http._tcp.{SERVICE_NAME}.{SERVICE_NAMESPACE}\"\u6267\u884cDNS SRV\u67e5\u8be2\uff0c\u4ee5\u67e5\u8be2\u8be5Service\u7684IP\u548c\u7aef\u53e3\u3002</p> <p>Kubernetes\u76ee\u524d\u652f\u6301\u73af\u5883\u53d8\u91cf\u548cDNS\u4e24\u79cd\u7b80\u5355\u7684\u670d\u52a1\u53d1\u73b0\uff0c\u4e24\u79cd\u65b9\u5f0f\u5404\u6709 \u4f18\u7f3a\u70b9\uff0c\u5176\u4e2d\u73af\u5883\u53d8\u91cf\u5f62\u5f0f\u9700\u8981\u5f00\u53d1\u4eba\u5458\u81ea\u884c\u5b9e\u73b0\u53d8\u91cf\u7684\u89e3\u6790\uff0c \u800c\u57fa\u4e8eDNS\u7684 \u670d\u52a1\u53d1\u73b0\u4e0d\u9700\u8981\u591a\u4f59\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u901a\u8fc7http://SERVICE_NAME:SERVICE_PORT \u5373\u53ef\u8c03\u7528\u5176\u4ed6\u7ec4\u4ef6\uff0c\u4f46\u662f\u4f1a\u6709\u4e00\u4e9b\u7f51\u7edc\u4e0a\u7684\u6d88\u8017\u3002 \u76f8\u5bf9\u4e8eKubernetes\u7684\u670d\u52a1\u53d1\u73b0\uff0c\u4e1a\u754c\u66f4\u5e38\u7528\u7684\u53ef\u80fd\u662f\u57fa\u4e8eSpring Cloud\u7684Eureka\uff0c\u6216\u8005\u662fConsul\u7b49\u5de5\u5177\u5b9e\u73b0\u5fae\u670d\u52a1\u7684\u81ea\u52a8\u53d1\u73b0\uff0c \u4e0d\u8fc7\u5e76\u4e0d\u662f\u6240\u6709\u7684\u9879\u76ee\u90fd\u662f\u57fa\u4e8eSpring Cloud\u5168\u5bb6\u6876\u8fdb\u884c\u5f00\u53d1\u7684\uff0c\u800c\u4f7f\u7528\u5176\u4ed6\u5de5\u5177\u6216Kubernetes\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u670d\u52a1\u53d1\u73b0\uff0c \u4e5f\u4f1a\u5e26\u6765\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u903b\u8f91\u4ee3\u7801\u65f6\u95f4\u4e0a\u7684\u6d88\u8017\uff0c\u6240\u4ee5\u53ef\u80fd\u57fa\u4e8eKubernetes DNS\u7684\u670d\u52a1\u53d1\u73b0\u66f4\u4e3a\u7b80\u5355\u9ad8\u6548\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#3ingress","title":"3.Ingress","text":"<p>Ingress\u4e3aKubernetes\u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u63d0\u4f9b\u4e86\u5165\u53e3\uff0c\u53ef\u4ee5\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001 SSL\u7ec8\u6b62\u548c\u57fa\u4e8e\u540d\u79f0\uff08\u57df\u540d\uff09\u7684\u865a\u62df\u4e3b\u673a\u3001\u5e94\u7528\u7684\u7070\u5ea6\u53d1\u5e03\u7b49\u529f\u80fd\uff0c\u5728\u751f\u4ea7\u73af \u5883\u4e2d\u5e38\u7528\u7684Ingress\u6709Treafik\u3001Nginx\u3001HAProxy\u3001Istio\u7b49\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#31-\u57fa\u672c\u6982\u5ff5","title":"3.1 \u57fa\u672c\u6982\u5ff5","text":"<p>\u4e0a\u4e00\u8282\u8bb2\u89e3Service\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7NodePort\u7c7b\u578b\u7684Service\u5728\u96c6\u7fa4\u5916 \u90e8\u8bbf\u95eeKubernetes\u96c6\u7fa4\u5185\u7684\u5e94\u7528\uff0c\u7136\u800c\u901a\u8fc7IP\u5730\u5740+\u7aef\u53e3\u7684\u8bbf\u95ee\u6a21\u5f0f\u5e76\u4e0d\u662f\u5e94 \u7528\u53d1\u5e03\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u4e5f\u4e0d\u662f\u63a8\u8350\u7684\u53d1\u5e03\u65b9\u5f0f\uff0c\u76f8\u5bf9\u4e8eIP\u5730\u5740\uff0c\u6211\u4eec\u66f4\u559c\u6b22\u5728 \u6d4f\u89c8\u5668\u8f93\u5165\u57df\u540d\u8bbf\u95ee\u5e94\u7528\uff0c \u90a3\u4e48\u5728Kubernetes\u96c6\u7fa4\u4e2d\u5982\u4f55\u4f7f\u7528\u57df\u540d\u53d1\u5e03\u670d\u52a1\u5462\uff1f</p> <p>\u5728\u6ca1\u6709\u4f7f\u7528Kubernetes\u7684\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u90e8\u7f72\u4e00\u4e2a\u5e94\u7528\u5e76\u4f7f\u7528\u57df\u540d\u8fdb\u884c\u53d1 \u5e03\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p>1\uff09\u90e8\u7f72\u5e94\u7528\u81f3\u5bbf\u4e3b\u673a\uff0c\u542f\u52a8\u5e94\u7528\u5e76\u66b4\u9732\u4e00\u4e2a\u7aef\u53e3\u53f7\u3002</p> <p>2\uff09\u901a\u8fc7Nginx\u6216\u5176\u4ed6\u4ee3\u7406\u5de5\u5177\u914d\u7f6e\u57df\u540d\uff0c\u5e76\u4ee3\u7406\u81f3\u540e\u7aef\u5e94\u7528\u3002</p> <p>3\uff09\u5728\u57df\u540d\u5382\u5546\u8fdb\u884c\u57df\u540d\u89e3\u6790\uff0c\u8bbe\u7f6eDNS\u8bb0\u5f55\u81f3Nginx\u6216\u5176\u4ed6\u4ee3\u7406\u5de5\u5177</p> <p>(Nginx\u7684\u524d\u9762\u53ef\u80fd\u8fd8\u6709\u5176\u4ed6\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5728\u6b64\u4e0d\u8fdb\u884c\u8bf4\u660e)\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u4e4b\u540e\u5c31\u80fd\u901a\u8fc7\u57df\u540d\u8bbf\u95ee\u6211\u4eec\u7684\u5e94\u7528\u3002</p> <p>\u5728\u4f7f\u7528Kubernetes\u65f6\uff0c\u90e8\u7f72\u4e00\u4e2a\u5e94\u7528\u5e76\u4f7f\u7528\u57df\u540d\u8fdb\u884c\u53d1\u5e03\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a 1\uff09\u90e8\u7f72\u5e94\u7528\u81f3Kubernetes\u96c6\u7fa4\uff0c\u5bb9\u5668\u5185\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u542f\u52a8\u7684\u65b9\u5f0f\u3002</p> <p>2\uff09\u914d\u7f6eClusterIP\u7c7b\u578b\u7684Service\uff0c\u901a\u8fc7Selector\u94fe\u63a5\u5230\u5bb9\u5668\u5185\u7684\u5e94\u7528\u3002</p> <p>3\uff09\u914d\u7f6eIngress\u94fe\u63a5\u5230\u8be5\u5e94\u7528\u7684Service\uff0c\u4e4b\u540e\u5c06\u57df\u540d\u89e3\u6790\u5230Ingress(Ingress\u524d\u9762\u53ef\u80fd\u8fd8\u6709\u5176\u4ed6\u4ee3\u7406\u670d\u52a1\u5668)\u5bf9\u5e94\u7684\u5bbf\u4e3b\u673a\u4e0a\u5373\u53ef\u3002</p> <p>\u6b64\u65f6\u5728Kubernetes\u4e2d\u5bf9\u5e94\u7684\u67b6\u6784\u56fe\u5982\u56fe6.3\u6240\u793a\u3002</p> <p></p> <p>\u56fe6.3 Ingress\u4ee3\u7406\u6a21\u5f0f</p> <p>\u90a3Ingress\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f</p> <p>\u901a\u4fd7\u6765\u8bb2\uff0cIngress\u548c\u4e4b\u524d\u63d0\u5230\u7684Service\u3001Deployment\u7b49\u7c7b\u4f3c\uff0c\u4e5f\u662f\u4e00\u4e2aKubernetes\u7684\u8d44\u6e90\u5bf9\u8c61\uff0cDeployment\u662f\u7528\u6765\u90e8\u7f72\u5e94\u7528\u7684\uff0cIngress\u5c31\u662f\u5b9e\u73b0\u7528\u57df\u540d\u7684\u65b9\u5f0f\u8bbf\u95ee\u5e94\u7528\u3002</p> <p>Ingress\u5b9e\u73b0\u7684\u65b9\u5f0f\u6709\u5f88\u591a\uff0c\u6bd4\u5982Nginx\u3001HAProxy\u3001 Treafik\u7b49\uff0c\u5c31Nginx\u800c\u8a00 \uff0c\u548c\u4e0a\u8ff0\u63d0\u5230\u7684\u4f20\u7edf\u670d\u52a1\u67b6\u6784\u7528Nginx\u7c7b\u4f3c \u3002</p> <p>Ingress\u63a7\u5236\u5668\u5728\u6bcf\u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u5bbf\u4e3b\u673a\u4e0a\u90e8\u7f72\u4e00\u4e2aPod\uff0c\u8fd9\u4e2aPod\u91cc\u9762\u8fd0\u884c\u7684 \u5c31\u662fNginx\u8fdb\u7a0b\uff0c\u91cc\u9762\u7684\u5b9e\u73b0\u903b\u8f91\u548c\u5bbf\u4e3b\u673a\u90e8\u7f72Nginx\u7684\u65b9\u5f0f\u5e76\u65e0\u592a\u5927\u533a\u522b\uff0c \u5173\u952e\u533a\u522b\u662f\u5bbf\u4e3b\u673a\u90e8\u7f72\u7684Nginx\u9700\u8981\u66f4\u6539Nginx\u7684\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u57df\u540d\uff0c \u800cIngress\u5219\u548c\u5176\u4ed6Kubernetes\u8d44\u6e90\u6587\u4ef6\u4e00\u6837\uff0c\u4f7f\u7528YAML\u6587\u4ef6\u8fdb\u884c\u914d\u7f6e\uff0c\u4e4b\u540e Ingress\u63a7\u5236\u5668\u6839\u636eYAML\u6587\u4ef6\u5b9a\u4e49\u7684\u5185\u5bb9\u81ea\u52a8\u751f\u6210\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u5728Kubernetes v1.1\u7248\u4e2d\u6b63\u5f0f\u5f15\u7528Ingress\u7684\u6982\u5ff5\uff0c\u7528\u4e8e\u4ece\u96c6\u7fa4\u5916\u90e8\u5230\u96c6 \u7fa4\u5185\u90e8Service\u7684HTTP\u548cHTTPS\u8def\u7531\uff0c\u53ef\u4ee5\u914d\u7f6e\u63d0\u4f9b\u670d\u52a1\u5916\u90e8\u8bbf\u95ee\u7684URL\u3001\u8d1f\u8f7d \u5747\u8861\u548c\u7ec8\u6b62SSL\uff0c\u5e76\u63d0\u4f9b\u57fa\u4e8e\u57df\u540d\u7684\u865a\u62df\u4e3b\u673a\u3002\u6d41\u91cf\u4eceInternet\u5230Ingress\u518d \u5230Services\u6700\u540e\u5230Pod\u4e0a\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cIngress\u90e8\u7f72\u5728\u6240\u6709\u7684Node\u8282\u70b9\u4e0a\uff0c \u66b4\u9732443\u548c80\u7aef\u53e3\uff08\u4e00\u822c\u901a\u8fc7hostNetwork\u7684\u65b9\u5f0f\u90e8\u7f72Ingress),\u4e4b\u540e\u518d\u901a\u8fc7F5\u6216\u516c\u6709\u4e91LB\u4ee3\u7406\u5230\u5bf9\u5e94\u7684Ingress\u8282\u70b9\u4e0a\uff0c\u4e4b\u540e\u5c06\u57df\u540d\u89e3\u6790\u5230F5\u6216\u516c\u6709\u4e91LB\u5373\u53ef\u5b9e\u73b0\u57fa\u4e8e\u57df\u540d\u7684\u670d\u52a1\u53d1\u5e03\u3002</p> <p>Ingress\u9009\u578b</p> <p>\u53c2\u8003\u6587\u732e</p> <ul> <li>https://www.yuque.com/coolops/kubernetes/uung6g</li> <li>https://www.yuque.com/cuiliang0302/kubernets/qc173m</li> <li>https://www.qikqiak.com/k8strain/network/ingress/nginx/</li> </ul> <p>Nginx Ingress\u5947\u5de7\u6deb\u6280</p> <p>https://www.yuque.com/coolops/kubernetes/ke3qu2</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#32-\u521b\u5efa\u4e00\u4e2aingress","title":"3.2 \u521b\u5efa\u4e00\u4e2aIngress","text":"<p>\u521b\u5efaIngress\u548c\u521b\u5efa\u5176\u4ed6\u8d44\u6e90\u7c7b\u4f3c\uff0c\u4e5f\u662f\u4f7f\u7528YAML\u683c\u5f0f\u7684\u6587\u4ef6\u3002</p> <p>\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684Ingress\u4ee3\u7801\u5982\u4e0b (Kubernetes\u7248\u672c\u5c0f\u4e8e1.22\u65f6\uff0cAPIVersion\u4e3a networking.k8s.io/v1beta1,\u5927\u4e8e\u7b49\u4e8e1.22\u7248\u672c\u65f6\u5fc5\u987b\u4e3anetworking.k8s.io/v1,\u6700\u65e9\u671f\u7684\u7248\u672c\u8fd8\u6709extensions/v1beta1\uff0c\u5728\u6b64\u4e0d\u518d\u8bf4\u660e\uff09\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\nname: simple-fanout-example\nannotations:\nkubernetes.io/ingress.class: \"nginx\" # \u4e0d\u540c\u7684controller\uff0cingress.class\u53ef\u80fd\u4e0d\u4e00\u81f4\nspec:\nrules:\n- host: foo.bar.com\nhttp:\npaths:\n- path: /foo\npathType: Prefix\nbackend:\nserviceName: service1\nservicePort: 4200\n- path: /bar\npathType: ImplementationSpecific\nbackend:\nserviceName: service2\nservicePort: 8080\n</code></pre> <p>\u4e0a\u8ff0host\u5b9a\u4e49\u8be5Ingress\u7684\u57df\u540d\uff0c\u5c06\u5176\u89e3\u6790\u81f3\u4efb\u610f\u90e8\u7f72\u4e86Ingress\u63a7\u5236\u5668 \u7684Node\u4e0a\u5373\u53ef\u8bbf\u95ee\uff0c</p> <p>\u5982\u679c\u8bbf\u95ee\u7684\u662ffoo.bar.com/foo\uff0c\u5219\u88ab\u8f6c\u53d1\u5230service1\u76844200\u7aef\u53e3\uff0c \u5982\u679c\u8bbf\u95ee\u7684\u662ffoo.bar.com/bar\uff0c\u5219\u88ab\u8f6c\u53d1\u5230service2\u76848080\u7aef\u53e3\u3002</p> <p>\u5f53\u96c6\u7fa4\u7248\u672c\u5927\u4e8e\u7b49\u4e8e1.19\u65f6\uff0cIngress\u7684APIVersion\u53d8\u4e3a\u4e86v1\u7248\u672c\uff081.22\u540e\u5e9f\u5f03\u4e86v1beta1\uff09\uff0c\u5bf9\u5e94\u7684\u914d\u7f6e\u4e5f\u6709\u4e00\u4e9b\u53d8\u5316\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1 # 1.19+\nkind: Ingress\nmetadata:\nname: simple-fanout-example\nspec:\ningressClassName: nginx\nrules:\n- host: foo.bar.com\nhttp:\npaths:\n- path: /foo\nbackend:\nservice\nname: service1\nport:\nnumber: 4200\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#33-ingress\u4f7f\u7528\u5165\u95e8","title":"3.3 Ingress\u4f7f\u7528\u5165\u95e8","text":""},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#1\u5355\u57df\u540d","title":"1.\u5355\u57df\u540d","text":"<p>\u4e00\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684\u914d\u7f6e\u662f\u5355\u4e2a\u57df\u540d\u5339\u914d\u591a\u4e2apath\u5230\u4e0d\u540c\u7684Service\uff08Kubernetes 1.19\u7248\u672c\u4ee5\u4e0a\u53ef\u4ee5\u53c2\u8003\u524d\u6587\uff09\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\nname: simple-fanout-example\nannotations:\nnginx.ingress.kubernetes.io/rewrite-target: /\nspec:\nrules:\n- host: foo.bar.com\nhttp:\npaths:\n- path: /foo\nbackend:\nserviceName: service1\nservicePort: 4200\n- path: /bar\nbackend:\nserviceName: service2\nservicePort: 8080\n</code></pre> <p>\u6b64\u65f6\uff0c\u8bbf\u95eefoo.bar.com/foo\u5230service1\u76844200\uff0c\u8bbf\u95eefoo.bar.com/bar\u5230service2\u76848080\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#2\u591a\u57df\u540d","title":"2.\u591a\u57df\u540d","text":"<p>\u4e5f\u652f\u6301\u548cNginx\u4e00\u6837\u7684\u591a\u57df\u540d\u914d\u7f6e\uff0c\u4e5f\u5c31\u662f\u57fa\u4e8e\u57df\u540d\u7684\u865a\u62df\u4e3b\u673a\uff0c\u652f\u6301\u5c06HTTP\u6d41\u91cf\u8def\u7531\u5230\u540c\u4e00IP\u5730\u5740\u7684\u591a\u4e2a\u4e3b\u673a\u540d\uff08Kubernetes 1.19\u4ee5\u4e0a\u7248\u672c\u53ef\u4ee5\u53c2\u8003\u524d\u6587\uff09\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\nname: name-virtual-host-ingress\nspec:\nrules:\n- host: foo.bar.com\nhttp:\npaths:\n- backend:\nserviceName: service1\nservicePort: 80\n- host: bar.foo.com\nhttp:\npaths:\n- backend:\nserviceName: service2\nservicePort: 80\n</code></pre> <p>\u6b64\u65f6\uff0c\u8bbf\u95eefoo.bar.com\u5230service1\uff0c\u8bbf\u95eebar.foo.com\u5230service2\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#3\u57fa\u4e8etls\u7684ingress","title":"3.\u57fa\u4e8eTLS\u7684Ingress","text":"<p>\u751f\u4ea7\u73af\u5883\u7684\u57df\u540d\u5927\u90e8\u5206\u90fd\u662fHTTPS\u7684\uff0cIngress\u4e5f\u652f\u6301HTTPS\u7c7b\u578b\u7684\u57df\u540d\u3002\u9996\u5148\u521b\u5efa\u8bc1\u4e66\uff0c\u751f\u4ea7\u73af\u5883\u7684\u8bc1\u4e66\u4e3a\u516c\u53f8\u8d2d\u4e70\u7684\u8bc1\u4e66\uff1a</p> <pre><code>$ kubectl -n default create secret tls nginx-test-tls --key=tls.key --cert=tls.crt\n</code></pre> <p>\u5b9a\u4e49Ingress\uff08Kubernetes 1.19\u4ee5\u4e0a\u7248\u672c\u53ef\u4ee5\u53c2\u8003\u524d\u6587\uff09\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\nname: nginx-https-test\nnamespace: default\nannotations:\nkubernetes.io/ingress.class: \"nginx\"\nspec:\nrules:\n- host: https-test.com\nhttp:\npaths:\n- backend:\nserviceName: nginx-svc\nservicePort: 80\ntls:\n- secretName: nginx-test-tls\n</code></pre> <p>\u63d0\u793a tls\u4e3a\u57df\u540d\u8bc1\u4e66\u914d\u7f6e\u9879\uff0c\u4e00\u4e2aIngress\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2atls\u7c7b\u578b\u7684Secret\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#34-\u66f4\u65b0ingress","title":"3.4 \u66f4\u65b0Ingress","text":"<p>\u66f4\u65b0Ingress\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>kubectl edit ingress INGRESS-NAME</code>\u8fdb\u884c\u66f4\u6539\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>kubectl apply/replace -f NEW-INGRESS-YAML.yaml</code>\u8fdb\u884c\u66f4\u6539\u3002</p> <p>\u672c\u7ae0\u53ea\u4ecb\u7ecd\u4e86Ingress\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u66f4\u591aIngress\u7684\u914d\u7f6e\u8bf7\u53c2\u8003Ingress Nginx\u8fdb\u9636\u4e00\u7ae0\uff08\u672c\u4e66\u7b2c16\u7ae0\uff09\u7684\u5185\u5bb9\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%9F%BA%E7%A1%80/#4\u5c0f\u7ed3","title":"4.\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u8bb2\u89e3\u4e86\u670d\u52a1\u53d1\u5e03\u7684\u4e24\u79cd\u65b9\u5f0f\uff0c\u5373Service\u548cIngress\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c Service\u7528\u4e8e\u7a0b\u5e8f\u95f4\u7684\u5185\u90e8\u8bbf\u95ee\uff0c\u5373\u540e\u7aef\u670d\u52a1\u4e4b\u95f4\u7684\u76f8\u4e92\u8c03\u7528\u3002 \u800cIngress\u591a \u7528\u4e8e\u5bf9\u5916\u53d1\u5e03\u670d\u52a1\uff0c\u5373\u901a\u8fc7\u57df\u540d\u7684\u5f62\u5f0f\u8ba9\u7528\u6237\u80fd\u8bbf\u95ee\u5230\u5185\u90e8\u670d\u52a1\uff0c\u8fd9\u4e5f\u662f\u6700\u666e\u904d\u7684\u53d1\u5e03\u65b9\u5f0f\uff0c \u4f46\u662f\u5982\u679c\u4e00\u4e2a\u4e0d\u9700\u8981\u5bf9\u5916\u53d1\u5e03\u7684\u540e\u7aef\u670d\u52a1\uff0c\u901a\u8fc7Ingress\u88ab\u53e6\u4e00\u4e2a\u540e\u7aef\u670d\u52a1\u8c03\u7528\uff0c\u5219\u76f8\u5f53\u4e8e\u4ece\u5916\u90e8\u7ed5\u4e86\u4e00\u5708\uff0c\u8fd9\u4e0d\u662f\u63a8\u8350\u7684\u65b9\u5f0f\u3002</p> <p>\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u4e5f\u4f1a\u6709\u67b6\u6784\u76f4\u63a5\u901a\u8fc7Service\u7684NodePort\u66b4\u9732\u670d\u52a1\uff0c\u7136\u540e\u7531 \u4e0a\u5c42\u7684\u7f51\u5173\u8fdb\u884c\u4ee3\u7406\uff0c\u57df\u540d\u90fd\u914d\u7f6e\u5728\u4e0a\u5c42\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u670d\u52a1\u8fc7\u591a\u4f1a\u5f15\u8d77\u7aef\u53e3 \u7ef4\u62a4\u975e\u5e38\u590d\u6742\uff0c\u53ef\u80fd\u8fd8\u4f1a\u6709\u6027\u80fd\u635f\u8017\u3002</p> <p>\u6240\u4ee5\u4e00\u822c\u63a8\u8350\u5728\u4e0a\u5c42\u914d\u7f6e\u901a\u914d\u7b26\u57df\u540d\uff0c\u6bd4\u5982*.test.com\u5230Kubernetes\u7684Ingress Controller\uff0c\u4e4b\u540e\u7531Ingress\u518d\u505a\u8def\u7531\u3002\u6bd4\u5982a.test.com\u6307\u5411A\u9879\u76ee\uff0ca.test.com/xxx\u6307\u5411A\u9879\u76ee\u7684xxx\u670d\u52a1\u3002</p> <p>\u53e6\u5916\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u65f6\uff0c\u6709\u4e86Service\u65e0\u987b\u518d\u8003\u8651\u8d1f\u8f7d\u5747\u8861\u7b49\u95ee\u9898\uff0c\u6240\u4ee5\u5982\u679c\u6709\u7a0b\u5e8f\u95f4\u7684\u8c03\u7528\uff0c\u9996\u9009Service\uff0c\u5e76\u4e14\u4ee5\u540e\u53ef\u4ee5\u65e0\u7f1d\u5730\u63a5\u5165\u670d\u52a1\u7f51\u683c\uff0c\u8fdb\u884c\u670d \u52a1\u6cbb\u7406\u3002</p> <p>\u5728\u4f7f\u7528Kubernetes\u65f6\uff0c\u5176\u5b9e\u5e76\u4e0d\u63a8\u8350\u4f7f\u7528Spring Cloud\u8fd9\u7c7b\u67b6\u6784\uff0c \u56e0\u4e3a\u5f88\u591a\u529f\u80fd\u90fd\u662f\u7c7b\u4f3c\u7684\uff0c \u5728Kubernetes\u4e0a\u4ecd\u65e7\u4f7f\u7528Spring Cloud\u5c5e\u4e8e\u201c\u5957\u5a03\u201d\u578b\u67b6\u6784\uff0c\u5e94\u8be5\u5411\u7740\u5355\u670d\u52a1\u65b9\u5411\u8fdb\u884c\u5f00\u53d1\uff0c\u6bd4\u5982\u76f4\u63a5\u4f7f\u7528Spring Boot\u5373\u53ef\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/","title":"Kubernetes\u914d\u7f6e\u7ba1\u7406","text":"<p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u670d\u52a1\u7684\u542f\u52a8\u9700\u8981\u4f9d\u8d56\u4e00\u4e9b\u914d\u7f6e\uff0c\u6bd4\u5982\u4e00\u4e2aJava\u5e94\u7528\u9700\u8981\u77e5\u9053\u81ea\u5df1\u94fe\u63a5\u7684\u6570\u636e\u5e93\u6216\u5176\u4ed6\u4e2d\u95f4\u4ef6\u7684\u5730\u5740\u662f\u4ec0\u4e48\uff0c \u9700\u8981\u77e5\u9053\u94fe\u63a5\u53e6\u4e00\u4e2a\u670d\u52a1\u7684\u63a5\u53e3\u5730\u5740\u662f\u4ec0\u4e48\uff0c\u6240\u4ee5\u9700\u8981\u544a\u8bc9\u5e94\u7528\u5176\u4ed6\u670d\u52a1\u7684\u914d\u7f6e\u4fe1\u606f\u3002</p> <p>\u4e00\u822c\u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u6ce8\u5165\u6216\u8005\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\uff0c\u800c\u4e0d\u662f\u5199\u6b7b\u5728\u4ee3\u7801\u91cc\u9762\uff0c\u8fd9\u4e5f\u662f\u4e91\u539f\u751f\u5e94\u7528\u8bbe\u8ba1\u6bd4\u8f83\u91cd\u8981\u7684\u56e0\u7d20\u2014\u2014\u914d\u7f6e\u5206\u79bb\u3002</p> <p>\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u4fdd\u5b58\u5728\u672c\u5730\u670d\u52a1\u5668\u3001\u4ee3\u7801\u4ed3\u5e93\u6216\u914d\u7f6e\u4e2d\u5fc3\uff0c\u800c\u5728Kubernetes\u4e0a\uff0c\u5176\u62bd\u8c61\u4e3aConfigMap\uff08\u7f29\u5199\u4e3aCM\uff09\u548cSecret\u7684\u6982\u5ff5\uff0c \u7528\u6765\u7ba1\u7406\u7a0b\u5e8f\u7684\u914d\u7f6e\u6587\u4ef6\u6216Pod\u53d8\u91cf\uff0c\u6bd4\u5982Nginx\u914d\u7f6e\u3001\u5e94\u7528\u914d\u7f6e\u3001Maven Setting\u914d\u7f6e\u6587\u4ef6\u7b49\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#1-\u4ec0\u4e48\u662fconfigmap","title":"1. \u4ec0\u4e48\u662fConfigMap","text":"<p>\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u914d\u7f6e\u6587\u4ef6\u5f80\u5f80\u88ab\u4fdd\u5b58\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u7a0b\u5e8f\u542f\u52a8\u65f6\u53ef\u4ee5\u6307\u5b9a\u67d0\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u4f46\u662f\u4f7f\u7528\u5bb9\u5668\u90e8\u7f72\u65f6\uff0c\u5bb9\u5668\u6240\u5728\u7684\u8282\u70b9\u5e76\u4e0d\u56fa\u5b9a\uff0c \u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6b64\u5904\u5728\u6784\u5efa\u955c\u50cf\u65f6\uff0c\u5982\u679c\u628a\u914d\u7f6e\u6587\u4ef6\u4e5f\u653e\u5728\u5bb9\u5668\u91cc\u9762\uff0c\u90a3\u4e48\u914d\u7f6e\u6587\u4ef6\u4e00\u65e6\u6709\u66f4\u6539\u7684\u8bdd\uff0c\u4e5f\u662f\u4e00\u4ef6\u975e\u5e38\u9ebb\u70e6\u7684\u4e8b\u60c5\u3002 \u6240\u4ee5Kubernetes\u62bd\u8c61\u4e86\u4e00\u4e2aConfigMap\u7684\u6982\u5ff5\uff0c\u5c06\u914d\u7f6e\u4e0ePod\u548c\u7ec4\u4ef6\u5206\u5f00\uff0c\u8fd9\u6709\u52a9\u4e8e\u4fdd\u6301\u5de5\u4f5c\u8d1f\u8f7d\u7684\u53ef\u79fb\u690d\u6027\uff0c\u4f7f\u914d\u7f6e\u66f4\u6613\u4e8e\u66f4\u6539\u548c\u7ba1\u7406\u3002</p> <p>\u6bd4\u5982\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u53ef\u4ee5\u5c06Nginx\u3001Redis\u7b49\u5e94\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u5b58\u50a8\u5728ConfigMap\u4e0a\uff0c\u7136\u540e\u5c06\u5176\u6302\u8f7d\u5373\u53ef\u4f7f\u7528\u3002</p> <p>\u76f8\u5bf9\u4e8eSecret\uff0cConfigMap\u66f4\u503e\u5411\u4e8e\u5b58\u50a8\u548c\u5171\u4eab\u975e\u654f\u611f\u3001\u672a\u52a0\u5bc6\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u5047\u5982\u662f\u5728\u96c6\u7fa4\u4e2d\u4f7f\u7528\u654f\u611f\u4fe1\u606f\uff0c\u6700\u597d\u4f7f\u7528Secret\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#2-\u521b\u5efaconfigmap","title":"2. \u521b\u5efaConfigMap","text":"<p>ConfigMap\u53ef\u4ee5\u7528\u76ee\u5f55\uff08\u76ee\u5f55\u4e0b\u6709\u591a\u4e2a\u6587\u4ef6\uff09\u3001\u5355\u4e2a\u6587\u4ef6\u6216\u5b57\u7b26\u503c\u7684\u65b9\u5f0f\u521b\u5efa\uff0c\u4f7f\u7528kubectl\u521b\u5efa\u4e00\u4e2aConfigMap\u7684\u547d\u4ee4\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>$ kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;\n</code></pre> <ul> <li>map-name\uff1aConfigMap\u7684\u540d\u79f0\u3002</li> <li>data-source\uff1a\u6570\u636e\u6e90\uff0c\u53ef\u4ee5\u662f\u6570\u636e\u7684\u76ee\u5f55\u3001\u6587\u4ef6\u6216\u5b57\u7b26\u503c\u3002</li> </ul> <p>ConfigMap\u4e2d\u7684\u6570\u636e\u662f\u4ee5\u952e-\u503c\u5bf9\uff08key-value pair\uff09\u7684\u5f62\u5f0f\u4fdd\u5b58\u7684\uff0c\u5176\u4e2d\uff1a</p> <ul> <li>key\uff1a\u6587\u4ef6\u540d\u6216\u5bc6\u94a5\u3002</li> <li>value\uff1a\u6587\u4ef6\u5185\u5bb9\u6216\u5b57\u7b26\u503c\u3002</li> </ul>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#21-\u57fa\u4e8e\u76ee\u5f55\u521b\u5efaconfigmap","title":"2.1 \u57fa\u4e8e\u76ee\u5f55\u521b\u5efaConfigMap","text":"<p>\u5047\u5982\u4e00\u6b21\u6027\u9700\u8981\u591a\u4e2a\u6587\u4ef6\u6765\u521b\u5efaConfigMap\uff0c\u53ef\u4ee5\u4f7f\u7528kubectl create configmap\u547d\u4ee4\u4ece\u540c\u4e00\u4e2a\u76ee\u5f55\u4e2d\u7684\u591a\u4e2a\u6587\u4ef6\u521b\u5efaConfigMap\u3002</p> <p>\u6bd4\u5982\u6709\u4e00\u4e2aconf\u6587\u4ef6\u5939\uff0c\u91cc\u9762\u5305\u542b\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>$ cat conf/game.properties\nenemies=aliens\nlives=3\nenemies.cheat=true\nenemies.cheat.level=noGoodRotten\nsecret.code.passphrase=UUDDLRLRBABAS\nsecret.code.allowed=true\nsecret.code.lives=30\n$ cat conf/ui.properties\ncolor.good=purple\ncolor.bad=yellow\nallow.textmode=true\nhow.nice.to.look=fairlyNice\n</code></pre> <p>ConfigMap\u4e5f\u662f\u6309Namespace\u9694\u79bb\u7684\uff0c\u4e0d\u540c\u7684Namespace\u4e4b\u95f4ConfigMap\u7684\u540d\u79f0\u53ef\u4ee5\u76f8\u540c\uff0c\u4f46\u662f\u4e0d\u80fd\u8de8Namespace\u8fdb\u884c\u8bbf\u95ee\u3002 \u6240\u4ee5\u521b\u5efaConfigMap\uff0c\u53ef\u4ee5\u4f7f\u7528-n\u6307\u5b9a\u8d44\u6e90\u6240\u5728\u7684Namespace\uff08\u547d\u540d\u7a7a\u95f4\uff09\uff0c\u9ed8\u8ba4\u521b\u5efa\u5728default\u547d\u540d\u7a7a\u95f4\u4e0b\u3002</p> <p>\u57fa\u4e8e\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u521b\u5efaConfigMap\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>$ kubectl create configmap game-config --from-file=conf\nconfigmap/game-config created\n\n$ kubectl get cm\nNAME               DATA   AGE\ngame-config        2      &lt;invalid&gt;\n</code></pre> <p>\u7531\u4e8e\u8be5ConfigMap\u662f\u76f4\u63a5\u57fa\u4e8e\u76ee\u5f55\u521b\u5efa\u7684\uff0c\u6ca1\u6709\u6307\u5b9aConfigMap\u4e2d\u7684Key\u540d\uff0c\u56e0\u6b64\u9ed8\u8ba4\u662f\u6309\u7167\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u540d\u4f5c\u4e3aConfigMap\u6570\u636e\u4e2d\u7684Key\u540d\uff0c\u67e5\u770b\u5f53\u524d\u521b\u5efa\u7684ConfigMap\uff1a <pre><code># \u67e5\u770b\u5f53\u524d\u521b\u5efa\u7684ConfigMap\n$ kubectl get cm game-config -o yaml\napiVersion: v1\ndata:\n  game.properties: |\nenemies=aliens\n    lives=3\nenemies.cheat=true\nenemies.cheat.level=noGoodRotten\n    secret.code.passphrase=UUDDLRLRBABAS\n    secret.code.allowed=true\nsecret.code.lives=30\nui.properties: |\ncolor.good=purple\n    color.bad=yellow\n    allow.textmode=true\nhow.nice.to.look=fairlyNice\nkind: ConfigMap\n</code></pre></p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#22-\u57fa\u4e8e\u6587\u4ef6\u521b\u5efaconfigmap","title":"2.2 \u57fa\u4e8e\u6587\u4ef6\u521b\u5efaConfigMap","text":"<p>\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u5927\u90e8\u5206\u90fd\u662f\u57fa\u4e8e\u5355\u4e2a\u6587\u4ef6\u521b\u5efaConfigMap\u7684\uff0c\u7136\u540e\u6302\u8f7d\u81f3\u67d0\u4e2a\u8d44\u6e90\u6587\u4ef6\u4f9b\u5176Pod\u4f7f\u7528\u3002</p> <p>\u4f8b\u5982\u6709\u4e00\u4e2agame.properties\u6587\u4ef6\uff0c\u53ef\u4ee5\u57fa\u4e8e\u6b64\u6587\u4ef6\u4f7f\u7528<code>kubectl create cm</code>\u521b\u5efaConfigMap\uff1a</p> <pre><code>$ kubectl create configmap game-config-2 --from-file=conf/game.properties\nconfigmap/game-config-2 created\n\n$ kubectl get cm\nNAME               DATA   AGE\ngame-config-2      1      &lt;invalid&gt;\n</code></pre> <p>\u7531\u4e8e\u6ca1\u6709\u6307\u5b9aConfigMap\u7684Key\uff0c\u56e0\u6b64\u4f9d\u65e7\u4f7f\u7528\u6587\u4ef6\u540d\u4f5c\u4e3aKey\uff0c\u67e5\u770b\u5f53\u524d\u7684ConfigMap\uff1a</p> <pre><code>$ kubectl get cm game-config-2 -o yaml\napiVersion: v1\ndata:\n  game.properties: |\nenemies=aliens\n    lives=3\nenemies.cheat=true\nenemies.cheat.level=noGoodRotten\n    secret.code.passphrase=UUDDLRLRBABAS\n    secret.code.allowed=true\nsecret.code.lives=30\nkind: ConfigMap\n</code></pre> <p>\u5982\u679c\u9700\u8981\u6307\u5b9aConfigMap\u7684Key\u540d\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u683c\u5f0f\u8fdb\u884c\u521b\u5efa\uff1a</p> <pre><code>$ kubectl create configmap game-config-3 --from-file=self-key=conf/game.properties\nconfigmap/game-config-3 created\n\n$ kubectl get cm\nNAME               DATA   AGE\ngame-config-3      1      24s\nkube-root-ca.crt   1      143d\n\n$ kubectl get cm game-config-3 -o yaml\napiVersion: v1\ndata:\n  self-key: |\nenemies=aliens\n    lives=3\nenemies.cheat=true\nenemies.cheat.level=noGoodRotten\n    secret.code.passphrase=UUDDLRLRBABAS\n    secret.code.allowed=true\nsecret.code.lives=30\nkind: ConfigMap\n</code></pre> <p>\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528--from-file\u591a\u6b21\u4f20\u5165\u53c2\u6570\u4ee5\u4ece\u591a\u4e2a\u6570\u636e\u6e90\u521b\u5efaConfigMap\uff0c\u6b64\u65b9\u5f0f\u548c\u57fa\u4e8e\u6587\u4ef6\u5939\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u53ef\u4ee5\u5355\u72ec\u8bbe\u7f6eConfigMap\u7684Key\u540d\uff1a</p> <pre><code>$ kubectl create configmap game-config-4 --from-file=conf/game.properties --from-file=conf/ui.properties\nconfigmap/game-config-4 created\n\n$ kubectl get cm\nNAME               DATA   AGE\ngame-config-4      2      &lt;invalid&gt;\nkube-root-ca.crt   1      143d\n\n# \u67e5\u770b\u5f53\u524d\u7684ConfigMap\uff1a\n$ kubectl get cm game-config-4 -o yaml\napiVersion: v1\ndata:\n  game.properties: |\nenemies=aliens\n    lives=3\nenemies.cheat=true\nenemies.cheat.level=noGoodRotten\n    secret.code.passphrase=UUDDLRLRBABAS\n    secret.code.allowed=true\nsecret.code.lives=30\nui.properties: |\ncolor.good=purple\n    color.bad=yellow\n    allow.textmode=true\nhow.nice.to.look=fairlyNice\nkind: ConfigMap\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#23-\u57fa\u4e8eenv\u6587\u4ef6\u521b\u5efaconfigmap","title":"2.3 \u57fa\u4e8eENV\u6587\u4ef6\u521b\u5efaConfigMap","text":"<p>\u5047\u5982\u6709\u4e00\u4e2a\u6587\u4ef6game-env-file.properties\uff0c\u91cc\u9762\u5b58\u50a8\u7684\u662fkey=value\u5f62 \u5f0f\u7684\u6570\u636e\uff0c\u6b64\u7c7b\u6587\u4ef6\u53ef\u4ee5\u5f53\u4f5c\u67d0\u4e2a\u5e94\u7528\u7684\u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff0c \u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528<code>--from-env-file</code>\u4eceENV\u6587\u4ef6\u521b\u5efaConfigMap\uff1a <pre><code>$ cat conf/game-env-file.properties\nenemies=aliens\nlives=3\nallowed=\"true\"\n# \u521b\u5efaConfigMap\uff1a\n$ kubectl create cm game-config-env-file --from-env-file=conf/game-env-file.properties\nconfigmap/game-config-env-file created\n\n# \u67e5\u770b\u5f53\u524d\u7684ConfigMap\uff0c\u6ce8\u610f\u6b64\u65f6ConfigMap\u7684data\u5185\u5bb9\u5df2\u7ecf\u53d8\u6210\u4e86key\u5192 \u53f7\uff08:\uff09\u7684\u5f62\u5f0f\uff0c\u800c\u4e0d\u662f\u4e4b\u524d\u548c\u6587\u4ef6\u5185\u5bb9\u4e00\u81f4\u7684\u6570\u636e\uff1a\n$ kubectl get cm/game-config-env-file -o yaml\napiVersion: v1\ndata:\n  allowed: '\"true\"'\niiienemies: aliens\n  lives: \"3\"\nkind: ConfigMap\nmetadata:\n  name: game-config-env-file\n  namespace: default\n</code></pre></p> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u4f7f\u7528--from-env-file\u591a\u6b21\u4f20\u9012\u53c2\u6570\u4ee5\u4ece\u591a\u4e2a\u6570\u636e\u6e90\u521b\u5efaConfigMap\uff0c\u4ec5\u6700\u540e\u4e00\u4e2aENV\u751f\u6548\uff081.23\u4ee5\u4e0a\u7248\u672c\u652f\u6301\u591a\u4e2a--from-env-file\u53c2\u6570\uff09\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#24-\u4ecekey-value\u5b57\u7b26\u4e32\u521b\u5efa","title":"2.4 \u4ecekey-value\u5b57\u7b26\u4e32\u521b\u5efa","text":"<p>\u6709\u65f6\u5019\u914d\u7f6e\u5e76\u4e0d\u662f\u5f88\u591a\uff0c\u53ea\u6709\u51e0\u4e2akey=value\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>kubectl create configmap</code>\u4e0e<code>--from-literal</code>\u53c2\u6570\u6765\u5b9a\u4e49\u547d\u4ee4\u884c\u7684\u5b57\u7b26\u503c\uff0c \u6bd4\u5982\u4ee5special.how=very\u548cspecial.type=charm\u8fdb\u884c\u521b\u5efa\uff1a</p> <pre><code>$ kubectl create configmap special-config --from-literal=special.how=very\nconfigmap \"special-config\" created\n\n$ kubectl get configmap special-config -o go-template='{{.data}}'\nmap[special.how:very]\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#25-configmap\u5b9e\u8df5","title":"2.5 ConfigMap\u5b9e\u8df5","text":""},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#1\u4f7f\u7528valuefrom\u5b9a\u4e49\u5bb9\u5668\u73af\u5883\u53d8\u91cf","title":"1.\u4f7f\u7528valueFrom\u5b9a\u4e49\u5bb9\u5668\u73af\u5883\u53d8\u91cf","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: env-valuefrom\nname: env-valuefrom\nnamespace: default\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: env-valuefrom\nstrategy:\nrollingUpdate:\nmaxSurge: 1\nmaxUnavailable: 0\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\napp: env-valuefrom\nspec:\ncontainers:\n- command:\n- sh\n- -c\n- env\nenv:\n- name: TZ\nvalue: Asia/Shanghai\n- name: LANG\nvalue: C.UTF-8\n- name: SPECIAL_LEVEL_KEY\nvalueFrom:\nconfigMapKeyRef:\nkey: special.how\nname: special-config\nimage: busybox\nimagePullPolicy: IfNotPresent\nname: env-valuefrom\nresources:\nlimits:\ncpu: 100m\nmemory: 100Mi\nrequests:\ncpu: 10m\nmemory: 10Mi\ndnsPolicy: ClusterFirst\nrestartPolicy: Never\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#2\u4f7f\u7528envfrom\u5b9a\u4e49\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf","title":"2.\u4f7f\u7528envFrom\u5b9a\u4e49\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf","text":"<p>\u4e0a\u8ff0\u6f14\u793a\u7684valueFrom\u901a\u5e38\u7528\u4e8e\u4f7f\u7528ConfigMap\u7684\u5355\u4e2aKey\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c \u4f46\u5b9e\u9645\u4f7f\u7528\u65f6\u66f4\u5e38\u7528\u7684\u662f\u628aConfigMap\u91cc\u9762\u6240\u6709\u7684\u6570\u636e\u90fd\u4f5c\u4e3a\u73af\u5883\u53d8\u91cf\uff0c \u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528envFrom\u53c2\u6570\uff0c\u5bf9\u5e94\u7684YAML\u6587\u4ef6\u5982\u4e0b\uff08\u6ce8\u610fenvFrom\u7684\u914d\u7f6e\u4f4d\u7f6e\uff09\uff1a</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: env-valuefrom\nname: env-valuefrom\nnamespace: default\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: env-valuefrom\nstrategy:\nrollingUpdate:\nmaxSurge: 1\nmaxUnavailable: 0\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\napp: env-valuefrom\nspec:\ncontainers:\n- command:\n- sh\n- -c\n- env\nenv:\n- name: TZ\nvalue: Asia/Shanghai\n- name: LANG\nvalue: C.UTF-8\nenvFrom:\n- configMapRef:\nname: game-config-env-file\nprefix: fromCm_\nimage: busybox\nimagePullPolicy: IfNotPresent\nname: env-valuefrom\nresources:\nlimits:\ncpu: 100m\nmemory: 100Mi\nrequests:\ncpu: 10m\nmemory: 10Mi\ndnsPolicy: ClusterFirst\nrestartPolicy: Never\n</code></pre> <p>\u6ce8\u610f</p> <p>\u4f7f\u7528envFrom\u65f6\uff0c\u73af\u5883\u53d8\u91cf\u7684\u540d\u5b57\u662fConfigMap\u4e2d\u6570\u636e\u7684key\u540d\u3002</p> <p>prefix\u53c2\u6570\u662f\u5c06ConfigMap\u4e2d\u7684key\u6dfb\u52a0\u4e00\u4e2a\u524d\u7f00\uff0c\u6bd4\u5982key\u540d\u662fself-key\uff0c\u52a0\u4e86prefix\u5c31\u662ffromCm_self-key\uff0cprefix\u4e3a\u53ef\u9009\u53c2\u6570\u3002</p> <p>\u53e6\u5916\u9700\u8981\u6ce8\u610f\uff0c\u5f53\u4f7f\u7528ConfigMap\u6216\u8005Secret\u5b9a\u4e49Pod\u53d8\u91cf\u65f6\uff0c\u5982\u679cConfigMap\u548cSecret\u5185\u5bb9\u6709\u53d8\u5316\uff0c\u800cPod\u6ca1\u6709\u91cd\u542f\u7684\u8bdd\uff0cPod\u91cc\u9762\u7684\u53d8\u91cf\u5c31\u4e0d\u4f1a\u66f4\u65b0\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#3\u7528\u4f5c\u547d\u4ee4\u884c\u53c2\u6570","title":"3.\u7528\u4f5c\u547d\u4ee4\u884c\u53c2\u6570","text":"<p>\u5c06 ConfigMap \u7528\u4f5c\u547d\u4ee4\u884c\u53c2\u6570\u65f6\uff0c\u9700\u8981\u5148\u628a ConfigMap \u7684\u6570\u636e\u4fdd\u5b58\u5728\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u7136\u540e\u901a\u8fc7 $(VAR_NAME) \u7684\u65b9\u5f0f\u5f15\u7528\u73af\u5883\u53d8\u91cf.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: dapi-test-pod\nspec:\ncontainers:\n- name: test-container\nimage: busybox\ncommand: [\"/bin/sh\", \"-c\", \"echo $(SPECIAL_LEVEL_KEY) $(SPECIAL_TYPE_KEY)\" ]\nenv:\n- name: SPECIAL_LEVEL_KEY\nvalueFrom:\nconfigMapKeyRef:\nname: special-config\nkey: special.how\n- name: SPECIAL_TYPE_KEY\nvalueFrom:\nconfigMapKeyRef:\nname: special-config\nkey: special.type\nrestartPolicy: Never\n</code></pre> <p>\u5f53 Pod \u7ed3\u675f\u540e\u4f1a\u8f93\u51fa</p> <pre><code>very charm\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#4\u4ee5\u6587\u4ef6\u5f62\u5f0f\u6302\u8f7dconfigmap","title":"4.\u4ee5\u6587\u4ef6\u5f62\u5f0f\u6302\u8f7dConfigMap","text":"<p>\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0cConfigMap\u5b9a\u4e49\u7684\u90fd\u662f\u914d\u7f6e\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u73af\u5883\u53d8\u91cf\uff0c\u56e0\u6b64 \u9700\u8981\u5c06ConfigMap\u4e2d\u7684\u6587\u4ef6\uff08\u4e00\u822c\u4e3a--from-file\u521b\u5efa\uff09\u6302\u8f7d\u5230Pod\u4e2d\uff0c\u7136\u540ePod\u4e2d\u7684\u5bb9\u5668\u5c31\u53ef\u4ee5\u5f15\u7528\uff0c\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7Pod\u7684volume\u5b57\u6bb5\u8fdb\u884c\u6302\u8f7d\u3002</p> <p>\u4f8b\u5982\u5c06\u540d\u79f0\u4e3aspecial-config\u7684ConfigMap\u6302\u8f7d\u5230\u5bb9\u5668\u7684/etc/config/\u76ee\u5f55\u4e0b\uff1a</p> <p>key\u4e3a\u6587\u4ef6\u540d\uff0cvalue \u4e3a\u5185\u5bb9</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: dapi-test-pod\nspec:\ncontainers:\n- name: test-container\nimage: busybox\ncommand: [ \"/bin/sh\", \"-c\", \"ls /etc/config/\" ]\nvolumeMounts:\n- name: config-volume\nmountPath: /etc/config\nvolumes:\n- name: config-volume\nconfigMap:\n# Provide the name of the ConfigMap containing the files you want\n# to add to the container\nname: special-config\nrestartPolicy: Never\n</code></pre> <p>\u4f7f\u7528kubectl\u521b\u5efa\u8be5Pod\u540e\uff0c\u4f1a\u6267\u884cPod\u8bbe\u7f6e\u7684command\u547d\u4ee4\uff0c\u5373\u6267\u884cls /etc/config/\uff1a <pre><code>special.level\nspecial.type\n</code></pre></p> <p>\u6ce8\u610f</p> <p>/etc/config/\u76ee\u5f55\u4f1a\u88ab\u8986\u76d6\uff0c\u6302\u8f7d\u6587\u4ef6\u65f6\u9700\u8981\u6ce8\u610f\u8fd9\u4e00\u70b9\uff0c\u540e\u9762\u7684\u7ae0\u8282\u4f1a \u8bb2\u89e3\u5982\u4f55\u4e0d\u8986\u76d6\u6302\u8f7dConfigMap\u548cSecret\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#5\u81ea\u5b9a\u4e49\u6587\u4ef6\u540d\u6302\u8f7dconfigmap","title":"5.\u81ea\u5b9a\u4e49\u6587\u4ef6\u540d\u6302\u8f7dConfigMap","text":"<p>\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u66f4\u6539\u6302\u8f7d\u7684\u6587\u4ef6\u540d\uff0c\u53ef\u4ee5\u4f7f\u7528path\u5b57\u6bb5\u6307\u5b9aConfigMap \u6302\u8f7d\u7684\u6587\u4ef6\u540d\uff0c \u6bd4\u5982\u5c06special.level\u6302\u8f7d\u5230/etc/config\uff0c\u5e76\u6307\u5b9a\u540d\u79f0\u4e3akeys\uff1a</p> <p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: dapi-test-pod\nspec:\ncontainers:\n- name: test-container\nimage: busybox\ncommand: [ \"/bin/sh\",\"-c\",\"cat /etc/config/keys\" ]\nvolumeMounts:\n- name: config-volume\nmountPath: /etc/config\nvolumes:\n- name: config-volume\nconfigMap:\nname: special-config\nitems:\n- key: special.how\npath: keys\nrestartPolicy: Never\n</code></pre> \u6b64\u65f6\u542f\u52a8Pod\u65f6\u4f1a\u6253\u5370\uff1a<code>very</code>\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#6\u6307\u5b9a\u6302\u8f7d\u7684\u6587\u4ef6\u6743\u9650","title":"6.\u6307\u5b9a\u6302\u8f7d\u7684\u6587\u4ef6\u6743\u9650","text":"<p>ConfigMap\u5728\u6302\u8f7d\u4f7f\u7528\u65f6\u53ef\u4ee5\u66f4\u6539\u6587\u4ef6\u7684\u6743\u9650\uff08\u9ed8\u8ba4\u662f0644\uff09\uff0c\u6bd4\u5982\u5c06\u4e0a\u8ff0\u7684\u6587\u4ef6\u6302\u8f7d\u6743\u9650\u81ea\u5b9a\u4e49\u4e3a0666\uff08\u5bf9\u5e94Linux\u7684\u6587\u4ef6\u6743\u9650\u4e3arw-rw-rw-\uff09\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: dapi-test-pod\nspec:\ncontainers:\n- name: test-container\nimage: busybox\ncommand: [ \"/bin/sh\",\"-c\",\"ls -l /etc/config/..data/\" ]\nvolumeMounts:\n- name: config-volume\nmountPath: /etc/config\nvolumes:\n- name: config-volume\nconfigMap:\nname: special-config\nitems:\n- key: special.how\npath: keys\ndefaultMode: 0666\nrestartPolicy: Never\n</code></pre> <p>\u4e0a\u6587\u4f7f\u7528.configMap.defaultMode\u5b57\u6bb5\u81ea\u5b9a\u4e49\u6587\u4ef6\u6743\u9650\uff0c\u8be5\u6743\u9650\u5bf9.configMap.items\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u5747\u751f\u6548\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528items[].mode\u5b57\u6bb5\u5355\u72ec \u8bbe\u7f6e\u67d0\u4e2a\u6587\u4ef6\u7684\u6743\u9650\uff0c\u7528\u4e8e\u4e0d\u540c\u6587\u4ef6\u7684\u4e0d\u540c\u6743\u9650\u6302\u8f7d\uff0c\u6bd4\u5982\uff08\u90e8\u5206\u4ee3\u7801\uff09\uff1a <pre><code>volumes:\n- name: config-volume\nconfigMap:\nname: special-config\nitems:\n- key: special.how\npath: keys\nmode: 328\n- key: special.level\npath: level\nmode: 0644\ndefaultMode: 0666\n</code></pre></p> <p>\u6ce8\u610f</p> <p>mode\u5b57\u6bb5\u4f18\u5148\u7ea7\u8f83\u9ad8\uff0c\u4f1a\u8986\u76d6\u5168\u5c40\u7684defaultMode\u3002</p> <p>\u53e6\u5916\u6ce8\u610f\u6743\u9650\u7684\u5199\u6cd5\uff0c \u5728Linux\u4e2d\u7684\u6587\u4ef6\u6743\u9650\u4e3a\u516b\u8fdb\u5236\uff0c\u6bd4\u5982\u4e0a\u8ff0\u76840644\u4e3a\u516b\u8fdb\u5236\u5199\u6cd5\uff0c\u5bf9\u5e94Linux\u7684\u6587\u4ef6\u6743\u9650\u5c31\u662f644\uff08rw-r--r--\uff09\uff0c328\u4e3a\u5341\u8fdb\u5236\u5199\u6cd5\uff0c\u6362\u7b97\u4e3a\u516b\u8fdb\u5236\u4e3a510\uff0c\u90a3\u4e48\u5bf9\u5e94Linux\u7684\u6587\u4ef6\u6743\u9650\u5c31\u662f510\uff08r-x--x---\uff09\u3002 \u5176\u4e2d\u516b\u8fdb\u5236\u7684\u53ef\u914d\u7f6e\u8303\u56f4\u4e3a0000 ~ 0777\uff0c\u5341\u8fdb\u5236\u53ef\u914d\u7f6e\u8303\u56f4\u4e3a0 ~ 511\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#7configmap\u9650\u5236","title":"7.ConfigMap\u9650\u5236","text":"<p>ConfigMap\u5728\u4f7f\u7528\u65f6\u6709\u5f88\u591a\u5c40\u9650\u6027\uff0c\u5982\u679c\u6ca1\u6709\u6b63\u786e\u4f7f\u7528ConfigMap\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4Pod\u4e0d\u80fd\u6b63\u5e38\u64cd\u4f5c\u3002\u76ee\u524d\u5177\u6709\u7684\u9650\u5236\u5982\u4e0b\uff1a</p> <ol> <li>\u5fc5\u987b\u5148\u521b\u5efaConfigMap\u624d\u80fd\u5728Pod\u4e2d\u5f15\u7528\u5b83\uff0c\u5982\u679cPod\u5f15\u7528\u7684ConfigMap\u4e0d\u5b58\u5728\uff0cPod\u5c06\u65e0\u6cd5\u542f\u52a8\uff0c\u4e00\u76f4\u5904\u4e8ePending\u72b6\u6001\uff0c\u53ef\u4ee5\u901a\u8fc7describe\u547d\u4ee4\u67e5\u770b\u3002</li> <li>Pod\u5f15\u7528\u7684\u952e\u5fc5\u987b\u5b58\u5728\u4e8eConfigMap\u4e2d\uff0c\u5426\u5219Pod\u65e0\u6cd5\u542f\u52a8\uff0c\u4e00\u76f4\u5904\u4e8eContainerCreating\u72b6\u6001\uff0c\u53ef\u4ee5\u901a\u8fc7describe\u547d\u4ee4\u67e5\u770b\u3002</li> <li>ConfigMap\u548c\u5f15\u7528\u5b83\u7684Pod\u9700\u8981\u5728\u540c\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u3002 </li> <li>\u4f7f\u7528envFrom\u914d\u7f6e\u5bb9\u5668\u73af\u5883\u53d8\u91cf\u65f6\uff0c\u9ed8\u8ba4\u4f1a\u8df3\u8fc7\u88ab\u89c6\u4e3a\u65e0\u6548\u7684\u952e\uff0c\u4f46\u662f\u4e0d\u5f71\u54cdPod\u542f\u52a8\uff0c\u65e0\u6548\u7684\u53d8\u91cf\u4f1a\u8bb0\u5f55\u5728\u4e8b\u4ef6\u65e5\u5fd7\u4e2d\uff0c\u5177\u4f53\u5982\u4e0b\uff1a     <pre><code># \u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\n$ kubectl get events\n</code></pre></li> </ol> <p>\u53c2\u8003\u6587\u6863</p> <p>https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#8\u4f7f\u7528subpath\u5c06configmap\u4f5c\u4e3a\u5355\u72ec\u7684\u6587\u4ef6\u6302\u8f7d\u5230\u76ee\u5f55","title":"8.\u4f7f\u7528subpath\u5c06ConfigMap\u4f5c\u4e3a\u5355\u72ec\u7684\u6587\u4ef6\u6302\u8f7d\u5230\u76ee\u5f55","text":"<p>\u5728\u4e00\u822c\u60c5\u51b5\u4e0bconfigmap\u6302\u8f7d\u6587\u4ef6\u65f6\uff0c\u4f1a\u5148\u8986\u76d6\u6389\u6302\u8f7d\u76ee\u5f55\uff0c\u7136\u540e\u518d\u5c06congfigmap\u4e2d\u7684\u5185\u5bb9\u4f5c\u4e3a\u6587\u4ef6\u6302\u8f7d\u8fdb\u884c\u3002</p> <p>\u5982\u679c\u60f3\u4e0d\u5bf9\u539f\u6765\u7684\u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6\u9020\u6210\u8986\u76d6\uff0c\u53ea\u662f\u5c06 configmap\u4e2d\u7684\u6bcf\u4e2akey\uff0c\u6309\u7167\u6587\u4ef6\u7684\u65b9\u5f0f\u6302\u8f7d\u5230\u76ee\u5f55\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528subpath\u53c2\u6570\u3002</p> <p>SubPath\u4e3b\u8981\u7528\u4e8e\u5c06\u540c\u4e00\u4e2aVolume\u7684\u6570\u636e\u6302\u8f7d\u5230\u4e0d\u540c\u7684\u8def\u5f84\uff0c\u540c\u65f6\u4e5f\u80fd\u7528 subPath\u7684\u529f\u80fd\u89e3\u51b3\u6302\u8f7d\u8986\u76d6\u7684\u95ee\u9898\u3002 </p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: dapi-test-pod\nspec:\ncontainers:\n- name: test-container\nimage: nginx\ncommand: [\"/bin/sh\",\"-c\",\"sleep 36000\"]\nvolumeMounts:\n- name: config-volume\nmountPath: /etc/nginx/special.how\nsubPath: special.how\nvolumes:\n- name: config-volume\nconfigMap:\nname: special-config\nitems:\n- key: special.how\npath: special.how\nrestartPolicy: Never\n</code></pre> <pre><code>root@dapi-test-pod:/# ls /etc/nginx/\nconf.d    fastcgi_params    koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params    special.how  uwsgi_params  win-utf\nroot@dapi-test-pod:/# cat /etc/nginx/special.how\nvery\nroot@dapi-test-pod:/#\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#3-\u52a0\u5bc6\u6570\u636e\u7ba1\u7406secret","title":"3. \u52a0\u5bc6\u6570\u636e\u7ba1\u7406Secret","text":"<p>\u4e0a\u4e00\u8282\u8bb2\u89e3\u7684ConfigMap\u4e3b\u8981\u7528\u4e8e\u975e\u5b89\u5168\u7684\u6570\u636e\uff0c\u4e0e\u5176\u5bf9\u5e94\u7684\u662fSecret\u5bf9 \u8c61\u7c7b\u578b\uff0c\u7528\u6765\u4fdd\u5b58\u654f\u611f\u4fe1\u606f\uff0c\u4f8b\u5982\u5bc6\u7801\u3001\u4ee4\u724c\u548cSSH Key\uff0c\u5c06\u8fd9\u4e9b\u4fe1\u606f\u653e\u5728 Secret\u4e2d\u6bd4\u8f83\u5b89\u5168\u548c\u7075\u6d3b\u3002\u7528\u6237\u53ef\u4ee5\u521b\u5efaSecret\u5e76\u4e14\u5f15\u7528\u5230Pod\u4e2d\uff0c\u6bd4\u5982\u4f7f\u7528 Secret\u521d\u59cb\u5316Redis\u3001MySQL\u5bc6\u7801\u7b49\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#31-secret-\u4e0e-configmap-\u5bf9\u6bd4","title":"3.1 Secret \u4e0e ConfigMap \u5bf9\u6bd4","text":"<p>\u76f8\u540c\u70b9\uff1a</p> <ol> <li>key/value \u7684\u5f62\u5f0f</li> <li>\u5c5e\u4e8e\u67d0\u4e2a\u7279\u5b9a\u7684 namespace</li> <li>\u53ef\u4ee5\u5bfc\u51fa\u5230\u73af\u5883\u53d8\u91cf</li> <li>\u53ef\u4ee5\u901a\u8fc7\u76ee\u5f55 / \u6587\u4ef6\u5f62\u5f0f\u6302\u8f7d (\u652f\u6301\u6302\u8f7d\u6240\u6709 key \u548c\u90e8\u5206 key)</li> </ol> <p>\u4e0d\u540c\u70b9\uff1a</p> <ol> <li>Secret \u53ef\u4ee5\u88ab ServerAccount \u5173\u8054 (\u4f7f\u7528)</li> <li>Secret \u53ef\u4ee5\u5b58\u50a8 register \u7684\u9274\u6743\u4fe1\u606f\uff0c\u7528\u5728 ImagePullSecret \u53c2\u6570\u4e2d\uff0c\u7528\u4e8e\u62c9\u53d6\u79c1\u6709\u4ed3\u5e93\u7684\u955c\u50cf</li> <li>Secret \u652f\u6301 Base64 \u52a0\u5bc6</li> <li>Secret \u5206\u4e3a Opaque\uff0ckubernetes.io/Service Account\uff0ckubernetes.io/dockerconfigjson \u4e09\u79cd\u7c7b\u578b, Configmap \u4e0d\u533a\u5206\u7c7b\u578b</li> <li>Secret \u6587\u4ef6\u5b58\u50a8\u5728 tmpfs \u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0cPod \u5220\u9664\u540e Secret \u6587\u4ef6\u4e5f\u4f1a\u5bf9\u5e94\u7684\u5220\u9664\u3002</li> </ol>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#32-\u4ee5\u6587\u4ef6\u5f62\u5f0f\u6302\u8f7dsecret","title":"3.2 \u4ee5\u6587\u4ef6\u5f62\u5f0f\u6302\u8f7dSecret","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: mypod\nspec:\ncontainers:\n- name: mypod\nimage: redis\nvolumeMounts:\n- name: foo\nmountPath: \"/etc/foo\"\nreadOnly: true\nvolumes:\n- name: foo\nsecret: # configMap\u6362\u6210secret\nsecretName: mysecret # configMap\u7c7b\u578b\u4e3aname\n</code></pre> <p>\u7528\u5230\u7684\u6bcf\u4e2aSecret\u90fd\u9700\u8981\u5728spec.volumes\u4e2d\u6307\u660e\uff0c\u5982\u679cPod\u4e2d\u6709\u591a\u4e2a\u5bb9 \u5668\uff0c\u6bcf\u4e2a\u5bb9\u5668\u90fd\u9700\u8981\u81ea\u5df1\u7684volumeMounts\u914d\u7f6e\u5757\uff0c\u7528\u4ee5\u6302\u8f7dvolume\u81f3\u672c\u5730\u67d0 \u4e2a\u76ee\u5f55\uff0c\u4f46\u662f\u6bcf\u4e2aSecret\u53ea\u9700\u8981\u4e00\u4e2aspec.volumes\uff08\u6ce8\u610fvolumes\u7684\u4f4d\u7f6e\uff09\uff0c \u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u5e94\u7528\u573a\u666f\u5c06\u591a\u4e2a\u6587\u4ef6\u6253\u5305\u5230\u4e00\u4e2aSecret\u4e2d\uff0c\u6216\u8005\u4f7f\u7528\u591a\u4e2a Secret\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#33-\u81ea\u5b9a\u4e49\u6587\u4ef6\u540d\u6302\u8f7d","title":"3.3 \u81ea\u5b9a\u4e49\u6587\u4ef6\u540d\u6302\u8f7d","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: mypod\nspec:\ncontainers:\n- name: mypod\nimage: redis\nvolumeMounts:\n- name: foo\nmountPath: \"/etc/foo\"\nreadOnly: true\nvolumes:\n- name: foo\nsecret:\nsecretName: mysecret\nitems:\n- key: username\npath: my-group/my-username\n</code></pre>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#34-secret\u4f5c\u4e3a\u73af\u5883\u53d8\u91cf","title":"3.4 Secret\u4f5c\u4e3a\u73af\u5883\u53d8\u91cf","text":"<p>Secret\u540c\u6837\u53ef\u4ee5\u4f5c\u4e3a\u73af\u5883\u53d8\u91cf\u4f7f\u7528\uff0c\u548cConfigMap\u7684\u914d\u7f6e\u65b9\u5f0f\u4e00\u81f4\uff0c\u53ea\u9700\u8981\u66f4\u6539\u5bf9\u5e94\u7684\u5b57\u6bb5\u540d\u5373\u53ef\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <p>1\uff09\u521b\u5efa\u4e00\u4e2aSecret\u6216\u8005\u4f7f\u7528\u4e00\u4e2a\u5df2\u5b58\u5728\u7684Secret\uff0c\u591a\u4e2aPod\u53ef\u4ee5\u5f15\u7528\u540c \u4e00\u4e2aSecret\u3002 2) \u4e3a\u6bcf\u4e2a\u5bb9\u5668\u6dfb\u52a0\u5bf9\u5e94\u7684Secret env.valueFrom.secretKeyRef\u3002</p> <p>Key\u73af\u5883\u53d8\u91cf\u6bd4\u5982\uff0c\u5b9a\u4e49SECRET_USERNAME\u548cSECRET_PASSWORD\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u5176\u503c\u6765\u81ea\u4e8e\u540d\u5b57\u4e3amysecret\u7684Secret\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: secret-env-pod\nspec:\ncontainers:\n- name: mycontainer\nimage: redis\nenv:\n- name: SECRET_USERNAME\nvalueFrom:\nsecretKeyRef:\nname: mysecret\nkey: username\n- name: SECRET_PASSWORD\nvalueFrom:\nsecretKeyRef:\nname: mysecret\nkey: password\nrestartPolicy: Never\n</code></pre> <p>\u6ce8\u610f</p> <p>envFrom\u7684\u7528\u6cd5\u548cConfigMap\u4e00\u81f4\uff0c\u5c06configMapRef\u6539\u4e3asecretRef\u5373\u53ef\uff0c\u5728\u6b64\u4e0d\u518d\u6f14\u793a\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#35-secret\u6587\u4ef6\u6743\u9650","title":"3.5 Secret\u6587\u4ef6\u6743\u9650","text":"<p>\u6587\u4ef6\u6743\u9650\u548cConfigMap\u65e0\u533a\u522b\uff0c\u5728\u6b64\u4e0d\u518d\u6f14\u793a\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#36-\u5e38\u7528\u7684secret\u7c7b\u578b","title":"3.6 \u5e38\u7528\u7684Secret\u7c7b\u578b","text":"<p>\u4e0a\u8ff0\u521b\u5efa\u7684Secret\u5747\u4e3a\u901a\u7528\u578bSecret\uff0c\u5373\u901a\u8fc7\u547d\u4ee4\u884ckubectl create secret generic\u521b\u5efa\u7684\uff0c\u521b\u5efa\u540e\u7684\u7c7b\u578b\u4e3aOpaque\uff0c\u53ef\u4ee5\u901a\u8fc7get\u547d\u4ee4\u67e5\u770b\u3002</p> <p>\u4f46\u662f\u548cConfigMap\u4e0d\u540c\u7684\u662fSecret\u6709\u5f88\u591a\u79cd\u7c7b\u578b\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>Opaque\uff1a\u901a\u7528\u578bSecret\uff0c\u9ed8\u8ba4\u7c7b\u578b\u3002</li> <li>kubernetes.io/service-account-token\uff1a\u4f5c\u7528\u4e8eServiceAccount,\u5305\u542b\u4e00\u4e2a\u4ee4\u724c\uff0c\u7528\u4e8e\u6807\u8bc6API\u670d\u52a1\u8d26\u6237\u3002</li> <li> <p>kubernetes.io/dockercfg: Kubernetes\u4e0b\u8f7d\u79c1\u6709\u4ed3\u5e93\u955c\u50cf\u4f7f\u7528\u7684Secret\uff0c\u548c\u5bbf\u4e3b\u673a\u7684~/.dockercfg\u4e00\u81f4,\u65b0\u7248\u672c\u7684Kubernetes(1.8+)\u4f7f\u7528kubernetes.io/dockerconfigjson\u66ff\u4ee3kubernetes.io/dockercfg\u3002</p> </li> <li> <p>kubernetes.io/dockerconfigjson \uff1a \u4e0b\u8f7d\u79c1\u6709\u4ed3\u5e93\u955c\u50cf\u4f7f\u7528\u7684Secret\uff0c\u548c\u5bbf\u4e3b\u673a\u7684/root/.docker/config.json\u4e00\u81f4\uff0c\u5bbf\u4e3b\u673a\u767b\u5f55 \u540e\u5373\u53ef\u4ea7\u751f\u8be5\u6587\u4ef6\u3002</p> </li> <li>kubernetes.io/basic-auth\uff1a\u7528\u4e8e\u4f7f\u7528\u57fa\u672c\u8ba4\u8bc1\uff08\u8d26\u53f7\u3001\u5bc6\u7801\uff09\u7684Secret\uff0c\u53ef\u4ee5\u4f7f\u7528Opaque\u53d6\u4ee3\u3002</li> <li>kubernetes.io/ssh-auth\uff1a\u7528\u4e8e\u5b58\u50a8SSH\u5bc6\u94a5\u7684Secret\u3002</li> <li>kubernetes.io/tls\uff1a\u7528\u4e8e\u5b58\u50a8HTTPS\u57df\u540d\u8bc1\u4e66\u6587\u4ef6\u7684Secret\uff0c\u53ef\u4ee5\u88abIngress\u4f7f\u7528\u3002</li> <li>bootstrap.kubernetes.io/token\uff1a\u4e00\u79cd\u7b80\u5355\u7684bearer token\uff0c\u7528\u4e8e\u521b\u5efa\u65b0\u96c6\u7fa4\u6216\u5c06\u65b0\u8282\u70b9\u6dfb\u52a0\u5230\u73b0\u6709\u96c6\u7fa4\uff0c\u5728\u96c6\u7fa4\u5b89\u88c5\u65f6\u53ef\u7528\u4e8e\u81ea\u52a8 \u9881\u53d1\u96c6\u7fa4\u7684\u8bc1\u4e66\u3002</li> </ul> <p>Secret\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u7528\u5f97\u6700\u591a\u7684\u662f\u901a\u7528\u578bOpaque\u3001 \u955c\u50cf\u4ed3\u5e93Secret\u548cHTTPS\u8bc1\u4e66\u7684Secret\uff0c\u4e0a\u8ff0\u4ecb\u7ecd\u7684\u5747\u4e3a\u901a\u7528\u578b\u7684Opaque\uff0c \u63a5\u4e0b\u6765\u8bb2\u89e3\u4e00\u4e0b\u5176\u4ed6\u7c7b\u578b\u7684Secret\u5982\u4f55\u4f7f\u7528\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#37-docker\u955c\u50cf\u4ed3\u5e93secret","title":"3.7 Docker\u955c\u50cf\u4ed3\u5e93Secret","text":"\u53c2\u8003\u6587\u732e <p>https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/pull-image-private-registry/</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#38-https\u8bc1\u4e66\u7c7b\u578b\u7684secret","title":"3.8 HTTPS\u8bc1\u4e66\u7c7b\u578b\u7684Secret","text":"<p>\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5e94\u7528\u670d\u52a1\u4e00\u822c\u90fd\u662f\u4f7f\u7528HTTPS\u534f\u8bae\u53d1\u5e03\u7684\uff0c\u53ef\u4ee5\u8d77\u5230\u52a0\u5bc6\u901a \u4fe1\u7684\u4f5c\u7528\u3002\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u57df\u540d\u8bc1\u4e66\u4e00\u822c\u5728\u96c6\u7fa4\u5165\u53e3\u7684\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\u7ba1 \u7406\uff0c\u6bd4\u5982Nginx\uff0c\u800c\u5728Kubernetes\u4e2d\uff0c\u4e00\u822c\u670d\u52a1\u90fd\u662f\u901a\u8fc7Ingress\u53d1\u5e03\u7684\uff0c\u6b64 \u65f6\u53ef\u4ee5\u5c06\u57df\u540d\u8bc1\u4e66\u4fdd\u5b58\u5728TLS\u7c7b\u578b\u7684Secret\u4e0a\uff0c\u4e4b\u540eIngress\u5373\u53ef\u7ed1\u5b9a\u8be5\u8bc1\u4e66\u3002 \u9996\u5148\u521b\u5efaHTTPS\u7684\u8bc1\u4e66\u6587\u4ef6\uff0c\u5047\u8bbe\u57df\u540d\u4e3atest.com\uff08\u751f\u4ea7\u73af\u5883\u4e2d\u7684\u8bc1\u4e66\u4e3a \u8d2d\u4e70\u7684\u53d7\u4fe1\u4efb\u7684\u8bc1\u4e66\uff0c\u81ea\u7b7e\u540d\u8bc1\u4e66\u4e0d\u53d7\u6d4f\u89c8\u5668\u4fe1\u4efb\uff09\uff1a</p> <pre><code>$ openssl req -x509 -nodes -days 365 --newkey rsa:2048 -keyout tls.key -out tls.crt =subj \"/CN=test.com\"\n</code></pre> <p>\u4e4b\u540e\u6839\u636e\u751f\u6210\u7684tls.key\u548ctls.crt\u521b\u5efaSecret\uff1a</p> <pre><code>$ kubectl -n default create secret tls nginx-test-tls -- key=tls.key --cert=tls.crt\n</code></pre> <p>\u6700\u540e\u521b\u5efa\u4e00\u4e2aIngress\u5c06\u8bc1\u4e66\u7ed1\u5b9a\u5230\u6307\u5b9a\u7684\u57df\u540d\u4e0a\uff1a <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\nname: nginx-https-test\nannotations:\nkubernetes.io/ingress.class: \"nginx\" # \u4e0d\u540c\u7684controller\uff0cingress.class\u53ef\u80fd\u4e0d\u4e00\u81f4\nspec:\nrules:\n- host: https-test.com\nhttp:\npaths:\n- backend:\nserviceName: nginx-svc\nservicePort: 80\ntls:\n- secretName: nginx-test-tls\n</code></pre></p> <p>\u5c0f\u77e5\u8bc6</p> <p>\u4e00\u4e2aIngress\u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2aTLS\u7c7b\u578b\u7684Secret\uff0c\u540c\u4e00\u4e2aSecret\u4e5f\u53ef\u4ee5\u88ab\u591a\u4e2a Ingress\u4f7f\u7528\u3002</p> <p>\u53c2\u8003\u6587\u6863 <p>Secret</p> <p>https://kubernetes.io/docs/concepts/configuration/secret/</p> </p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#4-configmap\u70ed\u66f4\u65b0\u548c\u683c\u5f0f\u4fee\u590d","title":"4. ConfigMap\u70ed\u66f4\u65b0\u548c\u683c\u5f0f\u4fee\u590d","text":"<p>\u5b9e\u9645\u4f7f\u7528ConfigMap\u548cSecret\u65f6\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u90fd\u662f\u76f4\u63a5\u4f7f\u7528\u6587\u4ef6\u521b\u5efa\uff0c \u4e5f\u5c31\u662f\u4f7f\u7528--from-file=xxx\u7684\u683c\u5f0f\u8fdb\u884c\u521b\u5efa\u3002</p> <p>\u521b\u5efa\u7684ConfigMap\u53ef\u80fd\u56e0\u4e3a\u6362\u884c\u7684\u95ee\u9898\uff0c\u5bfc\u81f4\u4f7f\u7528<code>kubectl edit cm xxx</code>\u65f6\u6392\u7248\u5f88\u4e71\uff0c\u7f16\u8f91\u8d77\u6765\u5f88\u53d7\u5f71\u54cd\u3002</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#41-configmap\u683c\u5f0f\u4fee\u590d","title":"4.1 Configmap\u683c\u5f0f\u4fee\u590d","text":"<p>\u5907\u5fd8configmap\u683c\u5f0f\u5316</p> <pre><code>#kubectl create cm node-local-dns  --from-file Corefile\nkubectl get cm node-local-dns -o json | jq '.data.Corefile' -r\n\n# \u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u5220\u9664\u5c3e\u968f\u7a7a\u683c\nsed -i -E 's/[[:space:]]+$//g' file.txt\n# \u4f7f\u7528\u7a7a\u683c\u66ff\u6362\u5236\u8868\u7b26\nsed -i 's/\\t/    /g' file.txt\n</code></pre> <p>\u53c2\u8003</p> <p>https://stackoverflow.com/questions/51291521/kubernetes-configmap-prints-n-instead-of-a-newline</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#42-configmap\u70ed\u66f4\u65b0","title":"4.2 Configmap\u70ed\u66f4\u65b0","text":"<p>\u53e6\u5916\uff0c\u4f7f\u7528<code>kubectl edit secret xxx</code>\u65f6\uff0c\u7531\u4e8eSecret\u6570\u636e\u4e3a\u52a0\u5bc6\u6570\u636e,\u65e0\u6cd5\u76f4\u63a5\u7f16\u8f91\u3002</p> <p>\u56e0\u6b64\u4e00\u822c\u60c5\u51b5\u4e0b\u90fd\u662f\u4fee\u6539\u6e90\u6587\u4ef6\uff0c\u7136\u540ereplace\u4e4b\u524d\u7684ConfigMap\u6216Secret,\u547d\u4ee4\u5982\u4e0b\uff08Secret\u548cConfigMap\u70ed\u66f4\u65b0\u547d\u4ee4\u683c\u5f0f\u4e00\u81f4\uff09\uff1a</p> <pre><code>$ kubectl create secret generic nginx-conf --from-file=nginx.conf --dry-run -o yaml | kubectl replace -f -\n</code></pre> <ul> <li>generic\uff1a\u6307\u5b9a\u4e3a\u901a\u7528\u578bSecret\u3002</li> <li>nginx-conf\uff1aSecret\u7684\u540d\u79f0\u3002</li> <li>dry-run -o yaml\uff1a\u53ea\u8fd0\u884c\u547d\u4ee4,\u5e76\u4e0d\u771f\u6b63\u5730\u521b\u5efa\uff0c\u5e76\u4ee5YAML\u7684\u683c\u5f0f\u8f93\u51fa,\u6bd4\u5982\uff1a</li> </ul> <pre><code>kubectl create secret generic nginx-conf --from-file=nginx.conf --dry-run -o yaml apiVersion: v1\ndata:\n  nginx.conf: ZGFlbW9uIG9uOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOS7peWuiOaKpOi/m+eoi+eahOaWueW8j+i......\nkind: Secret\nmetadata:\n  name: nginx-conf\n</code></pre> <p><code>kubectl replace -f -</code>\uff1a\u901a\u8fc7\u6587\u4ef6\u521b\u5efa\u7684Secret\u548cConfigMap\u4e0d\u80fd\u88ab\u76f4\u63a5\u66ff\u6362\uff0c\u4f46\u662f\u901a\u8fc7YAML\u6587\u4ef6\u521b\u5efa\u53ef\u4ee5\u88ab\u66ff\u6362\uff0c\u6240\u4ee5\u5148\u4f7f\u7528<code>dry-run -o yaml</code>\u751f\u6210YAML\u6587\u4ef6\uff0c</p> <p>\u518d\u8fdb\u884creplace\u5373\u53ef\u5b9e\u73b0\u70ed\u66f4\u65b0\uff0c\u8be5\u65b9\u6cd5\u53ef\u4ee5\u7528\u4e8e\u5176\u4ed6\u8d44\u6e90\u7c7b\u578b\uff0c\u901a\u8fc7YAML\u6587\u4ef6\u66ff\u6362\u5df2\u7ecf\u521b\u5efa\u7684\u8d44\u6e90\u4e5f\u662f\u53ef\u4ee5\u7684\u3002</p> <p>\u6ce8\u610f</p> <ul> <li> <p>\u5982\u679cConfigMap\u548cSecret\u662f\u901a\u8fc7\u67d0\u4e2aYAML\u6587\u4ef6\u521b\u5efa\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u8fd9\u4e2aYAML\u6587\u4ef6\uff0c\u7136\u540e\u8fdb\u884creplace\u5373\u53ef\u66f4\u65b0\u3002</p> </li> <li> <p>\u53e6\u5916\u66f4\u65b0\u540e\uff0c\u6302\u8f7d\u5230\u5bb9\u5668\u91cc\u9762\u7684\u6587\u4ef6\u4e0d\u4f1a\u88ab\u7acb\u5373\u66f4\u65b0\uff0c\u800c\u662fkubelet\u4f1a\u5468\u671f\u6027\u5730\u68c0\u67e5\u5e76\u8fdb\u884c\u91cd\u65b0\u6302\u8f7d\u64cd\u4f5c\u3002</p> </li> <li> <p>\u6302\u8f7d\u7684\u6587\u4ef6\u66f4\u65b0\u540e\uff0c\u9700\u8981\u7a0b\u5e8f\u81ea\u884c\u5904\u7406\u65b0\u914d\u7f6e\uff0c\u4e5f\u5c31\u662f\u7a0b\u5e8f\u70ed\u52a0\u8f7d\u529f\u80fd\uff0c\u6bd4\u5982Kubernetes\u4e91\u539f\u751f\u76d1\u63a7\u5e73\u53f0Prometheus\u5c31\u5b9e\u73b0\u4e86\u8be5\u529f\u80fd\uff0c\u66f4\u6539Prometheus\u7684\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u65e0\u987b\u91cd\u542fPrometheus\u8fdb\u7a0b\u53caPrometheus\u5bb9\u5668\u5373\u53ef\u52a0\u8f7d\u65b0\u914d\u7f6e\uff0c\u5982\u679c\u7a0b\u5e8f\u6ca1\u6709\u5b9e\u73b0\u8be5\u529f\u80fd\uff0c\u90a3\u4e48\u53ea\u80fd\u91cd\u542f\u5bb9\u5668\u52a0\u8f7d\u65b0\u914d\u7f6e\u3002</p> </li> </ul> <p>\u53c2\u8003\u6587\u732e</p> <p>https://www.yuque.com/jiaoyin-j930b/mry4p5/bhbyor</p> <p>https://jimmysong.io/kubernetes-handbook/concepts/configmap-hot-update.html</p>"},{"location":"Kubernetes/2.%E5%9F%BA%E7%A1%80%E7%AF%87/7.Kubernetes%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/#5-\u5c0f\u7ed3","title":"5. \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u5b66\u4e60\u4e86Kubernetes\u7684\u914d\u7f6e\u7ba1\u7406\uff0c\u53ef\u4ee5\u4f7f\u7528ConfigMap\u548cSecret\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u914d\u7f6e\uff0c\u8fd9\u4e5f\u662f\u4e91\u539f\u751f\u8981\u7d20\u975e\u5e38\u91cd\u8981\u7684\u4e00\u73af\u2014\u2014\u914d\u7f6e\u5206\u79bb\u3002</p> <p>\u5728\u7a0b\u5e8f\u5f00\u53d1\u65f6\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u7a0b\u5e8f\u5458\u9700\u8981\u6709\u8fd9\u79cd\u610f\u8bc6\uff0c\u5c31\u662f\u5c06\u6240\u6709\u7684\u53ef\u53d8\u914d\u7f6e\u90fd\u653e\u7f6e\u4e8e\u4ee3\u7801\u4e4b\u5916\uff0c\u8fd9\u662f\u975e\u5e38\u91cd\u8981\u7684\u7a0b\u5e8f\u8bbe\u8ba1\u3002</p> <p>\u4e0d\u4ec5\u7a0b\u5e8f\u7684\u7075\u6d3b\u6027\u9ad8\uff0c\u7ba1\u7406\u8d77\u6765\u4e5f\u4f1a\u66f4\u52a0\u65b9\u4fbf\uff0c\u5728\u4e0d\u540c\u7684\u73af\u5883\u90e8\u7f72\u5e94\u7528\uff0c\u4e0d\u9700\u8981\u4fee\u6539\u4efb\u4f55\u4ee3\u7801\uff0c\u53ea\u9700\u8981\u4fee\u6539\u5916\u7f6e\u7684\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\u3002</p> <p>Kubernetes\u7684\u914d\u7f6e\u7ba1\u7406\u53ef\u4ee5\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\u6302\u8f7d\uff0c\u4e5f\u53ef\u4ee5\u914d\u7f6e\u4e3a\u73af\u5883\u53d8\u91cf\uff0c\u7a0b\u5e8f\u9002\u914d\u5176\u4e2d\u7684\u4e00\u79cd\u5373\u53ef\u6ee1\u8db3\u9700\u6c42\u3002</p> <p>\u5982\u679c\u6709\u66f4\u590d\u6742\u7684\u914d\u7f6e\u9700\u6c42\uff0c\u6bd4\u5982\u9700\u8981\u5ba1\u6838\u3001\u5907\u4efd\u3001\u56de\u6eda\u7b49\uff0c\u53ef\u4ee5\u91c7\u7528\u4e13\u7528\u7684\u914d\u7f6e\u4e2d\u5fc3\uff0c\u6bd4\u5982Apollo\u3001Nacos\u548cSpringCloud\u7684ConfigServer\u7b49\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/","title":"Kubernetes\u5b58\u50a8\u5165\u95e8","text":"<p>\u524d\u9762\u5df2\u7ecf\u8bb2\u89e3\u4e86Kubernetes\u7684\u5927\u90e8\u5206\u77e5\u8bc6\u70b9\uff0c\u76f8\u4fe1\u8bfb\u8005\u5df2\u7ecf\u6162\u6162\u9886\u609f\u5230\u4e86Kubernetes\u7684\u7cbe\u9ad3\u3002\u4f46\u662f\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u8fd8\u4e0d\u8db3\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u5185\u5404\u79cd\u590d\u6742\u7684\u573a\u666f\uff0c\u56e0\u4e3a\u6211\u4eec\u5e76\u6ca1\u6709\u8bb2\u5230\u4efb\u4f55\u5173\u4e8e\u6570\u636e\u5b58\u50a8\u548c\u6570\u636e\u4ea4\u6362\u7684\u5185\u5bb9\u3002</p> <p>\u800c\u6570\u636e\u662f\u4e00\u4e2a\u4f01\u4e1a\u53d1\u5c55\u7684\u6838\u5fc3\uff0c\u5728\u751f\u4ea7\u4e2d\u662f\u5c24\u4e3a\u91cd\u8981\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u672c\u7ae0\u5c06\u5e26\u9886\u8bfb\u8005\u5b66\u4e60Kubernetes\u53e6\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u5e76\u4e14\u7a0d\u5fae\u6709\u4e9b\u96be\u5ea6\u7684\u77e5\u8bc6\u70b9\u2014\u2014\u6570\u636e\u6301\u4e45\u5316Volume\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#1-volume\u7684\u6982\u5ff5","title":"1. Volume\u7684\u6982\u5ff5","text":"<p>\u5bf9\u4e8e\u5927\u591a\u6570\u9879\u76ee\u800c\u8a00\uff0c\u6570\u636e\u6587\u4ef6\u7684\u5b58\u50a8\u662f\u975e\u5e38\u5e38\u89c1\u7684\u9700\u6c42\uff0c\u6bd4\u5982\u5b58\u50a8\u7528\u6237\u4e0a\u4f20\u7684\u5934\u50cf\u3001\u4e0a\u4f20\u7684\u6587\u4ef6\u4ee5\u53ca\u6570\u636e\u5e93\u7684\u6570\u636e\u3002</p> <p>\u5728Kubernetes\u4e2d\uff0c\u7531\u4e8e\u5e94\u7528\u7684\u90e8\u7f72\u5177\u6709\u9ad8\u5ea6\u7684\u53ef\u6269\u5c55\u6027\u548c\u7f16\u6392\u80fd\u529b\uff08\u4e0d\u50cf\u4f20\u7edf\u67b6\u6784\u90e8\u7f72\u5728\u56fa\u5b9a\u7684\u4f4d\u7f6e\uff09\uff0c\u56e0\u6b64\u628a\u6570\u636e\u5b58\u653e\u5728\u672c\u5730\u662f\u975e\u5e38\u4e0d\u53ef\u53d6\u7684\uff0c\u8fd9\u6837\u505a\u4e5f\u65e0\u6cd5\u4fdd\u969c\u6570\u636e\u7684\u5b89\u5168\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u5bf9\u4e91\u539f\u751f\u5e94\u7528\u6709\u6240\u4e86\u89e3\uff0c\u5c31\u4f1a\u77e5\u9053\u5176\u4e2d\u7684\u4e00\u4e2a\u6982\u5ff5\u2014\u2014\u628a\u6709\u72b6\u6001\u5e94\u7528\u53d8\u6210\u65e0\u72b6\u6001\u5e94\u7528\uff0c\u610f\u6307\u628a\u6570\u636e\u4ece\u5e94\u7528\u4e2d\u5265\u79bb\u51fa\u6765\uff0c\u628a\u4ea7\u751f\u7684\u6570\u636e\u6587\u4ef6\u6216\u8005\u7f13\u5b58\u4fe1\u606f\u90fd\u653e\u5728\u201c\u4e91\u7aef\u201d\uff0c \u6bd4\u5982\u5e38\u7528\u7684NFS\uff08\u751f\u4ea7\u73af\u5883\u6781\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u56e0\u4e3aNFS\u5b58\u5728\u5355\u70b9\u6545\u969c\uff0c\u63a8\u8350\u4f7f\u7528\u5206\u5e03\u5f0f\u5b58\u50a8\u6216\u8005\u516c\u6709\u4e91\u7684NAS\u670d\u52a1\uff09\u3001Ceph\u3001GlusterFS\uff08\u53ef\u80fd\u4f1a\u505c\u6b62\u7ef4\u62a4\uff09\u3001Minio\u7b49\u3002</p> <p>\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u5982\u679c\u8981\u4f7f\u7528\u8fd9\u4e9b\u5b58\u50a8\uff0c\u9700\u8981\u63d0\u524d\u5728\u5bbf\u4e3b\u673a\u6302\u8f7d\uff0c\u7136\u540e\u7a0b\u5e8f\u624d\u80fd\u8bbf\u95ee\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u7ecf\u5e38\u78b0\u5230\u65b0\u52a0\u8282\u70b9\u5fd8\u8bb0\u6302\u8f7d\u5b58\u50a8\u5bfc\u81f4\u7684\u4e00\u7cfb\u5217\u95ee\u9898\u3002\u800cKubernetes\u5728\u8bbe\u8ba1\u4e4b\u521d\u5c31\u8003\u8651\u4e86\u8fd9\u4e9b\u95ee\u9898\uff0c\u5e76\u62bd\u8c61\u51faVolume\u7684\u6982\u5ff5\u7528\u4e8e\u89e3\u51b3\u6570\u636e\u5b58\u50a8\u7684\u95ee\u9898\u3002</p> <p>\u5728\u5bb9\u5668\u4e2d\u7684\u78c1\u76d8\u6587\u4ef6\u662f\u77ed\u6682\u7684\uff0c\u5f53\u5bb9\u5668\u5d29\u6e83\u65f6\uff0cKubelet\u4f1a\u91cd\u65b0\u542f\u52a8\u5bb9\u5668\uff0c\u4f46\u5bb9\u5668\u8fd0\u884c\u65f6\u4ea7\u751f\u7684\u6570\u636e\u6587\u4ef6\u90fd\u5c06\u4f1a\u4e22\u5931\uff0c\u4e4b\u540e\u5bb9\u5668\u4f1a\u4ee5\u6700\u5e72\u51c0\u7684\u72b6\u6001\u542f\u52a8\u3002</p> <p>\u53e6\u5916\uff0c\u5f53\u4e00\u4e2aPod\u8fd0\u884c\u591a\u4e2a\u5bb9\u5668\u65f6\uff0c\u5404\u4e2a\u5bb9\u5668\u53ef\u80fd\u9700\u8981\u5171\u4eab\u4e00\u4e9b\u6587\u4ef6\uff0c\u8bf8\u5982\u6b64\u7c7b\u7684\u9700\u6c42\u90fd\u53ef\u4ee5\u4f7f\u7528Volume\u89e3\u51b3\u3002</p> <p>Docker\u4e5f\u6709\u5377\u7684\u6982\u5ff5\uff0c\u4f46\u662f\u5728Docker\u4e2d\uff0c\u5377\u53ea\u662f\u78c1\u76d8\u4e0a\u6216\u53e6\u4e00\u4e2a\u5bb9\u5668\u4e2d\u7684\u76ee\u5f55\uff0c\u5176\u751f\u547d\u5468\u671f\u4e0d\u53d7\u7ba1\u7406\u3002</p> <p>\u867d\u7136Docker\u5df2\u7ecf\u63d0\u4f9b\u4e86\u5377\u9a71\u52a8\u7a0b\u5e8f\uff0c\u4f46\u662f\u529f\u80fd\u975e\u5e38\u6709\u9650\uff0c\u4f8b\u5982\u4eceDocker 1.7\u7248\u672c\u5f00\u59cb\uff0c\u6bcf\u4e2a\u5bb9\u5668\u53ea\u5141\u8bb8\u4e00\u4e2a\u5377\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5e76\u4e14\u65e0\u6cd5\u5c06\u4e00\u4e9b\u7279\u6b8a\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u540e\u7aef\u5b58\u50a8\u3002</p> <p>\u4ece\u672c\u8d28\u4e0a\u8bb2\uff0c\u548c\u865a\u62df\u673a\u6216\u8005\u7269\u7406\u673a\u4e00\u6837\uff0c\u5377\u88ab\u6302\u8f7d\u540e\uff0c\u5728\u5bb9\u5668\u4e2d\u4e5f\u53ea\u662f\u4e00\u4e2a\u76ee\u5f55\uff0c\u53ef\u80fd\u5305\u542b\u4e00\u4e9b\u6570\u636e\uff0cPod\u4e2d\u7684\u5bb9\u5668\u4e5f\u53ef\u4ee5\u5bf9\u5176\u8fdb\u884c\u589e\u5220\u6539\u67e5\u64cd\u4f5c\uff0c\u4f7f\u7528\u65b9\u5f0f\u548c\u88f8\u673a\u6302\u8f7d\u51e0\u4e4e\u6ca1\u6709\u533a\u522b\u3002</p> <p>\u8981\u4f7f\u7528\u5377\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u548c\u5176\u4ed6\u53c2\u6570\u7c7b\u4f3c\uff0cPod\u53ea\u9700\u8981\u901a\u8fc7.spec.volumes\u5b57\u6bb5\u6307\u5b9a\u4e3aPod\u63d0\u4f9b\u7684\u5377\uff0c \u7136\u540e\u5728\u5bb9\u5668\u4e2d\u914d\u7f6e\u5757\uff0c\u4f7f\u7528.spec.containers.volumeMounts\u5b57\u6bb5\u6307\u5b9a\u5377\u6302\u8f7d\u7684\u76ee\u5f55\u5373\u53ef\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#2-volume\u7684\u7c7b\u578b","title":"2. Volume\u7684\u7c7b\u578b","text":"<p>\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u4f01\u4e1a\u5185\u53ef\u80fd\u6709\u81ea\u5df1\u7684\u5b58\u50a8\u5e73\u53f0\uff0c\u6bd4\u5982NFS\u3001Ceph\u3001GlusterFS\u3001Minio\u7b49\u3002\u5982\u679c\u8bfb\u8005\u7684\u73af\u5883\u5728\u516c\u6709\u4e91\uff0c\u53ef\u4ee5\u4f7f\u7528\u516c\u6709\u4e91\u63d0\u4f9b\u7684NAS\u3001\u5bf9\u8c61\u5b58\u50a8\u7b49\u3002\u5728Kubernetes\u4e2d\uff0cVolume\u4e5f\u652f\u6301\u914d\u7f6e\u4ee5\u4e0a\u5b58\u50a8\uff0c\u7528\u4e8e\u6302\u8f7d\u5230Pod\u4e2d\u5b9e\u73b0\u6570\u636e\u7684\u6301\u4e45\u5316\u3002</p> <p>Kubernetes Volume\u652f\u6301\u7684\u5377\u7684\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u4ee5\u4e0b\u4e3a\u5e38\u7528\u7684\u5377\uff1a</p> <ul> <li>CephFS\u3002</li> <li>GlusterFS\u3002</li> <li>ISCSI\u3002</li> <li>Cinder\u3002</li> <li>NFS\u3002</li> <li>RBD\u3002</li> <li>HostPath\u3002</li> </ul> <p>\u5f53\u7136\uff0c\u4e5f\u652f\u6301\u4e00\u4e9bKubernetes\u72ec\u6709\u7684\u7c7b\u578b\uff1a</p> <ul> <li>ConfigMap\uff1a\u7528\u4e8e\u5b58\u50a8\u914d\u7f6e\u6587\u4ef6\u3002</li> <li>Secret\uff1a\u7528\u4e8e\u5b58\u50a8\u654f\u611f\u6570\u636e\u3002</li> <li>EmptyDir\uff1a\u7528\u4e8e\u4e00\u4e2aPod\u5185\u591a\u4e2a\u5bb9\u5668\u7684\u6570\u636e\u5171\u4eab\u3002</li> <li>PersistentVolumeClaim\uff1a\u5bf9PersistentVolume\u7684\u7533\u8bf7\u3002</li> </ul> <p>\u4ee5\u4e0a\u5217\u4e3e\u7684\u662f\u4e00\u4e9b\u6bd4\u8f83\u5e38\u7528\u7684\u7c7b\u578b\uff0c\u5176\u4ed6\u652f\u6301\u7684\u7c7b\u578b\u53ef\u4ee5\u67e5\u770bVolume\u7684\u5b98\u65b9\u6587\u6863\uff1a</p> <p>https://kubernetes.io/docs/concepts/storage/volumes/</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7\u51e0\u4e2a\u6bd4\u8f83\u5e38\u7528\u7684\u7c7b\u578b\u7684Volume\u914d\u7f6e\u6f14\u793a\u4e00\u4e0bVolume\u7684\u4f7f\u7528\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#3-\u793a\u4f8b1-\u901a\u8fc7emptydir\u5171\u4eab\u6570\u636e","title":"3. \u793a\u4f8b1: \u901a\u8fc7emptyDir\u5171\u4eab\u6570\u636e","text":"<p>EmptyDir\u662f\u4e00\u4e2a\u7279\u6b8a\u7684Volume\u7c7b\u578b\uff0c\u4e0e\u4e0a\u8ff0Volume\u4e0d\u540c\u7684\u662f\uff0c \u5982\u679c\u5220\u9664Pod\uff0cemptyDir\u5377\u4e2d\u7684\u6570\u636e\u4e5f\u5c06\u88ab\u5220\u9664\uff0c\u6240\u4ee5\u4e00\u822cemptyDir\u7528\u4e8ePod\u4e2d\u7684\u4e0d\u540cContainer\u5171\u4eab\u6570\u636e\uff0c</p> <p>\u6bd4\u5982\u4e00\u4e2aPod\u5b58\u5728\u4e24\u4e2a\u5bb9\u5668A\u548cB\uff0c\u5bb9\u5668A\u9700\u8981\u4f7f\u7528\u5bb9\u5668B\u4ea7\u751f\u7684\u6570\u636e\uff0c\u6b64\u65f6\u53ef\u4ee5\u91c7\u7528emptyDir\u5171\u4eab\u6570\u636e\uff0c\u7c7b\u4f3c\u7684\u4f7f\u7528\u5982Filebeat\u6536\u96c6\u5bb9\u5668\u5185\u7a0b\u5e8f\u4ea7\u751f\u7684\u65e5\u5fd7\u3002</p> <p>\u4f7f\u7528emptyDir\u5377\u7684\u793a\u4f8b\u5982\u4e0b\uff0c\u76f4\u63a5\u6307\u5b9aemptyDir\u4e3a{}\u5373\u53ef\uff1a</p> <p>nginx-empty.yaml</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: nginx\nname: nginx\nnamespace: default\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: nginx\ntemplate:\nmetadata:\nlabels:\napp: nginx\nspec:\ncontainers:\n- image: nginx:1.15.2\nimagePullPolicy: IfNotPresent\nname: nginx\nvolumeMounts:\n- mountPath: /opt\nname: share-volume\n- image: nginx:1.15.2\nimagePullPolicy: IfNotPresent\nname: nginx2\ncommand:\n- sh\n- -c\n- sleep 3600\nvolumeMounts:\n- mountPath: /mnt\nname: share-volume\nvolumes:\n- name: share-volume\nemptyDir: {}\n#medium: Memory\n</code></pre> <p>\u6b64\u90e8\u7f72\u6587\u4ef6\u521b\u5efa\u4e00\u4e2aDeployment\uff0c\u91c7\u7528spec.volumes\u5b57\u6bb5\u914d\u7f6e\u4e86\u4e00\u4e2a\u540d\u5b57\u4e3ashare-volume\u3001\u7c7b\u578b\u4e3aemptyDir\u7684Volume\uff0c\u540c\u65f6\u91cc\u9762\u5305\u542b\u4e24\u4e2a\u5bb9\u5668nginx\u548cnginx2\uff0c \u5e76\u5c06\u8be5Volume\u6302\u8f7d\u5230\u4e86/opt\u548c/mnt\u76ee\u5f55\u4e0b\uff0c\u6b64\u65f6/opt\u548c/mnt\u76ee\u5f55\u7684\u6570\u636e\u5c31\u5b9e\u73b0\u4e86\u5171\u4eab\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cemptyDir\u652f\u6301\u8282\u70b9\u4e0a\u7684\u4efb\u4f55\u4ecb\u8d28\uff0c\u53ef\u80fd\u662fSSD\u3001\u78c1\u76d8\u6216\u7f51\u7edc\u5b58\u50a8\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u81ea\u8eab\u7684\u73af\u5883\u3002</p> <p>\u53ef\u4ee5\u5c06emptyDir.medium\u5b57\u6bb5\u8bbe\u7f6e\u4e3aMemory\uff0c\u8ba9Kubernetes\u4f7f\u7528tmpfs\uff08\u5185\u5b58\u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf\uff09\uff0c \u867d\u7136tmpfs\u975e\u5e38\u5feb\uff0c\u4f46\u662ftmpfs\u5728\u8282\u70b9\u91cd\u542f\u65f6\uff0c\u6570\u636e\u540c\u6837\u4f1a\u88ab\u6e05\u9664\uff0c\u5e76\u4e14\u8bbe\u7f6e\u7684\u5927\u5c0f\u4f1a\u88ab\u8ba1\u5165Container\u7684\u5185\u5b58\u9650\u5236\u4e2d\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#4-\u793a\u4f8b2-\u4f7f\u7528hostpath\u6302\u8f7d\u5bbf\u4e3b\u673a\u6587\u4ef6","title":"4. \u793a\u4f8b2: \u4f7f\u7528HostPath\u6302\u8f7d\u5bbf\u4e3b\u673a\u6587\u4ef6","text":"<p>HostPath\u5377\u53ef\u5c06\u8282\u70b9\u4e0a\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u6302\u8f7d\u5230Pod\u4e0a\uff0c\u7528\u4e8e\u5b9e\u73b0Pod\u548c\u5bbf\u4e3b\u673a\u4e4b\u95f4\u7684\u6570\u636e\u5171\u4eab\uff0c</p> <p>\u5e38\u7528\u7684\u793a\u4f8b\u6709\u6302\u8f7d\u5bbf\u4e3b\u673a\u7684\u65f6\u533a\u81f3Pod\uff0c\u6216\u8005\u5c06Pod\u7684\u65e5\u5fd7\u6587\u4ef6\u6302\u8f7d\u5230\u5bbf\u4e3b\u673a\u7b49\u3002</p> <p>\u4ee5\u4e0b\u4e3a\u4f7f\u7528hostPath\u5377\u7684\u793a\u4f8b\uff0c\u5b9e\u73b0\u5c06\u4e3b\u673a\u7684/etc/timezone\u6587\u4ef6\u6302\u8f7d\u5230Pod\u7684/etc/timezone\uff08\u6302\u8f7d\u8def\u5f84\u53ef\u4ee5\u4e0d\u4e00\u81f4\uff09\uff1a</p> <p>nginx-hostPath.yaml</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: nginx\nname: nginx\nnamespace: default\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: nginx\ntemplate:\nmetadata:\nlabels:\napp: nginx\nspec:\ncontainers:\n- image: nginx:1.15.2\nimagePullPolicy: IfNotPresent\nname: nginx\nvolumeMounts:\n- mountPath: /opt\nname: share-volume\n- mountPath: /etc/timezone\nname: timezone\n- image: nginx:1.15.2\nimagePullPolicy: IfNotPresent\nname: nginx2\ncommand:\n- sh\n- -c\n- sleep 3600\nvolumeMounts:\n- mountPath: /mnt\nname: share-volume\nvolumes:\n- name: share-volume\nemptyDir: {}\n#medium: Memory\n- name: timezone\nhostPath:\npath: /etc/timezone\ntype: File\n</code></pre> <p>\u5728\u914d\u7f6eHostPath\u65f6\uff0c\u6709\u4e00\u4e2atype\u7684\u53c2\u6570\uff0c\u7528\u4e8e\u8868\u8fbe\u4e0d\u540c\u7684\u6302\u8f7d\u7c7b\u578b\uff0cHostPath\u5377\u5e38\u7528\u7684type\uff08\u7c7b\u578b\uff09\u5982\u4e0b\uff1a</p> <ul> <li> <p>type\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff1a\u9ed8\u8ba4\u9009\u9879\uff0c\u610f\u5473\u7740\u6302\u8f7dhostPath\u5377\u4e4b\u524d\u4e0d\u4f1a\u6267\u884c\u4efb\u4f55\u68c0\u67e5\u3002</p> </li> <li> <p>DirectoryOrCreate\uff1a\u5982\u679c\u7ed9\u5b9a\u7684path\u4e0d\u5b58\u5728\u4efb\u4f55\u4e1c\u897f\uff0c\u90a3\u4e48\u5c06\u6839\u636e\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u6743\u9650\u4e3a0755\u7684\u7a7a\u76ee\u5f55\uff0c\u548cKubelet\u5177\u6709\u76f8\u540c\u7684\u7ec4\u548c\u6743\u9650</p> </li> <li>Directory\uff1a\u76ee\u5f55\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u7684\u8def\u5f84\u4e0b\u3002</li> <li>FileOrCreate\uff1a\u5982\u679c\u7ed9\u5b9a\u7684\u8def\u5f84\u4e0d\u5b58\u50a8\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u4f1a\u6839\u636e\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff0c\u6743\u9650\u8bbe\u7f6e\u4e3a0644\uff0c\u548cKubelet\u5177\u6709\u76f8\u540c\u7684\u7ec4\u548c\u6240\u6709\u6743\u3002</li> <li>File\uff1a\u6587\u4ef6\uff0c\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d\u3002</li> <li>Socket\uff1aUNIX\u5957\u63a5\u5b57\uff0c\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d\u3002</li> <li>CharDevice\uff1a\u5b57\u7b26\u8bbe\u5907\uff0c\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d\u3002</li> <li>BlockDevice\uff1a\u5757\u8bbe\u5907\uff0c\u5fc5\u987b\u5b58\u5728\u4e8e\u7ed9\u5b9a\u8def\u5f84\u4e2d\u3002</li> </ul>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#5-\u793a\u4f8b3-\u6302\u8f7dnfs\u81f3\u5bb9\u5668","title":"5. \u793a\u4f8b3: \u6302\u8f7dNFS\u81f3\u5bb9\u5668","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u8003\u8651\u5230\u6570\u636e\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u4ecd\u7136\u4e0d\u5efa\u8bae\u4f7f\u7528NFS\u4f5c\u4e3a\u540e\u7aef\u5b58\u50a8\u3002</p> <p>\u56e0\u4e3aNFS\u5b58\u5728\u5355\u70b9\u6545\u969c\uff0c\u5f88\u591a\u4f01\u4e1a\u5e76\u975e\u5bf9\u5176\u5b9e\u73b0\u9ad8\u53ef\u7528\uff0c\u5e76\u4e14NFS\u7684\u6027\u80fd\u5b58\u5728\u5f88\u5927\u7684\u74f6\u9888\u3002</p> <p>\u6240\u4ee5\u751f\u4ea7\u4e2d\uff0c\u5efa\u8bae\u4f7f\u7528\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u5728\u516c\u6709\u4e91\u4e2d\u5efa\u8bae\u4f7f\u7528\u516c\u6709\u4e91\u63d0\u4f9b\u7684NAS\u5b58\u50a8\u6765\u66ff\u4ee3NFS\uff0c\u5e76\u4e14NAS\u6027\u80fd\u66f4\u597d\uff0c\u53ef\u7528\u6027\u66f4\u9ad8\u3002</p> <p>NFS\u4f5c\u4e3a\u4e00\u4e2a\u6bd4\u8f83\u6d41\u884c\u7684\u8fdc\u7aef\u5b58\u50a8\u5de5\u5177\uff0c\u5728\u975e\u751f\u4ea7\u73af\u5883\u4e2d\u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u7528\u7684\u9009\u62e9\uff0c\u53ef\u4ee5\u5feb\u901f\u5730\u642d\u5efa\u4f7f\u7528\u3002\u63a5\u4e0b\u6765\u6f14\u793a\u5982\u4f55\u4f7f\u7528Volume\u6302\u8f7dNFS\u4e3a\u5bb9\u5668\u63d0\u4f9b\u6301\u4e45\u5316\u5b58\u50a8\u3002</p> <p>\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u9700\u8981\u63d0\u524d\u914d\u7f6eNFS\u7684\u6743\u9650\u548c\u6570\u636e\u76ee\u5f55\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003NFS\u7684\u6587\u6863\uff0c\u6b64\u5904\u53ea\u63d0\u4f9bNFS\u7684exporter\u914d\u7f6e\uff0c</p> <p>\u5047\u8bbeNFS\u63d0\u4f9b\u7684\u6570\u636e\u76ee\u5f55\u4e3a/data/nfs\uff0c\u6388\u6743\u53ef\u6302\u8f7d\u8be5\u76ee\u5f55\u7684IP\u6bb5\u4e3a192.168.0.0/24\uff1a</p> <pre><code>/data/nfs/ 192.168.0.0/24(rw,sync,no_subtree_check,no_root_squash)\n</code></pre> <p>\u548cemptyDir\u3001HostPath\u7684\u914d\u7f6e\u65b9\u6cd5\u7c7b\u4f3c\uff0cNFS\u7684Volume\u914d\u7f6e\u4e5f\u662f\u5728Volumes\u5b57\u6bb5\u4e2d\u914d\u7f6e\u7684\uff0c\u548cemptyDir\u4e0d\u540c\u7684\u662f\uff0cNFS\u5c5e\u4e8e\u6301\u4e45\u5316\u5b58\u50a8\u7684\u4e00\u79cd\uff0c\u5728Pod\u5220\u9664\u6216\u8005\u91cd\u542f\u540e\uff0c\u6570\u636e\u4f9d\u65e7\u4f1a\u5b58\u50a8\u5728NFS\u8282\u70b9\u4e0a\u3002</p> <p>NFS \u662f Network File System \u7684\u7f29\u5199\uff0c\u5373\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\u3002Kubernetes \u4e2d\u901a\u8fc7\u7b80\u5355\u5730\u914d\u7f6e\u5c31\u53ef\u4ee5\u6302\u8f7d NFS \u5230 Pod \u4e2d\uff0c\u800c NFS \u4e2d\u7684\u6570\u636e\u662f\u53ef\u4ee5\u6c38\u4e45\u4fdd\u5b58\u7684\uff0c\u540c\u65f6 NFS \u652f\u6301\u540c\u65f6\u5199\u64cd\u4f5c\u3002</p> <p>\u914d\u7f6eNFS\u4e5f\u76f8\u5bf9\u7b80\u5355\uff0c\u4ee3\u7801\u5982\u4e0b\uff08\u6302\u8f7d\u65b9\u5f0f\u548chostPath\u3001emptyDir\u7c7b\u4f3c\uff0c\u5728\u6b64\u4e0d\u518d\u6f14\u793a\uff09\uff1a</p> <pre><code>volumes:\n- name: nfs\nnfs:\n# FIXME: use the right hostname\nserver: 10.254.234.223\npath: \"/\"\n</code></pre> <ul> <li>Server\uff1aNFS\u670d\u52a1\u5668\u7684IP\u3002</li> <li>Path\uff1aNFS\u670d\u52a1\u5668\u7684\u5171\u4eab\u76ee\u5f55\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>Kubernetes\u6240\u6709\u7684\u8282\u70b9\u90fd\u9700\u8981\u5b89\u88c5\u4e0anfs-utils\u624d\u53ef\u4ee5\u6b63\u5e38\u6302\u8f7dNFS\u3002</p> <p>\u672c\u8282\u6f14\u793a\u4e86\u7c7b\u578b\u4e3aemptyDir\u3001hostPath\u3001NFS\u7684Volume\u7684\u4f7f\u7528\uff0c\u5728\u914d\u7f6e\u7ba1\u7406ConfigMap\u3001Secret\u65f6\u4e5f\u8bb2\u89e3\u4e86\u7c7b\u578b\u4e3aSecret\u548cConfigMap\u7684\u4f7f\u7528\uff0c\u540e\u9762\u7684\u7ae0\u8282\u5c06\u4e3a\u8bfb\u8005\u8bb2\u89e3persistentVolumeClaim\u4ee5\u53ca\u66f4\u9ad8\u7ea7\u7684\u5b58\u50a8\u914d\u7f6e\u7684\u4f7f\u7528\u3002</p> <p>\u5bf9\u4e8e\u5176\u4ed6\u7c7b\u578b\u7684Volume\u914d\u7f6e\uff0c\u539f\u7406\u548c\u914d\u7f6e\u65b9\u6cd5\u7c7b\u4f3c\uff0c</p> <p>\u5177\u4f53\u53c2\u8003</p> <p>https://kubernetes.io/docs/concepts/storage/volumes/\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#6-persistentvolume","title":"6. PersistentVolume","text":"<p>\u4e0a\u4e00\u8282\u8bb2\u89e3\u4e86Volume\u7684\u6982\u5ff5\u548c\u4f7f\u7528\uff0c\u867d\u7136Volume\u5df2\u7ecf\u53ef\u4ee5\u63a5\u5165\u5927\u90e8\u5206\u5b58\u50a8\u540e\u7aef\uff0c\u4f46\u662f\u5b9e\u9645\u4f7f\u7528\u65f6\u8fd8\u6709\u8bf8\u591a\u95ee\u9898\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5f53\u67d0\u4e2a\u6570\u636e\u5377\u4e0d\u518d\u88ab\u6302\u8f7d\u4f7f\u7528\u65f6\uff0c\u91cc\u9762\u7684\u6570\u636e\u5982\u4f55\u5904\u7406\uff1f</li> <li>\u5982\u679c\u60f3\u8981\u5b9e\u73b0\u53ea\u8bfb\u6302\u8f7d\u5982\u4f55\u5904\u7406\uff1f</li> <li>\u5982\u679c\u60f3\u8981\u53ea\u80fd\u6709\u4e00\u4e2aPod\u6302\u8f7d\u5982\u4f55\u5904\u7406\uff1f</li> </ul> <p>\u5982\u4e0a\u6240\u8ff0\uff0c\u5bf9\u4e8e\u5f88\u591a\u590d\u6742\u7684\u9700\u6c42Volume\u53ef\u80fd\u96be\u4ee5\u5b9e\u73b0\uff0c\u5e76\u4e14\u65e0\u6cd5\u5bf9\u5b58\u50a8\u5377\u7684\u751f\u547d\u5468\u671f\u8fdb\u884c\u7ba1\u7406\u3002\u53e6\u4e00\u4e2a\u5f88\u5927\u7684\u95ee\u9898\u662f\uff0c\u5728\u4f01\u4e1a\u5185\u4f7f\u7528Kubernetes\u7684\u4e0d\u4ec5\u4ec5\u662fKubernetes\u7ba1\u7406\u5458\uff0c\u53ef\u80fd\u8fd8\u6709\u5f00\u53d1\u4eba\u5458\u3001\u6d4b\u8bd5\u4eba\u5458\u4ee5\u53ca\u521d\u5b66Kubernetes\u7684\u6280\u672f\u4eba\u5458\uff0c\u5bf9\u4e8eKubernetes\u7684Volume\u6216\u8005\u76f8\u5173\u5b58\u50a8\u5e73\u53f0\u7684\u914d\u7f6e\u53c2\u6570\u5e76\u4e0d\u4e86\u89e3\uff0c\u6240\u4ee5\u65e0\u6cd5\u81ea\u884c\u5b8c\u6210\u5b58\u50a8\u7684\u914d\u7f6e\u3002</p> <p>\u4e3a\u6b64\uff0cKubernetes\u5f15\u5165\u4e86\u4e24\u4e2a\u65b0\u7684API\u8d44\u6e90\uff1aPersistentVolume\u548cPersistentVolumeClaim\u3002PersistentVolume\uff08\u7b80\u79f0PV\uff09\u662f\u7531Kubernetes\u7ba1\u7406\u5458\u8bbe\u7f6e\u7684\u5b58\u50a8\uff0cPersistentVolumeClaim\uff08\u7b80\u79f0PVC\uff09\u662f\u5bf9PV\u7684\u8bf7\u6c42\uff0c\u8868\u793a\u9700\u8981\u4ec0\u4e48\u7c7b\u578b\u7684PV\u3002\u5b83\u4eec\u540c\u6837\u662f\u96c6\u7fa4\u4e2d\u7684\u4e00\u7c7b\u8d44\u6e90\uff0c\u4f46\u5176\u751f\u547d\u5468\u671f\u6bd4\u8f83\u72ec\u7acb\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u5355\u72ec\u5bf9PV\u8fdb\u884c\u589e\u5220\u6539\u67e5\uff0c\u4e0d\u53d7Pod\u7684\u5f71\u54cd\uff0c\u751f\u547d\u5468\u671f\u53ef\u80fd\u6bd4\u6302\u8f7d\u5b83\u7684\u5176\u4ed6\u8d44\u6e90\u8fd8\u8981\u957f\u3002</p> <p>\u5982\u679c\u4e00\u4e2aKubernetes\u96c6\u7fa4\u7684\u4f7f\u7528\u8005\u5e76\u975e\u53ea\u6709Kubernetes\u7ba1\u7406\u5458\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7\u63d0\u524d\u521b\u5efaPV\uff0c\u7528\u4ee5\u89e3\u51b3\u5bf9\u5b58\u50a8\u6982\u5ff5\u4e0d\u662f\u5f88\u4e86\u89e3\u7684\u6280\u672f\u4eba\u5458\u5bf9\u5b58\u50a8\u7684\u9700\u6c42\u3002\u548c\u5355\u72ec\u914d\u7f6eVolume\u7c7b\u4f3c\uff0cPV\u4e5f\u53ef\u4ee5\u4f7f\u7528NFS\u3001GFS\u3001CEPH\u7b49\u5e38\u7528\u7684\u5b58\u50a8\u540e\u7aef\uff0c\u5e76\u4e14\u53ef\u4ee5\u63d0\u4f9b\u66f4\u52a0\u9ad8\u7ea7\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u8bbf\u95ee\u6a21\u5f0f\u3001\u7a7a\u95f4\u5927\u5c0f\u4ee5\u53ca\u56de\u6536\u7b56\u7565\u7b49\u3002</p> <p>\u76ee\u524dPV\u7684\u63d0\u4f9b\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a\u9759\u6001\u6216\u52a8\u6001\u3002\u9759\u6001PV\u7531\u7ba1\u7406\u5458\u63d0\u524d\u521b\u5efa\uff0c\u52a8\u6001PV\u65e0\u987b\u63d0\u524d\u521b\u5efa\uff08\u52a8\u6001PV\u57288.8\u8282\u8fdb\u884c\u8bb2\u89e3\uff09\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#61-pv\u56de\u6536\u7b56\u7565","title":"6.1 PV\u56de\u6536\u7b56\u7565","text":"<p>\u5f53\u7528\u6237\u4f7f\u7528\u5b8c\u5377\u65f6\uff0c\u53ef\u4ee5\u4eceAPI\u4e2d\u5220\u9664PVC\u5bf9\u8c61\uff0c\u4ece\u800c\u5141\u8bb8\u56de\u6536\u8d44\u6e90\u3002\u56de\u6536\u7b56\u7565\u4f1a\u544a\u8bc9PV\u5982\u4f55\u5904\u7406\u8be5\u5377\u3002</p> <p>\u76ee\u524d\u56de\u6536\u7b56\u7565\u53ef\u4ee5\u8bbe\u7f6e\u4e3aRetain\u3001Recycle\u548cDelete\uff1a</p> <ul> <li>Retain\uff1a\u4fdd\u7559\uff0c\u8be5\u7b56\u7565\u5141\u8bb8\u624b\u52a8\u56de\u6536\u8d44\u6e90\uff0c\u5f53\u5220\u9664PVC\u65f6\uff0cPV\u4ecd\u7136\u5b58\u5728\uff0cVolume\u88ab\u89c6\u4e3a\u5df2\u91ca\u653e\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u624b\u52a8\u56de\u6536\u5377\u3002</li> <li>Recycle\uff1a\u56de\u6536\uff0c\u5982\u679cVolume\u63d2\u4ef6\u652f\u6301\uff0cRecycle\u7b56\u7565\u4f1a\u5bf9\u5377\u6267\u884crm -rf\u6e05\u7406\u8be5PV\uff0c\u5e76\u4f7f\u5176\u53ef\u7528\u4e8e\u4e0b\u4e00\u4e2a\u65b0\u7684PVC\uff0c\u4f46\u662f\u672c\u7b56\u7565\u5c06\u6765\u4f1a\u88ab\u5f03\u7528\uff0c\u76ee\u524d\u53ea\u6709NFS\u548cHostPath\u652f\u6301\u8be5\u7b56\u7565\u3002</li> <li>Delete\uff1a\u5220\u9664\uff0c\u5982\u679cVolume\u63d2\u4ef6\u652f\u6301\uff0c\u5220\u9664PVC\u65f6\u4f1a\u540c\u65f6\u5220\u9664PV\uff0c\u52a8\u6001\u5377\u9ed8\u8ba4\u4e3aDelete\uff0c\u76ee\u524d\u652f\u6301Delete\u7684\u5b58\u50a8\u540e\u7aef\u5305\u62ecAWS EBS\u3001GCE PD\u3001Azure Disk\u3001OpenStack Cinder\u7b49\u3002</li> </ul>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#62-pv\u8bbf\u95ee\u7b56\u7565","title":"6.2 PV\u8bbf\u95ee\u7b56\u7565","text":"<p>\u5728\u5b9e\u9645\u4f7f\u7528PV\u65f6\uff0c\u53ef\u80fd\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u4f1a\u6709\u4e0d\u540c\u7684\u8bbf\u95ee\u7b56\u7565\uff0c\u6bd4\u5982\u67d0\u7c7bPod\u53ef\u4ee5\u8bfb\u5199\uff0c\u67d0\u7c7bPod\u53ea\u80fd\u8bfb\uff0c\u6216\u8005\u9700\u8981\u914d\u7f6e\u662f\u5426\u53ef\u4ee5\u88ab\u591a\u4e2a\u4e0d\u540c\u7684Pod\u540c\u65f6\u8bfb\u5199\u7b49\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528PV\u7684\u8bbf\u95ee\u7b56\u7565\u8fdb\u884c\u7b80\u5355\u63a7\u5236\uff0c\u76ee\u524d\u652f\u6301\u7684\u8bbf\u95ee\u7b56\u7565\u5982\u4e0b\uff1a</p> <ul> <li>ReadWriteOnce\uff1a\u53ef\u4ee5\u88ab\u5355\u8282\u70b9\u4ee5\u8bfb\u5199\u6a21\u5f0f\u6302\u8f7d\uff0c\u547d\u4ee4\u884c\u4e2d\u53ef\u4ee5\u88ab\u7f29\u5199\u4e3aRWO\u3002</li> <li>ReadOnlyMany\uff1a\u53ef\u4ee5\u88ab\u591a\u4e2a\u8282\u70b9\u4ee5\u53ea\u8bfb\u6a21\u5f0f\u6302\u8f7d\uff0c\u547d\u4ee4\u884c\u4e2d\u53ef\u4ee5\u88ab\u7f29\u5199\u4e3aROX\u3002</li> <li>ReadWriteMany\uff1a\u53ef\u4ee5\u88ab\u591a\u4e2a\u8282\u70b9\u4ee5\u8bfb\u5199\u6a21\u5f0f\u6302\u8f7d\uff0c\u547d\u4ee4\u884c\u4e2d\u53ef\u4ee5\u88ab\u7f29\u5199\u4e3aRWX\u3002</li> <li>ReadWriteOncePod\uff1a\u53ea\u80fd\u88ab\u4e00\u4e2aPod\u4ee5\u8bfb\u5199\u7684\u6a21\u5f0f\u6302\u8f7d\uff0c\u547d\u4ee4\u4e2d\u53ef\u4ee5\u88ab\u7f29\u5199\u4e3aRWOP\uff081.22\u4ee5\u4e0a\u7248\u672c\uff09\u3002</li> </ul> <p>\u867d\u7136PV\u5728\u521b\u5efa\u65f6\u53ef\u4ee5\u6307\u5b9a\u4e0d\u540c\u7684\u8bbf\u95ee\u7b56\u7565\uff0c\u4f46\u662f\u4e5f\u8981\u540e\u7aef\u7684\u5b58\u50a8\u652f\u6301\u624d\u884c\u3002</p> <p>\u6bd4\u5982\u4e00\u822c\u60c5\u51b5\u4e0b\u5927\u90e8\u5206\u5757\u5b58\u50a8\u662f\u4e0d\u652f\u6301ReadWriteMany\u7684\uff0c</p> <p>\u5177\u4f53\u540e\u7aef\u5b58\u50a8\u652f\u6301\u7684\u8bbf\u95ee\u6a21\u5f0f\u53ef\u4ee5\u53c2\u8003\uff1ahttps://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes\u3002</p> <p>\u5728\u4f01\u4e1a\u5185\uff0c\u53ef\u80fd\u5b58\u50a8\u5f88\u591a\u4e0d\u540c\u7c7b\u578b\u7684\u5b58\u50a8\uff0c\u6bd4\u5982NFS\u3001Ceph\u3001GlusterFS\u7b49\uff0c\u9488\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u540e\u7aef\u5b58\u50a8\u5177\u6709\u4e0d\u540c\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u8fd9\u4e5f\u662f\u5bf9\u96c6\u7fa4\u7ba1\u7406\u5458\u7684\u4e00\u79cd\u6311\u6218\uff0c\u56e0\u4e3a\u96c6\u7fa4\u7ba1\u7406\u5458\u9700\u8981\u5bf9\u6bcf\u79cd\u5b58\u50a8\u90fd\u6709\u6240\u4e86\u89e3\u3002\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u51e0\u4e2a\u5e38\u7528\u7684PV\u914d\u7f6e\u793a\u4f8b\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#63-\u57fa\u4e8enfs\u7684pv","title":"6.3 \u57fa\u4e8eNFS\u7684PV","text":"<p>\u521b\u5efa\u4e00\u4e2a\u57fa\u4e8eNFS\u7684PV\uff08PV\u76ee\u524d\u6ca1\u6709Namespace\u9694\u79bb\uff0c\u4e0d\u9700\u8981\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\uff0c\u5728\u4efb\u610f\u547d\u540d\u7a7a\u95f4\u4e0b\u521b\u5efa\u7684PV\u5747\u53ef\u4ee5\u5728\u5176\u4ed6Namespace\u4f7f\u7528\uff09\uff1a</p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\nname: pv0003\nspec:\ncapacity:\nstorage: 5Gi\nvolumeMode: Filesystem\naccessModes:\n- ReadWriteOnce\npersistentVolumeReclaimPolicy: Recycle\nstorageClassName: nfs-slow\nmountOptions:\n- hard\n- nfsvers=4.1\nnfs:\npath: /tmp\nserver: 172.17.0.2\n</code></pre> <ul> <li>capacity\uff1a\u5bb9\u91cf\u914d\u7f6e\u3002</li> <li>volumeMode\uff1a\u5377\u7684\u6a21\u5f0f\uff0c\u76ee\u524d\u652f\u6301Filesystem\uff08\u6587\u4ef6\u7cfb\u7edf\uff09\u548cBlock\uff08\u5757\uff09\uff0c\u5176\u4e2dBlock\u7c7b\u578b\u9700\u8981\u540e\u7aef\u5b58\u50a8\u652f\u6301\uff0c\u9ed8\u8ba4\u4e3a\u6587\u4ef6\u7cfb\u7edf\u3002l accessModes\uff1a\u8be5PV\u7684\u8bbf\u95ee\u6a21\u5f0f\u3002</li> <li>storageClassName\uff1aPV\u7684\u7c7b\uff0c\u4e00\u4e2a\u7279\u5b9a\u7c7b\u578b\u7684PV\u53ea\u80fd\u7ed1\u5b9a\u5230\u7279\u5b9a\u7c7b\u522b\u7684PVC\u3002</li> <li>persistentVolumeReclaimPolicy\uff1a\u56de\u6536\u7b56\u7565\u3002</li> <li>mountOptions\uff1a\u975e\u5fc5\u9700\uff0c\u65b0\u7248\u672c\u4e2d\u5df2\u5f03\u7528\u3002</li> <li>nfs\uff1aNFS\u670d\u52a1\u914d\u7f6e\uff0c\u5305\u62ec\u4ee5\u4e0b\u4e24\u4e2a\u9009\u9879\u3002</li> <li>path\uff1aNFS\u4e0a\u7684\u5171\u4eab\u76ee\u5f55\u3002</li> <li>server\uff1aNFS\u7684IP\u5730\u5740\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4f01\u4e1a\u5185\u7684NFS\u5f88\u6709\u53ef\u80fd\u662f\u6ca1\u6709\u9ad8\u53ef\u7528\u6027\u7684\uff0c\u6240\u4ee5\u5728\u4f01\u4e1a\u5185\u90e8\u8981\u8c28\u614e\u4f7f\u7528NFS\u4f5c\u4e3a\u540e\u53f0\u5b58\u50a8\uff0c\u53ef\u4ee5\u4f7f\u7528\u516c\u6709\u4e91\u7684NAS\u670d\u52a1\uff0c\u548cNFS\u7684\u534f\u8bae\u4e00\u81f4\uff0c\u6216\u8005\u4f7f\u7528\u652f\u6301\u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u6bd4\u5982Ceph\u7b49\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#64-\u57fa\u4e8ehostpath\u7684pv","title":"6.4 \u57fa\u4e8eHostPath\u7684PV","text":"<p>\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u57fa\u4e8ehostPath\u7684PV\uff0c\u548c\u914d\u7f6eNFS\u7684PV\u7c7b\u4f3c\uff0c\u53ea\u9700\u8981\u914d\u7f6ehostPath\u5b57\u6bb5\u5373\u53ef\uff0c\u5176\u4ed6\u914d\u7f6e\u57fa\u672c\u4e00\u81f4\uff1a</p> <pre><code>kind: PersistentVolume\napiVersion: v1\nmetadata:\nname: task-pv-volume\nlabels:\ntype: local\nspec:\nstorageClassName: manual\ncapacity:\nstorage: 10Gi\naccessModes:\n- ReadWriteOnce\nhostPath:\npath: \"/mnt/data\"\n</code></pre> <p>\u914d\u7f6e\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>hostPath\uff1a\u5bbf\u4e3b\u673a\u8def\u5f84\u914d\u7f6e\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>\u4f7f\u7528hostPath\u7c7b\u578b\u9700\u8981\u56fa\u5b9aPod\u6240\u5728\u7684\u8282\u70b9\uff0c\u9632\u6b62Pod\u6f02\u79fb\u9020\u6210\u6570\u636e\u4e22\u5931\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#65-\u57fa\u4e8eceph-rbd\u7684pv","title":"6.5 \u57fa\u4e8eCeph RBD\u7684PV","text":"<p>Ceph\u53ef\u80fd\u662f\u76ee\u524d\u4f01\u4e1a\u5185\u6700\u5e38\u7528\u7684\u4e00\u79cd\u5206\u5e03\u5f0f\u5b58\u50a8\u4e4b\u4e00\uff0c\u540c\u65f6\u652f\u6301\u6587\u4ef6\u7cfb\u7edf\u3001\u5757\u5b58\u50a8\u53ca\u5bf9\u8c61\u5b58\u50a8\uff0c\u548c\u4e0a\u8ff0NFS\u548cHostPath\u76f8\u6bd4\uff0c\u5177\u6709\u9ad8\u53ef\u7528\u6027\u548c\u8bfb\u5199\u9ad8\u6548\u6027\u3002 \u63a5\u4e0b\u6765\u770b\u4e00\u4e0bCeph RBD\u7c7b\u578b\u7684PV\u914d\u7f6e\uff1a</p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\nname: ceph-rbd-pv\nspec:\ncapacity:\nstorage: 1Gi\naccessModes:\n- ReadWriteOnce\nrbd:\nmonitors:\n- 192.168.1.123:6789\n- 192.168.1.124:6789\n- 192.168.1.125:6789\npool: rbd\nimage: ceph-rbd-pv-test\nuser: admin\nsecretRef:\nname: ceph-secret\nfsType: ext4\nreadOnly: false\n</code></pre> <p>\u914d\u7f6e\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>monitors\uff1aCeph\u7684monitor\u8282\u70b9\u7684IP\u3002</li> <li>pool\uff1a\u6240\u7528Ceph Pool\u7684\u540d\u79f0\uff0c\u53ef\u4ee5\u4f7f\u7528ceph osd pool ls\u67e5\u770b\u3002</li> <li>image\uff1aCeph\u5757\u8bbe\u5907\u4e2d\u7684\u78c1\u76d8\u6620\u50cf\u6587\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528rbd create POOL_NAME/IMAGE_NAME--size 1024\u521b\u5efa\uff0c\u4f7f\u7528rbd list POOL_NAME\u67e5\u770b\u3002</li> <li>user\uff1aRados\u7684\u7528\u6237\u540d\uff0c\u9ed8\u8ba4\u662fadmin\u3002</li> <li>secretRef\uff1a\u7528\u4e8e\u9a8c\u8bc1Ceph\u8eab\u4efd\u7684\u5bc6\u94a5\u3002</li> <li>fsType\uff1a\u6587\u4ef6\u7c7b\u578b\uff0c\u53ef\u4ee5\u662fExt4\u3001XFS\u7b49\u3002</li> <li>readOnly\uff1a\u662f\u5426\u662f\u53ea\u8bfb\u6302\u8f7d\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>Ceph\u7684Pool\u548cImage\u9700\u8981\u63d0\u524d\u521b\u5efa\u624d\u80fd\u4f7f\u7528\u3002</p> <p>\u867d\u7136\u524d\u9762\u8bb2\u8ff0\u4e86RBD\u7c7b\u578b\u7684PV\u914d\u7f6e\u793a\u4f8b\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u5927\u591a\u6570Ceph\u5b58\u50a8\u7684\u4f7f\u7528\u90fd\u662f\u91c7\u7528\u52a8\u6001\u5b58\u50a8\u7684\u65b9\u5f0f\uff0c\u5f88\u5c11\u901a\u8fc7\u9759\u6001\u65b9\u5f0f\u53bb\u7ba1\u7406\u3002</p> <p>\u540c\u65f6\uff0cKubernetes\u6240\u6709\u7684\u8282\u70b9\u90fd\u9700\u8981\u5b89\u88c5ceph-common\u624d\u80fd\u6b63\u5e38\u6302\u8f7dCeph\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#66-pv\u7684\u72b6\u6001","title":"6.6 PV\u7684\u72b6\u6001","text":"<p>\u5728\u521b\u5efaPV\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7kubectl get pv\u67e5\u770b\u5df2\u7ecf\u521b\u5efa\u7684PV\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pv\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                            STORAGECLASS                        REASON   AGE\ngitlab-postgresql-pv                       200Gi      RWO            Retain           Bound    kube-ops/gitlab-postgresql-pvc   managed-nfs-storage                          115d\ngitlab-pv                                  500Gi      RWO            Retain           Bound    kube-ops/gitlab-pvc              managed-nfs-storage  </code></pre> <p>\u5176\u4e2d\u6709\u4e00\u4e2a\u5b57\u6bb5STATUS\u8868\u793a\u5f53\u524dPV\u7684\u72b6\u6001\uff0c\u4f1a\u6709\u4ee5\u4e0b\u51e0\u79cd\u72b6\u6001\uff1a</p> <ul> <li>Available\uff1a\u53ef\u7528\uff0c\u6ca1\u6709\u88abPVC\u7ed1\u5b9a\u7684\u7a7a\u95f2\u8d44\u6e90\u3002</li> <li>Bound\uff1a\u5df2\u7ed1\u5b9a\uff0c\u5df2\u7ecf\u88abPVC\u7ed1\u5b9a\u3002</li> <li>Released\uff1a\u5df2\u91ca\u653e\uff0cPVC\u88ab\u5220\u9664\uff0c\u4f46\u662f\u8d44\u6e90\u8fd8\u672a\u88ab\u91cd\u65b0\u4f7f\u7528\u3002</li> <li>Failed\uff1a\u5931\u8d25\uff0c\u81ea\u52a8\u56de\u6536\u5931\u8d25\u3002</li> </ul>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#7-persistentvolumeclaim","title":"7. PersistentVolumeClaim","text":"<p>\u7531Kubernetes\u7ba1\u7406\u5458\u63d0\u524d\u521b\u5efa\u4e86PV\uff0c\u6211\u4eec\u5e94\u8be5\u600e\u6837\u4f7f\u7528\u5b83\u5462\uff1f</p> <p>\u8fd9\u91cc\u4ecb\u7ecdKubernetes\u7684\u53e6\u4e00\u4e2a\u6982\u5ff5PersistentVolumeClaim\uff08 \u7b80 \u79f0 PVC\uff09\u3002</p> <p>PVC\u662f\u5176\u4ed6\u6280\u672f\u4eba\u5458\u5728Kubernetes\u4e0a\u5bf9\u5b58\u50a8\u7684\u7533\u8bf7\uff0c\u5b83\u53ef\u4ee5\u6807\u660e\u4e00\u4e2a\u7a0b\u5e8f\u9700\u8981\u7528\u5230\u4ec0\u4e48\u6837\u7684\u540e\u7aef\u5b58\u50a8\u3001\u591a\u5927\u7684\u7a7a\u95f4\u4ee5\u53ca\u4ee5\u4ec0\u4e48\u8bbf\u95ee\u6a21\u5f0f\u8fdb\u884c\u6302\u8f7d\u3002 \u8fd9\u4e00\u70b9\u548cPod\u7684QoS\u914d\u7f6e\u7c7b\u4f3c\uff0cPod\u6d88\u8017\u8282\u70b9\u8d44\u6e90\uff0cPVC\u6d88\u8017PV\u8d44\u6e90\uff0cPod\u53ef\u4ee5\u8bf7\u6c42\u7279\u5b9a\u7ea7\u522b\u7684\u8d44\u6e90\uff08CPU\u548c\u5185\u5b58\uff09\uff0cPVC\u53ef\u4ee5\u8bf7\u6c42\u7279\u5b9a\u7684\u5927\u5c0f\u548c\u8bbf\u95ee\u6a21\u5f0f\u7684PV\u3002</p> <p>\u4f8b\u5982\u7533\u8bf7\u4e00\u4e2a\u5927\u5c0f\u4e3a5Gi\u4e14\u53ea\u80fd\u88ab\u4e00\u4e2aPod\u53ea\u8bfb\u8bbf\u95ee\u7684\u5b58\u50a8\u3002</p> <p>\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u867d\u7136\u7528\u6237\u901a\u8fc7PVC\u83b7\u53d6\u5b58\u50a8\u652f\u6301\uff0c\u4f46\u662f\u7528\u6237\u53ef\u80fd\u9700\u8981\u5177\u6709\u4e0d\u540c\u6027\u8d28\u7684PV\u6765\u89e3\u51b3\u4e0d\u540c\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u4f7f\u7528SSD\u786c\u76d8\u6765\u63d0\u9ad8\u6027\u80fd\u3002 \u6240\u4ee5\u96c6\u7fa4\u7ba1\u7406\u5458\u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u5b58\u50a8\u540e\u7aef\u6765\u63d0\u4f9b\u5404\u79cdPV\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u5927\u5c0f\u548c\u8bbf\u95ee\u6a21\u5f0f\u7684\u533a\u522b\uff0c\u5e76\u4e14\u65e0\u987b\u8ba9\u7528\u6237\u4e86\u89e3\u8fd9\u4e9b\u5377\u7684\u5177\u4f53\u5b9e\u73b0\u65b9\u5f0f\u548c\u5b58\u50a8\u7c7b\u578b\uff0c\u8fbe\u5230\u4e86\u5b58\u50a8 \u7684\u89e3\u85d5\uff0c\u964d\u4f4e\u4e86\u5b58\u50a8\u4f7f\u7528\u7684\u590d\u6742\u5ea6\u3002</p> <p>\u57288.6\u8282\u7684PV\u90e8\u5206\uff0c\u6211\u4eec\u5217\u4e3e\u4e86\u51e0\u4e2a\u5e38\u7528\u7684\u5b58\u50a8\u7c7b\u578b\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u5982\u4f55\u8ba9PVC\u548c\u8fd9\u4e9bPV\u7ed1\u5b9a\u3002</p> <p>\u6ce8\u610f</p> <p>PVC\u548cPV\u8fdb\u884c\u7ed1\u5b9a\u7684\u524d\u63d0\u6761\u4ef6\u662f\u4e00\u4e9b\u53c2\u6570\u5fc5\u987b\u5339\u914d\uff0c\u6bd4\u5982accessModes\u3001storageClassName\u3001volumeMode\u90fd\u9700\u8981\u76f8\u540c\uff0c \u5e76\u4e14PVC\u7684storage\u9700\u8981\u5c0f\u4e8e\u7b49\u4e8ePV\u7684storage\u914d\u7f6e\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#71-pvc\u7684\u521b\u5efa","title":"7.1 PVC\u7684\u521b\u5efa","text":"<p>\u6b64\u65f6\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aPVC\u5373\u53ef\u4e0e\u5176\u7ed1\u5b9a\uff08\u6ce8\u610fPV\u548cPVC\u52a0\u7c97\u7684\u90e8\u5206\uff0cPV\u548cPVC\u8fdb\u884c\u7ed1\u5b9a\u5e76\u975e\u662f\u540d\u5b57\u76f8\u540c\uff0c\u800c\u662fStorageClassName\u76f8\u540c\u4e14\u5176\u4ed6\u53c2\u6570\u4e00\u81f4\u624d\u53ef\u4ee5\u8fdb\u884c\u7ed1\u5b9a\uff09\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>kind: PersistentVolume\napiVersion: v1\nmetadata:\nname: task-pv-volume\nlabels:\ntype: local\nspec:\nstorageClassName: manual\ncapacity:\nstorage: 10Gi\naccessModes:\n- ReadWriteOnce\nhostPath:\npath: \"/mnt/data\"\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\nname: task-pv-claim\nspec:\nstorageClassName: manual\naccessModes:\n- ReadWriteOnce\nresources:\nrequests:\nstorage: 3Gi\n</code></pre> <p>\u6ce8\u610f</p> <p>PVC\u5177\u6709\u547d\u540d\u7a7a\u95f4\u9694\u79bb\u6027\uff0c\u4e0a\u8ff0\u4ee3\u7801\u6ca1\u6709\u6dfb\u52a0namespace\u53c2\u6570\uff0c\u4f1a\u9ed8\u8ba4\u521b\u5efa\u5728default\u547d\u540d\u7a7a\u95f4\u3002</p> <p>\u5982\u679c\u9700\u8981\u7ed9\u5176\u4ed6\u547d\u540d\u7a7a\u95f4\u7684Pod\u4f7f\u7528\uff0c\u5c31\u5e94\u5c06\u5176\u521b\u5efa\u5728\u6307\u5b9a\u7684\u547d\u540d\u7a7a\u95f4\u3002</p> <p>\u540c\u6837\u7684\u65b9\u5f0f\u4e5f\u53ef\u4ee5\u7ed9NFS\u7c7b\u578b\u7684PV\u521b\u5efa\u4e00\u4e2aPVC\uff1a</p> <pre><code>kind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\nname: pvc-nfs\nspec:\nstorageClassName: nfs-slow\naccessModes:\n- ReadWriteOnce\nresources:\nrequests:\nstorage: 3Gi\n</code></pre> <p>\u4ece\u4e0a\u8ff0\u4e24\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa\uff0cPVC\u7684\u5b9a\u4e49\u548c\u540e\u7aef\u5b58\u50a8\u5e76\u6ca1\u6709\u5173\u7cfb\u3002</p> <p>\u5bf9\u4e8e\u6709\u5b58\u50a8\u9700\u6c42\u7684\u6280\u672f\u4eba\u5458\uff0c\u76f4\u63a5\u5b9a\u4e49PVC\u5373\u53ef\u7ed1\u5b9a\u4e00\u5757PV\uff0c\u4e4b\u540e\u5c31\u53ef\u4ee5\u4f9bPod\u4f7f\u7528\uff0c\u800c\u4e0d\u7528\u53bb\u5173\u5fc3\u5177\u4f53\u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u5b58\u50a8\u7684\u590d\u6742\u5ea6\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u4e00\u4e0bPVC\u5982\u4f55\u63d0\u4f9b\u7ed9Pod\u4f7f\u7528\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#72-pvc\u7684\u4f7f\u7528","title":"7.2 PVC\u7684\u4f7f\u7528","text":"<p>\u4e0a\u8ff0\u521b\u5efa\u4e86PV\uff0c\u5e76\u4f7f\u7528PVC\u4e0e\u5176\u7ed1\u5b9a\uff0c\u73b0\u5728\u8fd8\u5dee\u4e00\u6b65\u5c31\u80fd\u8ba9\u7a0b\u5e8f\u4f7f\u7528\u8fd9\u5757\u5b58\u50a8\uff0c\u90a3\u5c31\u662f\u5c06PVC\u6302\u8f7d\u5230Pod\u3002\u548c\u4e4b\u524d\u7684\u6302\u8f7d\u65b9\u5f0f\u7c7b\u4f3c\uff0cPVC\u7684\u6302\u8f7d\u4e5f\u662f\u901a\u8fc7volumes\u5b57\u6bb5\u8fdb\u884c\u914d\u7f6e\u7684\uff0c\u53ea\u4e0d\u8fc7\u4e4b\u524d\u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u5b58\u50a8\u540e\u7aef\u586b\u5199\u5f88\u591a\u590d\u6742\u7684\u53c2\u6570\uff0c\u800c\u4f7f\u7528PVC\u8fdb\u884c\u6302\u8f7d\u65f6\uff0c\u53ea\u586b\u5199PVC\u7684\u540d\u5b57\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u518d\u5173\u5fc3\u4efb\u4f55\u7684\u5b58\u50a8\u7ec6\u8282\uff0c\u8fd9\u6837\u5373\u4f7f\u4e0d\u662fKubernetes\u7ba1\u7406\u5458\uff0c\u4e0d\u61c2\u5b58\u50a8\u7684\u5176\u4ed6\u6280\u672f\u4eba\u5458\u60f3\u8981\u4f7f\u7528\u5b58\u50a8\uff0c\u4e5f\u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u5730\u8fdb\u884c\u914d\u7f6e\u548c\u4f7f\u7528\u3002</p> <p>\u6bd4\u5982\u6211\u4eec\u5c06\u4e4b\u524d\u521b\u5efa\u7684hostPath\u7c7b\u578b\u7684PVC\u6302\u8f7d\u5230Pod\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u53ea\u9700\u8981\u914d\u7f6e\u4e00\u4e2apersistentVolumeClaim\u7c7b\u578b\u7684volumes\uff0cclaimName\u914d\u7f6e\u4e3aPVC\u7684\u540d\u79f0\u5373\u53ef\uff1a</p> <pre><code>kind: Pod\napiVersion: v1\nmetadata:\nname: task-pv-pod\nspec:\nvolumes:\n- name: task-pv-storage\npersistentVolumeClaim:\nclaimName: task-pv-claim\ncontainers:\n- name: task-pv-container\nimage: nginx\nports:\n- containerPort: 80\nname: \"http-server\"\nvolumeMounts:\n- mountPath: \"/usr/share/nginx/html\"\nname: task-pv-storage\n</code></pre> <p>\u6ce8\u610f</p> <p>claimName\u9700\u8981\u548c\u4e0a\u8ff0\u5b9a\u4e49\u7684PVC\u540d\u79f0task-pv-claim\u4e00\u81f4\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#8\u52a8\u6001\u5b58\u50a8storageclass","title":"8.\u52a8\u6001\u5b58\u50a8StorageClass","text":"<p>\u867d\u7136\u4f7f\u7528PV\u548cPVC\u80fd\u5c4f\u853d\u4e00\u4e9b\u5b58\u50a8\u4f7f\u7528\u4e0a\u7684\u7ec6\u8282\uff0c\u964d\u4f4e\u4e86\u5b58\u50a8\u4f7f\u7528\u7684\u590d\u6742\u5ea6\uff0c\u4f46\u662f\u4e5f\u4f1a\u6709\u53e6\u4e00\u4e2a\u95ee\u9898\u65e0\u6cd5\u89e3\u51b3\u3002</p> <p>\u5f53\u516c\u53f8Kubernetes\u96c6\u7fa4\u5f88\u591a\uff0c\u5e76\u4e14\u4f7f\u7528\u5b83\u4eec\u7684\u6280\u672f\u4eba\u5458\u8fc7\u591a\u65f6\uff0c\u5bf9\u4e8ePV\u7684\u521b\u5efa\u662f\u4e00\u4e2a\u5f88\u8017\u65f6\u3001\u8017\u529b\u7684\u5de5\u4f5c\uff0c\u5e76\u4e14\u8fbe\u5230\u4e00\u5b9a\u89c4\u6a21\u540e\uff0c\u8fc7\u591a\u7684PV\u5c06\u96be\u4ee5\u7ef4\u62a4\u3002</p> <p>\u6240\u4ee5\u5c31\u9700\u8981\u67d0\u79cd\u673a\u5236\u7528\u4e8e\u81ea\u52a8\u7ba1\u7406PV\u7684\u751f\u547d\u5468\u671f\uff0c\u6bd4\u5982\u521b\u5efa\u3001\u5220\u9664\u3001\u81ea\u52a8\u6269\u5bb9\u7b49\uff0c\u4e8e\u662fKubernetes\u5c31\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u540d\u4e3aStorageClass\uff08\u7f29\u5199\u4e3aSC\uff0c\u6ca1\u6709\u547d\u540d\u7a7a\u95f4\u9694\u79bb\u6027\uff09\u7684\u4e1c\u897f\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u52a8\u6001\u7ba1\u7406\u96c6\u7fa4\u4e2d\u7684PV\uff0c\u8fd9\u6837Kubernetes\u7ba1\u7406\u5458\u5c31\u65e0\u987b\u6d6a\u8d39\u5927\u91cf\u7684\u65f6\u95f4\u5728PV\u7684\u7ba1\u7406\u4e2d\u3002</p> <p>\u5728Kubernetes\u4e2d\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u53ea\u521b\u5efaStorageClass\u201c\u94fe\u63a5\u201d\u5230\u540e\u7aef\u4e0d\u540c\u7684\u5b58\u50a8\uff0c\u6bd4\u5982Ceph\u3001GlusterFS\u3001OpenStack\u7684Cinder\u3001\u5176\u4ed6\u516c\u6709\u4e91\u63d0\u4f9b\u7684\u5b58\u50a8\u7b49\uff0c\u4e4b\u540e\u6709\u5b58\u50a8\u9700\u6c42\u7684\u6280\u672f\u4eba\u5458\uff0c\u521b\u5efa\u4e00\u4e2aPVC\u6307\u5411\u5bf9\u5e94\u7684StorageClass\u5373\u53ef\uff0cStorageClass\u4f1a\u81ea\u52a8\u521b\u5efaPV\u4f9bPod\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528StatefulSet\u7684volumeClaimTemplate\u81ea\u52a8\u5206\u522b\u4e3a\u6bcf\u4e2aPod\u7533\u8bf7\u4e00\u4e2aPVC\u3002</p> <p>\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u5982\u4f55\u5b9a\u4e49\u4e00\u4e2aStorageClass\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#81-\u5b9a\u4e49storageclass","title":"8.1 \u5b9a\u4e49StorageClass","text":"<p>\u5b9a\u4e49\u4e00\u4e2aStorageClass\u7684\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\nname: slow\nprovisioner: kubernetes.io/glusterfs\nparameters:\nresturl: \"http://127.0.0.1:8081\"\nclusterid: \"630372ccdc720a92c681fb928f27b53f\"\nrestauthenabled: \"true\"\nrestuser: \"admin\"\nsecretNamespace: \"default\"\nsecretName: \"heketi-secret\"\ngidMin: \"40000\"\ngidMax: \"50000\"\nvolumetype: \"replicate:3\"\n</code></pre> <p>\u8be5\u793a\u4f8b\u662f\u4f7f\u7528StorageClass\u94fe\u63a5GlusterFS\u7684\u4e00\u4e2a\u793a\u4f8b\uff0cPV\u548cVolume\u53ef\u4ee5\u76f4\u63a5\u914d\u7f6eGlusterFS\uff0c\u5176\u914d\u7f6e\u53c2\u6570\u548cStorageClass\u7684parameters\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7PV\u662f\u5355\u72ec\u4f9bPVC\u4f7f\u7528\u7684\uff0c</p> <p>Volume\u662f\u9488\u5bf9\u67d0\u4e2aPod\u4f7f\u7528\u7684\uff0c\u800cStorageClass\u662f\u4e00\u4e2a\u5168\u5c40\u7684\u914d\u7f6e\uff0c\u6ca1\u6709\u547d\u540d\u7a7a\u95f4\u9694\u79bb\u6027\uff0c\u4efb\u4f55\u547d\u540d\u7a7a\u95f4\u4e0b\u6709\u5b58\u50a8\u9700\u6c42\u7684\u5e94\u7528\u90fd\u53ef\u4ee5\u914d\u7f6e\u5bf9\u5e94\u7684StorageClass\u6765\u83b7\u53d6\u5b58\u50a8\u3002</p> <p>StorageClass\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u66f4\u9ad8\u7ea7\u7684\u914d\u7f6e\uff0c\u6bd4\u5982provisioner\u3001parameters\u3001reclaimPolicy\u3001allowVolumeExpansion\u7b49\u3002</p> <ul> <li>Provisioner\uff1a\u76f4\u8bd1\u8fc7\u6765\u662f\u4f9b\u5e94\u5546\u7684\u610f\u601d\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u8be5\u53c2\u6570\u6765\u6807\u660e\u5bf9\u4e8ePV\u7684\u521b\u5efa\u4f7f\u7528\u54ea\u4e2a\u63d2\u4ef6\u6765\u6267\u884c\uff0c\u6bd4\u5982\u521b\u5efaGlusterFS\u7c7b\u578b\u7684PV\uff0c\u9700\u8981\u4f7f\u7528GlusterFS\u7684\u63d2\u4ef6\u624d\u80fd\u521b\u5efa\uff0c\u5fc5\u987b\u6307\u5b9a\u6b64\u5b57\u6bb5\u3002</li> </ul> <p>\u76ee\u524d\u5b98\u65b9\u652f\u6301\u7684Provisioner\u53ef\u4ee5\u5728\u6b64\u5904\u67e5\u770b\uff1ahttps://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner\u3002</p> <p>\u6ce8\u610f</p> <p>Provisioner\u4e0d\u4ec5\u9650\u4e8e\u5b98\u65b9\u5217\u51fa\u7684\u5185\u90e8provisioner\uff0c\u8fd8\u53ef\u4ee5\u8fd0\u884c\u548c\u6307\u5b9a\u5916\u90e8\u4f9b\u5e94\u5546\u3002</p> <p>\u4f8b\u5982\uff0cNFS\u4e0d\u63d0\u4f9b\u5185\u90e8\u914d\u7f6e\u7a0b\u5e8f\uff0c\u4f46\u662f\u53ef\u4ee5\u4f7f\u7528\u5916\u90e8\u914d\u7f6e\u7a0b\u5e8f\uff0c\u5916\u90e8\u914d\u7f6e\u65b9\u5f0f\u53c2\u89c1\u7f51\u5740\uff08\u5176\u4ed6\u7c7b\u578b\u7684\u5b58\u50a8\u53ef\u4ee5\u5728\u5176\u5b98\u65b9\u6587\u6863\u6216\u8005GitHub\u8fdb\u884c\u67e5\u627e\uff09\uff1a</p> <p>https://github.com/kubernetes-incubator/external-storage\u3002</p> <ul> <li>Parameters\uff1a\u9488\u5bf9\u540e\u7aef\u914d\u7f6e\u7684\u4e0d\u540c\u53c2\u6570\uff0c\u6bd4\u5982\u4e0a\u8ff0\u7684GlusterFS\u7c7b\u578b\u7684StorageClass\uff0c\u53ef\u4ee5\u6307\u5b9a\u6570\u636e\u7684\u526f\u672c\u6570\uff08replicate:3\uff09\u3001Gluster REST\u670d\u52a1/Heketi\u670d\u52a1\u7684URL\u7b49\u3002\u8be5\u53c2\u6570\u7684\u5b9a\u4e49\u53d6\u51b3\u4e8eprovisioner\uff0c\u4e0d\u540c\u7684provisioner\u914d\u7f6e\u7684\u53c2\u6570\u4e0d\u540c\u3002\u5982\u679c\u8be5\u53c2\u6570\u7701\u7565\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002</li> <li>ReclaimPolicy\uff1a\u56de\u6536\u7b56\u7565\uff0c\u53ef\u4ee5\u662fDelete\u3001Retain\uff0c\u9ed8\u8ba4\u4e3aDelete\uff0c\u4e5f\u5c31\u662fPVC\u88ab\u5220\u9664\u540e\uff0c\u5bf9\u5e94\u7684PV\u5982\u4f55\u5904\u7406\u3002</li> <li>MountOptions\uff1a\u901a\u8fc7StorageClass\u52a8\u6001\u521b\u5efa\u7684PV\u53ef\u4ee5\u4f7f\u7528MountOptions\u6307\u5b9a\u6302\u8f7d\u53c2\u6570\u3002\u5982\u679c\u6307\u5b9a\u7684\u5377\u63d2\u4ef6\u4e0d\u652f\u6301\u6307\u5b9a\u7684\u6302\u8f7d\u9009\u9879\uff0c\u5c31\u4e0d\u4f1a\u88ab\u521b\u5efa\u6210\u529f\uff0c\u56e0\u6b64\u5728\u8bbe\u7f6e\u65f6\u9700\u8981\u8fdb\u884c\u786e\u8ba4\u3002</li> <li>AllowVolumeExpansion\uff1a\u662f\u5426\u5141\u8bb8\u5bf9PV\u8fdb\u884c\u6269\u5bb9\uff0c\u9700\u8981\u540e\u7aef\u5b58\u50a8\u652f\u6301\uff0c\u4e00\u822c\u4e0d\u63a8\u8350\u8fdb\u884c\u7f29\u5bb9\u3002\u76ee\u524d\u652f\u6301\u6269\u5bb9\u7684\u5b58\u50a8\u7c7b\u578b\u53ef\u4ee5\u5728\u4ee5\u4e0b\u6587\u6863\u67e5\u770b\uff1ahttps://kubernetes.io/docs/concepts/storage/storage-classes/#allow-volume-expansion\u3002</li> </ul> <p>\u8be5\u5c0f\u8282\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\u6765\u8bf4\u660e\u5982\u4f55\u914d\u7f6e\u4e00\u4e2aStorageClass\uff0c\u5bf9\u4e8e\u5176\u4ed6\u4e0d\u540c\u7c7b\u578b\u7684\u5b58\u50a8\u914d\u7f6e\u65b9\u5f0f\u53ea\u662fparameters\u4e0d\u4e00\u6837\uff0c\u4f7f\u7528\u65b9\u5f0f\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5176\u4ed6\u7c7b\u578b\u7684\u5b58\u50a8\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863\uff1ahttps://kubernetes.io/docs/concepts/storage/storage-classes/#parameters\u3002</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7\u4e00\u4e2aCeph RBD\u7684\u793a\u4f8b\u6765\u6f14\u793a\u4e00\u4e0bStorageClass\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#82-\u6574\u5408storageclass\u548cceph-rbd","title":"8.2 \u6574\u5408StorageClass\u548cCeph RBD","text":"<ol> <li>Kubernetes\u96c6\u7fa4\u7684\u5b89\u88c5\u53ef\u4ee5\u53c2\u8003\u672c\u4e66\u5b89\u88c5\u7bc7</li> <li>Ceph\u96c6\u7fa4\u7684\u642d\u5efa\u53ef\u4ee5\u53c2\u8003\u5176\u5b98\u65b9\u6587\u6863\uff1ahttps://docs.ceph.com/en/latest/install/</li> </ol> <p>\u672c\u5c0f\u8282\u5185\u5bb9\u5047\u5b9a\u5b9e\u9a8c\u73af\u5883\u5df2\u7ecf\u6709\u4e86Kubernetes\u96c6\u7fa4\u548cCeph\u96c6\u7fa4\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#821-\u90e8\u7f72ceph-rbd-provisioner","title":"8.2.1 \u90e8\u7f72Ceph RBD Provisioner","text":"<p>provi-cephrbd.yaml</p> <pre><code>---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: rbd-provisioner\nnamespace: kube-system\nrules:\n- apiGroups: [\"\"]\nresources: [\"persistentvolumes\"]\nverbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n- apiGroups: [\"\"]\nresources: [\"persistentvolumeclaims\"]\nverbs: [\"get\", \"list\", \"watch\", \"update\"]\n- apiGroups: [\"storage.k8s.io\"]\nresources: [\"storageclasses\"]\nverbs: [\"get\", \"list\", \"watch\"]\n- apiGroups: [\"\"]\nresources: [\"events\"]\nverbs: [\"create\", \"update\", \"patch\"]\n- apiGroups: [\"\"]\nresources: [\"services\"]\nresourceNames: [\"kube-dns\",\"coredns\"]\nverbs: [\"list\", \"get\"]\n- apiGroups: [\"\"]\nresources: [\"endpoints\"]\nverbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: rbd-provisioner\nnamespace: kube-system\nsubjects:\n- kind: ServiceAccount\nname: rbd-provisioner\nnamespace: kube-system\nroleRef:\nkind: ClusterRole\nname: rbd-provisioner\napiGroup: rbac.authorization.k8s.io\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\nname: rbd-provisioner\nnamespace: kube-system\nrules:\n- apiGroups: [\"\"]\nresources: [\"secrets\"]\nverbs: [\"get\"]\n- apiGroups: [\"\"]\nresources: [\"endpoints\"]\nverbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\nname: rbd-provisioner\nnamespace: kube-system\nroleRef:\napiGroup: rbac.authorization.k8s.io\nkind: Role\nname: rbd-provisioner\nsubjects:\n- kind: ServiceAccount\nname: rbd-provisioner\nnamespace: kube-system\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: rbd-provisioner\nnamespace: kube-system\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: rbd-provisioner\nstrategy:\ntype: Recreate\ntemplate:\nmetadata:\nlabels:\napp: rbd-provisioner\nspec:\ncontainers:\n- name: rbd-provisioner\nimage: \"registry.cn-beijing.aliyuncs.com/dotbalo/rbd-provisioner:latest\"\nenv:\n- name: PROVISIONER_NAME\nvalue: ceph.com/rbd\n</code></pre> <p>\u9996\u5148\u5b89\u88c5Ceph RBD\u7684Provisioner\uff0c\u76f4\u63a5\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5373\u53ef\u5b89\u88c5Ceph RBD Provisioner\uff0c\u5e76\u521b\u5efa\u5176\u76f8\u5173\u7684\u6743\u9650\uff1a</p> <pre><code>$ kubectl  apply -f provi-cephrbd.yaml\nserviceaccount/rbd-provisioner created\nclusterrole.rbac.authorization.k8s.io/rbd-provisioner created\nclusterrolebinding.rbac.authorization.k8s.io/rbd-provisioner created\nrole.rbac.authorization.k8s.io/rbd-provisioner created\nrolebinding.rbac.authorization.k8s.io/rbd-provisioner created\ndeployment.apps/rbd-provisioner created\n</code></pre> <p>\u67e5\u770bPod\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pods -n kube-system -l app=rbd-provisioner\n</code></pre>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#822-\u521b\u5efaceph-pool","title":"8.2.2 \u521b\u5efaCeph Pool","text":"<p>\u63a5\u4e0b\u6765\u521b\u5efa\u4e00\u4e2aKubernetes\u4e13\u7528\u7684Pool\u4e3aPod\u63d0\u4f9bPV\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5df2\u7ecf\u5b58\u5728\u7684Pool\u3002</p> <p>\u767b\u5f55Ceph\u7684\u7ba1\u7406\u7aef\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3arbdfork8s\u3001pg_num\u4e3a128\uff08\u751f\u4ea7\u73af\u5883\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u914d\u7f6epg_num\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003Ceph\u6587\u6863\uff09\u7684Pool\uff1a</p> <pre><code>$ ceph osd pool create rbdfork8s 128\npool 'rbdfork8s' created\n</code></pre> <p>\u5bf9\u65b0\u5efa\u7684Pool\u8fdb\u884c\u5355\u72ec\u6388\u6743\uff1a</p> <pre><code>$ ceph auth add client.kube mon 'allow r' osd 'allow rwx pool=rbdfork8s'\nadded key for client.kube\n</code></pre> <p>\u521d\u59cb\u5316\u8be5Pool\uff08\u4e0d\u662f\u65b0\u5efa\u7684Pool\u65e0\u987b\u521d\u59cb\u5316\uff09\uff1a</p> <pre><code>$ ceph osd pool application enable rbdfork8s rbd\nenabled application 'rbd' on pool 'rbdfork8s'\n$ rbd pool init rbdfork8s\n</code></pre> <p>\u67e5\u770bclient.kube\u7684Key\uff1a</p> <pre><code>$ ceph auth get-key client.kube\nAQB/eopgaqSRJxAAYDs2gKTXSpcpY2m+yHJaJw==\n</code></pre> <p>\u5728Kubernetes\u4e2d\u521b\u5efa\u5177\u6709\u8be5Key\u7684Secret\uff0c\u4f9bStorageClass\u914d\u7f6e\u4f7f\u7528\uff1a</p> <pre><code>$ kubectl create secret generic ceph-k8s-secret \\\n--type=\"kubernetes.io/rbd\" \\\n--from-literal=key='AQB/eopgaqSRJxAAYDs2gKTXSpcpY2m+yHJaJw==' \\\n-n kube-system\n</code></pre> <p>admin\u7528\u6237\u7684Key\u4e5f\u8981\u521b\u5efa\u4e00\u4e2aSecret\u4f9bStorageClass\u4f7f\u7528\uff0c\u67e5\u770bceph admin\u7684Key\uff1a</p> <pre><code>$ ceph auth get-key client.admin\nAQA8HP9ezBHPDBAAdL+NteK0d1mjXZV47r4I7w==\n</code></pre> <p>\u5c06Key\u4fdd\u5b58\u5728Kubernetes\u7684Secret\u4e2d\uff1a</p> <pre><code>$ kubectl create secret generic ceph-admin-secret \\\n--type=\"kubernetes.io/rbd\" \\\n--from-literal=key='AQA8HP9ezBHPDBAAdL+NteK0d1mjXZV47r4I7w==' \\\n-n kube-system\n\n$ kubectl get secret -n kube-system ceph-admin-secret\n</code></pre>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#823-\u521b\u5efastorageclass","title":"8.2.3 \u521b\u5efaStorageClass","text":"<p>\u5728Ceph\u7684\u7ba1\u7406\u7aef\u67e5\u770bMonitor\u7684\u8282\u70b9\u4fe1\u606f\uff1a</p> <pre><code>$ ceph mon dump\n</code></pre> <p>\u5c06\u6253\u5370\u7684\u7ed3\u679c\u4e2d\u7684Monitor\u7684IP\u5730\u5740\u586b\u5199\u5230StorageClass\u4e2d\uff0c\u4e00\u822c\u4e3aIP\u5730\u5740+6789\u7aef\u53e3\uff08\u66ff\u6362\u4ee5\u4e0b\u6587\u4ef6\u7684monitors\u53c2\u6570\uff09\uff1a</p> <p>rbd-sc.yaml</p> <pre><code>---\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\nname: ceph-rbd\nprovisioner: ceph.com/rbd\nparameters:\nmonitors: x.x.x.x:6789,x.x.x.x:6789,x.x.x.x:6789\npool: rbdfork8s\nadminId: admin\nadminSecretNamespace: kube-system\nadminSecretName: ceph-admin-secret\nuserId: kube\nuserSecretNamespace: kube-system\nuserSecretName: ceph-k8s-secret\nimageFormat: \"2\"\nimageFeatures: layering\n</code></pre> <p>\u521b\u5efa\u8be5StorageClass\uff1a</p> <pre><code>$ kubectl create -f rbd-sc.yaml\n$ kubectl get sc\n</code></pre>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#824-\u521b\u5efapvc","title":"8.2.4 \u521b\u5efaPVC","text":"<p>\u4e4b\u540e\u521b\u5efa\u4e00\u4e2aPVC\u6307\u5411\u8be5StorageClass\uff08\u6ce8\u610fstorageClassName\u4e3a\u4e0a\u8ff0\u521b\u5efa\u7684StorageClass\u7684\u540d\u5b57\uff09\uff1a</p> <p>rbd-pvc.yaml</p> <pre><code>---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\nname: rbd-pvc-test\nspec:\naccessModes:\n- ReadWriteOnce\nstorageClassName: ceph-rbd\nresources:\nrequests:\nstorage: 100Mi\n</code></pre> <pre><code>$ kubectl create -f rbd-pvc.yaml </code></pre> <p>\u521b\u5efa\u5b8c\u6210\u4e4b\u540e\uff0cStorageClass\u4f1a\u81ea\u52a8\u521b\u5efaPV\uff0c\u7136\u540e\u4e0ePVC\u8fdb\u884c\u7ed1\u5b9a\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#9\u5b58\u50a8\u7684\u672a\u6765csi","title":"9.\u5b58\u50a8\u7684\u672a\u6765\uff1aCSI","text":"<p>\u524d\u9762\u8bb2\u89e3\u4e86Kubernetes\u5b58\u50a8\u7684\u591a\u79cd\u4f7f\u7528\u65b9\u5f0f\uff0c\u6bd4\u5982Volumes\u76f4\u8fde\u3001PV\u548c\u52a8\u6001\u5b58\u50a8StorageClass\uff0c\u867d\u7136PV\u964d\u4f4e\u4e86\u5176\u4ed6\u4eba\u5458\u4f7f\u7528\u5b58\u50a8 \u7684\u590d\u6742\u6027 \uff0c StorageClass\u4e5f\u964d\u4f4e\u4e86Kubernetes\u7ba1\u7406\u5458\u7ba1\u7406PV\u7684\u96be\u5ea6\u3002</p> <p>\u4f46\u662f\u5728Kubernetes \u53d1\u5c55\u4e2d\u8fd8\u6709\u4e00\u4e2a\u68d8\u624b\u7684\u95ee\u9898\uff0c\u5c31\u662f\u5e02\u9762\u4e0a\u76ee\u524d\u6709\u5f88\u591a\u5b58\u50a8\u63d0\u4f9b\u5546\uff0c\u6bd4\u5982NFS\u3001 Ceph\u3001NAS\u7b49\uff0c\u5b83\u4eec\u90fd\u5c5e\u4e8e\u4e0d\u540c\u7684\u201c\u5382\u5546\u201d\uff0c\u7531\u4e0d\u540c\u7684\u56e2\u961f\u7ef4\u62a4\uff0c\u800c\u6bcf\u4e2a\u516c\u53f8\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u9009\u62e9\u4e0d\u540c\u7684\u5b58\u50a8\uff0c</p> <p>Kubernetes\u4f5c\u4e3a\u4e00\u4e2a\u6bd4\u8f83\u6d41\u884c\u7684\u4e91\u539f \u751f\u64cd\u4f5c\u7cfb\u7edf\uff0c\u60f3\u8981\u6709\u66f4\u597d\u7684\u517c\u5bb9\u6027\uff0c\u5c31\u9700\u8981\u53bb\u517c\u5bb9\u8fd9\u4e9b\u5b58\u50a8\uff0c\u8fd9\u5c31\u610f\u5473\u7740 Kubernetes\u7684\u7ef4\u62a4\u4eba\u5458\u9700\u8981\u5b66\u4e60\u6bcf\u79cd\u5b58\u50a8\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u624d\u80fd\u5f00\u53d1\u51fa\u4f7f\u7528\u67d0\u7c7b \u5b58\u50a8\u7684\u529f\u80fd\uff0c\u8fd9\u5bf9\u4e8eKubernetes\u7ef4\u62a4\u4eba\u5458\u6765\u8bf4\u5c06\u662f\u4e00\u79cd\u6311\u6218\uff0c\u540c\u65f6\u968f\u7740\u5b58\u50a8\u7684\u589e\u591a\uff0cKubernetes\u7684\u4ee3\u7801\u4f1a\u663e\u5f97\u8d8a\u6765\u8d8a\u81c3\u80bf\u3001\u96be\u4ee5\u7ef4\u62a4\uff0c\u6240\u4ee5\u8981\u6709\u4e00\u79cd\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\u3002</p> <p>\u5728\u4e4b\u524d\u7684\u7ae0\u8282\u63d0\u5230\u8fc7\uff0cKubernetes\u4f5c\u4e3a\u4e00\u4e2a\u5bb9\u5668\u7684\u7f16\u6392\u5e73\u53f0\uff0c\u80fd\u591f\u8c03\u5ea6 \u591a\u79cd\u4e0d\u540c\u7684\u5bb9\u5668\u5f15\u64ce\uff0c\u6bd4\u5982Containerd\u3001Docker\uff081.24\u7248\u672c\u4e4b\u524d\uff09\u3001CRI-O \u7b49\u3002</p> <p>\u4e3a\u4e86\u80fd\u591f\u517c\u5bb9\u66f4\u591a\u7684\u5bb9\u5668\u5f15\u64ce\uff0c\u65e0\u987bKubernetes\u7ba1\u7406\u5458\u7f16\u5199\u591a\u4f59\u7684\u4ee3 \u7801\uff0cKubernetes\u63d0\u51fa\u4e86CRI\uff08Container Runtime Interface\uff0c\u5bb9\u5668\u8fd0\u884c\u65f6\u63a5 \u53e3\uff09\u7684\u6982\u5ff5\uff0c\u4efb\u4f55\u5f00\u53d1\u5bb9\u5668\u5f15\u64ce\u7684\u516c\u53f8\u53ea\u9700\u8981\u517c\u5bb9\u8fd9\u4e2a\u63a5\u53e3\uff0c\u5c31\u53ef\u4ee5\u88ab Kubernetes\u8c03\u5ea6\u3002</p> <p>\u4e3a\u5b9e\u73b0\u4e0a\u8ff0\u76ee\u6807\uff0cKubernetes\u53c8\u63d0\u51fa\u4e86\u4e00\u4e2a\u65b0\u7684\u6807\u51c6CSI\uff08Container Storage Interface\uff0c\u5bb9\u5668\u5b58\u50a8\u63a5\u53e3\uff09\uff0c\u8be5\u6807\u51c6\u76f8\u5f53\u4e8e\u5728\u5bb9\u5668\u7f16\u6392\u5e73\u53f0\u548c\u5b58\u50a8 \u4e4b\u95f4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u201c\u6865\u6881\u201d\uff0c\u53ea\u8981\u5b58\u50a8\u5e73\u53f0\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u63a5\u53e3\uff0c\u5c31\u80fd\u4e3a\u7f16\u6392\u5e73\u53f0 \uff08\u4e0d\u9650\u4e8eKubernetes\uff09\u63d0\u4f9b\u5b58\u50a8\u529f\u80fd\u3002\u8fd9\u79cd\u5b58\u50a8\u7684\u5b9e\u73b0\u9700\u8981\u5b58\u50a8\u5382\u5546\u63d0\u4f9b\u7b26\u5408CSI\u6807\u51c6\u7684\u9a71\u52a8\uff0c\u53ea\u8981\u914d\u7f6eStorageClass\u94fe\u63a5\u8be5\u9a71\u52a8\u5373\u53ef\u4e3aKubernetes\u63d0\u4f9b \u5b58\u50a8\u3002 CSI\u6807\u51c6\u5c06\u5b58\u50a8\u7684\u4ee3\u7801\u4e0b\u6c89\u5230\u4e86\u5b58\u50a8\u5382\u5546\uff0c\u800cKubernetes\u7ef4\u62a4\u4eba\u5458\u65e0\u987b \u518d\u5173\u6ce8\u5b58\u50a8\u7ec6\u8282\uff0c\u53ea\u9700\u8981\u5173\u6ce8Kubernetes\u6838\u5fc3\u4ee3\u7801\u5373\u53ef\u3002</p> <p>\u8fd9\u7c7b\u5f00\u53d1\u65b9\u5f0f\u79f0\u4e3aout-of-tree\uff0c\u610f\u601d\u5c31\u662f\u5728Kubernetes\u6838\u5fc3\u4ee3\u7801\u5916\u7ef4\u62a4\u5b9e\u73b0\u5404\u7c7b\u5b58\u50a8\u7684\u63a5\u5165\uff0c \u4e4b\u524d\u7684Volume \u3001 PV \u3001 StorageClass\u79f0\u4e3ain-tree\u7684\u5f00\u53d1\u65b9\u5f0f\uff0c\u610f\u601d\u662f\u5728Kubernetes\u5185\u90e8\u7ef4\u62a4\u5b58\u50a8\u7684\u63a5\u5165\u3002</p> <p>\u76f8\u6bd4\u4e4b\u4e0b\uff0cout-of-tree\u662f\u66f4\u4f73\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4e8e\u662f\u73b0\u5728\u5f88\u591ain-tree\u7684\u5b9e\u73b0\u65b9\u5f0f\u90fd\u5728\u6162\u6162\u5730\u5411out-of-tree\u8fc1\u79fb\u3002</p> <p>\u63d0\u793a</p> <p>\u5916\u7f6e\u5b58\u50a8\u9a71\u52a8\u9664CSI\u5916\uff0c\u8fd8\u6709\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u79f0\u4e3aFlex Volume\uff0c\u7531\u4e8e\u5df2\u7ecf\u8fc7\u65f6\uff0c\u672c\u4e66\u4e0d\u518d\u4ecb\u7ecd\u3002\u9488\u5bf9\u5b58\u50a8\u7684\u63a5\u5165\uff0c\u5e94\u8be5\u66f4\u503e\u5411\u4e8eCSI\u7684\u65b9\u5f0f\u3002</p> <p>\u4ee5\u4e0a\u7b80\u5355\u8bb2\u89e3\u4e86CSI\u7684\u6982\u5ff5\uff0c\u4e0b\u9762\u901a\u8fc7\u793a\u4f8b\u4e86\u89e3\u4e00\u4e0bCSI\u5177\u4f53\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002\u5176\u5b9eCSI\u7684\u914d\u7f6e\u4e5f\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <p>1\uff09\u627e\u5230\u5bf9\u5e94\u5b58\u50a8\u7684CSI\u9a71\u52a8\u53ca\u5b89\u88c5\u65b9\u5f0f\u3002 2\uff09\u5728Kubernetes\u96c6\u7fa4\u4e2d\u5b89\u88c5\u8be5\u9a71\u52a8\u3002 3\uff09\u914d\u7f6eStorageClass\u94fe\u63a5\u81f3\u8be5\u9a71\u52a8\u5373\u53ef\u4f7f\u7528\u3002</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7\u4e24\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u5373CSI\u5bf9\u63a5CephFS\u548cCeph RBD\u6765\u5b66\u4e60CSI\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#91-\u901a\u8fc7csi\u8fde\u63a5cephfs","title":"9.1 \u901a\u8fc7CSI\u8fde\u63a5CephFS","text":"<p>\u9996\u5148\u6211\u4eec\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7CSI\u914d\u7f6eCeph\u7684\u6587\u4ef6\u5b58\u50a8\uff0c Ceph CSI\u7684\u6587\u6863\u53ef\u4ee5\u5728https://github.com/ceph/ceph-csi\u67e5\u770b\uff0c CephFS CSI\u7684\u90e8\u7f72\u6587\u6863\u53ef\u4ee5\u901a\u8fc7\u94fe\u63a5\uff1ahttps://github.com/ceph/ceph-csi/blob/devel/docs/deploy-cephfs.md  \u67e5\u770b\uff08\u8be5\u94fe\u63a5\u53ef\u80fd\u4f1a\u6709\u6240\u53d8\u5316\uff0c\u53ef\u4ee5\u4ecehttps://github.com/ceph/ceph-csi\u7684\u76ee\u5f55\u4e2d\u67e5\u627e\uff09\u3002</p> <p>CephFS\u548cCeph RBD\u7684\u90e8\u7f72\u65b9\u5f0f\u5206\u4e3a\u4e24\u79cd\uff1a Helm\u5b89\u88c5\u548c\u76f4\u63a5\u4f7f\u7528YAML\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u7531\u4e8e\u4e24\u8005\u6d89\u53ca\u7684YAML\u6587\u4ef6\u8fc7\u591a\uff0c\u5728\u6b64\u4f7f\u7528Helm\uff08Helm\u662fKubernetes\u7684\u4e00\u79cd\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5bf9\u590d\u6742\u7684\u5e73\u53f0\u8fdb\u884c\u4e00\u952e\u5f0f\u5b89\u88c5\uff0cHelm\u5b98\u65b9\u6587 \u6863\uff1ahttps://helm.sh/\uff09\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u9996\u5148\u9700\u8981\u5728Kubernetes\uff08\u672c\u5c0f\u8282\u5b9e\u9a8c\u9700\u8981\u6709Kubernetes\u548cCeph\u73af\u5883\uff09\u7684\u63a7\u5236\u7aef\uff08\u4e5f\u5c31\u662f\u6267\u884cKubectl\u547d\u4ee4\u7684\u673a\u5668\uff09\u5b89\u88c5Helm\u7684\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u53ea\u9700\u8981\u4e0b\u8f7dHelm\u7684\u4e8c\u8fdb\u5236\u5305\u5373\u53ef\uff1a</p> <pre><code>$ curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash\nDownloading https://get.helm.sh/helm-v3.5.4-linux-amd64.tar.gz\nVerifying checksum... Done.\nPreparing to install helm into /usr/local/bin\n</code></pre> <p>\u67e5\u770b\u5b89\u88c5\u7684Helm\u7248\u672c\uff1a <pre><code>$ helm version\nversion.BuildInfo{Version:\"v3.5.4\", GitCommit:\"fe51cd1e31e6a202cba7dead9552a6d418ded79a\", GitTreeState:\"clean\", GoVersion:\"go1.15.11\"}\n</code></pre></p> <p>1\uff0eCephFS\u9a71\u52a8\u5b89\u88c5 Helm\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u8fdb\u5165\u672c\u4e66\u8be5\u5c0f\u8282\u7684\u6587\u6863\u76ee\u5f55\uff0c\u7136\u540e\u8fdb\u5165install\u6587\u4ef6\u5939\uff0c\u5b89\u88c5CephFS CSI\uff1a <pre><code>$ kubectl create namespace ceph-csi-cephfs\nnamespace/ceph-csi-cephfs created\n\n$ helm install --namespace \"ceph-csi-cephfs\" \"ceph-csi-cephfs\" .\n</code></pre></p> <p>\u6ce8\u610f</p> <p>\u7531\u4e8eHelm\u5305\u9ed8\u8ba4\u7684\u955c\u50cf\u5730\u5740\u662fgcr.io\u4ed3\u5e93\uff0c\u56fd\u5185\u53ef\u80fd\u65e0\u6cd5\u8bbf\u95ee\uff0c\u56e0\u6b64\u672c\u4e66\u6240\u7528\u7684\u5305\u5df2\u7ecf\u4e3a\u8bfb\u8005\u5c06\u76f8\u5173gcr\u955c\u50cf\u540c\u6b65\u5230\u4e86\u963f\u91cc\u4e91\uff0c\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5\u3002 \u5982\u679c \u4f7f\u7528\u7684\u662f\u65b0\u7684Helm\u5305\uff0c\u9700\u8981\u81ea\u884c\u540c\u6b65gcr\u955c\u50cf\u81f3\u963f\u91cc\u4e91\u6216\u516c\u53f8\u5185\u7684\u955c\u50cf\u4ed3\u5e93\uff0c\u65b0\u7248\u5b89\u88c5\u6587\u6863\uff1a https://github.com/ceph/ceph-csi/blob/devel/charts/ceph-csi-cephfs/README.md</p> <p>\u67e5\u770bCSI\u9a71\u52a8Pod\u7684\u72b6\u6001\uff1a <pre><code>$ kubectl get pod -n ceph-csi-cephfs\n</code></pre></p> <p>2\uff0eCeph\u914d\u7f6e</p> <p>\u4e4b\u540e\u9700\u8981\u5728Ceph\u4e2d\u521b\u5efa\u4e00\u4e2aPool\u4e3aKubernetes\u96c6\u7fa4\u63d0\u4f9b\u5b58\u50a8\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5df2\u7ecf\u5b58\u5728\u7684Pool\u3002 </p> <p>\u9996\u5148\u67e5\u770b\u5f53\u524dCeph\u96c6\u7fa4\u6709\u65e0Filesystem\u7c7b\u578b\u7684Pool\uff0c\u5982\u679c\u6709\u5219\u65e0\u987b\u518d\u521b\u5efa\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff1a</p> <pre><code>$ ceph fs ls\nname: sharefs, metadata pool: sharefs-metadata, data pools: [sharefs-data0 ]\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u7684\u8bdd\uff0c\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b\u7684Pool\uff08\u5927\u5c0f\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u914d\u7f6e\uff09\uff1a <pre><code>$ ceph osd pool create sharefs-data0 128 128\n$ ceph osd pool create sharefs-metadata 64 64\n$ ceph fs new sharefs sharefs-metadata sharefs-data0\n$ ceph fs ls\nname: sharefs, metadata pool: sharefs-metadata, data pools: [sharefs-data0 ]\n</code></pre></p> <p>Kubernetes\u4f7f\u7528Ceph\u4f5c\u4e3a\u540e\u7aef\u5b58\u50a8\uff0c\u4f1a\u5bf9Ceph\u96c6\u7fa4\u7684\u5377\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\uff0c \u6bd4\u5982\u521b\u5efa\u3001\u5220\u9664\u3001\u66f4\u6539\u7b49\uff0c\u6240\u4ee5Kubernetes\u9700\u8981\u6709\u76f8\u5173\u7684\u6743\u9650\uff0c \u6b64\u65f6\u53ef\u4ee5\u628a Ceph\u7684\u8ba4\u8bc1\u4fe1\u606f\u4fdd\u5b58\u5728Secret\u4e2d\uff0c\u4e4b\u540e\u914d\u7f6eStorageClass\u4f7f\u7528\u8be5Secret\u5373\u53ef\u3002</p> <p>\u67e5\u770bclient.admin\u7684Key\uff1a <pre><code>$ ceph auth get-key client.admin\nAQA8HP9ezBHPDBAAdL+NteK0d1mjXZV47r4I7w==\n</code></pre></p> <p>\u521b\u5efaSecret\uff1a <pre><code>$ kubectl create secret generic csi-cephfs-secret \\\n--type=\"kubernetes.io/cephfs\" \\\n--from-literal=adminKey='AQA8HP9ezBHPDBAAdL+NteK0d1mjXZV47r4I7w==' \\\n--from-literal-adminID='admin' \\\n--namespace=ceph-csi-cephfs\n</code></pre> \u67e5\u770b\u5e76\u8bb0\u5f55\u96c6\u7fa4\u7684fsid\uff1a <pre><code>$ ceph fsid\n48ddd55b-28ce-43f3-92a8-d17d9ad2c0de\n</code></pre></p> <p>\u67e5\u770bCeph\u7684Monitors\u8282\u70b9\u4fe1\u606f\uff1a</p> <p><pre><code>$ ceph mon dump\n</code></pre> \u7ed3\u679c\u4e2d\u7684Monitor\u7684IP+6789\u7aef\u53e3\u5373\u4e3aCeph Monitor\u7684\u5730\u5740\uff0c\u4e4b\u540e\u9700\u8981\u5728StorageClass\u4f7f\u7528\u3002</p> <p>3\uff0e\u521b\u5efa\u6587\u4ef6\u5171\u4eab\u578bStorageClass</p> <p>\u521b\u5efa\u8fde\u63a5Ceph\u7684\u4fe1\u606f\uff0c\u5176\u4e2dclusterID\u662f\u4e0a\u8ff0\u67e5\u8be2\u7684fsid\uff0cmonitors\u662f\u4e0a\u8ff0\u67e5\u8be2\u7684Monitor\u5730\u5740\uff0csubvolumeGroup\u76f8\u5f53\u4e8e\u5b50\u76ee\u5f55\uff1a</p> <p>ceph-configmap.yaml</p> <pre><code>apiVersion: v1\nkind: ConfigMap\ndata:\nconfig.json: |-\n[\n{\n\"clusterID\": \"48ddd55b-28ce-43f3-92a8-d17d9ad2c0de\",\n\"monitors\": [\n\"xxx:6789\",\n\"xxx:6789\",\n\"xxx:6789\"\n],\n\"cephFS\": {\n\"subvolumeGroup\": \"cephfs-k8s-csi\"\n}\n}\n]\nmetadata:\nname: ceph-csi-config\n</code></pre> <pre><code>$ kubectl create -f ceph-configmap.yaml -n ceph-csi-cephfs\n</code></pre> <p>\u521b\u5efaStorageClass\uff1a</p> <p>cephfs-csi-sc.yaml</p> <pre><code>---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\nname: csi-cephfs-sc\nprovisioner: cephfs.csi.ceph.com\nparameters:\nclusterID: 48ddd55b-28ce-43f3-92a8-d17d9ad2c0de fsName: sharefs\npool: sharefs-data0\n# The secrets have to contain user and/or Ceph admin credentials.\ncsi.storage.k8s.io/provisioner-secret-name: csi-cephfs-secret\ncsi.storage.k8s.io/provisioner-secret-namespace: ceph-csi-cephfs\ncsi.storage.k8s.io/controller-expand-secret-name: csi-cephfs-secret\ncsi.storage.k8s.io/controller-expand-secret-namespace: ceph-csi-cephfs\ncsi.storage.k8s.io/node-stage-secret-name: csi-cephfs-secret\ncsi.storage.k8s.io/node-stage-secret-namespace: ceph-csi-cephfs\n# (optional) The driver can use either ceph-fuse (fuse) or\n# ceph kernelclient (kernel).\n# If omitted, default volume mounter will be used - this is\n# determined by probing for ceph-fuse and mount.ceph\n# mounter: kernel\n# (optional) Prefix to use for naming subvolumes.\n# If omitted, defaults to \"csi-vol-\".\n# volumeNamePrefix: \"foo-bar-\"\nreclaimPolicy: Delete\nallowVolumeExpansion: true\nmountOptions:\n- debug\n</code></pre> <ul> <li>clusterID\uff1aCeph\u96c6\u7fa4\u7684fsid\u3002</li> <li>fsName\uff1aCeph\u6587\u4ef6\u7cfb\u7edf\u7684\u540d\u5b57\u3002</li> <li>pool\uff1aData Pool\u7684\u540d\u5b57\u3002</li> </ul> <p>csi.storage.k8s.io/provisioner-secret-name\uff1a\u8fde\u63a5\u4fe1\u606f\u7684Secret\uff0c\u5176\u4ed6\u7684\u7c7b\u4f3c\u3002</p> <ul> <li>reclaimPolicy\uff1a\u56de\u6536\u7b56\u7565\uff0c\u9ed8\u8ba4\u662f\u5220\u9664\u3002</li> <li>allowVolumeExpansion\uff1a\u5141\u8bb8\u6269\u5bb9\uff0c\u9700\u8981\u540e\u7aef\u5b58\u50a8\u652f\u6301\u3002</li> </ul> <p>\u521b\u5efaStorageClass\uff1a <pre><code>$ kubectl create -f cephfs-csi-sc.yaml\nstorageclass.storage.k8s.io/csi-cephfs-sc created\n</code></pre></p> <p>\u67e5\u770bStorageClass\uff1a <pre><code>$ kubectl get sc csi-cephfs-sc\n</code></pre></p> <p>4\uff0eCeph CSI\u9a8c\u8bc1 \u521b\u5efa\u4e00\u4e2aPVC\u6307\u5411\u8be5StorageClass\uff08storageClassName\u53c2\u6570\uff09\uff0c\u67e5\u770b\u4e00\u4e0b\u662f\u5426\u80fd\u6b63\u5e38\u521b\u5efaPV\uff1a</p> <p>vim pvc.yaml</p> <pre><code>---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\nname: cephfs-pvc-test-csi\nspec:\naccessModes:\n- ReadWriteMany\nstorageClassName: csi-cephfs-sc\nresources:\nrequests:\nstorage: 100Mi\n</code></pre> <p>test-pvc-dp.yaml</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: test-cephfs\nname: test-cephfs\nnamespace: default\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: test-cephfs\nstrategy:\nrollingUpdate:\nmaxSurge: 1\nmaxUnavailable: 0\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\napp: test-cephfs\nspec:\ncontainers:\n- command:\n- sh\n- -c\n- sleep 36000\nimage: registry.cn-beijing.aliyuncs.com/dotbalo/debug-tools\nname: test-cephfs\nvolumeMounts:\n- mountPath: /mnt\nname: cephfs-pvc-test\nvolumes:\n- name: cephfs-pvc-test\npersistentVolumeClaim:\nclaimName: cephfs-pvc-test-csi\n</code></pre> <p><pre><code>$ kubectl create -f pvc.yaml\n\n$ kubectl get pvc\n</code></pre> \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u6210\u529f\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3apvc-9cad122e-632e-408e-bce1-69186ae71cb6\u7684PV\uff0c \u72b6\u6001\u4e5f\u53d8\u6210\u4e86Bound\uff0c\u4e4b\u540e\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aPod\u8fdb\u884c\u6570\u636e\u8bfb\u5199\u6d4b\u8bd5\uff0c\u5c06PV\u6302\u8f7d\u5230/mnt\u76ee\u5f55\uff0c\u53ef\u4ee5\u6309\u9700\u4fee\u6539\uff1a</p> <p>test-pvc-dp.yaml</p> <p><pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: test-rbd\nname: test-rbd\nnamespace: default\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: test-rbd\nstrategy:\nrollingUpdate:\nmaxSurge: 1\nmaxUnavailable: 0\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\napp: test-rbd\nspec:\ncontainers:\n- command:\n- sh\n- -c\n- sleep 36000\nimage: registry.cn-beijing.aliyuncs.com/dotbalo/debug-tools\nname: test-rbd\nvolumeMounts:\n- mountPath: /mnt\nname: rbd-pvc-test\nvolumes:\n- name: rbd-pvc-test\npersistentVolumeClaim:\nclaimName: rbd-pvc-test-csi\n</code></pre> \u521b\u5efa\u8be5Deployment\uff1a <pre><code>$ kubectl apply -f test-pvc-dp.yaml\n$ kubectl get pod -l app=test-cephfs\n</code></pre> \u5728\u5176\u4e2d\u7684\u526f\u672c\u8fdb\u884c\u6570\u636e\u5199\u5165\uff1a <pre><code>$ kubectl exec test-cephfs-811238bfb7-splxx -- bash\n# echo \"hello, csi\" &gt; /mnt/test.txt \n# exit\n</code></pre></p> <p>\u5728\u53e6\u4e00\u4e2a\u526f\u672c\u4e2d\u67e5\u770b\u6570\u636e\uff1a <pre><code>$ kubectl exec test-cephfs-85f8f8bfb7-splxg -- cat /mnt/test.txt\nhello, csi\n</code></pre></p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#92-\u901a\u8fc7csi\u8fde\u63a5ceph-rbd","title":"9.2 \u901a\u8fc7CSI\u8fde\u63a5Ceph RBD","text":"<p>\u548cCephFS CSI\u7c7b\u4f3c\uff0c\u5b89\u88c5Ceph RBD CSI\u7684\u6b65\u9aa4\u51e0\u4e4e\u4e00\u6837\uff0c\u53ea\u662f\u5bf9\u5e94\u7684\u5b89\u88c5\u6587\u4ef6\u4e0d\u4e00\u6837 \uff0c </p> <p>RBD CSI\u7684\u6587\u6863\u53ef\u4ee5\u901a\u8fc7https://github.com/ceph/ceph-csi/blob/devel/docs/deploy-rbd.md\u67e5\u770b\uff0c  \u901a\u8fc7Helm\u5b89\u88c5\u6587\u6863\u5730\u5740 \uff1a https://github.com/ceph/ceph-csi/blob/devel/charts/ceph-csi-rbd/README.md\u3002</p> <p>1\uff0eCeph RBD\u9a71\u52a8\u5b89\u88c5</p> <p>\u540c\u6837\uff0c\u8be5Helm\u5305\u9ed8\u8ba4\u7684\u955c\u50cf\u5730\u5740\u4e5f\u662fgcr.io\uff0c\u7b14\u8005\u5df2\u7ecf\u4e3a\u8bfb\u8005\u540c\u6b65\u4e86\u76f8\u5173\u955c\u50cf\uff0c\u653e\u5728\u4e86\u672c\u5c0f\u8282\u7684install\u76ee\u5f55\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u5b89\u88c5\uff08Helm\u5b89\u88c5\u53ef\u4ee5\u53c2 \u80038.9.1\u8282\uff09\uff1a</p> <pre><code>$ kubectl create namespace \"ceph-csi-rbd\"\nnamespace/ceph-csi-rbd created\n\n# \u6ce8\u610f\u547d\u4ee4\u6700\u540e\u7684\u4e00\u4e2a\u70b9\n$ helm install --namespace \"ceph-csi-rbd\" \"ceph-csi-rbd\" .\nNAME: ceph-csi-rbd\n...\nNOTES:\nExamples on how to configure a storage class and start using thedriver are here:\nhttps://github.com/ceph/ceph-csi/tree/v3.3.1/examples/rbd\n</code></pre> <p>\u67e5\u770bPod\u72b6\u6001 <pre><code>$ kubectl get po -n ceph-csi-rbd\n</code></pre></p> <p>2\uff0eCeph\u914d\u7f6e</p> <p>\u521b\u5efaCeph Pool\uff0c\u5982\u679c\u6709Pool\u7684\u8bdd\u53ef\u4ee5\u4e0d\u7528\u521b\u5efa\uff08\u5927\u5c0f\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u914d\u7f6e\uff09\uff1a</p> <pre><code>$ ceph osd pool create rbdfork8s 128\npool 'rbdfork8s' created\n</code></pre> <p>\u76f8\u5bf9\u4e8e\u7ba1\u7406\u5458\u7528\u6237\uff0cRBD\u53ef\u4ee5\u5355\u72ec\u6388\u6743\u4e00\u4e2a\u4f4e\u6743\u9650\u7684\u7528\u6237\u7ba1\u7406Pool\uff0c\u6bd4\u5982 \u521b\u5efa\u4e00\u4e2akube\u7528\u6237\uff0c\u5bf9osd\u6709\u67e5\u770b\u6743\u9650\uff0c\u5bf9rbdfork8s\u6709\u8bfb\u5199\u6743\u9650\uff08\u5177\u4f53\u6743\u9650 \u914d\u7f6e\u53ef\u4ee5\u53c2\u8003Ceph\u6587\u6863\uff09\uff1a</p> <pre><code>$ ceph auth add client.kube mon 'allow r' osd 'allow rwx pool=rbdfork8s'\nadded key for client.kube\n</code></pre> <p>\u521d\u59cb\u5316Pool\uff0c\u6ce8\u610f\u5982\u679c\u4e0d\u662f\u65b0\u5efa\u7684\u5c31\u4e0d\u7528\u521d\u59cb\u5316\uff1a <pre><code>$ ceph osd pool application enable rbdfork8s rbd\nenabled application 'rbd' on pool 'rbdfork8s'\n$ rbd pool init rbdfork8s\n</code></pre></p> <p>\u67e5\u770bclient.kube\u7684key\uff1a <pre><code>$ ceph auth get-key client.kube\nAQB/eopgaqSRJxAAYDs2gKTXSpcpY2m+yHJaJw==\n</code></pre></p> <p>\u521b\u5efaSecret\uff1a <pre><code>$ kubectl create secret generic csi-rbd-secret \\\n--type=\"kubernetes.io/rbd\" \\\n--from-literal=userKey=\"AQB/eopgaqSRJxAAYDs2gKTXSpcpY2m+yHJaJw==\" \\\n--from-literal=userID=\"kube\" \\\n--namespace=ceph-csi-rbd\n</code></pre></p> <p>\u67e5\u770b\u5e76\u8bb0\u5f55\u96c6\u7fa4\u7684fsid\uff1a <pre><code>$ ceph fsid\n48ddd55b-28ce-43f3-92a8-d17d9ad2c0de\n</code></pre></p> <p>\u67e5\u770bCeph\u7684Monitors\u8282\u70b9\u4fe1\u606f\uff1a <pre><code>$ ceph mon dump\n</code></pre></p> <p>\u7ed3\u679c\u4e2d\u7684Monitor\u7684IP+6789\u7aef\u53e3\u5373\u4e3aCeph Monitor\u7684\u5730\u5740\uff0c\u4e4b\u540e\u9700\u8981\u5728StorageClass\u4e2d\u4f7f\u7528\u3002</p> <p>3\uff0e\u521b\u5efaStorageClass</p> <p>\u521b\u5efaStorageClass\u548cCephFS\u7684\u7c7b\u4f3c\uff0c\u5177\u4f53\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003CephFS CSI\u7684StorageClass\u914d\u7f6e\uff1a</p> <p>ceph-configmap.yaml</p> <p><pre><code>apiVersion: v1\nkind: ConfigMap\ndata:\nconfig.json: |-\n[\n{\n\"clusterID\": \"48ddd55b-28ce-43f3-92a8-d17d9ad2c0de\",\n\"monitors\": [\n\"xxx:6789\",\n\"xxx:6789\",\n\"xxx:6789\"\n],\n\"cephFS\": {\n\"subvolumeGroup\": \"cephrbd-k8s-csi\"\n}\n}\n]\nmetadata:\nname: ceph-csi-config\n</code></pre> <pre><code>$ kubectl create -f ceph-configmap.yaml -n ceph-csi-rbd\n</code></pre></p> <p>\u521b\u5efaStorageClass\uff1a</p> <p>rbd-csi-sc.yaml</p> <pre><code>---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\nname: csi-rbd-sc\nprovisioner: rbd.csi.ceph.com\nparameters:\nclusterID: 48ddd55b-28ce-43f3-92a8-d17d9ad2c0de pool: rbdfork8s\nimageFeatures: layering\ncsi.storage.k8s.io/provisioner-secret-name: csi-rbd-secret\ncsi.storage.k8s.io/provisioner-secret-namespace: ceph-csi-rbd csi.storage.k8s.io/controller-expand-secret-name: csi-rbd-secret\ncsi.storage.k8s.io/controller-expand-secret-namespace: ceph-csi-rbd\ncsi.storage.k8s.io/node-stage-secret-name: csi-rbd-secret\ncsi.storage.k8s.io/node-stage-secret-namespace: ceph-csi-rbd\ncsi.storage.k8s.io/fstype: ext4\nreclaimPolicy: Delete\nallowVolumeExpansion: true\nmountOptions:\n- discard\n</code></pre> <p>4\uff0eCeph RBD\u9a8c\u8bc1</p> <p>\u521b\u5efaPVC\uff0c\u67e5\u770b\u662f\u5426\u80fd\u81ea\u52a8\u521b\u5efaPV\uff0c\u521b\u5efa\u7684\u914d\u7f6e\u548c\u4e4b\u524d\u5e76\u65e0\u592a\u5927\u533a\u522b\uff0c\u53ea\u662fstorageClassName\u6362\u6210\u4e86RBD\u7684StorageClass\u540d\u79f0\uff1a</p> <p>pvc.yaml <pre><code>---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\nname: rbd-pvc-test-csi\nspec:\naccessModes:\n- ReadWriteOnce\nstorageClassName: csi-rbd-sc\nresources:\nrequests:\nstorage: 100Mi\n</code></pre></p> <p>test-pvc-dp.yaml</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: test-rbd\nname: test-rbd\nnamespace: default\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: test-rbd\nstrategy:\nrollingUpdate:\nmaxSurge: 1\nmaxUnavailable: 0\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\napp: test-rbd\nspec:\ncontainers:\n- command:\n- sh\n- -c\n- sleep 36000\nimage: registry.cn-beijing.aliyuncs.com/dotbalo/debug-tools\nname: test-rbd\nvolumeMounts:\n- mountPath: /mnt\nname: rbd-pvc-test\nvolumes:\n- name: rbd-pvc-test\npersistentVolumeClaim:\nclaimName: rbd-pvc-test-csi\n</code></pre> <p>\u521b\u5efa\u8be5Deployment\uff1a</p> <p><pre><code>$ kubectl apply -f test-pvc-dp.yaml\n$ kubectl get pod -l app=test-cephfs\n</code></pre> \u5728\u5176\u4e2d\u7684\u526f\u672c\u8fdb\u884c\u6570\u636e\u5199\u5165\uff1a <pre><code>$ kubectl exec test-cephfs-811238bfb7-splxx -- bash\n# echo \"hello, csi rbd\" &gt; /mnt/test.txt \n# exit\n</code></pre></p> <p>\u5728\u53e6\u4e00\u4e2a\u526f\u672c\u4e2d\u67e5\u770b\u6570\u636e\uff1a <pre><code>$ kubectl exec test-cephfs-85f8f8bfb7-splxg -- cat /mnt/test.txt\nhello, csi rbd\n</code></pre></p> <p>K8S\u4f7f\u7528ceph-csi\u6301\u4e45\u5316\u5b58\u50a8\u4e4bRBD</p> <p>https://mp.weixin.qq.com/s?__biz=MzAxMjk0MTYzNw==&amp;mid=2247484067</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/8.Kubernetes%E5%AD%98%E5%82%A8%E5%85%A5%E9%97%A8/#10-\u5c0f\u7ed3","title":"10. \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u4e3b\u8981\u8bb2\u89e3\u4e86Kubernetes\u5b58\u50a8\u7f16\u6392\u529f\u80fd\uff0c\u76ee\u524d\u5b58\u50a8\u7684\u65b9\u5411\u66f4\u504f\u5411\u4e8eCSI\u7684\u7ba1\u7406\u65b9\u5f0f\u3002</p> <p>\u6240\u4ee5\u8bfb\u8005\u60f3\u8981Kubernetes\u96c6\u7fa4\u63a5\u5165\u5b58\u50a8\u5e73\u53f0\uff0c\u9996\u9009\u7684\u65b9\u5f0f\u5e94\u8be5\u662fCSI\u3002</p> <p>\u76ee\u524d\u5927\u90e8\u5206\u5b58\u50a8\u5e73\u53f0\u7684\u4f9b\u5e94\u5546\u90fd\u63d0\u4f9b\u4e86CSI\u7684\u9a71\u52a8\uff0c\u8bfb\u8005\u76f4\u63a5\u5b89\u88c5\u5373\u53ef\u4f7f\u7528\uff08\u9700\u8981\u5728GitHub\u6216\u8005\u5bf9\u5e94\u5b58\u50a8\u5e73\u53f0\u7684\u5b98\u65b9\u7f51\u7ad9\u8fdb\u884c\u67e5\u627e\uff09\uff0c CSI\u7684\u7ba1\u7406 \u65b9\u5f0f\u5927\u5927\u964d\u4f4e\u4e86\u5b58\u50a8\u7684\u590d\u6742\u5ea6\uff0c\u53ef\u4ee5\u66f4\u52a0\u65b9\u4fbf\u5730\u5b9e\u73b0\u5b58\u50a8\u7684\u7ba1\u7406\uff0c\u6bd4\u5982\u521b\u5efa \u5b58\u50a8\u3001\u5220\u9664\u3001\u6269\u5bb9\u3001\u5907\u4efd\u7b49\u3002</p> <p>\u76f8\u5bf9\u4e8e\u914d\u7f6e\u5206\u79bb\uff0c\u5b58\u50a8\u5206\u79bb\u4e5f\u662f\u4e91\u539f\u751f\u8bbe\u8ba1\u975e\u5e38\u91cd\u8981\u7684\u56e0\u7d20\uff0c\u5373\u6709\u72b6\u6001\u5e94\u7528\u65e0\u72b6\u6001\u5316\u2014\u2014\u628a\u5b58\u50a8\u4ea4\u7ed9\u8fdc\u7aef\u3002</p> <p>\u5728\u4e4b\u524d\u7684\u7a0b\u5e8f\u8bbe\u8ba1\u4e2d\uff0c\u53ef\u80fd\u4f1a\u628a\u4e00\u4e9b\u6570\u636e\u653e\u5728\u672c\u5730\u6216\u8005\u5185\u5b58\u4e2d\uff0c\u56e0\u4e3a\u4e4b\u524d\u7684\u90e8\u7f72\u65b9\u5f0f\u4e0d\u4f1a\u5177\u6709\u5f88\u5927\u7684\u53d8\u5316\uff0c\u6240\u4ee5\u8fd9\u79cd\u67b6\u6784\u4e0d\u4f1a\u6709\u5927\u7684\u95ee\u9898\u3002</p> <p>\u4f46\u662f\u73b0\u5728\u7684\u67b6\u6784\u5177\u6709\u5f88\u9ad8\u7684\u5f39\u6027\uff0c\u6211\u4eec\u5f80\u5f80\u5e76\u4e0d\u77e5\u9053\u670d\u52a1\u5230\u5e95\u90e8\u7f72\u5728\u4e86\u54ea\u53f0\u670d\u52a1\u5668\u3001\u54ea\u4e2a\u4f4d\u7f6e\uff0c\u6240\u4ee5\u4ecd\u65e7\u5c06\u7a0b\u5e8f\u7684\u6570\u636e\u653e\u7f6e\u4e8e\u672c\u5730\u548c\u5185\u5b58\u4e2d\u662f\u4e0d\u53ef\u53d6\u7684\u65b9\u5f0f\u3002</p> <p>\u5bf9\u4e8e\u6587\u4ef6\u578b\u5b58\u50a8\uff0c\u53ef\u4ee5\u4f7f\u7528\u5bf9\u8c61\u5b58\u50a8\u7684\u65b9\u5f0f\u5c06\u6587\u4ef6\u76f4\u63a5\u5b58\u50a8\u5728\u5bf9\u8c61\u5b58\u50a8\u5e73\u53f0\u4e0a\u3002</p> <p>\u5bf9\u4e8e\u7f13\u5b58\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3cRedis\u7684\u4e2d\u95f4\u4ef6\u8fdb\u884c\u5b58\u53d6\u3002</p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u7684\u7a0b\u5e8f\u5c06\u4f1a\u5f7b\u5e95\u53d8\u6210\u65e0\u72b6\u6001\u7684\u5f62\u5f0f\uff0c\u65e0\u8bba\u5982\u4f55\u90e8\u7f72\u3001\u91cd\u542f\u3001\u8fc1\u79fb\u90fd\u4e0d\u4f1a \u9020\u6210\u6570\u636e\u7684\u4e22\u5931\uff0c\u6240\u4ee5\u5728\u8bbe\u8ba1\u7a0b\u5e8f\u65f6\u4e5f\u8981\u6709\u6b64\u7c7b\u610f\u8bc6\uff0c\u5c06\u6709\u72b6\u6001\u8bbe\u8ba1\u53d8\u6210\u65e0\u72b6\u6001\u8bbe\u8ba1\u3002</p> <p>\u53c2\u8003\u6587\u732e\uff1a</p> <p>https://www.qikqiak.com/k8strain2/storage/ceph/</p> <p>https://imszz.com/p/4aa1a279/</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/","title":"Kubernetes\u9ad8\u7ea7\u8c03\u5ea6","text":"<p>\u5728\u524d\u9762\u7684\u7ae0\u8282\u5df2\u7ecf\u5b66\u4e60\u8fc7Kubernetes\u7684\u8c03\u5ea6\u57fa\u7840\uff0c\u5b9e\u73b0\u4e86\u5c06\u81ea\u5df1\u7684\u670d\u52a1\u90e8\u7f72\u5230Kubernetes\u3002\u4f46\u662f\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u8c03\u5ea6\u8fdc\u8fdc\u6bd4\u81ea\u5df1\u60f3\u8c61\u7684\u8981\u590d\u6742\u3002 \u6bd4\u5982\uff1a</p> <ul> <li>\u67d0\u4e9b\u7a0b\u5e8f\u53ea\u80fd\u90e8\u7f72\u5728\u56fa\u5b9a\u7684\u51e0\u53f0\u673a\u5668\u4e0a\u3002</li> <li>\u67d0\u4e9b\u673a\u5668\u53ea\u80fd\u90e8\u7f72\u6307\u5b9a\u7684Pod\u3002</li> <li>\u8282\u70b9\u6302\u4e86\u600e\u4e48\u5feb\u901f\u6062\u590d\u3002</li> <li>\u8282\u70b9\u6302\u4e86\u5982\u4f55\u8ba9\u5f71\u54cd\u5ea6\u6700\u5c0f\u3002</li> <li>\u5728\u7ebfDebug\u6ca1\u6709\u547d\u4ee4\u600e\u4e48\u529e\u3002</li> </ul> <p>\u4e0a\u8ff0\u53ea\u662f\u5217\u4e3e\u4e86\u4e00\u4e9b\u9700\u6c42\uff0c\u771f\u5b9e\u7684\u60c5\u51b5\u53ef\u80fd\u66f4\u4e3a\u590d\u6742\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u66f4 \u9ad8\u7ea7\u7684\u8c03\u5ea6\u65b9\u5f0f\u3001\u66f4\u5b9e\u7528\u7684\u529f\u80fd\u6765\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002</p> <p>\u5e78\u8fd0\u7684\u662f\uff0cKubernetes\u539f\u751f\u7684\u5f88\u591a\u529f\u80fd\u5747\u80fd\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u672c\u7ae0\u6211\u4eec\u5c31\u6765\u5b66\u4e60Kubernetes\u66f4\u9ad8\u7ea7\u7684\u8c03\u5ea6\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#1-\u521d\u59cb\u5316\u5bb9\u5668initcontainer","title":"1. \u521d\u59cb\u5316\u5bb9\u5668InitContainer","text":"<p>InitContainer\u662fKubernetes\u7684\u521d\u59cb\u5316\u5bb9\u5668\uff08\u4e5f\u53ef\u79f0\u4e4b\u4e3aInit\u5bb9\u5668\uff09\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u5bb9\u5668\uff0c\u5728Pod\u5185\u7684\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u8fd0\u884c\uff0c\u53ef\u4ee5\u5305\u62ec\u4e00\u4e9b\u5e94\u7528\u955c\u50cf\u4e2d\u4e0d\u5b58\u5728\u7684\u5b9e\u7528\u5de5\u5177\u548c\u5b89\u88c5\u811a\u672c\uff0c\u7528\u4ee5\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u6bd4\u5982\u521b \u5efa\u6587\u4ef6\u3001\u4fee\u6539\u5185\u6838\u53c2\u6570\u3001\u7b49\u5f85\u4f9d\u8d56\u7a0b\u5e8f\u542f\u52a8\u7b49\u3002</p> <p>\u6bcf\u4e2aPod\u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u5bb9\u5668\uff0c\u540c\u65f6Pod\u4e5f\u53ef\u4ee5\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u5148\u4e8e\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u7684Init\u5bb9\u5668\uff0c\u5728Pod\u5b9a\u4e49\u4e2d\u548ccontainers\u540c\u7ea7\uff0c\u6309\u987a\u5e8f\u9010\u4e2a\u6267\u884c\uff0c \u5f53\u6240\u6709\u7684Init\u5bb9\u5668\u8fd0\u884c\u5b8c\u6210\u65f6\uff0cKubernetes\u624d\u4f1a\u542f\u52a8Pod\u5185\u7684\u666e\u901a\u5bb9\u5668\u3002</p> <p>Init\u5bb9\u5668\u4e0e\u666e\u901a\u7684\u5bb9\u5668\u975e\u5e38\u50cf\uff0c\u9664\u4e86\u5982\u4e0b\u51e0\u70b9\uff1a</p> <ul> <li> <p>\u5b83\u4eec\u603b\u662f\u8fd0\u884c\u5230\u5b8c\u6210\u3002</p> </li> <li> <p>\u4e0a\u4e00\u4e2a\u8fd0\u884c\u5b8c\u6210\u624d\u4f1a\u8fd0\u884c\u4e0b\u4e00\u4e2a\u3002</p> </li> <li> <p>\u5982\u679cPod\u7684Init\u5bb9\u5668\u5931\u8d25\uff0cKubernetes\u4f1a\u4e0d\u65ad\u5730\u91cd\u542f\u8be5Pod\uff0c\u76f4\u5230Init\u5bb9\u5668\u6210\u529f\u4e3a\u6b62 \uff0c \u4f46\u662fPod\u5bf9\u5e94\u7684restartPolicy\u503c\u4e3aNever\uff0c Kubernetes\u4e0d\u4f1a\u91cd\u65b0\u542f\u52a8Pod\u3002</p> </li> </ul> <p>\u4e3aPod\u8bbe\u7f6eInit\u5bb9\u5668\u9700\u8981\u5728Pod\u7684spec\u4e2d\u6dfb\u52a0initContainers\u5b57\u6bb5\uff0c\u8be5\u5b57 \u6bb5\u548c\u5e94\u7528\u7684containers\u6570\u7ec4\u540c\u7ea7\u76f8\u90bb\uff0c\u914d\u7f6e\u65b9\u5f0f\u548ccontainers\u4e2d\u7684\u666e\u901a\u5bb9\u5668 \u5dee\u4e0d\u591a\uff0cInit\u5bb9\u5668\u652f\u6301\u5e94\u7528\u5bb9\u5668\u7684\u5168\u90e8\u5b57\u6bb5\u548c\u7279\u6027\uff0c\u5305\u62ec\u8d44\u6e90\u9650\u5236\u3001\u6570\u636e\u5377 \u548c\u5b89\u5168\u8bbe\u7f6e\u3002</p> <p>\u4f46\u662fInit\u5bb9\u5668\u5bf9\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236\u7684\u5904\u7406\u7a0d\u6709\u4e0d\u540c\uff0cInit\u5bb9\u5668\u4e0d\u652f\u6301lifecycle\u3001livenessProbe\u3001readinessProbe\u548cstartupProbe\uff0c\u56e0\u4e3a\u5b83 \u4eec\u5fc5\u987b\u5728Pod\u5c31\u7eea\u4e4b\u524d\u8fd0\u884c\u5b8c\u6210\u3002</p> <p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e3a\u4e86\u5e94\u7528\u7684\u5b89\u5168\u548c\u4f18\u5316\u955c\u50cf\u7684\u4f53\u79ef\uff0c\u4e1a\u52a1\u955c\u50cf\u4e00\u822c\u4e0d\u4f1a \u5b89\u88c5\u9ad8\u5371\u5de5\u5177\u548c\u5e76\u4e0d\u5e38\u7528\u7684\u8fd0\u7ef4\u5de5\u5177\uff0c\u6bd4\u5982curl\u3001sed\u3001awk\u3001python\u6216dig\u7b49\uff0c\u540c\u65f6\u5efa\u8bae\u4f7f\u7528\u975eroot\u7528\u6237\u53bb\u542f\u52a8\u5bb9\u5668\u3002</p> <p>\u4f46\u662f\u67d0\u4e9b\u5e94\u7528\u542f\u52a8\u4e4b\u524d\u53ef\u80fd\u9700\u8981\u68c0\u6d4b\u4f9d\u8d56\u7684\u670d\u52a1\u6709\u6ca1\u6709\u6210\u529f\u8fd0\u884c\uff0c\u6216\u8005\u9700\u8981\u9ad8\u6743\u9650\u53bb\u4fee\u6539\u4e00\u4e9b\u7cfb\u7edf\u7ea7\u914d\u7f6e\uff0c \u800c\u8fd9\u4e9b\u68c0\u6d4b\u6216\u914d\u7f6e\u66f4\u6539\u90fd\u662f\u4e00\u6b21\u6027\u7684\uff0c\u6240\u4ee5\u5728\u5236\u4f5c\u4e1a\u52a1\u955c\u50cf\u65f6\u6ca1\u6709\u5fc5\u8981\u4e3a\u4e86\u4e00\u6b21\u914d\u7f6e\u7684\u53d8\u66f4\u53bb\u5b89\u88c5\u4e00\u4e2a\u914d\u7f6e\u5de5\u5177\uff0c\u66f4\u6ca1\u6709\u5fc5\u8981\u56e0\u4e3a\u4f7f\u7528\u4e00\u6b21\u9ad8\u6743\u9650\u800c\u628a\u6574\u4e2a\u955c\u50cf\u6539\u6210\u4ee5root\u8eab\u4efd\u8fd0\u884c\u3002</p> <p>\u8003\u8651\u5230\u4e0a\u8ff0\u95ee\u9898\u548c\u9700\u6c42\uff0cKubernetes\u5f15\u5165\u4e86\u521d\u59cb\u5316\u5bb9\u5668\u7684\u6982\u5ff5\uff0cInit\u5bb9\u5668\u5177\u6709\u4e0e\u5e94\u7528\u5bb9\u5668\u5206\u79bb\u7684\u5355\u72ec\u955c\u50cf\uff0c\u5176\u542f\u52a8\u76f8\u5173\u4ee3\u7801\u5177\u6709\u5982\u4e0b\u4f18\u52bf\uff1a</p> <ul> <li>Init\u5bb9\u5668\u53ef\u4ee5\u5305\u542b\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u5e94\u7528\u5bb9\u5668\u4e2d\u4e0d\u5b58\u5728\u7684\u5b9e\u7528\u5de5\u5177\u6216\u4e2a\u6027\u5316\u4ee3\u7801\u3002</li> <li>Init\u5bb9\u5668\u53ef\u4ee5\u5b89\u5168\u5730\u8fd0\u884c\u8fd9\u4e9b\u5de5\u5177\uff0c\u907f\u514d\u8fd9\u4e9b\u5de5\u5177\u5bfc\u81f4\u5e94\u7528\u955c\u50cf\u7684\u5b89\u5168\u6027\u964d\u4f4e\u3002</li> <li>Init\u5bb9\u5668\u53ef\u4ee5\u4ee5root\u8eab\u4efd\u8fd0\u884c\uff0c\u6267\u884c\u4e00\u4e9b\u9ad8\u6743\u9650\u547d\u4ee4\u3002</li> <li>Init\u5bb9\u5668\u76f8\u5173\u64cd\u4f5c\u6267\u884c\u5b8c\u6210\u540e\u5c31\u4f1a\u9000\u51fa\uff0c\u4e0d\u4f1a\u7ed9\u4e1a\u52a1\u5bb9\u5668\u5e26\u6765\u5b89\u5168\u9690\u60a3\u3002</li> </ul> <p>\u7531\u4e8eInit\u5bb9\u5668\u5fc5\u987b\u5728\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u8fd0\u884c\u5b8c\u6210\uff0c\u56e0\u6b64Init\u5bb9\u5668\u63d0\u4f9b\u4e86\u4e00\u79cd\u673a\u5236\u6765\u963b\u585e\u6216\u5ef6\u8fdf\u5e94\u7528\u5bb9\u5668\u7684\u542f\u52a8\uff0c\u76f4\u5230\u6ee1\u8db3\u4e00\u7ec4\u5148\u51b3\u6761\u4ef6\uff0cPod\u5185\u7684\u6240\u6709\u5e94\u7528\u5bb9\u5668\u624d\u4f1a\u5e76\u884c\u542f\u52a8\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#11-\u793a\u4f8b1\u7b49\u5f85\u4f9d\u8d56\u670d\u52a1\u542f\u52a8","title":"1.1 \u793a\u4f8b1\uff1a\u7b49\u5f85\u4f9d\u8d56\u670d\u52a1\u542f\u52a8","text":"<p>\u6709\u65f6\u67d0\u4e9b\u670d\u52a1\u9700\u8981\u4f9d\u8d56\u5176\u4ed6\u7ec4\u4ef6\u624d\u80fd\u542f\u52a8\uff0c\u6bd4\u5982\u540e\u7aef\u5e94\u7528\u9700\u8981\u6570\u636e\u5e93\u542f\u52a8\u4e4b\u540e\uff0c\u5e94\u7528\u624d\u80fd\u6b63\u5e38\u542f\u52a8\uff0c\u6240\u4ee5\u6b64\u65f6\u9700\u8981\u68c0\u6d4b\u6570\u636e\u5e93\u5b9e\u4f8b\u662f\u5426\u6b63\u5e38\uff0c \u5f85\u6570\u636e\u5e93\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u65f6\uff0c\u518d\u542f\u52a8\u540e\u7aef\u5e94\u7528\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u521d\u59cb\u5316\u5bb9\u5668\u8fdb\u884c\u63a7\u5236\uff0c\u5bf9\u5e94\u7684YAML\u6587\u4ef6\u5982\u4e0b\uff08\u90e8\u5206\u4ee3\u7801\uff09\uff1a <pre><code>apiVersion: apps/v1beta1\nkind: Deployment\nmetadata:\nname: init-test\nspec:\nreplicas: 1\ntemplate:\nmetadata:\nlabels:\napp: init\nspec:\ncontainers:\n- name: nginx-init\nimage: nginx:1.7.9\nports:\n- containerPort: 80\ninitContainers:\n- name: init-mydb\nimage: busybox\ncommand: ['sh', '-c', 'until nslookup mysql; do echo waiting for mysql; sleep 2; done;']\nrestartPolicy: Always\n</code></pre> \u4e0a\u9762\u7684\u793a\u4f8b\u662f\u6253\u7b97\u542f\u52a8\u4e00\u4e2aNginx\u670d\u52a1\uff0c\u5728\u542f\u52a8\u670d\u52a1\u4e4b\u524d\u6765\u5224\u65adMySQL\u7684\u670d\u52a1\u662f\u5426\u542f\u52a8\u3002\u901a\u8fc7nslookup\u68c0\u6d4bmysql\u670d\u52a1\u662f\u5426\u6210\u529f\u542f\u52a8\u3002\u5982\u679cmysql\u670d\u52a1\u542f\u52a8\u4e86\u4e4b\u540e\uff0cnslookup \u68c0\u6d4b\u57df\u540d\u4e5f\u4f1a\u6210\u529f\uff0c\u540e\u7eed\u4f1a\u542f\u52a8Nginx\u5bb9\u5668\uff1b</p> <p>\u5426\u5219\uff0c\u5c06\u4f1a\u7b49\u5f85\u4e24\u79d2\u4e4b\u540e\uff0c\u518d\u6b21\u68c0\u6d4b\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u6211\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5e76\u6ca1\u6709\u6210\u529f\u3002\u6211\u7684\u73af\u5883\u662f\u4e3amysql\u914d\u7f6e\u4e86Deploy\u548cService\uff0c\u5728\u5173\u95edpod\u7684\u60c5\u51b5\u4e0b\u901a\u8fc7nslookup\u6765\u68c0\u6d4b\u57df\u540d\u8fd8\u662f\u53ef\u4ee5\u6210\u529f\u3002</p> <p>\u540e\u9762\u6211\u76f4\u63a5\u4f7f\u7528curl\u6765\u5224\u65ad\u7aef\u53e3\u670d\u52a1\u662f\u5426\u53ef\u7528\u3002 <pre><code>apiVersion: apps/v1beta1\nkind: Deployment\nmetadata:\nname: init-test\nspec:\nreplicas: 1\ntemplate:\nmetadata:\nlabels:\napp: init\nspec:\ncontainers:\n- name: nginx-init\nimage: nginx:1.7.9\nports:\n- containerPort: 80\ninitContainers:\n- name: init-mydb\nimage: curlimages/curl:7.68.0\ncommand: ['sh', '-c', 'until curl 192.168.10.254:6379;; do echo waiting for mysql; sleep 2; done;']\nrestartPolicy: Always\n</code></pre></p> <p>Init container\u5bb9\u5668\u4e2d\u4f7f\u7528curl\u955c\u50cf\uff0c\u547d\u4ee4\u901a\u8fc7curl + \u670d\u52a1\u5730\u5740,\u670d\u52a1\u5730\u5740\u5c31\u662f\u4f60\u7684MySQL\u670d\u52a1\u5730\u5740\uff0c\u76f4\u63a5\u6765\u5224\u65ad\u670d\u52a1\u662f\u5426\u53ef\u7528\u6b63\u5e38\u4f7f\u7528\u3002</p> <p>\u5f53MySQL\u670d\u52a1\u6ca1\u6709\u6b63\u5e38\u542f\u52a8\u65f6\uff0c\u9519\u8bef\u4fe1\u606f\uff1a <pre><code>curl: (7) Failed to connect to 192.168.10.254 port 6379: Connection refused\uff0cinit container\n</code></pre> \u4f1a\u4e00\u76f4\u5faa\u73af\u68c0\u6d4b\u3002</p> <p>\u5230\u670d\u52a1\u6b63\u5e38\u542f\u52a8\u4e4b\u540e\uff0c <pre><code>It looks like you are trying to access mysql over HTTP on the native driver port.\n</code></pre> \u4e4b\u540e\u670d\u52a1\u5c31\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8\u4e86\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#12-\u793a\u4f8b2\u670d\u52a1\u6ce8\u518c","title":"1.2 \u793a\u4f8b2\uff1a\u670d\u52a1\u6ce8\u518c","text":"<p>\u6ce8\u518c\u8fd9\u4e2aPod\u7684IP\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\uff0c\u901a\u8fc7\u5728\u547d\u4ee4\u4e2d\u8c03\u7528API\uff0c\u7c7b\u4f3c\u5982\u4e0b\uff08\u90e8\u5206\u4ee3\u7801\uff09\uff1a <pre><code>      initContainers:\n- command:\n- sh - -c - |\ncurl -X POST http://$MANAGEMENT_SERVICE_HOST: $MANAGEMENT_SERVICE_PORT/REGISTER \\\n-d 'instance=$(&lt;POD_NAME&gt;)&amp;ip=$(&lt;POD_IP&gt;)'\nenv:\n- name: TZ\nvalue: Asia/Shanghai\n- name: LANG\nvalue: C.UTF-8\nimage: curl\nimagePullPolicy: Always\nname: init_curl restartPolicy: Always\n</code></pre></p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#13-\u793a\u4f8b3\u514b\u9686git\u4ee3\u7801\u5230\u5bb9\u5668\u4e2d","title":"1.3 \u793a\u4f8b3\uff1a\u514b\u9686Git\u4ee3\u7801\u5230\u5bb9\u5668\u4e2d","text":"<pre><code>     initContainers:\n- command:\n- sh - -c - |\ngit clone https://github.com/dotbalo/kubenetes-guide.git\nenv:\n- name: TZ\nvalue: Asia/Shanghai\n- name: LANG\nvalue: C.UTF-8\nimage: alpine/git:latest\nimagePullPolicy: Always\nname: init_git\nrestartPolicy: Always\n</code></pre>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#14-\u793a\u4f8b4\u591a\u4e2a\u521d\u59cb\u5316\u5bb9\u5668\u4f7f\u7528","title":"1.4 \u793a\u4f8b4\uff1a\u591a\u4e2a\u521d\u59cb\u5316\u5bb9\u5668\u4f7f\u7528","text":"<p>\u5982\u524d\u9762\u6240\u8ff0\uff0c\u4e00\u4e2aPod\u4e2d\u53ef\u4ee5\u8fd0\u884c\u591a\u4e2aInit\u5bb9\u5668\u3002\u6bd4\u5982\u4e00\u4e2a\u5e94\u7528\u9700\u8981\u7b49\u5f85\u8be5\u5e94\u7528\u6240\u5728Namespace\u7684\u4e00\u4e2aService\u5bf9\u5e94\u7684Pod\u542f\u52a8\uff0c\u4e5f\u9700\u8981\u4e00\u4e2aDB\u7684 Service\u542f\u52a8\uff0c\u5f53\u4e24\u4e2aInitContainer\u90fd\u6210\u529f\u540e\uff0c\u624d\u53ef\u4ee5\u542f\u52a8\u4e1a\u52a1\u5e94\u7528\u5bb9\u5668\uff0c \u6b64\u65f6\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u914d\u7f6e\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: myapp-pod\nlabels:\napp: myapp\nspec:\ncontainers:\n# \u4e1a\u52a1\u5e94\u7528\u5bb9\u5668\n- name: myapp-container\nimage: busybox:1.28\ncommand: ['sh', '-c', 'echo The app is running! &amp;&amp; sleep 3600']\n# \u521d\u59cb\u5316\u5bb9\u5668\u5217\u8868\ninitContainers:\n# \u7b2c\u4e00\u4e2a\u521d\u59cb\u5316\u5bb9\u5668\uff0c\u7b49\u5f85\u5f53\u524dNamespace\u4e0b\u7684myservice\u542f\u52a8\n- name: init-myservice\nimage: busybox:1.28\ncommand: ['sh', '-c', \"until nslookup myservice.$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace).svc.cluster.local; do echo waiting for myservice; sleep 2; done\"]\n# \u7b2c\u4e8c\u4e2a\u521d\u59cb\u5316\u5bb9\u5668\uff0c\u7b49\u5f85DB\u7684Service\u542f\u52a8\n- name: init-mydb\nimage: busybox:1.28\ncommand: ['sh', '-c', \"until nslookup mydb.$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace).svc.cluster.local; do echo waiting for mydb; sleep 2; done\"]\n</code></pre></p> <p>\u6b64\u65f6\u53ef\u4ee5\u67e5\u770b\u8be5Pod\u7684\u521d\u59cb\u5316\u5bb9\u5668\u7684\u65e5\u5fd7\uff1a <pre><code># \u67e5\u770b\u7b2c\u4e00\u4e2a\u521d\u59cb\u5316\u5bb9\u5668\n$ kubectl logs myapp-container -c init-myservice  # \u67e5\u770b\u7b2c\u4e8c\u4e2a\u521d\u59cb\u5316\u5bb9\u5668\n$ kubectl logs myapp-container -c init-mydb\n</code></pre></p> <p>\u6b64\u65f6Init\u5bb9\u5668\u5c06\u4f1a\u4e00\u76f4\u7b49\u5f85mydb\u548cmyservice\u7684Service\u53ef\u7528\u3002\u5f53mydb\u548cmyservice\u53ef\u7528\u540e\uff0cmy-app\u7684Pod\u8fdb\u5165Running\u72b6\u6001\uff1a <pre><code>$ kubectl get -f myapp.yaml\n</code></pre></p> <p>\u5176\u4ed6\u793a\u4f8b\uff08\u5982sleep\u6307\u5b9a\u7684\u65f6\u95f4\u3001\u6839\u636e\u5f53\u524dPod\u73af\u5883\u53d8\u91cf\u4f7f\u7528jinja\u751f\u6210\u914d \u7f6e\u6587\u4ef6\uff09\u5728\u6b64\u4e0d\u518d\u6f14\u793a\uff0c\u53ea\u9700\u8981\u627e\u5230\u5bf9\u5e94\u7684\u955c\u50cf\uff0c\u4e4b\u540e\u66f4\u6539\u6267\u884c\u547d\u4ee4\u5373\u53ef\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#2-\u4e34\u65f6\u5bb9\u5668ephemeral-containers","title":"2. \u4e34\u65f6\u5bb9\u5668Ephemeral Containers","text":"<p>\u4e34\u65f6\u5bb9\u5668\u529f\u80fd\u5728Kubernetes 1.16 \u540e\u7684\u7248\u672c\u624d\u53ef\u4ee5\u4f7f\u7528\uff0c\u5e76\u4e14\u57281.16~1.18\u7248\u672c\u548c1.18+\u7248\u672c\u7684\u4f7f\u7528\u65b9\u6cd5\u4e0d\u592a\u4e00\u81f4\uff0c\u4f7f\u7528\u65f6\u9700\u8981\u591a\u52a0\u6ce8\u610f\u3002</p> <p>\uff081\uff09\u57281.16~1.18\u7248\u672c\u4e2d\u4e34\u65f6\u5bb9\u5668\u7684\u4f7f\u7528\u65b9\u6cd5</p> <p>\u4e34\u65f6\u5bb9\u5668\u662f\u4f7f\u7528Pod\u7684ephemeralcontainers\u5b50\u8d44\u6e90\u521b\u5efa\u7684\uff0c \u53ef\u4ee5\u4f7f\u7528kubectl --raw\u5411\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684Pod\u6ce8\u5165\u4e00\u4e2a\u4e34\u65f6\u5bb9\u5668\uff0c\u5047\u5982\u5411kube-system\u547d\u540d\u7a7a\u95f4\u4e0b\u7684metrics-server\u5bb9\u5668\u6dfb\u52a0\u4e00\u4e2abusybox\u7684\u4e34\u65f6\u5bb9\u5668\u3002</p> <p>\u9996\u5148\u67e5\u770bmetrics-server\u7684Pod\u540d\u79f0\uff1a <pre><code>$ kubectl get pod -n kube-system -l k8s-app=metrics-server\n</code></pre></p> <p>\u63a5\u7740\u521b\u5efa\u4e00\u4e2aec.json\u6587\u4ef6\uff0c\u58f0\u660e\u4e34\u65f6\u5bb9\u5668\u7684\u914d\u7f6e\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>{\n\"apiVersion\": \"v1\",\n\"kind\":\"EphemeralContainers\",\n\"metadata\":{\"name\": \"metrics-server-89786cd84-t9dwm\"},\n\"ephemeralContainers\": [{\n\"command\": [\n\"sh\"\n],\n\"image\": \"busybox\",\n\"imagePullPolicy\": \"IfNotPresent\",\n\"name\":\"debugger\",\n\"stdin\": true,\n\"tty\":true,\n\"terminationMessagePolicy\": \"File\"\n}]\n}\n</code></pre> \u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff1a</p> <ul> <li>metadata.name\uff1a\u88ab\u6ce8\u5165\u5bb9\u5668\u7684\u540d\u5b57\u3002</li> <li>ephemeralContainers[].image\uff1a\u4e34\u65f6\u5bb9\u5668\u4f7f\u7528\u7684\u955c\u50cf\u3002</li> <li>ephemeralContainers[].name\uff1a\u4e34\u65f6\u5bb9\u5668\u7684\u540d\u79f0\u3002</li> </ul> <p>\u4e4b\u540e\u4f7f\u7528kubectl replace --raw\u547d\u4ee4\u66f4\u65b0\u5df2\u8fd0\u884c\u7684\u4e34\u65f6\u5bb9\u5668metrics-server-89786cd84-t9dwm\uff1a</p> <pre><code>$ kubectl replace --raw /api/v1/namespaces/kube-system/pods/ metrics-server-89786cd84-t9dwm/ephemeralcontainers -f ec.json\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0bexec\u6216\u8005attach\u547d\u4ee4\u8fde\u63a5\u65b0\u7684\u4e34\u65f6\u5bb9\u5668\uff08-c\u6307\u5b9a\u4e3a\u4e34\u65f6\u5bb9\u5668\u7684\u540d\u79f0\uff09\uff1a</p> <pre><code>$ kubectl attach -it metrics-server-89786cd84-t9dwm -n kube- system -c debugger\n</code></pre> <p>\u5982\u679c\u542f\u7528\u4e86\u8fdb\u7a0b\u547d\u540d\u7a7a\u95f4\u5171\u4eab\uff0c\u5219\u53ef\u4ee5\u5728\u4e34\u65f6\u5bb9\u5668\u4e2d\u67e5\u770b\u8be5Pod\u6240\u6709\u5bb9\u5668\u4e2d\u7684\u8fdb\u7a0b\u3002</p> <p>\u4f8b\u5982\uff0c\u8fd0\u884c\u4e0a\u8ff0attach\u64cd\u4f5c\u540e\uff0c\u5728\u8c03\u8bd5\u5668\u5bb9\u5668\u65f6\u8fdb\u884cps\u548cnetstat\u64cd\u4f5c\uff1a</p> <pre><code>$ ps aux\n\n$ netstat -lntp\n</code></pre> <p>\u5728\u4e34\u65f6\u5bb9\u5668busybox\u4e2d\u6267\u884cps aux\u80fd\u770b\u5230\u5176\u4ed6\u5bb9\u5668\u7684\u8fdb\u7a0b\uff0c\u6267\u884cnetstat\u4e5f\u80fd\u770b\u5230Pod\u4e2d\u6240\u6709\u5bb9\u5668\u7684\u542f\u52a8\u7aef\u53e3\u53f7\uff0c\u53ef\u4ee5\u770b\u5230\u5728\u4e1a\u52a1\u5bb9\u5668\u6ca1\u6709\u57fa\u672c\u5de5\u5177\u7684\u524d\u63d0\u4e0b\uff0c\u4f7f\u7528\u4e34\u65f6\u5bb9\u5668\u5927\u5927\u63d0\u9ad8\u4e86\u6392\u67e5\u6545\u969c\u7684\u6548\u7387\u3002</p> <p>\uff082\uff09\u57281.18+\u7248\u672c\u4e2d\u4e34\u65f6\u5bb9\u5668\u7684\u4f7f\u7528\u65b9\u6cd5  Kubernetes\u7248\u672c\u4f4e\u4e8e1.18\u65f6\uff0c\u4f7f\u7528\u4e34\u65f6\u5bb9\u5668\u5728\u7ebfDebug\u7684\u8fc7\u7a0b\u8fd8\u662f\u6bd4\u8f83\u9ebb\u70e6\u7684\uff0c\u57281.18\u7248\u672c\u4e4b\u540e\uff08\u5305\u62ec1.18),\u4f7f\u7528\u4e34\u65f6\u5bb9\u5668\u5728\u7ebfDebug\u5c31\u76f8\u5bf9\u7b80\u5355\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528kubectl alpha debug\u8fdb\u884c\u8c03\u8bd5\uff0c\u6bd4\u5982\u4e0a\u8ff0\u64cd\u4f5c\u53ef\u4ee5\u7528\u4e00\u6761\u547d\u4ee4\u4ee3\u66ff\uff1a</p> <pre><code>$ kubectl -n kube-system alpha debug metrics-server-89786cd84- t9dwm -i --image=busybox\n</code></pre> <p>\u6ce8\u610f</p> <p>1.18\u7248\u672c\u4e5f\u9700\u8981\u5f00\u542f\u4e34\u65f6\u5bb9\u5668\u529f\u80fd\u30021.19\u4ee5\u4e0a\u7248\u672ckubectl\u547d\u4ee4\u4e0d\u7528\u518d\u52a0alpha\u5b57\u6bb5\u3002</p> <p>\u4f7f\u7528\u4e34\u65f6\u8c03\u8bd5\u5bb9\u5668\u6765\u8fdb\u884c\u8c03\u8bd5</p> <p>https://kubernetes.io/zh-cn/docs/tasks/debug/debug-application/debug-running-pod/#ephemeral-container</p> <p>Kubernetes\u4e2d\u4f7f\u7528\u4e34\u65f6\u5bb9\u5668\u8fdb\u884c\u6545\u969c\u6392\u67e5\u7684\u65b9\u6cd5</p> <p>https://www.zhangshengrong.com/p/OQNzr70eNR/</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#3-\u81ea\u52a8\u6269\u7f29\u5bb9hpa","title":"3. \u81ea\u52a8\u6269\u7f29\u5bb9HPA","text":"<p>\u5728\u96c6\u7fa4\u5b89\u88c5\u7684\u7b2c1\u30012\u7ae0\uff0c\u6211\u4eec\u5b89\u88c5\u4e86\u4e00\u4e2a\u53ebMetrics Server\u7684\u7ec4\u4ef6\uff0c\u8be5\u7ec4\u4ef6\u5728\u96c6\u7fa4\u4e2d\u8d1f\u8d23\u91c7\u96c6Pod\u548cNode\u7684\u5ea6\u91cf\u6307\u6807\uff0c \u6bd4\u5982Pod\u7684CPU\u3001\u5185\u5b58\u4f7f\u7528\u7387\u548c\u8282\u70b9\u7684\u5185\u5b58\u3001CPU\u4f7f\u7528\u7387\uff0c\u800c\u4e14\u5b89\u88c5\u7684Dashboard\u53ef\u4ee5\u5c55\u793aCPU\u3001\u5185\u5b58\u4fe1\u606f\u4e5f\u662f \u4f9d\u9760Metrics Server\u7684\u3002</p> <p>\u5f53\u7136\uff0c\u8be5\u7ec4\u4ef6\u4e0d\u4ec5\u4ec5\u662f\u7528\u6765\u5c55\u793a\u6570\u636e\u7684\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528Metrics Server\u63d0\u4f9b\u7684\u6570\u636e\u7ed3\u5408Kubernetes\u7684HPA\u529f\u80fd\u5b9e\u73b0Pod\u7684\u81ea\u52a8\u6269\u5bb9\u548c\u7f29\u5bb9\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#31-\u4ec0\u4e48\u662fhpa","title":"3.1 \u4ec0\u4e48\u662fHPA","text":"<p>HPA\uff08Horizontal Pod Autoscaler\uff0c\u6c34\u5e73Pod\u81ea\u52a8\u4f38\u7f29\u5668\uff09\u53ef\u4ee5\u6839\u636e\u89c2\u5bdf\u5230\u7684CPU\u3001\u5185\u5b58\u4f7f\u7528\u7387\u6216\u81ea\u5b9a\u4e49\u5ea6\u91cf\u6807\u51c6\u6765\u81ea\u52a8\u6269\u5c55\u6216\u7f29\u5bb9Pod\u7684\u6570\u91cf\u3002</p> <p>\u6ce8\u610f\uff1a HPA\u4e0d\u9002\u7528\u4e8e\u65e0\u6cd5\u7f29\u653e\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982DaemonSet\u3002</p> <p>HPA\u63a7\u5236\u5668\u4f1a\u5b9a\u671f\u8c03\u6574RC\u6216Deployment\u7684\u526f\u672c\u6570\uff0c\u4ee5\u4f7f\u89c2\u5bdf\u5230\u7684\u5e73\u5747CPU \u5229\u7528\u7387\u4e0e\u7528\u6237\u6307\u5b9a\u7684\u76ee\u6807\u76f8\u5339\u914d\u3002</p> <p>HPA\u9700\u8981Metrics Server\uff08\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/kubernetes- sigs/metrics-server\uff09\u83b7\u53d6\u5ea6\u91cf\u6307\u6807\uff0c\u7531\u4e8e\u5728\u9ad8\u53ef\u7528\u96c6\u7fa4\u5b89\u88c5\u4e2d\u5df2\u7ecf\u5b89\u88c5\u4e86Metrics Server\uff0c\u6240\u4ee5\u672c\u8282\u7684\u5b9e\u8df5\u90e8\u5206\u65e0\u987b\u518d\u6b21\u5b89\u88c5\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#32-hpa\u5b9e\u8df5--\u5b9e\u73b0web\u670d\u52a1\u5668\u7684\u81ea\u52a8\u4f38\u7f29\u7279\u6027","title":"3.2 HPA\u5b9e\u8df5--\u5b9e\u73b0Web\u670d\u52a1\u5668\u7684\u81ea\u52a8\u4f38\u7f29\u7279\u6027","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u603b\u4f1a\u6709\u4e00\u4e9b\u610f\u60f3\u4e0d\u5230\u7684\u4e8b\u60c5\u53d1\u751f\uff0c\u6bd4\u5982\u516c\u53f8\u7f51\u7ad9\u6d41\u91cf\u7a81 \u7136\u5347\u9ad8\uff0c\u6b64\u65f6\u4e4b\u524d\u521b\u5efa\u7684Pod\u5df2\u4e0d\u8db3\u4ee5\u652f\u6491\u6240\u6709\u7684\u8bbf\u95ee\uff0c \u800c\u8fd0\u7ef4\u4eba\u5458\u4e5f\u4e0d\u53ef\u80fd 24\u5c0f\u65f6\u5b88\u7740\u4e1a\u52a1\u670d\u52a1\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6eHPA\uff0c\u5b9e\u73b0\u8d1f\u8f7d\u8fc7\u9ad8\u7684\u60c5\u51b5\u4e0b\u81ea\u52a8\u6269\u5bb9Pod\u526f\u672c\u6570\u4ee5\u5206\u644a\u9ad8\u5e76\u53d1\u7684\u6d41\u91cf\uff0c\u5f53\u6d41\u91cf\u6062\u590d\u6b63\u5e38\u540e\uff0cHPA\u4f1a\u81ea\u52a8\u7f29\u51cfPod\u7684\u6570\u91cf\u3002</p> <p>\u672c\u8282\u5c06\u6d4b\u8bd5\u5b9e\u73b0\u4e00\u4e2aWeb\u670d\u52a1\u5668\u7684\u81ea\u52a8\u4f38\u7f29\u7279\u6027\uff0c\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <p>hpa-demo.yml</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: hpa-demo\nspec:\nselector:\nmatchLabels:\napp: nginx\ntemplate:\nmetadata:\nlabels:\napp: nginx\nspec:\ncontainers:\n- name: nginx\nimage: nginx\nports:\n- containerPort: 80\nresources:\nrequests:\nmemory: 50Mi\ncpu: 50m\n</code></pre> <p>\u7136\u540e\u91cd\u65b0\u66f4\u65b0 Deployment\uff0c\u91cd\u65b0\u521b\u5efa HPA \u5bf9\u8c61\uff1a</p> <pre><code>$ kubectl apply -f hpa-demo.yml\ndeployment.apps/hpa-demo configured\n\n$ kubectl get pods -o wide -l app=nginx\nNAME                        READY   STATUS    RESTARTS   AGE     IP            NODE         NOMINATED NODE   READINESS GATES\nhpa-demo-69968bb59f-twtdp   1/1     Running   0          4m11s   10.244.4.97   ydzs-node4   &lt;none&gt;           &lt;none&gt;\n\n$ kubectl delete hpa hpa-demo\nhorizontalpodautoscaler.autoscaling \"hpa-demo\" deleted\n\n$ kubectl autoscale deployment hpa-demo --cpu-percent=10 --min=1 --max=10\nhorizontalpodautoscaler.autoscaling/hpa-demo autoscaled\n\n$ kubectl describe hpa hpa-demo\nName:                                                  hpa-demo\nNamespace:                                             default\nLabels:                                                &lt;none&gt;\nAnnotations:                                           &lt;none&gt;\nCreationTimestamp:                                     Tue, 19 Nov 2019 17:23:49 +0800\nReference:                                             Deployment/hpa-demo\nMetrics:                                               ( current / target )\nresource cpu on pods  (as a percentage of request):  0% (0) / 10%\nMin replicas:                                          1\nMax replicas:                                          10\nDeployment pods:                                       1 current / 1 desired\nConditions:\n  Type            Status  Reason               Message\n  ----            ------  ------               -------\n  AbleToScale     True    ScaleDownStabilized  recent recommendations were higher than current one, applying the highest recent recommendation\n  ScalingActive   True    ValidMetricFound     the HPA was able to successfully calculate a replica count from cpu resource utilization (percentage of request)\nScalingLimited  False   DesiredWithinRange   the desired count is within the acceptable range\nEvents:           &lt;none&gt;\n\n$ kubectl get hpa\nNAME       REFERENCE             TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\nhpa-demo   Deployment/hpa-demo   0%/10%    1         10        1          52s </code></pre> <p>\u73b0\u5728\u53ef\u4ee5\u770b\u5230 HPA \u8d44\u6e90\u5bf9\u8c61\u5df2\u7ecf\u6b63\u5e38\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u6765\u589e\u5927\u8d1f\u8f7d\u8fdb\u884c\u6d4b\u8bd5\uff0c\u6211\u4eec\u6765\u521b\u5efa\u4e00\u4e2a busybox \u7684 Pod\uff0c\u5e76\u4e14\u5faa\u73af\u8bbf\u95ee\u4e0a\u9762\u521b\u5efa\u7684 Pod\uff1a</p> <pre><code>$ kubectl run -it --image busybox test-hpa --restart=Never --rm /bin/sh\nIf you don't see a command prompt, try pressing enter.\n/ # while true; do wget -q -O- http://10.244.4.97; done\n</code></pre> <p>\u5982\u4e0b\u53ef\u4ee5\u770b\u5230\uff0cHPA \u5df2\u7ecf\u5f00\u59cb\u5de5\u4f5c\uff1a</p> <pre><code>$  kubectl get hpa\nNAME       REFERENCE             TARGETS    MINPODS   MAXPODS   REPLICAS   AGE\nhpa-demo   Deployment/hpa-demo   338%/10%   1         10        1          5m15s\n\n$ kubectl get pods -l app=nginx --watch\nNAME                        READY   STATUS              RESTARTS   AGE\nhpa-demo-69968bb59f-8hjnn   1/1     Running             0          22s\nhpa-demo-69968bb59f-9ss9f   1/1     Running             0          22s\nhpa-demo-69968bb59f-bllsd   1/1     Running             0          22s\nhpa-demo-69968bb59f-lnh8k   1/1     Running             0          37s\nhpa-demo-69968bb59f-r8zfh   1/1     Running             0          22s\nhpa-demo-69968bb59f-twtdp   1/1     Running             0          6m43s\nhpa-demo-69968bb59f-w792g   1/1     Running             0          37s\nhpa-demo-69968bb59f-zlxkp   1/1     Running             0          37s\nhpa-demo-69968bb59f-znp6q   0/1     ContainerCreating   0          6s\nhpa-demo-69968bb59f-ztnvx   1/1     Running             0          6s\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u81ea\u52a8\u62c9\u8d77\u4e86\u5f88\u591a\u65b0\u7684 Pod\uff0c\u6700\u540e\u5b9a\u683c\u5728\u4e86\u6211\u4eec\u4e0a\u9762\u8bbe\u7f6e\u7684 10 \u4e2a Pod\uff0c\u540c\u65f6\u67e5\u770b\u8d44\u6e90 hpa-demo \u7684\u526f\u672c\u6570\u91cf\uff0c\u526f\u672c\u6570\u91cf\u5df2\u7ecf\u4ece\u539f\u6765\u76841\u53d8\u6210\u4e8610\u4e2a\uff1a</p> <pre><code>$ kubectl get deployment hpa-demo\nNAME       READY   UP-TO-DATE   AVAILABLE   AGE\nhpa-demo   10/10   10           10          17m\n</code></pre> <p>\u67e5\u770b HPA \u8d44\u6e90\u7684\u5bf9\u8c61\u4e86\u89e3\u5de5\u4f5c\u8fc7\u7a0b\uff1a</p> <pre><code>$ kubectl describe hpa hpa-demo\nName:                                                  hpa-demo\nNamespace:                                             default\nLabels:                                                &lt;none&gt;\nAnnotations:                                           &lt;none&gt;\nCreationTimestamp:                                     Tue, 19 Nov 2019 17:23:49 +0800\nReference:                                             Deployment/hpa-demo\nMetrics:                                               ( current / target )\nresource cpu on pods  (as a percentage of request):  0% (0) / 10%\nMin replicas:                                          1\nMax replicas:                                          10\nDeployment pods:                                       10 current / 10 desired\nConditions:\n  Type            Status  Reason               Message\n  ----            ------  ------               -------\n  AbleToScale     True    ScaleDownStabilized  recent recommendations were higher than current one, applying the highest recent recommendation\n  ScalingActive   True    ValidMetricFound     the HPA was able to successfully calculate a replica count from cpu resource utilization (percentage of request)\nScalingLimited  True    TooManyReplicas      the desired replica count is more than the maximum replica count\nEvents:\n  Type    Reason             Age    From                       Message\n  ----    ------             ----   ----                       -------\n  Normal  SuccessfulRescale  5m45s  horizontal-pod-autoscaler  New size: 4; reason: cpu resource utilization (percentage of request) above target\n  Normal  SuccessfulRescale  5m30s  horizontal-pod-autoscaler  New size: 8; reason: cpu resource utilization (percentage of request) above target\n  Normal  SuccessfulRescale  5m14s  horizontal-pod-autoscaler  New size: 10; reason: cpu resource utilization (percentage of request) above target\n</code></pre> <p>\u540c\u6837\u7684\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u6765\u5173\u6389 busybox \u6765\u51cf\u5c11\u8d1f\u8f7d\uff0c\u7136\u540e\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u89c2\u5bdf\u4e0b HPA \u548c Deployment \u5bf9\u8c61\uff1a</p> <pre><code>$ kubectl get hpa\nNAME       REFERENCE             TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\nhpa-demo   Deployment/hpa-demo   0%/10%    1         10        1          14m\n\n$ kubectl get deployment hpa-demo\nNAME       READY   UP-TO-DATE   AVAILABLE   AGE\nhpa-demo   1/1     1            1           24m\n</code></pre> <p>\u7f29\u653e\u95f4\u9699</p> <p>\u4eceKubernetes v1.12\u7248\u672c\u5f00\u59cb\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6ekube-controller-manager\u7ec4\u4ef6\u7684<code>--horizontal-pod-autoscaler-downscale-stabilization</code>\u53c2\u6570\u6765\u8bbe\u7f6e\u4e00\u4e2a\u6301\u7eed\u65f6\u95f4\uff0c \u7528\u4e8e\u6307\u5b9a\u5728\u5f53\u524d\u64cd\u4f5c\u5b8c\u6210\u540e\uff0cHPA \u5fc5\u987b\u7b49\u5f85\u591a\u957f\u65f6\u95f4\u624d\u80fd\u6267\u884c\u53e6\u4e00\u6b21\u7f29\u653e\u64cd\u4f5c\u3002</p> <p>\u9ed8\u8ba4\u4e3a5\u5206\u949f\uff0c\u4e5f\u5c31\u662f\u9ed8\u8ba4\u9700\u8981\u7b49\u5f855\u5206\u949f\u540e\u624d\u4f1a\u5f00\u59cb\u81ea\u52a8\u7f29\u653e\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u526f\u672c\u6570\u91cf\u5df2\u7ecf\u753110\u53d8\u4e3a1\uff0c\u5f53\u524d\u6211\u4eec\u53ea\u662f\u6f14\u793a\u4e86CPU\u4f7f\u7528\u7387\u8fd9\u4e00\u4e2a\u6307\u6807\uff0c\u5728\u540e\u9762\u7684\u8bfe\u7a0b\u4e2d\u6211\u4eec\u8fd8\u4f1a\u5b66\u4e60\u5230\u6839\u636e\u81ea\u5b9a\u4e49\u7684\u76d1\u63a7\u6307\u6807\u6765\u81ea\u52a8\u5bf9 Pod \u8fdb\u884c\u6269\u7f29\u5bb9\u3002</p> <p>Pod\u6c34\u5e73\u81ea\u52a8\u6269\u7f29</p> <p>https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale/</p> <p>HorizontalPodAutoscaler\u6f14\u7ec3</p> <p>https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#4-taint\u548ctoleration","title":"4. Taint\u548cToleration","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u6709\u8fd9\u6837\u7684\u9700\u6c42\uff1a</p> <ul> <li> <p>Master\u8282\u70b9\u53ea\u90e8\u7f72\u7cfb\u7edf\u7ec4\u4ef6\u5bb9\u5668\uff0c\u6bd4\u5982Calico\u3001Metrics Server\u3001 Dashboard\u7b49\uff0c\u4e0d\u5e94\u8be5\u90e8\u7f72\u4e1a\u52a1\u5e94\u7528\u3002</p> </li> <li> <p>\u65b0\u6dfb\u52a0\u8282\u70b9\u4e0d\u5e94\u8be5\u7acb\u9a6c\u5c31\u5141\u8bb8\u90e8\u7f72\u4e1a\u52a1\u5bb9\u5668\uff0c\u4e5f\u5c31\u662f\u65b0\u8282\u70b9\u9700\u8981\u7ecf\u8fc7\u5b8c\u6574\u6027\u53ca\u7a33\u5b9a\u6027\u6d4b\u8bd5\u624d\u53ef\u4ee5\u88ab\u5141\u8bb8\u8c03\u5ea6\u3002</p> </li> <li> <p>\u67d0\u4e9b\u8282\u70b9\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u7cfb\u7edf\u5347\u7ea7\u6216\u8005\u5176\u4ed6\u7ef4\u62a4\uff0c\u53ef\u80fd\u4f1a\u5f15\u8d77\u8282\u70b9\u4e0a\u7684\u5bb9\u5668\u4e0d\u53ef\u7528\uff0c\u6b64\u65f6\u9700\u8981\u5c06\u8be5\u8282\u70b9\u4e0a\u7684Pod\u6f02\u79fb\u81f3\u5176\u4ed6\u8282\u70b9\uff0c\u518d\u8fdb\u884c\u7ef4\u62a4\u3002</p> </li> <li> <p>\u6709\u4e00\u4e9bGPU\u670d\u52a1\u5668\u6216\u5176\u4ed6\u4e13\u7528\u8282\u70b9\u670d\u52a1\u5668\uff0c\u9664\u4e86\u6307\u5b9a\u7684Pod\u5916\uff0c\u5e76\u4e0d\u60f3\u8ba9\u5b83\u4eec\u90e8\u7f72\u5176\u4ed6Pod\u3002</p> </li> </ul> <p>\u9762\u5bf9\u8fd9\u6837\u7684\u9700\u6c42\uff0cKubernetes\u62bd\u8c61\u4e86\u6c61\u70b9(Taint)\u548c\u5bb9\u5fcd(Toleration)\u7684\u6982\u5ff5\uff0c\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u5b9e\u73b0\u8fd9\u4e9b\u9700\u6c42\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#41-\u5bb9\u5fcd\u548c\u6c61\u70b9\u7684\u57fa\u672c\u6982\u5ff5","title":"4.1 \u5bb9\u5fcd\u548c\u6c61\u70b9\u7684\u57fa\u672c\u6982\u5ff5","text":"<p>Taint\u4f5c\u7528\u5728\u8282\u70b9\u4e0a\uff0c\u80fd\u591f\u4f7f\u8282\u70b9\u6392\u65a5\u4e00\u7c7b\u7279\u5b9a\u7684Pod\uff0c\u4e5f\u5c31\u662f\u4e0d\u80fd\u201c\u517c \u5bb9\u201d\u8be5\u8282\u70b9\u7684\u6c61\u70b9\u7684Pod\u3002</p> <p>\u5bf9\u5e94\u7684Toleration\u4f5c\u7528\u5728Pod\u4e0a\uff0c\u610f\u4e3a\u5bb9\u5fcd\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u517c\u5bb9\u67d0\u7c7b\u6c61\u70b9\u3002</p> <p>Taint\u548cToleration\u76f8\u4e92\u914d\u5408\u53ef\u4ee5\u7528\u6765\u907f\u514dPod\u88ab\u5206\u914d\u5230\u4e0d\u5408\u9002\u7684\u8282\u70b9\uff0c\u6bd4\u5982\u6709\u4e00\u6279GPU\u670d\u52a1\u5668\u53ea\u80fd\u90e8\u7f72\u8981\u4f7f\u7528GPU\u7684Pod\u3002</p> <p>\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u53ef\u4ee5\u5e94\u7528\u4e00\u4e2a\u6216\u591a\u4e2aTaint\uff0c\u8fd9\u8868\u793a\u5bf9\u4e8e\u90a3\u4e9b\u4e0d\u80fd\u5bb9\u5fcd\u8fd9\u4e9bTaint\u7684Pod\u662f\u4e0d\u80fd\u90e8\u7f72\u5728\u8be5\u670d\u52a1\u5668\u4e0a\u7684\u3002</p> <p>\u5982\u679cPod\u914d\u7f6e\u4e86Toleration\uff0c\u5219\u8868\u793a\u8fd9\u4e9bPod\u53ef\u4ee5\u88ab\u8c03\u5ea6\u5230\u8bbe\u7f6e\u4e86Taint\u7684\u8282\u70b9\u4e0a\uff0c\u5f53\u7136\u6ca1\u6709\u8bbe\u7f6eTaint\u7684\u8282\u70b9\u4e5f\u662f\u53ef\u4ee5\u90e8\u7f72\u7684\u3002</p> <p>\u7ed9\u8282\u70b9\u589e\u52a0\u4e00\u4e2aTaint\u4e5f\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u4f7f\u7528kubectl taint\u547d\u4ee4\u5373\u53ef\uff0c\u6bd4\u5982\u7ed9k8s-node01\u8282\u70b9\u8bbe\u7f6e\u4e00\u4e2aTaint\uff1a</p> <pre><code># kubectl taint nodes k8s-node01 taintKey=taintValue:NoSchedule\nnode/k8s-node01 tainted\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u7ed9k8s-node01\u589e\u52a0\u4e86\u4e00\u4e2aTaint\uff0c\u5b83\u7684taintKey(\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u5176\u4ed6\u503c)\u5bf9\u5e94\u7684\u5c31\u662fTaint\u7684\u952e\uff0c taintValue(\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u5176\u4ed6\u503c)\u5bf9\u5e94\u5c31\u662fTaint\u7684\u503c,Effect\u5bf9\u5e94\u7684\u5c31\u662fNoSchedule\uff0c \u987e\u540d\u601d\u4e49\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e2aTaint\u7684\"\u5f71\u54cd\"\u76f8\u5f53\u4e8eTaint\u7684\"\u7ea7\u522b\"\u3002</p> <p>\u8fd9\u8868\u660e\u53ea\u6709\u548c\u8fd9\u4e2aTaint\u76f8\u5339\u914d\u7684Toleration\u7684Pod\u624d\u80fd\u591f\u88ab\u5206\u914d\u5230k8s-node01\u8282\u70b9\u4e0a\u3002</p> <p>\u6309\u5982\u4e0b\u65b9\u5f0f\u5728PodSpec\u4e2d\u5b9a\u4e49Pod\u7684Toleration\uff0c\u5c31\u53ef\u4ee5\u5c06Pod\u90e8\u7f72\u5230\u8be5\u8282\u70b9\u4e0a\u3002</p> <p>\u65b9\u5f0f\u4e00</p> <p>\u5b8c\u5168\u5339\u914d\uff0coperator\u4e3aEqual\uff0c\u6bd4\u5982\u80fd\u5bb9\u5fcdkey\u540d\u4e3ataintKey\u3001value\u4e3ataintValue\u3001effect\u4e3aNoSchedule\u7684Taint\uff08Toleration\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\uff09\uff1a</p> <pre><code>tolerations:\n- key: \"taintKey\"\n  operator: \"Equal\"\n  value: \"taintValue\"\n  effect: \"NoSchedule\"\n</code></pre> <p>\u65b9\u5f0f\u4e8c</p> <p>\u4e0d\u5b8c\u5168\u5339\u914d\uff0coperator\u4e3aExists\uff0c\u6bd4\u5982\u80fd\u5bb9\u5fcdkey\u540d\u4e3ataintKey\u3001effect\u4e3aNoSchedule\u7684Taint\uff0c\u4e0d\u8003\u8651Taint\u7684value\u662f\u4ec0\u4e48\uff1a</p> <pre><code>tolerations:\n- key: \"taintKey\"\n  operator: \"Exists\"\n  effect: \"NoSchedule\"\n</code></pre> <p>\u5f53\u7136\uff0c\u8fd8\u53ef\u4ee5\u5339\u914d\u66f4\u5927\u7684\u8303\u56f4\uff0c\u6bd4\u5982\u80fd\u5bb9\u5fcdkey\u540d\u4e3ataintKey\u7684Taint\uff1a</p> <pre><code>- key: \"taintKey\"\n  operator: \"Exists\"\n</code></pre> <p>\u7efc\u4e0a\u53ef\u77e5\uff0c \u5982\u679cPod\u7684Toleration\u914d\u7f6e\u7684operator\u4e3aExists(\u6b64\u65f6toleration\u4e0d\u6307\u5b9avalue\uff09\uff0c \u90a3\u4e48\u4e00\u4e2aToleration\u548c\u4e00\u4e2aTaint\u76f8\u5339\u914d\u662f\u6307\u5b83\u4eec\u6709\u4e00\u6837\u7684key\u548ceffect\uff0c\u5982\u679coperator\u662fEqual\uff0c\u5219\u5b83\u4eec\u7684value\u4e5f\u5e94\u8be5\u76f8\u7b49\u3002</p> <p>\u6ce8\u610f\u4e24\u79cd\u7279\u6b8a\u60c5\u51b5\uff1a - \u5982\u679c\u4e00\u4e2aToleration\u7684key\u3001value\u548ceffect\u5747\u4e3a\u7a7a\uff0c\u4e14operator\u4e3aExists\uff0c\u8868\u793a\u8fd9\u4e2aToleration\u4e0e\u4efb\u610f\u7684key\u3001value\u548ceffect\u90fd\u5339   \u914d\uff0c\u5373\u8fd9\u4e2aToleration\u80fd\u5bb9\u5fcd\u4efb\u610f\u7684Taint\uff1a</p> <pre><code>tolerations:\n- operator: \"Exists\"\n</code></pre> <ul> <li>\u5982\u679c\u4e00\u4e2aToleration\u7684effect\u4e3a\u7a7a\uff0c\u5219\u8fd9\u4e2aToleration\u53ef\u4ee5\u5bb9\u5fcd\u4efb\u4f55key\u4e3a\u540dtaintKey\u7684Taint\uff0c\u65e0\u8bba\u8be5Taint\u7684value\u548ceffect\u662f\u4ec0\u4e48\uff1a <pre><code>tolerations:\n- key: \"taintKey\"\n  operator: \"Exists\"\n</code></pre></li> </ul> <p>\u4e0a\u8ff0\u4f8b\u5b50\u4f7f\u7528\u5230effect\u7684\u4e00\u4e2a\u503cNoSchedule\uff08\u7981\u6b62\u8c03\u5ea6\u7684\u610f\u601d\uff0c\u4e00\u822c\u8be5\u8282\u70b9\u8981\u7ef4\u62a4\u6216\u8005\u521a\u6dfb\u52a0\u8282\u70b9\u4f1a\u914d\u7f6e\u8be5Taint\uff09\uff0c \u4e5f\u53ef\u4ee5\u4f7f\u7528PreferNoSchedule\uff0c\u8be5\u503c\u5b9a\u4e49\u5c3d\u91cf\u907f\u514d\u5c06Pod\u8c03\u5ea6\u5230\u5b58\u5728\u5176\u4e0d\u80fd\u5bb9\u5fcd\u7684Taint \u7684\u8282\u70b9\u4e0a\uff0c\u4f46\u5e76\u4e0d\u662f\u5f3a\u5236\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u6ca1\u6709\u914d\u7f6eToleration\u7684Pod\u4f1a\u4f18 \u5148\u90e8\u7f72\u81f3\u5176\u4ed6\u8282\u70b9\uff0c\u6ca1\u6709\u5176\u4ed6\u53ef\u4ee5\u8c03\u5ea6\u7684\u8282\u70b9\u65f6\uff0c\u8fd8\u662f\u53ef\u4ee5\u90e8\u7f72\u5230effect\u4e3a PreferNoSchedule\u7684\u8282\u70b9\u4e0a\u7684\uff0cNoSchedule\u6ca1\u6709\u8fd9\u79cd\u673a\u5236\u3002</p> <p>Effect\u7684\u503c\u8fd8\u53ef \u4ee5\u8bbe\u7f6e\u4e3aNoExecute\uff0c\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u7684Taint\u7684Effect\u914d\u7f6e\u4e3aNoExecute\uff0c\u90a3\u4e48\u5df2\u7ecf\u5728\u8fd9\u4e2a\u8282\u70b9\u4e0a\u7684Pod\u6ca1\u6709\u914d\u7f6e\u5bb9\u5fcd\u8be5Taint\u7684Toleration\uff0c \u8fd9\u4e2a\u8282\u70b9\u4e0a\u7684Pod\u4f1a\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u88ab\u9a71\u9010\u5230\u5176\u4ed6\u8282\u70b9\u4e0a\uff0c\u4f46Effect\u4e3aNoSchedule\u6216PreferNoSchedule\u65f6\u4e0d\u4f1a\u9a71\u9010\u5df2\u7ecf\u5728\u8be5\u8282\u70b9\u4e0a\u7684Pod\u3002</p> <p>\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2aTaint\uff0c\u4e5f\u53ef\u4ee5\u7ed9\u4e00\u4e2aPod\u6dfb\u52a0\u591a\u4e2aToleration\u3002</p> <p>Kubernetes\u5904\u7406\u591a\u4e2aTaint\u548cToleration\u7684\u8fc7\u7a0b\u5c31\u50cf\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff1a \u4ece\u4e00\u4e2a\u8282\u70b9 \u7684\u6240\u6709Taint\u5f00\u59cb\u904d\u5386\uff0c\u8fc7\u6ee4\u6389\u90a3\u4e9bPod\u4e2d\u5b58\u5728\u4e0e\u4e4b\u76f8\u5339\u914d\u7684Toleration\u7684Taint\uff0c\u4f59\u4e0b\u672a\u88ab\u8fc7\u6ee4\u7684Taint\u7684effect\u503c\u51b3\u5b9a\u4e86Pod\u662f\u5426\u4f1a\u88ab\u5206\u914d\u5230\u8be5\u8282\u70b9\uff0c \u7279\u522b\u662f\u4ee5\u4e0b\u60c5\u51b5\uff1a</p> <ul> <li> <p>\u5982\u679c\u672a\u88ab\u8fc7\u6ee4\u7684Taint\u4e2d\u5b58\u5728\u4e00\u4e2a\u4ee5\u4e0aeffect\u503c\u4e3aNoSchedule\u7684Taint\uff0c\u5219Kubernetes\u4e0d\u4f1a\u5c06Pod\u5206\u914d\u5230\u8be5\u8282\u70b9\u3002</p> </li> <li> <p>\u5982\u679c\u672a\u88ab\u8fc7\u6ee4\u7684Taint\u4e2d\u4e0d\u5b58\u5728effect\u503c\u4e3aNoExecute\u7684Taint\uff0c\u4f46\u662f\u5b58\u5728effect\u503c\u4e3aPreferNoSchedule\u7684Taint\uff0c\u5219Kubernetes\u4f1a\u5c1d\u8bd5\u5c06Pod\u5206\u914d\u5230\u8be5\u8282\u70b9\u3002</p> </li> <li> <p>\u5982\u679c\u672a\u88ab\u8fc7\u6ee4\u7684Taint\u4e2d\u5b58\u5728\u4e00\u4e2a\u4ee5\u4e0aeffect\u503c\u4e3aNoExecute\u7684Taint\uff0c\u5219Kubernetes\u4e0d\u4f1a\u5c06Pod\u5206\u914d\u5230\u8be5\u8282\u70b9(\u5982\u679cPod\u8fd8\u672a\u5728\u8282\u70b9\u4e0a\u8fd0\u884c)\uff0c\u6216\u8005\u5c06Pod\u4ece\u8be5\u8282\u70b9\u9a71\u9010(\u5982\u679cPod\u5df2\u7ecf\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\uff09\u3002</p> </li> </ul> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u7ed9\u4e00\u4e2a\u8282\u70b9\u6dfb\u52a0\u4e86\u4ee5\u4e0bTaint\uff1a <pre><code>kubectl taint nodes k8s-node01 key1=value1:NoSchedule\nkubectl taint nodes k8s-node01 key1=value1:NoExecute\nkubectl taint nodes k8s-node01 key2=value2:NoSchedule\n</code></pre></p> <p>\u7136\u540e\u5b58\u5728\u4e00\u4e2aPod\uff0c\u5b83\u6709\u4e24\u4e2aToleration\uff1a</p> <p><pre><code>tolerations:\n- key: \"key1\"\n  operator: \"Equal\"\n  value: \"value1\"\n  effect: \"NoSchedule\"\n\n- key: \"key1\"\n  operator: \"Equal\"\n  value: \"value1\"\n  effect: \"NoExecute\"\n</code></pre> \u5728\u4e0a\u8ff0\u4f8b\u5b50\u4e2d\uff0c\u8be5Pod\u4e0d\u4f1a\u88ab\u5206\u914d\u5230\u4e0a\u8ff0\u8282\u70b9\uff0c\u56e0\u4e3a\u6ca1\u6709\u5339\u914d\u7b2c3\u4e2aTaint\u3002</p> <p>\u4f46\u662f\u5982\u679c\u7ed9\u8282\u70b9\u6dfb\u52a0\u4e0a\u8ff03\u4e2aTaint\u4e4b\u524d\uff0c\u8be5Pod\u5df2\u7ecf\u5728\u4e0a\u8ff0\u8282\u70b9\u4e2d\u8fd0\u884c\uff0c\u90a3\u4e48\u5b83\u4e0d\u4f1a\u88ab\u9a71\u9010\uff0c\u8fd8\u4f1a\u7ee7\u7eed\u8fd0\u884c\u5728\u8fd9\u4e2a\u8282\u70b9\u4e0a\uff0c \u56e0\u4e3aEffect\u4e3aNoSchedule\u7684Taint\u53ea\u662f\u7981\u6b62\u8ba9\u6ca1\u6709\u5339\u914d\u8be5Taint\u7684Pod\u4e0d\u4f1a\u88ab\u8c03\u5ea6\u5230\u8be5\u8282\u70b9\u4e0a\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5df2\u7ecf\u90e8\u7f72\u7684Pod\u3002</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u7ed9\u4e00\u4e2a\u8282\u70b9\u6dfb\u52a0\u4e86\u4e00\u4e2aeffect\u503c\u4e3aNoExecute\u7684Taint\uff0c\u5219\u4efb\u4f55\u4e0d\u80fd\u5bb9\u5fcd\u8fd9\u4e2aTaint\u7684Pod\u90fd\u4f1a\u9a6c\u4e0a\u88ab\u9a71\u9010\uff0c\u4efb\u4f55\u53ef\u4ee5\u5bb9\u5fcd\u8fd9\u4e2a Taint\u7684Pod\u90fd\u4e0d\u4f1a\u88ab\u9a71\u9010\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679cPod\u5b58\u5728\u4e00\u4e2aeffect\u503c\u4e3aNoExecute\u7684Toleration\u6307\u5b9a\u4e86\u53ef\u9009\u5c5e\u6027tolerationSeconds\u7684\u503c\uff0c\u5219\u8be5\u503c\u8868\u793a\u5728\u7ed9\u8282\u70b9\u6dfb\u52a0\u4e86\u4e0a\u8ff0Taint\u4e4b\u540e\uff0cPod\u8fd8\u80fd\u7ee7\u7eed\u5728\u8be5\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u4f8b\u5982\uff1a <pre><code>tolerations:\n- key: \"key1\"\n  operator: \"Equal\"\n  value: \"value1\"\n  effect: \"NoExecute\"\n  tolerationSeconds: 3600\n</code></pre> \u8868\u793a\u5982\u679c\u8fd9\u4e2aPod\u6b63\u5728\u67d0\u4e2a\u8282\u70b9\u8fd0\u884c\uff0c\u7136\u540e\u4e00\u4e2aEffect\u4e3aNoExecute\u7684Taint\u88ab\u6dfb\u52a0\u5230\u5176\u6240\u5728\u7684\u8282\u70b9\uff0c\u90a3\u4e48Pod\u8fd8\u5c06\u7ee7\u7eed\u5728\u8282\u70b9\u4e0a\u8fd0\u884c3600\u79d2\uff0c\u7136\u540e\u88ab\u9a71\u9010\u3002</p> <p>\u5982\u679c\u5728\u6b64\u4e4b\u524d\u4e0a\u8ff0Taint\u88ab\u5220\u9664\u4e86\uff0c\u5219Pod\u4e0d\u4f1a\u88ab\u9a71\u9010\u3002</p> <p>\u5220\u9664\u4e00\u4e2aTaint\u548c\u5220\u9664Label\u7c7b\u4f3c\uff0c\u4f7f\u7528\u51cf\u53f7\uff08\u2012\uff09\u5373\u53ef\uff1a <pre><code># kubectl taint nodes k8s-node01 key1:NoExecute-\n</code></pre></p> <p>\u67e5\u770b\u67d0\u4e2a\u8282\u70b9\u7684Taint\u53ef\u4ee5\u4f7f\u7528describe\uff1a <pre><code># kubectl describe node k8s-node01 | grep Taint\nTaints:            key=value:NoSchedule\n</code></pre></p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#42-\u4f7f\u7528\u6848\u4f8b","title":"4.2 \u4f7f\u7528\u6848\u4f8b","text":"<p>\u901a\u8fc7Taint\u548cToleration\u53ef\u4ee5\u7075\u6d3b\u5730\u8ba9Pod\u907f\u5f00\u67d0\u4e9b\u8282\u70b9\u6216\u8005\u5c06Pod\u4ece\u67d0\u4e9b\u8282\u70b9\u9a71\u9010\u3002 \u4e0b\u9762\u662f\u51e0\u79cd\u4f7f\u7528\u6848\u4f8b\u3002</p> <p>\uff081\uff09\u4e13\u7528\u8282\u70b9 \u5982\u679c\u60f3\u5c06\u67d0\u4e9b\u8282\u70b9\u4e13\u95e8\u5206\u914d\u7ed9\u7279\u5b9a\u7684\u4e00\u7ec4\u7528\u6237\u4f7f\u7528\uff0c\u53ef\u4ee5\u7ed9\u8fd9\u4e9b\u8282\u70b9\u6dfb\u52a0\u4e00\u4e2aTaint( kubectl taint nodes nodename dedicated=groupName:NoSchedule\uff09\uff0c \u7136\u540e\u7ed9\u8fd9\u7ec4\u7528\u6237\u7684Pod\u6dfb\u52a0\u4e00\u4e2a\u76f8\u5bf9\u5e94\u7684Toleration\uff0c\u90a3\u4e48\u62e5\u6709\u4e0a\u8ff0Toleration\u7684Pod\u5c31\u80fd\u591f\u88ab\u5206\u914d\u5230\u4e0a\u8ff0\u4e13\u7528\u8282\u70b9\uff0c\u540c\u65f6\u4e5f\u80fd\u591f\u88ab\u5206\u914d\u5230\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6\u8282\u70b9\u3002</p> <p>\u5982\u679c\u5e0c\u671b\u8fd9\u4e9bPod\u53ea\u80fd\u5206\u914d\u5230\u4e0a\u8ff0\u4e13\u7528\u8282\u70b9\u4e2d\uff0c\u90a3\u4e48\u8fd8\u9700\u8981\u7ed9\u8fd9\u4e9b\u4e13\u7528\u8282\u70b9\u53e6\u5916\u6dfb\u52a0\u4e00\u4e2a\u548c\u4e0a\u8ff0Taint\u7c7b\u4f3c\u7684Label\uff08\u4f8b\u5982dedicated=groupName\uff09\uff0c\u7136\u540e\u7ed9Pod\u589e\u52a0\u8282\u70b9\u4eb2\u548c\u6027\u8981\u6c42\u6216\u8005\u4f7f \u7528NodeSelector\uff0c\u5c31\u80fd\u5c06Pod\u53ea\u5206\u914d\u5230\u6dfb\u52a0\u4e86dedicated=groupName\u6807\u7b7e\u7684\u8282\u70b9\u4e0a\u3002</p> <p>\uff082\uff09\u7279\u6b8a\u786c\u4ef6\u7684\u8282\u70b9 \u5728\u90e8\u5206\u8282\u70b9\u4e0a\u914d\u5907\u4e86\u7279\u6b8a\u786c\u4ef6\uff08\u6bd4\u5982GPU\uff09\u7684\u96c6\u7fa4\u4e2d\uff0c\u6211\u4eec\u53ea\u5141\u8bb8\u7279\u5b9a\u7684Pod\u624d\u80fd\u90e8\u7f72\u5728\u8fd9\u4e9b\u8282\u70b9\u4e0a\u3002 \u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528Taint\u8fdb\u884c\u63a7\u5236\uff0c\u6dfb\u52a0Taint\uff0c\u5982<code>kubectl taint nodes nodename special=true:NoSchedule</code> \u6216\u8005  <code>kubectl taint nodes nodename special=true:PreferNoSchedule</code>\uff0c\u7136\u540e\u7ed9\u9700\u8981\u90e8\u7f72\u5728\u8fd9\u4e9b\u8282\u70b9\u4e0a\u7684Pod\u6dfb\u52a0\u76f8\u5339\u914d\u7684Toleration\u5373\u53ef\u3002</p> <p>\uff083\uff09\u57fa\u4e8eTaint\u7684\u9a71\u9010 \u5c5e\u4e8ealpha\u7279\u6027\uff0c\u5728\u6bcf\u4e2aPod\u4e2d\u914d\u7f6e\u5728\u8282\u70b9\u51fa\u73b0\u95ee\u9898\u65f6\u7684\u9a71\u9010\u884c\u4e3a\uff0c\u53c2\u8003\u4e0b\u4e00\u5c0f\u8282\u3002</p> <p>\u6807\u7b7e\u3001\u6c61\u70b9\u8bbe\u7f6e\u4e3e\u4f8b</p> <pre><code># \u8bbe\u7f6e\u6807\u7b7e\nkubectl label nodes 172.18.0.76 node_role=giteePraefect\n\n# \u8bbe\u7f6e\u6c61\u70b9\nkubectl taint nodes 172.18.0.76 GiteePraefectOnly=yes:NoSchedule\n\n# \u5220\u9664\u6807\u7b7e\nkubectl label nodes 172.18.0.66 node_role-\n\n# \u5220\u9664\u6c61\u70b9\nkubectl taint node 172.18.0.66 GiteeInternalOnly:NoSchedule-\n\n# \u67e5\u770b\u6807\u7b7e\nkubectl get node --show-labels\nkubectl get node 172.18.0.66 --show-labels|grep giteeInternal\n\n# \u67e5\u770b\u6c61\u70b9\nkubectl describe nodes 172.18.0.66|grep -A 5 Taints\n</code></pre>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#43-\u57fa\u4e8etaint\u7684\u9a71\u9010","title":"4.3 \u57fa\u4e8eTaint\u7684\u9a71\u9010","text":"<p>\u4e4b\u524d\u63d0\u5230\u8fc7Taint\u7684effect\u503cNoExecute\uff0c\u5b83\u4f1a\u5f71\u54cd\u5df2\u7ecf\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u7684Pod\u3002</p> <p>\u5982\u679cPod\u4e0d\u80fd\u5fcd\u53d7effect\u503c\u4e3aNoExecute\u7684Taint\uff0c\u90a3\u4e48Pod\u5c06\u4f1a\u88ab\u9a6c\u4e0a\u9a71\u9010\u3002 \u5982\u679c\u80fd\u591f\u5fcd\u53d7effect\u503c\u4e3aNoExecute\u7684Taint\uff0c\u4f46\u662f\u5728Toleration\u5b9a\u4e49\u4e2d\u6ca1\u6709\u6307\u5b9atolerationSeconds\uff0c\u5219Pod\u8fd8\u4f1a\u4e00\u76f4\u5728\u8fd9\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u3002</p> <p>\u5728Kubernetes 1.6\u7248\u4ee5\u540e\u5df2\u7ecf\u652f\u6301\uff08alpha\uff09\u5f53\u67d0\u79cd\u6761\u4ef6\u4e3a\u771f\u65f6\uff0cNode Controller\u4f1a\u81ea\u52a8\u7ed9\u8282\u70b9\u6dfb\u52a0\u4e00\u4e2aTaint\uff0c\u7528\u4ee5\u8868\u793a\u8282\u70b9\u7684\u95ee\u9898\u3002 \u5f53\u524d\u5185\u7f6e\u7684Taint\u5305\u62ec\uff1a</p> <ul> <li>node.kubernetes.io/not-ready\uff1a\u8282\u70b9\u672a\u51c6\u5907\u597d\uff0c\u76f8\u5f53\u4e8e\u8282\u70b9\u72b6\u6001 Ready\u7684\u503c\u4e3aFalse\u3002</li> <li>node.kubernetes.io/unreachable\uff1a Node Controller\u8bbf\u95ee\u4e0d\u5230\u8282\u70b9\uff0c\u76f8\u5f53\u4e8e\u8282\u70b9\u72b6\u6001Ready\u7684\u503c\u4e3aUnknown\u3002</li> <li>node.kubernetes.io/out-of-disk\uff1a\u8282\u70b9\u78c1\u76d8\u8017\u5c3d\u3002</li> <li>node.kubernetes.io/memory-pressure\uff1a\u8282\u70b9\u5b58\u5728\u5185\u5b58\u538b\u529b\u3002</li> <li>node.kubernetes.io/disk-pressure\uff1a\u8282\u70b9\u5b58\u5728\u78c1\u76d8\u538b\u529b\u3002</li> <li>node.kubernetes.io/network-unavailable\uff1a\u8282\u70b9\u7f51\u7edc\u4e0d\u53ef\u8fbe\u3002</li> <li>node.kubernetes.io/unschedulable\uff1a\u8282\u70b9\u4e0d\u53ef\u8c03\u5ea6\u3002</li> <li>node.cloudprovider.kubernetes.io/uninitialized\uff1a\u5982\u679cKubelet \u542f\u52a8\u65f6\u6307\u5b9a\u4e86\u4e00\u4e2a\u5916\u90e8\u7684cloudprovider\uff0c\u5b83\u5c06\u7ed9\u5f53\u524d\u8282\u70b9\u6dfb\u52a0\u4e00\u4e2aTaint\u5c06\u5176\u6807\u8bb0\u4e3a\u4e0d\u53ef\u7528\u3002\u5728cloud-controller-manager\u7684\u4e00\u4e2aController\u521d\u59cb\u5316\u8fd9\u4e2a\u8282\u70b9\u540e\uff0cKubelet\u5c06\u5220\u9664\u8fd9\u4e2aTaint\u3002</li> </ul> <p>\u4f7f\u7528\u8fd9\u4e2aalpha\u529f\u80fd\u7279\u6027\u7ed3\u5408tolerationSeconds\uff0cPod\u5c31\u53ef\u4ee5\u6307\u5b9a\u5f53\u8282\u70b9\u51fa\u73b0\u4e00\u4e2a\u6216\u5168\u90e8\u4e0a\u8ff0\u95ee\u9898\u65f6\uff0cPod\u8fd8\u80fd\u5728\u8fd9\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u591a\u957f\u65f6\u95f4\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u4f7f\u7528\u4e86\u5f88\u591a\u672c\u5730\u72b6\u6001\u7684\u5e94\u7528\u7a0b\u5e8f\u5728\u7f51\u7edc\u65ad\u5f00\u65f6\uff0c\u4ecd\u7136\u5e0c\u671b\u505c \u7559\u5728\u5f53\u524d\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\uff0c\u613f\u610f\u7b49\u5f85\u7f51\u7edc\u6062\u590d\u4ee5\u907f\u514d\u88ab\u9a71\u9010\u3002 \u5728\u8fd9\u79cd\u60c5 \u51b5\u4e0b\uff0cPod\u7684Toleration\u53ef\u4ee5\u8fd9\u6837\u914d\u7f6e\uff1a</p> <pre><code>tolerations:\n- key: \"node.cloudprovider.kubernetes.io/uninitialized\"\n  operator: \"Exists\"\n  effect: \"NoExecute\"\n  tolerationSeconds: 6000\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879</p> <p>Kubernetes\u4f1a\u81ea\u52a8\u7ed9Pod\u6dfb\u52a0\u4e00\u4e2akey\u4e3anode.kubernetes.io/not-ready\u7684 Toleration\u5e76\u914d\u7f6etolerationSeconds=300\uff0c \u540c\u6837\u4e5f\u4f1a\u7ed9Pod\u6dfb\u52a0\u4e00\u4e2akey\u4e3a <code>node.kubernetes.io/unreachable</code>\u7684Toleration\u5e76\u914d\u7f6e tolerationSeconds=300\uff0c\u9664\u975e\u7528\u6237\u81ea\u5b9a\u4e49\u4e86\u4e0a\u8ff0key\uff0c\u5426\u5219\u4f1a\u91c7\u7528\u8fd9\u4e2a\u9ed8\u8ba4\u8bbe\u7f6e\uff0c \u610f\u601d\u5c31\u662f\u8bf4\u5982\u679c\u8282\u70b9\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u9020\u6210\u4e0d\u53ef\u7528\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0bPod\u4f1a \u57285\u5206\u949f\u540e\u624d\u4f1a\u6f02\u79fb\u81f3\u5176\u4ed6\u8282\u70b9\uff0c\u5bf9\u4e8e\u8981\u6c42\u9ad8\u53ef\u7528\u7387\u7684Pod\u6309\u9700\u4fee\u6539\u8fd9\u4e24\u5904 \u7684tolerationSeconds\u4e3a\u8f83\u77ed\u7684\u503c\uff0c\u5c31\u53ef\u4ee5\u5728\u8282\u70b9\u6545\u969c\u540e\u5feb\u901f\u8fdb\u884c\u6545\u969c\u6062\u590d\uff0c\u5f53\u7136\u4e5f\u4e0d\u80fd\u592a\u77ed\uff0c\u56e0\u4e3a\u53ef\u80fd\u67d0\u4e9b\u8282\u70b9\u662f\u7531\u4e8e\u7f51\u7edc\u6ce2\u52a8\u9020\u6210\u7684\u4e0d\u53ef\u7528\uff0c\u6240\u4ee5\u8be5\u503c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u573a\u666f\u8fdb\u884c\u8bbe\u7f6e\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u6dfb\u52a0Toleration\u7684\u673a\u5236\u4fdd\u8bc1\u4e86\u5728\u5176\u4e2d\u4e00\u79cd\u95ee\u9898\u88ab\u68c0\u6d4b\u5230\u65f6\uff0cPod\u9ed8\u8ba4\u8fd8\u80fd\u7ee7\u7eed\u505c\u7559\u5728\u5f53\u524d\u8282\u70b9\u8fd0\u884c5\u5206\u949f\u3002</p> <p>\u8fd9\u4e24\u4e2a\u9ed8\u8ba4Toleration\u662f\u7531DefaultTolerationSeconds admission controller\u6dfb\u52a0\u7684\u3002</p> <p>DaemonSet\u4e2d\u7684Pod\u88ab\u521b\u5efa\u65f6\uff0c\u9488\u5bf9\u4ee5\u4e0bTaint\u81ea\u52a8\u6dfb\u52a0\u7684NoExecute\u7684Toleration\u5c06\u4e0d\u4f1a\u6307\u5b9atolerationSeconds\uff1a - node.alpha.kubernetes.io/unreachable\u3002 - node.kubernetes.io/not-ready\u3002</p> <p>\u8fd9\u4fdd\u8bc1\u4e86\u51fa\u73b0\u4e0a\u8ff0\u95ee\u9898\u65f6\uff0cDaemonSet\u4e2d\u7684Pod\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u9a71\u9010\uff0c\u5f53\u7136DaemonSet\u7684Pod\u4e0d\u9700\u8981\u8fdb\u884c\u6f02\u79fb\u3002</p>"},{"location":"Kubernetes/3.%E8%BF%9B%E9%98%B6%E7%AF%87/9.Kubernetes%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6/#5-affinity\u4eb2\u548c\u529b","title":"5. Affinity\u4eb2\u548c\u529b","text":""},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/","title":"\u4e91\u539f\u751f\u5b58\u50a8Rook","text":"<p>\u5728\u7b2c8\u7ae0\uff0c\u6211\u4eec\u5b66\u4e60\u4e86\u57fa\u4e8eCeph\u5206\u5e03\u5f0f\u7684Kubernetes\u52a8\u6001\u5b58\u50a8\u3002</p> <p>\u8bfb\u8005\u5728\u5b66\u4e60Kubernetes\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u5e76\u6ca1\u6709\u73b0\u6210\u7684Ceph\u96c6\u7fa4\u7528\u4e8e\u7ec3\u4e60\uff0c\u6216\u8005\u5728\u516c\u53f8\u5185\u90e8\uff0c\u9664\u4e86\u751f\u4ea7\u73af\u5883\u5e76\u6ca1\u6709\u4e00\u4e2a\u591a\u4f59\u7684Ceph\u96c6\u7fa4\uff0c\u56e0\u4e3a\u5efa\u7acbCeph\u96c6\u7fa4\u4e0d\u4ec5\u9700\u8981\u5927\u91cf\u7684\u670d\u52a1\u5668\u8d44\u6e90\uff0c\u672c\u8eab\u7684\u590d\u6742\u5ea6\u4e5f\u9700\u8981\u4eba\u529b\u6210\u672c\u3002</p> <p>\u4f46\u662f\u5728\u4f01\u4e1a\u5185\u90e8\u4f7f\u7528Kubernetes\u65f6\uff0c\u65e0\u8bba\u662f\u5728\u90e8\u7f72\u4e1a\u52a1\u670d\u52a1\u8fd8\u662f\u4e2d\u95f4\u4ef6\u670d\u52a1\uff0c\u90fd\u80fd\u5f88\u660e\u663e\u5730\u4f53\u4f1a\u5230Kubernetes\u7684\u4fbf\u5229\u6027\u548c\u5f3a\u5927\u4e4b\u5904\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u4f01\u4e1a\u5185\u90e8\u4f7f\u7528Kubernetes\u65f6\uff0c\u540c\u65f6\u4e5f\u4f1a\u628a\u4e2d\u95f4\u4ef6\u670d\u52a1\uff08\u6bd4\u5982MySQL\u3001RabbitMQ\u3001Zookeeper\u7b49\uff09\u90e8\u7f72\u5728Kubernetes\u96c6\u7fa4\u4e2d\u3002</p> <p>\u76f8\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u4e5f\u9700\u8981\u4fdd\u7559\u5b83\u4eec\u7684\u6570\u636e\uff0c\u4f46\u662f\u975e\u751f\u4ea7\u73af\u5883\u53ef\u80fd\u5e76\u6ca1\u6709\u73b0\u6210\u7684\u5b58\u50a8\u5e73\u53f0\u4f9bKubernetes\u4f7f\u7528\uff0c\u65b0\u5efa\u4e00\u4e2a\u5e73\u53f0\u4f9b\u5176\u4f7f\u7528\u4e5f\u4f1a\u6d6a\u8d39\u5f88\u591a\u7cbe\u529b\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u975e\u751f\u4ea7\u73af\u5883\u7684\u6570\u636e\u6301\u4e45\u5316\u95ee\u9898\uff0c\u5f88\u591a\u516c\u53f8\u90fd\u91c7\u7528\u4e86NFS\u4f5c\u4e3a\u540e\u7aef\uff0c\u4f46\u662f\u4e00\u65e6\u4f7f\u7528\u7684\u5bb9\u5668\u8f83\u591a\u6216\u8005\u5b58\u50a8\u7684\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u5c31\u5bb9\u6613\u9020\u6210\u6027\u80fd\u95ee\u9898\uff0c\u5e76\u4e14NFS\u670d\u52a1\u5668\u4e00\u65e6\u51fa\u73b0\u95ee\u9898\uff0c\u6574\u4e2a\u6570\u636e\u53ef\u80fd\u4f1a\u5168\u90e8\u4e22\u5931\uff0c\u6240\u4ee5\u5728\u975e\u751f\u4ea7\u73af\u5883\u4e5f\u9700\u8981\u4e00\u4e2a\u9ad8\u53ef\u7528\u3001\u5206\u5e03\u5f0f\u5e76\u4e14\u514d\u8fd0\u7ef4\u7684\u5b58\u50a8\u5e73\u53f0\uff0c\u4e8e\u662fRook\u5c31\u8bde\u751f\u4e86\u3002</p> <p>Rook\u662f\u4e00\u4e2a\u81ea\u6211\u7ba1\u7406\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u7f16\u6392\u7cfb\u7edf\uff0c\u5b83\u672c\u8eab\u5e76\u4e0d\u662f\u5b58\u50a8\u7cfb\u7edf\uff0cRook\u5728\u5b58\u50a8\u548cKubernetes\u4e4b\u95f4\u642d\u5efa\u4e86\u4e00\u4e2a\u6865\u6881\uff0c\u4f7f\u5b58\u50a8\u7cfb\u7edf\u7684\u642d\u5efa\u6216\u8005\u7ef4\u62a4\u53d8\u5f97\u7279\u522b\u7b80\u5355\uff0cRook\u5c06\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf\u8f6c\u53d8\u4e3a\u81ea\u6211\u7ba1\u7406\u3001\u81ea\u6211\u6269\u5c55\u3001\u81ea\u6211\u4fee\u590d\u7684\u5b58\u50a8\u670d\u52a1\u3002</p> <p>\u5b83\u8ba9\u4e00\u4e9b\u5b58\u50a8\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u90e8\u7f72\u3001\u914d\u7f6e\u3001\u6269\u5bb9\u3001\u5347\u7ea7\u3001\u8fc1\u79fb\u3001\u707e\u96be\u6062\u590d\u3001\u76d1\u89c6\u548c\u8d44\u6e90\u7ba1\u7406\u53d8\u5f97\u81ea\u52a8\u5316\uff0c\u65e0\u987b\u4eba\u5de5\u5904\u7406\u3002\u540c\u65f6Rook\u652f\u6301CSI\uff0c\u53ef\u4ee5\u5229\u7528CSI\u505a\u4e00\u4e9bPVC\u7684\u5feb\u7167\u3001\u6269\u5bb9\u3001\u514b\u9686\u7b49\u64cd\u4f5c\u3002</p> <p>\u6709\u4e86Rook\u5c31\u53ef\u4ee5\u5728\u975e\u751f\u4ea7\u73af\u5883\u5feb\u901f\u5730\u642d\u5efa\u4e00\u4e2a\u5b58\u50a8\u7cfb\u7edf\uff0c\u7528\u6765\u6301\u4e45\u5316\u4e00\u4e9b\u5fc5\u9700\u7684\u6570\u636e\uff0c\u4e0d\u4ec5\u964d\u4f4e\u4e86\u8fd0\u7ef4\u590d\u6742\u5ea6\uff0c\u4e5f\u80fd\u66f4\u52a0\u65b9\u4fbf\u5730\u4f53\u9a8cKubernetes\u5e26 \u6765\u7684\u6536\u76ca\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u901a\u8fc7Rook\u6765\u6f14\u793a\u66f4\u591a\u7684Kubernetes\u5b58\u50a8\u7684\u9ad8\u7ea7\u529f\u80fd\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/12.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AD%98%E5%82%A8Rook/#1rook\u7684\u5b89\u88c5","title":"1.Rook\u7684\u5b89\u88c5","text":"<p>Rook\u662f\u4e13\u95e8\u4e3aKubernetes\u8bbe\u8ba1\u7684\u4e91\u539f\u751f\u5b58\u50a8\uff0c\u6240\u4ee5\u5b83\u672c\u8eab\u548c\u7531Rook\u521b\u5efa\u7684Ceph\u96c6\u7fa4\u90fd\u662f\u90e8\u7f72\u5728Kubernetes\u5e73\u53f0\u4e0a\u7684\u3002\u672c\u4e66\u5b89\u88c5\u7684Rook\u7248\u672c\u4e3a v1.10.10\uff08\u672c\u4e66\u622a\u6b62\u524d\u6700\u65b0\u7248\uff09\uff0c\u6700\u65b0\u7248\u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9\u6587\u6863https://rook.io\u83b7\u53d6\uff0c\u5176\u5b89\u88c5\u8fc7\u7a0b\u7c7b\u4f3c\u3002</p> <p>\u9996\u5148\u4e0b\u8f7dv1.10.10\u7248\u672c\u7684Rook\u6e90\u7801\uff0c\u672c\u7ae0\u6240\u6709\u793a\u4f8b\u5747\u53ef\u4ee5\u5728\u6e90\u7801\u4e2d\u627e\u5230\uff1a</p> <pre><code>$ git clone --single-branch --branch v1.10.10 https://github.com/rook/rook.git\n</code></pre>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/","title":"\u4e2d\u95f4\u4ef6\u5bb9\u5668\u5316","text":"<p>\u901a\u8fc7\u524d\u9762\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u57fa\u672c\u638c\u63e1\u4e86Kubernetes\u7684\u6838\u5fc3\u6982\u5ff5\uff0c\u76f8\u4fe1\u8bfb\u8005\u5df2\u7ecf\u80fd\u591f\u90e8\u7f72\u4e00\u4e9b\u6bd4\u8f83\u7b80\u5355\u7684\u670d\u52a1\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u5c06\u516c\u53f8\u7684\u5e94\u7528\u8fc1\u79fb\u81f3 Kubernetes\u3002</p> <p>\u4f46\u662f\u5728\u4f7f\u7528Kubernetes\u65f6\uff0c\u53ea\u90e8\u7f72\u4e00\u4e9b\u7b80\u5355\u7684\u5355\u4f53\u5e94\u7528\u5e76\u975e\u6211\u4eec\u7684\u6700\u7ec8\u76ee\u6807\u3002</p> <p>\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5c06\u4e00\u4e9b\u590d\u6742\u7684\u4e2d\u95f4\u4ef6\u90e8\u7f72\u5230Kubernetes\uff0c\u6bd4\u5982Redis\u3001RabbitMQ\u3001Kafka\u3001Zookeeper\u96c6\u7fa4\u7b49\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e9b\u5e94\u7528\u6bd4\u8f83\u590d\u6742\uff0c\u5e76\u4e14\u642d\u5efa\u65f6\u6d89\u53ca\u7684\u8d44\u6e90\u6587\u4ef6\u6bd4\u8f83\u591a\uff0c\u56e0\u6b64\u4f7f\u7528\u4f20\u7edf\u7684\u7ba1\u7406\u65b9\u5f0f\u663e\u5f97\u5f88\u9ebb\u70e6\uff0c\u6211 \u4eec\u9700\u8981\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u5c31\u53ef\u4ee5\u90e8\u7f72\u3001\u7ba1\u7406Kubernetes\u4e0a\u7684\u6bd4\u8f83\u590d\u6742\u7684\u5e94\u7528\uff0c\u5728Kubernetes\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u5305\u7ba1\u7406\u5de5\u5177Operator\u548cHelm\u6765\u7ba1\u7406\u6bd4\u8f83\u590d\u6742\u7684\u4e2d \u95f4\u4ef6\uff0c\u672c\u7ae0\u7684\u5185\u5bb9\u5c31\u662f\u4f7f\u7528Kubernetes\u5305\u7ba1\u7406\u5de5\u5177\u5c06\u6bd4\u8f83\u590d\u6742\u7684\u4e2d\u95f4\u4ef6\u90e8\u7f72\u81f3Kubernetes\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#1-\u4f20\u7edf\u67b6\u6784\u5982\u4f55\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4","title":"1. \u4f20\u7edf\u67b6\u6784\u5982\u4f55\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4","text":"<p>\u4f7f\u7528Kubernetes\u90e8\u7f72\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u56de\u987e\u4e00\u4e0b\uff0c\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\u662f\u5982\u4f55\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u7684\u3002</p> <p>\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u7ba1\u7406\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u7684\u6d41\u7a0b\u5927\u81f4\u5982\u56fe</p> <p>1\uff09\u5047\u8bbe\u73b0\u5728\u9700\u8981\u4e2d\u95f4\u4ef6\u96c6\u7fa4\uff0c\u6bd4\u5982\u9700\u8981\u4e00\u4e2a\u4e09\u4e3b\u4e09\u4ece\u7684Redis\u96c6\u7fa4\u3002</p> <p>2\uff09\u5982\u679c\u516c\u53f8\u73af\u5883\u76ee\u524d\u6ca1\u6709\u670d\u52a1\u5668\uff0c\u9700\u8981\u65b0\u7533\u8bf73\uff5e6\uff08\u6709\u53ef\u80fd\u662f\u590d\u7528\u4e4b\u524d\u7684\u670d\u52a1\u5668\u642d\u5efa\u96c6\u7fa4\uff09\u53f0\u670d\u52a1\u5668\u7528\u6765\u90e8\u7f72Redis\u96c6\u7fa4\u3002</p> <p>3\uff09\u4eceRedis\u5b98\u65b9\u7f51\u7ad9\u4e0b\u8f7d\u67d0\u4e2a\u7248\u672c\u7684Redis\u5b89\u88c5\u5305\uff0c\u5e76\u4e14\u5b89\u88c5\u5230\u6bcf\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\uff0c\u540c\u65f6\u53ef\u80fd\u6bcf\u53f0\u670d\u52a1\u5668\u4e5f\u9700\u8981\u505a\u76f8\u5173\u7684\u4f18\u5316\u914d\u7f6e\uff0c\u6bd4\u5982\u4fee\u6539\u63d0\u5347\u6027\u80fd \u7684\u5185\u6838\u7b49\u3002</p> <p>4\uff09\u8fdb\u884c\u6bcf\u53f0\u670d\u52a1\u5668\u7684Redis\u914d\u7f6e\uff0c\u5982\u679c\u662f\u4e00\u53f0\u670d\u52a1\u5668\u90e8\u7f72\u4e24\u4e2aRedis\u5b9e\u4f8b\uff0c\u53ef\u80fd\u8fd8\u9700\u8981\u914d\u7f6e\u4e0d\u540c\u7684\u7aef\u53e3\u53f7\u7b49\u3002</p> <p>\u4f20\u7edf\u67b6\u6784\u7ba1\u7406\u4e2d\u95f4\u4ef6 </p> <p>5\uff09\u542f\u52a8\u6bcf\u53f0\u670d\u52a1\u5668\u4e0a\u7684Redis\u5b9e\u4f8b\u3002</p> <p>6\uff09\u901a\u8fc7\u76f8\u5173\u547d\u4ee4\u5efa\u7acb\u96c6\u7fa4\uff0c\u5f53\u7136\u6709\u7684\u4e2d\u95f4\u4ef6\u662f\u6ca1\u6709\u6b64\u6b65\u9aa4\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u76f8\u5173\u914d\u7f6e\u6587\u4ef6\u76f4\u63a5\u5efa\u7acb\u96c6\u7fa4\u3002</p> <p>7\uff09\u5982\u679c\u96c6\u7fa4\u60f3\u8981\u6dfb\u52a0\u8282\u70b9\uff0c\u53ef\u80fd\u5c31\u9700\u8981\u91cd\u590d2\uff09\uff5e6\uff09\u7684\u6b65\u9aa4\u3002</p> <p>\u7efc\u4e0a\u53ef\u77e5\uff0c\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\u60f3\u8981\u642d\u5efa\u4e00\u4e2a\u7c7b\u4f3c\u4e8eRedis\u7684\u4e2d\u95f4\u4ef6\u96c6\u7fa4\uff0c\u5176\u5b9e\u662f\u4e00\u4ef6\u633a\u70e6\u7410\u4e14\u975e\u5e38\u5177\u6709\u91cd\u590d\u6027\u7684\u4e8b\uff0c\u5e76\u4e14\u7531\u4e8e\u670d\u52a1\u5668\u7684\u73af\u5883\u4e0d\u540c\uff0c\u5728\u5b89\u88c5 \u8fc7\u7a0b\u4e2d\u53ef\u80fd\u8fd8\u4f1a\u9047\u5230\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\uff0c\u6d6a\u8d39\u5f88\u591a\u65f6\u95f4\u548c\u7cbe\u529b\u3002</p> <p>\u4f46\u662f\u5728Kubernetes\u4e2d\uff0c\u53ef\u4ee5\u5229\u7528Kubernetes\u7684\u7279\u6027\u975e\u5e38\u65b9\u4fbf\u4e14\u8fc5\u901f\u5730\u542f\u52a8\u4e00\u4e2a\u5bf9\u5e94\u7684\u96c6\u7fa4\u3002\u63a5\u4e0b\u6765\u8bb2\u89e3\u5982\u4f55\u5728Kubernetes\u4e2d\u90e8\u7f72\u76f8\u5173\u7684\u4e2d\u95f4\u4ef6\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#2-kubernetes\u5982\u4f55\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4","title":"2. Kubernetes\u5982\u4f55\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4","text":"<p>\u5728Kubernetes\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528Kubernetes\u7684\u5305\u7ba1\u7406\u5de5\u5177\u975e\u5e38\u65b9\u4fbf\u5730\u642d\u5efa\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u96c6\u7fa4\uff0c\u6700\u4e3a\u5e38\u7528\u7684\u5305\u7ba1\u7406\u5de5\u5177\u8fd8\u662f\u4ee5Operator\u548cHelm\u4e3a\u4e3b\uff0c\u9996\u5148\u6211 \u4eec\u6765\u7b80\u5355\u770b\u4e00\u4e0bOperator\u548cHelm\u7684\u533a\u522b\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#21-operator\u548chelm\u7684\u533a\u522b","title":"2.1 Operator\u548cHelm\u7684\u533a\u522b","text":"<p>\u7b80\u800c\u8a00\u4e4b\uff0c\u5305\u7ba1\u7406\u5de5\u5177\u5c31\u662f\u628a\u76f8\u5173\u6587\u4ef6\u7684\u5b9a\u4e49\u7edf\u4e00\u7ba1\u7406\uff0c\u7136\u540e\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u901a\u8fc7\u8fd9\u4e9b\u5de5\u5177\u7ba1\u7406\u6bd4\u8f83\u590d\u6742\u7684\u5e94\u7528\uff0c\u6bd4\u5982MyS?L\u96c6\u7fa4\u3001Redis\u96c6\u7fa4\u7b49\uff0c\u5b9e \u73b0\u4e00\u952e\u521b\u5efa\u96c6\u7fa4\u3001\u6269\u5bb9\u3001\u5907\u4efd\u7b49\u3002\u5f53\u7136\uff0c\u516c\u53f8\u5185\u5f00\u53d1\u7684\u5e94\u7528\u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u901a\u8fc7Kubernetes\u7684\u5305\u7ba1\u7406\u5de5\u5177\u8fdb\u884c\u7ba1\u7406\uff0c\u76ee\u524d\u5e38\u7528\u7684\u4e24\u79cd\u5305\u7ba1\u7406\u5de5\u5177\u662fOperator \u548cHelm\uff0c\u7c7b\u4f3c\u7684\u8fd8\u6709Kustomize\u3001CNAB\u7b49\u3002</p> <p>\u867d\u7136Operator\u548cHelm\u5b9e\u73b0\u7684\u529f\u80fd\u7c7b\u4f3c\uff0c\u4f46\u662f\u4e24\u8005\u8fd8\u662f\u6709\u5f88\u5927\u7684\u533a\u522b\u7684\u3002</p> <p>Operator\u66f4\u503e\u5411\u4e8e\u7ba1\u7406\u590d\u6742\u7684\u6709\u72b6\u6001\u670d\u52a1\uff0c\u6bd4\u5982MySQL\u96c6\u7fa4\u3001Redis\u96c6\u7fa4\u3001TiDB\u96c6\u7fa4\u7b49\uff0c\u800cHelm\u66f4\u503e\u5411\u4e8e\u7ba1\u7406\u65e0\u72b6\u6001\u5e94\u7528\u7684\u90e8\u7f72\uff0c\u6bd4\u5982\u516c\u53f8\u7684\u670d\u52a1\u3001\u67d0 \u4e9b\u4e0d\u9700\u8981\u6301\u4e45\u5316\u6570\u636e\u7684\u4e2d\u95f4\u4ef6\u3001\u4e0d\u9700\u8981\u5b9e\u73b0\u989d\u5916\u529f\u80fd\u7684\u670d\u52a1\u7b49\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u4e4b\u524d\u4f7f\u7528Operator\u548cHelm\u90e8\u7f72\u8fc7\u4e00\u4e9b\u670d\u52a1\uff0c\u5c31\u4f1a\u77e5\u9053\u5f88\u591a\u4e2d\u95f4\u4ef6\u7684\u90e8\u7f72\u90fd\u6709Helm\u548cOperator\u4e24\u79cd\u65b9\u5f0f\u53ef\u4ee5\u9009\u62e9\uff0c\u6bd4\u5982RabbitMQ\u53ef\u4ee5\u901a\u8fc7Helm\u90e8\u7f72\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7Operator\u90e8\u7f72\u3002\u8bfb\u8005\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u7591\u60d1\uff0c\u65e2\u7136\u529f\u80fd\u7c7b\u4f3c\uff0c\u4e3a\u4f55\u8fd8\u8981\u5927\u8d39\u5468\u7ae0\u5730\u91cd\u590d\u201c\u9020\u8f6e\u5b50\u201d\u5462\uff1f</p> <p>\u524d\u6587\u63d0\u5230\u8fc7\uff0cHelm\u9002\u5408\u90e8\u7f72\u4e0d\u9700\u8981\u989d\u5916\u529f\u80fd\u7684\u670d\u52a1\uff0c\u8fd9\u91cc\u63d0\u5230\u7684\u989d\u5916\u529f\u80fd\u6709\u5907\u4efd\u3001\u56de\u6eda\u4ee5\u53ca\u66f4\u9ad8\u7ea7\u7684\u7528\u6cd5\u3002</p> <p>\u5982\u679c\u60f3\u8981\u5b9e\u73b0\u8fd9\u4e9b\u903b\u8f91\uff0c\u4f7f\u7528Helm\u4e0d\u5bb9\u6613\u5b9e\u73b0\uff0c\u6216\u8005\u65e0\u6cd5\u5b9e\u73b0\uff0c\u800cOperator\u53ef\u4ee5\u901a\u8fc7\u4ee3\u7801\u6765\u5b9e\u73b0\u76f8\u5173\u7684\u903b\u8f91\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48**Operator\u66f4\u503e\u5411\u4e8e\u7ba1\u7406\u66f4\u4e3a\u590d\u6742\u7684\u670d\u52a1\u3002**</p> <p>\u53e6\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u5f88\u5927\u7684\u533a\u522b\uff0c\u5c31\u662f\u4e24\u79cd\u5de5\u5177\u7684\u5b9e\u73b0\u96be\u5ea6\u662f\u4e0d\u4e00\u6837\u7684\u3002</p> <p>\u6bd4\u5982\u81ea\u5df1\u5199\u4e00\u4e2aHelm\u7684Chart\uff08Helm\u5305\u7684\u540d\u79f0\u53ebChart\uff09\uff0c\u53ea\u9700\u8981\u5c06\u76f8\u5173\u7684\u6a21\u677f\u6587\u4ef6\u653e\u5728Chart\u7684templates\u76ee\u5f55\uff0c \u7136\u540e\u62bd\u79bb\u76f8\u5173\u7684\u914d\u7f6e\uff0c \u653e\u7f6e\u4e8e values.yaml\uff0c\u6a21\u677f\u6587\u4ef6\u901a\u8fc7go template\u8bed\u6cd5\u5373\u53ef\u751f\u6210\u76f8\u5173\u7684\u8d44\u6e90\u6587\u4ef6\u5e76\u52a0\u8f7d\u5230Kubernetes\u4e2d\u3002</p> <p>\u800cOperator\u9700\u8981\u81ea\u5df1\u52a8\u624b\u7f16\u5199\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u8fd9\u4e2a\u63a7\u5236\u5668\u53ef\u4ee5\u89e3\u6790\u81ea\u5df1\u5b9a\u4e49\u7684CRD\uff08Custom Resource Define\uff0c\u81ea\u5b9a\u4e49\u8d44\u6e90\u7c7b\u578b\uff09\uff0c\u7136 \u540e\u751f\u6210\u76f8\u5173\u7684\u8d44\u6e90\u6587\u4ef6\u5e76\u52a0\u8f7d\u5230Kubernetes\u4e2d\u3002\u60f3\u8981\u5b9e\u73b0\u4e0a\u8ff0\u6240\u8bb2\u7684\u5907\u4efd\u3001\u56de\u6eda\u7b49\u529f\u80fd\uff0c\u4e5f\u9700\u8981\u81ea\u5df1\u7f16\u5199\u76f8\u5e94\u7684\u4ee3\u7801\u5b9e\u73b0\u3002</p> <p>\u6240\u4ee5Operator\u9700\u8981\u4e00\u5b9a\u7684\u5f00\u53d1\u80fd\u529b\uff0c\u53ef\u4ee5\u7528Golang\u3001Java\u7b49\u8bed\u8a00\u3002</p> <p>\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u4e24\u8005\u6ca1\u6709\u6700\u4f73\u9009\u62e9\uff0c\u53ea\u6709\u66f4\u5408\u9002\u7684\u9009\u62e9\u3002</p> <p>\u6bd4\u5982\u60f3\u8981\u642d\u5efa\u67d0\u4e2a\u6d41\u884c\u7684\u4e2d\u95f4\u4ef6\u96c6\u7fa4\uff08\u6bd4\u5982Redis\u96c6\u7fa4\uff09\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u4ece\u5934\u5f00\u59cb\u5199\u4e00\u4e2aRedis\u96c6\u7fa4\u7684Operator\u6216\u8005Helm\u7684Chart\u3002</p> <p>\u56e0\u4e3a\u50cfRedis\u8fd9\u6837\u6bd4\u8f83\u6d41\u884c\u7684\u4e2d\u95f4\u4ef6\uff0c\u5b98\u65b9\u6216\u8005\u7b2c\u4e09\u65b9\u5e73\u53f0\uff08\u6bd4\u5982Bitnami\uff09\u5df2\u7ecf\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e9b\u975e\u5e38\u597d\u7528\u4e14 \u529f\u80fd\u9f50\u5168\u7684Operator\u6216\u8005Helm Chart\uff0c\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\u3002</p> <p>\u5728\u4f01\u4e1a\u5185\u90e8\u7f16\u5199Operator\u6216\u8005Helm Chart\u5927\u90e8\u5206\u90fd\u662f\u57fa\u4e8e\u516c\u53f8\u81ea\u5df1\u7684\u4e1a\u52a1\u7cfb\u7edf\u5c55\u5f00\u7684\uff08\u5f53\u7136\uff0c\u4e00\u4e9b\u516c\u53f8\u4e5f\u4f1a\u4e3a\u5f00\u6e90\u9879\u76ee\u505a\u51fa\u81ea\u5df1\u7684\u8d21\u732e\uff0c\u4e5f\u4f1a\u4e3a\u4e2d\u95f4\u4ef6\u7f16\u5199\u76f8\u5e94\u7684 Operator\uff0c\u6bd4\u5982UCloud\u63d0\u4f9b\u7684Redis Cluster Operator\u4e5f\u662f\u975e\u5e38\u597d\u7528\u7684\uff09\uff0c\u6bd4\u5982\u516c\u53f8\u7684\u67d0\u4e2a\u4ea7\u54c1\uff0c\u53ef\u4ee5\u4e00\u952e\u5f0f\u90e8\u7f72\u6216\u8005\u8fc1\u79fb\u7b49\u3002</p> <p>\u800c\u50cf\u8fd9\u7c7b\u4e00\u952e\u5f0f\u642d\u5efa\u4e1a\u52a1\u7cfb\u7edf\u7684\u9700\u6c42\uff0c\u7f16\u5199Helm\u8981\u6bd4Operator\u7b80\u5355\u5f88\u591a\uff0c\u4f46\u662f\u5982\u679c\u60f3\u8981\u5b9e\u73b0\u66f4\u591a\u3001\u66f4\u590d\u6742\u7684\u903b\u8f91\uff0cOperator\u53ef\u80fd\u66f4\u4e3a\u5408\u9002\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#22-kubernetes\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u7684\u6d41\u7a0b","title":"2.2 Kubernetes\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u7684\u6d41\u7a0b","text":"<p>\u4e4b\u524d\u6211\u4eec\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u4f20\u7edf\u67b6\u6784\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u7684\u6d41\u7a0b\uff0c\u63a5\u4e0b\u6765\u4ecb\u7ecdKubernetes\u662f\u5982\u4f55\u5229\u7528\u5305\u7ba1\u7406\u5de5\u5177\u6765\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u7684\u3002</p> <p>\u65e0\u8bba\u662f\u9009\u62e9Helm\u8fd8\u662fOperator\u6765\u7ba1\u7406\u4e2d\u95f4\u4ef6\uff0c\u90fd\u662f\u975e\u5e38\u7b80\u5355\u7684\u3002Helm\u548cOperator\u7ba1\u7406\u4e2d\u95f4\u4ef6\u7684\u6d41\u7a0b\u5982\u56fe</p> <p></p> <p>\u6bd4\u5982\u4f7f\u7528Helm\u7ba1\u7406\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p>1\uff09\u9996\u5148\u96c6\u7fa4\u4e2d\u9700\u8981\u6709\u4e00\u4e2aHelm\u7684\u5ba2\u6237\u7aef\uff0c\u7528\u6765\u6267\u884c\u589e\u5220\u6539\u67e5\u547d\u4ee4\uff0c\u548cKubectl\u7c7b\u4f3c\u3002</p> <p>2\uff09\u4e4b\u540e\u9700\u8981\u627e\u5230\u5bf9\u5e94\u7684Chart\uff08\u53ef\u4ee5\u5728\u4e2d\u95f4\u4ef6\u7684\u5b98\u7f51\u6216\u8005GitHub\u4e2d\u67e5\u627e\uff09\uff0c\u6bd4\u5982\u5b89\u88c5Redis\u3001Zookeeper\u96c6\u7fa4\u7684\u5305\u3002\u8fd9\u4e2a\u5305\u548c\u955c\u50cf\u7c7b\u4f3c\uff0c\u90fd\u662f\u653e\u5728 \u4e00\u4e2a\u4ed3\u5e93\u4e2d\uff0c\u955c\u50cf\u653e\u5728\u955c\u50cf\u4ed3\u5e93\uff0cChart\u653e\u5728Chart\u4ed3\u5e93\u3002</p> <p>3\uff09\u5982\u679c\u662f\u65b0\u5efa\u96c6\u7fa4\uff0c\u53ea\u9700\u8981\u6267\u884chelm install\u547d\u4ee4\u5373\u53ef\u4e00\u952e\u5f0f\u521b\u5efa\u8be5\u96c6\u7fa4\u3002\u5982\u679c\u60f3\u8981\u66f4\u65b0\u914d\u7f6e\uff0c\u76f4\u63a5\u4f7f\u7528helm upgrade\u5373\u53ef\u3002</p> <p>\u4f7f\u7528Operator\u7ba1\u7406\u4e2d\u95f4\u4ef6\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p>1\uff09\u76f8\u5bf9\u4e8eHelm\u9700\u8981\u5b89\u88c5\u5355\u72ec\u7684\u5ba2\u6237\u7aef\u5de5\u5177\uff0cOperator\u4e0d\u9700\u8981\u5355\u72ec\u7684\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u4f7f\u7528kubectl\u5373\u53ef\u3002\u6240\u4ee5\u7b2c\u4e00\u6b65\u5c31\u662f\u627e\u5230\u5bf9\u5e94\u7684Operator\uff08\u548cHelm\u7c7b \u4f3c\uff0c\u53ef\u4ee5\u5728GitHub\u6216\u8005\u5176\u5b98\u65b9\u7f51\u7ad9\u4e0a\u67e5\u627e\uff09\u3002</p> <p>2\uff09\u521b\u5efa\u5bf9\u5e94\u7684\u63a7\u5236\u5668\uff0c\u7528\u6765\u89e3\u6790\u4e00\u4e9b\u81ea\u5b9a\u4e49\u8d44\u6e90\u903b\u8f91\u7684\u7a0b\u5e8f\u3002</p> <p>3\uff09\u4e4b\u540e\u521b\u5efa\u81ea\u5b9a\u4e49\u8d44\u6e90\u5373\u53ef\uff0c\u5bf9\u5e94\u7684\u63a7\u5236\u5668\u4f1a\u89e3\u6790\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9e\u73b0\u76f8\u5173\u529f\u80fd\uff0c\u6bd4\u5982\u521b\u5efa\u96c6\u7fa4\u3001\u6269\u5bb9\u3001\u5907\u4efd\u7b49\u3002</p> <p>\u7531\u6b64\u770b\u6765\uff0cHelm\u548cOperator\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b9e\u73b0\u4e2d\u95f4\u4ef6\u96c6\u7fa4\u7684\u7ba1\u7406\u548c\u7ef4\u62a4\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u901a\u8fc7\u51e0\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u5b9e\u8df5\u4e00\u4e0bHelm\u548cOperator\u7684\u4f7f\u7528\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#3-operator\u7684\u4f7f\u7528","title":"3. Operator\u7684\u4f7f\u7528","text":""},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#31-\u4f7f\u7528operator\u5b89\u88c5redis\u96c6\u7fa4","title":"3.1 \u4f7f\u7528Operator\u5b89\u88c5Redis\u96c6\u7fa4","text":"<p>\u672c\u5c0f\u8282\u6f14\u793a\u7684Operator\u662f\u7531UCloud\u5f00\u6e90\u7684\u4e00\u4e2a\u9879\u76ee\u3002</p> <p>\u9879\u76ee\u5730\u5740</p> <p>https://github.com/ucloud/redis-cluster-operator\uff0c</p> <p>\u63a5\u4e0b\u6765\u6839\u636e\u524d\u6587\u63d0\u5230\u7684\u6d41\u7a0b\u521b\u5efa\u4e00\u4e2a\u5177\u67096\u4e2a\u5b9e\u4f8b\u7684Redis\u96c6\u7fa4\u3002</p> <p>\u9996\u5148\u9700\u8981\u4e0b\u8f7d\u8be5\u9879\u76ee\u81f3\u670d\u52a1\u5668\uff1a <pre><code>$ git clone https://github.com/ucloud/redis-cluster-operator.git\n$ cd redis-cluster-operator\n</code></pre></p> <p>\u4e4b\u540e\u521b\u5efa\u5bf9\u5e94\u7684CRD\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9bCRD\u58f0\u660e\u4e00\u4e2a\u521b\u5efaRedis\u96c6\u7fa4\u7684YAML\u6587\u4ef6\uff1a <pre><code>$ kubectl create -f deploy/crds/redis.kun_distributedredisclusters_crd.yaml\n$ kubectl create -f deploy/crds/redis.kun_redisclusterbackups_crd.yaml\n</code></pre> \u5047\u8bbe\u9700\u8981\u5c06Redis\u96c6\u7fa4\u90e8\u7f72\u81f3redis-cluster\u547d\u540d\u7a7a\u95f4\uff0c\u9700\u8981\u5148\u521b\u5efaredis-cluster\u547d\u540d\u7a7a\u95f4\u548c\u5bf9\u5e94\u7684\u4e00\u4e9b\u6743\u9650\uff0c\u5e76\u4e14\u5c06Operator\u63a7\u5236\u5668\u5b89\u88c5\u81f3\u8be5 \u547d\u540d\u7a7a\u95f4\uff1a <pre><code>$ kubectl create ns redis-cluster\n$ kubectl create -f deploy/service_account.yaml -n redis-cluster\n$ kubectl create -f deploy/namespace/role.yaml -n redis-cluster\n$ kubectl create -f deploy/namespace/role_binding.yaml -n redis-cluster\n$ kubectl create -f deploy/namespace/operator.yaml -n redis-cluster\n</code></pre> \u67e5\u770bRedis Operator\u7684Pod\u72b6\u6001\uff1a <pre><code>$ kubectl get pod -n redis-cluster\nNAME                                      READY   STATUS    RESTARTS   AGE\nredis-cluster-operator-675ccbc697-c6m2t   1/1     Running   0          37s\n</code></pre> \u63a5\u4e0b\u6765\u901a\u8fc7\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7c7b\u578b\u7684YAML\u6587\u4ef6\u4e00\u952e\u5f0f\u542f\u52a8\u4e00\u4e2a\u4e09\u4e3b\u4e09\u4ece\u7684\u8282\u70b9\uff0c\u5728\u542f\u52a8\u4e4b\u524d\u5148\u6765\u770b\u4e00\u4e0b\u8fd9\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\uff1a <pre><code>$ cat deploy/example/redis.kun_v1alpha1_distributedrediscluster_cr.yaml\napiVersion: redis.kun/v1alpha1\nkind: DistributedRedisCluster\nmetadata:\n  annotations:\n    # if your operator run as cluster-scoped, add this annotations\n#redis.kun/scope: cluster-scoped\nname: example-distributedrediscluster\nspec:\n  # Add fields here\nmasterSize: 3\nclusterReplicas: 1\nimage: redis:5.0.4-alpine\n</code></pre></p> <p>\u6ce8\u610f\u770b\u8be5\u6587\u4ef6\u7684kind\u548capiVersion\uff0c\u5728\u6807\u51c6\u7684Kubernetes\u4e2d\uff0c\u662f\u6ca1\u6709apiVersion\u4e3aredis.kun/v1alpha1\u3001kind\u4e3aDistributedRedisCluster\u8fd9\u79cd\u7c7b \u578b\u7684\u8d44\u6e90\u7684\u3002</p> <p>\u6211\u4eec\u5e38\u7528\u7684\u662f\u7c7b\u4f3c\u4e8eDeployment\u3001StatefulSet\u7684\u8d44\u6e90\uff0c\u8fd9\u79cd\u4e0d\u5c5e\u4e8e\u539f\u751f\u8d44\u6e90\u7684\u8d44\u6e90\u79f0\u4e3a\u81ea\u5b9a\u4e49\u8d44\u6e90\u7c7b\u578b\uff08Custom Resource Definition\uff0c CRD )\u3002</p> <p>\u4e0a\u8ff0\u662f\u901a\u8fc7\u547d\u4ee4<code>kubectl create -f deploy/crds/redis.kun_distributedredisclusters_crd.yaml</code>\u521b\u5efa\u4e86\u201c\u6269\u5c55\u8d44\u6e90\u7c7b\u578b\u201d\u3002</p> <p>\u7ee7\u7eed\u770b\u8be5\u6587\u4ef6\u7684spec\u5b9a\u4e49\uff0c\u4e5f\u662f\u548c\u539f\u751f\u7684\u8d44\u6e90\u5b9a\u4e49\u6709\u6240\u4e0d\u540c\uff0c\u6240\u4ee5\u6807\u51c6Kubernetes\u89e3\u6790\u4e0d\u4e86\u8be5\u7c7b\u578b\u7684\u8d44\u6e90\uff0c\u8be5\u7c7b\u578b\u7684\u8d44\u6e90\u521b\u5efa\u540e\uff0c\u7531Redis Operator\u8d1f\u8d23\u89e3\u6790\u3002\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u8fd9\u6bb5YAML\u4ee3\u7801\u5177\u4f53\u7684\u542b\u4e49\uff1a</p> <ul> <li>masterSize\uff1a\u65b0\u5efa\u7684Redis\u96c6\u7fa4\u6709\u51e0\u4e2a\u4e3b\u8282\u70b9\u3002</li> <li>clusterReplicas\uff1a\u6bcf\u4e2a\u4e3b\u8282\u70b9\u6709\u51e0\u4e2a\u4ece\u8282\u70b9\u3002</li> <li>image\uff1a\u8be5\u96c6\u7fa4\u4f7f\u7528\u54ea\u4e2a\u955c\u50cf\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>\u7531\u4e8e\u6211\u4eec\u521b\u5efa\u7684\u662f\u547d\u540d\u7a7a\u95f4\u57fa\u672c\u7684Operator\uff0c\u56e0\u6b64\u9700\u8981\u5c06annotations\u7684redis.kun/scope:cluster-scoped\u6ce8\u91ca\u6389\u3002</p> <p>\u5728\u660e\u767d\u5176\u914d\u7f6e\u542b\u4e49\u540e\uff0c\u901a\u8fc7\u4e00\u6761\u547d\u4ee4\u5373\u53ef\u521b\u5efa\u4e00\u4e2aRedis\u96c6\u7fa4\uff1a <pre><code>$ kubectl create -f deploy/example/redis.kun_v1alpha1_distributedrediscluster_cr.yaml -n redis-cluster\ndistributedrediscluster.redis.kun/example-distributedrediscluster created\n</code></pre></p> <p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u81ea\u5b9a\u4e49distributedrediscluster\u8d44\u6e90\u7684\u72b6\u6001\u6765\u5224\u65adRedis\u96c6\u7fa4\u662f\u5426\u5b8c\u6210\u4e86\u521d\u59cb\u5316\uff1a</p> <pre><code>$ kubectl get distributedrediscluster -n redis-cluster\nNAME                              MASTERSIZE   STATUS    AGE\nexample-distributedrediscluster   3            Scaling   42s\n</code></pre> <p>\u6b64\u65f6\u4e5f\u53ef\u4ee5\u67e5\u770bPod\u7684\u72b6\u6001\uff0c\u867d\u7136\u90fd\u662f\u6b63\u5e38\u72b6\u6001\uff0c\u4f46\u662f\u7531\u4e8e\u6ca1\u6709\u5b8c\u6210\u69fd\u7684\u5206\u914d\uff0c\u56e0\u6b64\u5f53\u524d\u96c6\u7fa4\u8fd8\u662f\u4e0d\u53ef\u7528\u7684\u72b6\u6001\uff1a</p> <p><pre><code>$ kubectl get pod -n redis-cluster -w\nNAME                                      READY   STATUS    RESTARTS   AGE\ndrc-example-distributedrediscluster-0-0   1/1     Running   0          7m3s\ndrc-example-distributedrediscluster-0-1   1/1     Running   0          6m3s\ndrc-example-distributedrediscluster-1-0   1/1     Running   0          7m3s\ndrc-example-distributedrediscluster-1-1   1/1     Running   0          6m23s\ndrc-example-distributedrediscluster-2-0   1/1     Running   0          7m3s\ndrc-example-distributedrediscluster-2-1   1/1     Running   0          6m23s\nredis-cluster-operator-675ccbc697-c6m2t   1/1     Running   0          14m\n</code></pre> \u5f53\u72b6\u6001\u7531Scaling\u53d8\u6210\u4e86Healthy\uff08\u6b64\u8fc7\u7a0b\u53ef\u80fd\u9700\u898130\u5206\u949f\u5de6\u53f3\u7684\u65f6\u95f4\uff09\uff0c\u5373\u8868\u793aRedis\u96c6\u7fa4\u5df2\u7ecf\u521b\u5efa\u5b8c\u6210\uff0c\u5e76\u5b8c\u6210\u4e86\u69fd\u7684\u914d\u7f6e\uff0c\u6b64\u65f6\u5df2\u7ecf\u53ef\u4ee5\u6b63 \u5e38\u4f7f\u7528\uff1a</p> <pre><code>$ kubectl get distributedrediscluster -n redis-cluster\nNAME                              MASTERSIZE   STATUS    AGE\nexample-distributedrediscluster   3            Healthy   7m7s\n</code></pre> <p>\u5728\u521b\u5efaRedis\u96c6\u7fa4\u540e\uff0c\u4f1a\u521b\u5efa\u5982\u4e0b\u51e0\u4e2aService\uff1a</p> <pre><code>$ kubectl get svc -n redis-cluster\nNAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)              AGE\nexample-distributedrediscluster     ClusterIP   10.104.160.70   &lt;none&gt;        6379/TCP,16379/TCP   7m52s\nexample-distributedrediscluster-0   ClusterIP   None            &lt;none&gt;        6379/TCP,16379/TCP   7m52s\nexample-distributedrediscluster-1   ClusterIP   None            &lt;none&gt;        6379/TCP,16379/TCP   7m52s\nexample-distributedrediscluster-2   ClusterIP   None            &lt;none&gt;        6379/TCP,16379/TCP   7m52s\nredis-cluster-operator-metrics      ClusterIP   10.101.25.137   &lt;none&gt;        8383/TCP,8686/TCP    14m\n</code></pre> <p>\u5176\u4e2dexample-distributedrediscluster\u4e3a\u7a0b\u5e8f\u7aef\u7528\u6765\u64cd\u4f5cRedis\u96c6\u7fa4\u7684Service\u540d\u79f0\uff0c\u53ef\u4ee5\u901a\u8fc7redis://example-distributedrediscluster.redis-cluster:6379\u94fe\u63a5\u81f3\u8be5\u96c6\u7fa4\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f\u5177\u6709Redis\u5ba2\u6237\u7aef\u5de5\u5177\u7684Pod\u8fdb\u884c\u8fde\u63a5\u6d4b\u8bd5\uff0c\u6bd4\u5982\u4f7f\u7528drc-example-distributedrediscluster-0-0\u8fd9\u4e2aPod\u8fdb\u884c\u6d4b\u8bd5\uff0c\u9996\u5148 \u767b\u5f55\u81f3\u8be5Pod\uff08\u7531\u4e8eRedis\u5ba2\u6237\u7aef\u548cRedis\u96c6\u7fa4\u662f\u540c\u4e00\u4e2aNamespace\uff0c\u56e0\u6b64.redis-cluster\u53ef\u4ee5\u7701\u7565\uff09\uff1a</p> <pre><code>$ kubectl exec -it drc-example-distributedrediscluster-0-0 -n redis-cluster -- sh\n/data # redis-cli -h example-distributedrediscluster\nexample-distributedrediscluster:6379&gt; info\n.....\n\n# Replication\nrole:slave\nmaster_host:10.0.14.130\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:10\nmaster_sync_in_progress:0\nslave_repl_offset:728\nslave_priority:100\nslave_read_only:1\nconnected_slaves:0\nmaster_replid:a303475b201463f9c7476f9356f73fb5511b8e57\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:728\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:728\n</code></pre> <p>\u4f7f\u7528redis-cli\u8fde\u63a5\u5230Redis\u96c6\u7fa4\u540e\uff0c\u53ef\u4ee5\u6267\u884cRedis\u7684\u76f8\u5173\u547d\u4ee4\u67e5\u770b\u4e00\u4e9b\u4fe1\u606f\uff0c\u5728\u6b64\u4e0d\u518d\u6f14\u793a\uff0c\u6709\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u67e5\u627e\u5b66\u4e60\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8fdb\u884c\u6570 \u636e\u7684\u5199\u5165\u3002</p> <p>\u8bf7\u6ce8\u610f\u6846\u5185\u7684\u63d0\u793a\uff0c\u6211\u4eec\u5728\u6267\u884cset\u547d\u4ee4\u65f6\uff0cRedis\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38MOVED\uff0c\u8fd9\u5c31\u662fRedis\u96c6\u7fa4\u7684\u673a\u5236\uff0c\u4e86\u89e3\u8fc7Redis\u96c6\u7fa4\u67b6\u6784\u7684\u8bfb\u8005 \u53ef\u80fd\u6709\u6240\u4e86\u89e3\u3002</p> <p>Redis\u96c6\u7fa4\u91c7\u7528\u5206\u7247\u673a\u5236\uff0c\u6bcf\u4e2a\u6570\u636e\u63d2\u5165\u65f6\u4f1a\u9009\u62e9\u4e00\u4e2a\u5bf9\u5e94\u7684\u69fd\u5b58\u653e\u6570\u636e\uff0c\u5982\u679c\u8be5\u69fd\u4f4d\u4e0d\u5728\u8fd9\u4e2a\u5df2\u7ecf\u8fde\u63a5\u7684\u5b9e\u4f8b\u4e0a\uff0c\u5c31\u9700\u8981\u8fdb\u884c\u201c\u4e0b\u4e00 \u8df3\u201d\uff0c\u4e5f\u5c31\u662f\u4f1a\u8fde\u63a5\u5230\u5177\u6709\u8be5\u69fd\u4f4d\u7684\u8282\u70b9\u4e0a\uff0c\u518d\u5199\u5165\u6570\u636e\uff0c\u5f53\u7136\u5982\u679c\u8be5\u69fd\u4f4d\u6b63\u597d\u4f4d\u4e8e\u6b63\u5728\u8fde\u63a5\u7684\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u5c31\u4f1a\u76f4\u63a5\u5199\u5165\u6570\u636e\u3002</p> <pre><code>/data # redis-cli -h example-distributedrediscluster\nexample-distributedrediscluster:6379&gt; set a 1\n(error) MOVED 15495 10.0.20.225:6379\n</code></pre> <p>\u63a5\u4e0b\u6765\u8fde\u63a5\u523010.0.20.225:6379\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u5c1d\u8bd5\u5199\u5165\u6570\u636e</p> <pre><code>/data # redis-cli -h 10.0.20.225\n10.0.20.225:6379&gt; set a 1\nOK\n10.0.20.225:6379&gt; get a\n\"1\"\n10.0.20.225:6379&gt; quit\n/data #\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5f53\u8fde\u63a5\u81f3172.27.14.202\u8282\u70b9\u65f6\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6ekey\u4e3aa\u7684\u503c\uff0c\u5f53\u67e5\u770ba\u7684\u503c\u7684\u65f6\u5019\uff0c\u4e5f\u80fd\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\uff0c\u5f53\u7136\u5982\u679c\u8fde\u63a5\u7684\u4e0d\u662f10.0.20.225\u8fd9 \u4e2a\u5b9e\u4f8b\uff0c\u4e5f\u662f\u8fd4\u56deMOVED\u9519\u8bef\u3002</p> <p>\u7531\u4e8eRedis\u96c6\u7fa4\u7684\u8fd9\u79cd\u673a\u5236\uff0c\u56e0\u6b64\u5728Kubernetes\u96c6\u7fa4\u5916\u90e8\u7684\u5ba2\u6237\u7aef\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528Kubernetes\u4e2d\u7684Redis\u96c6\u7fa4\uff0c\u56e0\u4e3a\u5728\u5b83\u9700\u8981MOVED\u65f6\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2aPod\u7684 IP\uff0c\u8fd9\u4e2aIP\u4e3aKubernetes\u5185\u90e8IP\uff0c\u6807\u51c6\u7684Kubernetes\u4e0d\u4f1a\u8ba9\u5916\u90e8\u7f51\u7edc\u548c\u5176\u76f4\u63a5\u901a\u4fe1\uff0c\u5982\u679c\u9700\u8981\u96c6\u7fa4\u5916\u90e8\u8fde\u63a5\u81f3Kubernetes\u5185\u90e8\u7684Redis\u96c6\u7fa4\uff0c\u53ef\u4ee5\u91c7\u7528 Redis\u96c6\u7fa4\u7684\u4ee3\u7406\u5de5\u5177\u8fdb\u884c\u89e3\u51b3\uff0c\u6709\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u5c1d\u8bd5\u3002</p> <p>\u4f46\u662f\u751f\u4ea7\u73af\u5883\u7684Redis\u96c6\u7fa4\u4e00\u822c\u4e0d\u4f1a\u76f4\u63a5\u66b4\u9732\u5728\u5916\uff0c\u8fd9\u4e5f\u662f\u4e00\u79cd\u5b89\u5168\u7684\u624b\u6bb5\uff0c\u975e\u751f\u4ea7\u73af\u5883\u91c7\u7528\u5355\u793a\u4f8b\u7684Redis\u5373\u53ef\u6ee1\u8db3\u9700\u8981\uff0c\u5355\u793a\u4f8b\u7684Redis\u662f\u6ca1\u6709\u6b64\u7c7b\u95ee\u9898\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7NodePort\u7c7b\u578b\u7684Service\u8fdb\u884c\u8fde\u63a5\u3002</p> <p>\u6ce8\u610f \u4ee5\u4e0a\u6f14\u793a\u7684\u96c6\u7fa4\u5b89\u88c5\u5e76\u6ca1\u6709\u8fdb\u884cRedis\u96c6\u7fa4\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u5982\u679c\u60f3\u8981\u6301\u4e45\u5316\u6570 \u636e \uff0c \u9700\u8981\u6709StorageClass\u7684\u652f\u6301\uff0c\u63d0\u4f9b\u52a8\u6001\u5b58\u50a8\u3002</p> <p>\u4e4b\u540e\u4f7f\u7528deploy/example/persistent.yaml\u6587\u4ef6\u521b\u5efa\u5177\u6709\u6301\u4e45\u5316\u6570\u636e\u7684Redis\u96c6\u7fa4\uff0c\u53ea\u9700\u8981\u4fee\u6539class\u5b57\u6bb5\u4e3a\u96c6\u7fa4\u5185\u5757\u5b58\u50a8\u7684StorageClass\u540d\u5b57\u5373\u53ef\uff0csize\u6309\u9700\u4fee\u6539\u3002\u5f53\u7136\uff0c\u4e0d\u8981\u5fd8\u8bb0\u6ce8\u91caredis.kun/scope: cluster-scoped\u5b57\u6bb5\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#32-redis\u96c6\u7fa4\u4e00\u952e\u6269\u5bb9","title":"3.2 Redis\u96c6\u7fa4\u4e00\u952e\u6269\u5bb9","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u901a\u8fc7Operator\u5f88\u65b9\u4fbf\u3001\u8fc5\u901f\u5730\u642d\u5efa\u4e86\u4e00\u4e2aRedis\u96c6\u7fa4\uff0c\u63a5\u4e0b\u6765\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7Operator\u5b8c\u6210\u4e00\u952e\u5f0f\u96c6\u7fa4\u6269\u5bb9\u3002</p> <p>\u524d\u9762\u63d0\u5230\u8fc7\u81ea\u5b9a\u4e49\u8d44\u6e90\u7684\u914d\u7f6e\uff0c\u6709\u4e00\u4e2a\u53c2\u6570\u4e3amasterSize: 3\uff0c\u8be5\u53c2\u6570\u51b3\u5b9a\u4e86\u8be5\u96c6\u7fa4\u4e00\u5171\u6709\u591a\u5c11\u4e2aMaster\u8282\u70b9\uff0cclusterReplicas\u53c2\u6570\u51b3\u5b9a\u4e86\u6bcf\u4e2a Master\u8282\u70b9\u6709\u51e0\u4e2a\u4ece\u8282\u70b9\uff0c\u5982\u679c\u60f3\u8981\u6269\u5bb9\u8be5\u96c6\u7fa4\uff0c\u53ea\u9700\u8981\u66f4\u6539\u8fd9\u4e24\u4e2a\u53c2\u6570\u5373\u53ef\u3002</p> <p>\u6bd4\u5982\u5c06\u96c6\u7fa4\u6269\u5bb9\u4e3a\u5177\u67094\u4e2aMaster\u8282\u70b9\u7684\u96c6\u7fa4\uff1a</p> <pre><code>$ grep \"master\" deploy/example/redis.kun_v1alpha1_distributedrediscluster_cr.yaml\n  masterSize: 4\n$ kubectl replace -f deploy/example/redis.kun_v1alpha1_distributedrediscluster_cr.yaml -n redis-cluster\ndistributedrediscluster.redis.kun/example-distributedrediscluster replaced\n</code></pre> <p>\u518d\u6b21\u67e5\u770bPod\uff0c\u4f1a\u53d1\u73b0\u521b\u5efa\u4e86\u4e24\u4e2a\u65b0\u7684Pod\uff1a</p> <pre><code>$ kubectl get pod -n redis-cluster\nNAME                                      READY   STATUS    RESTARTS   AGE\ndrc-example-distributedrediscluster-0-0   1/1     Running   0          54m\ndrc-example-distributedrediscluster-0-1   1/1     Running   0          53m\ndrc-example-distributedrediscluster-1-0   1/1     Running   0          54m\ndrc-example-distributedrediscluster-1-1   1/1     Running   0          53m\ndrc-example-distributedrediscluster-2-0   1/1     Running   0          54m\ndrc-example-distributedrediscluster-2-1   1/1     Running   0          53m\ndrc-example-distributedrediscluster-3-0   1/1     Running   0          2m37s\ndrc-example-distributedrediscluster-3-1   1/1     Running   0          97s\nredis-cluster-operator-675ccbc697-c6m2t   1/1     Running   0          61m\n</code></pre> <p>\u6b64\u65f6\u96c6\u7fa4\u7684\u72b6\u6001\u53c8\u4f1a\u53d8\u6210Scaling\u7136\u540e\u53d8\u6210Healthy\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get distributedredisclusters -n redis-cluster\nNAME                              MASTERSIZE   STATUS    AGE\nexample-distributedrediscluster   4            Healthy   55m\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5728\u6269\u5bb9\u548c\u7f29\u5bb9\u7684\u8fc7\u7a0b\u4e2d\uff0cRedis\u96c6\u7fa4\u662f\u4e0d\u53ef\u7528\u72b6\u6001\uff0c\u6240\u4ee5\u6700\u597d\u5728\u975e\u4e1a\u52a1\u65f6\u95f4\u6bb5\u8fdb\u884c\u6269\u5bb9\u3002Redis\u96c6\u7fa4\u7684\u53ef\u7528\u6027\u6d4b\u8bd5\u548c\u521b\u5efa\u5c0f\u8282\u4e00\u81f4\uff0c \u6b64\u5904\u4e0d\u518d\u6f14\u793a\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#33-\u96c6\u7fa4\u6e05\u7406","title":"3.3 \u96c6\u7fa4\u6e05\u7406","text":"<p>\u5982\u679c\u53ea\u662f\u7528\u6765\u6d4b\u8bd5\u548c\u5b66\u4e60\uff0c\u5728\u64cd\u4f5c\u5b8c\u6210\u540e\u53ef\u4ee5\u6e05\u7406\u8be5\u96c6\u7fa4\uff0c\u6e05\u7406\u6b65\u9aa4\u8f83\u4f20\u7edf\u67b6\u6784\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5c06\u5b89\u88c5\u7684create\u6539\u6210delete\u5373\u53ef\uff1a</p> <pre><code>$ kubectl delete -f deploy/example/redis.kun_v1alpha1_distributedrediscluster_cr.yaml -n redis-cluster\n$ kubectl delete -f deploy/cluster/operator.yaml -n redis-cluster\n$ kubectl delete -f deploy/cluster/cluster_role_binding.yaml -n redis-cluster\n$ kubectl delete -f deploy/cluster/cluster_role -n redis-cluster\n$ kubectl delete -f deploy/service_account.yaml -n redis-cluster\n$ kubectl delete -f deploy/crds/redis.kun_redisclusterbackups_crd.yaml -n redis-cluster\n$ kubectl delete -f deploy/crds/redis.kun_distributedredisclusters_crd.yaml -n redis-cluster\n$ kubectl delete ns redis-cluster\n</code></pre> <p>\u5982\u679c\u4ee5\u540e\u4e0d\u9700\u8981\u518d\u521b\u5efaRedis\u96c6\u7fa4\uff0c\u53ef\u4ee5\u628aCRD\u4e5f\u5220\u9664\uff1a</p> <pre><code>$ kubectl delete -f deploy/crds/redis.kun_distributedredisclusters_crd.yaml\n$ kubectl delete -f deploy/crds/redis.kun_redisclusterbackups_crd.yaml\n</code></pre>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#4-helm\u7684\u4f7f\u7528","title":"4. Helm\u7684\u4f7f\u7528","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528Operator\u5feb\u901f\u521b\u5efa\u4e00\u4e2aRedis\u96c6\u7fa4\uff0c\u540c\u65f6\u4e5f\u5b9e\u73b0\u4e86\u4e00\u952e\u5f0f\u6269\u5bb9\u3002</p> <p>\u672c\u8282\u5c06\u4f1a\u7ee7\u7eed\u5b66\u4e60Kubernetes\u5305\u7ba1\u7406\u5de5\u5177Helm\u7684\u4f7f\u7528\uff0c\u5b9e\u73b0\u4e00\u952e\u5f0f\u521b\u5efaZookeeper\u3001Kafka\u96c6\u7fa4\u7b49\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#41-\u5b89\u88c5helm\u5ba2\u6237\u7aef","title":"4.1 \u5b89\u88c5Helm\u5ba2\u6237\u7aef","text":"<p>\u4f7f\u7528Helm\u548cOperator\u4e0d\u540c\u7684\u662f\uff0cHelm\u7684\u64cd\u4f5c\u9700\u8981\u4f7f\u7528\u5355\u72ec\u7684Helm\u5ba2\u6237\u7aef\u5de5\u5177\u3002\u5bf9\u4e8eHelm V3\u548cV2\u7684\u5b89\u88c5\u662f\u6709\u6240\u533a\u522b\u7684\uff0cHelm V3\u53ea\u9700\u8981\u5c06Helm\u5ba2\u6237\u7aef \u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u653e\u5728/usr/local/bin/\u4e0b\u5373\u53ef\uff0cV2\u9664\u4e86\u4e8c\u8fdb\u5236\u5de5\u5177\u5916\uff0c\u8fd8\u9700\u8981\u5b89\u88c5\u4e00\u4e2aTiller\u670d\u52a1\u7aef\uff0c\u7531\u4e8e\u73b0\u5728\u4e3b\u8981\u4ee5V3\u4e3a\u4e3b\uff0c\u56e0\u6b64\u4e0d\u518d\u6f14\u793aV2\u7684\u5b89\u88c5\u548c\u4f7f \u7528\u3002</p> <p>\u9996\u5148\u5728Helm\u5b98\u65b9\u4e0b\u8f7dHelm\u7684\u4e8c\u8fdb\u5236\u5305\uff08\u6b64\u5904\u6f14\u793a\u7684\u4e3aLinux\u7684\u5b89\u88c5\u6b65\u9aa4\uff0c\u5176\u4ed6\u6b65\u9aa4\u53ef\u4ee5\u53c2\u8003\uff1ahttps://helm.sh/docs/intro/install/\uff09\uff1a</p> <p>\u8f6f\u4ef6\u5305\u4e0b\u8f7d\u5730\u5740\u4e3a\uff1ahttps://github.com/helm/helm/releases</p> <pre><code># \u672c\u4f8b\u5b89\u88c5\u7684\u4e3a3.7.2\uff0c\u5176\u4ed6\u7248\u672c\u4e0b\u8f7d\u5730\u5740https://github.com/helm/helm/releases\n$ wget https://mirrors.huaweicloud.com/helm/v3.7.2/helm-v3.7.2-linux-amd64.tar.gz\n$ tar -zxvf helm-v3.7.2-linux-amd64.tar.gz $ cd linux-amd64/ $ cp helm /usr/local/bin/\n$ chmod a+x  /usr/local/bin/helm\n\n#\u67e5\u770b\u7248\u672c\n$ helm version\nversion.BuildInfo{Version:\"v3.7.2\", GitCommit:\"663a896f4a815053445eec4153677ddc24a0a361\", GitTreeState:\"clean\", GoVersion:\"go1.16.10\"}\n</code></pre> <pre><code># \u811a\u672c\u5b89\u88c5\n$ curl -fsSL -o get_helm.sh \\\nhttps://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3\n$ chmod 700 get_helm.sh\n$ ./get_helm.sh\n\n# \u4e8c\u8fdb\u5236\u5b89\u88c5\nwget https://get.helm.sh/helm-v3.11.1-linux-amd64.tar.gz\ntar xvf helm-v3.11.1-linux-amd64.tar.gz\nsudo mv linux-amd64/helm /usr/local/bin\nrm -rf linux-amd64 helm-v3.7.0-linux-amd64.tar.gz\n\n# \u8865\u5168\nhelm completion bash &gt; /etc/bash_completion.d/helm\n</code></pre>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#42-helm\u5ba2\u6237\u7aef\u547d\u4ee4\u5165\u95e8","title":"4.2 Helm\u5ba2\u6237\u7aef\u547d\u4ee4\u5165\u95e8","text":"<p>\u5728\u5b66\u4e60Helm\u547d\u4ee4\u4e4b\u524d\uff0c\u5148\u6765\u8ba4\u8bc6\u4e00\u4e0bHelm\u3002Helm\u7684\u673a\u5236\u548cDocker\u6709\u4e9b\u7c7b\u4f3c\uff0cDocker\u6709\u955c\u50cf\u7684\u6982\u5ff5\uff0c\u7528\u6765\u653e\u7f6e\u76f8\u5173\u7a0b\u5e8f\uff0c\u5e76\u4e14\u955c\u50cf\u662f\u653e\u5728\u955c\u50cf\u4ed3\u5e93\u91cc \u9762\u8fdb\u884c\u7ba1\u7406\u7684\u3002</p> <p>\u800cHelm\u76f8\u5bf9\u4e8eDocker\u955c\u50cf\u6709\u4e00\u4e2a\u540d\u8bcd\u53ebChart\uff0c\u662fHelm\u653e\u7f6e\u6a21\u677f\u548c\u914d\u7f6e\u7684\u5730\u65b9\uff0c\u540c\u65f6Chart\u4e5f\u53ef\u4ee5\u653e\u5728\u4ed3\u5e93\u4e2d\uff0c\u53ea\u4e0d\u8fc7\u653e\u7f6e\u955c\u50cf\u7684\u53eb\u955c\u50cf\u4ed3 \u5e93\uff0c\u653e\u7f6eChart\u7684\u53ebChart\u4ed3\u5e93\uff0c\u6bd4\u8f83\u4e3b\u6d41\u7684\u955c\u50cf\u4ed3\u5e93Harbor\u4e0d\u4ec5\u652f\u6301\u955c\u50cf\u7684\u5b58\u50a8\uff0c\u4e5f\u652f\u6301Chart\u7684\u5b58\u50a8\u3002</p> <p>\u6709\u4e86\u4e0a\u8ff0\u7406\u89e3\uff0c\u7ed3\u5408\u4e4b\u524d\u8bb2\u8fc7\u7684\u7ba1\u7406\u4e2d\u95f4\u4ef6\u7684\u6d41\u7a0b\uff0c\u53ef\u4ee5\u77e5\u9053\u6211\u4eec\u5728\u5b89\u88c5\u76f8\u5173\u4e2d\u95f4\u4ef6\u7684\u65f6\u5019\uff0c\u9700\u8981\u5148\u627e\u5230\u5bf9\u5e94\u7684\u5305\uff08\u5c31\u662f\u524d\u9762\u8bb2\u7684Chart\uff09\uff0c\u800c\u8fd9\u4e2a \u5305\u6709\u4e00\u4e2a\u5b58\u653e\u7684\u4ed3\u5e93\uff0c\u56e0\u6b64\u9700\u8981\u5148\u5728\u5f53\u524d\u73af\u5883\u6dfb\u52a0\u8fd9\u4e2a\u4ed3\u5e93\uff0c\u4ece\u8fd9\u4e2a\u4ed3\u5e93\u4e2d\u4e0b\u8f7d\u8be5\u5305\uff0c\u7136\u540e\u8fdb\u884c\u5b89\u88c5\uff08\u4e0d\u4e0b\u8f7d\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5\uff09\u5373\u53ef\u3002</p> <p>\u5b89\u88c5\u5b8cHelm\u540e\uff0c\u53ef\u4ee5\u6267\u884chelm repo list\u67e5\u770b\u5df2\u7ecf\u6dfb\u52a0\u7684\u4ed3\u5e93\u6709\u54ea\u4e9b\uff1a</p> <pre><code>$ helm repo list\nNAME                            URL\nkubernetes-dashboard            https://kubernetes.github.io/dashboard/\ningress-nginx                   https://kubernetes.github.io/ingress-nginx\nnfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/\nmycharts                        https://hujianli94.github.io/mycharts/\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6709\u4e00\u4e2a\u540d\u5b57\u4e3astable\u7684\u4ed3\u5e93\uff0c\u4ed3\u5e93\u5730\u5740\u662fhttps://charts.helm.sh/stable\u3002 \u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7helm repo add\u547d\u4ee4\u6dfb\u52a0\u4e00\u4e2aBitNami\uff08BitNami\u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u5177\u6709\u5f88\u591a\u89e3\u51b3\u65b9\u6848\uff0c\u6211\u4eec\u5e38\u7528\u7684\u5f88\u591a\u670d\u52a1\u5728BitNami\u4ed3\u5e93\u90fd\u80fd\u627e\u5230\uff09\u7684\u4ed3\u5e93\uff1a</p> <pre><code>$ helm repo add bitnami https://charts.bitnami.com/bitnami\n$ helm repo update\nHang tight while we grab the latest from your chart repositories...\n...Successfully got an update from the \"nfs-subdir-external-provisioner\" chart repository\n...Successfully got an update from the \"mycharts\" chart repository\n...Successfully got an update from the \"ingress-nginx\" chart repository\n</code></pre> <p>\u6dfb\u52a0\u5b8c\u6210\u540e\u518d\u6b21\u67e5\u770b\u4ed3\u5e93\u5217\u8868\uff1a</p> <pre><code>$ helm repo list\nNAME                            URL\n.....\nbitnami                         https://charts.bitnami.com/bitnami\n</code></pre> <p>\u63a5\u4e0b\u6765\u53ef\u4ee5\u901a\u8fc7helm search\u547d\u4ee4\u67e5\u770bBitNami\u4ed3\u5e93\u6709\u54ea\u4e9b\u53ef\u7528\u7684Chart\uff1a</p> <pre><code>$ helm search repo bitnami\nNAME                                            CHART VERSION   APP VERSION     DESCRIPTION\nbitnami/airflow                                 14.0.12         2.5.1           Apache Airflow is a tool to express and execute...\nbitnami/apache                                  9.2.16          2.4.55          Apache HTTP Server is an open-source HTTP serve...\nbitnami/appsmith                                0.1.13          1.9.8           Appsmith is an open source platform for buildin...\nbitnami/argo-cd                                 4.4.10          2.6.2           Argo CD is a continuous delivery tool for Kuber...\nbitnami/argo-workflows                          5.1.9           3.4.5           Argo Workflows is meant to orchestrate Kubernet...\nbitnami/aspnet-core                             4.0.6           7.0.3           ASP.NET Core is an open-source framework for we...\nbitnami/cassandra                               10.0.3          4.1.0           Apache Cassandra is an open source distributed ...\nbitnami/cert-manager                            0.9.1           1.11.0          cert-manager is a Kubernetes add-on to automate...\nbitnami/clickhouse                              3.0.2           23.1.3          ClickHouse is an open-source column-oriented OL...\nbitnami/common                                  2.2.3           2.2.3           A Library Helm Chart for grouping common logic ...\n.....\n</code></pre> <ul> <li>NAME\uff1aChart\u7684\u540d\u5b57\u3002</li> <li>CHART VERSION\uff1aChart\u7684\u7248\u672c\u3002</li> <li>APP VERSION\uff1aChart\u5185\u5e94\u7528\u7684\u540d\u79f0\u3002</li> <li>DESCRIPTION\uff1aChart\u7684\u63cf\u8ff0\u6587\u4ef6\u3002</li> </ul> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u641c\u7d22\u8f6f\u4ef6\u7684\u540d\u5b57\uff0c\u6bd4\u5982\u641c\u7d22Kafka\u76f8\u5173\u7684Chart\uff1a</p> <pre><code>$ helm search repo kafka\nNAME                            CHART VERSION   APP VERSION     DESCRIPTION\nbitnami/kafka                   21.0.1          3.4.0           Apache Kafka is a distributed streaming platfor...\nbitnami/dataplatform-bp2        12.0.5          1.0.1           DEPRECATED This Helm chart can be used for the ...\nbitnami/schema-registry         8.0.6           7.3.1           Confluent Schema Registry provides a RESTful in...\n</code></pre> <p>\u63a5\u4e0b\u6765\u53ef\u4ee5\u4f7f\u7528helm pull\u5c06\u67d0\u4e2aChart\u4e0b\u8f7d\u81f3\u672c\u5730\uff0c\u6bd4\u5982\u5c06\u4e0a\u8ff0\u68c0\u7d22\u7684Kafka\u4e0b\u8f7d\u81f3\u672c\u5730\uff1a</p> <pre><code>[root@k8s-master01 helm-devops]# mkdir helm-study\n[root@k8s-master01 helm-devops]# cd helm-study/\n[root@k8s-master01 helm-study]# helm pull bitnami/kafka\n[root@k8s-master01 helm-study]# ls\nkafka-21.0.1.tgz\n</code></pre> <p>\u6b64\u65f6\u4e0b\u8f7d\u7684\u4e3a\u65b0\u7248\u7684Chart\uff0c\u8bfb\u8005\u7684\u7248\u672c\u53ef\u80fd\u4f1a\u4e0d\u4e00\u81f4\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7-l\u53c2\u6570\u67e5\u770b\u67d0\u4e2aChart\u7684\u5386\u53f2\u7248\u672c\uff1a</p> <pre><code>$ helm search repo kafka -l\nNAME                            CHART VERSION   APP VERSION     DESCRIPTION\nbitnami/kafka                   21.0.1          3.4.0           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   21.0.0          3.4.0           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.1.1          3.4.0           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.1.0          3.4.0           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.0.6          3.3.2           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.0.5          3.3.2           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.0.4          3.3.1           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.0.3          3.3.1           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.0.2          3.3.1           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.0.1          3.3.1           Apache Kafka is a distributed streaming platfor...\nbitnami/kafka                   20.0.0          3.3.1           Apache Kafka is a distributed streaming platfor...\n.....\n</code></pre> <p>\u7136\u540e\u901a\u8fc7\u6307\u5b9a--version\u53c2\u6570\u4e0b\u8f7d\u6307\u5b9a\u7248\u672c\uff1a</p> <pre><code>$ helm pull bitnami/kafka --version=17.2.3\n$ ls\nkafka-17.2.3.tgz  kafka-21.0.1.tgz\n</code></pre> <p>\u5176\u4ed6\u5173\u4e8eHelm\u7684\u589e\u5220\u6539\u67e5\uff0c\u5728\u5b89\u88c5\u4e2d\u95f4\u4ef6\u65f6\u518d\u4e3a\u8bfb\u8005\u4ecb\u7ecd\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#43-\u90e8\u7f72zookeeper","title":"4.3 \u90e8\u7f72Zookeeper","text":"<p>\u63a5\u4e0b\u6765\u901a\u8fc7Helm\u5b89\u88c5\u4e00\u4e2aZookeeper\u96c6\u7fa4\u81f3Kubernetes\u3002\u4f7f\u7528Helm\u5b89\u88c5Chart\u65f6\uff0c\u9700\u8981\u6ce8\u610fChart\u5305\u53ef\u4ee5\u4e0b\u8f7d\u81f3\u672c\u5730\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u7528\u4e0b\u8f7d\u81f3\u672c\u5730\u3002</p> <p>\u672c\u5c0f\u8282\u6f14\u793a\u7684\u662f\u4e0b\u8f7d\u81f3\u672c\u5730\u8fdb\u884c\u5b89\u88c5\uff0c\u4e0b\u4e00\u5c0f\u8282\u5c06\u6f14\u793a\u65e0\u987b\u4e0b\u8f7d\u81f3\u672c\u5730\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u9996\u5148\u5c06Zookeeper\u7684Chart\u5305\u4e0b\u8f7d\u81f3\u672c\u5730\uff1a</p> <pre><code>$ helm pull bitnami/zookeeper\n$ ls\nkafka-17.2.3.tgz  kafka-21.0.1.tgz  zookeeper-11.1.3.tgz\n</code></pre> <p>\u4e4b\u540e\u5c06\u8be5\u5305\u89e3\u538b\uff0c\u7136\u540e\u4fee\u6539values.yaml\u7684\u914d\u7f6e\u5373\u53ef\uff1a</p> <pre><code>$ tar xf zookeeper-11.1.3.tgz\n$ ls\nkafka-17.2.3.tgz  kafka-21.0.1.tgz  zookeeper  zookeeper-11.1.3.tgz\n\n$ cd zookeeper/\n$ ll\ntotal 108\n-rw-r--r-- 1 root root   219 Feb 18 05:13 Chart.lock\ndrwxr-xr-x 3 root root    20 Feb 24 10:21 charts\n-rw-r--r-- 1 root root   740 Feb 18 05:13 Chart.yaml\n-rw-r--r-- 1 root root 60053 Feb 18 05:13 README.md\ndrwxr-xr-x 2 root root  4096 Feb 24 10:21 templates\n-rw-r--r-- 1 root root 36146 Feb 18 05:13 values.yaml\n</code></pre> <p>\u548c Operator\u7684\u533a\u522b\u662f \uff0c Operator\u901a\u8fc7CRD\u7ba1\u7406\u914d\u7f6e \uff0c Helm\u901a\u8fc7values.yaml\u7ba1\u7406\u914d\u7f6e\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u66f4\u6539values.yaml\u5373\u53ef\u5b9e\u73b0\u4e00\u4e9b\u5b9a\u5236 \u5316\u914d\u7f6e\u3002\u6253\u5f00values.yaml\u4fee\u6539\u4e00\u4e9b\u5e38\u7528\u914d\u7f6e\uff1a</p> <pre><code>$ vim values.yaml\n\nreplicaCount: 3\n# \u6f14\u793a\u73af\u5883\u5173\u95ed\u8ba4\u8bc1\uff0c\u751f\u4ea7\u73af\u5883\u9700\u8981\u6309\u9700\u5f00\u542f\nauth:\n  client:\n    enabled: false\npersistence:\n  # \u5173\u95ed\u6570\u636e\u6301\u4e45\u5316\uff0c\u6d4b\u8bd5\u73af\u5883\nenabled: false\nexistingClaim: \"\"\n# \u751f\u4ea7\u73af\u5883\u9700\u8981\u914d\u7f6estorageClass\u5b9e\u73b0\u6570\u636e\u6301\u4e45\u5316\nstorageClass: \"\"\naccessModes:\n    - ReadWriteOnce\n  size: 8Gi\n  annotations: {}\n</code></pre> <p>\u4fee\u6539\u5b8c\u6bd5\u540e\uff0c\u4e00\u6761\u547d\u4ee4\u5373\u53ef\u521b\u5efaZookeeper\u96c6\u7fa4\uff0c\u5047\u8bbe\u90e8\u7f72\u81f3public-service\u547d\u540d\u7a7a\u95f4\uff1a</p> <pre><code>$ helm install zookeeper . --namespace public-service --create-namespace\nNAME: zookeeper\nLAST DEPLOYED: Fri Feb 24 10:32:01 2023\nNAMESPACE: public-service\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nCHART NAME: zookeeper\nCHART VERSION: 11.1.3\nAPP VERSION: 3.8.1\n\n** Please be patient while the chart is being deployed **\n\nZooKeeper can be accessed via port 2181 on the following DNS name from within your cluster:\n\nzookeeper.public-service.svc.cluster.local\n\nTo connect to your ZooKeeper server run the following commands:\n\nexport POD_NAME=$(kubectl get pods --namespace public-service -l \"app.kubernetes.io/name=zookeeper,app.kubernetes.io/instance=zookeeper,app.kubernetes.io/component=zookeeper\" -o jsonpath=\"{.items[0].metadata.name}\")\nkubectl exec -it $POD_NAME -- zkCli.sh\n\nTo connect to your ZooKeeper server from outside the cluster execute the following commands:\n\nkubectl port-forward --namespace public-service svc/zookeeper 2181:2181 &amp;\nzkCli.sh 127.0.0.1:2181\n</code></pre> <p>\u6ce8\u610f</p> <p>\u7531\u4e8e\u6211\u4eec\u662f\u5c06Chart\u5305\u4e0b\u8f7d\u81f3\u672c\u5730\uff0c\u66f4\u6539values.yaml\u6587\u4ef6\u540e\u624d\u6267\u884c\u7684\u5b89\u88c5\uff0c\u56e0\u6b64\u5728\u4f7f\u7528<code>helm install -n public-service zookeeper .</code>\u547d\u4ee4\u65f6\uff0c\u4e0d \u8981\u5fd8\u8bb0\u547d\u4ee4\u6700\u540e\u6709\u4e00\u4e2a\u70b9\uff0c\u5e76\u4e14\u9700\u8981\u5728values.yaml\u6240\u5728\u76ee\u5f55\u4e0b\u6267\u884c\u3002</p> <p>\u53e6\u5916,\u672c\u6b21\u6f14\u793a\u7684\u5185\u5bb9\u6ca1\u6709\u8fdb\u884c\u6570\u636e\u6301\u4e45\u5316\uff0c\u751f\u4ea7\u73af\u5883\u53ef\u4ee5\u4f7f\u7528StorageClass\u8fdb\u884c\u6570\u636e\u6301\u4e45\u5316\uff0c\u4e0b\u4e00\u5c0f\u8282\u6f14\u793a\u7684Kafka\u540c\u6837\u5982\u6b64\u3002</p> <p>\u67e5\u770bPod\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pod -n public-service\nNAME          READY   STATUS    RESTARTS   AGE\nzookeeper-0   1/1     Running   0          4m55s\nzookeeper-1   1/1     Running   0          4m55s\nzookeeper-2   1/1     Running   0          4m55s\n</code></pre> <p>\u67e5\u770b\u521b\u5efa\u7684Service\uff1a</p> <pre><code>$ kubectl get svc -n public-service\nNAME                 TYPE        CLUSTER-IP        EXTERNAL-IP   PORT(S)                      AGE\nzookeeper            ClusterIP   192.168.144.220   &lt;none&gt;        2181/TCP,2888/TCP,3888/TCP   5m11s\nzookeeper-headless   ClusterIP   None              &lt;none&gt;        2181/TCP,2888/TCP,3888/TCP   5m11s\n</code></pre> <p>\u5176\u4e2dzookeeper-headless\u662fZookeeper\u5b9e\u4f8b\u5185\u90e8\u901a\u4fe1\u4f7f\u7528\u7684\uff0cZookeeper\u662f\u5916\u90e8\u7a0b\u5e8f\u8c03\u7528\u7684Service\u3002</p> <p>\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7Zookeeper\u7684\u5ba2\u6237\u7aef\u5de5\u5177\u67e5\u770bZookeeper\u96c6\u7fa4\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl exec -it pod/zookeeper-0 -n public-service /opt/bitnami/zookeeper/bin/zkServer.sh status\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\n/opt/bitnami/java/bin/java\nZooKeeper JMX enabled by default\nUsing config: /opt/bitnami/zookeeper/bin/../conf/zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: follower\n</code></pre> <p>\u5176\u4ed6\u8282\u70b9\u53ef\u81ea\u884c\u6d4b\u8bd5\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#44-\u90e8\u7f72kafka","title":"4.4 \u90e8\u7f72Kafka","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u4f7f\u7528Helm\u5b89\u88c5Zookeeper\u96c6\u7fa4\u81f3Kubernetes\uff0c\u91c7\u7528\u7684\u662f\u5148\u4e0b\u8f7d\u540e\u5b89\u88c5\u3002</p> <p>\u672c\u5c0f\u8282\u6f14\u793a\u4e0d\u4e0b\u8f7d\u8fdb\u884cChart\u7684\u5b89\u88c5\uff0c\u76f8\u540c\u7684\u662f\uff0cKafka\u7684Chart\u4e5f\u662f\u4f7f\u7528Bitnami\u4ed3\u5e93\u4e2d\u7684Chart\u3002</p> <p>\u65b0\u7248\u7684Kafka\u96c6\u7fa4\u7684\u521b\u5efa\u5df2\u7ecf\u53ef\u4ee5\u4e0d\u4f9d\u8d56Zookeeper\uff0c\u4f46\u662f\u76ee\u524d\u751f\u4ea7\u4e0a\u91c7\u7528\u7684\u5e76\u4e0d\u90fd\u662f\u5168\u65b0\u7684\u7248\u672c\uff0c\u6240\u4ee5\u672c\u6b21\u6f14\u793a\u7684\u662f\u4e4b\u524d\u7248\u672c\u7684Kafka\u3002\u7531\u4e8e\u4e0a\u4e00\u5c0f \u8282\u5df2\u7ecf\u5b89\u88c5\u4e86Zookeeper\u96c6\u7fa4\uff0c\u56e0\u6b64\u672c\u6b21\u5b89\u88c5\u4f9d\u8d56\u7684Zookeeper\u53ef\u4ee5\u4f7f\u7528\u4e0a\u4e00\u5c0f\u8282\u5b89\u88c5\u7684\uff0c\u901a\u8fc7\u4e00\u6761\u547d\u4ee4\u5373\u53ef\u5b89\u88c5Kafka\u96c6\u7fa4\uff1a</p> <pre><code>$ helm repo add bitnami https://charts.bitnami.com/bitnami\n## \u90e8\u7f723\u8282\u70b9kafka\nhelm install kafka bitnami/kafka \\\n--set zookeeper.enabled=false \\\n--set containerPorts.client=9092 \\\n--set service.ports.client=9092\n--set replicaCount=3 \\\n# \u66ff\u6362ZOOKEEPER-SERVICE-NAME\u4e3a zookeeper.default.svc\n--set externalZookeeper.servers=ZOOKEEPER-SERVICE-NAME\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u672c\u6b21\u5b89\u88c5\u5e76\u6ca1\u6709\u4e0b\u8f7d\u5bf9\u5e94\u7684Chart\u5305\uff0c\u4e5f\u6ca1\u6709\u4fee\u6539values.yaml\u7684\u64cd\u4f5c\uff0c\u800c\u662f\u4f7f\u7528--set\u6307\u5b9a\u4e00\u4e9b\u914d\u7f6e\uff0c--set\u7684\u529f\u80fd\u76f8\u5f53\u4e8e\u4fee\u6539values.yaml\u4e2d\u7684\u914d\u7f6e\uff0c\u7528\u6765\u6e32\u67d3\u6a21\u677f\u3002</p> <p>\u6bd4\u5982--set persistence.enabled=false\u5c31\u662f\u548c\u4e4b\u524d\u4fee\u6539values.yaml\u7684\u914d\u7f6e\u529f\u80fd\u4e00\u6837\uff0c\u9700\u8981\u6ce8\u610f--set\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8evalues.yaml\u4e2d\u7684\u914d\u7f6e\uff0c \u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u662f\u4e0b\u8f7d\u4e0b\u6765\u7684Chart\u5305\uff0c\u7136\u540e\u4fee\u6539\u4e86values.yaml\u7684\u5185\u5bb9\uff0c\u4f46\u662f\u4f9d\u65e7\u53ef\u4ee5\u4f7f\u7528--set\u8986\u76d6\u91cc\u9762\u7684\u914d\u7f6e\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#45-kafka\u96c6\u7fa4\u6269\u5bb9","title":"4.5 Kafka\u96c6\u7fa4\u6269\u5bb9","text":"<p>\u7531\u4e8eKafka\u662f\u76f4\u63a5\u901a\u8fc7--set\u5b89\u88c5\u7684\uff0c\u56e0\u6b64\u66f4\u65b0\u65f6\u9700\u8981\u627e\u5230\u4e4b\u524d\u7684\u547d\u4ee4\u8fdb\u884c\u66f4\u65b0\uff0c\u5982\u679c\u5fd8\u8bb0\u53ef\u4ee5\u901a\u8fc7helm get values\u67e5\u770b\uff1a</p> <pre><code>$ helm upgrade kafka bitnami/kafka \\\n--set zookeeper.enabled=false \\\n--set replicaCount=7 \\\n--set externalZookeeper.servers=ZOOKEEPER-SERVICE-NAME\n</code></pre>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#46-\u5220\u9664helm-release","title":"4.6 \u5220\u9664Helm Release","text":"<p>\u5982\u679c\u524d\u9762\u521b\u5efa\u7684\u4e2d\u95f4\u4ef6\u4e0d\u518d\u4f7f\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528Helm delete\u5220\u9664\uff0c\u5220\u9664Zookeeper\u548c\u547d\u540d\u7a7a\u95f4\uff1a <pre><code>$ helm delete kafka -n public-service\nrelease \"kafka\" uninstalled\n\n#\u4e4b\u540e\u5220\u9664Zookeeper\u548c\u547d\u540d\u7a7a\u95f4\uff1a\n$ helm delete Zookeeper -n public-service\nrelease \"zookeeper\" uninstalled\n\n$ kubectl delete ns public-service\nnamespace \"public-service\" deleted\n</code></pre></p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#47-\u90e8\u7f72kubenetes-dashboard","title":"4.7 \u90e8\u7f72Kubenetes-Dashboard","text":""},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#1-\u76ee\u6807","title":"1. \u76ee\u6807","text":"<ol> <li>\u4f7f\u7528Helm3\u5feb\u901f\u5b8c\u6210Dashboard\u90e8\u7f72</li> <li>\u8c03\u6574session\u7684\u9ed8\u8ba4\u5931\u6548\u65f6\u95f4</li> <li>\u672c\u6b21\u90e8\u7f72\u7684dashboard\u7248\u672c2.0.4</li> </ol>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#2-helm\u90e8\u7f72","title":"2. Helm\u90e8\u7f72","text":"<p>chart\u5730\u5740</p> <p>https://artifacthub.io/packages/helm/k8s-dashboard/kubernetes-dashboard/2.8.1</p> <p>\u53c2\u6570\u793a\u4f8b</p> <pre><code>extraArgs:\n- --token-ttl=0\n- --system-banner=\"Welcome to 3IN Kubernetes Cluster. \u64cd\u4f5c\u9700\u8c28\u614e\uff01\uff01\uff01\"\ningress:\nenabled: true\nannotations:\nkubernetes.io/ingress.class: nginx\nkubernetes.io/tls-acme: 'true'\nnginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\npaths:\n- /\nhosts:\n- kube-dashboard.3incloud.cn\ntls:\n- secretName: tls-3incloudcn\nhosts:\n- kube-dashboard.3incloud.cn\nmetricsScraper:\nenabled: true\n</code></pre> <p>- token-ttl=0\u914d\u7f6e\u7528\u6765\u8868\u793a\u767b\u9646\u540esession\u4e0d\u5931\u6548</p> <p>\u5b89\u88c5</p> <pre><code># add repo\n$ helm repo add k8s-dashboard https://kubernetes.github.io/dashboard/\n\n# install\n$ helm install kube-dashboard k8s-dashboard/kubernetes-dashboard -n kube-dashboard -f value.yaml\n</code></pre> <p>\u9519\u8bef\u4fee\u6b63</p> <p>\u4fee\u6539Deployment kube-dashboard-metrics-server\u955c\u50cf\u4e3a<code>registry.cn-hangzhou.aliyuncs.com/vcors/metrics-server-amd64:v0.3.6</code>\uff0cgcr\u4ed3\u5e93\u955c\u50cf\u56fd\u5185\u8bbf\u95ee\u4e0d\u5230\u3002</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#3-\u521b\u5efa\u8d26\u6237","title":"3. \u521b\u5efa\u8d26\u6237","text":"<p>\u521b\u5efa\u8d26\u6237</p> <pre><code>$ cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: test\n  namespace: kube-dashboard\nEOF\n</code></pre> <p>\u7ed1\u5b9a\u89d2\u8272</p> <pre><code>$ cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: test\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: test\n  namespace: kube-dashboard\nEOF\n</code></pre> <p>\u83b7\u53d6Token</p> <pre><code>$ kubectl -n kube-dashboard describe secret $(kubectl -n monitor get secret | grep wuyuexin | awk '{print $1}')\n</code></pre> <p>\u5927\u529f\u544a\u6210</p> <p>\u53c2\u8003\u6587\u732e</p> <p>https://github.com/kubernetes/dashboard</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#48-helm\u90e8\u7f72devops\u5de5\u5177","title":"4.8 Helm\u90e8\u7f72DevOps\u5de5\u5177","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.yuque.com/wuyuexin/bu3d95/aqrvn9</p> <p>\u5728Kubernetes\u4e0a\u4f7f\u7528Jenkins</p> <p>https://www.yuque.com/wuyuexin/bu3d95/eikxqa</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#5-helm\u66f4\u591a\u4f7f\u7528","title":"5. Helm\u66f4\u591a\u4f7f\u7528","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>helm\u4ed3\u5e93\u8be6\u89e3</p> <p>https://docs.youdianzhishi.com/k8s/helm/overview/</p>"},{"location":"Kubernetes/4.%E9%AB%98%E7%BA%A7%E7%AF%87/13.%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%B9%E5%99%A8%E5%8C%96/#6-\u5c0f\u7ed3","title":"6. \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u6f14\u793a\u4e86Operator\u548cHelm\u7684\u7b80\u5355\u4f7f\u7528\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u57fa\u672c\u4e0a\u5e38\u7528\u7684\u4e00\u4e9b \u670d\u52a1\u90fd\u80fd\u627e\u5230\u5bf9\u5e94\u7684Operator\u6216\u8005Helm\u8fdb\u884c\u90e8\u7f72\uff0c\u4e00\u4e9b\u5e38\u7528\u7684\u5f00\u6e90\u9879\u76ee\u4e00\u822c \u4e0d\u9700\u8981\u6211\u4eec\u81ea\u884c\u7f16\u5199Operator\u63a7\u5236\u5668\u6216\u8005Helm\u7684\u5305\uff0c \u53ea\u9700\u8981\u5728\u5b98\u65b9\u7f51\u7ad9\u6216\u8005 GitHub\u627e\u5230\u76f8\u5173\u8d44\u6599\u5373\u53ef\u3002</p> <p>\u901a\u8fc7\u4e0a\u8ff0\u6f14\u793a\u4e5f\u80fd\u770b\u51fa\u6765\uff0c\u65e0\u8bba\u662f\u4ec0\u4e48\u4e2d\u95f4\u4ef6\uff0c \u90e8\u7f72\u6b65\u9aa4\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u57fa\u672c\u6ca1\u6709\u592a\u5927\u7684\u533a\u522b\u3002</p> <p>Operator\u5c31\u662f\u521b\u5efaCRD\u548c\u63a7\u5236 \u5668\uff0c\u7136\u540e\u521b\u5efa\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0cHelm\u5c31\u662f\u627e\u5230\u5bf9\u5e94\u7684\u5305\uff0c\u7136\u540e\u901a\u8fc7install\u5b89\u88c5\u3002</p> <p>\u5c06\u4e00\u4e9b\u4e2d\u95f4\u4ef6\u670d\u52a1\u90e8\u7f72\u5230Kubernetes\u4e2d\uff0c\u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6\u5730\u964d\u4f4e\u5e94\u7528\u90e8\u7f72 \u7684\u590d\u6742\u5ea6\uff0c\u540c\u65f6\u53ef\u4ee5\u63d0\u5347\u90e8\u7f72\u7684\u6548\u7387\u3002\u5982\u679c\u4f01\u4e1a\u5185\u90e8\u6709\u5b8c\u5584\u7684\u5b58\u50a8\u5e73\u53f0\u4f9b Kubernetes\u4f7f\u7528\uff0c\u57fa\u672c\u4e0a\u53ef\u4ee5\u5c06\u4efb\u4f55\u4e2d\u95f4\u4ef6\u90e8\u7f72\u81f3Kubernetes\u96c6\u7fa4\uff0c\u4e5f\u5c31\u662f \u5b9e\u73b0\u201c\u4e00\u5207\u7686\u5bb9\u5668\u201d\u7684\u601d\u60f3\u3002</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5728Kubernetes\u96c6\u7fa4\u5916\u90e8\u4f1a\u6709\u4e00\u4e2aCeph\u8fd9\u6837\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u5e73\u53f0\u4f9bKubernetes\u4f7f\u7528\uff0c\u5728Kubernetes\u4e0a\u90e8\u7f72\u5bf9\u5e94\u7684CSI\u8fdb\u884c\u5b58\u50a8\u7f16\u6392\uff0c\u4e4b\u540e\u5373\u53ef\u975e\u5e38\u65b9\u4fbf\u5730\u5b9e\u73b0\u4e2d\u95f4\u4ef6\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u8fd9\u4e5f\u662f\u5e38\u7528\u7684\u4e00\u79cd\u65b9\u5f0f\u548c\u67b6\u6784\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/","title":"Kubernetes\u65e5\u5fd7\u6536\u96c6","text":""},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#1-\u65e5\u5fd7\u6536\u96c6\u67b6\u6784","title":"1. \u65e5\u5fd7\u6536\u96c6\u67b6\u6784","text":"<p>\u524d\u9762\u6211\u4eec\u5b66\u4e60\u4e86 Kubernetes \u96c6\u7fa4\u4e2d\u76d1\u63a7\u7cfb\u7edf\u7684\u642d\u5efa\uff0c\u9664\u4e86\u5bf9\u96c6\u7fa4\u7684\u76d1\u63a7\u62a5\u8b66\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u9879\u8fd0\u7ef4\u5de5\u4f5c\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u90a3\u5c31\u662f\u65e5\u5fd7\u7684\u6536\u96c6\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u548c\u7cfb\u7edf\u65e5\u5fd7\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u4e86\u89e3\u96c6\u7fa4\u5185\u90e8\u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u65e5\u5fd7\u5bf9\u4e8e\u6211\u4eec\u8c03\u8bd5\u95ee\u9898\u548c\u76d1\u89c6\u96c6\u7fa4\u60c5\u51b5\u4e5f\u662f\u975e\u5e38\u6709\u7528\u7684\u3002\u800c\u4e14\u5927\u90e8\u5206\u7684\u5e94\u7528\u90fd\u4f1a\u6709\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5bf9\u4e8e\u4f20\u7edf\u7684\u5e94\u7528\u5927\u90e8\u5206\u90fd\u4f1a\u5199\u5165\u5230\u672c\u5730\u7684\u65e5\u5fd7\u6587\u4ef6\u4e4b\u4e2d\u3002\u5bf9\u4e8e\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u5219\u66f4\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5c06\u65e5\u5fd7\u4fe1\u606f\u5199\u5165\u5230 stdout \u548c stderr \u5373\u53ef\uff0c\u5bb9\u5668\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5c31\u4f1a\u628a\u8fd9\u4e9b\u65e5\u5fd7\u8f93\u51fa\u5230\u5bbf\u4e3b\u673a\u4e0a\u7684\u4e00\u4e2a JSON \u6587\u4ef6\u4e4b\u4e2d\uff0c\u540c\u6837\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>docker logs</code> \u6216\u8005 <code>kubectl logs</code> \u6765\u67e5\u770b\u5230\u5bf9\u5e94\u7684\u65e5\u5fd7\u4fe1\u606f\u3002</p> <p>\u4f46\u662f\uff0c\u901a\u5e38\u6765\u8bf4\u5bb9\u5668\u5f15\u64ce\u6216\u8fd0\u884c\u65f6\u63d0\u4f9b\u7684\u529f\u80fd\u4e0d\u8db3\u4ee5\u8bb0\u5f55\u5b8c\u6574\u7684\u65e5\u5fd7\u4fe1\u606f\uff0c\u6bd4\u5982\uff0c\u5982\u679c\u5bb9\u5668\u5d29\u6e83\u4e86\u3001Pod \u88ab\u9a71\u9010\u4e86\u6216\u8005\u8282\u70b9\u6302\u6389\u4e86\uff0c\u6211\u4eec\u4ecd\u7136\u4e5f\u5e0c\u671b\u8bbf\u95ee\u5e94\u7528\u7a0b\u5e8f\u7684\u65e5\u5fd7\u3002\u6240\u4ee5\uff0c\u65e5\u5fd7\u5e94\u8be5\u72ec\u7acb\u4e8e\u8282\u70b9\u3001Pod \u6216\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u65b9\u5f0f\u88ab\u79f0\u4e3a <code>cluster-level-logging</code>\uff0c\u5373\u5b8c\u5168\u72ec\u7acb\u4e8e Kubernetes \u7cfb\u7edf\uff0c\u9700\u8981\u81ea\u5df1\u63d0\u4f9b\u5355\u72ec\u7684\u65e5\u5fd7\u540e\u7aef\u5b58\u50a8\u3001\u5206\u6790\u548c\u67e5\u8be2\u5de5\u5177\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#11-kubernetes-\u4e2d\u7684\u57fa\u672c\u65e5\u5fd7","title":"1.1 Kubernetes \u4e2d\u7684\u57fa\u672c\u65e5\u5fd7","text":"<p>\u4e0b\u9762\u8fd9\u4e2a\u793a\u4f8b\u662f Kubernetes \u4e2d\u7684\u4e00\u4e2a\u57fa\u672c\u65e5\u5fd7\u8bb0\u5f55\u7684\u793a\u4f8b\uff0c\u76f4\u63a5\u5c06\u6570\u636e\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u6d41\uff0c\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: counter\nspec:\ncontainers:\n- name: count\nimage: busybox\nargs:\n[\n/bin/sh,\n-c,\n'i=0; while true; do echo \"$i: $(date)\"; i=$((i+1)); sleep 1; done',\n]\n</code></pre> <p>\u5c06\u4e0a\u9762\u6587\u4ef6\u4fdd\u5b58\u4e3a counter-pod.yaml\uff0c\u8be5 Pod \u6bcf\u79d2\u8f93\u51fa\u4e00\u4e9b\u6587\u672c\u4fe1\u606f\uff0c\u521b\u5efa\u8fd9\u4e2a Pod\uff1a</p> <pre><code>$ kubectl apply -f counter-pod.yaml\npod \"counter\" created\n</code></pre> <p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>kubectl logs</code> \u547d\u4ee4\u67e5\u770b\u65e5\u5fd7\u4fe1\u606f\uff1a</p> <pre><code>$ kubectl logs counter\n0: Thu Dec 27 15:47:04 UTC 2018\n1: Thu Dec 27 15:47:05 UTC 2018\n2: Thu Dec 27 15:47:06 UTC 2018\n3: Thu Dec 27 15:47:07 UTC 2018\n......\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#12-kubernetes-\u65e5\u5fd7\u6536\u96c6","title":"1.2 Kubernetes \u65e5\u5fd7\u6536\u96c6","text":"<p>Kubernetes \u96c6\u7fa4\u672c\u8eab\u4e0d\u63d0\u4f9b\u65e5\u5fd7\u6536\u96c6\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4e00\u822c\u6765\u8bf4\u6709\u4e3b\u8981\u7684 3 \u79cd\u65b9\u6848\u6765\u505a\u65e5\u5fd7\u6536\u96c6\uff1a</p> <ul> <li>\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a agent \u6765\u6536\u96c6\u65e5\u5fd7</li> <li>\u5728 Pod \u4e2d\u5305\u542b\u4e00\u4e2a sidecar \u5bb9\u5668\u6765\u6536\u96c6\u5e94\u7528\u65e5\u5fd7</li> <li>\u76f4\u63a5\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5c06\u65e5\u5fd7\u4fe1\u606f\u63a8\u9001\u5230\u91c7\u96c6\u540e\u7aef</li> </ul>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#121-\u8282\u70b9\u65e5\u5fd7\u91c7\u96c6\u4ee3\u7406","title":"1.2.1 \u8282\u70b9\u65e5\u5fd7\u91c7\u96c6\u4ee3\u7406","text":"<p>\u901a\u8fc7\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a\u65e5\u5fd7\u6536\u96c6\u7684 agent \u6765\u91c7\u96c6\u65e5\u5fd7\u6570\u636e\uff0c\u65e5\u5fd7\u91c7\u96c6 agent \u662f\u4e00\u79cd\u4e13\u7528\u5de5\u5177\uff0c\u7528\u4e8e\u5c06\u65e5\u5fd7\u6570\u636e\u63a8\u9001\u5230\u7edf\u4e00\u7684\u540e\u7aef\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u8fd9\u79cd agent \u7528\u4e00\u4e2a\u5bb9\u5668\u6765\u8fd0\u884c\uff0c\u53ef\u4ee5\u8bbf\u95ee\u8be5\u8282\u70b9\u4e0a\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u7684\u65e5\u5fd7\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u3002</p> <p>\u7531\u4e8e\u8fd9\u79cd agent \u5fc5\u987b\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u6240\u4ee5\u76f4\u63a5\u4f7f\u7528 DaemonSet \u63a7\u5236\u5668\u8fd0\u884c\u8be5\u5e94\u7528\u7a0b\u5e8f\u5373\u53ef\u3002</p> <p>\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a\u65e5\u5fd7\u6536\u96c6\u7684 agent \u8fd9\u79cd\u65b9\u5f0f\u662f\u6700\u5e38\u89c1\u7684\u4e00\u79cd\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5b83\u53ea\u9700\u8981\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a\u4ee3\u7406\u7a0b\u5e8f\uff0c\u5e76\u4e0d\u9700\u8981\u5bf9\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u66f4\u6539\uff0c\u5bf9\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u4efb\u4f55\u4fb5\u5165\u6027\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u4ec5\u4ec5\u9002\u7528\u4e8e\u6536\u96c6\u8f93\u51fa\u5230 stdout \u548c stderr \u7684\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#122-\u4ee5-sidecar-\u5bb9\u5668\u6536\u96c6\u65e5\u5fd7","title":"1.2.2 \u4ee5 sidecar \u5bb9\u5668\u6536\u96c6\u65e5\u5fd7","text":"<p>\u6211\u4eec\u770b\u4e0a\u9762\u7684\u56fe\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e2a\u660e\u663e\u7684\u95ee\u9898\u5c31\u662f\u6211\u4eec\u91c7\u96c6\u7684\u65e5\u5fd7\u90fd\u662f\u901a\u8fc7\u8f93\u51fa\u5230\u5bb9\u5668\u7684 stdout \u548c stderr \u91cc\u9762\u7684\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u4f1a\u5728\u672c\u5730\u7684\u5bb9\u5668\u5bf9\u5e94\u76ee\u5f55\u4e2d\u4fdd\u7559\u6210 JSON \u65e5\u5fd7\u6587\u4ef6\uff0c\u6240\u4ee5\u76f4\u63a5\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a agent \u5c31\u53ef\u4ee5\u91c7\u96c6\u5230\u65e5\u5fd7\u3002\u4f46\u662f\u5982\u679c\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u65e5\u5fd7\u662f\u8f93\u51fa\u5230\u5bb9\u5668\u4e2d\u7684\u67d0\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u8bdd\u5462\uff1f\u8fd9\u79cd\u65e5\u5fd7\u6570\u636e\u663e\u7136\u53ea\u901a\u8fc7\u4e0a\u9762\u7684\u65b9\u6848\u662f\u91c7\u96c6\u4e0d\u5230\u7684\u4e86\u3002</p> <p>\u7528 sidecar \u5bb9\u5668\u91cd\u65b0\u8f93\u51fa\u65e5\u5fd7</p> <p></p> <p>\u5bf9\u4e8e\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728 Pod \u4e2d\u542f\u52a8\u53e6\u5916\u4e00\u4e2a sidecar \u5bb9\u5668\uff0c\u76f4\u63a5\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u65e5\u5fd7\u901a\u8fc7\u8fd9\u4e2a\u5bb9\u5668\u91cd\u65b0\u8f93\u51fa\u5230 stdout\uff0c\u8fd9\u6837\u662f\u4e0d\u662f\u901a\u8fc7\u4e0a\u9762\u7684\u8282\u70b9\u65e5\u5fd7\u6536\u96c6\u65b9\u6848\u53c8\u53ef\u4ee5\u5b8c\u6210\u4e86\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e2a sidecar \u5bb9\u5668\u7684\u4e3b\u8981\u903b\u8f91\u5c31\u662f\u5c06\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u65e5\u5fd7\u8fdb\u884c\u91cd\u5b9a\u5411\u6253\u5370\uff0c\u6240\u4ee5\u80cc\u540e\u7684\u903b\u8f91\u975e\u5e38\u7b80\u5355\uff0c\u5f00\u9500\u5f88\u5c0f\uff0c\u800c\u4e14\u7531\u4e8e\u8f93\u51fa\u5230\u4e86 stdout \u6216\u8005 stderr\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 kubectl logs \u6765\u67e5\u770b\u65e5\u5fd7\u4e86\u3002</p> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u662f\u5728 Pod \u4e2d\u5c06\u65e5\u5fd7\u8bb0\u5f55\u5728\u4e86\u5bb9\u5668\u7684\u4e24\u4e2a\u672c\u5730\u6587\u4ef6\u4e4b\u4e2d\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: counter\nspec:\ncontainers:\n- name: count\nimage: busybox\nargs:\n- /bin/sh\n- -c\n- &gt;\ni=0;\nwhile true;\ndo\necho \"$i: $(date)\" &gt;&gt; /var/log/1.log;\necho \"$(date) INFO $i\" &gt;&gt; /var/log/2.log;\ni=$((i+1));\nsleep 1;\ndone\nvolumeMounts:\n- name: varlog\nmountPath: /var/log\nvolumes:\n- name: varlog\nemptyDir: {}\n</code></pre></p> <p>\u7531\u4e8e Pod \u4e2d\u5bb9\u5668\u7684\u7279\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u53e6\u5916\u4e00\u4e2a sidecar \u5bb9\u5668\u53bb\u83b7\u53d6\u5230\u53e6\u5916\u5bb9\u5668\u4e2d\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u7136\u540e\u5c06\u65e5\u5fd7\u91cd\u5b9a\u5411\u5230\u81ea\u5df1\u7684 stdout \u6d41\u4e2d\uff0c\u53ef\u4ee5\u5c06\u4e0a\u9762\u7684 YAML \u6587\u4ef6\u505a\u5982\u4e0b\u4fee\u6539\uff1a\uff08two-files-counter-pod-streaming-sidecar.yaml\uff09</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: counter\nspec:\ncontainers:\n- name: count\nimage: busybox\nargs:\n- /bin/sh\n- -c\n- &gt;\ni=0;\nwhile true;\ndo\necho \"$i: $(date)\" &gt;&gt; /var/log/1.log;\necho \"$(date) INFO $i\" &gt;&gt; /var/log/2.log;\ni=$((i+1));\nsleep 1;\ndone\nvolumeMounts:\n- name: varlog\nmountPath: /var/log\n- name: count-log-1\nimage: busybox\nargs: [/bin/sh, -c, \"tail -n+1 -f /var/log/1.log\"]\nvolumeMounts:\n- name: varlog\nmountPath: /var/log\n- name: count-log-2\nimage: busybox\nargs: [/bin/sh, -c, \"tail -n+1 -f /var/log/2.log\"]\nvolumeMounts:\n- name: varlog\nmountPath: /var/log\nvolumes:\n- name: varlog\nemptyDir: {}\n</code></pre> <p>\u76f4\u63a5\u521b\u5efa\u4e0a\u9762\u7684 Pod\uff1a <pre><code>$ kubectl apply -f two-files-counter-pod-streaming-sidecar.yaml\npod \"counter\" created\n</code></pre></p> <p>\u8fd0\u884c\u6210\u529f\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u67e5\u770b\u65e5\u5fd7\u7684\u4fe1\u606f\uff1a <pre><code>$ kubectl logs counter count-log-1\n0: Mon Jan  1 00:00:00 UTC 2001\n1: Mon Jan  1 00:00:01 UTC 2001\n2: Mon Jan  1 00:00:02 UTC 2001\n...\n$ kubectl logs counter count-log-2\nMon Jan  1 00:00:00 UTC 2001 INFO 0\nMon Jan  1 00:00:01 UTC 2001 INFO 1\nMon Jan  1 00:00:02 UTC 2001 INFO 2\n...\n</code></pre> \u8fd9\u6837\u524d\u9762\u8282\u70b9\u4e0a\u7684\u65e5\u5fd7\u91c7\u96c6 agent \u5c31\u53ef\u4ee5\u81ea\u52a8\u83b7\u53d6\u8fd9\u4e9b\u65e5\u5fd7\u4fe1\u606f\uff0c\u800c\u4e0d\u9700\u8981\u5176\u4ed6\u914d\u7f6e\u3002</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u867d\u7136\u53ef\u4ee5\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u4f46\u662f\u4e5f\u6709\u4e00\u4e2a\u660e\u663e\u7684\u7f3a\u9677\uff0c\u5c31\u662f\u65e5\u5fd7\u4e0d\u4ec5\u4f1a\u5728\u539f\u5bb9\u5668\u6587\u4ef6\u4e2d\u4fdd\u7559\u4e0b\u6765\uff0c\u8fd8\u4f1a\u901a\u8fc7 stdout \u8f93\u51fa\u540e\u5360\u7528\u78c1\u76d8\u7a7a\u95f4\uff0c\u8fd9\u6837\u65e0\u5f62\u4e2d\u5c31\u589e\u52a0\u4e86\u4e00\u500d\u78c1\u76d8\u7a7a\u95f4\u3002</p> <p>\u4f7f\u7528 sidecar \u8fd0\u884c\u65e5\u5fd7\u91c7\u96c6 agent</p> <p></p> <p>\u5982\u679c\u4f60\u89c9\u5f97\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a\u65e5\u5fd7\u91c7\u96c6\u7684\u4ee3\u7406\u4e0d\u591f\u7075\u6d3b\u7684\u8bdd\uff0c\u90a3\u4e48\u4f60\u4e5f\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5355\u72ec\u7684\u65e5\u5fd7\u91c7\u96c6\u4ee3\u7406\u7a0b\u5e8f\u7684 sidecar \u5bb9\u5668\uff0c\u4e0d\u8fc7\u9700\u8981\u5355\u72ec\u914d\u7f6e\u548c\u5e94\u7528\u7a0b\u5e8f\u4e00\u8d77\u8fd0\u884c\u3002</p> <p>\u4e0d\u8fc7\u8fd9\u6837\u867d\u7136\u66f4\u52a0\u7075\u6d3b\uff0c\u4f46\u662f\u5728 sidecar \u5bb9\u5668\u4e2d\u8fd0\u884c\u65e5\u5fd7\u91c7\u96c6\u4ee3\u7406\u7a0b\u5e8f\u4f1a\u5bfc\u81f4\u5927\u91cf\u8d44\u6e90\u6d88\u8017\uff0c\u56e0\u4e3a\u4f60\u6709\u591a\u5c11\u4e2a\u8981\u91c7\u96c6\u7684 Pod\uff0c\u5c31\u9700\u8981\u8fd0\u884c\u591a\u5c11\u4e2a\u91c7\u96c6\u4ee3\u7406\u7a0b\u5e8f\uff0c\u53e6\u5916\u8fd8\u65e0\u6cd5\u4f7f\u7528 kubectl logs \u547d\u4ee4\u6765\u8bbf\u95ee\u8fd9\u4e9b\u65e5\u5fd7\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0d\u53d7 kubelet \u63a7\u5236\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u7684 Stackdriver\uff0c\u5b83\u4f7f\u7528 fluentd \u4f5c\u4e3a\u8bb0\u5f55\u5242\u3002\u4ee5\u4e0b\u662f\u4e24\u4e2a\u53ef\u7528\u4e8e\u5b9e\u73b0\u6b64\u65b9\u6cd5\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u7b2c\u4e00\u4e2a\u6587\u4ef6\u5305\u542b\u914d\u7f6e\u6d41\u5229\u7684 ConfigMap\u3002</p> <p>\u4e0b\u9762\u662f Kubernetes \u5b98\u65b9\u7684\u4e00\u4e2a fluentd \u7684\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\uff0c\u4f7f\u7528 ConfigMap \u5bf9\u8c61\u6765\u4fdd\u5b58\uff1a <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\nname: fluentd-config\ndata:\nfluentd.conf: |\n&lt;source&gt;\ntype tail\nformat none\npath /var/log/1.log\npos_file /var/log/1.log.pos\ntag count.format1\n&lt;/source&gt;\n&lt;source&gt;\ntype tail\nformat none\npath /var/log/2.log\npos_file /var/log/2.log.pos\ntag count.format2\n&lt;/source&gt;\n&lt;match **&gt;\ntype google_cloud\n&lt;/match&gt;\n</code></pre></p> <p>\u4e0a\u9762\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u914d\u7f6e\u6536\u96c6\u539f\u6587\u4ef6 /var/log/1.log \u548c /var/log/2.log \u7684\u65e5\u5fd7\u6570\u636e\uff0c\u7136\u540e\u901a\u8fc7 google_cloud \u8fd9\u4e2a\u63d2\u4ef6\u5c06\u6570\u636e\u63a8\u9001\u5230 Stackdriver \u540e\u7aef\u53bb\u3002</p> <p>\u4e0b\u9762\u662f\u6211\u4eec\u4f7f\u7528\u4e0a\u9762\u7684\u914d\u7f6e\u6587\u4ef6\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u8fd0\u884c\u4e00\u4e2a fluentd \u7684\u5bb9\u5668\u6765\u8bfb\u53d6\u65e5\u5fd7\u6570\u636e\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: counter\nspec:\ncontainers:\n- name: count\nimage: busybox\nargs:\n- /bin/sh\n- -c\n- &gt;\ni=0;\nwhile true;\ndo\necho \"$i: $(date)\" &gt;&gt; /var/log/1.log;\necho \"$(date) INFO $i\" &gt;&gt; /var/log/2.log;\ni=$((i+1));\nsleep 1;\ndone\nvolumeMounts:\n- name: varlog\nmountPath: /var/log\n- name: count-agent\nimage: k8s.gcr.io/fluentd-gcp:1.30\nenv:\n- name: FLUENTD_ARGS\nvalue: -c /etc/fluentd-config/fluentd.conf\nvolumeMounts:\n- name: varlog\nmountPath: /var/log\n- name: config-volume\nmountPath: /etc/fluentd-config\nvolumes:\n- name: varlog\nemptyDir: {}\n- name: config-volume\nconfigMap:\nname: fluentd-config\n</code></pre> <p>\u4e0a\u9762\u7684 Pod \u521b\u5efa\u5b8c\u6210\u540e\uff0c\u5bb9\u5668 count-agent \u5c31\u4f1a\u5c06 count \u5bb9\u5668\u4e2d\u7684\u65e5\u5fd7\u8fdb\u884c\u6536\u96c6\u7136\u540e\u4e0a\u4f20\u3002</p> <p>\u5f53\u7136\uff0c\u8fd9\u53ea\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u6211\u4eec\u4e5f\u5b8c\u5168\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u7684\u4efb\u4f55\u65e5\u5fd7\u91c7\u96c6\u5de5\u5177\u6765\u66ff\u6362 fluentd\uff0c\u6bd4\u5982 logstash\u3001fluent-bit \u7b49\u7b49\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#123-\u76f4\u63a5\u4ece\u5e94\u7528\u7a0b\u5e8f\u6536\u96c6\u65e5\u5fd7","title":"1.2.3 \u76f4\u63a5\u4ece\u5e94\u7528\u7a0b\u5e8f\u6536\u96c6\u65e5\u5fd7","text":"<p>\u9664\u4e86\u4e0a\u9762\u7684\u51e0\u79cd\u65b9\u6848\u4e4b\u5916\uff0c\u6211\u4eec\u4e5f\u5b8c\u5168\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u53bb\u663e\u793a\u7684\u5c06\u65e5\u5fd7\u63a8\u9001\u5230\u65e5\u5fd7\u540e\u7aef\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u9700\u8981\u4ee3\u7801\u5c42\u9762\u7684\u5b9e\u73b0\uff0c\u4e5f\u8d85\u51fa\u4e86 Kubernetes \u672c\u8eab\u7684\u8303\u56f4\u3002</p> <p></p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#2-\u642d\u5efa-efk-\u65e5\u5fd7\u7cfb\u7edf","title":"2. \u642d\u5efa EFK \u65e5\u5fd7\u7cfb\u7edf","text":"<p>\u524d\u9762\u5927\u5bb6\u4ecb\u7ecd\u4e86 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u51e0\u79cd\u65e5\u5fd7\u6536\u96c6\u65b9\u6848\uff0cKubernetes \u4e2d\u6bd4\u8f83\u6d41\u884c\u7684\u65e5\u5fd7\u6536\u96c6\u89e3\u51b3\u65b9\u6848\u662f Elasticsearch\u3001Fluentd \u548c Kibana\uff08EFK\uff09\u6280\u672f\u6808\uff0c\u4e5f\u662f\u5b98\u65b9\u73b0\u5728\u6bd4\u8f83\u63a8\u8350\u7684\u4e00\u79cd\u65b9\u6848\u3002</p> <p>Elasticsearch \u662f\u4e00\u4e2a\u5b9e\u65f6\u7684\u3001\u5206\u5e03\u5f0f\u7684\u53ef\u6269\u5c55\u7684\u641c\u7d22\u5f15\u64ce\uff0c\u5141\u8bb8\u8fdb\u884c\u5168\u6587\u3001\u7ed3\u6784\u5316\u641c\u7d22\uff0c\u5b83\u901a\u5e38\u7528\u4e8e\u7d22\u5f15\u548c\u641c\u7d22\u5927\u91cf\u65e5\u5fd7\u6570\u636e\uff0c\u4e5f\u53ef\u7528\u4e8e\u641c\u7d22\u8bb8\u591a\u4e0d\u540c\u7c7b\u578b\u7684\u6587\u6863\u3002</p> <p>Elasticsearch \u901a\u5e38\u4e0e Kibana \u4e00\u8d77\u90e8\u7f72\uff0cKibana \u662f Elasticsearch \u7684\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684\u6570\u636e\u53ef\u89c6\u5316 Dashboard\uff0cKibana \u5141\u8bb8\u4f60\u901a\u8fc7 web \u754c\u9762\u6765\u6d4f\u89c8 Elasticsearch \u65e5\u5fd7\u6570\u636e\u3002</p> <p>Fluentd\u662f\u4e00\u4e2a\u6d41\u884c\u7684\u5f00\u6e90\u6570\u636e\u6536\u96c6\u5668\uff0c\u6211\u4eec\u5c06\u5728 Kubernetes \u96c6\u7fa4\u8282\u70b9\u4e0a\u5b89\u88c5 Fluentd\uff0c\u901a\u8fc7\u83b7\u53d6\u5bb9\u5668\u65e5\u5fd7\u6587\u4ef6\u3001\u8fc7\u6ee4\u548c\u8f6c\u6362\u65e5\u5fd7\u6570\u636e\uff0c\u7136\u540e\u5c06\u6570\u636e\u4f20\u9012\u5230 Elasticsearch \u96c6\u7fa4\uff0c\u5728\u8be5\u96c6\u7fa4\u4e2d\u5bf9\u5176\u8fdb\u884c\u7d22\u5f15\u548c\u5b58\u50a8\u3002</p> <p>\u6211\u4eec\u5148\u6765\u914d\u7f6e\u542f\u52a8\u4e00\u4e2a\u53ef\u6269\u5c55\u7684 Elasticsearch \u96c6\u7fa4\uff0c\u7136\u540e\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u521b\u5efa\u4e00\u4e2a Kibana \u5e94\u7528\uff0c\u6700\u540e\u901a\u8fc7 DaemonSet \u6765\u8fd0\u884c Fluentd\uff0c\u4ee5\u4fbf\u5b83\u5728\u6bcf\u4e2a Kubernetes \u5de5\u4f5c\u8282\u70b9\u4e0a\u90fd\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e2a Pod\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#21-\u5b89\u88c5-elasticsearch-\u96c6\u7fa4","title":"2.1 \u5b89\u88c5 Elasticsearch \u96c6\u7fa4","text":"<p>\u5728\u521b\u5efa Elasticsearch \u96c6\u7fa4\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\uff0c\u6211\u4eec\u5c06\u5728\u5176\u4e2d\u5b89\u88c5\u6240\u6709\u65e5\u5fd7\u76f8\u5173\u7684\u8d44\u6e90\u5bf9\u8c61\u3002</p> <pre><code>$ kubectl create ns logging\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#211-\u73af\u5883\u51c6\u5907","title":"2.1.1 \u73af\u5883\u51c6\u5907","text":"<p>ElasticSearch \u5b89\u88c5\u6709\u6700\u4f4e\u5b89\u88c5\u8981\u6c42\uff0c\u5982\u679c\u5b89\u88c5\u540e Pod \u65e0\u6cd5\u6b63\u5e38\u542f\u52a8\uff0c\u8bf7\u68c0\u67e5\u662f\u5426\u7b26\u5408\u6700\u4f4e\u8981\u6c42\u7684\u914d\u7f6e\uff0c\u8981\u6c42\u5982\u4e0b\uff1a</p> \u8282\u70b9\u540d\u79f0 \u8282\u70b9\u7c7b\u578b CPU \u914d\u7f6e Memory \u914d\u7f6e k8s-master master 4C 4Gi k8s-node-2-12 worker 8C 8Gi k8s-node-2-13 worker 8C 8Gi k8s-node-2-14 worker 8C 8Gi <p>es\u96c6\u7fa4\u8981\u6c42</p> ElasticSearch\u8282\u70b9 CPU\u6700\u5c0f\u8981\u6c42 Memory \u6700\u5c0f\u8981\u6c42 elasticsearch-master &gt;2\u6838 &gt;2Gi elasticsearch-data &gt;1\u6838 &gt;2Gi elasticsearch-client &gt;1\u6838 &gt;2Gi <p>\u8fd9\u91cc\u6211\u4eec\u8981\u5b89\u88c5\u7684 ES \u96c6\u7fa4\u73af\u5883\u4fe1\u606f\u5982\u4e0b\u6240\u793a\uff1a</p> \u96c6\u7fa4\u540d\u79f0 \u8282\u70b9\u7c7b\u578b \u526f\u672c\u6570\u76ee \u5b58\u50a8\u5927\u5c0f \u7f51\u7edc\u6a21\u5f0f \u63cf\u8ff0 elasticsearch Master 3 5Gi ClusterIP \u4e3b\u8282\u70b9 elasticsearch Data 3 50Gi ClusterIP \u6570\u636e\u8282\u70b9 elasticsearch Client 2 \u65e0 NodePort \u5904\u7406\u7528\u6237\u8bf7\u6c42\u3001\u8f6c\u53d1 <p>\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a NFS \u7c7b\u578b\u7684 StorageClass \u6765\u505a\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u5f53\u7136\u5982\u679c\u4f60\u662f\u7ebf\u4e0a\u73af\u5883\u5efa\u8bae\u4f7f\u7528 Local PV \u6216\u8005 Ceph RBD \u4e4b\u7c7b\u7684\u5b58\u50a8\u6765\u6301\u4e45\u5316 Elasticsearch \u7684\u6570\u636e\u3002</p> <p>\u5b89\u88c5nfs-storageClass\u5b58\u50a8 <pre><code>$ helm repo add azure http://mirror.azure.cn/kubernetes/charts/\n$ helm repo update\n\n# \u6216\u8005\u4e0b\u8f7d\u5230\u672c\u5730\u518d\u5b89\u88c5\n$ helm pull azure/nfs-client-provisioner\n$ tar xvf nfs-client-provisioner-*.tgz\n\n$ kubectl create ns nfs\n\n$ helm install efk-nfs-storage -n nfs \\\n--set nfs.server=192.168.1.46 \\\n--set nfs.path=/efk  \\\n--set storageClass.name=efk-nfs,storageClass.reclaimPolicy=Retain \\\n--set storageClass.defaultClass=true \\\nnfs-client-provisioner\n</code></pre></p> <p>\u6b64\u5916\u7531\u4e8e ElasticSearch 7.x \u7248\u672c\u9ed8\u8ba4\u5b89\u88c5\u4e86 X-Pack \u63d2\u4ef6\uff0c\u5e76\u4e14\u90e8\u5206\u529f\u80fd\u514d\u8d39\uff0c\u9700\u8981\u6211\u4eec\u914d\u7f6e\u4e00\u4e9b\u5b89\u5168\u8bc1\u4e66\u6587\u4ef6\u3002</p> <p>1\u3001\u751f\u6210\u8bc1\u4e66\u6587\u4ef6</p> <pre><code># \u8fd0\u884c\u5bb9\u5668\u751f\u6210\u8bc1\u4e66\n$ docker run --name elastic-certs -i -w /app elasticsearch:7.12.0 /bin/sh -c  \\\n\"elasticsearch-certutil ca --out /app/elastic-stack-ca.p12 --pass '' &amp;&amp; \\\n    elasticsearch-certutil cert --name security-master --dns \\\n    security-master --ca /app/elastic-stack-ca.p12 --pass '' --ca-pass '' --out /app/elastic-certificates.p12\"\n# \u4ece\u5bb9\u5668\u4e2d\u5c06\u751f\u6210\u7684\u8bc1\u4e66\u62f7\u8d1d\u51fa\u6765\n$ docker cp elastic-certs:/app/elastic-certificates.p12 .\n\n# \u5220\u9664\u5bb9\u5668\n$ docker rm -f elastic-certs\n\n# \u5c06 pcks12 \u4e2d\u7684\u4fe1\u606f\u5206\u79bb\u51fa\u6765\uff0c\u5199\u5165\u6587\u4ef6\n$ openssl pkcs12 -nodes -passin pass:'' -in elastic-certificates.p12 -out elastic-certificate.pem\n</code></pre> <p>2\u3001\u6dfb\u52a0\u8bc1\u4e66\u5230 Kubernetes</p> <pre><code># \u6dfb\u52a0\u8bc1\u4e66\n$ kubectl create secret -n logging generic elastic-certs --from-file=elastic-certificates.p12\n\n# \u8bbe\u7f6e\u96c6\u7fa4\u7528\u6237\u540d\u5bc6\u7801\n$ kubectl create secret -n logging generic elastic-auth --from-literal=username=elastic --from-literal=password=oschina\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#212-\u5b89\u88c5-es-\u96c6\u7fa4","title":"2.1.2 \u5b89\u88c5 ES \u96c6\u7fa4","text":"<p>\u9996\u5148\u6dfb\u52a0 ELastic \u7684 Helm \u4ed3\u5e93\uff1a <pre><code>$ helm repo add elastic https://helm.elastic.co\n$ helm repo update\n</code></pre> ElaticSearch \u5b89\u88c5\u9700\u8981\u5b89\u88c5\u4e09\u6b21\uff0c\u5206\u522b\u5b89\u88c5 Master\u3001Data\u3001Client \u8282\u70b9\uff0cMaster \u8282\u70b9\u8d1f\u8d23\u96c6\u7fa4\u95f4\u7684\u7ba1\u7406\u5de5\u4f5c\uff1bData \u8282\u70b9\u8d1f\u8d23\u5b58\u50a8\u6570\u636e\uff1bClient \u8282\u70b9\u8d1f\u8d23\u4ee3\u7406 ElasticSearch Cluster \u96c6\u7fa4\uff0c\u8d1f\u8f7d\u5747\u8861\u3002</p> <p>\u9996\u5148\u4f7f\u7528 helm pull \u62c9\u53d6 Chart \u5e76\u89e3\u538b\uff1a <pre><code>$ helm pull elastic/elasticsearch --untar --version 7.17.3\n$ cd elasticsearch\n</code></pre></p> <p>\u5728 Chart \u76ee\u5f55\u4e0b\u9762\u521b\u5efa\u7528\u4e8e Master \u8282\u70b9\u5b89\u88c5\u914d\u7f6e\u7684 values \u6587\u4ef6\uff1a</p> <p><code>values-master.yaml</code></p> <pre><code># values-master.yaml\n## \u8bbe\u7f6e\u96c6\u7fa4\u540d\u79f0\nclusterName: \"elasticsearch\"\n## \u8bbe\u7f6e\u8282\u70b9\u540d\u79f0\nnodeGroup: \"master\"\n## \u8bbe\u7f6e\u89d2\u8272\nroles:\nmaster: \"true\"\ningest: \"false\"\ndata: \"false\"\n# ============\u955c\u50cf\u914d\u7f6e============\n## \u6307\u5b9a\u955c\u50cf\u4e0e\u955c\u50cf\u7248\u672c\nimage: \"elasticsearch\"\nimageTag: \"7.17.3\"\nimagePullPolicy: \"IfNotPresent\"\n## \u526f\u672c\u6570\nreplicas: 3\n# ============\u8d44\u6e90\u914d\u7f6e============\n## JVM \u914d\u7f6e\u53c2\u6570\nesJavaOpts: \"-Xmx1g -Xms1g\"\n## \u90e8\u7f72\u8d44\u6e90\u914d\u7f6e(\u751f\u6210\u73af\u5883\u8981\u8bbe\u7f6e\u5927\u4e9b)\nresources:\nrequests:\ncpu: \"2000m\"\nmemory: \"2Gi\"\nlimits:\ncpu: \"2000m\"\nmemory: \"2Gi\"\n## \u6570\u636e\u6301\u4e45\u5377\u914d\u7f6e\npersistence:\nenabled: true\n## \u5b58\u50a8\u6570\u636e\u5927\u5c0f\u914d\u7f6e\nvolumeClaimTemplate:\nstorageClassName: efk-nfs\naccessModes: [\"ReadWriteOnce\"]\nresources:\nrequests:\nstorage: 50Gi\n# ============\u5b89\u5168\u914d\u7f6e============\n## \u8bbe\u7f6e\u534f\u8bae\uff0c\u53ef\u914d\u7f6e\u4e3a http\u3001https\nprotocol: http\n## \u8bc1\u4e66\u6302\u8f7d\u914d\u7f6e\uff0c\u8fd9\u91cc\u6211\u4eec\u6302\u5165\u4e0a\u9762\u521b\u5efa\u7684\u8bc1\u4e66\nsecretMounts:\n- name: elastic-certs\nsecretName: elastic-certs\npath: /usr/share/elasticsearch/config/certs\ndefaultMode: 0755\n## \u5141\u8bb8\u60a8\u5728/usr/share/elasticsearch/config/\u4e2d\u6dfb\u52a0\u4efb\u4f55\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6,\u4f8b\u5982 elasticsearch.yml\u3001log4j2.properties\n## ElasticSearch 7.x \u9ed8\u8ba4\u5b89\u88c5\u4e86 x-pack \u63d2\u4ef6\uff0c\u90e8\u5206\u529f\u80fd\u514d\u8d39\uff0c\u8fd9\u91cc\u6211\u4eec\u914d\u7f6e\u4e0b\n## \u4e0b\u9762\u6ce8\u6389\u7684\u90e8\u5206\u4e3a\u914d\u7f6e https \u8bc1\u4e66\uff0c\u914d\u7f6e\u6b64\u90e8\u5206\u8fd8\u9700\u8981\u914d\u7f6e helm \u53c2\u6570 protocol \u503c\u6539\u4e3a https\nesConfig:\nelasticsearch.yml: |\nxpack.security.enabled: true\nxpack.security.transport.ssl.enabled: true\nxpack.security.transport.ssl.verification_mode: certificate\nxpack.security.transport.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\nxpack.security.transport.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n# xpack.security.http.ssl.enabled: true\n# xpack.security.http.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n# xpack.security.http.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n## \u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff0c\u8fd9\u91cc\u5f15\u5165\u4e0a\u9762\u8bbe\u7f6e\u7684\u7528\u6237\u540d\u3001\u5bc6\u7801 secret \u6587\u4ef6\nextraEnvs:\n- name: ELASTIC_USERNAME\nvalueFrom:\nsecretKeyRef:\nname: elastic-auth\nkey: username\n- name: ELASTIC_PASSWORD\nvalueFrom:\nsecretKeyRef:\nname: elastic-auth\nkey: password\n# ============\u8c03\u5ea6\u914d\u7f6e============\n## \u8bbe\u7f6e\u8c03\u5ea6\u7b56\u7565\n## - hard\uff1a\u53ea\u6709\u5f53\u6709\u8db3\u591f\u7684\u8282\u70b9\u65f6 Pod \u624d\u4f1a\u88ab\u8c03\u5ea6\uff0c\u5e76\u4e14\u5b83\u4eec\u6c38\u8fdc\u4e0d\u4f1a\u51fa\u73b0\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\n## - soft\uff1a\u5c3d\u6700\u5927\u52aa\u529b\u8c03\u5ea6\nantiAffinity: \"soft\"\n# tolerations:\n#   - operator: \"Exists\" ##\u5bb9\u5fcd\u5168\u90e8\u6c61\u70b9\n</code></pre> <p>\u7136\u540e\u521b\u5efa\u7528\u4e8e Data \u8282\u70b9\u5b89\u88c5\u7684 values \u6587\u4ef6\uff1a</p> <pre><code># values-data.yaml\n# ============\u8bbe\u7f6e\u96c6\u7fa4\u540d\u79f0============\n## \u8bbe\u7f6e\u96c6\u7fa4\u540d\u79f0\nclusterName: \"elasticsearch\"\n## \u8bbe\u7f6e\u8282\u70b9\u540d\u79f0\nnodeGroup: \"data\"\n## \u8bbe\u7f6e\u89d2\u8272\nroles:\nmaster: \"false\"\ningest: \"true\"\ndata: \"true\"\n# ============\u955c\u50cf\u914d\u7f6e============\n## \u6307\u5b9a\u955c\u50cf\u4e0e\u955c\u50cf\u7248\u672c\nimage: \"elasticsearch\"\nimageTag: \"7.17.3\"\n## \u526f\u672c\u6570(\u5efa\u8bae\u8bbe\u7f6e\u4e3a3\uff0c\u6211\u8fd9\u91cc\u8d44\u6e90\u4e0d\u8db3\u53ea\u7528\u4e861\u4e2a\u526f\u672c)\nreplicas: 3\n# ============\u8d44\u6e90\u914d\u7f6e============\n## JVM \u914d\u7f6e\u53c2\u6570\nesJavaOpts: \"-Xmx1g -Xms1g\"\n## \u90e8\u7f72\u8d44\u6e90\u914d\u7f6e(\u751f\u6210\u73af\u5883\u4e00\u5b9a\u8981\u8bbe\u7f6e\u5927\u4e9b)\nresources:\nrequests:\ncpu: \"1000m\"\nmemory: \"2Gi\"\nlimits:\ncpu: \"1000m\"\nmemory: \"2Gi\"\n## \u6570\u636e\u6301\u4e45\u5377\u914d\u7f6e\npersistence:\nenabled: true\n## \u5b58\u50a8\u6570\u636e\u5927\u5c0f\u914d\u7f6e\nvolumeClaimTemplate:\nstorageClassName: efk-nfs\naccessModes: [\"ReadWriteOnce\"]\nresources:\nrequests:\nstorage: 200Gi\n# ============\u5b89\u5168\u914d\u7f6e============\n## \u8bbe\u7f6e\u534f\u8bae\uff0c\u53ef\u914d\u7f6e\u4e3a http\u3001https\nprotocol: http\n## \u8bc1\u4e66\u6302\u8f7d\u914d\u7f6e\uff0c\u8fd9\u91cc\u6211\u4eec\u6302\u5165\u4e0a\u9762\u521b\u5efa\u7684\u8bc1\u4e66\nsecretMounts:\n- name: elastic-certs\nsecretName: elastic-certs\npath: /usr/share/elasticsearch/config/certs\n## \u5141\u8bb8\u60a8\u5728/usr/share/elasticsearch/config/\u4e2d\u6dfb\u52a0\u4efb\u4f55\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6,\u4f8b\u5982 elasticsearch.yml\n## ElasticSearch 7.x \u9ed8\u8ba4\u5b89\u88c5\u4e86 x-pack \u63d2\u4ef6\uff0c\u90e8\u5206\u529f\u80fd\u514d\u8d39\uff0c\u8fd9\u91cc\u6211\u4eec\u914d\u7f6e\u4e0b\n## \u4e0b\u9762\u6ce8\u6389\u7684\u90e8\u5206\u4e3a\u914d\u7f6e https \u8bc1\u4e66\uff0c\u914d\u7f6e\u6b64\u90e8\u5206\u8fd8\u9700\u8981\u914d\u7f6e helm \u53c2\u6570 protocol \u503c\u6539\u4e3a https\nesConfig:\nelasticsearch.yml: |\nxpack.security.enabled: true\nxpack.security.transport.ssl.enabled: true\nxpack.security.transport.ssl.verification_mode: certificate\nxpack.security.transport.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\nxpack.security.transport.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n# xpack.security.http.ssl.enabled: true\n# xpack.security.http.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n# xpack.security.http.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n## \u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff0c\u8fd9\u91cc\u5f15\u5165\u4e0a\u9762\u8bbe\u7f6e\u7684\u7528\u6237\u540d\u3001\u5bc6\u7801 secret \u6587\u4ef6\nextraEnvs:\n- name: ELASTIC_USERNAME\nvalueFrom:\nsecretKeyRef:\nname: elastic-auth\nkey: username\n- name: ELASTIC_PASSWORD\nvalueFrom:\nsecretKeyRef:\nname: elastic-auth\nkey: password\n# ============\u8c03\u5ea6\u914d\u7f6e============\n## \u8bbe\u7f6e\u8c03\u5ea6\u7b56\u7565\n## - hard\uff1a\u53ea\u6709\u5f53\u6709\u8db3\u591f\u7684\u8282\u70b9\u65f6 Pod \u624d\u4f1a\u88ab\u8c03\u5ea6\uff0c\u5e76\u4e14\u5b83\u4eec\u6c38\u8fdc\u4e0d\u4f1a\u51fa\u73b0\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\n## - soft\uff1a\u5c3d\u6700\u5927\u52aa\u529b\u8c03\u5ea6\nantiAffinity: \"soft\"\n## \u5bb9\u5fcd\u914d\u7f6e\n# tolerations:\n#   - operator: \"Exists\" ##\u5bb9\u5fcd\u5168\u90e8\u6c61\u70b9\n</code></pre> <p>\u6700\u540e\u4e00\u4e2a\u662f\u7528\u4e8e\u521b\u5efa Client \u8282\u70b9\u7684 values \u6587\u4ef6\uff1a</p> <p><code>values-client.yaml</code></p> <pre><code># values-client.yaml\n# ============\u8bbe\u7f6e\u96c6\u7fa4\u540d\u79f0============\n## \u8bbe\u7f6e\u96c6\u7fa4\u540d\u79f0\nclusterName: \"elasticsearch\"\n## \u8bbe\u7f6e\u8282\u70b9\u540d\u79f0\nnodeGroup: \"client\"\n## \u8bbe\u7f6e\u89d2\u8272\nroles:\nmaster: \"false\"\ningest: \"false\"\ndata: \"false\"\n# ============\u955c\u50cf\u914d\u7f6e============\n## \u6307\u5b9a\u955c\u50cf\u4e0e\u955c\u50cf\u7248\u672c\nimage: \"elasticsearch\"\nimageTag: \"7.17.3\"\n## \u526f\u672c\u6570\nreplicas: 1\n# ============\u8d44\u6e90\u914d\u7f6e============\n## JVM \u914d\u7f6e\u53c2\u6570\nesJavaOpts: \"-Xmx1g -Xms1g\"\n## \u90e8\u7f72\u8d44\u6e90\u914d\u7f6e(\u751f\u6210\u73af\u5883\u4e00\u5b9a\u8981\u8bbe\u7f6e\u5927\u4e9b)\nresources:\nrequests:\ncpu: \"1000m\"\nmemory: \"2Gi\"\nlimits:\ncpu: \"1000m\"\nmemory: \"2Gi\"\n## \u6570\u636e\u6301\u4e45\u5377\u914d\u7f6e\npersistence:\nenabled: false\n# ============\u5b89\u5168\u914d\u7f6e============\n## \u8bbe\u7f6e\u534f\u8bae\uff0c\u53ef\u914d\u7f6e\u4e3a http\u3001https\nprotocol: http\n## \u8bc1\u4e66\u6302\u8f7d\u914d\u7f6e\uff0c\u8fd9\u91cc\u6211\u4eec\u6302\u5165\u4e0a\u9762\u521b\u5efa\u7684\u8bc1\u4e66\nsecretMounts:\n- name: elastic-certs\nsecretName: elastic-certs\npath: /usr/share/elasticsearch/config/certs\n## \u5141\u8bb8\u60a8\u5728/usr/share/elasticsearch/config/\u4e2d\u6dfb\u52a0\u4efb\u4f55\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6,\u4f8b\u5982 elasticsearch.yml\n## ElasticSearch 7.x \u9ed8\u8ba4\u5b89\u88c5\u4e86 x-pack \u63d2\u4ef6\uff0c\u90e8\u5206\u529f\u80fd\u514d\u8d39\uff0c\u8fd9\u91cc\u6211\u4eec\u914d\u7f6e\u4e0b\n## \u4e0b\u9762\u6ce8\u6389\u7684\u90e8\u5206\u4e3a\u914d\u7f6e https \u8bc1\u4e66\uff0c\u914d\u7f6e\u6b64\u90e8\u5206\u8fd8\u9700\u8981\u914d\u7f6e helm \u53c2\u6570 protocol \u503c\u6539\u4e3a https\nesConfig:\nelasticsearch.yml: |\nxpack.security.enabled: true\nxpack.security.transport.ssl.enabled: true\nxpack.security.transport.ssl.verification_mode: certificate\nxpack.security.transport.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\nxpack.security.transport.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n# xpack.security.http.ssl.enabled: true\n# xpack.security.http.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n# xpack.security.http.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\n## \u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff0c\u8fd9\u91cc\u5f15\u5165\u4e0a\u9762\u8bbe\u7f6e\u7684\u7528\u6237\u540d\u3001\u5bc6\u7801 secret \u6587\u4ef6\nextraEnvs:\n- name: ELASTIC_USERNAME\nvalueFrom:\nsecretKeyRef:\nname: elastic-auth\nkey: username\n- name: ELASTIC_PASSWORD\nvalueFrom:\nsecretKeyRef:\nname: elastic-auth\nkey: password\n# ============Service \u914d\u7f6e============\nservice:\ntype: NodePort\nnodePort: \"30200\"\n</code></pre> <p>\u73b0\u5728\u7528\u4e0a\u9762\u7684 values \u6587\u4ef6\u6765\u5b89\u88c5\uff1a</p> <pre><code># \u5b89\u88c5 master \u8282\u70b9\n$ helm upgrade --install es-master -f values-master.yaml --namespace logging .\n# \u5b89\u88c5 data \u8282\u70b9\n$ helm upgrade --install es-data -f values-data.yaml --namespace logging .\n# \u5b89\u88c5 client \u8282\u70b9\n$ helm upgrade --install es-client -f values-client.yaml --namespace logging .\n</code></pre> <p>\u5728\u5b89\u88c5 Master \u8282\u70b9\u540e Pod \u542f\u52a8\u65f6\u5019\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u5c31\u7eea\u63a2\u9488\u63a2\u6d3b\u5931\u8d25\uff0c\u8fd9\u662f\u4e2a\u6b63\u5e38\u73b0\u8c61\u3002\u5728\u6267\u884c\u5b89\u88c5 Data \u8282\u70b9\u540e Master \u8282\u70b9 Pod \u5c31\u4f1a\u6062\u590d\u6b63\u5e38\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#213-\u5b89\u88c5-kibana","title":"2.1.3 \u5b89\u88c5 Kibana","text":"<p>Elasticsearch \u96c6\u7fa4\u5b89\u88c5\u5b8c\u6210\u540e\u63a5\u4e0b\u6765\u914d\u7f6e\u5b89\u88c5 Kibana</p> <p>\u4f7f\u7528 helm pull \u547d\u4ee4\u62c9\u53d6 Kibana Chart \u5305\u5e76\u89e3\u538b\uff1a</p> <pre><code>$ helm pull elastic/kibana --untar --version 7.17.3\n$ cd kibana\n</code></pre> <p>\u521b\u5efa\u7528\u4e8e\u5b89\u88c5 Kibana \u7684 values \u6587\u4ef6\uff1a <code>values-prod.yaml</code></p> <pre><code># values-prod.yaml\n## \u6307\u5b9a\u955c\u50cf\u4e0e\u955c\u50cf\u7248\u672c\nimage: \"kibana\"\nimageTag: \"7.17.3\"\n## \u914d\u7f6e ElasticSearch \u5730\u5740\nelasticsearchHosts: \"http://elasticsearch-client:9200\"\n# ============\u73af\u5883\u53d8\u91cf\u914d\u7f6e============\n## \u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff0c\u8fd9\u91cc\u5f15\u5165\u4e0a\u9762\u8bbe\u7f6e\u7684\u7528\u6237\u540d\u3001\u5bc6\u7801 secret \u6587\u4ef6\nextraEnvs:\n- name: \"ELASTICSEARCH_USERNAME\"\nvalueFrom:\nsecretKeyRef:\nname: elastic-auth\nkey: username\n- name: \"ELASTICSEARCH_PASSWORD\"\nvalueFrom:\nsecretKeyRef:\nname: elastic-auth\nkey: password\n# ============\u8d44\u6e90\u914d\u7f6e============\nresources:\nrequests:\ncpu: \"500m\"\nmemory: \"1Gi\"\nlimits:\ncpu: \"500m\"\nmemory: \"1Gi\"\n# ============\u914d\u7f6e Kibana \u53c2\u6570============\n## kibana \u914d\u7f6e\u4e2d\u6dfb\u52a0\u8bed\u8a00\u914d\u7f6e\uff0c\u8bbe\u7f6e kibana \u4e3a\u4e2d\u6587\nkibanaConfig:\nkibana.yml: |\ni18n.locale: \"zh-CN\"\n# ============Service \u914d\u7f6e============\nservice:\ntype: NodePort\nnodePort: \"30601\"\n</code></pre> <p>\u4f7f\u7528\u4e0a\u9762\u7684\u914d\u7f6e\u76f4\u63a5\u5b89\u88c5\u5373\u53ef\uff1a</p> <pre><code>$ helm install kibana -f values-prod.yaml --namespace logging .\n</code></pre> <p>\u4e0b\u9762\u662f\u5b89\u88c5\u5b8c\u6210\u540e\u7684 ES \u96c6\u7fa4\u548c Kibana \u8d44\u6e90\uff1a</p> <pre><code>$ kubectl get pods -n logging\nNAME                            READY   STATUS    RESTARTS   AGE\nelasticsearch-client-0          1/1     Running   0          12m\nelasticsearch-data-0            1/1     Running   0          12m\nelasticsearch-data-1            1/1     Running   0          12m\nelasticsearch-data-2            1/1     Running   0          12m\nelasticsearch-master-0          1/1     Running   0          13m\nelasticsearch-master-1          1/1     Running   0          13m\nelasticsearch-master-2          1/1     Running   0          13m\nkibana-kibana-f76c9758d-9ndrn   1/1     Running   0          5m34s\n\n$ kubectl get svc -n logging\nNAME                            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                         AGE\nelasticsearch-client            NodePort    172.16.131.20    &lt;none&gt;        9200:30200/TCP,9300:31868/TCP   10m\nelasticsearch-client-headless   ClusterIP   None             &lt;none&gt;        9200/TCP,9300/TCP               10m\nelasticsearch-data              ClusterIP   172.16.180.25    &lt;none&gt;        9200/TCP,9300/TCP               10m\nelasticsearch-data-headless     ClusterIP   None             &lt;none&gt;        9200/TCP,9300/TCP               10m\nelasticsearch-master            ClusterIP   172.16.182.14    &lt;none&gt;        9200/TCP,9300/TCP               10m\nelasticsearch-master-headless   ClusterIP   None             &lt;none&gt;        9200/TCP,9300/TCP               10m\nkibana-kibana                   NodePort    172.16.244.211   &lt;none&gt;        5601:30601/TCP                  2m4s\n</code></pre> <p>\u4e0a\u9762\u6211\u4eec\u5b89\u88c5 Kibana \u7684\u65f6\u5019\u6307\u5b9a\u4e86 30601 \u7684 NodePort \u7aef\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4ece\u4efb\u610f\u8282\u70b9 http://IP:30601 \u6765\u8bbf\u95ee Kibana\u3002</p> <p> \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4f1a\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762\uff0c\u8ba9\u6211\u4eec\u8f93\u51fa\u7528\u6237\u540d\u3001\u5bc6\u7801\uff0c\u8fd9\u91cc\u6211\u4eec\u8f93\u5165\u4e0a\u9762\u914d\u7f6e\u7684\u7528\u6237\u540d elastic\u3001\u5bc6\u7801 oschina\u8fdb\u884c\u767b\u5f55\u3002</p> <p>\u767b\u5f55\u6210\u529f\u540e\u70b9\u51fb\u81ea\u5df1\u6d4f\u89c8\uff0c\u8fdb\u5165\u5982\u4e0b\u6240\u793a\u7684 Kibana \u4e3b\u9875\uff1a </p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#22-\u90e8\u7f72-fluentd","title":"2.2 \u90e8\u7f72 Fluentd","text":"<p>Fluentd \u662f\u4e00\u4e2a\u9ad8\u6548\u7684\u65e5\u5fd7\u805a\u5408\u5668\uff0c\u662f\u7528 Ruby \u7f16\u5199\u7684\uff0c\u5e76\u4e14\u53ef\u4ee5\u5f88\u597d\u5730\u6269\u5c55\u3002 \u5bf9\u4e8e\u5927\u90e8\u5206\u4f01\u4e1a\u6765\u8bf4\uff0cFluentd \u8db3\u591f\u9ad8\u6548\u5e76\u4e14\u6d88\u8017\u7684\u8d44\u6e90\u76f8\u5bf9\u8f83\u5c11\uff0c\u53e6\u5916\u4e00\u4e2a\u5de5\u5177 Fluent-bit \u66f4\u8f7b\u91cf\u7ea7\uff0c\u5360\u7528\u8d44\u6e90\u66f4\u5c11\uff0c \u4f46\u662f\u63d2\u4ef6\u76f8\u5bf9 Fluentd \u6765\u8bf4\u4e0d\u591f\u4e30\u5bcc\uff0c\u6240\u4ee5\u6574\u4f53\u6765\u8bf4\uff0cFluentd \u66f4\u52a0\u6210\u719f\uff0c\u4f7f\u7528\u66f4\u52a0\u5e7f\u6cdb\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 Fluentd \u6765\u4f5c\u4e3a\u65e5\u5fd7\u6536\u96c6\u5de5\u5177\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#221-\u5de5\u4f5c\u539f\u7406","title":"2.2.1 \u5de5\u4f5c\u539f\u7406","text":"<p>Fluentd \u901a\u8fc7\u4e00\u7ec4\u7ed9\u5b9a\u7684\u6570\u636e\u6e90\u6293\u53d6\u65e5\u5fd7\u6570\u636e\uff0c\u5904\u7406\u540e\uff08\u8f6c\u6362\u6210\u7ed3\u6784\u5316\u7684\u6570\u636e\u683c\u5f0f\uff09\u5c06\u5b83\u4eec\u8f6c\u53d1\u7ed9\u5176\u4ed6\u670d\u52a1\uff0c\u6bd4\u5982 Elasticsearch\u3001\u5bf9\u8c61\u5b58\u50a8\u7b49\u7b49\u3002Fluentd \u652f\u6301\u8d85\u8fc7 300 \u4e2a\u65e5\u5fd7\u5b58\u50a8\u548c\u5206\u6790\u670d\u52a1\uff0c\u6240\u4ee5\u5728\u8fd9\u65b9\u9762\u662f\u975e\u5e38\u7075\u6d3b\u7684\u3002\u4e3b\u8981\u8fd0\u884c\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u9996\u5148 Fluentd \u4ece\u591a\u4e2a\u65e5\u5fd7\u6e90\u83b7\u53d6\u6570\u636e </li> <li>\u7ed3\u6784\u5316\u5e76\u4e14\u6807\u8bb0\u8fd9\u4e9b\u6570\u636e </li> <li>\u7136\u540e\u6839\u636e\u5339\u914d\u7684\u6807\u7b7e\u5c06\u6570\u636e\u53d1\u9001\u5230\u591a\u4e2a\u76ee\u6807\u670d\u52a1\u53bb</li> </ul> <p></p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#222-\u914d\u7f6e","title":"2.2.2 \u914d\u7f6e","text":"<p>\u4e00\u822c\u6765\u8bf4\u6211\u4eec\u662f\u901a\u8fc7\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u6765\u544a\u8bc9 Fluentd \u5982\u4f55\u91c7\u96c6\u3001\u5904\u7406\u6570\u636e\u7684\uff0c\u4e0b\u9762\u7b80\u5355\u548c\u5927\u5bb6\u4ecb\u7ecd\u4e0b Fluentd \u7684\u914d\u7f6e\u65b9\u6cd5\u3002</p> <p>\u65e5\u5fd7\u6e90\u914d\u7f6e \u6bd4\u5982\u6211\u4eec\u8fd9\u91cc\u4e3a\u4e86\u6536\u96c6 Kubernetes \u8282\u70b9\u4e0a\u7684\u6240\u6709\u5bb9\u5668\u65e5\u5fd7\uff0c\u5c31\u9700\u8981\u505a\u5982\u4e0b\u7684\u65e5\u5fd7\u6e90\u914d\u7f6e\uff1a <pre><code>&lt;source&gt;\n@id fluentd-containers.log\n@type tail                             # Fluentd \u5185\u7f6e\u7684\u8f93\u5165\u65b9\u5f0f\uff0c\u5176\u539f\u7406\u662f\u4e0d\u505c\u5730\u4ece\u6e90\u6587\u4ef6\u4e2d\u83b7\u53d6\u65b0\u7684\u65e5\u5fd7\u3002\npath /var/log/containers/*.log         # \u6302\u8f7d\u7684\u5bbf\u4e3b\u673a\u5bb9\u5668\u65e5\u5fd7\u5730\u5740\npos_file /var/log/es-containers.log.pos\ntag raw.kubernetes.*                   # \u8bbe\u7f6e\u65e5\u5fd7\u6807\u7b7e\nread_from_head true\n&lt;parse&gt;                                # \u591a\u884c\u683c\u5f0f\u5316\u6210JSON\n@type multi_format                   # \u4f7f\u7528 multi-format-parser \u89e3\u6790\u5668\u63d2\u4ef6\n&lt;pattern&gt;\nformat json                        # JSON \u89e3\u6790\u5668\ntime_key time                      # \u6307\u5b9a\u4e8b\u4ef6\u65f6\u95f4\u7684\u65f6\u95f4\u5b57\u6bb5\ntime_format %Y-%m-%dT%H:%M:%S.%NZ  # \u65f6\u95f4\u683c\u5f0f\n&lt;/pattern&gt;\n&lt;pattern&gt;\nformat /^(?&lt;time&gt;.+) (?&lt;stream&gt;stdout|stderr) [^ ]* (?&lt;log&gt;.*)$/\ntime_format %Y-%m-%dT%H:%M:%S.%N%:z\n&lt;/pattern&gt;\n&lt;/parse&gt;\n&lt;/source&gt;\n</code></pre></p> <p>\u4e0a\u9762\u914d\u7f6e\u90e8\u5206\u53c2\u6570\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ul> <li>id\uff1a\u8868\u793a\u5f15\u7528\u8be5\u65e5\u5fd7\u6e90\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u8be5\u6807\u8bc6\u53ef\u7528\u4e8e\u8fdb\u4e00\u6b65\u8fc7\u6ee4\u548c\u8def\u7531\u7ed3\u6784\u5316\u65e5\u5fd7\u6570\u636e </li> <li>type\uff1aFluentd \u5185\u7f6e\u7684\u6307\u4ee4\uff0ctail \u8868\u793a Fluentd \u4ece\u4e0a\u6b21\u8bfb\u53d6\u7684\u4f4d\u7f6e\u901a\u8fc7 tail \u4e0d\u65ad\u83b7\u53d6\u6570\u636e\uff0c\u53e6\u5916\u4e00\u4e2a\u662f http \u8868\u793a\u901a\u8fc7\u4e00\u4e2a GET \u8bf7\u6c42\u6765\u6536\u96c6\u6570\u636e\u3002 </li> <li>path\uff1atail \u7c7b\u578b\u4e0b\u7684\u7279\u5b9a\u53c2\u6570\uff0c\u544a\u8bc9 Fluentd \u91c7\u96c6 /var/log/containers \u76ee\u5f55\u4e0b\u7684\u6240\u6709\u65e5\u5fd7\uff0c\u8fd9\u662f docker \u5728 Kubernetes \u8282\u70b9\u4e0a\u7528\u6765\u5b58\u50a8\u8fd0\u884c\u5bb9\u5668 stdout \u8f93\u51fa\u65e5\u5fd7\u6570\u636e\u7684\u76ee\u5f55\u3002 </li> <li>pos_file\uff1a\u68c0\u67e5\u70b9\uff0c\u5982\u679c Fluentd \u7a0b\u5e8f\u91cd\u65b0\u542f\u52a8\u4e86\uff0c\u5b83\u5c06\u4f7f\u7528\u6b64\u6587\u4ef6\u4e2d\u7684\u4f4d\u7f6e\u6765\u6062\u590d\u65e5\u5fd7\u6570\u636e\u6536\u96c6\u3002 </li> <li>tag\uff1a\u7528\u6765\u5c06\u65e5\u5fd7\u6e90\u4e0e\u76ee\u6807\u6216\u8005\u8fc7\u6ee4\u5668\u5339\u914d\u7684\u81ea\u5b9a\u4e49\u5b57\u7b26\u4e32\uff0cFluentd \u5339\u914d\u6e90/\u76ee\u6807\u6807\u7b7e\u6765\u8def\u7531\u65e5\u5fd7\u6570\u636e\u3002</li> </ul> <p>\u8def\u7531\u914d\u7f6e</p> <p>\u4e0a\u9762\u662f\u65e5\u5fd7\u6e90\u7684\u914d\u7f6e\uff0c\u63a5\u4e0b\u6765\u770b\u770b\u5982\u4f55\u5c06\u65e5\u5fd7\u6570\u636e\u53d1\u9001\u5230 Elasticsearch\uff1a</p> <pre><code>&lt;match **&gt;\n@id elasticsearch\n@type elasticsearch\n@log_level info\ninclude_tag_key true\ntype_name fluentd\nhost \"#{ENV['OUTPUT_HOST']}\"\nport \"#{ENV['OUTPUT_PORT']}\"\nlogstash_format true\n&lt;buffer&gt;\n@type file\npath /var/log/fluentd-buffers/kubernetes.system.buffer\nflush_mode interval\nretry_type exponential_backoff\nflush_thread_count 2\nflush_interval 5s\nretry_forever\nretry_max_interval 30\nchunk_limit_size \"#{ENV['OUTPUT_BUFFER_CHUNK_LIMIT']}\"\nqueue_limit_length \"#{ENV['OUTPUT_BUFFER_QUEUE_LIMIT']}\"\noverflow_action block\n&lt;/buffer&gt;\n&lt;/match&gt;\n</code></pre> <ul> <li>match\uff1a\u6807\u8bc6\u4e00\u4e2a\u76ee\u6807\u6807\u7b7e\uff0c\u540e\u9762\u662f\u4e00\u4e2a\u5339\u914d\u65e5\u5fd7\u6e90\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u6211\u4eec\u8fd9\u91cc\u60f3\u8981\u6355\u83b7\u6240\u6709\u7684\u65e5\u5fd7\u5e76\u5c06\u5b83\u4eec\u53d1\u9001\u7ed9 Elasticsearch\uff0c\u6240\u4ee5\u9700\u8981\u914d\u7f6e\u6210**\u3002 </li> <li>id\uff1a\u76ee\u6807\u7684\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6\u7b26\u3002 </li> <li>type\uff1a\u652f\u6301\u7684\u8f93\u51fa\u63d2\u4ef6\u6807\u8bc6\u7b26\uff0c\u6211\u4eec\u8fd9\u91cc\u8981\u8f93\u51fa\u5230 Elasticsearch\uff0c\u6240\u4ee5\u914d\u7f6e\u6210 elasticsearch\uff0c\u8fd9\u662f Fluentd \u7684\u4e00\u4e2a\u5185\u7f6e\u63d2\u4ef6\u3002 </li> <li>log_level\uff1a\u6307\u5b9a\u8981\u6355\u83b7\u7684\u65e5\u5fd7\u7ea7\u522b\uff0c\u6211\u4eec\u8fd9\u91cc\u914d\u7f6e\u6210 info\uff0c\u8868\u793a\u4efb\u4f55\u8be5\u7ea7\u522b\u6216\u8005\u8be5\u7ea7\u522b\u4ee5\u4e0a\uff08INFO\u3001WARNING\u3001ERROR\uff09\u7684\u65e5\u5fd7\u90fd\u5c06\u88ab\u8def\u7531\u5230 Elsasticsearch\u3002 </li> <li>host/port\uff1a\u5b9a\u4e49 Elasticsearch \u7684\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u914d\u7f6e\u8ba4\u8bc1\u4fe1\u606f\uff0c\u6211\u4eec\u7684 Elasticsearch \u4e0d\u9700\u8981\u8ba4\u8bc1\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u6307\u5b9a host \u548c port \u5373\u53ef\u3002 </li> <li>logstash_format\uff1aElasticsearch \u670d\u52a1\u5bf9\u65e5\u5fd7\u6570\u636e\u6784\u5efa\u53cd\u5411\u7d22\u5f15\u8fdb\u884c\u641c\u7d22\uff0c\u5c06 logstash_format \u8bbe\u7f6e\u4e3a true\uff0cFluentd \u5c06\u4f1a\u4ee5 logstash \u683c\u5f0f\u6765\u8f6c\u53d1\u7ed3\u6784\u5316\u7684\u65e5\u5fd7\u6570\u636e\u3002 </li> <li>Buffer\uff1a Fluentd \u5141\u8bb8\u5728\u76ee\u6807\u4e0d\u53ef\u7528\u65f6\u8fdb\u884c\u7f13\u5b58\uff0c\u6bd4\u5982\uff0c\u5982\u679c\u7f51\u7edc\u51fa\u73b0\u6545\u969c\u6216\u8005 Elasticsearch \u4e0d\u53ef\u7528\u7684\u65f6\u5019\u3002\u7f13\u51b2\u533a\u914d\u7f6e\u4e5f\u6709\u52a9\u4e8e\u964d\u4f4e\u78c1\u76d8\u7684 IO\u3002</li> </ul> <p>\u8fc7\u6ee4 \u7531\u4e8e Kubernetes \u96c6\u7fa4\u4e2d\u5e94\u7528\u592a\u591a\uff0c\u4e5f\u8fd8\u6709\u5f88\u591a\u5386\u53f2\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u53ea\u5c06\u67d0\u4e9b\u5e94\u7528\u7684\u65e5\u5fd7\u8fdb\u884c\u6536\u96c6\uff0c\u6bd4\u5982\u6211\u4eec\u53ea\u91c7\u96c6\u5177\u6709 logging=true \u8fd9\u4e2a Label \u6807\u7b7e\u7684 Pod \u65e5\u5fd7\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528 filter\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code># \u5220\u9664\u65e0\u7528\u7684\u5c5e\u6027\n&lt;filter kubernetes.**&gt;\n@type record_transformer\nremove_keys $.docker.container_id,$.kubernetes.container_image_id,$.kubernetes.pod_id,$.kubernetes.namespace_id,$.kubernetes.master_url,$.kubernetes.labels.pod-template-hash\n&lt;/filter&gt;\n# \u53ea\u4fdd\u7559\u5177\u6709logging=true\u6807\u7b7e\u7684Pod\u65e5\u5fd7\n&lt;filter kubernetes.**&gt;\n@id filter_log\n@type grep\n&lt;regexp&gt;\nkey $.kubernetes.labels.logging\npattern ^true$\n&lt;/regexp&gt;\n&lt;/filter&gt;\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#223-\u5b89\u88c5","title":"2.2.3 \u5b89\u88c5","text":"<p>\u8981\u6536\u96c6 Kubernetes \u96c6\u7fa4\u7684\u65e5\u5fd7\uff0c\u76f4\u63a5\u7528 DasemonSet \u63a7\u5236\u5668\u6765\u90e8\u7f72 Fluentd \u5e94\u7528\uff0c\u8fd9\u6837\uff0c\u5b83\u5c31\u53ef\u4ee5\u4ece Kubernetes \u8282\u70b9\u4e0a\u91c7\u96c6\u65e5\u5fd7\uff0c\u786e\u4fdd\u5728\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u59cb\u7ec8\u8fd0\u884c\u4e00\u4e2a Fluentd \u5bb9\u5668\u3002 \u5f53\u7136\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Helm \u6765\u8fdb\u884c\u4e00\u952e\u5b89\u88c5\uff0c\u4e3a\u4e86\u80fd\u591f\u4e86\u89e3\u66f4\u591a\u5b9e\u73b0\u7ec6\u8282\uff0c\u6211\u4eec\u8fd9\u91cc\u8fd8\u662f\u91c7\u7528\u624b\u52a8\u65b9\u6cd5\u6765\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5b98\u65b9\u7684\u5bf9\u4e8e Kubernetes \u96c6\u7fa4\u7684\u5b89\u88c5\u6587\u6863: https://docs.fluentd.org/container-deployment/kubernetes\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u901a\u8fc7 ConfigMap \u5bf9\u8c61\u6765\u6307\u5b9a Fluentd \u914d\u7f6e\u6587\u4ef6\uff0c\u65b0\u5efa fluentd-configmap.yaml \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a <code>fluentd-configmap.yaml</code></p> <pre><code>kind: ConfigMap\napiVersion: v1\nmetadata:\nname: fluentd-conf\nnamespace: logging\ndata:\n# \u5bb9\u5668\u65e5\u5fd7\ncontainers.input.conf: |-\n&lt;source&gt;\n@id fluentd-containers.log\n@type tail\npath /var/log/containers/*.log\npos_file /var/log/es-containers.log.pos\ntag raw.kubernetes.*\nread_from_head true\n&lt;parse&gt;\n@type multi_format\n&lt;pattern&gt;\nformat json\ntime_key time\ntime_format %Y-%m-%dT%H:%M:%S.%NZ\n&lt;/pattern&gt;\n&lt;pattern&gt;\nformat /^(?&lt;time&gt;.+) (?&lt;stream&gt;stdout|stderr) [^ ]* (?&lt;log&gt;.*)$/\ntime_format %Y-%m-%dT%H:%M:%S.%N%:z\n&lt;/pattern&gt;\n&lt;/parse&gt;\n&lt;/source&gt;\n# \u5728\u65e5\u5fd7\u8f93\u51fa\u4e2d\u68c0\u6d4b\u5f02\u5e38(\u591a\u884c\u65e5\u5fd7)\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u4e00\u6761\u65e5\u5fd7\u8f6c\u53d1\n# https://github.com/GoogleCloudPlatform/fluent-plugin-detect-exceptions\n&lt;match raw.kubernetes.**&gt;\n@id raw.kubernetes\n@type detect_exceptions\nremove_tag_prefix raw\nmessage log\nmultiline_flush_interval 5\n&lt;/match&gt;\n&lt;filter **&gt;\n@id filter_concat\n@type concat\nkey message\nmultiline_end_regexp /\\n$/\nseparator \"\"\n&lt;/filter&gt;\n# \u6dfb\u52a0 Kubernetes metadata \u6570\u636e\n&lt;filter kubernetes.**&gt;\n@id filter_kubernetes_metadata\n@type kubernetes_metadata\n&lt;/filter&gt;\n# \u4fee\u590d ES \u4e2d\u7684 JSON \u5b57\u6bb5\n# \u63d2\u4ef6\u5730\u5740\uff1ahttps://github.com/repeatedly/fluent-plugin-multi-format-parser\n&lt;filter kubernetes.**&gt;\n@id filter_parser\n@type parser\nkey_name log\nreserve_data true\nremove_key_name_field true\n&lt;parse&gt;\n@type multi_format\n&lt;pattern&gt;\nformat json\n&lt;/pattern&gt;\n&lt;pattern&gt;\nformat none\n&lt;/pattern&gt;\n&lt;/parse&gt;\n&lt;/filter&gt;\n# \u5220\u9664\u4e00\u4e9b\u591a\u4f59\u7684\u5c5e\u6027\n&lt;filter kubernetes.**&gt;\n@type record_transformer\nremove_keys $.docker.container_id,$.kubernetes.container_image_id,$.kubernetes.pod_id,$.kubernetes.namespace_id,$.kubernetes.master_url,$.kubernetes.labels.pod-template-hash\n&lt;/filter&gt;\n##   \u6211\u6ce8\u91ca\u6389\u8fd9\u91cc\u7684\u7528\u610f\u5c31\u662f\u6240\u6709pod\u7684\u65e5\u5fd7\u90fd\u8fdb\u884c\u91c7\u96c6\n#    ##\u53ea\u4fdd\u7559\u5177\u6709logging=true\u6807\u7b7e\u7684Pod\u65e5\u5fd7\n#    &lt;filter kubernetes.**&gt;\n#      @id filter_log\n#      @type grep\n#      &lt;regexp&gt;\n#        key $.kubernetes.labels.logging\n#        pattern ^true$\n#      &lt;/regexp&gt;\n#    &lt;/filter&gt;\n###### \u76d1\u542c\u914d\u7f6e\uff0c\u4e00\u822c\u7528\u4e8e\u65e5\u5fd7\u805a\u5408\u7528 ######\nforward.input.conf: |-\n# \u76d1\u542c\u901a\u8fc7TCP\u53d1\u9001\u7684\u6d88\u606f\n&lt;source&gt;\n@id forward\n@type forward\n&lt;/source&gt;\noutput.conf: |-\n&lt;match **&gt;\n@id elasticsearch\n@type elasticsearch\n@log_level info\ninclude_tag_key true\nhost elasticsearch-client\nport 9200\nuser elastic\npassword oschina\nlogstash_format true\nlogstash_prefix k8s\nrequest_timeout 30s\n&lt;buffer&gt;\n@type file\npath /var/log/fluentd-buffers/kubernetes.system.buffer\nflush_mode interval\nretry_type exponential_backoff\nflush_thread_count 2\nflush_interval 5s\nretry_forever\nretry_max_interval 30\nchunk_limit_size 2M\nqueue_limit_length 8\noverflow_action block\n&lt;/buffer&gt;\n&lt;/match&gt;\n</code></pre> <p>\u4e0a\u9762\u914d\u7f6e\u6587\u4ef6\u4e2d\u6211\u4eec\u53ea\u914d\u7f6e\u4e86 docker \u5bb9\u5668\u65e5\u5fd7\u76ee\u5f55\uff0c\u6536\u96c6\u5230\u6570\u636e\u7ecf\u8fc7\u5904\u7406\u540e\u53d1\u9001\u5230 elasticsearch-client:9200 \u670d\u52a1\u3002</p> <p>\u7136\u540e\u65b0\u5efa\u4e00\u4e2a <code>fluentd-daemonset.yaml</code> \u7684\u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\nname: fluentd-es\nnamespace: logging\nlabels:\nk8s-app: fluentd-es\nkubernetes.io/cluster-service: \"true\"\naddonmanager.kubernetes.io/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: fluentd-es\nlabels:\nk8s-app: fluentd-es\nkubernetes.io/cluster-service: \"true\"\naddonmanager.kubernetes.io/mode: Reconcile\nrules:\n- apiGroups:\n- \"\"\nresources:\n- \"namespaces\"\n- \"pods\"\nverbs:\n- \"get\"\n- \"watch\"\n- \"list\"\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: fluentd-es\nlabels:\nk8s-app: fluentd-es\nkubernetes.io/cluster-service: \"true\"\naddonmanager.kubernetes.io/mode: Reconcile\nsubjects:\n- kind: ServiceAccount\nname: fluentd-es\nnamespace: logging\napiGroup: \"\"\nroleRef:\nkind: ClusterRole\nname: fluentd-es\napiGroup: \"\"\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\nname: fluentd\nnamespace: logging\nlabels:\napp: fluentd\nkubernetes.io/cluster-service: \"true\"\nspec:\nselector:\nmatchLabels:\napp: fluentd\ntemplate:\nmetadata:\nlabels:\napp: fluentd\nkubernetes.io/cluster-service: \"true\"\nspec:\ntolerations:\n- key: node-role.kubernetes.io/master\neffect: NoSchedule\nserviceAccountName: fluentd-es\ncontainers:\n- name: fluentd\nimage: quay.io/fluentd_elasticsearch/fluentd:v3.4.0\nvolumeMounts:\n- name: fluentconfig\nmountPath: /etc/fluent/config.d\n- name: varlog\nmountPath: /var/log\nnodeSelector:\nbeta.kubernetes.io/fluentd-ds-ready: \"true\"\nterminationGracePeriodSeconds: 30\nvolumes:\n- name: fluentconfig\nconfigMap:\nname: fluentd-conf\n- name: varlog\nhostPath:\npath: /var/log\n</code></pre> <p>\u6211\u4eec\u5c06\u4e0a\u9762\u521b\u5efa\u7684 fluentd-config \u8fd9\u4e2a ConfigMap \u5bf9\u8c61\u901a\u8fc7 volumes \u6302\u8f7d\u5230\u4e86 Fluentd \u5bb9\u5668\u4e2d\uff0c\u53e6\u5916\u4e3a\u4e86\u80fd\u591f\u7075\u6d3b\u63a7\u5236\u54ea\u4e9b\u8282\u70b9\u7684\u65e5\u5fd7\u53ef\u4ee5\u88ab\u6536\u96c6\uff0c\u8fd8\u53ef\u4ee5\u6dfb\u52a0\u4e86\u4e00\u4e2a nodSelector \u5c5e\u6027\uff1a</p> <p><pre><code>nodeSelector:\nbeta.kubernetes.io/fluentd-ds-ready: \"true\"\n</code></pre> \u610f\u601d\u5c31\u662f\u8981\u60f3\u91c7\u96c6\u8282\u70b9\u7684\u65e5\u5fd7\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u9700\u8981\u7ed9\u8282\u70b9\u6253\u4e0a\u4e0a\u9762\u7684\u6807\u7b7e\u3002</p> <p>\u63d0\u793a</p> <p>\u5982\u679c\u4f60\u9700\u8981\u5728\u5176\u4ed6\u8282\u70b9\u4e0a\u91c7\u96c6\u65e5\u5fd7\uff0c\u5219\u9700\u8981\u7ed9\u5bf9\u5e94\u8282\u70b9\u6253\u4e0a\u6807\u7b7e\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1akubectl label nodes node\u540d beta.kubernetes.io/fluentd-ds-ready=true\u3002</p> <pre><code>$ kubectl label nodes giteego-k8s-n1 beta.kubernetes.io/fluentd-ds-ready=true\n$ kubectl label nodes giteego-k8s-n2 beta.kubernetes.io/fluentd-ds-ready=true\n$ kubectl label nodes giteego-k8s-n3 beta.kubernetes.io/fluentd-ds-ready=true\n$ kubectl label nodes giteego-k8s-n4 beta.kubernetes.io/fluentd-ds-ready=true\n</code></pre> <p>\u53e6\u5916\u7531\u4e8e\u6211\u4eec\u7684\u96c6\u7fa4\u4f7f\u7528\u7684\u662f kubeadm \u642d\u5efa\u7684\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b master \u8282\u70b9\u6709\u6c61\u70b9\uff0c\u6240\u4ee5\u5982\u679c\u8981\u60f3\u4e5f\u6536\u96c6 master \u8282\u70b9\u7684\u65e5\u5fd7\uff0c\u5219\u9700\u8981\u6dfb\u52a0\u4e0a\u5bb9\u5fcd\uff1a</p> <pre><code>tolerations:\n- operator: Exists\n</code></pre> <p>\u6ce8\u610f</p> <p>\u53e6\u5916\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u662f\uff0c\u5982\u679c\u66f4\u6539\u4e86 docker \u7684\u6839\u76ee\u5f55\uff0c\u5219\u5728 volumes \u548c volumeMount \u91cc\u9762\u90fd\u9700\u8981\u66f4\u6539\uff0c\u4fdd\u6301\u4e00\u81f4</p> <p>\u4e3e\u4f8b</p> <pre><code>  containers:\n- name: fluentd\nimage: quay.io/fluentd_elasticsearch/fluentd:v3.4.0\nvolumeMounts:\n- name: fluentconfig\nmountPath: /etc/fluent/config.d\n- name: varlog\nmountPath: /var/log\n- name: varlibdockercontainers\nmountPath: /home/cce/docker/containers\nreadOnly: true\nnodeSelector:\nbeta.kubernetes.io/fluentd-ds-ready: \"true\"\nterminationGracePeriodSeconds: 30\nvolumes:\n- name: fluentconfig\nconfigMap:\nname: fluentd-conf\n- name: varlog\nhostPath:\npath: /var/log\n- name: varlibdockercontainers\nhostPath:\npath: /home/cce/docker/containers\n</code></pre> <p>\u5206\u522b\u521b\u5efa\u4e0a\u9762\u7684 ConfigMap \u5bf9\u8c61\u548c DaemonSet\uff1a</p> <pre><code>$ kubectl create -f fluentd-configmap.yaml\nconfigmap \"fluentd-conf\" created\n$ kubectl create -f fluentd-daemonset.yaml\nserviceaccount \"fluentd-es\" created\nclusterrole.rbac.authorization.k8s.io \"fluentd-es\" created\nclusterrolebinding.rbac.authorization.k8s.io \"fluentd-es\" created\ndaemonset.apps \"fluentd\" created\n</code></pre> <p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u67e5\u770b\u5bf9\u5e94\u7684 Pods \u5217\u8868\uff0c\u68c0\u67e5\u662f\u5426\u90e8\u7f72\u6210\u529f\uff1a <pre><code>$ kubectl get pod -n logging\nNAME                            READY   STATUS    RESTARTS   AGE\nelasticsearch-client-0          1/1     Running   0          38m\nelasticsearch-data-0            1/1     Running   0          38m\nelasticsearch-data-1            1/1     Running   0          38m\nelasticsearch-data-2            1/1     Running   0          38m\nelasticsearch-master-0          1/1     Running   0          39m\nelasticsearch-master-1          1/1     Running   0          39m\nelasticsearch-master-2          1/1     Running   0          39m\nfluentd-hmg9k                   1/1     Running   0          56s\nfluentd-hpmmh                   1/1     Running   0          56s\nfluentd-j6nws                   1/1     Running   0          56s\nfluentd-v969z                   1/1     Running   0          56s\nkibana-kibana-f76c9758d-9ndrn   1/1     Running   0          31m\n</code></pre> Fluentd \u542f\u52a8\u6210\u529f\u540e\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u53d1\u9001\u65e5\u5fd7\u5230 ES \u4e86\uff0c\u4f46\u662f\u6211\u4eec\u8fd9\u91cc\u662f\u8fc7\u6ee4\u4e86\u53ea\u91c7\u96c6\u5177\u6709 logging=true \u6807\u7b7e\u7684 Pod \u65e5\u5fd7\uff0c\u6240\u4ee5\u73b0\u5728\u8fd8\u6ca1\u6709\u4efb\u4f55\u6570\u636e\u4f1a\u88ab\u91c7\u96c6\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u90e8\u7f72\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u5e94\u7528\uff0c \u65b0\u5efa <code>counter.yaml</code> \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: counter\nlabels:\nlogging: \"true\"\nspec:\ncontainers:\n- name: count\nimage: busybox\nargs:\n[\n/bin/sh,\n-c,\n'i=0; while true; do echo \"$i: $(date)\"; i=$((i+1)); sleep 1; done',\n]\n</code></pre></p> <p>\u8be5 Pod \u53ea\u662f\u7b80\u5355\u5c06\u65e5\u5fd7\u4fe1\u606f\u6253\u5370\u5230 stdout\uff0c\u6240\u4ee5\u6b63\u5e38\u6765\u8bf4 Fluentd \u4f1a\u6536\u96c6\u5230\u8fd9\u4e2a\u65e5\u5fd7\u6570\u636e\uff0c\u5728 Kibana \u4e2d\u4e5f\u5c31\u53ef\u4ee5\u627e\u5230\u5bf9\u5e94\u7684\u65e5\u5fd7\u6570\u636e\u4e86\uff0c\u4f7f\u7528 kubectl \u5de5\u5177\u521b\u5efa\u8be5 Pod\uff1a</p> <pre><code>$ kubectl create -f counter.yaml\n$ kubectl get pods\nNAME                             READY   STATUS    RESTARTS   AGE\ncounter                          1/1     Running   0          9h\n</code></pre> <p>Pod \u521b\u5efa\u5e76\u8fd0\u884c\u540e\uff0c\u56de\u5230 Kibana Dashboard \u9875\u9762\uff0c\u70b9\u51fb\u5de6\u4fa7\u6700\u4e0b\u9762\u7684 Management -&gt; Stack Management\uff0c\u8fdb\u5165\u7ba1\u7406\u9875\u9762\uff0c\u70b9\u51fb\u5de6\u4fa7 Kibana \u4e0b\u9762\u7684 \u7d22\u5f15\u6a21\u5f0f\uff0c\u70b9\u51fb \u521b\u5efa\u7d22\u5f15\u6a21\u5f0f \u5f00\u59cb\u5bfc\u5165\u7d22\u5f15\u6570\u636e\uff1a </p> <p>\u5728\u8fd9\u91cc\u53ef\u4ee5\u914d\u7f6e\u6211\u4eec\u9700\u8981\u7684 Elasticsearch \u7d22\u5f15\uff0c\u524d\u9762 Fluentd \u914d\u7f6e\u6587\u4ef6\u4e2d\u6211\u4eec\u91c7\u96c6\u7684\u65e5\u5fd7\u4f7f\u7528\u7684\u662f logstash \u683c\u5f0f\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a k8s \u7684\u524d\u7f00\uff0c \u6240\u4ee5\u8fd9\u91cc\u53ea\u9700\u8981\u5728\u6587\u672c\u6846\u4e2d\u8f93\u5165 <code>k8s-*</code> \u5373\u53ef\u5339\u914d\u5230 Elasticsearch \u96c6\u7fa4\u4e2d\u91c7\u96c6\u7684 Kubernetes \u96c6\u7fa4\u65e5\u5fd7\u6570\u636e\uff0c\u7136\u540e\u70b9\u51fb\u4e0b\u4e00\u6b65\uff0c\u8fdb\u5165\u4ee5\u4e0b\u9875\u9762\uff1a </p> <p>\u5728\u8be5\u9875\u9762\u4e2d\u914d\u7f6e\u4f7f\u7528\u54ea\u4e2a\u5b57\u6bb5\u6309\u65f6\u95f4\u8fc7\u6ee4\u65e5\u5fd7\u6570\u636e\uff0c\u5728\u4e0b\u62c9\u5217\u8868\u4e2d\uff0c\u9009\u62e9@timestamp\u5b57\u6bb5\uff0c\u7136\u540e\u70b9\u51fb \u521b\u5efa\u7d22\u5f15\u6a21\u5f0f\uff0c\u521b\u5efa\u5b8c\u6210\u540e\uff0c \u70b9\u51fb\u5de6\u4fa7\u5bfc\u822a\u83dc\u5355\u4e2d\u7684 Discover\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u76f4\u65b9\u56fe\u548c\u6700\u8fd1\u91c7\u96c6\u5230\u7684\u65e5\u5fd7\u6570\u636e\u4e86\uff1a</p> <p></p> <p>\u73b0\u5728\u7684\u6570\u636e\u5c31\u662f\u4e0a\u9762 Counter \u5e94\u7528\u7684\u65e5\u5fd7\uff0c\u5982\u679c\u8fd8\u6709\u5176\u4ed6\u7684\u5e94\u7528\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7b5b\u9009\u8fc7\u6ee4\uff1a</p> <p></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u5143\u6570\u636e\u6765\u8fc7\u6ee4\u65e5\u5fd7\u6570\u636e\uff0c\u6bd4\u5982\u60a8\u53ef\u4ee5\u5355\u51fb\u4efb\u4f55\u65e5\u5fd7\u6761\u76ee\u4ee5\u67e5\u770b\u5176\u4ed6\u5143\u6570\u636e\uff0c\u5982\u5bb9\u5668\u540d\u79f0\uff0cKubernetes \u8282\u70b9\uff0c\u547d\u540d\u7a7a\u95f4\u7b49\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#23-\u5b89\u88c5-kafka","title":"2.3 \u5b89\u88c5 Kafka","text":"<p>\u5bf9\u4e8e\u5927\u89c4\u6a21\u96c6\u7fa4\u6765\u8bf4\uff0c\u65e5\u5fd7\u6570\u636e\u91cf\u662f\u975e\u5e38\u5de8\u5927\u7684\uff0c\u5982\u679c\u76f4\u63a5\u901a\u8fc7 Fluentd \u5c06\u65e5\u5fd7\u6253\u5165 Elasticsearch\uff0c\u5bf9 ES \u6765\u8bf4\u538b\u529b\u662f\u975e\u5e38\u5de8\u5927\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e2d\u95f4\u52a0\u4e00\u5c42\u6d88\u606f\u4e2d\u95f4\u4ef6\u6765\u7f13\u89e3 ES \u7684\u538b\u529b\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u6211\u4eec\u4f1a\u4f7f\u7528 Kafka\uff0c\u7136\u540e\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 kafka-connect-elasticsearch \u8fd9\u6837\u7684\u5de5\u5177\u5c06\u6570\u636e\u76f4\u63a5\u6253\u5165 ES\uff0c\u4e5f\u53ef\u4ee5\u5728\u52a0\u4e00\u5c42 Logstash \u53bb\u6d88\u8d39 Kafka \u7684\u6570\u636e\uff0c\u7136\u540e\u901a\u8fc7 Logstash \u628a\u6570\u636e\u5b58\u5165 ES\uff0c\u8fd9\u91cc\u6211\u4eec\u6765\u4f7f\u7528 Logstash \u8fd9\u79cd\u6a21\u5f0f\u6765\u5bf9\u65e5\u5fd7\u6536\u96c6\u8fdb\u884c\u4f18\u5316\u3002</p> <p>\u9996\u5148\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u5b89\u88c5 Kafka\uff0c\u540c\u6837\u8fd9\u91cc\u4f7f\u7528 Helm \u8fdb\u884c\u5b89\u88c5\uff1a <pre><code>$ helm repo add bitnami https://charts.bitnami.com/bitnami\n$ helm repo update\n</code></pre> \u9996\u5148\u4f7f\u7528 helm pull \u62c9\u53d6 Chart \u5e76\u89e3\u538b\uff1a</p> <pre><code>$ helm pull bitnami/kafka --untar --version 17.2.3\n$ cd kafka\n</code></pre> <p>\u8fd9\u91cc\u9762\u6211\u4eec\u6307\u5b9a\u4f7f\u7528\u4e00\u4e2a StorageClass \u6765\u63d0\u4f9b\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u5728 Chart \u76ee\u5f55\u4e0b\u9762\u521b\u5efa\u7528\u4e8e\u5b89\u88c5\u7684 values \u6587\u4ef6\uff1a <code>values-prod.yaml</code></p> <p><pre><code># values-prod.yaml\n## @section Persistence parameters\npersistence:\nenabled: true\nstorageClass: \"efk-nfs\"\naccessModes:\n- ReadWriteOnce\nsize: 8Gi\nmountPath: /bitnami/kafka\n# \u914d\u7f6ezk volumes\nzookeeper:\nenabled: true\npersistence:\nenabled: true\nstorageClass: \"efk-nfs\"\naccessModes:\n- ReadWriteOnce\nsize: 8Gi\n</code></pre> \u76f4\u63a5\u4f7f\u7528\u4e0a\u9762\u7684 values \u6587\u4ef6\u5b89\u88c5 kafka\uff1a <pre><code>$ helm upgrade --install kafka -f values-prod.yaml --namespace logging .\nRelease \"kafka\" does not exist. Installing it now.\nNAME: kafka\nLAST DEPLOYED: Thu Jun  9 14:02:01 2022\nNAMESPACE: logging\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nCHART NAME: kafka\nCHART VERSION: 17.2.3\nAPP VERSION: 3.2.0\n\n** Please be patient while the chart is being deployed **\n\nKafka can be accessed by consumers via port 9092 on the following DNS name from within your cluster:\n\nkafka.logging.svc.cluster.local\n\nEach Kafka broker can be accessed by producers via port 9092 on the following DNS name(s) from within your cluster:\n\nkafka-0.kafka-headless.logging.svc.cluster.local:9092\n\nTo create a pod that you can use as a Kafka client run the following commands:\n\nkubectl run kafka-client --restart='Never' --image docker.io/bitnami/kafka:3.2.0-debian-10-r4 --namespace logging --command -- sleep infinity\n    kubectl exec --tty -i kafka-client --namespace logging -- bash\n\nPRODUCER:\n        kafka-console-producer.sh \\\n--broker-list kafka-0.kafka-headless.logging.svc.cluster.local:9092 \\\n--topic test\nCONSUMER:\n        kafka-console-consumer.sh \\\n--bootstrap-server kafka.logging.svc.cluster.local:9092 \\\n--topic test \\\n--from-beginning\n</code></pre></p> <p>\u5b89\u88c5\u5b8c\u6210\u540e\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u63d0\u793a\u6765\u68c0\u67e5 Kafka \u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff1a</p> <pre><code>$ kubectl get pods -n logging -l app.kubernetes.io/instance=kafka\nkafka-0             1/1     Running   0          7m58s\nkafka-zookeeper-0   1/1     Running   0          7m58s\n</code></pre> <p>\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u4e00\u4e2a Kafka \u7684\u6d4b\u8bd5\u5ba2\u6237\u7aef Pod\uff1a <pre><code>$ kubectl run kafka-client --restart='Never' --image docker.io/bitnami/kafka:3.2.0-debian-10-r4 --namespace logging --command -- sleep infinity\npod/kafka-client created\n</code></pre> \u7136\u540e\u542f\u52a8\u4e00\u4e2a\u7ec8\u7aef\u8fdb\u5165\u5bb9\u5668\u5185\u90e8\u751f\u4ea7\u6d88\u606f\uff1a <pre><code># \u751f\u4ea7\u8005\n$ kubectl exec --tty -i kafka-client --namespace logging -- bash\nI have no name!@kafka-client:/$ kafka-console-producer.sh --broker-list kafka-0.kafka-headless.logging.svc.cluster.local:9092 --topic test\n&gt;hello kafka on k8s\n&gt;\n</code></pre></p> <p>\u542f\u52a8\u53e6\u5916\u4e00\u4e2a\u7ec8\u7aef\u8fdb\u5165\u5bb9\u5668\u5185\u90e8\u6d88\u8d39\u6d88\u606f\uff1a <pre><code># \u6d88\u8d39\u8005\n$ kubectl exec --tty -i kafka-client --namespace logging -- bash\nI have no name!@kafka-client:/$ kafka-console-consumer.sh --bootstrap-server kafka.logging.svc.cluster.local:9092 --topic test --from-beginning\nhello kafka on k8s\n</code></pre></p> <p>\u5982\u679c\u5728\u6d88\u8d39\u7aef\u770b\u5230\u4e86\u751f\u4ea7\u7684\u6d88\u606f\u6570\u636e\u8bc1\u660e\u6211\u4eec\u7684 Kafka \u5df2\u7ecf\u8fd0\u884c\u6210\u529f\u4e86\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#24-fluentd-\u914d\u7f6e-kafka","title":"2.4 Fluentd \u914d\u7f6e Kafka","text":"<p>\u73b0\u5728\u6709\u4e86 Kafka\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06 Fluentd \u7684\u65e5\u5fd7\u6570\u636e\u8f93\u51fa\u5230 Kafka \u4e86\uff0c\u53ea\u9700\u8981\u5c06 Fluentd \u914d\u7f6e\u4e2d\u7684  \u66f4\u6539\u4e3a\u4f7f\u7528 Kafka \u63d2\u4ef6\u5373\u53ef\uff0c\u4f46\u662f\u5728 Fluentd \u4e2d\u8f93\u51fa\u5230 Kafka\uff0c \u9700\u8981\u4f7f\u7528\u5230 fluent-plugin-kafka \u63d2\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u6211\u4eec\u81ea\u5b9a\u4e49\u4e0b Docker \u955c\u50cf\uff0c\u6700\u7b80\u5355\u7684\u505a\u6cd5\u5c31\u662f\u5728\u4e0a\u9762 Fluentd \u955c\u50cf\u7684\u57fa\u7840\u4e0a\u65b0\u589e kafka \u63d2\u4ef6\u5373\u53ef\uff0cDockerfile \u6587\u4ef6\u5982\u4e0b\u6240\u793a\uff1a <p><code>Dockerfile</code> <pre><code>FROM quay.io/fluentd_elasticsearch/fluentd:v3.4.0\nRUN echo \"source 'https://mirrors.tuna.tsinghua.edu.cn/rubygems/'\" &gt; Gemfile &amp;&amp; gem install bundler\nRUN gem install fluent-plugin-kafka -v 0.17.5 --no-document\n</code></pre></p> <pre><code>$ docker build -t giteeops/fluentd-kafka:v0.17.5 .\n$ docker push giteeops/fluentd-kafka:v0.17.5\n</code></pre> <p>\u4f7f\u7528\u4e0a\u9762\u7684 Dockerfile \u6587\u4ef6\u6784\u5efa\u4e00\u4e2a Docker \u955c\u50cf\u5373\u53ef\uff0c\u6211\u8fd9\u91cc\u6784\u5efa\u8fc7\u540e\u7684\u955c\u50cf\u540d\u4e3a <code>giteeops/fluentd-kafka:v0.17.5</code>\u3002\u63a5\u4e0b\u6765\u66ff\u6362 Fluentd \u7684 Configmap \u5bf9\u8c61\u4e2d\u7684  \u90e8\u5206\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code># fluentd-configmap.yaml\nkind: ConfigMap\napiVersion: v1\nmetadata:\nname: fluentd-conf\nnamespace: logging\ndata:\n......\noutput.conf: |-\n&lt;match **&gt;\n@id kafka\n@type kafka2\n@log_level info\n# list of seed brokers\nbrokers kafka-0.kafka-headless.logging.svc.cluster.local:9092\nuse_event_time true\n# topic settings\ntopic_key k8slog\ndefault_topic messages  # \u6ce8\u610f\uff0ckafka\u4e2d\u6d88\u8d39\u4f7f\u7528\u7684\u662f\u8fd9\u4e2atopic\n# buffer settings\n&lt;buffer k8slog&gt;\n@type file\npath /var/log/td-agent/buffer/td\nflush_interval 3s\n&lt;/buffer&gt;\n# data type settings\n&lt;format&gt;\n@type json\n&lt;/format&gt;\n# producer settings\nrequired_acks -1\ncompression_codec gzip\n&lt;/match&gt;\n</code></pre> <p>\u6ce8\u610f</p> <p>node\u8282\u70b9\u4f1a\u521b\u5efa\u4e00\u4e2a/var/log/td-agent/buffer/td\u76ee\u5f55\u3002\u6b64\u76ee\u5f55\u6570\u636e\u5f88\u5927\uff0c\u8003\u8651\u5230\u78c1\u76d8\u7a7a\u95f4\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u5c06buffer settings\u4e3amemory\u7684\u65b9\u5f0f</p> <pre><code>  output.conf: |-\n&lt;match **&gt;\n@id kafka\n@type kafka2\n@log_level info\n# list of seed brokers\nbrokers kafka-0.kafka-headless.logging.svc.cluster.local:9092\nuse_event_time true\n# topic settings\ntopic_key k8slog\ndefault_topic messages  # \u6ce8\u610f\uff0ckafka\u4e2d\u6d88\u8d39\u4f7f\u7528\u7684\u662f\u8fd9\u4e2atopic\n# buffer settings\n&lt;buffer k8slog&gt;\n@type memory\npath /var/log/td-agent/buffer/td\nflush_interval 3s\n&lt;/buffer&gt;\n# data type settings\n&lt;format&gt;\n@type json\n&lt;/format&gt;\n# producer settings\nrequired_acks -1\ncompression_codec gzip\n&lt;/match&gt;\n</code></pre> <p>\u7136\u540e\u66ff\u6362\u8fd0\u884c\u7684 Fluentd \u955c\u50cf\uff1a <pre><code># fluentd-daemonset.yaml\nimage: giteeops/fluentd-kafka:v0.17.5\n</code></pre> \u76f4\u63a5\u66f4\u65b0 Fluentd \u7684 Configmap \u4e0e DaemonSet \u8d44\u6e90\u5bf9\u8c61\u5373\u53ef\uff1a <pre><code>$ kubectl apply -f fluentd-configmap.yaml\n$ kubectl apply -f fluentd-daemonset.yaml\n</code></pre></p> <p>\u66f4\u65b0\u6210\u529f\u540e\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u6d4b\u8bd5 Kafka \u5ba2\u6237\u7aef\u6765\u9a8c\u8bc1\u662f\u5426\u6709\u65e5\u5fd7\u6570\u636e\uff1a <pre><code>$ kubectl exec --tty -i kafka-client --namespace logging -- bash\nI have no name!@kafka-client:/$ kafka-console-consumer.sh --bootstrap-server kafka.logging.svc.cluster.local:9092 --topic messages --from-beginning\n{\"stream\":\"stdout\",\"docker\":{},\"kubernetes\":{\"container_name\":\"count\",\"namespace_name\":\"default\",\"pod_name\":\"counter\",\"container_image\":\"busybox:latest\",\"host\":\"node1\",\"labels\":{\"logging\":\"true\"}},\"message\":\"43883: Tue Apr 27 12:16:30 UTC 2021\\n\"}\n......\n</code></pre></p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#25-\u5b89\u88c5-logstash","title":"2.5 \u5b89\u88c5 Logstash","text":"<p>\u867d\u7136\u6570\u636e\u4ece Kafka \u5230 Elasticsearch \u7684\u65b9\u5f0f\u591a\u79cd\u591a\u6837\uff0c\u6bd4\u5982\u53ef\u4ee5\u4f7f\u7528 Kafka Connect Elasticsearch Connector \u6765\u5b9e\u73b0\uff0c</p> <p>\u6211\u4eec\u8fd9\u91cc\u8fd8\u662f\u91c7\u7528\u66f4\u52a0\u6d41\u884c\u7684 <code>Logstash</code> \u65b9\u6848\uff0c\u4e0a\u9762\u6211\u4eec\u5df2\u7ecf\u5c06\u65e5\u5fd7\u4ece Fluentd \u91c7\u96c6\u8f93\u51fa\u5230 Kafka \u4e2d\u53bb\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528 Logstash \u6765\u8fde\u63a5 Kafka \u4e0e Elasticsearch \u95f4\u7684\u65e5\u5fd7\u6570\u636e\u3002</p> <p>\u9996\u5148\u4f7f\u7528 helm pull \u62c9\u53d6 Chart \u5e76\u89e3\u538b\uff1a</p> <pre><code>$ helm pull elastic/logstash --untar --version 7.17.3\n$ cd logstash\n</code></pre> <p>\u540c\u6837\u5728 Chart \u6839\u76ee\u5f55\u4e0b\u9762\u521b\u5efa\u7528\u4e8e\u5b89\u88c5\u7684 Values \u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code># values-prod.yaml\nfullnameOverride: logstash\npersistence:\nenabled: true\nlogstashConfig:\nlogstash.yml: |\nhttp.host: 0.0.0.0\n# \u5982\u679c\u542f\u7528\u4e86xpack\uff0c\u9700\u8981\u505a\u5982\u4e0b\u914d\u7f6e\nxpack.monitoring.enabled: true\nxpack.monitoring.elasticsearch.hosts: [\"http://elasticsearch-client:9200\"]\nxpack.monitoring.elasticsearch.username: \"elastic\"\nxpack.monitoring.elasticsearch.password: \"oschina\"\n# \u8981\u6ce8\u610f\u4e0b\u683c\u5f0f\nlogstashPipeline:\nlogstash.conf: |\ninput { kafka { bootstrap_servers =&gt; \"kafka-0.kafka-headless.logging.svc.cluster.local:9092\" codec =&gt; json consumer_threads =&gt; 3 topics =&gt; [\"messages\"] } }\nfilter {}  # \u8fc7\u6ee4\u914d\u7f6e\uff08\u6bd4\u5982\u53ef\u4ee5\u5220\u9664key\u3001\u6dfb\u52a0geoip\u7b49\u7b49\uff09\noutput { elasticsearch { hosts =&gt; [ \"elasticsearch-client:9200\" ] user =&gt; \"elastic\" password =&gt; \"oschina\" index =&gt; \"logstash-k8s-%{+YYYY.MM.dd}\" } stdout { codec =&gt; rubydebug } }\nvolumeClaimTemplate:\naccessModes: [\"ReadWriteOnce\"]\nstorageClassName: efk-nfs\nresources:\nrequests:\nstorage: 10Gi\n</code></pre></p> <p>\u5176\u4e2d\u6700\u91cd\u8981\u7684\u5c31\u662f\u901a\u8fc7 logstashPipeline \u914d\u7f6e logstash \u6570\u636e\u6d41\u7684\u5904\u7406\u914d\u7f6e\uff0c\u901a\u8fc7 input \u6307\u5b9a\u65e5\u5fd7\u6e90 kafka \u7684\u914d\u7f6e\uff0c\u901a\u8fc7 output \u8f93\u51fa\u5230 Elasticsearch\uff0c\u540c\u6837\u76f4\u63a5\u4f7f\u7528\u4e0a\u9762\u7684 Values \u6587\u4ef6\u5b89\u88c5 logstash \u5373\u53ef\uff1a</p> <p><pre><code>$ helm upgrade --install logstash -f values-prod.yaml --namespace logging .\nRelease \"logstash\" does not exist. Installing it now.\nNAME: logstash\nLAST DEPLOYED: Thu Jun  9 15:02:49 2022\nNAMESPACE: logging\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\n1. Watch all cluster members come up.\n  $ kubectl get pods --namespace=logging -l app=logstash -w\n</code></pre> \u5b89\u88c5\u542f\u52a8\u5b8c\u6210\u540e\u53ef\u4ee5\u67e5\u770b logstash \u7684\u65e5\u5fd7\uff1a</p> <pre><code>$ kubectl get pods --namespace=logging -l app=logstash\nNAME         READY   STATUS    RESTARTS   AGE\nlogstash-0   1/1     Running   0          2m8s\n\n$ kubectl logs -f logstash-0 -n logging\n......\n{\n\"@version\" =&gt; \"1\",\n        \"stream\" =&gt; \"stdout\",\n    \"@timestamp\" =&gt; 2022-06-09T07:09:16.889Z,\n       \"message\" =&gt; \"4672: Thu Jun  9 07:09:15 UTC 2022\",\n    \"kubernetes\" =&gt; {\n\"container_image\" =&gt; \"docker.io/library/busybox:latest\",\n          \"container_name\" =&gt; \"count\",\n                  \"labels\" =&gt; {\n\"logging\" =&gt; \"true\"\n},\n                \"pod_name\" =&gt; \"counter\",\n          \"namespace_name\" =&gt; \"default\",\n                  \"pod_ip\" =&gt; \"10.244.2.118\",\n                    \"host\" =&gt; \"node2\",\n        \"namespace_labels\" =&gt; {\n\"kubernetes_io/metadata_name\" =&gt; \"default\"\n}\n},\n        \"docker\" =&gt; {}\n}\n</code></pre> <p>\u7531\u4e8e\u6211\u4eec\u542f\u7528\u4e86 debug \u65e5\u5fd7\u8c03\u8bd5\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728 logstash \u7684\u65e5\u5fd7\u4e2d\u770b\u5230\u6211\u4eec\u91c7\u96c6\u7684\u65e5\u5fd7\u6d88\u606f\uff0c\u5230\u8fd9\u91cc\u8bc1\u660e\u6211\u4eec\u7684\u65e5\u5fd7\u6570\u636e\u5c31\u83b7\u53d6\u6210\u529f\u4e86\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u767b\u5f55\u5230 Kibana \u53ef\u4ee5\u770b\u5230\u6709\u5982\u4e0b\u6240\u793a\u7684\u7d22\u5f15\u6570\u636e\u4e86\uff1a</p> <p></p> <p>\u7136\u540e\u540c\u6837\u521b\u5efa\u7d22\u5f15\u6a21\u5f0f\uff0c\u5339\u914d\u4e0a\u9762\u7684\u7d22\u5f15\u5373\u53ef\uff1a </p> <p>\u521b\u5efa\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u524d\u5f80\u53d1\u73b0\u9875\u9762\u8fc7\u6ee4\u65e5\u5fd7\u6570\u636e\u4e86\u3002</p> <p>\u5230\u8fd9\u91cc\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u4e00\u4e2a\u4f7f\u7528 Fluentd+Kafka+Logstash+Elasticsearch+Kibana \u7684 Kubernetes \u65e5\u5fd7\u6536\u96c6\u5de5\u5177\u6808\uff0c\u8fd9\u91cc\u6211\u4eec\u5b8c\u6574\u7684 Pod \u4fe1\u606f\u5982\u4e0b\u6240\u793a\uff1a <pre><code>$ kubectl get pods -n logging\nNAME                            READY   STATUS    RESTARTS   AGE\nelasticsearch-client-0          1/1     Running   0          128m\nelasticsearch-data-0            1/1     Running   0          128m\nelasticsearch-master-0          1/1     Running   0          128m\nfluentd-6k52h                   1/1     Running   0          61m\nfluentd-cw72c                   1/1     Running   0          61m\nfluentd-dn4hs                   1/1     Running   0          61m\nkafka-0                         1/1     Running   3          134m\nkafka-client                    1/1     Running   0          125m\nkafka-zookeeper-0               1/1     Running   0          134m\nkibana-kibana-66f97964b-qqjgg   1/1     Running   0          128m\nlogstash-0                      1/1     Running   0          13m\n</code></pre></p> <p>\u5f53\u7136\u5728\u5b9e\u9645\u7684\u5de5\u4f5c\u9879\u76ee\u4e2d\u8fd8\u9700\u8981\u6211\u4eec\u6839\u636e\u5b9e\u9645\u7684\u4e1a\u52a1\u573a\u666f\u6765\u8fdb\u884c\u53c2\u6570\u6027\u80fd\u8c03\u4f18\u4ee5\u53ca\u9ad8\u53ef\u7528\u7b49\u8bbe\u7f6e\uff0c\u4ee5\u8fbe\u5230\u7cfb\u7edf\u7684\u6700\u4f18\u6027\u80fd\u3002</p> <p>\u4e0a\u9762\u6211\u4eec\u5728\u914d\u7f6e logstash \u7684\u65f6\u5019\u662f\u5c06\u65e5\u5fd7\u8f93\u51fa\u5230 \"logstash-k8s-%{+YYYY.MM.dd}\" \u8fd9\u4e2a\u7d22\u5f15\u6a21\u5f0f\u7684\uff0c\u53ef\u80fd\u6709\u7684\u573a\u666f\u4e0b\u53ea\u901a\u8fc7\u65e5\u671f\u53bb\u533a\u5206\u7d22\u5f15\u4e0d\u662f\u5f88\u5408\u7406\uff0c \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u53bb\u4fee\u6539\u7d22\u5f15\u540d\u79f0\uff0c\u6bd4\u5982\u53ef\u4ee5\u6839\u636e\u6211\u4eec\u7684\u670d\u52a1\u540d\u79f0\u6765\u8fdb\u884c\u533a\u5206\uff0c\u90a3\u4e48\u8fd9\u4e2a\u670d\u52a1\u540d\u79f0\u53ef\u4ee5\u600e\u4e48\u6765\u5b9a\u4e49\u5462\uff1f\u53ef\u4ee5\u662f Pod \u7684\u540d\u79f0\u6216\u8005\u901a\u8fc7 label \u6807\u7b7e\u53bb\u6307\u5b9a\uff0c \u6bd4\u5982\u6211\u4eec\u8fd9\u91cc\u53bb\u505a\u4e00\u4e2a\u89c4\u8303\uff0c\u8981\u6c42\u9700\u8981\u6536\u96c6\u65e5\u5fd7\u7684 Pod \u9664\u4e86\u9700\u8981\u6dfb\u52a0 logging: true \u8fd9\u4e2a\u6807\u7b7e\u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a<code>logIndex: &lt;\u7d22\u5f15\u540d&gt;</code>\u7684\u6807\u7b7e\u3002</p> <p>\u6bd4\u5982\u91cd\u65b0\u66f4\u65b0\u6211\u4eec\u6d4b\u8bd5\u7684 counter \u5e94\u7528\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: counter\nlabels:\nlogging: \"true\" # \u4e00\u5b9a\u8981\u5177\u6709\u8be5\u6807\u7b7e\u624d\u4f1a\u88ab\u91c7\u96c6\nlogIndex: \"test\"  # \u6307\u5b9a\u7d22\u5f15\u540d\u79f0\nspec:\ncontainers:\n- name: count\nimage: busybox\nargs:\n[\n/bin/sh,\n-c,\n'i=0; while true; do echo \"$i: $(date)\"; i=$((i+1)); sleep 1; done',\n]\n</code></pre></p> <p>\u7136\u540e\u91cd\u65b0\u66f4\u65b0 logstash \u7684\u914d\u7f6e\uff0c\u4fee\u6539 values \u914d\u7f6e\uff1a <pre><code># ......\nlogstashPipeline:\nlogstash.conf: |\ninput { kafka { bootstrap_servers =&gt; \"kafka-0.kafka-headless.logging.svc.cluster.local:9092\" codec =&gt; json consumer_threads =&gt; 3 topics =&gt; [\"messages\"] } }\nfilter {}  # \u8fc7\u6ee4\u914d\u7f6e\uff08\u6bd4\u5982\u53ef\u4ee5\u5220\u9664key\u3001\u6dfb\u52a0geoip\u7b49\u7b49\uff09\noutput { elasticsearch { hosts =&gt; [ \"elasticsearch-client:9200\" ] user =&gt; \"elastic\" password =&gt; \"oschina\" index =&gt; \"k8s-%{[kubernetes][labels][logIndex]}-%{+YYYY.MM.dd}\" } stdout { codec =&gt; rubydebug } }\n# ......\n</code></pre></p> <p>\u4f7f\u7528\u4e0a\u9762\u7684 values \u503c\u66f4\u65b0 logstash\uff0c\u6b63\u5e38\u66f4\u65b0\u540e\u4e0a\u9762\u7684 counter \u8fd9\u4e2a Pod \u65e5\u5fd7\u4f1a\u8f93\u51fa\u5230\u4e00\u4e2a\u540d\u4e3a k8s-test-2022.06.09 \u7684\u7d22\u5f15\u53bb\u3002 </p> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u81ea\u5b9a\u4e49\u7d22\u5f15\u540d\u79f0\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 Pod \u540d\u79f0\u3001\u5bb9\u5668\u540d\u79f0\u3001\u547d\u540d\u7a7a\u95f4\u540d\u79f0\u6765\u4f5c\u4e3a\u7d22\u5f15\u7684\u540d\u79f0\uff0c\u8fd9\u5b8c\u5168\u53d6\u51b3\u4e8e\u4f60\u81ea\u5df1\u7684\u9700\u6c42\u3002</p> <p>Elasticsearch\u96c6\u7fa4\u6027\u80fd\u4f18\u5316\u5b9e\u8df5</p> <p>https://cloud.tencent.com/developer/article/1775059</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/14.Kubernetes%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/#3-\u53c2\u8003\u6587\u732e","title":"3. \u53c2\u8003\u6587\u732e","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://mp.weixin.qq.com/s/lPeYavvFJ6GdivkT0iwTGw https://docs.youdianzhishi.com/k8s/logging/efk/</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/","title":"Kubernetes\u76d1\u63a7\u544a\u8b66","text":"<p>\u672c\u7ae0\u5c06\u5e26\u9886\u8bfb\u8005\u5b66\u4e60\u5982\u4f55\u5bf9Kubernetes\u96c6\u7fa4\u4ee5\u53ca\u90e8\u7f72\u7684\u5e94\u7528\u8fdb\u884c\u76d1\u63a7\u3002</p> <p>\u4f20\u7edf\u67b6\u6784\u4e2d\u6bd4\u8f83\u6d41\u884c\u7684\u76d1\u63a7\u5de5\u5177\u6709Zabbix\u3001Nagios\u7b49\uff0c\u8fd9\u4e9b\u76d1\u63a7\u5de5\u5177\u5bf9\u4e8eKubernetes\u8fd9\u7c7b\u4e91\u5e73\u53f0\u76d1\u63a7\u4e0d\u662f\u5f88\u53cb\u597d\uff0c\u7279\u522b\u662f\u5f53Kubernetes\u96c6\u7fa4\u4e2d\u6709\u4e86\u6210\u5343\u4e0a\u4e07\u7684\u5bb9\u5668\u540e\u66f4\u662f\u5982\u6b64\uff0c\u672c\u7ae0\u5c06\u5e26\u9886\u8bfb\u8005\u5b66\u4e60\u4e0b\u4e00\u4ee3\u7684\u4e91\u539f\u751f\u76d1\u63a7\u5e73\u53f0\u2014Prometheus\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#1prometheus\u7684\u67b6\u6784\u4ecb\u7ecd","title":"1.Prometheus\u7684\u67b6\u6784\u4ecb\u7ecd","text":"<p>Prometheus\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u7cfb\u7edf\u76d1\u63a7\u548c\u62a5\u8b66\u6846\u67b6\uff0c\u5176\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5e93\uff08Time Series Database\uff0cTSDB),\u5b83\u7684\u8bbe\u8ba1\u7075\u611f\u6765\u6e90\u4e8eGoogle\u7684Borgmon\uff0c\u5c31\u50cfKubernetes\u662f\u57fa\u4e8eBorg\u7cfb\u7edf\u5f00\u6e90\u7684\u3002</p> <p>Prometheus\u662f\u7531Sound Cloud\u7684Google\u524d\u5458\u5de5\u8bbe\u8ba1\u5e76\u5f00\u6e90\u7684\uff0c\u5b98\u65b9\u7f51\u7ad9\u4e3ahttps://prometheus.io/\u3002 Prometheus\u4e8e2016\u5e74\u52a0\u5165\u4e91\u539f\u751f\u8ba1\u7b97\u57fa\u91d1\u4f1a\uff08Cloud Native Computing Foundation\uff0cCNCF\uff09,\u6210\u4e3a\u53d7\u6b22\u8fce\u7a0b\u5ea6\u4ec5\u6b21\u4e8eKubernetes\u7684\u5f00\u6e90\u9879\u76ee\u3002</p> <p>\u8be5\u9879\u76ee\u62e5\u6709\u975e\u5e38\u6d3b\u8dc3\u7684\u5f00\u53d1\u8005\u548c\u7528\u6237\u793e\u533a\uff0c\u76ee\u524d\u5df2\u7ecf\u88ab\u5f88\u591a\u516c\u53f8\u91c7\u7528\uff0c\u5e76\u4e14\u90e8\u5206\u516c\u53f8\u4e5f\u53c2\u4e0e\u4e86\u8be5\u9879\u76ee\u7684\u7ef4\u62a4\u3002</p> <p>Prometheus\u88ab\u79f0\u4e3a\u4e0b\u4e00\u4ee3\u7684\u76d1\u63a7\u5e73\u53f0\uff0c\u5177\u6709\u5f88\u591a\u548c\u201c\u8001\u724c\u201d\u76d1\u63a7\u4e0d\u4e00\u6837\u7684\u7279\u6027\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u4e00\u4e2a\u591a\u7ef4\u7684\u6570\u636e\u6a21\u578b\uff0c\u5177\u6709\u7531\u6307\u6807\u540d\u79f0\u548c\u952e-\u503c\u5bf9\u6807\u8bc6\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002</li> <li>\u4f7f\u7528PromQL\u67e5\u8be2\u548c\u805a\u5408\u6570\u636e\uff0c\u53ef\u4ee5\u975e\u5e38\u7075\u6d3b\u5730\u5bf9\u6570\u636e\u8fdb\u884c\u68c0\u7d22\u3002</li> <li>\u4e0d\u4f9d\u8d56\u989d\u5916\u7684\u6570\u636e\u5b58\u50a8\uff0cPrometheus\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u63d0\u4f9b\u672c\u5730\u5b58\u50a8\u548c\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u5e76\u4e14\u6bcf\u4e2aPrometheus\u90fd\u662f\u81ea\u6cbb\u7684\u3002</li> <li>\u5e94\u7528\u7a0b\u5e8f\u66b4\u9732Metrics\u63a5\u53e3\uff0cPrometheus\u901a\u8fc7\u57fa\u4e8eHTTP\u7684Pull\u6a21\u578b\u91c7\u96c6\u6570\u636e\u3002</li> <li>\u540c\u65f6\u53ef\u4ee5\u4f7f\u7528PushGateway\u8fdb\u884cPush\u6570\u636e\u3002</li> <li>Prometheus\u540c\u65f6\u652f\u6301\u52a8\u6001\u670d\u52a1\u548c\u9759\u6001\u914d\u7f6e\u53d1\u73b0\u76ee\u6807\u673a\u5668\u3002</li> <li>\u652f\u6301\u591a\u79cd\u56fe\u5f62\u548c\u4eea\u8868\u76d8\uff0c\u548cGrafana\u582a\u79f0\u201c\u7edd\u914d\u201d</li> </ul> <p>Prometheus\u751f\u6001\u7cfb\u7edf\u7531\u591a\u4e2a\u7ec4\u4ef6\u7ec4\u6210\uff0c\u5176\u67b6\u6784\u56fe\u5982\u56fe15.1\u6240\u793a\u3002</p> <p> \u56fe15.1\u3000Prometheus\u67b6\u6784</p> <p>\u867d\u7136Prometheus\u7684\u7ec4\u4ef6\u6709\u5f88\u591a\uff0c\u4f46\u662f\u5f88\u591a\u7ec4\u4ef6\u90fd\u662f\u53ef\u9009\u7684\uff0c\u6240\u4ee5Prometheus\u8981\u6bd4\u5176\u4ed6\u76d1\u63a7\u5e73\u53f0\u66f4\u7075\u6d3b\u3002\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u6bcf\u4e2a\u7ec4\u4ef6\u7684\u7528\u9014\u3002</p> <p>Prometheus Server\uff1aPrometheus\u751f\u6001\u6700\u91cd\u8981\u7684\u7ec4\u4ef6\uff0c\u4e3b\u8981\u7528\u4e8e\u6293\u53d6\u548c\u5b58\u50a8\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u540c\u65f6\u63d0\u4f9b\u6570\u636e\u7684\u67e5\u8be2\u548c\u544a\u8b66\u7b56\u7565\u7684\u914d\u7f6e\u7ba1 \u7406\u3002</p> <ul> <li> <p>Alertmanager\uff1aPrometheus\u751f\u6001\u7528\u4e8e\u544a\u8b66\u7684\u7ec4\u4ef6\uff0cPrometheus Server\u4f1a\u5c06\u544a\u8b66\u53d1\u9001\u7ed9Alertmanager\uff0cAlertmanager\u6839\u636e\u8def\u7531\u914d\u7f6e   \u5c06\u544a\u8b66\u4fe1\u606f\u53d1\u9001\u7ed9\u6307\u5b9a\u7684\u4eba\u6216\u7ec4\u3002Alertmanager\u652f\u6301\u90ae\u4ef6\u3001Webhook\u3001\u5fae\u4fe1\u3001\u9489\u9489\u3001\u77ed\u4fe1\u7b49\u5a92\u4ecb\u8fdb\u884c\u544a\u8b66\u901a\u77e5\u3002</p> </li> <li> <p>Grafana\uff1a\u7528\u4e8e\u5c55\u793a\u6570\u636e\uff0c\u4fbf\u4e8e\u6570\u636e\u7684\u67e5\u8be2\u548c\u89c2\u6d4b\u3002</p> </li> <li> <p>Push Gateway\uff1aPrometheus\u672c\u8eab\u662f\u901a\u8fc7Pull\u7684\u65b9\u5f0f\u62c9\u53d6\u6570\u636e\u7684\uff0c\u4f46\u662f\u6709\u4e9b\u76d1\u63a7\u6570\u636e\u53ef\u80fd\u662f\u77ed\u671f\u7684\uff0c\u5982\u679c\u6ca1\u6709\u91c7\u96c6\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e22   \u5931\u3002Push Gateway\u53ef\u4ee5\u7528\u6765\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u63a5\u6536\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7Push\u7684\u65b9\u5f0f\u5c06\u6570\u636e\u63a8\u9001\u5230Push Gateway\uff0c\u4e4b\u540ePrometheus\u53ef\u4ee5\u901a\u8fc7Pull\u62c9\u53d6\u8be5\u6570\u636e\u3002</p> </li> <li> <p>Exporter\uff1a\u4e3b\u8981\u7528\u6765\u91c7\u96c6\u76d1\u63a7\u6570\u636e\uff0c\u6bd4\u5982\u4e3b\u673a\u7684\u76d1\u63a7\u6570\u636e\u53ef\u4ee5\u901a\u8fc7node_exporter\u91c7\u96c6\uff0cMySQL\u7684\u76d1\u63a7\u6570\u636e\u53ef\u4ee5\u901a\u8fc7mysql_exporter\u91c7\u96c6\uff0c\u4e4b\u540eExporter\u66b4\u9732\u4e00\u4e2a\u63a5\u53e3\uff0c\u6bd4\u5982/metrics\uff0cPrometheus\u53ef\u4ee5\u901a\u8fc7\u8be5\u63a5\u53e3\u91c7\u96c6\u5230\u6570\u636e\u3002</p> </li> <li> <p>PromQL\uff1aPromQL\u5176\u5b9e\u4e0d\u7b97Prometheus\u7684\u7ec4\u4ef6\uff0c\u5b83\u662f\u7528\u6765\u67e5\u8be2\u6570\u636e\u7684   \u4e00\u79cd\u8bed\u6cd5\uff0c\u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7SQL\u8bed\u53e5\u67e5\u8be2\u6570\u636e\u5e93\u7684\u6570\u636e\uff0c\u901a\u8fc7LogQL\u8bed\u53e5\u67e5\u8be2Loki\u7684\u6570\u636e\uff0c\u901a\u8fc7PromQL\u8bed\u53e5\u67e5\u8be2Prometheus\u7684\u6570\u636e\u3002</p> </li> <li> <p>Service Discovery\uff1a\u7528\u6765\u53d1\u73b0\u76d1\u63a7\u76ee\u6807\u7684\u81ea\u52a8\u53d1\u73b0\uff0c\u5e38\u7528\u7684\u6709\u57fa\u4e8eKubernetes\u3001Consul\u3001Eureka\u3001\u6587\u4ef6\u7684\u81ea\u52a8\u53d1\u73b0\u7b49\u3002</p> </li> </ul> <p>\u4ee5\u4e0a\u5bf9Prometheus\u8fdb\u884c\u4e86\u7b80\u5355\u7684\u4ecb\u7ecd\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4e0a\u624b\u4f53\u9a8cPrometheus\u7684\u5f3a\u5927\u4e4b\u5904\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#2prometheus\u7684\u5b89\u88c5","title":"2.Prometheus\u7684\u5b89\u88c5","text":"<p>Prometheus\u6709\u591a\u79cd\u5b89\u88c5\u65b9\u5f0f\uff0c\u6bd4\u5982\u4e8c\u8fdb\u5236\u5b89\u88c5\u3001\u5bb9\u5668\u5b89\u88c5\u548cKubernetes \u96c6\u7fa4\u4e2d\u5b89\u88c5\uff0c\u7531\u4e8e\u672c\u4e66\u662f\u57fa\u4e8eKubernetes\u5c55\u5f00\u7684\uff0c\u56e0\u6b64\u4f1a\u5c06Prometheus\u5b89\u88c5\u5230Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u5f53\u7136\u8fd9\u4e5f\u662f\u5b98\u65b9\u63a8\u8350\u7684\u90e8\u7f72\u65b9\u5f0f\u3002</p> <p>\u5c06Prometheus\u5b89\u88c5\u5230Kubernetes\u96c6\u7fa4\u4e5f\u6709\u5f88\u591a\u65b9\u5f0f\uff0c\u6bd4\u5982\u4e4b\u524d\u63d0\u5230\u8fc7\u7684Helm\u3001Operator\u7b49\uff0cPrometheus\u4e5f\u662f\u652f\u6301\u4e0a\u8ff0\u5b89\u88c5\u65b9\u5f0f\u7684\u3002</p> <p>\u4f46\u662fPrometheus\u662f\u4e00\u4e2a\u751f\u6001\u7cfb\u7edf\uff0c\u6709\u5f88\u591a\u7ec4\u4ef6\u90fd\u9700\u8981\u5b89\u88c5\uff0c\u5e76\u4e14\u4e5f\u6709\u5f88\u591a\u76d1\u63a7\u9700\u8981\u5355\u72ec\u914d\u7f6e\uff0c\u4e8e\u662fPrometheus\u5b98\u65b9\u5f00\u6e90\u4e86\u4e00\u4e2akube-prometheus\u9879\u76ee\uff0c\u8be5\u9879\u76ee\u4e0d\u4ec5\u4ec5\u662f\u7528\u6765\u5b89\u88c5Prometheus\u7684\uff0c\u4e5f\u5305\u542b\u5f88\u591a\u5176\u4ed6\u7684\u7ec4\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <ul> <li>Prometheus Operator\u3002</li> <li>\u9ad8\u53ef\u7528\u7684Prometheus\u3002</li> <li>\u9ad8\u53ef\u7528\u7684Alertmanager\u3002</li> <li>\u4e3b\u673a\u76d1\u63a7Node Exporter\u3002</li> <li>Prometheus Adapter\u3002</li> <li>\u5bb9\u5668\u76d1\u63a7kube-state-metrics\u3002</li> <li>\u56fe\u5f62\u5316\u5c55\u793aGrafana\u3002</li> </ul> <p>\u5177\u4f53\u53ef\u4ee5\u901a\u8fc7https://github.com/prometheus-operator/kube-prometheus/\u627e\u5230\u8be5\u9879\u76ee\u8fdb\u884c\u67e5\u770b\u3002</p> <p>\u6709\u4e86kube-prometheus\u9879\u76ee\uff0c\u5bf9\u5176\u7684\u5b89\u88c5\u4e5f\u53d8\u5f97\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4e24\u6761\u547d\u4ee4\u5373\u53ef\u3002</p> <p>\u9996\u5148\u9700\u8981\u901a\u8fc7\u8be5\u9879\u76ee\u5730\u5740\u627e\u5230\u548c\u81ea\u5df1Kubernetes\u7248\u672c\u5bf9\u5e94\u7684Kube Prometheus Stack\u7684\u7248\u672c\uff0c\u5982\u56fe15.2\u6240\u793a\u3002</p> <p></p> <p>\u56fe15.2\u3000Prometheus\u7248\u672c\u9009\u62e9</p> <p>\u4e4b\u540e\u5c06\u8be5\u9879\u76ee\u5bf9\u5e94\u5206\u652f\u514b\u9686\u5230\u672c\u5730\uff1a</p> <p>kubernetes1.21\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f <pre><code>$ git clone -b release-0.9 https://github.com/prometheus-operator/kube-prometheus.git\n$ cd kube-prometheus/manifests\n</code></pre></p> <p>kubernetes1.20\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f <pre><code>$ git clone https://github.com/prometheus-operator/kube-prometheus.git\n$ cd kube-prometheus\n$ git checkout -b origin/release-0.8 remotes/origin/release-0.8\n$ cd manifests/\n</code></pre></p> <p>\u9996\u5148\u5b89\u88c5Prometheus Operator\uff1a</p> <pre><code>$ kubectl create -f setup/\nnamespace/monitoring created\n...\ndeployment.apps/prometheus-operator created\nservice/prometheus-operator created\nserviceaccount/prometheus-operator created\n</code></pre> <p>\u67e5\u770bOperator\u5bb9\u5668\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pod -n monitoring\nNAME                                   READY   STATUS    RESTARTS   AGE\nprometheus-operator-75d9b475d9-pk8qb   2/2     Running   0          4m16s\n</code></pre> <p>\u6570\u636e\u6301\u4e45\u5316</p> <p>\u914d\u7f6eprometheus\u6301\u4e45\u5316\u7684\u914d\u7f6e\u6e05\u5355\uff1a</p> <p>prometheus-prometheus.yaml</p> <pre><code>  image: quay.io/prometheus/prometheus:v2.26.0\nenv:\n- name: TZ\nvalue: \"Asia/Shanghai\"\n......\nretention: 15d\nstorage:\nvolumeClaimTemplate:\nspec:\nstorageClassName: gitee-nfs-client\nresources:\nrequests:\nstorage: 20Gi\n</code></pre> <p>\u914d\u7f6egrafana\u6301\u4e45\u5316\u7684\u914d\u7f6e\u6e05\u5355\uff1a</p> <p>grafana-pvc.yaml</p> <pre><code>$ mkdir grafana-pvc $ vim grafana-pvc.yaml\n</code></pre> <pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\nname: grafana-pvc\nnamespace: monitoring\nspec:\naccessModes:\n- ReadWriteMany\nresources:\nrequests:\nstorage: 20M\nstorageClassName: gitee-nfs-client\n</code></pre> <p>grafana-deployment.yaml</p> <pre><code>.......\nspec:\ncontainers:\n# \u56fa\u5b9agrafana\u7684\u767b\u9646\u5bc6\u7801\n- env:\n- name: GF_SECURITY_ADMIN_USER\nvalue: admin\n- name: GF_SECURITY_ADMIN_PASSWORD\nvalue: oschina123\n- name: TZ\nvalue: Asia/Shanghai\n# image: grafana/grafana:8.1.1\nimage: grafana/grafana:8.4.7\nname: grafana\nports:\n- containerPort: 3000\nname: http\nreadinessProbe:\nhttpGet:\npath: /api/health\nport: http\nresources:\nlimits:\ncpu: 200m\nmemory: 200Mi\nrequests:\ncpu: 100m\nmemory: 100Mi\n.......\nnodeSelector:\nkubernetes.io/os: linux\nsecurityContext:\nfsGroup: 65534\nrunAsNonRoot: true\nrunAsUser: 65534\nserviceAccountName: grafana\nvolumes:\n# \u6301\u4e45\u5316pvc\n- name: grafana-storage\npersistentVolumeClaim:\nclaimName: grafana-pvc\n.......\n</code></pre> <p>\u914d\u7f6ealertmanager\u6301\u4e45\u5316\u7684\u914d\u7f6e\u6e05\u5355\uff1a</p> <p>alertmanager-alertmanager.yaml</p> <pre><code>....\nretention: 24h\nstorage:\nvolumeClaimTemplate:\nspec:\nstorageClassName: gitee-nfs-client\nresources:\nrequests:\nstorage: 10Gi\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>https://www.lhl.zone/virtualization/kube-prometheus/102.html</p> <p>Operator\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u5b89\u88c5Prometheus Stack\uff1a</p> <pre><code>$ kubectl create -f .\nalertmanager.monitoring.coreos.com/main created\nWarning: policy/v1beta1 PodDisruptionBudget is deprecated in v1.21+, unavailable in v1.25+; use policy/v1 PodDisruptionBudget\npoddisruptionbudget.policy/alertmanager-main created\nprometheusrule.monitoring.coreos.com/alertmanager-main-rules created\n....\nrole.rbac.authorization.k8s.io/prometheus-k8s-config created\nrole.rbac.authorization.k8s.io/prometheus-k8s created\nrole.rbac.authorization.k8s.io/prometheus-k8s created\nrole.rbac.authorization.k8s.io/prometheus-k8s created\nservice/prometheus-k8s created\nserviceaccount/prometheus-k8s created\nservicemonitor.monitoring.coreos.com/prometheus-k8s created\n</code></pre> <p>\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u6709\u4e00\u4e9b\u8d44\u6e90\u7684\u955c\u50cf\u6765\u81ea\u4e8e <code>k8s.gcr.io</code>\uff0c\u5982\u679c\u4e0d\u80fd\u6b63\u5e38\u62c9\u53d6\uff0c\u5219\u53ef\u4ee5\u5c06\u955c\u50cf\u66ff\u6362\u6210\u53ef\u62c9\u53d6\u7684\uff1a</p> <ul> <li><code>prometheusAdapter-deployment.yaml</code>\uff1a\u5c06 <code>image: k8s.gcr.io/prometheus-adapter/prometheus-adapter:v0.9.1</code> \u66ff\u6362\u4e3a <code>cnych/prometheus-adapter:v0.9.1</code></li> <li><code>kubeStateMetrics-deployment.yaml</code>\uff1a\u5c06 <code>image: k8s.gcr.io/kube-state-metrics/kube-state-metrics:v2.4.2</code> \u66ff\u6362\u4e3a <code>cnych/kube-state-metrics:v2.4.2</code></li> </ul> <pre><code>$ sed 's#k8s.gcr.io/kube-state-metrics/kube-state-metrics:v2.1.1#cnych/kube-state-metrics:v2.4.2#g' -i *.yaml\n$ sed 's#k8s.gcr.io/prometheus-adapter/prometheus-adapter:v0.9.0#cnych/prometheus-adapter:v0.9.1#g' -i *.yaml\n</code></pre> <p>\u8fd9\u4f1a\u81ea\u52a8\u5b89\u88c5 prometheus-operator\u3001node-exporter\u3001kube-state-metrics\u3001grafana\u3001prometheus-adapter \u4ee5\u53ca prometheus \u548c alertmanager \u7b49\u5927\u91cf\u7ec4\u4ef6\uff0c\u5982\u679c\u6ca1\u6210\u529f\u53ef\u4ee5\u591a\u6b21\u6267\u884c\u4e0a\u9762\u7684\u5b89\u88c5\u547d\u4ee4\u3002</p> <p>\u67e5\u770bPrometheus\u5bb9\u5668\u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl get pods -n monitoring\nNAME                                   READY   STATUS    RESTARTS   AGE\nalertmanager-main-0                    2/2     Running   0          6m41s\nalertmanager-main-1                    2/2     Running   0          6m41s\nalertmanager-main-2                    2/2     Running   0          6m41s\nblackbox-exporter-6798fb5bb4-9rg5s     3/3     Running   0          6m41s\ngrafana-7476b4c65b-6qrxh               1/1     Running   0          6m40s\nkube-state-metrics-64c7ff87dc-8b4bs    3/3     Running   0          6m40s\nnode-exporter-2f2h2                    2/2     Running   0          6m40s\nnode-exporter-2zcbr                    2/2     Running   0          6m40s\nnode-exporter-5txxx                    2/2     Running   0          6m40s\nnode-exporter-7wxp6                    2/2     Running   0          6m40s\nnode-exporter-99wrh                    2/2     Running   0          6m40s\nnode-exporter-dcfdn                    2/2     Running   0          6m40s\nnode-exporter-g7hl9                    2/2     Running   0          6m40s\nnode-exporter-hsgwx                    2/2     Running   0          6m40s\nnode-exporter-jp8qs                    2/2     Running   0          6m40s\nprometheus-adapter-77774d7447-r7m9p    1/1     Running   0          6m40s\nprometheus-adapter-77774d7447-xjcm5    1/1     Running   0          6m40s\nprometheus-k8s-0                       2/2     Running   0          6m39s\nprometheus-k8s-1                       2/2     Running   0          6m39s\nprometheus-operator-75d9b475d9-pk8qb   2/2     Running   0          97m\n\n$ kubectl get svc -n monitoring\nNAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE\nalertmanager-main       ClusterIP   10.111.159.143   &lt;none&gt;        9093/TCP                     6m58s\nalertmanager-operated   ClusterIP   None             &lt;none&gt;        9093/TCP,9094/TCP,9094/UDP   6m58s\nblackbox-exporter       ClusterIP   10.103.27.127    &lt;none&gt;        9115/TCP,19115/TCP           6m58s\ngrafana                 ClusterIP   10.102.99.88     &lt;none&gt;        3000/TCP                     6m57s\nkube-state-metrics      ClusterIP   None             &lt;none&gt;        8443/TCP,9443/TCP            6m57s\nnode-exporter           ClusterIP   None             &lt;none&gt;        9100/TCP                     6m57s\nprometheus-adapter      ClusterIP   10.110.138.216   &lt;none&gt;        443/TCP                      6m57s\nprometheus-k8s          ClusterIP   10.106.193.178   &lt;none&gt;        9090/TCP                     6m56s\nprometheus-operated     ClusterIP   None             &lt;none&gt;        9090/TCP                     6m56s\nprometheus-operator     ClusterIP   None             &lt;none&gt;        8443/TCP                     97m\n</code></pre> <p>\u5f85\u5bb9\u5668\u5168\u90e8\u4e0b\u8f7d\u5b8c\u6210(\u9996\u6b21\u5b89\u88c5\u955c\u50cf\u4e0b\u8f7d\u53ef\u80fd\u4f1a\u5f88\u6162)\u5e76\u4e14\u542f\u52a8\u540e\uff0c\u53ef\u4ee5\u8bbf\u95eeGrafana\u548cPrometheus \u3002</p> <p>\u5728\u6267\u884c\u5b89\u88c5\u65f6\u4f1a\u81ea\u52a8\u521b\u5efaGrafana\u548cPrometheus\u7684Service\uff0c\u53ef\u4ee5\u901a\u8fc7NodePort\u6216\u8005Ingress\u7684\u65b9\u5f0f\u8bbf\u95ee\uff0c\u5728\u6b64\u6f14\u793a\u7684\u4e3aNodePort\u65b9\u5f0f\u3002</p> <p>\u9996\u5148\u5c06Grafana\u7684Service\u6539\u6210NodePort\u7c7b\u578b\uff1a</p> <pre><code>$ kubectl edit svc grafana -n monitoring\n  selector:\n    app.kubernetes.io/component: grafana\n    app.kubernetes.io/name: grafana\n    app.kubernetes.io/part-of: kube-prometheus\n  sessionAffinity: None\n  # \u66f4\u6539Grafana\u7684Service\u7c7b\u578b\ntype: NodePort\n</code></pre> <p>\u6216\u8005\u76f4\u63a5\u4fee\u6539<code>grafana-service.yaml</code>\u6587\u4ef6\u5185\u5bb9 <pre><code>apiVersion: v1\nkind: Service\nmetadata:\nlabels:\napp.kubernetes.io/component: grafana\napp.kubernetes.io/name: grafana\napp.kubernetes.io/part-of: kube-prometheus\napp.kubernetes.io/version: 7.5.4\nname: grafana\nnamespace: monitoring\nspec:\ntype: NodePort\nports:\n- name: http\nport: 3000\nnodePort: 30030\ntargetPort: http\nselector:\napp.kubernetes.io/component: grafana\napp.kubernetes.io/name: grafana\napp.kubernetes.io/part-of: kube-prometheus\n</code></pre></p> <p>\u67e5\u770bGrafana Service\u7684NodePort\uff1a</p> <pre><code>$ kubectl get svc grafana -n monitoring\nNAME      TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE\ngrafana   NodePort   10.102.99.88   &lt;none&gt;        3000:31790/TCP   8m55s\n</code></pre> <p>\u4e4b\u540e\u901a\u8fc7\u4efb\u610f\u4e00\u4e2a\u5b89\u88c5\u4e86kube-proxy\u670d\u52a1\u7684\u8282\u70b9IP+31790\u7aef\u53e3\u5373\u53ef\u8bbf\u95eeGrafana\uff0c\u5982\u56fe15.4\u6240\u793a\u3002</p> <p></p> <p>Grafana\u9ed8\u8ba4\u767b\u5f55\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u4e3aadmin/admin\uff0c\u767b\u5f55\u4f1a\u63d0\u793a\u66f4\u6539\u5bc6\u7801\uff0c\u4e5f\u53ef\u4ee5\u5355\u51fbskip\u4e0d\u66f4\u6539\u5bc6\u7801\u3002\u7136\u540e\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u66f4\u6539Prometheus\u7684Service\u4e3aNodePort\uff1a</p> <pre><code>$ kubectl edit svc prometheus-k8s -n monitoring\n  selector:\n    app: prometheus\n    app.kubernetes.io/component: prometheus\n    app.kubernetes.io/name: prometheus\n    app.kubernetes.io/part-of: kube-prometheus\n    prometheus: k8s\n  sessionAffinity: ClientIP\n  sessionAffinityConfig:\n    clientIP:\n      timeoutSeconds: 10800\n# \u66f4\u6539prometheus\u7684Service\u7c7b\u578b\ntype: NodePort\n\n$ kubectl get svc prometheus-k8s -n monitoring\nNAME             TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE\nprometheus-k8s   NodePort   10.106.193.178   &lt;none&gt;        9090:31635/TCP   13m\n</code></pre> <p>\u6700\u540e\u901a\u8fc7\u4efb\u610f\u4e00\u4e2a\u5b89\u88c5\u4e86kube-proxy\u670d\u52a1\u7684\u8282\u70b9IP+31635\u7aef\u53e3\u5373\u53ef\u8bbf\u95eePrometheus\u7684Web UI\uff0c\u5982\u56fe15.5\u6240\u793a\u3002</p> <p> \u56fe15.5 \u8bbf\u95eePrometheus Web UI</p> <p>\u63d0\u793a</p> <p>\u9ed8\u8ba4\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u4f1a\u6709\u51e0\u4e2a\u544a\u8b66\uff0c\u5148\u5ffd\u7565\u3002</p> <p>\u5982\u679c\u8981\u6e05\u7406 Prometheus-Operator\uff0c\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\u5bf9\u5e94\u7684\u8d44\u6e90\u6e05\u5355\u5373\u53ef\uff1a</p> <pre><code>$ kubectl delete -f kube-prometheus/manifests/\n$ kubectl delete -f kube-prometheus/manifests/setup/\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#3\u4e91\u539f\u751f\u548c\u975e\u4e91\u539f\u751f\u5e94\u7528\u7684\u76d1\u63a7\u6d41\u7a0b","title":"3.\u4e91\u539f\u751f\u548c\u975e\u4e91\u539f\u751f\u5e94\u7528\u7684\u76d1\u63a7\u6d41\u7a0b","text":"<p>\u901a\u8fc7\u524d\u9762\u7684\u5b66\u4e60\uff0c\u53ef\u4ee5\u770b\u5230\u53ea\u9700\u8981\u51e0\u6761\u547d\u4ee4\u5373\u53ef\u5b8c\u6210Prometheus Stack\u7684\u5b89\u88c5\uff0c\u63a5\u4e0b\u6765\u5f00\u59cb\u4ecb\u7ecdPrometheus\u662f\u5982\u4f55\u6293\u53d6\u6570\u636e\u7684\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#31-\u76d1\u63a7\u6570\u636e\u6765\u6e90","title":"3.1 \u76d1\u63a7\u6570\u636e\u6765\u6e90","text":"<p>\u4ecePrometheus\u7684\u67b6\u6784\u4e2d\u4e86\u89e3\u5230\uff0cPrometheus\u901a\u5e38\u91c7\u7528Pull\u7684\u5f62\u5f0f\u6765\u62c9\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u88ab\u76d1\u63a7\u5e94\u7528\u53ea\u8981\u6709\u4e00\u4e2a\u80fd\u83b7\u53d6\u5230\u76d1\u63a7\u6570\u636e\u7684\u63a5\u53e3\uff0c\u5c31\u53ef\u4ee5\u91c7\u96c6\u5230\u76d1\u63a7\u6570\u636e\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u8bb2\u4e00\u4e0b\u8fd9\u4e2a\u63a5\u53e3\u4ece\u4f55\u800c\u6765\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u4ece\u4e8b\u4e91\u76f8\u5173\u7684\u5de5\u4f5c\uff0c\u80af\u5b9a\u90fd\u542c\u8bf4\u8fc7\u4e91\u539f\u751f\u8fd9\u4e2a\u8bcd\u8bed\uff0c\u5176\u4e2d\u4e91\u539f\u751f\u6d89\u53ca12\u4e2a\u5173\u952e\u8981\u7d20\uff0c\u5176\u4e2d\u4e00\u9879\u5c31\u662f\u5e94\u7528\u7684\u5f00\u53d1\u8005\u5728\u8fdb\u884c\u76f8\u5173\u7a0b\u5e8f\u5f00\u53d1\u65f6\uff0c\u8981\u8003\u8651\u7a0b\u5e8f\u672c\u8eab\u4e00\u4e9b\u5185\u90e8\u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u6bd4\u5982\u7a0b\u5e8f\u5f53\u524d\u7684\u8fde\u63a5\u6570\u3001\u8d44\u6e90\u5360\u7528\u60c5\u51b5\u7b49\uff0c\u6b64\u65f6\u53ef\u4ee5\u5f15\u7528Prometheus\u7684\u5ba2\u6237\u7aef\u5de5\u5177\u6765\u91c7\u96c6\u5e76\u66b4\u9732\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u57fa\u4e8e\u4e91\u539f\u751f\u7406\u5ff5\u5f00\u53d1\u7684\u7a0b\u5e8f\u81ea\u5df1\u4f1a\u66b4\u9732Metrics\u63a5\u53e3\uff0c\u5c31\u50cfKubernetes\u672c\u8eab\u7684\u7ec4\u4ef6\u3001Etcd\u7b49\uff0c\u90fd\u6709\u4e00\u4e2a/metrics\u63a5\u53e3\uff0cPrometheus\u53ea\u9700\u8981\u8bf7\u6c42\u8fd9\u4e2a\u63a5\u53e3\u5373\u53ef\u83b7\u53d6\u5230\u76f8\u5173\u6570\u636e\u3002</p> <p>\u57fa\u4e8e\u4e91\u539f\u751f\u7406\u5ff5\u5f00\u53d1\u7684\u7a0b\u5e8f\u5927\u90e8\u5206\u90fd\u6709\u76f8\u5173\u63a5\u53e3\uff0c\u4f46\u662f\u6709\u5f88\u591a\u5e94\u7528\u5e76\u975e\u662f\u57fa\u4e8e\u4e91\u539f\u751f\u7406\u5ff5\u5f00\u53d1\u7684\uff0c\u6240\u4ee5\u6ca1\u6709\u6b64\u7c7b\u63a5\u53e3\uff0c\u6bd4\u5982MySQL\u3001Redis\u7b49\u3002</p> <p>\u90a3\u4e48\u5982\u4f55\u91c7\u96c6\u8fd9\u7c7b\u7a0b\u5e8f\u7684\u76d1\u63a7\u6570\u636e\u5462\uff1f\u8fd9\u4e2a\u65f6\u5019\u5728\u8bb2\u89e3Prometheus\u67b6\u6784\u65f6\u63d0\u5230\u7684Exporter\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\uff0cExporter\u4e3b\u8981\u7528\u6765\u91c7\u96c6\u975e\u4e91\u539f\u751f\u5e94\u7528\u7684\u5185\u90e8\u6570\u636e\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u67d0\u4e9b\u673a\u5236\uff08\u6bd4\u5982\u8c03\u7528\u63a5\u53e3\u3001\u6267\u884c\u5ba2\u6237\u7aef\u547d\u540d\uff09\u6765\u83b7\u53d6\u5185\u90e8\u4e00\u4e9b\u6bd4\u8f83\u91cd\u8981\u7684\u6570\u636e\uff0c\u7136\u540e\u5c06\u5176\u8f6c\u6362\u6210Prometheus\u80fd\u591f\u8bc6\u522b\u7684\u6570\u636e\uff0c\u5e76\u4e14\u7531Exporter\u66b4\u9732/metrics\uff0c\u6b64\u65f6Prometheus\u5c31\u53ef\u4ee5\u91c7\u96c6\u5230\u7531Exporter\u66b4\u9732\u7684\u975e\u4e91\u539f\u751f\u5e94\u7528\u7684\u5185\u90e8\u8fd0\u884c\u72b6\u6001\u3002\u76ee\u524d\u6bd4\u8f83\u5e38\u7528\u7684Exporter\u5de5\u5177\u5982\u886815.1\u6240\u793a\u3002</p> <p>\u886815.1\u3000\u76ee\u524d\u6bd4\u8f83\u5e38\u7528\u7684Exporter\u5de5\u5177</p> <p></p> <p>\u5728\u5b89\u88c5\u4e86Prometheus Stack\u540e\uff0c\u9ed8\u8ba4\u4f1a\u5b89\u88c5\u4e00\u4e9b\u5e38\u7528\u7684\u76d1\u63a7\uff0c\u6bd4\u5982Kubernetes\u7ec4\u4ef6\u3001\u96c6\u7fa4\u72b6\u6001\u3001\u4e3b\u673a\u72b6\u6001\u7684\u76d1\u63a7\u7b49\u3002\u5176\u4e2dKubernetes\u7ec4\u4ef6\u662f\u57fa\u4e8e\u4e91\u539f\u751f\u7406\u5ff5\u5f00\u53d1\u7684\uff0c\u5b83\u81ea\u8eab\u63d0\u4f9b\u4e86Metrics\u63a5\u53e3\uff0c\u6bd4\u5982Kubelet\u7ec4\u4ef6\u53ef\u4ee5\u901a\u8fc7\u4e3b\u673a\u768410255\u7aef\u53e3\u8bbf\u95ee\u76d1\u63a7\u6570\u636e\uff1a</p> <pre><code>$ curl -s 127.0.0.1:10255/metrics| tail -5\n</code></pre> <p>\u5982\u679c\u8bfb\u8005\u7684Kubelet\u4e0d\u662f10255\u7aef\u53e3\uff0c\u53ef\u4ee5\u901a\u8fc7netstat\u67e5\u770b\u76d1\u542c\u7684\u7aef\u53e3\u53f7\uff1a</p> <pre><code>$ netstat -lnpt|grep kubelet\ntcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      96284/kubelet\ntcp6       0      0 :::10250                :::*                    LISTEN      96284/kubelet\n</code></pre> <p>\u4e4b\u540e\u5728Grafana\u9875\u9762\u5373\u53ef\u770b\u5230\u76f8\u5173\u7684\u76d1\u63a7\u6570\u636e\uff0c\u4f9d\u6b21\u5355\u51fbGeneral/Home\u2192Default\u2192Kubernetes/Kubelet\u5373\u53ef\u770b\u5230\u9762\u677f\uff0c\u5982\u56fe15.6\u6240\u793a\u3002</p> <p></p> <p>Kubernetes\u8282\u70b9\uff08\u4e5f\u5c31\u662f\u670d\u52a1\u5668\u672c\u8eab\uff09\u80af\u5b9a\u4e0d\u662f\u4e91\u539f\u751f\u5e94\u7528\uff0c\u6216\u8005\u8bf4\u5b83\u4e0d\u7b97\u4e00\u4e2a\u5e94\u7528\uff0c\u800c\u662f\u4e00\u4e2a\u7cfb\u7edf\uff0c\u90a3\u4e48\u7cfb\u7edf\u672c\u8eab\u80af\u5b9a\u6ca1\u6709\u7c7b\u4f3c\u7684Metrics\u63a5\u53e3\u3002</p> <p>\u6309\u7167\u4e4b\u524d\u7684\u8bb2\u89e3\uff0c\u9700\u8981\u6709\u4e00\u4e2aExporter\u91c7\u96c6\u5bbf\u4e3b\u673a\u4fe1\u606f\uff0c\u7136\u540e\u66b4\u9732\u7ed9Prometheus\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u4e13\u7528\u4e8e\u4e3b\u673a\u4fe1\u606f\u91c7\u96c6\u7684node-exporter\u5e94\u7528\u6765\u91c7\u96c6\u6570\u636e\uff0c\u5e76\u66b4\u9732Metrics\u63a5\u53e3\u7ed9Prometheus\u3002</p> <p>\u5b89\u88c5Prometheus Stack\u65f6\uff0c\u9ed8\u8ba4\u7528DaemonSet\u5b89\u88c5\u4e86node-exporter\uff0c\u5b83\u4f1a\u5728\u6bcf\u4e2aKubernetes\u8282\u70b9\u90e8\u7f72\u4e00\u4e2anode-exporter\uff1a</p> <pre><code>$ kubectl get ds -n monitoring\nNAME            DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE\nnode-exporter   9         9         9       9            9           kubernetes.io/os=linux   34m\n\n$ kubectl get pod -n monitoring|grep node-exporter\nnode-exporter-2f2h2                    2/2     Running   0          34m\nnode-exporter-2zcbr                    2/2     Running   0          34m\nnode-exporter-5txxx                    2/2     Running   0          34m\nnode-exporter-7wxp6                    2/2     Running   0          34m\nnode-exporter-99wrh                    2/2     Running   0          34m\nnode-exporter-dcfdn                    2/2     Running   0          34m\nnode-exporter-g7hl9                    2/2     Running   0          34m\nnode-exporter-hsgwx                    2/2     Running   0          34m\nnode-exporter-jp8qs                    2/2     Running   0          34m\n</code></pre> <p>\u6b64\u65f6\u53ef\u4ee5\u5728\u6bcf\u4e2a\u5bbf\u4e3b\u673a\u770b\u5230node-exporter\u76d1\u542c\u76849100\u7aef\u53e3\uff1a</p> <pre><code>$ netstat -lntp|grep node_exporter\ntcp        0      0 127.0.0.1:9100          0.0.0.0:*               LISTEN      40711/node_exporter\n</code></pre> <p>\u6b64\u65f6\u8bbf\u95ee9100\u5373\u53ef\u8bbf\u95ee\u5230\u4e3b\u673a\u7684\u76d1\u63a7\u4fe1\u606f\uff1a</p> <pre><code>$ curl -s 127.0.0.1:9100/metrics| tail -5\n# HELP promhttp_metric_handler_requests_total Total number of scrapes by HTTP status code.\n# TYPE promhttp_metric_handler_requests_total counter\npromhttp_metric_handler_requests_total{code=\"200\"} 281\npromhttp_metric_handler_requests_total{code=\"500\"} 0\npromhttp_metric_handler_requests_total{code=\"503\"} 0\n</code></pre> <p>\u540c\u65f6\u5728Grafana\u4e0a\u4e5f\u53ef\u4ee5\u770b\u5230\u76d1\u63a7\u9762\u677f,\u5355\u51fbGeneral/Home\u2192Default\u2192Node Exporter\u3002</p> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u7406\u89e3\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u9488\u5bf9\u4e91\u539f\u751f\u5e94\u7528\u6216\u975e\u4e91\u539f\u751f\u5e94\u7528\u7684\u76d1\u63a7\u6570\u636e\u6765\u6e90\uff0c\u4f46\u662fPrometheus\u662f\u5982\u4f55\u77e5\u9053\u8981\u91c7\u96c6\u54ea\u4e9b\u6570\u636e\u7684\u5462\uff1f\u63a5\u4e0b\u6765\u6211\u4eec\u4ecb\u7ecd\u5982\u4f55\u914d\u7f6ePrometheus\u91c7\u96c6\u6307\u5b9a\u76ee\u6807\u5e94\u7528\u7684\u76d1\u63a7\u6570\u636e\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#32-\u4ec0\u4e48\u662fservicemonitor","title":"3.2 \u4ec0\u4e48\u662fServiceMonitor","text":"<p>\u5982\u679c\u8bfb\u8005\u4f53\u9a8c\u8fc7\u5bb9\u5668\u5316\u6216\u8005\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u5b89\u88c5Prometheus\uff0c\u5c31\u4f1a\u6ce8\u610f\u5230Prometheus\u6709\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u4e8e\u914d\u7f6e\u9700\u8981\u76d1\u63a7\u54ea\u4e9b\u6570\u636e\uff0c\u6216\u8005\u914d\u7f6e\u4e00\u4e9b\u544a\u8b66\u7b56\u7565\u3002</p> <p>\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u7684\u7ef4\u62a4\u975e\u5e38\u9ebb\u70e6\uff0c\u7279\u522b\u662f\u76d1\u63a7\u9879\u975e\u5e38\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u5f88\u5bb9\u6613\u51fa\u73b0\u914d\u7f6e\u9519\u8bef\uff0c\u800c\u5728Kubernetes\u4e0a\u90e8\u7f72Prometheus\uff0c\u53ef\u4ee5\u4e0d\u7528\u53bb\u7ef4\u62a4\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u800c\u662f\u901a\u8fc7\u4e00\u4e2a\u53ebServiceMonitor\u7684\u8d44\u6e90\u6765\u81ea\u52a8\u53d1\u73b0\u76d1\u63a7\u76ee\u6807\u5e76\u52a8\u6001\u751f\u6210\u914d\u7f6e\u3002</p> <p>\u6bd4\u5982\u4e0a\u8ff0\u5c55\u793a\u7684Kubelet\u548cNodeExporter\u7684\u76d1\u63a7 \uff0c \u90fd\u6709\u4e00\u4e2aServiceMonitor\uff1a</p> <pre><code>$ kubectl get servicemonitor -n monitoring\nNAME                      AGE\nalertmanager              42m\nblackbox-exporter         42m\ncoredns                   42m\ngrafana                   42m\nkube-apiserver            42m\nkube-controller-manager   42m\nkube-scheduler            42m\nkube-state-metrics        42m\nkubelet                   42m\nnode-exporter             42m\nprometheus-adapter        42m\nprometheus-k8s            42m\nprometheus-operator       42m\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7-o\u547d\u4ee4\u67e5\u770b\u914d\u7f6e\u8be6\u60c5\uff1a</p> <pre><code>$ kubectl get servicemonitor -n monitoring kubelet -o yaml\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  creationTimestamp: \"2022-12-28T06:35:18Z\"\ngeneration: 1\nlabels:\n    app.kubernetes.io/name: kubelet\n  name: kubelet\n  namespace: monitoring\n  resourceVersion: \"269124093\"\nselfLink: /apis/monitoring.coreos.com/v1/namespaces/monitoring/servicemonitors/kubelet\n  uid: 0295ed26-49c4-4b15-ba92-f63a0bc5e7ec\nspec:\n  endpoints:\n  - bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token\n    honorLabels: true\ninterval: 30s\n    metricRelabelings:\n......\n\njobLabel: app.kubernetes.io/name\n  namespaceSelector:\n    matchNames:\n    - kube-system\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: kubelet\n</code></pre> <p>\u4e0a\u8ff0\u5c55\u793a\u7684\u662f\u4e00\u4e2aKubelet\u7684ServiceMonitor\u914d\u7f6e\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u7684kind\u914d\u7f6e\u4e3aServiceMonitor\uff0c\u5e76\u975e\u6807\u51c6\u7684Kubernetes\u63d0\u4f9b\u7684\u8d44\u6e90\u7c7b\u578b\u3002</p> <p>\u5728\u7b2c13\u7ae0\uff0c\u6211\u4eec\u8bb2\u8fc7Operator\u548cCRD\uff0cPrometheus Stack\u4e5f\u662f\u4e00\u79cdCRD\u548cOperator\u7684\u5b9e\u73b0\u3002\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7c7b\u578b\u4e3aServiceMonitor\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0cPrometheus\u7684Operator\u4f1a\u89e3\u6790\u8be5\u8d44\u6e90\u7c7b\u578b\u7684\u914d\u7f6e\uff0c\u7136\u540e\u52a8\u6001\u751f\u6210Prometheus\u7684\u914d\u7f6e\uff0c</p> <p>\u8fd9\u5c31\u662fServiceMonitor\u7684\u4f5c\u7528,\u5b83\u53ef\u4ee5\u8ba9\u6211\u4eec\u7528\u8d44\u6e90\u5b9a\u4e49\u7684\u65b9\u5f0f\u53bb\u914d\u7f6ePrometheus\u9700\u8981\u76d1\u63a7\u8c01\uff0c\u4e0d\u7528\u518d\u5904\u7406\u6210\u767e\u4e0a\u5343\u884c\u7684Prometheus\u914d\u7f6e\uff0c\u4e5f\u4e0d\u9700\u8981\u6bcf\u6b21\u66f4\u6539Prometheus\u914d\u7f6e\u540e\u91cd\u542fPrometheus\u5b9e\u4f8b\u3002</p> <p>\u63a5\u4e0b\u6765\u770b\u4e00\u4e2aServiceMonitor\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\nlabels:\nk8s-app: elasticsearch-exporter\nrelease: es-exporter\nname: es-exporter-elasticsearch-exporter\nnamespace: monitoring\nspec:\nendpoints:\n- honorLabels: true\ninterval: 10s\npath: /metrics\nport: http\nscheme: http\njobLabel: es-exporter\nnamespaceSelector:\nmatchNames:\n- monitoring\nselector:\nmatchLabels:\nk8s-app: elasticsearch-exporter\nrelease: es-exporter\n</code></pre> <ul> <li>honorLabels\uff1a\u5982\u679c\u76ee\u6807\u6807\u7b7e\u548c\u670d\u52a1\u5668\u6807\u7b7e\u51b2\u7a81\uff0c\u662f\u5426\u4fdd\u7559\u76ee\u6807\u6807\u7b7e\u3002</li> <li>interval\uff1a\u76d1\u63a7\u6570\u636e\u6293\u53d6\u7684\u65f6\u95f4\u95f4\u9694\u3002</li> <li>path\uff1aMetrics\u63a5\u53e3\u8def\u5f84\u3002</li> <li>port\uff1aMetrics\u7aef\u53e3\u3002</li> <li>scheme\uff1aMetrics\u63a5\u53e3\u7684\u534f\u8bae\u3002</li> <li>namespaceSelector\uff1a\u76d1\u63a7\u76ee\u6807Service\u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\u3002</li> <li>selector\uff1a\u76d1\u63a7\u76ee\u6807Service\u7684\u6807\u7b7e\u3002</li> </ul> <p>\u53cd\u8fc7\u6765\u518d\u770bKubelet\u7684ServiceMonitor\uff1a</p> <pre><code>  namespaceSelector:\nmatchNames:\n- kube-system\nselector:\nmatchLabels:\napp.kubernetes.io/name: kubelet\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8be5ServiceMonitor\u7684\u76d1\u63a7\u76ee\u6807\u662fkube-system\u547d\u540d\u7a7a\u95f4\u4e0b\u5177\u6709app.kubernetes.io/name=kubelet\u6807\u7b7e\u7684Service,\u6b64\u65f6\u53ef\u4ee5\u67e5 \u770b\u8be5Service\uff1a</p> <pre><code>$ kubectl get svc -n kube-system -l app.kubernetes.io/name=kubelet\nNAME      TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                        AGE\nkubelet   ClusterIP   None         &lt;none&gt;        10250/TCP,10255/TCP,4194/TCP   161m\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0c\u5728\u4f7f\u7528Prometheus\u76d1\u63a7\u5e94\u7528\u65f6\uff0c\u6709\u4e91\u539f\u751f\u548c\u975e\u4e91\u539f\u751f\u5e94\u7528\u4e4b\u5206\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u76d1\u63a7\u6570\u636e\u662f\u7531\u7a0b\u5e8f\u672c\u8eab\u63d0\u4f9b\u8fd8\u662f\u901a\u8fc7Exporter\u63d0\u4f9b\u3002\u5bf9\u4e8e\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u91c7\u7528\u4e0d\u540c\u7684\u7ba1\u63a7\u6d41\u7a0b\uff0c\u5177\u4f53\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u4e91\u539f\u751f\u5e94\u7528\uff1a\u627e\u5230\u672c\u8eab\u63d0\u4f9b\u7684Metrics\u63a5\u53e3\uff0c\u7136\u540e\u914d\u7f6e\u4e00\u4e2aService\u6307\u5411\u8be5\u5e94\u7528\u7684Pod\uff0c\u6700\u540e\u521b\u5efa\u4e00\u4e2aServiceMonitor\u6307\u5b9a\u8be5\u5e94\u7528\u7684Service\u5373\u53ef\u5b8c\u6210\u76d1\u63a7\u6570\u636e\u7684\u91c7\u96c6\u3002</p> </li> <li> <p>\u975e\u4e91\u539f\u751f\u5e94\u7528\uff1a\u9700\u8981\u627e\u5230\u5408\u9002\u8be5\u5e94\u7528\u7684Exporter\uff0c\u4e4b\u540eExporter\u94fe\u63a5\u81f3\u8be5\u5e94\u7528\u5e76\u91c7\u96c6\u76f8\u5173\u6570\u636e\uff0c\u7136\u540e\u914d\u7f6e\u4e00\u4e2aService\u6307\u5411\u8be5Exporter\u7684Pod\uff0c\u6700\u540e\u521b\u5efa\u4e00\u4e2aServiceMonitor\u6307\u5b9a\u8be5Exporter\u7684Service\u5373\u53ef\u5b8c\u6210\u76d1\u63a7\u6570\u636e\u7684\u91c7\u96c6\u3002</p> </li> </ul>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#33-servicemonitor\u627e\u4e0d\u5230\u76d1\u63a7\u4e3b\u673a\u6392\u67e5","title":"3.3 ServiceMonitor\u627e\u4e0d\u5230\u76d1\u63a7\u4e3b\u673a\u6392\u67e5","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u77e5\u9053\u4e86Prometheus\u76d1\u63a7\u5e94\u7528\u7684\u6d41\u7a0b\uff0c\u63a5\u4e0b\u6765\u8d81\u70ed\u6253\u94c1\u770b\u4e00\u4e2aKubernetes\u7ec4\u4ef6\u7684\u76d1\u63a7\u95ee\u9898\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u91c7\u7528\u7684\u662f\u4e8c\u8fdb\u5236\u65b9\u5f0f\u5b89\u88c5\u7684Kubernetes\u96c6\u7fa4\uff0c\u5b89\u88c5Prometheus\u540e\uff0ckube-controller-manager\u548ckube- scheduler\u53ef\u80fd\u5904\u4e8e\u65e0\u6cd5\u76d1\u63a7\u7684\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u627e\u4e0d\u5230\u76ee\u6807\u4e3b\u673a\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7Prometheus\u7684Web UI\u7684Status\u2192Service Discovery\u67e5\u770b\uff0c\u5982\u56fe15.7\u6240\u793a\u3002</p> <p></p> <p>\u540c\u65f6\u5728Alerts\u9875\u9762\u4e5f\u80fd\u770b\u5230Controller Manager\u548cScheduler\u7684\u544a\u8b66\uff0c\u5982\u56fe15.8\u6240\u793a\u3002</p> <p></p> <p>\u56fe15.8\u3000\u67e5\u770b\u544a\u8b66</p> <p>\u6b64\u65f6\u867d\u7136\u6709kube-controller-manager\u548ckube-scheduler\u7684\u76d1\u63a7\u914d\u7f6e\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u53d1\u73b0\u53ef\u7528\u7684\u76d1\u63a7\u76ee\u6807\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5206\u6790\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u627e\u4e0d\u5230\u76d1\u63a7\u76ee\u6807\u3002</p> <p>\u6ce8\u610f \u672c\u8282\u7684\u6392\u67e5\u601d\u8def\u662f\u901a\u7528\u6b65\u9aa4\uff0c\u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8econtroller\u548cscheduler\u3002</p> <p>\u5176\u6b21Kubernetes\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u9488\u5bf9controller\u548cscheduler\u7684\u95ee\u9898\u89e3\u51b3\u65b9\u5f0f\u53ef\u80fd\u5e76\u4e0d\u4e00\u81f4\uff0c\u4f46\u662fServiceMonitor\u627e\u4e0d\u5230\u4e3b\u673a\u7684\u6392\u67e5\u6b65\u9aa4\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u9996\u5148\u6211\u4eec\u6ce8\u610f\u5230Prometheus\u662f\u6709\u76f8\u5173\u914d\u7f6e\u7684\uff0c\u8bf4\u660eServiceMonitor\u5df2\u7ecf\u521b\u5efa\u6210\u529f\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a</p> <pre><code>$ kubectl get servicemonitors -n monitoring kube-controller-manager kube-scheduler\nNAME                      AGE\nkube-controller-manager   127m\nkube-scheduler            127m\n</code></pre> <p>\u63a5\u4e0b\u6765\u8fdb\u4e00\u6b65\u5206\u6790 ,\u9996\u5148\u67e5\u770bkube-controller-manager\u7684ServiceMonitor\u914d\u7f6e\uff1a</p> <pre><code>$ kubectl get servicemonitor -n monitoring kube-controller-manager -o yaml\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\n......\n    port: https-metrics\n    scheme: https\n    tlsConfig:\n      insecureSkipVerify: true\njobLabel: app.kubernetes.io/name\n  namespaceSelector:\n    matchNames:\n    - kube-system\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: kube-controller-manager\n</code></pre> <p>\u770b\u5230\u8be5ServiceMonitor \u5339\u914d\u7684\u662fkube-system \u547d\u540d\u7a7a\u95f4\u4e0b\u5177\u6709app.kubernetes.io/name=kubecontroller-manager\u7684\u6807\u7b7e\uff0c\u63a5\u4e0b\u6765\u901a\u8fc7\u8be5\u6807\u7b7e\u67e5\u770b\u662f\u5426\u6709\u8be5Service\uff1a</p> <pre><code>$ kubectl get svc -n kube-system -l app.kubernetes.io/name=kube-controller-manager\nNo resources found in kube-system namespace.\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5e76\u6ca1\u6709\u6b64\u6807\u7b7e\u7684Service\uff0c\u6240\u4ee5\u5bfc\u81f4\u627e\u4e0d\u5230\u9700\u8981\u76d1\u63a7\u7684\u76ee\u6807\uff0c\u6b64\u65f6\u53ef\u4ee5\u624b\u52a8\u521b\u5efa\u8be5Service\u548cEndpoint\u6307\u5411\u81ea\u5df1\u7684Controller Manager\uff1a</p> <p><code>kubernetesControlPlane-serviceMonitorKubeControllerManager.yaml</code></p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\nnamespace: kube-system\nname: kube-controller-manager\nlabels:\napp.kubernetes.io/name: kube-controller-manager\nspec:\nselector:\ncomponent: kube-controller-manager\nports:\n- name: https-metrics\nport: 10257\ntargetPort: 10257 # controller-manager \u7684\u5b89\u5168\u7aef\u53e3\u4e3a10257\n</code></pre> <p>\u6ce8\u610f\u9700\u8981\u66f4\u6539Endpoint\u914d\u7f6e\u7684YOUR_CONTROLLER_IP\u4e3a\u81ea\u5df1\u7684Controller Manager\u7684IP\uff0c\u63a5\u4e0b\u6765\u521b\u5efa\u8be5Service\u548cEndpoint\uff1a</p> <pre><code>$ kubectl create -f kubernetesControlPlane-serviceMonitorKubeControllerManager.yaml\nservice/kube-controller-manager created\n</code></pre> <p>\u67e5\u770b\u521b\u5efa\u7684Service\u548cEndpoint\uff1a</p> <pre><code>$ kubectl get svc -n kube-system kube-controller-manager\nNAME                      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)     AGE\nkube-controller-manager   ClusterIP   10.99.49.192   &lt;none&gt;        10257/TCP   37s\n</code></pre> <p>\u6b64\u65f6\u8be5Service\u53ef\u80fd\u662f\u4e0d\u901a\u7684\uff0c\u56e0\u4e3a\u5728\u96c6\u7fa4\u642d\u5efa\u65f6\uff0cController Manager\u548cScheduler\u76d1\u542c\u7684\u53ef\u80fd\u662f127.0.0.1\uff0c\u5bfc\u81f4\u65e0\u6cd5\u88ab\u5916\u90e8\u8bbf\u95ee\uff0c\u6b64\u65f6\u9700\u8981\u66f4\u6539\u5b83\u7684\u76d1\u542c\u5730\u5740\u4e3a0.0.0.0\uff08\u5982\u679c\u8bfb\u8005\u7684\u96c6\u7fa4\u539f\u672c\u76d1\u542c\u7684\u5c31\u662f0.0.0.0\uff0c\u5219\u65e0\u987b\u66f4\u6539\uff0ckubeadm\u5b89\u88c5\u65b9\u5f0f\u914d\u7f6e\u6587\u4ef6\u5728/etc/kubernetes/manifests\u76ee\u5f55\uff09\uff1a</p> <pre><code>$ sed -i 's#address=127.0.0.1#address=0.0.0.0#g' /usr/lib/systemd/system/kube-controller-manager.service\n$ systemctl daemon-reload\n$ systemctl restart kube-controller-manager\n</code></pre> <p>\u5982\u679c\u4f7f\u7528kubeadm\u542f\u52a8\u7684\u96c6\u7fa4\uff0c\u521d\u59cb\u5316\u65f6\u52a0\u5165\u5982\u4e0b\u53c2\u6570</p> <pre><code>controllerManagerExtraArgs:\n  address: 0.0.0.0\nschedulerExtraArgs:\n  address: 0.0.0.0\n</code></pre> <p>\u5982\u679c\u662f\u5df2\u7ecf\u542f\u52a8\u4e4b\u540e\u7684\u96c6\u7fa4\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u4fee\u6539</p> <pre><code>$ sed -e \"s/- --address=127.0.0.1/- --address=0.0.0.0/\" -i /etc/kubernetes/manifests/kube-controller-manager.yaml\n$ sed -e \"s/- --address=127.0.0.1/- --address=0.0.0.0/\" -i /etc/kubernetes/manifests/kube-scheduler.yaml\n</code></pre> <p>\u63d0\u793a \u5982\u679c\u8bfb\u8005\u7684Kubernetes\u7248\u672c\u5927\u4e8e1.22\uff0c\u5230\u6b64\u6b65\u9aa4\u540e\uff0ccontroller\u7684\u95ee\u9898\u5c31\u5df2\u7ecf\u89e3\u51b3\u4e86\u3002</p> <p>\u901a\u8fc7\u8be5Service\u7684ClusterIP\u8bbf\u95eeController Manager\u7684Metrics\u63a5\u53e3\uff1a</p> <pre><code>$ kubectl get svc -n kube-system kube-controller-manager\nNAME                      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)     AGE\nkube-controller-manager   ClusterIP   10.99.49.192   &lt;none&gt;        10257/TCP   37s\n\n$ curl -s 10.99.49.192:10257/metrics| tail -1\n</code></pre> <p>\u5230\u6b64\u65f6\uff0c\u8bfb\u8005\u53ef\u80fd\u4f1a\u4ee5\u4e3a\u6709\u4e86\u8fd9\u4e2aService\u4e4b\u540e\uff0cPrometheus\u5c31\u80fd\u53d1\u73b0\u8be5\u76ee\u6807\uff0c\u4f46\u5176\u5b9e\u4e0d\u7136\uff0c\u7ec6\u5fc3\u7684\u8bfb\u8005\u4f1a\u53d1\u73b0ServiceMonitor\u7684port\u548cscheme\u914d\u7f6e\u7684\u548c\u8be5Service\u7684\u4e0d\u4e00\u81f4\u3002</p> <p>\u5728\u521b\u5efaService\u4e4b\u524d\uff0c\u5982\u679c\u8bfb\u8005\u7684\u96c6\u7fa4\u5df2\u7ecf\u6709\u4e86\u7b26\u5408ServiceMonitor\u9009\u62e9\u7684Service\uff0c\u4f9d\u65e7\u4e0d\u80fd\u53d1\u73b0\u76d1\u63a7\u76ee\u6807\uff0c\u5c31\u9700\u8981\u68c0\u67e5\u7aef\u53e3\u548c\u534f\u8bae\u662f\u5426\u548cService\u914d\u7f6e\u7684\u4e00\u81f4\u3002\u66f4\u6539ServiceMonitor\u7684\u914d\u7f6e\u548cService\u4e00\u81f4\uff0c\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>    port: https-metrics\nscheme: https\ntlsConfig:\ninsecureSkipVerify: true\n</code></pre> <p>\u914d\u7f6eService Monitor</p> <pre><code>$ kubectl edit servicemonitor kube-controller-manager -n monitoring\n</code></pre> <p>\u7b49\u5f85\u51e0\u5206\u949f\u540e\uff0c \u5c31\u53ef\u4ee5\u5728Prometheus \u7684Web UI\u4e0a\u770b\u5230Controller Manager\u7684\u76d1\u63a7\u76ee\u6807\uff0c\u5982\u56fe15.10\u548c\u56fe15.11\u6240\u793a\u3002</p> <p> \u56fe15.10\u3000\u67e5\u770bTargets</p> <p> \u56fe15.11\u3000\u67e5\u770bService Discovery</p> <p>\u53c2\u8003</p> <p>https://p8s.io/docs/operator/install/</p> <p>\u6b64\u65f6\u544a\u8b66\u4e5f\u4f1a\u6d88\u5931\uff0cGrafana\u4e5f\u80fd\u67e5\u770b\u5230Controller Manager\u7684\u76d1\u63a7\u6570\u636e\u3002Scheduler\u7684\u6392\u67e5\u548cController Manager\u4e00\u81f4\u3002</p> <p><code>kubernetesControlPlane-serviceMonitorKubeScheduler.yaml</code></p> <pre><code>apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\nlabels:\napp.kubernetes.io/name: kube-scheduler\napp.kubernetes.io/part-of: kube-prometheus\nname: kube-scheduler\nnamespace: monitoring\nspec:\nendpoints:\n- bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token\ninterval: 30s\nport: https-metrics\nscheme: https\ntlsConfig:\ninsecureSkipVerify: true\njobLabel: app.kubernetes.io/name\nnamespaceSelector:\nmatchNames:\n- kube-system\nselector:\nmatchLabels:\napp.kubernetes.io/name: kube-scheduler\n---\napiVersion: v1\nkind: Service\nmetadata:\nnamespace: kube-system\nname: kube-scheduler\nlabels: # \u5fc5\u987b\u548c\u4e0a\u9762\u7684 ServiceMonitor \u4e0b\u9762\u7684 matchLabels \u4fdd\u6301\u4e00\u81f4\napp.kubernetes.io/name: kube-scheduler\nspec:\nselector:\ncomponent: kube-scheduler\nports:\n- name: https-metrics\nport: 10259\n# \u9700\u8981\u6ce8\u610f\u73b0\u5728\u7248\u672c\u9ed8\u8ba4\u7684\u5b89\u5168\u7aef\u53e3\u662f10259\ntargetPort: 10259 </code></pre> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u901a\u8fc7ServiceMonitor\u76d1\u63a7\u5e94\u7528\u65f6\uff0c\u5982\u679c\u76d1\u63a7\u6ca1\u6709\u627e\u5230\u76ee\u6807\u4e3b\u673a\u7684\u6392\u67e5\u6b65\u9aa4\uff0c\u6392\u67e5\u6b65\u9aa4\u5927\u81f4\u5982\u4e0b\uff1a</p> <ul> <li>\u786e\u8ba4ServiceMonitor\u662f\u5426\u6210\u529f\u521b\u5efa\u3002</li> <li>\u786e\u8ba4Prometheus\u662f\u5426\u751f\u6210\u4e86\u76f8\u5173\u914d\u7f6e\u3002</li> <li>\u786e\u8ba4\u5b58\u5728ServiceMonitor\u5339\u914d\u7684Service\u3002</li> <li>\u786e\u8ba4\u901a\u8fc7Service\u80fd\u591f\u8bbf\u95ee\u7a0b\u5e8f\u7684Metrics\u63a5\u53e3\u3002</li> <li>\u786e\u8ba4Service\u7684\u7aef\u53e3\u548cScheme\u3001ServiceMonitor\u4e00\u81f4\u3002</li> </ul>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#34-\u4e91\u539f\u751f\u5e94\u7528\u76d1\u63a7","title":"3.4 \u4e91\u539f\u751f\u5e94\u7528\u76d1\u63a7","text":"<p>\u901a\u8fc7\u524d\u9762\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u5bf9Prometheus\u76f8\u5173\u77e5\u8bc6\u505a\u4e86\u4e00\u4e9b\u4e86\u89e3\uff0c\u4e5f\u7406\u89e3\u4e86\u4e91\u539f\u751f\u548c\u975e\u4e91\u539f\u751f\u5e94\u7528\u7684\u76d1\u63a7\u6d41\u7a0b\uff0c\u63a5\u4e0b\u6765\u901a\u8fc7\u4e24\u4e2a\u793a\u4f8b\u6f14\u793a\u5e94\u7528\u76d1\u63a7\u7684\u57fa\u672c\u6d41\u7a0b\u3002</p> <p>\u9664\u4e86 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u4e00\u4e9b\u8d44\u6e90\u5bf9\u8c61\u3001\u8282\u70b9\u4ee5\u53ca\u7ec4\u4ef6\u9700\u8981\u76d1\u63a7\uff0c\u6709\u7684\u65f6\u5019\u6211\u4eec\u53ef\u80fd\u8fd8\u9700\u8981\u6839\u636e\u5b9e\u9645\u7684\u4e1a\u52a1\u9700\u6c42\u53bb\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684\u76d1\u63a7\u9879\uff0c\u6dfb\u52a0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u76d1\u63a7\u7684\u6b65\u9aa4\u4e5f\u662f\u975e\u5e38\u7b80\u5355\u7684\u3002</p> <p>\u7b2c\u4e00\u6b65\u5efa\u7acb\u4e00\u4e2a ServiceMonitor \u5bf9\u8c61\uff0c\u7528\u4e8e Prometheus \u6dfb\u52a0\u76d1\u63a7\u9879</p> <p>\u7b2c\u4e8c\u6b65\u4e3a ServiceMonitor \u5bf9\u8c61\u5173\u8054 metrics \u6570\u636e\u63a5\u53e3\u7684\u4e00\u4e2a Service \u5bf9\u8c61</p> <p>\u7b2c\u4e09\u6b65\u786e\u4fdd Service \u5bf9\u8c61\u53ef\u4ee5\u6b63\u786e\u83b7\u53d6\u5230 metrics \u6570\u636e</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u4e3a\u5927\u5bb6\u6f14\u793a\u5982\u4f55\u6dfb\u52a0 etcd \u96c6\u7fa4\u7684\u76d1\u63a7\u3002\u65e0\u8bba\u662f Kubernetes \u96c6\u7fa4\u5916\u7684\u8fd8\u662f\u4f7f\u7528 kubeadm \u5b89\u88c5\u5728\u96c6\u7fa4\u5185\u90e8\u7684 etcd \u96c6\u7fa4\uff0c\u6211\u4eec\u8fd9\u91cc\u90fd\u5c06\u5176\u89c6\u4f5c\u96c6\u7fa4\u5916\u7684\u72ec\u7acb\u96c6\u7fa4\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u4e8c\u8005\u7684\u4f7f\u7528\u65b9\u6cd5\u6ca1\u4ec0\u4e48\u7279\u6b8a\u4e4b\u5904\u3002</p> <p>\u5728\u5b89\u88c5Prometheus\u65f6\uff0c\u5e76\u6ca1\u6709\u5bf9Etcd\u96c6\u7fa4\u8fdb\u884c\u76d1\u63a7\uff0cEtcd\u96c6\u7fa4\u662fKubernetes\u7684\u6570\u636e\u5e93\uff0c\u638c\u63e1\u7740Kubernetes\u6700\u6838\u5fc3\u7684\u6570\u636e\uff0cEtcd\u7684\u72b6\u6001\u548c\u6027\u80fd\u76f4\u63a5\u5f71\u54cdKubernetes\u96c6\u7fa4\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u5bf9Etcd\u96c6\u7fa4\u7684\u76d1\u63a7\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7Etcd\u7684\u76d1\u63a7\u5b66\u4e60\u5982\u4f55\u5bf9\u4e91\u539f\u751f\u5e94\u7528\u8fdb\u884c\u76d1\u63a7\u3002</p> <p>\u4e4b\u524d\u8bb2\u4e86\uff0c\u4e91\u539f\u751f\u5e94\u7528\u4f1a\u63d0\u4f9b\u4e00\u4e2aMetrics\u63a5\u53e3\uff0c\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u5230\u5185\u90e8\u7684\u8fd0\u884c\u4fe1\u606f\uff0c\u6bd4\u5982Etcd\u7684\u5185\u90e8\u6570\u636e\u53ef\u4ee5\u901a\u8fc72379\u7684/metrics\u5f97\u5230\uff0c\u548c\u4e4b\u524d\u7684kubelet\u7c7b\u4f3c\u3002\u4e0d\u540c\u7684\u662f\uff0cEtcd\u5bf9\u5916\u7684\u63a5\u53e3\u5fc5\u987b\u901a\u8fc7HTTPS\u534f\u8bae\u8bbf\u95ee\uff0c\u6240\u4ee5\u5728\u8bf7\u6c42\u65f6\u9700\u8981\u52a0\u4e0a\u5bf9\u5e94\u7684\u8bc1\u4e66\uff0c\u6bd4\u5982\uff1a</p> <pre><code>$ curl -s --cert /etc/kubernetes/pki/etcd/etcd.pem --key /etc/kubernetes/pki/etcd/etcd-key.pem https://YOUR_ETCD_IP:2379/metrics -k | tail -1\n</code></pre> <p>\u8bc1\u4e66\u7684\u4f4d\u7f6e\u53ef\u4ee5\u5728Etcd\u914d\u7f6e\u6587\u4ef6\u4e2d\u83b7\u5f97\uff08\u6ce8\u610f\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u4e0d\u540c\u7684\u96c6\u7fa4\u4f4d\u7f6e\u53ef\u80fd\u4e0d\u540c \uff0c Kubeadm \u5b89 \u88c5 \u65b9 \u5f0f \u53ef \u80fd \u4f1a\u5728/etc/kubernetes/manifests/etcd.yml\u4e2d)\uff1a</p> <pre><code>$ grep -E \"key-file|cert-file\" /etc/kubernetes/manifests/etcd.yaml\n    - --cert-file=/etc/kubernetes/pki/etcd/server.crt\n    - --key-file=/etc/kubernetes/pki/etcd/server.key\n    - --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt\n    - --peer-key-file=/etc/kubernetes/pki/etcd/peer.key\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6b64\u65f6\u52a0\u4e0a--cert\u548c--key\u53c2\u6570\u624d\u53ef\u4ee5\u8bbf\u95eeEtcd\u7684Metrics\u63a5\u53e3\uff0c\u6240\u4ee5\u5728\u914d\u7f6eServiceMonitor\u65f6\u9700\u8981\u52a0\u4e0a\u8bc1\u4e66\u7684\u914d\u7f6e\u3002</p> <p>1\uff0e\u521b\u5efaEtcd ServiceMonitor</p> <p>\u9996\u5148\uff0c\u9700\u8981\u914d\u7f6eEtcd\u7684Service\u548cEndpoint\uff1a</p> <p><code>kubernetesControlPlane-serviceMonitorEtcd.yaml</code></p> <pre><code>apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\nname: etcd-k8s\nnamespace: monitoring\nlabels:\nk8s-app: etcd-k8s\nspec:\njobLabel: k8s-app\nendpoints:\n- port: port\ninterval: 15s\nselector:\nmatchLabels:\nk8s-app: etcd\nnamespaceSelector:\nmatchNames:\n- kube-system\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u5c06YOUR_ETCD_IP\u6539\u6210\u81ea\u5df1\u7684Etcd\u4e3b\u673aIP\uff0c\u53e6\u5916\u9700\u8981\u6ce8\u610fport\u7684\u540d\u79f0\u4e3ahttps-metrics\uff0c\u8981\u548c\u540e\u9762\u7684ServiceMonitor\u4fdd\u6301\u4e00\u81f4\u3002\u4e4b\u540e\u521b\u5efa\u8be5\u8d44\u6e90\u5e76\u67e5\u770bService\u7684ClusterIP\uff1a</p> <pre><code>$ kubectl create -f kubernetesControlPlane-serviceMonitorEtcd.yaml\nservicemonitor.monitoring.coreos.com/etcd-k8s created\n</code></pre> <p>2.\u521b\u5efaEtcd Service</p> <p>\u4f46\u5b9e\u9645\u4e0a\u73b0\u5728\u5e76\u4e0d\u80fd\u76d1\u63a7\u5230 etcd \u96c6\u7fa4\uff0c\u56e0\u4e3a\u5e76\u6ca1\u6709\u4e00\u4e2a\u6ee1\u8db3 ServiceMonitor \u6761\u4ef6\u7684 Service \u5bf9\u8c61\u4e0e\u4e4b\u5173\u8054\uff1a</p> <pre><code>$ kubectl get svc -n kube-system -l k8s-app=etcd\nNo resources found in kube-system namespace.\n</code></pre> <p>\u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u6ee1\u8db3\u4e0a\u9762\u6761\u4ef6\u7684 Service \u5bf9\u8c61\uff0c\u7531\u4e8e\u6211\u4eec\u628a etcd \u5f53\u6210\u662f\u96c6\u7fa4\u5916\u90e8\u7684\u670d\u52a1\uff0c\u6240\u4ee5\u8981\u5f15\u5165\u5230\u96c6\u7fa4\u4e2d\u6765\u6211\u4eec\u5c31\u9700\u8981\u81ea\u5b9a\u4e49 Endpoints \u5bf9\u8c61\u6765\u521b\u5efa Service \u5bf9\u8c61\u4e86\uff1a</p> <p><code>etcd-service.yaml</code></p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\nname: etcd-k8s\nnamespace: kube-system\nlabels:\nk8s-app: etcd\nspec:\ntype: ClusterIP\nclusterIP: None # \u4e00\u5b9a\u8981\u8bbe\u7f6e clusterIP:None\nports:\n- name: port\nport: 2381\n---\napiVersion: v1\nkind: Endpoints\nmetadata:\nname: etcd-k8s\nnamespace: kube-system\nlabels:\nk8s-app: etcd\nsubsets:\n- addresses:\n- ip: 192.168.1.56 # \u6307\u5b9aetcd\u8282\u70b9\u5730\u5740\uff0c\u5982\u679c\u662f\u96c6\u7fa4\u5219\u7ee7\u7eed\u5411\u4e0b\u6dfb\u52a0\nnodeName: etc-master\nports:\n- name: port\nport: 2381\n</code></pre> <pre><code>$ kubectl create -f etcd-service.yaml\nservice/etcd-k8s created\nendpoints/etcd-k8s created\n</code></pre> <p>\u6211\u4eec\u8fd9\u91cc\u521b\u5efa\u7684 Service \u6ca1\u6709\u91c7\u7528\u524d\u9762\u901a\u8fc7 label \u6807\u7b7e\u7684\u5f62\u5f0f\u53bb\u5339\u914d Pod \u7684\u505a\u6cd5\uff0c\u56e0\u4e3a\u524d\u9762\u6211\u4eec\u8bf4\u8fc7\u5f88\u591a\u65f6\u5019\u6211\u4eec\u521b\u5efa\u7684 etcd \u96c6\u7fa4\u662f\u72ec\u7acb\u4e8e\u96c6\u7fa4\u4e4b\u5916\u7684\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u9762\u6211\u4eec\u5c31\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e2a Endpoints\uff0c\u8981\u6ce8\u610f <code>metadata</code> \u533a\u57df\u7684\u5185\u5bb9\u8981\u548c Service \u4fdd\u6301\u4e00\u81f4\uff0cService \u7684 clusterIP \u8bbe\u7f6e\u4e3a None\uff0c\u65b0\u7248\u672c\u7684 etcd \u5c06 metrics \u63a5\u53e3\u6570\u636e\u653e\u7f6e\u5230\u4e86 2381 \u7aef\u53e3\u3002\u76f4\u63a5\u521b\u5efa\u8be5\u8d44\u6e90\u5bf9\u8c61\u5373\u53ef\uff1a</p> <pre><code>$ kubectl get svc -n kube-system -l k8s-app=etcd\nNAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\netcd-k8s   ClusterIP   None         &lt;none&gt;        2381/TCP   37s\n</code></pre> <p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u9694\u4e00\u4f1a\u513f\u53bbPrometheus\u7684Dashboard\u4e2d\u67e5\u770btargets\uff0c\u4fbf\u4f1a\u6709etcd\u7684\u76d1\u63a7\u9879\u4e86\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e2a\u660e\u663e\u7684\u9519\u8bef\uff0c2381 \u7aef\u53e3\u94fe\u63a5\u88ab\u62d2\u7edd\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u8fd9\u91cc\u7684 etcd \u7684 metrics \u63a5\u53e3\u662f\u76d1\u542c\u5728 <code>127.0.0.1</code> \u8fd9\u4e2a IP \u4e0a\u9762\u7684\uff0c\u6240\u4ee5\u8bbf\u95ee\u4f1a\u62d2\u7edd\uff1a</p> <pre><code>--listen-metrics-urls=http://127.0.0.1:2381\n</code></pre> <p>\u6211\u4eec\u53ea\u9700\u8981\u5728 <code>/etc/kubernetes/manifests/</code>\u76ee\u5f55\u4e0b\u9762\uff08\u9759\u6001Pod\u9ed8\u8ba4\u7684\u76ee\u5f55\uff09\u7684 <code>etcd.yaml</code> \u6587\u4ef6\u4e2d\u5c06\u4e0a\u9762\u7684<code>listen-metrics-urls</code> \u66f4\u6539\u6210\u8282\u70b9IP\u5373\u53ef\uff1a</p> <pre><code>--listen-metrics-urls=http://0.0.0.0:2381\n</code></pre> <p>\u5f53etcd\u91cd\u542f\u751f\u6548\u540e\uff0c\u67e5\u770betcd\u8fd9\u4e2a\u76d1\u63a7\u4efb\u52a1\u5c31\u6b63\u5e38\u4e86\uff1a </p> <p>3\uff0e\u914d\u7f6eGrafana</p> <p>\u4f9d\u6b21\u5355\u51fb\u201c+\u201d\u2192Import\uff0c\u4e4b\u540e\u8f93\u5165Etcd\u7684Grafana Dashboard\u5730\u5740</p> <p>\u6570\u636e\u91c7\u96c6\u5230\u540e\uff0c\u53ef\u4ee5\u5728 grafana \u4e2d\u5bfc\u5165\u7f16\u53f7\u4e3a <code>3070</code> \u7684 dashboard\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230 etcd \u7684\u76d1\u63a7\u56fe\u8868\uff1a</p> <p>\u4e4b\u540e\u5c31\u53ef\u4ee5\u770b\u5230Etcd\u96c6\u7fa4\u7684\u72b6\u6001\uff0c\u5982\u56fe15.16\u6240\u793a\u3002</p> <p></p> <p>\u56fe15.16\u3000\u67e5\u770bEtcd\u76d1\u63a7</p> <p>\u53c2\u8003\u6587\u732e</p> <p>https://p8s.io/docs/operator/custom/?h=etc#etcd-%E7%9B%91%E6%8E%A7</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#35-\u975e\u4e91\u539f\u751f\u76d1\u63a7exporter","title":"3.5 \u975e\u4e91\u539f\u751f\u76d1\u63a7Exporter","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u9488\u5bf9\u4e91\u539f\u751f\u5e94\u7528Etcd\u8fdb\u884c\u4e86\u76d1\u63a7\uff0c\u53ef\u4ee5\u770b\u5230\u7b26\u5408\u4e91\u539f\u751f\u8981\u7d20\u5f00\u53d1\u7684\u5e94\u7528\uff0c\u81ea\u5e26\u7684\u90fd\u6709\u4e00\u4e2aMetrics\u63a5\u53e3\uff0c\u53ef\u4ee5\u8ba9\u76d1\u63a7\u5e73\u53f0\u76f4\u63a5\u91c7\u96c6\u5230\u76d1\u63a7\u6570\u636e\u3002</p> <p>\u800c\u975e\u539f\u751f\u5e94\u7528\uff08\u5982MySQL\u3001Redis\u3001Kakfa\u7b49\uff09\u6ca1\u6709\u66b4\u9732Metrics\u63a5\u53e3\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u5bf9\u5e94\u7684Exporter\u91c7\u96c6\u6570\u636e\uff0c\u5e76\u66b4\u9732Metrics\u63a5\u53e3\u3002\u672c\u5c0f\u8282\u5c06\u4f7f\u7528MySQL\u4f5c\u4e3a\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u4f7f\u7528Exporter\u76d1\u63a7\u975e\u4e91\u539f\u751f\u5e94\u7528\u3002</p> <p>1\uff0e\u90e8\u7f72\u6d4b\u8bd5\u7528\u4f8b</p> <p>\u9996\u5148\u90e8\u7f72MySQL\u81f3Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u5982\u679c\u8bfb\u8005\u6709\u9700\u8981\u76d1\u63a7\u7684MySQL\uff0c\u53ef\u4ee5\u5ffd\u7565\u6b64\u6b65\u9aa4\uff0c\u76f4\u63a5\u914d\u7f6eMySQL\u7684\u6743\u9650\u5373\u53ef\uff1a</p> <pre><code>$ kubectl create deploy mysql --image=registry.cn-beijing.aliyuncs.com/dotbalo/mysql:5.7.23\ndeployment.apps/mysql created\n\n$ kubectl set env deploy/mysql MYSQL_ROOT_PASSWORD=mysql\ndeployment.apps/mysql env updated\n\n# \u67e5\u770bpod\u662f\u5426\u6b63\u5e38\n$ kubectl get po -l app=mysql\nNAME                     READY   STATUS    RESTARTS   AGE\nmysql-69d6f69557-8hdg6   1/1     Running   0          52s\n</code></pre> <p>\u521b\u5efaService\u66b4\u9732MySQL\uff1a</p> <pre><code>$ kubectl expose deploy mysql --port 3306\nservice/mysql exposed\n\n$ kubectl get svc -l app=mysql\nNAME    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\nmysql   ClusterIP   10.110.161.154   &lt;none&gt;        3306/TCP   24s\n</code></pre> <p>\u68c0\u67e5Service\u662f\u5426\u53ef\u7528\uff1a</p> <pre><code>$ telnet 10.110.161.154 3306\nTrying 10.110.161.154...\nConnected to 10.110.161.154.\nEscape character is '^]'.\nJ\n5.7.23/adMH4SqV,w+b'y?E8mysql_native_password\n</code></pre> <p>\u767b\u5f55MySQL\uff0c\u521b\u5efaExporter\u6240\u9700\u7684\u7528\u6237\u548c\u6743\u9650\uff08\u5982\u679c\u5df2\u7ecf\u6709\u9700\u8981\u76d1\u63a7\u7684MySQL\uff0c\u76f4\u63a5\u6267\u884c\u6b64\u6b65\u9aa4\u5373\u53ef\uff09\uff1a</p> <pre><code>$ kubectl exec -ti mysql-69d6f69557-5vnvg -- bash\nroot@mysql-69d6f69557-5vnvg:/# mysql -uroot -pmysql\n\nmysql&gt; CREATE USER 'exporter'@'%' IDENTIFIED BY 'exporter' WITH MAX_USER_CONNECTIONS 3;\nQuery OK, 0 rows affected (0.00 sec)\nmysql&gt; GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'exporter'@'%';\nQuery OK, 0 rows affected (0.00 sec)\nmysql&gt; quit\nBye\nroot@mysql-69d6f69557-5vnvg:/# exit\nexit\n</code></pre> <p>\u914d\u7f6eMySQL Exporter\u91c7\u96c6MySQL\u76d1\u63a7\u6570\u636e\uff1a</p> <p>mysql-exporter.yaml</p> <pre><code>---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: mysql-exporter\nnamespace: monitoring\nspec:\nreplicas: 1\nselector:\nmatchLabels:\nk8s-app: mysql-exporter\ntemplate:\nmetadata:\nlabels:\nk8s-app: mysql-exporter\nspec:\ncontainers:\n- name: mysql-exporter\nimage: registry.cn-beijing.aliyuncs.com/dotbalo/mysqld-exporter env:\n- name: DATA_SOURCE_NAME\nvalue: \"root:mysql@(mysql.default:3306)/\"\nimagePullPolicy: IfNotPresent\nports:\n- containerPort: 9104\n---\napiVersion: v1\nkind: Service\nmetadata:\nname: mysql-exporter\nnamespace: monitoring\nlabels:\nk8s-app: mysql-exporter\nspec:\ntype: ClusterIP\nselector:\nk8s-app: mysql-exporter\nports:\n- name: api\nport: 9104\nprotocol: TCP\n</code></pre> <p>\u6ce8 \u610f DATA_SOURCE_NAME \u7684 \u914d \u7f6e \uff0c \u9700\u8981\u5c06 <code>exporter:exporter@(mysql.default:3306)/</code>\u6539\u6210\u81ea\u5df1\u7684\u5b9e\u9645\u914d\u7f6e\uff0c\u683c\u5f0f\u4e3a\uff1a <code>USERNAME:PASSWORD@MYSQL_HOST_ADDRESS:MYSQL_PORT</code>\u3002</p> <p>\u521b\u5efaExporter\uff1a</p> <pre><code>$ kubectl create -f mysql-exporter.yaml\ndeployment.apps/mysql-exporter created\nservice/mysql-exporter created\n\n$ kubectl get -f mysql-exporter.yaml\nNAME                             READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/mysql-exporter   1/1     1            1           9s\n\nNAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\nservice/mysql-exporter   ClusterIP   10.105.237.248   &lt;none&gt;        9104/TCP   9s\n</code></pre> <p>\u901a\u8fc7\u8be5Service\u5730\u5740\u68c0\u67e5\u662f\u5426\u80fd\u6b63\u5e38\u83b7\u53d6Metrics\u6570\u636e\uff1a</p> <pre><code>$ curl -s 10.105.237.248:9104/metrics | tail -1\npromhttp_metric_handler_requests_total{code=\"503\"} 0\n</code></pre> <p>2\uff0e\u914d\u7f6eServiceMonitor\u548cGrafana</p> <p>\u914d\u7f6eExporter\u540e\uff0cMetrics\u63a5\u53e3\u5df2\u7ecf\u6709\u4e86\uff0c\u5269\u4e0b\u7684\u914d\u7f6e\u5176\u5b9e\u548c\u4e91\u539f\u751f\u76d1\u63a7\u6d41\u7a0b\u5df2\u7ecf\u4e00\u6837\u4e86\u3002</p> <p>\u9996\u5148\u914d\u7f6eServiceMonitor\uff0c\u7136\u540e\u5bfc\u5165Grafana Dashboard\u5373\u53ef\u3002\u914d\u7f6eServiceMonitor\uff1a</p> <p>mysql-sm.yaml</p> <pre><code>apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\nname: mysql-exporter\nnamespace: monitoring\nlabels:\nk8s-app: mysql-exporter\nnamespace: monitoring\nspec:\njobLabel: k8s-app\nendpoints:\n- port: api\ninterval: 30s\nscheme: http\nselector:\nmatchLabels:\nk8s-app: mysql-exporter\nnamespaceSelector:\nmatchNames:\n- monitoring\n</code></pre> <p>\u9700\u8981\u6ce8\u610fmatchLabels\u548cendpoints\u7684\u914d\u7f6e\uff0c\u8981\u548cMySQL\u7684Service\u4e00\u81f4\u3002 \u4e4b\u540e\u521b\u5efa\u8be5ServiceMonitor\uff1a</p> <pre><code>$ kubectl create -f mysql-sm.yaml\nservicemonitor.monitoring.coreos.com/mysql-exporter created\n</code></pre> <p>\u63a5\u4e0b\u6765\u5373\u53ef\u5728Prometheus Web UI\u770b\u5230\u8be5\u76d1\u63a7\uff0c\u5982\u56fe15.17\u6240\u793a\u3002</p> <p></p> <p>\u5bfc\u5165Grafana Dashboard, \u5730\u5740\u4e3ahttps://grafana.com/grafana/dashboards/6239\uff0c\u5bfc\u5165\u6b65\u9aa4\u548c\u4e4b\u524d\u7c7b\u4f3c\uff0c\u5728\u6b64\u4e0d\u518d\u6f14\u793a\u3002</p> <p>\u5bfc\u5165\u5b8c\u6210\u540e\uff0c\u5373\u53ef\u5728Grafana\u770b\u5230\u76d1\u63a7\u6570\u636e\uff0c\u5982\u56fe15.18\u6240\u793a\u3002</p> <p> \u56fe15.18\u3000\u67e5\u770bMySQL\u76d1\u63a7</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#4\u9ed1\u76d2\u76d1\u63a7","title":"4.\u9ed1\u76d2\u76d1\u63a7","text":"<p>\u524d\u9762\u7684\u7ae0\u8282\u5bf9MySQL\u6216\u8005Etcd\u7684\u76d1\u63a7\u90fd\u662f\u76d1\u63a7\u5e94\u7528\u672c\u8eab\uff0c\u4e5f\u5c31\u662f\u7a0b\u5e8f\u5185\u90e8\u7684\u4e00\u4e9b\u6307\u6807\uff0c\u8fd9\u7c7b\u76d1\u63a7\u5173\u6ce8\u7684\u662f\u539f\u56e0\uff0c\u4e00\u822c\u4e3a\u51fa\u73b0\u95ee\u9898\u7684\u6839\u672c\uff0c\u6b64\u7c7b\u76d1\u63a7\u79f0\u4e3a\u767d\u76d2\u76d1\u63a7\u3002</p> <p>\u8fd8\u6709\u4e00\u7c7b\u76d1\u63a7\u5173\u6ce8\u7684\u662f\u73b0\u8c61\uff0c\u4e5f\u5c31\u662f\u6b63\u5728\u53d1\u751f\u7684\u544a\u8b66\uff0c\u6bd4\u5982\u67d0\u4e2a\u7f51\u7ad9\u7a81\u7136\u6162\u4e86\uff0c\u6216\u8005\u6253\u4e0d\u5f00\u4e86\u3002\u6b64\u7c7b\u544a\u8b66\u662f\u7ad9\u5728\u7528\u6237\u7684\u89d2\u5ea6\u770b\u5230\u7684\u4e1c\u897f\uff0c\u6bd4\u8f83\u5173\u6ce8\u73b0\u8c61\uff0c\u8868\u793a\u6b63\u5728\u53d1\u751f\u7684\u95ee\u9898\uff0c\u8fd9\u7c7b\u76d1\u63a7\u79f0\u4e3a\u9ed1\u76d2\u76d1\u63a7\u3002</p> <p>\u767d\u76d2\u76d1\u63a7\u53ef\u4ee5\u901a\u8fc7Exporter\u91c7\u96c6\u6570\u636e\uff0c\u9ed1\u76d2\u76d1\u63a7\u4e5f\u53ef\u4ee5\u901a\u8fc7Exporter\u91c7\u96c6\u6570\u636e\uff0c\u65b0\u7248\u672c\u7684Prometheus Stack\u5df2\u7ecf\u9ed8\u8ba4\u5b89\u88c5\u4e86Blackbox Exporter\uff0c\u53ef\u4ee5\u7528\u5176\u91c7\u96c6\u67d0\u4e2a\u57df\u540d\u3001\u63a5\u53e3\u6216\u8005TCP\u8fde\u63a5\u7684\u72b6\u6001\u3001\u662f\u5426\u53ef\u7528\u7b49\u3002</p> <p>\u65b0\u7248Prometheus Stack\u5df2\u7ecf\u9ed8\u8ba4\u5b89\u88c5\u4e86Blackbox Exporter\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a</p> <pre><code>$ kubectl get po -n monitoring -l app.kubernetes.io/name=blackbox-exporter\nNAME                                 READY   STATUS    RESTARTS   AGE\nblackbox-exporter-6798fb5bb4-nqstp   3/3     Running   0          14h\n</code></pre> <p>\u540c\u65f6\u4e5f\u4f1a\u521b\u5efa\u4e00\u4e2aService\uff0c\u53ef\u4ee5\u901a\u8fc7\u8be5Service\u8bbf\u95eeBlackbox Exporter\u5e76\u4f20\u9012\u4e00\u4e9b\u53c2\u6570\uff1a</p> <pre><code>$ kubectl get svc -n monitoring -l app.kubernetes.io/name=blackbox-exporter\nNAME                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)              AGE\nblackbox-exporter   ClusterIP   10.105.208.175   &lt;none&gt;        9115/TCP,19115/TCP   14h\n</code></pre> <p>\u6bd4\u5982\u68c0\u6d4bwww.baidu.com\uff08\u4f7f\u7528\u4efb\u4f55\u4e00\u4e2a\u516c\u7f51\u57df\u540d\u6216\u8005\u516c\u53f8\u5185\u7684\u57df\u540d\u63a2\u6d4b\u5373\u53ef\uff09\u7f51\u7ad9\u7684\u72b6\u6001\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u68c0\u67e5\uff1a</p> <pre><code>$ curl -s \"http://10.105.208.175:19115/probe?target=www.baidu.com&amp;module=http_2xx\" |tail -3\n# HELP probe_success Displays whether or not the probe was a success\n# TYPE probe_success gauge\nprobe_success 1\n</code></pre> <p>probe\u662f\u63a5\u53e3\u5730\u5740\uff0ctarget\u662f\u68c0\u6d4b\u7684\u76ee\u6807\uff0cmodule\u662f\u6307\u4f7f\u7528\u54ea\u4e2a\u6a21\u5757\u8fdb\u884c\u63a2\u6d4b\u3002</p> <p>\u5982\u679c\u96c6\u7fa4\u4e2d\u6ca1\u6709\u914d\u7f6eBlackbox Exporter, \u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u8fdb\u884c\u5b89\u88c5:</p> <p>https://github.com/prometheus/blackbox_exporter </p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#5prometheus\u9759\u6001\u914d\u7f6e","title":"5.Prometheus\u9759\u6001\u914d\u7f6e","text":"<p>\u524d\u9762\u51e0\u4e2a\u5c0f\u8282\u914d\u7f6e\u76d1\u63a7\u76ee\u6807\u65f6\uff0c\u7528\u7684\u90fd\u662fServiceMonitor\uff0c\u4f46\u662fServiceMonitor\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u9650\u5236 \u3002 \u6bd4\u5982 \uff0c \u5982\u679c\u6ca1\u6709\u5b89\u88c5 Prometheus Operator\uff0c\u53ef\u80fd\u5c31\u65e0\u6cd5\u4f7f\u7528ServiceMonitor\uff0c\u53e6\u5916\u5e76\u4e0d\u662f\u6240\u6709\u7684\u76d1\u63a7\u90fd\u80fd\u4f7f\u7528ServiceMonitor\u8fdb\u884c\u914d\u7f6e\uff0c\u6216\u8005\u4f7f\u7528ServiceMonitor\u914d\u7f6e\u663e\u5f97\u8fc7\u4e8e\u70e6\u7410\u3002</p> <p>\u4e0a\u4e00\u8282\u8bb2\u89e3\u7684\u9ed1\u76d2\u76d1\u63a7\u4f7f\u7528ServiceMonitor\u5c31\u663e\u5f97\u8fc7\u4e8e\u590d\u6742\uff0c\u4f7f\u7528\u4f20\u7edf\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u76f4\u63a5\u5c06target\u4f20\u9012\u7ed9Blackbox Exporter\u5373\u53ef\u3002\u867d\u7136\u672c\u4e66\u4f7f\u7528\u7684\u662fOperator\u5b89\u88c5Prometheus\uff0c\u4f46\u662f\u5b83\u4e5f\u662f\u652f\u6301\u9759\u6001\u914d\u7f6e\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u5f00\u542fPrometheus\u7684\u9759\u6001\u914d\u7f6e\u3002</p> <p>\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff0c\u7136\u540e\u901a\u8fc7\u8be5\u6587\u4ef6\u521b\u5efa\u4e00\u4e2aSecret\uff0c\u8fd9\u4e2aSecret\u5373\u53ef\u4f5c\u4e3aPrometheus\u7684\u9759\u6001\u914d\u7f6e\uff1a</p> <pre><code>$ touch prometheus-additional.yaml\n$ kubectl create secret generic additional-configs --from-file=prometheus-additional.yaml -n monitoring\nsecret/additional-configs created\n</code></pre> <p>\u521b\u5efa\u5b8cSecret\u540e\uff0c\u9700\u8981\u7f16\u8f91Prometheus\u7684\u914d\u7f6e\uff08\u89c1\u56fe15.19\uff09\uff1a</p> <pre><code>$ kubectl edit prometheus -n monitoring k8s\n</code></pre> <pre><code>spec:\nadditionalScrapeConfigs:\nkey: prometheus-additional.yaml\nname: additional-configs\noptional: true\nalerting:\nalertmanagers:\n- apiVersion: v2\nname: alertmanager-main\nnamespace: monitoring\nport: web\nenableFeatures: []\nexternalLabels: {}\nimage: quay.io/prometheus/prometheus:v2.29.1\nnodeSelector:\nkubernetes.io/os: linux\n</code></pre> <p>\u6dfb\u52a0\u4e0a\u8ff0\u914d\u7f6e\u540e\u4fdd\u5b58\u9000\u51fa\uff0c\u65e0\u987b\u91cd\u542fPrometheus\u7684Pod\u5373\u53ef\u751f\u6548\u3002</p> <p>\u4e4b\u540e\u5728prometheusadditional.yaml\u6587\u4ef6\u5185\u7f16\u8f91\u4e00\u4e9b\u9759\u6001\u914d\u7f6e\uff0c\u6b64\u5904\u7528\u9ed1\u76d2\u76d1\u63a7\u7684\u914d\u7f6e\u8fdb\u884c\u6f14\u793a\uff1a</p> <pre><code>- job_name: \"blackbox\"\n# \u8fd9\u91cc\u7684\u6307\u6807\u8def\u5f84\u662f /probe\nmetrics_path: /probe\nparams:\n# \u4f7f\u7528 http \u6a21\u5757\nmodelus: [http_2xx]\nstatic_configs:\n# \u68c0\u6d4b\u7684\u76ee\u6807\n- targets:\n- https://www.baidu.com\n- https://youdianzhishi.com\nrelabel_configs:\n- source_labels: [__address__]\ntarget_label: __param_target\n- source_labels: [__param_target]\ntarget_label: instance\n- target_label: __address__\nreplacement: blackbox-exporter:19115\n- job_name: 'other-node_exporter'\nstatic_configs:\n- targets: ['172.18.0.85:9100',\"172.18.0.84:9100\",\"172.18.0.83:9100\",\"172.18.0.82:9100\"]\n- job_name: 'node-exporter-others'\nstatic_configs:\n- targets:\n- *.*.*.149:31190\n- *.*.*.150:31190\n- *.*.*.122:31190\n- job_name: 'mysql-exporter'\nstatic_configs:\n- targets:\n- *.*.*.104:9592\n- *.*.*.125:9592\n- *.*.*.128:9592\n- job_name: 'nacos-exporter'\nmetrics_path: '/nacos/actuator/prometheus'\nstatic_configs:\n- targets:\n- *.*.*.113:8848\n- *.*.*.114:8848\n- *.*.*.118:8848\n- job_name: 'elasticsearch-exporter'\nstatic_configs:\n- targets:\n- *.*.*.110:9597\n- *.*.*.107:9597\n- *.*.*.117:9597\n- job_name: 'zookeeper-exporter'\nstatic_configs:\n- targets:\n- *.*.*.115:9595\n- *.*.*.121:9595\n- *.*.*.120:9595\n- job_name: 'nginx-exporter'\nstatic_configs:\n- targets:\n- *.*.*.149:9593\n- *.*.*.150:9593\n- *.*.*.122:9593\n- job_name: 'redis-exporter'\nstatic_configs:\n- targets:\n- *.*.*.109:9594\n- job_name: 'redis-exporter-targets'\nstatic_configs:\n- targets:\n- redis://*.*.*.146:7090\n- redis://*.*.*.144:7090\n- redis://*.*.*.133:7091\nmetrics_path: /scrape\nrelabel_configs:\n- source_labels: [__address__]\ntarget_label: __param_target\n- source_labels: [__param_target]\ntarget_label: instance\n- target_label: __address__\nreplacement: *.*.*.109:9594\n</code></pre> <ul> <li>targets\uff1a\u63a2\u6d4b\u7684\u76ee\u6807\uff0c\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u66f4\u6539\u3002</li> <li>params\uff1a\u4f7f\u7528\u54ea\u4e2a\u6a21\u5757\u8fdb\u884c\u63a2\u6d4b\u3002</li> <li>replacement\uff1aBlackbox Exporter\u7684\u5730\u5740\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\u6b64\u5904\u7684\u5185\u5bb9\u548c\u4f20\u7edf\u914d\u7f6e\u7684\u5185\u5bb9\u4e00\u81f4\uff0c\u53ea\u9700\u8981\u6dfb\u52a0\u5bf9\u5e94\u7684job\u5373\u53ef\u3002\u4e4b\u540e\u901a\u8fc7\u8be5\u6587\u4ef6\u66f4\u65b0\u8be5Secret\uff1a</p> <pre><code>$ kubectl create secret generic additional-configs --from-file=prometheus-additional.yaml --dry-run=client -o yaml |kubectl replace -f - -n monitoring\nsecret/additional-configs replaced\n</code></pre> <p>\u66f4\u65b0\u5b8c\u6210\u540e\uff0c\u7a0d\u7b49\u4e00\u5206\u949f\u5373\u53ef\u5728Prometheus Web UI\u770b\u5230\u8be5\u914d\u7f6e\uff0c\u5982\u56fe15.20\u6240\u793a\u3002</p> <p></p> <p>\u56fe15.20\u3000\u67e5\u770b\u9ed1\u76d2\u76d1\u63a7Target</p> <p>\u76d1\u63a7\u72b6\u6001\u4e3aUP\u540e, \u5bfc\u5165\u9ed1\u76d2\u76d1\u63a7\u7684\u6a21\u677f\uff08https://grafana.com/grafana/dashboards/13659\uff09\u5373\u53ef,\u5982\u56fe15.21\u6240\u793a\u3002</p> <p></p> <p>\u4ee5\u4e0a\u6f14\u793a\u4e86\u9ed1\u76d2\u76d1\u63a7\u7684HTTP\u6a21\u5757\u7684\u4f7f\u7528\uff0c\u5176\u4ed6\u6a21\u5757\u7684\u4f7f\u7528\u65b9\u6cd5\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u53c2\u8003\uff1a</p> <p>https://github.com/prometheus/blackbox_exporter\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#6prometheus\u76d1\u63a7windows\u5916\u90e8\u4e3b\u673a","title":"6.Prometheus\u76d1\u63a7Windows(\u5916\u90e8)\u4e3b\u673a","text":"<p>\u4e0a\u4e00\u8282\u6f14\u793a\u4e86\u4f7f\u7528Prometheus\u9759\u6001\u914d\u7f6e\u76d1\u63a7\u7f51\u7ad9\u7684\u53ef\u7528\u6027\uff0c\u63a5\u4e0b\u6765\u518d\u901a\u8fc7\u4e00\u4e2a\u5b9e\u4f8b\u6f14\u793a\u9759\u6001\u914d\u7f6e\u7684\u4f7f\u7528\uff0c\u540c\u65f6\u4e5f\u5b66\u4e60\u4e00\u4e0bKubernetes\u96c6\u7fa4\u5916\u90e8\u7684\u670d\u52a1\u662f\u5982\u4f55\u76d1\u63a7\u7684\u3002</p> <p>\u4f7f\u7528Prometheus\u76d1\u63a7Windows\u4e3b\u673a\u548cLinux\u4e3b\u673a\u5e76\u65e0\u592a\u5927\u533a\u522b\uff0c\u90fd\u662f\u4f7f\u7528\u793e\u533a\u7684Exporter\u91c7\u96c6\u6570\u636e\uff0c\u4e4b\u540e\u66b4\u9732\u4e00\u4e2aMetrics\u63a5\u53e3\uff0c\u53ef\u4ee5\u8ba9Prometheus\u91c7\u96c6\u5230\u4e3b\u673a\u7684\u6570\u636e\u3002</p> <p>\u5176\u4e2d </p> <p>\u76d1\u63a7Linux\u7684Exporter\u662f </p> <p>https://github.com/prometheus/node_exporter</p> <p>\u76d1\u63a7Windows\u4e3b\u673a\u7684Exporter\u662f</p> <p>https://github.com/prometheus-community/windows_exporter</p> <p>\u9996\u5148\u4e0b\u8f7d\u5bf9\u5e94\u7684Exporter\u81f3Windows\u4e3b\u673aMSI\u6587\u4ef6\u4e0b\u8f7d\u5730\u5740\uff0c\u5982\u56fe15.22\u6240\u793a\u3002</p> <p></p> <p>\u56fe15.22\u3000\u4e0b\u8f7dWindows\u76d1\u63a7\u7ec4\u4ef6</p> <p>\u4e0b\u8f7d\u5b8c\u6210\u540e\uff0c\u53cc\u51fb\u6253\u5f00\u5373\u53ef\u5b8c\u6210\u5b89\u88c5\uff0c\u4e4b\u540e\u53ef\u4ee5\u5728\u4efb\u52a1\u7ba1\u7406\u5668\u4e0a\u770b\u5230\u5bf9\u5e94\u7684\u8fdb\u7a0b\uff0c\u5982\u56fe15.23\u6240\u793a\u3002</p> <p></p> <p>Windows Exporter\u4f1a\u66b4\u9732\u4e00\u4e2a9182\u7aef\u53e3\uff0c\u53ef\u4ee5\u901a\u8fc7\u8be5\u7aef\u53e3\u8bbf\u95eeWindows\u7684\u76d1\u63a7\u6570\u636e\u3002\u63a5\u4e0b\u6765\u5728\u9759\u6001\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <p>Targets\u914d\u7f6e\u7684\u662f\u76d1\u63a7\u4e3b\u673a\uff0c\u5982\u679c\u662f\u591a\u53f0Windows\u4e3b\u673a\uff0c\u914d\u7f6e\u591a\u884c\u5373\u53ef\uff0c\u5f53\u7136\u6bcf\u53f0\u4e3b\u673a\u90fd\u9700\u8981\u914d\u7f6eExporter\u3002\u4e4b\u540e\u53ef\u4ee5\u5728Prometheus Web UI\u770b\u5230\u76d1\u63a7\u6570\u636e\uff0c\u5982\u56fe15.24\u6240\u793a\u3002</p> <pre><code>- job_name: 'WindowsServerMonitor'\nstatic_configs:\n- targets:\n- \"192.168.1.164:9182\"\nlabels:\nserver_type: 'windows'\nrelabel_configs:\n- source_labels: [__address__]\ntarget_label: instance\n</code></pre> <p>Targets\u914d\u7f6e\u7684\u662f\u76d1\u63a7\u4e3b\u673a\uff0c\u5982\u679c\u662f\u591a\u53f0Windows\u4e3b\u673a\uff0c\u914d\u7f6e\u591a\u884c\u5373\u53ef\uff0c\u5f53\u7136\u6bcf\u53f0\u4e3b\u673a\u90fd\u9700\u8981\u914d\u7f6eExporter\u3002</p> <p>\u4e4b\u540e\u53ef\u4ee5\u5728Prometheus Web UI\u770b\u5230\u76d1\u63a7\u6570\u636e\uff0c\u5982\u56fe15.24\u6240\u793a\u3002</p> <p></p> <p>\u56fe15.24\u3000\u67e5\u770bWindows\u76d1\u63a7\u6307\u6807</p> <p>\u4e4b\u540e\u5bfc\u5165\u6a21\u677f(\u5730 \u5740:https://grafana.com/grafana/dashboards/12566)\u5373\u53ef\uff0c\u5982\u56fe15.25\u6240\u793a\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230Prometheus\u7684\u9759\u6001\u914d\u7f6e\u5927\u81f4\u6d41\u7a0b\u4e00\u81f4\uff0c\u914d\u7f6e\u5185\u5bb9\u4e5f\u7c7b\u4f3c\uff0c\u6240\u4ee5\u4e00\u4e9b\u4e0d\u65b9\u4fbf\u4f7f\u7528ServiceMonitor\u8fdb\u884c\u914d\u7f6e\u7684\uff0c\u53ef\u4ee5\u91c7\u7528\u9759\u6001\u914d\u7f6e\u7684\u65b9\u5f0f\uff0c\u5f53\u7136\u9759\u6001\u914d\u7f6e\u4e5f\u53ef\u4ee5\u91c7\u7528ServiceMonitor\u65b9\u5f0f\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#7prometheus\u8bed\u6cd5promql\u5165\u95e8","title":"7.Prometheus\u8bed\u6cd5PromQL\u5165\u95e8","text":"<p>\u524d\u9762\u5b66\u4e60\u4e86\u4e91\u539f\u751f\u5e94\u7528\u3001\u975e\u4e91\u539f\u751f\u5e94\u7528\u3001\u9ed1\u76d2\u76d1\u63a7\u548c\u96c6\u7fa4\u5916\u90e8\u4e3b\u673a\u76d1\u63a7\uff0c\u540c\u65f6\u5b66\u4e60\u4e86ServiceMonitor\u548c\u9759\u6001\u914d\u7f6e\u7684\u4f7f\u7528\uff0c\u638c\u63e1\u8fd9\u4e9b\u4ee5\u540e\uff0c\u751f\u4ea7\u73af\u5883\u7684\u5927\u90e8\u5206\u573a\u666f\u90fd\u53ef\u4ee5\u8fdb\u884c\u76d1\u63a7\u3002</p> <p>\u4f46\u662f\u76d1\u63a7\u5e76\u4e0d\u662f\u6700\u7ec8\u7684\u76ee\u7684\uff0c\u867d\u7136\u901a\u8fc7Grafana\u7684Dashboard\u80fd\u770b\u5230\u4e00\u4e9b\u76d1\u63a7\u5927\u5c4f\uff0c\u4f46\u662f\u9700\u8981\u76d1\u63a7\u7684\u5730\u65b9\u592a\u591a\uff0c\u5e76\u4e14\u6280\u672f\u4eba\u5458\u4e0d\u53ef\u80fd\u968f\u65f6\u968f\u5730\u90fd\u76ef\u7740Dashboard\uff0c\u6240\u4ee5\u9700\u8981\u5bf9\u4e25\u91cd\u7684\u544a\u8b66\u8fdb\u884c\u901a\u77e5\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u9700\u8981\u7528\u5230Prometheus\u7684\u53e6\u4e00\u4e2a\u7ec4\u4ef6\u2014Alertmanager\uff0c\u4e3b\u8981\u7528\u6765\u8fdb\u884c\u544a\u8b66\u7684\u901a\u77e5\uff0c\u53ef\u4ee5\u91c7\u7528\u90ae\u7bb1\u3001\u9489\u9489\u3001\u5fae\u4fe1\u3001Slack\u3001Webhook\u7b49\u8fdb\u884c\u901a\u77e5\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#71-promql\u8bed\u6cd5\u521d\u4f53\u9a8c","title":"7.1 PromQL\u8bed\u6cd5\u521d\u4f53\u9a8c","text":"<p>\u5728\u5b66\u4e60\u544a\u8b66\u4e4b\u524d\uff0c\u5fc5\u987b\u638c\u63e1\u57fa\u7840\u7684Prometheus\u6570\u636e\u67e5\u8be2\u8bed\u6cd5 \u3002Prometheus\u67e5\u8be2\u8bed\u6cd5\u53ebPromQL\uff0c\u5c31\u50cfMySQL\u7684SQL\u8bed\u53e5\u3002</p> <p>\u9996\u5148\u6839\u636e\u67e5\u8be2\u8bed\u6cd5\u67e5\u51fa\u6765\u60f3\u8981\u7684\u6570\u636e\uff0c\u4e4b\u540e\u6839\u636e\u6761\u4ef6\u5224\u65ad\u5373\u53ef\u8fdb\u884c\u544a\u8b66\u3002</p> <p>PromQL Web UI\u7684Graph\u9009\u9879\u5361\u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u7528\u4e8e\u67e5\u8be2\u6570\u636e\u7684\u5165\u53e3\uff0c\u5bf9\u4e8ePromQL\u7684\u7f16\u5199\u548c\u6821\u9a8c\u90fd\u53ef\u4ee5\u5728\u6b64\u4f4d\u7f6e\uff0c\u5982\u56fe15.26\u6240\u793a\u3002</p> <p> \u56fe15.26\u3000\u9009\u62e9Graph</p> <p>\u6211\u4eec\u53ef\u4ee5\u5148\u8f93\u5165up\uff0c\u7136\u540e\u5355\u51fbExecute\uff0c\u5c31\u80fd\u67e5\u5230\u76d1\u63a7\u6b63\u5e38\u7684Target\uff0c\u5982\u56fe15.27\u6240\u793a\u3002</p> <p></p> <p>up\u547d\u4ee4\u53ef\u4ee5\u67e5\u5230\u6240\u6709\u6b63\u5e38\u76d1\u63a7\u7684\u76ee\u6807\uff0c\u5982\u679c\u76d1\u63a7\u7684\u76ee\u6807\u8fc7\u591a\uff0c\u53ef\u80fd\u4f1a\u67e5\u8be2\u51fa\u6765\u5f88\u591a\u6570\u636e\u3002\u6b64\u65f6\u53ef\u4ee5\u6839\u636e\u4e00\u4e9b\u6761\u4ef6\u8fdb\u884c\u8fc7\u6ee4\uff0c\u5c31\u50cfSQL\u8bed\u53e5\u7684where\u8bed\u6cd5\u3002\u6bd4\u5982\u901a\u8fc7\u6807\u7b7e\u9009\u62e9\u5668\u8fc7\u6ee4\u51fajob\u4e3anode-exporter\u7684\u76d1\u63a7\uff0c\u8bed\u6cd5\u4e3a\uff1aup{job=\"node-exporter\"}\uff0c\u5982\u56fe15.28\u6240\u793a\u3002</p> <p> \u56fe15.28\u3000\u67e5\u770b\u4e3b\u673a\u76d1\u63a7</p> <p>\u6ce8\u610f\u6b64\u65f6up{job=\"node-exporter\"}\u5c5e\u4e8e\u7edd\u5bf9\u5339\u914d\uff0cProm?L\u4e5f\u652f\u6301\u5982\u4e0b\u8868\u8fbe\u5f0f\uff1a</p> <ul> <li>!=\uff1a\u8868\u793a\u4e0d\u7b49\u4e8e\u67d0\u4e2a\u503c\u7684\u6307\u6807\uff0c\u6bd4\u5982up{job!=\"node-exporter\"}\u8868\u793ajob\u4e0d\u4e3anode-exporter\u7684\u6307\u6807\u3002</li> <li>=~\uff1a\u8868\u793a\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u6307\u6807\uff0c\u6bd4\u5982up{job=~\"node.*\"}\u8868\u793a\u6240\u6709\u4ee5node\u5f00\u5934\u7684\u6307\u6807\u3002</li> <li>!<sub>\uff1a\u548c=</sub>\u7c7b\u4f3c\uff0c=<sub>\u8868\u793a\u6b63\u5219\u5339\u914d\uff0c!</sub>\u8868\u793a\u6b63\u5219\u4e0d\u5339\u914d\uff0c\u4e5f\u5c31\u662f\u6392\u9664\u4e00\u4e9b\u6307\u6807\u3002</li> </ul> <p>\u5982\u679c\u60f3\u8981\u67e5\u770b\u4e3b\u673a\u76d1\u63a7\u7684\u6307\u6807\u6709\u54ea\u4e9b\uff0c\u53ef\u4ee5\u8f93\u5165node\uff0c\u4f1a\u63d0\u793a\u6240\u6709\u4e3b\u673a\u76d1\u63a7\u7684\u6307\u6807\uff0c\u5982\u56fe15.29\u6240\u793a\u3002  \u56fe15.29\u3000\u67e5\u770b\u4e3b\u673a\u76d1\u63a7\u6307\u6807</p> <p>\u5047\u5982\u60f3\u8981\u67e5\u8be2Kubernetes\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u5bbf\u4e3b\u673a\u7684\u78c1\u76d8\u603b\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528node_filesystem_size_bytes\uff0c\u5982\u56fe15.30\u6240\u793a\u3002</p> <p> \u56fe15.30\u3000\u67e5\u770b\u78c1\u76d8\u7a7a\u95f4</p> <p>\u53ef\u4ee5\u770b\u5230\u6b64\u65f6\u67e5\u8be2\u7ed3\u679c\u8fc7\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8fdb\u884c\u5904\u7406\uff0c\u6bd4\u5982\u53ea\u67e5\u8be2\u6839\u5206\u533a\u7684\u5927\u5c0f\uff0c\u6839\u636e\u524d\u6587\u63d0\u5230\u7684\u6807\u7b7e\u9009\u62e9\u5668\uff0c\u52a0\u4e0amountpoint\u5339\u914d\u89c4\u5219node_filesystem_size_bytes{mountpoint=\"/\"}\u5373\u53ef\uff0c\u5982\u56fe15.31\u6240\u793a\u3002</p> <p> \u56fe15.31\u3000\u67e5\u770b\u6839\u5206\u533a\u7a7a\u95f4\u5927\u5c0f</p> <p>\u6216\u8005\u67e5\u8be2\u5206\u533a\u4e0d\u662f/boot\uff0c\u4e14\u78c1\u76d8\u662f/dev/\u5f00\u5934\u7684\u5206\u533a\u5927\u5c0f\uff08\u7ed3\u679c\u4e0d\u518d\u5c55\u793a\uff09\uff1a</p> <pre><code>node_filesystem_size_bytes{device=~\"/dev/.*\",mountpoint!=\"/boot\"}\n</code></pre> <p>\u4e0a\u8ff0\u7684PromQL\u67e5\u8be2\u51fa\u6765\u7684\u6570\u636e\u90fd\u662f\u77ac\u65f6\u503c\uff0c\u4e5f\u5c31\u662fPrometheus\u91c7\u96c6\u5230\u7684\u6700\u65b0\u7684\u6570\u636e\uff0c\u5728\u65f6\u5e8f\u6570\u636e\u5e93\u4e2d\u88ab\u79f0\u4e3a\u77ac\u65f6\u5411\u91cf\u3002\u56e0\u4e3aPrometheus\u672c\u8eab\u662f\u4e00\u4e2a\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u67e5\u8be2\u67d0\u4e2a\u6307\u6807\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\uff0c\u6bd4\u5982\u67e5\u8be2\u4e3b\u673ak8s-master01\u5728\u6700\u8fd15\u5206\u949f\u53ef\u7528\u7684\u78c1\u76d8\u7a7a\u95f4\u53d8\u5316\uff08\u89c1\u56fe15.32\uff09\uff1a</p> <pre><code>node_filesystem_avail_bytes{instance=\"giteego-k8s-m1\",mountpoint=\"/\",device=\"/dev/sda1\"}[5m]\n</code></pre> <p> \u56fe15.32\u3000\u67e5\u770b\u6700\u8fd15\u5206\u949f\u7684\u6570\u636e</p> <p>\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u7684\u6570\u636e\u6709\u4e00\u4e2a\u65f6\u95f4\u6233\uff08\u67e5\u8be2\u7ed3\u679c@\u7b26\u53f7\u540e\u9762\uff09\uff0c\u8fd9\u4e2a\u65f6\u95f4\u6233\u8bb0\u5f55\u4e86\u6570\u636e\u6837\u672c\u7684\u8bb0\u5f55\u65f6\u95f4\u3002</p> <p>\u5e76\u4e14\u80fd\u770b\u5230\u6709\u591a\u6761\u67e5\u8be2\u7ed3\u679c\u4e3a\u8fd95\u5206\u949f\u5185\u7684\u6240\u6709\u6570\u636e\uff0c\u8fd9\u79cd\u67e5\u8be2\u4e00\u6bb5\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u7ed3\u679c\u88ab\u79f0\u4e3a\u533a\u95f4\u5411\u91cf\u3002\u76ee\u524d\u652f\u6301\u7684\u8303 \u56f4\u5355\u4f4d\u5982\u4e0b\uff1a</p> <ul> <li>s\uff1a\u79d2\u3002</li> <li>m\uff1a\u5206\u949f\u3002</li> <li>h\uff1a\u5c0f\u65f6\u3002</li> <li>d\uff1a\u5929\u3002</li> <li>w\uff1a\u5468\u3002</li> <li>y\uff1a\u5e74\u3002</li> </ul> <p>\u9664\u4e86\u80fd\u67e5\u8be2\u533a\u95f4\u5411\u91cf\u548c\u77ac\u65f6\u5411\u91cf\u7684\u6570\u636e\uff0cPrometheus\u4e5f\u652f\u6301\u67e5\u8be2\u51e0\u5206\u949f\u4e4b\u524d\u7684\u6570\u636e\u6216\u8005\u51e0\u5206\u949f\u4e4b\u524d\u7684\u4e00\u6bb5\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\uff0c\u6bd4\u5982\u67e5\u8be210\u5206\u949f\u4e4b\u524d\u78c1\u76d8\u7684\u53ef\u7528\u7a7a\u95f4\uff0c\u53ea\u9700\u8981\u6307\u5b9aoffset\u53c2\u6570\u5373\u53ef\uff1a</p> <pre><code>node_filesystem_avail_bytes{instance=\"giteego-k8s-m1\",mountpoint=\"/\",device=\"/dev/sda1\"} offset 10m\n</code></pre> <p>\u6216\u8005\u67e5\u8be210\u5206\u949f\u4e4b\u524d\uff0c5\u5206\u949f\u533a\u95f4\u7684\u78c1\u76d8\u53ef\u7528\u7a7a\u95f4\u7684\u53d8\u5316\uff1a</p> <pre><code>node_filesystem_avail_bytes{instance=\"giteego-k8s-m1\",mountpoint=\"/\",device=\"/dev/sda1\"}[5m] offset 10m\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#72-promql\u64cd\u4f5c\u7b26","title":"7.2 PromQL\u64cd\u4f5c\u7b26","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u6211\u4eec\u901a\u8fc7PromQL\u7684\u8bed\u6cd5\u67e5\u5230\u4e86\u4e3b\u673a\u78c1\u76d8\u7684\u7a7a\u95f4\u6570\u636e\uff0c\u67e5\u8be2\u7ed3\u679c\u5982\u56fe15.33\u6240\u793a\u3002</p> <p> \u56fe15.33\u3000\u67e5\u770b\u4e3b\u673a\u78c1\u76d8\u7a7a\u95f4\u6570\u636e</p> <p>\u53ef\u4ee5\u770b\u5230\u6b64\u65f6\u7684\u6570\u636e\u4e3a16358440960\uff0c\u8fd9\u4e2a\u7ed3\u679c\u5e76\u4e0d\u9002\u5408\u76f4\u63a5\u9605\u8bfb\uff0c\u56e0\u4e3a\u5b83\u8fd4\u56de\u7684\u6570\u636e\u5355\u4f4d\u4e3a\u5b57\u8282\uff08bytes\uff0c\u5176\u4ed6\u6307\u6807\u53ef\u80fd\u662f\u5176\u4ed6\u5355\u4f4d\uff09\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5c06\u5b57\u8282\u8f6c\u6362\u4e3aGB\u6216\u8005MB\uff1a</p> <pre><code>node_filesystem_avail_bytes{instance=\"giteego-k8s-m1\",mountpoint=\"/\",device=\"/dev/sda1\"} / 1024 / 1024 / 1024\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5c061024/1024/1024\u6539\u4e3a(1024 ^ 3)\uff1a</p> <pre><code>node_filesystem_avail_bytes{instance=\"giteego-k8s-m1\",mountpoint=\"/\",device=\"/dev/sda1\"} / (1024 ^3) \n</code></pre> <p>\u67e5\u8be2\u7ed3\u679c\u5982\u56fe15.34\u6240\u793a\uff0c\u6b64\u65f6\u4e3a12GB\u5de6\u53f3\u3002</p> <p> \u56fe15.34\u3000\u67e5\u770b\u7a7a\u95f4\u5927\u5c0f</p> <p>\u6b64\u65f6\u53ef\u4ee5\u5728\u5bbf\u4e3b\u673a\u4e0a\u6bd4\u5bf9\u6570\u636e\u662f\u5426\u6b63\u786e\uff1a</p> <pre><code>$ df -Th|grep /dev/sda1\n/dev/sda1      xfs        20G  7.4G   13G  37% /\n</code></pre> <p>\u4e0a\u8ff0\u4f7f\u7528\u7684\u201c/\u201d\u4e3a\u6570\u5b66\u8fd0\u7b97\u7684\u201c\u9664\u201d\uff0c\u201c^\u201d\u4e3a\u5e42\u8fd0\u7b97\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u5982\u4e0b\u8fd0\u7b97\u7b26\uff1a</p> <ul> <li>+\uff1a\u52a0\u3002</li> <li>\u2012\uff1a\u51cf\u3002</li> <li>*\uff1a\u4e58\u3002</li> <li>/\uff1a\u9664\u3002</li> <li>^\uff1a\u5e42\u8fd0\u7b97\u3002</li> <li>%\uff1a\u6c42\u4f59\u3002</li> </ul> <p>\u901a\u8fc7\u4e0d\u540c\u7684\u6307\u6807\u7ed3\u5408\u4e0d\u540c\u7684\u8868\u8fbe\u5f0f\u53ef\u4ee5\u67e5\u8be2\u5230\u4e0d\u540c\u7684\u6570\u636e\uff0c\u6bd4\u5982\u8981\u67e5\u8be2k8s-master01\u6839\u533a\u5206\u78c1\u76d8\u7684\u53ef\u7528\u7387\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u6307\u4ee4\u8fdb\u884c\u8ba1\u7b97\uff1a</p> <pre><code>node_filesystem_avail_bytes{instance=\"giteego-k8s-m1\",mountpoint=\"/\",device=\"/dev/sda1\"}  /node_filesystem_size_bytes{instance=\"giteego-k8s-m1\",mountpoint=\"/\",device=\"/dev/sda1\"}\n</code></pre> <p>node_filesystem_avail_bytes \u4e3a \u7cfb \u7edf \u53ef \u7528 \u7684 \u78c1 \u76d8 \u7a7a \u95f4 \uff0cnode_filesystem_size_bytes\u4e3a\u78c1\u76d8\u7a7a\u95f4\u7684\u603b\u5927\u5c0f\uff0c\u6240\u4ee5\u4e24\u8005\u7684\u6bd4\u503c\u5373\u4e3a\u78c1 \u76d8\u7a7a\u95f4\u7684\u53ef\u7528\u7387\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u53bb\u6389instance\u53c2\u6570\uff0c\u67e5\u8be2\u6240\u6709\u4e3b\u673a\u6839\u5206\u533a\u7684\u53ef\u7528\u7387\uff08\u89c1\u56fe15.35\uff09\uff1a</p> <pre><code>node_filesystem_avail_bytes{mountpoint=\"/\"} /node_filesystem_size_bytes{mountpoint=\"/\"}\n</code></pre> <p> \u56fe15.35\u3000\u67e5\u770b\u78c1\u76d8\u53ef\u7528\u7387</p> <p>\u4e5f\u53ef\u4ee5\u5c06\u7ed3\u679c\u4e58\u4ee5100\u76f4\u63a5\u5f97\u5230\u767e\u5206\u6bd4\uff1a</p> <pre><code>node_filesystem_avail_bytes{mountpoint=\"/\"} /node_filesystem_size_bytes{mountpoint=\"/\"} * 100\n</code></pre> <p>\u901a\u8fc7\u4e0a\u8ff0\u64cd\u4f5c\u7b26\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u8be2\u5230\u4e3b\u673a\u78c1\u76d8\u7684\u4f7f\u7528\u4fe1\u606f\uff0c\u8bfb\u8005\u53ef\u4ee5\u6839\u636e\u4e0a\u8ff0\u8bed\u53e5\u5c1d\u8bd5\u67e5\u8be2\u5176\u4ed6\u6307\u6807\u4fe1\u606f\uff0c\u6bd4\u5982CPU\u3001\u5185\u5b58\u7684\u4f7f\u7528\u7387\u7b49\uff0c\u5982\u56fe15.36\u6240\u793a\u3002</p> <p></p> <p>\u56fe15.36\u3000\u67e5\u770b\u78c1\u76d8\u53ef\u7528\u767e\u5206\u6bd4</p> <p>\u867d\u7136\u53ef\u4ee5\u901a\u8fc7\u4e0a\u8ff0\u8bed\u53e5\u67e5\u8be2\u5230\u4e00\u4e9b\u6307\u6807\uff0c\u4f46\u662f\u8fd9\u4e9b\u6307\u6807\u53ef\u80fd\u5e76\u975e\u6211\u4eec\u6700\u7ec8\u60f3\u8981\u7684\u3002</p> <p>\u6bd4\u5982\u60f3\u8981\u627e\u5230\u96c6\u7fa4\u4e2d\u6839\u5206\u533a\u7a7a\u95f4\u53ef\u7528\u7387\u5927\u4e8e60%\u7684\u4e3b\u673a\uff0c\u6b64\u65f6\u53ef\u4ee5\u5c06\u67e5\u8be2\u8bed\u53e5\u6dfb\u52a0\u4e00\u4e2a\u5224\u65ad\u6761\u4ef6\uff0c\u5f97\u5230\u81ea\u5df1\u60f3\u8981\u7684\u7ed3\u679c\uff0c\u6bd4\u5982\uff1a</p> <pre><code>node_filesystem_avail_bytes{mountpoint=\"/\"} /node_filesystem_size_bytes{mountpoint=\"/\"} * 100 &gt;60\n</code></pre> <p>\u7ed3\u679c\u5982\u56fe15.37\u6240\u793a\u3002</p> <p> \u56fe15.37\u3000\u67e5\u770b\u78c1\u76d8\u53ef\u7528\u7387\u5927\u4e8e60%\u7684\u4e3b\u673a</p> <p>\u6b64\u65f6\u5f97\u5230\u7684\u7ed3\u679c\u4e3a\u76d1\u63a7\u76ee\u6807\u4e3b\u673a\u78c1\u76d8\u53ef\u7528\u7387\u5927\u4e8e60%\u7684\u4e3b\u673a\uff0c\u5982\u679c\u5c06\u5927\u4e8e60\u6539\u4e3a\u5c0f\u4e8e20\uff0c\u5c31\u662f\u67e5\u8be2\u6240\u6709\u78c1\u76d8\u53ef\u7528\u7387\u5c0f\u4e8e20%\u7684\u4e3b\u673a\uff0c\u6b64\u65f6\u662f\u4e0d\u662f\u5c31\u5e94\u8be5\u4ea7\u751f\u544a\u8b66\uff1f\u6240\u4ee5\u8bf4\u5c06PromQL\u7684\u8bed\u6cd5\u7a0d\u52a0\u6539\u9020\u5373\u4e3a\u6211\u4eec\u60f3\u8981\u7684\u544a\u8b66\u6761\u4ef6\u3002</p> <pre><code>node_filesystem_avail_bytes{mountpoint=\"/\"} /node_filesystem_size_bytes{mountpoint=\"/\"} * 100 &lt;20\n</code></pre> <p>\u9664\u4e86\u4ee5\u4e0a\u5224\u65ad\u8bed\u6cd5\u5916\uff0cPromQL\u4e5f\u652f\u6301\u5982\u4e0b\u5224\u65ad\uff1a</p> <ul> <li>==\uff1a\u76f8\u7b49\u3002</li> <li>!=\uff1a\u4e0d\u76f8\u7b49\u3002</li> <li>\uff1a\u5927\u4e8e\u3002</li> <li>&lt;\uff1a\u5c0f\u4e8e\u3002</li> <li>=\uff1a\u5927\u4e8e\u7b49\u4e8e\u3002</li> <li>&lt;=\uff1a\u5c0f\u4e8e\u7b49\u4e8e\u3002</li> </ul> <p>\u4e0a\u8ff0\u8bed\u6cd5\u53ea\u662f\u505a\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u5224\u65ad\uff0c\u6bd4\u5982\u53ea\u8fc7\u6ee4\u4e86\u78c1\u76d8\u53ef\u7528\u7387\u5927\u4e8e60%\u7684\u6307\u6807\uff0c\u5982\u679c\u60f3\u8981\u8fc7\u6ee4\u5176\u4ed6\u8303\u56f4\u4e5f\u662f\u652f\u6301\u7684\uff0c\u6bd4\u5982\u78c1\u76d8\u53ef\u7528\u7387\u5927\u4e8e30%\u5c0f\u4e8e\u7b49\u4e8e60%\u7684\u4e3b\u673a\uff1a</p> <pre><code>30 &lt; node_filesystem_avail_bytes{mountpoint=\"/\"} /node_filesystem_size_bytes{mountpoint=\"/\"} * 100 &lt;=60\n</code></pre> <p>\u5728\u8bed\u53e5\u7684\u524d\u9762\u52a0\u4e0a\u201c30&lt;\u201d\uff0c\u540e\u9762\u52a0\u4e0a\u201c&lt;=\u201d60\u3002\u4e5f\u53ef\u4ee5\u7528and\u8fdb\u884c\u8054\u5408\u67e5\u8be2\uff1a</p> <pre><code>(node_filesystem_avail_bytes{mountpoint=\"/\"} /node_filesystem_size_bytes{mountpoint=\"/\"}) * 100 &gt; 30 and (node_filesystem_avail_bytes{mountpoint=\"/\"} /node_filesystem_size_bytes{mountpoint=\"/\"}) * 100 &lt;= 60\n</code></pre> <p>\u9664\u4e86and\u5916\uff0c\u4e5f\u652f\u6301or\u548cunless\uff1a</p> <ul> <li>and\uff1a\u5e76\u4e14\u3002</li> <li>or\uff1a\u6216\u8005\u3002</li> <li>unless\uff1a\u6392\u9664\u3002</li> </ul> <p>\u7531\u4e0a\u53ef\u77e5\uff0cand\u662f\u5fc5\u987b\u4e24\u4e2a\u6761\u4ef6\u90fd\u7b26\u5408\uff0cor\u53ea\u9700\u8981\u7b26\u5408\u5176\u4e2d\u4e00\u4e2a\u5373\u53ef\uff0c\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u7ec3\u4e60\u3002</p> <p>\u800cunless\u662f\u6392\u9664\u67d0\u4e2a\u6307\u6807\uff0c\u6bd4\u5982\u67e5\u8be2\u4e3b\u673a\u78c1\u76d8\u5269\u4f59\u7a7a\u95f4\uff0c\u5e76\u4e14\u6392\u9664\u6389shm\u548ctmpfs\u7684\u78c1\u76d8\uff1a</p> <pre><code>node_filesystem_free_bytes unless node_filesystem_free_bytes{device=~\"shm|tmpfs\"}\n</code></pre> <p>\u5f53\u7136\uff0c\u8fd9\u4e2a\u8bed\u6cd5\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5199\u4e3a\uff1a</p> <pre><code>node_filesystem_free_bytes{device!~\"shm|tmpfs\"}\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#73-promql\u5e38\u7528\u51fd\u6570","title":"7.3 PromQL\u5e38\u7528\u51fd\u6570","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u4f7f\u7528PromQL\u67e5\u8be2\u4e86\u4e00\u4e9b\u6307\u6807\uff0c\u63a5\u4e0b\u6765\u901a\u8fc7PromQL\u4e00\u4e9b\u5e38\u7528\u7684\u51fd\u6570\u5bf9\u6570\u636e\u8fdb\u4e00\u6b65\u5904\u7406\u3002\u6bd4\u5982\u4f7f\u7528sum\u51fd\u6570\u7edf\u8ba1\u5f53\u524d\u76d1\u63a7\u76ee\u6807\u6240\u6709\u4e3b\u673a\u6839\u5206\u533a\u5269\u4f59\u7684\u7a7a\u95f4\uff08\u89c1\u56fe15.38\uff09\uff1a</p> <pre><code>sum(node_filesystem_free_bytes{mountpoint=\"/\"}) / 1024^3\n</code></pre> <p> \u56fe15.38\u3000sum\u7edf\u8ba1</p> <p>\u4e5f\u53ef\u4ee5\u7528\u540c\u6837\u65b9\u5f0f\u8ba1\u7b97\u6240\u6709\u7684\u8bf7\u6c42\u603b\u91cf\uff1a</p> <pre><code>sum(http_requests_total)\n</code></pre> <p>sum(http_request_total)\u662f\u5bf9\u6240\u6709\u7684\u8bf7\u6c42\u8fdb\u884c\u6c47\u603b\uff0c\u5982\u679c\u60f3\u8981\u7edf\u8ba1\u66f4\u52a0\u7ec6\u7c92\u5ea6\u7684\u6307\u6807\uff0c\u53ef\u4ee5\u52a0\u4e0a\u5bf9\u5e94\u7684\u5339\u914d\u6761\u4ef6\uff0c\u6bd4\u5982\u60f3\u8981\u7edf\u8ba1\u6240\u6709\u72b6\u6001\u7801\u4e3a200\u7684\u8bf7\u6c42\u3002</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7http_request_total\u5b66\u4e60\u7ec6\u7c92\u5ea6\u7684\u7edf\u8ba1\uff0c\u9996\u5148\u770b\u4e00\u4e0bhttp_request_total\u7684\u6570\u636e\u7c7b\u578b\u662f\u600e\u6837\u7684 \u3002 </p> <p>\u53ef\u4ee5\u76f4\u63a5\u67e5\u8be2http_request_total\u7684\u6570\u636e\uff08\u89c1\u56fe15.39\uff09\uff1a</p> <p> \u56fe15.39\u3000sum\u7edf\u8ba1\u8bf7\u6c42\u6570</p> <p>\u4e0a\u9762\u53ea\u5c55\u793a\u4e86\u4e00\u6761\u6570\u636e\uff0c\u53ef\u4ee5\u770b\u5230\u6709handler\u3001statuscode\u548cmethod\uff0c\u4e5f\u5c31\u662f\u8be5\u6761\u6570\u636e\u53ef\u4ee5\u4ee3\u8868\u8bbf\u95ee\u6839\u8def\u5f84\u72b6\u6001\u4e3a200\u4e14\u8bf7\u6c42\u65b9\u5f0f\u4e3aget\u7684\u7edf\u8ba1\uff0c\u6570\u91cf\u4e3a10\u3002</p> <p>\u7531\u8be5\u6761\u6570\u636e\u7ed3\u5408sum\u51fd\u6570\uff0c\u53ef\u4ee5\u6839\u636estatuscode\u5b57\u6bb5\u7edf\u8ba1\u8bf7\u6c42\u6570\u636e\uff08\u89c1\u56fe15.40\uff09\uff1a</p> <pre><code>sum(http_request_total) by (statuscode)\n</code></pre> <p> \u56fe15.40\u3000\u6839\u636e\u5b57\u6bb5\u8fdb\u884c\u7edf\u8ba1</p> <p>\u53ef\u4ee5\u770b\u5230\u72b6\u6001\u7801\u4e3a404\u7684\u8bf7\u6c42\u6b21\u6570\u662f12\uff0c\u72b6\u6001\u7801\u4e3a200\u7684\u8bf7\u6c42\u6b21\u6570\u662f7156\u3002\u540c\u65f6\u4e5f\u53ef\u4ee5\u6839\u636estatuscode\u548chandler\u4e24\u4e2a\u6307\u6807\u8fdb\u4e00\u6b65\u7edf\u8ba1\uff08\u89c1\u56fe15.41\uff09\uff1a</p> <pre><code>sum(http_request_total) by (statuscode, handler)\n</code></pre> <p> \u56fe15.41\u3000\u6839\u636e\u591a\u4e2a\u5b57\u6bb5\u7edf\u8ba1</p> <p>\u4e0a\u8ff0\u8bed\u53e5\u53ef\u4ee5\u7edf\u8ba1\u51fa\u8bbf\u95ee\u67d0\u4e2a\u8def\u5f84\u4e14\u72b6\u6001\u7801\u4e3a\u67d0\u4e2a\u503c\u7684\u7edf\u8ba1\u7ed3\u679c\u3002</p> <p>\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528topk\u51fd\u6570\uff0c\u627e\u5230\u7edf\u8ba1\u7ed3\u679c\u4e2d\u6b21\u6570\u6700\u591a\u7684\u51e0\u4e2a\u7ed3\u679c\u3002\u6bd4\u5982\u627e\u5230\u6392\u540d\u524d5\u7684\u6570\u636e\uff08\u4e3a\u8282\u7701\u7bc7\u5e45\uff0c\u7ed3\u679c\u4e0d\u518d\u5c55\u793a\uff09\uff1a</p> <pre><code>topk(5, sum(http_request_total) by (statuscode, handler))\n</code></pre> <p>PromQL\u5f00\u7bb1\u5373\u7528\u7684\u51fd\u6570\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u53d6\u6700\u540e3\u4e2a\u6570\u636e\uff1a</p> <pre><code>grafana(3, sum(http_request_total) by (statuscode, handler))\n</code></pre> <p>\u627e\u51fa\u7edf\u8ba1\u7ed3\u679c\u4e2d\u6700\u5c0f\u7684\u6570\u636e\uff1a</p> <pre><code>min(node_filesystem_avail_bytes{mountpoint=\"/\"})\n</code></pre> <p>\u6700\u5927\u7684\u6570\u636e\uff1a</p> <pre><code>max(node_filesystem_avail_bytes{mountpoint=\"/\"})\n</code></pre> <p>\u5e73\u5747\u503c\uff1a</p> <pre><code>avg(node_filesystem_avail_bytes{mountpoint=\"/\"})\n</code></pre> <p>\u56db\u820d\u4e94\u5165\uff0c\u5411\u4e0a\u53d6\u6700\u63a5\u8fd1\u7684\u6574\u6570\uff0c\u6bd4\u59822.79\u21923\uff1a</p> <pre><code>ceil(node_filesystem_files_free{mountpoint=\"/\"} / 1024 / 1024)\n</code></pre> <p>\u5411\u4e0b\u53d6\u6574\u6570\uff0c\u6bd4\u59822.79\u21922\uff1a</p> <pre><code>floor(node_filesystem_files_free{mountpoint=\"/\"} / 1024 / 1024)\n</code></pre> <p>\u5bf9\u7ed3\u679c\u8fdb\u884c\u6b63\u5411\u6392\u5e8f\uff1a</p> <pre><code>sort(sum(http_request_total) by (handler, statuscode))\n</code></pre> <p>\u5bf9\u7ed3\u679c\u8fdb\u884c\u9006\u5411\u6392\u5e8f\uff1a</p> <pre><code>sort_desc(sum(http_request_total) by (handler, statuscode))\n</code></pre> <p>predict_linear\u51fd\u6570\u53ef\u4ee5\u7528\u4e8e\u9884\u6d4b\u5206\u6790\u548c\u9884\u6d4b\u6027\u544a\u8b66\uff0c\u6bd4\u5982\u53ef\u4ee5\u6839\u636e\u4e00\u5929\u7684\u6570\u636e\u9884\u6d4b4\u4e2a\u5c0f\u65f6\u540e\u78c1\u76d8\u5206\u533a\u7684\u7a7a\u95f4\u4f1a\u4e0d\u4f1a\u5c0f\u4e8e0\uff1a</p> <pre><code>predict_linear(node_filesystem_files_free{mountpoint=\"/\"}[1d],4*3600) &lt; 0\n</code></pre> <p>\u9664\u4e86\u4e0a\u8ff0\u51fd\u6570\uff0c\u8fd8\u6709\u51e0\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u51fd\u6570\uff0c\u6bd4\u5982increase\u3001rate\u3001irate\u3002</p> <p>\u5176\u4e2dincrease\u7528\u4e8e\u8ba1\u7b97\u5728\u4e00\u6bb5\u65f6\u95f4\u8303\u56f4\u5185\u6570\u636e\u7684\u589e\u957f\uff0crate\u548cirate\u7528\u4e8e\u8ba1\u7b97\u589e\u957f\u7387\u3002\u6bd4\u5982\u67e5\u8be2\u67d0\u4e2a\u8bf7\u6c42\u57281\u5c0f\u65f6\u5185\u589e\u957f\u4e86\u591a\u5c11\uff1a</p> <pre><code>increase(http_request_total{handler=\"/api/datasources/proxy/:id/*\",method=\"get\",namespace=\"monitoring\",service=\"grafana\",statuscode=\"200\"}[1h])\n</code></pre> <p>\u5c061\u5c0f\u65f6\u589e\u957f\u7684\u6570\u91cf\u9664\u4ee5\u8be5\u65f6\u95f4\u5373\u4e3a\u589e\u957f\u7387\uff1a</p> <pre><code>increase(http_request_total{handler=\"/api/datasources/proxy/:id/*\",method=\"get\",namespace=\"monitoring\",service=\"grafana\",statuscode=\"200\"}[1h]) / 3600\n</code></pre> <p>\u5f53\u7136\uff0cincrease\u4e5f\u53ef\u4ee5\u7528\u4e8e\u78c1\u76d8\u3001CPU\u3001\u5185\u5b58\u7b49\u6307\u6807\uff0c\u8bfb\u8005\u53ef\u4ee5\u53d1\u6325\u4e00\u4e0b\u81ea\u5df1\u7684\u60f3\u8c61\u3002</p> <p>\u76f8\u5bf9\u4e8eincrease\uff0crate\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u51fa\u67d0\u4e2a\u6307\u6807\u5728\u7ed9\u5b9a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u589e\u957f\u7387\uff0c\u6bd4\u5982\u8fd8\u662f\u8ba1\u7b971\u5c0f\u65f6\u7684\u589e\u957f\u7387\uff0c\u53ef\u4ee5\u7528rate\u51fd\u6570\u8fdb\u884c\u8ba1\u7b97\uff1a</p> <pre><code>rate(http_request_total{handler=\"/api/datasources/proxy/:id/*\",method=\"get\",namespace=\"monitoring\",service=\"grafana\",statuscode=\"200\"}[1h])\n</code></pre> <p>\u5728\u4f7f\u7528rate\u548cincrease\u65f6\uff0c\u96be\u514d\u4f1a\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5e38\u8bf4\u7684\u201c\u957f\u5c3e\u6548\u5e94\u201d\uff0c\u4e5f\u5c31\u662f\u67d0\u4e2a\u6307\u6807\u4e00\u76f4\u5904\u4e8e\u4e00\u4e2a\u6570\u503c\uff0c\u8fd9\u4e2a\u589e\u957f\u7387\u5373\u4e3a0\uff0c\u6b64\u65f6\u4f1a\u51fa\u73b0\u8bef\u5224\u3002</p> <p>\u6bd4\u5982\u67d0\u4e2a\u4e3b\u673a\u7684\u78c1\u76d8\u7a7a\u95f4\u5df2\u7ecf\u5728\u6628\u5929\u8fbe\u5230\u4e86100%\uff0c\u6b64\u65f6\u67e5\u8be21\u5c0f\u65f6\u7684\u589e\u957f\u7387\uff0c\u7531\u4e8e\u6ca1\u6709\u53d8\u5316\uff0c\u56e0\u6b64\u65e0\u6cd5\u8ba1\u7b97\u5728\u8fd9\u4e2a\u65f6\u95f4\u7a97\u53e3\u7684\u5e73\u5747\u589e\u957f\u7387\uff0c\u5c31\u610f\u5473\u7740\u65e0\u6cd5\u53cd\u6620\u6b64\u95ee\u9898\u3002</p> <p>PromQL\u9488\u5bf9\u201c\u957f\u5c3e\u6548\u5e94\u201d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u52a0\u7075\u654f\u7684\u51fd\u6570\uff1a</p> <p>irate\uff0c\u540c\u6837\u7528\u4e8e\u8ba1\u7b97\u533a\u95f4\u5411\u91cf\u7684\u589e\u957f\u901f\u7387\uff0c\u4f46\u662firate\u8ba1\u7b97\u7684\u662f\u77ac\u65f6\u589e\u957f\u7387\uff0c\u5373irate\u662f\u901a\u8fc7 \u533a\u95f4\u5411\u91cf\u4e2d\u6700\u540e\u4e24\u4e2a\u6837\u672c\u6570\u636e\u6765\u8ba1\u7b97\u533a\u95f4\u5411\u91cf\u7684\u589e\u957f\u7387\u7684\uff0c\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u9002\u5f53\u907f\u514d\u4e00\u4e9b\u6307\u6807\u7684\u201c\u957f\u5c3e\u6548\u5e94\u201d\u3002</p> <p>\u867d\u7136irate\u8f83rate\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7684\u7075\u654f\u5ea6\uff0c\u4f46\u662f\u5982\u679c\u9700\u8981\u5206\u6790\u957f\u671f\u8d8b\u52bf\uff0c\u6216\u8005\u5728\u914d\u7f6e\u544a\u8b66\u89c4\u5219\u65f6\uff0cirate\u8fc7\u9ad8\u7684\u7075\u654f\u5ea6\u4f1a\u9020\u6210\u5e72\u6270\uff0c\u9488\u5bf9\u957f\u671f\u8d8b\u52bf\u5206\u6790\u548c\u544a\u8b66\u89c4\u5219\uff0c\u66f4\u63a8\u8350\u4f7f\u7528rate\u51fd\u6570\u3002</p> <p>\u5b9e\u9645\u5e94\u7528\u73af\u5883\u4e2d\u5982\u679c\u9700\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8ePromQL\u51fd\u6570\u7684\u5185\u5bb9\uff0c\u8bfb\u8005\u53ef\u4ee5\u4ece\u5b98\u7f51https://prometheus.io/docs/prometheus/2.4/querying/functions/\u4e2d\u7ee7\u7eed\u5b66\u4e60\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#8alertmanager\u544a\u8b66\u5165\u95e8","title":"8.Alertmanager\u544a\u8b66\u5165\u95e8","text":"<p>\u524d\u9762\u4ecb\u7ecd\u4e86\u4e00\u4e9b\u6bd4\u8f83\u5e38\u7528\u7684Prometheus\u67e5\u8be2\u8bed\u6cd5\uff0c\u540c\u65f6\u4e5f\u5b66\u4e60\u4e86\u544a\u8b66\u8bed\u6cd5\u7684\u7f16\u5199\u65b9\u6cd5\u3002</p> <p>\u672c\u8282\u6211\u4eec\u5b66\u4e60Prometheus\u7684\u544a\u8b66\u7ec4\u4ef6Alertmanager\uff0c\u770b\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528\u4e00\u4e9b\u5e38\u7528\u7684\u5a92\u4ecb\u53d1\u9001\u544a\u8b66\u901a\u77e5\uff0c\u540c\u65f6\u4e5f\u4f1a\u5b66\u4e60Alertmanager\u7684\u8def\u7531 \u89c4\u5219\uff0c\u5c06\u544a\u8b66\u8fdb\u884c\u5206\u7ec4\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#81-alertmanager\u914d\u7f6e\u6587\u4ef6\u89e3\u6790","title":"8.1 Alertmanager\u914d\u7f6e\u6587\u4ef6\u89e3\u6790","text":"<p>\u9996\u5148\u770b\u4e00\u4e2a\u7b80\u5355\u7684Alertmanager\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>## Alertmanager \u914d\u7f6e\u6587\u4ef6\nglobal:\nresolve_timeout: 5m\n# smtp\u914d\u7f6e\nsmtp_from: \"prom-alert@example.com\"\nsmtp_smarthost: 'email-smtp.us-west-2.amazonaws.com:465'\nsmtp_auth_username: \"user\"\nsmtp_auth_password: \"pass\"\nsmtp_require_tls: true\n# email\u3001\u4f01\u4e1a\u5fae\u4fe1\u7684\u6a21\u677f\u914d\u7f6e\u5b58\u653e\u4f4d\u7f6e\uff0c\u9489\u9489\u7684\u6a21\u677f\u4f1a\u5355\u72ec\u8bb2\u5982\u679c\u914d\u7f6e\u3002\ntemplates:\n- '/data/alertmanager/templates/*.tmpl'\n# \u8def\u7531\u5206\u7ec4\nroute:\nreceiver: Default\ngroup_by:\n- namespace\n- job\n- alertname\nroutes:\n- receiver: Watchdog\nmatch:\nalertname: Watchdog\n- receiver: Critical\nmatch:\nseverity: critical\ngroup_wait: 30s\ngroup_interval: 5m\nrepeat_interval: 10m\n# \u6291\u5236\u5668\u914d\u7f6e\ninhibit_rules:\n- source_match: # \u6e90\u6807\u7b7e\u8b66\u62a5\u89e6\u53d1\u65f6\u6291\u5236\u542b\u6709\u76ee\u6807\u6807\u7b7e\u7684\u8b66\u62a5\uff0c\u5728\u5f53\u524d\u8b66\u62a5\u5339\u914d status: 'High'\nseverity: critical\ntarget_match_re:\nseverity: warning|info\nequal:\n- namespace\n- alertname\n- source_match:\nseverity: warning\ntarget_match_re:\nseverity: info\nequal:\n- namespace\n- alertname\n# \u63a5\u6536\u5668\u6307\u5b9a\u53d1\u9001\u4eba\u4ee5\u53ca\u53d1\u9001\u6e20\u9053\nreceivers:\n# ops\u5206\u7ec4\u7684\u5b9a\u4e49\n- name: ops\nemail_configs:\n- to: '9935226@qq.com,10000@qq.com'\nsend_resolved: true\nheaders: subject: \"[operations] \u62a5\u8b66\u90ae\u4ef6\"\nfrom: \"\u8b66\u62a5\u4e2d\u5fc3\"\nto: \"\u5c0f\u715c\u72fc\u7687\" # \u9489\u9489\u914d\u7f6e\nwebhook_configs:\n- url: http://localhost:8070/dingtalk/ops/send\n# \u4f01\u4e1a\u5fae\u4fe1\u914d\u7f6e\nwechat_configs:\n- corp_id: 'ww5421dksajhdasjkhj'\napi_url: 'https://qyapi.weixin.qq.com/cgi-bin/'\nsend_resolved: true\nto_party: '2'\nagent_id: '1000002'\napi_secret: 'Tm1kkEE3RGqVhv5hO-khdakjsdkjsahjkdksahjkdsahkj'\n# web\n- name: web\nemail_configs:\n- to: '9935226@qq.com'\nsend_resolved: true\nheaders: { Subject: \"[web] \u62a5\u8b66\u90ae\u4ef6\"} # \u63a5\u6536\u90ae\u4ef6\u7684\u6807\u9898\nwebhook_configs:\n- url: http://localhost:8070/dingtalk/web/send\n- url: http://localhost:8070/dingtalk/ops/send\n# db\n- name: db\nemail_configs:\n- to: '9935226@qq.com'\nsend_resolved: true\nheaders: { Subject: \"[db] \u62a5\u8b66\u90ae\u4ef6\"} # \u63a5\u6536\u90ae\u4ef6\u7684\u6807\u9898\nwebhook_configs:\n- url: http://localhost:8070/dingtalk/db/send\n- url: http://localhost:8070/dingtalk/ops/send\n# hadoop\n- name: hadoop\nemail_configs:\n- to: '9935226@qq.com'\nsend_resolved: true\nheaders: { Subject: \"[hadoop] \u62a5\u8b66\u90ae\u4ef6\"} # \u63a5\u6536\u90ae\u4ef6\u7684\u6807\u9898\nwebhook_configs:\n- url: http://localhost:8070/dingtalk/hadoop/send\n- url: http://localhost:8070/dingtalk/ops/send\n</code></pre> <p>\u4ece\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u770b\u51fa\uff0cAlertmanager\u7684\u914d\u7f6e\u4e3b\u8981\u5206\u4e3a5\u5927\u5757\uff1a</p> <ul> <li> <p>Global\uff1a\u5168\u5c40\u914d\u7f6e\uff0c\u4e3b\u8981\u8fdb\u884c\u4e00\u4e9b\u901a\u7528\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u90ae\u4ef6\u901a\u77e5\u7684\u8d26\u53f7\u3001\u5bc6\u7801\u3001SMTP\u670d\u52a1\u5668\u3001\u5fae\u4fe1\u544a\u8b66\u7b49\u3002Global\u5757\u914d\u7f6e\u4e0b\u7684\u914d\u7f6e\u9009\u9879\u5728\u672c\u914d\u7f6e\u6587\u4ef6\u5185\u7684\u6240\u6709\u914d\u7f6e\u9879\u4e0b\u53ef\u89c1\uff0c\u4f46\u662f\u6587\u4ef6\u5185\u5176\u4ed6\u4f4d\u7f6e\u7684\u5b50\u914d\u7f6e\u53ef\u4ee5\u8986\u76d6Global\u914d\u7f6e\u3002</p> </li> <li> <p>Templates\uff1a\u7528\u4e8e\u653e\u7f6e\u81ea\u5b9a\u4e49\u6a21\u677f\u7684\u4f4d\u7f6e\u3002</p> </li> <li>Route\uff1a\u544a\u8b66\u8def\u7531\u914d\u7f6e\uff0c\u7528\u4e8e\u544a\u8b66\u4fe1\u606f\u7684\u5206\u7ec4\u8def\u7531\uff0c\u53ef\u4ee5\u5c06\u4e0d\u540c\u5206\u7ec4\u7684\u544a\u8b66\u53d1\u9001\u7ed9\u4e0d\u540c\u7684\u6536\u4ef6\u4eba\u3002\u6bd4\u5982\u5c06\u6570\u636e\u5e93\u544a\u8b66\u53d1\u9001\u7ed9DBA\uff0c\u670d\u52a1\u5668\u544a\u8b66\u53d1\u9001\u7ed9OPS\u3002</li> <li>Inhibit_rules\uff1a\u544a\u8b66\u6291\u5236\uff0c\u4e3b\u8981\u7528\u4e8e\u51cf\u5c11\u544a\u8b66\u7684\u6b21\u6570\uff0c\u9632\u6b62\u201c\u544a\u8b66\u8f70\u70b8\u201d\u3002\u6bd4\u5982\u67d0\u4e2a\u5bbf\u4e3b\u673a\u5b95\u673a\uff0c\u53ef\u80fd\u4f1a\u5f15\u8d77\u5bb9\u5668\u91cd\u5efa\u3001\u6f02\u79fb\u3001\u670d\u52a1   \u4e0d\u53ef\u7528\u7b49\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u5982\u679c\u6bcf\u4e2a\u5f02\u5e38\u5747\u6709\u544a\u8b66\uff0c\u4f1a\u4e00\u6b21\u6027\u53d1\u9001\u5f88\u591a\u544a\u8b66\uff0c\u9020\u6210\u544a\u8b66\u8f70\u70b8\uff0c\u5e76\u4e14\u4e5f\u4f1a\u5e72\u6270\u5b9a\u4f4d\u95ee\u9898\u7684\u601d\u8def\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f   \u7528\u544a\u8b66\u6291\u5236\uff0c\u5c4f\u853d\u7531\u5bbf\u4e3b\u673a\u5b95\u673a\u5f15\u6765\u7684\u5176\u4ed6\u95ee\u9898\uff0c\u53ea\u53d1\u9001\u5bbf\u4e3b\u673a\u5b95\u673a\u7684\u6d88\u606f\u5373\u53ef\u3002</li> <li>Receivers\uff1a\u544a\u8b66\u6536\u4ef6\u4eba\u914d\u7f6e\uff0c\u6bcf\u4e2areceiver\u90fd\u6709\u4e00\u4e2a\u540d\u5b57\uff0c\u7ecf\u8fc7route\u5206\u7ec4\u5e76\u4e14\u8def\u7531\u540e\u9700\u8981\u6307\u5b9a\u4e00\u4e2areceiver\uff0c\u5c31\u662f\u5728\u6b64\u4f4d\u7f6e\u914d\u7f6e   \u7684\u3002</li> </ul> <p>\u4e86\u89e3\u5b8cAlertmanager\u4e3b\u8981\u7684\u914d\u7f6e\u5757\u540e\uff0c\u63a5\u4e0b\u6765\u5bf9Alertmanager\u6bd4\u8f83\u91cd\u8981\u7684Route\u5355\u72ec\u8bb2\u89e3\uff0c\u5176\u4ed6\u914d\u7f6e\u4f1a\u5728\u5b9e\u8df5\u4e2d\u8fdb\u884c\u8865\u5145\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#82-alertmanager\u8def\u7531\u89c4\u5219","title":"8.2 Alertmanager\u8def\u7531\u89c4\u5219","text":"<p>\u524d\u6587\u63d0\u5230\u8fc7Route\u662f\u544a\u8b66\u7684\u8def\u7531\u914d\u7f6e\uff0c\u5b83\u53ef\u4ee5\u8ba9\u544a\u8b66\u6839\u636e\u5206\u7ec4\u53d1\u9001\u7ed9\u5bf9\u5e94\u7684\u4eba\u6216\u8005\u5c0f\u7ec4\uff0c\u8fd9\u4e00\u5757\u7684\u914d\u7f6e\u662fAlertmanager\u6bd4\u8f83\u590d\u6742\u4e14\u7ecf\u5e38\u53d8\u66f4\u7684\u914d\u7f6e\uff0c\u6240\u4ee5\u672c\u5c0f\u8282\u5c06\u8bb2\u89e3\u4e00\u4e0bAlertmanager\u7684\u8def\u7531\u914d\u7f6e\u3002</p> <p>\u4ece\u4e0a\u8ff0\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u622a\u53d6Route\u914d\u7f6e\uff1a</p> <pre><code># \u8def\u7531\u5206\u7ec4\nroute:\nreceiver: Default\ngroup_by:\n- namespace\n- job\n- alertname\nroutes:\n- receiver: Watchdog\nmatch:\nalertname: Watchdog\n- receiver: Critical\nmatch:\nseverity: critical\ngroup_wait: 30s\ngroup_interval: 5m\nrepeat_interval: 10m\n</code></pre> <p>\u4ece\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u770b\u51fa\uff0c\u8def\u7531\u914d\u7f6e\u5757\u7684\u9876\u7ea7\u914d\u7f6e\u7531route\u5f00\u59cb\uff0c\u5b83\u662f\u6574\u4e2a\u8def\u7531\u7684\u5165\u53e3\uff0c\u79f0\u4f5c\u6839\u8def\u7531\u3002</p> <p>\u6bcf\u4e00\u6761\u544a\u8b66\u8fdb\u6765\u540e\uff0c\u90fd\u5148\u8fdb\u5165route\uff0c\u4e4b\u540e\u6839\u636e\u544a\u8b66\u81ea\u8eab\u7684\u6807\u7b7e\u548croute.group_by\u914d\u7f6e\u7684\u5b57\u6bb5\u8fdb\u884c\u5206\u7ec4\u3002\u6bd4\u5982\u53ef\u4ee5\u6839\u636ejob\u3001 cluster\u6216\u8005\u5176\u4ed6\u81ea\u5b9a\u4e49\u7684\u6807\u7b7e\u540d\u79f0\u8fdb\u884c\u5206\u7ec4\uff0c\u5206\u7ec4\u540e\u8fdb\u5165\u5b50\u8def\u7531\uff08\u901a\u8fc7route.routes\u914d\u7f6e\u5b50\u8def\u7531\uff09\uff0c\u8fdb\u4e00\u6b65\u8fdb\u884c\u66f4\u52a0\u7ec6\u7c92\u5ea6\u7684\u5212\u5206\uff0c\u6bd4\u5982job\u540d\u79f0\u5305\u542bmysql\u7684\u53d1\u9001\u7ed9DBA\u7ec4\u3002</p> <p>\u9664\u4e86group_by\u548croutes\u5916\uff0cRoute\u8fd8\u6709\u4ee5\u4e0b\u5e38\u7528\u7684\u914d\u7f6e\uff1a</p> <ul> <li> <p>receiver\uff1a\u544a\u8b66\u7684\u901a\u77e5\u76ee\u6807\uff0c\u9700\u8981\u548creceivers\u914d\u7f6e\u4e2d\u7684name\u8fdb\u884c\u5339\u914d\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0croute.routes\u4e0b\u4e5f\u53ef\u4ee5\u6709receiver\u914d\u7f6e\uff0c\u4f18\u5148\u7ea7\u9ad8\u4e8eroute.receiver\u914d\u7f6e\u7684\u9ed8\u8ba4\u63a5\u6536\u4eba\uff0c\u5f53\u544a\u8b66\u6ca1\u6709\u5339\u914d\u5230\u5b50\u8def\u7531\u65f6,\u4f1a\u4f7f\u7528route.receiver\u8fdb\u884c\u901a\u77e5,\u6bd4\u5982\u4e0a\u8ff0\u914d\u7f6e\u4e2d\u7684Default\u3002</p> </li> <li> <p>group_by \uff1a \u5206\u7ec4\u914d\u7f6e,\u503c\u7c7b\u578b\u4e3a\u5217\u8868\u3002\u6bd4\u5982\u914d\u7f6e\u6210['job','severity']\uff0c\u4ee3\u8868\u544a\u8b66\u4fe1\u606f\u5305\u542bjob\u548cseverity\u6807\u7b7e\u7684\u4f1a\u8fdb\u884c\u5206\u7ec4\uff0c\u4e14\u6807\u7b7e\u7684key\u548cvalue\u90fd\u76f8\u540c\u624d\u4f1a\u88ab\u5206\u5230\u4e00\u7ec4\u3002</p> </li> <li> <p>continue\uff1a\u51b3\u5b9a\u5339\u914d\u5230\u7b2c\u4e00\u4e2a\u8def\u7531\u540e\uff0c\u662f\u5426\u7ee7\u7eed\u540e\u7eed\u5339\u914d\u3002\u9ed8\u8ba4\u4e3afalse\uff0c\u5373\u5339\u914d\u5230\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\u540e\u505c\u6b62\u7ee7\u7eed\u5339\u914d\u3002</p> </li> <li> <p>match\uff1a\u4e00\u5bf9\u4e00\u5339\u914d\u89c4\u5219\uff0c\u6bd4\u5982match\u914d\u7f6e\u7684\u4e3ajob: mysql\uff0c\u90a3\u4e48\u5177\u6709job=mysql\u7684\u544a\u8b66\u4f1a\u8fdb\u5165\u8be5\u8def\u7531\u3002</p> </li> <li> <p>match_re\uff1a\u548cmatch\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7match_re\u662f\u6b63\u5219\u5339\u914d\u3002</p> </li> <li> <p>matchers\uff1a\u8fd9\u662fAlertmanager 0.22\u7248\u672c\u65b0\u6dfb\u52a0\u7684\u4e00\u4e2a\u914d\u7f6e\u9879\uff0c\u7528\u4e8e\u66ff\u6362match\u548cmatch_re\uff0c\u5982\u679c\u8bfb\u8005\u75280.22\u4ee5\u4e0a\u7248\u672c\u7684Alertmanager\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u8be5\u53c2\u6570\u3002Matchers\u8bbe\u8ba1\u7406\u5ff5\u53c2\u8003\u4e86PromQL\u548cOpenMetrics\uff0c\u53ef\u4ee5\u76f4\u63a5\u5199\u6210\u5982\u4e0b\u683c\u5f0f\uff1a</p> </li> <li> <p>\u5339\u914dfoo\u7b49\u4e8ebar\u4e14dings\u4e0d\u7b49\u4e8ebums</p> <pre><code>matchers:\n  - foo = bar\n  - dings != bums\n</code></pre> </li> <li> <p>\u5339\u914dfoo\u7b49\u4e8ebar\u548cbaz\uff0c\u4e14dings\u4e0d\u7b49\u4e8ebums\uff1a</p> <pre><code>matchers\uff1a[ \"foo = bar,baz\", \"dings != bums\" ]\n</code></pre> </li> <li> <p>\u5339\u914dfoo\u7b49\u4e8ebar\u4e14dings\u4e0d\u7b49\u4e8ebums\u7684\u53e6\u4e00\u79cd\u5199\u6cd5\uff0c\u548cPromQL\u7c7b\u4f3c\uff1a</p> <pre><code>matchers\uff1a[ '{foo=\"bar\", dings!=\"bums\"}' ]\n</code></pre> </li> <li> <p>group_wait\uff1a\u544a\u8b66\u901a\u77e5\u7b49\u5f85\uff0c\u503c\u7c7b\u578b\u4e3a\u5b57\u7b26\u4e32\u3002\u82e5\u4e00\u7ec4\u65b0\u7684\u544a\u8b66\u4ea7\u751f\uff0c\u5219\u4f1a\u7b49group_wait\u540e\u518d\u53d1\u9001\u901a\u77e5\uff0c\u8be5\u529f\u80fd\u4e3b\u8981\u7528\u4e8e\u5f53\u544a\u8b66\u5728\u5f88\u77ed\u65f6\u95f4\u5185\u63a5\u8fde\u4ea7\u751f\u65f6\uff0c\u5728group_wait\u5185\u5408\u5e76\u4e3a\u5355\u4e00\u7684\u544a\u8b66\u540e\u518d\u53d1\u9001\uff0c\u9632\u6b62\u544a\u8b66\u8fc7\u591a\uff0c\u9ed8\u8ba4\u503c\u4e3a30s\u3002</p> </li> <li> <p>group_interval\uff1a\u540c\u4e00\u7ec4\u544a\u8b66\u901a\u77e5\u540e\uff0c\u5982\u679c\u6709\u65b0\u7684\u544a\u8b66\u6dfb\u52a0\u5230\u8be5\u7ec4\u4e2d\uff0c\u518d\u6b21\u53d1\u9001\u544a\u8b66\u901a\u77e5\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4\u503c\u4e3a5ms\u3002</p> </li> <li>repeat_interval\uff1a\u5982\u679c\u4e00\u6761\u544a\u8b66\u901a\u77e5\u5df2\u6210\u529f\u53d1\u9001\uff0c\u4e14\u5728\u95f4\u9694repeat_interval\u540e\uff0c\u8be5\u544a\u8b66\u4ecd\u7136\u672a\u88ab\u8bbe\u7f6e\u4e3aresolved\uff0c\u5219\u4f1a\u518d\u6b21\u53d1   \u9001\u8be5\u544a\u8b66\u901a\u77e5\uff0c\u9ed8\u8ba4\u503c\u4e3a4h\u3002</li> </ul> <p>\u4ee5\u4e0a\u5373\u4e3aAlertmanager\u5e38\u7528\u7684\u8def\u7531\u914d\u7f6e\uff0c\u53ef\u4ee5\u770b\u5230Alertmanager\u7684\u8def\u7531\u548c\u5339\u914d\u89c4\u5219\u975e\u5e38\u7075\u6d3b\uff0c\u901a\u8fc7\u4e0d\u540c\u7684\u8def\u7531\u5d4c\u5957\u548c\u5339\u914d\u89c4\u5219\u53ef\u4ee5\u8fbe\u5230\u4e0d\u540c\u7684\u901a\u77e5\u6548\u679c\u3002</p> <p>\u5bf9\u4e8eAlertmanager\u7684\u5176\u4ed6\u914d\u7f6e\uff0c\u4f1a\u5728\u5b9e\u8df5\u4e2d\u8fdb\u884c\u8865\u5145\u3002\u63a5\u4e0b\u6765\u5b66\u4e60\u5982\u4f55\u5c06\u544a\u8b66\u901a\u8fc7\u4e0d\u540c\u7684\u5a92\u4ecb\u8fdb\u884c\u901a\u77e5\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#83-alertmanager\u90ae\u4ef6\u901a\u77e5","title":"8.3 Alertmanager\u90ae\u4ef6\u901a\u77e5","text":"<p>\u544a\u8b66\u90ae\u4ef6\u901a\u77e5\u662f\u4f01\u4e1a\u5185\u6700\u5e38\u7528\u7684\u4e00\u79cd\u901a\u77e5\u65b9\u5f0f\uff0cAlertmanager\u539f\u751f\u652f\u6301\u90ae\u4ef6\u544a\u8b66\u65b9\u5f0f\uff0c\u5176\u914d\u7f6e\u65b9\u5f0f\u76f8\u5bf9\u7b80\u5355\u3002\u9996\u5148\u8fdb\u5165\u5728\u5b89\u88c5\u5c0f\u8282\uff08\u672c\u4e6615.2\u8282\uff09clone\u7684\u4ee3\u7801\u76ee\u5f55\uff0c\u627e\u5230Alertmanager\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u5176\u4ed6\u5b89\u88c5\u65b9\u5f0f\u7684\u4f4d\u7f6e\u53ef\u80fd\u4e0d\u540c\uff0c\u9700\u8981\u81ea\u884c\u627e\u5230\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u914d\u7f6e\u6587\u4ef6\u7684\u5185\u5bb9\u662f\u4e00\u81f4\u7684\uff09\uff1a</p> <pre><code>[root@centos7-base kube-prometheus]# cd manifests/\n[root@centos7-base manifests]# ls alertmanager-secret.yaml\nalertmanager-secret.yaml\n</code></pre> <p>\u4f7f\u7528Operator\u5f62\u5f0f\u5b89\u88c5\u7684Prometheus\u548cAlertmanager\uff0c\u914d\u7f6e\u90fd\u4f1a\u5b58\u50a8\u5728Kubernetes\u7684ConfigMap\u548cSecret\u4e2d\u3002</p> <p>Alertmanager\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u901a\u8fc7Secret\u8fdb\u884c\u5b58\u50a8\u7684\uff0c\u5176\u539f\u59cb\u6587\u4ef6\u4e3aalertmanagersecret.yaml\uff0c\u5185\u5bb9\u5927\u81f4\u5982\u4e0b\uff1a</p> <pre><code>cat alertmanager-secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\nlabels:\nalertmanager: main\napp.kubernetes.io/component: alert-router\napp.kubernetes.io/name: alertmanager\napp.kubernetes.io/part-of: kube-prometheus\napp.kubernetes.io/version: 0.22.2\nname: alertmanager-main\nnamespace: monitoring\nstringData:\nalertmanager.yaml: |-\n\"global\":\n\"resolve_timeout\": \"5m\"\n......\n</code></pre> <p>\u524d\u6587\u63d0\u5230\u8fc7\uff0c\u4e00\u822c\u901a\u7528\u914d\u7f6e\u4f1a\u653e\u7f6e\u5728global\u914d\u7f6e\u4e2d\uff0c\u8fdb\u884c\u90ae\u4ef6\u901a\u77e5\u7684SMTP\u914d\u7f6e\u4e5f\u662f\u653e\u5728global\u4e0b\u3002</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7163\u90ae\u7bb1\u914d\u7f6e\u90ae\u4ef6\u901a\u77e5\uff0c\u9996\u5148\u5728163\u90ae\u7bb1\u5e73\u53f0\u5c06SMTP\u529f\u80fd\u6253\u5f00\uff08\u672c\u4e66\u4e0d\u505a\u6f14\u793a\uff09\uff0c\u4e4b\u540e\u5728alertmanager- secret.yaml\u6587\u4ef6\u7684global\u4e0b\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>  alertmanager.yaml: |-\n\"global\":\nresolve_timeout: \"5m\"\n# smtp\u914d\u7f6e\nsmtp_from: \"1879324764@qq.com\"\nsmtp_smarthost: 'smtp.qq.com:25'\nsmtp_hello: \"smtp.qq.com\"\nsmtp_auth_username: \"1879324764@qq.com\"\nsmtp_auth_password: \"ucpkvebqnkysecgh\"\nsmtp_require_tls: false\n</code></pre> <p>\u4e4b\u540e\u5c06\u540d\u79f0\u4e3aDefault\u7684receiver\u914d\u7f6e\u66f4\u6539\u4e3a\u90ae\u4ef6\u901a\u77e5,\u4fee\u6539alertmanager-secret.yaml\u6587\u4ef6\u7684receivers\u914d\u7f6e\u5982\u4e0b\uff1a</p> <pre><code>    \"receivers\":\n- \"name\": \"Default\"\n\"email_configs\":\n- to: \"notification@163.com\"\nsend_resolved: true\n- \"name\": \"Watchdog\"\n- \"name\": \"Critical\"\n</code></pre> <ul> <li>email_configs\uff1a\u4ee3\u8868\u4f7f\u7528\u90ae\u4ef6\u901a\u77e5\u3002</li> <li>to\uff1a\u6536\u4ef6\u4eba\uff0c\u6b64\u5904\u4e3anotification@163.com\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c\u7528\u9017\u53f7\u9694\u5f00\u3002</li> <li>send_resolved\uff1a\u5982\u679c\u544a\u8b66\u88ab\u89e3\u51b3\uff0c\u662f\u5426\u53d1\u9001\u89e3\u51b3\u901a\u77e5</li> </ul> <p>\u81f3\u6b64\uff0c\u5373\u5b8c\u6210\u4e86\u544a\u8b66\u7684\u90ae\u4ef6\u901a\u77e5\u3002\u63a5\u4e0b\u6765\u5206\u6790\u4e00\u4e0b\u8def\u7531\u89c4\u5219\uff08\u9ed8\u8ba4\u5206\u7ec4\u53ea\u6709namespace\uff0c\u5728\u6b64\u6dfb\u52a0job\u548calertname\uff0c\u5f53\u7136\u4e0d\u6dfb\u52a0\u4e5f\u53ef\u4ee5\uff09\uff1a</p> <pre><code># \u8def\u7531\u5206\u7ec4\nroute:\ngroup_wait: 30s\ngroup_interval: 5m\nrepeat_interval: 10m\nreceiver: Default\n\"group_by\":\n- \"namespace\"\n- \"job\"\n- \"alertname\"\nroutes:\n- receiver: Watchdog\nmatch:\nalertname: Watchdog\n- receiver: Critical\nmatch:\nseverity: critical\n</code></pre> <p>\u8be5\u544a\u8b66\u89c4\u5219\u5bf9namespace\u6807\u7b7e\u8fdb\u884c\u5206\u7ec4\uff08group_by\u5b57\u6bb5\uff09\uff0c\u6ca1\u6709\u5339\u914d\u5230\u5b50\u8def\u7531\u7684\u544a\u8b66\u9ed8\u8ba4\u53d1\u9001\u7ed9\u540d\u4e3aDefault\u7684receiver\uff08receiver\u5b57\u6bb5\uff09\u3002</p> <p>\u5982\u679c\u5339\u914d\u5230alertname=Watchdog\u7684\u544a\u8b66\uff0c\u5219\u5c06\u901a\u77e5\u53d1\u9001\u7ed9Watchdog\uff0c\u5982\u679c\u5339\u914d\u5230severity=critical\u7684\u544a\u8b66\uff0c\u5219\u5c06\u901a\u77e5\u53d1\u9001\u7ed9Critical\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Alertmanager\u63d0\u4f9b\u7684Web UI\u67e5\u770b\u5206\u7ec4\u4fe1\u606f\uff0c\u548cPrometheus\u4e00\u81f4\uff0c\u5c06Alertmanager\u7684Service\u66f4\u6539\u4e3aNodePort\uff08\u89c1\u56fe15.42\uff09\uff1a</p> <pre><code># kubectl edit svc -n monitoring alertmanager-main\n</code></pre> <pre><code>  ports:\n- name: web\nnodePort: 32234\nport: 9093\nprotocol: TCP\ntargetPort: web\nselector:\nalertmanager: main\napp: alertmanager\napp.kubernetes.io/component: alert-router\napp.kubernetes.io/name: alertmanager\napp.kubernetes.io/part-of: kube-prometheus\nsessionAffinity: ClientIP\nsessionAffinityConfig:\nclientIP:\ntimeoutSeconds: 10800\ntype: NodePort\n</code></pre> <p>\u67e5\u770b\u76d1\u542c\u7684\u7aef\u53e3\u53f7\uff1a</p> <pre><code>$ kubectl get svc -n monitoring alertmanager-main\nNAME                TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE\nalertmanager-main   NodePort   10.99.53.46   &lt;none&gt;        9093:32234/TCP   21h\n</code></pre> <p>\u5c06\u66f4\u6539\u597d\u7684Alertmanager\u914d\u7f6e\u52a0\u8f7d\u5230Alertmanager\uff1a</p> <pre><code>$ kubectl replace -f alertmanager-secret.yaml\nsecret/alertmanager-main replaced\n</code></pre> <p>\u7a0d\u7b49\u51e0\u5206\u949f\uff0c\u5373\u53ef\u5728Alertmanager\u7684Web\u754c\u9762\u770b\u5230\u66f4\u6539\u7684\u914d\u7f6e(Status\uff09\uff0c\u5982\u56fe15.43\u6240\u793a\u3002</p> <p> \u56fe15.43\u3000\u67e5\u770bAlertmanager\u914d\u7f6e</p> <p>\u4e5f\u53ef\u4ee5\u67e5\u770b\u5206\u7ec4\u4fe1\u606f\uff0c\u5982\u56fe15.44\u6240\u793a\u3002  \u56fe15.44\u3000\u67e5\u770b\u544a\u8b66\u5206\u7ec4</p> <p>\u5728\u5b89\u88c5Prometheus\u540e\uff0c\u5982\u679c\u6ca1\u6709\u505a\u4efb\u4f55\u66f4\u6539\uff0c\u53ef\u80fd\u4f1a\u5728Prometheus\u9875\u9762\u770b\u5230\u5982\u4e0b\u544a\u8b66\uff1a</p> <ul> <li>KubeSchedulerDown\u548cKubeControllerManagerDown\u53ef\u4ee5\u53c2\u800315.3.3\u8282\u7684ServiceMonitor\u8fdb\u884c\u89e3\u51b3\u3002</li> <li>Watchdog\uff1a\u5e76\u975e\u662f\u4e00\u4e2a\u5f02\u5e38\u7684\u544a\u8b66\uff0c\u800c\u662fPrometheus\u96c6\u7fa4\u7684\u72b6\u6001\u76d1\u63a7\uff0c\u5b83\u8868\u793aPrometheus\u96c6\u7fa4\u7684\u72b6\u6001\u662f\u6b63\u5e38\u7684\uff0c\u53ef\u4ee5\u5c06\u6b64\u544a\u8b66\u5173\u95ed\u3002</li> <li>CPU?hrottlingHigh\uff1a\u8be5\u544a\u8b66\u53cd\u6620\u7684\u662f\u6700\u8fd15\u5206\u949f\u8d85\u8fc725%\u7684CPU\u6267\u884c\u5468\u671f\u53d7\u5230\u9650\u5236\u7684\u5bb9\u5668\uff0c\u4e00\u822c\u662flimit\u8bbe\u7f6e\u5f97\u4f4e\u6216\u8005\u672a\u8bbe\u7f6e\u5f15\u8d77\u7684\u3002\u53ef\u4ee5\u5c06\u6b64\u544a\u8b66\u5173\u95ed\uff0c\u6216\u8005\u5408\u7406\u914d\u7f6e\u5bb9\u5668\u7684resources\u53c2\u6570\u3002</li> <li>NodeClockNotSynchronising\uff1a\u8be5\u544a\u8b66\u662f\u7531\u4e8e\u4e3b\u673a\u548c\u65f6\u95f4\u670d\u52a1\u5668\u65e0\u6cd5\u8fde\u63a5\u5bfc\u81f4\u7684\uff0c\u8bfb\u8005\u53ef\u80fd\u5e76\u6ca1\u6709\u6b64\u544a\u8b66\uff0c\u8be5\u544a\u8b66\u53ef\u4ee5\u76f4\u63a5\u5173\u95ed\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6eNTP\u670d\u52a1\u5668\u6765\u89e3\u51b3\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\u5355\u51fb\u4efb\u610f\u4e00\u4e2a\u544a\u8b66\uff0c\u53ef\u4ee5\u67e5\u770b\u5230\u8be5\u6761\u544a\u8b66\u4fe1\u606f\u7684\u544a\u8b66\u8bed\u6cd5\uff0c\u5982\u56fe15.45\u548c\u56fe15.46\u6240\u793a\u3002</p> <p> \u56fe15.45\u3000\u67e5\u770b\u544a\u8b66</p> <p> \u56fe15.46\u3000\u67e5\u770b\u544a\u8b66\u8bed\u6cd5</p> <p>\u4e4b\u540e\u5355\u51fbexpr\u7684\u8bed\u6cd5\uff0c\u53ef\u4ee5\u8fdb\u5165\u67e5\u8be2\u9875\u9762\uff0c\u5982\u56fe15.47\u6240\u793a\u3002  \u56fe15.47\u3000\u67e5\u770bexpr\u8bed\u6cd5</p> <p>\u6b64\u65f6\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2ametric\u7684\u6807\u7b7e\uff0c\u5982\u679c\u67e5\u770b\u6bcf\u4e2a\u5df2\u7ecf\u544a\u8b66\u7684\u8be6\u7ec6\u8bed\u6cd5\uff0c\u53ef\u4ee5\u770b\u5230Watchdog\u5177\u6709alertname=\"Watchdog\"\u6807\u7b7e\uff0c\u4e24\u4e2aKube\u7684\u544a\u8b66\uff08\u5982\u6709\uff09\u5177\u6709severity=\"critical\"\u6807\u7b7e\uff0c\u8fd9\u4e24\u6761\u544a\u8b66\u5747\u88ab\u5b50\u8def\u7531\u5339\u914d\uff0c\u5206\u522b\u5c06\u544a\u8b66\u53d1\u9001\u7ed9\u4e86Watchdog\u548cCritical\uff0c\u7531\u4e8e\u4e24\u8005\u5e76\u6ca1\u6709\u914d\u7f6e\u5b9e\u9645\u7684\u5a92\u4ecb\uff0c\u56e0\u6b64\u6682\u65f6\u65e0\u6cd5\u6536\u5230\u8be5\u544a\u8b66\u3002</p> <p>\u800cCPUThrottlingHigh\u548cNodeClockNotSynchronising\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55\u5b50\u8def\u7531\uff0c\u6240\u4ee5\u5c06\u544a\u8b66\u4fe1\u606f\u53d1\u9001\u5230\u4e86\u9ed8\u8ba4\u7684receiver\uff0c\u4e5f\u5c31\u662fDefault\uff0c\u6b64\u65f6Default receiver\u914d\u7f6e\u7684\u90ae\u7bb1\u4f1a\u6536\u5230\u4e24\u8005\u7684\u544a\u8b66\u4fe1\u606f\uff0c\u5982\u56fe15.48\u548c\u56fe15.49\u6240\u793a\u3002</p> <p> \u56fe15.48\u3000\u67e5\u770b\u90ae\u4ef6\u544a\u8b66</p> <p>\u901a\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\u5373\u53ef\u5b9e\u73b0\u544a\u8b66\u7684\u90ae\u4ef6\u901a\u77e5\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u5206\u7ec4\u5c06\u544a\u8b66\u53d1\u9001\u7ed9\u4e0d\u540c\u7684\u6536\u4ef6\u4eba\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#84-alertmanager\u4f01\u4e1a\u5fae\u4fe1\u901a\u77e5","title":"8.4 Alertmanager\u4f01\u4e1a\u5fae\u4fe1\u901a\u77e5","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u5df2\u7ecf\u5b9e\u73b0\u4e86\u4f7f\u7528\u90ae\u4ef6\u8fdb\u884c\u544a\u8b66\u7684\u901a\u77e5\uff0c\u672c\u5c0f\u8282\u6f14\u793a\u4f7f\u7528\u4f01\u4e1a\u5fae\u4fe1\u8fdb\u884c\u544a\u8b66\u3002</p> <p>\u9996\u5148\u5728\u4f01\u4e1a\u5fae\u4fe1\u5b98\u7f51\uff08https://work.weixin.qq.com/\uff09\u6ce8\u518c\u4e00\u4e2a\u4f01\u4e1a(\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u6ce8\u518c\uff0c\u6ce8\u518c\u8fc7\u7a0b\u4e0d\u518d\u6f14\u793a\uff09\uff0c\u5982\u679c\u8bfb\u8005\u6240\u5728\u7684\u516c\u53f8\u5df2\u7ecf\u6709\u76f8\u5173\u4f01\u4e1a\u5fae\u4fe1\uff0c\u53ef\u4ee5\u65e0\u987b\u6ce8\u518c\uff0c\u53ea\u9700\u8981\u6709\u521b\u5efa\u901a\u8baf\u5f55\u548c\u521b\u5efa\u5e94\u7528\u7684\u6743\u9650\u5373\u53ef\u3002</p> <p>1\uff0e\u4f01\u4e1a\u5fae\u4fe1\u914d\u7f6e</p> <p>\u6ce8\u518c\u5b8c\u6210\u540e\u8fdb\u884c\u767b\u5f55\uff0c\u767b\u5f55\u540e\u5355\u51fb\u201c\u6211\u7684\u4f01\u4e1a\u201d\uff0c\u5982\u56fe15.50\u6240\u793a\u3002</p> <p> \u56fe15.50\u3000\u67e5\u770b\u6211\u7684\u4f01\u4e1a</p> <p>\u5728\u9875\u9762\u7684\u6700\u4e0b\u9762\u627e\u5230\u4f01\u4e1aID\uff08\u5bf9\u5e94Alertmanager\u7684corp_id\u5b57\u6bb5\uff09\u5e76\u8bb0\u5f55\uff0c\u7a0d\u540e\u4f1a\u7528\u5230\uff0c\u5982\u56fe15.51\u6240\u793a\u3002</p> <p> \u56fe15.51\u3000\u67e5\u770b\u4f01\u4e1aID</p> <p>\u4e4b\u540e\u521b\u5efa\u4e00\u4e2a\u90e8\u95e8\uff0c\u7528\u4e8e\u63a5\u6536\u544a\u8b66\u901a\u77e5\uff0c\u5982\u56fe15.52\u6240\u793a\u3002  \u56fe15.52\u3000\u6dfb\u52a0\u5b50\u90e8\u95e8</p> <p>\u8f93\u5165Prom\u544a\u8b66\uff0c\u4e4b\u540e\u5355\u51fb\u201c\u786e\u5b9a\u201d\u6309\u94ae\uff0c\u5982\u56fe15.53\u6240\u793a\u3002  \u56fe15.53\u3000\u914d\u7f6e\u90e8\u95e8\u540d\u79f0</p> <p>\u4e4b\u540e\u5728Prom\u544a\u8b66\u5b50\u90e8\u95e8\u6dfb\u52a0\u76f8\u5173\u7684\u6210\u5458\u5373\u53ef\uff0c\u5982\u56fe15.54\u6240\u793a\uff0c\u5728\u6b64\u4e0d\u518d\u6f14\u793a\u3002  \u56fe15.54\u3000\u6dfb\u52a0\u6210\u5458</p> <p>\u67e5\u770b\u8be5\u90e8\u95e8ID\uff08\u5bf9\u5e94Alertmanager\u7684to_party\u5b57\u6bb5\uff09\u5e76\u8bb0\u5f55\uff0c\u5982\u56fe15.55\u6240\u793a\u3002  \u56fe15.55\u3000\u67e5\u770b\u90e8\u95e8ID</p> <p>\u4e4b\u540e\u521b\u5efa\u673a\u5668\u4eba\u5e94\u7528\uff0c\u9996\u5148\u5355\u51fb\u5e94\u7528\u7ba1\u7406\u2192\u521b\u5efa\u5e94\u7528\uff0c\u5982\u56fe15.56\u6240\u793a\u3002  \u56fe15.56\u3000\u6dfb\u52a0\u544a\u8b66\u5e94\u7528</p> <p>\u9009\u62e9\u4e00\u4e2alogo\uff0c\u8f93\u5165\u5e94\u7528\u540d\u79f0\u5e76\u9009\u62e9\u53ef\u89c1\u8303\u56f4\uff0c\u5982\u56fe15.57\u548c\u56fe15.58\u6240\u793a\u3002</p> <p> \u56fe15.57\u3000\u914d\u7f6e\u5e94\u7528\u53ef\u89c1\u6743\u9650</p> <p> \u56fe15.58\u3000\u914d\u7f6e\u5e94\u7528\u53ef\u89c1\u8303\u56f4</p> <p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u67e5\u770bAgentId\u548cSecret\uff08\u5bf9\u5e94Alertmanager\u7684api_secret\u5b57\u6bb5\uff09\u5e76\u8bb0\u5f55\uff0c\u5982\u56fe15.59\u6240\u793a\u3002</p> <p>\u5355\u51fbSecret\u540e\u7684\u201c\u67e5\u770b\u201d\uff0c\u6b64\u65f6\u4f1a\u5c06Secret\u53d1\u9001\u81f3\u4f01\u4e1a\u5fae\u4fe1\uff0c\u5355\u51fb\u201c\u524d\u5f80\u67e5\u770b\u201d\u5e76\u8bb0\u5f55\u5373\u53ef\uff0c\u5982\u56fe15.60\u6240\u793a\u3002  \u56fe15.59\u3000\u67e5\u770bAgentId\u548cSecret</p> <p> \u56fe15.60\u3000\u67e5\u770bSecret\u8be6\u60c5</p> <p>2\uff0eAlertmanager\u914d\u7f6e</p> <p>\u4fee\u6539Alertmanager\u914d\u7f6e\u6587\u4ef6\uff0c\u6dfb\u52a0\u4f01\u4e1a\u5fae\u4fe1\u544a\u8b66\u3002\u9996\u5148\u4fee\u6539global\uff0c\u6dfb\u52a0\u4e00\u4e9b\u901a\u7528\u914d\u7f6e\uff0cwechat_api_url\u662f\u56fa\u5b9a\u914d\u7f6e\uff0ccorp_id\u4e3a\u4f01\u4e1aID\uff1a</p> <pre><code>    \"global\":\nresolve_timeout: \"5m\"\nwechat_api_url: \"https://qyapi.weixin.qq.com/cgi-bin/\"\nwechat api corp id: \"wwef86a30xxxxxxxxxxxx\"\n</code></pre> <p>receivers\u6dfb\u52a0\u5fae\u4fe1\u901a\u77e5\uff1a</p> <pre><code>    \"receivers\":\n- \"name\": wechat-ops\nwechat_configs:\n- send_resolved: true\nto_party: 3\nto_user: \"@all\"\nagent_id: 1000006\napi_secret: \"3bB350Sxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\n- \"name\": \"Default\"\n\"email_configs\":\n- to: \"notification@163.com\"\nsend_resolved: true\n- \"name\": \"Watchdog\"\n- \"name\": \"Critical\"\n</code></pre> <p>\u6b64\u5904\u914d\u7f6e\u7684receiver\u540d\u5b57\u4e3awechat-ops\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5212\u5206\u4e0d\u540c\u7684\u90e8\u95e8\u3002\u6b64\u65f6\u914d\u7f6e\u7684to_user\u4e3a@all\uff0c\u4ee3\u8868\u53d1\u9001\u7ed9\u6240\u6709\u4eba\uff0c\u4e5f\u53ef\u4ee5\u53ea\u53d1\u9001\u7ed9\u90e8\u95e8\u7684\u67d0\u4e00\u4e2a\u4eba\uff0c\u53ea\u9700\u8981\u5c06\u6b64\u5904\u6539\u4e3aUSER_ID\u5373\u53ef\uff0c  \u5982\u56fe15.61\u6240\u793a\u3002</p> <p> \u56fe15.61\u3000\u7528\u6237ID</p> <p>\u66f4\u6539\u8def\u7531\u914d\u7f6e\uff0c\u5c06Watchdog\u7684\u544a\u8b66\u53d1\u9001\u7ed9\u8be5\u90e8\u95e8\uff08\u4e5f\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u5c06\u5176\u4ed6\u544a\u8b66\u53d1\u9001\u7ed9\u8be5\u90e8\u95e8\uff09\uff1a</p> <pre><code>route:\ngroup_wait: 30s\ngroup_interval: 5m\nrepeat_interval: 10m\nreceiver: Default\n\"group_by\":\n- \"namespace\"\n- \"job\"\n- \"alertname\"\nroutes:\n- \"match\":\n\"alertname\": \"Watchdog\"\n\"receiver\": \"wechat-ops\"\n\"repeat_interval\": \"10m\"\n</code></pre> <p>\u4e4b\u540e\u66f4\u65b0Alertmanager\u7684\u914d\u7f6e\uff1a</p> <pre><code>$ kubectl replace -f alertmanager-secret.yaml\nsecret/alertmanager-main replaced\n</code></pre> <p>\u7b49\u5f85\u51e0\u5206\u949f\u540e\uff0c\u53ef\u4ee5\u5728Alertmanager Web UI\u770b\u5230\u65b0\u914d\u7f6e\uff0c\u5e76\u4e14\u4f01\u4e1a\u5fae\u4fe1\u53ef\u4ee5\u6536\u5230Watchdog\u7684\u544a\u8b66\uff0c\u5982\u56fe15.62\u6240\u793a\u3002</p> <p> \u56fe15.62\u3000\u67e5\u770b\u5fae\u4fe1\u544a\u8b66</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#85-\u81ea\u5b9a\u4e49\u544a\u8b66\u6a21\u677f","title":"8.5 \u81ea\u5b9a\u4e49\u544a\u8b66\u6a21\u677f","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u4f7f\u7528\u4f01\u4e1a\u5fae\u4fe1\u8fdb\u884c\u4e86\u544a\u8b66\u901a\u77e5\uff0c\u76f8\u5bf9\u4e8e\u90ae\u7bb1\u901a\u77e5\uff0c\u4f01\u4e1a\u5fae\u4fe1\u7684\u544a\u8b66\u901a\u77e5\u5e76\u4e0d\u662f\u5f88\u5bb9\u6613\u9605\u8bfb\uff0c\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7Alertmanager\u7684\u6a21\u677f\u529f\u80fd\u914d\u7f6e\u4e00\u4e9b\u81ea\u5b9a\u4e49\u6a21\u677f\u3002</p> <p>\u9996\u5148\u4fee\u6539alertmanager-secret.yaml\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6a21\u677f\uff08\u6ce8\u610fwechat.tmpl\u548calertmanager.yaml\u9700\u8981\u5bf9\u9f50\uff0c\u6a21\u677f\u7684\u5185\u5bb9\u4e5f\u662f\u901a\u8fc7go-template\u7f16\u5199\u7684\uff09\uff1a</p> <pre><code>        app.kubernetes.io/part-of: kube-prometheus\napp.kubernetes.io/version: 0.21.0\nname: alertmanager-main\nnamespace: monitoring\nstringData:\nwechat.tmpl: |-\n{{ define \"wechat.default.message\" }}\n... \n{{- end }}\nalertmanager.yaml: |-\n\"global\":\n\"resolve_timeout\": \"5m\"\n</code></pre> <p>\u5728templates\u5b57\u6bb5\u6dfb\u52a0\u6a21\u677f\u4f4d\u7f6e\uff1a</p> <pre><code>templates:\n- '/etc/alertmanager/config/*.tmpl'\n\"inhibit_rules\":\n</code></pre> <p>\u914d\u7f6ewechat-ops receiver\u4f7f\u7528\u8be5\u6a21\u677f\uff1a</p> <pre><code>    \"receivers\":\n- \"name\": wechat-ops\nwechat_configs:\n- send_resolved: true\nto_party: 3\n...\nmessage: '{{ template \"wechat.default.message\" . }}'\n</code></pre> <p>\u6ce8\u610f</p> <p>{{  template  \"wechat.default.message\"  .  }} \u914d \u7f6e \u7684wechat.default.message \u662f \u6a21 \u677f \u6587 \u4ef6 define \u5b9a \u4e49 \u7684 \u540d \u79f0 \uff1a {{ define \"wechat.default.message\" }}\uff0c\u5e76\u975e\u6587\u4ef6\u540d\u79f0\u3002</p> <p>\u5c06\u914d\u7f6e\u66f4\u65b0\u81f3Alertmanager\uff1a</p> <pre><code>$ kubectl replace -f alertmanager-secret.yaml\nsecret/alertmanager-main replaced\n</code></pre> <p>\u66f4\u65b0\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5728Secret\u4e2d\u67e5\u770b\u8be5\u914d\u7f6e\uff1a</p> <pre><code>$ kubectl describe secrets alertmanager-main -n monitoring\nName:         alertmanager-main\nNamespace:    monitoring\nLabels:       alertmanager=main\n              app.kubernetes.io/component=alert-router\n              app.kubernetes.io/name=alertmanager\n              app.kubernetes.io/part-of=kube-prometheus\n              app.kubernetes.io/version=0.22.2\nAnnotations:  &lt;none&gt;\n\nType:  Opaque\n\nData\n====\nalertmanager.yaml:  1438 bytes\nwechat.tmpl:     1823 bytes\n</code></pre> <p>\u4e4b\u540e\u518d\u6b21\u6536\u5230\u544a\u8b66\uff0c\u5373\u4e3a\u81ea\u5b9a\u4e49\u544a\u8b66\u6a21\u677f\uff0c\u5982\u56fe15.63\u6240\u793a\u3002</p> <p></p> <p>\u56fe15.63\u3000\u67e5\u770b\u5fae\u4fe1\u544a\u8b66</p> <p>\u63d0\u793a</p> <p>\u65b0\u7248\u7684kube-prometheus\u63d0\u4f9b\u4e86Alertmanager \u914d\u7f6e\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90AlertmanagerConfig\uff0c\u4e0a\u8ff0\u914d\u7f6e\u5747\u53ef\u4ee5\u901a\u8fc7AlertmanagerConfig\u8fdb\u884c\u914d \u7f6e\uff0c\u4f46\u662f\u7531\u4e8eAlertmanagerConfig\u8fd8\u4e0d\u591f\u6210\u719f\uff0c\u5e76\u4e14\u5e76\u4e0d\u662f\u6240\u6709\u7684\u516c\u53f8\u90fd\u5c06Prometheus\u6280\u672f\u6808\u90e8\u7f72\u81f3Kubernetes\uff0c</p> <p>\u56e0\u6b64\u672c\u4e66\u8fd8\u662f\u4ee5\u4f20\u7edf\u7684\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u8bb2\u89e3\uff0c \u6709\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u53c2\u8003 https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/design.md#alertmanagerconfig \u8fdb\u884c\u5b66\u4e60\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#9prometheus\u544a\u8b66\u5b9e\u6218","title":"9.Prometheus\u544a\u8b66\u5b9e\u6218","text":"<p>\u524d\u9762\u7684\u7ae0\u8282\u57fa\u672c\u4e0a\u5bf9Prometheus\u548cAlertmanager\u5e38\u7528\u7684\u914d\u7f6e\u8fdb\u884c\u4e86\u5168\u9762\u7684\u5b66\u4e60\uff0c\u5e76\u4e14\u5b66\u4e60\u4e86PromQL\u8bed\u6cd5\uff0c\u5b9e\u73b0\u4e86\u5e38\u7528\u5a92\u4ecb\u7684\u544a\u8b66\u901a\u77e5\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528PromQL\u81ea\u5b9a\u4e49\u544a\u8b66\u7b56\u7565\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#91-prometheusrule","title":"9.1 PrometheusRule","text":"<p>\u5728\u5b89\u88c5Prometheus\u540e\uff0c\u9ed8\u8ba4\u914d\u7f6e\u4e86\u5f88\u591a\u544a\u8b66\u7b56\u7565\uff0c\u90a3\u4e48\u8fd9\u4e9b\u544a\u8b66\u914d\u7f6e\u662f\u5982\u4f55\u52a0\u8f7d\u5230Prometheus\u7684\u5462\uff1f</p> <p>\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u901a\u8fc7\u76f4\u63a5\u4fee\u6539Prometheus\u7684\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\u52a0\u8f7d\u76f8\u5e94\u7684\u544a\u8b66\u7b56\u7565\uff0c\u4f46\u662f\u5728Prometheus Operator\u4e2d\uff0c\u65e0\u987b\u518d\u76f4\u63a5\u4fee\u6539Prometheus\u7684\u914d\u7f6e\uff0c\u901a\u8fc7\u81ea\u5b9a\u4e49\u7684\u8d44\u6e90PrometheusRule\u5373\u53ef\u914d\u7f6e\u544a\u8b66\u7b56\u7565\u3002\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\u9ed8\u8ba4\u914d\u7f6e\u7684\u544a\u8b66\u7b56\u7565\uff1a</p> <pre><code>$ kubectl get prometheusrule -n monitoring\nNAME                              AGE\nalertmanager-main-rules           44h\nkube-prometheus-rules             44h\nkube-state-metrics-rules          44h\nkubernetes-monitoring-rules       44h\nnode-exporter-rules               44h\nprometheus-k8s-prometheus-rules   44h\nprometheus-operator-rules         44h\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7-oyaml\u67e5\u770b\u67d0\u4e2arules\u7684\u8be6\u7ec6\u914d\u7f6e\uff1a</p> <pre><code>$ kubectl get prometheusrule node-exporter-rules -n monitoring -o yaml\napiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\n....    spec:\n  groups:\n  - name: node-exporter\n    rules:\n    - alert: NodeFilesystemSpaceFillingUp\n      annotations:\n        description: Filesystem on {{ $labels.device }} at {{ $labels.instance }}\nhas only {{ printf \"%.2f\" $value }}% available space left and is filling\n          up.\n        runbook_url: https://runbooks.prometheus-operator.dev/runbooks/node/nodefilesystemspacefillingup\n        summary: Filesystem is predicted to run out of space within the next 24 hours.\n      expr: |\n(\nnode_filesystem_avail_bytes{job=\"node-exporter\",fstype!=\"\"} / node_filesystem_size_bytes{job=\"node-exporter\",fstype!=\"\"} * 100 &lt; 40\nand\n          predict_linear(node_filesystem_avail_bytes{job=\"node-exporter\",fstype!=\"\"}[6h], 24*60*60) &lt; 0\nand\n          node_filesystem_readonly{job=\"node-exporter\",fstype!=\"\"} == 0\n)\nfor: 1h\n      labels:\n        severity: warning\n</code></pre> <p>groups\u4e0b\u7684\u914d\u7f6e\u5373\u4e3a\u544a\u8b66\u7b56\u7565,\u5982\u679c\u8bfb\u8005\u5b66\u4e60\u8fc7\u4f20\u7edf\u914d\u7f6e\u7684Prometheus\uff0c\u5176\u5b9e\u53ef\u4ee5\u770b\u51fa\u5e76\u65e0\u533a\u522b\uff0c\u53ea\u662fOperator\u662f\u901a\u8fc7kind\u4e3a PrometheusRule\u8fdb\u884c\u5355\u72ec\u7ba1\u7406\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\u8fdb\u884c\u6bcf\u4e2a\u914d\u7f6e\u7684\u89e3\u6790\u3002</p> <ul> <li>alert\uff1a\u544a\u8b66\u7b56\u7565\u7684\u540d\u79f0\u3002</li> <li>annotations\uff1a\u544a\u8b66\u6ce8\u91ca\u4fe1\u606f\uff0c\u4e00\u822c\u5199\u4e3a\u544a\u8b66\u4fe1\u606f\u3002</li> <li>expr\uff1a\u544a\u8b66\u8868\u8fbe\u5f0f\u3002</li> <li>for\uff1a\u8bc4\u4f30\u7b49\u5f85\u65f6\u95f4\uff0c\u544a\u8b66\u6301\u7eed\u591a\u4e45\u624d\u4f1a\u53d1\u9001\u544a\u8b66\u6570\u636e\u3002</li> <li>labels\uff1a\u544a\u8b66\u7684\u6807\u7b7e\uff0c\u7528\u4e8e\u544a\u8b66\u7684\u8def\u7531\u3002</li> </ul> <p>\u4e86\u89e3\u4e86PrometheusRule\u5199\u6cd5\u89c4\u5219\u540e\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u544a\u8b66\u7b56\u7565\u3002</p> <p>\u5b9e\u9645\u4f7f\u7528\u65f6\u53ef\u4ee5\u6309\u7167\u76d1\u63a7\u7684\u76ee\u6807\u5212\u5206PrometheusRule\uff0c\u6bd4\u5982\u4e4b\u524d\u914d\u7f6e\u4e86\u9ed1\u76d2\u76d1\u63a7\uff0c\u90a3\u4e48\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u540d\u4e3ablackbox\u7684PrometheusRule\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/15.Kubernetes%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/#92-\u544a\u8b66\u901a\u7528\u914d\u7f6e\u6b65\u9aa4","title":"9.2 \u544a\u8b66\u901a\u7528\u914d\u7f6e\u6b65\u9aa4","text":"<p>\u5047\u8bbe\u9700\u8981\u5bf9\u57df\u540d\u8bbf\u95ee\u5ef6\u8fdf\u8fdb\u884c\u76d1\u63a7\uff0c\u8bbf\u95ee\u5ef6\u8fdf\u5927\u4e8e1\u79d2\u8fdb\u884c\u544a\u8b66\uff08\u751f\u4ea7\u73af\u5883\u53ef\u4ee5\u6309\u9700\u8c03\u8282\uff0c\u4e3a\u4e86\u5b9e\u73b0\u544a\u8b66\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u5c06\u8be5\u503c\u8bbe\u7f6e\u5f97\u5c0f\u4e00\u4e9b\uff09\uff0c\u6b64\u65f6\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aPrometheusRule\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/","title":"\u670d\u52a1\u53d1\u5e03Ingress\u8fdb\u9636","text":"<p>\u8981\u5c06Kubernetes\u96c6\u7fa4\u5185\u7684\u670d\u52a1\u53d1\u5e03\u5230\u96c6\u7fa4\u5916\u6765\u4f7f\u7528\uff0c\u901a\u5e38\u7684\u529e\u6cd5\u662f</p> <ol> <li>\u914d\u7f6eNodePort</li> <li>\u914d\u7f6eLoadBalancer\u7684Service</li> <li>\u914d\u7f6eExternalIP\u7684Service</li> <li>\u901a\u8fc7Pod\u6a21\u677f\u4e2d\u7684HostPort\u8fdb\u884c\u914d\u7f6e\u7b49\u3002</li> </ol> <p>\u4f46\u8fd9\u4e9b\u65b9\u5f0f\u90fd\u5b58\u5728\u6bd4\u8f83\u4e25\u91cd\u7684\u95ee\u9898\u3002\u5b83\u4eec\u51e0\u4e4e\u90fd\u662f\u901a\u8fc7\u8282\u70b9\u7aef\u53e3\u5f62\u5f0f\u5411\u5916\u66b4\u9732\u670d\u52a1\u7684\uff0cService\u4e00\u65e6\u53d8\u591a\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e0a\u5f00\u542f\u7684\u7aef\u53e3\u4e5f\u4f1a \u53d8\u591a\u3002\u8fd9\u6837\u4e0d\u4ec5\u7ef4\u62a4\u8d77\u6765\u76f8\u5f53\u590d\u6742\uff0c\u5b89\u5168\u6027\u8fd8\u4f1a\u5927\u5927\u964d\u4f4e\u3002</p> <p>Ingress\u53ef\u4ee5\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0c\u9664\u4e86Ingress\u81ea\u8eab\u7684\u670d\u52a1\u9700\u8981\u5411\u5916\u53d1\u5e03\u4e4b\u5916\uff0c\u5176\u4ed6\u670d\u52a1\u4e0d\u5fc5\u4f7f\u7528\u8282\u70b9\u7aef\u53e3\u5f62\u5f0f\u5411\u5916\u53d1\u5e03\u3002</p> <p>\u5728\u670d\u52a1\u53d1\u5e03\u57fa\u7840\u7bc7\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86Ingress\u8fd9\u4e2a\u62bd\u8c61\u6982\u5ff5\uff0c\u5e76\u4e14\u5bf9Ingress\u7684\u914d\u7f6e\u8fdb\u884c\u4e86\u7b80\u5355\u7684\u8bb2\u89e3\u3002</p> <p>\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u5bf9\u4e8e\u5e94\u7528\u7684\u53d1\u5e03\uff0c\u573a\u666f\u66f4\u4e3a\u590d\u6742\uff0c\u4e4b\u524d\u8bb2\u89e3\u7684\u5185\u5bb9\u4e0d\u8db3\u4ee5\u6ee1\u8db3\u751f\u4ea7\u73af\u5883\u7684\u9700\u6c42\u3002 \u672c\u7ae0\u5c06\u4f1a\u8fdb\u4e00\u6b65\u4ecb\u7ecdIngress\u7684\u4f7f\u7528\uff0c\u4ee5\u6ee1\u8db3\u5b9e\u9645\u4f7f\u7528\u65f6\u7684\u5404\u79cd\u9700\u6c42\u3002</p> <p>\u9996\u5148\u56de\u987e\u4e00\u4e0b\u7528\u6237\u8bbf\u95ee\u4e00\u4e2a\u4e1a\u52a1\u7684\u6d41\u7a0b\uff1a</p> <p>1\uff09\u7528\u6237\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165\u57df\u540d\u3002</p> <p>2\uff09\u57df\u540d\u89e3\u6790\u81f3\u4e1a\u52a1\u7684\u5165\u53e3IP\uff08\u4e00\u822c\u4e3a\u5916\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u6bd4\u5982\u963f\u91cc\u4e91\u7684SLB\u6216\u8005DMZ\u7684\u7f51\u5173\uff09\u3002</p> <p>3\uff09\u5916\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\u53cd\u5411\u4ee3\u7406\u81f3Kubernetes\u7684\u5165\u53e3\uff08\u4e00\u822c\u4e3aIngress\uff0c\u6216\u8005\u901a\u8fc7NodePort\u66b4\u9732\u7684\u670d\u52a1\u7b49\uff09\u3002</p> <p>4\uff09Ingress\u6839\u636e\u81ea\u8eab\u7684\u914d\u7f6e\u627e\u5230\u5bf9\u5e94\u7684Service\uff0c\u518d\u4ee3\u7406\u5230\u5bf9\u5e94\u7684Service\u4e0a\u3002</p> <p>5\uff09\u6700\u540e\u5230\u8fbeService\u5bf9\u5e94\u7684\u67d0\u4e00\u4e2aPod\u4e0a\u3002</p> <p>Ingress Controller \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u76d1\u542c\u5668\uff0c\u901a\u8fc7\u4e0d\u65ad\u5730\u76d1\u542c kube-apiserver\uff0c\u5b9e\u65f6\u7684\u611f\u77e5\u540e\u7aef Service\u3001Pod \u7684\u53d8\u5316\uff0c\u5f53\u5f97\u5230\u8fd9\u4e9b\u4fe1\u606f\u53d8\u5316\u540e\uff0cIngress Controller \u518d\u7ed3\u5408 Ingress \u7684\u914d\u7f6e\uff0c\u66f4\u65b0\u53cd\u5411\u4ee3\u7406\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u8fbe\u5230\u670d\u52a1\u53d1\u73b0\u7684\u4f5c\u7528\u3002\u5176\u5b9e\u8fd9\u70b9\u548c\u670d\u52a1\u53d1\u73b0\u5de5\u5177 consul\u3001 consul-template \u975e\u5e38\u7c7b\u4f3c\u3002</p> <p></p> <p>\u53ef\u89c1\uff0c\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cIngress\u4e3b\u8981\u662f\u4e00\u4e2a\u7528\u4e8eKubernetes\u96c6\u7fa4\u4e1a\u52a1\u7684\u5165\u53e3\u3002</p> <p>Ingress\u63a7\u5236\u5668\u4e0d\u4f1a\u968f\u7740Kubernetes\u4e00\u8d77\u5b89\u88c5\u3002\u5982\u679c\u8981\u8ba9Ingress\u8d44\u6e90\u6b63\u5e38\u8fd0\u4f5c\uff0c\u9700\u8981\u5b89\u88c5Ingress\u63a7\u5236\u5668\u3002\u53ef\u4ee5\u9009\u62e9\u7684Ingress\u63a7\u5236\u5668 \u79cd\u7c7b\u5f88\u591a\uff0c\u53ef\u6839\u636e\u60c5\u51b5\u81ea\u884c\u9009\u62e9\u3002</p> <p>\u73b0\u5728\u53ef\u4ee5\u4f9b\u5927\u5bb6\u4f7f\u7528\u7684 Ingress Controller \u6709\u5f88\u591a\uff0c\u6bd4\u5982</p> <ul> <li>traefik</li> <li>nginx-controller</li> <li>Kubernetes Ingress Controller for Kong</li> <li>HAProxy Ingress controller</li> </ul> <p>\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a Ingress Controller\uff0c\u73b0\u5728\u666e\u904d\u7528\u5f97\u8f83\u591a\u7684\u662f traefik \u548c nginx-controller\uff0ctraefik \u7684\u6027\u80fd\u8f83 nginx-controller \u5dee\uff0c\u4f46\u662f\u914d\u7f6e\u4f7f\u7528\u8981\u7b80\u5355\u8bb8\u591a\uff0c\u6211\u4eec\u8fd9\u91cc\u4f1a\u91cd\u70b9\u7ed9\u5927\u5bb6\u4ecb\u7ecd nginx-controller \u4ee5\u53ca traefik \u7684\u4f7f\u7528\u3002</p> <p>\u56e0 \u4e3a \u76f8 \u5bf9 \u4e8e \u5176 \u4ed6 IngressController\uff0c\u7ba1\u7406\u4eba\u5458\u66f4\u719f\u6089Nginx\u6216\u8005HAProxy\u7b49\u670d\u52a1\uff0c\u6240\u4ee5\u672c\u7ae0\u4e3b\u8981\u8bb2\u89e3Ingress Nginx\u7684\u5b89\u88c5\u4e0e\u5e38\u7528\u914d\u7f6e\uff0c\u8fd9\u4e5f\u662fKubernetes\u5b98\u65b9\u63d0\u4f9b\u7684IngressController\uff0c\u6709\u5173\u5176\u4ed6\u7684Ingress\uff0c\u8bfb\u8005\u53ef\u53c2\u8003\u76f8\u5173\u8d44\u6599\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#1-\u5b89\u88c5ingress-nginx-controller","title":"1. \u5b89\u88c5Ingress Nginx Controller","text":"<p>\u4e4b\u524d\u63d0\u5230\u8fc7\uff0c\u7531\u4e8eIngress Controller\u76f8\u5f53\u4e8eKubernetes\u96c6\u7fa4\u4e2d\u670d\u52a1\u7684\u201c\u5927\u95e8\u201d\uff0c\u56e0\u6b64\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e00\u5b9a\u8981\u4fdd\u969cController\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u7528\u6027\u3002</p> <p>\u4e3a\u4e86\u63d0\u9ad8Ingress Controller\u7684\u53ef\u7528\u6027\uff0c\u6211\u4eec\u4e00\u822c\u91c7\u7528\u5355\u72ec\u7684\u670d\u52a1\u5668\u4f5c\u4e3aController\u8282\u70b9\uff0c\u4ee5\u6b64\u4fdd\u969cIngress Controller\u7684Pod\u8d44\u6e90\u4e0d\u4f1a\u88ab\u5176\u4ed6\u670d\u52a1\u7684 Pod\u5f71\u54cd\u3002</p> <p>\u7531\u4e8e nginx-ingress \u6240\u5728\u7684\u8282\u70b9\u9700\u8981\u80fd\u591f\u8bbf\u95ee\u5916\u7f51\uff0c\u8fd9\u6837\u57df\u540d\u53ef\u4ee5\u89e3\u6790\u5230\u8fd9\u4e9b\u8282\u70b9\u4e0a\u76f4\u63a5\u4f7f\u7528\uff0c\u6240\u4ee5\u9700\u8981\u8ba9 nginx-ingress \u7ed1\u5b9a\u8282\u70b9\u7684 80 \u548c 443 \u7aef\u53e3\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528 hostPort \u6765\u8fdb\u884c\u8bbf\u95ee\uff0c\u5f53\u7136\u5bf9\u4e8e\u7ebf\u4e0a\u73af\u5883\u6765\u8bf4\u4e3a\u4e86\u4fdd\u8bc1\u9ad8\u53ef\u7528\uff0c\u4e00\u822c\u662f\u9700\u8981\u8fd0\u884c\u591a\u4e2a nginx-ingress \u5b9e\u4f8b\u7684\uff0c\u7136\u540e\u53ef\u4ee5\u7528\u4e00\u4e2a nginx/haproxy \u4f5c\u4e3a\u5165\u53e3\uff0c\u901a\u8fc7 keepalived \u6765\u8bbf\u95ee\u8fb9\u7f18\u8282\u70b9\u7684 vip \u5730\u5740\u3002</p> <p>\u8fb9\u7f18\u8282\u70b9</p> <p>\u6240\u8c13\u7684\u8fb9\u7f18\u8282\u70b9\u5373\u96c6\u7fa4\u5185\u90e8\u7528\u6765\u5411\u96c6\u7fa4\u5916\u66b4\u9732\u670d\u52a1\u80fd\u529b\u7684\u8282\u70b9\uff0c\u96c6\u7fa4\u5916\u90e8\u7684\u670d\u52a1\u901a\u8fc7\u8be5\u8282\u70b9\u6765\u8c03\u7528\u96c6\u7fa4\u5185\u90e8\u7684\u670d\u52a1\uff0c\u8fb9\u7f18\u8282\u70b9\u662f\u96c6\u7fa4\u5185\u5916\u4ea4\u6d41\u7684\u4e00\u4e2aEndpoint\u3002</p> <p></p> <p>\u751f\u4ea7\u73af\u5883</p> <p>\u6211\u4eec\u90e8\u7f722\u4e2aingress\u8282\u70b9\uff0c\u505aha\u9ad8\u53ef\u7528\uff0c\u5bf9\u5916\u53d1\u5e03\u670d\u52a1\u3002</p> <ol> <li>\u8bbe\u7f6e\u6c61\u70b9\u548c\u6807\u7b7e</li> </ol> <pre><code># kubectl taint node k8s-node1 GiteeCommonAddonsOnly=yes:NoSchedule\n# kubectl taint node k8s-node2 GiteeCommonAddonsOnly=yes:NoSchedule\n</code></pre> <ol> <li>\u6253\u6807\u7b7e</li> </ol> <pre><code>## \u6253\u4e0a2\u4e2a\u6807\u7b7e\u3002\n## \u5e26\u6709ingress\u6807\u8bc6\u7b26\u7684\u6807\u7b7e\n# kubectl label nodes k8s-node01 node-role.kubernetes.io/ingress=\"true\"\n# kubectl label nodes k8s-node02 node-role.kubernetes.io/ingress=\"true\"\n## \u67e5\u770b\u8282\u70b9\u662f\u5426\u8bbe\u7f6e Label \u6210\u529f\n## \u67e5\u770b\u6240\u6709\u8282\u70b9\n# kubectl get nodes --show-labels\n## \u67e5\u770b\u5355\u4e2a\u8282\u70b9\n# kubectl get nodes k8s-node01 --show-labels\n## \u5220\u9664\u5e26\u6709node-role.kubernetes.io/edge\u6807\u8bc6\u7b26\u7684\u6807\u7b7e\n# kubectl label k8s-node01 node-role.kubernetes.io/ingress-\n# kubectl label k8s-node02 node-role.kubernetes.io/ingress-\n## \u66f4\u65b0deployment\uff0c\u589e\u52a0nodeSelector\u914d\u7f6e\n# $ kubectl -n kube-system patch deployment nginx-ingress-controller -p '{\"spec\": {\"template\": {\"spec\": {\"nodeSelector\": {\"node-role.kubernetes.io/ingress\": \"true\"}}}}}'\n</code></pre> <ol> <li>\u5b89\u88c5keepalived+haproxy</li> </ol> <p>\u8bbe\u7f6e\u8fb9\u7f18\u8282\u70b9\u9ad8\u53ef\u7528\uff0c\u5728k8s-node01\u548ck8s-node02\u4e0a\u5b89\u88c5keepalived+haproxy</p> <p>\u53c2\u8003</p> <p>\u5728\u6307\u5b9a\u8282\u70b9\u90e8\u7f72Ingress\u670d\u52a1</p> <p>\u6d4b\u8bd5\u73af\u5883</p> <p>\u8fd9\u91cc\u5c06k8s-node01\u4f5c\u4e3a\u8fb9\u7f18\u8282\u70b9\uff0c\u6253\u4e0aLabel\uff1a</p> <pre><code>$ kubectl label nodes k8s-node01 node-role.kubernetes.io/ingress=\"true\"\n$ kubectl  get nodes\nNAME           STATUS   ROLES           AGE   VERSION\nk8s-master01   Ready    control-plane   19h   v1.25.6\nk8s-master02   Ready    control-plane   19h   v1.25.6\nk8s-master03   Ready    control-plane   19h   v1.25.6\nk8s-node01     Ready    ingress         19h   v1.25.6\n\n# kubectl get nodes k8s-node01 --show-labels\nNAME         STATUS   ROLES     AGE   VERSION   LABELS\nk8s-node01   Ready    ingress   19h   v1.25.6   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node01,kubernetes.io/os=linux,node-role.kubernetes.io/ingress=true\n</code></pre> <p>\u4e0b\u8f7dingress-nginx\u7684helm chart:</p> <pre><code># \u5982\u679c\u4f60\u4e0d\u559c\u6b22\u4f7f\u7528 helm chart \u8fdb\u884c\u5b89\u88c5\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u4e00\u952e\u5b89\u88c5\n# kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.1.0/deploy/static/provider/cloud/deploy.yaml\n\u279c helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\n\u279c helm repo update\n\u279c helm fetch ingress-nginx/ingress-nginx\n\u279c tar -xvf ingress-nginx-4.4.2.tgz &amp;&amp; cd ingress-nginx\n\u279c tree .\n.\n\u251c\u2500\u2500 CHANGELOG.md\n\u251c\u2500\u2500 Chart.yaml\n\u251c\u2500\u2500 OWNERS\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 ci\n\u2502   \u251c\u2500\u2500 controller-custom-ingressclass-flags.yaml\n\u2502   \u251c\u2500\u2500 daemonset-customconfig-values.yaml\n\u2502   \u251c\u2500\u2500 daemonset-customnodeport-values.yaml\n\u2502   \u251c\u2500\u2500 daemonset-headers-values.yaml\n\u2502   \u251c\u2500\u2500 daemonset-internal-lb-values.yaml\n\u2502   \u251c\u2500\u2500 daemonset-nodeport-values.yaml\n\u2502   \u251c\u2500\u2500 daemonset-podannotations-values.yaml\n\u2502   \u251c\u2500\u2500 daemonset-tcp-udp-configMapNamespace-values.yaml\n\u2502   \u251c\u2500\u2500 daemonset-tcp-udp-values.yaml\n\u2502   \u251c\u2500\u2500 daemonset-tcp-values.yaml\n\u2502   \u251c\u2500\u2500 deamonset-default-values.yaml\n\u2502   \u251c\u2500\u2500 deamonset-metrics-values.yaml\n\u2502   \u251c\u2500\u2500 deamonset-psp-values.yaml\n\u2502   \u251c\u2500\u2500 deamonset-webhook-and-psp-values.yaml\n\u2502   \u251c\u2500\u2500 deamonset-webhook-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-autoscaling-behavior-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-autoscaling-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-customconfig-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-customnodeport-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-default-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-headers-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-internal-lb-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-metrics-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-nodeport-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-podannotations-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-psp-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-tcp-udp-configMapNamespace-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-tcp-udp-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-tcp-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-webhook-and-psp-values.yaml\n\u2502   \u251c\u2500\u2500 deployment-webhook-resources-values.yaml\n\u2502   \u2514\u2500\u2500 deployment-webhook-values.yaml\n\u251c\u2500\u2500 templates\n\u2502   \u251c\u2500\u2500 NOTES.txt\n\u2502   \u251c\u2500\u2500 _helpers.tpl\n\u2502   \u251c\u2500\u2500 _params.tpl\n\u2502   \u251c\u2500\u2500 admission-webhooks\n\u2502   \u2502   \u251c\u2500\u2500 job-patch\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 clusterrole.yaml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 clusterrolebinding.yaml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 job-createSecret.yaml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 job-patchWebhook.yaml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 psp.yaml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 role.yaml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 rolebinding.yaml\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 serviceaccount.yaml\n\u2502   \u2502   \u2514\u2500\u2500 validating-webhook.yaml\n\u2502   \u251c\u2500\u2500 clusterrole.yaml\n\u2502   \u251c\u2500\u2500 clusterrolebinding.yaml\n\u2502   \u251c\u2500\u2500 controller-configmap-addheaders.yaml\n\u2502   \u251c\u2500\u2500 controller-configmap-proxyheaders.yaml\n\u2502   \u251c\u2500\u2500 controller-configmap-tcp.yaml\n\u2502   \u251c\u2500\u2500 controller-configmap-udp.yaml\n\u2502   \u251c\u2500\u2500 controller-configmap.yaml\n\u2502   \u251c\u2500\u2500 controller-daemonset.yaml\n\u2502   \u251c\u2500\u2500 controller-deployment.yaml\n\u2502   \u251c\u2500\u2500 controller-hpa.yaml\n\u2502   \u251c\u2500\u2500 controller-ingressclass.yaml\n\u2502   \u251c\u2500\u2500 controller-keda.yaml\n\u2502   \u251c\u2500\u2500 controller-poddisruptionbudget.yaml\n\u2502   \u251c\u2500\u2500 controller-prometheusrules.yaml\n\u2502   \u251c\u2500\u2500 controller-psp.yaml\n\u2502   \u251c\u2500\u2500 controller-role.yaml\n\u2502   \u251c\u2500\u2500 controller-rolebinding.yaml\n\u2502   \u251c\u2500\u2500 controller-service-internal.yaml\n\u2502   \u251c\u2500\u2500 controller-service-metrics.yaml\n\u2502   \u251c\u2500\u2500 controller-service-webhook.yaml\n\u2502   \u251c\u2500\u2500 controller-service.yaml\n\u2502   \u251c\u2500\u2500 controller-serviceaccount.yaml\n\u2502   \u251c\u2500\u2500 controller-servicemonitor.yaml\n\u2502   \u251c\u2500\u2500 default-backend-deployment.yaml\n\u2502   \u251c\u2500\u2500 default-backend-hpa.yaml\n\u2502   \u251c\u2500\u2500 default-backend-poddisruptionbudget.yaml\n\u2502   \u251c\u2500\u2500 default-backend-psp.yaml\n\u2502   \u251c\u2500\u2500 default-backend-role.yaml\n\u2502   \u251c\u2500\u2500 default-backend-rolebinding.yaml\n\u2502   \u251c\u2500\u2500 default-backend-service.yaml\n\u2502   \u251c\u2500\u2500 default-backend-serviceaccount.yaml\n\u2502   \u2514\u2500\u2500 dh-param-secret.yaml\n\u2514\u2500\u2500 values.yaml\n\n4 directories, 81 files\n</code></pre> <p>\u6211\u4eec\u8fd9\u91cc\u6d4b\u8bd5\u73af\u5883\u53ea\u6709 k8s-node01\u8282\u70b9\u53ef\u4ee5\u8bbf\u95ee\u5916\u7f51\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u76f4\u63a5\u8bb2 ingress-nginx \u56fa\u5b9a\u5230 k8s-node01\u8282\u70b9\u4e0a\uff0c\u91c7\u7528 hostNetwork \u6a21\u5f0f(\u751f\u4ea7\u73af\u5883\u53ef\u4ee5\u4f7f\u7528 LB + DaemonSet hostNetwork \u6a21\u5f0f)\u3002</p> <p>\u7136\u540e\u65b0\u5efa\u4e00\u4e2a\u540d\u4e3a values-prod.yaml \u7684 Values \u6587\u4ef6\uff0c\u7528\u6765\u8986\u76d6 ingress-nginx \u9ed8\u8ba4\u7684 Values \u503c\uff0c\u5bf9\u5e94\u7684\u6570\u636e\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>\u279c helm show values ingress-nginx &gt; values-prod.yaml\n\u279c vim values-prod.yaml\ncontroller:\n  name: controller\n  image:\n    repository: cnych/ingress-nginx\n    tag: \"v1.1.0\"\ndigest:\n\ndnsPolicy: ClusterFirstWithHostNet\n\nconfig:\n    apiVersion: v1\n    client_max_body_size: 20m\n    custom-http-errors: \"404,415,503\"\nhostNetwork: true\npublishService:  # hostNetwork \u6a21\u5f0f\u4e0b\u8bbe\u7f6e\u4e3afalse\uff0c\u901a\u8fc7\u8282\u70b9IP\u5730\u5740\u4e0a\u62a5ingress status\u6570\u636e\nenabled: false\n# \u662f\u5426\u9700\u8981\u5904\u7406\u4e0d\u5e26 ingressClass \u6ce8\u89e3\u6216\u8005 ingressClassName \u5c5e\u6027\u7684 Ingress \u5bf9\u8c61\n# \u8bbe\u7f6e\u4e3a true \u4f1a\u5728\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570\u4e2d\u65b0\u589e\u4e00\u4e2a --watch-ingress-without-class \u6807\u6ce8\nwatchIngressWithoutClass: false\nkind: DaemonSet\n\nnodeSelector:   # \u56fa\u5b9a\u5230k8s-node1\u8282\u70b9\nnode-role.kubernetes.io/ingress: 'true'\nservice:  # HostNetwork \u6a21\u5f0f\u4e0d\u9700\u8981\u521b\u5efaservice\nenabled: false\nadmissionWebhooks: # \u5f3a\u70c8\u5efa\u8bae\u5f00\u542f admission webhook\nenabled: true\ncreateSecretJob:\n      resources:\n        limits:\n          cpu: 10m\n          memory: 20Mi\n        requests:\n          cpu: 10m\n          memory: 20Mi\n    patchWebhookJob:\n      resources:\n        limits:\n          cpu: 10m\n          memory: 20Mi\n        requests:\n          cpu: 10m\n          memory: 20Mi\n    patch:\n      enabled: true\nimage:\n        repository: cnych/ingress-nginx-webhook-certgen\n        tag: v1.1.1\n        digest:\n\ndefaultBackend:\n  enabled: true\nname: defaultbackend\n  image:\n    repository: cnych/ingress-nginx-defaultbackend\n    tag: \"1.5\"\n</code></pre> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5 ingress-nginx \u5e94\u7528\u5230 ingress-nginx \u7684\u547d\u540d\u7a7a\u95f4\u4e2d\uff1a</p> <pre><code>\u279c helm install ingress-nginx ingress-nginx -f ./values-prod.yaml --namespace ingress-nginx  --create-namespace\nNAME: ingress-nginx\nLAST DEPLOYED: Thu Feb  9 14:21:40 2023\nNAMESPACE: ingress-nginx\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nThe ingress-nginx controller has been installed.\nIt may take a few minutes for the LoadBalancer IP to be available.\nYou can watch the status by running 'kubectl --namespace ingress-nginx get services -o wide -w ingress-nginx-controller'\nAn example Ingress that makes use of the controller:\n  apiVersion: networking.k8s.io/v1\n  kind: Ingress\n  metadata:\n    name: example\n    namespace: foo\n  spec:\n    ingressClassName: nginx\n    rules:\n      - host: www.example.com\n        http:\n          paths:\n            - pathType: Prefix\n              backend:\n                service:\n                  name: exampleService\n                  port:\n                    number: 80\npath: /\n    # This section is only required if TLS is to be enabled for the Ingress\ntls:\n      - hosts:\n        - www.example.com\n        secretName: example-tls\n\nIf TLS is enabled for the Ingress, a Secret containing the certificate and key must also be provided:\n\napiVersion: v1\n  kind: Secret\n  metadata:\n    name: example-tls\n    namespace: foo\n  data:\n    tls.crt: &lt;base64 encoded cert&gt;\n    tls.key: &lt;base64 encoded key&gt;\n  type: kubernetes.io/tls\n</code></pre> <p>\u90e8\u7f72\u5b8c\u6210\u540e\u67e5\u770b Pod \u7684\u8fd0\u884c\u72b6\u6001\uff1a</p> <pre><code>\u279c kubectl get svc -n ingress-nginx\nNAME                                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE\ningress-nginx-controller-admission   ClusterIP   192.168.5.132    &lt;none&gt;        443/TCP   2m6s\ningress-nginx-defaultbackend         ClusterIP   192.168.230.39   &lt;none&gt;        80/TCP    2m6s\n\n\u279c kubectl get pods -n ingress-nginx\nNAME                                           READY   STATUS    RESTARTS   AGE\ningress-nginx-controller-j9w5j                 1/1     Running   0          2m36s\ningress-nginx-defaultbackend-f67985f77-t766q   1/1     Running   0          2m36s\n\u279c  POD_NAME=$(kubectl get pods -l app.kubernetes.io/name=ingress-nginx -n ingress-nginx -o jsonpath='{.items[0].metadata.name}')\n\u279c  kubectl exec -it $POD_NAME -n ingress-nginx -- /nginx-ingress-controller --version\n-------------------------------------------------------------------------------\nNGINX Ingress controller\n  Release:       v1.1.0\n  Build:         cacbee86b6ccc45bde8ffc184521bed3022e7dee\n  Repository:    https://github.com/kubernetes/ingress-nginx\n  nginx version: nginx/1.19.9\n\n-------------------------------------------------------------------------------\n</code></pre> <p>\u5f53\u770b\u5230\u4e0a\u9762\u7684\u4fe1\u606f\u8bc1\u660e <code>ingress-nginx</code> \u90e8\u7f72\u6210\u529f\u4e86\uff0c\u8fd9\u91cc\u6211\u4eec\u5b89\u88c5\u7684\u662f\u6700\u65b0\u7248\u672c\u7684\u63a7\u5236\u5668\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a \u540d\u4e3a <code>nginx</code> \u7684 <code>IngressClass</code> \u5bf9\u8c61\uff1a</p> <pre><code>\u279c  kubectl get ingressclass\nNAME    CONTROLLER             PARAMETERS   AGE\nnginx   k8s.io/ingress-nginx   &lt;none&gt;       3m55s\n\n\u279c  kubectl get ingressclass nginx -o yaml\napiVersion: networking.k8s.io/v1\nkind: IngressClass\nmetadata:\n......\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/managed-by: Helm\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n    helm.sh/chart: ingress-nginx-4.4.2\n  name: nginx\n  resourceVersion: \"124250\"\nuid: 0745abff-fc05-4ca8-a3fe-3e6218ed94b6\nspec:\n  controller: k8s.io/ingress-nginx\n</code></pre> <p>\u4e0d\u8fc7\u8fd9\u91cc\u6211\u4eec\u53ea\u63d0\u4f9b\u4e86\u4e00\u4e2a <code>controller</code> \u5c5e\u6027\uff0c\u5982\u679c\u8fd8\u9700\u8981\u914d\u7f6e\u4e00\u4e9b\u989d\u5916\u7684\u53c2\u6570\uff0c\u5219\u53ef\u4ee5\u5728\u5b89\u88c5\u7684 values \u6587\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#2-ingress-nginx\u5165\u95e8","title":"2. Ingress Nginx\u5165\u95e8","text":"<p>\u9996\u5148\u4ece\u6700\u7b80\u5355\u7684\u914d\u7f6e\u5f00\u59cb\uff0c\u5047\u5982\u516c\u53f8\u6709\u4e00\u4e2aWeb\u670d\u52a1\u7684\u5bb9\u5668\uff0c\u9700\u8981\u4e3a\u5176\u6dfb\u52a0\u4e00\u4e2a\u57df\u540d\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528Ingress\u5b9e\u73b0\u8be5\u529f\u80fd\u3002</p> <p>\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u5b66\u4e60Ingress\u7684Namespace\uff0c\u4e4b\u540e\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u5728\u6b64Namespace\u8fdb\u884c\uff1a</p> <pre><code>$ kubectl create ns study-ingress\nnamespace/study-ingress created\n</code></pre> <p>\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684Nginx\u6a21\u62dfWeb\u670d\u52a1\uff1a</p> <pre><code>$ kubectl create deploy nginx --image=registry.cn-beijing.aliyuncs.com/dotbalo/nginx:1.15.12 -n study-ingress                             deployment.apps/nginx created\n</code></pre> <p>\u521b\u5efa\u8be5Web\u5bb9\u5668\u7684Service\uff1a</p> <pre><code>$ kubectl expose deploy nginx --port 80 -n study-ingress\nservice/nginx exposed\n</code></pre> <p>\u4e4b\u540e\u521b\u5efaIngress\u6307\u5411\u4e0a\u9762\u521b\u5efa\u7684Service\uff1a</p> <p>web-ingress.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nname: nginx-ingress\nnamespace: study-ingress\nspec:\ningressClassName: nginx\nrules:\n- host: nginx.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: nginx\nport:\nnumber: 80\npath: /\npathType: ImplementationSpecific\n</code></pre> <p>\u63d0\u793a: </p> <p>\u672c\u7ae0\u5185\u5bb9\u5747\u91c7\u7528networking.k8s.io/v1\u7248\u672c\u521b\u5efaIngress\u8d44\u6e90\uff0c\u5982\u679cKubernetes\u7248\u672c\u4f4e\u4e8e1.19\uff0c\u53ef\u4ee5\u4f7f\u7528networking.k8s.io/v1beta1\u66ff\u4ee3\uff0c\u914d \u7f6e\u53ef\u4ee5\u53c2\u8003\u4e0a\u8ff0\u7684networking.k8s.io/v1beta1\uff0c\u53ea\u6709backend\u914d\u7f6e\u4e0d\u4e00\u6837\u3002</p> <p>v1beta1</p> <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: nginx-ingress\n  namespace: study-ingress\nspec:\n  rules:\n  - host: nginx.test.com\n    http:\n      paths:\n      - backend:\n          serviceName: nginx\n          servicePort: 80\n        path: /\n        pathType: ImplementationSpecific\n</code></pre> <p>\u521b\u5efa\u8be5Ingress\uff1a</p> <pre><code>$ kubectl create -f web-ingress.yaml\n</code></pre> <p>\u521b\u5efa\u7684Ingress\u7ed1\u5b9a\u7684\u57df\u540d\u4e3anginx.test.com\uff0c\u7531\u4e8e\u672c\u4e66\u7684IngressController\u662f\u4ee5hostNetwork\u6a21\u5f0f\u90e8\u7f72\u7684\uff0c\u56e0\u6b64\u5c06\u57df \u540d\u89e3\u6790\u81f3Ingress Controller\u6240\u5728\u7684\u8282\u70b9\u5373\u53ef\u3002(\u4fee\u6539hosts\u6587\u4ef6\uff0c\u6216\u8005DNS\u6307\u5411)</p> <p>\u5982\u679cIngress Controller\u4e0a\u5c42\u8fd8\u6709\u4e00\u5c42\u7f51\u5173\uff0c\u89e3\u6790\u81f3\u7f51\u5173IP\u5373\u53ef\u3002\u63a5\u4e0b\u6765\u901a\u8fc7\u57df\u540dnginx.test.com\u5373\u53ef\u8bbf\u95eeWeb\u670d\u52a1\u5668\uff0c\u5982</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u901a\u8fc7\u4e0a\u8ff0\u7b80\u5355\u7684Ingress\u8d44\u6e90\u5b9a\u4e49\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4ee5\u57df\u540d\u7684\u65b9\u5f0f\u8bbf\u95ee\u670d\u52a1\uff0c\u4e0d\u9700\u8981\u518d\u53bb\u7ef4\u62a4\u590d\u6742\u7684Nginx\u914d\u7f6e\u6587\u4ef6\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u8fd0\u7ef4\u7684\u590d\u6742\u5ea6\u548c\u51fa\u9519\u7684\u9891\u7387\u3002</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7\u4e00\u4e9b\u5176\u4ed6\u914d\u7f6e\u5b9e\u73b0\u4f01\u4e1a\u5185\u5e38\u7528\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u91cd\u5b9a\u5411\u3001\u524d\u540e\u7aef\u5206\u79bb\u3001\u9519\u8bef\u53cb\u597d\u9875\u9762\u7b49\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#3-ingress-nginx\u57df\u540d\u91cd\u5b9a\u5411redirect","title":"3. Ingress Nginx\u57df\u540d\u91cd\u5b9a\u5411Redirect","text":"<p>\u5f53\u4e00\u4e2a\u670d\u52a1\u9700\u8981\u66f4\u6362\u57df\u540d\u65f6\uff0c\u5e76\u4e0d\u80fd\u5bf9\u5176\u76f4\u63a5\u66f4\u6539\uff0c\u9700\u8981\u4e00\u4e2a\u8fc7\u6e21\u7684\u8fc7\u7a0b\u3002</p> <p>\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u5c06\u65e7\u57df\u540d\u7684\u8bbf\u95ee\u8df3\u8f6c\u5230\u65b0\u57df\u540d\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528Redirect\u529f\u80fd\u3002</p> <p>\u5f85\u65e7\u57df\u540d\u65e0\u8bbf\u95ee\u65f6\uff0c\u518d\u505c\u6b62\u65e7\u57df\u540d\u3002\u5728Nginx\u4f5c\u4e3a\u4ee3\u7406\u670d\u52a1\u5668\u65f6\uff0cRedirect\u53ef\u7528\u4e8e\u57df\u540d\u7684\u91cd\u5b9a\u5411\uff0c\u6bd4\u5982\u8bbf\u95eeold.com\u88ab\u91cd\u5b9a\u5411\u5230new.com\u3002</p> <p>Ingress\u53ef\u4ee5\u66f4\u7b80\u5355\u5730\u5b9e\u73b0Redirect\u529f\u80fd\u3002\u63a5\u4e0b\u6765\u7528nginx.redirect.com\u4f5c\u4e3a\u65e7\u57df\u540d\uff0cbaidu.com\u4f5c\u4e3a\u65b0\u57df\u540d\u8fdb\u884c\u6f14\u793a\uff1a</p> <p>redirect.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nannotations:\nnginx.ingress.kubernetes.io/permanent-redirect: https://www.baidu.com\nname: nginx-redirect\nnamespace: study-ingress\nspec:\ningressClassName: nginx\nrules:\n- host: nginx.redirect.com\nhttp:\npaths:\n- backend:\nservice:\nname: nginx\nport:\nnumber: 80\npath: /\npathType: ImplementationSpecific\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u914d\u7f6e\u91cd\u5b9a\u5411\u529f\u80fd\u53ea\u9700\u8981\u586b\u52a0\u4e00\u4e2aannotations\u5373\u53ef\uff0ckey\u4e3anginx.ingress.kubernetes.io/permanent-redirect \uff0c \u503c \u4e3a \u76ee \u6807 URL \uff1ahttps://www.baidu.com\u3002</p> <p>\u63a5\u4e0b\u6765\u540c\u6837\u7684\u65b9\u5f0f\u5c06nginx.redirect.com\u89e3\u6790\u5230Controller\u6240\u5728\u8282\u70b9\uff08\u63a5\u4e0b\u6765\u7684\u793a\u4f8b\u4e0d\u518d\u63d0\u793a\u6dfb\u52a0Host\uff09\uff0c\u5728\u6d4f\u89c8\u5668\u8bbf\u95ee\u6216\u8005\u4f7f\u7528curl\u8bbf\u95ee\uff0c\u5373\u53ef\u770b\u5230\u91cd\u5b9a\u5411\u4fe1\u606f\u3002</p> <p>\u4f7f\u7528curl\u8bbf\u95ee\u57df\u540dnginx.redirect.com\uff0c\u53ef\u4ee5\u770b\u5230301\uff08\u8bf7\u6c42\u88ab\u91cd\u5b9a\u5411\u7684\u8fd4\u56de\u503c\uff09\uff1a</p> <pre><code>$ curl -I nginx.redirect.com\nHTTP/1.1 301 Moved Permanently\nDate: Fri, 10 Feb 2023 05:39:03 GMT\nContent-Type: text/html\nContent-Length: 162\nConnection: keep-alive\nLocation: https://www.baidu.com\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#4-ingress-nginx\u524d\u540e\u7aef\u5206\u79bbrewrite","title":"4. Ingress Nginx\u524d\u540e\u7aef\u5206\u79bbRewrite","text":"<p>\u73b0\u5728\u5927\u90e8\u5206\u5e94\u7528\u90fd\u662f\u524d\u540e\u7aef\u5206\u79bb\u7684\u67b6\u6784\uff0c\u4e5f\u5c31\u662f\u524d\u7aef\u7528\u67d0\u4e2a\u57df\u540d\u7684\u6839\u8def\u5f84\u8fdb\u884c\u8bbf\u95ee\uff0c\u540e\u7aef\u63a5\u53e3\u91c7\u7528/api\u8fdb\u884c\u8bbf\u95ee\uff0c\u7528\u6765\u533a\u5206\u524d\u7aef\u548c\u540e\u7aef\u3002</p> <p>\u6216\u8005\u540c\u65f6\u5177\u6709\u5f88\u591a\u4e2a\u540e\u7aef\uff0c\u9700\u8981\u4f7f\u7528/api-a\u5230A\u670d\u52a1\uff0c/api-b\u5230B\u670d\u52a1\uff0c\u4f46\u662f\u7531\u4e8eA\u548cB\u670d\u52a1\u53ef\u80fd\u5e76\u6ca1\u6709/api-a\u548c/api-b\u7684\u8def\u5f84\uff0c\u56e0\u6b64\u9700\u8981\u5c06/api-x\u91cd\u5199\u4e3a\u201c/\u201d\uff0c\u624d \u53ef\u4ee5\u6b63\u5e38\u5230A\u6216\u8005B\u670d\u52a1\uff0c\u5426\u5219\u5c06\u4f1a\u51fa\u73b0404\u7684\u62a5\u9519\u3002</p> <p>\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7Rewrite\u529f\u80fd\u8fbe\u5230\u8fd9\u79cd\u6548\u679c\uff0c\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u5e94\u7528\u6a21\u62df\u540e\u7aef\u670d\u52a1\uff1a</p> <pre><code>$ kubectl create deploy backend-api --image=registry.cn-beijing.aliyuncs.com/dotbalo/nginx:backend-api -n study-ingress                   deployment.apps/backend-api created\n</code></pre> <p>\u521b\u5efaService\u66b4\u9732\u8be5\u5e94\u7528\uff1a</p> <pre><code>$ kubectl expose deploy backend-api --port 80 -n study-ingress\nservice/backend-api exposed\n</code></pre> <p>\u67e5\u770b\u8be5Service\u7684\u5730\u5740\uff0c\u5e76\u4e14\u901a\u8fc7/api-a\u8bbf\u95ee\u6d4b\u8bd5\uff1a</p> <pre><code>$ kubectl get svc -n study-ingress\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE\nbackend-api   ClusterIP   192.168.27.166   &lt;none&gt;        80/TCP    31s\n\n# curl 192.168.27.166/api-a\n&lt;html&gt;\n&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;\n&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;\n&lt;hr&gt;&lt;center&gt;nginx/1.15.12&lt;/center&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u76f4\u63a5\u8bbf\u95ee\u6839\u8def\u5f84\u4e5f\u662f\u53ef\u4ee5\u7684\uff1a</p> <pre><code>$ curl 192.168.27.166\n&lt;h1&gt; backend for ingress rewrite &lt;/h1&gt;\n\n&lt;h2&gt; Path: /api-a &lt;/h2&gt;\n\n&lt;a href=\"http://gaoxin.kubeasy.com\"&gt; Kubeasy &lt;/a&gt;\n</code></pre> <p>\u6240\u4ee5\u6b64\u65f6\u9700\u8981\u901a\u8fc7Ingress Nginx\u7684Rewrite\u529f\u80fd\u5c06/api-a\u91cd\u5199\u4e3a\u201c/\u201d\uff0c\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b\uff1a</p> <p>redirect.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nannotations:\nnginx.ingress.kubernetes.io/rewrite-target: /$2\nname: backend-api\nnamespace: study-ingress\nspec:\ningressClassName: nginx\nrules:\n- host: nginx.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: backend-api\nport:\nnumber: 80\npath: /api-a(/|$)(.*)\npathType: ImplementationSpecific\n</code></pre> <pre><code>$ kubectl apply -f redirect.yaml\n</code></pre> <p>\u9700\u8981\u6dfb\u52a0\u4e00\u4e2akey\u4e3anginx.ingress.kubernetes.io/rewrite-target\u7684annotation\uff0c\u5e76\u4e14value\u662f$2\uff0c\u6b64\u65f6\u8bbf\u95ee/api-a\u5c31\u4f1a\u88ab\u91cd\u5199\u4e3a\u201c/\u201d\uff0c\u8bbf\u95ee/api-a/xxx\u4f1a\u88ab\u91cd\u5199\u4e3a/xxx\u3002</p> <p>\u518d\u6b21\u8bbf\u95eenginx.test.com/api-a\u5373\u53ef\u8bbf\u95ee\u5230\u540e\u7aef\u670d\u52a1\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#5-ingress-nginx\u9519\u8bef\u4ee3\u7801\u91cd\u5b9a\u5411","title":"5. Ingress Nginx\u9519\u8bef\u4ee3\u7801\u91cd\u5b9a\u5411","text":"<p>\u5728\u4e4b\u524d\u7684\u6f14\u793a\u4e2d\uff0c\u5982\u679c\u8bbf\u95ee\u4e00\u4e9b\u4e0d\u5b58\u5728\u7684\u8def\u5f84\u6216\u57df\u540d\uff0c\u5c31\u4f1a\u629b\u51fa404\u7684\u5f02\u5e38\u9875\u9762\u3002</p> <p>\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u8fd9\u4e2a\u63d0\u793a\u5e76\u4e0d\u53cb\u597d\uff0c\u4f1a\u66b4\u9732Nginx\u7684\u7248\u672c\u53f7\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528Nginx\u7684\u9519\u8bef\u4ee3\u7801\u91cd\u5b9a\u5411\u529f\u80fd\uff0c\u5c06\u67d0\u4e9b\u9519\u8bef\u4ee3\u7801\uff08\u6bd4\u5982404\u3001403\u3001 503\uff09\u91cd\u5b9a\u5411\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u9875\u9762\u3002</p> <p>\u672c\u8282\u4e3b\u8981\u6f14\u793a\u5f53\u8bbf\u95ee\u94fe\u63a5\u8fd4\u56de\u503c\u4e3a404\u3001503\u7b49\u9519\u8bef\u65f6\uff0c\u5982\u4f55\u81ea\u52a8\u8df3\u8f6c\u5230\u81ea\u5b9a\u4e49\u7684\u9519\u8bef\u9875\u9762\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u662f\u91c7\u7528Helm\u5b89\u88c5\u7684Ingress Controller \uff0c \u63a8\u8350\u76f4\u63a5\u66f4\u6539values.yaml\uff0c\u4e4b\u540e\u6267\u884chelm upgrade\u5373\u53ef\uff08\u5982\u679c\u662f\u9759\u6001\u6587\u4ef6\u5b89\u88c5\uff0c\u9700\u8981\u66f4\u6539 ingress-nginx \u7684 ConfigMap \u6587 \u4ef6 \uff09 \u3002 \u9996\u5148\u5f00\u542fdefaultBackend \uff0c\u4fee\u6539values.yaml\u3002</p> <p>\u66f4\u65b0values.yaml\u7684ConfigMap\uff1a</p> <pre><code>  config:\napiVersion: v1\nclient_max_body_size: 20m\ncustom-http-errors: \"404,415,503\"\n</code></pre> <p>\u4e4b\u540e\u66f4\u65b0Release\uff1a</p> <pre><code>$ helm upgrade ingress-nginx ingress-nginx -f ./values-prod.yaml --namespace ingress-nginx  --create-namespace\n</code></pre> <p>\u66f4\u65b0\u540ePod\u4f1a\u81ea\u52a8\u91cd\u542f\uff0c\u5e76\u4e14\u4f1a\u521b\u5efa\u4e00\u4e2adefaultBackend\uff1a</p> <pre><code>$ kubectl  get pod -n ingress-nginx\nNAME                                           READY   STATUS    RESTARTS   AGE\ningress-nginx-controller-rvgbx                 1/1     Running   0          7h16m\ningress-nginx-defaultbackend-f67985f77-99cxx   1/1     Running   0          7h16m\n</code></pre> <p>\u66f4\u65b0\u5b8c\u6210\u540e\u8bbf\u95ee\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u9875\u9762\uff0c\u6bd4\u5982\u4e4b\u524d\u5b9a\u4e49\u7684nginx.test.com\u3002\u8bbf\u95ee\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u9875\u9762123\uff0c\u5c31\u4f1a\u8df3\u8f6c\u5230Error Server\u4e2d\u7684\u9875\u9762\uff1a</p> <pre><code>$ curl nginx.test.com/123\nHTTP/1.1 404 Not Found\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#6-ingress-nginx-ssl","title":"6. Ingress Nginx SSL","text":"<p>\u751f\u4ea7\u73af\u5883\u5bf9\u5916\u7684\u670d\u52a1\u4e00\u822c\u9700\u8981\u914d\u7f6eHTTPS\u534f\u8bae\uff0c\u4f7f\u7528Ingress\u4e5f\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u6dfb\u52a0HTTPS\u7684\u8bc1\u4e66\u3002</p> <p>\u7531\u4e8e\u662f\u5b66\u4e60\u73af\u5883\uff0c\u5e76\u6ca1\u6709\u6743\u5a01\u8bc1\u4e66\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528OpenSSL\u751f\u6210\u4e00\u4e2a\u6d4b\u8bd5\u8bc1\u4e66\uff08\u5982\u679c\u662f\u751f\u4ea7\u73af\u5883\uff0c\u90a3\u4e48\u8bc1\u4e66\u4e3a\u5728\u7b2c\u4e09\u65b9\u516c\u53f8\u8d2d\u4e70\u7684\u8bc1\u4e66\uff0c\u65e0\u987b\u81ea\u884c\u751f \u6210\uff09\uff1a</p> <pre><code>$ openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj \"/CN=nginx/O=nginx\"\nGenerating a 2048 bit RSA private key\n..................+++\n...................................+++\nwriting new private key to 'tls.key'\n-----\n</code></pre> <p>\u521b\u5efa <code>secret</code></p> <pre><code>$ kubectl create secret tls tls-secret --key tls.key --cert tls.crt\nsecret/tls-secret created\n</code></pre> <p>\u4e3aIngress\u6dfb\u52a0TLS\u914d\u7f6e\uff1a</p> <p>ingress-ssl.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\ncreationTimestamp: null\nname: nginx-ingress\nspec:\ningressClassName: nginx\nrules:\n- host: nginx.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: nginx\nport:\nnumber: 80\npath: /\npathType: ImplementationSpecific\ntls:\n- hosts:\n- nginx.test.com\nsecretName: tls-secret\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230Ingress\u6dfb\u52a0?LS\u914d\u7f6e\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728spec\u4e0b\u6dfb\u52a0\u4e00\u4e2atls\u5b57\u6bb5\u5373\u53ef\uff1a</p> <ul> <li>hosts\uff1a\u8bc1\u4e66\u6240\u6388\u6743\u7684\u57df\u540d\u5217\u8868\u3002</li> <li>secretName\uff1a\u8bc1\u4e66\u7684Secret\u540d\u5b57\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\u66f4\u65b0\u8be5Ingress\uff1a</p> <pre><code>$ kubectl apply -f ingress-ssl.yaml\ningress.networking.k8s.io/nginx-ingress created\n</code></pre> <p>\u4f7f\u7528curl\u8fdb\u884c\u6d4b\u8bd5\uff0c\u57df\u540d\u5df2\u7ecf\u88ab\u91cd\u5b9a\u5411\u5230H??PS\uff1a</p> <pre><code>$ curl -I nginx.test.com\nHTTP/1.1 308 Permanent Redirect\nDate: Fri, 10 Feb 2023 11:12:58 GMT\nContent-Type: text/html\nContent-Length: 164\nConnection: keep-alive\nLocation: https://nginx.test.com\n</code></pre> <p>\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\u4f1a\u81ea\u52a8\u8df3\u8f6c\u5230HTTPS\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#7-ingress-nginx\u5339\u914d\u8bf7\u6c42\u5934","title":"7. Ingress Nginx\u5339\u914d\u8bf7\u6c42\u5934","text":"<p>\u5f00\u53d1\u4e00\u4e2a\u7f51\u9875\u6216\u8005\u5e94\u7528\u65f6\uff0c\u5f80\u5f80\u4f1a\u9002\u914d\u8ba1\u7b97\u673a\u7aef\u548c\u624b\u673a\u7aef\uff0c\u901a\u5e38\u4f1a\u5c06\u79fb\u52a8\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u9875\u9762\u91cd\u5b9a\u5411\u5230\u79fb\u52a8\u7aef\u7684\u670d\u52a1\u4e0a\uff0c\u8bfb\u8005\u4e5f\u6709\u53ef\u80fd\u7ecf\u5e38\u89c1\u5230 m.xxx.com\u6b64\u7c7b\u7684\u57df\u540d\uff0c\u57fa\u672c\u90fd\u5c5e\u4e8e\u79fb\u52a8\u7aef\u670d\u52a1\u3002</p> <p>Nginx\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u8bf7\u6c42\u7684\u8bf7\u6c42\u5934\u5224\u65ad\u5ba2\u6237\u7aef\u6765\u6e90\uff0c\u5e76\u5c06\u5176\u8def\u7531\u5230\u6307\u5b9a\u7684\u670d\u52a1\u4e0a\u3002</p> <p>\u672c\u8282\u5c06\u6f14\u793a\u628a\u6765\u81ea\u79fb\u52a8\u7aef\u7684\u8bbf\u95ee\u91cd\u5b9a\u5411\u5230\u79fb\u52a8\u7aef\u670d\u52a1\uff0c\u8ba1\u7b97\u673a\u7aef\u8bbf\u95ee\u4fdd\u6301\u9ed8\u8ba4\u5373\u53ef\u3002</p> <p>\u9996\u5148\u90e8\u7f72\u79fb\u52a8\u7aef\u5e94\u7528\uff1a</p> <pre><code>$ kubectl create deploy phone --image=registry.cn-beijing.aliyuncs.com/dotbalo/nginx:phone -n study-ingress\ndeployment.apps/phone created\n\n$ kubectl expose deploy phone --port 80 -n study-ingress\nservice/phone exposed\n</code></pre> <p>Ingress\u5b9e\u4f8b\u4e5f\u53ef\u4ee5\u901a\u8fc7kubectl create\u521b\u5efa\uff0c\u53ea\u9700\u8981\u4e00\u6761\u547d\u4ee4\u5373\u53ef\uff1a</p> <pre><code>$ kubectl create ingress phone --class=nginx  --rule=m.test.com/*=phone:80 -n study-ingress\ningress.networking.k8s.io/phone created\n</code></pre> <p>\u90e8\u7f72\u8ba1\u7b97\u673a\u7aef\u5e94\u7528\uff1a</p> <pre><code>$ kubectl create deploy laptop --image=registry.cn-beijing.aliyuncs.com/dotbalo/nginx:laptop -n study-ingress\ndeployment.apps/laptop created\n\n$ kubectl expose deploy laptop --port 80 -n study-ingress\nservice/laptop exposed\n\n$ kubectl  get pod -n study-ingress -l app=laptop\nNAME                      READY   STATUS    RESTARTS   AGE\nlaptop-684698ddb4-csv6z   1/1     Running   0          78s\n</code></pre> <p>\u4e4b\u540e\u521b\u5efa\u8ba1\u7b97\u673a\u7aef\u7684Ingress\uff0c\u6ce8\u610fIngress annotations\u7684nginx.ingress.kubernetes.io/server-snippet\u914d\u7f6e\u3002</p> <p>Snippet\u914d\u7f6e\u4e13\u95e8\u7528\u4e8e\u4e00\u4e9b\u590d\u6742\u7684Nginx\u914d\u7f6e\uff0c\u548cNginx\u914d\u7f6e\u901a\u7528\u3002</p> <p>\u5339\u914d\u79fb\u52a8\u7aef\u5b9e\u4f8b\u5982\u4e0b\uff1a</p> <p>vim laptop-ingress.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nannotations:\nnginx.ingress.kubernetes.io/server-snippet: |\nset $agentflag 0;\nif ($http_user_agent ~* \"(Android|iPhone|Windows Phone|UC|Kindle)\" ){\nset $agentflag 1;\n}\nif ( $agentflag = 1 ) {\nreturn 301 http://m.test.com;\n}\nname: laptop\nnamespace: study-ingress\nspec:\ningressClassName: nginx\nrules:\n- host: test.com\nhttp:\npaths:\n- backend:\nservice:\nname: laptop\nport:\nnumber: 80\npath: /\npathType: ImplementationSpecific\n</code></pre> <pre><code>$ kubectl apply -f laptop-ingress.yaml\ningress.networking.k8s.io/laptop created\n</code></pre> <p>\u9996\u5148\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95eetest.com\uff0c\u53ef\u4ee5\u770b\u5230\u9875\u9762\u662fLaptop\uff0c\u5982\u56fe16.7\u6240\u793a\u3002</p> <p> \u56fe16.7\u3000\u8bbf\u95ee\u8ba1\u7b97\u673a\u7aef</p> <p>\u63a5\u4e0b\u6765\u4f7f\u7528\u6d4f\u89c8\u5668\u7684\u5f00\u53d1\u8005\u5de5\u5177\u5c06\u7ec8\u7aef\u7c7b\u578b\u6539\u4e3aiPhone\uff0c\u6216\u8005\u76f4\u63a5\u7528iPhone\u624b\u673a\u8bbf\u95ee\uff08\u7ebf\u4e0a\u4e1a\u52a1\u4e00\u822c\u914d\u7f6e\u7684\u90fd\u6709DNS\uff0c\u53ef\u4ee5\u76f4\u63a5\u89e3\u6790\u57df\u540d\uff0c\u6d4b\u8bd5\u73af\u5883\u53ef\u80fd\u9700\u8981\u81ea\u5df1\u5355\u72ec\u914d\u7f6e\uff09\uff0c\u5982\u56fe16.8\u6240\u793a\u3002</p> <p></p> <p>\u5237\u65b0\u9875\u9762\u4f1a\u81ea\u52a8\u8df3\u8f6c\u81f3m.test.com\uff0c\u5982\u56fe16.9\u6240\u793a\u3002 </p> <p>\u56fe16.9\u3000\u624b\u673a\u7aef\u9875\u9762</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#8-ingress-nginx\u57fa\u672c\u8ba4\u8bc1","title":"8. Ingress Nginx\u57fa\u672c\u8ba4\u8bc1","text":"<p>\u6709\u4e9b\u7f51\u7ad9\u53ef\u80fd\u9700\u8981\u901a\u8fc7\u5bc6\u7801\u6765\u8bbf\u95ee\uff0c\u5bf9\u4e8e\u8fd9\u7c7b\u7f51\u7ad9\u53ef\u4ee5\u4f7f\u7528Nginx\u7684basic-auth\u8bbe\u7f6e\u5bc6\u7801\u8bbf\u95ee\uff0c\u5177\u4f53\u65b9\u6cd5\u5982\u4e0b\uff0c\u7531\u4e8e\u9700\u8981\u4f7f\u7528htpasswd\u5de5\u5177\uff0c\u56e0 \u6b64\u9700\u8981\u5b89\u88c5httpd\uff1a</p> <pre><code>$ yum install httpd -y\n</code></pre> <p>\u4f7f\u7528htpasswd\u521b\u5efafoo\u7528\u6237\u7684\u5bc6\u7801\uff1a</p> <pre><code>$ htpasswd -c auth foo\nNew password:\nRe-type new password:\nAdding password for user foo\n\n$ cat auth\nfoo:$apr1$drc3/UbL$TjUp.ZEVK3q6ImJVT/ZYy0\n</code></pre> <p>\u57fa\u4e8e\u4e4b\u524d\u521b\u5efa\u7684\u5bc6\u7801\u6587\u4ef6\u521b\u5efaSecret\uff1a</p> <pre><code>$ kubectl create secret generic basic-auth --from-file=auth -n study-ingress\nsecret/basic-auth created\n</code></pre> <p>\u521b\u5efa\u5305\u542b\u5bc6\u7801\u8ba4\u8bc1\u7684Ingress\uff1a</p> <p>ingress-with-auth.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nannotations:\nnginx.ingress.kubernetes.io/auth-realm: Please Input Your Username and Password\nnginx.ingress.kubernetes.io/auth-secret: basic-auth\nnginx.ingress.kubernetes.io/auth-type: basic\nname: ingress-with-auth\nnamespace: study-ingress\nspec:\ningressClassName: nginx\nrules:\n- host: auth.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: nginx\nport:\nnumber: 80\npath: /\npathType: ImplementationSpecific </code></pre> <ul> <li>nginx.ingress.kubernetes.io/auth-type \uff1a \u8ba4\u8bc1\u7c7b\u578b,\u53ef\u4ee5\u662fbasic\u548cdigest\u3002</li> <li>nginx.ingress.kubernetes.io/auth-secret\uff1a\u5bc6\u7801\u6587\u4ef6\u7684Secret\u540d\u79f0\u3002</li> <li>nginx.ingress.kubernetes.io/auth-realm\uff1a\u9700\u8981\u5bc6\u7801\u8ba4\u8bc1\u7684\u6d88\u606f\u63d0\u9192\u3002</li> </ul> <p>\u521b\u5efa\u8be5Ingress\uff0c\u5e76\u8bbf\u95ee\u6d4b\u8bd5\uff0c\u5982\u56fe16.10\u6240\u793a\u3002</p> <pre><code>$ kubectl create deploy nginx --image=registry.cn-beijing.aliyuncs.com/dotbalo/nginx:1.15.12 -n study-ingress\ndeployment.apps/nginx created\n\n$ kubectl expose deploy nginx --port 80 -n study-ingress\nservice/nginx exposed\n\n$ kubectl apply -f ingress-with-auth.yaml\ningress.networking.k8s.io/ingress-with-auth created\n</code></pre> <p>\u521b\u5efa\u8be5Ingress\uff0c\u5e76\u8bbf\u95ee\u6d4b\u8bd5\uff0c\u5982\u56fe16.10\u6240\u793a\u3002  \u56fe16.10\u3000\u914d\u7f6e\u8d26\u53f7\u548c\u5bc6\u7801</p> <p>\u8f93\u5165\u5bc6\u7801\u540e\u5373\u53ef\u8fdb\u5165\u9875\u9762\uff0c\u5728\u6b64\u4e0d\u518d\u6f14\u793a\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#9-ingress-nginx\u9ed1\u767d\u540d\u5355","title":"9. Ingress Nginx\u9ed1/\u767d\u540d\u5355","text":"<p>\u6709\u4e9b\u7f51\u9875\u53ef\u80fd\u53ea\u9700\u8981\u6307\u5b9a\u7528\u6237\u8bbf\u95ee\uff0c\u6bd4\u5982\u516c\u53f8\u7684ERP\u53ea\u80fd\u516c\u53f8\u5185\u90e8\u8bbf\u95ee\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u767d\u540d\u5355\u9650\u5236\u8bbf\u95ee\u7684IP\u3002</p> <p>\u6709\u4e9b\u7f51\u9875\u4e0d\u5141\u8bb8\u67d0\u4e9bIP\u8bbf\u95ee\uff0c\u6bd4\u5982\u4e00\u4e9b\u6709\u5f02\u5e38\u6d41\u91cf\u7684IP\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u9ed1\u540d\u5355\u7981\u6b62\u8be5IP\u8bbf\u95ee\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#91-\u914d\u7f6e\u9ed1\u540d\u5355","title":"9.1 \u914d\u7f6e\u9ed1\u540d\u5355","text":"<p>\u914d\u7f6e\u9ed1\u540d\u5355\u7981\u6b62\u67d0\u4e00\u4e2a\u6216\u67d0\u4e00\u6bb5IP\uff0c\u9700\u8981\u5728Nginx Ingress\u7684ConfigMap\u4e2d\u914d\u7f6e\uff0c\u6bd4\u5982\u5c06192.168.10.130\uff08\u591a\u4e2a\u914d\u7f6e\u4f7f\u7528\u9017\u53f7\u5206\u9694\uff09\u6dfb\u52a0\u81f3\u9ed1\u540d\u5355\uff1a</p> <p>vim values-prod.yaml</p> <pre><code>controller:\nname: controller\nimage:\nrepository: cnych/ingress-nginx\ntag: \"v1.1.0\"\ndigest:\ndnsPolicy: ClusterFirstWithHostNet\nconfig:\nblock-cidrs: 192.168.1.190\napiVersion: v1\nclient_max_body_size: 20m\ncustom-http-errors: \"404,415,503\"\n.......\n</code></pre> <p>\u6eda\u52a8\u66f4\u65b0Nginx Ingress\uff1a</p> <pre><code>$ helm upgrade ingress-nginx ingress-nginx -f ./values-prod.yaml --namespace ingress-nginx\n</code></pre> <p>\u4f7f\u7528192.168.1.190\u4e3b\u673a\u518d\u6b21\u8bbf\u95ee\uff0c\u53d1\u73b0\u8be5IP\u5df2\u7ecf\u88ab\u7981\u6b62\uff1a</p> <pre><code>$ curl -I auth.test.com\nHTTP/1.1 403 Forbidden\nDate: Mon, 13 Feb 2023 07:18:48 GMT\nContent-Type: text/html\nContent-Length: 146\nConnection: keep-alive\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#92-\u914d\u7f6e\u767d\u540d\u5355","title":"9.2 \u914d\u7f6e\u767d\u540d\u5355","text":"<p>\u767d\u540d\u5355\u8868\u793a\u53ea\u5141\u8bb8\u67d0\u4e2aIP\u8bbf\u95ee\uff0c\u76f4\u63a5\u5728YAML\u6587\u4ef6\u4e2d\u914d\u7f6e\u5373\u53ef\uff08\u4e5f\u53ef\u4ee5\u901a\u8fc7ConfigMap\u914d\u7f6e\uff09\uff0c\u6bd4\u5982\u53ea\u5141\u8bb8192.168.10.128\u8bbf\u95ee\uff0c\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a nginx.ingress.kubernetes.io/whitelist-source-range\u6ce8\u91ca\u5373\u53ef\uff1a</p> <p>\u7f51\u6bb5\u548c\u591a\u4e2aIP\u8bbe\u7f6e\u767d\u540d\u5355</p> <pre><code>nginx.ingress.kubernetes.io/whitelist-source-range: 192.168.1.0/24,192.168.2.8\n</code></pre> <p>vim auth-whitelist.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nannotations:\nnginx.ingress.kubernetes.io/auth-realm: Please Input Your Username and Password\nnginx.ingress.kubernetes.io/auth-secret: basic-auth\nnginx.ingress.kubernetes.io/auth-type: basic\nnginx.ingress.kubernetes.io/whitelist-source-range: 192.168.1.190\nname: ingress-with-auth\nnamespace: study-ingress\nspec:\ningressClassName: nginx\nrules:\n- host: auth.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: nginx\nport:\nnumber: 80\npath: /\npathType: ImplementationSpecific </code></pre> <p>\u66f4\u65b0\u8be5Ingress\uff1a</p> <pre><code>$ kubectl apply -f auth-whitelist.yaml\ningress.networking.k8s.io/ingress-with-auth configured\n</code></pre> <p>\u6b64\u65f6192.168.1.190\u4e3b\u673a\u662f\u53ef\u4ee5\u8bbf\u95ee\u7684\uff1a</p> <pre><code>$ curl auth.test.com -I\nHTTP/1.1 401 Unauthorized\nDate: Mon, 13 Feb 2023 07:48:26 GMT\nContent-Type: text/html\nContent-Length: 172\nConnection: keep-alive\nWWW-Authenticate: Basic realm=\"Please Input Your Username and Password\"\n</code></pre> <p>\u5176\u4ed6IP\u8bbf\u95ee\u88ab\u7981\u6b62\uff1a</p> <pre><code>$ curl -I auth.test.com\nHTTP/1.1 403 Forbidden\nDate: Mon, 13 Feb 2023 07:49:31 GMT\nContent-Type: text/html\nContent-Length: 146\nConnection: keep-alive\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#10-ingress-nginx\u901f\u7387\u9650\u5236","title":"10. Ingress Nginx\u901f\u7387\u9650\u5236","text":"<p>\u6709\u65f6\u5019\u53ef\u80fd\u9700\u8981\u9650\u5236\u901f\u7387\u4ee5\u964d\u4f4e\u540e\u7aef\u538b\u529b\uff0c\u6216\u8005\u9650\u5236\u5355\u4e2aIP\u6bcf\u79d2\u7684\u8bbf\u95ee\u901f\u7387\u9632\u6b62\u653b\u51fb\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528Nginx\u7684rate limit\u8fdb\u884c\u914d\u7f6e\u3002</p> <p>\u9996\u5148\u6ca1\u6709\u52a0\u901f\u7387\u9650\u5236\uff0c\u4f7f\u7528ab\u8fdb\u884c\u8bbf\u95ee\uff0cFailed\u4e3a0\uff1a</p> <pre><code>$ yum -y install httpd-tools\n$ ab -c 10 -n 100 http://auth.test.com/ | grep requests\nComplete requests:      100\nFailed requests:        0\nTime per request:       0.579 [ms] (mean, across all concurrent requests)\nPercentage of the requests served within a certain time (ms)\n</code></pre> <p>\u6dfb\u52a0\u901f\u7387\u9650\u5236\uff0c\u9650\u5236\u53ea\u80fd\u6709\u4e00\u4e2a\u8fde\u63a5\uff0c \u53ea\u9700\u8981\u6dfb\u52a0nginx.ingress.kubernetes.io/limit-connections\u4e3a1\u5373\u53ef\uff1a</p> <p>vim auth-rate-limit.yaml </p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nannotations:\nnginx.ingress.kubernetes.io/auth-realm: Please Input Your Username and Password\nnginx.ingress.kubernetes.io/auth-secret: basic-auth\nnginx.ingress.kubernetes.io/auth-type: basic\nnginx.ingress.kubernetes.io/limit-connections: \"1\"\nname: ingress-with-auth\nnamespace: study-ingress\nspec:\ningressClassName: nginx\nrules:\n- host: auth.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: nginx\nport:\nnumber: 80\npath: /\npathType: ImplementationSpecific\n</code></pre> <pre><code>$ kubectl apply -f auth-rate-limit.yaml\ningress.networking.k8s.io/ingress-with-auth created\n</code></pre> <p>\u518d\u6b21\u4f7f\u7528ab\u6d4b\u8bd5\uff0cFailed\u4e3a32\uff1a</p> <pre><code>$ ab -c 10 -n 100 http://auth.test.com/ | grep requests\nComplete requests:      100\nFailed requests:        32\nTime per request:       0.511 [ms] (mean, across all concurrent requests)\nPercentage of the requests served within a certain time (ms)\n</code></pre> <p>\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u65b9\u9762\u7684\u9650\u5236\uff0c\u5e38\u7528\u7684\u914d\u7f6e\u5982\u4e0b\uff1a</p> <pre><code>#\u9650\u5236\u6bcf\u79d2\u7684\u8fde\u63a5\uff0c\u5355\u4e2aIP\nnginx.ingress.kubernetes.io/limit-rps\nnginx.ingress.kubernetes.io/limit-rps: '100'\n\n#\u9650\u5236\u6bcf\u5206\u949f\u7684\u8fde\u63a5\uff0c\u5355\u4e2aIP\nnginx.ingress.kubernetes.io/limit-rpm\n\n#\u9650\u5236\u5ba2\u6237\u7aef\u6bcf\u79d2\u4f20\u8f93\u7684\u5b57\u8282\u6570\uff0c\u5355\u4f4d\u4e3aKB\uff0c\u9700\u8981\u5f00\u542fproxy-buffering\nnginx.ingress.kubernetes.io/limit-rate\n\n# \u901f\u7387\u9650\u5236\u767d\u540d\u5355\nnginx.ingress.kubernetes.io/limit-whitelist\n</code></pre> <p>\u6bd4\u5982\u5982\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\nname: ingress-nginx\nannotations:\nkubernetes.io/ingress.class: \"nginx\"\nnginx.ingress.kubernetes.io/limit-rate: \"100K\"\nnginx.ingress.kubernetes.io/limit-whitelist: \"10.1.10.100\"\nnginx.ingress.kubernetes.io/limit-rps: \"1\"\nnginx.ingress.kubernetes.io/limit-rpm: \"30\"\nspec:\nrules:\n- host: iphone.coolops.cn http:\npaths:\n- path: backend:\nserviceName: ng-svc\nservicePort: 80\n</code></pre> <p>\u5176\u4e2d\uff1a</p> <ul> <li>nginx.ingress.kubernetes.io/limit-rate\uff1a\u9650\u5236\u5ba2\u6237\u7aef\u6bcf\u79d2\u4f20\u8f93\u7684\u5b57\u8282\u6570</li> <li>nginx.ingress.kubernetes.io/limit-whitelist\uff1a\u767d\u540d\u5355\u4e2d\u7684IP\u4e0d\u9650\u901f</li> <li>nginx.ingress.kubernetes.io/limit-rps\uff1a\u5355\u4e2aIP\u6bcf\u79d2\u7684\u8fde\u63a5\u6570</li> <li>nginx.ingress.kubernetes.io/limit-rpm\uff1a\u5355\u4e2aIP\u6bcf\u5206\u949f\u7684\u8fde\u63a5\u6570</li> </ul> <p>\u66f4\u591a\u8bf7\u70b9 \u8fd9\u91cc\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#11-ingress-nginx\u8de8\u57df\u914d\u7f6e","title":"11. Ingress Nginx\u8de8\u57df\u914d\u7f6e","text":"<pre><code>apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\nannotations:\nnginx.ingress.kubernetes.io/cors-allow-headers: &gt;-\nDNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\nnginx.ingress.kubernetes.io/cors-allow-methods: 'PUT, GET, POST, OPTIONS'\nnginx.ingress.kubernetes.io/cors-allow-origin: '*'\nnginx.ingress.kubernetes.io/enable-cors: 'true'\nnginx.ingress.kubernetes.io/service-weight: ''\ncreationTimestamp: '2019-06-27T12:36:08Z'\ngeneration: 1\nname: hs-http\nnamespace: default\nresourceVersion: '81912785'\nselfLink: /apis/extensions/v1beta1/namespaces/default/ingresses/hs-http\nuid: 2343101d-98d8-11e9-8792-7a7bebcd6704\nspec:\nrules:\n- host: hs.k8s.test.com\nhttp:\npaths:\n- backend:\nserviceName: custom-hs\nservicePort: 80\npath: /\ntls:\n- hosts:\n- hs.k8s.test.com\nsecretName: hs-secret0\nstatus:\nloadBalancer:\ningress:\n- ip: 1.2.3.4\n</code></pre> <p>\u5c06\u8fd9\u4e2a\u914d\u7f6e\u6dfb\u52a0\u5230Ingress\u7684\u6ce8\u89e3\u4e2d\u5373\u53ef\uff0c</p> <p>\u8be6\u89c1</p> <p>https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#enable-cors</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#12-\u4f7f\u7528nginx\u5b9e\u73b0\u7070\u5ea6\u91d1\u4e1d\u96c0\u53d1\u5e03","title":"12. \u4f7f\u7528Nginx\u5b9e\u73b0\u7070\u5ea6/\u91d1\u4e1d\u96c0\u53d1\u5e03","text":"<p>Nginx\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e9b\u7b80\u5355\u7684\u7070\u5ea6\u3001\u84dd\u7eff\u53d1\u5e03\uff0c\u5f53\u67d0\u4e2a\u670d\u52a1\u9700\u8981\u5728\u4e0a\u7ebf\u4e4b\u524d\u8fdb\u884c\u4e00\u4e9b\u903b\u8f91\u6d4b\u8bd5\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b64\u529f\u80fd\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#121-\u521b\u5efav1\u7248\u672c","title":"12.1 \u521b\u5efav1\u7248\u672c","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e24\u4e2a\u547d\u540d\u7a7a\u95f4\uff0c\u4e00\u4e2a\u662f\u6b63\u5728\u4f7f\u7528\u7684\u751f\u4ea7\u73af\u5883Production\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u7070\u5ea6\u6d4b\u8bd5\u7684Canary\u3002</p> <p>\u5728\u53d1\u5e03\u5e94\u7528\u65f6\uff0c\u53ef\u4ee5\u5c06\u5e94\u7528\u5148\u53d1\u5e03\u81f3Canary\uff0c\u7136\u540e\u5207\u4e00\u90e8\u5206\u6d41\u91cf\u5230Canary\uff0c\u4e4b\u540e\u6162\u6162\u5c06\u6d41\u91cf\u5168\u90e8\u5207\u6362\u5230\u4e0a\u9762\u5373\u53ef\u3002</p> <p>\u9996\u5148\u521b\u5efa\u6a21\u62df\u751f\u4ea7\uff08Production\uff09\u73af\u5883\u7684\u547d\u540d\u7a7a\u95f4\u548c\u670d\u52a1\uff1a</p> <pre><code>$ kubectl create ns production\nnamespace/production created\n\n$ kubectl create deploy canary-v1 --image=registry.cn-beijing.aliyuncs.com/dotbalo/canary:v1 -n production\ndeployment.apps/canary-v1 created\n\n$ kubectl expose deploy canary-v1 --port 8080 -n production\nservice/canary-v1 exposed\n\n$ kubectl create ingress canary-v1 --class=nginx  --rule=canary.com/*=canary-v1:8080 -n production\ningress.networking.k8s.io/canary-v1 created\n\n$ k get ingress -n production\nNAME        CLASS   HOSTS        ADDRESS   PORTS   AGE\ncanary-v1   nginx   canary.com             80      22s\n</code></pre> <p>\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\u8be5\u670d\u52a1\uff0c\u53ef\u4ee5\u770b\u5230Canary v1\u7684\u9875\u9762\uff0c\u5982\u56fe16.11\u6240\u793a\u3002</p> <p> \u56fe16.11\u3000\u8bbf\u95ee\u7070\u5ea6v1\u7248\u672c</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#122-\u521b\u5efav2\u7248\u672c","title":"12.2 \u521b\u5efav2\u7248\u672c","text":"<p>\u63a5\u4e0b\u6765\u521b\u5efav2\u7248\u672c\uff0c\u5145\u5f53\u7070\u5ea6\u73af\u5883</p> <pre><code>$ kubectl create ns canary\nnamespace/canary created\n</code></pre> <p>\u521b\u5efav2\u7248\u672c\u7684\u5e94\u7528\u548cService\uff1a</p> <pre><code>$ kubectl create deploy canary-v2 --image=registry.cn-beijing.aliyuncs.com/dotbalo/canary:v2 -n canary\ndeployment.apps/canary-v2 created\n\n$ kubectl expose deploy canary-v2 --port 8080 -n canary\nservice/canary-v2 exposed\n\n$ kubectl create ingress canary-v1 --class=nginx  --rule=canary.com/*=canary-v1:8080 -n production\ningress.networking.k8s.io/canary-v1 created\n</code></pre> <p>\u5f85\u7a0b\u5e8f\u542f\u52a8\u5b8c\u6210\u540e\uff0c\u901a\u8fc7Service\u8bbf\u95ee\u8be5\u670d\u52a1\uff0c\u4f1a\u8fd4\u56deCanary v2\uff1a</p> <pre><code>$ kubectl get svc -n canary\nNAME        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\ncanary-v2   ClusterIP   192.168.87.20   &lt;none&gt;        8080/TCP   34s\n\n$ curl 192.168.87.20:8080\n&lt;h1&gt;Canary v2&lt;/h1&gt;\n</code></pre> <p>\u63a5\u4e0b\u6765\u901a\u8fc7Ingress\u63a7\u5236\u6d41\u91cf\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#123-canary\u7248\u672c\u5207\u5165\u90e8\u5206\u6d41\u91cf","title":"12.3 Canary\u7248\u672c\u5207\u5165\u90e8\u5206\u6d41\u91cf","text":"<p>\u521b\u5efav2\u7248\u672c\u7684Ingress\u65f6,\u9700\u8981\u6dfb\u52a0\u4e24\u4e2a\u6ce8\u91ca\uff1a</p> <ul> <li>nginx.ingress.kubernetes.io/canary\uff0c\u8868\u660e\u662f\u7070\u5ea6\u73af\u5883 \uff1b</li> <li>nginx.ingress.kubernetes.io/canary-weight\uff0c\u8868\u660e\u5206\u914d\u591a\u5c11\u6d41\u91cf\u5230\u8be5\u73af\u5883\uff0c\u672c\u793a\u4f8b\u4e3a10%\uff1a</li> </ul> <p>canary-v2.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nannotations:\nnginx.ingress.kubernetes.io/canary: \"true\"\nnginx.ingress.kubernetes.io/canary-weight: \"10\"\nname: canary-v2\nnamespace: canary\nspec:\ningressClassName: nginx\nrules:\n- host: canary.com\nhttp:\npaths:\n- backend:\nservice:\nname: canary-v2\nport:\nnumber: 8080\npath: /\npathType: ImplementationSpecific\n</code></pre> <p>\u6b64\u65f6\u901a\u8fc7nginx.ingress.kubernetes.io/canary-weight: \"10\"\u8bbe\u7f6e\u7684\u6743\u91cd\u662f10\uff0c\u5373v1:v2\u4e3a9:1\u3002</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#124-\u6d4b\u8bd5\u7070\u5ea6\u53d1\u5e03","title":"12.4 \u6d4b\u8bd5\u7070\u5ea6\u53d1\u5e03","text":"<p>\u63a5\u4e0b\u6765\u4f7f\u7528shell\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5\uff0c\u6b64\u811a\u672c\u4f1a\u8f93\u51fav1\u548cv2\u7684\u8bbf\u95ee\u6b21\u6570\u6bd4\u503c\uff1a</p> <p>test-canary.sh</p> <pre><code>v1=0;v2=0\nfor i in $(seq 1 100);\ndo\nif $(curl -s \"canary.com\"|grep \"v1\" &gt;/dev/null);then\nv1=$[$v1+1]\nelse\nv2=$[$v2+1]\nfi\ndone\nprintf \"v1:%d  v2:%d\\n\" $v1 $v2\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6bd4\u4f8b\u5dee\u4e0d\u591a\u662f9:1\uff0c\u63a5\u4e0b\u6765\u8bfb\u8005\u53ef\u4ee5\u66f4\u6539\u6743\u91cd\uff0c\u518d\u6b21\u6d4b\u8bd5\uff0c\u5728\u6b64\u4e0d\u518d\u6f14\u793a\u3002</p> <pre><code>$ bash test-canary.sh\nv1:89  v2:11\n\n$ bash test-canary.sh\nv1:91  v2:9\n\n$ bash test-canary.sh\nv1:91  v2:9\n</code></pre>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#13--\u73af\u5883\u6e05\u7406","title":"13.  \u73af\u5883\u6e05\u7406","text":"<p>\u6d4b\u8bd5\u65e0\u8bef\u540e\uff0c\u53ef\u4ee5\u6e05\u7406\u4e4b\u524d\u7684\u5b66\u4e60\u6570\u636e\uff1a</p> <pre><code>$ kubectl delete deploy,svc,ingress -n production --all\n\n$ kubectl delete deploy,svc,ingress -n canary --all\n\n$ kubectl delete deploy,svc,ingress -n study-ingress --all\n\n$ kubectl delete ns study-ingress production canary\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>Ingress\u4f01\u4e1a\u5b9e\u6218\uff1a\u91d1\u4e1d\u96c0\u4e0e\u84dd\u7eff\u53d1\u5e03\u7bc7</p>"},{"location":"Kubernetes/5.%E8%BF%90%E7%BB%B4%E7%AF%87/16.%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83Ingress%E8%BF%9B%E9%98%B6/#14-\u5c0f\u7ed3","title":"14. \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u8bb2\u89e3\u7684\u662fIngress\u5728\u5b9e\u9645\u5e94\u7528\u65f6\u5e38\u7528\u7684\u6848\u4f8b\uff0c\u5176\u5b9e\u4e0d\u96be\u770b\u51fa\uff0c\u91c7\u7528Ingress\u5145\u5f53\u7f51\u5173\uff0c\u6ca1\u6709\u4e86\u9488\u5bf9Nginx\u3001HAProxy\u7b49\u5de5\u5177\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u5b66\u4e60\u3002</p> <p>\u65e0\u8bba\u4f55\u79cdIngress Controller\u65b9\u6848\uff0c\u5176\u914d\u7f6e\u65b9\u5f0f\u90fd\u662f\u7c7b\u4f3c\u7684\uff0c\u53ea\u9700\u8981\u627e\u5230\u5bf9\u5e94\u63a7\u5236\u5668\u7684\u5b98\u65b9\u6587\u6863\u5373\u53ef\uff0c\u53ef\u80fd\u53ea\u662f\u6ce8\u91ca\uff08IngressClass\u6210\u719f\u540e\uff0c\u53ef\u80fd\u5e76\u4e0d\u518d \u9700\u8981\u6ce8\u91ca\u7684\u65b9\u5f0f\uff09\u7684\u533a\u522b\uff0c\u5bf9\u4e8eIngress\u7684\u914d\u7f6e\u5927\u81f4\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u76ee\u524d\u6bd4\u8f83\u6d41\u884c\u7684Ingress Controller\u6709ingress-nginx(\u672c\u4e66\u8bb2\u89e3\u7684\uff0c\u7531Kubernetes \u5b98\u65b9\u7ef4\u62a4)\u3001nginx-ingress(\u7531Nginx\u5b98\u65b9\u7ef4\u62a4\uff0c\u6ce8\u610f\u548cingress-nginx\u7684\u533a\u522b)\u3001Traefik\u3001Istio\u7b49\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u4eca\u540e\u9700\u8981\u63a5\u5165Istio\uff0c\u63a8\u8350\u91c7\u7528Istio\u7684ingressgateway\u4f5c\u4e3aIngress\uff08\u5176\u5b9e\u5df2\u7ecf\u4e0d\u80fd\u518d\u79f0\u4e3aIngress\uff0c\u56e0\u4e3aingressgateway\u914d\u7f6e\u65b9\u5f0f\u5e76\u975eIngress\u8d44\u6e90\uff0c\u800c\u662fIstio\u81ea\u5b9a\u4e49\u7684Gateway\u548cVirtualService\u8d44\u6e90\uff09\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/","title":"DevOps\u5b9e\u8df5","text":"<p>\u5728\u4e4b\u524d\u7684\u7ae0\u8282\uff0c\u6211\u4eec\u6240\u4ecb\u7ecd\u7684\u5e94\u7528\u90e8\u7f72\u6216\u8005\u66f4\u65b0\u90fd\u662f\u91c7\u7528\u624b\u5de5\u7684\u65b9\u5f0f\uff0c\u4f46\u5728\u4f01\u4e1a\u5185\u90e8\uff0c\u5e94\u7528\u67b6\u6784\u4e00\u822c\u90fd\u91c7\u7528\u5fae\u670d\u52a1\uff0c\u5927\u90e8\u5206\u9879\u76ee\u90fd\u4f1a\u5bf9\u5e94\u51e0\u5341\u3001\u4e0a \u767e\uff0c\u751a\u81f3\u4e0a\u5343\u4e2a\u5fae\u670d\u52a1\uff0c\u5e76\u4e14\u8fd8\u4e0d\u4ec5\u4ec5\u53ea\u6709\u4e00\u4e2a\u9879\u76ee\uff0c\u6240\u4ee5\u91c7\u7528\u624b\u5de5\u65b9\u5f0f\u4e0a\u7ebf\u662f\u4e0d\u592a\u73b0\u5b9e\u7684\u4e8b\u60c5\uff0c\u7279\u522b\u662f\u968f\u7740\u5e94\u7528\u7684\u589e\u591a\uff0c\u5bf9\u5e94\u7684\u5de5\u4f5c\u91cf\u4e5f\u53d8\u5f97\u4e0d\u53ef\u60f3 \u8c61\u3002</p> <p>\u7531\u4e8e\u4e0a\u7ebf\u7684\u8fc7\u7a0b\u4e00\u822c\u6bd4\u8f83\u56fa\u5b9a\uff0c\u5927\u90fd\u662f\u63d0\u524d\u89c4\u5b9a\u597d\u3001\u6bd4\u8f83\u4e00\u81f4\u7684\u6d41\u7a0b\uff0c\u56e0\u6b64\u91c7\u7528\u5de5\u5177\u6765\u5b8c\u6210\u8fd9\u7c7b\u201c\u6b7b\u677f\u201d\u7684\u5de5\u4f5c\u662f\u6bd4\u8f83\u63a8\u8350\u7684\u65b9\u5f0f\uff0c\u540c\u65f6\u4e5f\u80fd\u51cf\u5c11 \u624b\u5de5\u64cd\u4f5c\u5e26\u6765\u6545\u969c\u7684\u98ce\u9669\u3002</p> <p>\u672c\u7ae0\u4e3b\u8981\u4ecb\u7ecd\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6301\u7eed\u96c6\u6210\uff08Continuous Integration\uff0cCI\uff09\u4e0e\u6301\u7eed\u90e8\u7f72\uff08Continuous Deployment\uff0cCD\uff09\u7684\u4f7f\u7528--\u5b9e\u73b0Jenkins\u6d41\u6c34\u7ebf \u811a\u672c\u81ea\u52a8\u53d1\u5e03\u5e94\u7528\u5230Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u5f53\u7136CI/CD\u662fDevOps\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u73af\u8282\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-cicd\u4ecb\u7ecd","title":"1. CI/CD\u4ecb\u7ecd","text":"<p>CI/CD\u662f\u4e00\u79cd\u901a\u8fc7\u5728\u5e94\u7528\u5f00\u53d1\u9636\u6bb5\u5f15\u5165\u81ea\u52a8\u5316\u6765\u9891\u7e41\u5411\u5ba2\u6237\u4ea4\u4ed8\u5e94\u7528\u7684\u65b9\u6cd5\u3002</p> <p>CI/CD\u7684\u6838\u5fc3\u6982\u5ff5\u662f\u6301\u7eed\u96c6\u6210\u3001\u6301\u7eed\u4ea4\u4ed8\uff08Continuous Delivery\uff0cCD\uff09\u548c\u6301\u7eed\u90e8\u7f72\u3002</p> <p>\u4f5c\u4e3a\u4e00\u4e2a\u9762\u5411\u5f00\u53d1\u548c\u8fd0\u8425\u56e2\u961f\u7684\u89e3\u51b3\u65b9\u6848\uff0cCI/CD\u4e3b\u8981\u9488\u5bf9\u5728\u96c6\u6210\u65b0\u4ee3\u7801\u65f6\u6240\u5f15\u53d1\u7684\u95ee\u9898\uff08\u4e5f\u79f0\u201c\u96c6\u6210\u5730\u72f1\u201d\uff09\u3002</p> <p>\u5177\u4f53\u800c\u8a00\uff0cCI/CD\u5728\u6574\u4e2a\u5e94\u7528\u751f\u547d\u5468\u671f\u5185\uff08\u4ece\u96c6\u6210\u548c\u6d4b\u8bd5\u9636\u6bb5\u5230\u4ea4\u4ed8\u548c\u90e8\u7f72\uff09\u5f15\u5165\u4e86\u6301\u7eed\u81ea\u52a8\u5316\u548c\u6301\u7eed\u76d1\u63a7\uff0c\u8fd9\u4e9b\u5173\u8054\u7684\u4e8b\u52a1\u901a\u5e38\u88ab\u79f0\u4e3a\u201cCI/CD\u7ba1 \u9053\u201d\uff0c\u7531\u5f00\u53d1\u548c\u8fd0\u7ef4\u56e2\u961f\u4ee5\u654f\u6377\u65b9\u5f0f\u534f\u540c\u652f\u6301\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#11-\u6301\u7eed\u96c6\u6210ci","title":"1.1 \u6301\u7eed\u96c6\u6210(CI)","text":"<p>\u73b0\u4ee3\u5e94\u7528\u5f00\u53d1\u7684\u76ee\u6807\u662f\u8ba9\u591a\u4f4d\u5f00\u53d1\u4eba\u5458\u540c\u65f6\u5f00\u53d1\u540c\u4e00\u4e2a\u5e94\u7528\u7684\u4e0d\u540c\u529f\u80fd\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u4f01\u4e1a\u5b89\u6392\u5728\u4e00\u5929\u5185\u5c06\u6240\u6709\u5206\u652f\u6e90\u4ee3\u7801\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u6700\u7ec8\u53ef\u80fd\u5bfc\u81f4\u5de5\u4f5c\u70e6\u7410\u3001\u8017\u65f6\uff0c\u800c\u4e14\u9700\u8981\u624b\u52a8\u5b8c\u6210\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5f53\u4e00\u4f4d\u72ec\u7acb\u5de5\u4f5c\u7684\u5f00\u53d1\u4eba\u5458\u5bf9\u5e94\u7528\u8fdb\u884c\u66f4\u6539\u65f6\uff0c\u6709\u53ef\u80fd\u4f1a\u6709\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u540c\u65f6\u8fdb\u884c\u66f4\u6539\uff0c\u4ece\u800c\u5f15\u53d1 \u51b2\u7a81\u3002</p> <p>\u6301\u7eed\u96c6\u6210\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u66f4\u52a0\u9891\u7e41\u5730\u5c06\u4ee3\u7801\u66f4\u6539\u5408\u5e76\u5230\u5171\u4eab\u5206\u652f\u6216\u4e3b\u5e72\u4e2d\u3002\u4e00\u65e6\u5f00\u53d1\u4eba\u5458\u5bf9\u5e94\u7528\u6240\u505a\u7684\u66f4\u6539\u88ab\u5408\u5e76\uff0c\u7cfb\u7edf\u5c31\u4f1a\u901a\u8fc7\u81ea\u52a8\u6784\u5efa\u5e94\u7528 \u5e76\u8fd0\u884c\u4e0d\u540c\u7ea7\u522b\u7684\u81ea\u52a8\u5316\u6d4b\u8bd5\uff08\u901a\u5e38\u662f\u5355\u5143\u6d4b\u8bd5\u548c\u96c6\u6210\u6d4b\u8bd5\uff09\u6765\u9a8c\u8bc1\u8fd9\u4e9b\u66f4\u6539\uff0c\u786e\u4fdd\u66f4\u6539\u6ca1\u6709\u5bf9\u5e94\u7528\u9020\u6210\u7834\u574f\u3002</p> <p>\u8fd9\u610f\u5473\u7740\u6d4b\u8bd5\u5185\u5bb9\u6db5\u76d6\u4e86\u4ece\u7c7b\u548c\u51fd\u6570\u5230\u6784\u6210\u6574\u4e2a\u5e94\u7528\u7684\u4e0d\u540c\u6a21\u5757\uff0c\u5982\u679c\u81ea\u52a8\u5316\u6d4b\u8bd5\u53d1\u73b0\u65b0\u4ee3\u7801\u548c\u73b0\u6709\u4ee3\u7801\u4e4b\u95f4\u6709\u51b2\u7a81\uff0c\u6301\u7eed\u96c6\u6210\u53ef\u4ee5\u66f4\u52a0\u8f7b\u677e\u5feb\u901f\u5730\u4fee\u590d\u8fd9\u4e9b\u9519\u8bef\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#12-\u6301\u7eed\u4ea4\u4ed8cd","title":"1.2 \u6301\u7eed\u4ea4\u4ed8(CD)","text":"<p>\u5b8c\u6210\u6301\u7eed\u96c6\u6210\u4e2d\u6784\u5efa\u5355\u5143\u6d4b\u8bd5\u548c\u96c6\u6210\u6d4b\u8bd5\u7684\u81ea\u52a8\u5316\u6d41\u7a0b\u540e\uff0c\u901a\u8fc7\u6301\u7eed\u4ea4\u4ed8\u53ef\u4ee5\u81ea\u52a8\u5c06\u5df2\u9a8c\u8bc1\u7684\u4ee3\u7801\u53d1\u5e03\u5230\u5b58\u50a8\u5e93\u3002\u4e3a\u4e86\u5b9e\u73b0\u9ad8\u6548\u7684\u6301\u7eed\u4ea4\u4ed8\u6d41\u7a0b\uff0c \u52a1\u5fc5\u8981\u786e\u4fdd\u6301\u7eed\u4ea4\u4ed8\u5df2\u5185\u7f6e\u4e8e\u5f00\u53d1\u7ba1\u9053\u3002</p> <p>\u6301\u7eed\u4ea4\u4ed8\u7684\u76ee\u6807\u662f\u62e5\u6709\u4e00\u4e2a\u53ef\u968f\u65f6\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u7684\u4ee3\u7801\u5e93\u3002</p> <p>\u5728\u6301\u7eed\u4ea4\u4ed8\u4e2d\uff0c\u6bcf\u4e2a\u9636\u6bb5\uff08\u4ece\u4ee3\u7801\u66f4\u6539\u7684\u5408\u5e76\u5230\u751f\u4ea7\u5c31\u7eea\u578b\u6784\u5efa\u7248\u672c\u7684\u4ea4\u4ed8\uff09\u90fd\u6d89\u53ca\u6d4b\u8bd5\u81ea\u52a8\u5316\u548c\u4ee3\u7801\u53d1\u5e03\u81ea\u52a8\u5316\u3002\u5728\u6d41\u7a0b\u7ed3\u675f\u65f6\uff0c\u8fd0\u7ef4\u56e2\u961f\u53ef\u4ee5 \u5feb\u901f\u3001\u8f7b\u677e\u5730\u5c06\u5e94\u7528\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u4e2d\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#13-\u6301\u7eed\u90e8\u7f72cd","title":"1.3 \u6301\u7eed\u90e8\u7f72(CD)","text":"<p>\u5bf9\u4e8e\u4e00\u4e2a\u6210\u719f\u7684CI/CD\u7ba1\u9053\u6765\u8bf4\uff0c\u6700\u540e\u7684\u9636\u6bb5\u662f\u6301\u7eed\u90e8\u7f72\u3002</p> <p>\u4f5c\u4e3a\u6301\u7eed\u4ea4\u4ed8\uff08\u81ea\u52a8\u5c06\u751f\u4ea7\u5c31\u7eea\u578b\u6784\u5efa\u7248\u672c\u53d1\u5e03\u5230\u4ee3\u7801\u5b58\u50a8\u5e93\uff09\u7684\u5ef6\u4f38\uff0c\u6301\u7eed\u90e8\u7f72\u53ef\u4ee5\u81ea\u52a8\u5c06\u5e94\u7528\u53d1\u5e03\u5230\u751f\u4ea7\u73af\u5883\u4e2d\u3002</p> <p>\u7531\u4e8e\u751f\u4ea7\u4e4b\u524d\u7684\u7ba1\u9053\u9636\u6bb5\u6ca1\u6709\u624b\u52a8\u95e8\u63a7\uff0c\u56e0\u6b64\u6301\u7eed\u90e8\u7f72\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u90fd\u5f97\u4f9d\u8d56\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u6d4b\u8bd5\u81ea\u52a8\u5316\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6301\u7eed\u90e8\u7f72\u610f\u5473\u7740\u5f00\u53d1\u4eba\u5458\u5bf9\u5e94\u7528\u7684\u66f4\u6539\u5728\u7f16\u5199\u540e\u7684\u51e0\u5206\u949f\u5185\u5c31\u80fd\u751f\u6548\uff0c\u8fd9\u66f4\u52a0\u4fbf\u4e8e\u6301\u7eed\u63a5\u6536\u548c\u6574\u5408\u7528\u6237\u53cd\u9988\u3002</p> <p>\u603b\u800c\u8a00\u4e4b\uff0c\u6240\u6709\u8fd9\u4e9bCI/CD\u7684\u5173\u8054\u6b65\u9aa4\u90fd\u6709\u52a9\u4e8e\u964d\u4f4e\u5e94\u7528\u7684\u90e8\u7f72\u98ce\u9669\uff0c\u56e0\u6b64\u66f4\u4fbf\u4e8e\u4ee5\u5c0f\u4ef6\u7684\u65b9\u5f0f\uff08\u975e\u4e00\u6b21\u6027\uff09\u53d1\u5e03\u5bf9\u5e94\u7528\u7684\u66f4\u6539\u3002</p> <p>\u4e0d\u8fc7\uff0c\u7531\u4e8e\u8fd8\u9700\u8981\u7f16\u5199\u81ea\u52a8\u5316\u6d4b\u8bd5\u4ee5\u9002\u5e94CI/CD\u7ba1\u9053\u4e2d\u7684\u5404\u79cd\u6d4b\u8bd5\u548c\u53d1\u5e03\u9636\u6bb5\uff0c\u56e0\u6b64\u524d\u671f\u6295\u8d44\u4f1a\u5f88\u5927\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#14-ci\u548ccd\u7684\u533a\u522b","title":"1.4 CI\u548cCD\u7684\u533a\u522b","text":"<p>CI/CD\u4e2d\u7684CI\u5373\u6301\u7eed\u96c6\u6210\uff0c\u5b83\u5c5e\u4e8e\u5f00\u53d1\u4eba\u5458\u7684\u81ea\u52a8\u5316\u6d41\u7a0b\u3002</p> <p>\u6210\u529f\u7684CI\u610f\u5473\u7740\u5e94\u7528\u4ee3\u7801\u7684\u6700\u65b0\u66f4\u6539\u4f1a\u5b9a\u671f\u6784\u5efa\u3001\u6d4b\u8bd5\u5e76\u5408\u5e76\u5230\u5171\u4eab\u5b58\u50a8\u4e2d\u3002</p> <p>\u8be5\u89e3\u51b3\u65b9\u6848\u53ef\u4ee5\u89e3\u51b3\u5728\u4e00\u6b21\u5f00\u53d1\u4e2d\u6709\u592a\u591a\u5e94\u7528\u5206\u652f\uff0c\u4ece\u800c\u5bfc\u81f4\u76f8\u4e92\u51b2\u7a81\u7684\u95ee\u9898\u3002</p> <p>CI/CD\u4e2d\u7684CD\u6307\u7684\u662f\u6301\u7eed\u4ea4\u4ed8\u6216\u6301\u7eed\u90e8\u7f72\uff0c\u8fd9\u4e9b\u76f8\u5173\u6982\u5ff5\u6709\u65f6\u4f1a\u4ea4\u53c9\u4f7f\u7528\u3002</p> <p>\u4e24\u8005\u90fd\u4e8b\u5173\u7ba1\u9053\u540e\u7eed\u9636\u6bb5\u7684\u81ea\u52a8\u5316\uff0c\u4f46\u5b83\u4eec\u6709\u65f6\u4e5f\u4f1a\u5355\u72ec\u4f7f\u7528\uff0c\u7528\u4e8e\u8bf4\u660e\u81ea\u52a8\u5316\u7a0b\u5ea6\u3002</p> <p>\u6301\u7eed\u4ea4\u4ed8\u901a\u5e38\u662f\u6307\u5f00\u53d1\u4eba\u5458\u5bf9\u5e94\u7528\u7684\u66f4\u6539\u4f1a\u81ea\u52a8\u8fdb\u884c\u9519\u8bef\u6d4b\u8bd5\u5e76\u4e0a\u4f20\u5230\u5b58\u50a8\u5e93\uff08\u5982GitLab\u6216\u5bb9\u5668\u6ce8\u518c\u8868\uff09\uff0c\u7136\u540e\u7531\u8fd0\u7ef4\u56e2\u961f\u5c06\u5176\u90e8\u7f72\u5230\u5b9e\u65f6\u751f\u4ea7\u73af \u5883\u4e2d\uff0c\u65e8\u5728\u89e3\u51b3\u5f00\u53d1\u548c\u8fd0\u7ef4\u56e2\u961f\u4e4b\u95f4\u53ef\u89c1\u6027\u53ca\u6c9f\u901a\u8f83\u5dee\u7684\u95ee\u9898\uff0c\u56e0\u6b64\u6301\u7eed\u4ea4\u4ed8\u7684\u76ee\u7684\u5c31\u662f\u786e\u4fdd\u5c3d\u53ef\u80fd\u51cf\u5c11\u90e8\u7f72\u65b0\u4ee3\u7801\u65f6\u6240\u9700\u7684\u5de5\u4f5c\u91cf\u3002</p> <p>\u6301\u7eed\u90e8\u7f72\u6307\u7684\u662f\u81ea\u52a8\u5c06\u5f00\u53d1\u4eba\u5458\u7684\u66f4\u6539\u4ece\u4ee3\u7801\u5e93\u53d1\u5e03\u5230\u751f\u4ea7\u73af\u5883\u4e2d\u4ee5\u4f9b\u5ba2\u6237\u4f7f\u7528\uff0c\u5b83\u4e3b\u8981\u4e3a\u89e3\u51b3\u56e0\u624b\u52a8\u6d41\u7a0b\u964d\u4f4e\u5e94\u7528\u4ea4\u4ed8\u901f\u5ea6\uff0c\u4ece\u800c\u4f7f\u8fd0\u7ef4\u56e2\u961f\u8d85 \u8d1f\u8377\u7684\u95ee\u9898\u3002</p> <p>\u6301\u7eed\u90e8\u7f72\u4ee5\u6301\u7eed\u4ea4\u4ed8\u7684\u4f18\u52bf\u4e3a\u6839\u57fa\uff0c\u5b9e\u73b0\u4e86\u7ba1\u9053\u540e\u7eed\u9636\u6bb5\u7684\u81ea\u52a8\u5316\u3002</p> <p>CI/CD\u65e2\u53ef\u80fd\u4ec5\u6307\u6301\u7eed\u96c6\u6210\u548c\u6301\u7eed\u4ea4\u4ed8\u6784\u6210\u7684\u5173\u8054\u73af\u8282\uff0c\u4e5f\u53ef\u4ee5\u6307\u6301\u7eed\u96c6\u6210\u3001\u6301\u7eed\u4ea4\u4ed8\u548c\u6301\u7eed\u90e8\u7f72\u8fd93\u4e2a\u65b9\u9762\u6784\u6210\u7684\u5173\u8054\u73af\u8282\u3002</p> <p>\u66f4\u4e3a\u590d\u6742\u7684\u662f\u6709\u65f6\u6301\u7eed\u4ea4\u4ed8\u4e5f\u5305\u542b\u6301\u7eed\u90e8\u7f72\u6d41\u7a0b\u3002</p> <p>\u7ea0\u7f20\u4e8e\u8fd9\u4e9b\u8bed\u4e49\u5176\u5b9e\u6ca1\u6709\u5fc5\u8981\uff0c\u53ea\u9700\u8bb0\u5f97CI/CD\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u6d41\u7a0b\uff08\u901a\u5e38\u8868\u8ff0\u4e3a\u7ba1\u9053\uff09\uff0c\u7528\u4e8e\u5728\u66f4\u5927\u7a0b\u5ea6\u4e0a\u5b9e\u73b0\u5e94\u7528\u5f00\u53d1\u7684\u6301\u7eed\u81ea\u52a8\u5316\u548c\u6301\u7eed\u76d1\u63a7\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-jenkins\u6d41\u6c34\u7ebf\u4ecb\u7ecd","title":"2. Jenkins\u6d41\u6c34\u7ebf\u4ecb\u7ecd","text":"<p>\u63d0\u5230CI\u5de5\u5177\uff0c\u9996\u5148\u60f3\u5230\u7684\u5c31\u662f\u201cCI\u754c\u201d\u7684\u5927\u4f6c\u2014\u2014Jenkins\uff0c\u867d\u7136\u5728\u4e91\u539f\u751f\u7206\u53d1\u7684\u5e74\u4ee3\uff0c\u8e66\u51fa\u6765\u4e86\u5f88\u591a\u4e91\u539f\u751f\u7684CI\u5de5\u5177\uff0c\u4f46\u662f\u90fd\u4e0d\u8db3\u4ee5\u64bc\u52a8Jenkins\u7684 \u5730\u4f4d\u3002</p> <p>\u5728\u4f01\u4e1a\u4e2d\u5bf9\u4e8e\u6301\u7eed\u96c6\u6210\u3001\u6301\u7eed\u90e8\u7f72\u7684\u9700\u6c42\u975e\u5e38\u591a\uff0c\u5e76\u4e14\u4e5f\u4f1a\u7ecf\u5e38\u6709\u4e00\u4e9b\u6bd4\u8f83\u590d\u6742\u7684\u9700\u6c42\uff0c\u6b64\u65f6\u65b0\u751f\u7684CI\u5de5\u5177\u4e0d\u8db3\u4ee5\u652f\u6491\u8fd9\u4e9b\u5f88\u590d\u6742\u7684\u9700\u6c42\u3002</p> <p>\u4f46\u662fJenkins\u4e30\u5bcc\u7684\u63d2\u4ef6\u57fa\u672c\u4e0a\u53ef\u4ee5\u6ee1\u8db3\u4efb\u4f55\u573a\u666f\uff0c\u6240\u4ee5\u672c\u4e66\u7684CI/CD\u8fd8\u662f\u56f4\u7ed5Jenkins\u8fdb\u884c\u8bb2\u89e3\u3002</p> <p>\u9650\u4e8e\u7bc7\u5e45\uff0c\u672c\u4e66\u5e76\u4e0d\u6253\u7b97\u4ece\u57fa\u7840\u7684\u6982\u5ff5\u8bb2\u8d77\uff0c\u800c\u662f\u8bb2\u89e3Jenkins\u6700\u4f73\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662fJenkins Pipeline\uff08Jenkins\u6d41\u6c34\u7ebf\uff09\u7684\u4f7f\u7528\u3002</p> <p>\u9996\u5148\u4ecb\u7ecd\u6d41\u6c34\u7ebf\u7684\u6982\u5ff5\u548c\u7c7b\u578b\uff0c\u5305\u62ecJenkins\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\uff08Declarative Pipeline\uff09\u548c\u811a\u672c\u5f0f\u6d41\u6c34\u7ebf\uff08Scripted Pipeline\uff09\uff0c\u7136\u540e\u8bb2\u89e3\u6d41\u6c34\u7ebf\u7684\u57fa\u672c\u8bed\u6cd5\u548c\u4e00\u4e9b\u4f8b \u5b50\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#21-\u4ec0\u4e48\u662f\u6d41\u6c34\u7ebf","title":"2.1 \u4ec0\u4e48\u662f\u6d41\u6c34\u7ebf","text":"<p>Jenkins\u6d41\u6c34\u7ebf\u662f\u4e00\u5957\u63d2\u4ef6\uff0c\u5b83\u652f\u6301\u5728Jenkins\u4e2d\u5b9e\u73b0\u548c\u96c6\u6210\u6301\u7eed\u4ea4\u4ed8\u6d41\u6c34\u7ebf\uff08Continuous Delivery Pipeline\uff09\u3002</p> <p>\u6d41\u6c34\u7ebf\u63d0\u4f9b\u4e86\u4e00\u7ec4\u53ef\u6269\u5c55\u7684\u5de5\u5177\uff0c\u7528\u4e8e\u901a\u8fc7Pipeline DSL\u5c06\u7b80\u5355\u5230\u590d\u6742\u7684\u4ea4\u4ed8\u6d41\u6c34\u7ebf\u4ee5\u4ee3\u7801\u7684\u5f62\u52bf\u5c55\u73b0\uff0c\u7c7b\u4f3c\u4e8e\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u3002</p> <p>\u6301\u7eed\u4ea4\u4ed8\u6d41\u6c34\u7ebf\u4f1a\u7ecf\u5386\u4e00\u4e2a\u590d\u6742\u7684\u8fc7\u7a0b\uff1a</p> <p>\u4ece\u7248\u672c\u63a7\u5236\u3001\u5411\u7528\u6237\u548c\u5ba2\u6237\u63d0\u4ea4\u8f6f\u4ef6\u3001\u8f6f\u4ef6\u7684\u6bcf\u6b21\u53d8\u66f4\uff08\u63d0\u4ea4\u4ee3\u7801\u5230\u4ed3\u5e93\uff09\u5230\u8f6f\u4ef6\u53d1\u5e03\uff08Release\uff09\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u5305\u62ec\u4ee5\u4e00\u79cd\u53ef\u9760\u5e76\u53ef\u91cd\u590d\u7684\u65b9\u5f0f\u6784\u5efa\u8f6f\u4ef6\uff0c\u4ee5\u53ca\u901a\u8fc7\u591a\u4e2a\u6d4b\u8bd5\u548c\u90e8\u7f72\u9636\u6bb5\u6765\u5f00\u53d1\u6784\u5efa\u597d\u7684\u8f6f\u4ef6\uff08\u79f0\u4e3aBuild\uff09\u3002</p> <p>Jenkins\u6d41\u6c34\u7ebf\u7684\u5b9a\u4e49\u88ab\u5199\u5728\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\u4e2d\uff08\u4e00\u822c\u4e3aJenkinsfile\uff09\uff0c\u8be5\u6587\u4ef6\u201c\u5b9a\u5236\u201d\u4e86\u6574\u4e2a\u6784\u5efa\u8f6f\u4ef6\u7684\u8fc7\u7a0b\u3002Jenkinsfile\u4e5f\u53ef\u4ee5\u88ab\u63d0\u4ea4\u5230\u9879\u76ee\u7684 \u4ee3\u7801\u4ed3\u5e93\u4e2d\uff0c\u5728Jenkins\u4e2d\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\u3002\u5c06\u6301\u7eed\u4ea4\u4ed8\u6d41\u6c34\u7ebf\u4f5c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u7684\u4e00\u90e8\u5206\uff0c\u50cf\u5176\u4ed6\u4ee3\u7801\u4e00\u6837\u8fdb\u884c\u7248\u672c\u5316\u548c\u5ba1\u67e5\uff0c\u8fd9\u662f\u6d41\u6c34\u7ebf\u5373\u4ee3\u7801\u7684\u57fa\u7840\u3002</p> <p>\u521b\u5efaJenkinsfile\u5e76\u63d0\u4ea4\u5230\u4ee3\u7801\u4ed3\u5e93\u4e2d\u7684\u597d\u5904\u5982\u4e0b\uff1a</p> <ul> <li>\u81ea\u52a8\u4e3a\u6240\u6709\u5206\u652f\u521b\u5efa\u6d41\u6c34\u7ebf\u6784\u5efa\u8fc7\u7a0b\u3002</li> <li>\u5728\u6d41\u6c34\u7ebf\u4e0a\u8fdb\u884c\u4ee3\u7801\u590d\u67e5/\u8fed\u4ee3\u3002</li> <li>\u5bf9\u6d41\u6c34\u7ebf\u8fdb\u884c\u5ba1\u8ba1\u8ddf\u8e2a\u3002</li> <li>\u6d41\u6c34\u7ebf\u7684\u4ee3\u7801\u53ef\u4ee5\u88ab\u9879\u76ee\u7684\u591a\u4e2a\u6210\u5458\u67e5\u770b\u548c\u7f16\u8f91\u3002</li> <li>\u53ef\u4ee5\u5bf9Jenkinsfile\u8fdb\u884c\u7248\u672c\u63a7\u5236\u3002</li> </ul> <p>Jenkins\u6d41\u6c34\u7ebf\u4e3b\u8981\u5206\u4e3a\u58f0\u660e\u5f0f\u548c\u811a\u672c\u5f0f\u4e24\u79cd\uff0c\u5305\u542bpipeline\uff08\u6d41\u6c34\u7ebf\uff09\u3001node\uff08\u8282\u70b9\uff09\u3001stage\uff08\u9636\u6bb5\uff09\u3001step\uff08\u6b65\u9aa4\uff09\u7b49\u533a\u5757\u3002</p> <p>\uff081\uff09pipeline pipeline\u662f\u7528\u6237\u5b9a\u4e49\u7684\u4e00\u4e2a\u6301\u7eed\u4ea4\u4ed8\uff08CD\uff09\u6d41\u6c34\u7ebf\u6a21\u578b\u3002\u6d41\u6c34\u7ebf\u7684\u4ee3\u7801\u5b9a\u4e49\u4e86\u6574\u4e2a\u6784\u5efa\u8fc7\u7a0b\uff0c\u5305\u62ec\u6784\u5efa\u3001\u6d4b\u8bd5\u548c\u4ea4\u4ed8\u5e94\u7528\u7a0b\u5e8f\u7684\u9636\u6bb5\u3002\u53e6\u5916\uff0c pipeline\u5757\u662f\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u8bed\u6cd5\u7684\u5173\u952e\u90e8\u5206\u3002</p> <p>\uff082\uff09node node\u662f\u4e00\u4e2a\u673a\u5668\uff0c\u5b83\u662fJenkins\u73af\u5883\u7684\u4e00\u90e8\u5206\uff0c\u53e6\u5916\uff0cnode\u5757\u662f\u811a\u672c\u5316\u6d41\u6c34\u7ebf\u8bed\u6cd5\u7684\u5173\u952e\u90e8\u5206\u3002</p> <p>\uff083\uff09stage stage\u5757\u5b9a\u4e49\u4e86\u5728\u6574\u4e2a\u6d41\u6c34\u7ebf\u7684\u6267\u884c\u4efb\u52a1\u4e2d\u6982\u5ff5\u4e0d\u540c\u7684\u5b50\u96c6\uff08\u6bd4\u5982Build\u3001Test\u3001Deploy\u9636\u6bb5\uff09\uff0c\u5b83\u88ab\u8bb8\u591a\u63d2\u4ef6\u7528\u4e8e\u53ef\u89c6\u5316Jenkins\u6d41\u6c34\u7ebf\u5f53\u524d \u7684\u72b6\u6001/\u8fdb\u5c55\u3002</p> <p>\uff084\uff09step \u672c\u8d28\u4e0a\u662f\u6307\u901a\u8fc7\u4e00\u4e2a\u5355\u4e00\u7684\u4efb\u52a1\u544a\u8bc9Jenkins\u5728\u7279\u5b9a\u7684\u65f6\u95f4\u70b9\u9700\u8981\u505a\u4ec0\u4e48\uff0c\u6bd4\u5982\u8981\u6267\u884cshell\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u7528<code>sh SHELL_COMMAND</code>\u3002</p> <p>\u4ece\u4e0a\u6587\u53ef\u4ee5\u4e86\u89e3\uff0cJenkins\u6d41\u6c34\u7ebf\u5206\u4e3a\u811a\u672c\u5f0f\u548c\u58f0\u660e\u5f0f\uff0c\u800c\u58f0\u660e\u5f0f\u662f\u201c\u65b0\u4e00\u4ee3\u201d\u7684\u6d41\u6c34\u7ebf\uff0c\u6bd4\u811a\u672c\u5f0f\u66f4\u52a0\u7075\u6d3b\uff0c\u53ef\u8bfb\u6027\u66f4\u5f3a\uff0c\u5e76\u4e14\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u652f\u6301 \u4ee5\u56fe\u5f62\u5316\u7684\u65b9\u5f0f\u8fdb\u884c\u7f16\u8f91\uff0c\u6240\u4ee5\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u662f\u7740\u91cd\u5b66\u4e60\u7684\u5bf9\u8c61\u3002</p> <p>\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u548c\u811a\u672c\u5f0f\u6d41\u6c34\u7ebf\u7684\u8bed\u6cd5\u533a\u522b\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#22-\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf","title":"2.2 \u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf","text":"<p>\u5728\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u8bed\u6cd5\u4e2d\uff0c\u6d41\u6c34\u7ebf\u8fc7\u7a0b\u5b9a\u4e49\u5728pipeline{}\u4e2d\uff0cpipeline\u5757\u5b9a\u4e49\u4e86\u6574\u4e2a\u6d41\u6c34\u7ebf\u4e2d\u5b8c\u6210\u7684\u6240\u6709\u5de5\u4f5c\uff0c\u6bd4\u5982\uff1a</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n    stages {\n      stage('Build') {\n        steps {\n          echo 'Build'\n        }\n      }\n      stage('Test') {\n        steps {\n          echo 'Test'\n        }\n      }\n      stage('Deploy') {\n        steps {\n          echo 'Deploy'\n      }\n    }\n  }\n}\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>agent any\uff1a\u5728\u4efb\u4f55\u53ef\u7528\u7684\u4ee3\u7406\u4e0a\u6267\u884c\u6d41\u6c34\u7ebf\u6216\u5b83\u7684\u4efb\u4f55\u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u6267\u884c\u6d41\u6c34\u7ebf\u8fc7\u7a0b\u7684\u4f4d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5230\u5177\u4f53\u7684\u8282\u70b9\u3002</li> <li>stage\uff1a\u5b9a\u4e49\u6d41\u6c34\u7ebf\u7684\u6267\u884c\u8fc7\u7a0b\uff08\u76f8\u5f53\u4e8e\u4e00\u4e2a\u9636\u6bb5\uff09\uff0c\u6bd4\u5982\u4e0a\u6587\u6240\u793a\u7684Build\u3001Test\u3001Deploy\uff0c\u4f46\u662f\u8fd9\u4e2a\u540d\u5b57\u662f\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5b9a\u4e49\u7684\uff0c\u5e76   \u975e\u56fa\u5b9a\u7684\u540d\u5b57\u3002</li> <li>steps\uff1a\u6267\u884c\u67d0\u9636\u6bb5\u5177\u4f53\u7684\u6b65\u9aa4\u3002</li> </ul> <p>\u4e00\u4e2a\u4ee5\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u8bed\u6cd5\u7f16\u5199\u7684Jenkinsfile\u6587\u4ef6\u5982\u4e0b\uff1a</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n    stages {\n      stage('Build') {\n        steps {\n          sh 'make'\n        }\n      }\n      stage('Test') {\n        steps {\n          sh 'make check'\n          junit 'reports/**/*.xml'\n        }\n      }\n      stage('Deploy') {\n        steps {\n          sh 'make publish'\n      }\n    }\n  }\n}\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>pipeline\uff1a\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u4e00\u79cd\u7279\u5b9a\u8bed\u6cd5\uff0c\u5b9a\u4e49\u4e86\u5305\u542b\u6267\u884c\u6574\u4e2a\u6d41\u6c34\u7ebf\u7684\u6240\u6709\u5185\u5bb9\u548c\u6307\u4ee4\uff0c\u4e5f\u662f\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u5f00\u59cb\u3002</li> <li>agent\uff1a\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u4e00\u79cd\u7279\u5b9a\u8bed\u6cd5\uff0c\u6307\u793aJenkins\u4e3a\u6574\u4e2a\u6d41\u6c34\u7ebf\u5206\u914d\u4e00\u4e2a\u6267\u884c\u5668\u548c\u5de5\u4f5c\u533a\uff0c\u4e5f\u5c31\u662f\u5728\u6d41\u6c34\u7ebf\u4e2d\u7684\u6b65\u9aa4\u5728\u54ea\u4e2aagent\u4e0a   \u6267\u884c\uff0c\u8be5\u53c2\u6570\u540c\u6837\u53ef\u4ee5\u5728stage\u4e2d\u914d\u7f6e\u3002</li> <li>stage\uff1a\u63cf\u8ff0\u6d41\u6c34\u7ebf\u9636\u6bb5\u7684\u8bed\u6cd5\u5757\uff0c\u5728\u811a\u672c\u5f0f\u6d41\u6c34\u7ebf\u8bed\u6cd5\u4e2d\uff0cstage\u5757\u662f\u53ef\u9009\u7684\u3002</li> <li>steps\uff1a\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u4e00\u79cd\u7279\u5b9a\u8bed\u6cd5\uff0c\u5b83\u63cf\u8ff0\u4e86\u5728\u8fd9\u4e2astage\u4e2d\u8981\u8fd0\u884c\u7684\u6b65\u9aa4\u3002</li> <li>sh\uff1a\u6267\u884c\u4e00\u4e2ashell\u547d\u4ee4\u3002</li> <li>junit\uff1a\u7528\u4e8e\u805a\u5408\u6d4b\u8bd5\u62a5\u544a\u3002</li> </ul>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#23-\u811a\u672c\u5316\u6d41\u6c34\u7ebf","title":"2.3 \u811a\u672c\u5316\u6d41\u6c34\u7ebf","text":"<p>\u5728\u811a\u672c\u5316\u6d41\u6c34\u7ebf\u7684\u8bed\u6cd5\u4e2d\uff0c\u4f1a\u6709\u4e00\u4e2a\u6216\u591a\u4e2anode\u5757\u5728\u6574\u4e2a\u6d41\u6c34\u7ebf\u4e2d\u6267\u884c\u6838\u5fc3\u5de5\u4f5c\uff0c\u6bd4\u5982\uff1a</p> <pre><code>//Jenkinsfile (Scripted Pipeline)\nnode {\n  stage('Build') {\n    echo 'Build'\n  }\n  stage('Test') {\n    echo 'Test'\n  }\n  stage('Deploy') {\n    echo 'Deploy'\n  }\n}\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>node\uff1a\u5728\u4efb\u4f55\u53ef\u7528\u7684\u4ee3\u7406\u4e0a\u6267\u884c\u6d41\u6c34\u7ebf\u6216\u5b83\u7684\u4efb\u4f55\u9636\u6bb5\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5230\u5177\u4f53\u7684\u8282\u70b9\u3002</li> <li>stage\uff1a\u548c\u58f0\u660e\u5f0f\u7684\u542b\u4e49\u4e00\u81f4\uff0c\u5b9a\u4e49\u6d41\u6c34\u7ebf\u7684\u9636\u6bb5\u3002stage\u5757\u5728\u811a\u672c\u5316\u6d41\u6c34\u7ebf\u8bed\u6cd5\u4e2d\u662f\u53ef\u9009\u7684\uff0c\u7136\u800c\u5728\u811a\u672c\u5316\u6d41\u6c34\u7ebf\u4e2d\u5b9e\u73b0stage\u5757\uff0c\u53ef   \u4ee5\u6e05\u695a\u5730\u5728Jenkins UI\u754c\u9762\u4e2d\u663e\u793a\u6bcf\u4e2astage\u7684\u4efb\u52a1\u5b50\u96c6\u3002</li> </ul> <p>\u4e0a\u4e00\u5c0f\u8282\u7684\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u4e5f\u53ef\u4ee5\u7528\u4ee5\u4e0b\u811a\u672c\u5f0f\u6d41\u6c34\u7ebf\u4ee3\u66ff\uff1a</p> <pre><code>//Jenkinsfile (Scripted Pipeline)\nnode {\n  stage('Build') {\n    sh 'make'\n  }\n  stage('Test') {\n     sh 'make check'\n     junit 'reports/**/*.xml'\n  }\n  stage('Deploy') {\n      sh 'make publish'\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#3-\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u8bed\u6cd5","title":"3. \u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u8bed\u6cd5","text":"<p>\u524d\u6587\u63d0\u5230\uff0c\u58f0\u660e\u5f0f\u662fJenkins\u65b0\u4e00\u4ee3\u7684\u6d41\u6c34\u7ebf\u7f16\u5199\u65b9\u5f0f\uff0c\u800c\u4e14\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u652f\u6301\u7c7b\u4f3cBlue Ocean\u8fd9\u7c7b\u7684\u56fe\u5f62\u5316\u5de5\u5177\u8fdb\u884c\u5728\u7ebf\u7f16\u8f91\uff0c\u56e0\u6b64\u672c\u4e66\u4e3b\u8981\u8bb2\u89e3 \u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u5199\u6cd5\u3002</p> <p>\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u5728\u6d41\u6c34\u7ebf\u5b50\u7cfb\u7edf\u4e4b\u4e0a\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u7b80\u5355\u3001\u66f4\u5bb9\u6613\u7406\u89e3\u7684\u8bed\u6cd5\u3002</p> <p>\u4e4b\u524d\u4e5f\u63d0\u5230\u8fc7\uff0c\u6240\u6709\u6709\u6548\u7684\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u5fc5\u987b\u5305\u542b\u5728\u4e00\u4e2apipeline\u5757\u4e2d\uff0c\u6bd4\u5982\u4ee5\u4e0b\u662f\u4e00\u4e2apipeline\u5757\u7684\u683c\u5f0f\uff1a</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n/* insert Declarative Pipeline here */\n}\n</code></pre> <p>\u5728\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u4e2d\uff0c\u6709\u6548\u7684\u57fa\u672c\u8bed\u53e5\u548c\u8868\u8fbe\u5f0f\u9075\u5faa\u4e0eGroovy\u7684\u8bed\u6cd5\u540c\u6837\u7684\u89c4\u5219\uff0c\u4f46\u6709\u4ee5\u4e0b\u4f8b\u5916\uff1a</p> <ul> <li>\u6d41\u6c34\u7ebf\u9876\u5c42\u5fc5\u987b\u662f\u4e00\u4e2a block\uff0c\u5373 <code>pipeline{}</code></li> <li>\u5206\u9694\u7b26\u53ef\u4ee5\u4e0d\u9700\u8981\u5206\u53f7\uff0c\u4f46\u662f\u6bcf\u6761\u8bed\u53e5\u90fd\u5fc5\u987b\u5728\u81ea\u5df1\u7684\u884c\u4e0a</li> <li>\u5757\u53ea\u80fd\u7531 Sections\u3001Directives\u3001Steps \u6216 assignment statements\u7ec4\u6210</li> <li>\u5c5e\u6027\u5f15\u7528\u8bed\u53e5\u88ab\u5f53\u505a\u662f\u65e0\u53c2\u6570\u7684\u65b9\u6cd5\u8c03\u7528\uff0c\u6bd4\u5982 input \u4f1a\u88ab\u5f53\u505ainput()\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\u5b66\u4e60\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u7684\u57fa\u672c\u8bed\u6cd5\uff0c\u5305\u62ecsections\u3001directives\u533a\u5757\u53caparallel\u5b57\u6bb5\u7684\u7528\u6cd5\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#31-sections","title":"3.1 Sections","text":"<p>\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u4e2d\u7684 Sections \u4e0d\u662f\u4e00\u4e2a\u5173\u952e\u5b57\u6216\u6307\u4ee4\uff0c\u800c\u662f\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a Agent\u3001Stages\u3001 post\u3001Directives \u548c Steps \u7684\u4ee3\u7801\u533a\u57df\u5757\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-agent","title":"1. agent","text":"<p>agent\u8868\u793a\u6574\u4e2a\u6d41\u6c34\u7ebf\u6216\u7279\u5b9a\u9636\u6bb5\u4e2d\u7684\u6b65\u9aa4\u548c\u547d\u4ee4\u6267\u884c\u7684\u4f4d\u7f6e\uff0c\u8be5\u90e8\u5206\u5fc5\u987b\u5728pipeline\u5757\u7684\u9876\u5c42\u88ab\u5b9a\u4e49\uff0c\u4e5f\u53ef\u4ee5\u5728stage\u4e2d\u518d\u6b21\u5b9a\u4e49\uff0c\u4f46\u662fstage\u7ea7\u522b \u662f\u53ef\u9009\u7684\u3002</p> <p>\uff081\uff09agent\u7684\u914d\u7f6e\u51fd\u6570 \u4e3a\u4e86\u652f\u6301\u53ef\u80fd\u6709\u7684\u5404\u79cd\u5404\u6837\u7684\u6d41\u6c34\u7ebf\uff0cagent\u652f\u6301\u4e00\u4e9b\u4e0d\u540c\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u8fd9\u4e9b\u53c2\u6570\u5e94\u7528\u5728pipeline\u5757\u7684\u9876\u5c42\uff0c\u6216stage\u6307\u4ee4\u5185\u90e8\u3002agent\u53ef\u9009\u914d\u7f6e\u5982 \u4e0b\uff1a</p> <ul> <li>any\uff1a\u5728\u4efb\u4f55\u53ef\u7528\u7684\u4ee3\u7406\u4e0a\u6267\u884c\u6d41\u6c34\u7ebf\uff0c\u914d\u7f6e\u8bed\u6cd5\uff1a</li> </ul> <pre><code>pipeline {\n  agent any\n}\n</code></pre> <ul> <li>none\uff1a\u8868\u793a\u8be5pipeline\u811a\u672c\u6ca1\u6709\u5168\u5c40\u7684agent\u914d\u7f6e\u3002\u5f53\u9876\u5c42\u7684agent\u914d\u7f6e\u4e3anone\u65f6\uff0c\u6bcf\u4e2astage\u90e8\u5206\u90fd\u9700\u8981\u5305\u542b\u5b83\u81ea\u5df1\u7684agent\u3002\u914d\u7f6e\u8bed\u6cd5\uff1a</li> </ul> <pre><code>pipeline {\n  agent none\n  stages {\n    stage('Stage For Build'){\n      agent any\n    }\n  }\n}\n</code></pre> <ul> <li>label: \u4ee5\u8282\u70b9\u6807\u7b7e\u5f62\u5f0f\u9009\u62e9\u67d0\u4e2a\u5177\u4f53\u7684\u8282\u70b9\u6267\u884c Pipeline \u547d\u4ee4\uff0c\u4f8b\u5982\uff1aagent { label 'my-defined-label' }\u3002\u8282\u70b9\u9700\u8981\u63d0\u524d\u914d\u7f6e\u6807\u7b7e\u3002</li> </ul> <pre><code>pipeline {\n  agent none\n    stages {\n      stage('Stage For Build'){\n        agent { label 'role-master' }\n        steps {\n          echo \"role-master\"\n        }\n      }\n    }\n}\n</code></pre> <ul> <li>node: \u548c label \u914d\u7f6e\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u662f\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u914d\u7f6e\uff0c\u6bd4\u5982 customWorkspace(\u8bbe\u7f6e\u9ed8\u8ba4\u5de5\u4f5c\u76ee\u5f55)</li> </ul> <pre><code>pipeline {\n  agent none\n    stages {\n      stage('Stage For Build'){\n        agent {\n          node {\n            label 'role-master'\n            customWorkspace \"/tmp/zhangzhuo/data\"\n          }\n        }\n        steps {\n          sh \"echo role-master &gt; 1.txt\"\n        }\n      }\n    }\n}\n</code></pre> <ul> <li>dockerfile\uff1a\u4f7f\u7528\u4ece\u6e90\u7801\u4e2d\u5305\u542b\u7684Dockerfile\u6240\u6784\u5efa\u7684\u5bb9\u5668\u6267\u884c\u6d41\u6c34\u7ebf\u6216stage\u3002\u4e3a\u4e86\u4f7f\u7528\u8be5\u9009\u9879\uff0cJenkinsfile\u5fc5\u987b\u4ece\u591a\u4e2a\u5206\u652f\u6d41\u6c34\u7ebf\u4e2d\u52a0\u8f7d\uff0c\u6216\u8005\u4ecepipeline from SCM\uff08\u540e\u9762\u7684\u7ae0\u8282\u4f1a\u6d89\u53ca\uff09\u52a0\u8f7d\u3002</li> </ul> <p>\u5982\u679c\u914d\u7f6e\u7684\u8bed\u6cd5\u4e3aagent {dockerfile true}\uff0c\u90a3\u4e48\u5c06\u4ece\u6e90\u7801\u7684\u6839\u76ee\u5f55\u4e0b\u4f7f\u7528Dockerfile\u6587\u4ef6\u8fdb\u884c\u6784\u5efa\u3002</p> <p>\u5982\u679cDockerfile\u6587\u4ef6\u5728\u5176\u4ed6\u76ee\u5f55\uff0c\u5219\u9700\u8981\u4f7f\u7528dir\u5b57\u6bb5\u66f4\u6539Dockerfile\u6240\u5728\u7684\u76ee\u5f55\uff0c\u914d\u7f6e\u65b9\u6cd5\u4e3aagent { dockerfile { dir 'DockerfileDir'} }\u3002</p> <p>\u5982\u679c\u6784\u5efa\u955c\u50cf\u7684Dockerfile\u540d\u79f0\u4e0d\u662fDockerfile\uff0c\u53ef\u4ee5\u4f7f\u7528filename\u9009\u9879\u6307\u5b9aDockerfile\u6587\u4ef6\u540d\u3002</p> <p>\u540c\u65f6\u4e5f\u53ef\u4ee5\u4f7f\u7528additionalBuildArgs\u53c2\u6570\u4f20\u9012\u6784\u5efa\u955c\u50cf\u7684\u53c2\u6570\uff0c\u6bd4\u5982agent{dockerfile{ additionalBuildArgs '--build-arg version=1.0.2' } }\u3002</p> <p>\u5047\u5982\u6709\u4e00\u4e2a\u9879\u76ee\u9700\u8981\u4f7f\u7528Dockerfile\u7c7b\u578b\u7684agent\uff0c\u5e76\u4e14Dockerfile\u5728build\u76ee\u5f55\uff0c\u6587\u4ef6\u540d\u4e3aDockerfile.build\uff0c\u6784\u5efa\u65f6\u671f\u671b\u6709\u4e00\u4e2aversion\u7684\u53c2\u6570\u3002\u6b64\u65f6\u5bf9\u5e94\u7684   agent\u5199\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>  agent {\n     dockerfile {\n       filename 'Dockerfile.build'  //dockerfile\u6587\u4ef6\u540d\u79f0\n       dir 'build'                  //\u6267\u884c\u6784\u5efa\u955c\u50cf\u7684\u5de5\u4f5c\u76ee\u5f55\n       label 'role-master'          //\u6267\u884c\u7684node\u8282\u70b9\uff0c\u6807\u7b7e\u9009\u62e9\n       additionalBuildArgs '--build-arg version=1.0.2' //\u6784\u5efa\u53c2\u6570\n     }\n  }\n</code></pre> <ul> <li>docker\uff1a\u76f8\u5f53\u4e8edockerfile\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528docker\u5b57\u6bb5\u6307\u5b9a\u5916\u90e8\u955c\u50cf\uff0c\u53ef\u4ee5\u7701\u53bb\u6784\u5efa\u7684\u65f6\u95f4\u3002\u6bd4\u5982\u4f7f\u7528maven\u955c\u50cf\u8fdb\u884c\u6253\u5305\uff0c\u540c\u65f6\u53ef\u4ee5\u6307\u5b9aargs\uff1a</li> </ul> <pre><code>agent{\n  docker{\n    image '192.168.10.15/kubernetes/alpine:latest'   //\u955c\u50cf\u5730\u5740\n    label 'role-master' //\u6267\u884c\u7684\u8282\u70b9\uff0c\u6807\u7b7e\u9009\u62e9\n    args '-v /tmp:/tmp'      //\u542f\u52a8\u955c\u50cf\u7684\u53c2\u6570\n  }\n}\n</code></pre> <ul> <li>kubernetes\uff1aJenkins\u4e5f\u652f\u6301\u4f7f\u7528Kubernetes\u521b\u5efaSlave\uff0c\u4e5f\u5c31\u662f\u5e38\u8bf4\u7684\u52a8\u6001Slave\u3002</li> </ul> <p>\u9700\u8981\u90e8\u7f72 kubernetes \u76f8\u5173\u7684\u63d2\u4ef6\uff0c\u5b98\u65b9\u6587\u6863\uff1a</p> <p>https://github.com/jenkinsci/kubernetes-plugin/</p> <p>\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b;</p> <ul> <li>cloud: Configure Clouds \u7684\u540d\u79f0\uff0c\u6307\u5b9a\u5230\u5176\u4e2d\u4e00\u4e2ak8s</li> <li>slaveConnectTimeout: \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4</li> <li>yaml: pod \u5b9a\u4e49\u6587\u4ef6\uff0cjnlp \u5bb9\u5668\u7684\u914d\u7f6e\u5fc5\u987b\u6709\u914d\u7f6e\u65e0\u9700\u6539\u53d8\uff0c\u5176\u4f59containerd\u6839\u636e\u81ea\u5df1\u60c5\u51b5\u6307\u5b9a</li> <li>workspaceVolume\uff1a\u6301\u4e45\u5316 jenkins \u7684\u5de5\u4f5c\u76ee\u5f55\u3002<ul> <li>persistentVolumeClaimWorkspaceVolume\uff1a\u6302\u8f7d\u5df2\u6709pvc\u3002</li> </ul> </li> </ul> <pre><code>workspaceVolume persistentVolumeClaimWorkspaceVolume(claimName: \"jenkins-agent\", mountPath: \"/\", readOnly: \"false\")\n</code></pre> <ul> <li>nfsWorkspaceVolume\uff1a\u6302\u8f7d nfs \u670d\u52a1\u5668\u76ee\u5f55</li> </ul> <pre><code>workspaceVolume nfsWorkspaceVolume(serverAddress: \"192.168.10.254\", serverPath: \"/nfs\", readOnly: \"false\")\n</code></pre> <ul> <li>dynamicPVC\uff1a\u52a8\u6001\u7533\u8bf7 pvc\uff0c\u4efb\u52a1\u6267\u884c\u7ed3\u675f\u540e\u5220\u9664</li> </ul> <pre><code>workspaceVolume dynamicPVC(storageClassName: \"nfs-client\", requestsSize: \"1Gi\", accessModes: \"ReadWriteMany\")\n</code></pre> <ul> <li>emptyDirWorkspaceVolume\uff1a\u4e34\u65f6\u76ee\u5f55\uff0c\u4efb\u52a1\u6267\u884c\u7ed3\u675f\u540e\u4f1a\u968f\u7740 pod \u5220\u9664\u88ab\u5220\u9664\uff0c\u4e3b\u8981\u529f\u80fd\u591a\u4e2a\u4efb\u52a1 container \u5171\u4eab jenkins \u5de5\u4f5c\u76ee\u5f55\u3002</li> </ul> <pre><code>workspaceVolume emptyDirWorkspaceVolume()\n</code></pre> <ul> <li>hostPathWorkspaceVolume\uff1a\u6302\u8f7d node \u8282\u70b9\u672c\u673a\u76ee\u5f55\uff0c\u6ce8\u610f\u6302\u8f7d\u672c\u673a\u76ee\u5f55\u6ce8\u610f\u6743\u9650\u95ee\u9898\uff0c\u53ef\u4ee5\u5148\u521b\u5efa\u8bbe\u7f6e 777 \u6743\u9650\uff0c\u5426\u5219\u9ed8\u8ba4 kubelet \u521b\u5efa\u7684\u76ee\u5f55\u6743\u9650\u4e3a 755 \u9ed8\u8ba4\u5176\u4ed6\u7528\u6237\u6ca1\u6709\u5199\u6743\u9650\uff0c\u6267\u884c\u6d41\u6c34\u7ebf\u4f1a\u62a5\u9519\u3002</li> </ul> <pre><code>workspaceVolume hostPathWorkspaceVolume(hostPath: \"/opt/workspace\", readOnly: false)\n</code></pre> <p>\u793a\u4f8b</p> <pre><code>agent {\n  kubernetes {\n      cloud 'kubernetes'\n      slaveConnectTimeout 1200\n      workspaceVolume emptyDirWorkspaceVolume()\n      yaml '''\nkind: Pod\nmetadata:\n  name: jenkins-agent\nspec:\n  containers:\n  - args: [\\'$(JENKINS_SECRET)\\', \\'$(JENKINS_NAME)\\']\n    image: '192.168.10.15/kubernetes/jnlp:alpine'\n    name: jnlp\n    imagePullPolicy: IfNotPresent\n  - command:\n      - \"cat\"\n    image: \"192.168.10.15/kubernetes/alpine:latest\"\n    imagePullPolicy: \"IfNotPresent\"\n    name: \"date\"\n    tty: true\n  restartPolicy: Never\n'''\n  }\n}\n</code></pre> <p>\uff082\uff09agent\u7684\u5e38\u89c1\u9009\u9879</p> <ul> <li> <p>label\uff1a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u6807\u7b7e\u7528\u4e8e\u8fd0\u884c\u6d41\u6c34\u7ebf\u7684\u4f4d\u7f6e\u3002\u8be5\u9009\u9879\u5bf9node\u3001docker\u548cdockerfile\u53ef\u7528\uff0cnode\u5fc5\u987b\u9009\u62e9\u8be5\u9009\u9879</p> </li> <li> <p>customWorkspace\uff1a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u7528\u4e8e\u81ea\u5b9a\u4e49\u5de5\u4f5c\u533a\u8fd0\u884c\u6d41\u6c34\u7ebf\u6216stage\u3002\u5b83\u53ef\u4ee5\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u8be5\u9009\u9879\u5bf9node\u3001   docker\u548cdockerfile\u53ef\u7528\u3002\u6bd4\u5982\uff1a</p> </li> </ul> <pre><code>agent {\n  node {\n      label 'my-defied-label'\n      customWorkspace 'some/other/path'\n  }\n}\n</code></pre> <ul> <li>reuseNode\uff1a\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u9ed8\u8ba4\u4e3afalse\u3002\u5982\u679c\u662ftrue\uff0c\u5219\u5728\u540c\u4e00\u4e2a\u5de5\u4f5c\u76ee\u5f55\u6267\u884c\u6d41\u6c34\u7ebf\u3002</li> </ul> <p>\u8fd9\u4e2a\u9009\u9879\u5bf9docker\u548cdockerfile\u6709\u7528\uff0c\u5e76\u4e14\u53ea\u6709\u4f7f\u7528\u5728\u4e2a\u522bstage\u7684agent\u4e0a\u624d\u4f1a\u6709\u6548\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\u4f7f\u7528docker   \u4f5c\u4e3aagent\u65f6\u4f1a\u5f00\u542f\u6b64\u53c2\u6570\uff1a</p> <pre><code>agent {\n  docker {\n      image 'maven:3-alpine'\n      label 'my-defined-label'\n      args '-v /tmp:/tmp'\n      reuseNode true\n  }\n}\n</code></pre> <p>\uff083\uff09agent\u7684\u914d\u7f6e\u793a\u4f8b</p> <ul> <li>\u793a\u4f8b1\uff1a\u5047\u8bbe\u6709\u4e00\u4e2aJava\u9879\u76ee\uff0c\u9700\u8981\u7528mvn\u547d\u4ee4\u8fdb\u884c\u7f16\u8bd1\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528maven\u7684\u955c\u50cf\u4f5c\u4e3aagent\u3002\u914d\u7f6e\u5982\u4e0b\uff1a</li> </ul> <pre><code>pipeline {\n  agent { docker 'maven:3-alpine' }\n  stages {\n    stage('Example Build') {\n      steps {\n        echo 'Hello, Maven'\n        sh 'mvn -B clean verify'\n      }\n    }\n  }\n}\n</code></pre> <ul> <li>\u793a\u4f8b2\uff1a\u672c\u793a\u4f8b\u5728\u6d41\u6c34\u7ebf\u9876\u5c42\u5c06agent\u5b9a\u4e49\u4e3anone\uff0c\u90a3\u4e48\u6b64\u65f6stage\u90e8\u5206\u5c31\u5fc5\u987b\u5305\u542b\u5b83\u81ea\u5df1\u7684agent\u90e8\u5206\u3002</li> </ul> <p>\u5728stage('Example Build')\u90e8\u5206\u4f7f\u7528maven:3-alpine\u6267\u884c\u8be5\u9636\u6bb5\u7684\u6b65\u9aa4\uff0c\u5728stage('Example Test')\u90e8\u5206\u4f7f\u7528openjdk:8-jre\u6267\u884c\u8be5\u9636\u6bb5\u7684\u6b65\u9aa4\u3002\u6b64\u65f6Pipeline\u5982\u4e0b\uff1a</p> <pre><code>pipeline {\n  agent none\n  stages {\n    stage('Example Build') {\n      agent { docker 'maven:3-alpine' }\n      steps {\n        echo 'Hello, Maven'\n        sh 'mvn --version'\n      }\n    }\n    stage('Example Test') {\n      agent { docker 'openjdk:8-jre' }\n      steps {\n        echo 'Hello, JDK'\n        sh 'java -version'\n      }\n    }\n  }\n} \n</code></pre> <ul> <li>kubernetes \u793a\u4f8b</li> </ul> <pre><code>pipeline {\n  agent {\n    kubernetes {\n      cloud 'kubernetes'\n      slaveConnectTimeout 1200\n      workspaceVolume emptyDirWorkspaceVolume()\n      yaml '''\nkind: Pod\nmetadata:\n  name: jenkins-agent\nspec:\n  containers:\n  - args: [\\'$(JENKINS_SECRET)\\', \\'$(JENKINS_NAME)\\']\n    image: '192.168.10.15/kubernetes/jnlp:alpine'\n    name: jnlp\n    imagePullPolicy: IfNotPresent\n  - command:\n      - \"cat\"\n    image: \"192.168.10.15/kubernetes/alpine:latest\"\n    imagePullPolicy: \"IfNotPresent\"\n    name: \"date\"\n    tty: true\n  - command:\n      - \"cat\"\n    image: \"192.168.10.15/kubernetes/kubectl:apline\"\n    imagePullPolicy: \"IfNotPresent\"\n    name: \"kubectl\"\n    tty: true\n  restartPolicy: Never\n'''\n    }\n  }\n  environment {\n    MY_KUBECONFIG = credentials('kubernetes-cluster')\n  }\n  stages {\n    stage('Data') {\n      steps {\n        container(name: 'date') {\n          sh \"\"\"\n            date\n          \"\"\"\n        }\n      }\n    }\n    stage('echo') {\n      steps {\n        container(name: 'date') {\n          sh \"\"\"\n            echo 'k8s is pod'\n          \"\"\"\n        }\n      }\n    }\n    stage('kubectl') {\n      steps {\n        container(name: 'kubectl') {\n          sh \"\"\"\n            kubectl get pod -A  --kubeconfig $MY_KUBECONFIG\n          \"\"\"\n        }\n      }\n    }\n  }\n  }\n</code></pre> <p>Jenkins\u7684pipeline\u5b9e\u8df5\u4e4bGitSCM\u53c2\u6570\u914d\u7f6e\u9879\u8be6\u89e3</p> <p>https://cloud.tencent.com/developer/article/2017111</p> <p>\u8d85\u65f6\u8bbe\u7f6e\u4e0e\u90e8\u7f72\u53c2\u6570switch\u8bed\u53e5\u9009\u62e9</p> <pre><code>timeout(time: 1, unit: 'MINUTES') {\n  script {\n    env.deploy_option = input message: '\u9009\u62e9\u64cd\u4f5c', ok: 'deploy',\n    parameters: [choice(name: 'deploy_option', choices: ['deploy', 'rollback', 'redeploy'], description: '\u9009\u62e9\u90e8\u7f72\u73af\u5883')]\n    switch(\"${env.deploy_option}\"){\n        case 'deploy':\n            println('1.deploy prd env')\n            break;\n        case 'rollback':\n            println('2.rollback env')\n            break;\n        case 'redeploy':\n            println('3.redeploy env')\n            break;\n        default:\n            println('error env')\n    }\n  }\n}\n</code></pre> <p>docker\u7684\u793a\u4f8b <pre><code>pipeline {\n  agent none \n  stages {\n    stage('Example Build') {\n      agent { docker 'maven:3-alpine' } \n      steps {\n        echo 'Hello, Maven'\n        sh 'mvn --version'\n      }\n    }\n    stage('Example Test') {\n      agent { docker 'openjdk:8-jre' } \n      steps {\n        echo 'Hello, JDK'\n        sh 'java -version'\n      }\n    }\n  }\n}\n</code></pre></p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-post","title":"2. Post","text":"<p>post \u4e00\u822c\u7528\u4e8e\u6d41\u6c34\u7ebf\u7ed3\u675f\u540e\u7684\u8fdb\u4e00\u6b65\u5904\u7406\uff0c\u6bd4\u5982\u9519\u8bef\u901a\u77e5\u7b49\u3002</p> <p>post\u53ef\u4ee5\u9488\u5bf9\u6d41\u6c34\u7ebf\u4e0d\u540c\u7684\u7ed3\u679c\u505a\u51fa\u4e0d\u540c\u7684\u5904\u7406\uff0c\u5c31\u50cf\u5f00\u53d1\u7a0b\u5e8f\u7684\u9519\u8bef\u5904\u7406\uff0c\u6bd4\u5982Python\u8bed\u8a00\u7684try catch\u3002post\u53ef\u4ee5\u5b9a\u4e49\u5728Pipeline\u6216stage\u4e2d\uff0c\u76ee\u524d\u652f\u6301\u4ee5\u4e0bpost-condition\uff1a</p> <ol> <li>always\uff1a\u65e0\u8bba Pipeline \u6216 stage \u7684\u5b8c\u6210\u72b6\u6001\u5982\u4f55\uff0c\u90fd\u5141\u8bb8\u8fd0\u884c\u8be5 post \u4e2d\u5b9a\u4e49\u7684\u6307\u4ee4\uff1b</li> <li>changed\uff1a\u53ea\u6709\u5f53\u524d Pipeline \u6216 stage \u7684\u5b8c\u6210\u72b6\u6001\u4e0e\u5b83\u4e4b\u524d\u7684\u8fd0\u884c\u4e0d\u540c\u65f6\uff0c\u624d\u5141\u8bb8\u5728\u8be5 post \u90e8\u5206\u8fd0\u884c\u8be5\u6b65\u9aa4\uff1b</li> <li>fixed\uff1a\u5f53\u672c\u6b21 Pipeline \u6216 stage \u6210\u529f\uff0c\u4e14\u4e0a\u4e00\u6b21\u6784\u5efa\u662f\u5931\u8d25\u6216\u4e0d\u7a33\u5b9a\u65f6\uff0c\u5141\u8bb8\u8fd0\u884c\u8be5 post \u4e2d\u5b9a\u4e49\u7684\u6307\u4ee4\uff1b</li> <li>regression\uff1a\u5f53\u672c\u6b21 Pipeline \u6216 stage \u7684\u72b6\u6001\u4e3a\u5931\u8d25\u3001\u4e0d\u7a33\u5b9a\u6216\u7ec8\u6b62\uff0c\u4e14\u4e0a\u4e00\u6b21\u6784\u5efa\u7684 \u72b6\u6001\u4e3a\u6210\u529f\u65f6\uff0c\u5141\u8bb8\u8fd0\u884c\u8be5 post \u4e2d\u5b9a\u4e49\u7684\u6307\u4ee4\uff1b</li> <li>failure\uff1a\u53ea\u6709\u5f53\u524d Pipeline \u6216 stage \u7684\u5b8c\u6210\u72b6\u6001\u4e3a\u5931\u8d25\uff08failure\uff09\uff0c\u624d\u5141\u8bb8\u5728 post \u90e8\u5206\u8fd0\u884c\u8be5\u6b65\u9aa4\uff0c\u901a\u5e38\u8fd9\u65f6\u5728 Web \u754c\u9762\u4e2d\u663e\u793a\u4e3a\u7ea2\u8272</li> <li>success\uff1a\u5f53\u524d\u72b6\u6001\u4e3a\u6210\u529f\uff08success\uff09\uff0c\u6267\u884c post \u6b65\u9aa4\uff0c\u901a\u5e38\u5728 Web \u754c\u9762\u4e2d\u663e\u793a\u4e3a\u84dd\u8272 \u6216\u7eff\u8272</li> <li>unstable\uff1a\u5f53\u524d\u72b6\u6001\u4e3a\u4e0d\u7a33\u5b9a\uff08unstable\uff09\uff0c\u6267\u884c post \u6b65\u9aa4\uff0c\u901a\u5e38\u7531\u4e8e\u6d4b\u8bd5\u5931\u8d25\u6216\u4ee3\u7801 \u8fdd\u89c4\u7b49\u9020\u6210\uff0c\u5728 Web \u754c\u9762\u4e2d\u663e\u793a\u4e3a\u9ec4\u8272</li> <li>aborted\uff1a\u5f53\u524d\u72b6\u6001\u4e3a\u7ec8\u6b62\uff08aborted\uff09\uff0c\u6267\u884c\u8be5 post \u6b65\u9aa4\uff0c\u901a\u5e38\u7531\u4e8e\u6d41\u6c34\u7ebf\u88ab\u624b\u52a8\u7ec8\u6b62\u89e6\u53d1\uff0c\u8fd9\u65f6\u5728 Web \u754c\u9762\u4e2d\u663e\u793a\u4e3a\u7070\u8272\uff1b</li> <li>unsuccessful\uff1a\u5f53\u524d\u72b6\u6001\u4e0d\u662f success \u65f6\uff0c\u6267\u884c\u8be5 post \u6b65\u9aa4\uff1b</li> <li>cleanup\uff1a\u65e0\u8bba pipeline \u6216 stage \u7684\u5b8c\u6210\u72b6\u6001\u5982\u4f55\uff0c\u90fd\u5141\u8bb8\u8fd0\u884c\u8be5 post \u4e2d\u5b9a\u4e49\u7684\u6307\u4ee4\u3002\u548c always \u7684\u533a\u522b\u5728\u4e8e\uff0ccleanup \u4f1a\u5728\u5176\u5b83\u6267\u884c\u4e4b\u540e\u6267\u884c\u3002</li> </ol> <pre><code>pipeline {\n\n  .....\n\n  post {\n    always{\n      script{ println(\"\u6d41\u6c34\u7ebf\u7ed3\u675f\u540e\uff0c\u7ecf\u5e38\u8981\u505a\u7684\u4e8b\u60c5\") }\n    }\n\n    success{\n      script{ println(\"\u6d41\u6c34\u7ebf\u6210\u529f\u540e\uff0c\u8981\u505a\u7684\u4e8b\u60c5\") }\n    }\n\n    failure{\n      script{ println(\"\u6d41\u6c34\u7ebf\u5931\u8d25\u540e\uff0c\u8981\u505a\u7684\u4e8b\u60c5\") }\n    }\n\n    failure{\n      script{ println(\"\u6d41\u6c34\u7ebf\u53d6\u6d88\u540e\uff0c\u8981\u505a\u7684\u4e8b\u60c5\") }\n    }\n  }\n}\n</code></pre> <p>\u793a\u4f8b</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b post \u90e8\u5206\u653e\u5728\u6d41\u6c34\u7ebf\u7684\u5e95\u90e8\uff0c\u6bd4\u5982\u672c\u5b9e\u4f8b\uff0c\u65e0\u8bba stage \u7684\u5b8c\u6210\u72b6\u6001\u5982\u4f55\uff0c\u90fd\u4f1a\u8f93\u51fa\u4e00\u6761 I will always say Hello again!\u4fe1\u606f</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  stages {\n    stage('Example1') {\n      steps {\n        echo 'Hello World1'\n      }\n    }\n    stage('Example2') {\n      steps {\n        echo 'Hello World2'\n      }\n    }\n  }\n  post {\n    always {\n      echo 'I will always say Hello again!'\n    }\n  }\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5c06 post \u5199\u5728 stage\uff0c\u4e0b\u9762\u793a\u4f8b\u8868\u793a Example1 \u6267\u884c\u5931\u8d25\u6267\u884c post\u3002</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  stages {\n    stage('Example1') {\n      steps {\n        sh 'ip a'\n      }\n      post {\n        failure {\n          echo 'I will always say Hello again!'\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#3-stages","title":"3. stages","text":"<p>\u5728\u524d\u6587\u4e2d\uff0c\u5176\u5b9e\u5df2\u7ecf\u80fd\u770b\u5230\u4e00\u4e9b\u5bf9stages\u7684\u5b9a\u4e49\uff0cstages\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2astage\u6307\u4ee4\uff0c\u540c\u65f6\u53ef\u4ee5\u5728stage\u7684steps\u5757\u4e2d\u5b9a\u4e49\u771f\u6b63\u6267\u884c\u7684\u6307\u4ee4\u3002</p> <p>stages\u90e8\u5206\u662f\u6d41\u6c34\u7ebf\u63cf\u8ff0\u7684\u5927\u90e8\u5206\u5de5\u4f5c\uff08work\uff09\u7684\u4f4d\u7f6e\u3002\u5efa\u8baestages\u81f3\u5c11\u5305\u542b\u4e00\u4e2astage\u6307\u4ee4\uff0c\u7528\u4e8e\u6301\u7eed\u4ea4\u4ed8\u8fc7\u7a0b\u7684\u67d0\u4e2a\u79bb\u6563\u7684\u90e8\u5206\uff0c\u6bd4\u5982\u6784\u5efa\u3001\u6d4b\u8bd5\u6216\u90e8\u7f72\u3002</p> <p>\u6bd4\u5982\u521b\u5efa\u4e00\u4e2a\u6d41\u6c34\u7ebf\uff0cstages\u5305\u542b\u4e00\u4e2a\u540d\u4e3aExample\u7684stage\uff0c\u8be5stage\u6267\u884cecho 'Hello World'\u547d\u4ee4\u8f93\u51faHello World\u5b57\u7b26\u4e32\uff1a</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  stages {\n    stage('Example') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n  }\n}\n</code></pre> <p>steps\u90e8\u5206\u5728\u7ed9\u5b9a\u7684stage\u6307\u4ee4\u4e2d\u6267\u884c\u4e00\u4e2a\u6216\u591a\u4e2a\u6b65\u9aa4\uff0c\u6bd4\u5982\u5728steps\u4e2d\u5b9a\u4e49\u6267\u884c\u4e00\u6761shell\u547d\u4ee4\uff1a</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  stages {\n    stage('Example') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n  }\n}\n</code></pre> <p>\u6216\u8005\u4e5f\u53ef\u4ee5\u4f7f\u7528sh\u5b57\u6bb5\u6267\u884c\u591a\u6761\u6307\u4ee4\uff1a</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  stages {\n    stage('Example') {\n      steps {\n        sh \"\"\"\n           echo 'Hello World1'\n           echo 'Hello World2'\n        \"\"\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#32-directives","title":"3.2 directives","text":"<p>directives\u53ef\u7528\u4e8e\u4e00\u4e9b\u6267\u884cstage\u65f6\u7684\u6761\u4ef6\u5224\u65ad\u6216\u9884\u5904\u7406\u4e00\u4e9b\u6570\u636e\uff0c\u548csections\u4e00\u81f4\u3002directives\u4e0d\u662f\u4e00\u4e2a\u5173\u952e\u5b57\u6216\u6307\u4ee4\uff0c\u800c\u662f\u5305\u542benvironment\u3001options\u3001parameters\u3001triggers\u3001stage\u3001input\u3001when\u7b49\u914d\u7f6e\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-environment","title":"1. environment","text":"<p>environment\u4e3b\u8981\u7528\u4e8e\u5728\u6d41\u6c34\u7ebf\u4e2d\u914d\u7f6e\u4e00\u4e9b\u73af\u5883\u53d8\u91cf\uff0c\u6839\u636e\u914d\u7f6e\u7684\u4f4d\u7f6e\u51b3\u5b9a\u73af\u5883\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u3002</p> <p>environment\u53ef\u4ee5\u5b9a\u4e49\u5728pipeline\u4e2d\u4f5c\u4e3a\u5168\u5c40\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u914d\u7f6e\u5728stage\u4e2d\u4f5c\u4e3a\u8be5stage\u7684\u73af\u5883\u53d8\u91cf\u3002</p> <p>\u8be5\u6307\u4ee4\u652f\u6301\u4e00\u4e2a\u7279\u6b8a\u7684\u65b9\u6cd5credentials()\uff0c\u8be5\u65b9\u6cd5\u53ef\u7528\u4e8e\u5728Jenkins\u73af\u5883\u4e2d\u901a\u8fc7\u6807\u8bc6\u7b26\u8bbf\u95ee\u9884\u5b9a\u4e49\u7684\u51ed\u8bc1\u3002\u5bf9\u4e8e\u7c7b\u578b\u4e3aSecret Text\u7684\u51ed\u8bc1\uff0ccredentials()\u53ef\u4ee5\u5c06\u8be5Secret\u4e2d\u7684\u6587\u672c\u5185\u5bb9\u8d4b\u503c\u7ed9\u73af\u5883\u53d8\u91cf\u3002</p> <p>\u5bf9\u4e8e\u7c7b\u578b\u4e3a\u6807\u51c6\u7684\u8d26\u53f7\u5bc6\u7801\u578b\u7684\u51ed\u8bc1\uff0c\u6307\u5b9a\u7684\u73af\u5883\u53d8\u91cf\u4e3ausername\u548cpassword\uff0c\u5e76\u4e14\u4e5f\u4f1a\u5b9a\u4e49\u4e24\u4e2a\u989d\u5916\u7684\u73af\u5883\u53d8\u91cf\uff0c\u5206\u522b\u4e3aMYVARNAME_USR\u548cMYVARNAME_PSW\u3002</p> <p>\u57fa\u672c\u53d8\u91cf\u4f7f\u7528</p> <pre><code>//\u793a\u4f8b\npipeline {\n  agent any\n  environment {   //\u5168\u5c40\u53d8\u91cf\uff0c\u4f1a\u5728\u6240\u6709stage\u4e2d\u751f\u6548\n    NAME= 'zhangzhuo'\n  }\n  stages {\n    stage('env1') {\n      environment { //\u5b9a\u4e49\u5728stage\u4e2d\u7684\u53d8\u91cf\u53ea\u4f1a\u5728\u5f53\u524dstage\u751f\u6548\uff0c\u5176\u4ed6\u7684stage\u4e0d\u4f1a\u751f\u6548\n        HARBOR = 'https://192.168.10.15'\n      }\n      steps {\n        sh \"env\"\n      }\n    }\n    stage('env2') {\n      steps {\n        sh \"env\"\n      }\n    }\n  }\n}\n</code></pre> <p>\u4f7f\u7528\u53d8\u91cf\u5f15\u7528 secret \u7684\u51ed\u8bc1</p> <pre><code>//\u8fd9\u91cc\u4f7f\u7528k8s\u7684kubeconfig\u6587\u4ef6\u793a\u4f8b\npipeline {\n  agent any\n  environment {\n    KUBECONFIG = credentials('kubernetes-cluster')\n  }\n  stages {\n    stage('env') {\n      steps {\n        sh \"env\"  //\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8f93\u51fa\u7684\u53d8\u91cf\u5185\u5bb9\u4f1a\u88ab\u52a0\u5bc6\n      }\n    }\n  }\n}\n</code></pre> <p>\u4f7f\u7528\u53d8\u91cf\u5f15\u7528\u7c7b\u578b\u4e3a\u6807\u51c6\u7684\u8d26\u53f7\u5bc6\u7801\u578b\u7684\u51ed\u8bc1</p> <p>\u8fd9\u91cc\u4f7f\u7528 HARBOR \u53d8\u91cf\u8fdb\u884c\u6f14\u793a\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8d26\u53f7\u5bc6\u7801\u578b\u7684\u51ed\u8bc1\u4f1a\u81ea\u52a8\u521b\u5efa 3 \u4e2a\u53d8\u91cf</p> <ul> <li>HARBOR_USR:\u4f1a\u628a\u51ed\u8bc1\u4e2d username \u503c\u8d4b\u503c\u7ed9\u8fd9\u4e2a\u53d8\u91cf</li> <li>HARBOR_PSW:\u4f1a\u628a\u51ed\u8bc1\u4e2d password \u503c\u8d4b\u503c\u7ed9\u8fd9\u4e2a\u53d8\u91cf</li> <li>HARBOR:\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8d4b\u503c\u7684\u503c\u4e3a<code>usernamme:password</code></li> </ul> <pre><code>pipeline {\n  agent any\n  environment {\n    HARBOR = credentials('harbor-account')\n  }\n  stages {\n    stage('env') {\n      steps {\n        sh \"env\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-options","title":"2. options","text":"<p>Jenkins \u6d41\u6c34\u7ebf\u652f\u6301\u5f88\u591a\u5185\u7f6e\u6307\u4ee4\uff0c\u6bd4\u5982 retry \u53ef\u4ee5\u5bf9\u5931\u8d25\u7684\u6b65\u9aa4\u8fdb\u884c\u91cd\u590d\u6267\u884c n \u6b21\uff0c\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u6307\u4ee4\u5b9e\u73b0\u4e0d\u540c\u7684\u6548\u679c\u3002\u6bd4\u8f83\u5e38\u7528\u7684\u6307\u4ee4\u5982\u4e0b:</p> <ul> <li> <p>buildDiscarder\uff1a\u4fdd\u7559\u591a\u5c11\u4e2a\u6d41\u6c34\u7ebf\u7684\u6784\u5efa\u8bb0\u5f55\uff0c\u6bd4\u5982<code>options { buildDiscarder(logRotator(numToKeepStr: '1')) }</code>\u3002</p> </li> <li> <p>disableConcurrentBuilds\uff1a\u7981\u6b62\u6d41\u6c34\u7ebf\u5e76\u884c\u6267\u884c\uff0c\u9632\u6b62\u5e76\u884c\u6d41\u6c34\u7ebf\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u5bfc\u81f4\u6d41\u6c34\u7ebf\u5931 \u8d25,\u6bd4\u5982<code>options { disableConcurrentBuilds() }</code>\u3002</p> </li> <li> <p>disableResume \uff1a\u5982\u679c\u63a7\u5236\u5668\u91cd\u542f\uff0c\u7981\u6b62\u6d41\u6c34\u7ebf\u81ea\u52a8\u6062\u590d\u3002\u6bd4\u5982<code>options { disableResume() }</code>\u3002</p> </li> <li> <p>newContainerPerStage\uff1aagent \u4e3a docker \u6216 dockerfile \u65f6\uff0c\u6bcf\u4e2a\u9636\u6bb5\u5c06\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u7684\u65b0\u5bb9\u5668\u4e2d\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u6240\u6709\u7684\u9636\u6bb5\u90fd\u5728\u540c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u8fd0\u884c\u3002\u6bd4\u5982<code>options { newContainerPerStage () }</code>\u3002</p> </li> <li> <p>quietPeriod\uff1a\u6d41\u6c34\u7ebf\u9759\u9ed8\u671f\uff0c\u4e5f\u5c31\u662f\u89e6\u53d1\u6d41\u6c34\u7ebf\u540e\u7b49\u5f85\u4e00\u4f1a\u5728\u6267\u884c\u3002\u6bd4\u5982<code>options{ quietPeriod(30) }</code>\u3002</p> </li> <li> <p>retry\uff1a\u6d41\u6c34\u7ebf\u5931\u8d25\u540e\u91cd\u8bd5\u6b21\u6570\uff0c\u6bd4\u5982<code>options { retry(3) }</code>\u3002</p> </li> <li> <p>timeout\uff1a\u8bbe\u7f6e\u6d41\u6c34\u7ebf\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u8d85\u8fc7\u6d41\u6c34\u7ebf\u65f6\u95f4\uff0cjob \u4f1a\u81ea\u52a8\u7ec8\u6b62\u3002\u5982\u679c\u4e0d\u52a0 unit \u53c2\u6570\u9ed8\u8ba4\u4e3a 1 \u5206,\u6bd4\u5982<code>options{ timeout(time: 1, unit: 'HOURS') }</code>\u3002</p> </li> <li> <p>skipDefaultCheckout\uff1a\u8df3\u8fc7checkout scm\u8bed\u53e5\uff0c\u6bd4\u5982<code>options { skipDefaultCheckout () }</code>\u3002</p> </li> <li> <p>timestamps\uff1a\u4e3a\u63a7\u5236\u53f0\u8f93\u51fa\u65f6\u95f4\u6233, \u6bd4\u5982<code>options { timestamps() }</code>\u3002</p> </li> <li> <p>checkoutToSubdirectory \u6307\u5b9a\u4ee3\u7801\u68c0\u51fa\u5230 <code>$WORKSPACE</code>\u7684\u5b50\u76ee\u5f55\u3002</p> </li> </ul> <pre><code>  options {\n        checkoutToSubdirectory('testdir')\n  }\n</code></pre> <p>\u5e38\u7528\u6c47\u603b\uff1a</p> <pre><code>options {\n        timestamps()\n        disableConcurrentBuilds()\n        timeout(time: 10, unit: 'MINUTES')\n        buildDiscarder(logRotator(numToKeepStr: '10'))\n}\n</code></pre> <p>\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b\uff0c\u53ea\u9700\u8981\u6dfb\u52a0options\u5b57\u6bb5\u5373\u53ef\uff1a</p> <p>\u5b9a\u4e49\u5728 pipeline \u4e2d</p> <pre><code>pipeline {\n  agent any\n  options {\n    timeout(time: 1, unit: 'HOURS')  //\u8d85\u65f6\u65f6\u95f41\u5c0f\u65f6\uff0c\u5982\u679c\u4e0d\u52a0unit\u53c2\u6570\u9ed8\u8ba4\u4e3a1\u5206\n    timestamps()                     //\u6240\u6709\u8f93\u51fa\u6bcf\u884c\u90fd\u4f1a\u6253\u5370\u65f6\u95f4\u6233\n    buildDiscarder(logRotator(numToKeepStr: '3')) //\u4fdd\u7559\u4e09\u4e2a\u5386\u53f2\u6784\u5efa\u7248\u672c\n    quietPeriod(10)  //\u9759\u9ed810s\n    retry(3)    //\u6d41\u6c34\u7ebf\u5931\u8d25\u540e\u91cd\u8bd5\u6b21\u6570\n  }\n  stages {\n    stage('env1') {\n      options {\n        timeout(time: 5, unit: 'MINUTES')\n        retry(3)\n        timestamps()\n      }\n      steps {\n        sh \"env\"\n        sleep 2\n      }\n    }\n    stage('env2') {\n      steps {\n        sh \"env\"\n      }\n    }\n  }\n}\n</code></pre> <p>\u5b9a\u4e49\u5728 stage \u4e2d</p> <p>Option \u9664\u4e86\u5199\u5728 Pipeline \u9876\u5c42\uff0c\u8fd8\u53ef\u4ee5\u5199\u5728 stage \u4e2d\uff0c\u4f46\u662f\u5199\u5728 stage \u4e2d\u7684 option \u4ec5\u652f\u6301 retry\u3001 timeout\u3001timestamps\uff0c\u6216\u8005\u662f\u548c stage \u76f8\u5173\u7684\u58f0\u660e\u5f0f\u9009\u9879\uff0c\u6bd4\u5982 skipDefaultCheckout\u3002\u5904\u4e8e stage \u7ea7\u522b\u7684 options \u5199\u6cd5\u5982\u4e0b</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('env1') {\n      options {   //\u5b9a\u4e49\u5728\u8fd9\u91cc\u8fd9\u5bf9\u8fd9\u4e2astage\u751f\u6548\n        timeout(time: 2, unit: 'SECONDS') //\u8d85\u65f6\u65f6\u95f42\u79d2\n        timestamps()                     //\u6240\u6709\u8f93\u51fa\u6bcf\u884c\u90fd\u4f1a\u6253\u5370\u65f6\u95f4\u6233\n        retry(3)    //\u6d41\u6c34\u7ebf\u5931\u8d25\u540e\u91cd\u8bd5\u6b21\u6570\n      }\n      steps {\n        sh \"env &amp;&amp; sleep 2\"\n      }\n    }\n    stage('env2') {\n      steps {\n        sh \"env\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#3-parameters","title":"3. parameters","text":"<p>parameters\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u6237\u5728\u89e6\u53d1\u6d41\u6c34\u7ebf\u65f6\u5e94\u8be5\u63d0\u4f9b\u7684\u53c2\u6570\u5217\u8868\uff0c\u8fd9\u4e9b\u7528\u6237\u6307\u5b9a\u53c2\u6570\u7684\u503c\u53ef\u4ee5\u901a\u8fc7params\u5bf9\u8c61\u63d0\u4f9b\u7ed9\u6d41\u6c34\u7ebf\u7684step\uff08\u6b65\u9aa4\uff09\u3002</p> <p>\u76ee\u524d\u652f\u6301\u7684\u53c2\u6570\u7c7b\u578b\u5982\u4e0b\uff1a</p> <ul> <li>string\uff1a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u53c2\u6570\u3002</li> </ul> <pre><code>parameters { string(name:'DEPLOY_ENV', defaultValue:'staging', description: '') }\n\n// \u8868\u793a\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3aDEPLOY_ENV\u7684\u5b57\u7b26\u578b\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3astaging\u3002\n</code></pre> <ul> <li>text\uff1a\u6587\u672c\u578b\u53c2\u6570\uff0c\u4e00\u822c\u7528\u4e8e\u5b9a\u4e49\u591a\u884c\u6587\u672c\u5185\u5bb9\u7684\u53d8\u91cf\u3002</li> </ul> <pre><code>parameters {text(name:'DEPLOY_TEXT', defaultValue:'One\\nTwo\\nThree\\n',\ndescription: '')}\n\n// \u8868\u793a\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3aDEPLOY_TEXT\u7684\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u662f'One\\nTwo\\nThree\\n'\n</code></pre> <ul> <li>booleanParam\uff1a\u5e03\u5c14\u578b\u53c2\u6570\u3002</li> </ul> <pre><code>parameters {booleanParam(name:  'DEBUG_BUILD',defaultValue:  true,description: '')}\n</code></pre> <ul> <li>choice\uff1a\u9009\u62e9\u578b\u53c2\u6570\uff0c\u4e00\u822c\u7528\u4e8e\u7ed9\u5b9a\u51e0\u4e2a\u53ef\u9009\u7684\u503c\uff0c\u7136\u540e\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u8fdb\u884c\u8d4b\u503c\u3002</li> </ul> <pre><code>parameters { choice(name: 'CHOICES',choices: ['one', 'two', 'three'], description: '') }\n\n// \u8868\u793a\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3aCHOICES\u7684\u53d8\u91cf\uff0c\u53ef\u9009\u7684\u503c\u4e3aone\u3001two\u3001three\u3002\n</code></pre> <ul> <li>password\uff1a\u5bc6\u7801\u578b\u53d8\u91cf\uff0c\u4e00\u822c\u7528\u4e8e\u5b9a\u4e49\u654f\u611f\u578b\u53d8\u91cf\uff0c\u5728 Jenkins \u63a7\u5236\u53f0\u4f1a\u8f93\u51fa\u4e3a*\u3002</li> </ul> <pre><code>parameters { password(name: 'PASSWORD',defaultValue: 'SECRET', description: 'A secret password')}\n\n// \u8868\u793a\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3aPASSWORD\u7684\u53d8\u91cf\uff0c\u5176\u9ed8\u8ba4\u503c\u4e3aSECRE?\u3002\n</code></pre> <p>\u63d2\u4ef6 Parameters</p> <ul> <li>imageTag\uff1a\u955c\u50cf tag\uff0c\u9700\u8981\u5b89\u88c5 Image Tag Parameter \u63d2\u4ef6\u540e\u4f7f\u7528</li> <li>gitParameter\uff1a\u83b7\u53d6 git \u4ed3\u5e93\u5206\u652f\uff0c\u9700\u8981 Git Parameter \u63d2\u4ef6\u540e\u4f7f\u7528</li> </ul> <p>\u793a\u4f8b</p> <pre><code>pipeline {\n  agent any\n  parameters {\n    string(name: 'DEPLOY_ENV', defaultValue:  'staging', description: '1')   //\u6267\u884c\u6784\u5efa\u65f6\u9700\u8981\u624b\u52a8\u914d\u7f6e\u5b57\u7b26\u4e32\u7c7b\u578b\u53c2\u6570\uff0c\u4e4b\u540e\u8d4b\u503c\u7ed9\u53d8\u91cf\n    text(name:  'DEPLOY_TEXT', defaultValue: 'One\\nTwo\\nThree\\n', description: '2')  //\u6267\u884c\u6784\u5efa\u65f6\u9700\u8981\u63d0\u4f9b\u6587\u672c\u53c2\u6570\uff0c\u4e4b\u540e\u8d4b\u503c\u7ed9\u53d8\u91cf\n    booleanParam(name: 'DEBUG_BUILD',  defaultValue: true, description: '3')   //\u5e03\u5c14\u578b\u53c2\u6570\n    choice(name: 'CHOICES', choices: ['one', 'two', 'three'], description: '4')  //\u9009\u62e9\u5f62\u5f0f\u5217\u8868\u53c2\u6570\n    password(name: 'PASSWORD', defaultValue: 'SECRET', description: 'A  secret password')  //\u5bc6\u7801\u7c7b\u578b\u53c2\u6570\uff0c\u4f1a\u8fdb\u884c\u52a0\u5bc6\n    imageTag(name: 'DOCKER_IMAGE', description: '', image: 'kubernetes/kubectl', filter: '.*', defaultTag: '', registry: 'https://192.168.10.15', credentialId: 'harbor-account', tagOrder: 'NATURAL')   //\u83b7\u53d6\u955c\u50cf\u540d\u79f0\u4e0etag\n    gitParameter(branch: '', branchFilter: 'origin/(.*)', defaultValue: '', description: 'Branch for build and deploy', name: 'BRANCH', quickFilterEnabled: false, selectedValue: 'NONE', sortMode: 'NONE',  tagFilter: '*', type: 'PT_BRANCH')\n  }  //\u83b7\u53d6git\u4ed3\u5e93\u5206\u652f\u5217\u8868\uff0c\u5fc5\u987b\u6709git\u5f15\u7528\n  stages {\n    stage('env1') {\n      steps {\n        sh \"env\"\n      }\n    }\n    stage('git') {\n      steps {\n        git branch: \"$BRANCH\", credentialsId: 'gitlab-key', url: 'git@192.168.10.14:root/env.git'   //\u4f7f\u7528gitParameter\uff0c\u5fc5\u987b\u6709\u8fd9\u4e2a\n      }\n    }\n  }\n}\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>Jenkins\u6307\u5b9atag\u53d1\u5e03\u5230k8s\u73af\u5883</p> <p>Jenkins\u7cfb\u5217\u4e4b\u516d\u2014\u2014\u62c9\u53d6\u6307\u5b9abranch\u6216tag </p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#4-triggers","title":"4. triggers","text":"<p>\u5728pipeline\u4e2d\u53ef\u4ee5\u7528triggers\u5b9e\u73b0\u81ea\u52a8\u89e6\u53d1\u6d41\u6c34\u7ebf\u6267\u884c\u4efb\u52a1\uff0c\u53ef\u4ee5\u901a\u8fc7Webhook\u3001Cron\u3001pollSCM\u548cupstream\u7b49\u65b9\u5f0f\u89e6\u53d1\u6d41\u6c34\u7ebf\u3002</p> <p>\u5047\u5982\u67d0\u4e2a\u6d41\u6c34\u7ebf\u6784\u5efa\u7684\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u6216\u8005\u67d0\u4e2a\u6d41\u6c34\u7ebf\u9700\u8981\u5b9a\u671f\u5728\u67d0\u4e2a\u65f6 \u95f4\u6bb5\u6267\u884c\u6784\u5efa\uff0c\u53ef\u4ee5\u4f7f\u7528cron\u914d\u7f6e\u89e6\u53d1\u5668\uff0c\u6bd4\u5982\u5468\u4e00\u5230\u5468\u4e94\u6bcf\u96944\u4e2a\u5c0f\u65f6\u6267\u884c\u4e00\u6b21\uff1a</p> <p>Cron</p> <p>\u5b9a\u65f6\u6784\u5efa\u5047\u5982\u67d0\u4e2a\u6d41\u6c34\u7ebf\u6784\u5efa\u7684\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u6216\u8005\u67d0\u4e2a\u6d41\u6c34\u7ebf\u9700\u8981\u5b9a\u671f\u5728\u67d0\u4e2a\u65f6\u95f4\u6bb5\u6267\u884c\u6784\u5efa\uff0c\u53ef\u4ee5 \u4f7f\u7528 cron \u914d\u7f6e\u89e6\u53d1\u5668\uff0c\u6bd4\u5982\u5468\u4e00\u5230\u5468\u4e94\u6bcf\u9694\u56db\u4e2a\u5c0f\u65f6\u6267\u884c\u4e00\u6b21</p> <p>\u6ce8\u610f\uff1aH \u7684\u610f\u601d\u4e0d\u662f HOURS \u7684\u610f\u601d\uff0c\u800c\u662f Hash \u7684\u7f29\u5199\u3002\u4e3b\u8981\u4e3a\u4e86\u89e3\u51b3\u591a\u4e2a\u6d41\u6c34\u7ebf\u5728\u540c\u4e00\u65f6\u95f4\u540c\u65f6\u8fd0\u884c\u5e26\u6765\u7684\u7cfb\u7edf\u8d1f\u8f7d\u538b\u529b\u3002</p> <pre><code>pipeline {\n  agent any\n  triggers {\n    cron('H */4 * * 1-5')   //\u5468\u4e00\u5230\u5468\u4e94\u6bcf\u9694\u56db\u4e2a\u5c0f\u65f6\u6267\u884c\u4e00\u6b21\n    cron('H/12 * * * *')   //\u6bcf\u969412\u5206\u949f\u6267\u884c\u4e00\u6b21\n    cron('H * * * *')   //\u6bcf\u96941\u5c0f\u65f6\u6267\u884c\u4e00\u6b21\n  }\n  stages {\n    stage('Example') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n  }\n}\n</code></pre> <p>\u4f7f\u7528cron\u5b57\u6bb5\u53ef\u4ee5\u5b9a\u671f\u6267\u884c\u6d41\u6c34\u7ebf\uff0c\u5982\u679c\u4ee3\u7801\u66f4\u65b0\uff0c\u60f3\u8981\u91cd\u65b0\u89e6\u53d1\u6d41\u6c34\u7ebf\uff0c\u53ef\u4ee5\u4f7f\u7528pollSCM\u5b57\u6bb5\uff1a</p> <pre><code>pipeline {\n  agent any\n  triggers {\n    POLLscm('H */4 * * 1-5')\n  }\n  stages {\n    stage('Example') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n  }\n}\n</code></pre> <p>Upstream</p> <p>Upstream \u53ef\u4ee5\u6839\u636e\u4e0a\u6e38 job \u7684\u6267\u884c\u7ed3\u679c\u51b3\u5b9a\u662f\u5426\u89e6\u53d1\u8be5\u6d41\u6c34\u7ebf\u3002\u6bd4\u5982\u5f53 job1 \u6216 job2 \u6267\u884c\u6210\u529f\u65f6\u89e6\u53d1\u8be5\u6d41\u6c34\u7ebf</p> <p>\u76ee\u524d\u652f\u6301\u7684\u72b6\u6001\u6709 SUCCESS\u3001UNSTABLE\u3001FAILURE\u3001NOT_BUILT\u3001ABORTED \u7b49\u3002</p> <pre><code>pipeline {\n  agent any\n  triggers {\n    upstream(upstreamProjects: 'env', threshold: hudson.model.Result.SUCCESS)  //\u5f53env\u6784\u5efa\u6210\u529f\u65f6\u6784\u5efa\u8fd9\u4e2a\u6d41\u6c34\u7ebf\n  }\n  stages {\n    stage('Example') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#5-stage","title":"5. stage","text":"<p>stage\u6307\u4ee4\u4f4d\u4e8estages\u4e0b\uff0c\u5305\u542b\u4e00\u4e2asteps\u3001\u4e00\u4e2aagent\uff08\u53ef\u9009\uff09\u6216\u5176\u4ed6\u7279\u5b9a\u7684stage\u6307\u4ee4\u3002</p> <p>\u6d41\u6c34\u7ebf\u4e2d\u5b9e\u9645\u6267\u884c\u7684\u6307\u4ee4\u90fd\u5728stage\u4e2d\u914d\u7f6e\uff0c\u6240\u4ee5\u5728\u6d41\u6c34\u7ebf\u4e2d\uff0c\u81f3\u5c11\u6709\u4e00\u4e2astage\u3002\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('Example') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#6-input","title":"6. Input","text":"<p>Input \u5b57\u6bb5\u53ef\u4ee5\u5b9e\u73b0\u5728\u6d41\u6c34\u7ebf\u4e2d\u8fdb\u884c\u4ea4\u4e92\u5f0f\u64cd\u4f5c\uff0c\u6bd4\u5982\u9009\u62e9\u8981\u90e8\u7f72\u7684\u73af\u5883\u3001\u662f\u5426\u7ee7\u7eed\u6267\u884c\u67d0\u4e2a\u9636\u6bb5\u7b49\u3002</p> <p>\u914d\u7f6e Input \u652f\u6301\u4ee5\u4e0b\u9009\u9879</p> <ul> <li>message\uff1a\u5fc5\u9009\uff0c\u9700\u8981\u7528\u6237\u8fdb\u884c input \u7684\u63d0\u793a\u4fe1\u606f\uff0c\u6bd4\u5982\uff1a\u201c\u662f\u5426\u53d1\u5e03\u5230\u751f\u4ea7\u73af\u5883\uff1f\u201d\uff1b</li> <li>id\uff1a\u53ef\u9009\uff0cinput \u7684\u6807\u8bc6\u7b26\uff0c\u9ed8\u8ba4\u4e3a stage \u7684\u540d\u79f0\uff1b</li> <li>ok\uff1a\u53ef\u9009\uff0c\u786e\u8ba4\u6309\u94ae\u7684\u663e\u793a\u4fe1\u606f\uff0c\u6bd4\u5982\uff1a\u201c\u786e\u5b9a\u201d\u3001\u201c\u5141\u8bb8\u201d\uff1b</li> <li>submitter\uff1a\u53ef\u9009\uff0c\u5141\u8bb8\u63d0\u4ea4 input \u64cd\u4f5c\u7684\u7528\u6237\u6216\u7ec4\u7684\u540d\u79f0\uff0c\u5982\u679c\u4e3a\u7a7a\uff0c\u4efb\u4f55\u767b\u5f55\u7528\u6237\u5747\u53ef\u63d0\u4ea4 input\uff1b</li> <li>parameters\uff1a\u63d0\u4f9b\u4e00\u4e2a\u53c2\u6570\u5217\u8868\u4f9b input \u4f7f\u7528\u3002</li> </ul> <p>\u5047\u5982\u9700\u8981\u914d\u7f6e\u4e00\u4e2a\u63d0\u793a\u6d88\u606f\u4e3a\u201c\u8fd8\u7ee7\u7eed\u4e48\u201d\u3001\u786e\u8ba4\u6309\u94ae\u4e3a\u201c\u7ee7\u7eed\u201d\u3001\u63d0\u4f9b\u4e00\u4e2a PERSON \u7684\u53d8\u91cf\u7684\u53c2\u6570\uff0c\u5e76\u4e14\u53ea\u80fd\u7531\u767b\u5f55\u7528\u6237\u4e3a alice \u548c bob \u63d0\u4ea4\u7684 input \u6d41\u6c34\u7ebf</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('Example') {\n      input {\n        message \"\u8fd8\u7ee7\u7eed\u4e48?\"\n        ok \"\u7ee7\u7eed\"\n        submitter \"alice,bob\"\n        parameters {\n          string(name: 'PERSON', defaultValue: 'Mr Jenkins', description: 'Who should I say hello to?')\n        }\n      }\n      steps {\n        echo \"Hello, ${PERSON}, nice to meet you.\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#7-when","title":"7. when","text":"<p>When \u6307\u4ee4\u5141\u8bb8\u6d41\u6c34\u7ebf\u6839\u636e\u7ed9\u5b9a\u7684\u6761\u4ef6\u51b3\u5b9a\u662f\u5426\u5e94\u8be5\u6267\u884c\u8be5 stage\uff0cwhen \u6307\u4ee4\u5fc5\u987b\u5305\u542b\u81f3\u5c11 \u4e00\u4e2a\u6761\u4ef6\u3002\u5982\u679c when \u5305\u542b\u591a\u4e2a\u6761\u4ef6\uff0c\u6240\u6709\u7684\u5b50\u6761\u4ef6\u5fc5\u987b\u90fd\u8fd4\u56de True\uff0cstage \u624d\u80fd\u6267\u884c\u3002</p> <p>When \u4e5f\u53ef\u4ee5\u7ed3\u5408 not\u3001allOf\u3001anyOf \u8bed\u6cd5\u8fbe\u5230\u66f4\u7075\u6d3b\u7684\u6761\u4ef6\u5339\u914d\u3002</p> <p>\u76ee\u524d\u6bd4\u8f83\u5e38\u7528\u7684\u5185\u7f6e\u6761\u4ef6\u5982\u4e0b</p> <ul> <li> <p>branch\uff1a\u5f53\u6b63\u5728\u6784\u5efa\u7684\u5206\u652f\u4e0e\u7ed9\u5b9a\u7684\u5206\u652f\u5339\u914d\u65f6\uff0c\u6267\u884c\u8fd9\u4e2a stage\uff0c\u4f8b\u5982when { branch'master' }\u3002\u6ce8\u610f\uff0cbranch \u53ea\u9002\u7528\u4e8e\u591a\u5206\u652f\u6d41\u6c34\u7ebf\u3002</p> </li> <li> <p>changelog\uff1a\u5339\u914d\u63d0\u4ea4\u7684 changeLog \u51b3\u5b9a\u662f\u5426\u6784\u5efa\uff0c\u4f8b\u5982:<code>when { changelog '.*^\\\\[DEPENDENCY\\\\] .+$' }</code></p> </li> <li> <p>environment\uff1a\u5f53\u6307\u5b9a\u7684\u73af\u5883\u53d8\u91cf\u548c\u7ed9\u5b9a\u7684\u53d8\u91cf\u5339\u914d\u65f6\uff0c\u6267\u884c\u8fd9\u4e2a stage\uff0c\u4f8b\u5982\uff1awhen { environment name: 'DEPLOY_TO', value: 'production' }\u3002</p> </li> <li> <p>equals\uff1a\u5f53\u671f\u671b\u503c\u548c\u5b9e\u9645\u503c\u76f8\u540c\u65f6\uff0c\u6267\u884c\u8fd9\u4e2a stage\uff0c\u4f8b\u5982\uff1awhen { equals expected: 2, actual: currentBuild.number }\u3002</p> </li> <li> <p>expression\uff1a\u5f53\u6307\u5b9a\u7684 Groovy \u8868\u8fbe\u5f0f\u8bc4\u4f30\u4e3a True\uff0c\u6267\u884c\u8fd9\u4e2a stage\uff0c\u4f8b\u5982\uff1awhen { expression { return params.DEBUG_BUILD } }\u3002</p> </li> <li> <p>tag\uff1a\u5982\u679c TAG_NAME \u7684\u503c\u548c\u7ed9\u5b9a\u7684\u6761\u4ef6\u5339\u914d\uff0c\u6267\u884c\u8fd9\u4e2a stage\uff0c\u4f8b\u5982\uff1awhen { tag \"release-*\" }\u3002</p> </li> <li> <p>not\uff1a\u5f53\u5d4c\u5957\u6761\u4ef6\u51fa\u73b0\u9519\u8bef\u65f6\uff0c\u6267\u884c\u8fd9\u4e2a stage\uff0c\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u6761\u4ef6\uff0c\u4f8b\u5982\uff1awhen { not { branch 'master' } }\u3002</p> </li> <li> <p>allOf\uff1a\u5f53\u6240\u6709\u7684\u5d4c\u5957\u6761\u4ef6\u90fd\u6b63\u786e\u65f6\uff0c\u6267\u884c\u8fd9\u4e2a stage\uff0c\u5fc5\u987b\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u6761\u4ef6\uff0c\u4f8b\u5982\uff1awhen { allOf { branch 'master'; environment name: 'DEPLOY_TO', value: 'production' } }\u3002</p> </li> <li> <p>anyOf\uff1a\u5f53\u81f3\u5c11\u6709\u4e00\u4e2a\u5d4c\u5957\u6761\u4ef6\u4e3a True \u65f6\uff0c\u6267\u884c\u8fd9\u4e2a stage\uff0c\u4f8b\u5982\uff1awhen { anyOf { branch 'master'; branch 'staging' } }\u3002</p> </li> </ul> <p>\u793a\u4f8b\uff1a\u5f53\u5206\u652f\u4e3a<code>main</code>\u65f6\u6267\u884cExample Deploy\u6b65\u9aa4</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('Example Build') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n    stage('Example Deploy') {\n      when {\n        branch 'main' //\u591a\u5206\u652f\u6d41\u6c34\u7ebf\uff0c\u5206\u652f\u4e3a\u624d\u4f1a\u6267\u884c\u3002\n      }\n      steps {\n        echo 'Deploying'\n      }\n    }\n  }\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u540c\u65f6\u914d\u7f6e\u591a\u4e2a\u6761\u4ef6\uff0c\u6bd4\u5982\u5206\u652f\u662f<code>production</code>\uff0c\u800c\u4e14<code>DEPLOY_TO</code>\u53d8\u91cf\u7684\u503c\u4e3amain\u65f6\uff0c\u624d\u6267\u884cExample Deploy</p> <pre><code>pipeline {\n  agent any\n  environment {\n    DEPLOY_TO = \"main\"\n  }\n  stages {\n    stage('Example Deploy') {\n      when {\n        branch 'production'\n        environment name: 'DEPLOY_TO', value: 'main'\n      }\n      steps {\n        echo 'Deploying'\n      }\n    }\n  }\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>anyOf</code>\u8fdb\u884c\u5339\u914d\u5176\u4e2d\u4e00\u4e2a\u6761\u4ef6\u5373\u53ef\uff0c\u6bd4\u5982\u5206\u652f\u4e3a<code>main</code>\u6216<code>DEPLOY_TO</code>\u4e3a<code>main</code>\u6216<code>master</code>\u65f6\u6267\u884cDeploy</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('Example Deploy') {\n      when {\n        anyOf {\n          branch 'main'\n          environment name: 'DEPLOY_TO', value: 'main'\n          environment name: 'DEPLOY_TO', value: 'master'\n        }\n      }\n      steps {\n        echo 'Deploying'\n      }\n    }\n  }\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 expression \u8fdb\u884c\u6b63\u5219\u5339\u914d\uff0c\u6bd4\u5982\u5f53<code>BRANCH_NAME</code>\u4e3a<code>main</code>\u6216<code>maste</code>\uff0c\u5e76\u4e14<code>DEPLOY_TO</code>\u4e3a<code>master</code>\u6216<code>main</code>\u65f6\u624d\u4f1a\u6267\u884cExample Deploy</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('Example Deploy') {\n      when {\n        expression { BRANCH_NAME ==~ /(main|master)/ }\n        anyOf {\n          environment name: 'DEPLOY_TO', value: 'main'\n          environment name: 'DEPLOY_TO', value: 'master'\n        }\n      }\n      steps {\n        echo 'Deploying'\n      }\n    }\n  }\n}\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5b9a\u4e49\u4e86\u67d0\u4e2a stage \u7684 agent\uff0c\u5728\u8fdb\u5165\u8be5 stage \u7684 agent \u540e\uff0c\u8be5 stage \u7684 when \u6761\u4ef6\u624d\u4f1a\u88ab\u8bc4\u4f30\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u9009\u9879\u66f4\u6539\u6b64\u9009\u9879\u3002</p> <p>\u6bd4\u5982\u5728\u8fdb\u5165stage\u7684agent \u524d\u8bc4\u4f30when\uff0c \u53ef\u4ee5\u4f7f\u7528 beforeAgent\uff0c\u5f53when\u4e3atrue\u65f6\u624d\u8fdb\u884c\u8be5 stage</p> <p>\u76ee\u524d\u652f\u6301\u7684\u524d\u7f6e\u6761\u4ef6\u5982\u4e0b</p> <ul> <li>beforeAgent\uff1a\u5982\u679c beforeAgent \u4e3a true\uff0c\u5219\u4f1a\u5148\u8bc4\u4f30 when \u6761\u4ef6\u3002\u5728 when \u6761\u4ef6\u4e3a true \u65f6\uff0c\u624d\u4f1a\u8fdb\u5165\u8be5 stage</li> <li>beforeInput\uff1a\u5982\u679c beforeInput \u4e3a true\uff0c\u5219\u4f1a\u5148\u8bc4\u4f30 when \u6761\u4ef6\u3002\u5728 when \u6761\u4ef6\u4e3a true \u65f6\uff0c\u624d\u4f1a\u8fdb\u5165\u5230 input \u9636\u6bb5\uff1b</li> <li>beforeOptions\uff1a\u5982\u679c beforeInput \u4e3a true\uff0c\u5219\u4f1a\u5148\u8bc4\u4f30 when \u6761\u4ef6\u3002\u5728 when \u6761\u4ef6\u4e3a true \u65f6\uff0c\u624d\u4f1a\u8fdb\u5165\u5230 options \u9636\u6bb5\uff1b</li> </ul> <p>beforeOptions \u4f18\u5148\u7ea7\u5927\u4e8e beforeInput \u5927\u4e8e beforeAgent</p> <p>\u793a\u4f8b1\uff1a\u914d\u7f6e\u4e00\u4e2abeforeAgent\u3002</p> <pre><code>pipeline {\n  agent none\n  stages {\n    stage('Example Build') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n    stage('Example Deploy') {\n      when {\n        beforeAgent true\n        branch 'production'\n      }\n      steps {\n        echo 'Deploying'\n      }\n    }\n  }\n}\n</code></pre> <p>\u793a\u4f8b2\uff1a\u914d\u7f6e\u4e00\u4e2abeforeInput\u3002</p> <pre><code>pipeline {\n  agent none\n  stages {\n    stage('Example Build') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n    stage('Example Deploy') {\n      when {\n        beforeInput true\n        branch 'production'\n      }\n      input {\n        message \"Deploy to production?\"\n        id \"simple-input\"\n      }\n      steps {\n        echo 'Deploying'\n      }\n    }\n  }\n}\n</code></pre> <p>\u793a\u4f8b3\uff1a\u914d\u7f6e\u4e00\u4e2abeforeOptions\u3002</p> <pre><code>pipeline {\n  agent none\n  stages {\n    stage('Example Build') {\n      steps {\n        echo 'Hello World'\n      }\n    }\n    stage('Example Deploy') {\n      when {\n        beforeOptions true\n        branch 'testing'\n      }\n      options {\n        lock label: 'testing-deploy-envs',quantity: 1, variable: 'deployEnv'    \n        }\n      steps {\n        echo 'Deploying'\n      }\n    }\n  }\n}\n</code></pre> <p>steps\u5305\u542b\u4e00\u4e2a\u5b8c\u6574\u7684script\u6b65\u9aa4\u5217\u8868\uff0c\u662f\u6d41\u6c34\u7ebf\u771f\u6b63\u6307\u5b9a\u64cd\u4f5c\u7684\u4f4d\u7f6e\uff0c \u6bd4\u5982\u6784\u5efa\u547d\u4ee4\u3001\u90e8\u7f72\u547d\u4ee4\u7b49\u3002script\u6b65\u9aa4\u9700\u8981scripted-pipeline\u5757\u5e76\u5728\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u4e2d\u6267\u884c\uff0c\u5bf9\u4e8e\u5927\u591a\u6570\u7528\u4f8b\u6765\u8bf4\uff0cscript\u6b65\u9aa4\u5e76\u4e0d\u662f\u5fc5\u8981\u7684</p> <p>\u53ef\u4ee5\u5728steps\u4e2d\u6dfb\u52a0script\u8fdb\u884cfor\u5faa\u73af\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('Example') {\n      steps {\n        echo 'Hello World'\n\n        script {\n            def browsers = ['chrome','firefox']\n            for (int i =0; i &lt; browsers.size(); ++i) {\n                echo \"Testing the ${browsers[i]} browsers \"\n            }\n         }   \n       }\n     }\n  } \n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#33-parallel","title":"3.3 parallel","text":"<p>\u5728\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u4e2d\u53ef\u4ee5\u4f7f\u7528 Parallel \u5b57\u6bb5\uff0c\u5373\u53ef\u5f88\u65b9\u4fbf\u7684\u5b9e\u73b0\u5e76\u53d1\u6784\u5efa\uff0c\u6bd4\u5982\u5bf9\u5206\u652f A\u3001B\u3001 C \u8fdb\u884c\u5e76\u884c\u5904\u7406</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('Non-Parallel Stage') {\n      steps {\n        echo 'This stage will be executed first.'\n      }\n    }\n    stage('Parallel Stage') {\n      failFast true         //\u8868\u793a\u5176\u4e2d\u53ea\u8981\u6709\u4e00\u4e2a\u5206\u652f\u6784\u5efa\u6267\u884c\u5931\u8d25\uff0c\u5c31\u76f4\u63a5\u63a8\u51fa\u4e0d\u7b49\u5f85\u5176\u4ed6\u5206\u652f\u6784\u5efa\n      parallel {\n        stage('Branch A') {\n          steps {\n            echo \"On Branch A\"\n          }\n        }\n        stage('Branch B') {\n          steps {\n            echo \"On Branch B\"\n          }\n        }\n        stage('Branch C') {\n          stages {\n            stage('Nested 1') {\n              steps {\n                echo \"In stage Nested 1 within Branch C\"\n              }\n            }\n            stage('Nested 2') {\n              steps {\n               echo \"In stage Nested 2 within Branch C\"\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>\u8bbe\u7f6efailFast\u4e3atrue\u8868\u793a\u5e76\u884c\u6d41\u6c34\u7ebf\u4e2d\u4efb\u610f\u4e00\u4e2astage\u51fa\u73b0\u9519\u8bef\uff0c\u5176\u4ed6stage\u4e5f\u4f1a\u7acb\u5373\u7ec8\u6b62\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7options\u914d\u7f6e\u5728\u5168\u5c40\uff1a</p> <pre><code>pipeline {\n  agent any\n  options {\n    parallelsAlwaysFailFast()\n  }\n  stages {\n    stage('Non-Parallel Stage') {\n      steps {\n        echo 'This stage will be executed first.'\n      }\n    }\n    stage('Parallel Stage') {\n      parallel {\n        stage('Branch A') {\n          steps {\n            echo \"On Branch A\"\n          }\n        }\n        stage('Branch B') {\n          steps {\n            echo \"On Branch B\"\n          }\n        }\n        stage('Branch C') {\n          stages {\n            stage('Nested 1') {\n              steps {\n                echo \"In stage Nested 1 within Branch C\"\n              }\n            }\n            stage('Nested 2') {\n              steps {\n               echo \"In stage Nested 2 within Branch C\"\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>parallel\u5e76\u884c</p> <pre><code> stage('Parallel Stage') {\n    when {\n        branch 'master'\n    }\n    failFast true\n    parallel {\n        stage('Branch A') {\n            agent {\n                label \"for-branch-a\"\n            }\n            steps {\n                echo \"On Branch A\"\n            }\n        }\n        stage('Branch B') {\n            agent {\n                label \"for-branch-b\"\n            }\n            steps {\n                echo \"On Branch B\"\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#4-jenkinsfile\u7684\u4f7f\u7528","title":"4. Jenkinsfile\u7684\u4f7f\u7528","text":"<p>\u524d\u9762\u8bb2\u8fc7\u6d41\u6c34\u7ebf\u652f\u6301\u4e24\u79cd\u8bed\u6cd5\uff0c\u5373\u58f0\u660e\u5f0f\u548c\u811a\u672c\u5f0f\uff0c\u8fd9\u4e24\u79cd\u8bed\u6cd5\u90fd\u652f\u6301\u6784\u5efa\u6301\u7eed\u4ea4\u4ed8\u6d41\u6c34\u7ebf\uff0c\u5e76\u4e14\u90fd\u53ef\u4ee5\u7528\u6765\u5728Web UI\u6216Jenkinsfile\u4e2d\u5b9a\u4e49\u6d41\u6c34 \u7ebf\uff0c\u4e0d\u8fc7\u901a\u5e38\u5c06Jenkinsfile\u653e\u7f6e\u4e8e\u4ee3\u7801\u4ed3\u5e93\u4e2d\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u653e\u5728\u5355\u72ec\u7684\u4ee3\u7801\u4ed3\u5e93\u4e2d\u8fdb\u884c\u7ba1\u7406\uff09\u3002</p> <p>\u521b\u5efa\u4e00\u4e2aJenkinsfile\u5e76\u5c06\u5176\u653e\u7f6e\u4e8e\u4ee3\u7801\u4ed3\u5e93\u4e2d\uff0c\u6709\u4ee5\u4e0b\u597d\u5904\uff1a</p> <ul> <li>\u65b9\u4fbf\u5bf9\u6d41\u6c34\u7ebf\u4e0a\u7684\u4ee3\u7801\u8fdb\u884c\u590d\u67e5/\u8fed\u4ee3\u3002</li> <li>\u5bf9\u7ba1\u9053\u8fdb\u884c\u5ba1\u8ba1\u8ddf\u8e2a\u3002</li> <li>\u6d41\u6c34\u7ebf\u771f\u6b63\u7684\u6e90\u4ee3\u7801\u80fd\u591f\u88ab\u9879\u76ee\u7684\u591a\u4e2a\u6210\u5458\u67e5\u770b\u548c\u7f16\u8f91\u3002</li> </ul>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#41-\u73af\u5883\u53d8\u91cf","title":"4.1 \u73af\u5883\u53d8\u91cf","text":""},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-\u9759\u6001\u53d8\u91cf","title":"1. \u9759\u6001\u53d8\u91cf","text":"<p>Jenkins \u6709\u8bb8\u591a\u5185\u7f6e\u53d8\u91cf\u53ef\u4ee5\u76f4\u63a5\u5728 Jenkinsfile \u4e2d\u4f7f\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>JENKINS_URL/pipeline/syntax/globals#env</code> \u83b7\u53d6\u5b8c\u6574\u5217\u8868\u3002\u76ee\u524d\u6bd4\u8f83\u5e38\u7528\u7684\u73af\u5883\u53d8\u91cf\u5982\u4e0b</p> <ul> <li>BUILD_ID\uff1a\u5f53\u524d\u6784\u5efa\u7684 ID\uff0c\u4e0e Jenkins \u7248\u672c 1.597+\u4e2d\u7684 BUILD_NUMBER \u5b8c\u5168\u76f8\u540c</li> <li>BUILD_NUMBER\uff1a\u5f53\u524d\u6784\u5efa\u7684 ID\uff0c\u548c BUILD_ID \u4e00\u81f4</li> <li>BUILD_TAG\uff1a\u7528\u6765\u6807\u8bc6\u6784\u5efa\u7684\u7248\u672c\u53f7\uff0c\u683c\u5f0f\u4e3a\uff1a<code>jenkins-${JOB_NAME}-${BUILD_NUMBER}</code>\uff0c \u53ef\u4ee5\u5bf9\u4ea7\u7269\u8fdb\u884c\u547d\u540d\uff0c\u6bd4\u5982\u751f\u4ea7\u7684 jar \u5305\u540d\u5b57\u3001\u955c\u50cf\u7684 TAG \u7b49\uff1b</li> <li>BUILD_URL\uff1a\u672c\u6b21\u6784\u5efa\u7684\u5b8c\u6574 URL\uff0c\u6bd4\u5982\uff1ahttp://buildserver/jenkins/job/MyJobName/17/%EF%BC%9B</li> <li>JOB_NAME\uff1a\u672c\u6b21\u6784\u5efa\u7684\u9879\u76ee\u540d\u79f0</li> <li>NODE_NAME\uff1a\u5f53\u524d\u6784\u5efa\u8282\u70b9\u7684\u540d\u79f0\uff1b</li> <li>JENKINS_URL\uff1aJenkins \u5b8c\u6574\u7684 URL\uff0c\u9700\u8981\u5728 SystemConfiguration \u8bbe\u7f6e\uff1b</li> <li>WORKSPACE\uff1a\u6267\u884c\u6784\u5efa\u7684\u5de5\u4f5c\u76ee\u5f55\u3002</li> </ul> <p>\u793a\u4f8b\u5982\u679c\u4e00\u4e2a\u6d41\u6c34\u7ebf\u540d\u79f0\u4e3a<code>print_env</code>\uff0c\u7b2c 2 \u6b21\u6784\u5efa\uff0c\u5404\u4e2a\u53d8\u91cf\u7684\u503c\u3002</p> <pre><code>BUILD_ID\uff1a2\nBUILD_NUMBER\uff1a2\nBUILD_TAG\uff1ajenkins-print_env-2\nBUILD_URL\uff1ahttp://192.168.10.16:8080/job/print_env/2/\nJOB_NAME\uff1aprint_env\nNODE_NAME\uff1abuilt-in\nJENKINS_URL\uff1ahttp://192.168.10.16:8080/\nWORKSPACE\uff1a/bitnami/jenkins/home/workspace/print_env\n</code></pre> <p>\u4e0a\u8ff0\u53d8\u91cf\u4f1a\u4fdd\u5b58\u5728\u4e00\u4e2a Map \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 env.BUILD_ID \u6216 env.JENKINS_URL \u5f15\u7528\u67d0\u4e2a\u5185\u7f6e\u53d8\u91cf</p> <pre><code>pipeline {\n  agent any\n  stages {\n    stage('print env') {\n      parallel {\n        stage('BUILD_ID') {\n          steps {\n            echo \"$env.BUILD_ID\"\n          }\n        }\n        stage('BUILD_NUMBER') {\n          steps {\n            echo \"$env.BUILD_NUMBER\"\n          }\n        }\n        stage('BUILD_TAG') {\n          steps {\n            echo \"$env.BUILD_TAG\"\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>pipeline\u4e2d\u7684\u53d8\u91cf\uff1a</p> <p>\u9996\u5148\u4f60\u8981\u5148\u7406\u89e3pipeline\u53ef\u4ee5\u7528groovy\u8bed\u6cd5\u6765\u7f16\u5199\uff0c\u800cgroovy\u662f\u4e00\u95e8\u7f16\u7a0b\u8bed\u8a00\u3002\u6240\u6709\u7684\u7f16\u7a0b\u8bed\u8a00\u4e5f\u90fd\u6709\u5404\u81ea\u7684\u53d8\u91cf\u5b9a\u4e49\u65b9\u5f0f\uff0c\u8fd9\u5c31\u5bb9\u6613\u8ba9\u5927\u5bb6\u4ea7\u751f\u7591\u60d1\u7684\u5730\u65b9\uff0cpipeline\u4e2d\u53ef\u4ee5\u6709\u591a\u79cd\u5199\u6cd5\u3002</p> <p><pre><code>def name = \"devops\"\nString name = \"devops\"\n</code></pre> \u4e24\u79cd\u5199\u6cd5\u662f\u4e00\u6837\u7684\uff0cdef\u53ef\u4ee5\u81ea\u52a8\u63a8\u5bfc\u51fa\u53d8\u91cf\u7c7b\u578b\uff0c\u800cString\u8fd9\u79cd\u5199\u6cd5\u662f\u7cbe\u786e\u8fd9\u4e2a\u53d8\u91cf\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u3002</p> <p>\u5982\u679c\u4f60\u518dJenkins\u56fe\u5f62\u754c\u9762\u8bbe\u7f6e\u4e86\u53c2\u6570\u5316\u6784\u5efa\u6ca1\u90a3\u4e48\u8fd9\u4e9b\u53c2\u6570\u4e5f\u53d8\u6210\u4e86Jenkins\u5168\u5c40\u53d8\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0eJenkins\u5185\u7f6e\u53d8\u91cf\u76f8\u540c\u7684\u5f15\u7528\u65b9\u5f0f\u3002</p> <p>\u5982\u679c\u67d0\u4e2astage\u5b9a\u4e49\u7684\u53d8\u91cf\u9ed8\u8ba4\u662f\u5c40\u90e8\u53d8\u91cf\uff0c\u5728\u540e\u7eed\u7684stage\u4e2d\u53ef\u80fd\u8bed\u6cd5\u5f15\u7528\uff0c\u6240\u4ee5\u5982\u679c\u9700\u8981\u5f15\u7528\u6700\u597d\u5b9a\u4e49\u4e3a\u5168\u5c40\u53d8\u91cf\u3002</p> <p>\u5168\u5c40\u53d8\u91cf\u7684\u5b9a\u4e49\u65b9\u5f0f\uff1a</p> <pre><code>env.name = \"devops\"\n</code></pre> <p>\u5f15\u7528\u65b9\u5f0f\uff1a <code>\"${env.name}\"</code></p> <p>\u603b\u4e4b\u53d8\u91cf\u7684\u5b9a\u4e49\u65e0\u5904\u4e0d\u5728\uff0c\u5982\u679c\u5b9a\u4e49\u5168\u5c40\u53d8\u91cf\u5c31\u7528<code>env.\u53d8\u91cf\u540d</code>\u7684\u65b9\u5f0f\u5b9a\u4e49\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-\u52a8\u6001\u53d8\u91cf","title":"2. \u52a8\u6001\u53d8\u91cf","text":"<p>\u52a8\u6001\u53d8\u91cf\u662f\u6839\u636e\u67d0\u4e2a\u6307\u4ee4\u7684\u7ed3\u679c\u8fdb\u884c\u52a8\u6001\u8d4b\u503c\uff0c\u53d8\u91cf\u7684\u503c\u6839\u636e\u6307\u4ee4\u7684\u6267\u884c\u7ed3\u679c\u800c\u4e0d\u540c\u3002\u5982\u4e0b\u6240\u793a</p> <ul> <li>returnStdout\uff1a\u5c06\u547d\u4ee4\u7684\u6267\u884c\u7ed3\u679c\u8d4b\u503c\u7ed9\u53d8\u91cf\uff0c\u6bd4\u5982\u4e0b\u8ff0\u7684\u547d\u4ee4\u8fd4\u56de\u7684\u662f clang\uff0c\u6b64\u65f6 CC \u7684\u503c\u4e3a\u201cclang\u201d\u3002</li> <li>returnStatus\uff1a\u5c06\u547d\u4ee4\u7684\u6267\u884c\u72b6\u6001\u8d4b\u503c\u7ed9\u53d8\u91cf\uff0c\u6bd4\u5982\u4e0b\u8ff0\u547d\u4ee4\u7684\u6267\u884c\u72b6\u6001\u4e3a 1\uff0c\u6b64\u65f6 EXIT_STATUS \u7684\u503c\u4e3a 1\u3002</li> </ul> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  environment {\n    // \u4f7f\u7528 returnStdout\n    CC = \"\"\"${sh(\n         returnStdout: true,\n         script: 'echo -n \"clang\"'   //\u5982\u679c\u4f7f\u7528shell\u547d\u4ee4\u7684echo\u8d4b\u503c\u53d8\u91cf\u6700\u597d\u52a0-n\u53d6\u6d88\u6362\u884c\n         )}\"\"\"\n\n    // \u4f7f\u7528 returnStatus\n    EXIT_STATUS = \"\"\"${sh(\n         returnStatus: true,\n         script: 'exit 1'\n         )}\"\"\"\n  }\n  stages {\n    stage('Example') {\n      environment {\n        DEBUG_FLAGS = '-g'\n      }\n      steps {\n        sh 'printenv'\n      }\n    }\n  }\n}\n</code></pre> <ul> <li> <p>\u5fc5\u987b\u5728\u7ba1\u9053\u7684\u9876\u5c42\u8bbe\u7f6eagent\u3002\u5982\u679cagent\u8bbe\u7f6enone\uff0c\u5219\u6b64\u64cd\u4f5c\u5c06\u5931\u8d25\u3002</p> </li> <li> <p>\u4f7f\u7528returnStout\u65f6\uff0c\u5c06\u5728\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u540e\u9762\u9644\u52a0\u4e00\u4e2a\u5c3e\u968f\u7a7a\u683c\u3002\u4f7f\u7528.trim()\u5220\u9664\u6b64\u9879\u3002</p> </li> </ul>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#3-jenkins\u5185\u7f6e\u53d8\u91cf","title":"3. Jenkins\u5185\u7f6e\u53d8\u91cf","text":"<p>\u5728pipeline\u6267\u884c\u65f6\uff0cJenkins\u901a\u8fc7\u4e00\u4e2a\u540d\u4e3aenv\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u5c06Jenkins\u5185\u7f6e\u73af\u5883\u53d8\u91cf\u66b4\u9732\u51fa\u6765\u3002\u5176\u4f7f\u7528\u65b9\u6cd5\u6709\u591a\u79cd\uff0c\u793a\u4f8b\u5982\u4e0b: <pre><code>pipeline {\n  agent any\n  stages {\n    stage('debug-\u5217\u51fa\u5f53\u524d\u6d41\u6c34\u7ebf\u7684\u6240\u6709\u73af\u5883\u53d8\u91cf) {\n      setps {\n        sh \"printenv | sort\"\n      }\n    }\n    stage('Example') {\n      steps {\n         echo \"Running ${env.BUILDNUMBER} on ${env.JENKINS_URL}\" # \u65b9\u6cd51\n         echo \"Running $env.BUILDNUMBER on $env.JENKINS_URL\"  # \u65b9\u6cd52\n         echo \"Running ${BUILDNUMBER} on ${JENKINS_URL}\"   # \u65b9\u6cd53 \u7b80\u5199\u7248\u672c\u4e0d\u63a8\u8350\uff0c\u96be\u6392\u67e5\n      }\n    }\n  }\n}\n</code></pre></p> <p>\u9ed8\u8ba4env\u7684\u5c5e\u6027\u53ef\u4ee5\u76f4\u63a5\u5728pipeline\u4e2d\u5f15\u7528\u3002\u6240\u4ee5\u4ee5\u4e0a\u65b9\u6cd5\u90fd\u662f\u5408\u6cd5\u7684\u3002\u4f46\u662f\u4e0d\u63a8\u8350\u65b9\u6cd5\u4e09\uff0c\u56e0\u4e3a\u51fa\u73b0\u53d8\u91cf\u51b2\u7a81\u65f6\uff0c\u975e\u5e38\u96be\u67e5\u95ee\u9898\u3002</p> <p>\u90a3\u4e48\uff0cenv\u53d8\u91cf\u90fd\u6709\u54ea\u4e9b\u53ef\u7528\u5c5e\u6027\u5462?  \u901a\u8fc7\u8bbf\u95ee<code>&lt;Jenkins master\u7684\u5730\u5740&gt;/pipeline-syntax/globals#env</code>\u6765\u83b7\u53d6\u5b8c\u6574\u5217\u8868\u3002  \u5728\u5217\u8868\u4e2d\uff0c\u5f53\u4e00\u4e2a\u53d8\u91cf\u88ab\u58f0\u660e\u4e3a\"For a multibranch project\"\u65f6\uff0c\u4ee3\u8868\u53ea\u6709\u591a\u5206\u652f\u9879\u76ee\u624d\u4f1a\u6709\u6b64\u53d8\u91cf\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#4-\u81ea\u5b9a\u4e49\u53d8\u91cf","title":"4. \u81ea\u5b9a\u4e49\u53d8\u91cf","text":"<p>1.pipeline\u63d0\u4f9b\u7684environment\u6307\u4ee4\u4e2d\u5b9a\u4e49 <pre><code>pipeline {\n    agent any\n    environment {\n        // \u8986\u76d6\u9ed8\u8ba4\u7684PATH\u53d8\u91cf\u503c\n        PATH=\"/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin\"\n        name='jack'\n    }\n    stages {\n        stage(\"test env\") {\n          steps {\n            sh \"printenv\"  #\u8c03\u8bd5\uff0c\u6253\u5370\u6240\u6709env\u53d8\u91cf\n            echo \"${name}\"  # jack\n            echo \"${env.name}\"  # jack\n          }\n        }\n     }\n  }\n</code></pre></p> <pre><code>pipeline {\n    agent any\n\n    environment {\n        FOO = \"bar\"\n    }\n\n    stages {\n        stage(\"Env Variables\") {\n            environment {\n                NAME = \"Alan\"\n            }\n\n            steps {\n                echo \"FOO = ${env.FOO}\"\n                echo \"NAME = ${env.NAME}\"\n\n                script {\n                    env.TEST_VARIABLE = \"some test value\"\n                }\n\n                echo \"TEST_VARIABLE = ${env.TEST_VARIABLE}\"\n\n                withEnv([\"ANOTHER_ENV_VAR=here is some value\"]) {\n                    echo \"ANOTHER_ENV_VAR = ${env.ANOTHER_ENV_VAR}\"\n                }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#5-\u8986\u76d6\u73af\u5883\u53d8\u91cf","title":"5. \u8986\u76d6\u73af\u5883\u53d8\u91cf","text":"<p>Jenkins Pipeline\u652f\u6301\u8986\u76d6\u73af\u5883\u53d8\u91cf\u3002\u60a8\u9700\u8981\u6ce8\u610f\u4e00\u4e9b\u89c4\u5219\u3002</p> <ul> <li>\u4f7f\u7528withEnv([\"env=value]) { }\u8bed\u53e5\u5757\u53ef\u4ee5\u8986\u76d6\u4efb\u4f55\u73af\u5883\u53d8\u91cf\u3002 </li> <li>\u4f7f\u7528environment {}\u8bed\u53e5\u5757\u8bbe\u7f6e\u7684\u53d8\u91cf\u4e0d\u80fd\u4f7f\u7528\u547d\u4ee4\u5f0fenv.VAR = \"value\"\u8d4b\u503c\u8986\u76d6\u3002 </li> <li>\u547d\u4ee4\u5f0fenv.VAR = \"value\"\u5206\u914d\u53ea\u80fd\u8986\u76d6\u4f7f\u7528\u547d\u4ee4\u5f0f\u521b\u5efa\u7684\u73af\u5883\u53d8\u91cf\u3002</li> </ul> <p>\u8fd9\u662f\u4e00\u4e2a\u793a\u4f8b\u6027\u7684Jenkinsfile\uff0c\u663e\u793a\u4e86\u6240\u6709\u4e09\u79cd\u4e0d\u540c\u7684\u7528\u4f8b\u3002 <pre><code>pipeline {\n    agent any\n\n    environment {\n        FOO = \"bar\"\n        NAME = \"Joe\"\n    }\n\n    stages {\n        stage(\"Env Variables\") {\n            environment {\n                NAME = \"Alan\" // overrides pipeline level NAME env variable\n                BUILD_NUMBER = \"2\" // overrides the default BUILD_NUMBER\n            }\n\n            steps {\n                echo \"FOO = ${env.FOO}\" // prints \"FOO = bar\"\n                echo \"NAME = ${env.NAME}\" // prints \"NAME = Alan\"\n                echo \"BUILD_NUMBER =  ${env.BUILD_NUMBER}\" // prints \"BUILD_NUMBER = 2\"\n\n                script {\n                    env.SOMETHING = \"1\" // creates env.SOMETHING variable\n                }\n            }\n        }\n\n        stage(\"Override Variables\") {\n            steps {\n                script {\n                    env.FOO = \"IT DOES NOT WORK!\" // it can't override env.FOO declared at the pipeline (or stage) level\n                    env.SOMETHING = \"2\" // it can override env variable created imperatively\n                }\n\n                echo \"FOO = ${env.FOO}\" // prints \"FOO = bar\"\n                echo \"SOMETHING = ${env.SOMETHING}\" // prints \"SOMETHING = 2\"\n\n                withEnv([\"FOO=foobar\"]) { // it can override any env variable\n                    echo \"FOO = ${env.FOO}\" // prints \"FOO = foobar\"\n                }\n\n                withEnv([\"BUILD_NUMBER=1\"]) {\n                    echo \"BUILD_NUMBER = ${env.BUILD_NUMBER}\" // prints \"BUILD_NUMBER = 1\"\n                }\n            }\n        }\n    }\n}\n</code></pre></p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#6-\u73af\u5883\u53d8\u91cf\u7684\u4e92\u76f8\u5f15\u7528","title":"6. \u73af\u5883\u53d8\u91cf\u7684\u4e92\u76f8\u5f15\u7528","text":"<pre><code>environment {\n  __server_name = 'email-server'\n  __version = \"${BUILD_NUMBER}\"\n  __artifact_name = \"${__server_name}-${__version}.jar\"\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#7-\u5c06\u5e03\u5c14\u503c\u5b58\u50a8\u5728\u73af\u5883\u53d8\u91cf\u4e2d","title":"7. \u5c06\u5e03\u5c14\u503c\u5b58\u50a8\u5728\u73af\u5883\u53d8\u91cf\u4e2d","text":"<p>\u5173\u4e8e\u4f7f\u7528\u73af\u5883\u53d8\u91cf\uff0c\u5b58\u5728\u4e00\u79cd\u666e\u904d\u7684\u8bef\u89e3\u3002\u5b58\u50a8\u4e3a\u73af\u5883\u53d8\u91cf\u7684\u6bcf\u4e2a\u503c\u90fd\u5c06\u8f6c\u6362\u4e3aString\u3002  \u5f53\u60a8\u5b58\u50a8\u5e03\u5c14false\u503c\u65f6\uff0c\u5b83\u5c06\u8f6c\u6362\u4e3a\"false\"\u3002\u5982\u679c\u8981\u5728\u5e03\u5c14\u8868\u8fbe\u5f0f\u4e2d\u6b63\u786e\u4f7f\u7528\u8be5\u503c\uff0c\u5219\u9700\u8981\u8c03\u7528<code>\"false\".toBoolean()</code>method\u3002</p> <pre><code>pipeline {\n    agent any\n\n    environment {\n        IS_BOOLEAN = false\n    }\n\n    stages {\n        stage(\"Env Variables\") {\n            steps {\n                script {\n                    if (env.IS_BOOLEAN) {\n                        echo \"You can see this message, because \\\"false\\\" String evaluates to Boolean.TRUE value\"\n                    }\n\n                    if (env.IS_BOOLEAN.toBoolean() == false) {\n                        echo \"You can see this message, because \\\"false\\\".toBoolean() returns Boolean.FALSE value\"\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#8-\u81ea\u5b9a\u4e49\u5168\u5c40\u73af\u5883\u53d8\u91cf","title":"8. \u81ea\u5b9a\u4e49\u5168\u5c40\u73af\u5883\u53d8\u91cf","text":"<p>\u5b9a\u4e49\u5168\u5c40\u73af\u5883\u53d8\u91cf\u53ef\u4ee5\u8de8pipeline\u4f7f\u7528 \u8fdb\u5165Jenkins -- Manage Jenkins -- \u627e\u5230Global properties -- \u52fe\u9009Environment variables</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#42-\u51ed\u8bc1\u7ba1\u7406","title":"4.2 \u51ed\u8bc1\u7ba1\u7406","text":"<p>Jenkins \u7684\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u8bed\u6cd5\u6709\u4e00\u4e2a credentials()\u51fd\u6570\uff0c\u5b83\u652f\u6301 secret text\uff08\u52a0\u5bc6\u6587\u672c\uff09\u3001username \u548c password\uff08\u7528\u6237\u540d\u548c\u5bc6\u7801\uff09\u4ee5\u53ca secret file\uff08\u52a0\u5bc6\u6587\u4ef6\uff09\u7b49\u3002\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u4e00\u4e9b\u5e38\u7528\u7684\u51ed\u8bc1\u5904\u7406\u65b9\u6cd5\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-\u52a0\u5bc6\u6587\u672c","title":"1. \u52a0\u5bc6\u6587\u672c","text":"<p>\u672c\u5b9e\u4f8b\u6f14\u793a\u5c06\u4e24\u4e2a Secret \u6587\u672c\u51ed\u8bc1\u5206\u914d\u7ed9\u5355\u72ec\u7684\u73af\u5883\u53d8\u91cf\u6765\u8bbf\u95ee Amazon Web \u670d\u52a1\uff0c\u9700\u8981\u63d0\u524d\u521b\u5efa\u8fd9\u4e24\u4e2a\u6587\u4ef6\u7684 credentials\uff08\u5b9e\u8df5\u7684\u7ae0\u8282\u4f1a\u6709\u6f14\u793a\uff09\uff0cJenkinsfile \u6587\u4ef6\u7684\u5185\u5bb9\u5982\u4e0b</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  environment {\n    AWS_ACCESS_KEY_ID = credentials('txt1')\n    AWS_SECRET_ACCESS_KEY = credentials('txt2')\n  }\n  stages {\n    stage('Example stage 1') {\n      steps {\n        echo \"$AWS_ACCESS_KEY_ID\"\n      }\n    }\n    stage('Example stage 2') {\n      steps {\n        echo \"$AWS_SECRET_ACCESS_KEY\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-\u7528\u6237\u540d\u5bc6\u7801","title":"2. \u7528\u6237\u540d\u5bc6\u7801","text":"<p>\u672c\u793a\u4f8b\u7528\u6765\u6f14\u793a credentials \u8d26\u53f7\u5bc6\u7801\u7684\u4f7f\u7528\uff0c\u6bd4\u5982\u4f7f\u7528\u4e00\u4e2a\u516c\u7528\u8d26\u6237\u8bbf\u95ee Bitbucket\u3001GitLab\u3001 Harbor \u7b49\u3002\u5047\u8bbe\u5df2\u7ecf\u914d\u7f6e\u5b8c\u6210\u4e86\u7528\u6237\u540d\u5bc6\u7801\u5f62\u5f0f\u7684 credentials\uff0c\u51ed\u8bc1 ID \u4e3a harbor-account</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  environment {\n    BITBUCKET_COMMON_CREDS = credentials('harbor-account')\n  }\n  stages {\n    stage('printenv') {\n      steps {\n        sh \"env\"\n      }\n    }\n}\n</code></pre> <p>\u4e0a\u8ff0\u7684\u914d\u7f6e\u4f1a\u81ea\u52a8\u751f\u6210 3 \u4e2a\u73af\u5883\u53d8\u91cf</p> <ul> <li>BITBUCKET_COMMON_CREDS\uff1a\u5305\u542b\u4e00\u4e2a\u4ee5\u5192\u53f7\u5206\u9694\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u683c\u5f0f\u4e3a username:password</li> <li>BITBUCKET_COMMON_CREDS_USR\uff1a\u4ec5\u5305\u542b\u7528\u6237\u540d\u7684\u9644\u52a0\u53d8\u91cf</li> <li>BITBUCKET_COMMON_CREDS_PSW\uff1a\u4ec5\u5305\u542b\u5bc6\u7801\u7684\u9644\u52a0\u53d8\u91cf\u3002</li> </ul>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#3-\u52a0\u5bc6\u6587\u4ef6","title":"3. \u52a0\u5bc6\u6587\u4ef6","text":"<p>\u9700\u8981\u52a0\u5bc6\u4fdd\u5b58\u7684\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 credential\uff0c\u6bd4\u5982\u94fe\u63a5\u5230 Kubernetes \u96c6\u7fa4\u7684 kubeconfig \u6587\u4ef6\u7b49\u3002</p> <p>\u5047\u5982\u5df2\u7ecf\u914d\u7f6e\u597d\u4e86\u4e00\u4e2a kubeconfig \u6587\u4ef6\uff0c\u6b64\u65f6\u53ef\u4ee5\u5728 Pipeline \u4e2d\u5f15\u7528\u8be5\u6587\u4ef6</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent {\n    kubernetes {\n      cloud 'kubernetes'\n      slaveConnectTimeout 1200\n      workspaceVolume emptyDirWorkspaceVolume()\n      yaml '''\nkind: Pod\nmetadata:\n  name: jenkins-agent\nspec:\n  containers:\n  - args: [\\'$(JENKINS_SECRET)\\', \\'$(JENKINS_NAME)\\']\n    image: '192.168.10.15/kubernetes/jnlp:alpine'\n    name: jnlp\n    imagePullPolicy: IfNotPresent\n  - command:\n      - \"cat\"\n    image: \"192.168.10.15/kubernetes/kubectl:apline\"\n    imagePullPolicy: \"IfNotPresent\"\n    name: \"kubectl\"\n    tty: true\n  restartPolicy: Never\n'''\n    }\n  }\n  environment {\n    KUBECONFIG = credentials('kubernetes-cluster')\n  }\n  stages {\n    stage('kubectl') {\n      steps {\n        container(name: 'kubectl') {\n          sh \"\"\"\n            # kubectl get pod -A  --kubeconfig $MY_KUBECONFIG\n\n            mkdir -p ~/.kube &amp;&amp; cp ${KUBECONFIG} ~/.kube/config\n            kubectl get nodes\n          \"\"\"\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>\u66f4\u591a\u5176\u4ed6\u7c7b\u578b\u7684\u51ed\u8bc1\u53ef\u4ee5\u53c2\u8003</p> <p>https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#handlingcredentials\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#43-\u53c2\u6570\u5904\u7406","title":"4.3 \u53c2\u6570\u5904\u7406","text":"<p>\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u652f\u6301\u5f88\u591a\u5f00\u7bb1\u5373\u7528\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u8ba9\u6d41\u6c34\u7ebf\u63a5\u6536\u4e0d\u540c\u7684\u53c2\u6570\u4ee5\u8fbe\u5230\u4e0d\u540c\u7684\u6784\u5efa\u6548\u679c\u3002</p> <p>\u5728Jenkinsfile\u4e2d\u6307\u5b9a\u7684parameters\u4f1a\u5728Jenkins Web UI\u81ea\u52a8\u751f\u6210\u5bf9\u5e94\u7684\u53c2\u6570\u5217\u8868\uff0c\u6b64\u65f6\u53ef\u4ee5\u5728Jenkins\u9875\u9762\u5355\u51fbBuild With Parameters\u6765\u6307\u5b9a\u53c2\u6570 \u7684\u503c\uff0c\u8fd9\u4e9b\u53c2\u6570\u53ef\u4ee5\u901a\u8fc7params\u53d8\u91cf\u88ab\u6210\u5458\u8bbf\u95ee\u3002</p> <p>\u5047\u8bbe\u5728Jenkinsfile\u4e2d\u914d\u7f6e\u4e86\u540d\u4e3aGreeting\u7684\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u53ef\u4ee5\u901a\u8fc7${params.Greeting}\u8bbf\u95ee\u8be5\u53c2\u6570\uff0c\u6bd4\u5982\uff1a</p> <pre><code>//Jenkinsfile (Declarative Pipeline)\npipeline {\n  agent any\n  parameters {\n    string(name\uff1a\u2018Greeting\u2019, defaultValue: 'Hello', description: \"How should I greet the world?\")\n  }\n  stages {\n    stage('Example') {\n      steps {\n        echo \"${params.Greeting} World!\"\n       }\n     }\n  }\n}\n</code></pre> <p>\u5bf9\u5e94\u7684\u811a\u672c\u5f0f\u6d41\u6c34\u7ebf\u5982\u4e0b\uff1a</p> <pre><code>//Jenkinsfile (Scripted Pipeline)\nproperties([parameters([string(name\uff1a\u2018Greeting\u2019, defaultValue: 'Hello', description: \"How should I greet the world?\")])])\n\nnode {\n    echo \"${params.Greeting} World!\" \n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#44-\u5904\u7406\u5931\u8d25","title":"4.4 \u5904\u7406\u5931\u8d25","text":"<p>\u5728\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u4e2d\uff0c\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u7ed3\u679c\u8fdb\u884c\u540e\u7f6e\u5904\u7406\uff0c\u6bd4\u5982always\u3001unstable\u3001success\u3001failure\u548cchanged\uff0c\u5177\u4f53\u53ef\u53c2\u8003Pipeline Post\u7684\u8bed\u6cd5\u3002</p> <p>\u5047\u5982\u6d41\u6c34\u7ebf\u6784\u5efa\u5931\u8d25\u9700\u8981\u8fdb\u884c\u90ae\u4ef6\u901a\u77e5\uff0c\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u793a\u4f8b\uff08Jenkins\u9700\u8981\u914d\u7f6e\u90ae\u7bb1\uff09\uff1a</p> <pre><code>pipeline { \n    agent any \n\n    parameters {\n        \u7701\u7565\u5185\u5bb9\u2026\u2026\n    }\n    environment {\n        \u7701\u7565\u5185\u5bb9\u2026\u2026\n    }\n    stages {\n        \u7701\u7565\u5185\u5bb9\u2026\u2026\n    }\n    post {\n        success {\n            emailext (\n                subject: \"SUCCESSFUL: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'\",\n                body: \"\"\"&lt;p&gt;SUCCESSFUL: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]':&lt;/p&gt;\n                    &lt;p&gt;Check console output at \"&lt;a href=\"${env.BUILD_URL}\"&gt;${env.JOB_NAME} [${env.BUILD_NUMBER}]&lt;/a&gt;\"&lt;/p&gt;\"\"\",\n                to: \"user1@qq.com,user2@qq.com\",\n                from: \"admin@sina.com\"\n            )\n        }\n        failure {\n            emailext (\n                subject: \"FAILED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'\",\n                body: \"\"\"&lt;p&gt;FAILED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]':&lt;/p&gt;\n                    &lt;p&gt;Check console output at \"&lt;a href=\"${env.BUILD_URL}\"&gt;${env.JOB_NAME}          [${env.BUILD_NUMBER}]&lt;/a&gt;\"&lt;/p&gt;\"\"\",\n                to: \"user1@qq.com,user2@qq.com\",\n                from: \"admin@sina.com\"\n            )\n        }\n    }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#45-\u4f7f\u7528\u591a\u4e2a\u4ee3\u7406","title":"4.5 \u4f7f\u7528\u591a\u4e2a\u4ee3\u7406","text":"<p>\u6d41\u6c34\u7ebf\u5141\u8bb8\u5728Jenkins\u73af\u5883\u4e2d\u4f7f\u7528\u591a\u4e2a\u4ee3\u7406\uff0c\u8fd9\u6709\u52a9\u4e8e\u66f4\u9ad8\u7ea7\u7684\u7528\u4f8b\uff0c\u4f8b\u5982\u8de8\u591a\u4e2a\u5e73\u53f0\u6267\u884c\u6784\u5efa\u3001\u6d4b\u8bd5\u7b49\u3002</p> <p>\u6bd4\u5982\uff0c\u5728Linux\u548cWindows\u7cfb\u7edf\u7684\u4e0d\u540cagent\u4e0a\u8fdb\u884c\u6d4b\u8bd5\uff1a</p> <pre><code>pipeline {\n    agent none\n    stages {\n        stage('Build') {\n            agent any\n            steps {\n                checkout scm\n                sh 'make'\n                stash includes: '**/target/*.jar', name: 'app'\n            }\n        }\n\n         stage('Test on Linux') {\n            agent { label 'linux'}\n            steps {\n              unstash 'app'\n               sh 'make check'\n            }\n            post {\n              always {\n                junit '**/target/*.xml'\n              }\n            }\n        }\n\n       stage('Test on Windows') {\n            agent { label 'windows'}\n            steps {\n              unstash 'app'\n               sh 'make check'\n            }\n            post {\n              always {\n                junit '**/target/*.xml'\n              }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#46-\u6d41\u6c34\u7ebf\u56de\u653e\u529f\u80fd","title":"4.6 \u6d41\u6c34\u7ebf\u56de\u653e\u529f\u80fd","text":"<p>\u501f\u52a9\u56de\u653e\u53ef\u4ee5\u4fee\u6539\u4e0a\u6b21\u6784\u5efa\u6240\u4f7f\u7528\u7684Jenkinsfile\u4ee3\u7801\uff0c\u8fdb\u884c\u66f4\u6539\u540e\u53ef\u4ee5\u7acb\u5373\u8fd0\u884c\u8fdb\u884c\u6d4b\u8bd5\u3002</p> <p></p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#47-pipeline\u5f00\u53d1\u5de5\u5177","title":"4.7 Pipeline\u5f00\u53d1\u5de5\u5177","text":""},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#\u7247\u6bb5\u751f\u6210\u5668","title":"\u7247\u6bb5\u751f\u6210\u5668","text":"<p>\u6d41\u6c34\u7ebf\u4ee3\u7801\u7247\u6bb5\u751f\u6210\u5668\uff0c\u975e\u5e38\u597d\u7528\uff0c\u5728\u8fd9\u91cc\u53ef\u4ee5\u627e\u5230<code>\u6bcf\u4e2a\u63d2\u4ef6\u4ee5\u53caJenkins\u5185\u7f6e\u7684\u65b9\u6cd5</code>\u7684\u4f7f\u7528\u65b9\u6cd5.\u4f7f\u7528\u7247\u6bb5\u751f\u6210\u5668\u53ef\u4ee5\u6839\u636e\u4e2a\u4eba\u9700\u8981\u751f\u6210\u65b9\u6cd5\uff0c \u6709\u4e9b\u65b9\u6cd5\u6765\u6e90\u4e8e\u63d2\u4ef6\uff0c\u5219\u9700\u8981\u5b89\u88c5\u76f8\u5173\u7684\u63d2\u4ef6\u624d\u80fd\u4f7f\u7528\u54e6\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#\u58f0\u660e\u5f0f\u8bed\u6cd5\u751f\u6210\u5668","title":"\u58f0\u660e\u5f0f\u8bed\u6cd5\u751f\u6210\u5668","text":"<p>\u53ef\u4ee5\u751f\u6210\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u8bed\u6cd5\u7684\u8bed\u53e5\u5757</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#\u5168\u5c40\u53d8\u91cf\u53c2\u8003","title":"\u5168\u5c40\u53d8\u91cf\u53c2\u8003","text":"<p>\u8fd9\u91cc\u9762\u662f\u5df2\u7ecf\u5b89\u88c5\u7684Jenkins\u63d2\u4ef6\u548cJenkins\u5185\u7f6e\u7684\u5168\u5c40\u53d8\u91cf\u6e05\u5355\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#48-dsl\u65b9\u6cd5","title":"4.8 DSL\u65b9\u6cd5","text":""},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#481-json\u6570\u636e\u683c\u5f0f\u89e3\u6790","title":"4.8.1 JSON\u6570\u636e\u683c\u5f0f\u89e3\u6790","text":"<p>\u63d2\u4ef6\uff1a Pipeline Utils Steps</p> <pre><code>// \u63d2\u4ef6\ndef response = readJSON text: \"${scanResult}\"\nprintln(scanResult)\n\n// \u539f\u751f\u65b9\u6cd5\nimport groovy.json.*\n\n@NonCPS\ndef GetJson(text){\n    def prettyJson = JsonOutput.prettyPrint(text) \n    new JsonSlurperClassic().parseText(prettyJson)\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#482-\u6d41\u6c34\u7ebf\u4e2d\u4f7f\u7528\u51ed\u8bc1","title":"4.8.2 \u6d41\u6c34\u7ebf\u4e2d\u4f7f\u7528\u51ed\u8bc1","text":"<pre><code>withCredentials([string(credentialsId: \"xxxxx\", variable: \"sonarToken\")]) {\n    println(sonarToken)\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#483-\u4ee3\u7801\u7ba1\u7406-\u4e0b\u8f7d\u4ee3\u7801","title":"4.8.3 \u4ee3\u7801\u7ba1\u7406-\u4e0b\u8f7d\u4ee3\u7801","text":"<pre><code>//Git\ncheckout([$class: 'GitSCM', branches: [[name: \"brnachName\"]], \n            doGenerateSubmoduleConfigurations: false, \n            extensions: [], submoduleCfg: [], \n            userRemoteConfigs: [[credentialsId: \"${credentialsId}\", \n            url: \"${srcUrl}\"]]])\n//Svn\ncheckout([$class: 'SubversionSCM', additionalCredentials: [], \n            filterChangelog: false, ignoreDirPropChanges: false, \n            locations: [[credentialsId: \"${credentialsId}\", \n            depthOption: 'infinity', ignoreExternalsOption: true, \n            remote: \"${svnUrl}\"]], workspaceUpdater: [$class: 'CheckoutUpdater']]\n)\n</code></pre> <p>\u62c9\u53d6\u4ed3\u5e93\u5206\u652f</p> <pre><code>stage('pull master code') {\n    options { retry(3) }\n    steps {\n        checkout([$class: 'GitSCM', branches: [[name: \"${RELEASE_VERSION}\"]], \n        extensions: [\n          [$class: 'CleanBeforeCheckout', deleteUntrackedNestedRepositories: true]],\n        userRemoteConfigs: [[credentialsId: \"${GIT_AUTH}\", url: \"${GIT_ADDRESS}\"]]])\n        }\n}\n</code></pre> <p>\u62c9\u53d6\u4ed3\u5e93pull-request\u5206\u652f\u4e0b\u7684\u76ee\u5f55\u6216\u8005\u6587\u4ef6</p> <pre><code>stage('pull pr branch config') {\n  options { retry(3) }\n  steps {\n      checkout([$class: 'GitSCM',\n          branches: [[name: \"pull/${giteePullRequestIid}/MERGE\"]], doGenerateSubmoduleConfigurations: false, submoduleCfg: [],\n          extensions: [\n              [$class: 'CleanBeforeCheckout', deleteUntrackedNestedRepositories: true],\n              [$class: 'SparseCheckoutPaths', sparseCheckoutPaths:[[$class:'SparseCheckoutPath', path:'config/']]],\n              [$class: 'CloneOption', depth: 1, noTags: true, shallow: true, honorRefspec: true]],\n          userRemoteConfigs: [[credentialsId: \"${GIT_AUTH}\", name: 'origin', refspec: '+refs/pull/${giteePullRequestIid}/MERGE:refs/pull/${giteePullRequestIid}/MERGE', url: \"${GIT_ADDRESS}\"]]\n      ])\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#49-groovy\u7f16\u7a0b","title":"4.9 Groovy\u7f16\u7a0b","text":"<p>\u53c2\u8003\u6587\u6863</p> <p>http://docs.groovy-lang.org/docs/latest/html/documentation/#_map_coercion</p> <p>http://groovy-lang.org/groovy-dev-kit.html</p> <p>Groovy\u662f\u4e00\u79cd\u529f\u80fd\u5f3a\u5927\uff0c\u53ef\u9009\u7c7b\u578b\u548c\u52a8\u6001\u8bed\u8a00\uff0c\u652f\u6301Java\u5e73\u53f0\u3002\u65e8\u5728\u63d0\u9ad8\u5f00\u53d1\u4eba\u5458\u7684\u751f\u4ea7\u529b\u5f97\u76ca\u4e8e\u7b80\u6d01\uff0c\u719f\u6089\u4e14\u7b80\u5355\u6613\u5b66\u7684\u8bed\u6cd5\u3002</p> <p>\u53ef\u4ee5\u4e0e\u4efb\u4f55Java\u7a0b\u5e8f\u987a\u5229\u96c6\u6210\uff0c\u5e76\u7acb\u5373\u4e3a\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5f3a\u5927\u7684\u529f\u80fd\uff0c\u5305\u62ec\u811a\u672c\u7f16\u5199\u529f\u80fd\uff0c\u7279\u5b9a\u9886\u57df\u8bed\u8a00\u7f16\u5199\uff0c\u8fd0\u884c\u65f6\u548c\u7f16\u8bd1\u65f6\u5143\u7f16\u7a0b\u4ee5\u53ca\u51fd\u6570\u5f0f\u7f16\u7a0b\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1\u5b89\u88c5","title":"1.\u5b89\u88c5","text":"<ul> <li>\u4e0b\u8f7d\u5b89\u88c5\u5305(\u5148\u5b89\u88c5JDK)</li> <li>\u89e3\u538b\u5b89\u88c5\u5305 \u83b7\u53d6\u5b89\u88c5\u5305bin\u76ee\u5f55 </li> <li>\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u5199\u5165/etc/profile\u6587\u4ef6</li> </ul> <p>\u5b89\u88c5\u5305\u4e0b\u8f7d\u5730\u5740\uff1a https://groovy.apache.org/download.html</p> <p>JDK\u5b89\u88c5</p> <p>JDK(Java Development Kit)\u662fSun Microsystems\u9488\u5bf9Java\u5f00\u53d1\u5458\u7684\u4ea7\u54c1\u3002 \u81ea\u4eceJava\u63a8\u51fa\u4ee5\u6765\uff0cJDK\u5df2\u7ecf\u6210\u4e3a\u4f7f\u7528\u6700\u5e7f\u6cdb\u7684Java SDK. JDK\u662f\u6574\u4e2aJava\u7684\u6838\u5fc3\uff0c\u5305\u62ec\u4e86Java\u8fd0\u884c\u73af\u5883\uff0cJava\u5de5\u5177\u548cJava\u57fa\u7840\u7684\u7c7b\u5e93\u3002</p> <p>JDK\u4e0b\u8f7d\u9762\u9875\uff1a</p> <p>http://www.oracle.com/technetwork/java/javase/downloads/index.html</p> <pre><code># Linux\u4e2d\u4f7f\u7528wget\u4e0b\u8f7d\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a\nwget --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie\" \"http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz\"\n# \u6216\nwget ftp://biguser:www.jb51.net@gw.086o2i.cn:8021/201704/tools/jdk-linux-x64.tar.gz\ntar zxvf jdk-linux-x64.tar.gz\nmv jdk1.8.0_131/ /usr/local/jdk1.8\n\n# \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\nvim /etc/profile\n# \u5728\u672b\u5c3e\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9:\nexport JAVA_HOME=/usr/local/jdk1.8\nexport CLASSPATH=$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH:$HOMR/bin\n\n# \u4fdd\u5b58\u6587\u4ef6\u540e\uff0c\u4f7f\u5176\u751f\u6548:\nsource /etc/profile\n\n# \u68c0\u6d4b\u662f\u5426\u8bbe\u7f6e\u6b63\u786e:\njava -versio\n</code></pre> <p>\u914d\u7f6eGroovy\u73af\u5883\u53d8\u91cf</p> <pre><code>vi /etc/profile\nexport GROOVY_HOME=/usr/local/groovy-3.0.7/\nexport PATH=$PATH:$GROOVY_HOME/bin\n\nsource /etc/profile\ngroovysh\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>Jenkins\u7cfb\u521708-Pipeline</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#5-devops\u5e73\u53f0\u5efa\u8bbe","title":"5. DevOps\u5e73\u53f0\u5efa\u8bbe","text":"<p>\u672c\u8282\u4ecb\u7ecd\u6301\u7eed\u96c6\u6210\u3001\u6301\u7eed\u90e8\u7f72\u7684\u6b65\u9aa4\u53ca\u8fc7\u7a0b\uff0c\u4e3b\u8981\u8bb2\u89e3\u5982\u4f55\u57fa\u4e8eKubernetes\u548cJenkins\u642d\u5efaDevOps\u5e73\u53f0\u3001\u5982\u4f55\u5728Kubernetes\u4e2d\u53d1\u7248\u3001DevOps\u5e73 \u53f0\u7528\u5230\u7684\u5de5\u5177\u7684\u5b89\u88c5\u4ee5\u53ca\u57fa\u4e8eKubernetes\u548cJenkins\u7684CI/CD\u8fc7\u7a0b\u3002</p> <p>\u5728Kubernetes\u4e2d\u8fdb\u884cCI/CD\u7684\u8fc7\u7a0b\uff0c\u4e00\u822c\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u5728GitLab\u4e2d\u521b\u5efa\u5bf9\u5e94\u7684\u9879\u76ee\u3002</p> </li> <li> <p>\u914d\u7f6eJenkins\u96c6\u6210Kubernetes\u96c6\u7fa4 \uff0c \u540e\u671fJenkins\u7684Slave\u4e3a\u5728Kubernetes\u4e2d\u52a8\u6001\u521b\u5efa\u7684Slave\u3002</p> </li> <li> <p>Jenkins\u521b\u5efa\u5bf9\u5e94\u7684\u4efb\u52a1(Job)\uff0c\u96c6\u6210\u8be5\u9879\u76ee\u7684Git\u5730\u5740\u548cKubernetes\u96c6\u7fa4\u3002</p> </li> <li> <p>\u5f00\u53d1\u8005\u5c06\u4ee3\u7801\u63d0\u4ea4\u5230GitLab\u3002</p> </li> <li> <p>\u82e5\u914d\u7f6e\u4e86\u94a9\u5b50\uff0c\u5219\u63a8\u9001\uff08Push\uff09\u4ee3\u7801\u4f1a\u81ea\u52a8\u89e6\u53d1Jenkins\u6784\u5efa\uff0c\u82e5\u6ca1\u6709\u914d\u7f6e\u94a9\u5b50\uff0c\u5219\u9700\u8981\u624b\u52a8\u6784\u5efa\u3002</p> </li> <li> <p>Jenkins\u63a7\u5236Kubernetes\uff08\u4f7f\u7528\u7684\u662fKubernetes\u63d2\u4ef6\uff09\u521b\u5efaJenkinsSlave\uff08Pod\u5f62\u5f0f\uff09\u3002</p> </li> <li> <p>Jenkins Slave\u6839\u636e\u6d41\u6c34\u7ebf\u5b9a\u4e49\u7684\u6b65\u9aa4\u6267\u884c\u6784\u5efa\u3002</p> </li> <li> <p>\u901a\u8fc7Dockerfile\u751f\u6210\u955c\u50cf\u3002</p> </li> <li> <p>\u5c06\u955c\u50cf\u63d0\u9001\u5230\u79c1\u6709Harbor\uff08\u6216\u8005\u5176\u4ed6\u7684\u955c\u50cf\u4ed3\u5e93\uff09\u3002</p> </li> <li> <p>Jenkins\u518d\u6b21\u63a7\u5236Kubernetes\u8fdb\u884c\u6700\u65b0\u7684\u955c\u50cf\u90e8\u7f72\u3002</p> </li> <li> <p>\u6d41\u6c34\u7ebf\u7ed3\u675f\uff0c\u5220\u9664Jenkins Slave\u3002</p> </li> </ol> <p>\u4e0a\u8ff0\u4e3a\u6bd4\u8f83\u5e38\u7528\u7684\u6b65\u9aa4\uff0c\u4e2d\u95f4\u8fd8\u53ef\u80fd\u6d89\u53ca\u81ea\u52a8\u5316\u6d4b\u8bd5\u7b49\u5176\u4ed6\u6b65\u9aa4\uff0c\u53ef\u81ea\u884c\u6839\u636e\u4e1a\u52a1\u573a\u666f\u6dfb\u52a0\u6216\u5220\u9664\u3002</p> <p>\u4e0a\u8ff0\u6d41\u6c34\u7ebf\u6b65\u9aa4\u4e00\u822c\u5199\u5728Jenkinsfile\u4e2d\uff0cJenkins\u4f1a\u81ea\u52a8\u8bfb\u53d6\u8be5\u6587\u4ef6\uff0c\u540c\u65f6Jenkinsfile\u548cDockerfile\u53ef\u4e00\u5e76\u548c\u4ee3\u7801\u653e \u7f6e\u4e8eGitLab\u4e2d\uff0c\u53ef\u4ee5\u548c\u4ee3\u7801\u4e00\u6837\u5b9e\u73b0\u7248\u672c\u63a7\u5236\uff0c\u5355\u72ec\u914d\u7f6e\u4e5f\u53ef\u4ee5</p> <p>\u4e0b\u56fe\u662f\u6211\u4eec\u5f53\u524d\u793a\u4f8b\u7684\u6d41\u7a0b\u56fe</p> <p></p> <p></p> <p>\u751f\u4ea7\u73af\u5883CICD\u6d41\u7a0b</p> <p></p> <p>\u4e86\u89e3\u4e86\u57fa\u4e8eKubernetes\u548cJenkins\u7684\u53d1\u7248\u6d41\u7a0b\u540e\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u4e00\u6b65\u4e00\u6b65\u5b89\u88c5\u6240\u9700\u8981\u7684\u5de5\u5177\uff0c\u4e4b\u540e\u5373\u53ef\u5f00\u59cbCI/CD\u7684\u5b66\u4e60\u3002\u5982\u679c\u516c\u53f8\u5185\u5df2\u7ecf\u6709\u53ef\u4ee5\u7528\u6765\u8054\u7cfb\u7684\u5e73\u53f0\uff0c\u53ef\u4ee5\u4e0d\u5b89\u88c5\u8fd9\u4e9b\u5de5\u5177\u3002</p> <p>\u5efa\u8bbeDevOps\u5e73\u53f0\u9700\u8981\u5efa\u8bbe\u5982\u4e0b\u670d\u52a1</p> <ul> <li>Jenkins </li> <li>GitLab </li> <li>Harbor </li> <li>Coredns</li> </ul> <p>\u53ef\u4ee5\u5b89\u88c5\u5728Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5355\u72ec\u90e8\u7f72\uff0c</p> <p>\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u9009\u62e9\u76f4\u63a5\u5728\u5355\u72ec\u7684\u673a\u5668\u4e0a\u90e8\u7f72\uff0c\u8fd9\u662f\u4f01\u4e1a\u5e38\u7528\u7684\u4e00\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#51--\u5b89\u88c5jenkins","title":"5.1  \u5b89\u88c5Jenkins","text":""},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-\u670d\u52a1\u65b9\u5f0f","title":"1. \u670d\u52a1\u65b9\u5f0f","text":"centosdebian/ubuntuwardocker <pre><code># Step 1: Install Java\n$ sudo yum install fontconfig java-11-openjdk\n\n# Step 2: Add Jenkins Repository\n$ sudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key\n\n# Step 3: Add Jenkins repo to the system\n$ sudo cat &lt;&lt;EOF &gt; /etc/yum.repos.d/jenkins.repo\n[jenkins]\nname=Jenkins\nbaseurl=http://pkg.jenkins.io/redhat-stable\ngpgcheck=1\nEOF\n# Step 4: Install Jenkins\n$ sudo yum install Jenkins\n\n# Step 5: Verify installation\n$ sudo systemctl status Jenkins\n\n# Step 6: Once Jenkins is up and running, access it from the link:\n# http://localhost:8080\n</code></pre> <pre><code># Step 1: Install Java\n$ sudo apt update\n$ sudo apt install fontconfig openjdk-11-jre\n\n# Step 2: Add Jenkins Repository\n$ curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo tee \\\n/usr/share/keyrings/jenkins-keyring.asc &gt; /dev/null\n\n# Step 3: Add Jenkins repo to the system\n$ echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \\\nhttps://pkg.jenkins.io/debian-stable binary/ | sudo tee \\\n/etc/apt/sources.list.d/jenkins.list &gt; /dev/null\n\n# Step 4: Install Jenkins\n$ sudo apt update\n$ sudo apt install Jenkins\n\n# Step 5: Verify installation\n$ systemctl status Jenkins\n\n# Step 6: Once Jenkins is up and running, access it from the link:\n# http://localhost:8080\n</code></pre> <pre><code>$ sudo yum install fontconfig java-11-openjdk\n$ sudo wget https://get.jenkins.io/war-stable/2.375.1/jenkins.war\n$ sudo java -jar jenkins.war\n\n# http://localhost:8080\n</code></pre> <pre><code>$ sudo mkdir -p /data/jenkins\n$ sudo docker run \\\n--name jenkins \\\n-p 8080:8080 \\\n-p 50000:50000 \\\n--env JENKINS_ADMIN_ID=admin \\\n--env JENKINS_ADMIN_PASSWORD=password \\\n--restart always \\\n-v /data/jenkins:/var/jenkins_home \\\njenkins:jenkins\n\n# http://localhost:8080\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-docker-master-slave\u65b9\u5f0f\u90e8\u63a8\u8350","title":"2. docker-master-slave\u65b9\u5f0f\u90e8(\u63a8\u8350)","text":"<p>\u9996\u5148\u9700\u8981\u4e00\u4e2aLinux\u670d\u52a1\u5668\uff0c\u914d\u7f6e\u4e0d\u4f4e\u4e8e2\u6838CPU\u30014GB\u5185\u5b58\u548c40GB\u7684\u786c\u76d8\u3002\u9996\u5148\u5b89\u88c5docker\u548cdocker-compose</p> <p>docker\u5b89\u88c5</p> <pre><code>$ wget https://download.docker.com/linux/static/stable/aarch64/docker-20.10.9.tgz\n$ tar zxf docker-20.10.9.tgz\n$ cp docker/* /usr/bin\n$ cat &gt;/lib/systemd/system/docker.service &lt;&lt;EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service\nWants=network-online.target\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd\nExecReload=/bin/kill -s HUP $MAINPID\nLimitNOFILE=infinity\nLimitNPROC=infinity\nTimeoutStartSec=0\nDelegate=yes\nKillMode=process\nRestart=on-failure\nStartLimitBurst=3\nStartLimitInterval=60s\n[Install]\nWantedBy=multi-user.target\nEOF\n$ systemctl daemon-reload\n$ systemctl start docker $ docker version\n\n# \u5982\u679c\u955c\u50cf\u4ed3\u5e93\u672a\u914d\u7f6e\u8bc1\u4e66\uff0c\u5219\u9700\u8981\u914d\u7f6einsecure-registry\uff1a\n$ cat &gt; /etc/docker/daemon.json &lt;&lt;'EOF'\n{\n  \"graph\": \"/data/docker\",\n  \"storage-driver\": \"overlay2\",\n  \"insecure-registries\": [\"hub.gitee.cc\"],\n  \"registry-mirrors\": [\"https://25bxwt20.mirror.aliyuncs.com\"],\n  \"live-restore\": true,\n  \"bip\": \"172.16.200.1/24\",\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"hosts\": [\"tcp://0.0.0.0:2375\", \"unix:///var/run/docker.sock\"],\n  \"log-opts\": {\n    \"max-size\":\"100M\",\n    \"max-file\":\"3\"\n  }\n}\nEOF\n$ systemctl restart docker\n</code></pre> <p>docker-compose\u5b89\u88c5</p> <pre><code>$ sudo curl -L https://get.daocloud.io/docker/compose/releases/download/v2.4.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose\n\n$ sudo chmod +x /usr/local/bin/docker-compose\n$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\n$ docker-compose version\nDocker Compose version v2.4.1\n</code></pre> <p>\u7ec4\u6210\u90e8\u5206</p> <ul> <li>master \u63a5\u6536 webhook \uff0c\u8c03\u5ea6\u4efb\u52a1\u7b49</li> <li>agent \u6267\u884c\u6784\u5efa\u4efb\u52a1</li> <li>dind \u6784\u5efa\u955c\u50cf</li> </ul> <p>\u5f00\u59cb\u90e8\u7f72</p> <p>\u4ed3\u5e93\u5730\u5740\uff1a https://gitee.com/hujianli94net/simple-jenkins.git</p> <p>\u90e8\u7f72 master</p> <ul> <li>\u4fee\u6539\u6301\u4e45\u5316\u76ee\u5f55\u5c5e\u4e3b\u4e3a 1000:1000</li> </ul> <pre><code>mkdir devops &amp;&amp; cd devops\ngit clone https://gitee.com/hujianli94net/simple-jenkins.git\ncd simple-jenkins/jenkins/master\nchown -R 1000:1000 jenkins_home\nchown -R 1000:1000 init.groovy.d\n</code></pre> <ul> <li>\u6267\u884c docker-compose \u547d\u4ee4\u5b8c\u6210\u90e8\u7f72</li> </ul> <p>\u521b\u5efa docker network</p> <pre><code>docker network create -d bridge jenkins-cluster\n</code></pre> <p>\u542f\u52a8</p> <pre><code>docker-compose up -d\n</code></pre> <ul> <li>\u5b8c\u6210\u521d\u59cb\u5316\u5e76\u5b89\u88c5\u63d2\u4ef6</li> </ul> <p>blueocean \u955c\u50cf\u5df2\u5305\u542b\u5e38\u7528\u63d2\u4ef6\uff0c\u5728\u9996\u6b21\u8bbf\u95ee Jenkins \u65f6\uff0c\u9009\u62e9\u5b89\u88c5\u63a8\u8350\u63d2\u4ef6\u5373\u53ef\u3002</p> <p>\u5728\u5b89\u88c5\u4e4b\u524d\u5148\u914d\u7f6e\u56fd\u5185\u7684\u63d2\u4ef6\u6e90\uff0c\u5355\u51fbAdvanced\uff0c\u5c06\u63d2\u4ef6\u6e90\u66f4\u6539\u4e3a\u56fd\u5185\u63d2\u4ef6\u6e90(https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json\uff09</p> <p>\u521d\u59cb\u5316\u5b8c\u6210\u540e\uff0c\u767b\u5f55 Jenkins \uff0c\u8fdb\u5165\u201c\u7cfb\u7edf\u7ba1\u7406-&gt;\u63d2\u4ef6\u7ba1\u7406-&gt;\u53ef\u9009\u63d2\u4ef6\u201d \u5728\u641c\u7d22\u6846\u641c\u7d22\u5982\u4e0b\u63d2\u4ef6\u5b89\u88c5\u3002</p> <ul> <li>Git Parameter</li> <li>Build With Parameters</li> <li>Timestamper</li> <li>Git Pipeline for Blue Ocean</li> <li>GitLab</li> <li>GitLab Authentication</li> <li>GitLab Branch Source</li> <li>Generic Webhook Trigger</li> <li>Image Tag Parameter</li> <li> <p>Workspace Cleanup</p> </li> <li> <p>Role-based Authorization Strategy</p> </li> <li>Email Extension Template</li> <li>Git Pipeline for Blue Ocean</li> <li>Pipeline: GitHub</li> <li>Blue Ocean </li> <li>Blue Ocean Pipeline Editor</li> <li>Web for Blue Ocean</li> <li>Blue Ocean Core JS</li> <li>Pipeline SCM API for Blue Ocean</li> <li>Dashboard for Blue Ocean</li> <li>Build With Parameters</li> <li>Dynamic Extended Choice Parameter Plug-In</li> <li>Extended Choice Parameter</li> <li>List Git Branches Parameter</li> <li>Pipeline</li> <li>Pipeline: Deprecated Groovy Libraries</li> <li>SSH Pipeline Steps</li> <li>Kubernetes</li> <li>Kubernetes CLI</li> <li>Kubernetes Credentials</li> <li>Kubernetes Client API</li> <li>Active Choices</li> <li>Design Language</li> <li>REST API for Blue Ocean</li> <li>REST Implementation for Blue Ocean</li> </ul> <p>\u52fe\u9009\u540e\uff0c\u5355\u51fbDownload now and install after restart\uff0c\u4e4b\u540e\u53ef\u4ee5\u5728Installed\u9009\u9879\u5361\u4e0b\u770b\u5230\u5df2\u7ecf\u5b89\u88c5\u7684\u63d2\u4ef6\u3002</p> <ul> <li>\u914d\u7f6e Gitee \u63d2\u4ef6</li> </ul> <p>\u5b8c\u6210 gitee \u63d2\u4ef6\u5b89\u88c5\u540e\uff0c\u8fdb\u5165\u201c\u7cfb\u7edf\u7ba1\u7406-&gt;\u7cfb\u7edf\u914d\u7f6e\u201d\uff0c\u5b9a\u4f4d\u5230 \u201cGitee \u914d\u7f6e\u201d \u90e8\u5206\uff0c\u521b\u5efa\u8bc1\u4e66\u4ee4\u724c\uff08\u9700\u8981\u5148\u5728 Gitee \u521b\u5efa Gitee API V5 \u7684\u79c1\u4eba\u4ee4\u724c\uff09\uff0c\u5e76\u5b8c\u6210\u914d\u7f6e\u3002</p> <p></p> <p></p> <p>\u70b9\u51fb\u6d4b\u8bd5\u8fde\u63a5\u3002\u663e\u793a\u6210\u529f\u5c31\u4fdd\u5b58\uff0c\u7ee7\u7eed\u5f80\u540e\u64cd\u4f5c</p> <p></p> <ul> <li>\u65b0\u5efa agent</li> </ul> <p>\u8fdb\u5165 \u201c\u7cfb\u7edf\u7ba1\u7406-&gt;\u8282\u70b9\u5217\u8868\u201d \uff0c\u70b9\u51fb\u65b0\u5efa\u8282\u70b9</p> <p>\u521b\u5efa\u4e24\u4e2a\u201c\u56fa\u5b9a\u8282\u70b9\u201d\uff0c\u8282\u70b9\u914d\u7f6e\u5982\u4e0b</p> <p></p> <p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u8282\u70b9\uff0c\u67e5\u770b\u8282\u70b9\u8fde\u63a5\u4fe1\u606f\uff0c\u90e8\u7f72 agent \u65f6\u9700\u8981\u63d0\u4f9b\u8be5\u8fde\u63a5\u4fe1\u606f</p> <p></p> <p></p> <p>\u90e8\u7f72 agent</p> <ul> <li>\u6784\u5efa\u81ea\u5b9a\u4e49 agent \u955c\u50cf</li> </ul> <p>\u4e0b\u8f7d kubectl \u3001 docker \u3001 helm \u4e8c\u8fdb\u5236\u6587\u4ef6</p> <p>docker\u4e8c\u8fdb\u5236\u4e0b\u8f7d\u5730\u5740</p> <p>https://download.docker.com/linux/static/stable/x86_64/</p> <pre><code>$ cd jenkins/agent/bin\n\n## \u4e0b\u8f7dhelm\n$ wget -c https://repo.huaweicloud.com/helm/v3.8.0/helm-v3.8.0-linux-386.tar.gz\n\n## \u4f8b\u5982\uff0c\u8981\u5728 Linux \u4e2d\u4e0b\u8f7d v1.21.0 \u7248\u672c\uff0c\u8bf7\u8f93\u5165\uff1a\n$ curl -LO https://dl.k8s.io/release/v1.21.0/bin/linux/amd64/kubectl\n\n$ chmod +x *\n\n# ll\ntotal 134552\n-rwxr-xr-x 1 root root 50707288 Feb 14 16:45 docker\n-rwxr-xr-x 1 3434 3434 40636416 Jan 25  2022 helm\n-rwxr-xr-x 1 root root 46436352 Feb 14 16:44 kubectl\n</code></pre> <p>\u51c6\u5907 .kube \u548c .docker \u6587\u4ef6\u5939\uff0c\u7528\u4e8e\u6388\u6743\u8bbf\u95ee kubernetes api-server \u548c harbor \u955c\u50cf\u4ed3\u5e93</p> <p><code>.kube/config</code> \u4ece kubernetes \u96c6\u7fa4\u5185\u83b7\u53d6,</p> <p>\u521b\u5efa <code>.docker/config.json</code></p> <pre><code>harbor_addr=hub.gitee.cc\nharbor_username=admin\nharbor_password=oschina123\nauth_str=$(echo -ne \"$harbor_username:$harbor_password\" | base64)\ncat &gt; .docker/config.json &lt;&lt;EOF\n{\n        \"auths\": {\n                \"$harbor_addr\": {\n                        \"auth\": \"$auth_str\"\n                }\n        }\n}\nEOF\n</code></pre> <p>docker build agent \u955c\u50cf</p> <pre><code>$ docker build -t $harbor_addr/jenkins/inbound-agent:4.11-1-kube .\n\n# \u63a8\u9001\u955c\u50cf\u5230harbor\u4ed3\u5e93\uff0chabor\u4ed3\u5e93\u9700\u8981\u63d0\u524d\u90e8\u7f72\n$ docker push $harbor_addr/jenkins/inbound-agent:4.11-1-kube\n</code></pre> <ul> <li>\u6267\u884c docker-compose \u547d\u4ee4\u5b8c\u6210\u90e8\u7f72</li> </ul> <p>\u4fee\u6539 docker-compose.yml \u4e2d\u7684 secret \u4e2a agent_name \uff0c\u5bf9\u5e94\u4e8e\u4e0a\u9762 master \u4e2d\u521b\u5efa\u7684\u8282\u70b9\u8fde\u63a5\u4fe1\u606f</p> <pre><code>$ chown -R 1000:1000 /root/devops/simple-jenkins/jenkins/agent/\n$ docker-compose up -d\n</code></pre> <p>\u90e8\u7f72 dind</p> <ul> <li>\u521b\u5efa daemon.json</li> </ul> <pre><code>$ cd dind\n$ harbor_addr=hub.gitee.cc\n$ dns_addr=192.168.1.60\n$ cat &gt; etc/daemon.json &lt;&lt;EOF\n{\n  \"registry-mirrors\": [\"https://gfty7g09.mirror.aliyuncs.com\"],\n  \"insecure-registries\": [\"$harbor_addr\"],\n  \"live-restore\": true,\n  \"default-shm-size\": \"128M\",\n  \"max-concurrent-downloads\": 10,\n  \"oom-score-adjust\": -1000,\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"100m\"\n  },\n  \"dns\": [\n    \"$dns_addr\"\n  ]\n}\nEOF\n</code></pre> <ul> <li>\u6267\u884c docker-compose \u547d\u4ee4\u5b8c\u6210\u90e8\u7f72</li> </ul> <pre><code>$ docker-compose up -d\n</code></pre> <p>\u67e5\u770b\u6240\u6709\u5bb9\u5668</p> <pre><code>$ docker ps\nCONTAINER ID   IMAGE                                            COMMAND                  CREATED              STATUS              PORTS                                                                                      NAMES\n425c73c120ec   docker:20.10.10-dind                             \"dockerd-entrypoint.\u2026\"   36 seconds ago       Up 16 seconds       2375-2376/tcp                                                                              dind-docker01-1\n89f9bcfd1f12   docker:20.10.10-dind                             \"dockerd-entrypoint.\u2026\"   36 seconds ago       Up 16 seconds       2375-2376/tcp                                                                              dind-docker02-1\n6bd628bfba16   hub.gitee.cc/jenkins/inbound-agent:4.11-1-kube   \"/usr/local/bin/jenk\u2026\"   About a minute ago   Up About a minute                                                                                              agent-agent02-1\n171340672a53   hub.gitee.cc/jenkins/inbound-agent:4.11-1-kube   \"/usr/local/bin/jenk\u2026\"   About a minute ago   Up About a minute                                                                                              agent-agent01-1\n0e4f1c2ca769   jenkins/jenkins:2.390-jdk11                      \"/usr/bin/tini -- /u\u2026\"   11 minutes ago       Up 11 minutes       0.0.0.0:8080-&gt;8080/tcp, :::8080-&gt;8080/tcp, 0.0.0.0:50000-&gt;50000/tcp, :::50000-&gt;50000/tcp   jenkins-master\n</code></pre> <p>\u5b8c\u6210</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#3-helm\u65b9\u5f0f\u90e8\u7f72\u63a8\u8350","title":"3. helm\u65b9\u5f0f\u90e8\u7f72(\u63a8\u8350)","text":""},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#31-\u90e8\u7f72nfs","title":"3.1 \u90e8\u7f72nfs","text":"<p>\u51c6\u5907\u4e00\u5757&gt;2T\u7684\u6570\u636e\u76d8\uff0c\u683c\u5f0f\u5316\u540e\u6302\u8f7d\u5230/data\u76ee\u5f55\u4e0b\u3002/data\u76ee\u5f55\u4e3anfs\u7684\u6570\u636e\u76ee\u5f55\u3002</p> <p>\u76f4\u63a5\u547d\u4ee4\u5b89\u88c5\uff0c\u793a\u4f8b\u5982\u4e0b</p> <pre><code>$ docker run -d --name nfs --privileged -v /data:/nfsshare -e SHARED_DIRECTORY=/nfsshare itsthenetwork/nfs-server-alpine:latest\n</code></pre> <p>docker-compose\u90e8\u7f72</p> <p><code>docker-compose.yaml</code></p> <pre><code>---\nversion: '3'\nservices:\nnfs:\nimage: atompi/nfs-server:9\nrestart: always\nports:\n- \"2049:2049\"\nvolumes:\n- /data/nfs:/nfsshare\nenvironment:\n- SHARED_DIRECTORY=/nfsshare\nprivileged: yes\n</code></pre> <p>\u53ef\u53c2\u8003\u6587\u732e</p> <p>https://github.com/ehough/docker-nfs-server.git</p> <p>https://github.com/sjiveson/nfs-server-alpine</p> <p>https://gitee.com/atompi/nfs-server-docker</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#32-\u90e8\u7f72storageclass","title":"3.2 \u90e8\u7f72StorageClass","text":"<p>GitHub \u5730\u5740\uff1ahttps://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</p> <p>Chart \u4ed3\u5e93\u5730\u5740\uff1ahttps://artifacthub.io/packages/helm/nfs-subdir-external-provisioner/nfs-subdir-external-provisioner</p> <p>nfs-subdir-external-provisioner\u4f7f\u7528\u65b9\u6cd5</p> <pre><code>$ helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/\n$ helm repo update\n\n# \u53ef\u4ee5\u4e0b\u8f7d\u5230\u672c\u5730\u79bb\u7ebf\u5b89\u88c5\n# helm pull nfs-subdir-external-provisioner/nfs-subdir-external-provisioner --version 4.0.17 --untar\n# \u9ed8\u8ba4\u955c\u50cf\nhelm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner\n--set nfs.server=172.18.0.95 \\\n--set nfs.path=/gitee \\\n--set storageClass.name=gitee-nfs-client \\\n--set storageClass.reclaimPolicy=\"Retain\" \\\n--namespace nfs-sc --create-namespace\n\n# --------------------- \u8ba4\u955c\u50cf\u4e0b\u8f7d\u7f51\u7edc\u53d7\u9650\uff0c\u4f7f\u7528\u4e2d\u56fd\u5185\u90e8\u955c\u50cf ------------------------------------\nhelm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \\\n--set image.repository=easzlab/nfs-subdir-external-provisioner \\\n--set image.tag=v4.0.2 \\\n--set nfs.server=192.168.1.60 \\\n--set nfs.path=/QaTest \\\n--set storageClass.name=gitee-nfs-client \\\n--set storageClass.reclaimPolicy=\"Retain\" \\\n--namespace nfs-sc --create-namespace\n</code></pre> <p>\u68c0\u67e5StorageClass\u90e8\u7f72\u72b6\u6001</p> <pre><code>$ kubectl get pod -n nfs-sc\nNAME                                               READY   STATUS    RESTARTS   AGE\nnfs-subdir-external-provisioner-7fdff5bfc9-q28qc   1/1     Running   0          2m49s\n\n$ kubectl get sc\nNAME               PROVISIONER                                     RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\ngitee-nfs-client   cluster.local/nfs-subdir-external-provisioner   Retain          Immediate           true                   2m54s\n\n$ helm list -n nfs-sc\nNAME                            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                                   APP VERSION\nnfs-subdir-external-provisioner nfs-sc          1               2022-10-18 14:41:18.070839496 +0800 CST deployed        nfs-subdir-external-provisioner-4.0.17  4.0.2\n</code></pre> <p>\u5982\u4e0a\u663e\u793a\uff0c\u8868\u793aStorageClass\u542f\u52a8\u6b63\u5e38\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#33--\u90e8\u7f72jenkins","title":"3.3  \u90e8\u7f72jenkins","text":"<p>\u524d\u63d0\u6761\u4ef6\uff1aNFS \u7c7b\u578b\u7684 StorageClass \u6765\u505a\u6301\u4e45\u5316\u5b58\u50a8,  StorageClass \u540d\u79f0<code>gitee-nfs-client</code></p> <p>\u539f\u59cb\u4ed3\u5e93</p> <pre><code>$ helm repo add jenkins https://charts.jenkins.io\n$ helm repo update\n</code></pre> <p>Chart \u4ed3\u5e93\u5730\u5740\uff1ahttps://hujianli94.github.io/mycharts/jenkinsci</p> <p>\u8bbe\u7f6ehelm\u6e90</p> <pre><code>$ helm repo add mycharts https://hujianli94.github.io/mycharts/\n$ helm repo update\n$ helm search repo jenkinsci\nNAME                    CHART VERSION   APP VERSION     DESCRIPTION\nmycharts/jenkinsci      0.1.0           2.390-jdk11     A Helm chart for Kubernetes\n\n$ helm pull mycharts/jenkinsci --version=0.1.0\n$ helm pull mycharts/jenkinsci --version=0.1.0 --untar\n\n# \u4fee\u6539jenkinsci/values.yaml\u914d\u7f6e\n## \u4fee\u6539storageClassName\n## \u4fee\u6539nfs\u4fe1\u606f\n## \u6839\u636e\u8981\u6c42\u8fdb\u884c\u4fee\u6539\n</code></pre> <p>\u4f7f\u7528helm\u8fdb\u884c\u90e8\u7f72</p> <pre><code>$ helm upgrade jenkinsci jenkinsci --install --namespace kube-ops --create-namespace\nRelease \"jenkinsci\" does not exist. Installing it now.\nNAME: jenkinsci\nLAST DEPLOYED: Wed Feb 15 10:04:21 2023\nNAMESPACE: kube-ops\nSTATUS: deployed\nREVISION: 1\nNOTES:\n1. Get the application URL by running these commands:\n  export NODE_PORT=$(kubectl get --namespace kube-ops -o jsonpath=\"{.spec.ports[0].nodePort}\" services jenkinsci)\nexport NODE_IP=$(kubectl get nodes --namespace kube-ops -o jsonpath=\"{.items[0].status.addresses[0].address}\")\necho http://$NODE_IP:$NODE_PORT\n</code></pre> <p>\u67e5\u770b\u90e8\u7f72pod\u7684\u72b6\u6001\u548c\u65e5\u5fd7</p> <pre><code># kubectl get pod,svc,pvc -n kube-ops\nNAME                             READY   STATUS    RESTARTS   AGE\npod/jenkinsci-6465964b6d-rplhl   1/1     Running   0          2m43s\n\nNAME                TYPE       CLUSTER-IP        EXTERNAL-IP   PORT(S)                          AGE\nservice/jenkinsci   NodePort   192.168.105.182   &lt;none&gt;        8080:32080/TCP,50000:32050/TCP   2m43s\n\nNAME                              STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS       AGE\npersistentvolumeclaim/jenkinsci   Bound    jenkinsci   100Gi      RWO            gitee-nfs-client   2m43s\n\n# kubectl exec -it pod/jenkinsci-6465964b6d-rplhl  -n kube-ops -- cat /var/jenkins_home/secrets/initialAdminPassword\n917475173c3746959bcd50d608fb28d7\n\n# kubectl logs -f pod/jenkinsci-6465964b6d-rplhl -n kube-ops\n.....\nJenkins initial setup is required. An admin user has been created and a password generated.\nPlease use the following password to proceed to installation:\n\n917475173c3746959bcd50d608fb28d7\n\nThis may also be found at: /var/jenkins_home/secrets/initialAdminPassword\n\n*************************************************************\n*************************************************************\n*************************************************************\n</code></pre> <p>\u4f7f\u7528Node+NodePort\u7aef\u53e3\u8fdb\u884c\u8bbf\u95ee\uff0c\u4f7f\u7528\u521d\u59cb\u5bc6\u7801\u767b\u5f55\u3002</p> <p>\u5b89\u88c5\u63d2\u4ef6\u914d\u7f6e\u7136\u540e\u57fa\u672c\u73af\u5883\u5176\u4ed6\u64cd\u4f5c\u4e0edocker\u90e8\u7f72\u4e00\u81f4\u3002</p> <p>\u53c2\u8003\u6587\u732e\uff1a</p> <p>https://www.yuque.com/wuyuexin/bu3d95/eikxqa</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#4-yaml\u65b9\u5f0f\u90e8\u7f72\u4e0d\u63a8\u8350","title":"4. yaml\u65b9\u5f0f\u90e8\u7f72(\u4e0d\u63a8\u8350)","text":"<p>\u65e2\u7136\u8981\u57fa\u4e8e Kubernetes \u6765\u505a CI/CD\uff0c\u6211\u4eec\u8fd9\u91cc\u6700\u597d\u8fd8\u662f\u5c06 Jenkins \u5b89\u88c5\u5230 Kubernetes \u96c6\u7fa4\u5f53\u4e2d\uff0c\u5b89\u88c5\u7684\u65b9\u5f0f\u4e5f\u5f88\u591a\uff0c\u6211\u4eec\u8fd9\u91cc\u4ecd\u7136\u8fd8\u662f\u4f7f\u7528\u624b\u52a8\u7684\u65b9\u5f0f\uff0c\u8fd9\u6837\u53ef\u4ee5\u4e86\u89e3\u66f4\u591a\u7ec6\u8282\uff0c\u5bf9\u5e94\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\u5982\u4e0b\u6240\u793a\uff1a</p> <p><code>jenkins-pv.yaml</code></p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\nname: jenkinsci\nlabels:\napp: jenkinsci\nspec:\ncapacity:\nstorage: 100Gi\naccessModes:\n- ReadWriteOnce\npersistentVolumeReclaimPolicy: Retain\nstorageClassName: gitee-nfs-client\nmountOptions:\n- hard\n- nfsvers=4.1\nnfs:\nserver: 192.168.1.60\npath: /QaTest/jenkins\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\nname: jenkins-pvc\nnamespace: kube-ops\nspec:\naccessModes:\n- ReadWriteOnce\nstorageClassName: gitee-nfs-client\nresources:\nrequests:\nstorage: 100Gi\nselector:\nmatchLabels:\napp: jenkinsci\n</code></pre> <p>\u5728storageClassName\u7684\u6307\u5b9a\u76ee\u5f55\u4e0b\u6301\u4e45\u5316\u6570\u636e\uff0c\u8bbe\u7f6e\u6307\u5b9a\u540d\u79f0\u7684\u9759\u6001PV\u548cPVC\u3002</p> <p><code>jenkins.yaml</code></p> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\nname: jenkins\nnamespace: kube-ops\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: jenkins\nrules:\n- apiGroups: [\"extensions\", \"apps\"]\nresources: [\"deployments\", \"ingresses\"]\nverbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"]\n- apiGroups: [\"\"]\nresources: [\"services\"]\nverbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"]\n- apiGroups: [\"\"]\nresources: [\"pods\"]\nverbs: [\"create\", \"delete\", \"get\", \"list\", \"patch\", \"update\", \"watch\"]\n- apiGroups: [\"\"]\nresources: [\"pods/exec\"]\nverbs: [\"create\", \"delete\", \"get\", \"list\", \"patch\", \"update\", \"watch\"]\n- apiGroups: [\"\"]\nresources: [\"pods/log\", \"events\"]\nverbs: [\"get\", \"list\", \"watch\"]\n- apiGroups: [\"\"]\nresources: [\"secrets\"]\nverbs: [\"get\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\nname: jenkins\nnamespace: kube-ops\nroleRef:\napiGroup: rbac.authorization.k8s.io\nkind: ClusterRole\nname: jenkins\nsubjects:\n- kind: ServiceAccount\nname: jenkins\nnamespace: kube-ops\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: jenkins\nnamespace: kube-ops\nspec:\nselector:\nmatchLabels:\napp: jenkins\ntemplate:\nmetadata:\nlabels:\napp: jenkins\nspec:\nserviceAccount: jenkins\ninitContainers:\n- name: fix-permissions\nimage: busybox:1.35.0\ncommand: [\"sh\", \"-c\", \"chown -R 1000:1000 /var/jenkins_home\"]\nsecurityContext:\nprivileged: true\nvolumeMounts:\n- name: jenkinshome\nmountPath: /var/jenkins_home\ncontainers:\n- name: jenkins\nimage: jenkins/jenkins:2.390-jdk11\nimagePullPolicy: IfNotPresent\nenv:\n- name: JAVA_OPTS\nvalue: -Dhudson.model.DownloadService.noSignatureCheck=true\nports:\n- containerPort: 8080\nname: web\nprotocol: TCP\n- containerPort: 50000\nname: agent\nprotocol: TCP\nresources:\nlimits:\ncpu: 1500m\nmemory: 2048Mi\nrequests:\ncpu: 1500m\nmemory: 2048Mi\nreadinessProbe:\nhttpGet:\npath: /login\nport: 8080\ninitialDelaySeconds: 60\ntimeoutSeconds: 5\nfailureThreshold: 12\nvolumeMounts:\n- name: jenkinshome\nmountPath: /var/jenkins_home\nvolumes:\n- name: jenkinshome\npersistentVolumeClaim:\nclaimName: jenkins-pvc\n---\napiVersion: v1\nkind: Service\nmetadata:\nname: jenkins\nnamespace: kube-ops\nlabels:\napp: jenkins\nspec:\ntype: NodePort\nselector:\napp: jenkins\nports:\n- name: web\nport: 8080\ntargetPort: web\nnodePort: 32080\n- name: agent\nport: 50000\ntargetPort: agent\nnodePort: 32050\n</code></pre> <p>\u7531\u4e8e\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u7684\u955c\u50cf\u5185\u90e8\u8fd0\u884c\u7684\u7528\u6237 <code>uid=1000</code>\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u6302\u8f7d\u51fa\u6765\u540e\u4f1a\u51fa\u73b0\u6743\u9650\u95ee\u9898\uff0c\u4e3a\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u540c\u6837\u8fd8\u662f\u7528\u4e00\u4e2a\u7b80\u5355\u7684 <code>initContainer</code> \u6765\u4fee\u6539\u4e0b\u6211\u4eec\u6302\u8f7d\u7684\u6570\u636e\u76ee\u5f55\u3002</p> <p>\u6211\u4eec\u76f4\u63a5\u6765\u521b\u5efa jenkins \u7684\u8d44\u6e90\u6e05\u5355\u5373\u53ef\uff1a</p> <pre><code>$ kubectl apply -f jenkins-pv.yaml\n$ kubectl apply -f jenkins.yaml\n$ kubectl get all -n kube-ops\nNAME                          READY   STATUS    RESTARTS   AGE\npod/jenkins-95db8c7dc-d9hrq   1/1     Running   0          7m52s\n\nNAME              TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)                          AGE\nservice/jenkins   NodePort   192.168.59.29   &lt;none&gt;        8080:32080/TCP,50000:32050/TCP   7m52s\n\nNAME                      READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/jenkins   1/1     1            1           7m52s\n\nNAME                                DESIRED   CURRENT   READY   AGE\nreplicaset.apps/jenkins-95db8c7dc   1         1         1       7m52s\n</code></pre> <p>\u7136\u540e\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u89e3\u9501\u7684\u7ba1\u7406\u5458\u5bc6\u7801\uff1a</p> <pre><code>$ kubectl exec -it pod/jenkins-95db8c7dc-d9hrq  -n kube-ops -- cat /var/jenkins_home/secrets/initialAdminPassword\nDefaulted container \"jenkins\" out of: jenkins, fix-permissions (init)\nb9a201f71e67434f828c0fe59a94e460  # jenkins\u542f\u52a8\u65e5\u5fd7\u91cc\u9762\u4e5f\u6709\n</code></pre> <p>\u4f7f\u7528Node+NodePort\u7aef\u53e3\u8fdb\u884c\u8bbf\u95ee\uff0c\u4f7f\u7528\u521d\u59cb\u5bc6\u7801\u767b\u5f55\u3002</p> <p>\u5b89\u88c5\u63d2\u4ef6\u914d\u7f6e\u7136\u540e\u57fa\u672c\u73af\u5883\u5176\u4ed6\u64cd\u4f5c\u4e0edocker\u90e8\u7f72\u4e00\u81f4\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#5-\u67b6\u6784","title":"5. \u67b6\u6784","text":"<p>Jenkins \u5b89\u88c5\u5b8c\u6210\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4e0d\u7528\u6025\u7740\u5c31\u53bb\u4f7f\u7528\uff0c\u6211\u4eec\u8981\u4e86\u89e3\u4e0b\u5728 Kubernetes \u73af\u5883\u4e0b\u9762\u4f7f\u7528 Jenkins \u6709\u4ec0\u4e48\u597d\u5904\u3002</p> <p>\u6211\u4eec\u77e5\u9053\u6301\u7eed\u6784\u5efa\u4e0e\u53d1\u5e03\u662f\u6211\u4eec\u65e5\u5e38\u5de5\u4f5c\u4e2d\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e00\u4e2a\u6b65\u9aa4\uff0c\u76ee\u524d\u5927\u591a\u516c\u53f8\u90fd\u91c7\u7528 Jenkins \u96c6\u7fa4\u6765\u642d\u5efa\u7b26\u5408\u9700\u6c42\u7684 CI/CD \u6d41\u7a0b\uff0c\u7136\u800c\u4f20\u7edf\u7684 Jenkins Slave \u4e00\u4e3b\u591a\u4ece\u65b9\u5f0f\u4f1a\u5b58\u5728\u4e00\u4e9b\u75db\u70b9\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u4e3b Master \u53d1\u751f\u5355\u70b9\u6545\u969c\u65f6\uff0c\u6574\u4e2a\u6d41\u7a0b\u90fd\u4e0d\u53ef\u7528\u4e86</li> <li>\u6bcf\u4e2a Slave \u7684\u914d\u7f6e\u73af\u5883\u4e0d\u4e00\u6837\uff0c\u6765\u5b8c\u6210\u4e0d\u540c\u8bed\u8a00\u7684\u7f16\u8bd1\u6253\u5305\u7b49\u64cd\u4f5c\uff0c\u4f46\u662f\u8fd9\u4e9b\u5dee\u5f02\u5316\u7684\u914d\u7f6e\u5bfc\u81f4\u7ba1\u7406\u8d77\u6765\u975e\u5e38\u4e0d\u65b9\u4fbf\uff0c\u7ef4\u62a4\u8d77\u6765\u4e5f\u662f\u6bd4\u8f83\u8d39\u52b2</li> <li>\u8d44\u6e90\u5206\u914d\u4e0d\u5747\u8861\uff0c\u6709\u7684 Slave \u8981\u8fd0\u884c\u7684 job \u51fa\u73b0\u6392\u961f\u7b49\u5f85\uff0c\u800c\u6709\u7684 Slave \u5904\u4e8e\u7a7a\u95f2\u72b6\u6001</li> <li>\u8d44\u6e90\u6709\u6d6a\u8d39\uff0c\u6bcf\u53f0 Slave \u53ef\u80fd\u662f\u7269\u7406\u673a\u6216\u8005\u865a\u62df\u673a\uff0c\u5f53 Slave \u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u65f6\uff0c\u4e5f\u4e0d\u4f1a\u5b8c\u5168\u91ca\u653e\u6389\u8d44\u6e90\u3002</li> </ul> <p>\u6b63\u56e0\u4e3a\u4e0a\u9762\u7684\u8fd9\u4e9b\u79cd\u79cd\u75db\u70b9\uff0c\u6211\u4eec\u6e34\u671b\u4e00\u79cd\u66f4\u9ad8\u6548\u66f4\u53ef\u9760\u7684\u65b9\u5f0f\u6765\u5b8c\u6210\u8fd9\u4e2a CI/CD \u6d41\u7a0b\uff0c\u800c Docker \u865a\u62df\u5316\u5bb9\u5668\u6280\u672f\u80fd\u5f88\u597d\u7684\u89e3\u51b3\u8fd9\u4e2a\u75db\u70b9\uff0c\u53c8\u7279\u522b\u662f\u5728 Kubernetes \u96c6\u7fa4\u73af\u5883\u4e0b\u9762\u80fd\u591f\u66f4\u597d\u6765\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u4e0b\u56fe\u662f\u57fa\u4e8e Kubernetes \u642d\u5efa Jenkins \u96c6\u7fa4\u7684\u7b80\u5355\u793a\u610f\u56fe\uff1a</p> <p></p> <p>\u4ece\u56fe\u4e0a\u53ef\u4ee5\u770b\u5230 <code>Jenkins Master</code> \u548c <code>Jenkins Slave</code> \u4ee5 Pod \u5f62\u5f0f\u8fd0\u884c\u5728 Kubernetes \u96c6\u7fa4\u7684 Node \u4e0a\uff0cMaster \u8fd0\u884c\u5728\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9\uff0c\u5e76\u4e14\u5c06\u5176\u914d\u7f6e\u6570\u636e\u5b58\u50a8\u5230\u4e00\u4e2a Volume \u4e0a\u53bb\uff0cSlave \u8fd0\u884c\u5728\u5404\u4e2a\u8282\u70b9\u4e0a\uff0c\u5e76\u4e14\u5b83\u4e0d\u662f\u4e00\u76f4\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\uff0c\u5b83\u4f1a\u6309\u7167\u9700\u6c42\u52a8\u6001\u7684\u521b\u5efa\u5e76\u81ea\u52a8\u5220\u9664\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u7684\u5de5\u4f5c\u6d41\u7a0b\u5927\u81f4\u4e3a\uff1a\u5f53 Jenkins Master \u63a5\u53d7\u5230 Build \u8bf7\u6c42\u65f6\uff0c\u4f1a\u6839\u636e\u914d\u7f6e\u7684 Label \u52a8\u6001\u521b\u5efa\u4e00\u4e2a\u8fd0\u884c\u5728 Pod \u4e2d\u7684 Jenkins Slave \u5e76\u6ce8\u518c\u5230 Master \u4e0a\uff0c\u5f53\u8fd0\u884c\u5b8c Job \u540e\uff0c\u8fd9\u4e2a Slave \u4f1a\u88ab\u6ce8\u9500\u5e76\u4e14\u8fd9\u4e2a Pod \u4e5f\u4f1a\u81ea\u52a8\u5220\u9664\uff0c\u6062\u590d\u5230\u6700\u521d\u72b6\u6001\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u5e26\u6765\u4e86\u54ea\u4e9b\u597d\u5904\u5462\uff1f</p> <ul> <li>\u670d\u52a1\u9ad8\u53ef\u7528\uff0c\u5f53 Jenkins Master \u51fa\u73b0\u6545\u969c\u65f6\uff0cKubernetes \u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Jenkins Master \u5bb9\u5668\uff0c\u5e76\u4e14\u5c06 Volume \u5206\u914d\u7ed9\u65b0\u521b\u5efa\u7684\u5bb9\u5668\uff0c\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4ece\u800c\u8fbe\u5230\u96c6\u7fa4\u670d\u52a1\u9ad8\u53ef\u7528\u3002</li> <li>\u52a8\u6001\u4f38\u7f29\uff0c\u5408\u7406\u4f7f\u7528\u8d44\u6e90\uff0c\u6bcf\u6b21\u8fd0\u884c Job \u65f6\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a Jenkins Slave\uff0cJob \u5b8c\u6210\u540e\uff0cSlave \u81ea\u52a8\u6ce8\u9500\u5e76\u5220\u9664\u5bb9\u5668\uff0c\u8d44\u6e90\u81ea\u52a8\u91ca\u653e\uff0c\u800c\u4e14 Kubernetes \u4f1a\u6839\u636e\u6bcf\u4e2a\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u52a8\u6001\u5206\u914d Slave \u5230\u7a7a\u95f2\u7684\u8282\u70b9\u4e0a\u521b\u5efa\uff0c\u964d\u4f4e\u51fa\u73b0\u56e0\u67d0\u8282\u70b9\u8d44\u6e90\u5229\u7528\u7387\u9ad8\uff0c\u8fd8\u6392\u961f\u7b49\u5f85\u5728\u8be5\u8282\u70b9\u7684\u60c5\u51b5\u3002</li> <li>\u6269\u5c55\u6027\u597d\uff0c\u5f53 Kubernetes \u96c6\u7fa4\u7684\u8d44\u6e90\u4e25\u91cd\u4e0d\u8db3\u800c\u5bfc\u81f4 Job \u6392\u961f\u7b49\u5f85\u65f6\uff0c\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u6dfb\u52a0\u4e00\u4e2a Kubernetes Node \u5230\u96c6\u7fa4\u4e2d\uff0c\u4ece\u800c\u5b9e\u73b0\u6269\u5c55\u3002 \u662f\u4e0d\u662f\u4ee5\u524d\u6211\u4eec\u9762\u4e34\u7684\u79cd\u79cd\u95ee\u9898\u5728 Kubernetes \u96c6\u7fa4\u73af\u5883\u4e0b\u9762\u662f\u4e0d\u662f\u90fd\u6ca1\u6709\u4e86\u554a\uff1f\u770b\u4e0a\u53bb\u975e\u5e38\u5b8c\u7f8e\u3002</li> </ul>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-\u914d\u7f6e","title":"1. \u914d\u7f6e","text":"<p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u9700\u8981\u6765\u914d\u7f6e Jenkins\uff0c\u8ba9\u4ed6\u80fd\u591f\u52a8\u6001\u7684\u751f\u6210 Slave \u7684 Pod\u3002</p> <p>\u7b2c 1 \u6b65. \u6211\u4eec\u9700\u8981\u5b89\u88c5 kubernetes \u63d2\u4ef6\uff0c \u70b9\u51fb Manage Jenkins -&gt; Manage Plugins -&gt; Available -&gt; Kubernetes \u52fe\u9009\u5b89\u88c5\u5373\u53ef\u3002</p> <p>\u7b2c 2 \u6b65. \u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u8fdb\u5165configureClouds\u9875\u9762\uff1a</p> <p></p> <p>\u5728\u8be5\u9875\u9762\u6211\u4eec\u53ef\u4ee5\u70b9\u51fb <code>Add a new cloud</code> -&gt; \u9009\u62e9 <code>Kubernetes</code>\uff0c\u9996\u5148\u70b9\u51fb <code>Kubernetes Cloud details...</code> \u6309\u94ae\u8fdb\u884c\u914d\u7f6e\u3002</p> <p>\u9996\u5148\u914d\u7f6e\u8fde\u63a5 Kubernetes APIServer \u7684\u5730\u5740\uff0c\u7531\u4e8e\u6211\u4eec\u7684 Jenkins \u8fd0\u884c\u5728 Kubernetes \u96c6\u7fa4\u4e2d\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528 Service \u7684 DNS \u5f62\u5f0f\u8fdb\u884c\u8fde\u63a5 <code>https://kubernetes.default.svc.cluster.local</code>\uff1a</p> <p>\u6ce8\u610f namespace\uff0c\u6211\u4eec\u8fd9\u91cc\u586b kube-ops\uff0c\u51ed\u636e\u8f93\u5165KUBECONFIG\u6587\u4ef6\u5bf9\u5e94\u7684\u51ed\u8bc1\uff0c\u7136\u540e\u70b9\u51fb <code>Test Connection</code>\uff0c\u5982\u679c\u51fa\u73b0 <code>Connected to Kubernetes...</code> \u7684\u63d0\u793a\u4fe1\u606f\u8bc1\u660e Jenkins \u5df2\u7ecf\u53ef\u4ee5\u548c Kubernetes \u7cfb\u7edf\u6b63\u5e38\u901a\u4fe1\u4e86\u3002</p> <p></p> <p>\u7136\u540e\u4e0b\u65b9\u7684 Jenkins URL \u5730\u5740\uff1a<code>http://jenkinsci.kube-ops.svc.cluster.local:8080</code>\uff0c\u8fd9\u91cc\u7684\u683c\u5f0f\u4e3a\uff1a<code>\u670d\u52a1\u540d.namespace.svc.cluster.local:8080</code>\uff0c\u6839\u636e\u4e0a\u9762\u521b\u5efa\u7684 jenkins \u7684\u670d\u52a1\u540d\u586b\u5199\uff0c\u5305\u62ec\u4e0b\u9762\u7684Jenkins\u901a\u9053\uff0c\u9ed8\u8ba4\u662f50000\u7aef\u53e3\uff08\u8981\u6ce8\u610f\u662f TCP\uff0c\u6240\u4ee5\u4e0d\u8981\u586b\u5199 http\uff09\u3002</p> <p>\u914d\u7f6ejenkins-slave\u955c\u50cf\u3002</p> <pre><code>[root@k8s-master01 jenkins-slave]# tree -a\n.\n\u251c\u2500\u2500 bin\n    \u251c\u2500\u2500 docker\n    \u251c\u2500\u2500 helm\n    \u2514\u2500\u2500 kubectl\n\u251c\u2500\u2500 config\n    \u2514\u2500\u2500 config\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 .ssh\n    \u251c\u2500\u2500 authorized_keys\n    \u251c\u2500\u2500 id_rsa\n    \u251c\u2500\u2500 id_rsa.pub\n    \u2514\u2500\u2500 known_hosts\n3 directories, 9 files\n\n# cat Dockerfile\nFROM jenkins/jnlp-slave:4.13.3-1-jdk11\nMAINTAINER hjl@94qq.com\n\nUSER root\n\nENV JENKINS_AGENT_WORKDIR=/home/jenkins/agent\n\nRUN set -eux; \\\nsed -i 's#http://deb.debian.org#https://mirrors.163.com#g' /etc/apt/sources.list \\\n&amp;&amp; apt update \\\n&amp;&amp; apt install -y python  \\\nsshpass  \\\nrsync \\\nmake  \\\ngcc  \\\ncurl  \\\nnet-tools  \\\nwget  \\\n--no-install-recommends \\\n&amp;&amp; apt-get -y autoremove --purge \\\n&amp;&amp; rm -rf /var/lib/apt/lists/* \\\n&amp;&amp; mkdir -p /home/jenkins/.ssh\n\nENV PATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/home/jenkins/bin\n\nCOPY --chown=root:root bin /home/jenkins/bin\nCOPY --chown=root:root .ssh /root/.ssh\n\nRUN set -eux ; \\\nchmod 755 /home/jenkins/bin/*\n\n# docker build -t hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11 .\n# docker push hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11\nThe push refers to repository [hub.gitee.cc/kubernetes/jenkins-salve]\nf861fb1f9735: Pushing [===&gt;                                               ]  11.11MB/150.2MB\n.....\n</code></pre> <p>\u7b2c 3 \u6b65. \u70b9\u51fb\u6700\u4e0b\u65b9\u7684 <code>Pod Templates</code> \u6309\u94ae\u7528\u4e8e\u914d\u7f6e Jenkins Slave \u8fd0\u884c\u7684 Pod \u6a21\u677f\uff0c\u547d\u540d\u7a7a\u95f4\u6211\u4eec\u540c\u6837\u662f\u7528 kube-ops\uff0cLabels \u8fd9\u91cc\u4e5f\u975e\u5e38\u91cd\u8981\uff0c\u5bf9\u4e8e\u540e\u9762\u6267\u884c Job \u7684\u65f6\u5019\u9700\u8981\u7528\u5230\u8be5\u503c\u3002</p> <p></p> <p>\u914d\u7f6e\u7684Slave Pod\u4e2d\u7684Label\u540d\u79f0</p> <p></p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#11-docker-in-pod\u63a8\u8350","title":"1.1 docker in pod(\u63a8\u8350)","text":"<p>\u914d\u7f6e\u5bb9\u5668\u6a21\u677f</p> <p>jenkins-salve\u6a21\u677f\u5bb9\u5668\u914d\u7f6e</p> <p></p> <p>\u6ce8\u610f</p> <p>\u5bb9\u5668\u7684\u540d\u79f0\u5fc5\u987b\u662f <code>jnlp</code>\uff0c\u8fd9\u662f\u9ed8\u8ba4\u62c9\u8d77\u7684\u5bb9\u5668\uff0c\u53e6\u5916\u9700\u8981\u5c06 <code>\u8fd0\u884c\u7684\u547d\u4ee4</code> \u548c <code>\u547d\u4ee4\u53c2\u6570</code> \u7684\u503c\u90fd\u5220\u9664\u6389\uff0c\u5426\u5219\u4f1a\u5931\u8d25\u3002</p> <p>\u7531\u4e8ejnlp\u5bb9\u5668\u4e2d\u53ea\u662f docker cli\uff0c\u9700\u8981 docker daemon \u624d\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u6211\u4eec\u901a\u5e38\u60c5\u51b5\u4e0b\u7684\u505a\u6cd5\u662f\u5c06\u5bbf\u4e3b\u673a\u4e0a\u7684 docker sock \u6587\u4ef6 <code>/var/run/docker.sock</code> \u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\uff0c\u4f46\u662f\u6211\u4eec\u73b0\u5728\u7684 Kubernetes \u96c6\u7fa4\u4f7f\u7528\u7684\u662f containerd \u8fd9\u79cd\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u8282\u70b9\u4e0a\u6ca1\u6709 docker daemon\u3002\u6211\u4eec\u53ef\u4ee5\u5355\u72ec\u4ee5 Pod \u7684\u5f62\u5f0f\u5728\u96c6\u7fa4\u4e2d\u8dd1\u4e00\u4e2a docker daemon \u7684\u670d\u52a1\uff0c\u5bf9\u5e94\u7684\u8d44\u6e90\u6e05\u5355\u5982\u4e0b\u6240\u793a\uff1a</p> <p>** \u751f\u4ea7\u73af\u5883\u5c06docker-dind\u90e8\u7f72\u56fa\u5b9a\u5728\u6027\u80fd\u597d\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u6253\u4e0atag**</p> <p>\u56e0\u4e3a<code>replicas: 1</code>\uff0c\u5728\u5e94\u5bf9\u591a\u4efb\u52a1\u65f6\u4f1a\u6709\u70b9\u6162\uff0c\u6240\u6709\u5982\u4e0b\u7684pod\u53ef\u4ee5\u591a\u90e8\u7f72\u51e0\u4efd\u3002</p> <p>\u5728Jenkinsfile\u4e2d\u6307\u5b9a\u5bf9\u5e94\u7684server\u540d\u79f0\uff0c\u8c03\u5ea6\u5bf9\u5e94\u7684pod\u8fdb\u884c\u7f16\u8bd1\u5373\u53ef\u3002</p> <p>\u914d\u7f6ehostPath\u5b58\u50a8\u6a21\u5f0f</p> <p><code>docker-dind-1.yml</code></p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: docker-dind-1\nnamespace: kube-ops\nlabels:\nname: docker-dind-1\nspec:\nreplicas: 1\nselector:\nmatchLabels:\nname: docker-dind-1\ntemplate:\nmetadata:\nlabels:\nname: docker-dind-1\nspec:\ncontainers:\n- name: dind\nimage: docker:20.10.12-dind\nargs:\n- --insecure-registry=$(REGISTRY)\n- --registry-mirror=https://25bxwt20.mirror.aliyuncs.com\nenv:\n- name: REGISTRY\nvalue: http://hub.gitee.cc\n- name: DOCKER_TLS_CERTDIR\nvalue: \"\"\n- name: DOCKER_HOST\nvalue: tcp://0.0.0.0:2375\nsecurityContext:\nprivileged: true\ntty: true\nresources:\nrequests:\ncpu: 1000m\nmemory: 500Mi\nlimits:\ncpu: 4096m\nmemory: 8000Mi\nreadinessProbe:\nexec:\ncommand: [\"docker\", \"info\"]\ninitialDelaySeconds: 60\nfailureThreshold: 10\nlivenessProbe:\nexec:\ncommand: [\"docker\", \"info\"]\ninitialDelaySeconds: 60\nfailureThreshold: 10\nvolumeMounts:\n- name: docker-storage\nmountPath:  /var/lib/docker\n- name: localtime\nmountPath: /etc/localtime\nvolumes:\n- name: docker-storage\nhostPath:\npath: /var/lib/docker\n- name: localtime\nhostPath:\npath: /usr/share/zoneinfo/Asia/Shanghai\nnodeSelector:\ndocker-dind-1: \"true\"\n---\nkind: Service\napiVersion: v1\nmetadata:\nname: docker-dind-1\nnamespace: kube-ops\nspec:\nselector:\nname: docker-dind-1\nports:\n- protocol: TCP\nport: 2375\ntargetPort: 2375\n</code></pre> <p>\u914d\u7f6ePVC nfs\u5b58\u50a8\u6a21\u5f0f</p> <pre><code>---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\nname: docker-dind-pv\nlabels:\napp: docker-dind-pv\nspec:\ncapacity:\nstorage: 10Gi\naccessModes:\n- ReadWriteOnce\npersistentVolumeReclaimPolicy: Retain\nstorageClassName: gitee-nfs-client\nmountOptions:\n- hard\n- nfsvers=4.1\nnfs:\nserver: 192.168.1.60\npath: /QaTest/docker-dind\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\nlabels:\napp: docker-dind\nname: docker-dind-data\nnamespace: kube-ops\nspec:\naccessModes:\n- ReadWriteOnce\nstorageClassName: gitee-nfs-client\nresources:\nrequests:\nstorage: 10Gi\nselector:\nmatchLabels:\napp: docker-dind-pv\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: docker-dind\nnamespace: kube-ops\nlabels:\nname: docker-dind\nspec:\nreplicas: 1\nselector:\nmatchLabels:\nname: docker-dind\ntemplate:\nmetadata:\nlabels:\nname: docker-dind\nspec:\ncontainers:\n- name: dind\nimage: docker:20.10.12-dind\nargs:\n- --insecure-registry=$(REGISTRY)\n- --registry-mirror=https://25bxwt20.mirror.aliyuncs.com\nenv:\n- name: REGISTRY\nvalue: http://hub.gitee.cc\n- name: DOCKER_TLS_CERTDIR\nvalue: \"\"\n- name: DOCKER_HOST\nvalue: tcp://0.0.0.0:2375\nsecurityContext:\nprivileged: true\ntty: true\nresources:\nrequests:\ncpu: 1000m\nmemory: 500Mi\nlimits:\ncpu: 4096m\nmemory: 8000Mi\nreadinessProbe:\nexec:\ncommand: [\"docker\", \"info\"]\ninitialDelaySeconds: 60\nfailureThreshold: 10\nlivenessProbe:\nexec:\ncommand: [\"docker\", \"info\"]\ninitialDelaySeconds: 60\nfailureThreshold: 10\nvolumeMounts:\n- name: docker-dind-data-vol\nmountPath: /var/lib/docker/\nvolumes:\n- name: docker-dind-data-vol\npersistentVolumeClaim:\nclaimName: docker-dind-data\nnodeSelector:\nbuild: \"true\"\n---\nkind: Service\napiVersion: v1\nmetadata:\nname: docker-dind\nnamespace: kube-ops\nspec:\nselector:\nname: docker-dind\nports:\n- protocol: TCP\nport: 2375\ntargetPort: 2375\n</code></pre> <p>\u76f4\u63a5\u521b\u5efa\u4e0a\u9762\u7684\u8d44\u6e90\u5bf9\u8c61\u5373\u53ef\uff1a</p> <pre><code>$ kubectl apply -f docker-dind.yaml\n$ kubectl get pods -n kube-ops -l app=docker-dind\nNAME                           READY   STATUS    RESTARTS   AGE\ndocker-dind-86d95bfc49-wq248   1/1     Running   0          17s\n\n$ kubectl get svc -n kube-ops -l app=docker-dind\nNAME          TYPE        CLUSTER-IP        EXTERNAL-IP   PORT(S)    AGE\ndocker-dind   ClusterIP   192.168.172.137   &lt;none&gt;        2375/TCP   6m3s\n</code></pre> <p>\u6269\u5c55\u53c2\u8003\u6587\u732e</p> <p>\u6d41\u6c34\u7ebf\u4e2d\u4f7f\u7528 docker in pod \u65b9\u5f0f\u6784\u5efa\u5bb9\u5668\u955c\u50cf</p> <p>https://blog.csdn.net/alex_yangchuansheng/article/details/123564347</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#12-\u7269\u7406\u673abuild\u63a8\u8350","title":"1.2 \u7269\u7406\u673abuild(\u63a8\u8350)","text":"<p>\u9009\u62e9\u4e00\u53f0\u6709SSD\u6027\u80fd\u597d\u7684\u7269\u7406\u670d\u52a1\u5668\u4f5c\u4e3a\u7f16\u8bd1\u955c\u50cf\u6253\u5305\u670d\u52a1\u5668\u3002</p> <p>\u5728\u547d\u4ee4\u884c\u4e0a\u6765\u521b\u5efa Secret\u63d0\u4f9b\u79c1\u6709\u4ed3\u5e93\u62c9\u53d6\u51ed\u8bc1\u3002\u8fd9\u6837<code>hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11</code>\u79c1\u6709\u955c\u50cf\u5c31\u80fd\u6b63\u5e38\u62c9\u53d6\u4e86\u3002</p> <pre><code>$ kubectl -n kube-ops create secret docker-registry regcred \\\n--docker-server=http://hub.gitee.cc \\\n--docker-username=admin \\\n--docker-password=oschina123 \\\n--docker-email=1@1.com\n</code></pre> <p>\u53c2\u8003\uff1ahttps://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/pull-image-private-registry/</p> <p>\u5728\u56fe\u5f62\u754c\u9762\u4e2d\u8bbe\u7f6e\u62c9\u53d6\u51ed\u8bc1\u4fe1\u606f\u3002</p> <p></p> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u8bfb\u8005\u7684Kubernetes\u96c6\u7fa4\u91c7\u7528\u7684\u662fContainerd\u4f5c\u4e3aRuntime\uff0c\u914d\u7f6einsecure-registry\u53ea\u9700\u8981\u5728Containerd\u914d\u7f6e\u6587\u4ef6\u7684mirrors\u4e0b\u6dfb\u52a0\u81ea\u5df1\u7684\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u5373\u53ef</p> <p>vim /etc/containerd/config.toml</p> <pre><code>    [plugins.\"io.containerd.grpc.v1.cri\".registry]\n      config_path = \"\"\n\n      [plugins.\"io.containerd.grpc.v1.cri\".registry.auths]\n\n      [plugins.\"io.containerd.grpc.v1.cri\".registry.configs]\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"hub.gitee.cc\".tls]\n          insecure_skip_verify = true\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"hub.gitee.cc\".auth]\n      [plugins.\"io.containerd.grpc.v1.cri\".registry.headers]\n\n      [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors]\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\n          endpoint = [\"https://pooj3a7i.mirror.aliyuncs.com\"]\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"hub.gitee.cc\"]\n          endpoint = [\"http://hub.gitee.cc\"]\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u542fContainerd\uff0c\u4e4b\u540e\u8fdb\u884cpull\u6d4b\u8bd5\uff1a</p> <pre><code>$ systemctl restart containerd\n$ ctr -n k8s.io image pull hub.gitee.cc/kubernetes/webkubectl:latest --plain-http --user admin:oschina123 </code></pre> <p>\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf <code>DOCKER_HOST: tcp://docker-dind:2375</code> \u53bb\u8fde\u63a5 docker dind \u670d\u52a1\u3002</p> <p>\u53e6\u5916\u9700\u8981\u5c06\u6587\u4ef6 <code>/root/.kube/config</code> \u6302\u8f7d\u5230\u5bb9\u5668\u7684 <code>/root/.kube/</code> \u76ee\u5f55\u4e0b\u9762\uff0c\u8fd9\u662f\u4e3a\u4e86\u8ba9\u6211\u4eec\u80fd\u591f\u5728 Pod \u7684\u5bb9\u5668\u4e2d\u80fd\u591f\u4f7f\u7528 <code>kubectl</code> \u5de5\u5177\u6765\u8bbf\u95ee\u6211\u4eec\u7684Kubernetes\u96c6\u7fa4\uff0c\u65b9\u4fbf\u6211\u4eec\u540e\u9762\u5728 <code>Slave Pod</code> \u90e8\u7f72 Kubernetes \u5e94\u7528\u3002</p> <p>\u9996\u5148\u5728master\u4e0a\u521b\u5efacm\u6587\u4ef6\uff0ccm\u6587\u4ef6\u4f4d\u4e8ekube-ops\u540d\u79f0\u7a7a\u95f4\u4e0b\uff1a</p> <pre><code>$ kubectl create configmap kubeconfig --from-file=/root/.kube/config -n kube-ops\n$ k get cm -n kube-ops\nNAME               DATA   AGE\nkube-root-ca.crt   1      2d\nkubeconfig         1      6m4s\n</code></pre> <p></p> <p>\u53e6\u5916\u5982\u679c\u5728\u914d\u7f6e\u4e86\u540e\u8fd0\u884c Slave Pod \u7684\u65f6\u5019\u51fa\u73b0\u4e86\u6743\u9650\u95ee\u9898\uff0c\u8fd9\u662f\u56e0\u4e3aJenkins Slave Pod\u4e2d\u6ca1\u6709\u914d\u7f6e\u6743\u9650\uff0c\u6240\u4ee5\u9700\u8981\u914d\u7f6e\u4e0a ServiceAccount\uff0c \u5728Slave Pod\u914d\u7f6e\u7684\u5730\u65b9\u70b9\u51fb\u4e0b\u9762\u7684\u9ad8\u7ea7\uff0c\u6dfb\u52a0\u4e0a\u5bf9\u5e94\u7684 ServiceAccount \u5373\u53ef\uff1a</p> <p></p> <p>\u5230\u8fd9\u91cc\u6211\u4eec\u7684 Kubernetes \u63d2\u4ef6\u5c31\u7b97\u914d\u7f6e\u5b8c\u6210\u4e86\uff0c\u8bb0\u5f97\u4fdd\u5b58\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-\u6d4b\u8bd5","title":"2. \u6d4b\u8bd5","text":"<p>Kubernetes \u63d2\u4ef6\u7684\u914d\u7f6e\u5de5\u4f5c\u5b8c\u6210\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u6dfb\u52a0\u4e00\u4e2aJob\u4efb\u52a1\uff0c\u770b\u662f\u5426\u80fd\u591f\u5728Slave Pod\u4e2d\u6267\u884c\uff0c\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u540e\u770bPod\u662f\u5426\u4f1a\u88ab\u9500\u6bc1\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#21-\u81ea\u7531\u98ce\u683c\u7684\u6d41\u6c34\u7ebf","title":"2.1 \u81ea\u7531\u98ce\u683c\u7684\u6d41\u6c34\u7ebf","text":"<p>\u5728 Jenkins \u9996\u9875\u70b9\u51fb <code>\u65b0\u5efa\u4efb\u52a1</code>\uff0c\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u7684\u4efb\u52a1\uff0c\u8f93\u5165\u4efb\u52a1\u540d\u79f0\uff0c\u7136\u540e\u6211\u4eec\u9009\u62e9 <code>\u6784\u5efa\u4e00\u4e2a\u81ea\u7531\u98ce\u683c\u7684\u8f6f\u4ef6\u9879\u76ee</code> \u7c7b\u578b\u7684\u4efb\u52a1\uff0c\u6ce8\u610f\u5728\u4e0b\u9762\u7684 <code>Label Expression</code> \u8fd9\u91cc\u8981\u586b\u5165 <code>jenkins-jnlp</code>\uff0c\u5c31\u662f\u524d\u9762\u6211\u4eec\u914d\u7f6e\u7684 Slave Pod \u4e2d\u7684 Label\uff0c\u8fd9\u4e24\u4e2a\u5730\u65b9\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\uff1a</p> <p></p> <p>\u7136\u540e\u5f80\u4e0b\u62c9\uff0c\u5728 <code>\u6784\u5efa</code> \u533a\u57df\u9009\u62e9 <code>\u6267\u884c shell</code>\uff1a</p> <p></p> <p>\u7136\u540e\u8f93\u5165\u6211\u4eec\u6d4b\u8bd5\u547d\u4ee4</p> <pre><code>echo \"\u6d4b\u8bd5 Kubernetes \u52a8\u6001\u751f\u6210 jenkins slave\"\necho \"==============docker in docker===========\"\ndocker version\n\necho \"=============kubectl=============\"\nkubectl get pods\n</code></pre> <p>\u6700\u540e\u70b9\u51fb\u4fdd\u5b58\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u76f4\u63a5\u5728\u9875\u9762\u70b9\u51fb\u5de6\u4fa7\u7684 <code>\u7acb\u5373\u6784\u5efa</code> \u89e6\u53d1\u6784\u5efa\u5373\u53ef\uff0c\u7136\u540e\u89c2\u5bdf Kubernetes \u96c6\u7fa4\u4e2d Pod \u7684\u53d8\u5316\uff1a</p> <pre><code>$ kubectl get pods -n kube-ops\nNAME                          READY   STATUS              RESTARTS   AGE\njenkins-556cd59c8c-2vl8m    1/1     Running             0          64m\njenkins-agent-rb8hk           0/1     ContainerCreating   0          8s\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728\u6211\u4eec\u70b9\u51fb\u7acb\u523b\u6784\u5efa\u7684\u65f6\u5019\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u65b0\u7684 Pod\uff1a<code>jenkins-agent-rb8hk</code> \u88ab\u521b\u5efa\u4e86\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u7684 Jenkins Slave\u3002\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u540e\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4efb\u52a1\u4fe1\u606f:</p> <p>\u5230\u8fd9\u91cc\u8bc1\u660e\u6211\u4eec\u7684\u4efb\u52a1\u5df2\u7ecf\u6784\u5efa\u5b8c\u6210\uff0c\u7136\u540e\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u518d\u53bb\u96c6\u7fa4\u67e5\u770b\u6211\u4eec\u7684 Pod \u5217\u8868\uff0c\u53d1\u73b0 kube-ops \u8fd9\u4e2a namespace \u4e0b\u9762\u5df2\u7ecf\u6ca1\u6709\u4e4b\u524d\u7684 Slave \u8fd9\u4e2a Pod \u4e86\u3002</p> <pre><code>$ kubectl get pods -n kube-ops\nNAME                                           READY   STATUS              RESTARTS   AGE\njenkins-556cd59c8c-2vl8m                       1/1     Running             0          12h\n</code></pre> <p>\u5230\u8fd9\u91cc\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4f7f\u7528 Kubernetes \u52a8\u6001\u751f\u6210 Jenkins Slave \u7684\u65b9\u6cd5\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#22-pipeline\u6d41\u6c34\u7ebf","title":"2.2 pipeline\u6d41\u6c34\u7ebf","text":"<p>\u4f7f\u7528\u7269\u7406\u673a\u7528\u4e8ebuild\u3002\u7269\u7406\u673a\u53ef\u4ee5\u5b89\u88c5\u8d1f\u8f7d\u5747\u8861\u3001\u53cd\u5411\u4ee3\u7406\uff08haproxy\u3001nginx\uff09\u8f6f\u4ef6\uff0c\u5236\u4f5c\u4e00\u4e2adocker build \u5206\u53d1\u6c60\uff0c\u5206\u644abuild\u6784\u5efa\u538b\u529b\u3002</p> <pre><code>pipeline{\n    environment {\n        VERSION = \"v5.0.0\"\n        RELEASE_VERSION = \"master\"\n        GIT_ADDRESS = \"https://gitee.com/oschina/gitee.git\"\n\n    }\n\n    options {\n      parallelsAlwaysFailFast()\n      disableResume()\n      skipDefaultCheckout()\n      quietPeriod(1)\n      preserveStashes(buildCount: 5)\n      timestamps()\n      buildDiscarder(logRotator(numToKeepStr: '100'))\n      timeout(time: 60, unit: 'MINUTES')\n    }\n\n    agent {\n        kubernetes {\n            cloud 'kubernetes'\n            slaveConnectTimeout 1200\n            workspaceVolume nfsWorkspaceVolume(serverAddress: \"192.168.1.60\", serverPath: \"/QaTest/jenkins-salve\", readOnly: \"false\")\n            yaml '''\n\n---\napiVersion: \"v1\"\nkind: \"Pod\"\nmetadata:\n  labels:\n    jenkins: \"slave\"\n    jenkins/label: \"jenkins-jnlp\"\n  name: \"jenkins-slave\"\n  namespace: \"kube-ops\"\n\nspec:\n  containers:\n  - env:\n    - name: \"DOCKER_HOST\"\n      value: \"tcp://192.168.1.141:2375\"\n\n    - name: \"JENKINS_AGENT_WORKDIR\"\n      value: \"/home/jenkins/agent\"\n\n    image: \"hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11\"\n    imagePullPolicy: \"IfNotPresent\"\n    name: \"jnlp\"\n    tty: true\n    resources:\n      limits:\n        cpu: 1000m\n        memory: 2000Mi\n      requests:\n        cpu: 200m\n        memory: 400Mi\n\n    volumeMounts:\n    - mountPath: \"/root/.kube/config\"\n      name: \"volume-0\"\n      readOnly: false\n      subPath: \"config\"\n\n    - name: localtime\n      mountPath: /etc/localtime\n\n    - mountPath: \"/home/jenkins/agent\"\n      name: \"workspace-volume\"\n      readOnly: false\n    workingDir: \"/home/jenkins/agent\"\n\n  hostNetwork: false\n  imagePullSecrets:\n  - name: \"regcred\"\n  nodeSelector:\n    kubernetes.io/os: \"linux\"\n\n  restartPolicy: \"Never\"\n  volumes:\n  - name: localtime\n    hostPath:\n      path: /usr/share/zoneinfo/Asia/Shanghai\n\n  - configMap:\n      name: \"kubeconfig\"\n      optional: false\n    name: \"volume-0\"\n\n  - emptyDir:\n      medium: \"\"\n    name: \"workspace-volume\"\n            '''\n        }\n    }\n\n    stages {\n      stage('Build') {\n        steps {\n          sh '''#!/bin/bash\n                set -eu\n                echo 'Build'\n                echo\n                docker version\n                echo\n             '''\n        }\n      }\n      stage('Test') {\n        steps {\n          echo 'Test'\n        }\n      }\n      stage('Deploy') {\n        steps {\n            sh '''#!/bin/bash\n                set -eu\n                echo 'Deploy'\n                echo\n                kubectl get nodes\n                echo\n             '''\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#52--\u5b89\u88c5gitlab","title":"5.2  \u5b89\u88c5GitLab","text":"<p>GitLab\u5728\u4f01\u4e1a\u5185\u7ecf\u5e38\u7528\u4e8e\u4ee3\u7801\u7684\u7248\u672c\u63a7\u5236\uff0c\u662fDevOps\u5e73\u53f0\u4e2d\u5c24\u4e3a\u91cd\u8981\u7684\u4e00\u4e2a\u5de5\u5177\u3002\u63a5\u4e0b\u6765\u5728\u53e6\u4e00\u53f0\u670d\u52a1\u5668\uff0840GB\u4ee5\u4e0a\uff09\u4e0a\u5b89\u88c5GitLab\uff08\u5982\u679c\u6709\u53ef\u7528 \u7684GitLab\uff0c\u4e5f\u65e0\u987b\u5b89\u88c5\uff09\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-\u670d\u52a1\u65b9\u5f0f\u90e8\u7f72\u63a8\u8350","title":"1. \u670d\u52a1\u65b9\u5f0f\u90e8\u7f72(\u63a8\u8350)","text":"<p>\u9996\u5148\u5728GitLab\u56fd\u5185\u6e90\u4e0b\u8f7dGitLab\u7684\u5b89\u88c5\u5305\uff1ahttps://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/\u3002 \u5c06\u4e0b\u8f7d\u540e\u7684RPM\u5305\u4e0a\u4f20\u5230\u670d\u52a1\u5668\uff0c\u4e4b\u540e\u901a\u8fc7yum\u76f4\u63a5\u5b89\u88c5\u5373\u53ef\uff1a</p> <pre><code>$ mkdir gitlab\n$ cd gitlab/\n$ wget -c https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-15.8.2-ce.0.el7.x86_64.rpm\n$ yum install gitlab-ce-14.2.3-ce.0.el7.x86_64.rpm -y\n</code></pre> <p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u9700\u8981\u66f4\u6539\u51e0\u5904\u914d\u7f6e\uff1a <pre><code>vim /etc/gitlab/gitlab.rb\n</code></pre></p> <p>\u5c06external_url\u66f4\u6539\u4e3a\u81ea\u5df1\u7684\u53d1\u5e03\u5730\u5740\uff0c\u53ef\u4ee5\u662f\u670d\u52a1\u5668\u7684IP\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u53ef\u88ab\u89e3\u6790\u7684\u57df\u540d\uff0c\u66f4\u6539\u5b8c\u6210\u540e\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code># gitlab-ctl reconfigure\n</code></pre> <p>\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95eeGitLab \uff0c \u8d26\u53f7\u4e3aroot \uff0c\u9ed8\u8ba4\u5bc6\u7801\u5728/etc/gitlab/initial_root_password\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-docker\u65b9\u5f0f\u90e8\u7f72\u63a8\u8350","title":"2. docker\u65b9\u5f0f\u90e8\u7f72(\u63a8\u8350)","text":"<p>gitlab-ce \u6709\u4e24\u4e2a\u4e0d\u540c\u7684\u5bb9\u5668\u5316\u955c\u50cf\uff0csameersbn/gitlab \u548c gitlab/gitlab-ce\uff0c \u524d\u8005\u662f\u7b2c\u4e09\u65b9\u7ef4\u62a4\u7684\uff0c\u7528\u6237\u5e7f\u6cdb\uff0c\u5e74\u4ee3\u4e45\u8fdc\uff0c\u901a\u8fc7\u6ce8\u5165\u73af\u5883\u53d8\u91cf\u6765\u81ea\u52a8\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5c31\u662f\u7248\u672c\u4e00\u822c\u4f1a\u843d\u540e\u5b98\u65b9\u3002\u540e\u8005\u662f\u5b98\u65b9\u7684\u955c\u50cf\uff0c\u66f4\u65b0\u53ca\u65f6\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#21-sameersbngitlab","title":"2.1 sameersbn/gitlab","text":"<p>\u4ed3\u5e93\u5730\u5740</p> <p>https://github.com/sameersbn/docker-gitlab</p> <p>https://www.jianshu.com/p/abd406052677</p> <p>https://www.jianshu.com/p/ee0c8ed4795e</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#22-gitlabgitlab-ce","title":"2.2 gitlab/gitlab-ce","text":"<p>\u521b\u5efa\u5b89\u88c5\u76ee\u5f55\u3001\u62c9\u53d6\u955c\u50cf</p> <pre><code>$ docker pull gitlab/gitlab-ce\n\n$ mkdir -p /root/wokerdir/gitlab\n</code></pre> <p><code>docker-compose.yaml</code></p> <pre><code>version: '3.1'\nservices:\ngitlab:\nimage: 'gitlab/gitlab-ce:latest'\ncontainer_name: gitlab\nrestart: always\nenvironment:\nGITLAB_OMNIBUS_CONFIG: |\nexternal_url 'http://gitlab.runjs.cn:8929'\ngitlab_rails['gitlab_shell_ssh_port'] = 2224\nports:\n- '8929:8929'\n- '2224:22'\nvolumes:\n- './config:/etc/gitlab'\n- './logs:/var/log/gitlab'\n- './data:/var/opt/gitlab'\nshm_size: '256m'\n</code></pre> <ol> <li>\u6307\u5b9a\u4e09\u4e2a\u7aef\u53e3,22\u4e3assh\u7aef\u53e3,80\u4e3ahttp\u7aef\u53e3,443\u4e3ahttps\u7aef\u53e3,\u5206\u522b\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u76847022\u30018080\u548c7443\u7aef\u53e3</li> <li> <p>\u901a\u8fc7--volume\u6307\u5b9a\u76ee\u5f55\u6620\u5c04,\u5176\u4e2d</p> </li> <li> <p>/etc/gitlab\u8868\u793agitlab\u7684\u914d\u7f6e\u76ee\u5f55,\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684/opt/gitlab/config\u76ee\u5f55.</p> </li> <li>/var/log/gitlab\u8868\u793agitlab\u7684\u65e5\u5fd7\u76ee\u5f55,\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684/opt/gitlab/logs\u76ee\u5f55.</li> <li> <p>/var/opt/gitlab\u8868\u793agitlab\u7684\u6570\u636e\u76ee\u5f55,\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684/opt/gitlab/data\u76ee\u5f55.</p> </li> <li> <p>\u76ee\u5f55\u8bf4\u660e</p> </li> <li> <p>/opt/gitlab/config \u5b58\u50a8 GitLab \u914d\u7f6e\u4fe1\u606f</p> </li> <li>/opt/gitlab/data \u5b58\u50a8\u6570\u636e\u5e93</li> <li>/opt/gitlab/logs \u5b58\u50a8\u65e5\u5fd7</li> </ol> <pre><code>$ docker-compose up -d\n\n## \u91cd\u542fgitlab\u5bb9\u5668\n$ docker restart gitlab\n</code></pre> <p>\u542f\u52a8\u5bb9\u5668\uff08\u9700\u8981\u7a0d\u7b49\u4e00\u5c0f\u4f1a\u2026\u2026\uff09</p> <p>\u91cd\u542f\u914d\u7f6e\u670d\u52a1\uff08\u51fa\u73b0\u95ee\u9898\uff09 </p> <p>\u7531\u4e8e\u6211\u4eec\u8fd0\u884c\u662f\u4f7f\u7528\u6570\u636e\u5377\u53c2\u6570\u8fdb\u884c\u8fd0\u884c\u7684\uff0c\u5bbf\u4e3b\u673a\u7684gitlab.rb\u6587\u4ef6\u4fee\u6539\u4e86\uff0cgitlab\u7684\u6587\u4ef6\u4f1a\u8ddf\u7740\u6539\uff0c\u4f46\u662f\u5bb9\u5668\u7684\u6587\u4ef6\u4e0d\u4f1a\u8ddf\u7740\u751f\u6548\uff0c\u5fc5\u987b\u8981\u8fdb\u53bb\u5bb9\u5668\u91cc\u9762\u8fdb\u884c\u547d\u4ee4\u6267\u884c\uff0c\u91cd\u7f6e\u914d\u7f6e\u6587\u4ef6\u6bd4\u8f83\u8017\u8d39\u65f6\u95f4\uff0c\u9700\u8981\u8010\u5fc3\u7b49\u5f85\uff0c\u5982\u679c\u65f6\u95f4\u6bd4\u8f83\u77ed\u8bf4\u660e\u6210\u529f\u7387\u4e0d\u9ad8\uff0c\u800c\u4e14\u8fdb\u53bb\u5bb9\u5668\u4e4b\u540e\u5c31\u9000\u51fa\u5566\u3002</p> <pre><code>$ docker exec -it gitlab /bin/bash  #\u8fdb\u53bbgitlab\u5bb9\u5668\u7684\u547d\u4ee4\n$ gitlab-ctl reconfigure        #\u91cd\u7f6egitlab\u5ba2\u6237\u7aef\u7684\u547d\u4ee4\n$ gitlab-ctrl restart\n</code></pre> <p>\u67e5\u770broot\u767b\u5f55\u5bc6\u7801</p> <pre><code>$ docker exec  $(docker ps | grep gitlab | awk '{print $1}') grep 'Password:' /etc/gitlab/initial_root_password\nPassword: lB7RIXsS41R7on31KPHAzJ0FE736mBMPxTdjOt4g2Lo=\n</code></pre> <p>\u91cd\u7f6e\u7ba1\u7406\u5458\u5bc6\u7801</p> <pre><code>root@docker-node141:~/gitlab# docker exec -it gitlab /bin/bash\nroot@192:/# gitlab-rails console -e production\n--------------------------------------------------------------------------------\n Ruby:         ruby 2.7.5p203 (2021-11-24 revision f69aeb8314) [x86_64-linux]\nGitLab:       14.6.1 (661d663ab2b) FOSS\n GitLab Shell: 13.22.1\n PostgreSQL:   12.7\n--------------------------------------------------------------------------------\nLoading production environment (Rails 6.1.4.1)\nirb(main):001:0&gt; user = User.where(id: 1).first\n=&gt; #&lt;User id:1 @root&gt;\nirb(main):002:0&gt; user.password = 'oschina123'\n=&gt; \"oschina123\"\nirb(main):003:0&gt; user.password_confirmation = 'oschina123'\n=&gt; \"oschina123\"\nirb(main):004:0&gt; user.save!\n=&gt; true\nirb(main):005:0&gt; exit\n</code></pre> <p>\u5e38\u7528\u547d\u4ee4</p> <pre><code># \u8fdb\u5165\u5bb9\u5668\ndocker exec -it gitlab /bin/bash\n\n# \u542f\u52a8\u6240\u6709gitlab\u7ec4\u4ef6\ngitlab-ctl start\n\n# \u67e5\u770bgitlab\u72b6\u6001\ngitlab-ctl status\n\n# \u91cd\u65b0\u542f\u7528\u914d\u7f6e\ngitlab-ctl reconfigure\n\n# \u91cd\u542fgitlab\ndocker restart gitlab\n</code></pre> <p>\u767b\u5f55\u540e\uff0c\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u9879\u76ee\uff0c\u8fdb\u884c\u4e00\u4e9b\u7b80\u5355\u7684\u6d4b\u8bd5\u3002\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u7ec4\u3002\u7ec4\u540d\u4e3akubernetes\uff0c\u7c7b\u578b\u4e3aPrivate\uff0c\u4e4b\u540e\u5355\u51fbCreate group</p> <p></p> <p>\u9009\u62e9\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u9879\u76ee\uff0c\u8f93\u5165\u9879\u76ee\u540d\u79f0test-project\uff0c\u7136\u540e\u5355\u51fbCreate project\u5982\u56fe </p> <p>\u4e4b\u540e\u53ef\u4ee5\u5c06Jenkins\u670d\u52a1\u5668\u7684key\u5bfc\u5165GitLab\uff0c\u9996\u5148\u751f\u6210\u5bc6\u94a5\uff08\u5982\u6709\u53ef\u4ee5\u4e0d\u751f\u6210\uff09\uff1a</p> <pre><code>$ ssh-keygen -t rsa -C \"YOUR_EMAIL@ADDRESS.COM\"\n</code></pre> <p>\u5c06\u516c\u94a5\u7684\u5185\u5bb9\u653e\u5728GitLab\u4e2d\uff1a</p> <pre><code>$ cat ~/.ssh/id_rsa.pub\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDAipO4jkJioJBW57Nv25i95yAiWNCeaySwvtFViOqtcX644WbN81SDwMscYCvKNcdgPmXkzBaKWBzehAVZ9RhVN1gqp9/BvnGzhyz6IpYXMgQfsDLIakARM4uJjxKt9LCTVugUL3kA5p+fsNsaMwpSy/+scnfUsuKCTqDuCBBGbdRkBIjC2ZuXzXs2ei2jWwVavJbxSZwMxPT2pNeHG7GxiyIBVwR6kbdDQNqzDBOBSATKSFp8XKhdc+7Mu3f6cUD64i+TxBgqqG1rA29yb4xn0iB1IHxsOCc5RO4WrfwrYQxMsMiB2cxQK2sKhrNrggeQ4LQhsWRWQWxTaDEB5TbvMsdKoEAivGE8OjUyyz/3VTPFqMtLEeAB5RDjOwFKeJBB6aYNOqOYlI7nm1g9oLm4OtiSjeSxz2MvO0N4KPMBgX6qW5lecYbD6VrJC2RVic05NouViRWoJPJEIUn9c3wNd0lDYMYhDVAOfW4PPx0B6gf1b40+aTlUxoUPLAhTocs= 1879324764@qq.com\n</code></pre> <p>\u5728GitLab\u627e\u5230Profile\uff0c\u4e4b\u540e\u5728SSH Keys\u6dfb\u52a0\u516c\u94a5\uff0c\u5982\u56fe </p> <p>\u521b\u5efa\u51e0\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u63d0\u4ea4\u6d4b\u8bd5\uff1a</p> <pre><code>$ git clone ssh://git@gitlab.runjs.cn:7022/kubernetes/test-project.git\n$ cd test-project/\n$ touch aaa{1..3}.py\nroot@docker-node141:~/gitlab/test-project# echo 'aaa' &gt; aaa1.py\nroot@docker-node141:~/gitlab/test-project# git add .\n\nroot@docker-node141:~/gitlab/test-project# git config --global user.email \"18793247642qq.com\"\nroot@docker-node141:~/gitlab/test-project# git config --global user.name \"hujianli\"\nroot@docker-node141:~/gitlab/test-project# git commit -m \"first commit\"\n[main 515ab18] first commit\n 3 files changed, 1 insertion(+)\ncreate mode 100644 aaa1.py\n create mode 100644 aaa2.py\n create mode 100644 aaa3.py\n\nroot@docker-node141:~/gitlab/test-project# git push origin main\nWarning: Permanently added '[gitlab.runjs.cn]:7022,[192.168.1.141]:7022' (ECDSA) to the list of known hosts.\nEnumerating objects: 5, done.\nCounting objects: 100% (5/5), done.\nDelta compression using up to 8 threads\nCompressing objects: 100% (2/2), done.\nWriting objects: 100% (4/4), 313 bytes | 313.00 KiB/s, done.\nTotal 4 (delta 0), reused 0 (delta 0)\nTo ssh://gitlab.runjs.cn:7022/kubernetes/test-project.git\n   b77d308..515ab18  main -&gt; main\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>https://www.cnblogs.com/linanjie/p/13932352.html</p> <p>https://wtl4it.blog.csdn.net/article/details/125019372</p> <p>\u4f01\u4e1a\u7ea7GitLab\u5728Docker\u90e8\u7f72\u4f7f\u7528</p> <p>\u5b98\u65b9\u6587\u6863</p> <p>https://docs.gitlab.com/ee/install/docker.html</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#3-yaml\u65b9\u5f0f\u90e8\u7f72\u4e0d\u63a8\u8350","title":"3. yaml\u65b9\u5f0f\u90e8\u7f72(\u4e0d\u63a8\u8350)","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.qikqiak.com/k8strain2/devops/gitlab/</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#4-helm3\u5b89\u88c5gitlab\u4e0d\u63a8\u8350","title":"4. helm3\u5b89\u88c5gitlab(\u4e0d\u63a8\u8350)","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://blog.51cto.com/u_14268033/2456991</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#53-\u5b89\u88c5harbor","title":"5.3 \u5b89\u88c5Harbor","text":"<p>\u5728\u4f7f\u7528\u5bb9\u5668\u6216\u8005Kubernetes\u53d1\u5e03\u670d\u52a1\u65f6\uff0c\u90fd\u662f\u4ee5\u955c\u50cf\u4e3a\u57fa\u51c6\u53d1\u5e03\u7684\uff0c\u800c\u955c\u50cf\u7684\u5b58\u50a8\u9700\u8981\u955c\u50cf\u4ed3\u5e93\u6765\u652f\u6301\uff0c\u76ee\u524d\u6bd4\u8f83\u5e38\u7528\u7684\u6709Harbor\u3001Nexus\u3001JFrog Artifactory\u7b49\u3002</p> <p>\u672c\u5c0f\u8282\u5c06\u6f14\u793aHarbor\u7684\u5b89\u88c5\u548c\u4f7f\u7528\uff0c\u8fd9\u4e5f\u662f\u4f01\u4e1a\u5185\u6bd4\u8f83\u5e38\u7528\u7684\u955c\u50cf\u4ed3\u5e93\u3002</p> <p>\u6ce8\u610f</p> <p>\u63a8\u8350\u4f7f\u7528docker-compose\u7684\u65b9\u5f0f\u90e8\u7f72\uff0c\u8282\u7701kubernetes\u8d44\u6e90\uff0c\u5355\u72ec\u955c\u50cf\u4ed3\u5e93\u73af\u5883</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-docker\u65b9\u5f0f\u90e8\u7f72\u63a8\u8350","title":"1. docker\u65b9\u5f0f\u90e8\u7f72(\u63a8\u8350)","text":"<p>\u9996\u5148\u5728GitHub\u4e0b\u8f7d\u65b0\u7684Harbor\u79bb\u7ebf\u5305\uff0c\u5e76\u4e0a\u4f20\u81f3Harbor\u670d\u52a1\u5668\uff0c\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740\uff1ahttps://github.com/goharbor/harbor/releases/\u3002 \u7531\u4e8eHarbor\u662f\u91c7\u7528docker-compose\u4e00\u952e\u90e8\u7f72\u7684\uff0c\u56e0\u6b64Harbor\u670d\u52a1\u5668\u4e5f\u9700\u8981\u5b89\u88c5Docker</p> <p>Harbor \u9ad8\u53ef\u7528\u642d\u5efa(docker-compose)</p> <p>\u53c2\u8003\u6587\u732e</p> <p>https://clay-wangzhi.com/cloudnative/kubernetes/docker-harbor-ha.html#summary</p> <p>Harbor \u662f\u4e00\u4e2a\u4e3b\u6d41\u7684\u955c\u50cf\u4ed3\u5e93\u7cfb\u7edf\uff0c\u5728 v1.6 \u7248\u672c\u4ee5\u540e\u7684 harbor \u4e2d\u65b0\u589e\u52a0\u4e86 helm charts \u7684\u7ba1\u7406\u529f\u80fd\uff0c\u53ef\u4ee5\u5b58\u50a8Chart\u6587\u4ef6\u3002</p> <p>\u53c2\u8003\u6587\u732e</p> <p>\u90e8\u7f72\u4ed3\u5e93\u5730\u5740\uff1ahttps://gitee.com/autom-studio/simple-harbor</p> <p>\u79bb\u7ebf\u5305\uff1aharbor-offline-installer-v240.tgz</p> <pre><code>$ wget https://github.com/goharbor/harbor/releases/download/v2.4.2/harbor-online-installer-v2.4.2.tgz\n\n# \u4e0a\u4f20\u5b89\u88c5\u5305\u5230\u670d\u52a1\u5668/root/wokerdir/harbor\u76ee\u5f55\u4e0b\n$ cd /root/wokerdir/harbor\n$ tar -zxf harbor-online-installer-v2.4.2.tgz\n$ cd /root/wokerdir/harbor/harbor\n\n## \u590d\u5236 harbor \u914d\u7f6e\u6a21\u677f\n$ cp harbor.yml.tmpl harbor.yml\n</code></pre> <p>\u89e3\u538b\u5e76\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u53ea\u9700\u4fee\u6539 harbor.yml \uff0c\u4fee\u6539\u9879\u5982\u4e0b\uff1a</p> <pre><code>hostname: hub.gitee.cc  # \u8bbf\u95ee\u57df\u540d\u6216IP\u5730\u5740\n\n# \u5982\u679c\u6ca1\u6709ssl\u8bc1\u4e66\uff0c\u5219\u6ce8\u91ca\u6389 https \u5b57\u6bb5\nharbor_admin_password: admin123    # \u521d\u59cb\u7ba1\u7406\u5458\u5bc6\u7801\ndata_volume: /data/harbor    # \u955c\u50cf\u6587\u4ef6\u5b58\u50a8\u8def\u5f84\uff0c\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u7a7a\u6587\u4ef6\u5939\u4e14\u7a7a\u95f4\u8db3\u591f\n\nexternal_url: http://hub.gitee.cc\n</code></pre> <p>\u6267\u884c\u5b89\u88c5\u547d\u4ee4</p> <pre><code>## \u540c\u65f6\u5f00\u542f helm chart \u4ed3\u5e93\u652f\u6301\n$ sudo ./install.sh --with-chartmuseum\n</code></pre> <p>\u5b8c\u6210</p> <p>\u6210\u529f\u542f\u52a8\u540e\uff0c\u5373\u53ef\u901a\u8fc7\u914d\u7f6e\u7684\u5730\u5740\u6216\u57df\u540d\u8bbf\u95ee\u3002</p> <p>\u5982\u679c\u914d\u7f6e\u4e0d\u662fHTTPS\u534f\u8bae\uff0c\u6240\u6709\u7684Kubernetes\u8282\u70b9\u7684Docker\uff08\u5982\u679c\u662fcontainerd\u4f5c\u4e3aRuntime\uff0c\u53ef\u4ee5\u53c2\u8003\u4e0b\u6587\u914d\u7f6einsecure-registry\uff09\u90fd\u9700\u8981\u6dfb \u52a0insecure-registries\u914d\u7f6e\uff1a</p> <pre><code>$ cat &gt;/etc/docker/daemon.json &lt;&lt;EOF\n{\n  \"insecure-registries\": [\"http://hub.gitee.cc\"],\n  \"registry-mirrors\": [\"https://25bxwt20.mirror.aliyuncs.com\"],\n  \"live-restore\": true,\n  \"default-shm-size\": \"128M\",\n  \"max-concurrent-downloads\": 10,\n  \"oom-score-adjust\": -1000,\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"hosts\": [\"tcp://0.0.0.0:2375\", \"unix:///var/run/docker.sock\"],\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"100m\",\n    \"max-file\":\"3\"\n  }\n}\nEOF\n$ systemctl daemon-reload\n$ systemctl restart docker\n</code></pre> <p>\u90e8\u7f72\u5b8c\u6210\u540e\u5982\u679c\u9700\u8981\u4fee\u6539harbor.yml \uff0c\u9700\u8981\u5728\u4fee\u6539\u540e\u91cd\u65b0\u521d\u59cb\u5316\u914d\u7f6e\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <pre><code>docker-compose down -v\nvim harbor.yml\nsudo ./prepare --with-chartmuseum\ndocker-compose up -d\n</code></pre> <p>\u521b\u5efaexternal nginx \u914d\u7f6e\u6587\u4ef6</p> <p>\u6839\u636e\u5b9e\u9645\u73af\u5883\u914d\u7f6e</p> <pre><code>upstream harbor {\n    server 192.168.1.188:8080;\n    keepalive 32;\n}\n\nserver {\n    listen 80;\n    server_name hub.gitee.com;\n    access_log /var/log/nginx/hub_302_access.log main;\n    error_log /var/log/nginx/hub_302_error.log;\n    return 302 https://$server_name$request_uri;\n}\n\nserver {\n    include ssl.d/ssl.conf;\n    server_name hub.gitee.com;\n    access_log /var/log/nginx/hub_access.log main;\n    error_log /var/log/nginx/hub_error.log;\n\n    location / {\n        proxy_set_header Connection \"\";\n        proxy_set_header Host $http_host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Frame-Options SAMEORIGIN;\n        proxy_buffers 256 16k;\n        proxy_buffer_size 16k;\n        proxy_read_timeout 600s;\n        proxy_cache_revalidate on;\n        proxy_cache_min_uses 2;\n        proxy_cache_use_stale timeout;\n        proxy_cache_lock on;\n        proxy_http_version 1.1;\n        proxy_pass http://harbor;\n    }\n\n    error_page 500 502 503 504 /50x.html;\n    location = /50x.html {\n        root /usr/share/nginx/html;\n    }\n}\n</code></pre> <p>\u767b\u5f55\u6d4b\u8bd5\uff1a</p> <pre><code>$ docker login http://hub.gitee.cc\nUsername: admin\nPassword:\nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n</code></pre> <p>\u63a5\u4e0b\u6765\u5728Harbor\u4e0a\u521b\u5efa\u4e00\u4e2aProject\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\u521b\u5efa\u4e00\u4e2a\u540d\u4e3akubernetes\u7684Project</p> <p></p> <p>\u4e4b\u540e\u5728\u670d\u52a1\u5668\u4e0a\u627e\u4efb\u610f\u4e00\u4e2a\u955c\u50cf\uff0c\u4fee\u6539tag\u4e3aHarbor\u7684\u5730\u5740\uff0c\u5e76\u8fdb\u884cpush\u6d4b\u8bd5\uff1a</p> <pre><code>$ docker tag kubeoperator/webkubectl:latest hub.gitee.cc/kubernetes/webkubectl:latest\n$ docker push hub.gitee.cc/kubernetes/webkubectl:latest\nThe push refers to repository [hub.gitee.cc/kubernetes/webkubectl]\n99b13cfbfb0f: Pushed\n0e658bc0176b: Pushed\n9eba8e5bc7c8: Pushed\nadc0cdf505f7: Pushed\nad4e41a7f1d3: Pushed\n7ba699eb6203: Pushed\nb4c5273b6d27: Pushed\ne5e13b0c77cb: Mounted from library/mailcat\nlatest: digest: sha256:51cacad0e26ebacc59de84ba71fb50e161ff3e1b8337e39d448c91d6cd048062 size: 1990\n</code></pre> <p>\u4e4b\u540e\u5c31\u53ef\u4ee5\u5728Harbor\u67e5\u770b\u8be5\u955c\u50cf\uff0c\u5982\u56fe</p> <p></p> <p>\u5982\u679c\u8bfb\u8005\u7684Kubernetes\u96c6\u7fa4\u91c7\u7528\u7684\u662fContainerd\u4f5c\u4e3aRuntime\uff0c\u914d\u7f6einsecure-registry\u53ea\u9700\u8981\u5728Containerd\u914d\u7f6e\u6587\u4ef6\u7684mirrors\u4e0b\u6dfb\u52a0\u81ea\u5df1\u7684\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u5373\u53ef\u3002</p> <pre><code>## Containerd\u914d\u7f6einsecure\u4ed3\u5e93\n$ vim /etc/containerd/config.toml\n   [plugins.\"io.containerd.grpc.v1.cri\".registry]\nconfig_path = \"\"\n[plugins.\"io.containerd.grpc.v1.cri\".registry.auths]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"hub.gitee.cc\".tls]\ninsecure_skip_verify = true\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"hub.gitee.cc\".auth]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.headers]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\nendpoint = [\"https://pooj3a7i.mirror.aliyuncs.com\"]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"hub.gitee.cc\"]\nendpoint = [\"http://hub.gitee.cc\"]\n.....\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u542fContainerd\uff0c\u4e4b\u540e\u8fdb\u884cpull\u6d4b\u8bd5\uff1a</p> <pre><code>$ systemctl restart containerd\n$ ctr -n k8s.io image pull hub.gitee.cc/kubernetes/webkubectl:latest --plain-http --user admin:oschina123 </code></pre> <p>\u81f3\u6b64\uff0c\u7528\u5230\u7684\u5de5\u5177\u90fd\u5df2\u7ecf\u5b89\u88c5\u5b8c\u6210\u3002\u63a5\u4e0b\u6765\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u914d\u7f6e\u3002</p> <p>\u53c2\u8003\u6587\u732e</p> <p>Harbor\u914d\u5408Nginx\u914d\u7f6e\u516c\u7f51\u57df\u540d</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-helm\u65b9\u5f0f\u90e8\u7f72","title":"2. helm\u65b9\u5f0f\u90e8\u7f72","text":"<p>\u524d\u63d0\u6761\u4ef6\uff1aNFS \u7c7b\u578b\u7684 StorageClass \u6765\u505a\u6301\u4e45\u5316\u5b58\u50a8,  StorageClass \u540d\u79f0<code>gitee-nfs-client</code></p> <p>Chart \u4ed3\u5e93\u5730\u5740\uff1ahttps://helm.goharbor.io</p> <p>\u7531\u4e8e Harbor \u6d89\u53ca\u7684\u7ec4\u4ef6\u592a\u591a\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u7528\u66f4\u52a0\u4fbf\u6377\u7684 Helm \u6765\u8fdb\u884c\u5b89\u88c5\u3002\u9996\u5148\u6dfb\u52a0 Chart \u4ed3\u5e93\u5730\u5740\uff1a</p> <pre><code># \u6dfb\u52a0 Chart \u4ed3\u5e93\n$ helm repo add harbor https://helm.goharbor.io\n\n# \u66f4\u65b0\n$ helm repo update\n</code></pre> <p>\u6211\u4eec\u4f7f\u7528\u5b9a\u5236\u7684 values \u6587\u4ef6\u6765\u8fdb\u884c\u5b89\u88c5\u4e86\uff0c\u5b8c\u6574\u5b9a\u5236\u7684 values \u6587\u4ef6\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code># \u62c9\u53d61.10.1\u7248\u672c\u5e76\u89e3\u538b\n$ helm pull harbor/harbor --version 1.10.1\n$ helm pull harbor/harbor --untar --version 1.10.1\n\n$ cat &gt; values-prod.yaml &lt;&lt;'EOF'\n# \u5916\u7f51\u8bbf\u95eeIP\nexternalURL: http://106.12.45.72:30002\nharborAdminPassword: Harbor12345\nlogLevel: debug\nexpose:\n  type: nodePort\n  tls:\n    enabled: false\n  nodePort:\n    name: harbor\n    ports:\n      http:\n        port: 80\n        nodePort: 30002\n      https:\n        port: 443\n        nodePort: 30003\n      notary:\n        port: 4443\n        nodePort: 30004\npersistence:\n  enabled: true\n  resourcePolicy: \"keep\"\n  persistentVolumeClaim:\n    registry:\n      storageClass: \"gitee-nfs-client\"\n      # \u5982\u679c\u662f\u9ad8\u53ef\u7528\u7684\uff0c\u591a\u4e2a\u526f\u672c\u7ec4\u4ef6\u9700\u8981\u4f7f\u7528 ReadWriteMany\uff0c\u9ed8\u8ba4\u4e3a ReadWriteOnce\n      accessMode: ReadWriteMany\n      size: 500Gi\n    chartmuseum:\n      storageClass: \"gitee-nfs-client\"\n      accessMode: ReadWriteMany\n      size: 20Gi\n    jobservice:\n      storageClass: \"gitee-nfs-client\"\n      accessMode: ReadWriteMany\n      size: 10Gi\n    database:\n      storageClass: \"gitee-nfs-client\"\n      accessMode: ReadWriteMany\n      size: 20Gi\n    redis:\n      storageClass: \"gitee-nfs-client\"\n      accessMode: ReadWriteMany\n      size: 8Gi\n    trivy:\n      storageClass: \"gitee-nfs-client\"\n      accessMode: ReadWriteMany\n      size: 10Gi\n# \u4f7f\u7528Harboar\u5185\u7f6e\u7684PostgreSQL\u548credis\u6570\u636e\u5e93\ndatabase:\n  type: internal\n  internal:\n    serviceAccountName: \"\"\n    image:\n      repository: goharbor/harbor-db\n      tag: v2.2.2\n    password: \"oschina123\"\nredis:\n  type: internal\n  internal:\n    serviceAccountName: \"\"\n    image:\n      repository: goharbor/redis-photon\n      tag: v2.2.2\nportal:\n  replicas: 2\ncore:\n  replicas: 2\njobservice:\n  replicas: 2\nregistry:\n  replicas: 2\nchartmuseum:\n  replicas: 2\nclair:\n  replicas: \nnotary:\n  server:\n    replicas: 2\n  signer:\n    replicas: 2\nEOF\n$ helm install -f values-prod.yaml harbor harbor --namespace pub-comm --create-namespace\n</code></pre> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\u9694\u4e00\u4f1a\u513f\u5c31\u53ef\u4ee5\u5b89\u88c5\u6210\u529f\u4e86\uff1a</p> <pre><code>$ helm ls -n pub-comm\nNAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION\nharbor          pub-comm        1               2022-10-19 09:41:55.531221406 +0800 CST deployed        harbor-1.6.2            2.2.2\n$ kubectl get pods -n pub-comm -l app=harbor\nharbor-harbor-chartmuseum-5d5dc4c5fc-75qx2     1/1     Running   0          3m24s\nharbor-harbor-chartmuseum-5d5dc4c5fc-xsngf     1/1     Running   0          3m24s\nharbor-harbor-core-5559c6b95d-wqcgb            1/1     Running   2          3m24s\nharbor-harbor-core-5559c6b95d-xlxpd            1/1     Running   2          3m24s\nharbor-harbor-database-0                       1/1     Running   0          3m24s\nharbor-harbor-jobservice-7599dc87cd-95z8v      1/1     Running   2          3m24s\nharbor-harbor-jobservice-7599dc87cd-np8jr      1/1     Running   0          3m24s\nharbor-harbor-nginx-9bc874c4c-xfgrc            1/1     Running   0          3m24s\nharbor-harbor-notary-server-7788bcd6c4-wbgdn   1/1     Running   3          3m24s\nharbor-harbor-notary-server-7788bcd6c4-z2hxq   1/1     Running   3          3m24s\nharbor-harbor-notary-signer-58894fb464-59k6z   1/1     Running   3          3m24s\nharbor-harbor-notary-signer-58894fb464-vr6t6   1/1     Running   0          3m24s\nharbor-harbor-portal-559c4d4bfd-kmdnx          1/1     Running   0          3m24s\nharbor-harbor-portal-559c4d4bfd-v8vqx          1/1     Running   0          3m24s\nharbor-harbor-redis-0                          1/1     Running   0          3m24s\nharbor-harbor-registry-9b46998cf-kd969         2/2     Running   0          3m24s\nharbor-harbor-registry-9b46998cf-kmjmq         2/2     Running   0          3m24s\nharbor-harbor-trivy-0                          1/1     Running   0          3m23s\n\n$ kubectl get svc -n pub-comm -l app=harbor\nNAME                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                       AGE\nharbor                        NodePort    172.24.58.77     &lt;none&gt;        80:30002/TCP,4443:30004/TCP   5m16s\nharbor-harbor-chartmuseum     ClusterIP   172.24.99.83     &lt;none&gt;        80/TCP                        5m16s\nharbor-harbor-core            ClusterIP   172.24.117.61    &lt;none&gt;        80/TCP                        5m16s\nharbor-harbor-database        ClusterIP   172.24.252.137   &lt;none&gt;        5432/TCP                      5m16s\nharbor-harbor-jobservice      ClusterIP   172.24.51.73     &lt;none&gt;        80/TCP                        5m16s\nharbor-harbor-notary-server   ClusterIP   172.24.241.2     &lt;none&gt;        4443/TCP                      5m16s\nharbor-harbor-notary-signer   ClusterIP   172.24.177.134   &lt;none&gt;        7899/TCP                      5m16s\nharbor-harbor-portal          ClusterIP   172.24.192.233   &lt;none&gt;        80/TCP                        5m16s\nharbor-harbor-redis           ClusterIP   172.24.242.178   &lt;none&gt;        6379/TCP                      5m16s\nharbor-harbor-registry        ClusterIP   172.24.182.141   &lt;none&gt;        5000/TCP,8080/TCP             5m16s\nharbor-harbor-trivy           ClusterIP   172.24.251.45    &lt;none&gt;        8080/TCP                      5m16s\n</code></pre> <p>\u5982\u4e0a\u72b6\u6001\u6240\u793a\u8868\u793aharbor\u90e8\u7f72\u5b8c\u6210\uff0c\u8bbf\u95ee\u4f7f\u7528externalURL: http://106.12.45.72:30002\u8fdb\u884c\u8bbf\u95ee\uff0c\u7528\u6237\u540d\u4f7f\u7528\u9ed8\u8ba4\u7684 admin\uff0c\u5bc6\u7801\u5219\u662f\u4e0a\u9762\u914d\u7f6e\u7684\u9ed8\u8ba4 <code>Harbor12345</code>\u3002</p> <p>\u53c2\u8003\u6587\u732e</p> <p>Harbor \u5b89\u88c5\u914d\u7f6e(k8s)</p> <p>Kubernetes\u90e8\u7f72Harbor</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#54-jenkins\u51ed\u8bc1credentials","title":"5.4 Jenkins\u51ed\u8bc1Credentials","text":"<p>\u5728\u4f7f\u7528Jenkins\u3001GitLab\u3001Harbor\u3001Kubernetes\u6253\u9020DevOps\u5e73\u53f0\u5b9e\u73b0CI/CD\u65f6\uff0c\u9700\u8981\u6d89\u53ca\u5f88\u591a\u8bc1\u4e66\u3001\u8d26\u53f7\u548c\u5bc6\u7801\u3001\u516c\u94a5\u548c\u79c1\u94a5\u7684\u914d\u7f6e\uff0c\u8fd9\u4e9b\u51ed\u8bc1\u9700 \u8981\u653e\u5728\u4e00\u4e2a\u7edf\u4e00\u7684\u5730\u65b9\u7ba1\u7406\uff0c\u5e76\u4e14\u80fd\u5728\u6574\u4e2a\u6d41\u6c34\u7ebf\u4e2d\u4f7f\u7528\uff0c\u800cJenkins\u63d0\u4f9b\u7684Credentials\u63d2\u4ef6\u53ef\u4ee5\u6ee1\u8db3\u4ee5\u4e0a\u8981\u6c42\uff0c\u5e76\u4e14\u5728\u6d41\u6c34\u7ebf\u4e2d\u4e5f\u4e0d\u4f1a\u6cc4\u9732\u76f8\u5173\u7684\u52a0\u5bc6 \u4fe1\u606f\u3002</p> <p>\u6240\u4ee5Harbor\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u3001GitLab\u7684\u79c1\u94a5\u3001Kubernetes\u7684\u8bc1\u4e66\u5747\u4f7f\u7528Jenkins\u7684Credentials\u7ba1\u7406\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#1-\u914d\u7f6ekubernetes\u8bc1\u4e66","title":"1. \u914d\u7f6eKubernetes\u8bc1\u4e66","text":"<p>\u5728\u5b89\u88c5\u548c\u7ef4\u62a4Kubernetes\u96c6\u7fa4\u65f6\uff0c\u90fd\u662f\u4f7f\u7528kubectl\u64cd\u4f5c\u96c6\u7fa4\uff0c\u800ckubectl\u64cd\u4f5c\u96c6\u7fa4\u9700\u8981\u4e00\u4e2aKUBECONFIG\u6587\u4ef6\uff0c\u6211\u4eec\u4f7f\u7528Jenkins\u63a7\u5236Kubernetes\u65f6\uff0c\u4e5f\u662f\u4f7f\u7528\u8be5\u6587\u4ef6\uff0c\u6240\u4ee5\u8be5\u6587\u4ef6\u9700\u8981\u653e\u7f6e\u5728Credentials\u4e2d\uff0c\u4e4b\u540e\u53ef\u4ee5\u88abJenkins\u7684Kubernetes\u63d2\u4ef6\u4f7f\u7528\u3002</p> <p>\u9996\u5148\u9700\u8981\u627e\u5230\u96c6\u7fa4\u4e2d\u7684KUBECONFIG\uff0c\u4e00\u822c\u662fkubectl\u8282\u70b9\u7684~/.kube/config\u6587\u4ef6\uff0c\u6216\u8005\u662fKUBECONFIG\u73af\u5883\u53d8\u91cf\u6240\u6307\u5411\u7684\u6587\u4ef6\u3002</p> <p>\u63a5\u4e0b\u6765\u53ea\u9700\u8981\u628a\u8bc1\u4e66\u6587\u4ef6\u653e\u7f6e\u4e8eJenkins\u7684Credentials\u4e2d\u5373\u53ef\u3002\u9996\u5148\u5355\u51fbManage Jenkins\uff0c\u4e4b\u540e\u5355\u51fbManage Credentials\u3002</p> <p>\u7136\u540e\u5355\u51fbGlobal\u7684\u4e0b\u62c9\u9009\u9879\uff0c\u4e4b\u540e\u5355\u51fbAdd Credentials\u3002 \u5728\u6253\u5f00\u6dfb\u52a0\u51ed\u8bc1\u9875\u9762\u65f6\uff0c\u9700\u8981\u5c06\u51ed\u8bc1\u7c7b\u578b\u6539\u4e3aSecret file\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <ul> <li>File\uff1aKUBECONFIG\u6587\u4ef6\u6216\u5176\u4ed6\u52a0\u5bc6\u6587\u4ef6\u3002</li> <li>ID\uff1a\u8be5\u51ed\u8bc1\u7684ID\u3002</li> <li>Description\uff1a\u8bc1\u4e66\u7684\u63cf\u8ff0\u3002</li> </ul> <p></p> <p>\u6dfb\u52a0Kubernetes\u7684kubeconfig</p> <p>\u53ea\u9700\u8981\u7b80\u5355\u7684\u51e0\u6b65\uff0c \u5c31\u53ef\u4ee5\u6dfb\u52a0Kubernetes\u7684KUBECONFIG\u6587\u4ef6\u81f3Jenkins\uff0c\u4e4b\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528\u524d\u9762\u8bb2\u8fc7\u7684Jenkins\u8bed\u6cd5\u5f15\u7528\u8be5\u51ed\u8bc1\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#2-\u914d\u7f6eharbor\u8d26\u53f7\u548c\u5bc6\u7801","title":"2. \u914d\u7f6eHarbor\u8d26\u53f7\u548c\u5bc6\u7801","text":"<p>\u5bf9\u4e8e\u8d26\u53f7\u3001\u5bc6\u7801\u548cKey\u7c7b\u578b\u7684\u51ed\u8bc1\uff0c\u914d\u7f6e\u6b65\u9aa4\u662f\u4e00\u81f4\u7684\uff0c\u53ea\u662f\u9009\u62e9\u7684\u51ed\u8bc1\u7c7b\u578b\u4e0d\u4e00\u6837\u3002\u63a5\u4e0b\u6765\u901a\u8fc7Jenkins\u51ed\u8bc1\u7ba1\u7406Harbor\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u3002</p> <p>\u5728\u540c\u6837\u7684\u4f4d\u7f6e\u5355\u51fbAdd Credentials</p> <p>\u9009\u62e9\u7c7b\u578b\u4e3aUsername with password\uff0c\u5982\u56fe</p> <p></p> <ul> <li>Username\uff1aHarbor\u6216\u8005\u5176\u4ed6\u5e73\u53f0\u7684\u7528\u6237\u540d\u3002</li> <li>Password\uff1aHarbor\u6216\u8005\u5176\u4ed6\u5e73\u53f0\u7684\u5bc6\u7801\u3002</li> <li>ID\uff1a\u8be5\u51ed\u8bc1\u7684ID\uff0charbor-user-passwd\u3002</li> <li>Description\uff1a\u8bc1\u4e66\u7684\u63cf\u8ff0</li> </ul> <p>\u4e4b\u540e\u5355\u51fbOK\u6309\u94ae\u4fdd\u5b58\u5373\u53ef\uff0c\u7136\u540e\u5728\u6d41\u6c34\u7ebf\u4e2d\u5373\u53ef\u901a\u8fc7\u7c7b\u4f3cenvironment\u8fd9\u6837\u7684\u6307\u4ee4\u5f15\u7528\u8be5\u51ed\u8bc1\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#3-\u914d\u7f6egitlab-key","title":"3. \u914d\u7f6eGitLab Key","text":"<p>\u5728\u642d\u5efaGitLab\u65f6\uff0c\u5c06Jenkins\u670d\u52a1\u5668\u7684\u516c\u94a5\u653e\u5728GitLab\u4e2d\uff0c\u4e4b\u540eJenkins\u5c31\u53ef\u4ee5\u901a\u8fc7\u81ea\u5df1\u7684\u79c1\u94a5\u767b\u5f55GitLab\uff0c\u7136\u540e\u4e0b\u8f7d\u548c\u4e0a\u4f20\u4ee3\u7801\u3002</p> <p>\u5728\u6d41\u6c34\u7ebf\u7684\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5f80\u5f80\u7b2c\u4e00\u4e2a\u8fc7\u7a0b\u5c31\u662f\u4e0b\u8f7d\u4ee3\u7801\uff0c\u6240\u4ee5Jenkins\u7684\u6d41\u6c34\u7ebf\u9700\u8981\u6709\u4e0b\u8f7d\u4ee3\u7801\u7684\u6743\u9650\u3002\u6b64\u65f6\u53ef\u4ee5\u5c06Jenkins\u7684\u79c1\u94a5\u4fdd\u5b58\u81f3Jenkins\u51ed \u8bc1\u4e2d\uff0c\u4e4b\u540e\u5728\u6d41\u6c34\u7ebf\u4e2d\u5f15\u7528\u5373\u53ef\u3002</p> <p>\u5355\u51fbAdd Credentials\uff0c\u7c7b\u578b\u9009\u62e9\u4e3aSSH Username with private key\uff0c\u5982\u56fe</p> <ul> <li>Username\uff1a\u7528\u6237\u540d\uff0c\u65e0\u5f3a\u5236\u6027\u3002</li> <li>Private Key\uff1aJenkins\u670d\u52a1\u5668\u7684\u79c1\u94a5\uff0c\u4e00\u822c\u4f4d\u4e8e~/.ssh/id_rsa</li> </ul> <pre><code># tree -a\n.\n\u251c\u2500\u2500 bin\n    \u251c\u2500\u2500 docker \u251c\u2500\u2500 helm\n    \u2514\u2500\u2500 kubectl\n\u251c\u2500\u2500 config\n    \u2514\u2500\u2500 config\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 .ssh\n    \u251c\u2500\u2500 authorized_keys\n    \u251c\u2500\u2500 id_rsa\n    \u251c\u2500\u2500 id_rsa.pub\n    \u2514\u2500\u2500 known_hosts\n\n## \u6211\u4eec\u5df2\u7ecf\u5c06Jenkins\u670d\u52a1\u5668\u7684\u79c1\u94a5\u653e\u5165jenkins-slave\u5bb9\u5668\u4e2d\n</code></pre> <p></p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#4-\u914d\u7f6egitlab\u8d26\u53f7\u5bc6\u7801","title":"4. \u914d\u7f6eGitLab\u8d26\u53f7\u5bc6\u7801","text":"<p>\u7531\u4e8e\u6211\u4eec\u662f\u5728\u4e00\u4e2a Slave Pod \u4e2d\u53bb\u8fdb\u884c\u6784\u5efa\uff0c\u6240\u4ee5\u5982\u679c\u4f7f\u7528 SSH \u7684\u65b9\u5f0f\u53bb\u8bbf\u95ee Gitlab \u4ee3\u7801\u4ed3\u5e93\u7684\u8bdd\u5c31\u9700\u8981\u9891\u7e41\u7684\u53bb\u66f4\u65b0 <code>SSH-KEY</code>\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u91c7\u7528\u76f4\u63a5\u4f7f\u7528\u7528\u6237\u540d\u548c\u5bc6\u7801\u7684\u5f62\u5f0f\u6765\u65b9\u5f0f\u3002</p> <p>\u5728 <code>Credentials</code> \u533a\u57df\u70b9\u51fb\u6dfb\u52a0\u6309\u94ae\u6dfb\u52a0\u6211\u4eec\u8bbf\u95ee Gitlab \u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff1a</p> <p></p> <p>\u901a\u8fc7\u4e0a\u8ff04\u79cd\u7c7b\u578b\u51ed\u8bc1\u7684\u914d\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5bf9Kubernetes\u8bc1\u4e66\u3001Harbor\u8d26\u53f7\u548c\u5bc6\u7801\u4ee5\u53caGitLab Key\u6216\u8005\u8d26\u53f7\u5bc6\u7801\u8fdb\u884c\u7ba1\u7406\u3002</p> <p>\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u9664Jenkins\u7684\u51ed\u8bc1\u5916\uff0c\u5176\u4ed6\u7c7b\u578b\u7684\u51ed\u8bc1\u4e5f\u53ef\u4ee5\u5728Jenkins\u4e2d\u7ba1\u7406\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#55-\u914d\u7f6eagent","title":"5.5 \u914d\u7f6eAgent","text":"<p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cJenkins Slave\u4f1a\u901a\u8fc7Jenkins Master\u8282\u70b9\u768450000\u7aef\u53e3\u4e0e\u4e4b\u901a\u4fe1\uff0c\u6240\u4ee5\u9700\u8981\u5f00\u542fAgent\u768450000\u7aef\u53e3\u3002</p> <p>\u5355\u51fbManage Jenkins\uff0c\u7136\u540e\u5355\u51fbConfigure Global Security\uff0c\u5728\u5b89\u5168\u914d\u7f6e\u4e0b\u65b9\u627e\u5230Agents\uff0c\u5355\u51fbFixed\uff0c\u8f93\u516550000\u5373\u53ef\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u6ca1\u6709\u5fc5\u8981\u628a\u6574\u4e2aKubernetes\u96c6\u7fa4\u7684\u8282\u70b9\u90fd\u5145\u5f53\u521b\u5efaJenkins Slave Pod\u7684\u8282\u70b9\uff0c\u53ef\u4ee5\u9009\u62e9\u4efb\u610f\u4e00\u4e2a\u6216\u591a\u4e2a\u8282\u70b9\u4f5c\u4e3a\u521b\u5efaSlave Pod\u7684\u8282 \u70b9\u3002</p> <p>\u63a5\u4e0b\u6765\u9009\u62e9\u4e00\u4e2a\u6216\u591a\u4e2a\u8282\u70b9\u4f5c\u4e3aKubernetes\u521b\u5efaJenkins Slave Pod\u7684\u8282\u70b9\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u4e00\u4e2a\u6807\u7b7e\u5373\u53ef\uff0c\u4e4b\u540eJenkinsfile\u7684agent\u4f1a\u6839\u636e\u6807\u7b7e\u521b\u5efa Slave Pod\u3002\u5047\u8bbek8s-node01\u4f5c\u4e3aSlave\u8282\u70b9\uff1a</p> <pre><code># kubectl label node k8s-node01 build=true\n# kubectl get nodes k8s-node01 --show-labels\nNAME         STATUS   ROLES     AGE     VERSION   LABELS\nk8s-node01   Ready    ingress   7d18h   v1.25.6   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,build=true,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node01,kubernetes.io/os=linux,node-role.kubernetes.io/ingress=true\n</code></pre> <p>\u81ea\u7531\u98ce\u683c\u91cc\u9762\u914d\u7f6e Cloud\u4e2d\u914d\u7f6e\u5982\u4e0b\uff1a</p> <p></p> <p>pipeline\u6d41\u6c34\u7ebf\u4e2d\u914d\u7f6e\u5982\u4e0b</p> <pre><code>pipeline{\n......\n\n    agent {\n        kubernetes {\n            cloud 'kubernetes'\n            slaveConnectTimeout 1200\n            workspaceVolume nfsWorkspaceVolume(serverAddress: \"192.168.1.60\", serverPath: \"/QaTest/jenkins-salve\", readOnly: \"false\")\n            yaml '''\n\n---\napiVersion: \"v1\"\nkind: \"Pod\"\nmetadata:\n  labels:\n    jenkins: \"slave\"\n    jenkins/label: \"jenkins-jnlp\"\n  name: \"jenkins-slave\"\n  namespace: \"kube-ops\"\n\nspec:\n  containers:\n  - env:\n    - name: \"DOCKER_HOST\"\n      value: \"tcp://docker-dind:2375\"\n\n    - name: \"JENKINS_AGENT_WORKDIR\"\n      value: \"/home/jenkins/agent\"\n\n    image: \"hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11\"\n    imagePullPolicy: \"IfNotPresent\"\n    .....\n  hostNetwork: false\n  imagePullSecrets:\n  - name: \"regcred\"\n  nodeSelector:\n    build: \"true\"\n......\n }\n</code></pre> <p>\u8bfb\u8005\u7684Kubernetes\u96c6\u7fa4\u53ef\u80fd\u5e76\u975e\u4f7f\u7528Docker\u4f5c\u4e3aRuntime\uff0c\u4f46\u662f\u7531\u4e8e\u6784\u5efa\u955c\u50cf\u65f6\u9700\u8981\u4f7f\u7528Docker\uff0c\u56e0\u6b64\u8be5\u8282\u70b9\u9700\u8981\u5b89\u88c5Docker\uff1a</p> <pre><code>$ wget https://download.docker.com/linux/static/stable/aarch64/docker-20.10.9.tgz\n$ tar zxf docker-20.10.9.tgz\n$ cp docker/* /usr/bin\n$ cat &gt;/lib/systemd/system/docker.service &lt;&lt;EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service\nWants=network-online.target\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd\nExecReload=/bin/kill -s HUP $MAINPID\nLimitNOFILE=infinity\nLimitNPROC=infinity\nTimeoutStartSec=0\nDelegate=yes\nKillMode=process\nRestart=on-failure\nStartLimitBurst=3\nStartLimitInterval=60s\n[Install]\nWantedBy=multi-user.target\nEOF\n$ systemctl daemon-reload\n$ systemctl enable --now docker $ docker version\n\n# \u5982\u679c\u955c\u50cf\u4ed3\u5e93\u672a\u914d\u7f6e\u8bc1\u4e66\uff0c\u5219\u9700\u8981\u914d\u7f6einsecure-registry\uff1a\n$ cat &gt; /etc/docker/daemon.json &lt;&lt;'EOF'\n{\n  \"graph\": \"/data/docker\",\n  \"storage-driver\": \"overlay2\",\n  \"insecure-registries\": [\"hub.gitee.cc\"],\n  \"registry-mirrors\": [\"https://25bxwt20.mirror.aliyuncs.com\"],\n  \"live-restore\": true,\n  \"bip\": \"172.16.200.1/24\",\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"hosts\": [\"tcp://0.0.0.0:2375\", \"unix:///var/run/docker.sock\"],\n  \"log-opts\": {\n    \"max-size\":\"100M\",\n    \"max-file\":\"3\"\n  }\n}\nEOF\n$ systemctl restart docker\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#56-jenkins\u914d\u7f6ekubernetes\u591a\u96c6\u7fa4","title":"5.6 Jenkins\u914d\u7f6eKubernetes\u591a\u96c6\u7fa4","text":"<p>\u672c\u4e66\u8bb2\u89e3\u7684Pipeline\u91c7\u7528\u7684Agent\u4e3a\u5728Kubernetes\u96c6\u7fa4\u4e2d\u521b\u5efa\u7684Pod\uff0c\u6240\u4ee5Jenkins\u8981\u63a7\u5236Kubernetes\u96c6\u7fa4\u521b\u5efaPod\u5145\u5f53Jenkins\u7684Slave\u3002</p> <p>\u4e4b\u524d\u6211\u4eec\u6dfb\u52a0\u4e86Kubernetes\u7684\u8bc1\u4e66\u81f3Jenkins\u51ed\u8bc1\uff0c\u63a5\u4e0b\u6765\u5728Jenkins\u4e2d\u914d\u7f6eKubernetes\u76f4\u63a5\u5f15\u7528\u8be5\u8bc1\u4e66\u3002</p> <p>\u9996\u5148\u5355\u51fbManage Jenkins\uff0c\u4e4b\u540e\u5355\u51fbConfigure Clouds\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u5355\u51fbAdd a new cloud\uff0c\u9009\u62e9Kubernetes</p> <p>\u4e4b\u540e\u5728Name\u5b57\u6bb5\u8f93\u5165\u96c6\u7fa4\u7684\u540d\u79f0\uff0c\u4e00\u822c\u8f93\u5165\u53ef\u8bc6\u522b\u7684\u540d\u79f0\u5373\u53ef\uff0c\u6bd4\u5982\u73b0\u5728\u662f\u5b66\u4e60\u73af \u5883 \u7684 Kubernetes \uff0c \u53ef \u4ee5 \u53eb \u4f5c kubernetes\u3002 </p> <p>\u4e4b\u540e\u5355\u51fbKubernetes Cloud details\uff0c\u5982\u56fe</p> <p>\u7136\u540e\u5728Credentials\u5904\u9009\u62e9\u4e4b\u524d\u6dfb\u52a0\u7684Kubernetes\u8bc1\u4e66\uff0c\u9009\u62e9\u540e\u5355\u51fbTest Connection\uff0c\u6700\u540e\u5728\u51ed\u8bc1\u4e0b\u65b9\u5373\u53ef\u770b\u5230\u80fd\u5426\u6b63\u5e38\u8fde\u63a5\u7684\u7ed3\u679c\u3002</p> <p></p> <p>\u6700\u540e\u5355\u51fbSave\u5373\u53ef\uff0c\u6dfb\u52a0\u5b8cKubernetes\u540e\uff0c\u5728Jenkinsfile\u7684Agent\u4e2d\u5c31\u53ef\u4ee5\u9009\u62e9\u8be5\u96c6\u7fa4\u4f5c\u4e3a\u521b\u5efaSlave\u7684\u96c6\u7fa4\u3002</p> <p>\u5982\u679c\u60f3\u8981\u6dfb\u52a0\u591a\u4e2a\u96c6\u7fa4\uff0c\u91cd\u590d\u4e0a\u8ff0\u6b65\u9aa4\u5373\u53ef\u3002\u9996\u5148\u6dfb\u52a0Kubernetes\u51ed\u8bc1\uff0c\u7136\u540e\u6dfb\u52a0Cloud\u5373\u53ef\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#6-\u81ea\u52a8\u5316\u6784\u5efajava\u5e94\u7528","title":"6. \u81ea\u52a8\u5316\u6784\u5efaJava\u5e94\u7528","text":"<p>\u672c\u8282\u5c06\u6f14\u793a\u81ea\u52a8\u5316\u6784\u5efaJava\u5e94\u7528\uff0c\u4f7f\u7528Spring Cloud\u7684Eureka\u8fdb\u884c\u6f14\u793a\uff0c\u5176\u4ed6Spring Boot\u6216\u8005Java\u5e94\u7528\u57fa\u672c\u4e0a\u90fd\u662f\u540c\u6837\u7684\u6b65\u9aa4\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#61-\u90e8\u7f72kubernetes\u5e94\u7528","title":"6.1 \u90e8\u7f72Kubernetes\u5e94\u7528","text":"<p>\u4e0a\u9762\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86\u5982\u4f55\u5728 Jenkins Slave \u4e2d\u6784\u5efa\u4efb\u52a1\u4e86\uff0c\u90a3\u4e48\u5982\u4f55\u6765\u90e8\u7f72\u4e00\u4e2a\u539f\u751f\u7684 Kubernetes \u5e94\u7528\u5462\uff1f \u8981\u90e8\u7f72 Kubernetes \u5e94\u7528\uff0c\u6211\u4eec\u5c31\u5f97\u5bf9\u6211\u4eec\u4e4b\u524d\u90e8\u7f72\u5e94\u7528\u7684\u6d41\u7a0b\u8981\u975e\u5e38\u719f\u6089\u624d\u884c\uff0c\u6211\u4eec\u4e4b\u524d\u7684\u6d41\u7a0b\u662f\u600e\u6837\u7684\uff1a</p> <ul> <li>\u7f16\u5199\u4ee3\u7801</li> <li>\u6d4b\u8bd5</li> <li>\u7f16\u5199 Dockerfile</li> <li>\u6784\u5efa\u6253\u5305 Docker \u955c\u50cf</li> <li>\u63a8\u9001 Docker \u955c\u50cf\u5230\u4ed3\u5e93</li> <li>\u7f16\u5199 Kubernetes YAML \u6587\u4ef6</li> <li>\u66f4\u6539 YAML \u6587\u4ef6\u4e2d Docker \u955c\u50cf TAG</li> <li>\u5229\u7528 kubectl \u5de5\u5177\u90e8\u7f72\u5e94\u7528</li> </ul>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#62-\u521b\u5efajava\u6d4b\u8bd5\u7528\u4f8b","title":"6.2 \u521b\u5efaJava\u6d4b\u8bd5\u7528\u4f8b","text":"<p>\u672c\u4e66\u4e3a\u8bfb\u8005\u51c6\u5907\u4e86\u4e00\u4e2a\u7b80\u5355\u7684Java\u6d4b\u8bd5\u7528\u4f8b\uff0c\u7528\u4e8e\u8bfb\u8005\u7684\u5b66\u4e60\uff0c\u53ef\u4ee5\u4ecehttps://gitee.com/dukuan/spring-boot-project.git\u627e\u5230\u8be5\u9879\u76ee\uff08\u4e5f\u53ef\u4ee5 \u4f7f\u7528\u516c\u53f8\u7684Java\u9879\u76ee\uff09\u3002</p> <p>\u63a5\u4e0b\u6765\u5c06\u8be5\u9879\u76ee\u5bfc\u5165\u81ea\u5df1\u7684GitLab\u4e2d\u3002\u9996\u5148\u627e\u5230\u4e4b\u524d\u521b\u5efa\u7684Kubernetes\u7ec4\uff0c\u7136\u540e\u5355\u51fbNew project\uff0c\u5982\u56fe </p> <p>\u5728Git repository URL\u4e2d\u8f93\u5165\u793a\u4f8b\u5730\u5740\uff0c\u7136\u540e\u5355\u51fbCreate project\uff0c\u5982\u56fe </p> <p>\u5bfc\u5165\u540e\uff0c\u7ed3\u679c\u5982\u56fe </p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#63-\u5b9a\u4e49jenkinsfile","title":"6.3 \u5b9a\u4e49Jenkinsfile","text":"<p>\u5148\u5c06\u955c\u50cf\u4e0a\u4f20\u5230harbor\u79c1\u6709\u4ed3\u5e93</p> <pre><code># docker pull registry.cn-beijing.aliyuncs.com/citools/maven:3.5.3\n# docker tag registry.cn-beijing.aliyuncs.com/citools/maven:3.5.3 hub.gitee.cc/kubernetes/maven:3.5.3\n# docker push hub.gitee.cc/kubernetes/maven:3.5.3\n</code></pre> <p>Jenkinsfile\u5b9a\u4e49\u6d41\u6c34\u7ebf\u7684\u6b65\u9aa4\u5305\u62ec\u62c9\u53d6\u4ee3\u7801\u3001\u6267\u884c\u6784\u5efa\u3001\u751f\u6210\u955c\u50cf\u3001\u66f4\u65b0Kubernetes\u8d44\u6e90\u7b49\u3002</p> <p>\u672c\u4e66\u5c06Jenkinsfile\u653e\u7f6e\u4e8e\u9879\u76ee\u6e90\u4ee3\u7801\u4e00\u5e76\u7ba1\u7406\uff0c\u4e5f\u53ef\u4ee5\u5355\u72ec\u653e\u7f6e\u4e8e\u4e00\u4e2aGit\u4ed3\u5e93\u8fdb\u884c\u7ba1\u7406\u3002</p> <p>\u63a5\u4e0b\u6765\u5728GitLab\u7684\u6e90\u4ee3\u7801\u4e2d\u6dfb\u52a0Jenkinsfile\u3002\u9996\u5148\u5355\u51fb\u4ee3\u7801\u9996\u9875\u7684\u201c+\u201d\uff0c\u7136\u540e\u5355\u51fbNew file\uff0c</p> <p></p> <p>\u5728\u7a97\u53e3\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>pipeline{\n    // \u5b9a\u4e49\u4e00\u4e9b\u5168\u5c40\u7684\u73af\u5883\u53d8\u91cf\n    environment {\n        COMMIT_ID = \"\"\n        // harbor\u5730\u5740\n        HARBOR_ADDRESS = \"hub.gitee.cc\"\n        // harbor\u7684\u9879\u76ee\u76ee\u5f55\n        REGISTRY_DIR = \"kubernetes\"\n        // \u955c\u50cf\u540d\u79f0\n        IMAGE_NAME = \"spring-boot-project\"\n        // kubernetes\u4e2d\u7684\u540d\u79f0\u7a7a\u95f4\n        NAMESPACE = \"kubernetes\"\n        // \u955c\u50cf\u7684\u5206\u652f\uff0c\u7531BUILD_TAG+COMMIT_ID\u7ec4\u6210\n        TAG = \"\"\n        // gitlab\u8d26\u53f7\u5bc6\u7801\u8ba4\u8bc1\n        GITLAB_AUTH = \"gitlab-auth\"\n        // harbor\u8d26\u53f7\u5bc6\u7801\u8ba4\u8bc1\n        HARBOR_AUTH = \"harbor-user-passwd\"\n    }\n  parameters {\n    // \u4f7f\u7528GitParameter\u63d2\u4ef6\uff0c\u8be5\u5b57\u6bb5\u4f1a\u5728jenkins\u9875\u9762\u751f\u6210\u4e00\u4e2a\u9009\u62e9\u5206\u652f\u7684\u9009\u9879\n    gitParameter(branch: '', branchFilter: 'origin/(.*)', defaultValue: 'master', description: 'Branch for build and deploy', name: 'BRANCH', quickFilterEnabled: false, selectedValue: 'NONE', sortMode: 'NONE', tagFilter: '*', type: 'PT_BRANCH')\n  }\n\n    options {\n      parallelsAlwaysFailFast()\n      disableResume()\n      quietPeriod(1)\n      preserveStashes(buildCount: 5)\n      timestamps()\n      buildDiscarder(logRotator(numToKeepStr: '100'))\n      timeout(time: 60, unit: 'MINUTES')\n    }\n\n    agent {\n        // \u5b9a\u4e49kubernetes\u4f5c\u4e3aagent\n        kubernetes {\n            // \u9009\u62e9\u7684\u4e91\u4e3a\u4e4b\u524d\u914d\u7f6e\u7684\u540d\u79f0\n            cloud 'kubernetes'\n            slaveConnectTimeout 1200\n            // \u5b58\u50a8\u4e3anfs\u65b9\u5f0f\u6301\u4e45\u5316\u6302\u8f7d\n            workspaceVolume nfsWorkspaceVolume(serverAddress: \"192.168.1.60\", serverPath: \"/QaTest/jenkins-salve\", readOnly: \"false\")\n            yaml '''\napiVersion: v1\nkind: Pod\nmetadata:\n  name: \"jenkins-slave\"\n  namespace: \"kube-ops\"\n  labels:\n    jenkins: \"slave\"\n    jenkins/label: \"jenkins-jnlp\"\nspec:\n  containers:\n  # jnlp\u5bb9\u5668\uff0c\u548cjenkins\u4e3b\u8282\u70b9\u901a\u4fe1\u3002\u5305\u542bkubectl\u547d\u4ee4\u3001helm\u547d\u4ee4\u3001docker\u547d\u4ee4\n  - name: \"jnlp\"\n    image: \"hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    resources:\n      limits:\n        cpu: 1000m\n        memory: 2000Mi\n      requests:\n        cpu: 200m\n        memory: 400Mi\n    env:\n    - name: \"DOCKER_HOST\"\n      value: \"tcp://192.168.1.141:2375\"\n    - name: \"JENKINS_AGENT_WORKDIR\"\n      value: \"/home/jenkins/agent\"\n    volumeMounts:\n    - mountPath: \"/root/.kube/config\"\n      name: \"volume-0\"\n      readOnly: false\n      subPath: \"config\"\n    - name: localtime\n      mountPath: /etc/localtime\n\n    - mountPath: \"/home/jenkins/agent\"\n      name: \"workspace-volume\"\n      readOnly: false\n    workingDir: \"/home/jenkins/agent\"\n\n  # build\u5bb9\u5668\uff0c\u5305\u542b\u6784\u5efa\u7684\u547d\u4ee4\uff0cjava\u9700\u8981maven\u6784\u5efa\uff0c\u9700\u8981\u4e00\u4e2amaven\u955c\u50cf\n  - name: \"build\"\n    image: \"hub.gitee.cc/kubernetes/maven:3.5.3\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    volumeMounts:\n      - name: localtime\n        mountPath: /etc/localtime\n      # Pod\u5355\u72ec\u521b\u5efa\u4e86\u4e00\u4e2a\u7f13\u5b58\u7684volume\uff0c\u5c06\u5176\u6302\u8f7d\u5230\u4e86maven\u63d2\u4ef6\u7684\u7f13\u5b58\u76ee\u5f55\uff0c\u9ed8\u8ba4\u662f/root/.m2\n      - name:  cachedir\n        mountPath: \"/root/.m2/\"\n        readOnly: false\n    command:\n      - \"cat\"\n    env:\n      - name: \"LANGUAGE\"\n        value: \"en_US:en\"\n      - name: \"LC_ALL\"\n        value: \"en_US.UTF-8\"\n      - name: \"LANG\"\n        value: \"en_US.UTF-8\"\n\n  volumes:\n    - name: localtime\n      hostPath:\n        path: /usr/share/zoneinfo/Asia/Shanghai\n\n    - configMap:\n        name: \"kubeconfig\"\n        optional: false\n      name: \"volume-0\"\n    # \u7f13\u5b58\u76ee\u5f55\n    - name: \"cachedir\"\n      hostPath:\n        path: \"/opt/m2\"\n\n    - emptyDir:\n        medium: \"\"\n      name: \"workspace-volume\"\n  restartPolicy: Always\n  hostNetwork: false\n  imagePullSecrets:\n  - name: \"regcred\"\n  # \u56fa\u5b9a\u8282\u70b9\u90e8\u7f72\n  nodeSelector:\n    build: \"true\"\n\n            '''\n        }\n    }\n\n    stages {\n      stage('Pulling Code') {\n        parallel {\n        stage('Pulling Code by Jenkins') {\n          when {\n            expression {\n              // \u82e5env.gitlabBranch\u4e3a\u7a7a\uff0c\u5219\u4e3a\u624b\u52a8\u89e6\u53d1\u6267\u884c\u624b\u52a8 stage,\u82e5\u4e0d\u4e3a\u7a7a\uff0c\u4e4b\u524d\u540c\u7ea7\u7684\u53e6\u5916\u4e00\u4e2astage\n              env.gitlabBranch == null\n            }\n\n          }\n          steps {\n            git(changelog: true, poll: true, url: 'http://gitlab.runjs.cn:8929/kubernetes/spring-boot-project.git', branch: \"${BRANCH}\", credentialsId: \"${GITLAB_AUTH}\")\n            script {\n              // \u5b9a\u4e49\u53d8\u91cf\u7528\u4e8e\u751f\u6210\u955c\u50cf\u7684Tag\n              // \u83b7\u53d6\u6700\u8fd1\u4e00\u6b21\u63d0\u4ea4\u7684Commit ID\n              COMMIT_ID = sh(returnStdout: true, script: \"git log -n 1 --pretty=format:'%h'\").trim()\n              // \u8d4b\u503c\u7ed9TAG\u53d8\u91cf\uff0c\u540e\u9762\u7684docker build\u53ef\u4ee5\u83b7\u53d6\u5230\u8be5TAG\u7684\u503c\n              TAG = BUILD_TAG + '-' + COMMIT_ID\n              println \"Current branch is ${BRANCH}, Commit ID is ${COMMIT_ID}, Image TAG is ${TAG}\"\n\n            }\n\n          }\n        }\n        stage('Pulling Code by trigger') {\n          when {\n            expression {\n              // \u82e5env.gitlabBranch\u4e0d\u4e3a\u7a7a\uff0c\u5219\u4e3awebook\u89e6\u53d1\u7684\u6267\u884cwebook stage\u3002\u4e0a\u9762\u7684stage\u4e0d\u6267\u884c\uff0c\u6b64\u65f6BRANCH\u53d8\u91cf\u4e3a\u7a7a\n              env.gitlabBranch != null\n            }\n\n          }\n          steps {\n            git(url: 'http://gitlab.runjs.cn:8929/kubernetes/spring-boot-project.git', branch: env.gitlabBranch, changelog: true, poll: true, credentialsId: \"${GITLAB_AUTH}\")\n            script {\n              COMMIT_ID = sh(returnStdout: true, script: \"git log -n 1 --pretty=format:'%h'\").trim()\n              TAG = BUILD_TAG + '-' + COMMIT_ID\n              println \"Current branch is ${env.gitlabBranch}, Commit ID is ${COMMIT_ID}, Image TAG is ${TAG}\"\n              }\n            }\n          }\n        }\n      }\n\n    stage('Building') {\n      steps {\n        container(name: 'build') {\n            sh \"\"\"\n              # \u7f16\u8bd1\u547d\u4ee4\uff0c\u9700\u8981\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u4fee\u6539\uff0c\u53ef\u80fd\u4f1a\u4e0d\u4e00\u81f4\n              mvn clean install -DskipTests\n              # \u5b8c\u6210\u6784\u5efa\u540e\u4e00\u822c\u4f1a\u5728target\u76ee\u5f55\u751f\u4ea7jar\u5305\n              ls target/*\n            \"\"\"\n        }\n      }\n    }\n\n    stage('Docker build for creating image') {\n      steps {\n        withCredentials([[$class: 'UsernamePasswordMultiBinding',\n        credentialsId: \"${HARBOR_AUTH}\",\n        usernameVariable: 'Harbor_user',\n        passwordVariable: 'Harbor_password']]) {\n            sh \"\"\"#!/bin/bash\n              set -eux\n              # \u767b\u5f55Harbor\n              docker login -u ${Harbor_user} -p ${Harbor_password} ${HARBOR_ADDRESS}\n\n              # Dockerfile\u653e\u5728\u4ee3\u7801\u4ed3\u548cJenkinsfile\u540c\u7ea7\n              docker build --no-cache -t ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG} .\n\n              # \u63a8\u9001\u955c\u50cf\u81f3\u79c1\u6709harbor\u4ed3\u5e93\n              docker push ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG}\n              \"\"\"\n        }\n      }\n    }\n\n    stage('Deploying to K8s') {\n      steps {\n           sh \"\"\"#!/bin/bash\n           set -ux\n\n           # set\u66f4\u65b0deployment\u955c\u50cf\n           kubectl set image deploy -l app=${IMAGE_NAME} ${IMAGE_NAME}=${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG} -n $NAMESPACE\n           \"\"\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#64-jenkinsfile\u8be6\u89e3","title":"6.4 Jenkinsfile\u8be6\u89e3","text":"<p>\u9996\u5148\u662f\u9876\u5c42\u7684agent\uff0c\u5b9a\u4e49Kubernetes\u7684Pod\u4f5c\u4e3aJenkins\u7684Slave\uff1a</p> <pre><code>    agent {\n        // \u5b9a\u4e49kubernetes\u4f5c\u4e3aagent\n        kubernetes {\n            // \u9009\u62e9\u7684\u4e91\u4e3a\u4e4b\u524d\u914d\u7f6e\u7684\u540d\u79f0\n            cloud 'kubernetes'\n            slaveConnectTimeout 1200\n            // \u5b58\u50a8\u4e3anfs\u65b9\u5f0f\u6301\u4e45\u5316\u6302\u8f7d\n            workspaceVolume nfsWorkspaceVolume(serverAddress: \"192.168.1.60\", serverPath: \"/QaTest/jenkins-salve\", readOnly: \"false\")\n            yaml '''\napiVersion: v1\nkind: Pod\nmetadata:\n  name: \"jenkins-slave\"\n  namespace: \"kube-ops\"\n  labels:\n    jenkins: \"slave\"\n    jenkins/label: \"jenkins-jnlp\"\nspec:\n  containers:\n  # jnlp\u5bb9\u5668\uff0c\u548cjenkins\u4e3b\u8282\u70b9\u901a\u4fe1\u3002\u5305\u542bkubectl\u547d\u4ee4\u3001helm\u547d\u4ee4\u3001docker\u547d\u4ee4\n  - name: \"jnlp\"\n    image: \"hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    resources:\n      limits:\n        cpu: 1000m\n        memory: 2000Mi\n      requests:\n        cpu: 200m\n        memory: 400Mi\n    env:\n    - name: \"DOCKER_HOST\"\n      value: \"tcp://192.168.1.141:2375\"\n    - name: \"JENKINS_AGENT_WORKDIR\"\n      value: \"/home/jenkins/agent\"\n    volumeMounts:\n    # \u6302\u8f7dkubeconfig\u6587\u4ef6\n    - mountPath: \"/root/.kube/config\"\n      name: \"volume-0\"\n      readOnly: false\n      subPath: \"config\"\n    - name: localtime\n      mountPath: /etc/localtime\n\n    - mountPath: \"/home/jenkins/agent\"\n      name: \"workspace-volume\"\n      readOnly: false\n    workingDir: \"/home/jenkins/agent\"\n\n  # build\u5bb9\u5668\uff0c\u5305\u542b\u6784\u5efa\u7684\u547d\u4ee4\uff0cjava\u9700\u8981maven\u6784\u5efa\uff0c\u9700\u8981\u4e00\u4e2amaven\u955c\u50cf\n  - name: \"build\"\n    image: \"registry.cn-beijing.aliyuncs.com/citools/maven:3.5.3\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    volumeMounts:\n      - name: localtime\n        mountPath: /etc/localtime\n      # Pod\u5355\u72ec\u521b\u5efa\u4e86\u4e00\u4e2a\u7f13\u5b58\u7684volume\uff0c\u5c06\u5176\u6302\u8f7d\u5230\u4e86maven\u63d2\u4ef6\u7684\u7f13\u5b58\u76ee\u5f55\uff0c\u9ed8\u8ba4\u662f/root/.m2\n      - name:  cachedir\n        mountPath: \"/root/.m2/\"\n        readOnly: false\n    command:\n      - \"cat\"\n    env:\n      - name: \"LANGUAGE\"\n        value: \"en_US:en\"\n      - name: \"LC_ALL\"\n        value: \"en_US.UTF-8\"\n      - name: \"LANG\"\n        value: \"en_US.UTF-8\"\n\n  volumes:\n    - name: localtime\n      hostPath:\n        path: /usr/share/zoneinfo/Asia/Shanghai\n\n    - configMap:\n        name: \"kubeconfig\"\n        optional: false\n      name: \"volume-0\"\n    # \u7f13\u5b58\u76ee\u5f55\n    - name: \"cachedir\"\n      hostPath:\n        path: \"/opt/m2\"\n\n    - emptyDir:\n        medium: \"\"\n      name: \"workspace-volume\"\n  restartPolicy: Always\n  hostNetwork: false\n  imagePullSecrets:\n  - name: \"regcred\"\n  # \u56fa\u5b9a\u8282\u70b9\u90e8\u7f72\n  nodeSelector:\n    build: \"true\"\n\n            '''\n        }\n    }\n</code></pre> <p>\u4e4b\u540e\u770b\u4e00\u4e0bJenkinsfile\u6700\u540e\u7684\u73af\u5883\u53d8\u91cf\u548cparameters\u7684\u914d\u7f6e\uff1a</p> <pre><code>    // \u5b9a\u4e49\u4e00\u4e9b\u5168\u5c40\u7684\u73af\u5883\u53d8\u91cf\n    environment {\n        COMMIT_ID = \"\"\n        // harbor\u5730\u5740\n        HARBOR_ADDRESS = \"hub.gitee.cc\"\n        // harbor\u7684\u9879\u76ee\u76ee\u5f55\n        REGISTRY_DIR = \"kubernetes\"\n        // \u955c\u50cf\u540d\u79f0\n        IMAGE_NAME = \"spring-boot-project\"\n        // kubernetes\u4e2d\u7684\u540d\u79f0\u7a7a\u95f4\n        NAMESPACE = \"kubernetes\"\n        // \u955c\u50cf\u7684\u5206\u652f\uff0c\u7531BUILD_TAG+COMMIT_ID\u7ec4\u6210\n        TAG = \"\"\n        // gitlab\u8d26\u53f7\u5bc6\u7801\u8ba4\u8bc1\n        GITLAB_AUTH = \"gitlab-auth\"\n        // harbor\u8d26\u53f7\u5bc6\u7801\u8ba4\u8bc1\n        HARBOR_AUTH = \"harbor-user-passwd\"\n    }\n  parameters {\n    // \u4f7f\u7528GitParameter\u63d2\u4ef6\uff0c\u8be5\u5b57\u6bb5\u4f1a\u5728jenkins\u9875\u9762\u751f\u6210\u4e00\u4e2a\u9009\u62e9\u5206\u652f\u7684\u9009\u9879\n    gitParameter(branch: '', branchFilter: 'origin/(.*)', defaultValue: 'master', description: 'Branch for build and deploy', name: 'BRANCH', quickFilterEnabled: false, selectedValue: 'NONE', sortMode: 'NONE', tagFilter: '*', type: 'PT_BRANCH')\n  }\n</code></pre> <p>\u63a5\u4e0b\u6765\u662f\u62c9\u53d6\u4ee3\u7801\u7684stage\uff0c\u8fd9\u4e2astage\u662f\u4e00\u4e2a\u5e76\u884c\u7684stage\uff0c\u56e0\u4e3a\u8003\u8651\u4e86\u8be5\u6d41\u6c34\u7ebf\u662f\u624b\u52a8\u89e6\u53d1\u8fd8\u662f\u81ea\u52a8\u89e6\u53d1\uff1a</p> <pre><code>      stage('Pulling Code') {\n        parallel {\n        stage('Pulling Code by Jenkins') {\n          when {\n            expression {\n              // \u82e5env.gitlabBranch\u4e3a\u7a7a\uff0c\u5219\u4e3a\u624b\u52a8\u89e6\u53d1\u6267\u884c\u624b\u52a8 stage,\u82e5\u4e0d\u4e3a\u7a7a\uff0c\u4e4b\u524d\u540c\u7ea7\u7684\u53e6\u5916\u4e00\u4e2astage\n              env.gitlabBranch == null\n            }\n\n          }\n          steps {\n            git(changelog: true, poll: true, url: 'http://gitlab.runjs.cn:8929/kubernetes/spring-boot-project.git', branch: \"${BRANCH}\", credentialsId: \"${GITLAB_AUTH}\")\n            script {\n              // \u5b9a\u4e49\u53d8\u91cf\u7528\u4e8e\u751f\u6210\u955c\u50cf\u7684Tag\n              // \u83b7\u53d6\u6700\u8fd1\u4e00\u6b21\u63d0\u4ea4\u7684Commit ID\n              COMMIT_ID = sh(returnStdout: true, script: \"git log -n 1 --pretty=format:'%h'\").trim()\n              // \u8d4b\u503c\u7ed9TAG\u53d8\u91cf\uff0c\u540e\u9762\u7684docker build\u53ef\u4ee5\u83b7\u53d6\u5230\u8be5TAG\u7684\u503c\n              TAG = BUILD_TAG + '-' + COMMIT_ID\n              println \"Current branch is ${BRANCH}, Commit ID is ${COMMIT_ID}, Image TAG is ${TAG}\"\n\n            }\n\n          }\n        }\n        stage('Pulling Code by trigger') {\n          when {\n            expression {\n              // \u82e5env.gitlabBranch\u4e0d\u4e3a\u7a7a\uff0c\u5219\u4e3awebook\u89e6\u53d1\u7684\u6267\u884cwebook stage\u3002\u4e0a\u9762\u7684stage\u4e0d\u6267\u884c\uff0c\u6b64\u65f6BRANCH\u53d8\u91cf\u4e3a\u7a7a\n              env.gitlabBranch != null\n            }\n\n          }\n          steps {\n            git(url: 'http://gitlab.runjs.cn:8929/kubernetes/spring-boot-project.git', branch: env.gitlabBranch, changelog: true, poll: true, credentialsId: \"${GITLAB_AUTH}\")\n            script {\n              COMMIT_ID = sh(returnStdout: true, script: \"git log -n 1 --pretty=format:'%h'\").trim()\n              TAG = BUILD_TAG + '-' + COMMIT_ID\n              println \"Current branch is ${env.gitlabBranch}, Commit ID is ${COMMIT_ID}, Image TAG is ${TAG}\"\n              }\n            }\n          }\n        }\n      }\n</code></pre> <p>\u4ee3\u7801\u62c9\u4e0b\u6765\u540e\uff0c\u5c31\u53ef\u4ee5\u6267\u884c\u6784\u5efa\u547d\u4ee4\uff0c\u7531\u4e8e\u672c\u6b21\u5b9e\u9a8c\u662fJava\u793a\u4f8b\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528mvn\u547d\u4ee4\u8fdb\u884c\u6784\u5efa\uff1a</p> <pre><code>    stage('Building') {\n      steps {\n        # \u4f7f\u7528pod\u6a21\u677f\u91cc\u9762build\u5bb9\u5668\u8fdb\u884c\u6784\u5efa\n        container(name: 'build') {\n            sh \"\"\" \n              # \u7f16\u8bd1\u547d\u4ee4\uff0c\u9700\u8981\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u4fee\u6539\n              mvn clean install -DskipTests\n              # \u5b8c\u6210\u6784\u5efa\u540e\u4e00\u822c\u4f1a\u5728target\u76ee\u5f55\u751f\u4ea7jar\u5305\n              ls target/*\n            \"\"\"\n        }\n      }\n    }\n</code></pre> <p>\u751f\u6210\u7f16\u8bd1\u4ea7\u7269\u540e\uff0c\u9700\u8981\u6839\u636e\u8be5\u4ea7\u7269\u751f\u6210\u5bf9\u5e94\u7684\u955c\u50cf,\u5e76\u5c06\u955c\u50cf\u63a8\u9001\u5230harbor\u79c1\u6709\u4ed3\u5e93\uff1a</p> <pre><code>    stage('Docker build for creating image') {\n      steps {\n        withCredentials([[$class: 'UsernamePasswordMultiBinding',\n        credentialsId: \"${HARBOR_AUTH}\",\n        usernameVariable: 'Harbor_user',\n        passwordVariable: 'Harbor_password']]) {\n            sh \"\"\"#!/bin/bash\n              set -eux\n              # \u767b\u5f55Harbor\n              docker login -u ${Harbor_user} -p ${Harbor_password} ${HARBOR_ADDRESS}\n\n              # Dockerfile\u653e\u5728\u4ee3\u7801\u4ed3\u548cJenkinsfile\u540c\u7ea7\n              docker build --no-cache -t ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG} .\n\n              # \u63a8\u9001\u955c\u50cf\u81f3\u79c1\u6709harbor\u4ed3\u5e93\n              docker push ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG}\n              docker rmi -f ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG}\n              \"\"\"\n        }\n      }\n    }\n</code></pre> <p>\u6700\u540e\u4e00\u6b65\u5c31\u662f\u5c06\u8be5\u955c\u50cf\u53d1\u7248\u81f3Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u6b64\u65f6\u4f7f\u7528\u7684\u662f\u5305\u542bkubectl\u547d\u4ee4\u7684\u5bb9\u5668\uff1a</p> <pre><code>    stage('Deploying to K8s') {\n      steps {\n           sh \"\"\"#!/bin/bash\n           set -ux\n\n           # set\u66f4\u65b0deployment\u955c\u50cf\n           kubectl set image deploy -l app=${IMAGE_NAME} ${IMAGE_NAME}=${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG} -n $NAMESPACE\n           \"\"\"\n      }\n    }\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#65-\u5b9a\u4e49dockerfile","title":"6.5 \u5b9a\u4e49Dockerfile","text":"<p>\u5728\u6267\u884c\u6d41\u6c34\u7ebf\u8fc7\u7a0b\u65f6\uff0c\u9700\u8981\u5c06\u4ee3\u7801\u7684\u7f16\u8bd1\u4ea7\u7269\u505a\u6210\u955c\u50cf\u3002Dockerfile\u4e3b\u8981\u5199\u7684\u662f\u5982\u4f55\u751f\u6210\u516c\u53f8\u4e1a\u52a1\u7684\u955c\u50cf\uff0c\u800c\u672c\u793a\u4f8b\u662fJava\u9879\u76ee\uff0c\u53ea\u9700\u8981\u628aJAR\u5305\u653e\u5728\u6709JRE\u73af\u5883\u7684\u955c\u50cf\u4e2d\uff0c\u7136\u540e\u542f\u52a8\u8be5JAR\u5305\u5373\u53ef\uff1a</p> <p><code>Dockerfile</code></p> <pre><code># \u57fa\u7840\u955c\u50cf\u53ef\u4ee5\u6309\u9700\u4fee\u6539\uff0c\u53ef\u4ee5\u66f4\u6539\u4e3a\u516c\u53f8\u81ea\u6709\u7684\u955c\u50cf\nFROM registry.cn-beijing.aliyuncs.com/dotbalo/jre:8u211-data\n# JAR\u5305\u540d\u79f0\u6539\u6210\u5b9e\u9645\u7684\u540d\u79f0\uff0c\u672c\u793a\u4f8b\u4e3aspring-cloud-eureka-0.0.1-SNAPSHOT.jar\nCOPY target/spring-cloud-eureka-0.0.1-SNAPSHOT.jar ./\n\n# \u542f\u52a8JAR\u5305\nCMD java -jar spring-cloud-eureka-0.0.1-SNAPSHOT.jar\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#66-\u5b9a\u4e49kubernetes\u8d44\u6e90","title":"6.6 \u5b9a\u4e49Kubernetes\u8d44\u6e90","text":"<p>\u672c\u4e66\u7684\u793a\u4f8b\u5728GitLab\u521b\u5efa\u7684Group\u4e3akubernetes\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u5176\u662f\u4e00\u4e2a\u9879\u76ee\uff0c\u540c\u4e00\u4e2a\u9879\u76ee\u53ef\u4ee5\u90e8\u7f72\u81f3Kubernetes\u96c6\u7fa4\u4e2d\u7684\u540c\u4e00\u4e2aNamespace\u4e2d\uff0c\u672c\u793a\u4f8b \u4e3akubernetes\u547d\u540d\u7a7a\u95f4\u3002\u7531\u4e8e\u4f7f\u7528\u7684\u662f\u79c1\u6709\u4ed3\u5e93\uff0c\u56e0\u6b64\u9700\u8981\u5148\u914d\u7f6e\u62c9\u53d6\u79c1\u6709\u4ed3\u5e93\u955c\u50cf\u7684\u5bc6\u94a5\uff1a</p> <pre><code># kubectl create ns kubernetes\nnamespace/kubernetes created\n# kubectl -n kubernetes create secret docker-registry harborkey \\\n--docker-server=http://hub.gitee.cc \\\n--docker-username=admin \\\n--docker-password=oschina123 \\\n--docker-email=1@2.com\n</code></pre> <p>\u914d\u7f6e\u8be5\u5e94\u7528\u7684Deployment\uff08\u90e8\u5206\u5185\u5bb9\uff09\uff0c\u9700\u8981\u6ce8\u610f\u6587\u4ef6\u7684\u6587\u5b57\u6ce8\u91ca\u90e8\u5206\uff1a</p> <p><code>deployment.yaml</code></p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: spring-boot-project\nname: spring-boot-project\nnamespace: kubernetes\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: spring-boot-project\nstrategy:\nrollingUpdate:\nmaxSurge: 1\nmaxUnavailable: 0\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\napp: spring-boot-project\nspec:\ncontainers:\n- env:\n- name: TZ\nvalue: Asia/Shanghai\n- name: LANG\nvalue: C.UTF-8\nimage: hub.gitee.cc/kubernetes/spring-boot-project:jenkins-spring-boot-project-2-e9ddd5d\nimagePullPolicy: IfNotPresent\nlivenessProbe:\nfailureThreshold: 2\ninitialDelaySeconds: 30\nperiodSeconds: 10\nsuccessThreshold: 1\ntcpSocket:\nport: 8761\ntimeoutSeconds: 2\nname: spring-boot-project\nports:\n- containerPort: 8761\nname: web\nprotocol: TCP\nresources:\nlimits:\ncpu: 994m\nmemory: 2170Mi\nrequests:\ncpu: 10m\nmemory: 55Mi\ndnsPolicy: ClusterFirst\nimagePullSecrets:\n- name: harborkey\nrestartPolicy: Always\nsecurityContext: {}\nserviceAccountName: default\n</code></pre> <p>\u5b9a\u4e49\u8be5\u5e94\u7528\u7684Service\u548cIngress\uff1a</p> <p><code>spring-boot-project-svc-ingress.yaml</code></p> <pre><code>---\napiVersion: v1\nkind: Service\nmetadata:\nlabels:\napp: spring-boot-project\nname: spring-boot-project\nnamespace: kubernetes\nspec:\nports:\n- name: web\nport: 8761\nprotocol: TCP\ntargetPort: 8761\nselector:\napp: spring-boot-project\ntype: ClusterIP\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nname: spring-boot-project\nnamespace: kubernetes\nspec:\ningressClassName: nginx\nrules:\n- host: spring-boot-project.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: spring-boot-project\nport: number: 8761\npath: /\npathType: ImplementationSpecific\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0cJava\u4e00\u822c\u662f\u540e\u53f0\u5e94\u7528\uff0c\u4e0d\u9700\u8981\u4f7f\u7528Ingress\u66b4\u9732\u51fa\u53bb\uff0c\u53ea\u9700\u8981\u914d\u7f6eService\u5373\u53ef\u3002</p> <p>\u5982\u679c\u9700\u8981\u88ab\u96c6\u7fa4\u5916\u90e8\u7684\u7528\u6237\u76f4\u63a5\u8bbf\u95ee\uff0c\u9700\u8981\u914d\u7f6eIngress\uff0c\u901a\u8fc7\u57df\u540d\u53d1\u5e03\u3002</p> <p>\u521b\u5efa\u8be5\u8d44\u6e90\uff1a</p> <pre><code>$ kubectl create -f deployment.yaml\n$ kubectl create -f spring-boot-project-svc-ingress.yaml\nservice/spring-boot-project created\ningress.networking.k8s.io/spring-boot-project created\n</code></pre> <p>\u63d0\u793a</p> <p>\u7531\u4e8e\u5728Harbor\u5df2\u7ecf\u914d\u7f6e\u4e86Kubernetes\u7684\u9879\u76ee\u76ee\u5f55\uff0c\u5728\u6b64\u4e0d\u518d\u91cd\u590d\u521b\u5efa\uff0c\u5982\u679c\u9700\u8981\u5c06\u955c\u50cf\u63a8\u9001\u81f3\u5176\u4ed6\u76ee\u5f55\uff0c\u6309\u7167\u540c\u6837\u7684\u6b65 \u9aa4\u521b\u5efa\u5373\u53ef\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#67-\u521b\u5efajenkins\u4efb\u52a1","title":"6.7 \u521b\u5efaJenkins\u4efb\u52a1","text":"<p>\u5355\u51fb\u9996\u9875\u7684\u521b\u5efa\u4efb\u52a1\uff08Job\uff09\u9009\u9879\uff08\u6216\u8005New Item\uff09\u5e76\u914d\u7f6e\u4efb\u52a1\u4fe1\u606f\uff0c\u8f93\u5165Job\u7684\u540d\u79f0\uff08\u4e00\u822c\u548cGitLab\u7684\u4ed3\u5e93\u540d\u5b57\u4e00\u81f4\uff0c\u4ee5\u4fbf\u4e8e\u533a\u5206\uff09\uff0c\u7c7b\u578b\u4e3aPipeline\uff0c\u6700\u540e\u5355\u51fbOK\u3002</p> <p></p> <p>\u5728\u65b0\u9875\u9762\u5355\u51fbPipeline\uff0c\u8f93\u5165Git\u4ed3\u5e93\u5730\u5740\uff0c\u9009\u62e9\u4e4b\u524d\u914d\u7f6e\u7684GitLab \u8d26\u53f7\u5bc6\u7801Key\uff0c\u5206\u652f\u4e3amaster\uff0c\u5355\u51fbSave\u3002</p> <p></p> <p>\u7b2c\u4e00\u6b21\u6784\u5efa\u4e5f\u4f1a\u5931\u8d25\uff0c\u7b2c\u4e8c\u6b21\u53ef\u4ee5\u9009\u62e9\u5206\u652f\u6784\u5efa\uff0c\u4e4b\u540e\u5355\u51fbBuild\uff0c\u7136\u540e\u5355\u51fbBuild History\u7684\u8fdb\u5ea6\u6761\uff0c\u5373\u53ef\u67e5\u770b\u6784\u5efa\u65e5\u5fd7\u3002</p> <p></p> <p></p> <p>\u6784\u5efa\u65e5\u5fd7\u4e0a\u90e8\u5206\u4e3a\u521b\u5efaPod\u7684\u65e5\u5fd7\uff0c\u53ef\u4ee5\u770b\u5230Pod\u4e3aAgent\u6307\u5b9a\u7684Pod\uff0c\u5982\u56fe</p> <p></p> <p>\u5982\u679c\u662fJava\u5e94\u7528\uff0c\u53ef\u4ee5\u770b\u5230BUILD SUCCESS\uff0c\u8bf4\u660emvn\u7f16\u8bd1\u5df2\u7ecf\u901a\u8fc7\uff0c\u5982\u56fe </p> <p>\u7f16\u8bd1\u7ed3\u675f\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u5236\u4f5c\u955c\u50cf\u7684\u65e5\u5fd7\uff0c\u4e4b\u540e\u955c\u50cf\u88ab\u63a8\u9001\u81f3Harbor\uff0c\u6700\u540e\u53d1\u7248\u81f3Kubernetes\u3002 </p> <p></p> <p></p> <p>\u51fa\u73b0Finished\uff1aSUCCESS\u8bf4\u660e\u8be5\u6d41\u6c34\u7ebf\u6b63\u5e38\u7ed3\u675f\u3002\u63a5\u4e0b\u6765\u53ef\u4ee5\u67e5\u770bDeployment\u7684\u955c\u50cf\uff1a</p> <pre><code>$ kubectl get deploy -n kubernetes spring-boot-project -o yaml|grep \"image: \"\nimage: hub.gitee.cc/kubernetes/spring-boot-project:jenkins-spring-boot-project-5-adf694c\n\n$ kubectl get pod -n kubernetes\nNAME                                   READY   STATUS    RESTARTS        AGE\nspring-boot-project-65f88c8f6b-l89sl   1/1     Running   1 (7m34s ago)   8m24s\n</code></pre> <p>\u6ce8\u610f</p> <p>\u8be5\u793a\u4f8b\u53ea\u662f\u7528Eureka\u7684\u4ee3\u7801\u4f5c\u4e3a\u6d4b\u8bd5\u5e94\u7528\uff0c\u5982\u679c\u662f\u751f\u4ea7\u73af\u5883\u7684Eureka\uff0c\u6700\u597d\u4f7f\u7528StatefulSet\u521b\u5efaEureka\u96c6\u7fa4\uff0c\u56e0\u4e3aStatefulSet\u4f1a\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u8bc6\u7b26 \uff0c \u6b64\u65f6\u5728Eureka\u7684defaultZone\u914d\u7f6e\u5982\u4e0b\uff1a</p> <p>defaultZone:http://eureka-0.eureka:8761/eureka/ \u3001 http://eureka-1.eureka:8761/eureka/\u3001http://eureka-2.eureka:8761/eureka/\uff0c\u5373\u53ef\u5f62\u6210\u96c6\u7fa4\u3002</p> <p>\u5176\u4ed6\u7684Spring Cloud\u6a21\u5757\u53ef\u4ee5\u901a\u8fc7\u8be5\u5730\u5740\u8fdb\u884c\u6ce8\u518c\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#68-webhook\u81ea\u52a8\u89e6\u53d1\u6784\u5efa","title":"6.8 Webhook\u81ea\u52a8\u89e6\u53d1\u6784\u5efa","text":"<p>\u4e4b\u524d\u7684\u6784\u5efa\u90fd\u662f\u624b\u52a8\u9009\u62e9\u5206\u652f\u8fdb\u884c\u6784\u5efa\u7684\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u9879\u76ee\u53ef\u80fd\u6709\u5f88\u591a\uff0c\u5982\u679c\u90fd\u662f\u624b\u52a8\u89e6\u53d1\uff0c\u53ef\u80fd\u6bd4\u8f83\u6d88\u8017\u4eba\u529b\u3002</p> <p>\u6240\u4ee5\u63a8\u8350\u6309\u9700\u914d\u7f6e\u81ea\u52a8\u89e6\u53d1\uff0c\u5373\u63d0\u4ea4\u4ee3\u7801\u540e\u81ea\u52a8\u89e6\u53d1Jenkins\u6784\u5efa\u4efb\u52a1\u3002</p> <p>\u672c\u6b21\u7528Java\u9879\u76ee\u8fdb\u884c\u6f14\u793a\u3002\u9996\u5148\u627e\u5230Java\u9879\u76ee\u7684Job\uff0c\u5355\u51fbConfigure\uff0c\u4e4b\u540e\u9009\u62e9Build Triggers\uff0c\u52fe\u9009Build when a change\u2026\uff0c</p> <p>\u8bb0\u5f55webhook URL\uff0c\u4e4b\u540e\u5355\u51fbAdvanced\uff0c\u9009\u62e9Allow all branches to trigger this job\uff0c</p> <p>\u5982\u679c\u4e0d\u60f3\u4efb\u4f55\u5206\u652f\u90fd\u53ef\u4ee5\u89e6\u53d1\u8be5\u6d41\u6c34\u7ebf\uff0c\u53ef\u4ee5\u9009\u62e9Filter\u8fdb\u884c\u6761\u4ef6\u5339\u914d\u3002\u4e4b\u540e\u5355\u51fbGenerate\u751f\u6210Secret token\uff0c\u6700\u540e\u5355\u51fbSave\u5373\u53ef\u3002</p> <p></p> <p></p> <p>\u63a5\u4e0b\u6765\u914d\u7f6eGitLab\uff0c\u9996\u5148\u5355\u51fbMenu\u2192Admin\u9009\u62e9Settings\u2192Network\uff0c\u4e4b\u540e\u5141\u8bb8\u8bbf\u95ee\u5916\u90e8\u7684\u8bf7\u6c42\u3002 </p> <p>\u5728Integrations\u914d\u7f6e\u9875\u7684\u76f8\u5e94\u8f93\u5165\u6846\u4e2d\u7c98\u8d34\u4e0a\u4e00\u6b65\u4e2dJenkins\u66b4\u9732\u7684webhook\u53ca\u76f8\u5e94\u7684Secret token\u5982\u4e0b\uff1a</p> <p></p> <p>\u6d4b\u8bd5\u6574\u4e2a\u94fe\u8def\u662f\u5426\u901a\u4e86\u3002\u5728GitLab\u4e0a\u6dfb\u52a0\u597d\u8fd9\u4e2awebhook\u540e\uff0c\u53ef\u4ee5\u8df3\u5230\u8868\u5355\u4e0b\u65b9\uff0c\u6709\u4e00\u4e2a\u5df2\u6dfb\u52a0\u7684webhook\u5217\u8868\uff0c\u627e\u5230\u6211\u4eec\u521a\u521a\u521b\u5efa\u7684webbook\u3002\u5355\u51fb\u201cTest\u201d\u6309\u94ae\uff0c\u9009\u62e9\u201cPushevents\u201d\uff0cGitLab\u5c31\u4f1a\u5411\u8be5webhook\u53d1\u9001\u4e00\u4e2aevent\u3002</p> <p>\u6dfb\u52a0\u4e4b\u540e\uff0c\u53ef\u4ee5\u70b9\u51fb\u4e00\u4e0btest\u770b\u770b\u6d41\u7a0b\u662f\u5426\u80fd\u591f\u8d70\u901a\uff0c\u5982\u679c\u8d70\u901a\uff0c\u90a3\u4e48\u6211\u4eec\u4ee5\u540e\u5f00\u53d1\u7684\u65f6\u5019\u76f4\u63a5\u63a8\u9001\u4ee3\u7801\u5373\u53ef\u89e6\u53d1\u6784\u5efa\u3002</p> <p>\u6b63\u5e38\u72b6\u6001\u8fd4\u56de\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7Blue Ocean\u770b\u5230\u662f\u81ea\u52a8\u89e6\u53d1\u7684stage\u88ab\u6267\u884c\uff0c\u5982\u56fe</p> <p></p> <p>\u65b0\u5efaPull Request\u5206\u652f\uff0c\u63d0\u4ea4\u4ee3\u7801\u6d4b\u8bd5CI\u89e6\u53d1\u3002</p> <pre><code>$ git clone ssh://git@gitlab.runjs.cn:2224/kubernetes/spring-boot-project.git\n$ cd spring-boot-project/\n$ git checkout -b dev-hu\n$ echo \"test=hu\" &gt;&gt; README.md\n$ git add .\n$ git commit -m \"hujianli test\"\n$ git push --set-upstream origin dev-hu\n</code></pre> <p>\u89e6\u53d1\u540e\u624b\u5de5\u6267\u884c\u4e2d\uff0c\u51fa\u73b0\u53ef\u4ee5\u9009\u62e9Pull Request\u7248\u672c\u7684\u4fe1\u606f\u3002</p> <p></p> <p>\u4ee5\u4e0a\u5c31\u662f\u901a\u8fc7GitLab\u7684\u4e8b\u4ef6\u89e6\u53d1Jenkins\u4efb\u52a1\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u6b64\u529f\u80fd\u975e\u5e38\u5e38\u7528\uff0c\u4e00\u822c\u4f1a\u7528\u4e8e\u5f00\u53d1\u3001\u6d4b\u8bd5\u7b49\u73af\u5883\uff0c\u7701\u53bb\u4e86\u624b\u52a8\u6784\u5efa\u7684\u8fc7\u7a0b\u3002</p> <p>\u800c\u5728UAT\u548c\u751f\u4ea7\u73af\u5883\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u518d\u6b21\u6784\u5efa\uff0c\u800c\u662f\u9009\u62e9\u5176\u4ed6\u73af\u5883\u4ea7\u751f\u7684\u955c\u50cf\u8fdb\u884c\u53d1\u7248\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#69-\u6784\u5efa\u72b6\u6001\u4fe1\u606f\u63a8\u9001\u5230gitlab","title":"6.9 \u6784\u5efa\u72b6\u6001\u4fe1\u606f\u63a8\u9001\u5230GitLab","text":"<p>\u5148\u751f\u6210\u4e00\u4e2a\u8bbf\u95ee\u4ee4\u724c\uff0c\u7528\u4e8e\u5728jenkins\u7684\u7cfb\u7edf\u914d\u7f6e\u53bb\u914d\u7f6e\u8fde\u63a5gitlab\u7684\u9009\u9879 </p> <p>\u751f\u6210\u4e2a\u4eba\u8bbf\u95ee\u4ee4\u724c\u3002 </p> <p>\u9996\u5148\u5728jenkins\u4e0a\u521b\u5efa\u4e00\u4e2agitlab api token\u7684\u51ed\u8bc1 </p> <p>\u9996\u5148\u5728<code>\u7cfb\u7edf\u7ba1\u7406</code>-<code>\u7cfb\u7edf\u914d\u7f6e</code>\u4e2d\u914d\u7f6e\u597d\u8fde\u63a5Gitlab\u7684\u4fe1\u606f\u5982\u4e0b</p> <p></p> <p>\u5728pipeline\u7684post\u90e8\u5206\uff0c\u5c06\u6784\u5efa\u7ed3\u679c\u66f4\u65b0\u5230GitLab\u7684\u76f8\u5e94commit\u8bb0\u5f55\u4e0a\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u5728**options\u90e8\u5206\u52a0\u5165gitLabConnection\u914d\u7f6e\uff0c\u540c\u65f6\u4f20\u5165\"gitlab\"\u53c2\u6570**\u3002\"gitlab\"\u5c31\u662f<code>Connection name</code>\u7684\u503c\u3002</p> <p>\u6838\u5fc3\u4ee3\u7801</p> <pre><code>pipeline {\n    agent any\n    triggers {\n        gitlab(triggerOnPush: true,\n            triggerOnMergeRequest: true,\n            branchFilterType: \"All\",\n            secretToken: \"t8vcxwuza023ehzcftzr5a74vkpto6xr\")\n    }\n    stages {\n        stage('build') {\n            steps {\n                echo 'Hello World from gitlab trigger'\n            }\n        }\n    }\n    post {\n        failure {\n            updateGitlabCommitStatus name: \"build\", state: \"failed\"\n        }\n        success {\n            updateGitlabCommitStatus name: \"build\", state: \"success\"\n        }\n    }\n    options {\n        gitLabConnection(\"gitlab\")\n    }\n}\n</code></pre> <p>\u63d0\u4ea4\u4ee3\u7801\u540e\uff0c\u9700\u8981\u624b\u52a8\u89e6\u53d1\u4e00\u6b21\u6784\u5efa\uff0cpipeline\u624d\u4f1a\u751f\u6548\u3002</p> <p></p> <p>\u53c2\u8003\u6587\u732e</p> <p>jenkins\u8fd4\u56de\u6784\u5efa\u72b6\u6001\u5230gitlab</p> <p>https://www.cnblogs.com/shipment/p/14690649.html</p> <p>https://blog.51cto.com/ygqygq2/2461766</p> <p>https://www.jianshu.com/p/d2af2915cfea</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#7-\u81ea\u52a8\u5316\u6784\u5efavueh5\u524d\u7aef\u5e94\u7528","title":"7. \u81ea\u52a8\u5316\u6784\u5efaVue/H5\u524d\u7aef\u5e94\u7528","text":"<p>\u672c\u8282\u4ecb\u7ecd\u81ea\u52a8\u5316\u6784\u5efaVue/H5\u5e94\u7528\uff0c\u5176\u6784\u5efa\u65b9\u5f0f\u548c\u81ea\u52a8\u5316\u6784\u5efaJava\u57fa\u672c\u76f8\u540c\uff0c\u91cd\u70b9\u662f\u66f4\u6539Deployment\u3001Jenkinsfile\u548cDockerfile\u3002</p> <p>\u540c\u6837\uff0c\u524d\u7aef\u5e94\u7528\u4e5f\u4e3a\u8bfb\u8005\u51c6\u5907\u4e86\u4e00\u4e2a\u6d4b\u8bd5\u9879\u76ee(\u9879\u76ee\u5730\u5740\uff1ahttps://gitee.com/dukuan/vue-project.git),\u53ef\u4ee5\u6309\u7167\u521b\u5efaJava\u6d4b\u8bd5\u7528\u4f8b\u7684\u65b9\u5f0f\u5bfc\u5165\u524d\u7aef\u9879\u76ee\u5230GitLab\u4e2d\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u516c\u53f8\u81ea\u5df1\u7684\u9879\u76ee\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#71-\u5b9a\u4e49jenkinsfile","title":"7.1 \u5b9a\u4e49Jenkinsfile","text":"<p>\u5148\u5c06\u955c\u50cf\u4e0a\u4f20\u5230harbor\u79c1\u6709\u4ed3\u5e93</p> <pre><code>$ docker pull registry.cn-beijing.aliyuncs.com/citools/node:lts\n$ docker tag registry.cn-beijing.aliyuncs.com/citools/node:lts hub.gitee.cc/kubernetes/node:lts\n$ docker push hub.gitee.cc/kubernetes/node:lts\n</code></pre> <p>Jenkinsfile\u548cJava\u9879\u76ee\u5e76\u65e0\u592a\u5927\u533a\u522b\uff0c\u9700\u8981\u66f4\u6539\u7684\u4f4d\u7f6e\u5982\u4e0b\uff08\u5c55\u793a\u90e8\u5206\u4ee3\u7801\uff09\uff1a</p> <pre><code>pipeline{\n    environment {\n        COMMIT_ID = \"\"\n        HARBOR_ADDRESS = \"hub.gitee.cc\"\n        REGISTRY_DIR = \"kubernetes\"\n        IMAGE_NAME = \"vue-project\"\n        NAMESPACE = \"kubernetes\"\n        TAG = \"\"\n        GITLAB_AUTH = \"gitlab-auth\"\n        HARBOR_AUTH = \"harbor-user-passwd\"\n    }\n  parameters {\n    gitParameter(branch: '', branchFilter: 'origin/(.*)', defaultValue: 'master', description: 'Branch for build and deploy',\n                name: 'BRANCH', quickFilterEnabled: false, selectedValue: 'NONE', sortMode: 'NONE', tagFilter: '*', type: 'PT_BRANCH')\n  }\n\n    options {\n      parallelsAlwaysFailFast()\n      disableResume()\n      quietPeriod(1)\n      preserveStashes(buildCount: 5)\n      timestamps()\n      buildDiscarder(logRotator(numToKeepStr: '100'))\n      timeout(time: 60, unit: 'MINUTES')\n      gitLabConnection(\"gitlab\")\n    }\n\n    agent {\n        kubernetes {\n            cloud 'kubernetes'\n            slaveConnectTimeout 1200\n            workspaceVolume nfsWorkspaceVolume(serverAddress: \"192.168.1.60\", serverPath: \"/QaTest/jenkins-salve\", readOnly: \"false\")\n            yaml '''\napiVersion: v1\nkind: Pod\nmetadata:\n  name: \"jenkins-slave\"\n  namespace: \"kube-ops\"\n  labels:\n    jenkins: \"slave\"\n    jenkins/label: \"jenkins-jnlp\"\nspec:\n  containers:\n  - name: \"jnlp\"\n    image: \"hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    resources:\n      limits:\n        cpu: 1000m\n        memory: 2000Mi\n      requests:\n        cpu: 200m\n        memory: 400Mi\n    env:\n    - name: \"DOCKER_HOST\"\n      value: \"tcp://192.168.1.141:2375\"\n    - name: \"JENKINS_AGENT_WORKDIR\"\n      value: \"/home/jenkins/agent\"\n    volumeMounts:\n    - mountPath: \"/root/.kube/config\"\n      name: \"volume-0\"\n      readOnly: false\n      subPath: \"config\"\n    - name: localtime\n      mountPath: /etc/localtime\n\n    - mountPath: \"/home/jenkins/agent\"\n      name: \"workspace-volume\"\n      readOnly: false\n    workingDir: \"/home/jenkins/agent\"\n\n  - name: \"build\"\n    image: \"hub.gitee.cc/kubernetes/node:lts\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    volumeMounts:\n      - name: localtime\n        mountPath: /etc/localtime\n    command:\n      - \"cat\"\n    env:\n      - name: \"LANGUAGE\"\n        value: \"en_US:en\"\n      - name: \"LC_ALL\"\n        value: \"en_US.UTF-8\"\n      - name: \"LANG\"\n        value: \"en_US.UTF-8\"\n\n  volumes:\n    - name: localtime\n      hostPath:\n        path: /usr/share/zoneinfo/Asia/Shanghai\n\n    - configMap:\n        name: \"kubeconfig\"\n        optional: false\n      name: \"volume-0\"\n\n    - emptyDir:\n        medium: \"\"\n      name: \"workspace-volume\"\n  restartPolicy: Always\n  hostNetwork: false\n  imagePullSecrets:\n  - name: \"regcred\"\n  # \u56fa\u5b9a\u8282\u70b9\u90e8\u7f72\n  nodeSelector:\n    build: \"true\"\n\n            '''\n        }\n    }\n\n    stages {\n      stage('Pulling Code') {\n        parallel {\n        stage('Pulling Code by Jenkins') {\n          when {\n            expression {\n              env.gitlabBranch == null\n            }\n\n          }\n          steps {\n            git(changelog: true, poll: true, url: 'http://gitlab.runjs.cn:8929/kubernetes/vue-project.git', branch: \"${BRANCH}\", credentialsId: \"${GITLAB_AUTH}\")\n            script {\n              COMMIT_ID = sh(returnStdout: true, script: \"git log -n 1 --pretty=format:'%h'\").trim()\n              TAG = BUILD_TAG + '-' + COMMIT_ID\n              println \"Current branch is ${BRANCH}, Commit ID is ${COMMIT_ID}, Image TAG is ${TAG}\"\n\n            }\n\n          }\n        }\n        stage('Pulling Code by trigger') {\n          when {\n            expression {\n              env.gitlabBranch != null\n            }\n\n          }\n          steps {\n            git(url: 'http://gitlab.runjs.cn:8929/kubernetes/vue-project.git', branch: env.gitlabBranch, changelog: true, poll: true, credentialsId: \"${GITLAB_AUTH}\")\n            script {\n              COMMIT_ID = sh(returnStdout: true, script: \"git log -n 1 --pretty=format:'%h'\").trim()\n              TAG = BUILD_TAG + '-' + COMMIT_ID\n              println \"Current branch is ${env.gitlabBranch}, Commit ID is ${COMMIT_ID}, Image TAG is ${TAG}\"\n              }\n            }\n          }\n        }\n      }\n\n    stage('Building') {\n      steps {\n        container(name: 'build') {\n            sh \"\"\"\n              npm install --registry=https://registry.npm.taobao.org\n              npm run build\n            \"\"\"\n        }\n      }\n    }\n\n    stage('Docker build for creating image') {\n      steps {\n        withCredentials([[$class: 'UsernamePasswordMultiBinding',\n        credentialsId: \"${HARBOR_AUTH}\",\n        usernameVariable: 'Harbor_user',\n        passwordVariable: 'Harbor_password']]) {\n            sh \"\"\"#!/bin/bash\n              set -eux\n\n              docker login -u ${Harbor_user} -p ${Harbor_password} ${HARBOR_ADDRESS}\n              docker build --no-cache -t ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG} .\n              docker push ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG}\n              docker rmi -f ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG}\n              \"\"\"\n        }\n      }\n    }\n\n    stage('Deploying to K8s') {\n      steps {\n           sh \"\"\"#!/bin/bash\n           set -ux\n\n           # set\u66f4\u65b0deployment\u955c\u50cf\n           kubectl set image deploy -l app=${IMAGE_NAME} ${IMAGE_NAME}=${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG} -n $NAMESPACE\n           \"\"\"\n      }\n    }\n  }\n      post {\n        failure {\n            updateGitlabCommitStatus name: \"build\", state: \"failed\"\n        }\n        success {\n            updateGitlabCommitStatus name: \"build\", state: \"success\"\n        }\n    }\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5bf9\u4e8e\u4e0d\u540c\u7684\u9879\u76ee\uff0c\u53ea\u662f\u6784\u5efa\u7684\u955c\u50cf\u548c\u6784\u5efa\u547d\u4ee4\u4e0d\u4e00\u81f4\uff0c\u6574\u4e2a\u6d41\u6c34\u7ebf\u7684\u8fc7\u7a0b\u57fa\u672c\u4e00\u81f4\uff0c\u6240\u4ee5\u5728\u5b9a\u4e49\u4e86\u4e00\u4e2aJenkinsfile\u540e\uff0c\u7a0d\u52a0\u4fee\u6539\u5373\u53ef\u5b9e\u73b0 \u5176\u4ed6\u8bed\u8a00\u7684\u81ea\u52a8\u5316\u6784\u5efa\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#72-\u5b9a\u4e49dockerfile","title":"7.2 \u5b9a\u4e49Dockerfile","text":"<p>\u524d\u7aef\u5e94\u7528\u6784\u5efa\u540e\u4e00\u822c\u4f1a\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u7684dist\u6587\u4ef6\u4e0b\u4ea7\u751fHTML\u6587\u4ef6\uff0c\u53ea\u9700\u8981\u590d\u5236\u5230nginx\u7684\u6839\u76ee\u5f55\u4e0b\u5373\u53ef\uff1a</p> <p><code>Dockerfile</code></p> <pre><code>FROM registry.cn-beijing.aliyuncs.com/dotbalo/nginx:1.15.12\nCOPY dist/* /usr/share/nginx/html/\n</code></pre> <p>Jenkinsfile\u548cDockerfile\u6587\u4ef6\u6dfb\u52a0\u5230\u4ed3\u5e93\u4ee3\u7801\u540c\u7ea7\u76ee\u5f55\u4e0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#73-\u5b9a\u4e49kubernetes\u8d44\u6e90","title":"7,3 \u5b9a\u4e49Kubernetes\u8d44\u6e90","text":"<p>\u5bf9\u4e8eKubernetes\u7684\u8d44\u6e90\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u53ea\u9700\u8981\u66f4\u6539\u8d44\u6e90\u540d\u79f0\u548c\u7aef\u53e3\u53f7\u5373\u53ef\uff1a</p> <p><code>deployment.yaml</code></p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\ncreationTimestamp: null\nlabels:\napp: vue-project\nname: vue-project\nnamespace: kubernetes\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: vue-project\nstrategy:\nrollingUpdate:\nmaxSurge: 1\nmaxUnavailable: 0\ntype: RollingUpdate\ntemplate:\nmetadata:\ncreationTimestamp: null\nlabels:\napp: vue-project\nspec:\ncontainers:\n- env:\n- name: TZ\nvalue: Asia/Shanghai\n- name: LANG\nvalue: C.UTF-8\nimage: nginx\nimagePullPolicy: IfNotPresent\nlivenessProbe:\nfailureThreshold: 2\ninitialDelaySeconds: 30\nperiodSeconds: 10\nsuccessThreshold: 1\ntcpSocket:\nport: 80\ntimeoutSeconds: 2\nname: vue-project\nports:\n- containerPort: 80\nname: web\nprotocol: TCP\nresources:\nlimits:\ncpu: 994m\nmemory: 1170Mi\nrequests:\ncpu: 10m\nmemory: 55Mi\ndnsPolicy: ClusterFirst\nimagePullSecrets:\n- name: harborkey\nrestartPolicy: Always\nserviceAccountName: default\n</code></pre> <p>\u5b9a\u4e49\u8be5\u5e94\u7528\u7684Service\u548cIngress\uff1a</p> <p><code>vue-project-svc-ingress.yaml</code></p> <pre><code>---\napiVersion: v1\nkind: Service\nmetadata:\nlabels:\napp: vue-project\nname: vue-project\nnamespace: kubernetes\nspec:\nports:\n- name: web\nport: 80\nprotocol: TCP\ntargetPort: 80\nselector:\napp: vue-project\nsessionAffinity: None\ntype: ClusterIP\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nname: vue-project\nnamespace: kubernetes\nspec:\ningressClassName: nginx\nrules:\n- host: vue-project.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: vue-project\nport: number: 80\npath: /\npathType: ImplementationSpecific\n</code></pre> <p>\u521b\u5efa\u8be5\u8d44\u6e90\uff1a</p> <pre><code>$ kubectl create -f deployment.yaml\n$ kubectl create -f vue-project-svc-ingress.yaml\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#74-\u521b\u5efajenkins-job","title":"7.4 \u521b\u5efaJenkins Job","text":"<p>\u521b\u5efaJenkins Job\u548c\u4e0a\u4e00\u5c0f\u8282\u7c7b\u4f3c\uff0c\u5e76\u65e0\u592a\u5927\u533a\u522b\u3002\u9996\u5148\u521b\u5efaPipeline\u7c7b\u578b\u7684Job\uff0c\u540d\u79f0\u4e3avue-project\uff0c\u540c\u6837\u5728Pipeline\u680f\u586b\u5199\u5730\u5740\u3001Key\u548c\u5206\u652f\uff0c\u5982\u56fe</p> <p></p> <p>\u540c\u6837\uff0c\u7b2c\u4e00\u6b21\u6784\u5efa\u4e5f\u4f1a\u5931\u8d25\uff0c\u7b2c\u4e8c\u6b21\u53ef\u4ee5\u9009\u62e9\u5206\u652f\u6784\u5efa.\u5f53\u51fa\u73b0SUCCESS\u65f6\uff0c\u8868\u793a\u6784\u5efa\u7ed3\u675f\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\u53ef\u4ee5\u67e5\u770bDeployment\u7684\u955c\u50cf\uff1a</p> <pre><code>$ kubectl get deploy vue-project -o yaml -n kubernetes|grep \"image:\"\nimage: hub.gitee.cc/kubernetes/vue-project:jenkins-vue-project-4-9256578\n\n$ kubectl get pod -n kubernetes\nNAME                          READY   STATUS    RESTARTS   AGE\nvue-project-f56dcdb95-zwbl5   1/1     Running   0          29m\n</code></pre> <p>\u90e8\u7f72\u66f4\u65b0\u955c\u50cf\u5b8c\u6bd5\u4e4b\u540e\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u8bbf\u95ee\u8be5\u57df\u540d\u3002</p> <p></p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#75-webhook\u81ea\u52a8\u89e6\u53d1","title":"7.5 Webhook\u81ea\u52a8\u89e6\u53d1","text":"<p>\u540c6.8\u8bbe\u7f6e\u76f8\u540c\u3002\u53c2\u8003\u4e0a\u9762\u8bbe\u7f6e\u5185\u5bb9\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#8-\u81ea\u52a8\u5316\u6784\u5efagolang\u9879\u76ee","title":"8. \u81ea\u52a8\u5316\u6784\u5efaGolang\u9879\u76ee","text":"<p>\u524d\u9762\u6f14\u793a\u4e86Java\u548c\u524d\u7aef\u5e94\u7528\u7684\u81ea\u52a8\u5316\uff0c\u63a5\u4e0b\u6765\u6f14\u793a\u5bf9\u4e8eGolang\u7684\u81ea\u52a8\u5316\u6784\u5efa\uff0c\u672c\u793a\u4f8b\u7684\u4ee3\u7801\u5730\u5740\u4e3ahttps://gitee.com/dukuan/go-project.git\u3002</p> <p>\u53ef\u4ee5\u6309\u7167\u521b\u5efaJava\u6d4b\u8bd5\u7528\u4f8b\u7684\u65b9\u5f0f\u5bfc\u5165\u524d\u7aef\u9879\u76ee\u5230GitLab\u4e2d\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u516c\u53f8\u81ea\u5df1\u7684\u9879\u76ee\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#81-\u5b9a\u4e49jenkinsfile","title":"8.1 \u5b9a\u4e49Jenkinsfile","text":"<p>\u5148\u5c06\u955c\u50cf\u4e0a\u4f20\u5230harbor\u79c1\u6709\u4ed3\u5e93</p> <pre><code>$ docker pull registry.cn-beijing.aliyuncs.com/citools/golang:1.15\n$ docker tag registry.cn-beijing.aliyuncs.com/citools/golang:1.15 hub.gitee.cc/kubernetes/golang:1.15\n$ docker push hub.gitee.cc/kubernetes/golang:1.15\n</code></pre> <p>\u672c\u793a\u4f8b\u7684Jenkinsfile\u548c\u4e4b\u524d\u7684\u6ca1\u6709\u592a\u5927\u533a\u522b\uff0c\u9700\u8981\u66f4\u6539\u7684\u4f4d\u7f6e\u662f\u6784\u5efa\u5bb9\u5668\u7684\u955c\u50cf\u3001\u7f13\u5b58\u76ee\u5f55\u3001Git\u5730\u5740\u548c\u9879\u76ee\u540d\u79f0\uff1a</p> <pre><code>pipeline{\n    environment {\n        COMMIT_ID = \"\"\n        HARBOR_ADDRESS = \"hub.gitee.cc\"\n        REGISTRY_DIR = \"kubernetes\"\n        IMAGE_NAME = \"go-project\"\n        NAMESPACE = \"kubernetes\"\n        TAG = \"\"\n        GITLAB_AUTH = \"gitlab-auth\"\n        HARBOR_AUTH = \"harbor-user-passwd\"\n    }\n  parameters {\n    gitParameter(branch: '', branchFilter: 'origin/(.*)', defaultValue: 'master', description: 'Branch for build and deploy', name: 'BRANCH', quickFilterEnabled: false, selectedValue: 'NONE', sortMode: 'NONE', tagFilter: '*', type: 'PT_BRANCH')\n  }\n\n    options {\n      parallelsAlwaysFailFast()\n      disableResume()\n      quietPeriod(1)\n      preserveStashes(buildCount: 5)\n      timestamps()\n      buildDiscarder(logRotator(numToKeepStr: '100'))\n      timeout(time: 60, unit: 'MINUTES')\n      gitLabConnection(\"gitlab\")\n    }\n\n    agent {\n        kubernetes {\n            cloud 'kubernetes'\n            slaveConnectTimeout 1200\n            workspaceVolume nfsWorkspaceVolume(serverAddress: \"192.168.1.60\", serverPath: \"/QaTest/jenkins-salve\", readOnly: \"false\")\n            yaml '''\napiVersion: v1\nkind: Pod\nmetadata:\n  name: \"jenkins-slave\"\n  namespace: \"kube-ops\"\n  labels:\n    jenkins: \"slave\"\n    jenkins/label: \"jenkins-jnlp\"\nspec:\n  containers:\n  - name: \"jnlp\"\n    image: \"hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    resources:\n      limits:\n        cpu: 1000m\n        memory: 2000Mi\n      requests:\n        cpu: 200m\n        memory: 400Mi\n    env:\n    - name: \"DOCKER_HOST\"\n      value: \"tcp://192.168.1.141:2375\"\n    - name: \"JENKINS_AGENT_WORKDIR\"\n      value: \"/home/jenkins/agent\"\n    volumeMounts:\n    - mountPath: \"/root/.kube/config\"\n      name: \"volume-0\"\n      readOnly: false\n      subPath: \"config\"\n    - name: localtime\n      mountPath: /etc/localtime\n\n    - mountPath: \"/home/jenkins/agent\"\n      name: \"workspace-volume\"\n      readOnly: false\n    workingDir: \"/home/jenkins/agent\"\n\n  - name: \"build\"\n    image: \"hub.gitee.cc/kubernetes/golang:1.15\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    volumeMounts:\n      - name: localtime\n        mountPath: /etc/localtime\n      - name:  cachedir\n        mountPath: \"/go/pkg/\"\n        readOnly: false\n    command:\n      - \"cat\"\n    env:\n      - name: \"LANGUAGE\"\n        value: \"en_US:en\"\n      - name: \"LC_ALL\"\n        value: \"en_US.UTF-8\"\n      - name: \"LANG\"\n        value: \"en_US.UTF-8\"\n\n  volumes:\n    - name: localtime\n      hostPath:\n        path: /usr/share/zoneinfo/Asia/Shanghai\n\n    - configMap:\n        name: \"kubeconfig\"\n        optional: false\n      name: \"volume-0\"\n    # \u7f13\u5b58\u76ee\u5f55\n    - name: \"cachedir\"\n      hostPath:\n        path: \"/opt/gopkg\"\n\n    - emptyDir:\n        medium: \"\"\n      name: \"workspace-volume\"\n  restartPolicy: Always\n  hostNetwork: false\n  imagePullSecrets:\n  - name: \"regcred\"\n  # \u56fa\u5b9a\u8282\u70b9\u90e8\u7f72\n  nodeSelector:\n    build: \"true\"\n\n            '''\n        }\n    }\n\n    stages {\n      stage('Pulling Code') {\n        parallel {\n        stage('Pulling Code by Jenkins') {\n          when {\n            expression {\n              env.gitlabBranch == null\n            }\n\n          }\n          steps {\n            git(changelog: true, poll: true, url: 'http://gitlab.runjs.cn:8929/kubernetes/go-project.git', branch: \"${BRANCH}\", credentialsId: \"${GITLAB_AUTH}\")\n            script {\n              COMMIT_ID = sh(returnStdout: true, script: \"git log -n 1 --pretty=format:'%h'\").trim()\n              TAG = BUILD_TAG + '-' + COMMIT_ID\n              println \"Current branch is ${BRANCH}, Commit ID is ${COMMIT_ID}, Image TAG is ${TAG}\"\n\n            }\n\n          }\n        }\n        stage('Pulling Code by trigger') {\n          when {\n            expression {\n              env.gitlabBranch != null\n            }\n\n          }\n          steps {\n            git(url: 'http://gitlab.runjs.cn:8929/kubernetes/go-project.git', branch: env.gitlabBranch, changelog: true, poll: true, credentialsId: \"${GITLAB_AUTH}\")\n            script {\n              COMMIT_ID = sh(returnStdout: true, script: \"git log -n 1 --pretty=format:'%h'\").trim()\n              TAG = BUILD_TAG + '-' + COMMIT_ID\n              println \"Current branch is ${env.gitlabBranch}, Commit ID is ${COMMIT_ID}, Image TAG is ${TAG}\"\n              }\n            }\n          }\n        }\n      }\n\n    stage('Building') {\n      steps {\n        container(name: 'build') {\n            sh \"\"\"\n               export GO111MODULE=on\n               go env -w GOPROXY=https://goproxy.cn,direct\n               go build\n            \"\"\"\n        }\n      }\n    }\n\n    stage('Docker build for creating image') {\n      steps {\n        withCredentials([[$class: 'UsernamePasswordMultiBinding',\n        credentialsId: \"${HARBOR_AUTH}\",\n        usernameVariable: 'Harbor_user',\n        passwordVariable: 'Harbor_password']]) {\n            sh \"\"\"#!/bin/bash\n              set -eux\n              docker login -u ${Harbor_user} -p ${Harbor_password} ${HARBOR_ADDRESS}\n\n              docker build --no-cache -t ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG} .\n\n              docker push ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG}\n              docker rmi -f ${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG}\n              \"\"\"\n        }\n      }\n    }\n\n    stage('Deploying to K8s') {\n      steps {\n           sh \"\"\"#!/bin/bash\n           set -ux\n           kubectl set image deploy -l app=${IMAGE_NAME} ${IMAGE_NAME}=${HARBOR_ADDRESS}/${REGISTRY_DIR}/${IMAGE_NAME}:${TAG} -n $NAMESPACE\n           \"\"\"\n      }\n    }\n  }\n    post {\n        failure {\n            updateGitlabCommitStatus name: \"build\", state: \"failed\"\n        }\n        success {\n            updateGitlabCommitStatus name: \"build\", state: \"success\"\n        }\n    }\n}\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#82-\u5b9a\u4e49dockerfile","title":"8.2 \u5b9a\u4e49Dockerfile","text":"<p>\u548c\u4e4b\u524d\u4e0d\u4e00\u6837\u7684\u5730\u65b9\u662f\uff0cGolang\u7f16\u8bd1\u540e\u751f\u6210\u7684\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\uff0c\u6240\u4ee5\u5e95\u5c42\u955c\u50cf\u8bbe\u7f6e\u4e3aalpine\u6216\u8005\u5176\u4ed6\u7684\u5c0f\u955c\u50cf\u5373\u53ef\uff1a</p> <p><code>Dockerfile</code></p> <pre><code>FROM registry.cn-beijing.aliyuncs.com/dotbalo/alpine-glibc:alpine-3.9\n# \u5982\u679c\u5b9a\u4e49\u4e86\u5355\u72ec\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u80fd\u9700\u8981\u62f7\u8d1d\u5230\u955c\u50cf\u4e2d\nCOPY conf/  ./conf # \u5305\u540d\u6309\u7167\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u4fee\u6539\nCOPY ./go-project ./ EXPOSE 8080\nENTRYPOINT [ \"./go-project\"] # \u542f\u52a8\u8be5\u5e94\u7528\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#83--\u5b9a\u4e49kubernets\u8d44\u6e90","title":"8.3  \u5b9a\u4e49Kubernets\u8d44\u6e90","text":"<p><code>go-project-deployment.yaml</code></p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: go-project\nname: go-project\nnamespace: kubernetes\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: go-project\ntemplate:\nmetadata:\nlabels:\napp: go-project\nspec:\ncontainers:\n- env:\n- name: TZ\nvalue: Asia/Shanghai\n- name: LANG\nvalue: C.UTF-8\nimage: nginx\nimagePullPolicy: IfNotPresent\nlivenessProbe:\nfailureThreshold: 2\ninitialDelaySeconds: 30\nperiodSeconds: 10\nsuccessThreshold: 1\ntcpSocket:\nport: 8080\ntimeoutSeconds: 2\nname: go-project\nports:\n- containerPort: 8080\nname: web\nprotocol: TCP\nresources:\nlimits:\ncpu: 994m\nmemory: 1170Mi\nrequests:\ncpu: 10m\nmemory: 55Mi\ndnsPolicy: ClusterFirst\nimagePullSecrets:\n- name: harborkey\nrestartPolicy: Always\nsecurityContext: {}\nserviceAccountName: default\n</code></pre> <p><code>go-project-svc-ingress.yaml</code></p> <pre><code>---\napiVersion: v1\nkind: Service\nmetadata:\nlabels:\napp: go-project\nname: go-project\nnamespace: kubernetes\nspec:\nports:\n- name: web\nport: 8080\nprotocol: TCP\ntargetPort: 8080\nselector:\napp: go-project\ntype: ClusterIP\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\nname: go-project\nnamespace: kubernetes\nspec:\ningressClassName: nginx\nrules:\n- host: go-project.test.com\nhttp:\npaths:\n- backend:\nservice:\nname: go-project\nport: number: 8080\npath: /\npathType: ImplementationSpecific\n</code></pre> <p>\u521b\u5efa\u8be5\u8d44\u6e90\uff1a</p> <pre><code>$ kubectl apply -f go-project-deployment.yaml\ndeployment.apps/go-project created\n\n$ kubectl apply -f go-project-svc-ingress.yaml\nservice/go-project created\ningress.networking.k8s.io/go-project created\n\n$ kubectl get pod -n kubernetes\nNAME                          READY   STATUS    RESTARTS      AGE\ngo-project-5b47cfcc8f-rbmm8   1/1     Running   1 (19s ago)   72s\n</code></pre>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#84-\u521b\u5efajenkins-job","title":"8.4 \u521b\u5efaJenkins Job","text":"<p>\u521b\u5efaJenkins Job\u548c\u524d\u9762\u4e5f\u6ca1\u6709\u533a\u522b\uff0c\u5728\u6b64\u4e0d\u518d\u91cd\u590d\u6f14\u793a\u3002</p> <p>\u63a5\u4e0b\u6765\u53ef\u4ee5\u67e5\u770bDeployment\u7684\u955c\u50cf\uff1a</p> <pre><code>$ kubectl get deployment -o yaml -n kubernetes |grep \"image: \"\nimage: hub.gitee.cc/kubernetes/go-project:jenkins-go-project-2-2cd059f\n\n$ kubectl get pod -n kubernetes\nNAME                          READY   STATUS    RESTARTS   AGE\ngo-project-6d8f6bddd6-jd5l7   1/1     Running   0          94s\n</code></pre> <p>\u4e4b\u540e\u5373\u53ef\u8bbf\u95ee\u8be5\u5e94\u7528\uff08\u5982\u679c\u662f\u540e\u7aef\u9879\u76ee\uff0c\u5219\u65e0\u987b\u521b\u5efaIngress\u66b4\u9732\u670d\u52a1\uff09</p> <p></p> <p>\u4e4b\u540e\u5728\u521b\u5efaPod\u7684\u8282\u70b9\u53ef\u4ee5\u770b\u5230\u7f13\u5b58\u76ee\u5f55\uff1a</p> <pre><code>$ cd /opt/gopkg/\n[root@k8s-node01 gopkg]# ll\ntotal 0\ndrwxr-xr-x 7 root root 96 Feb 22 15:49 mod\ndrwxr-xr-x 3 root root 28 Feb 22 15:49 sumdb\n</code></pre> <p>\u7f16\u5199\u4ee3\u7801\uff0c\u66f4\u65b0\u4ee3\u7801\u5230gitlab\u4ed3\u5e93\u4e2d\u3002 </p> <p>\u91cd\u65b0\u89e6\u53d1jenkins pipeline\u3002 </p> <p>\u67e5\u770b\u4ee3\u7801\u53d1\u5e03\u66f4\u65b0\u72b6\u6001\u3002 </p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#9-uat\u53ca\u751f\u4ea7\u73af\u5883\u6d41\u6c34\u7ebf\u8bbe\u8ba1","title":"9. UAT\u53ca\u751f\u4ea7\u73af\u5883\u6d41\u6c34\u7ebf\u8bbe\u8ba1","text":"<p>\u4e0a\u8ff0\u6f14\u793a\u793a\u4f8b\u90fd\u5305\u542b\u6784\u5efa\u8fc7\u7a0b\uff0c\u4e00\u822c\u4f1a\u7528\u5728\u9996\u6b21\u63d0\u4ea4\u4ee3\u7801\uff0c\u7136\u540e\u6784\u5efa\uff0c\u5e76\u53d1\u5e03\u81f3\u7b2c\u4e00\u4e2a\u9879\u76ee\u7684\u73af\u5883\u4e2d\uff0c\u4e00\u822c\u662f\u5f00\u53d1\u73af\u5883\u6216\u8005\u6d4b\u8bd5\u73af\u5883\u3002\u8fd9\u7c7b\u73af\u5883\u91c7 \u7528\u8fd9\u79cd\u6a21\u5f0f\u6ca1\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u6784\u5efa\u548c\u4ea7\u751f\u955c\u50cf\u7684\u6b65\u9aa4\u662f\u5fc5\u9700\u7684\u3002</p> <p>\u4f46\u662f\u5728\u5176\u4ed6\u73af\u5883\uff0c\u6bd4\u5982Sit\u3001UAT\u3001\u751f\u4ea7\u73af\u5883\uff0c\u5176\u5b9e\u662f\u6ca1\u6709\u5fc5\u8981\u91cd\u590d\u6784\u5efa\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u9009\u62e9\u955c\u50cf\u8fdb\u884c\u53d1\u7248\uff0c\u5f53\u7136\u8fd9\u79cd\u6a21\u5f0f\u548c\u4ee3\u7801\u672c\u8eab\u7684\u8bbe\u8ba1\u6709\u5173\u7cfb\uff0c \u4e5f\u5c31\u662f\u8981\u505a\u5230\u914d\u7f6e\u5206\u79bb\u548c\u6784\u5efa\u4e0e\u4ee3\u7801\u914d\u7f6e\u65e0\u5173\u624d\u884c\u3002</p> <p>\u5982\u679c\u8bfb\u8005\u7684\u9879\u76ee\u7b26\u5408\u6b64\u7c7b\u6761\u4ef6\uff0c\u53ef\u4ee5\u5c06\u7b2c\u4e00\u6b21\u6784\u5efa\u7684\u955c\u50cf\u53d1\u5e03\u5230\u4efb\u610f\u73af\u5883\uff0c\u53ef\u4ee5\u91c7\u7528\u955c\u50cf\u7684\u65b9\u5f0f\u8fdb\u884c\u53d1\u7248\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8be5\u6d41\u6c34\u7ebf\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\u3002</p> <p>\u5047\u5982\u6211\u4eec\u6709\u4e00\u4e2ago-project\u7684UAT\u73af\u5883\uff0c\u8be5\u73af\u5883\u7684\u53d1\u7248\u4e0d\u9700\u8981\u6784\u5efa\uff0c\u53ea\u9700\u8981\u9009\u62e9\u6d4b\u8bd5\u73af\u5883\u7684\u955c\u50cf\u5373\u53ef\uff0c\u6b64\u65f6UAT\u73af\u5883\uff08\u9009\u62e9\u955c\u50cf\u53d1\u7248\uff09\u7684Jenkins Job \u914d\u7f6e\u5982\u4e0b\u3002</p> <p>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Job\uff0c\u540d\u5b57\u4e3ago-project-uat\uff0c\u7c7b\u578b\u4e3aPipeline\uff0c\u5982\u56fe </p> <p>\u52fe\u9009\u9875\u9762\u4e0a\u7684This project is parameterized\uff08\u53c2\u6570\u5316\u6784\u5efa\uff09\uff0c\u9009\u62e9\u53c2\u6570\u7c7b\u578b\u4e3aImage Tag Parameter\uff08\u9700\u8981\u5b89\u88c5Image Tag\u63d2\u4ef6\uff09\uff0c\u4e4b\u540e\u5b9a\u4e49Name\u4e3a\u53d8\u91cf\u7684\u540d\u79f0\uff0cImage Name\u4e3aHarbor\u7684\u76ee\u5f55\u548c\u955c\u50cf\u540d\u79f0\uff0c\u5982\u56fe</p> <p></p> <p>\u6dfb\u52a0Image Tag\u53c2\u6570 </p> <p>\u914d\u7f6eHarbor\u5730\u5740 </p> <p>\u4e4b\u540e\u53ef\u4ee5\u5148\u5355\u51fbSave\uff0c\u7136\u540e\u6d4b\u8bd5\u80fd\u5426\u83b7\u53d6\u5230Tag\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u4fdd\u5b58\u540e\u5355\u51fbBuild with Parameters\u3002 </p> <p>\u4e4b\u540e\u5355\u51fbConfigure\uff0c\u6dfb\u52a0Pipeline\u811a\u672c\uff1a</p> <pre><code>pipeline{\n    environment {\n        HARBOR_ADDRESS = \"hub.gitee.cc\"\n        NAMESPACE = \"kubernetes\"\n        IMAGE_NAME = \"go-project\"\n        TAG = \"\"\n    }\n\n    options {\n      parallelsAlwaysFailFast()\n      disableResume()\n      quietPeriod(1)\n      preserveStashes(buildCount: 5)\n      timestamps()\n      buildDiscarder(logRotator(numToKeepStr: '100'))\n      timeout(time: 60, unit: 'MINUTES')\n    }\n\n    agent {\n        kubernetes {\n            cloud 'kubernetes'\n            slaveConnectTimeout 1200\n            workspaceVolume nfsWorkspaceVolume(serverAddress: \"192.168.1.60\", serverPath: \"/QaTest/jenkins-salve\", readOnly: \"false\")\n            yaml '''\napiVersion: v1\nkind: Pod\nmetadata:\n  name: \"jenkins-slave\"\n  namespace: \"kube-ops\"\n  labels:\n    jenkins: \"slave\"\n    jenkins/label: \"jenkins-jnlp\"\nspec:\n  containers:\n  - name: \"jnlp\"\n    image: \"hub.gitee.cc/kubernetes/jenkins-salve:latet-jdk11\"\n    imagePullPolicy: \"IfNotPresent\"\n    tty: true\n    resources:\n      limits:\n        cpu: 1000m\n        memory: 2000Mi\n      requests:\n        cpu: 200m\n        memory: 400Mi\n    env:\n    - name: \"DOCKER_HOST\"\n      value: \"tcp://192.168.1.141:2375\"\n    - name: \"JENKINS_AGENT_WORKDIR\"\n      value: \"/home/jenkins/agent\"\n    volumeMounts:\n    - mountPath: \"/root/.kube/config\"\n      name: \"volume-0\"\n      readOnly: false\n      subPath: \"config\"\n    - name: localtime\n      mountPath: /etc/localtime\n\n    - mountPath: \"/home/jenkins/agent\"\n      name: \"workspace-volume\"\n      readOnly: false\n    workingDir: \"/home/jenkins/agent\"\n\n  volumes:\n    - name: localtime\n      hostPath:\n        path: /usr/share/zoneinfo/Asia/Shanghai\n\n    - configMap:\n        name: \"kubeconfig\"\n        optional: false\n      name: \"volume-0\"\n\n    - emptyDir:\n        medium: \"\"\n      name: \"workspace-volume\"\n  restartPolicy: Always\n  hostNetwork: false\n  imagePullSecrets:\n  - name: \"regcred\"\n  nodeSelector:\n    build: \"true\"\n            '''\n        }\n    }\n\n    stages {\n        stage('Deploying to K8s') {\n          steps {\n            container(name: 'jnlp') {\n               sh \"\"\"#!/bin/bash\n                   set -ux\n                   # \u8be5\u53d8\u91cf\u5373\u4e3a\u524d\u53f0\u9009\u62e9\u7684\u955c\u50cf\n                   echo ${IMAGE_TAG}\n                   kubectl set image deployment -l app=${IMAGE_NAME} ${IMAGE_NAME}=${HARBOR_ADDRESS}/${IMAGE_TAG} -n ${NAMESPACE}\n                   kubectl get pod  -l app=${IMAGE_NAME} -n ${NAMESPACE}\n                   kubectl get deploy/${IMAGE_NAME} -o yaml  -n ${NAMESPACE}|grep \"image: \"\n               \"\"\"\n          }\n        }\n     }\n  }\n}\n</code></pre> <p>\u4fdd\u5b58\u540e\uff0c\u9009\u62e9\u4e00\u4e2a\u955c\u50cf\uff0c\u5355\u51fbBuild\uff0c\u7ed3\u679c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u662f\u76f4\u63a5\u5c06\u955c\u50cf\u7248\u672c\u66f4\u65b0\u81f3Kubernetes\uff0c\u5e76\u65e0\u6784\u5efa\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u7701\u4e0b\u5f88\u591a\u65f6\u95f4\u3002\u8be5\u6d41\u6c34\u7ebf\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e4b\u524d\u7684\u7248\u672c\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\u3002</p> <p>\u67e5\u770b\u90e8\u7f72\u8fc7\u7a0b</p> <p></p> <p>\u53c2\u8003\u6587\u732e</p> <p>\u57fa\u4e8ek8s\u7684DevOps\u73af\u5883\u6784\u5efa</p> <p>Jenkins\u7684\u6d41\u6c34\u7ebf\u8be6\u89e3</p> <p>DevOps\u81ea\u52a8\u5316\u6784\u5efa\u5e94\u7528</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#10-vscode-jenkins\u63d2\u4ef6\u5206\u4eab","title":"10. vscode Jenkins\u63d2\u4ef6\u5206\u4eab","text":"<p>Jenkins Pipeline Linter Connector</p> <p>\u5b89\u88c5\u65b9\u5f0f\uff1a\u5728Vscode\u6269\u5c55\u5546\u5e97\u5f53\u4e2d\u76f4\u63a5\u641c\u7d22\u5373\u53ef\u5b89\u88c5\u3002</p> <p>\u529f\u80fd\u8bf4\u660e\uff1aJenkinsfile \u8bed\u6cd5\u68c0\u6d4b\uff0c\u975e\u5e38\u65b9\u4fbf\u3002</p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#101-\u5728vscode\u4e2d\u6821\u9a8c\u60a8\u7684jenkinsfile","title":"10.1 \u5728VSCode\u4e2d\u6821\u9a8c\u60a8\u7684Jenkinsfile","text":"<p>\u60a8\u53ef\u4ee5\u5728 VS Code \u63d2\u4ef6\u6d4f\u89c8\u5668\u4e2d\u6216\u542c\u8fc7\u4e0b\u9762\u7684\u5730\u5740 url: https://marketplace.visualstudio.com/items?itemName=janjoerke.jenkins-pipeline-linter-connector \u627e\u5230\u63d2\u4ef6\u3002</p> <p>\u8be5\u63d2\u4ef6\u4f1a\u5728 VS Code \u4e2d\u6dfb\u52a0\u56db\u9879\u914d\u7f6e\uff0c\u60a8\u9700\u8981\u914d\u7f6e\u7528\u6765\u6267\u884c\u68c0\u9a8c\u7684 Jenkins \u3002 - jenkins.pipeline.linter.connector.url \u662f\u60a8\u7684 Jenkins \u671f\u5f85\u7684 POST \u8bf7\u6c42\u5730\u5740\uff0c\u5305\u542b\u60a8\u8981\u6821\u9a8c\u7684 Jenkinsfile \u6587\u4ef6\u3002\u901a\u5e38\u4e3a<code>http://&lt;your_jenkins_server:port&gt;/pipeline-model-converter/validate</code>\u3002</p> <ul> <li> <p>jenkins.pipeline.linter.connector.user \u5141\u8bb8\u60a8\u6307\u5b9a\u60a8\u7684 Jenkins \u7528\u6237\u540d\u3002</p> </li> <li> <p>jenkins.pipeline.linter.connector.pass \u5141\u8bb8\u60a8\u6307\u5b9a\u60a8\u7684 Jenkins \u5bc6\u7801\u3002</p> </li> <li> <p>jenkins.pipeline.linter.connector.crumbUrl \u5f53\u60a8\u7684 Jenkins \u542f\u7528\u4e86 CRSF \u65f6\u5fc5\u987b\u6307\u5b9a\u3002\u901a\u5e38\u4e3a<code>http://&lt;your_jenkins_server:port&gt;/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)</code>\u3002</p> </li> </ul> <p>\u5728 VS Code \u4e2d\u6821\u9a8c\u60a8\u7684 Jenkinsfile </p> <p>VScode\u672c\u5730\u8fdb\u884cJenkinsfile\u8bed\u6cd5\u9a8c\u8bc1</p> <p>\u5728 VS Code \u4e2d\u6821\u9a8c\u60a8\u7684 Jenkinsfile </p>"},{"location":"Kubernetes/6.DevOps%E7%AF%87/17.DevOps%E5%AE%9E%E8%B7%B5/#11-\u5c0f\u7ed3","title":"11. \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u4e3b\u8981\u6f14\u793a\u4e86Java\u3001Vue\u524d\u7aef\u3001Golang\u7684\u81ea\u52a8\u5316\u6784\u5efa\u914d\u7f6e\uff0c\u6f14\u793a\u4e86\u5bb9\u5668\u5316\u4e1a\u52a1\u90e8\u7f72\u7684\u4e0d\u540c\u65b9\u5f0f\uff0c\u5747\u4f7f\u7528Jenkins\u65b0\u7279\u6027\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u8fdb\u884c\u6301\u7eed\u96c6\u6210\u548c \u6301\u7eed\u90e8\u7f72\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u4e0d\u4e00\u5b9a\u975e\u8981\u4f7f\u7528\u6d41\u6c34\u7ebf\u8fdb\u884c\u6784\u5efa\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u9009\u62e9\u5176\u4ed6\u98ce\u683c\u7684\u6784\u5efa\u65b9\u5f0f\u3002</p> <p>\u901a\u8fc7\u591a\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa\uff0c\u4f7f\u7528\u6d41\u6c34\u7ebf\u8fdb\u884c\u6784\u5efa\u65f6\uff0c\u5927\u81f4\u6d41\u7a0b\u662f\u7c7b\u4f3c\u7684\uff0c\u4e3b\u8981\u662f\u7f16\u8bd1\u65b9\u5f0f\u3001\u57fa\u7840\u955c\u50cf\u548c\u7f16\u8bd1\u547d\u4ee4\u4e0d\u4e00\u6837\uff0c\u53ef\u4ee5\u6309\u7167\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u548c \u9700\u6c42\u8fdb\u884c\u4fee\u6539\u3002</p> <p>\u4e3a\u4e86\u4f7fJenkinsfile\u66f4\u52a0\u7075\u6d3b\u548c\u7edf\u4e00\uff0c\u53ef\u4ee5\u5bf9Jenkinsfile\u5b8c\u5168\u53c2\u6570\u5316\uff0c\u5c06Jenkinsfile\u6240\u6709\u53ef\u53d8\u7684\u8d4b\u503c\u90fd\u6539\u4e3a\u53d8\u91cf\uff0c\u7136\u540e\u5728Jenkins\u4e0a\u914d \u7f6e\u5bf9\u5e94\u7684\u53d8\u91cf\u5373\u53ef\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7fJenkins\u7684\u6784\u5efa\u53d8\u5f97\u66f4\u52a0\u7075\u6d3b\uff0c\u4e5f\u4f7f\u5f97\u540c\u4e00\u4e2aJenkinsfile\u9002\u7528\u4e8e\u6240\u6709\u7684\u9879\u76ee\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/","title":"1.Ansible\u5165\u95e8\u548c\u5b9e\u8df5","text":"<p>\u76f8\u6bd4\u8f83\u4e8ePuppet\u548cSaltstack\u800c\u8a00\uff0cAnsible\u662f\u4e00\u6b3e\u8f7b\u91cf\u7ea7\u7684\u670d\u52a1\u5668\u96c6\u4e2d\u7ba1\u7406\u8f6f\u4ef6\u3002</p> <p>Ansible\u9ed8\u8ba4\u91c7\u7528SSH\u7684\u65b9\u5f0f\u7ba1\u7406\u5ba2\u6237\u7aef\uff0c\u90e8\u7f72\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u8df3\u677f\u673a\u6216\u4e3b\u63a7\u7aef\u90e8\u7f72Ansible\u73af\u5883\u5373\u53ef\uff0c\u88ab\u63a7\u7aef\u65e0\u987b\u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c\u3002</p> <p>Ansible\u662f\u57fa\u4e8ePython\u5f00\u53d1\u7684\uff0c\u7531Paramiko\u548cPyYAML\u4e24\u4e2a\u5173\u952e\u6a21\u5757\u6784\u5efa\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b83\u7684\u5404\u79cd\u6a21\u5757\u6765\u5b9e\u73b0\u5bf9\u5ba2\u6237\u7aef\u7684\u6279\u91cf\u7ba1\u7406 (\u6267\u884c\u547d\u4ee4\u3001\u5b89\u88c5\u8f6f\u4ef6\u3001\u6307\u5b9a\u7279\u5b9a\u4efb\u52a1\u7b49)\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u8f83\u4e3a\u590d\u6742\u7684\u9700\u8981\u91cd\u590d\u6267\u884c\u7684\u4efb\u52a1\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Ansible\u4e0b\u7684playbook\u6765\u7ba1\u7406\u8fd9\u4e9b\u590d\u6742\u7684\u4efb\u52a1\u3002</p> <p>Ansible\u662f\u57fa\u4e8eParamiko\u5f00\u53d1\u7684\u3002</p> <p>\u90a3\u4e48Paramiko\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1fParamiko\u662f\u7528Python\u8bed\u8a00\u7f16\u5199\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u9075\u5faaSSH2\u534f\u8bae\uff0c\u652f\u6301\u4ee5\u52a0\u5bc6\u548c\u8ba4 \u8bc1\u7684\u65b9\u5f0f\uff0c\u8fdb\u884c\u8fdc\u7a0b\u670d\u52a1\u5668\u7684\u8fde\u63a5\u3002</p> <p>\u4e0e\u5e38\u7528\u8f6f\u4ef6xshell\u3001xftp\u7684\u529f\u80fd\u4e00\u6837\uff0c\u4e0d\u8fc7Paramiko\u53ef\u4ee5\u8fde\u63a5\u591a\u53f0\u670d\u52a1\u5668\uff0c\u8fdb\u884c\u590d\u6742\u7684\u64cd\u4f5c\u3002</p> <p>Ansible\u4e0e\u8f7b\u91cf\u7ea7\u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5de5\u5177Fabric\u8fd8\u6709\u4e00\u4e2a\u5171\u540c\u70b9\uff0c\u90a3\u5c31\u662f\u4e0d\u9700\u8981\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u5b89\u88c5\u5ba2\u6237\u7aef\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u662f\u57fa\u4e8eSSH\u6765\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u8fdb\u884c\u901a\u4fe1\u7684\u3002</p> <p>\u76f8\u6bd4\u8f83\u4e8e\u5176\u4ed6\u81ea\u52a8\u5316\u8fd0\u7ef4\u5de5\u5177\uff0cAnsible\u7684\u4f18\u52bf\u4e5f\u6709\u5f88\u591a\uff0c\u5177\u4f53\u5982\u4e0b\u3002</p> <ul> <li> <p>\u8f7b\u91cf\u7ea7\uff0c\u65e0\u987b\u5728\u5ba2\u6237\u7aef\u5b89\u88c5Aget,\u66f4\u65b0\u65f6\u53ea\u9700\u8981\u5728\u64cd\u4f5c\u673a\u4e0a\u8fdb\u884c\u4e00\u6b21\u66f4\u65b0\u5373\u53ef\u3002</p> </li> <li> <p>\u6279\u91cf\u4efb\u52a1\u6267\u884c\u53ef\u4ee5\u5199\u6210\u811a\u672c\uff0c\u800c\u4e14\u4e0d\u7528\u5206\u53d1\u5230\u8fdc\u7a0b\u5c31\u53ef\u4ee5\u6267\u884c\u3002</p> </li> <li> <p>\u4f7f\u7528Python\u7f16\u5199\uff0c\u7ef4\u62a4\u7b80\u5355\uff0c\u4e8c\u6b21\u5f00\u53d1\u66f4\u65b9\u4fbf\u3002</p> </li> <li> <p>\u652f\u6301\u975eroot\u7528\u6237\u7ba1\u7406\u64cd\u4f5c\uff0c\u652f\u6301sudo\u3002</p> </li> </ul> <p>+\u652f\u6301\u4e91\u8ba1\u7b97\u3001\u5927\u6570\u636e\u5e73\u53f0\uff08\u5982AWS\u3001OpenStack\u3001CloudStack\u7b49\uff09\u3002</p> <ul> <li>Ansible\u793e\u533a\u975e\u5e38\u6d3b\u8dc3\uff0cAnsible\u672c\u8eab\u63d0\u4f9b\u7684\u6a21\u5757\u4e5f\u975e\u5e38\u4e30\u5bcc\uff0c\u7b2c\u4e09\u65b9\u8d44\u6e90\u4f17\u591a\u3002</li> </ul> <p>2015\u5e74\uff0c\u7ea2\u5e3d\u516c\u53f8\u5ba3\u5e03\u6536\u8d2dAnsible,\u5728\u4ea7\u54c1\u5c42\u9762\uff0cAnsible\u7b26\u5408Red Hat\u5e0c\u671b\u901a\u8fc7\u5f00\u653e\u5f0f\u5f00\u53d1\u63d0\u4f9b\u65e0\u969c\u788d\u8bbe\u8ba1\u548c\u6a21\u5757\u5316\u67b6\u6784\u7684\u76ee\u6807\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u3002</p> <p>Ansible\u6613\u4e8e\u4f7f\u7528\uff1a\u8fd9\u4e00\u70b9\u4ece\u4e0b\u9762\u7684\u4e24\u4e2a\u4f8b\u5b50\u5f97\u4ee5\u4f53\u73b0\u3002\u4e00\u662f\uff0cAnsible\u7684playbook\u4f7f\u7528\u7684\u662f\u4eba\u7c7b\u53ef\u8bfb\u7684YAML\u4ee3\u7801\u7f16\u5199\uff0c\u7b80\u5316\u4e86\u81ea\u52a8\u5316\u6d41\u7a0b\u7684\u7f16\u5199\u548c\u7ef4\u62a4\uff1b \u4e8c\u662f\uff0cAnsible\u4f7f\u7528\u6807\u51c6\u7684SSH\u8fde\u63a5\u6765\u6267\u884c\u81ea\u52a8\u5316\u6d41\u7a0b\uff0c\u4e0d\u9700\u8981\u4ee3\u7406\uff0c\u66f4\u5bb9\u6613\u878d\u5165\u5df2\u6709\u7684\u4f01\u4e1aIT\u73af\u5883\u3002</p> <p>Ansible\u662f\u6a21\u5757\u5316\u7684\uff1aAnsible\u63d0\u4f9b\u4e86400\u591a\u4e2a\u6a21\u5757\uff0c\u800c\u4e14\u8fd8\u5728\u4e0d\u65ad\u589e\u52a0\uff0c\u8fd9\u4e9b\u6a21\u5757\u53ef\u4ee5\u7528\u4e8e\u6269\u5c55Ansible\u7684\u529f\u80fd\u3002\u8fd9\u662fRed Hat\u5e0c\u671b\u5728\u5176\u7ba1\u7406\u7684\u4ea7\u54c1\u4e2d\u63d0\u4f9b\u7684\u4e00\u4e2a\u91cd\u8981\u7684\u529f\u80fd\u3002</p> <p>Ansible\u662f\u4e00\u4e2a\u975e\u5e38\u53d7\u6b22\u8fce\u7684\u5f00\u6e90\u9879\u76ee\uff1a\u5728GitHub\u4e0a\uff0cAnsible\u6709\u5c06\u8fd113000\u9897\u661f\u548c4000\u4e2a\u5206\u652f\u3002\u53e6\u5916\uff0c\u6839\u636eRedmonk\u7edf\u8ba1\uff0cHacker News\u63d0\u53caAnsible\u7684\u6b21\u6570\u4e5f\u5728\u98de\u901f \u589e\u957f\u3002</p> <p>\u5728\u8d44\u4ea7\u7ec4\u5408\u65b9\u9762\uff0cAnsible\u7b26\u5408Red Hat\u5e0c\u671b\u63d0\u4f9b\u591a\u5c42\u67b6\u6784\u3001\u591a\u5c42\u4e00\u81f4\u6027\u548c\u591a\u4f9b\u5e94\u5546\u652f\u6301\u7684\u76ee\u6807\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u3002</p> <p>Ansible\u652f\u6301\u591a\u5c42\u90e8\u7f72\uff1a\u6309\u7167\u8bbe\u8ba1\uff0cAnsible\u901a\u8fc7VM\u548c\u5bb9\u5668\u4e3a\u591a\u5c42\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\u548c\u914d\u7f6e\u63d0\u4f9b\u652f\u6301\u3002\u8fd9\u610f\u5473\u7740\u7ec4\u7ec7\u53ef\u4ee5\u5c06\u540c\u4e00\u5e94\u7528\u7a0b\u5e8f\u7684\u4e0d\u540c\u7ec4\u4ef6\u81ea\u52a8\u90e8\u7f72\u5230\u8fd0\u884c\u6548\u7387\u6700 \u9ad8\u7684\u5c42\u4e0a\u3002\u6bd4\u5982\uff0cAnsible\u53ef\u4ee5\u540c\u65f6\u5728VMware vSphere\u670d\u52a1\u5668\u865a\u62df\u73af\u5883\u4e2d\u7ba1\u7406VM\u548c\u5ba2\u6237\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5728OpenStack laaS\u4e91\u4e0a\u90e8\u7f72\u548c\u7ba1\u7406\u5b9e\u4f8b\uff0c\u5728OpenShift PaaS\u4e91\u4e0a\u90e8\u7f72\u5e94\u7528 \u7a0b\u5e8f\u3002</p> <p>Ansible\u4e3a\u67b6\u6784\u7684\u591a\u4e2a\u5c42\u6b21\u5e26\u6765\u4e00\u81f4\u6027\uff1a\u60dc\u52a9Ansible,\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7f16\u7a0b\u6765\u64cd\u4f5c\u8ba1\u7b97 \u67b6\u6784\u4e2d\u4ece\u57fa\u7840\u8bbe\u65bd\u5230\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u7684\u6bcf\u4e00\u5c42\u3002\u6bd4\u5982\uff0cAnsible\u53ef\u4ee5\u81ea\u52a8\u5316\u5305\u62ec\u7f51\u7edc\u3001\u5b58\u50a8\u3001OS\u3001\u4e2d\u95f4\u4ef6\u548c\u5e94\u7528\u7a0b\u5e8f\u5c42\u5728\u5185\u7684\u6240\u6709\u914d\u7f6e\u5de5\u4f5c\u3002</p> <p>Ansible\u652f\u6301\u5f02\u6784IT\u73af\u5883\uff1aAnsible\u53ef\u4ee5\u81ea\u52a8\u914d\u7f6e\u6765\u81ea\u8bb8\u591a\u4f9b\u5e94\u5546\u7684\u5404\u79cd\u6280\u672f\uff0c\u800c\u4e0d\u53ea\u662fRed Hat\u7684\u6280\u672f\u3002\u6bd4\u5982\uff0cAnsible\u65e2\u652f\u6301Linux,\u4e5f\u652f\u6301Windows;Ansible\u4f7fIT\u7ec4\u7ec7\u53ef \u4ee5\u7ba1\u7406\u5404\u79cdISV\u548cIHV\u6280\u672f\uff0c\u6bd4\u5982\u786c\u4ef6F5Big-IP\u548cCitrix NetScaler\u5230Amazon Web\u670d\u52a1\u548cGoogle\u4e91\u8ba1\u7b97\u5e73\u53f0\u3002</p> <p>\u4eceAnsible1.7\u7248\u672c\u5f00\u59cb\uff0cAnsbile\u52a0\u5165\u4e86\u652f\u6301\u7ba1\u7406Windows\u7cfb\u7edf\u7684\u6a21\u5757,\u6709\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u53c2\u8003Ansible\u5b98\u7f51\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#1yaml\u4ecb\u7ecd","title":"1.YAML\u4ecb\u7ecd","text":"<p>YAML\u662f\u4e00\u4e2a\u53ef\u8bfb\u6027\u9ad8\u7684\u7528\u4e8e\u8868\u8fbe\u8d44\u6599\u5e8f\u5217\u7684\u683c\u5f0f\u3002\u5b83\u7684\u4e3b\u8981\u7279\u70b9\u662f\u53ef\u8bfb\u6027\u597d\u3001\u8bed\u6cd5\u7b80\u5355\u660e\u4e86\u3001\u8868\u8fbe\u80fd\u529b\u5f3a\u3001\u6269\u5c55\u6027\u548c\u901a\u7528\u6027\u5f3a\u7b49\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u4e0d\u7528\u5927\u5bb6\u6240\u719f\u6089\u7684XML\u5462\uff1f\u5177\u4f53\u539f\u56e0\u5982\u4e0b\u3002</p> <ul> <li> <p>YAML\u7684\u53ef\u8bfb\u6027\u597d\u3002</p> </li> <li> <p>YAML\u548c\u811a\u672c\u8bed\u8a00\u7684\u4ea4\u4e92\u6027\u597d\u3002</p> </li> <li> <p>YAML\u4f7f\u7528\u5b9e\u73b0\u8bed\u8a00\u7684\u6570\u636e\u7c7b\u578b\u3002</p> </li> <li> <p>YAML\u6709\u4e00\u4e2a\u4e00\u81f4\u7684\u4fe1\u606f\u6a21\u578b\u3002</p> </li> <li> <p>YAML\u6613\u4e8e\u5b9e\u73b0\u3002</p> </li> </ul> <p>\u4e0a\u97625\u6761\u4e5f\u662fXML\u4e0d\u8db3\u7684\u5730\u65b9\u3002\u6b64\u5916\uff0cYAML\u4e5f\u5177\u6709XML\u6240\u5177\u6709\u7684\u4e0b\u5217\u4f18\u70b9\u3002 + YAML\u53ef\u4ee5\u57fa\u4e8e\u6d41\u6765\u5904\u7406\u3002</p> <ul> <li>YAML\u8868\u8fbe\u80fd\u529b\u5f3a\uff0c\u6269\u5c55\u6027\u597d\u3002</li> </ul> <p>\u603b\u4e4b\uff0cYAML\u8bd5\u56fe\u7528\u4e00\u79cd\u6bd4XML\u66f4\u654f\u6377\u7684\u65b9\u5f0f\uff0c\u6765\u5b8c\u6210XML\u6240\u5b8c\u6210\u7684\u4efb\u52a1\u3002\u53e6\u5916\uff0c\u5efa\u8bae\u6240\u6709\u7684YAML\u6587\u4ef6\u90fd\u4ee5\u201c-\u201d\u4f5c\u4e3a\u5f00\u59cb\u884c\uff0c\u8fd9\u662fYAML\u6587\u4ef6\u683c\u5f0f\u7684\u4e00\u90e8\u5206\uff0c\u8868\u660e\u662f\u4e00\u4e2a\u6587\u4ef6\u7684\u5f00\u59cb\u3002</p> <p>YAML\u7684\u8bed\u6cd5\u4e0e\u5176\u4ed6\u9ad8\u9636\u8bed\u8a00\u7c7b\u4f3c\uff0c\u5e76\u4e14\u53ef\u4ee5\u7b80\u5355\u5730\u8868\u8fbe\u5217\u8868\u3001\u5b57\u5178\u7b49\u6570\u636e\u7ed3\u6784\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u5b83\u8fd8\u652f\u6301\u7eaf\u91cf\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u3002</p> <ul> <li> <p>\u5b57\u5178(dictionary):\u952e\u503c\u5bf9\u7684\u96c6\u5408\uff0c\u53c8\u79f0\u4e3a\u6620\u5c04(mapping)\u3002</p> </li> <li> <p>\u5217\u8868(1ist):\u4e00\u7ec4\u6309\u6b21\u5e8f\u6392\u5217\u7684\u503c\u3002</p> </li> <li> <p>\u5e38\u91cf(scalars):\u5355\u4e2a\u7684\u3001\u4e0d\u53ef\u518d\u5206\u7684\u503c\u3002</p> </li> </ul>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#11-\u901a\u7528\u7ed3\u6784","title":"1.1 \u901a\u7528\u7ed3\u6784","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e2a\u901a\u7528\u793a\u4f8b\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>---\nname: Tome smith\nage: 37\nspouse:\nname: Jane smith\nage: 35\nchildren:\n- name: Jimmy smith\nage: 15\n- name1: Jenny smith\nage1: 12\n# YAML\u4e2d\u7684\u591a\u884c\u5b57\u7b26\u4e8b\u53ef\u4ee5\u4f7f\u7528\u201c\u201d\u4fdd\u7559\u6362\u884c\u7b26\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u201c&gt;\u201d\u6298\u53e0\u6362\u884c\uff0c\u793a\u4f8b\nthis: |\nFoo\nBar\nthat: &gt;\nFoo\nBar\n# list\u7ed3\u6784\nFruit:\n- apple\n- banana\n- orange\n- pear\n</code></pre> <p>\u4f7f\u7528python\u8bfb\u53d6yaml\u6587\u4ef6\uff0c\u4ee3\u7801\u5982\u4e0b</p> <pre><code># -*- coding:utf8 -*-\nimport yaml\nfile = open(\"test.yaml\", 'r',encoding='utf-8')\nx = yaml.load(file, Loader=yaml.FullLoader)\nprint(x)\n</code></pre> <p>\u5bf9\u5e94Python\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>{'name': 'Tome smith', 'age': 37, 'spouse': {'name': 'Jane smith', 'age': 35}, 'children': [{'name': 'Jimmy smith', 'age': 15}, {'name1': 'Jenny smith', 'age1': 12}], 'this': 'Foo\\nBar\\n', 'that': 'Foo Bar\\n', 'Fruit': ['apple', 'banana', 'orange', 'pear']}\n</code></pre> <p><code>|</code>\u548c<code>&gt;</code>\u7684\u533a\u522b\uff1a<code>|</code>\u5b83\u4fdd\u7559\u6362\u884c\u7b26\uff0c<code>&gt;</code>\u628a\u591a\u884c\u5408\u5e76\u4e3a\u4e00\u884c\u3002</p> <pre><code># \u901a\u8fc7copy\u6a21\u5757\u521b\u5efa/tmp/1.txt\uff0c\u6587\u4ef6\u4e2d\u6709\u4e24\u884c\u5185\u5bb9\uff0c\u5206\u522b\u662fHello World\u548cni hao\n[root@control ansible]# vim f1.yml\n---\n- name: play 1\nhosts: test\ntasks:\n    - name: mkfile 1.txt\n      copy:\n        dest: /tmp/1.txt\n        content: |\nHello World!\n          ni hao.\n\n[root@control ansible]# ansible-playbook f1.yml\n# \u67e5\u770b\u7ed3\u679c\n[root@node1 ~]# cat /tmp/1.txt \nHello World!\nni hao.\n\n# \u901a\u8fc7copy\u6a21\u5757\u521b\u5efa/tmp/2.txt\uff0c\u6587\u4ef6\u4e2d\u6709\u4e00\u884c\u5185\u5bb9\uff0c\u5206\u522b\u662fHello World! ni hao\n[root@control ansible]# vim f2.yml \n---\n- name: play 1\nhosts: test\ntasks:\n    - name: mkfile 2.txt\n      copy:\n        dest: /tmp/2.txt\n        content: &gt;\n          Hello World!\n          ni hao.\n\n[root@control ansible]# ansible-playbook f2.yml\n[root@node1 ~]# cat /tmp/2.txt \nHello World! ni hao.\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#12-\u5b57\u5178\u7ed3\u6784","title":"1.2 \u5b57\u5178\u7ed3\u6784","text":"<pre><code>node_a:\nconntimeout:300\nexternal:\niface: eth0\nport: 556\ninternal:\niface: eth0\nport: 778\nbroadcast:\nclient: 1000\nserver: 2000\nnode_b:\n0:\nip: 10.0.0.1\nname: bl\n1:\nip: 10.0.0.2\nname: b2\n</code></pre> <p>\u5bf9\u5e94Python\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>{'node_a': 'conntimeout:300', 'external': {'iface': 'eth0', 'port': 556}, 'internal': {'iface': 'eth0', 'port': 778}, 'broadcast': {'client': 1000, 'server': 2000}, 'node_b': {0: {'ip': '10.0.0.1', 'name': 'bl'}, 1: {'ip': '10.0.0.2', 'name': 'b2'}}}\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#13-\u5217\u8868\u548c\u5b57\u5178\u6df7\u7528","title":"1.3 \u5217\u8868\u548c\u5b57\u5178\u6df7\u7528","text":"<pre><code>#\u4e00\u4f4d\u804c\u5de5\u8bb0\u5f55\nname: Example Developer\njob: Developer\nskill: Elite\nemployed: True\nfoods:\n- Apple\n- Orange\n- Strawberry\n- Mango\nlanguages:\nPython: edite\nJava: edite\nC++: edite\n</code></pre> <p>\u4f7f\u7528python\u4ee3\u7801\u8bfb\u53d6\u6587\u4ef6</p> <pre><code># -*- coding:utf8 -*-\nimport yaml\nwith open(\"list_dict.yaml\", 'r', encoding='utf-8') as file:\nx = yaml.safe_load(file)\nprint(x)\n</code></pre> <p>\u5bf9\u5e94Python\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>{'name': 'Example Developer', 'job': 'Developer', 'skill': 'Elite', 'employed': True, 'foods': ['Apple', 'Orange', 'Strawberry', 'Mango'], 'languages': {'Python': 'edite', 'Java': 'edite', 'C++': 'Lame'}}\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#14-\u591a\u79cd\u5e38\u91cf\u7ed3\u6784\u4f7f\u7528","title":"1.4 \u591a\u79cd\u5e38\u91cf\u7ed3\u6784\u4f7f\u7528","text":"<pre><code>boolean:\n- TRUE    # true,TRUE\u90fd\u53ef\u4ee5\n- FALSE   #false,False\u90fd\u53ef\u4ee5\nfloat:\n- 3.14\n- 6.8523015e+5   #\u53ef\u4ee5\u4f7f\u7528\u79d1\u5b66\u8ba1\u6570\u6cd5\nint:\n- 123\n- 0b10100111010010101110   #\u4e8c\u8fdb\u5236\u8868\u793a\nnu11:\nnodeName: 'node'\nparent: ~  #\u4f7f\u7528\u201c~\u201d\u8868\u793anul1\nstring:\n- 'hello,yhc'\n- 'He11owor1d'      #\u53ef\u4ee5\u4f7f\u7528\u53cc\u5f15\u53f7\u6216\u8005\u5355\u5f15\u53f7\u5305\u88f9\u7279\u6b8a\u5b57\u7b26\n- newline\nnewline2        #\u5b57\u7b26\u4e32\u53ef\u4ee5\u62c6\u6210\u591a\u884c\uff0c\u6bcf\u4e00\u884c\u90fd\u4f1a\u88ab\u8f6c\u5316\u6210\u4e00\u4e2a\u7a7a\u683c\ndate:\n- 2018-02-17        #\u65e5\u671f\u5fc5\u987b\u4f7f\u7528IS08601\u683c\u5f0f\uff0c\u5373yyyy-MM-dd\ndatetime:\n- 2018-02-17T15:02:31+08:00 # \u65f6\u95f4\u4f7f\u7528IS08601\u683c\u5f0f\uff0c\u65f6\u95f4\u548c\u65e5\u671f\u4e4b\u95f4\u4f7f\u7528T\u8fde\u63a5\uff0c\u6700\u540e\u4f7f\u7528\u201c+\u201d\u4ee3\u8868\u65f6\u533a\n</code></pre> <p>\u5bf9\u5e94Python\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>{'boolean': [True, False], 'float': [3.14, 685230.15], 'int': [123, 685230], 'nu11': {'nodeName': 'node', 'parent': None}, 'string': ['hello,yhc', 'He11owor1d', 'newline newline2'], 'date': [datetime.date(2018, 2, 17)], 'datetime': [datetime.datetime(2018, 2, 17, 15, 2, 31, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800)))]}\n</code></pre> <p>\u5217\u4e3e\u4e86\u8fd9\u4e48\u591a\u4f8b\u5b50\uff0c\u6700\u540e\u6211\u4eec\u5728\u6b64\u603b\u7ed3\u4e00\u4e0bYAML\u7684\u57fa\u672c\u8bed\u6cd5\u89c4\u5219\uff0c\u5927\u5bb6\u5728\u5de5\u4f5c\u4e2d\u8bf7\u8bb0\u5f97\u9075\u5faa\uff0c\u8bed\u6cd5\u89c4\u5219\u5177\u4f53\u5982\u4e0b\u6240\u793a\u3002</p> <ul> <li> <p>YAML\u6587\u4ef6\u5bf9\u5927\u5c0f\u5199\u654f\u611f\u3002</p> </li> <li> <p>\u4f7f\u7528\u7f29\u8fdb\u4ee3\u8868\u5c42\u7ea7\u5173\u7cfb\u3002</p> </li> <li> <p>\u7f29\u8fdb\u53ea\u80fd\u4f7f\u7528\u7a7a\u683c\uff0c\u4e0d\u80fd\u4f7f\u7528TAB,\u7a7a\u683c\u4e2a\u6570\u4e0d\u4f5c\u8981\u6c42\uff0c\u53ea\u9700\u8981\u76f8\u540c\u5c42\u7ea7\u5de6\u5bf9\u9f50(\u4e00\u822c\u4e3a2\u4e2a\u62164\u4e2a\u7a7a\u683c)\u5373\u53ef\u3002</p> </li> <li> <p>YAML\u6587\u4ef6\u662f\u4ee5\u201c#\u201d\u4f5c\u4e3a\u6ce8\u91ca\uff0cYAML\u4e2d\u53ea\u6709\u884c\u6ce8\u91ca\u3002</p> </li> </ul> <p>\u53c2\u8003\u6587\u6863</p> <p>YAML \u8bed\u6cd5</p> <p>Playbooks \u91c7\u7528YMAL \u8bed\u6cd5\u7ed3\u6784\uff0c\u57fa\u672c\u7684YMAL \u8bed\u6cd5\u8bf7\u53c2\u8003</p> <p>python\u5229\u7528pyyaml\u6a21\u5757\u8fdb\u884c\u89e3\u6790yaml\u8bed\u8a00</p> <p>yaml\u683c\u5f0f\u5728\u7ebf\u68c0\u67e5</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#2ansible\u7684\u5b89\u88c5\u548c\u914d\u7f6e","title":"2.Ansible\u7684\u5b89\u88c5\u548c\u914d\u7f6e","text":"ubuntupippython3 <pre><code>$ sudo apt update\n$ sudo apt install software-properties-common\n$ sudo apt-add-repository --yes --update ppa:ansible/ansible\n$ sudo apt install ansible\n</code></pre> <pre><code>curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py\npython get-pip.py\npip install ansible==2.12.10 -i https://mirrors.ustc.edu.cn/pypi/web/simple\n\n# \u901a\u8fc7\u6b64\u65b9\u5f0f\u5b89\u88c5\u7684\u6ca1\u6709\u751f\u6210/etc/ansible\u6587\u4ef6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\uff0c\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5230https://github.com/ansible/ansible/tree/devel/examples\n</code></pre> <pre><code>yum install -y python36 python36-tools\ncurl https://bootstrap.pypa.io/get-pip.py -o get-pip.py\npython3.6 get-pip.py pip3.6 install ansible==2.12.10 -i https://mirrors.ustc.edu.cn/pypi/web/simple\n# \u901a\u8fc7\u6b64\u65b9\u5f0f\u5b89\u88c5\u7684\u6ca1\u6709\u751f\u6210/etc/ansible\u6587\u4ef6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\uff0c\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5230https://github.com/ansible/ansible/tree/devel/examples\n</code></pre> <p>Ansible\u7684\u5b89\u88c5\u8fc7\u7a0b\u975e\u5e38\u7b80\u4fbf\uff0c\u5b89\u88c5\u6b65\u9aa4\u5177\u4f53\u5982\u4e0b\u3002</p> <ol> <li>\u8fd9\u91cc\u91c7\u7528\u7684\u662fpip\u5b89\u88c5\u65b9\u5f0f\uff0c\u5efa\u8bae\u5e26\u4e0aAnsible\u7248\u672c\u53f7\uff0c\u56e0\u4e3aAnsible2.x\u7684API\u8bed\u6cd5\u4e0eAnsible1.9\u7684API\u8bed\u6cd5\u5dee\u522b\u5f88\u5927\uff08\u6211\u4eec\u5185\u5bb9\u4e3b\u8981\u57fa\u4e8eAnsible1.9.6),\u547d\u4ee4\u5982\u4e0b\u793a\uff1a</li> </ol> <pre><code>pip install ansible==2.12.10 -i https://mirrors.ustc.edu.cn/pypi/web/simple\n</code></pre> <ol> <li>\u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u67e5\u770b\u7248\u672c</li> </ol> <pre><code>ansible --version\nansible [core 2.12.9]\nconfig file = /etc/ansible/ansible.cfg\n  configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']\nansible python module location = /usr/local/lib/python3.8/dist-packages/ansible\n  ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections\n  executable location = /usr/local/bin/ansible\n  python version = 3.8.10 (default, Nov 14 2022, 12:59:47) [GCC 9.4.0]\njinja version = 3.1.2\n  libyaml = True\n</code></pre> <ol> <li>Ansible\u914d\u7f6e\u6587\u4ef6ansible.cfg\u53ef\u4ee5\u5b58\u50a8\u4e8e\u7cfb\u7edf\u4e2d\u7684\u4e0d\u540c\u4f4d\u7f6e\uff0c\u4f46\u53ea\u6709\u4e00\u4e2a\u53ef\u7528\u3002</li> </ol> <p>\u5728\u4e0b\u5217\u5217\u8868\u4e2d\uff0cAnsible\u4f1a\u4ece\u4e0a\u5f80\u4e0b\u4f9d\u6b21\u68c0\u67e5\uff0c\u68c0\u67e5\u5230\u54ea\u4e2a\u53ef\u7528\u5c31\u7528\u54ea\u4e2a\u3002</p> <ul> <li> <p>ANSIBLE CFG\u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\u3002</p> </li> <li> <p>ansible.cfg\u5b58\u50a8\u4e8e\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u3002</p> </li> <li> <p>ansible.cfg\u5b58\u50a8\u4e8e\u5f53\u524d\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u3002</p> </li> <li> <p>\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e\uff1a/etc/ansible/ansible.cfg\u3002</p> </li> </ul> <p>Ansible\u914d\u7f6e\u6587\u4ef6\u9ed8\u8ba4\u5b58\u50a8\u4e8e/etc/ansible/ansible.cfg,hosts\u6587\u4ef6\u9ed8\u8ba4\u5b58\u50a8\u4e8e/etc/ansible/hosts,\u5728\u8fd9\u91cc\u6211\u4eec\u91c7\u7528\u9ed8\u8ba4\u503c\u3002</p> <p>\u5982\u4e0b\u4e3aAnsible.cfg\u5e38\u7528\u53c2\u6570\u8be6\u89e3</p> \u914d\u7f6e\u9879 \u63cf\u8ff0 inventory      = /etc/ansible/hosts \u6307\u5b9aAnsible\u7684\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u8def\u5f84\u3002 remote_user \u8fdc\u7a0b\u8fde\u63a5\u7684\u7528\u6237\u540d\u3002 private_key_file \u8fdc\u7a0b\u8fde\u63a5\u7684\u79c1\u94a5\u6587\u4ef6\u8def\u5f84\u3002 become \u662f\u5426\u5207\u6362\u5230\u7279\u6743\u7528\u6237\u8fdb\u884c\u64cd\u4f5c\u3002 become_user \u5207\u6362\u5230\u7684\u7279\u6743\u7528\u6237\u3002 become_method \u5207\u6362\u7279\u6743\u7528\u6237\u7684\u65b9\u6cd5\u3002 gather_facts \u662f\u5426\u6536\u96c6\u4e3b\u673a\u4fe1\u606f\u3002 fact_caching \u662f\u5426\u7f13\u5b58\u6536\u96c6\u5230\u7684\u4e3b\u673a\u4fe1\u606f\u3002 fact_caching_connection \u7528\u4e8e\u4e3b\u673a\u4fe1\u606f\u7f13\u5b58\u7684\u8fde\u63a5\u4fe1\u606f\u3002 roles_path \u89d2\u8272\u76ee\u5f55\u7684\u641c\u7d22\u8def\u5f84\u3002 host_key_checking=False \u662f\u5426\u68c0\u67e5\u4e3b\u673a\u5bc6\u94a5\u3002 log_path \u65e5\u5fd7\u6587\u4ef6\u8def\u5f84\u3002 forks=5 \u5e76\u53d1\u6267\u884c\u4efb\u52a1\u7684\u6570\u91cf\u3002 max_fail_percentage \u6700\u5927\u5931\u8d25\u767e\u5206\u6bd4\uff0c\u8d85\u8fc7\u5219\u505c\u6b62\u6267\u884c\u3002 timeout=10 \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002 module_lang=C \u9ed8\u8ba4\u6a21\u5757\u4e4b\u95f4\u7684\u8ba1\u7b97\u673a\u8bed\u8a00,\u9ed8\u8ba4C\u8bed\u8a00 ssh_args SSH\u53c2\u6570\u3002 log_path = ~/ansible.log Ansible\u65e5\u5fd7\u5b58\u653e\u5177\u4f53\u8def\u5f84 scp_if_ssh \u5982\u679cSSH\u53ef\u7528\uff0c\u5219\u4f7f\u7528SCP\u4f20\u8f93\u6587\u4ef6\u3002 control_path SSH\u63a7\u5236\u5957\u63a5\u5b57\u8def\u5f84\u3002 allow_world_readable_tmp \u662f\u5426\u5141\u8bb8\u4e34\u65f6\u6587\u4ef6\u53ef\u7531\u5176\u4ed6\u7528\u6237\u8bfb\u53d6\u3002 roles \u5b9a\u4e49\u8981\u5728\u4e3b\u673a\u4e0a\u6267\u884c\u7684\u89d2\u8272\u5217\u8868\u3002 tasks \u5b9a\u4e49\u8981\u5728\u4e3b\u673a\u4e0a\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\u3002 handlers \u5b9a\u4e49\u5904\u7406\u7a0b\u5e8f\u4efb\u52a1\u5217\u8868\uff0c\u53ef\u4ee5\u5728\u89e6\u53d1\u7279\u5b9a\u4e8b\u4ef6\u65f6\u8c03\u7528\u8fd9\u4e9b\u5904\u7406\u7a0b\u5e8f\u3002 vars \u5b9a\u4e49\u53d8\u91cf\u548c\u503c\u7684\u952e\u503c\u5bf9\uff0c\u53ef\u4ee5\u5728\u5267\u672c\u4e2d\u5f15\u7528\u8fd9\u4e9b\u53d8\u91cf\u3002 environment \u6307\u5b9a\u73af\u5883\u53d8\u91cf\u7684\u952e\u503c\u5bf9\u3002 pre_tasks \u5728\u89d2\u8272\u6216\u4efb\u52a1\u4e4b\u524d\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\u3002 post_tasks \u5728\u89d2\u8272\u6216\u4efb\u52a1\u4e4b\u540e\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\u3002 any_errors_fatal \u5982\u679c\u4efb\u4f55\u4efb\u52a1\u9519\u8bef\uff0c\u5219\u8bbe\u7f6e\u6240\u6709\u4efb\u52a1\u90fd\u5931\u8d25\u3002 ignore_errors \u5982\u679c\u4efb\u52a1\u5931\u8d25\uff0c\u5219\u5ffd\u7565\u9519\u8bef\u5e76\u7ee7\u7eed\u6267\u884c\u3002 max_parallel \u5e76\u884c\u6267\u884c\u4efb\u52a1\u7684\u6700\u5927\u6570\u91cf\u3002 serial \u4e00\u6b21\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u6267\u884c\u7684\u6279\u5904\u7406\u6570\u91cf\u3002 strategy \u5141\u8bb8\u60a8\u9009\u62e9\u6267\u884c\u7b56\u7565\uff08linear\u3001free\u3001mitogen\u7b49\uff09\u3002\u89c1\u5b98\u65b9\u6587\u6863\u4ee5\u83b7\u53d6\u5176\u4ed6\u53ef\u7528\u9009\u9879\u3002 tags \u6807\u8bb0\u5c06\u5141\u8bb8\u60a8\u9009\u62e9\u8981\u8fd0\u884c\u7684\u7279\u5b9a\u4efb\u52a1\u6216\u89d2\u8272\u3002 skip_tags \u5982\u679c\u6807\u8bb0\u5339\u914d\uff0c\u5219\u8df3\u8fc7\u8fd0\u884c\u7279\u5b9a\u4efb\u52a1\u6216\u89d2\u8272\u3002 check_mode \u662f\u5426\u4ee5\u68c0\u67e5\u6a21\u5f0f\u8fd0\u884c\u5267\u672c\uff0c\u4e0d\u4f1a\u5bf9\u4e3b\u673a\u6267\u884c\u4efb\u4f55\u66f4\u6539\u3002\u53ea\u62a5\u544a\u5c06\u505a\u51fa\u4ec0\u4e48\u66f4\u6539\u800c\u4e0d\u5b9e\u9645\u6267\u884c\u5b83\u4eec\u3002 gather_subset \u9009\u62e9\u8981\u6536\u96c6\u7684\u7279\u5b9a\u5b50\u96c6\uff0c\u5982<code>hardware</code>\u3001<code>network</code>\u3001<code>virtual</code>\u7b49\u3002 diff_mode \u662f\u5426\u542f\u7528\u5dee\u5f02\u6a21\u5f0f\uff0c\u663e\u793a\u66f4\u6539\u7684\u6587\u4ef6\u5185\u5bb9\u3002\u914d\u5408\u4f7f\u7528<code>register</code>\u6a21\u5757\u6765\u6536\u96c6\u66f4\u6539\u7684\u6587\u4ef6\u5217\u8868\u3002"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#21-ansible\u7684\u5e38\u7528\u8bbe\u7f6e","title":"2.1 Ansible\u7684\u5e38\u7528\u8bbe\u7f6e","text":"<pre><code># /etc/ansible/ansible.cfg\n\n[defaults]\n# Set the log_path\nlog_path = ~/ansible.log\n\n# Additional default options for Ansible\nforks = 20\nhost_key_checking = False\nretry_files_enabled = False\nretry_files_save_path = ~/ansible-installer-retries\nnocows = True\nremote_user = root\nroles_path = roles/\ngathering = smart\nfact_caching = jsonfile\nfact_caching_connection = $HOME/ansible/facts\nfact_caching_timeout = 600\ncallback_whitelist = profile_tasks\ninventory_ignore_extensions = secrets.py, .pyc, .cfg, .crt, .ini\n# work around privilege escalation timeouts in ansible:\ntimeout = 30\nhost_key_checking = False\n\n# Uncomment to use the provided example inventory\n#inventory = inventory/hosts.example\n\nansible_managed = Ansible managed: {file} modified by {uid} on {host}\n\n[inventory]\n# fail more helpfully when the inventory file does not parse (Ansible 2.4+)\nunparsed_is_failed=true\n\n# Additional ssh options for OpenShift Ansible\n[ssh_connection]\nretries = 15\npipelining = True\nssh_args = -o ControlMaster=auto -o ControlPersist=600s\ntimeout = 10\n# shorten the ControlPath which is often too long; when it is,\n# ssh connection reuse silently fails, making everything slower.\ncontrol_path = %(directory)s/%%h-%%r\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#22-\u8bbe\u7f6e\u514d\u5bc6\u767b\u5f55","title":"2.2 \u8bbe\u7f6e\u514d\u5bc6\u767b\u5f55","text":"<p>\u4f7f\u7528 ssh \u79d8\u94a5\u8fde\u63a5\u4e3b\u673a</p> <pre><code>echo 'PubkeyAuthentication yes' &gt;&gt; /etc/ssh/sshd_config\nsystemctl restart sshd\n</code></pre> <p>\u914d\u7f6e\u8fdc\u7a0b\u4e3b\u673a\u79d8\u94a5 <pre><code>#\u751f\u6210SSH\u79d8\u94a5\u7684\u8fde\u63a5\n# \u5728\u4e3b\u63a7\u7aef\u4e3b\u673a\uff08SN2013-08-020\uff09\u521b\u5efa\u5bc6\u94a5\uff0c\u6267\u884c\uff1assh-keygen-t\n# rsa\uff0c\u6709\u8be2\u95ee\u76f4\u63a5\u6309\u56de\u8f66\u952e\u5373\u53ef\uff0c\u5c06\u5728/root/.ssh/\u4e0b\u751f\u6210\u4e00\u5bf9\u5bc6\u94a5\uff0c\u5176\u4e2d\n# id_rsa\u4e3a\u79c1\u94a5\uff0cid_rsa.pub\u4e3a\u516c\u94a5\uff08\u9700\u8981\u4e0b\u53d1\u5230\u88ab\u63a7\u4e3b\u673a\u7528\u6237.ssh\u76ee\u5f55\uff0c\u540c\u65f6\u8981\u6c42\u91cd\u547d\u540d\u6210authorized_keys\u6587\u4ef6\uff09\n# ssh-keygen -t rsa\n# ssh-copy-id root@&lt;client_ip&gt; -p 22\n# \u6216\u8005\u5982\u4e0b\n# ssh-keygen -t rsa -P '' -b 4096 -f ~/.ssh/id_rsa\n# \u6216\u8005\u751f\u6210\u81ea\u5b9a\u4e49\u7684rsa key\u8ba4\u8bc1\nssh-keygen  -N \"\" -b 4096 -t rsa -C \"stanley@magedu.com\" -f /root/.ssh/stanley.rsa\n\n# \u4e3a\u672c\u673a\u6dfb\u52a0\u5bc6\u94a5\u8ba4\u8bc1\nssh-copy-id \u2013i /root/.ssh/stanley.rsa root@localhost\nssh-copy-id \u2013i /root/.ssh/stanley.rsa root@192.xx.xx.100\n</code></pre></p> <p>Ansible Role: ssh keys</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#23-\u914d\u7f6e\u4e3b\u673a\u6e05\u5355","title":"2.3 \u914d\u7f6e\u4e3b\u673a\u6e05\u5355","text":"<p>\u793a\u4f8b</p> <pre><code>[k8s_cluster_work]\n172.18.0.1\n172.18.0.2\n172.18.0.3\n172.18.0.4\n172.18.0.5\n\n[k8s_cluster_master]\n172.18.0.1\n172.18.0.2\n172.18.0.3\n\n[k8s_cluster:children]\nk8s_cluster_work\nk8s_cluster_master\n\n[k8s_cluster:vars]\nansible_ssh_user=root\n\n[app]\n172.18.0.15\n172.18.0.13\n172.18.0.12\n172.18.0.14\n\n[russia:children]\nk8s_cluster\ngitaly\n\n[russia:vars]\nansible_ssh_user=root\nansible_ssh_pass='xxxx'\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#24-\u6267\u884cansible\u547d\u4ee4","title":"2.4 \u6267\u884cansible\u547d\u4ee4","text":"<pre><code># \u6d4b\u8bd5\u8fde\u63a5\u72b6\u6001\nansible 192.168.77.135 -m ping\n\n# \u5b89\u88c5Nginx\nansible 192.168.77.135 -m yum -a 'name=nginx'\n# \u542f\u52a8Nginx\nansible 192.168.77.135 -m yum -a 'name=nginx'\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#3\u5b9a\u4e49\u4e3b\u673a\u4e0e\u7ec4\u89c4\u5219inventory","title":"3.\u5b9a\u4e49\u4e3b\u673a\u4e0e\u7ec4\u89c4\u5219(Inventory)","text":"<p>Ansible\u901a\u8fc7\u5b9a\u4e49\u597d\u7684\u4e3b\u673a\u4e0e\u7ec4\u89c4\u5219\uff08Inventory\u6587\u4ef6)\u6307\u5b9a\u4e86Ansible\u4f5c\u7528\u7684\u4e3b\u673a\u5217\u8868\uff0c</p> <p>Ansible\u9ed8\u8ba4\u8bfb\u53d6/etc/ansible/hosts\u6587\u4ef6\u3002</p> <p>\u5f53\u7136\uff0c\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u901a\u8fc7ANSIBLE_HOSTS\u73af\u5883\u53d8\u91cf\u6765\u6307\u5b9a\uff0c\u6216\u8005\u5728\u8fd0\u884cansible-hoc\u53caansible-playbook\u65f6\u7528\u201c-i\u201d\u53c2\u6570\u6307\u5b9a\u4e34\u65f6\u4e3b\u673a\u5217\u8868\u6587\u4ef6\u3002</p> <p>\u4e0b\u9762\u662fInventory\u6587\u4ef6\u7684\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <p><pre><code>mail.example.com\n\n[webservers]\nfoo.example.com\nbar.example.com\n\n[dbservers]\none.example.com\ntwo.example.com\nThree.example.com\n</code></pre> \u5176\u4e2d\uff0c\u4e2d\u62ec\u53f7\u5185\u7684\u662f\u7ec4\u540d\u79f0\uff0c\u4e00\u53f0\u4e3b\u673a\u53ef\u4ee5\u5c5e\u4e8e\u591a\u4e2a\u7ec4\u3002 \u4e00\u53f0\u5c5e\u4e8e\u591a\u4e2a\u7ec4\u7684\u4e3b\u673a\u4f1a\u8bfb\u53d6\u591a\u4e2a\u7ec4\u7684\u53d8\u91cf\u6587\u4ef6\uff0c\u8fd9\u6837\u53ef\u80fd\u5c31\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u5de5\u4f5c\u4e2d\u5c3d\u91cf\u907f\u514d\u8fd9\u6837\u7684\u5199\u6cd5\u3002</p> <p>\u5b9a\u4e49\u597dInventory\u6587\u4ef6\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u9a8c\u8bc1\u4e3b\u673a\u5217\u8868\u5185\u5bb9\u4e86\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <p><pre><code>ansible webservers --list-hosts\n</code></pre> \u6216\u8005\uff1a</p> <pre><code>ansible dbserver --ilst-hosts\n</code></pre> <p>\u6709\u4e00\u4e2a\u4e3b\u673a\u4f1a\u88abAnsible\u9ed8\u8ba4\u81ea\u52a8\u6dfb\u52a0\u5230Inventory\u4e2d\uff0c\u90a3\u5c31\u662flocalhost\u3002 Ansible\u4ee5\u4e3alocalhost\u5c31\u4ee3\u8868\u672c\u5730\u4e3b\u673a\uff0c\u6240\u4ee5\u5728\u9700\u8981\u5b83\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u5728\u672c\u673a\u6267\u884c\u800c\u4e0d\u662f\u901a\u8fc7SSH\u8fde\u63a5\u3002</p> <p>\u5982\u679cSSH\u91c7\u7528\u7684\u4e0d\u662f\u9ed8\u8ba4\u768422\u7aef\u53e3\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728\u4e3b\u673a\u540e\u9762\u6307\u5b9aSSH\u7aef\u53e3\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a <pre><code>badwolf.example.com:5309\n</code></pre></p> <p>\u4f7f\u7528\u9759\u6001IP\u65f6\uff0c\u5982\u679c\u6211\u4eec\u5e0c\u671b\u5728hosts\u6587\u4ef6\u4e2d\u4f7f\u7528\u522b\u540d\u6216\u901a\u8fc7\u901a\u9053\u8fdb\u884c\u8fde\u63a5\uff0c\u5219\u53ef\u4ee5\u91c7\u7528\u7c7b\u4f3c\u5982\u4e0b\u7684\u65b9\u5f0f\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a <pre><code>jumper ansible_ssh_port=5555 ansible_ssh_host=192.168.1.50\n</code></pre></p> <p>\u5982\u679c\u6709\u5f88\u591a\u7c7b\u4f3c\u7684\u4e3b\u673a\u540d\u79f0\uff0c\u5219\u5728\u6ca1\u5fc5\u8981\u65f6\u4e0d\u7528\u4e00\u4e00\u5217\u51fa\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a <pre><code>[webservers]\nwww[01:50].example.com\ndb-[a:f].example.com\n</code></pre></p> <p>\u5176\u4e2d\uff0c\u6570\u5b57\u5f00\u5934\u76840\u53ef\u4ee5\u7701\u7565\uff0c\u4e2d\u62ec\u53f7\u662f\u95ed\u5408\u7684\u3002</p> <p>\u4e5f\u53ef\u4ee5\u6307\u5b9a\u6bcf\u4e2a\u4e3b\u673a\u7684\u8fde\u63a5\u7c7b\u578b\u548c\u7528\u6237\u540d\uff1a <pre><code>[targets]\nlocalhost ansible_connection=local\notherl.example.com ansible_connection=ssh ansible_ssh user=mpdehaan\nother2.example.com ansible_connection=ssh ansible_ssh user=mdehaan\n</code></pre></p> <p>\u5982\u4e0a\u8ff0\u4ee3\u7801\u6240\u793a\uff0c\u76f4\u63a5\u5728Inventory\u6587\u4ef6\u4e2d\u6dfb\u52a0\u53c2\u6570\u7684\u65b9\u5f0f\u5e76\u4e0d\u662f\u4e00\u4e2a\u597d\u7684\u9009\u62e9\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecd\u66f4\u597d\u7684\u65b9\u6cd5\uff0c\u90a3\u5c31\u662f\u5728\u5355\u72ec\u7684host_vars\u76ee\u5f55\u4e2d\u5b9a\u4e49\u53c2\u6570\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#31-\u5b9a\u4e49\u4e3b\u673a\u53d8\u91cf","title":"3.1 \u5b9a\u4e49\u4e3b\u673a\u53d8\u91cf","text":"<p>\u4e3b\u673a\u53ef\u4ee5\u6307\u5b9a\u53d8\u91cf\uff0c\u4ee5\u4fbf\u540e\u7eed\u4f9bplaybooks\u914d\u7f6e\u4f7f\u7528\uff0c\u4f8b\u5982\u4e0b\u9762\u7684\u4ee3\u7801\u5b9a\u4e49\u4e86\u4e3b\u673ahost1\u548chost2\u4e0a\u9762Apache\u7684\u53c2\u6570http_port\u53camaxRequestsPerChild:</p> <pre><code>[atlanta]\nhost1 http_port=80 maxRequestsPerchild=808\nhost2 http_port=303 maxRequestsPerchild=909\n\n#\u5982\u679c\u4e0d\u914d\u7f6eSSH\u79d8\u94a5\u8ba4\u8bc1\uff0c\u53ef\u4ee5\u8fd9\u6837\u5bf9\u7ba1\u7406\u4e3b\u673a\u8fdb\u884c\u8ba4\u8bc1\n; vim /etc/ansible/hosts\n[wbservers]\n192.168.1.110 ansible_ssh_user=root ansible_ssh_pass=123.com\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#32-\u5b9a\u4e49\u7ec4\u53d8\u91cf","title":"3.2 \u5b9a\u4e49\u7ec4\u53d8\u91cf","text":"<p>\u7ec4\u53d8\u91cf\u7684\u4f5c\u7528\u662f\u8986\u76d6\u7ec4\u4e2d\u7684\u6240\u6709\u6210\u5458\uff0c\u4e0b\u9762\u5b9a\u4e49\u4e00\u4e2a\u65b0\u5757\uff0c\u5757\u540d\u7531\u7ec4\u540d+\"\uff1avas\"\u7ec4\u6210\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a <pre><code>[atlanta]\nhost1\nhost2\n\n[atlanta:vars]\nntp server=ntp.atlanta.example.com\nproxy=proxy.atlanta.example.com\n</code></pre></p> <p>\u7ec4\u7684\u7ec4\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u7ec4\u5d4c\u5957\u3002</p> <p>\u7ec4\u5d4c\u5957\u662f\u5b9a\u4e49\u4e00\u4e2a\u65b0\u5757\uff0c\u5757\u540d\u7531\u7ec4\u540d+\"\uff1achildren\"\u7ec4\u6210\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>[atlanta]\nhostl\nhost2\n\n[raleigh]\nhost2\nhost3\n\n[southeast:children]\natlanta\nraleigh\n\n[usa:children]\nsoutheast\nnortheast\nsouthwest\nNorthwest\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#33-\u5206\u79bb\u4e3b\u673a\u548c\u7ec4\u53d8\u91cf","title":"3.3 \u5206\u79bb\u4e3b\u673a\u548c\u7ec4\u53d8\u91cf","text":"<p>\u5728ansible\u4e2d\u66f4\u597d\u7684\u5b9e\u8df5\u5e76\u4e0d\u662f\u628a\u53d8\u91cf\u653e\u5230Inventory\u6587\u4ef6\u4e2d\uff0c\u800c\u662f\u4f7f\u7528YAML\u683c\u5f0f\u4fdd\u5b58\u5230\u5355\u72ec\u7684\u6587\u4ef6\u4e2d\uff0c\u4e0d\u8981\u4e0eInventory\u653e\u7f6e\u5230\u4e00\u8d77\u3002</p> <p>\u5047\u8bbeInventory\u6587\u4ef6\u7684\u8def\u5f84\u4e3a/etc/ansible/hosts,\u5176\u4e2d\u6709\u4e2a\u4e3b\u673a\u540d\u4e3afoosbal,\u5c5e\u4e8eraleigh\u548cwebservers\u4e24\u4e2a\u7ec4\uff0c\u90a3\u4e48\u4ee5\u4e0b\u4f4d\u7f6e\u7684YAML\u6587\u4ef6\u4f1a\u5bf9foosball\u4e3b\u673a\u6709\u6548\uff1a</p> <pre><code>/etc/ansible/group_vars/raleigh\n/etc/ansible/group_vars/webservers\n/etc/ansible/host_vars/foosball\n</code></pre> <p>\u4f8b\u5982\uff0c/etc/ansible/group_.vars/raleigh\u6587\u4ef6\u770b\u8d77\u6765\u53ef\u80fd\u7c7b\u4f3c\u4e8e\u4e0b\u9762\u8fd9\u6837\uff1a</p> <pre><code>ntp server:acme.example.org\ndatabase server:storage.example.org\n</code></pre> <p>\u4e8b\u5b9e\u4e0a\uff0c\u4e0a\u9762\u6d89\u53ca\u7684\u5185\u5bb9\u5168\u90e8\u5c5e\u4e8e\u9759\u6001Inventory\u7684\u8303\u7574\u3002</p> <p>\u5728\u5b9e\u9645\u8fd0\u7ef4\u81ea\u52a8\u5316\u7684\u5de5\u4f5c\u4e2d\uff0c\u52a8\u6001Inventory\u6587\u4ef6\u5e94\u7528\u5f97\u66f4\u591a\uff0c\u4e3b\u8981\u7528\u4e8e\u8981\u7f16\u5199Python\u811a\u672c\uff08\u4e0d\u4e00\u5b9a\u5c40\u9650\u4e8ePython \u8bed\u8a00\uff0c\u4f46\u63a8\u8350\u91c7\u7528Python),\u4ee5\u4fbf\u4ece\u516c\u53f8\u7684CMDB(\u8d44\u4ea7\u7ba1\u7406)\u7cfb\u7edf\u63d0\u4f9b\u7684API\u62c9\u53d6\u6240\u6709\u7684\u4e3b\u673a\u4fe1\u606f\uff0c\u7136\u540e\u518d\u4f7f\u7528Ansible\u6765\u8fdb\u884c\u7ba1\u7406\uff0c\u8fd9\u6837\u5c31\u80fd\u5f88\u65b9\u4fbf\u5730\u5c06Ansible\u4e0e\u5176\u4ed6\u8fd0\u7ef4\u7cfb\u7edf \u7ed3\u5408\u8d77\u6765\u4f7f\u7528\u4e86\u3002</p> <p>\u53c2\u8003\u6587\u732e</p> <p>\u4f7f\u7528\u52a8\u6001\u4e3b\u673a</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#4ansible\u5e38\u7528\u6a21\u5757\u4ecb\u7ecd","title":"4.Ansible\u5e38\u7528\u6a21\u5757\u4ecb\u7ecd","text":"<p>Ansible\u5e38\u7528\u6a21\u5757\u6709\u5f88\u591a\uff0c\u5305\u62ec\u4e91\u8ba1\u7b97\u3001\u547d\u4ee4\u884c\u3001\u5305\u7ba1\u7406\u3001\u7cfb\u7edf\u670d\u52a1\u3001\u7528\u6237\u7ba1\u7406\u7b49\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9\u7f51\u7ad9 \u67e5\u770b\u76f8\u5e94\u7684\u6a21\u5757\uff0c\u4e5f\u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u4e0b\u901a\u8fc7<code>ansible--doc -l</code>\u547d\u4ee4\u67e5\u770b\u6a21\u5757\uff0c\u6216\u8005\u901a\u8fc7<code>ansible-doc -s</code>\u6a21\u5757\u540d\u67e5\u770b\u5177 \u4f53\u67d0\u4e2a\u6a21\u5757\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p> <p>\u793a\u4f8b</p> <pre><code>ansible-doc -l\nansible-doc -s yum\nansible-doc yum\n</code></pre> <p>\u5b98\u7f51\u7684\u4ecb\u7ecd\u6bd4\u8f83\u8be6\u7ec6\uff0c\u5efa\u8bae\u67e5\u770b\u5b98\u7f51\u4ecb\u7ecd\u3002\u201cansible-doc -l\u201d\u547d\u4ee4\u90e8\u5206\u663e\u793a\u7ed3\u679c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>.....\npurestorage.flashblade.purefb_s3user                                                     Create or delete FlashBlade Object Store account users\npurestorage.flashblade.purefb_smtp                                                       Configure SMTP for Pure Storage FlashBlade\npurestorage.flashblade.purefb_snap                                                       Manage filesystem snapshots on Pure Storage FlashBlades\npurestorage.flashblade.purefb_snmp_agent                                                 Configure the FlashBlade SNMP Agent\npurestorage.flashblade.purefb_snmp_mgr                                                   Configure FlashBlade SNMP Managers\npurestorage.flashblade.purefb_subnet                                                     Manage network subnets in a Pure Storage FlashBlade\npurestorage.flashblade.purefb_syslog                                                     Configure Pure Storage FlashBlade syslog settings\npurestorage.flashblade.purefb_target                                                     Manage remote S3-capable targets for a FlashBlade\npurestorage.flashblade.purefb_timeout                                                    Configure Pure Storage FlashBlade GUI idle timeout\npurestorage.flashblade.purefb_user                                                       Modify FlashBlade local user account password\npurestorage.flashblade.purefb_userpolicy                                                 Manage FlashBlade Object Store User Access Policies\npurestorage.flashblade.purefb_virtualhost                                                Manage FlashBlade Object Store Virtual Hosts\nraw                                                                                      Executes a low-down and dirty command\nreboot                                                                                   Reboot a machine\nreplace                                                                                  Replace all instances of a particular string in a file using a back-referenced regular expression\nrpm_key                                                                                  Adds or removes a gpg key from the rpm db\nscript                                                                                   Runs a local script on a remote node after transferring it\nsensu.sensu_go.ad_auth_provider                                                          Manage Sensu AD authent\n.....\n</code></pre> <p>\u4e0b\u9762\u4ecb\u7ecd\u8fd0\u7ef4\u5de5\u4f5c\u4e2d\u7ecf\u5e38\u7528\u5230\u7684\u51e0\u4e2a\u6a21\u5757\uff0c\u5176\u4ed6\u6a21\u5757\u4e0d\u518d\u9010\u4e00\u4ecb\u7ecd\uff0c\u5efa\u8bae\u5927\u5bb6\u53c2\u8003\u5b98\u6587\u6863\u3002</p> <ul> <li>setup\u6a21\u5757</li> <li>copy\u6a21\u5757</li> <li>synchronize\u6a21\u5757</li> <li>file\u6a21\u5757</li> <li>ping\u6a21\u5757</li> <li>group\u6a21\u5757</li> <li>user\u6a21\u5757</li> <li>shell\u6a21\u5757</li> <li>script\u6a21\u5757</li> <li>get url\u6a21\u5757</li> <li>yum\u6a21\u5757</li> <li>cron\u6a21\u5757</li> <li>service\u6a21\u5757</li> </ul> <p>Ansible\u547d\u4ee4\u884c\u8c03\u7528\u6a21\u5757\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\u6240\u793a\uff1a <pre><code>ansible \u64cd\u4f5c\u76ee\u6807 -m \u6a21\u5757\u540d -a \u6a21\u5757\u53c2\u6570\n</code></pre></p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#setup\u6a21\u5757","title":"setup\u6a21\u5757","text":"<p>(1)\u529f\u80fd</p> <p>setup \u6a21\u5757\u6765\u6536\u96c6\u4e3b\u673a\u7684\u7cfb\u7edf\u4fe1\u606f\uff0c\u8fd9\u4e9b facts \u4fe1\u606f\u53ef\u4ee5\u76f4\u63a5\u4ee5\u53d8\u91cf\u7684\u5f62\u5f0f\u4f7f\u7528\uff0c\u4f46\u662f\u5982\u679c\u4e3b\u673a\u8f83\u591a\uff0c\u4f1a\u5f71\u54cd\u6267\u884c\u901f\u5ea6\uff0c\u53ef\u4ee5\u4f7f\u7528gather_facts: no\u6765\u7981\u6b62 Ansible \u6536\u96c6 facts \u4fe1\u606f</p> <p><code>ansible-doc -s setup</code></p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cplaybook\u7684\u7b2c\u4e00\u4e2a\u4efb\u52a1\u5c31\u662fFacts\u4fe1\u606f\uff0c\u663e\u793a\u7684\u7ed3\u679c\u5982\u4e0b:</p> <pre><code>PLAY [192.168.77.130] ******************************************\nTASK [Gathering Facts] ****************************************************************\nok: [192.168.77.130]\nTASK [test] ****************************************************\nchanged: [192.168.77.130]\n</code></pre> <p>\u5982\u679c\u8981\u5173\u95edplaybook\u7684\u8fd9\u4e00\u64cd\u4f5c\uff0c\u5c31\u9700\u8981\u4e3aplay\u6dfb\u52a0gather_facts\u5173\u952e\u5b57</p> <pre><code># \u5173\u95ed\u5173\u95ed\u81ea\u52a8\u91c7\u96c6Facts\n- hosts: whatever\n  gather_facts: no\n</code></pre> <p>(2) \u4e3e\u4f8b</p> <pre><code># \u67e5\u770b\u5df2\u7ecf\u5b89\u88c5\u7684\u4e1c\u897f\nansible all  -m setup\n\n# \u67e5\u770b\u6240\u6709\u8282\u70b9\u7684ansible_python\u7684\u7248\u672c\nansible all  -m  setup -a 'filter=ansible_python_version'  </code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#copy\u6a21\u5757","title":"copy\u6a21\u5757","text":"<p>(1)\u529f\u80fd</p> <p>Ansible \u4e2d\u7684copy\u6a21\u5757\u7528\u4e8e\u5b9e\u73b0\u6587\u4ef6\u590d\u5236\u548c\u6279\u91cf\u4e0b\u53d1\u6587\u4ef6\uff0csrc\u6765\u5b9a\u4e49\u672c\u5730\u6e90\u6587\u4ef6\u8def\u5f84\uff0c\u4f7f\u7528dest\u5b9a\u4e49\u88ab\u7ba1\u7406\u4e3b\u673a\u6587\u4ef6\u8def\u5f84\uff0c\u4f7f\u7528content\u5b9a\u4e49\u4fe1\u606f\u5185\u5bb9\u6765\u751f\u6210\u76ee\u6807\u6587\u4ef6</p> <p>\u8be5\u6a21\u5757\u53ef\u5b9e\u73b0Ansible\u4e3b\u673a\u5411\u5ba2\u6237\u7aef\u4f20\u9001\u6587\u4ef6\u7684\u529f\u80fd\uff0c\u6587\u4ef6\u7684\u53d8\u5316\u662f\u901a\u8fc7md5\u503c\u6765\u5224\u65ad\u7684\uff0c\u5927\u5bb6\u9700\u8981\u8bb0\u4f4f\u5e94\u63d0\u524d\u5173\u95ed\u5ba2\u6237\u7aef\u673a\u5668\u7684SELinux\u3002</p> <p><code>ansible-doc -s copy</code></p> <p>(2) \u4e3e\u4f8b</p> <pre><code>src: # \u6e90\u6587\u4ef6  \u6307\u5b9a\u62f7\u8d1d\u6587\u4ef6\u7684\u672c\u5730\u8def\u5f84  (\u5982\u679c\u6709/ \u5219\u62f7\u8d1d\u76ee\u5f55\u5185\u5bb9,\u6bd4\u62f7\u8d1d\u76ee\u5f55\u672c\u8eab)     \ndest: # \u6307\u5b9a\u76ee\u6807\u8def\u5f84     \nmode: # \u8bbe\u7f6e\u6743\u9650    \nbackup: # \u5907\u4efd\u6e90\u6587\u4ef6  \ncontent: # \u4ee3\u66ffsrc  \u6307\u5b9a\u672c\u673a\u6587\u4ef6\u5185\u5bb9,\u751f\u6210\u76ee\u6807\u4e3b\u673a\u6587\u4ef6\n</code></pre> <pre><code># \u8fdb\u884c\u590d\u5236dest=/tmp/test.txt\"\nansible webserver -m copy -a \"content='test content\\nxxx' dest=/tmp/test.txt\"\n# \u8fdb\u884c\u67e5\u770b\nansible webserver  -a \"cat /tmp/test.txt\" ansible webservers -m copy -a \"src=/home/test.sh dest=/tmp/ owner=root group=root mode=0755\"\nansible dbservers -m copy -a 'src=/etc/fstab dest=/tmp/fstab.ansible owner=root mode=640'\n#\u5c06\u201cHello Ansible Hi Ansible\u201d\u5199\u5165\u7ba1\u7406\u4e3b\u673a\u7684/tmp/test.ansible\u6587\u4ef6\u4e2d\nansible dbservers -m copy -a 'content=\"Hello Ansible Hi Ansible\" dest=/tmp/test.ansible'\n# \u62f7\u8d1d\u662f\u8bbe\u7f6e\u6743\u9650\uff0cforce\u5f3a\u5236\u8986\u76d6\uff0c\u9ed8\u8ba4\u3002 backup\u53c2\u8003\uff0c\u62f7\u8d1d\u8986\u76d6\u524d\u8fdb\u884c\u5907\u4efd\nansible webserver -m copy -a \"src=/usr/local/src/test.py dest=/tmp/owner=root group=root mode=0755 force=yes\"\nansible web -m copy -a \"src=/mine/ntp.conf dest=/etc/ntp.conf owner=root group=root mode=644 backup=yes force=yes\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#synchronize\u6a21\u5757","title":"synchronize\u6a21\u5757","text":"<p>(1)\u529f\u80fd</p> <p>\u7531\u4e8esynchronize\u6a21\u5757\u4f1a\u8c03\u7528rsync\u547d\u4ee4\uff0c\u56e0\u6b64\u9996\u5148\u8981\u8bb0\u5f97\u63d0\u524d\u5b89\u88c5\u597drsync\u8f6f\u4ef6\u5305\uff0c\u4e0d\u7136\u6267\u884c\u7684\u65f6\u5019\u4f1a\u51fa\u73b0<code>\"msg\":\"[Errno2]No such file or directory'\"</code>\u8fd9\u79cd\u62a5\u9519\u4fe1\u606f\u3002</p> <p><code>ansible-doc -s synchronize</code></p> <p>(2)\u4e3e\u4f8b</p> <p>synchronize\u6a21\u5757\u7528\u4e8e\u5c06Ansible\u673a\u5668\u7684\u6307\u5b9a\u76ee\u5f55\u63a8\u9001(push)\u5230\u5ba2\u6237\u673a\u5668\u7684\u6307\u5b9a\u76ee\u5f55\u4e0b\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>ansible 192.168.1.206 -m synchronize -a \"src=/usr/local/src/ dest=/usr/local/ src/delete=yes compress=yes\n</code></pre> <p>\u5176\u4e2d\uff0cdelete=-yes\u7528\u6765\u5b9e\u73b0\u4f7f\u4e24\u8fb9\u7684\u5185\u5bb9\u4e00\u6837(\u5373\u4ee5push\u65b9\u5f0f\u4e3a\u4e3b)\uff0c\u5b9e\u73b0\u6548\u679c\u4e0e<code>rsync-delete</code>\u4e00\u6837\uff0c \u5982\u679c\u662f\u5ba2\u6237\u7aef\u4e0d\u5b58\u5728\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u5219\u589e\u8865\uff0c\u5982\u679c\u5b58\u5728\u7740\u4e0d\u540c\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u5219\u5220\u9664\uff0c\u4ee5\u4fdd\u8bc1\u4e24\u8fb9\u5185\u5bb9\u4e00\u81f4\u3002</p> <p>compress=yes\u7528\u4e8e\u5f00\u542f\u538b\u7f29\uff0c\u9ed8\u8ba4\u4e3a\u5f00\u542f\u3002</p> <p>\u53e6\u5916\uff0c\u7531\u4e8esynchronize\u6a21\u5757\u8c03\u7528\u7684\u662frsync\u547d\u4ee4\uff0c\u56e0\u6b64\u5982\u679c\u8def\u5f84\u4f7f\u7528\u201c/\u201d\u6765\u7ed3\u5c3e\uff0c\u5219\u53ea\u590d\u5236\u76ee\u5f55\u91cc\u7684\u5185\u5bb9\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u201c/\u201d\u6765\u7ed3\u5c3e\uff0c\u5219\u5305\u542b\u76ee\u5f55\u5728\u5185\u7684\u6574\u4e2a\u5185\u5bb9\u5168\u90e8\u90fd\u8981\u590d \u5236\u8fc7\u53bb(\u6e90\u76ee\u6807\u76ee\u5f55\u4f5c\u4e3a\u76ee\u7684\u76ee\u5f55\u7684\u4e00\u4e2a\u5b50\u76ee\u5f55\u5b58\u5728)\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#file\u6a21\u5757","title":"file\u6a21\u5757","text":"<p>(1)\u529f\u80fd</p> <p>Ansible\u4e2d\u4f7f\u7528file\u6a21\u5757\u6765\u8bbe\u7f6e\u6587\u4ef6\u5c5e\u6027\uff0cpath\u6307\u5b9a\u6587\u4ef6\u8def\u5f84\uff0csec\u6307\u5b9a\u6e90\u6587\u4ef6\u8def\u5f84\uff0c\u4f7f\u7528name\u6216dest\u6765\u66ff\u6362\u521b\u5efa\u6587\u4ef6\u7684\u7b26\u53f7\u94fe\u63a5</p> <p><code>ansible-doc -s file</code></p> <p>(2)\u4e3e\u4f8b</p> <pre><code># \u66f4\u6539\u6587\u4ef6\u7684\u7528\u6237\u53ca\u6743\u9650\nansible web -m file -a \"dest=/tmp/a.txt mode=600 owner=user group=user\"\n# \u521b\u5efa\u76ee\u5f55\uff0c\u7c7b\u4f3cmkdir -p\nansible web -m file -a \"dest=/tmp/test mode=755 owner=user group=user state=directory\"\n# \u5220\u9664\u6587\u4ef6\u6216\u8005\u76ee\u5f55\nansible web -m file -a \"dest=/tmp/test state=absent\"\n# \u521b\u5efa\u8f6f\u8fde\u63a5\uff0c\u5e76\u8bbe\u7f6e\u6240\u5c5e\u7528\u6237\u548c\u7528\u6237\u7ec4\nansible web -m file -a  \"src=/file/to/link/to dest=/path/to/symlink owner=user group=user state=link\"\n# touch \u4e00\u4e2a\u6587\u4ef6\u5e76\u6dfb\u52a0\u7528\u6237\u8bfb\u5199\u6743\u9650\uff0c\u7528\u6237\u7ec4\u53bb\u9664\u5199\u6267\u884c\u6743\u9650\uff0c\u5176\u4ed6\u7ec4\u51cf\u53bb\u8bfb\u5199\u6267\u884c\u6743\u9650\nansible web -m file -a  \"path=/etc/foo.conf state=touch mode='u+rw,g-wx,o-rwx'\"\nansible webserver -m file -a 'path=/app/test.txt state=touch'       #\u521b\u5efa\u6587\u4ef6   \nansible webserver -m file -a \"path=/data/testdir state=directory\"   #\u521b\u5efa\u76ee\u5f55         \nansible webserver -m file -a \"path=/root/test.sh owner=wang mode=755\"  #\u8bbe\u7f6e\u6743\u9650755     \nansible webserver -m file -a 'src=/data/testfile dest=/data/testfile-link state=link' #\u521b\u5efa\u8f6f\u94fe\u63a5  \n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#ping\u6a21\u5757","title":"ping\u6a21\u5757","text":"<p>ping\u6a21\u5757\uff0c\u5176\u53ef\u7528\u4e8e\u68c0\u6d4b\u4e0e\u88ab\u63a7\u7aef\u673a\u5668\u7684\u8fde\u901a\u6027\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>ansible all -m ping\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#group\u6a21\u5757","title":"group\u6a21\u5757","text":"<p>(1)\u529f\u80fd</p> <p>Ansible\u4e2d\u7684group\u6a21\u5757\u7528\u4e8e\u5bf9\u7528\u6237\u7ec4\u8fdb\u884c\u7ba1\u7406</p> <p><code>ansible-doc -s group</code></p> <p>\uff082\uff09\u4f8b\u5b50</p> <pre><code># \u521b\u5efamysql\u7ec4\uff0c\u5c06mysql\u7528\u6237\u6dfb\u52a0\u5230mysql\u7ec4\u4e2d\nansible dbservers -m group -a 'name=mysql gid=306 system=yes'\nansible dbservers -m user -a 'name=mysql uid=306 system=yes group=mysql'\n# \u521b\u5efa\u4e00\u4e2a\u7ec4\u540d\u4e3atest gid\u4e3a2018\u7684\u7ec4\nansible webserver -m group -a gid=2018 name='test'\n# \u67e5\u770b\u521b\u5efa\u7684\u7ec4 \nansible webserver -m shell -a 'cat /etc/group|grep test'\n</code></pre> <p>\u6ce8\u610f\u8fd9\u91cc\u4f7f\u7528\u4e86shell\u6a21\u5757\uff0c\u6ca1\u6709\u4f7f\u7528\u9ed8\u8ba4\u7684command\u6a21\u5757\uff0c</p> <p>ansible\u7684\u9ed8\u8ba4\u6a21\u5757command\uff0c\u5b83\u4e0d\u4f1a\u901a\u8fc7shell\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u50cf<code>$HOME</code>\u548c\u50cf<code>\u201c&lt;\u201d\uff0c\u201c&gt;\u201d\uff0c\u201c|\u201d\uff0c\u201c;\u201d</code>\u548c<code>\u201c\uff06\u201d</code>\u5c06\u4e0d\u5de5\u4f5c\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#user\u6a21\u5757","title":"user\u6a21\u5757","text":"<p>(1)\u529f\u80fd</p> <p>Ansible\u4e2d\u7684user\u6a21\u5757\u7528\u4e8e\u521b\u5efa\u65b0\u7528\u6237\u548c\u66f4\u6539\u3001\u5220\u9664\u5df2\u5b58\u5728\u7684\u7528\u6237\u3002\u5176\u4e2dname\u9009\u9879\u7528\u6765\u8fd9\u4e48\u521b\u5efa\u7684\u7528\u6237\u540d\u79f0\u3002</p> <p>\u8fdc\u7a0b\u4e3b\u673a\u7cfb\u7edf\u7528\u6237\u7ba1\u7406\u3002</p> <p><code>ansible-doc -s user</code></p> <p>(2)\u793a\u4f8b</p> <pre><code>#\u521b\u5efa\u7528\u6237\nansible dbservers -m user -a 'name=\"user1\"'\n#\u8be5\u573a\u666f\u4e2d\u6211\u4eec\u53ef\u4ee5\u638c\u63e1\u5982\u4e0b\u6280\u80fd\u70b9\u3002\n# 1\uff09groups\u8bbe\u5b9a\uff1agroups=\u7528\u6237\u7ec41\uff0c\u7528\u6237\u7ec42\u2026\u2026\n# 2\uff09\u589e\u91cf\u6dfb\u52a0\u5c5e\u7ec4\uff1aappend=yes\n# 3\uff09\u8868\u660e\u5c5e\u7ec4\u72b6\u6001\u4e3a\u65b0\u5efa\uff1astate=present\nansible db -m user -a \"name=dba shell=/bin/bash groups=admins,dbagroup append=yes home=/home/dba/ state=present\"\n#\u8bbe\u7f6e\u7cfb\u7edf\u7528\u6237tom\u7684\u5bc6\u7801\u4e3aredhat123\u3002\nansible db -m user -a \"name=tom shell=/bin/bash password=to46pW3GOukvA update_password=always\"\n#\u5220\u9664\u7528\u6237\nansible dbservers -m user -a 'name=\"user1\" state=absent'\nansible db -m user -a \"name=dba state=absent remove=yes\"\n######## windows \u7528\u6237\u7ba1\u7406 ###########\n#\u65b0\u589e\u7528\u6237stanley\uff0c\u5bc6\u7801\u4e3amagedu@123\uff0c\u5c5e\u7ec4\u4e3aAdministrators\u3002\nansible windows -m win_user -a \"name=stanley passwd=magedu@123 group=Administrators\"\n######## \u5e94\u7528\u5c42\u7528\u6237\u7ba1\u7406 ####################\n#\u65b0\u589eMySQL\u7528\u6237stanley\uff0c\u8bbe\u7f6e\u767b\u5f55\u5bc6\u7801\u4e3amagedu@bj\uff0c\u5bf9zabbix.*\u8868\u6709ALL\u6743\u9650\nansible db -m mysql_user -a 'login_host=localhost login_password=magedu login_user=root name=stanley password=magedu@bj priv=zabbix.*:ALL state=present'\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#shell\u6a21\u5757","title":"shell\u6a21\u5757","text":"<p>(1) \u529f\u80fd</p> <p>command\u6a21\u5757\u4f5c\u4e3aAnsible\u7684\u9ed8\u8ba4\u6a21\u5757\uff0c\u53ef\u4ee5\u8fd0\u884c\u88ab\u63a7\u7aef\u673a\u5668\u6743\u9650\u8303\u56f4\u5185\u7684\u6240\u6709shell\u547d\u4ee4\uff0c\u524d\u9762\u5df2\u591a\u6b21\u63d0\u5230\uff0c\u8fd9\u91cc\u4e0d\u518d\u91cd\u590d\u3002</p> <p>\u800cshell\u6a21\u5757\u7528\u4e8e\u6267\u884c\u88ab\u63a7\u7aef\u673a\u5668\u7684Shell\u811a\u672c\u6587\u4ef6\uff0c\u4e0e\u53e6\u4e00\u4e2a\u6a21\u5757raw\u7684\u529f\u80fd\u7c7b\u4f3c\uff0c\u5e76\u4e14\u652f\u6301\u7ba1\u9053\u7b26\u3002</p> <p><code>ansible-doc -s shell</code></p> <p>(2) \u793a\u4f8b</p> <p>\u83b7\u53d6web\u7ec4\u91cc\u5f97eth0\u63a5\u53e3\u4fe1\u606f</p> <pre><code>ansible web -m shell -a \"ifconfig eth0|grep addr\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#raw\u6a21\u5757","title":"raw\u6a21\u5757","text":"<p>\u5982\u679c\u8bf4\u8fdc\u7a0b\u4e3b\u673a\u6ca1\u6709python \u6a21\u5757\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528raw \u6a21\u5757\u6267\u884c\u547d\u4ee4</p> <pre><code>ansible web -m raw -a \"ifconfig eth0|grep addr\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#scritp\u6a21\u5757","title":"scritp\u6a21\u5757","text":"<p>(1) \u529f\u80fd script\u6a21\u5757\u7528\u4e8e\u5728\u8fdc\u7a0b\u88ab\u63a7\u7aef\u4e3b\u673a\u6267\u884c\u672c\u5730Ansible\u673a\u5668\u4e2d\u7684Shell\u811a\u672c\u6587\u4ef6\uff0c\u76f8\u5f53\u4e8e\u201cscp+shell\u201d\u7684\u7ec4\u5408\u547d\u4ee4\u3002</p> <p>(2) \u793a\u4f8b <pre><code># \u6267\u884c\u811a\u672c\nansible web -m script -a ip.sh\n\nansible webserver -m script -a 'data/test.sh'\nansible webserver -m script -a \"/root/print_hello.sh\"\n</code></pre></p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#get_url\u6a21\u5757","title":"get_url\u6a21\u5757","text":"<p>(1) \u529f\u80fd</p> <p>\u5b9e\u73b0\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0b\u8f7d\u6307\u5b9aURL\u5230\u672c\u5730\uff0c\u652f\u6301sha256sum\u6587\u4ef6\u6821\u9a8c</p> <p>(2) \u4f8b\u5b50</p> <pre><code>ansible webservers -m get_url -a \"url=http://www.baidu.com dest=/tmp/index.html mode=0440 force=yes\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#yum\u6a21\u5757","title":"yum\u6a21\u5757","text":"<p>Ansible\u4e2d\u7684yum\u6a21\u5757\u8d1f\u8d23\u5728\u88ab\u7ba1\u7406\u7684\u4e3b\u673a\u6570\u5b89\u88c5\u4e0e\u5378\u8f7d\u8f6f\u4ef6\u5305\uff0c\u524d\u63d0\u662f\u5728\u6bcf\u4e2a\u8282\u70b9\u914d\u7f6e\u81ea\u5df1\u7684YUM\u4ed3\u5e93\uff0cname\u6307\u5b9a\u8981\u5b89\u88c5\u7684\u8f6f\u4ef6\u5305</p> <p>\u5e26\u4e0a\u8f6f\u4ef6\u5305\u7684\u7248\u672c\u53f7\uff0cstate\u6307\u5b9a\u5b89\u88c5\u8f6f\u4ef6\u5305\u7684\u72b6\u6001\uff0cpresent\u3001latest\u7528\u6765\u8868\u793a\u5b89\u88c5\uff0cabsent\u8868\u793a\u5378\u8f7d</p> <p><code>ansible-doc -s yum</code></p> <p>(1) \u529f\u80fd</p> <p>Linux\u5e73\u53f0\u8f6f\u4ef6\u5305\u7ba1\u7406\u64cd\u4f5c\uff0c\u5e38\u89c1\u6709yum\u3001apt\u7ba1\u7406\u65b9\u5f0f\u3002</p> <p>(2) \u4f8b\u5b50</p> <pre><code># \u5b89\u88c5zsh\u8f6f\u4ef6\u5305\nansible dbservers -m yum -a 'name=zsh'\n# \u5378\u8f7dzsh\u8f6f\u4ef6\u5305\nansible dbservers -m yum -a 'name=zsh,state=absent'\nansible webservers -m yum -a \"name=curl state=latest\"\n#Redis\u5b89\u88c5\u547d\u4ee4\uff1a\nansible db-m yum -a \"name=redis state=present\"\u3002\n\n#Redis\u5b89\u88c5\u68c0\u67e5\uff1a\nansible db-m command -a \"redis-cli--version\"\u3002\n\n# \u5b89\u88c5MariaDB-server\nansible db -m yum -a \"name=MariaDB-server state=present\"\n# #\u5b89\u88c5MySQL-python\u548cpython-setuptools\u4f9d\u8d56\u5305\u3002\nansible app -m yum -a \"name=MySQL-python state=present\"\nansible app -m yum -a \"name=python-setuptools state=present\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#apt\u6a21\u5757","title":"apt\u6a21\u5757","text":"<p>Ubuntu/Debian\u7cfb\u7edf</p> <pre><code># \u66f4\u65b0\u4ed3\u5e93\u7f13\u5b58\uff0c\u5e76\u5b89\u88c5\"curl\"\nansible webservers -m apt -a \"name=curl update_cache=yes\"\n## \u5b89\u88c5\nansible webservers -m apt -a \"pkg=curl state=present\"\n# \u5b89\u88c5\u6700\u65b0\u5f97\"curl\"\nansible all -m apt -a \"name=curl state=latest\"\n## \u5220\u9664\nansible webservers -m apt -a \"pkg=curl state=absent\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#cron\u6a21\u5757","title":"cron\u6a21\u5757","text":"<p>(1)\u529f\u80fd</p> <p>Ansible\u4e2d\u7684cron\u6a21\u5757\u7528\u4e8e\u5b9a\u4e49\u4efb\u52a1\u8ba1\u5212\uff0c\u5176\u4e2d\u6709\u4e24\u79cd\u72b6\u6001\uff0c(state):present\u8868\u793a\u6dfb\u52a0(\u7701\u7565\u72b6\u6001\u65f6\u9ed8\u8ba4\u4f7f\u7528),absent\u8868\u793a\u79fb\u9664\u3002</p> <p><code>ansible-doc -s cron</code></p> <p>(2) \u4f8b\u5b50</p> <pre><code># cron\u6a21\u5757\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u521b\u5efa\u8ba1\u5212\u4efb\u52a1\uff0c\u53ef\u4ee5\u5b9a\u4e49webserver\u7ec4\u88ab\u63a7\u7aef\u673a\u5668\u6bcf\u5929\u51cc\u66681\u70b9\u8fc71\u5206ntpdate\u81ea\u52a8\u5bf9\u65f6\uff0c\u547d\u4ee4\u5982\u4e0b\u6240\u793a\uff1a\nansible webserver -m cron -a '\"name=ntpdate time every day\" minute=\"1\" hour=\"1\" job=\"/sbin/ntpdate ntp.api.bz &gt;&gt; /dev/null\"'\n#\u6dfb\u52a0\u8ba1\u5212\u4efb\u52a1\nansible dbservers -m cron -a 'minute=\"*/10\" job=\"/bin/echo hello\" name=\"test cron job\"'\n192.168.1.108 | CHANGED =&gt; {\n\"changed\": true,\n    \"envs\": [],\n    \"jobs\": [\n\"test cron job\"\n]\n#\u67e5\u770bcrontab\u8ba1\u5212\u4efb\u52a1\nansible dbservers -a 'crontab -l'\n192.168.1.108 | CHANGED | rc=0 &gt;&gt;\n#Ansible: test cron job\n*/10 * * * * /bin/echo hello\n\n#\u79fb\u9664\u8ba1\u5212\u4efb\u52a1\nansible dbservers -m cron -a 'minute=\"*/10\" job=\"/bin/echo hello\" name=\"test cron job\" state=absent'\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#service\u6a21\u5757","title":"service\u6a21\u5757","text":"<p>(1) \u529f\u80fd</p> <p>\u8fdc\u7a0b\u4e3b\u673a\u7cfb\u7edf\u670d\u52a1\u7ba1\u7406\u3002</p> <p><code>ansible-doc -s service</code></p> <p>\u5728 Ansible\u4e2d\u4f7f\u7528service\u6a21\u5757\u6765\u63a7\u5236\u7ba1\u7406\u670d\u52a1\u5668\u7684\u8fd0\u884c\u72b6\u6001\uff0cenable\u8868\u793a\u662f\u5426\u5f00\u673a\u81ea\u542f\u52a8\uff0c \u503c\u4e3atrue\u6216\u8005false\uff0c</p> <p>\u4f7f\u7528name\u6765\u5b9a\u4e49\u670d\u52a1\u540d\u79f0\u4f7f\u7528state\u6307\u5b9a\u670d\u52a1\u72b6\u6001\uff0c\u53d6\u503c\u4e3astarted\u3001stoped\u3001restarted</p> <p>(2) \u793a\u4f8b</p> <pre><code>ansible webservers -m service -a \"name=nginx state=stopped\"\nansible webservers -m service -a \"name=nginx state=restarted\"\nansible webservers -m service -a \"name=nginx state=reloaded\"\n#\u5b89\u88c5httpd\u670d\u52a1\nansible webservers -m yum -a \"name=httpd state=latest\"\n#\u67e5\u770bhttpd\u670d\u52a1\u7684\u72b6\u6001\nansible dbservers -a 'service httpd status'\n#\u67e5\u770bhttp\u670d\u52a1\u5f00\u673a\u542f\u52a8\u72b6\u6001\nansible dbservers -a 'chkconfig httpd status'\n#\u8bbe\u7f6ehttpd\u670d\u52a1\u4e3a\u5f00\u673a\u81ea\u542f\u52a8\nansible dbservers -m service -a 'enable=ture name=httpd state=started'\nansible webservers -m service -a \"name=nginx state=stopped\"\nansible webservers -m service -a \"name=nginx state=restarted\"\nansible webservers -m service -a \"name=nginx state=reloaded\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#5playbook\u4ecb\u7ecd","title":"5.playbook\u4ecb\u7ecd","text":"<p>playbook(\u4e5f\u79f0\u4e3a\u5267\u672c)\u662f\u4e00\u4e2a\u4e0d\u540c\u4e8eAnsible Ad-hoc\u547d\u4ee4\u884c\u6267\u884c\u65b9\u5f0f\u7684\u6a21\u5f0f\uff0c\u5176\u529f\u80fd\u66f4\u4e3a\u5f3a\u5927\u7075\u6d3b\u3002</p> <p>\u7b80\u800c\u8a00\u4e4b\uff0c\u5b83\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u914d\u7f6e\u7ba1\u7406\u548c\u591a\u4e3b\u673a\u90e8\u7f72\u7cfb\u7edf\u3002playbook\u662f\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u201cplay\u201d\u7ec4\u6210\u7684\u5217\u8868\u3002play\u7684\u4e3b\u8981\u529f\u80fd\u662f\u5c06\u4e8b\u5148\u5f52\u4e3a\u4e00\u7ec4\u7684\u4e3b\u673a\u88c5\u626e\u6210\u901a\u8fc7 ansible\u4e2d\u7684task\u4e8b\u5148\u5b9a\u4e49\u597d\u7684\u89d2\u8272\u3002</p> <p>\u4ece\u6839\u672c\u4e0a\u6765\u8bb2\uff0c\u6240\u8c13\u7684task\u5c31\u662f\u8c03\u7528Ansible\u7684\u4e00\u4e2a\u4e2amodule\u5c06\u591a\u4e2aplay\u7ec4\u7ec7\u5728\u4e00\u4e2aplaybook\u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u5b83\u4eec\u8fde\u901a\u8d77\u6765\uff0c\u5e76\u6309\u4e8b\u5148\u7f16\u6392\u7684\u673a\u5236\u540c\u5531\u4e00\u53f0\u5927\u620f\u3002</p> <p>playbook\u7684\u6a21\u677f\u662f\u4f7f\u7528Python\u7684jinjaz2\u6a21\u5757\u6765\u5904\u7406\u7684\u3002</p> <p>\u53e6\u5916\uff0cplaybook\u4e5f\u662f\u901a\u8fc7YAML\u683c\u5f0f\u6765\u63cf\u8ff0\u5b9a\u4e49\u7684\uff0c\u53ef\u4ee5\u5b9e\u73b0\u591a\u53f0\u4e3b\u673a\u7684\u5e94\u7528\u90e8\u7f72\uff0c\u8bed\u6cd5\u4e5f\u5e76\u4e0d\u590d\u6742\uff0c\u5927\u5bb6\u53ef\u4ee5\u5bf9\u7167\u5b98\u65b9\u6848\u4f8b\u5b66\u4e60\u5176\u8bed\u6cd5\uff0c\u5b98\u65b9\u63d0\u4f9b\u4e86\u5927\u91cf \u7684\u6848\u4f8b\u3002</p> <p>\u5b98\u65b9\u6848\u4f8b\u5740\u4e3a\uff1a https:/github.com/ansible/ansible-examples\u3002</p> <p>\u7f16\u5199playbook</p> <ul> <li>\u4e00\u4e2a\u5267\u672c\uff08\u5373playbook\uff09\uff0c\u53ef\u4ee5\u5305\u542b\u591a\u4e2aplay</li> <li>\u6bcf\u4e2aplay\u7528\u4e8e\u5728\u6307\u5b9a\u7684\u4e3b\u673a\u4e0a\uff0c\u901a\u8fc7\u6a21\u5757\u548c\u53c2\u6570\u6267\u884c\u76f8\u5e94\u7684\u4efb\u52a1</li> <li>\u6bcf\u4e2aplay\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u4efb\u52a1\u3002</li> <li>\u4efb\u52a1\u6709\u6a21\u5757\u548c\u53c2\u6570\u6784\u6210\u3002</li> </ul> <pre><code>---\n- \u540d\u5b57: \u7334\u738b\u521d\u95ee\u4e16\n\u804c\u5458\u8868: \u7334\u54e5, \u5927\u9a6c\u7334\n\u573a\u666f:\n- \u540d\u5b57: \u77f3\u5934\u88c2\u5f00\u4e86\n- \u540d\u5b57: \u5929\u5bab\u9707\u98a4\u4e86\n- \u540d\u5b57: \u5b98\u5c01\u5f3c\u9a6c\u6e29\n\u804c\u5458\u8868: \u7334\u54e5, \u7389\u7687\u5927\u5e1d\n\u573a\u666f:\n- \u540d\u5b57: \u592a\u767d\u91d1\u661f\u9a97\u7334\u54e5\n- \u540d\u5b57: \u7334\u54e5\u5929\u5bab\u653e\u9a6c\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#51-\u5e38\u7528\u547d\u4ee4","title":"5.1 \u5e38\u7528\u547d\u4ee4","text":""},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#1-playbook\u7684\u6838\u5fc3\u5143\u7d20","title":"1. playbook\u7684\u6838\u5fc3\u5143\u7d20","text":"<pre><code>hosts : playbook\u914d\u7f6e\u6587\u4ef6\u4f5c\u7528\u7684\u4e3b\u673a\ntasks: \u4efb\u52a1\u5217\u8868\nvariables: \u53d8\u91cf\ntemplates:\u5305\u542b\u6a21\u677f\u8bed\u6cd5\u7684\u6587\u672c\u6587\u4ef6\nhandlers :\u7531\u7279\u5b9a\u6761\u4ef6\u89e6\u53d1\u7684\u4efb\u52a1\nroles :\u7528\u4e8e\u5c42\u6b21\u6027\u3001\u7ed3\u6784\u5316\u5730\u7ec4\u7ec7playbook\u3002roles \u80fd\u591f\u6839\u636e\u5c42\u6b21\u578b\u7ed3\u6784\u81ea\u52a8\u88c5\u8f7d\u53d8\u91cf\u6587\u4ef6\u3001tasks\u4ee5\u53cahandlers\u7b49\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#2-playbook\u8fd0\u884c\u65b9\u5f0f","title":"2. playbook\u8fd0\u884c\u65b9\u5f0f","text":"<pre><code>ansible-playbook first.yml -f 10  # \u4f7f\u7528ansible-playbook\u547d\u4ee4\u6267\u884cplaybook\nansible-playbook first.yml --syntax-check    #\u68c0\u67e5yaml\u6587\u4ef6\u7684\u8bed\u6cd5\u662f\u5426\u6b63\u786e\nansible-playbook first.yml --list-task       #\u68c0\u67e5tasks\u4efb\u52a1\nansible-playbook first.yml --list-hosts      #\u68c0\u67e5\u751f\u6548\u7684\u4e3b\u673a\nansible-playbook first.yml --start-at-task='Copy Nginx.conf'     #\u6307\u5b9a\u4ece\u67d0\u4e2atask\u5f00\u59cb\u8fd0\u884c\nansible-playbook first.yml -k      #\u7528\u6765\u4ea4\u4e92\u8f93\u5165ssh\u5bc6\u7801\nansible-playbook first.yml -K      #\u7528\u6765\u4ea4\u4e92\u8f93\u5165sudo\u5bc6\u7801\nansible-playbook first.yml -u      #\u6307\u5b9a\u7528\u6237\nansible-playbook --check \u53ea\u68c0\u6d4b\u53ef\u80fd\u4f1a\u53d1\u751f\u7684\u6539\u53d8,\u4f46\u4e0d\u771f\u6267\u884c\u64cd\u4f5c\nansible-playbook --list-hosts \u5217\u51fa\u8fd0\u884c\u4efb\u52a1\u7684\u4e3b\u673a\nansible-playbook --syntax-check playbook.yaml \u8bed\u6cd5\u68c0\u6d4b\nansible-playbook -t TAGS_NAME playbook.yaml \u53ea\u6267\u884cTAGS_NAME\u4efb\u52a1\n\n# \u4e5f\u53ef\u4ee5\u4f7f\u7528ansible-lint \u547d\u4ee4\u8fdb\u884c\u8be6\u7ec6\u68c0\u67e5playbook\u6587\u4ef6\nansible-lint httpd.yml\n\n# Ansible-playbook\u65b0\u589e\u7684\u529f\u80fd\u53c2\u6570\u5982\u4e0b\uff1a\n\u00b7--list-tags\uff1a      # \u5217\u51fa\u6240\u6709\u53ef\u7528\u7684tags\u3002\n\u00b7--list-tasks\uff1a     # \u5217\u51fa\u6240\u6709\u5373\u5c06\u88ab\u6267\u884c\u7684\u4efb\u52a1\u3002\n\u00b7--skip-tags=SKIP_TAGS\uff1a # \u8df3\u8fc7\u6307\u5b9a\u7684tags\u4efb\u52a1\u3002\n\u00b7--start-at-task=START_AT_TASK\uff1a      # \u4ece\u7b2c\u51e0\u6761\u4efb\u52a1\u5f00\u59cb\u6267\u884c\u3002\n\u00b7--step\uff1a                             # \u9010\u6b65\u6267\u884cPlaybook\u5b9a\u4e49\u7684\u4efb\u52a1\uff0c\u5e76\u7ecf\u4eba\u5de5\u786e\u8ba4\u540e\u7ee7\u7eed\u6267\u884c\u4e0b\u4e00\u6b65\u4efb\u52a1\u3002\n\u00b7--syntax-check\uff1a                     # \u68c0\u67e5Playbook\u4e2d\u7684\u8bed\u6cd5\u4e66\u5199\u3002\n\u00b7-t TAGS\uff0c--tags=TAGS\uff1a               # \u6307\u5b9a\u6267\u884c\u8be5tags\u7684\u4efb\u52a1\u3002\n# \u5728yaml\u4e2d\u6253\u6807\u7b7e\n# \u6700\u7b80\u6d01\u7684\u5199\u6cd5\ntags: ['one', 'two', 'three']\n# \u6700\u6e05\u6670\u7684\u5199\u6cd5\ntags:\n    - one\n    - two\n    - three\n\n#\u5982\u679c\u60a8\u53ea\u60f3\u8fd0\u884c\u4e00\u4e2a\u975e\u5e38\u957f\u7684\u5267\u672c\u7684\"\u914d\u7f6e\"\u548c\"\u5305\"\u90e8\u5206\uff0c\u60a8\u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u4e0a\u4f7f\u7528\u8be5\u9009\u9879\uff1a--tags\n$ ansible-playbook example.yml --tags \"configuration,packages\"\n#\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u8981\u5728\u6ca1\u6709\u67d0\u4e9b\u6807\u8bb0\u4efb\u52a1\u7684\u60c5\u51b5\u4e0b\u8fd0\u884cplaybook \uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u9009\u9879\uff1a--skip-tags\n$ ansible-playbook example.yml --skip-tags \"packages\"\nansible-playbook playbook.yaml\n\n# Ansible-playbook\uff1a\u5176\u4ed6\u9009\u9879\u6280\u5de7\n\u00b7--inventory=PATH\uff08-i PATH\uff09\uff1a\u6307\u5b9ainventory\u6587\u4ef6\uff0c\u9ed8\u8ba4\u6587\u4ef6\u662f/etc/ansible/hosts\u3002\n\n\u00b7--verbose\uff08-v\uff09\uff1a\u663e\u793a\u8be6\u7ec6\u8f93\u51fa\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528-vvvv\u663e\u793a\u7cbe\u786e\u5230\u6bcf\u5206\u949f\u7684\u8f93\u51fa\u3002\n\n\u00b7--extra-vars=VARS\uff08-e VARS\uff09\uff1a\u5b9a\u4e49\u5728Playbook\u4f7f\u7528\u7684\u53d8\u91cf\uff0c\u683c\u5f0f\u4e3a\uff1a\"key=value\uff0ckey=value\"\u3002\n\n\u00b7--forks=NUM\uff08-f NUM\uff09\uff1a\u6307\u5b9a\u5e76\u53d1\u6267\u884c\u7684\u4efb\u52a1\u6570\uff0c\u9ed8\u8ba4\u4e3a5\uff0c\u6839\u636e\u670d\u52a1\u5668\u6027\u80fd\uff0c\u8c03\u5927\u8fd9\u4e2a\u503c\u53ef\u63d0\u9ad8Ansible\u6267\u884c\u6548\u7387\u3002\n\n\u00b7--connection=TYPE\uff08-c TYPE\uff09\uff1a\u6307\u5b9a\u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\u7684\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u4e3aSSH\uff0c\u8bbe\u4e3alocal\u65f6\uff0c\u5219\u53ea\u5728\u672c\u5730\u6267\u884cPlaybook\uff0c\u5efa\u8bae\u4e0d\u505a\u4fee\u6539\u3002\n\n\u00b7--check\uff1a\u68c0\u6d4b\u6a21\u5f0f\uff0cPlaybook\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u4efb\u52a1\u5c06\u5728\u6bcf\u53f0\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u8fdb\u884c\u68c0\u6d4b\uff0c\u4f46\u5e76\u4e0d\u76f4\u6b63\u6267\u884c\u3002\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#52-\u5b98\u65b9\u6848\u4f8b","title":"5.2 \u5b98\u65b9\u6848\u4f8b","text":"<p>Ansible\u5b98\u65b9\u6848\u4f8b\u3002</p> <p>apache.yml</p> <pre><code>---\n- name: Deploy Apache\n  hosts: localhost\n  become: yes\n  vars:\n    http_port: 8001\n    max_clients: 200\n  tasks:\n    - name: Install Apache\n      apt:\n        name: httpd\n        state: latest\n    - name: Write the Apache config file\n      template:\n        src: /srv/httpd.j2\n        dest: /etc/httpd.conf\n      notify: Restart Apache\n    - name: Ensure Apache is running\n      service:\n        name: httpd\n        state: started\n  handlers:\n    - name: Restart Apache\n      service:\n        name: httpd\n        state: restarted\n</code></pre> <p><code>httpd.conf.j2</code>\u6a21\u677f</p> <pre><code>Listen {{ http_port }}\n\nServerName localhost\n\nMaxClients {{ max_clients }}\n\n&lt;VirtualHost *:{{ http_port }}&gt;\n  DocumentRoot /var/www/html\n  &lt;Directory /var/www/html&gt;\n    AllowOverride All\n    Require all granted\n  &lt;/Directory&gt;\n&lt;/VirtualHost&gt;\n</code></pre> <pre><code># \u67e5\u770bhosts\u548ctask\nansible-playbook apache.yml --list-hosts --list-task\nplaybook: apache.yml\n\nplay #1 (localhost): localhost        TAGS: []\npattern: ['localhost']\nhosts (1):\n      localhost\n    tasks:\n      Install Apache    TAGS: []\nWrite the Apache config file      TAGS: []\nEnsure Apache is running  TAGS: []\n# \u6267\u884c\u90e8\u7f72\nansible-playbook apache.yml -f 10\n</code></pre> <p>\u53c2\u6570-f 10\u63d0\u9ad8\u8fdb\u7a0b\u6570\uff0cansible\u9ed8\u8ba4\u5e76\u884c\u8fdb\u7a0b\u662f5(Ansible\u9ed8\u8ba4\u662f\u540c\u6b65\u963b\u585e\u6a21\u5f0f\uff0c\u4f1a\u7b49\u5f85\u6240\u6709\u673a\u5668\u6267\u884c\u5b8c\u6bd5\u518d\u5728\u524d\u53f0\u663e\u793a)</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#53-playbook\u7684\u8be6\u7ec6\u8bf4\u660e","title":"5.3 playbook\u7684\u8be6\u7ec6\u8bf4\u660e","text":""},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u5b9a\u4e49\u4e3b\u673a\u548c\u7528\u6237","title":"\u5b9a\u4e49\u4e3b\u673a\u548c\u7528\u6237","text":"<p>hosts \u5b9a\u4e49\u4e86\u4e3b\u673a\u6e05\u5355\u7684patterns \u6765\u786e\u5b9a\u54ea\u4e9b\u4e3b\u673a\u4e3a\u6267\u884c\u76ee\u6807\u3002remote_user\u6307\u5b9a\u6267\u884c\u76ee\u6807\u4e3b\u673a\u7684\u6267\u884c\u7528\u6237\u3002</p> <p><pre><code>- hosts: localhost\n  remote_user: root\n</code></pre> \u5982\u679c\u4f60\u60f3\u8981\u4e3a\u6267\u884c\u63d0\u5347\u6743\u9650\uff0c\u53ef\u4ee5\u8bbe\u7f6ebecome\u63d0\u6743\u53c2\u6570</p> <pre><code>---\n- hosts: webservers\nremote_user: git\nbecome: yes\n# \u5173\u95ed\u5173\u95ed\u81ea\u52a8\u91c7\u96c6Facts\ngather_facts: no\n</code></pre> <p>\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u6bcf\u4e2atask\u8bbe\u7f6e</p> <pre><code>---\n- hosts: webservers\n  remote_user: yourname\n  tasks:\n    - service:\n        name: nginx\n        state: started\n      become: yes\n      become_user: root\n      become_method: sudo\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u4efb\u52a1\u5217\u8868","title":"\u4efb\u52a1\u5217\u8868","text":"<p>\u6bcf\u4e2aplay\u5305\u542b\u4e00\u7ec4\u4efb\u52a1\u5217\u8868\uff0c \u4efb\u52a1\u4e4b\u95f4\u662f\u6309\u7167\u4ece\u4e0a\u5f80\u4e0b\u987a\u5e8f\u6267\u884c\u7684\uff0c\u6267\u884c\u5b8c\u4e0a\u4e00\u4e2a\u4efb\u52a1\u518d\u53bb\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1\u3002</p> <p>\u8fd0\u884c\u4ece\u4e0a\u5230\u4e0b\u8fd0\u884c\u7684\u5267\u672c\u65f6\uff0c\u4efb\u52a1\u5931\u8d25\u7684\u4e3b\u673a\u5c06\u4ece\u6574\u4e2a\u5267\u672c\u7684\u8f6e\u6362\u4e2d\u5220\u9664\u3002 \u5982\u679c\u5931\u8d25\uff0c\u53ea\u9700\u66f4\u6b63\u5267\u672c\u6587\u4ef6\u5e76\u91cd\u65b0\u8fd0\u884c\u5373\u53ef\u3002</p> <ul> <li>\u4f7f\u7528service\u6a21\u5757\u7684\u547d\u4ee4\u5982\u4e0b</li> </ul> <pre><code>tasks:\n- name: make sure apache is running\nservice:\nname: httpd\nstate: started\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528key=value\u7684\u5f62\u5f0f\u8868\u793a\u6a21\u5757\u53c2\u6570</p> <pre><code>tasks:\n- name: make sure apache is running\nservice: name=httpd state=started\n</code></pre> <ul> <li>\u4f7f\u7528command\u6a21\u5757\u7684\u547d\u4ee4\u5982\u4e0b</li> </ul> <p>command\u548cshell\u6a21\u5757\u53ea\u6709\u4e00\u7ec4\u53c2\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u5199\u5728\u6a21\u5757\u540e\u9762</p> <pre><code>tasks:\n- name: enable selinux\ncommand: /sbin/setenforce 1\n- name: run this command and ignore the result\nshell: /usr/bin/somecommand || /bin/true\n</code></pre> <p>\u5982\u679c\u60f3\u5ffd\u7565\u6a21\u5757\u7684\u6267\u884c\u9519\u8bef\uff0c\u53ef\u4ee5\u4e3a\u6a21\u5757\u6dfb\u52a0ignore_errors</p> <pre><code>tasks:\n  - name: run this command and ignore the result\n    shell: /usr/bin/somecommand\n    ignore_errors: True\n</code></pre> <p>\u5982\u679c\u884c\u592a\u957f\u4e86\uff0c\u53ef\u4ee5\u6362\u884c\u7f29\u8fdb\u8868\u793a</p> <pre><code>tasks:\n  - name: Copy ansible inventory file to client\n    copy: src=/etc/ansible/hosts dest=/etc/ansible/hosts\n            owner=root group=root mode=0644\n</code></pre> <ul> <li>\u4f7f\u7528copy\u6a21\u5757\u7684\u547d\u4ee4\u5982\u4e0b</li> </ul> <pre><code>tasks:\n  - name: Copy a new \"ntp.conf\" file into place, backing up the original if it differs from the copied version\n    copy:\n      src: /mine/ntp.conf\n      dest: /etc/ntp.conf\n      owner: root\n      group: root\n      mode: '0644'\n      backup: yes\n</code></pre> <ul> <li>\u4f7f\u7528template\u6a21\u5757\u7684\u547d\u4ee4\u5982\u4e0b</li> </ul> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cfvhost</p> <pre><code>tasks:\n  - name: create a virtual host file for {{ vhost }}\n    template:\n      src: somefile.j2\n      dest: /etc/httpd/conf.d/{{ vhost }}\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u4e8b\u4ef6\u5904\u7406handlers","title":"\u4e8b\u4ef6\u5904\u7406Handlers","text":"<p>\u8fd9\u4e9bnotify\u52a8\u4f5c\u5728play\u4e2d\u6bcf\u4e2a\u4efb\u52a1\u5757\u7ed3\u675f\u65f6\u89e6\u53d1\uff0c\u5e76\u4e14\u5373\u4f7f\u7531\u591a\u4e2a\u4e0d\u540c\u7684\u4efb\u52a1\u901a\u77e5\uff0c\u4e5f\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\u3002</p> <p><pre><code>- name: template configuration file\n  template:\n    src: template.j2\n    dest: /etc/foo.conf\n  notify:\n     - restart memcached\n     - restart apache\n\nhandlers:\n  - name: restart memcached\n    service:\n      name: memcached\n      state: restarted\n  - name: restart apache\n    service:\n      name: apache\n      state: restarted\n</code></pre> Handlers \u4e5f\u662f\u4efb\u52a1\u5217\u8868\uff0c\u4e0e\u5e38\u89c4\u4efb\u52a1\u6ca1\u6709\u4ec0\u4e48\u4e0d\u540c\uff0c\u5b83\u4eec\u7531\u5168\u5c40\u60df\u4e00\u7684\u540d\u79f0\u5f15\u7528\uff0c\u5e76\u7531notify\u52a8\u4f5c\u901a\u77e5\u3002 \u5982\u679c\u6ca1\u6709\u901a\u77e5\u5904\u7406\u7a0b\u5e8f\uff0c\u5b83\u5c06\u4e0d\u4f1a\u8fd0\u884c\u3002</p> <p>\u4e0d\u7ba1\u6709\u591a\u5c11\u4efb\u52a1\u901a\u77e5\u4e00\u4e2a\u5904\u7406\u7a0b\u5e8f\uff0c\u5b83\u90fd\u5c06\u53ea\u8fd0\u884c\u4e00\u6b21\uff0c\u5373\u5728\u4e00\u4e2a\u7279\u5b9aplay\u4e2d\u7684\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u4e4b\u540e\u3002</p> <p>Handlers \u91cc\u7684\u4efb\u52a1\u540d\u79f0 \u4e0d\u80fd\u4f7f\u7528 \u53d8\u91cf</p> <p>\u5728 ansible 2.2\u4e4b\u540e\uff0chandlers \u652f\u6301listen \u6765\u5b9e\u73b0\u76d1\u542c\u4e00\u4e2a\u901a\u77e5\u7a0b\u5e8f\u6765\u5b9e\u73b0\u6267\u884c\u591a\u4e2a\u901a\u77e5\u4efb\u52a1\u3002</p> <pre><code>handlers:\n    - name: restart memcached\n      service:\n        name: memcached\n        state: restarted\n      listen: \"restart web services\"\n    - name: restart apache\n      service:\n        name: apache\n        state: restarted\n      listen: \"restart web services\"\n\ntasks:\n    - name: restart everything\n      command: echo \"this task will restart the web services\"\n      notify: \"restart web services\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6761\u4ef6when\u8bed\u53e5","title":"\u6761\u4ef6when\u8bed\u53e5","text":"<p>ansible_os_family \u662f facts \u6216 vars \u7684\u53d8\u91cf</p> <pre><code>#  \u82e5\u64cd\u4f5c\u7cfb\u7edf\u662f Debian \u65f6\u5c31\u6267\u884c\u5173\u673a\u64cd\u4f5c\ntasks:\n    - name: \"shut down Debian flavored systems\"\n      command: /sbin/shutdown -t now\n      when: ansible_os_family == \"Debian\"\n</code></pre> <p>failed_when: \u6ee1\u8db3\u7ed9\u5b9a\u7684\u6761\u4ef6\u65f6\uff0c\u4f7f\u4efb\u52a1\u5931\u8d25</p> <pre><code>tasks:\n    - command: echo faild.\n      register: command_result\n      failed_when: \"'faild' in command_result.stdout\"\n\n    - debug: msg=\"echo test\"\n</code></pre> <p>\u4f7f\u7528\u6ce8\u518c\u53d8\u91cf\u5224\u65ad</p> <p>\u5c06\u7ed9\u5b9a\u547d\u4ee4\u7684\u7ed3\u679c\u5b58\u50a8\u5728\u53d8\u91cf\u4e2d\uff0c \u5e76\u5728\u540e\u7eed\u7684\u4efb\u52a1\u4e2d\u4f7f\u7528\u3002</p> <pre><code>- name: test play\n  hosts: all\n\n  tasks:\n    - shell: cat /etc/motd\n      register: motd_contents\n\n    - shell: echo \"motd contains the word hi\"\n      when: motd_contents.stdout.find('hi') != -1\n</code></pre> <p>\u4e00\u4e2a\u4f7f\u7528when\u7684\u793a\u4f8b</p> <pre><code>- name: Ensure docker history packages are removed.\n  yum: \"name={{ item }} state=removed\"\n  with_items: \"{{ docker_old }}\"\n\n- name: Ensure docker packages are installed.\n  yum: \"name={{ docker_packages }} state=installed  update_cache=yes\"\n\n- name: Install docker repo.\n  shell: \"yum-config-manager --add-repo {{ docker_repo }}\"\n\n- name: Modify the docker software source for keda.\n  replace:\n    path: /etc/yum.repos.d/docker-ce.repo\n    regexp: 'download\\.docker\\.com'\n    replace: \"mirrors.ustc.edu.cn/docker-ce\"\n\n- name: Create Docker config directory.\n  file: path=/etc/docker state=directory\n\n- name: Configure docker startup parameters.\n  template:\n    src: daemon.json.j2\n    dest: \"/etc/docker/daemon.json\"\n\n- name: Ensure docker-ce are installed.\n  yum: \"name={{ docker_ce_packages }} state=installed update_cache=yes enablerepo=docker-ce-stable\"\n\n- name: Set docker completion.\n  copy: src=/usr/share/bash-completion/completions/docker dest=/etc/bash_completion.d/docker remote_src=yes\n\n- name: Ensure docker is started and enabled at boot.\n  systemd: name=docker state=started enabled=yes\n  when: docker_start\n\n- name: Check if docker-compose file is already.\n  stat: path={{ docker_exec_path }}\n  register: docker_compose_result\n\n- name: Install docker-compose.\n  get_url: url={{ docker_compose_url }} dest={{ docker_exec_path }} validate_certs=no mode=0755\n  when: not docker_compose_result.stat.exists\n\n- name: docker-compose version.\n  command: docker-compose -version\n  register: version_result\n  changed_when: false\n  ignore_errors: True\n\n- debug: var=version_result.stdout\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u5faa\u73af\u8bed\u53e5","title":"\u5faa\u73af\u8bed\u53e5","text":"<p>\u6dfb\u52a0\u591a\u4e2a\u7528\u6237</p> <pre><code>- name: add several users\n  user:\n    name: \"{{ item }}\"\n    state: present\n    groups: \"wheel\"\n  loop:\n     - testuser1\n     - testuser2\n</code></pre> <pre><code>- name: Install Mysql package\n  yum: name={{ item }} state=present\n  with_items:\n   - mysql-server\n   - MySQL-python\n   - libselinux-python\n   - libsemanage-python\n</code></pre> <p>\u5faa\u73af\u8fd8\u652f\u6301\u5217\u8868\uff0c\u53ef\u4ee5\u901a\u8fc7with_flattened\u8bed\u53e5\u5b9e\u73b0</p> <pre><code>- name: Example with_flattened loop\n  hosts: localhost\n  gather_facts: false\n  vars:\n    my_list:\n      - [1, 2, 3]\n      - [4, 5, 6]\n      - [7, 8, 9]\n  tasks:\n    - name: Print item\n      debug:\n        msg: \"{{ item }}\"\n      with_flattened:\n        - \"{{ my_list }}\"\n</code></pre> <pre><code>ansible-playbook loop.yml -f 10\nPLAY [Example with_flattened loop] ******************************************************************************************************************************************************\n\nTASK [Print item] ***********************************************************************************************************************************************************************\nWednesday 09 August 2023  19:19:05 +0800 (0:00:00.018)       0:00:00.018 ******\nok: [localhost] =&gt; (item=1) =&gt; {\n\"msg\": 1\n}\nok: [localhost] =&gt; (item=2) =&gt; {\n\"msg\": 2\n}\nok: [localhost] =&gt; (item=3) =&gt; {\n\"msg\": 3\n}\nok: [localhost] =&gt; (item=4) =&gt; {\n\"msg\": 4\n}\nok: [localhost] =&gt; (item=5) =&gt; {\n\"msg\": 5\n}\nok: [localhost] =&gt; (item=6) =&gt; {\n\"msg\": 6\n}\nok: [localhost] =&gt; (item=7) =&gt; {\n\"msg\": 7\n}\nok: [localhost] =&gt; (item=8) =&gt; {\n\"msg\": 8\n}\nok: [localhost] =&gt; (item=9) =&gt; {\n\"msg\": 9\n}\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#6role\u89d2\u8272","title":"6.role\u89d2\u8272","text":"<p>\u5c42\u6b21\u5316\uff0c\u7ed3\u6784\u5316\u5730\u7ec4\u7ec7Playbook\uff0c\u4f7f\u7528\u89d2\u8272\uff08roles\uff09\uff0c\u53ef\u4ee5\u6839\u636e\u5c42\u6b21\u7ed3\u6784\u81ea\u52a8\u88c5\u8f7d\u53d8\u91cf\u6587\u4ef6\uff0ctasks\u4ee5\u53cahandlers\u7b49 roles\u5c31\u662f\u5c06\u53d8\u91cf\u3001\u6587\u4ef6\u3001\u4efb\u52a1\u3001\u6a21\u5757\u53ca\u5904\u7406\u5668\u8bbe\u7f6e\u4e8e\u5355\u72ec\u7684\u76ee\u5f55\u4e2d\uff0c\u4fbf\u6377\u5730\u4f7f\u7528\u5b83\u4eec</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#61-\u521b\u5efarole\u65b9\u5f0f\u4e00","title":"6.1 \u521b\u5efarole\u65b9\u5f0f\u4e00","text":"<pre><code>mkdir -p ansible_playbooks/roles/{websrvs,dbsrvs}/{tasks,files,templates,meta,handlers,vars}\nmkdir -p ansible_playbooks/group_vars/\ntouch ansible_playbooks/group_vars/vars.yml\ntouch ansible_playbooks/hosts\n``\n\u4e00\u4e2a\u5927\u578b\u9879\u76ee\u7ea7\u522b\u7684\u76ee\u5f55\u6846\u67b6\u5c31\u521b\u5efa\u5b8c\u6bd5\u3002\u5982\u4e0b\uff1a\n```shell\n[root@pxe-server ~]# tree ansible_playbooks/\nansible_playbooks/\n\u251c\u2500\u2500 group_vars\n\u2502    \u2514\u2500\u2500 vars.yml                 // \u5168\u5c40\u53d8\u91cf\n|   hosts\n\u2514\u2500\u2500 roles\n    \u251c\u2500\u2500 dbsrvs                      // dbsrvs\u5e94\u7528\u76ee\u5f55\n    \u2502    \u251c\u2500\u2500 files\n    \u2502    \u251c\u2500\u2500 handlers\n    \u2502    \u251c\u2500\u2500 meta\n    \u2502    \u251c\u2500\u2500 tasks\n    \u2502    \u251c\u2500\u2500 templates\n    \u2502    \u2514\u2500\u2500 vars\n    \u2514\u2500\u2500 websrvs                     // websrvs\u5e94\u7528\u76ee\u5f55\n        \u251c\u2500\u2500 files                   // \u5b89\u88c5\u5305\u3001\u914d\u7f6e\u6587\u4ef6\u3001\u811a\u672c\u6587\u4ef6\u76ee\u5f55\n        \u251c\u2500\u2500 handlers                // \u89e6\u53d1\u5668\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\n        \u251c\u2500\u2500 meta\n        \u251c\u2500\u2500 tasks                   // \u5404\u9879\u4efb\u52a1\u76ee\u5f55\n        \u251c\u2500\u2500 templates               // \u914d\u7f6e\u6a21\u677f\u6587\u4ef6\u76ee\u5f55 \u652f\u6301j2\u683c\u5f0f\n        \u2514\u2500\u2500 vars                    //\n17 directories, 0 files\n\n# \u6ce8\uff1afiles\u3001templates\u3001tasks\uff1a\u6240\u6709\u6587\u4ef6\u3001\u6a21\u677f\u90fd\u53ef\u4ee5\u653e\u5728\u8fd9\u91cc\uff0c\u653e\u5728\u8fd9\u91cc\u6700\u5927\u7684\u597d\u5904\u662f\u4e0d\u7528\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#62-\u521b\u5efarole\u65b9\u5f0f\u4e8c","title":"6.2 \u521b\u5efarole\u65b9\u5f0f\u4e8c","text":"<pre><code># - \u521b\u5efaroles\u76ee\u5f55\nmkdir -p /ansible/roles\ncd /ansible/roles\nansible-galaxy init backup\nansible-galaxy init nfs\nansible-galaxy init web\nansible-galaxy init lb\nansible-galaxy init db\nansible-galaxy init prometheus\nansible-galaxy init prometheus_db\nansible-galaxy init prometheus_web\n\n# - \u67e5\u770broles\u76ee\u5f55\u4e0b\u7684ansible\u6587\u4ef6\u8def\u5f84\ntree /ansible/roles/backup\n/ansible/roles/backup/\n\u251c\u2500\u2500 defaults                    \u5b58\u653e\u81ea\u5b9a\u4e49\u7684\u53d8\u91cf\u503c\n\u2502   \u2514\u2500\u2500 main.yml\n\u251c\u2500\u2500 files                       \u653e\u7f6e\u538b\u7f29\u5305,\u4f7f\u7528\u6587\u4ef6\n\u251c\u2500\u2500 handlers                    \u6267\u884c\u5267\u672c\u6587\u4ef6\u7684\u76ee\u5f55\n\u2502   \u2514\u2500\u2500 main.yml\n\u251c\u2500\u2500 meta\n\u2502   \u2514\u2500\u2500 main.yml\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 tasks                       \u6267\u884c\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\n\u2502   \u2514\u2500\u2500 main.yml\n\u251c\u2500\u2500 templates                   \u5206\u53d1\u7684\u6a21\u677f\u6587\u4ef6\u7684\u76ee\u5f55,\u6a21\u677f\u6587\u4ef6\u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u53d8\u91cf\u4fe1\u606f\n\u251c\u2500\u2500 tests\n\u2502   \u251c\u2500\u2500 inventory\n\u2502   \u2514\u2500\u2500 test.yml\n\u2514\u2500\u2500 vars\n    \u2514\u2500\u2500 main.yml\n\n8 directories, 8 files\n</code></pre> <p>\u53ef\u4ee5\u5199\u6210\u4e00\u4e2a\u811a\u672c\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <ul> <li>create_role.sh</li> </ul> <pre><code>#!/bin/bash\nwork=\"$(dirname $0)/..\"\nrole_name=$1\nwork_path=$work/$role_name\nroles_path=$work_path/roles/$role_name\nmkdir -p $work_path\nmkdir -p $work_path/group_vars\nmkdir -p $roles_path/defaults\nmkdir -p $roles_path/tasks\nmkdir -p $roles_path/handlers\nmkdir -p $roles_path/templates\nmkdir -p $roles_path/files\nmkdir -p $roles_path/vars\nmkdir -p $roles_path/meta\n\ntouch $roles_path/defaults/main.yml\ntouch $roles_path/tasks/main.yml\ntouch $roles_path/handlers/main.yml\ntouch $roles_path/vars/main.yml\ntouch $roles_path/meta/main.yml\ntouch $work_path/group_vars/all\n\ncat &gt; $work_path/site.yml &lt;&lt; _addroleyml\n---\n- hosts: all\n  gather_facts: True\n  roles:\n    - { role: common , tags: \"common\"}\n    - { role: collectd , tags: \"collectd\"}\n    - { role: zabbix , tags: \"zabbix\"}\n    - { role: $role_name , tags: \"$role_name\"}\n_addroleyml\n</code></pre> <p>\u4f7f\u7528Roles\u6807\u51c6\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff08\u4f7f\u7528tree\u547d\u4ee4\u8fd4\u56de\u7684\u7ed3\u679c\uff09\uff1a</p> <pre><code>fab2ansible\n\u251c\u2500\u2500 group_vars\n\u2502   \u2514\u2500\u2500 all\n\u251c\u2500\u2500 roles\n\u2502   \u251c\u2500\u2500 git\n\u2502   \u2502   \u251c\u2500\u2500 files\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 main.yml\n\u2502   \u2502   \u251c\u2500\u2500 tasks\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 create_dir.yml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 git_checkout.yml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 main.yml\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 static_git_pull.yml\n\u2502   \u2502   \u2514\u2500\u2500 vars\n\u2502   \u2502       \u2514\u2500\u2500 main.yml\n\u2502   \u2514\u2500\u2500 user\n\u2502       \u251c\u2500\u2500 tasks\n\u2502       \u2502   \u251c\u2500\u2500 main.yml\n\u2502       \u2502   \u2514\u2500\u2500 user-config.yml\n\u2502       \u2514\u2500\u2500 vars\n\u2502           \u2514\u2500\u2500 main.yml\n\u2514\u2500\u2500 userconf.yml\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>ansible\u5267\u672c \u4e00\u952e\u6267\u884c\u8d1f\u8f7d\u5747\u8861+Keepalived+web\u96c6\u7fa4+mysql+redis+NFS+Rsync\u6570\u636e\u540c\u6b65+Prometheus+Grafana\u76d1\u63a7\u6570\u63a7\u5e93\u548cweb\u96c6\u7fa4</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#63-\u591a\u91cd\u53d8\u91cf\u5b9a\u4e49","title":"6.3 \u591a\u91cd\u53d8\u91cf\u5b9a\u4e49","text":"<p>\u53d8\u91cf\u9664\u4e86\u53ef\u4ee5\u5728Inventory\u4e2d\u4e00\u5e76\u5b9a\u4e49\uff0c\u4e5f\u53ef\u4ee5\u72ec\u7acb\u4e8eInventory\u6587\u4ef6\u4e4b\u5916\u5355\u72ec\u5b58\u50a8\u5230YAML\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e9b\u6587\u4ef6\u901a\u5e38\u4ee5.yml\u3001.yaml\u3001.json\u4e3a\u540e\u7f00\u6216\u8005\u65e0\u540e\u7f00\u3002\u53d8\u91cf\u901a\u5e38\u4ece\u5982\u4e0b4\u4e2a\u4f4d\u7f6e\u68c0\u7d22\uff1a</p> <p><pre><code>- Inventory\u914d\u7f6e\u6587\u4ef6\uff08\u9ed8\u8ba4/etc/ansible/hosts\uff09\n\n- Playbook\u4e2dvars\u5b9a\u4e49\u7684\u533a\u57df\n\n- Roles\u4e2dvars\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\n\n- Roles\u540c\u7ea7\u76ee\u5f55group_vars\u548chosts_vars\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\n</code></pre> \u5bf9\u4e8e\u53d8\u91cf\u7684\u8bfb\u53d6\uff0cAnsible\u9075\u5faa\u5982\u4e0a\u4f18\u5148\u7ea7\u987a\u5e8f\uff0c\u56e0\u6b64\u5927\u5bb6\u8bbe\u7f6e\u53d8\u91cf\u65f6\u5c3d\u91cf\u6cbf\u7528\u540c\u4e00\u79cd\u65b9\u5f0f\uff0c\u4ee5\u65b9\u4fbf\u7ef4\u62a4\u4eba\u5458\u7ba1\u7406\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#64-ansible\u7684\u5185\u7f6e\u53d8\u91cf\u53c2\u6570","title":"6.4 Ansible\u7684\u5185\u7f6e\u53d8\u91cf\u53c2\u6570","text":"<p>ansible\u5185\u7f6e\u4e86\u5f88\u591a\u5176\u4ed6\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u5176\u4ea4\u4e92\u65b9\u5f0f\uff0c\u5982\u4e0b\u5217\u4e3e\u4e86\u90e8\u5206\u91cd\u8981\u53c2\u6570\uff1a</p> <pre><code>ansible_host\uff1a\u4f7f\u7528\u4e3b\u673a\u7684\u540d\u79f0\u53bb\u8fde\u63a5\uff0c\u53ef\u4ee5\u4f7f\u7528\u522b\u540d\nansible_port\uff1a\u5982\u679c\u9ed8\u8ba4\u4e0d\u662f22\u7684\u8bdd\uff0c\u8981\u5b9a\u4e49ssh\u7684\u7aef\u53e3\u53f7\nansible_user\uff1a\u9ed8\u8ba4ssh\u8fde\u63a5\u7528\u6237\nansible_ssh_pass\uff1a\u9ed8\u8ba4ssh \u8fde\u63a5\u7684passwd\uff08\u4e0d\u8981\u5728\u8fd9\u91cc\u51fa\u73b0\u660e\u6587\u5bc6\u7801\uff0c\u800c\u662f\u8981\u4f7f\u7528vault\uff09\nansible_ssh_private_key_file\uff1a\u8fde\u63a5\u65f6\u4f7f\u7528\u79c1\u94a5\u6587\u4ef6\u3002\u5982\u679c\u4e0d\u60f3\u4f7f\u7528ssh\u4ee3\u7406\u7684\u8bdd\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\u5bc6\u94a5\nansible_ssh_common_args\uff1a\u8be5\u8bbe\u7f6e\u5c06\u603b\u662f\u4e3asftp,scp,ssh\u9644\u52a0\u5230\u547d\u4ee4\u884c\uff0c\u53ef\u7528\u4e8e\u4e3a\u67d0\u4e2a\u4e3b\u673a\u6216\u7ec4\u914d\u7f6eProxyCommand\nansible_sftp_extra_args\uff1a\u8be5\u8bbe\u7f6e\u5c06sftp\u9644\u52a0\u5230\u547d\u4ee4\u884c\nansible_scp_extra_args\uff1a\u8be5\u8bbe\u7f6e\u5c06scp\u9644\u52a0\u5230\u547d\u4ee4\u884c\nansible_ssh_extra_args\uff1a\u8be5\u8bbe\u7f6e\u5c06ssh\u9644\u4ef6\u5230\u547d\u4ee4\u884c\nansible_ssh_pipelining\uff1a\u51b3\u5b9a\u662f\u5426\u4f7f\u7528ssh \u7ba1\u9053\uff0c\u5b83\u5c06\u8986\u76d6ansible.cfg\u4e2d\u7684pipelining\u8bbe\u7f6e\n\n# 2.2\u7248\u672c\u540e\u7684\u7279\u6027.\nansible_ssh_executable\uff1a\u8fd9\u4e2a\u8bbe\u7f6e\u5c06\u8986\u76d6\u4f7f\u7528\u7cfb\u7edfssh\u7684\u9ed8\u8ba4\u884c\u4e3a\u3002\u5b83\u5c06\u8986\u76d6ansible.cfg\u4e2d\u7684ssh_executable\u8bbe\u7f6e\n\u4f7f\u7528\u7279\u6743\u547d\u4ee4\uff08\u5982sudo\uff09\n\nansible_become\uff1a\u5141\u8bb8\u5347\u7ea7\u6743\u9650\uff0c\u76f8\u5f53\u4e8e ansible_sudo \u6216\u8005 ansible_su\nansible_become_method\uff1a\u5141\u8bb8\u8bbe\u7f6e\u7279\u6b8a\u6743\u9650\u7684\u65b9\u6cd5\nansible_become_user\uff1a\u5141\u8bb8\u8bbe\u7f6e\u7279\u6b8a\u6743\u9650\u7684\u7528\u6237\uff0c\u76f8\u5f53\u4e8e ansible_sudo_user \u6216\u8005 ansible_su_user\nansible_become_pass\uff1a\u5141\u8bb8\u8bbe\u7f6e\u7279\u6b8a\u6743\u9650\u7684\u5bc6\u7801\uff08\u4e0d\u8981\u5728\u8fd9\u91cc\u76f4\u63a5\u8f93\u5165\u660e\u6587\uff09\uff0c\u76f8\u5f53\u4e8e ansible_sudo_pass \u6216\u8005 ansible_su_pass\n</code></pre> <p>\u53ef\u4ee5\u53c2\u8003\u4e0b\u9762\u6587\u732e\uff1a</p> <p>\u4f7f\u7528\u5185\u7f6e\u53d8\u91cf</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#65-roles\u6280\u5de7\u4e4bfiles","title":"6.5 Roles\u6280\u5de7\u4e4bFiles","text":"<p>Files\u548cTemplates\u5747\u7528\u4e8eAnsible\u6587\u4ef6\u5904\u7406\uff0c\u4e24\u8005\u4e3b\u8981\u533a\u522b\u662f\uff1aFiles\uff08\u4e0d\u662ffile\u6a21\u5757\uff09\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u65e0\u9700\u5199\u7edd\u5bf9\u8def\u5f84\u5373\u53ef\u5c06\u6587\u4ef6\u4f20\u8f93\u81f3\u8fdc\u7a0b\u4e3b\u673a\uff1bTemplates\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4ee5Jinja2\u6e32\u67d3\uff0c\u4e14\u4f20\u8f93\u6587\u4ef6\u81f3\u8fdc\u7a0b\u4e3b\u673a\u7684\u540c\u65f6\u652f\u6301\u9884\u5b9a\u4e49\u53d8\u91cf\u66ff\u6362</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa41-\u7f16\u6392\u76ee\u5f55\u7ed3\u6784","title":"\u6b65\u9aa41: \u7f16\u6392\u76ee\u5f55\u7ed3\u6784","text":"<p>\u7f16\u6392\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b:</p> <p><pre><code>file.yml\nroles/example/\n\u251c\u2500\u2500 files\n\u2502   \u251c\u2500\u2500 MAGEDU.PPT\n\u2502   \u2514\u2500\u2500 STANLEY.PPT\n\u251c\u2500\u2500 tasks\n\u2502   \u251c\u2500\u2500 file.yml\n\u2502   \u2514\u2500\u2500 main.yml\n</code></pre> ./file.yml\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>---\n# \u8be5playbook\u662f\u6574\u4e2a\u9879\u76ee\u7684\u8c03\u5ea6\u5165\u53e3\n\n- hosts: 192.168.37.142\n  remote_user: root\n  gather_facts: false\n\n  roles:\n    - role: example\n</code></pre> <p>./roles/example/tasks/file.yml\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>---\n\n- name: file change example\n  # copy: src=MAGEDU.PPT  dest=/data/magedu.ppt owner=stanley group=stanley\n  copy: src={{ item.src }}  dest=/data/{{ item.dest }} owner=stanley group=stanley\n  with_items:\n      - { src: 'MAGEDU.PPT', dest: 'magedu.ppt' }\n      - { src: 'STANLEY.PPT', dest: 'stanley.ppt' }\n</code></pre> <p>./roles/example/tasks/main.yml\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>---\n\n- include: file.yml\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa42-\u4f20\u8f93\u6587\u4ef6","title":"\u6b65\u9aa42: \u4f20\u8f93\u6587\u4ef6","text":"<p>\u4f20\u8f93\u6587\u4ef6\u5230\u8fdc\u7a0b\u4e3b\u673a\u5e76\u4fee\u6539\u6587\u4ef6\u540d\u4e3a\u82f1\u6587\u5c0f\u5199\u3002</p> <p>\u5728roles\u76ee\u5f55\u540c\u7ea7\u76ee\u5f55\u4e0b\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>ansible-playbook file.yml\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#66-roles\u6280\u5de7\u4e4btemplates","title":"6.6 Roles\u6280\u5de7\u4e4bTemplates","text":"<p>Templates\u5e38\u88ab\u7528\u4f5c\u4f20\u8f93\u6587\u4ef6\uff0c\u540c\u65f6\u652f\u6301\u9884\u5b9a\u4e49\u53d8\u91cf\u66ff\u6362\u3002\u56e0Templates\u7531Jinja2\u6e32\u67d3\u683c\u5f0f\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa41\u7f16\u6392\u76ee\u5f55","title":"\u6b65\u9aa41:\u7f16\u6392\u76ee\u5f55","text":"<p>\u7f16\u6392\u76ee\u5f55\u5982\u4e0b\u3002</p> <pre><code>template.yml\nroles/template/\n\u251c\u2500\u2500 tasks\n\u2502   \u251c\u2500\u2500 main.yml\n\u2502   \u2514\u2500\u2500 template.yml\n\u251c\u2500\u2500 templates\n\u2502   \u2514\u2500\u2500 order.j2\n\u2514\u2500\u2500 vars\n    \u2514\u2500\u2500 main.yml\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa42-\u7f16\u8f91\u603b\u8c03\u5ea6\u6587\u4ef6","title":"\u6b65\u9aa42: \u7f16\u8f91\u603b\u8c03\u5ea6\u6587\u4ef6","text":"<p>\u4f9d\u6b21\u7f16\u8f91tempates.yml(\u548croles\u76ee\u5f55\u540c\u7ea7)\u4efb\u52a1\u603b\u8c03\u5ea6\u6587\u4ef6\u3002</p> <pre><code>---\n# \u8be5playbook\u662f\u6574\u4e2a\u9879\u76ee\u7684\u8c03\u5ea6\u5165\u53e3\n\n- hosts: 192.168.37.142\n  remote_user: root\n  gather_facts: false\n\n  roles:\n    - role: template\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa43-\u7f16\u8f91\u4efb\u52a1\u5b9a\u4e49\u6587\u4ef6","title":"\u6b65\u9aa43: \u7f16\u8f91\u4efb\u52a1\u5b9a\u4e49\u6587\u4ef6","text":"<p>\u4f9d\u6b21\u7f16\u8f91roles/template/tasks/{main.yml\uff0ctemplate.yml}\u4efb\u52a1\u5b9a\u4e49\u6587\u4ef6\u3002</p> <p>\u7f16\u8f91main.yml\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>---\n\n- include: template.yml\n</code></pre> <p>main.yml\u53ef\u901a\u8fc7Include\u7075\u6d3b\u5f15\u7528\u6240\u9700\u7684\u529f\u80fd\u7ec4\u4ef6\uff0c\u4e0d\u4ec5\u662f\u5f53\u524d\u76ee\u5f55\u4e0b\u7684YML\uff0c\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6Roles\u4e0b\u7684YML\u3002</p> <p>\u7f16\u8f91template.yml\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>---\n\n- name: tempalte transfer example\n  template: src=order.j2 dest=/data/{{ PROJECT }}/order.conf\n</code></pre> <p><code>{{PROJECT}}</code>\u7684\u53d8\u91cf\u5f15\u7528\u65b9\u5f0f\u5373\u672c\u8282\u4f0a\u59cb\u63d0\u5230\u7684Jinja2\u683c\u5f0f\u3002</p> <p>\u6e90\u6587\u4ef6\u662forder.j2\uff0c\u8fdc\u7a0b\u76ee\u5f55\u53ca\u76ee\u7684\u6587\u4ef6\u540d\u5206\u522b\u662f<code>/data/{{PROJECT}}/</code>\u548c<code>order.conf</code>\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa44-\u7f16\u8f91\u6a21\u677f\u6587\u4ef6","title":"\u6b65\u9aa44: \u7f16\u8f91\u6a21\u677f\u6587\u4ef6","text":"<p>\u7f16\u8f91roles/template/templates/order.j2\uff0c\u5b9a\u4e49\u6a21\u677f\u6587\u4ef6\u3002</p> <pre><code>project: {{ PROJECT }}\nswitch: {{ SWITCH }}\ndbport: {{ DBPORT }}\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa45-\u5b9a\u4e49\u53d8\u91cf","title":"\u6b65\u9aa45: \u5b9a\u4e49\u53d8\u91cf","text":"<p>\u7f16\u8f91roles/template/vars/main.yml\uff0c\u5b9a\u4e49\u53d8\u91cf\u3002</p> <pre><code>---\nPROJECT: \"JAVA\"\nSWITCH: \"ON\"\nDBPORT: \"3306\"\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa46-\u6267\u884c\u547d\u4ee4","title":"\u6b65\u9aa46: \u6267\u884c\u547d\u4ee4","text":"<p>\u6211\u4eec\u6765\u6267\u884c\u547d\u4ee4\u5e76\u770b\u4e0b\u8fd4\u56de\u53ca\u7ed3\u679c\u3002</p> <p>\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>ansible-playbook template.yml\n</code></pre> <p>Roles\u4e2dFiles\u548cTemplates\u7684\u533a\u522b</p> <ul> <li> <p>Files\uff1a\u7528\u4e8e\u6587\u4ef6\u5904\u7406\uff0c\u6587\u4ef6\u65e0\u9700\u5199\u7edd\u5bf9\u8def\u5f84\u5373\u53ef\u5c06\u6587\u4ef6\u4f20\u8f93\u81f3\u8fdc\u7a0b\u4e3b\u673a</p> </li> <li> <p>Templates\u76ee\u5f55\u4e0b\u6587\u4ef6\u4ee5Jinja2\u6e32\u67d3\uff0c\u4e14\u4f20\u8f93\u6587\u4ef6\u81f3\u8fdc\u7a0b\u4e3b\u673a\u7684\u540c\u65f6\u652f\u6301\u9884\u5b9a\u4e49\u53d8\u91cf\u66ff\u6362\u3002\u901a\u5e38\u5f15\u7528\u66ff\u6362\u53d8\u91cf\u7684\u7684\u683c\u5f0f\u4e3a {{variable}}\u3002</p> </li> </ul>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#67-\u521b\u5efaroles\u65f6\u7684\u6ce8\u610f\u4e8b\u9879","title":"6.7 \u521b\u5efaroles\u65f6\u7684\u6ce8\u610f\u4e8b\u9879","text":"<pre><code>\uff081\uff09 \u76ee\u5f55\u540d\u540c\u89d2\u8272\u540d\u7684\u5b9a\u4e49\n\n\uff082\uff09 \u76ee\u5f55\u7ed3\u6784\u6709\u56fa\u5b9a\u683c\u5f0f\n\n      1\uff09files: \u9759\u6001\u6587\u4ef6\uff1b\n\n      2\uff09templates: Jinja2\u6a21\u677f\u6587\u4ef6\uff1b\n\n      3\uff09tasks: \u81f3\u5c11\u6709\u4e00\u4e2amain.yml\u6587\u4ef6,\u5b9a\u4e49\u5404tasks\uff1b\n\n      4\uff09handlers: \u81f3\u5c11\u6709\u4e00\u4e2amain.yml\u6587\u4ef6\uff0c\u5b9a\u4e49\u5404handlers\uff1b\n\n      5\uff09vars: \u81f3\u5c11\u6709\u4e00\u4e2amain.yml\u6587\u4ef6\uff0c\u5b9a\u4e49\u53d8\u91cf\uff1b\n\n      6\uff09meta: \u5b9a\u4e49\u4f9d\u8d56\u5173\u7cfb\u7b49\u4fe1\u606f\n\n(3) \u5728roles\u4e4b\u5916\uff0c\u901a\u8fc7site.yml\u5b9a\u4e49Playbook\uff0c\u989d\u5916\u4e5f\u53ef\u4ee5\u6709\u5176\u4ed6\u7684yml\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#68-\u6848\u4f8b-ansible\u7ed3\u5408jinja2\u751f\u6210nginx\u914d\u7f6e","title":"6.8 \u6848\u4f8b-Ansible\u7ed3\u5408Jinja2\u751f\u6210Nginx\u914d\u7f6e","text":""},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa41-\u7f16\u6392\u76ee\u5f55","title":"\u6b65\u9aa41 \uff1a\u7f16\u6392\u76ee\u5f55","text":"<pre><code>$ ansible-galaxy init nginxconf\n\n$ tree roles/\nroles/\n\u251c\u2500\u2500 01.nginxconf.yml\n\u2514\u2500\u2500 nginxconf\n    \u251c\u2500\u2500 defaults\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 files\n    \u251c\u2500\u2500 handlers\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 meta\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 README.md\n    \u251c\u2500\u2500 tasks\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 file.yml\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 templates\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 nginx.conf.j2\n    \u251c\u2500\u2500 tests\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 inventory\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 test.yml\n    \u2514\u2500\u2500 vars\n        \u2514\u2500\u2500 main.yml\n\n9 directories, 11 files\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa42-\u7f16\u8f91role\u7684tasks\u8c03\u5ea6\u6587\u4ef6","title":"\u6b65\u9aa42 \uff1a\u7f16\u8f91role\u7684tasks\u8c03\u5ea6\u6587\u4ef6","text":"<p>\u8c03\u5ea6\u6587\u4ef6roles/nginx/tasks/{file.yml\uff0cmain.yml}\u3002</p> <p>\u7f16\u8f91file.yml\uff0c\u5b9a\u4e49nginxconf role\u7684\u4e00\u4e2a\u529f\u80fd\u96c6\uff08\u4e00\u4e2a\u6587\u4ef6\u4e00\u4e2a\u529f\u80fd\u96c6\uff09\u3002</p> <p><code>file.yml</code></p> <pre><code>---\n\n- name: nginx.conf.j2 tempalte transfer example\n  template:\n    src: nginx.conf.j2\n    dest: /tmp/nginx.conf.template\n</code></pre> <p>\u7f16\u8f91main.yml\uff0c\u5b9a\u4e49\u4efb\u52a1\u529f\u80fd\u96c6\u5408\u3001nginxconf role\u529f\u80fd\u96c6\u5165\u53e3\u3002</p> <p><code>main.yml</code></p> <pre><code>---\n\n- include: file.yml\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa43-\u5b9a\u4e49role\u7684\u6a21\u677f\u6587\u4ef6","title":"\u6b65\u9aa43 \uff1a\u5b9a\u4e49role\u7684\u6a21\u677f\u6587\u4ef6","text":"<p><code>roles/nginxconf/templates/nginx.conf.j2</code>\uff0c\u8be5\u6a21\u677f\u7684\u7075\u6d3b\u6027\u5c06\u76f4\u63a5\u5f71\u54cdAnsible-playbook\u7684\u4ee3\u7801\u884c\u6570\u548c\u6574\u4f53Playbook\u7684\u7075\u6d3b\u6027\u5065\u58ee\u6027\uff0c\u8be5\u6a21\u677f\u6587\u4ef6\u5c06\u88ab\u66ff\u6362\u53d8\u91cf\u540e\u751f\u6210\u6700\u7ec8\u7684Nginx\u914d\u7f6e\u6587\u4ef6\u3002</p> <pre><code>{% if nginx_use_proxy %}\n{% for proxy in nginx_proxies %}\nupstream {{ proxy.name }} {\n    # server 127.0.0.1:{{ proxy.port }};\n    server {{ ansible_eth0.ipv4.address }}:{{ proxy.port }};\n}\n{% endfor %}\n{% endif %}\nserver {\n    listen 80;\n    server_name {{ nginx_server_name }};\n    access_log off;\n    error_log /dev/null crit;\n    rewrite ^ https:// $server_name$request_uri? permanent;\n}\nserver {\n    listen 443 ssl;\n    server_name {{ nginx_server_name }};\n    ssl_certificate /etc/nginx/ssl/{{ nginx_ssl_cert_name }};\n    ssl_certificate_key /etc/nginx/ssl/{{ nginx_ssl_cert_key }};\n\n    root {{ nginx_web_root }};\n    index index.html index.html;\n\n{% if nginx_use_auth %}\n    auth_basic            \"Restricted\";\n    auth_basic_user_file  /etc/nginx/{{project_name}}.htpasswd;\n{% endif %}\n\n{% if nginx_use_proxy %}\n{% for proxy in nginx_proxies %}\n\n    location {{ proxy.location }} {\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-Proto http;\n        proxy_set_header X-Url-Scheme $scheme;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header X-NginX-Proxy true;\n        proxy_redirect off;\n        proxy_pass http://{{ proxy.name }};\n        break;\n    }\n{% endfor %}\n{% endif %}\n\n{% if nginx_server_static %}\n    location / {\n        try_files $uri $uri/ =404;\n    }\n\n{% endif %}\n}\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa44-\u7f16\u8f91role\u7684\u53d8\u91cf\u6587\u4ef6","title":"\u6b65\u9aa44 \uff1a\u7f16\u8f91role\u7684\u53d8\u91cf\u6587\u4ef6","text":"<p><code>roles/nginxconf/vars/main.yml</code></p> <pre><code>---\n\nnginx_server_name: www.magedu.com\nnginx_web_root: /opt/magedu/\nnginx_proxies:\n  - name: suspicious\n    location: /\n    port: 2368\n  - name: suspicious-api\n    location: /api\n    port: 3000\n</code></pre> <p>\u8be5\u53d8\u91cf\u6587\u4ef6\u9700\u8981\u5173\u6ce8\u7684\u662fnginx_proxies\u5b9a\u4e49\u7684\u53d8\u91cf\u7ec4\uff0c\u5176\u4e0b\u7684\u53d8\u91cf\u5217\u8868\u901a\u8fc7for\u5faa\u73af\u8bfb\u53d6\u540e\u53ef\u4ee5\u901a\u8fc7\u201c.\u201d\u6765\u5f15\u7528\uff0c\u5373\u5982\u4e0bproxy.name\u8fd9\u6837\u7684\u5f15\u7528\u65b9\u5f0f\u3002</p> <pre><code>{% for proxy in nginx_proxies %}\n\nupstream {{ proxy.name }} {\n    # server 127.0.0.1:{{ proxy.port }};\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa45-\u7f16\u8f91\u603b\u8c03\u5ea6\u6587\u4ef601nginxconfyml","title":"\u6b65\u9aa45 \uff1a\u7f16\u8f91\u603b\u8c03\u5ea6\u6587\u4ef601.nginxconf.yml","text":"<p><code>roles/01.nginxconf.yml</code></p> <pre><code>- name: Nginx Proxy Server's Conf Dynamic Create\n  hosts: \"192.168.240.12\"\n  vars:\n      nginx_use_proxy: true\n      nginx_ssl_cert_name: ifa.crt\n      nginx_ssl_cert_key: ifa.key\n      nginx_use_auth: true\n      project_name: suspicious\n      nginx_server_static: true\n  gather_facts: true\n\n  roles:\n      - { role: nginxconf }\n\n- name: Nginx WebServer's Conf Dynamic Create\n  hosts: \"192.168.240.14\"\n  vars:\n      nginx_use_proxy: false\n      nginx_ssl_cert_name: ifa.crt\n      nginx_ssl_cert_key: ifa.key\n      nginx_use_auth: false\n      project_name: suspicious\n      nginx_server_static: false\n  # \u5173\u95ed\u5173\u95ed\u81ea\u52a8\u91c7\u96c6Facts\n  gather_facts: no\n\n  roles:\n      - { role: nginxconf }\n</code></pre> <p>\u5728nginxconf.yml\u6587\u4ef6\u4e2d\uff0c\u540c\u6837\u6211\u4eec\u4e5f\u5b9a\u4e49nginx_use_proxy\u3001nginx_ssl_cert_name\u3001nginx_ssl_cert_key\u3001nginx_use_auth\u3001project_name\u3001nginx_server_static\u7b49\u53d8\u91cf\uff0c\u540c\u65f6\u4e0d\u540c\u7c7b\u578b\u7684\u4e3b\u673a\u5b9a\u4e49\u7684\u4e0d\u540c\u53d8\u91cf\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\u4e5f\u4e0d\u5c3d\u76f8\u540c\uff0cAnsible\u7684\u7075\u6d3b\u6027\u53ef\u89c1\u4e00\u6591\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u6b65\u9aa46-\u9a8c\u8bc1\u7ed3\u679c","title":"\u6b65\u9aa46 \uff1a\u9a8c\u8bc1\u7ed3\u679c\u3002","text":"<p>\u6267\u884c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>ansible-playbook 01.nginxconf.yml -f 6\n</code></pre> <p>\u7136\u540e\u767b\u5f55\u5230NginxWeb192.168.240.12\u67e5\u770b/etc/nginx/nginx.conf.template\u914d\u7f6e\u6587\u4ef6\uff0c\u7c7b\u4f3c\u5982\u4e0b\u8f93\u51fa\u8868\u793a\u8fbe\u5230\u6211\u4eec\u7684\u9884\u671f\u3002</p> <pre><code>; cat /tmp/nginx.conf.template \nupstream suspicious {\n    # server 127.0.0.1:2368;\n    server 192.168.240.12:2368;\n}\nupstream suspicious-api {\n    # server 127.0.0.1:3000;\n    server 192.168.240.12:3000;\n}\nserver {\n    listen 80;\n    server_name www.magedu.com;\n    access_log off;\n    error_log /dev/null crit;\n    rewrite ^ https:// $server_name$request_uri? permanent;\n}\nserver {\n    listen 443 ssl;\n    server_name www.magedu.com;\n    ssl_certificate /etc/nginx/ssl/ifa.crt;\n    ssl_certificate_key /etc/nginx/ssl/ifa.key;\n\n    root /opt/magedu/;\n    index index.html index.html;\n\n    auth_basic            \"Restricted\";\n    auth_basic_user_file  /etc/nginx/suspicious.htpasswd;\n\n    location / {\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-Proto http;\n        proxy_set_header X-Url-Scheme $scheme;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header X-NginX-Proxy true;\n        proxy_redirect off;\n        proxy_pass http://suspicious;\n        break;\n    }\n\n    location /api {\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-Proto http;\n        proxy_set_header X-Url-Scheme $scheme;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header X-NginX-Proxy true;\n        proxy_redirect off;\n        proxy_pass http://suspicious-api;\n        break;\n    }\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n\n}\n</code></pre> <p>\u540c\u7406\uff0c\u767b\u5f55\u5230NginxProxy\u4e3b\u673a\uff0c\u67e5\u770b\u5176\u4e2d\u4e00\u53f0Proxy\u7684nginx.conf.template\u914d\u7f6e\uff0c\u7c7b\u4f3c\u5982\u4e0b\u8f93\u51fa\u8868\u793a\u8fbe\u5230\u6211\u4eec\u7684\u9884\u671f\u3002</p> <pre><code>; cat /tmp/nginx.conf.template \nserver {\n    listen 80;\n    server_name www.magedu.com;\n    access_log off;\n    error_log /dev/null crit;\n    rewrite ^ https:// $server_name$request_uri? permanent;\n}\nserver {\n    listen 443 ssl;\n    server_name www.magedu.com;\n    ssl_certificate /etc/nginx/ssl/ifa.crt;\n    ssl_certificate_key /etc/nginx/ssl/ifa.key;\n\n    root /opt/magedu/;\n    index index.html index.html;\n}\n</code></pre> <p>\u540c\u6837\u7684\u6a21\u677f\uff0c\u901a\u8fc7\u7b80\u5355\u7684if\u548c\u53d8\u91cf\u8bbe\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u4e0d\u540c\u7c7b\u578b\u4e3b\u673a\u7684Nginxconf\u914d\u7f6e\uff0c\u6240\u4ee5\u5728\u4e86\u89e3Ansible\u5f3a\u5927\u7684\u6a21\u677f\u529f\u80fd\u7684\u540c\u65f6\uff0c\u4e5f\u663e\u793a\u51fa\u6a21\u677f\u8d28\u91cf\u7684\u91cd\u8981\u6027\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#69-\u6848\u4f8b-ansible\u90e8\u7f72\u4e00\u4e3b\u591a\u4ecemysql\u96c6\u7fa4","title":"6.9 \u6848\u4f8b-Ansible\u90e8\u7f72\u4e00\u4e3b\u591a\u4eceMySQL\u96c6\u7fa4","text":"<p>\u90e8\u7f72\u76ee\u6807</p> <ol> <li> <p>\u5feb\u901f\u90e8\u7f72\u4e00\u5957\u4e00\u4e3b\u4e24\u4ece\u7684mysql\u96c6\u7fa4</p> </li> <li> <p>\u90e8\u7f72\u8fc7\u7a0b\u4e2d\u652f\u6301\u4ea4\u4e92\u5f0f\u5b9a\u4e49\u5b89\u88c5\u76ee\u5f55\u53ca\u76d1\u542c\u7aef\u53e3\u53f7</p> </li> </ol>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u76ee\u5f55\u7ed3\u6784","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>root@master:/opt/mysql# tree .\n.\n\u251c\u2500\u2500 group_vars\n\u2502   \u2514\u2500\u2500 all.yml\n\u251c\u2500\u2500 hosts\n\u251c\u2500\u2500 mysql.yml\n\u2514\u2500\u2500 roles\n    \u2514\u2500\u2500 mysql\n        \u251c\u2500\u2500 files\n        \u2502   \u2514\u2500\u2500 mysql-5.7.33-linux-glibc2.12-x86_64.tar.gz\n        \u251c\u2500\u2500 tasks\n        \u2502   \u2514\u2500\u2500 main.yml\n        \u2514\u2500\u2500 templates\n            \u251c\u2500\u2500 my.cnf.j2\n            \u2514\u2500\u2500 mysqld.service.j2\n\n6 directories, 7 files\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u4e3b\u673a\u6e05\u5355","title":"\u4e3b\u673a\u6e05\u5355","text":"<p>\u5b9a\u4e49\u4e86\u9700\u8981\u90e8\u7f72mysql\u7684\u4e3b\u673a\u7ec4\u3001IP\u53ca\u8bbe\u5b9amysql\u4e3b\u673a\u89d2\u8272 <pre><code># \u4e3b\u673a\u6e05\u5355\nroot@master:/opt/mysql# cat hosts [mysql]\n192.168.16.140 slave=true\n192.168.16.150 slave=true\n192.168.16.129 master=true\n</code></pre></p> <p>\u58f0\u660e\u53d8\u91cf\uff1a</p> <pre><code># \u58f0\u660e\u53d8\u91cf\n# root@master:/opt/mysql# cat group_vars/all.yml \nmysql_pkg: mysql-5.7.33-linux-glibc2.12-x86_64.tar.gz\nmysql_version: mysql-5.7.33-linux-glibc2.12-x86_64\nmysql_install_path: /opt/soft\nmysql_link: mysql\nmysql_sock: /tmp/mysql.sock\nmysql_port: 3306\nmysql_root_passwd: Root_123^\nrepl_user: repl\nrepl_passwd: Repl_123^\nuser: mysql\ngroup: mysql\nmaster_ip: 192.168.16.129 </code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u4ea4\u4e92\u5f0f\u914d\u7f6e\u6587\u4ef6","title":"\u4ea4\u4e92\u5f0f\u914d\u7f6e\u6587\u4ef6","text":"<pre><code># root@master:/opt/mysql# cat mysql.yml \n---\n- hosts: mysql\n  gather_facts: false\n  vars_prompt:\n  - name: mysql_install_path\n    prompt: \u8bf7\u8f93\u5165mysql\u5b89\u88c5\u76ee\u5f55\n    default: \"/opt/soft\"\n    private: no\n  - name: mysql_port\n    prompt: \u8bf7\u8f93\u5165mysql\u670d\u52a1\u7684\u7aef\u53e3\n    default: 3306\n    private: no\n  - name: mysql_sock\n    prompt: \u8bf7\u8f93\u5165mysql\u670d\u52a1\u7684socket\u6587\u4ef6\n    default: \"/tmp/mysql.sock\"\n    private: no\n  - name: mysql_root_passwd\n    prompt: \u8bf7\u8f93\u5165mysql\u7684root\u5bc6\u7801\n    default: Root_123^ \n    private: yes\n  - name: repl_user\n    prompt: \u8bf7\u8f93\u5165\u590d\u5236\u7528\u6237\u540d\n    default: repl\n    private: no\n  - name: repl_passwd\n    prompt: \u8bf7\u8f93\u5165\u590d\u5236\u7528\u6237\u5bc6\u7801\n    default: Repl_123^\n    private: yes\n  - name: user\n    prompt: \u8bf7\u8f93\u5165mysql\u670d\u52a1\u7684\u542f\u52a8\u7528\u6237\n    default: mysql\n    private: no\n  roles:\n    - mysql\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u90e8\u7f72\u6e05\u5355","title":"\u90e8\u7f72\u6e05\u5355","text":"<p>\u5176\u5b9e\u5c31\u662f\u628a\u624b\u52a8\u90e8\u7f72MySQL\u96c6\u7fa4\u7684\u6b65\u9aa4\u901a\u8fc7Ansible\u7684\u76f8\u5173\u6a21\u5757\u3001playbook\u8bed\u6cd5\u53ca\u6761\u4ef6\u5224\u65ad\u8fdb\u884c\u7ec4\u5408\uff0c\u7ee7\u800c\u5b9e\u73b0\u81ea\u52a8\u5316\u90e8\u7f72\u7684\u8fc7\u7a0b\u3002</p> <p>\u539f\u7406\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u5176\u4e2d\u6d89\u53ca\u7684\u5173\u4e8e\u64cd\u4f5cMySQL\u7684\u6a21\u5757\u9700\u8981\u7740\u91cd\u7814\u7a76\uff0c\u8fd8\u6709\u5173\u4e8etemplate\u6a21\u677f\u7684\u7528\u6cd5\u4e5f\u975e\u5e38\u91cd\u8981\uff0c\u5728\u901a\u8fc7Ansible playbook\u90e8\u7f72\u4e00\u4e9b\u66f4\u590d\u6742\u7684\u7cfb\u7edf\u65f6\uff0c\u7ecf\u5e38\u4f1a\u7528\u5230\u4f7f\u7528template\u6a21\u677f\u8bed\u6cd5\u6e32\u67d3\u4e0d\u540c\u7684\u914d\u7f6e\uff0c\u5b9e\u73b0\u66f4\u4e3a\u590d\u6742\u7cfb\u7edf\u7684\u90e8\u7f72\u3002</p> <p>\u6bd4\u5982\u901a\u8fc7Ansible playbook\u79bb\u7ebf\u90e8\u7f72Kubernetes\u96c6\u7fa4\u3002</p> <pre><code>---\n- name: \"1\u3001\u521b\u5efa{{ user }}\u7528\u6237\"\n  user:\n    name: \"{{ user }}\"\n    shell: /bin/bash\n\n- name: \"2\u3001\u521b\u5efa\u5b89\u88c5\u76ee\u5f55\"\n  file:\n    path: \"{{ mysql_install_path }}\"\n    state: directory\n    owner: \"{{ user }}\"\n    group: \"{{ group }}\"\n    recurse: yes\n\n- name:  \"3\u3001\u89e3\u538bmysql\u4e8c\u8fdb\u5236\u5305\"\n  unarchive:\n    src:  \"{{ mysql_pkg }}\"\n    dest: \"{{ mysql_install_path }}\"\n    owner: \"{{ user }}\"\n    group: \"{{ group }}\"\n\n- name: \"4\u3001\u521b\u5efa\u6570\u636e\u76ee\u5f55\"\n  file:\n    path: \"{{ item }}\"\n    state: directory\n    owner: \"{{ user }}\"\n    group: \"{{ group }}\"\n    recurse: yes\n  with_items:\n    - \"{{ mysql_install_path }}/{{ mysql_version }}/data\"\n    - \"{{ mysql_install_path }}/{{ mysql_version }}/undolog\"\n\n- name: \"5\u3001\u4fee\u6539\u6743\u9650\"\n  command: chown -R \"{{ user }}:{{ group }}\" \"{{ mysql_install_path }}\"\n\n- name: \"6\u3001\u521b\u5efa\u94fe\u63a5\u6587\u4ef6\"\n  file:\n    src: \"{{ mysql_install_path }}/{{ mysql_version }}\"\n    dest: \"{{ mysql_install_path }}/{{ mysql_link }}\"\n    owner: \"{{ user }}\"\n    group: \"{{ group }}\"\n    state: link\n\n- name: \"7\u3001\u751f\u6210\u914d\u7f6e\u6587\u4ef6\"\n  template:\n    src: my.cnf.j2\n    dest: /etc/my.cnf\n\n- name: \"8\u3001\u6570\u636e\u5e93\u521d\u59cb\u5316\"\n  shell: ./mysqld --initialize --user={{ user }} --basedir={{ mysql_install_path }}/{{ mysql_link }} --datadir={{ mysql_install_path }}/{{ mysql_link }}/data\n  args:\n    chdir: \"{{ mysql_install_path }}/{{ mysql_link }}/bin\"\n\n- name: \"9\u3001\u6ce8\u518c\u521d\u59cb\u5bc6\u7801\"\n  shell: cat error.log |grep localhost|grep \"temporary password\"|awk '{print $NF}'\n  register: mysql_init_passwd\n  args:  \n    chdir: \"{{ mysql_install_path }}/{{ mysql_link }}/data\"\n\n- name: \"10\u3001\u6253\u5370\u521d\u59cb\u5bc6\u7801\"\n  debug: \n    msg: \"{{ mysql_init_passwd.stdout }}\"\n\n- name: \"11\u3001\u914d\u7f6esystemd\u5b88\u62a4\u8fdb\u7a0b\"\n  template:\n    src: mysqld.service.j2\n    dest: /usr/lib/systemd/system/mysqld.service\n\n- name: \"12\u3001\u542f\u52a8mysqld\u670d\u52a1\"\n  systemd:\n    name: mysqld\n    state: started\n    daemon_reload: yes\n    enabled: yes\n\n- name: \"13\u3001\u4fee\u6539\u521d\u59cb\u5bc6\u7801\"\n  shell: ./mysqladmin -u root -p\"{{ mysql_init_passwd.stdout }}\" password \"{{ mysql_root_passwd }}\"\n  args:\n    chdir: \"{{ mysql_install_path }}/{{ mysql_link }}/bin\"\n\n- name: \"14\u3001\u521b\u5efa{{ repl_user }}\u540c\u6b65\u7528\u6237\"\n  mysql_user: \n    login_host: localhost\n    login_port: \"{{ mysql_port }}\"\n    login_user: root\n    login_unix_socket: \"{{ mysql_sock }}\" \n    login_password: \"{{ mysql_root_passwd }}\"\n    name: \"{{ repl_user }}\"\n    password: \"{{ repl_passwd }}\"\n    priv: \"*.*:ALL\"\n    state: present \n    host: \"%\"\n  when: master is defined\n\n- name: \"15\u3001\u4ece\u5e93\u914d\u7f6e\u4ece\u4e3b\u5e93\u540c\u6b65\"\n  mysql_replication:\n    login_unix_socket: \"{{ mysql_sock }}\"\n    login_host: localhost\n    login_port: \"{{ mysql_port }}\"\n    login_user: root     \n    login_password: \"{{ mysql_root_passwd }}\"\n    master_host: \"{{ master_ip }}\" \n    master_user: \"{{ repl_user }}\" \n    master_password: \"{{ repl_passwd }}\"\n    master_port: \"{{ mysql_port }}\"\n    master_auto_position: 1\n    mode: changemaster\n  when: slave is defined\n\n- name: \"16\u3001Start Slave\"\n  mysql_replication: \n    login_unix_socket: \"{{ mysql_sock }}\"\n    login_user: root \n    login_host: localhost\n    login_port: \"{{ mysql_port }}\"\n    login_password: \"{{ mysql_root_passwd }}\"\n    mode: startslave\n  when: slave is defined\n\n- name: \"17\u3001\u6ce8\u518c\u590d\u5236\u72b6\u6001\"\n  mysql_replication:\n    login_host: localhost\n    login_user: root\n    login_port: \"{{ mysql_port }}\"\n    login_password: \"{{ mysql_root_passwd }}\"\n    login_unix_socket: \"{{ mysql_sock }}\"\n    mode: getslave\n  when: slave is defined\n  register: info\n\n- name: \"18\u3001\u6253\u5370\u590d\u5236\u72b6\u6001\u4fe1\u606f\"\n  debug:\n    msg: \"Slave_IO_Running={{ info.Slave_IO_Running }}       Slave_SQL_Running={{ info.Slave_SQL_Running }}\"\n  when: slave is defined\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#mysql\u914d\u7f6e\u6587\u4ef6","title":"MySQL\u914d\u7f6e\u6587\u4ef6","text":"<p>MySQL\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u7cfb\u7edf\u53c2\u6570\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u6309\u9700\u4fee\u6539\uff0c\u4ee5\u4e0b\u914d\u7f6e\u53ea\u4f9b\u53c2\u8003\uff0c\u7740\u91cd\u770b\u4e00\u4e0b\u6587\u4ef6\u4e2d\u6709\u6807\u6ce8\u7684\u5730\u65b9\u3002</p> <pre><code>; root@master:/opt/mysql# cat roles/mysql/templates/my.cnf.j2\n[client]\nport = {{ mysql_port }}\nsocket = {{ mysql_sock }}\ndefault-character-set=utf8mb4\n\n[mysqldump]\nsingle-transaction\n\n[mysqld]\nport = {{ mysql_port }}\nsocket = {{ mysql_sock }}\ncharacter-set-server=utf8mb4\nsql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\nlog_bin_trust_function_creators=1\ninnodb_flush_log_at_trx_commit=1\nsync_binlog=1\n\ngtid-mode = on\nenforce_gtid_consistency\nlog-bin = on\nlog-slave-updates = on\n\n#rpl_semi_sync_master_enabled=1\n#rpl_semi_sync_master_timeout=1000\n#rpl_semi_sync_slave_enabled=1\n\nmaster_info_repository = TABLE\nrelay_log_info_repository = TABLE\n\nreplicate-ignore-table=mysql.failover_console\n\ndatadir={{ mysql_install_path }}/{{ mysql_link }}/data\n\n# \u8bbe\u7f6e\u4e3b\u8282\u70b9server-id=1\uff0c\u6a21\u5f0f\u4e3a\u8bfb\u5199\uff1b\u4ece\u8282\u70b9server-id=2,\u6a21\u5f0f\u4e3a\u53ea\u8bfb\n{% if master is defined %}\nserver-id=1\n#read-only=0                             \n{% else %}\nserver-id=2\n#read-only=1\n{% endif %}\n\n#relay_log_purge=0\nlog_timestamps=SYSTEM\nlower_case_table_names=1\nlog_slave_updates=on\n\nskip-name-resolve\n#skip-networking\nback_log = 600\n\nslave_parallel_workers = 16\nslave-parallel-type = LOGICAL_CLOCK\nmaster_info_repository = TABLE\nrelay_log_info_repository = TABLE\nrelay_log_recovery = ON\nslave_preserve_commit_order = 1\n\ninnodb_undo_directory={{ mysql_install_path }}/{{ mysql_link }}/undolog\ninnodb_undo_tablespaces=4\ninnodb_undo_logs=128\ninnodb_max_undo_log_size=512M\ninnodb_purge_rseg_truncate_frequency\ninnodb_undo_log_truncate=1\n\nmax_connections = 4000\nmax_connect_errors = 6000\nopen_files_limit = 1024\ntable_open_cache = 4096\ntable_open_cache_instances = 64\nmax_allowed_packet = 128M\nbinlog_cache_size = 32M\nmax_heap_table_size = 128M\ntmp_table_size = 32M\nread_buffer_size = 8M  \nread_rnd_buffer_size = 8M  \nsort_buffer_size = 8M  \njoin_buffer_size = 8M  \nkey_buffer_size = 8M  \nthread_cache_size = 64\nquery_cache_type = 0\nquery_cache_size = 0\n#query_cache_size = 16M  \n#query_cache_limit = 8M\nft_min_word_len = 4\nlog_bin = mysql-bin\nbinlog_format = row\nexpire_logs_days = 15\nlog_error ={{ mysql_install_path }}/{{ mysql_link }}/data/error.log\nslow_query_log = 1\nlong_query_time = 3\nperformance_schema = 0\nexplicit_defaults_for_timestamp\n#lower_case_table_names = 1\nskip-external-locking\ndefault_storage_engine = InnoDB\ninnodb_flush_method = O_DIRECT\ninnodb_file_per_table = 1\ninnodb_stats_persistent_sample_pages = 64\ninnodb_open_files = 10000\ninnodb_buffer_pool_size = 2G\ninnodb_write_io_threads = 24\ninnodb_read_io_threads = 24\ninnodb_thread_concurrency = 0\ninnodb_purge_threads = 1\ninnodb_log_buffer_size = 64M\ninnodb_sort_buffer_size = 64M\ninnodb_log_file_size = 512M\ninnodb_log_files_in_group = 3\ninnodb_max_dirty_pages_pct = 75\ninnodb_lock_wait_timeout = 120\n#log_warnings=1\nlog_error_verbosity=1\n#local-infile=0\n#connection-control-failed-connections-threshold=10\n#connection-control-min-connection-delay=10800\nwait_timeout = 3600\ninteractive_timeout = 3600\ninnodb_temp_data_file_path = ibtmp1:200M:autoextend:max:5G\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#\u90e8\u7f72","title":"\u90e8\u7f72","text":"<pre><code># \u90e8\u7f72\u547d\u4ee4\nroot@master:/opt/mysql# ansible-playbook -i hosts mysql.yml\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>Ansible Playbook\u5feb\u901f\u90e8\u7f72\u4e00\u4e3b\u591a\u4eceMySQL\u96c6\u7fa4</p> <ul> <li> <p>ansible\u90e8\u7f72lnmp\u73af\u5883</p> </li> <li> <p>Kubernetes v1.25 \u4f01\u4e1a\u7ea7\u9ad8\u53ef\u7528\u96c6\u7fa4\u81ea\u52a8\u90e8\u7f72\uff08\u79bb\u7ebf\u7248\uff09</p> </li> <li> <p>\u4f18\u79c0\u7684role\u9274\u8d4f</p> </li> </ul> <p>\u53ef\u4ee5\u53c2\u8003\u4e0a\u9762\u7684role\uff0c\u7167\u732b\u753b\u864e\u7f16\u5199\u81ea\u5df1\u7684role\u90e8\u7f72\u5305\u3002</p> <p>\u66f4\u591a\u53c2\u8003\u6587\u6863</p> <p>Playbook\u5b9e\u6218\u4e09\uff1aAnsible\u90e8\u7f72Tomcat\u4f01\u4e1a\u5b9e\u6218</p> <p>Ansible\u7ba1\u7406windows\u96c6\u7fa4</p> <p>Ansible\u6279\u91cf\u7ba1\u7406Windows Server</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#7ansible-\u7684galaxy","title":"7.Ansible \u7684Galaxy","text":"<p>Ansible Galaxy\u662f\u4e00\u4e2aAnsible\u89d2\u8272\u5728\u7ebf\u5b58\u50a8\u5e93\uff0c\u4f4d\u7f6e\u5728<code>htps:\u2225galaxy.ansible.com/</code>\u3002</p> <p>\u5728\u5f00\u59cb\u4e3a\u73af\u5883\u4e2d\u7684\u67d0\u4e9b\u529f\u80fd\u7f16\u5199\u51fa\u8272\u7684Ansible\u89d2\u8272\u4e4b\u524d\uff0c\u503c\u5f97\u770b\u770bAnsible\u793e\u533a\u662f\u5426\u5df2\u7ecf\u89e3\u51b3\u4e86\u8be5\u95ee\u9898\uff0c\u5e76\u4e14\u5f20\u8d34\u4e86\u53ef\u4f9b\u4f7f\u7528\u7684\u4ee3\u7801\u3002</p> <p>\u5f53\u4f60\u627e\u5230\u60f3\u8981\u4f7f\u7528\u7684Ansible\u89d2\u8272\u65f6\uff0c\u7528<code>ansible-galaxy install</code>\u547d\u4ee4\u6307\u5b9a\u540d\u79f0</p> <p>\uff08\u4f8b\u5982\uff0c <code>ansible--galaxy install bennojoy..mysql</code>)\u3002</p> <p>\u7136\u540e\uff0c\u8fd9\u4e2a\u89d2\u8272\u88ab\u653e\u5165<code>/etc/ansible/roles</code>,\u7acb\u523b\u53ef\u4ee5\u5728\u4efb\u4f55\u5267\u672c\u4e2d\u4f7f\u7528\u3002</p> <p>\u4e3aAnsible Galaxy\u8d21\u732e\u4ee3\u7801\u76f8\u5f53\u7b80\u5355\u3002\u5728\u7f51\u7ad9\u7684Add a Role\u90e8\u5206\uff0c\u6307\u5b9a\u4f60\u7684GitHub\u8d26\u6237\u3001\u5305\u542b\u89d2\u8272\u7684\u5b58\u50a8\u5e93\u4ee5\u53ca\u89d2\u8272\u5728Galaxy\u7f51\u7ad9\u4e0a\u7684\u6807\u9898\uff08\u53ef\u9009\uff09\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cGalaxy\u663e\u793a\u7684\u89d2\u8272\u540d\u79f0\u4e3a\u4f60\u7684GitHub\u5b58\u50a8\u5e93\u540d\u79f0\u3002</p> <p>\u5728ansible-galaxy\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0a\u4f20\u548c\u4e0b\u8f7dRoles\uff0c\u8fd9\u91cc\u4e5f\u662f\u4f18\u79c0Roles\u7684\u805a\u96c6\u5730\u3002</p> <p>\u4e0b\u8f7d\u5730\u5740\u4e3a:https://galaxy.ansible.com</p> <pre><code># \u5b89\u88c5\u89d2\u8272\u6216\u96c6\u5408\nansible-galaxy install role_name\n\n# \u793a\u4f8b\u5b89\u88c5postgresql\nansible-galaxy collection install community.postgresql\n\n# \u5217\u51fa\u5df2\u5b89\u88c5\u7684\u89d2\u8272\u6216\u96c6\u5408\nansible-galaxy list\n\n# \u641c\u7d22\u89d2\u8272\u6216\u96c6\u5408\nansible-galaxy search role_name\n\n# \u5220\u9664\u89d2\u8272\u6216\u96c6\u5408\nansible-galaxy remove role_name\n</code></pre> <p>Ansible\u7684\u5b98\u65b9Role\u5206\u4eab\u5e73\u53f0</p> <pre><code># \u91cd\u8981\u7684\u7f51\u7ad9\u8bf43\u904d\nhttps://galaxy.ansible.com/\n\nhttps://galaxy.ansible.com/\n\nhttps://galaxy.ansible.com/\n</code></pre> <p>Ansible\u5b98\u65b9\u5e94\u7528\u90e8\u7f72\u7684\u4f8b\u5b50</p> <pre><code>https://github.com/ansible/ansible-examples\n</code></pre> <p>Ansible\u4e2d\u6587\u6743\u5a01\u6307\u5357</p> <pre><code>http://www.ansible.com.cn/index.html\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#8jinja2-\u6a21\u677f\u8bed\u6cd5","title":"8.Jinja2 \u6a21\u677f\u8bed\u6cd5","text":"<p>Jinja2 \u6a21\u677f\u8bed\u6cd5\uff1a \u4f20\u9001\u95e8</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#9ansible\u901f\u5ea6\u4f18\u5316","title":"9.Ansible\u901f\u5ea6\u4f18\u5316","text":""},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#91-\u5f00\u542fansible\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4","title":"9.1 \u5f00\u542fAnsible\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4","text":"<p>\u53ef\u6709\u52a9\u4e8e\u6211\u4eec\u4e86\u89e3playbook\u4e2d\u7684task\u4efb\u52a1\u6267\u884c\u65f6\u95f4\uff0c\u4ee5\u4fbf\u4e8e\u540e\u7eed\u4f18\u5316\u3002</p> <p>\u5728 ansible.cfg \u4e2d\u914d\u7f6e</p> <pre><code>[defaults]\ncallback_whitelist = timer, profile_tasks\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#92-ansible\u7684\u5e76\u53d1\u548c\u5f02\u6b65","title":"9.2 Ansible\u7684\u5e76\u53d1\u548c\u5f02\u6b65","text":"<p>Ansible\u9ed8\u8ba4\u662f\u540c\u6b65\u963b\u585e\u6a21\u5f0f\uff0c\u5b83\u4f1a\u7b49\u5f85\u6240\u6709\u7684\u673a\u5668\u90fd\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\u624d\u4f1a\u5728\u524d\u53f0\u8fd4\u56de\u3002</p> <p>Ansible\u9ed8\u8ba4\u53ea\u4f1a\u521b\u5efa5\u4e2a\u8fdb\u7a0b\u5e76\u53d1\u6267\u884c\u4efb\u52a1\uff0c\u6240\u4ee5\u4e00\u6b21\u4efb\u52a1\u53ea\u80fd\u540c\u65f6\u63a7\u52365\u53f0\u673a\u5668\u6267\u884c\u3002</p> <p>\u5982\u679c\u6709\u5927\u91cf\u7684\u673a\u5668\u9700\u8981\u63a7\u5236\uff0c\u4f8b\u598220\u53f0\uff0c\u90a3\u4e48Ansible\u6267\u884c\u4e00\u4e2a\u4efb\u52a1\u65f6\u4f1a\u5148\u5728\u5176\u4e2d5\u53f0\u4e0a\u6267\u884c\uff0c\u6267\u884c\u6210\u529f\u540e\u518d\u6267\u884c\u4e0b\u4e00\u62795\u53f0\uff0c\u76f4\u5230\u6240\u6709\u673a\u5668\u5168\u90e8\u6267\u884c\u5b8c\u6bd5\u3002</p> <p>\u4f7f\u7528<code>\"-f\"</code>\u9009\u9879\u53ef\u4ee5\u6307\u5b9a\u8fdb\u7a0b\u6570\uff0c\u6211\u4eec\u7684\u7ebf\u4e0a\u73af\u5883\u8bbe\u7f6e\u7684\u503c\u4e3a20(\u8fd9\u4e2a\u503c\u914d\u7f6e\u8fc7\u5927\u5e76\u4e0d\u4f1a\u5bf9Ansible\u7684\u5b9e\u9645\u6267\u884c\u6548\u7387\u6709\u5f88\u5927\u7684\u63d0\u5347\uff0c\u8fd8\u662f\u9700\u8981\u7ed3\u5408\u5b9e\u9645\u5e94\u7528\u573a\u666f\u6765\u8fdb\u884c\u8bbe\u7f6e)\u3002</p> <p>Ansible\u9664\u4e86\u652f\u6301\u540c\u6b65\u6a21\u5f0f\u4e4b\u5916\uff0c\u8fd8\u652f\u6301\u5f02\u6b65\u6a21\u5f0f\u3002</p> <p>\u603b\u4f53\u6765\u8bf4\uff0c\u5927\u6982\u6709\u5982\u4e0b\u7684\u4e00\u4e9b\u573a\u666f\u9700\u8981\u4f7f\u7528\u5230Ansible\u7684\u5f02\u6b65\u6267\u884c\u7279\u6027\u3002</p> <ul> <li> <p>\u5f53\u6211\u4eec\u6709\u4e00\u4e2atask\u9700\u8981\u8fd0\u884c\u5f88\u957f\u7684\u65f6\u95f4\uff0c\u800c\u4e14\u8fd9\u4e2atask\u5f88\u53ef\u80fd\u4f1a\u8fbe\u5230timeout\u65f6\u3002</p> </li> <li> <p>\u5f53\u6211\u4eec\u6709\u4e00\u4e2a\u4efb\u52a1\u9700\u8981\u5728\u5927\u91cf\u7684\u673a\u5668\u4e0a\u9762\u8fd0\u884c\u65f6\u3002</p> </li> <li> <p>\u5f53\u6211\u4eec\u6709\u4e00\u4e2a\u4efb\u52a1\u4e0d\u9700\u8981\u7b49\u5f85\u5b83\u5b8c\u6210\u65f6\u3002</p> </li> </ul> <p>\u8bd5\u60f3\u4e00\u4e0b\uff0c\u6709\u7684Ansible\u4efb\u52a1\u6267\u884c\u8d77\u6765\u5e76\u4e0d\u662f\u90a3\u4e48\u76f4\u63a5\uff0c\u53ef\u80fd\u4f1a\u82b1\u8d39\u6bd4\u8f83\u957f\u7684\u65f6\u95f4\uff0c\u751a\u81f3\u53ef\u80fd\u8fd8\u4f1a\u6bd4SSH\u7684\u8d85\u65f6\u65f6\u95f4\u8fd8\u8981\u957f\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4efb\u52a1\u662f\u4e0d\u662f\u5c31\u6ca1\u6cd5\u6267\u884c\u4e86\uff1f</p> <p>Ansible\u4e5f\u8003\u8651\u5230\u4e86\u8fd9\u79cd\u60c5\u51b5\uff0c\u5b98\u65b9\u6587\u6863\u4ecb\u7ecd\u4e86\u4e0a\u8ff0\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u5c31\u662f\u8ba9\u4e0b\u53d1\u7684\u4efb\u52a1\u6267\u884c\u7684\u8fde\u63a5\u53d8\u4e3a\u5f02\u6b65\uff1a\u4efb\u52a1\u4e0b\u53d1\u4e4b\u540e\uff0c\u957f\u8fde\u63a5\u4e0d\u518d\u4fdd\u6301\uff0c\u800c\u662f\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u8f6e\u8be2\u4e00\u6b21\u7ed3 \u679c\uff0c\u76f4\u5230\u4efb\u52a1\u7ed3\u675f\u4e3a\u6b62\u3002</p> <p>\u5b98\u65b9\u7ed9\u51fa\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>---\n\n- hosts: all\n  remote_user: root\n\n  tasks:\n  - name: simulate long running op (15 s),wait for up to 45 s,poll every 5 s\n    command: /bin/sleep 15\n    async: 45\n    poll: 0\n    register: result\n</code></pre> <p>async\u53c2\u6570\u503c\u4ee3\u8868\u4e86\u8fd9\u4e2a\u4efb\u52a1\u6267\u884c\u65f6\u95f4\u7684\u4e0a\u9650\u503c\u3002</p> <p>\u5373\u4efb\u52a1\u6267\u884c\u6240\u7528\u7684\u65f6\u95f4\u5982\u679c\u8d85\u51fa\u4e86\u8fd9\u4e2a\u65f6\u95f4\uff0c\u5219\u8ba4\u4e3a\u4efb\u52a1\u5931\u8d25\u3002</p> <p>\u82e5\u672a\u8bbe\u7f6e\u6b64\u53c2\u6570\uff0c\u5219\u4e3a\u540c\u6b65\u6267\u884c\u3002 </p> <p>pol\u53c2\u6570\u503c\u4ee3\u8868\u4e86\u4efb\u52a1\u5f02\u6b65\u6267\u884c\u65f6\u8f6e\u8be2\u7684\u65f6\u95f4\u95f4\u9694\u3002</p> <p>\u5728\u6b64\u5f02\u6b65\u6a21\u5f0f\u4e0b\uff0cAnsible\u4f1a\u5c06\u8282\u70b9\u7684\u4efb\u52a1\u4e22\u5728\u540e\u53f0\uff0c\u6bcf\u53f0\u88ab\u63a7\u5236\u7684\u673a\u5668\u90fd\u6709\u4e00\u4e2ajob id,Ansible\u4f1a\u6839\u636e\u8fd9\u4e2ajob id\u53bb\u8f6e\u8be2\u8be5\u673a\u5668\u4e0a\u4efb\u52a1\u7684\u6267\u884c\u60c5\u51b5\uff0c\u4f8b\u5982\u67d0\u673a\u5668\u4e0a\u6b64\u4efb\u52a1\u4e2d\u7684\u67d0\u4e00\u4e2a\u9636\u6bb5\u662f\u5426\u5b8c\u6210\uff0c\u662f\u5426\u8fdb\u4eba\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7b49\u3002</p> <p>\u5373\u4f7f\u4efb\u52a1\u65e9\u5c31\u7ed3\u675f\u4e86\uff0c\u4e5f\u53ea\u6709\u7b49\u8f6e\u8be2\u68c0\u67e5\u5230\u4efb\u52a1\u7ed3\u675f\u4e4b\u540e\u624d\u8ba4\u4e3a\u8be5\u4efb\u52a1\u7ed3\u675f\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a\u4efb\u52a1\u68c0\u67e5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba4\u662f10\u79d2\u3002</p> <p>\u9664\u975e\u6307\u5b9a\u4efb\u52a1\u68c0\u67e5\u7684\u65f6\u95f4\u95f4\u9694\u4e3a0\uff0c\u5426\u5219\u4f1a\u7b49\u5f85\u6240\u6709\u4efb\u52a1\u90fd\u5b8c\u6210\u540e\uff0cAnsible\u7aef\u624d\u4f1a\u91ca\u653e\u5360\u7528\u7684Shell\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u4e3a0\uff0c\u5219Ansible\u4f1a\u7acb\u5373\u8fd4\u56de\uff08\u81f3\u5c11\u5f97\u8fde\u63a5\u4e0a\u76ee\u6807\u4e3b\u673a\uff0c\u4efb\u52a1\u53d1\u5e03\u6210\u529f\u4e4b\u540e\u7acb\u5373\u8fd4\u56de)\uff0c\u5e76\u4e14\u4e0d\u4f1a\u68c0\u67e5\u5b83\u7684\u4efb\u52a1\u8fdb\u5ea6\u3002</p> <p>\u4e0b\u9762\u5728Ansible\u4e3b\u63a7\u7aef\u673a\u5668\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a </p> <pre><code>ansible webserver -B 30 -P 0 -m yum -a \"name=php\"-vv\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\"-B 30\"\u8868\u793a\u542f\u7528\u5f02\u6b65\uff0c\u8d85\u65f6\u65f6\u95f4\u4e3a30\uff1b\"-P 0\"\u8868\u793a\u5c06\u8f6e\u8be2\u65f6\u95f4\u8bbe\u7f6e\u4e3a0\uff0c\u5373\u4e0d\u68c0\u67e5\u4efb\u52a1\u8fdb\u5ea6\uff0c\u7acb\u5373\u8fd4\u56de\u7ed3\u679c\u3002</p> <p>\u6267\u884c\u4e0a\u9762\u7684\u547d\u4ee4\uff0cAnsible\u6ca1\u6709\u7ecf\u8fc7\u4efb\u4f55\u5ef6\u8fdf\u5c31\u51fa\u73b0\u7ed3\u679c\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5982\u4e0b\u547d\u4ee4\u6765\u67e5\u770b\u5b9e\u9645\u7684\u6267\u884c\u7ed3\u679c\uff1a </p> <pre><code>sudo ansible webserver -m async status -a \"jid=655563178400.5550\"\n</code></pre> <p>\u800c\u91c7\u53d6\u5f02\u6b65\u5e76\u7b49\u5f8510\u79d2\u7684\u547d\u4ee4\u5982\u4e0b\u6240\u793a\uff1a </p> <pre><code>ansible webserver -B 30 -P 10 -m yum -a \"name=mysql\"-vv\n</code></pre> <p>\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u5e94\u7528\u573a\u666f\uff0c\u6765\u9009\u62e9\u662f\u5426\u542f\u7528\u5f02\u6b65\u6a21\u5f0f\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#93-\u5f00\u542fssh-multiplexing","title":"9.3 \u5f00\u542fSSH Multiplexing","text":"<p>\u589e\u52a0control_path\u7684\u4f7f\u7528\u65f6\u95f4</p> <p>\u5728 ansible.cfg \u4e2d\u914d\u7f6e</p> <pre><code>[ssh_connection]\nssh_args = -o ControlMaster=auto -o ControlPersist=1800s\n</code></pre> <p>\u9ed8\u8ba4ssh\u7684\u8ba4\u8bc1\u65b9\u5f0f\u4f1a\u6709 <code>-o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey</code>,  \u5982\u679c\u53ea\u6709publickey\u4e00\u79cd\u65b9\u5f0f\u8ba4\u8bc1\uff0c\u53ef\u4ee5\u53ea\u6307\u5b9a<code>publickey -o PreferredAuthentications=publickey</code></p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#94-fork","title":"9.4 Fork","text":"<p>Ansible \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5e76\u884c\u6267\u884c\u7684\u6570\u91cf\u662f5\uff0c\u5bf9\u4e8e\u8f83\u591a\u7684\u8282\u70b9\uff0c\u5c31\u9700\u8981\u6269\u5927\u8fd9\u4e2a\u5e76\u884c\u6570\u91cf\u3002</p> <p>Fork \u6570\u91cf\u8d8a\u5927\u5bf9\u63a7\u5236\u8282\u70b9\u7684cpu\u6d88\u8017\u8d8a\u9ad8\u3002</p> <p>\u5728 ansible.cfg \u4e2d\u914d\u7f6e</p> <pre><code>[defaults]\nforks = 20\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#95-\u5f00\u542fssh-pipelinling","title":"9.5 \u5f00\u542fSSH Pipelinling","text":"<p>pipelining\u4e5f\u662fOpenSSH\u7684\u7279\u6027\u4e4b\u4e00\uff0c\u4e0b\u9762\u56de\u5fc6\u4e00\u4e0bAnsible\u662f\u5982\u4f55\u6267\u884c\u4e00\u4e2atask\u4efb\u52a1\u7684\uff0c\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\u6240\u793a\u3002 </p> <ol> <li>Ansible\u57fa\u4e8e\u8c03\u7528\u7684\u6a21\u5757\u751f\u6210\u4e00\u4e2aPython\u4e34\u65f6\u811a\u672c\u3002 </li> <li>\u5b83\u5c06\u6b64\u4e34\u65f6\u811a\u672c\u590d\u5236\u5230\u88ab\u63a7\u7aef\u4e3b\u673a\u4e0a\u3002 </li> <li>\u6267\u884c\u6b64Python\u4e34\u65f6\u811a\u672c\u3002 </li> <li>\u6267\u884c\u6210\u529f\u4ee5\u540e\u5220\u9664\u6b64\u4e34\u65f6\u811a\u672c\uff0c\u62b9\u53bb\u75d5\u8ff9\u3002</li> </ol> <p>\u4e0b\u9762\u6211\u4eec\u4ee5\u7ebf\u4e0a\u7684\u4e00\u53f0\u673a\u5668\u8fdb\u884c\u6d4b\u8bd5\u4e4b\u7528\uff0c\u673a\u5668IP\u4e3a61.130.2.23\uff0c\u547d\u4ee4\u5982\u4e0b\u6240\u793a\uff1a </p> <pre><code>ansible 61.130.2.23 -m script -a /root/test.sh -vvvv\n</code></pre> <p>\u6267\u884c\u4e0a\u9762\u547d\u4ee4\u5c31\u80fd\u770b\u5230\u5982\u4e0a\u6b65\u9aa4\u8be6\u7ec6\u8f93\u51fa\u3002</p> <p>\u5f00\u542fssh pipelining,\u5ba2\u6237\u7aef\u4ece\u7ba1\u9053\u4e2d\u8bfb\u53d6\u6267\u884c\u6e32\u67d3\u540e\u7684\u811a\u672c\uff0c\u800c\u4e0d\u662f\u5728\u5ba2\u6237\u7aef\u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u3002</p> <p>\u5728 ansible.cfg \u4e2d\u914d\u7f6e</p> <pre><code>[ssh_connection]\npipelining = True\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#96-fact\u7f13\u5b58","title":"9.6 Fact\u7f13\u5b58","text":"<p>\u5c06 Facts \u4fe1\u606f\u7b2c\u4e00\u6b21\u6536\u96c6\u540e\u7f13\u5b58\u5230memory\u6216\u8005redis\u6216\u8005\u6587\u4ef6\u4e2d\uff0c\u4ece\u800c\u4e3a\u540e\u7eed\u6267\u884c\u51cf\u5c11\u6536\u96c6\u65f6\u95f4\u3002</p> <p>\u76ee\u524dAnsible\u652f\u6301\u5982\u4e0b\u51e0\u79cd\u65b9\u5f0f\u6765\u7f13\u5b58fact\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <ul> <li>\u672c\u5730json\u6587\u4ef6</li> <li>redis</li> <li>memcached</li> </ul> <p>\u7ecf\u8fc7\u6027\u80fd\u8bc4\u4f30\uff0c\u8fd9\u91cc\u63a8\u8350\u5927\u5bb6\u91c7\u7528redis\u6765\u7f13\u5b58facts\u7684\u65b9\u5f0f\uff0c\u5177\u4f53\u914d\u7f6e\u6b65\u9aa4\u5982\u4e0b\u6240\u793a\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#redis","title":"redis","text":"<p>\u4e0b\u9762\u4fee\u6539Ansible\u914d\u7f6e\u6587\u4ef6\uff0c\u6dfb\u52a0\u5185\u5bb9\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>gathering =  smart \nfact_caching = redis \nfact_caching_timeout =86400 \nfact_caching_connection =127.0.0.1:6379\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#json\u6587\u4ef6","title":"json\u6587\u4ef6","text":"<p>\u5728 ansible.cfg \u4e2d\u914d\u7f6e</p> <pre><code>[defaults]\nfact_caching            = jsonfile\nfact_caching_connection = /tmp/.ansible_fact_cache\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#97-gather_subset","title":"9.7 Gather_subset","text":"<p>\u53ef\u9009\u62e9\u6027\u7684\u6536\u96c6network,hardware\u7b49\u4fe1\u606f\uff0c\u800c\u4e0d\u662f\u5168\u90e8</p> <p>\u5728 ansible.cfg \u4e2d\u914d\u7f6e</p> <pre><code># \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d,\u6392\u9664\u6536\u96c6\n[defaults]\ngather_subset=!hardware\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5728\u5728play\u4e2d\u5b9a\u4e49</p> <pre><code># \u4e0d\u6536\u96c6\u6570\u636e\n- hosts: whatever\n  gather_facts: no\n\n# \u53ea\u6536\u96c6minimal\n- hosts: all\n  gather_facts: False\n  pre_tasks:\n   - setup:\n      gather_subset:\n       - '!all'\n</code></pre>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#98-ansible\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b","title":"9.8 ansible\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b","text":"<p><code>/etc/ansible/ansible.cfg</code></p> <p>\u4e0b\u5217\u5217\u51fa\u4e86\u5e38\u7528\u7684\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u53ef\u7528\u4f5c\u53c2\u8003\u3002</p> <pre><code># /etc/ansible/ansible.cfg\n\n[defaults]\n# Set the log_path\nlog_path = ~/ansible.log\n\n# Additional default options for Ansible\nforks = 20\nhost_key_checking = False\nretry_files_enabled = False\nretry_files_save_path = ~/ansible-installer-retries\nnocows = True\nremote_user = root\nroles_path = roles/\ngathering = smart\nfact_caching = jsonfile\nfact_caching_connection = $HOME/ansible/facts\nfact_caching_timeout = 600\ncallback_whitelist = profile_tasks\ninventory_ignore_extensions = secrets.py, .pyc, .cfg, .crt, .ini\n# work around privilege escalation timeouts in ansible:\ntimeout = 30\nhost_key_checking = False\n\n# Uncomment to use the provided example inventory\n#inventory = inventory/hosts.example\n\nansible_managed = Ansible managed: {file} modified by {uid} on {host}\n\n[inventory]\n# fail more helpfully when the inventory file does not parse (Ansible 2.4+)\nunparsed_is_failed=true\n\n# Additional ssh options for OpenShift Ansible\n[ssh_connection]\nretries = 15\npipelining = True\nssh_args = -o ControlMaster=auto -o ControlPersist=600s\ntimeout = 10\n# shorten the ControlPath which is often too long; when it is,\n# ssh connection reuse silently fails, making everything slower.\ncontrol_path = %(directory)s/%%h-%%r\n</code></pre> <p>\u53c2\u8003\u6587\u6863</p> <p>http://docs.ansible.com/ansible/latest/playbooks_async.html </p> <p>Ansible \u4f18\u5316</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#10\u5229\u7528ansible-api\u63d0\u4f9b\u81ea\u52a8\u5316\u8fd0\u7ef4\u540e\u7aef","title":"10.\u5229\u7528Ansible API\u63d0\u4f9b\u81ea\u52a8\u5316\u8fd0\u7ef4\u540e\u7aef","text":"<p>Ansible\u672c\u8eab\u63d0\u4f9b\u4e86\u4e24\u4e2a\u6210\u719f\u7684\u3001\u5e38\u7528\u7684API,\u4e3b\u8981\u662f\u7528\u6765\u5b9e\u73b0Ansible\u7684Ad-hoc\u6a21\u5f0f\u548cplaybook\u6a21\u5f0f\uff0c</p> <p>\u8fd9\u4e24\u4e2aAPI\u5206\u522b\u4e3arunner API\u548cplaybook API\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7528\u6b64API\u6765\u5bf9 Ansible\u8fdb\u884c\u4e8c\u6b21\u5c01\u88c5\uff0c\u6216\u662f\u505a\u6210\u5355\u72ec\u7684\u7cfb\u7edf\u5bf9\u5916\u63d0\u4f9bHTTP\u63a5\u53e3\u7684\u670d\u52a1\uff0c\u914d\u5408\u524d\u7aef\uff0c\u8fd9\u6837\u5c31\u5f62\u6210\u4e86Wb\u81ea\u52a8\u5316\u8fd0\u7ef4\u4ea7\u54c1\uff0c</p> <p>\u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\uff0c\u975eIT\u4eba\u5458\uff08\u4f8b\u5982\u8d44\u4ea7\u90e8\u540c\u4e8b\u6216\u4ea7\u54c1\u90e8\u95e8\u540c\u4e8b)\u4e5f\u80fd\u901a\u8fc7\u56fe\u5f62\u754c\u9762\u6765\u5b8c\u6210\u81ea\u52a8\u5316\u8fd0\u7ef4\u7684\u5de5\u4f5c\u4e86\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u5206\u522b\u6765\u4ecb\u7ecd\u4e0brunner API\u548cplaybook API(Python\u73af\u5883\u4e3a3.8.10\uff0cAnsible\u7248\u672c\u4e3a2.12.10)\u3002</p>"},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#101-runner-api","title":"10.1 runner API","text":""},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#102-playbook-api","title":"10.2 playbook API","text":""},{"location":"Linux/Ansible/1.Ansible%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/#103-\u7528flask\u5c01\u88c5ansible\u63d0\u4f9b\u81ea\u52a8\u5316\u8fd0\u7ef4\u540e\u7aef","title":"10.3 \u7528Flask\u5c01\u88c5Ansible\u63d0\u4f9b\u81ea\u52a8\u5316\u8fd0\u7ef4\u540e\u7aef","text":""},{"location":"Linux/Ansible/2.Ansible-wiki/","title":"2.Ansible-wiki","text":""},{"location":"Linux/Ansible/2.Ansible-wiki/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Ansible\u4e2d\u6587\u6743\u5a01\u6307\u5357</li> <li>Ansible\u5b98\u65b9\u5e94\u7528\u90e8\u7f72\u7684\u4f8b\u5b50</li> <li>Ansible Cloud Alchemy</li> <li>Ansible\u7684\u5b98\u65b9Role\u5206\u4eab\u5e73\u53f0</li> <li>Ansible-wiki</li> <li>Ansible Wiki Site</li> <li>ansible-for-devops Public</li> <li>\u4e00\u6b65\u5230\u4f4d\u73a9\u900f Ansible (\u539f 51cto \u4e13\u680f)</li> </ul>"},{"location":"Linux/Ansible/2.Ansible-wiki/#docker-ansible-image","title":"docker ansible image","text":"<ul> <li>docker-ansible</li> </ul>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/","title":"1.Git\u57fa\u7840","text":""},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u521b\u5efa\u7248\u672c\u5e93","title":"\u521b\u5efa\u7248\u672c\u5e93","text":"<pre><code># \u5982\u679c\u672a\u6dfb\u52a0\u90ae\u7bb1\u9700\u8981\u6dfb\u52a0\ngit config --global user.name \"huanli\"\ngit config --global user.email 1879324764@qq.com\n\n# \u521d\u59cb\u5316\u4e00\u4e2aGit\u4ed3\u5e93\uff0c\u4f7f\u7528git init\u547d\u4ee4\u3002\ngit init .\n\n# \u6dfb\u52a0\u6587\u4ef6\u5230Git\u4ed3\u5e93\uff0c\u5206\u4e24\u6b65\uff1a\n# \u4f7f\u7528\u547d\u4ee4git add &lt;file&gt;\uff0c\u6ce8\u610f\uff0c\u53ef\u53cd\u590d\u591a\u6b21\u4f7f\u7528\uff0c\u6dfb\u52a0\u591a\u4e2a\u6587\u4ef6\uff1b\n# \u4f7f\u7528\u547d\u4ee4git commit -m &lt;message&gt;\uff0c\u5b8c\u6210\u3002\ngit add .\ngit commit -m \"first commit\"\n# \u7b49\u4e8e\u540c\u65f6\u6267\u884cgit add\u548cgit commit\ngit commit -am \"first2 commit\"\n</code></pre>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u7248\u672c\u56de\u9000","title":"\u7248\u672c\u56de\u9000","text":""},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u67e5\u770b\u5386\u53f2\u7248\u672c\u8bb0\u5f55","title":"\u67e5\u770b\u5386\u53f2\u7248\u672c\u8bb0\u5f55","text":"<pre><code># \u5386\u53f2\u8bb0\u5f55\uff0c\u5728Git\u4e2d\uff0c\u6211\u4eec\u7528git log\u547d\u4ee4\u67e5\u770b\uff1a\ngit log\n\n# \u5982\u679c\u5acc\u8f93\u51fa\u4fe1\u606f\u592a\u591a\uff0c\u770b\u5f97\u773c\u82b1\u7f2d\u4e71\u7684\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u52a0\u4e0a--pretty=oneline\u53c2\u6570\uff1a\ngit log --pretty=oneline\n\n# \u6216\u8005\ngit log --oneline\n</code></pre>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u56de\u9000\u5230\u4e0a\u4e00\u4e2a\u7248\u672c","title":"\u56de\u9000\u5230\u4e0a\u4e00\u4e2a\u7248\u672c","text":"<pre><code># \u6267\u884cgit reflog\u547d\u4ee4\uff0c\u67e5\u770b\u5f53\u524d\u4ed3\u5e93\u6267\u884c\u8fc7\u7684\u64cd\u4f5c\u7684\u65e5\u5fd7\ngit reflog\n\n# \u56de\u9000\u5230\u4e0a\u4e00\u4e2a\u7248\u672c\n# \u8fd9\u4e2a\u547d\u4ee4\u4f1a\u64a4\u9500\u672c\u5730\u4fee\u6539\uff0c\u6240\u4ee5\u5728\u6267\u884c\u4e4b\u524d\uff0c\u4f60\u8981\u4fdd\u5b58\u6240\u6709\u4e0d\u60f3\u4e22\u5931\u7684\u6539\u52a8\u3002\ngit reset --hard HEAD^\n</code></pre>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u56de\u9000\u5230\u6307\u5b9a\u7248\u672c","title":"\u56de\u9000\u5230\u6307\u5b9a\u7248\u672c","text":"<pre><code># \u56de\u9000\u5230\u6307\u5b9a\u7248\u672c\n# git reflog\u67e5\u770b\u547d\u4ee4\u5386\u53f2\uff0c\u4ee5\u4fbf\u786e\u5b9a\u8981\u56de\u5230\u672a\u6765\u7684\u54ea\u4e2a\u7248\u672c\ngit reflog\n\n# \u627e\u5230commit id\u662f1094adb.\ngit reset --hard 1094a\n</code></pre>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u56de\u5230\u8fdc\u7a0b\u4ed3\u5e93\u7684\u72b6\u6001","title":"\u56de\u5230\u8fdc\u7a0b\u4ed3\u5e93\u7684\u72b6\u6001","text":"<p>\u629b\u5f03\u672c\u5730\u6240\u6709\u7684\u4fee\u6539\uff0c\u56de\u5230\u8fdc\u7a0b\u4ed3\u5e93\u7684\u72b6\u6001</p> <pre><code>git fetch --all  git reset --hard origin/master git pull\n\n# \u4e0a\u8ff0\u5408\u5e76\u4e3a\u4e00\u6761\u547d\u4ee4\ngit fetch --all &amp;&amp; git reset --hard origin/master &amp;&amp; git pull\n</code></pre>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a","title":"\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a","text":"<ol> <li> <p><code>git add</code>\u628a\u6587\u4ef6\u6dfb\u52a0\u8fdb\u53bb\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u628a\u6587\u4ef6\u4fee\u6539\u6dfb\u52a0\u5230\u6682\u5b58\u533a\uff1b(\u5de5\u4f5c\u533a-\u6682\u5b58\u533a)</p> </li> <li> <p><code>git commit</code>\u63d0\u4ea4\u66f4\u6539\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u628a\u6682\u5b58\u533a\u7684\u6240\u6709\u5185\u5bb9\u63d0\u4ea4\u5230\u5f53\u524d\u5206\u652f\u3002(\u6682\u5b58\u533a-\u5206\u652f)</p> </li> </ol>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u67e5\u770b\u5de5\u4f5c\u533a\u4e0e\u6682\u5b58\u533a\u5dee\u5f02","title":"\u67e5\u770b\u5de5\u4f5c\u533a\u4e0e\u6682\u5b58\u533a\u5dee\u5f02","text":"<pre><code># \u67e5\u770b\u5dee\u5f02\u6587\u4ef6\ngit status\n\n# \u67e5\u770b\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a\u7684\u5dee\u5f02\ngit diff\n\n# \u67e5\u770b\u5de5\u4f5c\u533a\u548c\u6700\u65b0\u7248\u672c\u5e93\u7684\u533a\u522b\ngit diff HEAD\n</code></pre> <p>\u4e0d\u59a8\u517b\u6210\u4e00\u4e2a\u597d\u4e60\u60ef\uff0c\u5728\u6267\u884c<code>git commit</code>\u4e4b\u524d\u5148\u6267\u884c<code>git diff HEAD</code>\u547d\u4ee4\uff0c\u67e5\u770b\u672c\u6b21\u63d0\u4ea4\u548c\u4e0a\u6b21\u63d0\u4ea4\u4e4b\u95f4\u6709\u4ec0\u4e48\u5dee\u5f02\uff0c\u7b49\u786e\u8ba4\u5b8c\u4e86\u518d\u8fdb\u884c\u63d0\u4ea4\u3002HEAD\u662f\u6307\u5411\u5f53\u524d\u5206\u652f\u6700\u65b0\u7684\u4e00\u6b21\u63d0\u4ea4\u7684\u6307\u9488</p>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u67e5\u770b\u5e94\u7528\u4e24\u4e2a\u7248\u672c\u4e4b\u95f4\u7684\u5dee\u5f02","title":"\u67e5\u770b\u5e94\u7528\u4e24\u4e2a\u7248\u672c\u4e4b\u95f4\u7684\u5dee\u5f02","text":"<pre><code>git diff 2a 2b\n</code></pre>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u7ba1\u7406\u4fee\u6539","title":"\u7ba1\u7406\u4fee\u6539","text":"<pre><code># \u7b2c\u4e00\u6b21\ncoding ---&gt; git add \u6587\u4ef6(.)  ---&gt; git commit -m \"xxx\" # \u7b2c\u4e8c\u6b21\ncoding ---&gt; git add \u6587\u4ef6(.)  ---&gt; git commit -m \"xxx\" </code></pre>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u64a4\u9500\u4fee\u6539","title":"\u64a4\u9500\u4fee\u6539","text":"<p>\u573a\u666f1\uff1a\u5f53\u4f60\u6539\u4e71\u4e86\u5de5\u4f5c\u533a\u67d0\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u60f3\u76f4\u63a5\u4e22\u5f03\u5de5\u4f5c\u533a\u7684\u4fee\u6539\u65f6\uff0c\u7528\u547d\u4ee4<code>git checkout -- file</code>\u3002 <pre><code>git checkout -- file\ngit restore --staged &lt;file&gt;\n\n# \u653e\u5f03\u5de5\u4f5c\u533a\u7684\u4fee\u6539\ngit checkout &lt;file-name&gt;\n\n# \u653e\u5f03\u6240\u6709\u4fee\u6539\uff1a\ngit checkout .\n</code></pre></p> <p>\u573a\u666f2\uff1a\u5f53\u4f60\u4e0d\u4f46\u6539\u4e71\u4e86\u5de5\u4f5c\u533a\u67d0\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u8fd8\u6dfb\u52a0\u5230\u4e86\u6682\u5b58\u533a\u65f6\uff0c\u60f3\u4e22\u5f03\u4fee\u6539\uff0c\u5206\u4e24\u6b65\uff0c\u7b2c\u4e00\u6b65\u7528\u547d\u4ee4<code>git reset HEAD &lt;file&gt;</code>\uff0c\u5c31\u56de\u5230\u4e86\u573a\u666f1\uff0c\u7b2c\u4e8c\u6b65\u6309\u573a\u666f1\u64cd\u4f5c\u3002 <pre><code>git reset HEAD  &lt;file&gt;\n</code></pre></p> <p>\u573a\u666f3\uff1a\u5df2\u7ecf\u63d0\u4ea4\u4e86\u4e0d\u5408\u9002\u7684\u4fee\u6539\u5230\u7248\u672c\u5e93\u65f6\uff0c\u60f3\u8981\u64a4\u9500\u672c\u6b21\u63d0\u4ea4\uff0c\u53c2\u8003\u7248\u672c\u56de\u9000\u4e00\u8282\uff0c\u4e0d\u8fc7\u524d\u63d0\u662f\u6ca1\u6709\u63a8\u9001\u5230\u8fdc\u7a0b\u5e93\u3002 <pre><code>git reset --hard HEAD^\n</code></pre></p>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u4fee\u6539commit-message","title":"\u4fee\u6539Commit Message","text":""},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u4fee\u6539\u6700\u8fd1\u4e00\u6b21commit\u7684message","title":"\u4fee\u6539\u6700\u8fd1\u4e00\u6b21commit\u7684message","text":"<p><pre><code># git commit --amend\u540e\u4f1a\u8fdb\u5165\u4e00\u4e2a\u4ea4\u4e92\u754c\u9762\uff0c\u5728\u4ea4\u4e92\u754c\u9762\u4e2d\uff0c\u4fee\u6539\u6700\u8fd1\u4e00\u6b21\u7684 Commit Message\ngit commit --amend\n</code></pre> \u4fee\u6539\u5b8c\u6210\u540e\u6267\u884c:wq \u4fdd\u5b58\uff0c\u9000\u51fa\u7f16\u8f91\u5668\u4e4b\u540e\uff0c\u4f1a\u5728\u547d\u4ee4\u884c\u663e\u793a\uff0c\u8be5 commit \u7684 message \u7684\u66f4\u65b0\u7ed3\u679c\u3002</p>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u538b\u7f29\u5386\u53f2-\u4fee\u6539\u67d0\u6b21commit\u7684message","title":"\u538b\u7f29\u5386\u53f2-\u4fee\u6539\u67d0\u6b21commit\u7684message","text":"<pre><code>git checkout -b feature-C\n\n$ git branch\n* feature-C\n  fix_branch\n  hujianli\n  hujiianli\n  master\n\n$ cat README.md\n##hello\n## my friend\n- feature-A\n- feature-B\n- faeture-B\n\n# \u4fee\u6b63\u62fc\u5199\u9519\u8bef\n$ vim README.md\n\n$ git diff\ndiff --git a/README.md b/README.md\nindex 4e49ea0..aec690f 100644\n--- a/README.md\n+++ b/README.md\n@@ -3,4 +3,4 @@\n\n- feature-A\n - feature-B\n-- faeture-B\n+- feature-B\n\ngit commit -am \"Fix typo\"\n[feature-C 45b53fa] Fix typo\n 1 file changed, 1 insertion(+), 1 deletion(-)\n# \u5c06\u201cFix typo\u201d\u4fee\u6b63\u7684\u5185\u5bb9\u4e0e\u4e4b\u524d\u4e00\u6b21\u7684\u63d0\u4ea4\u5408\u5e76\uff0c\u5728\u5386\u53f2\u8bb0\u5f55\u4e2d\u5408\u5e76\u4e3a\u4e00\u6b21\u5b8c\u7f8e\u7684\u63d0\u4ea4\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u8981\u7528\u5230git rebase\u547d\u4ee4\ngit rebase -i HEAD~2\n# \u8fdb\u5165\u5230\u7f16\u8f91\u5668\u4e2d\uff0c\u5c06pick\u5220\u9664\uff0c\u4fee\u6539\u4e3afixup\uff0c\u7136\u540e\u62a5\u9519\uff0c\u7cfb\u7edf\u4f1a\u663e\u793arebase\u6210\u529f\uff0c\u8fd9\u65f62\u4e2a\u63d0\u4ea4\u52a8\u4f5c\u4f1a\u88ab\u5408\u5e76\u6210\u4e00\u4e2a\u3002\n# \u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u518d\u6b21\u67e5\u770b\ngit log --graph\n\n# \u6216\u8005\u4f7f\u7528\ngit rebase -i &lt;commit SHA&gt;~1\n# \u8fd9\u5c06\u542f\u52a8\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u7684 rebase \u8fdb\u7a0b\u3002\u5728\u7f16\u8f91\u5668\u4e2d\u627e\u5230\u8981\u4fee\u6539\u7684 commit \u884c\uff0c\u5e76\u5c06 pick \u6539\u4e3a reword \u6216 r,\u4fee\u6539\u5176 message\uff0c\u4fdd\u5b58\u5e76\u5173\u95ed\u7f16\u8f91\u5668\u3002\n</code></pre>"},{"location":"Linux/Git/1.Git%E5%9F%BA%E7%A1%80/#\u5220\u9664\u6587\u4ef6","title":"\u5220\u9664\u6587\u4ef6","text":"<p>\u5c06\u4ee3\u7801\u6587\u4ef6\u52a0\u5165\u5230\u7248\u672c\u5e93\u4e4b\u540e\uff0c\u5982\u679c\u51fa\u73b0\u8bef\u5220\u7684\u6587\u4ef6\u64cd\u4f5c\uff0c\u53ef\u4ee5\u76f4\u63a5\u6062\u590d\u5230\u6700\u65b0\u7248\u672c</p> <pre><code>git add test.txt\ngit commit -m \"add test.txt\"\nrm test.txt\ngit status\n\n# \u4e00\u662f\u786e\u5b9e\u8981\u4ece\u7248\u672c\u5e93\u4e2d\u5220\u9664\u8be5\u6587\u4ef6\uff0c\u90a3\u5c31\u7528\u547d\u4ee4git rm\u5220\u6389\uff0c\u5e76\u4e14git commit\uff1a\ngit rm test.txt\ngit commit -m \"remove test.txt\"\n# \u53e6\u4e00\u79cd\u60c5\u51b5\u662f\u5220\u9519\u4e86\uff0c\u56e0\u4e3a\u7248\u672c\u5e93\u91cc\u8fd8\u6709\u5462\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u628a\u8bef\u5220\u7684\u6587\u4ef6\u6062\u590d\u5230\u6700\u65b0\u7248\u672c\uff1a\ngit checkout -- test.txt\n</code></pre> <p>\u6ce8\u610f\uff1a\u4ece\u6765\u6ca1\u6709\u88ab\u6dfb\u52a0\u5230\u7248\u672c\u5e93\u5c31\u88ab\u5220\u9664\u7684\u6587\u4ef6\uff0c\u662f\u65e0\u6cd5\u6062\u590d\u7684\uff01</p>"},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/","title":"2.\u8fdc\u7a0b\u4ed3\u5e93","text":""},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u6dfb\u52a0\u8fdc\u7a0b\u5e93","title":"\u6dfb\u52a0\u8fdc\u7a0b\u5e93","text":"<p>\u4ee5GitHub\u4e3a\u793a\u4f8b</p>"},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u7b2c1\u6b65-\u521b\u5efassh-key","title":"\u7b2c1\u6b65: \u521b\u5efaSSH Key","text":"<p>\u5728\u7528\u6237\u4e3b\u76ee\u5f55\u4e0b\uff0c\u770b\u770b\u6709\u6ca1\u6709.ssh\u76ee\u5f55\uff0c\u5982\u679c\u6709\uff0c\u518d\u770b\u770b\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u6709\u6ca1\u6709id_rsa\u548cid_rsa.pub\u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u5982\u679c\u5df2\u7ecf\u6709\u4e86\uff0c\u53ef\u76f4\u63a5\u8df3\u5230\u4e0b\u4e00\u6b65\u3002 \u5982\u679c\u6ca1\u6709\uff0c\u6253\u5f00Shell\uff08Windows\u4e0b\u6253\u5f00Git Bash\uff09\uff0c\u521b\u5efaSSH Key\uff1a</p> <pre><code>$ ssh-keygen -t rsa -C \"youremail@example.com\"\n</code></pre> <p>\u5982\u679c\u4e00\u5207\u987a\u5229\u7684\u8bdd\uff0c\u53ef\u4ee5\u5728\u7528\u6237\u4e3b\u76ee\u5f55\u91cc\u627e\u5230<code>.ssh</code>\u76ee\u5f55\uff0c\u91cc\u9762\u6709<code>id_rsa</code>\u548c<code>id_rsa.pub</code>\u4e24\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e24\u4e2a\u5c31\u662fSSH Key\u7684\u79d8\u94a5\u5bf9\uff0c</p> <ul> <li>id_rsa\u662f\u79c1\u94a5\uff0c\u4e0d\u80fd\u6cc4\u9732\u51fa\u53bb</li> <li>id_rsa.pub\u662f\u516c\u94a5\uff0c\u53ef\u4ee5\u653e\u5fc3\u5730\u544a\u8bc9\u4efb\u4f55\u4eba\u3002</li> </ul>"},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u7b2c2\u6b65-\u767b\u9646github","title":"\u7b2c2\u6b65: \u767b\u9646GitHub","text":"<p>\u6253\u5f00\u201cAccount settings\u201d\uff0c\u201cSSH Keys\u201d\u9875\u9762\uff1a</p> <p>\u7136\u540e\uff0c\u70b9\u201cAdd SSH Key\u201d\uff0c\u586b\u4e0a\u4efb\u610fTitle\uff0c\u5728Key\u6587\u672c\u6846\u91cc\u7c98\u8d34id_rsa.pub\u6587\u4ef6\u7684\u5185\u5bb9\u3002</p> <p>GitHub\u5141\u8bb8\u4f60\u6dfb\u52a0\u591a\u4e2aKey\u3002\u5047\u5b9a\u4f60\u6709\u82e5\u5e72\u7535\u8111\uff0c\u4f60\u4e00\u4f1a\u513f\u5728\u516c\u53f8\u63d0\u4ea4\uff0c\u4e00\u4f1a\u513f\u5728\u5bb6\u91cc\u63d0\u4ea4\uff0c\u53ea\u8981\u628a\u6bcf\u53f0\u7535\u8111\u7684Key\u90fd\u6dfb\u52a0\u5230GitHub\uff0c\u5c31\u53ef\u4ee5\u5728\u6bcf\u53f0\u7535\u8111\u4e0a\u5f80GitHub\u63a8\u9001\u4e86\u3002</p>"},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u4ece\u8fdc\u7a0b\u5e93\u514b\u9686","title":"\u4ece\u8fdc\u7a0b\u5e93\u514b\u9686","text":""},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u83b7\u53d6\u8fdc\u7a0bmaster\u5206\u652f","title":"\u83b7\u53d6\u8fdc\u7a0bmaster\u5206\u652f","text":"<p>\u8981\u514b\u9686\u4e00\u4e2a\u4ed3\u5e93\uff0c\u9996\u5148\u5fc5\u987b\u77e5\u9053\u4ed3\u5e93\u7684\u5730\u5740\uff0c\u7136\u540e\u4f7f\u7528git clone\u547d\u4ee4\u514b\u9686\u3002</p> <p>Git\u652f\u6301\u591a\u79cd\u534f\u8bae\uff0c\u5305\u62ec<code>https</code>\uff0c\u4f46<code>ssh</code>\u534f\u8bae\u901f\u5ea6\u6700\u5feb\u3002</p> <pre><code> git clone git@github.com:michaelliao/gitskills.git\n</code></pre>"},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u83b7\u53d6\u8fdc\u7a0b\u7684feature-c\u5206\u652f","title":"\u83b7\u53d6\u8fdc\u7a0b\u7684feature-C\u5206\u652f","text":"<pre><code>git checkout -b feature-C origin/feature-C\n\nvim README.md\ngit diff\ngit commit -am \"ADD FEATURE-C\"\ngit push\n</code></pre> <p>\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u83b7\u53d6feature-C\u5206\u652f\uff0c\u5728\u672c\u5730\u4ed3\u5e93\u4e2d\u63d0\u4ea4\u66f4\u6539\uff0c\u518d\u5c06feature-C\u5206\u652f\u63a8\u9001\u56de\u8fdc\u7a0b\u4ed3\u5e93\uff0c</p> <p>\u901a\u8fc7\u8fd9\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u4e0e\u5176\u4ed6\u5f00\u53d1\u8005\u76f8\u4e92\u5408\u4f5c\uff0c\u5171\u540c\u57f9\u80b2feature-C\u5206\u652f\uff0c\u5b9e\u73b0\u67d0\u4e9b\u529f\u80fd\u3002</p> <p>\u5982\u679c\u4e24\u4eba\u540c\u65f6\u4fee\u6539\u540c\u4e00\u90e8\u5206\u7684\u6e90\u4ee3\u7801\uff0cpush\u65f6\u5c31\u5f88\u5bb9\u6613\u53d1\u751f\u51b2\u7a81\uff0c</p> <p>\u6240\u4ee5\u591a\u540d\u5f00\u53d1\u8005\u5728\u540c\u4e00\u4e2a\u5206\u652f\u4e2d\u8fdb\u884c\u4f5c\u4e1a\u65f6\uff0c\u4e3a\u51cf\u5c11\u51b2\u7a81\u60c5\u51b5\u7684\u53d1\u9001\uff0c\u5efa\u8bae\u9891\u7e41\u7684\u8fdb\u884cpush\u548cpull\u64cd\u4f5c\u3002</p> <pre><code>git pull origin feature-C\n</code></pre>"},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u63a8\u9001\u81f3\u8fdc\u7a0b","title":"\u63a8\u9001\u81f3\u8fdc\u7a0b","text":""},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u63a8\u9001\u81f3master\u5206\u652f","title":"\u63a8\u9001\u81f3master\u5206\u652f","text":"<pre><code>echo \"# test_github\" &gt;&gt; README.md\ngit init\ngit add README.md\ngit commit -m \"first commit\"\ngit branch -M master\ngit remote add origin git@github.com:hujianli94/test_github.git\ngit push -u origin master\n</code></pre> <p>\u5982\u679c\u51fa\u73b0\uff1a<code>git push error: failed to push some refs to</code>\u62a5\u9519\uff01\u8bf4\u660egithub\u4ed3\u5e93\u4e2d\u7684README\u6587\u4ef6\u4e0d\u5728\u672c\u5730\u4ee3\u7801\u76ee\u5f55\u4e2d\uff0c</p> <p>\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u9700\u8981\u5148\u5c06\u8fdc\u7a0b\u4ee3\u7801\u5e93\u4e2d\u7684\u4efb\u4f55\u6587\u4ef6\u5148pull\u5230\u672c\u5730\u4ee3\u7801\u5e93\u4e2d\uff0c\u624d\u80fdpush\u65b0\u7684\u4ee3\u7801\u5230github\u4ee3\u7801\u5e93\u4e2d\u3002</p> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4,\u7136\u540e\u518d\u8fdb\u884c\u4e0a\u4f20\uff1a</p> <pre><code>git pull --rebase origin master\ngit push -u origin master\n</code></pre>"},{"location":"Linux/Git/2.%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#\u63a8\u9001\u81f3master\u4ee5\u5916\u7684\u5206\u652f","title":"\u63a8\u9001\u81f3master\u4ee5\u5916\u7684\u5206\u652f","text":"<pre><code>git checkout feature-C\n\ngit push -u origin feature-C\n</code></pre> <p>\u73b0\u5728\uff0c\u5728\u8fdc\u7a0b\u4ed3\u5e93\u7684GitHub\u9875\u9762\u5c31\u53ef\u4ee5\u67e5\u770b\u5230feature-C\u5206\u652f\u4e86</p>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/","title":"3.\u5206\u652f\u7ba1\u7406","text":""},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#\u521b\u5efa\u4e0e\u5408\u5e76\u5206\u652f","title":"\u521b\u5efa\u4e0e\u5408\u5e76\u5206\u652f","text":"<pre><code># \u521b\u5efadev\u5206\u652f\uff0c\u7136\u540e\u5207\u6362\u5230dev\ngit checkout -b dev\n\n## \u6216\u8005\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\n# git branch dev\n# git checkout dev\n# git branch\u547d\u4ee4\u67e5\u770b\u5f53\u524d\u5206\u652f\ngit branch\n</code></pre>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#\u5207\u6362\u4e0e\u5408\u5e76\u5206\u652f","title":"\u5207\u6362\u4e0e\u5408\u5e76\u5206\u652f","text":"<pre><code># \u5207\u6362\u5206\u652f\ngit checkout master\n\n# git merge\u547d\u4ee4\u7528\u4e8e\u5408\u5e76\u6307\u5b9a\u5206\u652f\u5230\u5f53\u524d\u5206\u652f\u3002\ngit merge dev\n</code></pre> <pre><code># switch\n# \u521b\u5efa\u5e76\u5207\u6362\u5230\u65b0\u7684dev\u5206\u652f\uff0c\u53ef\u4ee5\u4f7f\u7528\uff1a\ngit switch -c dev\n\n# \u5207\u6362\u5206\u652f\ngit switch master\n</code></pre> <p>\u5408\u5e76\u5206\u652f\u6574\u4e2a\u6d41\u7a0b</p> <pre><code># \u67e5\u770b\u6240\u5728\u5206\u652f\n$ git branch\n* flask_yaml\n  master\n\n# \u5207\u6362\u5230\u4e3b\u5206\u652f\n$ git checkout master\nSwitched to branch 'master'\n# \u5408\u5e76\u67d0\u5206\u652f\u5230\u5f53\u524d\u4e3b\u5206\u652f\uff1a\n$ git merge flask_yaml\n</code></pre>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#\u5220\u9664\u5206\u652f","title":"\u5220\u9664\u5206\u652f","text":""},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#\u5220\u9664\u672c\u5730\u5206\u652f","title":"\u5220\u9664\u672c\u5730\u5206\u652f","text":"<pre><code># \u5408\u5e76\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u653e\u5fc3\u5730\u5220\u9664dev\u5206\u652f\u4e86\ngit branch -d dev\n\n# \u518d\u6b21\u67e5\u770b\u5c31\u6ca1\u6709dev\u5206\u652f\u4e86\ngit branch\n</code></pre>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#\u5220\u9664\u8fdc\u7a0b\u5206\u652f","title":"\u5220\u9664\u8fdc\u7a0b\u5206\u652f","text":"<pre><code># git push &lt;\u8fdc\u7a0b\u4ed3\u5e93\u540d\u79f0&gt; --delete &lt;\u5206\u652f\u540d\u79f0&gt;\ngit push origin --delete feature/branch\n</code></pre>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#\u89e3\u51b3\u5206\u652f\u51b2\u7a81","title":"\u89e3\u51b3\u5206\u652f\u51b2\u7a81","text":"<pre><code># \u5f53Git\u65e0\u6cd5\u81ea\u52a8\u5408\u5e76\u5206\u652f\u65f6\uff0c\u5c31\u5fc5\u987b\u9996\u5148\u89e3\u51b3\u51b2\u7a81\u3002\u89e3\u51b3\u51b2\u7a81\u540e\uff0c\u518d\u63d0\u4ea4\uff0c\u5408\u5e76\u5b8c\u6210\u3002\n# git log --graph\u547d\u4ee4\u53ef\u4ee5\u770b\u5230\u5206\u652f\u5408\u5e76\u56fe\u3002\ngit log --graph\n\n# \u663e\u793a\u77ed\u53f7\u5206\u652f\u5408\u5e76\u56fe\ngit log --graph --pretty=oneline --abbrev-commit\n\n# Git\u51fa\u73b0\u5408\u5e76\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u624b\u52a8\u89e3\u51b3\u51b2\u7a81\u540e\u518d\u63d0\u4ea4\u3002\n# Git\u7528&lt;&lt;&lt;&lt;&lt;&lt;&lt;\uff0c=======\uff0c&gt;&gt;&gt;&gt;&gt;&gt;&gt;\u6807\u8bb0\u51fa\u4e0d\u540c\u5206\u652f\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u4fee\u6539\u4e3a\u81ea\u5df1\u60f3\u8981\u7684\u4ee3\u7801\u540e\u4fdd\u5b58\u5373\u53ef\u89e3\u51b3\u51b2\u7a81\n</code></pre>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<pre><code># \u67e5\u770b\u5206\u652f\uff1a\ngit branch\n\n# \u521b\u5efa\u5206\u652f\uff1a\ngit branch &lt;name&gt;\n\n# \u5207\u6362\u5206\u652f\uff1a\ngit checkout &lt;name&gt; \u6216\u8005 git switch &lt;name&gt;\n\n# \u521b\u5efa+\u5207\u6362\u5206\u652f\uff1a\ngit checkout -b &lt;name&gt;\u6216\u8005git switch -c &lt;name&gt;\n\n# \u5408\u5e76\u67d0\u5206\u652f\u5230\u5f53\u524d\u5206\u652f\uff1a\ngit merge &lt;name&gt;\n\n# \u5220\u9664\u5206\u652f\uff1a\ngit branch -d &lt;name&gt;\n</code></pre>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#bug\u5206\u652f","title":"Bug\u5206\u652f","text":"<p>\u4fee\u590dbug\u65f6\uff0c\u6211\u4eec\u4f1a\u901a\u8fc7\u521b\u5efa\u65b0\u7684bug\u5206\u652f\u8fdb\u884c\u4fee\u590d\uff0c\u7136\u540e\u5408\u5e76\uff0c\u6700\u540e\u5220\u9664\uff1b</p> <p>\u5f53\u624b\u5934\u5de5\u4f5c\u6ca1\u6709\u5b8c\u6210\u65f6\uff0c\u5148\u628a\u5de5\u4f5c\u73b0\u573a<code>git stash</code>\u4e00\u4e0b\uff0c\u7136\u540e\u53bb\u4fee\u590dbug\uff0c\u4fee\u590d\u540e\uff0c\u518d<code>git stash pop</code>\uff0c\u56de\u5230\u5de5\u4f5c\u73b0\u573a\uff1b</p> <p>\u5728master\u5206\u652f\u4e0a\u4fee\u590d\u7684bug\uff0c\u60f3\u8981\u5408\u5e76\u5230\u5f53\u524ddev\u5206\u652f\uff0c\u53ef\u4ee5\u7528<code>git cherry-pick &lt;commit&gt;</code>\u547d\u4ee4\uff0c\u628abug\u63d0\u4ea4\u7684\u4fee\u6539\u201c\u590d\u5236\u201d\u5230\u5f53\u524d\u5206\u652f\uff0c\u907f\u514d\u91cd\u590d\u52b3\u52a8\u3002</p> <pre><code># \u76ee\u524d\u5728dev\u5206\u652f\u5728coding\u5f00\u53d1\ngit status\nOn branch dev\n\n## ----------------\u7a81\u7136\u51fa\u73b0\u4e86\u4e34\u65f6\u7d27\u6025\u7684bug\u9700\u8981\u4fee\u590d--------------------\n# \u628a\u5f53\u524d\u5de5\u4f5c\u73b0\u573a\u201c\u50a8\u85cf\u201d\u8d77\u6765\uff0c\u7b49\u4ee5\u540e\u6062\u590d\u73b0\u573a\u540e\u7ee7\u7eed\u5de5\u4f5c\uff1a\ngit stash\n\n# \u5207\u6362\u5230master\u5206\u652f\ngit checkout master\n# \u521b\u5efaBug\u5206\u652f\ngit checkout -b issue-101\n\n# \u5f00\u59cb\u5728bug\u5206\u652f\u4fee\u590d\u95ee\u9898\ngit add readme.txt git commit -m \"fix bug 101\"\n# \u4fee\u590d\u5b8c\u6210\u540e\uff0c\u5207\u6362\u5230master\u5206\u652f\uff0c\u5e76\u5b8c\u6210\u5408\u5e76\uff0c\u6700\u540e\u5220\u9664issue-101\u5206\u652f\uff1a\ngit switch master\n\ngit merge --no-ff -m \"merged bug fix 101\" issue-101\n\n# \u592a\u68d2\u4e86\uff0c\u539f\u8ba1\u5212\u4e24\u4e2a\u5c0f\u65f6\u7684bug\u4fee\u590d\u53ea\u82b1\u4e865\u5206\u949f\uff01\u73b0\u5728\uff0c\u662f\u65f6\u5019\u63a5\u7740\u56de\u5230dev\u5206\u652f\u5e72\u6d3b\u4e86\uff01\ngit switch dev\n\ngit status\n\n# \u5de5\u4f5c\u533a\u662f\u5e72\u51c0\u7684\uff0c\u521a\u624d\u7684\u5de5\u4f5c\u73b0\u573a\u5b58\u5230\u54ea\u53bb\u4e86\uff1f\u7528git stash list\u547d\u4ee4\u770b\u770b\uff1a\ngit stash list\n\n# \u5de5\u4f5c\u73b0\u573a\u8fd8\u5728\uff0cGit\u628astash\u5185\u5bb9\u5b58\u5728\u67d0\u4e2a\u5730\u65b9\u4e86\uff0c\u4f46\u662f\u9700\u8981\u6062\u590d\u4e00\u4e0b\uff0c\u6709\u4e24\u4e2a\u529e\u6cd5\uff1a\n# \u4e00\u662f\u7528git stash apply\u6062\u590d\uff0c\u4f46\u662f\u6062\u590d\u540e\uff0cstash\u5185\u5bb9\u5e76\u4e0d\u5220\u9664\uff0c\u4f60\u9700\u8981\u7528git stash drop\u6765\u5220\u9664\uff1b\ngit stash apply stash@{0}\ngit stash drop@{0}\n# \u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\u7528git stash pop\uff0c\u6062\u590d\u7684\u540c\u65f6\u628astash\u5185\u5bb9\u4e5f\u5220\u4e86\uff1a\ngit stash pop\n</code></pre> <p>\u540c\u6837\u7684bug\uff0c\u8981\u5728dev\u4e0a\u4fee\u590d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u628a4c805e2 fix bug 101\u8fd9\u4e2a\u63d0\u4ea4\u6240\u505a\u7684\u4fee\u6539\u201c\u590d\u5236\u201d\u5230dev\u5206\u652f\u3002\u6ce8\u610f\uff1a\u6211\u4eec\u53ea\u60f3\u590d\u52364c805e2 fix bug 101\u8fd9\u4e2a\u63d0\u4ea4\u6240\u505a\u7684\u4fee\u6539\uff0c\u5e76\u4e0d\u662f\u628a\u6574\u4e2amaster\u5206\u652fmerge\u8fc7\u6765\u3002</p> <pre><code>git branch\n* dev\n  master\n\ngit cherry-pick 4c805e2\n[master 1d4b803] fix bug 101\n1 file changed, 1 insertion(+), 1 deletion(-)\n</code></pre>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#feature\u5206\u652f","title":"Feature\u5206\u652f","text":"<p>\u5f00\u53d1\u4e00\u4e2a\u65b0feature\uff0c\u6700\u597d\u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff1b</p> <pre><code>git switch -c feature-vulcan\n\ngit add vulcan.py\ngit status\ngit commit -m \"add feature vulcan\"\n# \u5207\u56dedev\uff0c\u51c6\u5907\u5408\u5e76\uff1a\ngit switch dev\n\n# \u7a81\u7136\u53d1\u73b0\u529f\u80fd\u5f88\u9e21\u808b\uff0c\u4e0d\u7528\u5408\u5e76\u4e86,\u9500\u6bc1\u5931\u8d25\u3002Git\u53cb\u60c5\u63d0\u9192\uff0cfeature-vulcan\u5206\u652f\u8fd8\u6ca1\u6709\u88ab\u5408\u5e76\uff0c\u5982\u679c\u5220\u9664\uff0c\u5c06\u4e22\u5931\u6389\u4fee\u6539\uff0c\u5982\u679c\u8981\u5f3a\u884c\u5220\u9664\uff0c\u9700\u8981\u4f7f\u7528\u5927\u5199\u7684-D\u53c2\u6570\u3002\u3002\ngit branch -d feature-vulcan\nerror: The branch 'feature-vulcan' is not fully merged.\nIf you are sure you want to delete it, run 'git branch -D feature-vulcan'.\n</code></pre> <p>\u5982\u679c\u8981\u4e22\u5f03\u4e00\u4e2a\u6ca1\u6709\u88ab\u5408\u5e76\u8fc7\u7684\u5206\u652f\uff0c\u53ef\u4ee5\u901a\u8fc7<code>git branch -D &lt;name&gt;</code>\u5f3a\u884c\u5220\u9664\u3002</p> <pre><code>git branch -D feature-vulcan\n</code></pre>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#\u5173\u8054\u5206\u652f\u591a\u4eba\u534f\u4f5c","title":"\u5173\u8054\u5206\u652f\u591a\u4eba\u534f\u4f5c","text":"<p>\u5f53\u4f60\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u514b\u9686\u65f6\uff0c\u5b9e\u9645\u4e0aGit\u81ea\u52a8\u628a\u672c\u5730\u7684master\u5206\u652f\u548c\u8fdc\u7a0b\u7684master\u5206\u652f\u5bf9\u5e94\u8d77\u6765\u4e86\uff0c\u5e76\u4e14\uff0c\u8fdc\u7a0b\u4ed3\u5e93\u7684\u9ed8\u8ba4\u540d\u79f0\u662f<code>origin</code>\u3002</p> <p>\u8981\u67e5\u770b\u8fdc\u7a0b\u5e93\u7684\u4fe1\u606f\uff0c\u7528<code>git remote</code></p> <pre><code># \u8981\u67e5\u770b\u8fdc\u7a0b\u5e93\u7684\u4fe1\u606f\ngit remote\n# \u663e\u793a\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\ngit remote -v\n</code></pre> <p>\u63a8\u9001\u5206\u652f</p> <pre><code>git push origin master\n\n# \u63a8\u9001\u5176\u4ed6\u5206\u652f\uff0c\u6bd4\u5982dev\ngit push origin dev\n</code></pre> <p>\u4f46\u662f\uff0c\u5e76\u4e0d\u662f\u4e00\u5b9a\u8981\u628a\u672c\u5730\u5206\u652f\u5f80\u8fdc\u7a0b\u63a8\u9001\uff0c\u90a3\u4e48\uff0c\u54ea\u4e9b\u5206\u652f\u9700\u8981\u63a8\u9001\uff0c\u54ea\u4e9b\u4e0d\u9700\u8981\u5462\uff1f</p> <ul> <li> <p>master\u5206\u652f\u662f\u4e3b\u5206\u652f\uff0c\u56e0\u6b64\u8981\u65f6\u523b\u4e0e\u8fdc\u7a0b\u540c\u6b65\uff1b</p> </li> <li> <p>dev\u5206\u652f\u662f\u5f00\u53d1\u5206\u652f\uff0c\u56e2\u961f\u6240\u6709\u6210\u5458\u90fd\u9700\u8981\u5728\u4e0a\u9762\u5de5\u4f5c\uff0c\u6240\u4ee5\u4e5f\u9700\u8981\u4e0e\u8fdc\u7a0b\u540c\u6b65\uff1b</p> </li> <li> <p>bug\u5206\u652f\u53ea\u7528\u4e8e\u5728\u672c\u5730\u4fee\u590dbug\uff0c\u5c31\u6ca1\u5fc5\u8981\u63a8\u5230\u8fdc\u7a0b\u4e86\uff0c\u9664\u975e\u8001\u677f\u8981\u770b\u770b\u4f60\u6bcf\u5468\u5230\u5e95\u4fee\u590d\u4e86\u51e0\u4e2abug\uff1b</p> </li> <li> <p>feature\u5206\u652f\u662f\u5426\u63a8\u5230\u8fdc\u7a0b\uff0c\u53d6\u51b3\u4e8e\u4f60\u662f\u5426\u548c\u4f60\u7684\u5c0f\u4f19\u4f34\u5408\u4f5c\u5728\u4e0a\u9762\u5f00\u53d1\u3002</p> </li> </ul> <p><pre><code># \u5c0f\u4f19\u4f34A\ngit clone git@github.com:michaelliao/learngit.git\ngit branch\ngit checkout -b dev origin/dev\n\ngit add env.txt\ngit commit -m \"add env\"\ngit push origin dev\n\n# \u4f60\u7684\u5c0f\u4f19\u4f34A\u5df2\u7ecf\u5411origin/dev\u5206\u652f\u63a8\u9001\u4e86\u4ed6\u7684\u63d0\u4ea4\uff0c\u800c\u78b0\u5de7\u4f60\u4e5f\u5bf9\u540c\u6837\u7684\u6587\u4ef6\u4f5c\u4e86\u4fee\u6539\uff0c\u5e76\u8bd5\u56fe\u63a8\u9001\uff1a\ncat env.txt\nenv\n\ngit add env.txt\ngit commit -m \"add new env\"\n[dev 7bd91f1] add new env\n 1 file changed, 1 insertion(+)\ncreate mode 100644 env.txt\n\ngit push origin dev\nTo github.com:michaelliao/learngit.git\n ! [rejected]        dev -&gt; dev (non-fast-forward)\nerror: failed to push some refs to 'git@github.com:michaelliao/learngit.git'\nhint: Updates were rejected because the tip of your current branch is behind\nhint: its remote counterpart. Integrate the remote changes (e.g.\nhint: 'git pull ...') before pushing again.\nhint: See the 'Note about fast-forwards' in 'git push --help' for details.\n</code></pre> \u63a8\u9001\u5931\u8d25\uff0c\u56e0\u4e3a\u4f60\u7684\u5c0f\u4f19\u4f34A\u7684\u6700\u65b0\u63d0\u4ea4\u548c\u4f60\u8bd5\u56fe\u63a8\u9001\u7684\u63d0\u4ea4\u6709\u51b2\u7a81\uff0c\u89e3\u51b3\u529e\u6cd5\u4e5f\u5f88\u7b80\u5355\uff0cGit\u5df2\u7ecf\u63d0\u793a\u6211\u4eec\uff0c\u5148\u7528git pull\u628a\u6700\u65b0\u7684\u63d0\u4ea4\u4eceorigin/dev\u6293\u4e0b\u6765\uff0c\u7136\u540e\uff0c\u5728\u672c\u5730\u5408\u5e76\uff0c\u89e3\u51b3\u51b2\u7a81\uff0c\u518d\u63a8\u9001\uff1a</p> <pre><code># \u7acb\u672c\u5730\u5206\u652f\u548c\u8fdc\u7a0b\u5206\u652f\u7684\u5173\u8054\ngit branch --set-upstream-to=origin/dev dev\ngit pull\n\n# \u8fd9\u56degit pull\u6210\u529f\uff0c\u4f46\u662f\u5408\u5e76\u6709\u51b2\u7a81\uff0c\u9700\u8981\u624b\u52a8\u89e3\u51b3\uff0c\u89e3\u51b3\u7684\u65b9\u6cd5\u548c\u5206\u652f\u7ba1\u7406\u4e2d\u7684\u89e3\u51b3\u51b2\u7a81\u5b8c\u5168\u4e00\u6837\u3002\u89e3\u51b3\u540e\uff0c\u63d0\u4ea4\uff0c\u518dpush\uff1a\ngit commit -m \"fix env conflict\"\n[dev 57c53ab] fix env conflict\n\ngit push origin dev\n</code></pre> <p>\u56e0\u6b64\uff0c\u591a\u4eba\u534f\u4f5c\u7684\u5de5\u4f5c\u6a21\u5f0f\u901a\u5e38\u662f\u8fd9\u6837\uff1a</p> <ol> <li>\u67e5\u770b\u8fdc\u7a0b\u5e93\u4fe1\u606f\uff0c\u4f7f\u7528<code>git remote -v</code>\uff1b</li> <li>\u672c\u5730\u65b0\u5efa\u7684\u5206\u652f\u5982\u679c\u4e0d\u63a8\u9001\u5230\u8fdc\u7a0b\uff0c\u5bf9\u5176\u4ed6\u4eba\u5c31\u662f\u4e0d\u53ef\u89c1\u7684\uff1b</li> <li>\u4ece\u672c\u5730\u63a8\u9001\u5206\u652f\uff0c\u4f7f\u7528<code>git push origin branch-name</code>\uff0c\u5982\u679c\u63a8\u9001\u5931\u8d25\uff0c\u5148\u7528<code>git pull</code>\u6293\u53d6\u8fdc\u7a0b\u7684\u65b0\u63d0\u4ea4\uff1b </li> <li>\u5728\u672c\u5730\u521b\u5efa\u548c\u8fdc\u7a0b\u5206\u652f\u5bf9\u5e94\u7684\u5206\u652f\uff0c\u4f7f\u7528<code>git checkout -b branch-name origin/branch-name</code>\uff0c\u672c\u5730\u548c\u8fdc\u7a0b\u5206\u652f\u7684\u540d\u79f0\u6700\u597d\u4e00\u81f4\uff1b</li> <li>\u5efa\u7acb\u672c\u5730\u5206\u652f\u548c\u8fdc\u7a0b\u5206\u652f\u7684\u5173\u8054\uff0c\u4f7f\u7528<code>git branch --set-upstream branch-name origin/branch-name</code>\uff1b</li> <li>\u4ece\u8fdc\u7a0b\u6293\u53d6\u5206\u652f\uff0c\u4f7f\u7528<code>git pull</code>\uff0c\u5982\u679c\u6709\u51b2\u7a81\uff0c\u8981\u5148\u5904\u7406\u51b2\u7a81\u3002</li> </ol>"},{"location":"Linux/Git/3.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#rebase","title":"Rebase","text":"<p>Git\u6709\u4e00\u79cd\u79f0\u4e3arebase\u7684\u64cd\u4f5c\uff0c\u6709\u4eba\u628a\u5b83\u7ffb\u8bd1\u6210\"\u53d8\u57fa\"</p> <p>\"\u53d8\u57fa\"\u7684\u4f5c\u7528\u5c31\u662f\u628a\u5206\u53c9\u7684\u63d0\u4ea4\u53d8\u6210\u76f4\u7ebf\u3002</p> <pre><code>$ git log --graph --pretty=oneline --abbrev-commit\n* 582d922 (HEAD -&gt; master) add author\n* 8875536 add comment\n* d1be385 (origin/master) init hello\n*   e5e69f1 Merge branch 'dev'\n|\\  | *   57c53ab (origin/dev, dev) fix env conflict\n| |\\  | | * 7a5e5dd add env\n| * | 7bd91f1 add new env\n...\n\n# \u5148\u62c9\u53d6\u5408\u5e76\u8fdc\u7a0b\u5206\u652f\n$ git pull\n\n# \u52a0\u4e0a\u521a\u624d\u5408\u5e76\u7684\u63d0\u4ea4\uff0c\u73b0\u5728\u6211\u4eec\u672c\u5730\u5206\u652f\u6bd4\u8fdc\u7a0b\u5206\u652f\u8d85\u524d3\u4e2a\u63d0\u4ea4\u3002\n$ git status\nOn branch master\nYour branch is ahead of 'origin/master' by 3 commits.\n  (use \"git push\" to publish your local commits)\nnothing to commit, working tree clean\n\n# \u7528git log\u770b\u770b\uff1a\n$ git log --graph --pretty=oneline --abbrev-commit\n*   e0ea545 (HEAD -&gt; master) Merge branch 'master' of github.com:michaelliao/learngit\n|\\  | * f005ed4 (origin/master) set exit=1\n* | 582d922 add author\n* | 8875536 add comment\n|/  * d1be385 init hello\n...\n</code></pre> <pre><code>$ git rebase\nFirst, rewinding head to replay your work on top of it...\nApplying: add comment\nUsing index info to reconstruct a base tree...\nM    hello.py\nFalling back to patching base and 3-way merge...\nAuto-merging hello.py\nApplying: add author\nUsing index info to reconstruct a base tree...\nM    hello.py\nFalling back to patching base and 3-way merge...\nAuto-merging hello.py\n</code></pre> <p>\u8f93\u51fa\u4e86\u4e00\u5927\u5806\u64cd\u4f5c\uff0c\u5230\u5e95\u662f\u5565\u6548\u679c\uff1f\u518d\u7528git log\u770b\u770b\uff1a <pre><code>$ git log --graph --pretty=oneline --abbrev-commit\n* 7e61ed4 (HEAD -&gt; master) add author\n* 3611cfe add comment\n* f005ed4 (origin/master) set exit=1\n* d1be385 init hello\n...\n</code></pre></p> <p>\u8fd9\u5c31\u662frebase\u64cd\u4f5c\u7684\u7279\u70b9\uff1a\u628a\u5206\u53c9\u7684\u63d0\u4ea4\u5386\u53f2\"\u6574\u7406\"\u6210\u4e00\u6761\u76f4\u7ebf\uff0c\u770b\u4e0a\u53bb\u66f4\u76f4\u89c2\u3002\u7f3a\u70b9\u662f\u672c\u5730\u7684\u5206\u53c9\u63d0\u4ea4\u5df2\u7ecf\u88ab\u4fee\u6539\u8fc7\u4e86\u3002</p> <p>\u603b\u7ed3\uff1a</p> <ul> <li>rebase\u64cd\u4f5c\u53ef\u4ee5\u628a\u672c\u5730\u672apush\u7684\u5206\u53c9\u63d0\u4ea4\u5386\u53f2\u6574\u7406\u6210\u76f4\u7ebf\uff1b</li> <li>rebase\u7684\u76ee\u7684\u662f\u4f7f\u5f97\u6211\u4eec\u5728\u67e5\u770b\u5386\u53f2\u63d0\u4ea4\u7684\u53d8\u5316\u65f6\u66f4\u5bb9\u6613\uff0c\u56e0\u4e3a\u5206\u53c9\u7684\u63d0\u4ea4\u9700\u8981\u4e09\u65b9\u5bf9\u6bd4\u3002</li> </ul>"},{"location":"Linux/Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/","title":"4.\u5206\u652f\u7ba1\u7406\u7b56\u7565","text":"<p>\u901a\u5e38\uff0c\u5408\u5e76\u5206\u652f\u65f6\uff0c\u5982\u679c\u53ef\u80fd\uff0cGit\u4f1a\u7528Fast forward\u6a21\u5f0f\uff0c\u4f46\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u5220\u9664\u5206\u652f\u540e\uff0c\u4f1a\u4e22\u6389\u5206\u652f\u4fe1\u606f</p> <p>\u5982\u679c\u8981\u5f3a\u5236\u7981\u7528Fast forward\u6a21\u5f0f\uff0cGit\u5c31\u4f1a\u5728merge\u65f6\u751f\u6210\u4e00\u4e2a\u65b0\u7684commit\uff0c\u8fd9\u6837\uff0c\u4ece\u5206\u652f\u5386\u53f2\u4e0a\u5c31\u53ef\u4ee5\u770b\u51fa\u5206\u652f\u4fe1\u606f\u3002</p> <pre><code>git switch -c dev\ngit add readme.txt git commit -m \"add merge\"\ngit switch master\n\n# --no-ff\u53c2\u6570\uff0c\u8868\u793a\u7981\u7528Fast forward\uff1a\ngit merge --no-ff -m \"merge with no-ff\" dev\n\ngit log --graph --pretty=oneline --abbrev-commit\n</code></pre> <p>\u5408\u5e76\u5206\u652f\u65f6\uff0c\u52a0\u4e0a<code>--no-ff</code>\u53c2\u6570\u5c31\u53ef\u4ee5\u7528\u666e\u901a\u6a21\u5f0f\u5408\u5e76\uff0c\u5408\u5e76\u540e\u7684\u5386\u53f2\u6709\u5206\u652f\uff0c\u80fd\u770b\u51fa\u6765\u66fe\u7ecf\u505a\u8fc7\u5408\u5e76\uff0c\u800cfast forward\u5408\u5e76\u5c31\u770b\u4e0d\u51fa\u6765\u66fe\u7ecf\u505a\u8fc7\u5408\u5e76\u3002</p>"},{"location":"Linux/Git/4.%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5/#\u5206\u652f\u7b56\u7565","title":"\u5206\u652f\u7b56\u7565","text":"<p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u5e94\u8be5\u6309\u7167\u51e0\u4e2a\u57fa\u672c\u539f\u5219\u8fdb\u884c\u5206\u652f\u7ba1\u7406\uff1a</p> <p>\u9996\u5148\uff0cmaster\u5206\u652f\u5e94\u8be5\u662f\u975e\u5e38\u7a33\u5b9a\u7684\uff0c\u4e5f\u5c31\u662f\u4ec5\u7528\u6765\u53d1\u5e03\u65b0\u7248\u672c\uff0c\u5e73\u65f6\u4e0d\u80fd\u5728\u4e0a\u9762\u5e72\u6d3b\uff1b</p> <p>\u90a3\u5728\u54ea\u5e72\u6d3b\u5462\uff1f</p> <p>\u5e72\u6d3b\u90fd\u5728dev\u5206\u652f\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cdev\u5206\u652f\u662f\u4e0d\u7a33\u5b9a\u7684\uff0c\u5230\u67d0\u4e2a\u65f6\u5019\uff0c\u6bd4\u59821.0\u7248\u672c\u53d1\u5e03\u65f6\uff0c\u518d\u628adev\u5206\u652f\u5408\u5e76\u5230master\u4e0a\uff0c\u5728master\u5206\u652f\u53d1\u5e031.0\u7248\u672c\uff1b</p> <p>\u4f60\u548c\u4f60\u7684\u5c0f\u4f19\u4f34\u4eec\u6bcf\u4e2a\u4eba\u90fd\u5728dev\u5206\u652f\u4e0a\u5e72\u6d3b\uff0c\u6bcf\u4e2a\u4eba\u90fd\u6709\u81ea\u5df1\u7684\u5206\u652f\uff0c\u65f6\u4e0d\u65f6\u5730\u5f80dev\u5206\u652f\u4e0a\u5408\u5e76\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u56e2\u961f\u5408\u4f5c\u7684\u5206\u652f\u770b\u8d77\u6765\u5c31\u50cf\u8fd9\u6837\uff1a</p> <p></p>"},{"location":"Linux/Git/5.%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86/","title":"5.\u6807\u7b7e\u7ba1\u7406","text":"<p>Git\u6709commit\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u5f15\u5165tag\uff1f</p> <p>\u201c\u8bf7\u628a\u4e0a\u5468\u4e00\u7684\u90a3\u4e2a\u7248\u672c\u6253\u5305\u53d1\u5e03\uff0ccommit\u53f7\u662f6a5819e\u2026\u201d</p> <p>\u201c\u4e00\u4e32\u4e71\u4e03\u516b\u7cdf\u7684\u6570\u5b57\u4e0d\u597d\u627e\uff01\u201d</p> <p>\u5982\u679c\u6362\u4e00\u4e2a\u529e\u6cd5\uff1a</p> <p>\u201c\u8bf7\u628a\u4e0a\u5468\u4e00\u7684\u90a3\u4e2a\u7248\u672c\u6253\u5305\u53d1\u5e03\uff0c\u7248\u672c\u53f7\u662fv1.2\u201d</p> <p>\u201c\u597d\u7684\uff0c\u6309\u7167tag v1.2\u67e5\u627ecommit\u5c31\u884c\uff01\u201d</p> <p>\u6240\u4ee5\uff0ctag\u5c31\u662f\u4e00\u4e2a\u8ba9\u4eba\u5bb9\u6613\u8bb0\u4f4f\u7684\u6709\u610f\u4e49\u7684\u540d\u5b57\uff0c\u5b83\u8ddf\u67d0\u4e2acommit\u7ed1\u5728\u4e00\u8d77\u3002</p>"},{"location":"Linux/Git/5.%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86/#\u521b\u5efa\u6807\u7b7e","title":"\u521b\u5efa\u6807\u7b7e","text":"<pre><code>$ git branch\n* dev\n  master\n$ git checkout master\nSwitched to branch 'master'\n# \u6253\u4e00\u4e2a\u65b0\u6807\u7b7e\n$ git tag v1.0\n\n$ git tag\nv1.0\n\n# \u9ed8\u8ba4\u6807\u7b7e\u662f\u6253\u5728\u6700\u65b0\u63d0\u4ea4\u7684commit\u4e0a\u7684\u3002\u6709\u65f6\u5019\uff0c\u5982\u679c\u5fd8\u4e86\u6253\u6807\u7b7e\uff0c\u6bd4\u5982\uff0c\u73b0\u5728\u5df2\u7ecf\u662f\u5468\u4e94\u4e86\uff0c\u4f46\u5e94\u8be5\u5728\u5468\u4e00\u6253\u7684\u6807\u7b7e\u6ca1\u6709\u6253\uff0c\u600e\u4e48\u529e\uff1f\n# \u65b9\u6cd5\u662f\u627e\u5230\u5386\u53f2\u63d0\u4ea4\u7684commit id\uff0c\u7136\u540e\u6253\u4e0a\u5c31\u53ef\u4ee5\u4e86\uff1a\n$ git log --pretty=oneline --abbrev-commit\n1eb85f1 (HEAD -&gt; master, tag: v1.0, origin/master, origin/HEAD) modify README.md\n2408cbd \u66f4\u65b0README\n97a6780 \u4fee\u6539README.md\n046545a modify README\n864c775 \u6b63\u5e38\u8fd0\u884ccurd\n4c4e653 first commit\n80c50f1 Initial commit\n\n# \u6bd4\u65b9\u8bf4\u8981\u5bf9add merge\u8fd9\u6b21\u63d0\u4ea4\u6253\u6807\u7b7e\uff0c\u5b83\u5bf9\u5e94\u7684commit id\u662f2408cbd\uff0c\u6572\u5165\u547d\u4ee4\uff1a\n$ git tag v0.9 2408cbd\n\n# \u518d\u7528\u547d\u4ee4git tag\u67e5\u770b\u6807\u7b7e\uff1a\n$ git tag\nv0.9\nv1.0\n\n# \u6ce8\u610f\uff0c\u6807\u7b7e\u4e0d\u662f\u6309\u65f6\u95f4\u987a\u5e8f\u5217\u51fa\uff0c\u800c\u662f\u6309\u5b57\u6bcd\u6392\u5e8f\u7684\u3002\u53ef\u4ee5\u7528git show &lt;tagname&gt;\u67e5\u770b\u6807\u7b7e\u4fe1\u606f\uff1a\n$ git show v0.9\ncommit 2408cbddea915b360145b2dfc27d3c53549200ff (tag: v0.9)\nAuthor: \u5efa\u529b &lt;1879324764@qq.com&gt;\nDate:   Fri Aug 11 06:14:32 2023 +0000\n\n\u66f4\u65b0README\n\nSigned-off-by: \u5efa\u529b &lt;1879324764@qq.com&gt;\n\ndiff --git a/README.md b/README.md\nindex aa2c267..38d3d69 100644\n....\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c<code>v0.9</code>\u786e\u5b9e\u6253\u5728<code>\u66f4\u65b0README</code>\u8fd9\u6b21\u63d0\u4ea4\u4e0a\u3002</p> <p>\u8fd8\u53ef\u4ee5\u521b\u5efa\u5e26\u6709\u8bf4\u660e\u7684\u6807\u7b7e\uff0c\u7528-a\u6307\u5b9a\u6807\u7b7e\u540d\uff0c-m\u6307\u5b9a\u8bf4\u660e\u6587\u5b57\uff1a</p> <pre><code>$ git tag -a v0.1 -m \"version 0.1 released\" 1094adb\n</code></pre> <p>\u7528\u547d\u4ee4<code>git show &lt;tagname&gt;</code>\u53ef\u4ee5\u770b\u5230\u8bf4\u660e\u6587\u5b57\uff1a</p> <pre><code>$ git show v1.0\ncommit 1eb85f1a1b0021b57da00df5076a7dd17cd01f50 (HEAD -&gt; master, tag: v1.0, origin/master, origin/HEAD)\nAuthor: \u5efa\u529b &lt;1879324764@qq.com&gt;\nDate:   Mon Aug 14 09:28:44 2023 +0000\n\nmodify README.md\n\nSigned-off-by: \u5efa\u529b &lt;1879324764@qq.com&gt;\n\ndiff --git a/dockerfile/code-server/Dockerfile b/dockerfile/code-server/Dockerfile\nindex c5247a5..03edbc3 100644\n--- a/dockerfile/code-server/Dockerfile\n+++ b/dockerfile/code-server/Dockerfile\n@@ -61,8 +61,10 @@ RUN set -ux; \\\nadduser coder sudo &amp;&amp; \\\necho '%sudo ALL=(ALL) NOPASSWD:ALL' &gt;&gt; /etc/sudoers &amp;&amp; \\\necho \"root:P@ssw0rd\" | chpasswd &amp;&amp; \\\n+  echo \"coder:oschina\" | chpasswd &amp;&amp; \\\nlocale-gen en_US.UTF-8\n.....\n</code></pre> <p>\u6ce8\u610f\uff1a \u6807\u7b7e\u603b\u662f\u548c\u67d0\u4e2acommit\u6302\u94a9\u3002\u5982\u679c\u8fd9\u4e2acommit\u65e2\u51fa\u73b0\u5728master\u5206\u652f\uff0c\u53c8\u51fa\u73b0\u5728dev\u5206\u652f\uff0c\u90a3\u4e48\u5728\u8fd9\u4e24\u4e2a\u5206\u652f\u4e0a\u90fd\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u6807\u7b7e\u3002</p>"},{"location":"Linux/Git/5.%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<ul> <li>\u547d\u4ee4<code>git tag &lt;tagname&gt;</code>\u7528\u4e8e\u65b0\u5efa\u4e00\u4e2a\u6807\u7b7e\uff0c\u9ed8\u8ba4\u4e3aHEAD\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2acommit id\uff1b</li> <li>\u547d\u4ee4<code>git tag -a &lt;tagname&gt; -m \"blablabla...\"</code>\u53ef\u4ee5\u6307\u5b9a\u6807\u7b7e\u4fe1\u606f\uff1b</li> <li>\u547d\u4ee4<code>git tag</code>\u53ef\u4ee5\u67e5\u770b\u6240\u6709\u6807\u7b7e\u3002</li> </ul>"},{"location":"Linux/Git/5.%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86/#\u64cd\u4f5c\u6807\u7b7e","title":"\u64cd\u4f5c\u6807\u7b7e","text":"<p>\u5982\u679c\u6807\u7b7e\u6253\u9519\u4e86\uff0c\u4e5f\u53ef\u4ee5\u5220\u9664\uff1a</p> <pre><code>$ git tag -d v0.1\nDeleted tag 'v0.1' (was f15b0dd)\n</code></pre> <p>\u56e0\u4e3a\u521b\u5efa\u7684\u6807\u7b7e\u90fd\u53ea\u5b58\u50a8\u5728\u672c\u5730\uff0c\u4e0d\u4f1a\u81ea\u52a8\u63a8\u9001\u5230\u8fdc\u7a0b\u3002\u6240\u4ee5\uff0c\u6253\u9519\u7684\u6807\u7b7e\u53ef\u4ee5\u5728\u672c\u5730\u5b89\u5168\u5220\u9664\u3002</p> <p>\u5982\u679c\u8981\u63a8\u9001\u67d0\u4e2a\u6807\u7b7e\u5230\u8fdc\u7a0b\uff0c\u4f7f\u7528\u547d\u4ee4<code>git push origin &lt;tagname&gt;</code>\uff1a</p> <pre><code>$ git push origin v1.0\nTotal 0 (delta 0), reused 0 (delta 0)\nTo github.com:michaelliao/learngit.git\n * [new tag]         v1.0 -&gt; v1.0\n</code></pre> <p>\u6216\u8005\uff0c\u4e00\u6b21\u6027\u63a8\u9001\u5168\u90e8\u5c1a\u672a\u63a8\u9001\u5230\u8fdc\u7a0b\u7684\u672c\u5730\u6807\u7b7e\uff1a</p> <pre><code>$ git push origin --tags\nTotal 0 (delta 0), reused 0 (delta 0)\nTo github.com:michaelliao/learngit.git\n * [new tag]         v0.9 -&gt; v0.9\n</code></pre> <p>\u5982\u679c\u6807\u7b7e\u5df2\u7ecf\u63a8\u9001\u5230\u8fdc\u7a0b\uff0c\u8981\u5220\u9664\u8fdc\u7a0b\u6807\u7b7e\u5c31\u9ebb\u70e6\u4e00\u70b9\uff0c\u5148\u4ece\u672c\u5730\u5220\u9664\uff1a</p> <pre><code>$ git tag -d v0.9\nDeleted tag 'v0.9' (was f52c633)\n</code></pre> <p>\u7136\u540e\uff0c\u4ece\u8fdc\u7a0b\u5220\u9664\u3002\u5220\u9664\u547d\u4ee4\u4e5f\u662fpush\uff0c\u4f46\u662f\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>$ git push origin :refs/tags/v0.9\nTo github.com:michaelliao/learngit.git\n - [deleted]         v0.9\n</code></pre> <p>\u8981\u770b\u770b\u662f\u5426\u771f\u7684\u4ece\u8fdc\u7a0b\u5e93\u5220\u9664\u4e86\u6807\u7b7e\uff0c\u53ef\u4ee5\u767b\u9646GitHub\u67e5\u770b\u3002</p>"},{"location":"Linux/Git/5.%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86/#\u5c0f\u7ed3_1","title":"\u5c0f\u7ed3","text":"<ul> <li>\u547d\u4ee4<code>git push origin &lt;tagname&gt;</code>\u53ef\u4ee5\u63a8\u9001\u4e00\u4e2a\u672c\u5730\u6807\u7b7e\uff1b</li> <li>\u547d\u4ee4<code>git push origin --tags</code>\u53ef\u4ee5\u63a8\u9001\u5168\u90e8\u672a\u63a8\u9001\u8fc7\u7684\u672c\u5730\u6807\u7b7e\uff1b</li> <li>\u547d\u4ee4<code>git tag -d &lt;tagname&gt;</code>\u53ef\u4ee5\u5220\u9664\u4e00\u4e2a\u672c\u5730\u6807\u7b7e\uff1b</li> <li>\u547d\u4ee4<code>git push origin :refs/tags/&lt;tagname&gt;</code>\u53ef\u4ee5\u5220\u9664\u4e00\u4e2a\u8fdc\u7a0b\u6807\u7b7e</li> </ul>"},{"location":"Linux/Git/6.%E4%BD%BF%E7%94%A8Gitee/","title":"6.\u4f7f\u7528Gitee","text":""},{"location":"Linux/Git/6.%E4%BD%BF%E7%94%A8Gitee/#\u65b0\u5efa\u4ed3\u5e93","title":"\u65b0\u5efa\u4ed3\u5e93","text":"<p>\u5728Gitee\u4e0a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u9879\u76eelearngit</p>"},{"location":"Linux/Git/6.%E4%BD%BF%E7%94%A8Gitee/#\u5173\u8054\u4ed3\u5e93","title":"\u5173\u8054\u4ed3\u5e93","text":"<p><pre><code>git remote add origin git@gitee.com:liaoxuefeng/learngit.git\n\n# \u53ef\u4ee5\u5148\u7528git remote -v\u67e5\u770b\u8fdc\u7a0b\u5e93\u4fe1\u606f\ngit remote -v\norigin    git@github.com:michaelliao/learngit.git (fetch)\norigin    git@github.com:michaelliao/learngit.git (push)\n# \u53ef\u4ee5\u5220\u9664\u5df2\u6709\u7684GitHub\u8fdc\u7a0b\u5e93\ngit remote rm origin\n\n# \u518d\u6b21\u6dfb\u52a0\u5173\u8054\ngit remote add origin git@gitee.com:liaoxuefeng/learngit.git\n</code></pre> \u73b0\u5728\u53ef\u4ee5\u770b\u5230\uff0corigin\u5df2\u7ecf\u88ab\u5173\u8054\u5230Gitee\u7684\u8fdc\u7a0b\u5e93\u4e86\u3002\u901a\u8fc7git push\u547d\u4ee4\u5c31\u53ef\u4ee5\u628a\u672c\u5730\u5e93\u63a8\u9001\u5230Gitee\u4e0a\u3002</p> <p>\u540c\u65f6\u5173\u8054GitHub\u548cGitee\u7684\u8fdc\u7a0b\u5e93</p> <pre><code>git remote rm origin\ngit remote add github git@github.com:michaelliao/learngit.git\ngit remote add gitee git@gitee.com:liaoxuefeng/learngit.git\n\ngit remote -v\n\n# \u5982\u679c\u8981\u63a8\u9001\u5230GitHub\uff0c\u4f7f\u7528\u547d\u4ee4\uff1a\ngit push github master\n\n# \u5982\u679c\u8981\u63a8\u9001\u5230Gitee\uff0c\u4f7f\u7528\u547d\u4ee4\uff1a\ngit push gitee master\n</code></pre> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u7684\u672c\u5730\u5e93\u5c31\u53ef\u4ee5\u540c\u65f6\u4e0e\u591a\u4e2a\u8fdc\u7a0b\u5e93\u4e92\u76f8\u540c\u6b65\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 GitHub  \u2502 \u2502  Gitee  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u25b2           \u25b2\n     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Local Repo  \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"Linux/Git/7.%E4%BD%BF%E7%94%A8Github/","title":"7.\u4f7f\u7528Github","text":""},{"location":"Linux/Git/7.%E4%BD%BF%E7%94%A8Github/#github\u4e0a\u63d0\u4ea4pr","title":"Github\u4e0a\u63d0\u4ea4PR","text":""},{"location":"Linux/Git/7.%E4%BD%BF%E7%94%A8Github/#\u57fa\u4e8epr\u7684\u5de5\u4f5c\u6d41","title":"\u57fa\u4e8ePR\u7684\u5de5\u4f5c\u6d41","text":"<pre><code>$ git clone https://gitee.com/oschina/gitee.git\nCloning into 'gitee'...\nUsername for 'https://gitee.com': 1879324764@qq.com\nPassword for 'https://1879324764@qq.com@gitee.com':\n\n$ cd gitee\n\n# \u53d6\u56de\u8fdc\u7a0b\u4e3b\u673a\u7684\u66f4\u65b0\u4ee5\u540e\uff0c\u5728\u5b83\u7684\u57fa\u7840\u4e0a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5206\u652f \n$ git checkout -b hujianli/fix-ci-new origin/master # \u6216\u8005\u5207\u6362\u5230\u81ea\u5df1\u7684\u5206\u652f\n$ git checkout branchNamexxx\n\n# \u5f00\u59cb coding\n# \u5b8c\u6210\u4ee3\u7801\u4fee\u590d\u548c\u4f18\u5316\u540e\uff0c\u63d0\u4ea4\u4ee3\u7801\n$ git add .\n$git commit -m \"fix ent-doc\"\n[hujianli/fix-ci-new a5613c2b716] fix ent-doc\n 1 file changed, 1 insertion(+), 1 deletion(-)\n$ git push origin hujianli/fix-ci-new\n</code></pre>"},{"location":"Linux/Git/7.%E4%BD%BF%E7%94%A8Github/#\u5c0f\u7ed3","title":"\u5c0f\u7ed3","text":"<ul> <li>\u5728GitHub\u4e0a\uff0c\u53ef\u4ee5\u4efb\u610fFork\u5f00\u6e90\u4ed3\u5e93\uff1b</li> <li>\u81ea\u5df1\u62e5\u6709Fork\u540e\u7684\u4ed3\u5e93\u7684\u8bfb\u5199\u6743\u9650\uff1b</li> <li>\u53ef\u4ee5\u63a8\u9001pull request\u7ed9\u5b98\u65b9\u4ed3\u5e93\u6765\u8d21\u732e\u4ee3\u7801\u3002</li> </ul>"},{"location":"Linux/Git/7.%E4%BD%BF%E7%94%A8Github/#github\u4e0a\u9762\u627e\u5f00\u6e90\u9879\u76ee","title":"GitHub\u4e0a\u9762\u627e\u5f00\u6e90\u9879\u76ee","text":""},{"location":"Linux/Git/7.%E4%BD%BF%E7%94%A8Github/#1\u5355\u6761\u4ef6\u4f7f\u7528","title":"1.\u5355\u6761\u4ef6\u4f7f\u7528","text":"<ol> <li> <p>\u9879\u76ee\u540d\u79f0 \u4ed3\u5e93\u540d\u79f0\u5305\u542b spring \u7684\u9879\u76ee <code>in:name spring</code></p> </li> <li> <p>\u9879\u76ee\u63cf\u8ff0 \u4ed3\u5e93\u63cf\u8ff0\u4e2d\u5305\u542b spring \u7684\u9879\u76ee <code>in:description spring</code></p> </li> <li> <p>readme\u6587\u4ef6 readme \u4e2d\u7684\u63cf\u8ff0\u5305\u542b spring \u7684\u9879\u76ee <code>in:readme spring</code></p> </li> <li> <p>star\u6570\u91cf star \u6570\u91cf\u5927\u4e8e 1000 \u7684\u9879\u76ee <code>starts: &gt;1000</code></p> </li> </ol> <p>star \u6570\u91cf\u5728 10~20\u76f4\u63a5\u7684\u9879\u76ee <code>stars:10..20</code></p> <ol> <li>fork \u6570\u91cf fork \u6570\u91cf\u5927\u4e8e 1000 \u7684\u9879\u76ee <code>fork:&gt;1000</code></li> </ol> <p><code>fork \u6570\u91cf\u5728 10~20 \u4e4b\u95f4\u7684\u9879\u76ee</code></p> <ol> <li> <p>\u4ed3\u5e93\u5927\u5c0f \u6309\u7167\u4ed3\u5e93\u5927\u5c0f\u8fdb\u884c\u641c\u7d22\uff0c\u5355\u4f4d\uff1aKB\uff0c\u4ed3\u5e93\u5927\u4e8e1000kB\u7684\u9879\u76ee <code>size:&gt;=1000</code></p> </li> <li> <p>\u6700\u8fd1\u66f4\u65b0\u65f6\u95f4 \u6700\u8fd1\u4e00\u6b21\u63d0\u4ea4\u57282019\u5e74\u4ee5\u540e\u7684\u4ed3\u5e93 <code>pushed:&gt;2019-01-01 \u5173\u952e\u8bcd</code></p> </li> <li> <p>\u4ed3\u5e93\u521b\u5efa\u65f6\u95f4 2019\u5e74\u4ee5\u540e\u521b\u5efa\u7684\u4ed3\u5e93 <code>created:&gt;2019-01-01 \u5173\u952e\u8bcd</code></p> </li> <li> <p>license \u4f7f\u7528 apache-2.0 \u534f\u8bae\u7684\u4ed3\u5e93 <code>license:apache-2.0 \u5173\u952e\u8bcd</code></p> </li> <li> <p>\u4ed3\u5e93\u4f7f\u7528\u7684\u5f00\u53d1\u8bed\u8a00 \u7528java \u8bed\u8a00\u5199\u7684\u4ed3\u5e93 <code>language:java \u5173\u952e\u8bcd</code></p> </li> <li> <p>\u4ed3\u5e93\u7684\u4f5c\u8005 \u7528\u6237google \u4e0a\u4f20\u7684\u4ed3\u5e93 <code>user:google \u5173\u952e\u8bcd</code></p> </li> <li> <p>\u7ec4\u7ec7\u7684\u4ed3\u5e93 \u5217\u51faorg \u7684 spring-cloud \u4ed3\u5e93 <code>org:spring-cloud</code></p> </li> </ol>"},{"location":"Linux/Git/7.%E4%BD%BF%E7%94%A8Github/#2\u7ec4\u5408\u6761\u4ef6\u4f7f\u7528","title":"2.\u7ec4\u5408\u6761\u4ef6\u4f7f\u7528","text":"<ol> <li>\u641c\u7d22\u540d\u5b57\u5305\u542b spring boot ,\u5e76\u4e14 star \u5728 1000 \u4ee5\u4e0a\u7684\u9879\u76ee\u3002</li> </ol> <p><code>in:name spring boot stars:&gt;1000</code></p> <ol> <li>\u641c\u7d22\u63cf\u8ff0\u4e2d\u5305\u542b spring boot,\u5e76\u4e14 star \u57281000\u4ee5\u4e0a\uff0clanguage \u4e3a java \u7684\u9879\u76ee\u3002</li> </ol> <p><code>in:description spring boot stars:&gt;1000 language:java</code></p> <ol> <li>\u641c\u7d22 readme \u4e2d\u5305\u542b\u5173\u952e\u5b57\u3010\u6d4b\u8bd5\u81ea\u52a8\u5316\u6846\u67b6\u3011\uff0c\u5e76\u4e14 star \u5728 100 \u4ee5\u4e0a\uff0clanguage \u662f python \u7684\u9879\u76ee.</li> </ol> <p><code>in:readme \u6d4b\u8bd5\u81ea\u52a8\u5316\u6846\u67b6 stars:&gt;100 language:python</code></p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/","title":"8.\u5b9e\u8df5GitHub Flow","text":""},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u83b7\u53d6\u6700\u65b0\u4e3b\u5206\u652f\u4ee3\u7801","title":"\u83b7\u53d6\u6700\u65b0\u4e3b\u5206\u652f\u4ee3\u7801","text":"<p>\u5982\u679c\u5c1a\u672aclone\u4ed3\u5e93</p> <pre><code># \u9ed8\u8ba4\u62c9\u53d6\u7684\u662fmaster\u5206\u652f\uff0cGithub\u4e0a\u662fmain\u5206\u652f\n$ git clone git@github,com:ituring/fizzbuzz.git\n</code></pre> <p>\u5982\u679c\u4e4b\u524dclone\u8fc7\u4ed3\u5e93</p> <pre><code>$ git checkout master\n$ git pull\n</code></pre> <p>\u901a\u8fc7\u4ee5\u4e0a\u64cd\u4f5c\uff0c\u6211\u4eec\u624b\u5934\u5c31\u6709\u4e86\u6700\u65b0\u72b6\u6001\u7684master\u5206\u652f\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u521b\u5efa\u7279\u6027\u5206\u652f","title":"\u521b\u5efa\u7279\u6027\u5206\u652f","text":"<pre><code># \u6211\u4eec\u5c06\u65b0\u5206\u652f\u7684\u540d\u5b57\u5b9a\u4e3a7-case-output-github\u3002\n$ git checkout -b 7-case-output-github\n\n# \u4e3a\u65b9\u4fbf\u56e2\u961f\u5176\u4ed6\u4eba\u901a\u8fc7\u5206\u652f\u540d\u79f0\u77e5\u9053\u6211\u4eec\u5728\u505a\u4ec0\u4e48\uff0c\u6211\u4eec\u5728GitHub\u7aef\u7684\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u521b\u5efa\u4e00\u4e2a\u540c\u540d\u5206\u652f\u3002\n$ git push -u origin 7-case-output-github\n</code></pre> <p>\u521b\u5efa\u5206\u652f\u5927\u6982\u5c31\u662f\u8fd9\u4e2a\u6b65\u9aa4\u3002\u4eca\u540e\u6211\u4eec\u53ef\u4ee5\u6bcf\u5f53\u5de5\u4f5c\u544a\u4e00\u6bb5\u843d\u65f6\uff0c\u5b9a\u671f\u5c06\u8fd9\u4e2a\u7279\u6027\u5206\u652fpush\u5230\u8fdc\u7a0b\u4ed3\u5e93\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u5b9e\u73b0\u65b0\u529f\u80fd","title":"\u5b9e\u73b0\u65b0\u529f\u80fd","text":"<p>\u5199\u4ee3\u7801\u2026..</p> <p>\u63d0\u4ea4\u672c\u6b21\u5b9e\u73b0\u7684\u65b0\u529f\u80fd\u548c\u9700\u6c42 <pre><code># coding....\n$ git commit -am \"Add output GitHub\"\n//\u65b0\u529f\u80fd\u5df2\u7ecf\u987a\u5229\u5b9e\u73b0\uff0c\u73b0\u5728\u5c06\u5176push\u5230\u8fdc\u7a0b\u4ed3\u5e93\u3002\n$ git push\n</code></pre></p> <p>GitHub\u7aef\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u7684\u5206\u652f\u5e94\u8be5\u5df2\u7ecf\u88ab\u66f4\u65b0\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u521b\u5efapull-request","title":"\u521b\u5efaPull Request","text":"<p>\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u987a\u5229\u5b9e\u73b0\u4e86\u65b0\u529f\u80fd\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4ece<code>7-case-output-github</code>\u5206\u652f\u521b\u5efa\u4e00\u4e2a<code>Pull Request</code>\u53d1\u9001\u7ed9<code>master</code>\u5206\u652f\uff0c\u8bf7\u6c42\u4e0e<code>master</code>\u5408\u5e76\u3002</p> <p>\u5728Pull Request\u4e2d\u5199\u660e\u5e0c\u671b\u5f97\u5230\u5ba1\u67e5\u3002</p> <p>\u5982\u679c\u60f3\u8ba9\u7279\u5b9a\u7684\u4eba\u6765\u8fdb\u884c\u5ba1\u67e5\uff0c\u53ef\u4ee5\u5728\u8bc4\u8bba\u4e2d\u52a0\u5165<code>\"@\u7528\u6237\u540d\"</code>\uff0c\u8fd9\u6837\u8be5\u7528\u6237\u5c31\u4f1a\u6536\u5230Notifications\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u63a5\u6536\u53cd\u9988","title":"\u63a5\u6536\u53cd\u9988","text":"<p>\u81f3\u4e8e\u6d4b\u8bd5\u4ee3\u7801\uff0c\u6211\u4eec\u786e\u5b9e\u5728\u6dfb\u52a0\u65b0\u529f\u80fd\u65f6\u6ca1\u6709\u6dfb\u52a0\u76f8\u5e94\u7684\u6d4b\u8bd5\u4ee3\u7801\uff0c\u5bf9\u65b9\u6307\u51fa\u7684\u95ee\u9898\u786e\u5b9e\u5b58\u5728\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u4fee\u6b63\u88ab\u6307\u51fa\u7684\u95ee\u9898","title":"\u4fee\u6b63\u88ab\u6307\u51fa\u7684\u95ee\u9898","text":"<p>\u7136\u540e\u5c06\u4fee\u6539\u63d0\u4ea4\u81f3\u672c\u5730\u76847-case-output-github\u5206\u652f\u3002</p> <pre><code>$ git commit -am \"Fix index\"\n# \u8be5\u5206\u652fpush\u5230GitHub\u7aef\u7684\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u4e3a\u8fdc\u7a0b\u4ed3\u5e93\u5206\u652f\u6dfb\u52a0\u8fd9\u9879\u4fee\u6539\n$ git push\n</code></pre> <p>\u6211\u4eec\u518d\u6253\u5f00GitHub\u67e5\u770bPull Request\uff0c\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u7528\u4e8e\u4fee\u6b63\u7684\u63d0\u4ea4\u5df2\u7ecf\u6dfb\u52a0\u81f3Pull Request\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u6dfb\u52a0\u6d4b\u8bd5","title":"\u6dfb\u52a0\u6d4b\u8bd5","text":"<p>\u5728GitHub Flow\u4e2d\uff0c\u4e0d\u53ef\u4ee5\u5c06\u6ca1\u6709\u6d4b\u8bd5\u4ee3\u7801\u7684\u6210\u54c1\u4ee3\u7801\u52a0\u5165master\u5206\u652f\u3002\u56e0\u6b64\u6211\u4eec\u88ab\u5176\u4ed6\u5f00\u53d1\u8005\u6307\u51fa\u6ca1\u6709\u7f16\u5199\u6d4b\u8bd5\u4ee3\u7801\u4e86\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u57f9\u80b2pull-request","title":"\u57f9\u80b2Pull Request","text":"<p>\u4e3a\u4e86\u5c06\u6211\u4eec\u7f16\u5199\u7684\u65b0\u529f\u80fd\u5408\u5e76\u5230master\u5206\u652f\u4e2d\uff0c\u8981\u8fdb\u884c\u63d0\u4ea4\u5e76push\u3002</p> <pre><code>$ git commit -am \"Fix output Github\"\n# \u8be5\u5206\u652fpush\u5230GitHub\u7aef\u7684\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u4e3a\u8fdc\u7a0b\u4ed3\u5e93\u5206\u652f\u6dfb\u52a0\u8fd9\u9879\u4fee\u6539\n$ git push\n</code></pre> <p>\u786e\u8ba4Pull Request\u6ca1\u6709\u95ee\u9898\u4e4b\u540e\uff0c\u4fbf\u53ef\u4ee5\u901a\u8fc7\u8bc4\u8bba\u8bf7\u6c42\u4e0emaster\u5408\u5e76\u4e86</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#pull-request\u88ab\u5408\u5e76","title":"Pull Request\u88ab\u5408\u5e76","text":"<p>\u5408\u5e76\u5b8c\u6210\u540e\uff0c\u8fd9\u4e2amaster\u5206\u652f\u5c06\u88ab\u7acb\u523b\u90e8\u7f72\u81f3\u6b63\u5f0f\u73af\u5883\u3002</p> <p>\u4e60\u60ef\u4e86\u5728Pull Request\u4e0a\u8fdb\u884c\u4ea4\u6d41\u540e\uff0c\u6211\u4eec\u5c06\u80fd\u66f4\u7cbe\u786e\u5730\u8868\u8fbe\u51fa\u4ee3\u7801\u7684\u610f\u56fe\uff0c\u5ba1\u67e5\u7684\u6548\u7387\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u5feb\u3002</p> <p>\u719f\u7ec3\u8fd0\u7528<code>Pull Request</code>\u662f\u8fd9\u4e00\u5f00\u53d1\u6d41\u7a0b\u6210\u529f\u7684\u5173\u952e\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u56e2\u961f\u5b9e\u8df5github-flow\u65f6\u7684\u51e0\u70b9\u5efa\u8bae","title":"\u56e2\u961f\u5b9e\u8df5GitHub Flow\u65f6\u7684\u51e0\u70b9\u5efa\u8bae","text":""},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u51cf\u5c0fpull-request\u7684\u4f53\u79ef","title":"\u51cf\u5c0fPull Request\u7684\u4f53\u79ef","text":"<p>\u5f00\u53d1\u65f6\u95f4\u8d8a\u957f\u6216\u8005\u4ee3\u7801\u91cf\u8d8a\u5927\uff0c\u4ee3\u7801\u5ba1\u67e5\u65f6\u7684\u6210\u672c\u5c31\u8d8a\u9ad8\u3002 \u8fc7\u957f\u7684\u5f00\u53d1\u65f6\u95f4\u8ba9\u5ba1\u67e5\u8005\u96be\u4ee5\u4e86\u89e3\u5f00\u53d1\u8be5\u529f\u80fd\u65f6\u7684\u80cc\u666f\uff0c\u8fc7\u5927\u7684\u4ee3\u7801\u91cf\u4f1a\u8ba9\u5ba1\u67e5\u8005\u96be\u4ee5\u9605\u8bfb\u5230\u4ee3\u7801\u7684\u6bcf\u4e2a\u7ec6\u8282\u3002 \u8fd9\u6837\u4e00\u6765BUG\u66f4\u5bb9\u6613\u51fa\u73b0\uff0c\u4e45\u800c\u4e45\u4e4b\u6574\u4e2a\u56e2\u961f\u7684\u4ee3\u7801\u5ba1\u67e5\u90fd\u4f1a\u6f0f\u6d1e\u9891\u51fa\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u51c6\u5907\u53ef\u4f9b\u8bd5\u8fd0\u884c\u7684\u73af\u5883","title":"\u51c6\u5907\u53ef\u4f9b\u8bd5\u8fd0\u884c\u7684\u73af\u5883","text":"<p>\u6211\u4eec\u4e0d\u59a8\u521b\u5efa\u4e00\u4e2a\u4e0e\u6b63\u5f0f\u73af\u5883\u9ad8\u5ea6\u76f8\u4f3c\u7684\u9884\u6f14\uff08Staging\uff09\u73af\u5883\uff0c\u5728\u8fd9\u4e2a\u9884\u6f14\u73af\u5883\u4e2d\u90e8\u7f72\u5173\u952e\u4fee\u6539\uff0c\u501f\u4ee5\u786e\u8ba4\u4ee3\u7801\u7684\u5b9e\u9645\u8fd0\u884c\u72b6\u51b5\u3002</p> <p>\u5f53\u7136\uff0c\u5411\u9884\u6f14\u73af\u5883\u7684\u90e8\u7f72\u4e5f\u9700\u8981\u5b9e\u73b0\u81ea\u52a8\u5316\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u4e0d\u8981\u8ba9pull-request\u4e2d\u6709\u592a\u591a\u53cd\u9988","title":"\u4e0d\u8981\u8ba9Pull Request\u4e2d\u6709\u592a\u591a\u53cd\u9988","text":"<ul> <li>\u4e00\u662f\u4ea4\u6d41\u4e0d\u8db3\u3002</li> </ul> <p>\u5982\u679c\u521b\u5efaPull Request\u7684\u7406\u7531\u6ca1\u6709\u83b7\u5f97\u8ba4\u540c\uff0c\u90a3\u5c31\u4e0d\u8981\u901a\u8fc7PullRequest\u8fdb\u884c\u8ba8\u8bba\uff0c\u800c\u662f\u5e94\u8be5\u9009\u62e9\u5176\u4ed6\u624b\u6bb5\u8fdb\u884c\u4ea4\u6d41\u3002</p> <p>\u6700\u597d\u7684\u89e3\u51b3\u9014\u5f84\u662f\u76f4\u63a5\u9762\u8c08\u3002</p> <ul> <li>\u53e6\u4e00\u4e2a\u539f\u56e0\u662f\u6280\u672f\u6216\u80fd\u529b\u4e0d\u8db3\u3002</li> </ul> <p>\u5982\u679c\u4ee3\u7801\u7ecf\u5e38\u88ab\u6307\u51fa\u95ee\u9898\uff0c\u90a3\u4e48\u4e0d\u662f\u7f16\u7a0b\u80fd\u529b\u65b9\u9762\u6709\u95ee\u9898\uff0c\u5c31\u662f\u56e2\u961f\u7f16\u5199\u4ee3\u7801\u65f6\u6ca1\u6709\u4e00\u4e2a\u660e\u786e\u7684\u89c4\u5219\u3002 \u4e3a\u907f\u514d\u5728\u65e0\u7528\u7684\u8ba8\u8bba\u4e0a\u6d6a\u8d39\u65f6\u95f4\uff0c\u56e2\u961f\u5e94\u8be5\u5236\u5b9a\u4e00\u4e2a\u6700\u4f4e\u9650\u5ea6\u7684\u7f16\u7a0b\u89c4\u5219\uff0c\u5e76\u4e14\u544a\u77e5\u6bcf\u4e00\u540d\u56e2\u961f\u6210\u5458\u3002 \u5982\u679c\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u8fd8\u9700\u8981\u5176\u4ed6\u89c4\u5219\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u89c4\u5219\u6574\u5408\u5230Wiki\u4e2d\uff0c\u4fbf\u4e8e\u9605\u89c8\u53ca\u4fee\u6539\u3002</p> <p>GitHub Flow\u662f\u4ee5\u90e8\u7f72\u4e3a\u4e2d\u5fc3\u7684\u5f00\u53d1\u6d41\u7a0b\uff0c\u6240\u4ee5\u8981\u6c42\u56e2\u961f\u4e2d\u6bcf\u4e00\u540d\u5f00\u53d1\u8005\u90fd\u80fd\u7f16\u5199\u51fa\u9ad8\u54c1\u8d28\u7684\u4ee3\u7801\uff0c\u4ee5\u4fbf\u987a\u5229\u901a\u8fc7\u5ba1\u67e5\uff0c\u8fc5\u901f\u5b8c\u6210\u4ece\u5408\u5e76\u5230\u90e8\u7f72\u7684\u8fc7\u7a0b\u3002</p> <p>\u56e0\u6b64\u9700\u8981\u953b\u70bc\u5f00\u53d1\u8005\uff0c\u4fdd\u8bc1\u6bcf\u4e00\u540d\u56e2\u961f\u6210\u5458\u90fd\u80fd\u8fbe\u5230\u8fd9\u4e00\u6c34\u5e73\u3002</p> <ul> <li> <p>\u7ed3\u5bf9\u7f16\u7a0b</p> </li> <li> <p>\u7ec4\u7ec7\u5b66\u4e60\u5c0f\u7ec4\u5171\u4eab\u77e5\u8bc6</p> </li> <li> <p>\u5171\u4eab\u53ef\u4f9b\u53c2\u8003\u7684\u8d44\u6599</p> </li> </ul>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#\u4e0d\u8981\u79ef\u6512pull-request","title":"\u4e0d\u8981\u79ef\u6512Pull Request","text":"<p>\u5efa\u8bae\u56e2\u961f\u5236\u5b9a\u4e00\u4e2a\u65b0\u7684\u89c4\u5219\uff1a\u60f3\u521b\u5efaPull Request\u7684\u4eba\u8981\u5148\u53bb\u5bf9\u5176\u4ed6\u4eba\u7684Pull Request\u8fdb\u884c\u5ba1\u67e5\u53ca\u53cd\u9988\uff0c\u5e76\u5728\u53ef\u4ee5\u90e8\u7f72\u65f6\u53ca\u65f6\u90e8\u7f72\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u81ea\u5df1\u60f3\u521b\u5efaPull Request\u65f6\u5fc5\u987b\u5148\u5904\u7406\u5176\u4ed6\u4eba\u7684Pull Request\uff0c\u5c31\u53ef\u4ee5\u6709\u6548\u907f\u514dPull Request\u5806\u79ef\u7684\u60c5\u51b5\u53d1\u751f\u3002</p>"},{"location":"Linux/Git/8.%E5%AE%9E%E8%B7%B5GitHub-Flow/#github-flow\u7684\u5c0f\u7ed3","title":"GitHub Flow\u7684\u5c0f\u7ed3","text":"<ul> <li> <p>\u5f00\u53d1\u6d41\u7a0b\u4ee5\u90e8\u7f72\u4e3a\u4e2d\u5fc3</p> </li> <li> <p>\u9ad8\u901f\u6e90\u4e8e\u7b80\u5355</p> </li> </ul>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/","title":"9.\u5b9e\u8df5Git Flow","text":"<p>Ubuntu\u5b89\u88c5git-flow</p> <pre><code> sudo apt-get install git-flow\n</code></pre> <p>git-flow\u6559\u7a0b</p> <p>\u63a8\u8350\u4f7f\u7528</p> <p>Sourcetree</p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#1\u521b\u5efa\u5206\u652f\u524d\u671f\u5de5\u4f5c","title":"1.\u521b\u5efa\u5206\u652f(\u524d\u671f\u5de5\u4f5c)","text":""},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#11-\u8fdb\u884c-git-flow-\u7684\u521d\u59cb\u8bbe\u7f6e","title":"1.1 \u8fdb\u884c git flow \u7684\u521d\u59cb\u8bbe\u7f6e","text":"<pre><code>$ git config --global user.name \"\u5efa\u529b\"\n$ git config --global user.email \"1879324764@qq.com\"\n$ git flow init -d\nInitialized empty Git repository in /tmp/mailserver-docker/.git/\nUsing default branch names.\nNo branches exist yet. Base branches must be created now.\nBranch name for production releases: [master]\nBranch name for \"next release\" development: [develop]\nHow to name your supporting branch prefixes?\nFeature branches? [feature/]\nBugfix branches? [bugfix/]\nRelease branches? [release/]\nHotfix branches? [hotfix/]\nSupport branches? [support/]\nVersion tag prefix? []\nHooks and filters directory? [/tmp/mailserver-docker/.git/hooks]\n# \u67e5\u770b\u5df2\u521b\u5efa\u7684\u5206\u652f\u3002\n$ git branch -a\n* develop\n  master\n</code></pre>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#12-\u5728\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u4e5f\u521b\u5efadevelop\u5206\u652f","title":"1.2 \u5728\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u4e5f\u521b\u5efadevelop\u5206\u652f","text":"<p>\u76ee\u524d\u6211\u4eec\u5728\u672c\u5730\u73af\u5883\u4e2d\u62e5\u6709<code>master</code> \u548c <code>develop</code> \u4e24\u4e2a\u5206\u652f\uff0c\u4f46\u662f GitHub \u7aef\u7684\u8fdc\u7a0b\u4ed3\u5e93 \u4e2d\u4ecd\u7136\u53ea\u6709 master \u5206\u652f\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u8fdb\u884c push \u64cd\u4f5c\uff0c\u5728 GitHub \u7aef\u7684\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u4e5f\u521b\u5efa\u4e00\u4e2a develop \u5206\u652f\u3002</p> <pre><code>$ git add .\n$ git commit -m \"first commit\"\n$ git remote add origin https://gitee.com/k8s-devops/mailserver-docker.git\n$ git push -u origin develop\n</code></pre> <p>\u73b0\u5728 GitHub \u7aef\u7684\u4ed3\u5e93\u4e2d\u4e5f\u6709\u4e86<code>develop</code>\u5206\u652f\u3002</p> <p>\u4eca\u540e\u56e2\u961f\u4f1a\u4ee5 GitHub \u7aef\u7684 <code>develop</code>\u5206\u652f\u4f5c\u4e3a\u5f00\u53d1\u4e2d\u7684\u6700\u65b0\u4ee3\u7801\uff0c\u5305\u62ec\u6211\u4eec\u5728\u5185\u7684\u6240\u6709\u56e2\u961f\u6210\u5458\u90fd\u8981\u4ee5\u8fd9\u4e2a\u5206\u652f\u4e3a\u57fa\u7840\u8fdb\u884c\u5f00\u53d1\u3002</p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#2\u5b9e\u8df5-git-flow","title":"2.\u5b9e\u8df5 Git Flow","text":"<p>git flow \u4ecb\u7ecd</p> \u5206\u652f\u540d \u4f5c\u7528 master \u4e3b\u5206\u652f,\u7528\u4e8euat\u53d1\u5e03\u6216\u6700\u7ec8\u53d1\u5e03\uff0c\u7edd\u4e0d\u53ef\u76f4\u63a5push develop \u4e3b\u5f00\u53d1\u5206\u652f,\u57fa\u4e8emaster\u5206\u652f\u514b\u9686\uff0c\u53ea\u80fd\u4ece\u5176\u5b83\u5206\u652f\u5408\u5e76 feature \u529f\u80fd\u5f00\u53d1\u5206\u652f\uff0c\u57fa\u4e8edevelop\u5206\u652f\u514b\u9686\uff0c\u7528\u4e8e\u65b0\u529f\u80fd\u65b0\u9700\u6c42\u7684\u5f00\u53d1 release \u6d4b\u8bd5\uff08sit\u73af\u5883\uff09\u5206\u652f\uff0c\u63d0\u4ea4\u7ed9\u6d4b\u8bd5\u4eba\u5458\u8fdb\u884c\u529f\u80fd\u6d4b\u8bd5\u53ca\u5728\u672c\u5206\u652f\u8fdb\u884cBUG\u4fee\u590d hotfix \u8865\u4e01\u5206\u652f\uff0c\u57fa\u4e8emaster\u5206\u652f\u514b\u9686\uff0c\u7528\u4e8euat\u6216\u6b63\u5f0f\u73af\u5883\u7684\u7248\u672c\u8fdb\u884cBUG\u4fee\u590d <p></p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#21-\u5728-feature-\u4e2d\u8fdb\u884c\u7684\u5de5\u4f5c","title":"2.1 \u5728 feature \u4e2d\u8fdb\u884c\u7684\u5de5\u4f5c","text":"<p>feature\u5206\u652f\u4ee5develop\u5206\u652f\u4e3a\u8d77\u70b9\uff0c\u662f\u5f00\u53d1\u8005\u76f4\u63a5\u66f4\u6539\u4ee3\u7801\u53d1\u9001\u63d0\u4ea4\u7684\u5206\u652f\u3002</p> <p>\u5f00\u53d1\u4ee5\u4e0b\u8ff0\u6d41\u7a0b\u8fdb\u884c\u3002</p> <ol> <li>\u4ecedevelop\u5206\u652f\u521b\u5efafeature\u5206\u652f</li> <li>\u5728feature\u5206\u652f\u4e2d\u5b9e\u73b0\u76ee\u6807\u529f\u80fd</li> <li>\u901a\u8fc7GitHub\u5411develop\u5206\u652f\u53d1\u9001Pull Request</li> <li>\u63a5\u53d7\u5176\u4ed6\u5f00\u53d1\u8005\u5ba1\u67e5\u540e\uff0c\u5c06Pull Request\u5408\u5e76\u81f3develop\u5206\u652f</li> </ol> <p>\u4e0edevelop\u5206\u652f\u5408\u5e76\u540e\uff0c\u5df2\u7ecf\u5b8c\u6210\u5de5\u4f5c\u7684feature\u5206\u652f\u5c31\u5931\u53bb\u4e86\u4f5c\u7528\uff0c\u53ef\u4ee5\u5728\u9002\u5f53\u7684\u65f6\u5019\u5220\u9664\u3002</p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#211-\u521b\u5efa\u5206\u652f","title":"2.1.1 \u521b\u5efa\u5206\u652f","text":"<p>\u9996\u5148\u8981\u5c06develop\u5206\u652f\u66f4\u65b0\u81f3\u6700\u65b0\u72b6\u6001\u3002\u6211\u4eec\u4ece GitHub \u7684\u8fdc\u7a0b\u4ed3\u5e93\u8fdb\u884c pull \u64cd\u4f5c\u3002\u8fd9\u4e00\u64cd\u4f5c\u8981\u5728 develop \u5206\u652f\u4e0b\u8fdb\u884c\u3002</p> <pre><code>$ git pull\n</code></pre> <p>\u521b\u5efafeature\u5206\u652fadd-user\uff0c\u7528\u6765\u5b9e\u73b0\u6dfb\u52a0\u7528\u6237\u7684\u529f\u80fd\u3002</p> <pre><code>$ git flow feature start add-user\n</code></pre> <p>\u6211\u4eec\u5df2\u7ecf\u521b\u5efa\u5e76\u5207\u6362\u5230\u4e86feature/add-user\u5206\u652f\u3002\u4fdd\u9669\u8d77\u89c1\uff0c\u8ba9\u6211\u4eec\u6765\u786e\u8ba4\u4e00\u4e0b\u3002</p> <pre><code>$ git branch -a\n  develop\n* feature/add-user\n  master\n  remotes/origin/develop\n</code></pre>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#212-\u5728\u5206\u652f\u4e2d\u8fdb\u884c\u4f5c\u4e1a","title":"2.1.2 \u5728\u5206\u652f\u4e2d\u8fdb\u884c\u4f5c\u4e1a","text":"<p>\u63a5\u4e0b\u6765\u5728\u521a\u521a\u521b\u5efa\u7684feature/add-user\u5206\u652f\u4e2d\u5b9e\u73b0\u76ee\u6807\u529f\u80fd\u5e76\u8fdb\u884c\u63d0\u4ea4\u3002</p> <pre><code># \u5199\u4ee3\u7801 \uff0c\u4fee\u590dbug\n$ git commit -am \"git flow add user...\"\n$ git diff\n</code></pre>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#213-\u53d1\u9001pull-request","title":"2.1.3 \u53d1\u9001Pull Request","text":"<p>\u9996\u5148\u6211\u4eec\u5c06 <code>feature/add-user</code> \u5206\u652f push \u5230 GitHub \u7aef\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528Gitee\u505a\u793a\u8303\uff0c\u56e0\u4e3aGithub\u8bbf\u95ee\u9700\u8981\u79d1\u5b66\u4e0a\u7f51\u3002</p> <pre><code>$ git push origin feature/add-user\n....\nremote: Create a pull request for 'feature/add-user' on Gitee by visiting:\nremote:     https://gitee.com/k8s-devops/mailserver-docker/pull/new/k8s-devops:feature/add-user...k8s-devops:develop\nTo https://gitee.com/k8s-devops/mailserver-docker.git\n * [new branch]      feature/add-user -&gt; feature/add-user\n</code></pre> <p>\u63a8\u9001<code>feature/add-user</code>\u5206\u652f\u5230\u4ed3\u5e93\u4e4b\u540e\uff0c\u70b9\u51fb\u4ed3\u5e93\u7684Pull Request\u3002</p> <p>\u7136\u540e\u65b0\u5efa<code>Pull Request</code>,\u5982\u4e0b\u6240\u793a</p> <p></p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#214-\u901a\u8fc7\u4ee3\u7801\u5ba1\u67e5\u63d0\u9ad8\u4ee3\u7801\u8d28\u91cf","title":"2.1.4 \u901a\u8fc7\u4ee3\u7801\u5ba1\u67e5\u63d0\u9ad8\u4ee3\u7801\u8d28\u91cf","text":"<p>\u53d1\u9001 Pull Request \u4e4b\u540e\uff0c\u901a\u8fc7\u4e0b\u5217\u6b65\u9aa4\u5229\u7528 Pull Request \u4ece\u5176\u4ed6\u5f00\u53d1\u8005\u90a3\u91cc\u83b7\u53d6\u53cd\u9988\uff0c\u4e0d\u65ad\u7cbe\u70bc\u4ee3\u7801\u3002</p> <ol> <li>\u7531\u5176\u4ed6\u5f00\u53d1\u8005\u8fdb\u884c\u4ee3\u7801\u5ba1\u67e5\uff0c\u5728 Pull Request \u4e2d\u63d0\u4f9b\u53cd\u9988</li> <li>\u4fee\u6b63\u4ee3\u7801\u4ee5\u53cd\u6620\u53cd\u9988\u5185\u5bb9\uff08\u5728\u672c\u5730 feature/add-user \u5206\u652f\u4e2d\uff09</li> <li>\u5c06<code>feature/add-user</code>\u5206\u652f push \u5230\u8fdc\u7a0b\u4ed3\u5e93\uff08\u81ea\u52a8\u6dfb\u52a0\u81f3\u4e4b\u524d\u7684 Pull Request\uff09</li> <li>\u91cd\u590d\u524d\u4e09\u6b65</li> <li>\u786e\u8ba4 Pull Request \u6ca1\u6709\u95ee\u9898\u540e\uff0c\u7531\u5176\u4ed6\u5f00\u53d1\u8005\u5c06\u5176\u5408\u5e76\u81f3 develop \u5206\u652f</li> </ol>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#215-\u66f4\u65b0\u672c\u5730\u7684develop\u5206\u652f","title":"2.1.5 \u66f4\u65b0\u672c\u5730\u7684develop\u5206\u652f","text":"<p>\u6211\u4eec\u53d1\u9001\u7684 Pull Request \u5728 GitHub \u7aef\u4e0e develop \u5408\u5e76\u540e\uff0c\u4e3a\u8ba9\u5176\u53cd\u6620\u5230\u672c\u5730\u7684 develop \u5206\u652f\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\u3002</p> <ul> <li>\u5207\u6362\u81f3 develop \u5206\u652f</li> <li>\u6267\u884c<code>git pull</code> \u6216\u8005 <code>git fetch &amp;&amp; git merge</code></li> </ul> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u672c\u5730 develop \u5206\u652f\u5c31\u4ece GitHub \u7aef\u4ed3\u5e93\u83b7\u53d6\u4e86\u6700\u65b0\u72b6\u6001\u3002 <pre><code>$ git checkout develop\n$ git pull\n</code></pre></p> <p>\u6bcf\u5f53\u9700\u8981\u4ece develop \u5206\u652f\u521b\u5efa feature \u7b49\u5206\u652f\u65f6\uff0c\u8bb0\u5f97\u4e00\u5b9a\u8981\u5148\u6267\u884c\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u4fdd\u8bc1 develop \u5206\u652f\u5904\u4e8e\u6700\u65b0\u72b6\u6001\u3002</p> <p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u4f1a\u4e0d\u65ad\u91cd\u590d\u4e4b\u524d\u8fd9\u4e00\u7cfb\u5217\u6d41\u7a0b\uff0c\u4e0d\u65ad\u4e3a develop \u5206\u652f\u6dfb\u52a0\u529f\u80fd\u3002</p> <p>\u5f53\u529f\u80fd\u79ef\u6512\u5230\u8db3\u4ee5\u53d1\u5e03\u65f6\uff0c\u5c31\u4f1a\u7528\u5230 release \u5206\u652f\u3002</p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#22-\u5728-release-\u5206\u652f\u4e2d\u8fdb\u884c\u7684\u5de5\u4f5c","title":"2.2 \u5728 release \u5206\u652f\u4e2d\u8fdb\u884c\u7684\u5de5\u4f5c","text":""},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#221-\u521b\u5efa\u5206\u652f","title":"2.2.1 \u521b\u5efa\u5206\u652f","text":"<p>\u6211\u4eec\u4ece\u6700\u65b0\u7684 develop \u5206\u652f\u7740\u624b\uff0c\u5f00\u59cb 1.0.0 \u7248\u672c\u7684 release \u5de5\u4f5c\u3002</p> <pre><code># \u5207\u6362\u81f3develop\u5206\u652f\n$ git checkout develop\nSwitched to branch 'develop'\n# \u83b7\u53d6\u6700\u65b0develop\u5206\u652f\u7684\u4ee3\u7801\n$ git pull\nAlready up-to-date.\n\n# \u5f00\u59cbrelease\u5206\u652f\n$ git flow release start '1.0.0'\nSwitched to a new branch 'release/1.0.0'\nSummary of actions:\n- A new branch 'release/1.0.0' was created, based on 'develop'\n- You are now on branch 'release/1.0.0'\nFollow-up actions:\n- Bump the version number now!\n- Start committing last-minute fixes in preparing your release\n- When done, run:\n\ngit flow release finish '1.0.0'\n</code></pre> <pre><code>$ git branch -a\n  develop\n  feature/add-user\n  master\n* release/1.0.0\n</code></pre> <p>release/1.0.0 \u5206\u652f\u5df2\u7ecf\u6210\u529f\u521b\u5efa\uff0c\u5b83\u5c31\u662f\u8fd9\u6b21\u7684 release \u5206\u652f</p> <p></p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#222-\u5206\u652f\u5185\u7684\u5de5\u4f5c","title":"2.2.2 \u5206\u652f\u5185\u7684\u5de5\u4f5c","text":"<p>\u5728\u8fd9\u4e2a\u5206\u652f\u4e2d\uff0c\u6211\u4eec\u53ea\u5904\u7406\u4e0e\u53d1\u5e03\u524d\u51c6\u5907\u76f8\u5173\u7684\u63d0\u4ea4\u3002</p> <p>\u6bd4\u5982\u7248\u672c\u7f16\u53f7\u53d8\u66f4\u7b49\u5143\u6570\u636e\u7684\u6dfb\u52a0\u5de5\u4f5c\u3002</p> <p>\u5982\u679c\u8f6f\u4ef6\u90e8\u7f72\u5230\u9884\u6f14\u73af\u5883\u540e\u7ecf\u6d4b\u8bd5\u53d1\u73b0 BUG\uff0c\u76f8\u5173\u7684\u4fee\u6b63\u4e5f\u8981\u63d0\u4ea4\u7ed9\u8fd9\u4e2a\u5206\u652f\u3002 \u4f46\u8981\u8bb0\u4f4f\uff0c\u8be5\u5206\u652f\u4e2d\u7edd\u5bf9\u4e0d\u53ef\u4ee5\u5305\u542b\u9700\u6c42\u53d8\u66f4\u6216\u529f\u80fd\u53d8\u66f4\u7b49\u91cd\u5927\u4fee\u6b63\u3002</p> <p>\u8fd9\u4e00\u9636\u6bb5\u7684\u63d0\u4ea4\u6570\u5e94\u8be5\u9650\u5236\u5230\u6700\u4f4e.</p> <p>\u53c8\u5f00\u59cb\u7801\u4ee3\u7801</p> <pre><code># coding.......\n</code></pre>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#223-\u8fdb\u884c\u53d1\u5e03\u4e0e\u5408\u5e76","title":"2.2.3 \u8fdb\u884c\u53d1\u5e03\u4e0e\u5408\u5e76","text":"<p><pre><code>$ git commit -am \"release pull ...1.0.0\"\n[release/1.0.0 7a5b709] release pull ...1.0.0\n 1 file changed, 9 insertions(+)\n$ git push origin release/1.0.0\n\n# \u53d1\u5e03\u524d\u7684\u4fee\u6b63\u5168\u90e8\u5904\u7406\u5b8c\u540e\uff0c\u6211\u4eec\u7ed3\u675f\u8fd9\u4e00\u5206\u652f\u3002\n$ git flow release finish '1.0.0'\n</code></pre> \u671f\u95f4\u4f1a\u9700\u8981\u586b\u5199 \u63d0\u4ea4\u4fe1\u606f\u3001\u8fd9\u4e2a\u7248\u672c\u7684\u63d0\u4ea4\u4fe1\u606f\u3001\u5408\u5e76\u7684\u63d0\u4ea4\u4fe1\u606f\u3002\u65e0\u7279\u6b8a\u60c5\u51b5\uff0c\u4e00\u822c\u9ed8\u8ba4\u3002\u5168\u90e8\u7ed3\u675f\u540e\uff0c\u4f1a\u663e\u793a\u5982\u4e0b</p> <pre><code>$ git flow release finish '1.0.0'\nSwitched to branch 'master'\nYour branch is up-to-date with 'origin/master'.\nMerge made by the 'recursive' strategy.\n README.md | 2 ++\n 1 file changed, 2 insertions(+)\nSwitched to branch 'develop'\nYour branch is up-to-date with 'origin/develop'.\nAlready up-to-date!\nMerge made by the 'recursive' strategy.\nDeleted branch release/1.0.0 (was d3f54a0).\n\nSummary of actions:\n- Release branch 'release/1.0.0' has been merged into 'master'\n- The release was tagged '1.0.0'\n- Release tag '1.0.0' has been back-merged into 'develop'\n- Release branch 'release/1.0.0' has been locally deleted\n- You are now on branch 'develop'\n</code></pre> <p>\u5f53\u524d\u72b6\u6001\u5982\u4e0b\uff1a</p> <p></p> <p>release finish \u4e4b\u540e</p> <p>release \u5206\u652f\u5c06\u5408\u5e76\u81f3 master \u5206\u652f\u3002\u5206\u652f\u5728\u5408\u5e76\u65f6\u4f1a\u8be2\u95ee\u63d0\u4ea4\u4fe1\u606f\uff0c\u5982\u679c\u6ca1\u6709\u9700\u8981\u7279\u522b\u58f0\u660e\u7684\u4e8b\u9879\uff0c\u53ef\u4ee5\u76f4\u63a5\u4fdd\u6301\u9ed8\u8ba4\u72b6\u6001\u3002</p> <pre><code>Merge branch 'release/1.0.0'\n</code></pre>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#224-\u67e5\u770b\u7248\u672c\u6807\u7b7e","title":"2.2.4 \u67e5\u770b\u7248\u672c\u6807\u7b7e","text":"<p>\u901a\u8fc7\u524d\u9762\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u6211\u4eec\u521b\u5efa\u4e86\u4e0e\u53d1\u5e03\u7248\u672c\u53f7\u76f8\u540c\u7684 Git \u6807\u7b7e\u3002</p> <pre><code>$ git tag\n1.0.0\n</code></pre> <p>\u4eca\u540e\u5982\u679c\u9047\u5230\u4ec0\u4e48\u95ee\u9898\uff0c\u53ea\u8981\u6307\u5b9a\u8fd9\u4e2a\u6807\u7b7e\uff0c\u5c31\u53ef\u4ee5\u5c06\u8f6f\u4ef6\u56de\u6eaf\u5230\u76f8\u5e94\u7248\u672c\u3002</p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#225-\u66f4\u65b0\u5230\u8fdc\u7a0b\u4ed3\u5e93","title":"2.2.5 \u66f4\u65b0\u5230\u8fdc\u7a0b\u4ed3\u5e93","text":"<p>\u81f3\u6b64\u6211\u4eec\u5bf9\u591a\u4e2a\u5206\u652f\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u6240\u4ee5\u9700\u8981\u5229\u7528 push \u64cd\u4f5c\u5c06\u4fee\u6539\u66f4\u65b0\u5230 GitHub \u7aef\u7684\u8fdc\u7a0b\u4ed3\u5e93\u3002\u6211\u4eec\u5148\u4ece develop \u5206\u652f\u5f00\u59cb\u3002</p> <pre><code>$ git branch -a\n* develop\n  feature/add-user\n  master\n  remotes/origin/develop\n  remotes/origin/feature/add-user\n\n$ git push origin develop\n</code></pre> <p>\u7136\u540e\u662f master \u5206\u652f\u3002</p> <pre><code>$ git checkout master\nSwitched to branch 'master'\nYour branch is ahead of 'origin/master' by 5 commits.\n  (use \"git push\" to publish your local commits)\n$ git push origin master\n</code></pre> <p>\u518d push \u6807\u7b7e\u4fe1\u606f\u3002 <pre><code>$ git push --tags\n</code></pre></p> <p>\u7248\u672c\u53f7 1.0.0 \u7684\u6807\u7b7e\u4fe1\u606f\u5df2\u7ecf push \u5b8c\u6bd5\uff0c\u73b0\u5728\u53ea\u8981\u53d1\u5e03 master \u5206\u652f\uff0c\u6574\u4e2a\u53d1\u5e03\u5de5\u4f5c\u5c31\u7ed3\u675f\u4e86\u3002</p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#23-\u5728-hotfix-\u5206\u652f\u4e2d\u8fdb\u884c\u7684\u5de5\u4f5c","title":"2.3 \u5728 hotfix \u5206\u652f\u4e2d\u8fdb\u884c\u7684\u5de5\u4f5c","text":"<p>\u4e0b\u8ff0\u60c5\u51b5\u9700\u8981\u521b\u5efa hotfix \u5206\u652f</p> <ul> <li>release \u7248\u672c\u4e2d\u53d1\u73b0\u4e86bug \u6216\u8005\u6f0f\u6d1e</li> <li>develop \u5206\u652f\u6b63\u5728\u5f00\u53d1\u65b0\u529f\u80fd\uff0c\u65e0\u6cd5\u9762\u5411\u7528\u6237\u8fdb\u884c\u53d1\u5e03</li> <li>\u6f0f\u6d1e\u9700\u8981\u53ca\u65e9\u5904\u7406\uff0c\u65e0\u6cd5\u7b49\u5230\u4e0b\u4e00\u6b21\u7248\u672c\u53d1\u5e03</li> </ul> <p>\u5047\u8bbe\u4fee\u590dBUG \u540e\u7684\u7248\u672c\u81f3 1.0.1</p> <pre><code>$ git fetch origin\n\n# \u73b0\u5728\u4ee51.0.0\u7684\u6807\u7b7e\u4fe1\u606f\u4e3a\u8d77\u70b9\uff0c\u521b\u5efa\u540d\u4e3a1.0.1 \u7684hotfix\u5206\u652f\u3002\n$ git flow hotfix start '1.0.1' '1.0.0'\n# \u4fee\u590d\u5de5\u4f5c\u7ed3\u675f\u540e\uff0c\u5c06hotfix \u5206\u652fpush \u5230github\u7aef\u7684\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u5e76\u5411master\u5206\u652f\u53d1\u8d77Pull Request\n$ git push origin hotfix/1.0.1\n</code></pre> <p>\u521b\u5efa\u6807\u7b7e\u548c\u8fdb\u884c\u53d1\u5e03</p> <p>\u5728Github\u9879\u76ee\u4e3b\u9875\uff0c\u70b9\u51fbrelease \uff0c\u4e3a\u672c\u6b21hotfix \u521b\u5efa<code>1.0.1</code>\u6807\u7b7e\u3002</p> <p>\u70b9\u51fb Draft a new release \u6309\u94ae\uff0c\u8f93\u5165\u76f8\u5173\u6807\u7b7e\u4fe1\u606f\uff0c\u5728Target\u4e2d\u6307\u5b9amaster\u5206\u652f\uff08master\u5206\u652f\u5df2\u7ecf\u5408\u5e76\u4e86hotfix1.0.1\u7684\u4fee\u6539\uff09\u3002\u7136\u540e\u586b\u5199\u76f8\u5173\u4fe1\u606f\uff0c\u70b9\u51fbPublish release \u8fdb\u884c\u53d1\u5e03</p> <p>1.0.1\u53d1\u5e03\u540e\uff0c\u4e4b\u524d\u53d1\u5e03\u7684\u6210\u54c1\u4e5f\u5c31\u5b8c\u6210\u4e86\u751f\u547d\u5468\u671f</p> <pre><code>$ git fetch origin\n</code></pre> <p>\u4ece hotfix \u5206\u652f\u5408\u5e76\u5230develop \u5206\u652f</p> <p>\u767b\u5f55\u5230Github\uff0c\u4ecehotfix1.0.1\u5206\u652f\u5411develop\u5206\u652f\u53d1\u9001Pull Request\u5373\u53ef\u3002\u5ba1\u67e5\u540e\u4fbf\u4f1a\u88ab\u5408\u5e76\u5230develop\u5206\u652f</p>"},{"location":"Linux/Git/9.%E5%AE%9E%E8%B7%B5Git-Flow/#3git-flow-\u7684\u5c0f\u7ed3","title":"3.Git Flow \u7684\u5c0f\u7ed3","text":"<p>\u5efa\u8bae\u628a\u5f00\u53d1\u6d41\u7a0b\u56fe\u653e\u5927\u8d34\u5728\u5899\u4e0a\uff0c\u8fd9\u6837\u80fd\u591f\u6709\u6548\u5e2e\u52a9\u56e2\u961f\u6210\u5458\u7406\u89e3\u6d41\u7a0b\u5185\u5bb9</p> <p>\u7248\u672c\u53f7\u7684\u5206\u914d\u89c4\u5219 <code>x.y.z</code></p> <ul> <li>x: \u5728\u91cd\u5927\u529f\u80fd\u53d8\u66f4\uff0c\u6216\u8005\u7248\u672c\u4e0d\u5411\u4e0b\u517c\u5bb9+1\uff0c\u6b64\u65f6y z\u5f52\u96f6</li> <li>y: \u5728\u6dfb\u52a0\u65b0\u529f\u80fd\u6216\u8005\u5220\u9664\u5df2\u6709\u529f\u80fd+1 \u6b64\u65f6z\u5f52\u96f6</li> <li>z: \u53ea\u5728\u8fdb\u884c\u5185\u90e8\u4fee\u6539\u540e+1.</li> </ul> <p>\u4e0b\u9762\u4e3e\u4e2a\u5177\u4f53\u4f8b\u5b50\u3002</p> <pre><code>\u25cf 1.0.0\uff1a\u6700\u521d\u53d1\u5e03\u7684\u7248\u672c\n\n\u25cf 1.0.1\uff1a\u4fee\u6b63\u4e86\u8f7b\u5faeBUG\n\n\u25cf 1.0.2\uff1a\u4fee\u590d\u6f0f\u6d1e\n\n\u25cf 1.1.0\uff1a\u6dfb\u52a0\u65b0\u529f\u80fd\n\n\u25cf 2.0.0\uff1a\u66f4\u65b0\u6574\u4f53UI\u5e76\u6dfb\u52a0\u65b0\u529f\u80fd\n</code></pre>"},{"location":"Linux/serveices/0.ubuntu-desktop-vmware/","title":"ubuntu-desktop-vmware","text":"<p>ubunutu20.04 \u7248\u672c</p> <p>VMware Workstation 16~17.0 Pro \u4e0b\u8f7d\u5730\u5740<p>VMware Workstation Pro 16 \u5b98\u65b9\u4e0b\u8f7d\u7684\u7f51\u5740\u662f\uff1ahttps://www.vmware.com/cn.html</p> </p> <p>Mware Workstation Pro 16 \u6fc0\u6d3b\u8bb8\u53ef\u8bc1</p> <p>ZF3R0-FHED2-M80TY-8QYGC-NPKYF</p> <pre><code>sudo apt install -y vim build-essential linux-headers-generic libaio-dev x11vnc\nchmod 755 VMware-Workstation-Full-16.2.0-18760230.x86_64.bundle\nsudo ./VMware-Workstation-Full-16.2.0-18760230.x86_64.bundle\nsudo apt install -y x11vnc\nsudo x11vnc -storepasswd /etc/x11vnc.pass\n\nsudo vim /etc/systemd/system/x11vnc.service\n[Unit]\nDescription=Start x11vnc at startup.\nAfter=multi-user.target\n\n[Service]\nType=simple\nExecStart=/usr/bin/x11vnc -auth /run/user/1000/gdm/Xauthority -forever -loop -noxdamage -repeat -rfbauth /etc/x11vnc.pass -rfbport 5900 -shared\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>\u4fee\u6539\u8fdc\u7a0b\u8bbf\u95ee\u81ea\u52a8\u767b\u5f55\u7528\u6237</p> <pre><code>sudo vim /etc/gdm3/custom.conf\n# Enabling automatic login\nAutomaticLoginEnable = true\nAutomaticLogin = gitee\n\nsudo systemctl enable x11vnc\nsudo service x11vnc start\n</code></pre> <p>\u91cd\u542f <pre><code>reboot\n</code></pre></p>"},{"location":"Linux/serveices/0.ubuntu-desktop-vmware/#vmware-workstation-pro-16","title":"VMware Workstation Pro 16","text":"<p>https://download3.vmware.com/software/WKST-1623-LX-New/VMware-Workstation-Full-16.2.3-19376536.x86_64.bundle</p> <p>https://download3.vmware.com/software/wkst/file/VMware-Workstation-Full-16.2.1-18811642.x86_64.bundle</p> <p>https://download3.vmware.com/software/wkst/file/VMware-Workstation-Full-16.2.0-18760230.x86_64.bundle</p> <p>https://download3.vmware.com/software/wkst/file/VMware-Workstation-Full-16.1.2-17966106.x86_64.bundle</p> <p>https://download3.vmware.com/software/wkst/file/VMware-Workstation-Full-16.1.1-17801498.x86_64.bundle</p> <p>https://download3.vmware.com/software/wkst/file/VMware-Workstation-Full-16.1.0-17198959.x86_64.bundle</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/","title":"1.\u7b2c\u4e00\u4e2a Shell \u7a0b\u5e8f","text":""},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#1-shell-\u811a\u672c\u7684\u6784\u6210\u53ca\u89c4\u8303","title":"1. Shell \u811a\u672c\u7684\u6784\u6210\u53ca\u89c4\u8303","text":"<p>Shell \u811a\u672c\u6709\u4e00\u4e9b\u7ea6\u5b9a\u4fd7\u6210\u7684\u89c4\u8303\uff0c\u5927\u5bb6\u90fd\u9075\u5faa\u8fd9\u4e9b\u89c4\u5219\uff0c\u7f16\u5199\u51fa\u6765\u7684\u811a\u672c\u66f4\u80fd\u88ab\u5927\u5bb6\u63a5\u53d7\uff0cShell \u811a\u672c\u5176\u5b9e\u4e0d\u80fd\u79f0\u4e3a\u4e00\u95e8\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83\u66f4\u50cf\u662f\u4e00\u4e2a\u5de5\u5177\uff0c\u7528\u6765\u6742\u7cc5\u4e0d\u540c\u7684\u7a0b\u5e8f\u53ca\u547d\u4ee4\u4f9b\u6211\u4eec\u8c03\u7528\u6765\u5b8c\u6210\u81ea\u5df1\u7684\u9884\u671f\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#11-\u547d\u540d\u89c4\u8303","title":"1.1 \u547d\u540d\u89c4\u8303","text":"<ul> <li>Shell \u811a\u672c\u5728\u547d\u540d\u65b9\u9762\u6ca1\u6709\u4e25\u683c\u7684\u8981\u6c42\uff0c\u4f46\u662f\u6211\u4eec\u547d\u540d\u9700\u8981\u9075\u5faa\u89c1\u660e\u77e5\u610f\uff0c\u5373\u53ef\u901a\u8fc7 Shell \u811a\u672c\u7684\u540d\u79f0\u77e5\u9053\u5176\u529f\u80fd\u3002</li> <li>\u6587\u4ef6\u540d\u7ea6\u5b9a\u4fd7\u6210\u4ee5.sh \u7ed3\u5c3e\uff0c\u65b9\u4fbf\u8bc6\u522b\u5176\u4e3a Shell \u811a\u672c\u6587\u4ef6\uff1b</li> <li>\u6587\u4ef6\u7edf\u4e00\u547d\u540d\u98ce\u683c\uff0c\u5199 Shell \u4e00\u822c\u7528\u5c0f\u5199\u5b57\u6bcd\u52a0\u4e0b\u5212\u7ebf\uff0c\u4f8b\u5982 <code>install_myshell.sh</code>, \u6211\u4eec\u770b\u5230\u8be5\u540d\u79f0\u5c31\u80fd\u77e5\u9053\u5176\u4e3a\u4e00\u4e2a\u5b89\u88c5 mysql \u7684\u811a\u672c\u6587\u4ef6\u3002</li> </ul>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#12-shell-\u811a\u672c\u7ed3\u6784","title":"1.2 Shell \u811a\u672c\u7ed3\u6784","text":"<p>Shell \u811a\u672c\u5728\u5176\u4e2d\u7684\u7b2c\u4e00\u884c\u9700\u8981\u6709\u6307\u660e\u89e3\u91ca\u5668\uff0c\u5728\u4e0a\u9762 CLI Shell \u4e2d\u7684\u90a3\u4e9b\u89e3\u91ca\u5668\uff0c\u90fd\u53ef\u4ee5\u5199\uff0c\u5728\u4ee5<code>./install_mysql.sh</code> \u7684\u65f6\u5019\uff0c\u6b64\u65f6\u5c31\u662f\u5229\u7528\u811a\u672c\u4e2d\u7b2c\u4e00\u884c\u7684\u89e3\u91ca\u5668\u6765\u8fd0\u884c\u811a\u672c\uff0c\u5176\u683c\u5f0f\u4e3a <code>#!Shell\u89e3\u91ca\u5668</code>\uff0c\u4f8b\u5982<code>#!/bin/bash</code>, \u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u4e00\u5b9a\u7684\u5c40\u9650\u6027\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528 env \u73af\u5883\u53d8\u91cf\u4e2d\u7684 bash\uff0c\u63a8\u8350\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f<code>#!/usr/bin/env bash</code>\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#13-\u7f16\u7801\u7edf\u4e00","title":"1.3 \u7f16\u7801\u7edf\u4e00","text":"<p>\u5728\u7f16\u5199 Shell \u7684\u65f6\u5019\u6211\u4eec\u5c3d\u53ef\u80fd\u4f7f\u7528 UTF-8 \u7f16\u7801\uff0c\u53ef\u4ee5\u652f\u6301\u4e2d\u6587\u53ca\u5927\u591a\u6570\u7b26\u53f7\uff0c\u5728\u5176\u4e2d\u6211\u4eec\u6ce8\u91ca\u4f7f\u7528\u82f1\u6587\uff0c\u4f8b\u5982\u5728\u4e0d\u652f\u6301\u4e2d\u6587\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u811a\u672c\u66f4\u597d\u7684\u652f\u6301\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#14-\u4f5c\u8005\u4fe1\u606f","title":"1.4 \u4f5c\u8005\u4fe1\u606f","text":"<p>\u5728\u7f16\u5199 Shell \u811a\u672c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u6307\u5b9a Shell \u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u4ee5\u53ca\u8be5\u811a\u672c\u7684\u4f5c\u8005\uff0c\u7f16\u5199\u8be5\u811a\u672c\u7684\u65e5\u671f\u53ca\u8054\u7cfb\u65b9\u5f0f\uff0c\u4ee5\u53ca\u811a\u672c\u7684\u7248\u672c\uff0c\u65b9\u4fbf\u540e\u671f\u5176\u4ed6\u4eba\u9605\u8bfb\u53ca\u8054\u7cfb\u3002 \u4f8b\u5982\u5728\u5934\u90e8\u6dfb\u52a0\u5982\u4e0b\u6ce8\u91ca\u4fe1\u606f\uff1a</p> <pre><code>#!/bin/env bash\n# Description: /mybin/myvim scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# Date: 2020-02-15 13:36\n# Version: 1.0\n</code></pre>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#2-shell-\u7684\u8fd0\u884c\u65b9\u5f0f","title":"2. Shell \u7684\u8fd0\u884c\u65b9\u5f0f","text":"<p>\u8fd0\u884c\u811a\u672c\u53ef\u4ee5\u5f52\u7eb3\u4e3a\u4e09\u79cd\u65b9\u5f0f\uff0c\u6ce8\u610f\u4e00\u822c\u5728\u8fd0\u884c\u811a\u672c\u7684\u65f6\u5019\u4e3a\u811a\u672c\u6dfb\u52a0 <code>x</code> \u53ef\u6267\u884c\u6743\u9650</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#21-\u663e\u5f0f\u5236\u5b9a\u89e3\u91ca\u5668\u6267\u884c","title":"2.1 \u663e\u5f0f\u5236\u5b9a\u89e3\u91ca\u5668\u6267\u884c","text":"<pre><code>[root@shell workspace]# ll\ntotal 4\n-rw-r--r-- 1 root root 44 Sep  3 14:16 01-scripts.sh\n[root@shell workspace]# cat 01-scripts.sh \n#!/bin/env bash\n# Description: /mybin/myvim scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# Date: 2020-02-15 13:36\n# Version: 1.0\necho \"this is my first script\"\ncd /\n[root@shell workspace]# bash 01-scripts.sh \nthis is my first script\n</code></pre> <p>\u5728\u5f53\u524d bash \u73af\u5883\u4e0b\uff0c\u5f53\u524d\u7ec8\u7aef\u767b\u5f55\u7684 Shell \u4e3a\u7236 Shell\uff0c\u6b64\u79cd\u65b9\u5f0f\u4e3a\u5728\u5f53\u524d Shell \u4e0b\u518d\u542f\u52a8\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u8fd0\u884c Shell \u811a\u672c\u3002</p> <p>Tips: \u6b64\u65b9\u6cd5\u76f4\u63a5\u5728\u7ec8\u7aef\u6307\u5b9a\u89e3\u91ca\u5668\u6765\u6267\u884c\u811a\u672c\uff0c\u6b64\u65f6\u7684\u89e3\u91ca\u5668\u4e3a\u7ec8\u7aef\u6307\u5b9a\u7684\uff0c\u4e0d\u4f7f\u7528\u811a\u672c\u5185\u7b2c\u4e00\u884c\u6307\u5b9a\u7684\u89e3\u91ca\u5668\u6267\u884c\uff0c\u76f4\u63a5\u6307\u5b9a\u89e3\u91ca\u5668\uff0c\u6b64\u65f6\u4e0d\u9700\u8981\u4e3a\u811a\u672c\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#22-\u76f4\u63a5\u6307\u5b9a\u811a\u672c\u6587\u4ef6\u540d\u79f0","title":"2.2 \u76f4\u63a5\u6307\u5b9a\u811a\u672c\u6587\u4ef6\u540d\u79f0","text":"<pre><code>[root@shell workspace]# ll\ntotal 4\n-rw-r--r-- 1 root root 44 Sep  3 14:16 01-scripts.sh\n[root@shell workspace]# . ./01-scripts.sh\n-bash: ./01-scripts.sh: Permission denied\n[root@shell workspace]# chmod +x 01-scripts.sh \n[root@shell workspace]# ll\ntotal 4\n-rwxr-xr-x 1 root root 44 Sep  3 14:16 01-scripts.sh\n[root@shell workspace]# . ./01-scripts.sh \nthis is my first script\n[root@shell workspace]# /workspace/01-scripts.sh \nthis is my first script\n</code></pre> <p>\u5229\u7528\u76f4\u63a5\u5728\u7ec8\u7aef\u6307\u5b9a\u811a\u672c\u6587\u4ef6\u540d\u79f0\u65b9\u5f0f\u6267\u884c\uff0c\u6b64\u79cd\u65b9\u5f0f\u9700\u8981\u4e3a\u811a\u672c\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\uff0c\u5728\u5f53\u524d Shell \u6765\u6267\u884c\uff0c\u4e0d\u542f\u52a8\u5b50 Shell\uff0c\u5229\u7528\u6b64\u79cd\u65b9\u5f0f\u6267\u884c\u811a\u672c\u7684\u89e3\u91ca\u5668\u4e3a\u811a\u672c\u5185\u7684\u7b2c\u4e00\u884c\u6307\u5b9a\u7684\u89e3\u91ca\u5668\uff0c\u4f8b\u5982\u6b64\u4f8b\u4e2d\u4e3a<code>#!/bin/bash</code>\uff0c\u5229\u7528<code>.</code> \u547d\u4ee4\u6765\u6267\u884c\u811a\u672c\uff0c\u4e00\u822c\u7528\u5728\u5f53\u524d\u76ee\u5f55\u6ca1\u6709\u5728 PATH \u4e2d\uff0c\u6240\u4ee5\u7b2c\u4e8c\u4e2a<code>./</code> \u662f\u7528\u6765\u8868\u793a\u5f53\u524d\u76ee\u5f55\u7684\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#23-source-\u6267\u884c","title":"2.3 source \u6267\u884c","text":"<pre><code>[root@xuel-transfer workspace]# bash 01-scripts.sh\nthis is my first script\n[root@xuel-transfer workspace]# ./01-scripts.sh\nthis is my first script\n[root@xuel-transfer workspace]# source 01-scripts.sh\nthis is my first script\n[root@xuel-transfer /]# pwd\n/\n</code></pre> <p>\u5229\u7528\u6b64\u79cd\u65b9\u5f0f\u4e5f\u53ef\u6267\u884c\u811a\u672c\uff0c\u6b64\u65b9\u5f0f\u5728\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u811a\u672c\uff0c\u4e0d\u4f1a\u751f\u6210\u65b0\u7684\u5b50\u8fdb\u7a0b\u3002\u811a\u672c\u6267\u884c\u5b8c\u6bd5\uff0c\u56de\u5230\u5f53\u524d Shell\uff0c\u811a\u672c\u5185\u5982\u679c\u6709 <code>cd \u547d\u4ee4</code>\u811a\u672c\u9000\u51fa\u540e\u4f1a\u5f71\u54cd\u5f53\u524d\u7684\u73af\u5883\u4e0a\u4e0b\u6587\uff0c\u6b64\u79cd\u65b9\u5f0f\u8fd0\u884c Shell\uff0c\u811a\u672c\u4e5f\u53ef\u4ee5\u6ca1\u6709\u53ef\u6267\u884c\u6743\u9650\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#3-\u8c03\u8bd5","title":"3. \u8c03\u8bd5","text":"<p>\u5728\u6211\u4eec\u6267\u884c Shell \u811a\u672c\u7684\u65f6\u5019\u4e3a\u6765\u65b9\u4fbf\u6392\u9664\u5f02\u5e38\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528 <code>-x</code> \u6765\u5f00\u542f\u8c03\u8bd5\uff0c\u4f8b\u5982</p> <pre><code>[root@xuel-transfer workspace]# bash -x 01-scripts.sh\n+ echo 'this is my first script'\nthis is my first script\n+ cd /\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa + \u540e\u9762\u4e3a\u811a\u672c\u7684\u5185\u5bb9\uff0c\u6ca1\u6709 + \u7684\u4e3a\u811a\u672c\u6267\u884c\u7684\u8f93\u51fa</p> <p>\u540c\u65f6\u6211\u4eec\u4e3a\u4e86\u65b9\u4fbf\u67e5\u770b\u811a\u672c\u6253\u5370\u6b63\u5728\u6267\u884c\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u8fd8\u53ef\u4ee5\u5229\u7528 <code>-v</code> \u53c2\u6570\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#4-\u5b9e\u4f8b","title":"4. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#41-\u7b2c\u4e00\u4e2a-shell-\u9700\u6c42","title":"4.1 \u7b2c\u4e00\u4e2a Shell \u9700\u6c42","text":"<p>\u5728\u6b64\u6211\u4eec\u4e5f\u4e0d\u5199 <code>Hello Shell</code> \u4e86\uff0c\u4e3e\u4e00\u4e2a\u975e\u5e38\u5b9e\u7528\u7684\u4f8b\u5b50\uff0c\u91cc\u9762\u8bbe\u8ba1\u4e00\u4e9b\u8bed\u6cd5\u5728\u540e\u671f\u7684\u6587\u7ae0\u4e2d\u5927\u5bb6\u90fd\u80fd\u5b66\u5230\uff0c\u53ef\u4ee5\u5148\u6309\u7167\u64cd\u4f5c\u6b65\u9aa4\u5b9e\u73b0\u3002 \u7ecf\u8fc7\u4e0a\u9762\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u77e5\u9053\u6211\u4eec\u5728\u5199 Shell \u811a\u672c\u7684\u65f6\u5019\u9700\u6700\u597d\u5199\u4e00\u4e9b\u4f5c\u8005\u7684\u4fe1\u606f\uff0c\u5982\u679c\u6bcf\u6b21\u7f16\u5199\u90fd\u624b\u52a8\u6dfb\u52a0\u4e00\u6b21\u5c31\u5f88\u9ebb\u70e6\uff0c\u5982\u679c\u662f IDE \u4e00\u822c\u5de5\u5177\u90fd\u53ef\u4ee5\u81ea\u5b9a\u4e49\u914d\u7f6e\u6dfb\u52a0\u9996\u90e8 banner\uff0c\u4f46\u662f\u5728 Linux \u7cfb\u7edf\u5185\u90e8\u7f16\u5199\u7b80\u5355 Shell \u6216\u6587\u672c\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5c0f\u5de5\u5177\u6765\u5b9e\u73b0\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#42-\u601d\u8def","title":"4.2 \u601d\u8def","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u65b0\u589e\u4e00\u4e2a\u811a\u672c\u5c06\u5176\u6dfb\u52a0\u8fdb PATH \u4e2d\uff0c\u5982\u679c\u5229\u7528\u6b64\u547d\u4ee4\u6253\u5f00\u5df2\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u5229\u7528 vim \u76f4\u63a5\u6253\u5f00\uff0c\u4e0d\u5bf9\u539f\u5185\u5bb9\u4f5c\u51fa\u66f4\u6539\uff0c\u5982\u679c\u4e4b\u524d\u6587\u4ef6\u672a\u5b58\u5728\uff0c\u5c31\u5728\u6587\u4ef6\u9996\u90e8\u81ea\u52a8\u6dfb\u52a0 banner \u5e76\u7528 vim \u6253\u5f00\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#43-\u5b9e\u73b0","title":"4.3 \u5b9e\u73b0","text":"<ul> <li>\u521b\u5efa\u6587\u4ef6   \u9996\u5148\u521b\u5efa\u4e2a\u6587\u4ef6 myvim</li> <li>\u7f16\u5199\u5185\u5bb9</li> </ul> <pre><code>#!/bin/env bash\n# Description: /mybin/myvim scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: auto generate banner\n# Date: 2020-02-15 13:36\n# Version: 1.0\n# file not exist\n[ $# -eq 0 ] &amp;&amp; echo \"$0 [file],At least one parameter!\" &amp;&amp; exit 1\n# add banner\nadd_banner() {\ncat &gt; $1 &lt;&lt; EOF\n#!/bin/env bash\n# Description: $0 scripts\n# Auth: $USER\n# Date: $(date +%F\" \"%H:%M)\n# Version: 1.0\nEOF\n}\n# exist file\nfor file in $*;\ndo\nif [ -f ${file} ];then\nvim ${file} &amp;&amp; exit 0\nelse\ntouch ${file} &amp;&amp; add_banner ${file} &amp;&amp; vim ${file} &amp;&amp; exit 0\nfi\ndone\n</code></pre> <ul> <li>\u6dfb\u52a0\u8fdb PATH \u4e2d</li> </ul> <pre><code>[root@devops-server mybin]# chmod +x myvim     # \u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\n[root@devops-server mybin]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin\n[root@devops-server mybin]# echo \"export PATH=\\$PATH:/mybin\" &gt;&gt; /etc/profile       # \u5c06mybin\u6dfb\u52a0\u8fdbPATH\u4e2d\n[root@devops-server mybin]# source /etc/profile\n[root@devops-server mybin]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin:/mybin\n</code></pre>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#44-\u6548\u679c","title":"4.4 \u6548\u679c","text":"<p>\u5229\u7528 myvim \u6765\u7f16\u8f91\u811a\u672c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210 banner\uff0c\u518d\u6b21\u6253\u5f00\u53ef\u4ee5\u7ee7\u7eed\u7f16\u8f91\uff0c\u8fd9\u6837\u5c31\u514d\u53bb\u6765\u6211\u4eec\u6bcf\u6b21\u624b\u52a8\u7f16\u5199 banner \u7684\u9ebb\u70e6\u3002\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u8fdb\u884c\u5c1d\u8bd5\uff0c\u662f\u4e0d\u662f\u611f\u89c9 Shell \u53ef\u4ee5\u4e3a\u6211\u4eec\u5e26\u6765\u65e0\u7a77\u7684\u4e50\u8da3\u3002</p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#5-\u6ce8\u610f\u4e8b\u9879","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u518d\u6b21\u6ce8\u610f\u7f16\u5199 Shell \u9700\u8981\u9075\u5b88\u5176\u89c4\u8303\uff0c\u8fd9\u4e9b\u7ea6\u5b9a\u4fd7\u6210\u7684\u89c4\u5219\u80fd\u5728\u65e5\u540e\u7684\u751f\u4ea7\u73af\u5883\u4e2d\u4e3a\u6211\u4eec\u907f\u514d\u5f88\u591a\u4e0d\u5fc5\u8981\u7684\u5751\u3002</li> <li>\u5b66\u4e60 Shell \u9700\u8981\u591a\u52a8\u624b\u5b9e\u8df5\uff0c\u5b9e\u8df5\u51fa\u771f\u7406\uff0c\u591a\u5199\u52e4\u7ec3\uff0c\u9488\u5bf9\u7ed3\u679c\u591a\u601d\u8003\uff0c\u719f\u7ec3\u8fd0\u7528 man \u6307\u4ee4\u6765\u67e5\u770b Shell \u811a\u672c\u4e2d\u7528\u7684\u7684\u547d\u4ee4\u7684\u53c2\u6570\u53ca\u9009\u9879\u3002</li> <li>\u4e3e\u4e00\u53cd\u4e09\uff0c\u9488\u5bf9\u4e00\u4e2a\u811a\u672c\u5982\u4f55\u80fd\u65e0\u72b6\u6001\uff0c\u66f4\u5065\u58ee\uff0c\u66f4\u7075\u6d3b\u6613\u7ef4\u62a4\uff0c\u9700\u8981\u591a\u6b21\u7684\u4fee\u6539\uff0c\u53cd\u590d\u7684\u6267\u884c\u9a8c\u8bc1\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\uff0c\u5c06\u6570\u636e\u62bd\u8c61\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012\uff0c\u53ef\u4ee5\u8fbe\u5230\u662f\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\u3002</li> </ul>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#6-\u7ecf\u9a8c\u5206\u4eab","title":"6. \u7ecf\u9a8c\u5206\u4eab","text":"<p>\u4f8b\u5982\u4e0a\u9762\u7684\u6211\u7684\u7b2c\u4e00\u4e2a Shell \u811a\u672c\u4f8b\u5b50\uff0c\u518d\u6b21\u53ea\u662f\u629b\u7816\u5f15\u7389\u4f5c\u7528\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4e3e\u4e00\u53cd\u4e09\u601d\u8003\u66f4\u591a\u7684\u7528\u5904\uff0c\u4f8b\u5982\uff0c\u53ef\u4ee5\u83b7\u53d6\u5929\u6c14\uff0c\u5229\u7528\u81ea\u5236\u5c0f\u5de5\u5177\u6765\u8fdb\u884c Shell \u4e0b\u5feb\u901f\u7ffb\u8bd1\u7b49\u3002</p> <p></p>"},{"location":"Linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#7-\u5c0f\u7ed3","title":"7. \u5c0f\u7ed3","text":"<p>\u76ee\u524d Shell \u7684\u5185\u5bb9\u975e\u5e38\u591a\uff0c\u5176\u4f5c\u4e3a\u7528\u6237\u548c\u7cfb\u7edf\u5185\u6838\u7684\u6865\u6881\uff0c\u5176\u529f\u80fd\u5f3a\u5927\u4e0d\u8a00\u800c\u55bb\uff0c\u6211\u4eec\u9700\u8981\u5c06\u6709\u9650\u7684\u7cbe\u529b\u653e\u5728\u70ed\u70b9\u77e5\u8bc6\u4e0a\uff0c\u597d\u94a2\u7528\u5728\u5200\u5203\u4e0a\uff0c\u6ce8\u610f\u5b66\u4e60\u65b9\u6cd5\u5b66\u4f1a\u4e3e\u4e00\u53cd\u4e09\uff0c\u8fd9\u6837\u5728\u540e\u671f\u7684 Shell \u5b66\u4e60\u4e2d\u80fd\u591f\u66f4\u52a0\u7684\u5feb\u901f\u9ad8\u6548\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/","title":"10.Shell\u8f93\u5165/\u8f93\u51fa\u91cd\u5b9a\u5411","text":""},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#1-shell-\u91cd\u5b9a\u5411","title":"1. Shell \u91cd\u5b9a\u5411","text":""},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#11-shell-\u91cd\u5b9a\u5411\u662f\u4ec0\u4e48","title":"1.1 Shell \u91cd\u5b9a\u5411\u662f\u4ec0\u4e48","text":"<p>\u6211\u4eec\u5728\u4e4b\u524d\u7ae0\u8282\u6709\u5b66\u4e60 echo/printf \u6765\u5c06\u6211\u4eec\u7684\u9700\u6c42\u8f93\u51fa\uff0c\u6b64\u65f6\u5c31\u662f\u6211\u4eec\u5c06\u7cfb\u7edf\u7684\u8fd4\u56de\u8f93\u51fa\u5230\u6211\u4eec\u6807\u51c6\u7ec8\u7aef\uff0c\u4f7f\u5f97\u6211\u4eec\u80fd\u591f\u770b\u5230\u6b63\u5e38\u7684\u8f93\u51fa\u7684\u7ed3\u679c\uff0cUnix \u547d\u4ee4\u9ed8\u8ba4\u7684\u8f93\u5165\u8bbe\u5907\u5373 <code>stdin</code> \u4e3a\u952e\u76d8\uff0c\u6807\u51c6\u548c\u9519\u8bef\u8bbe\u5907\u5373 <code>stdout</code> \u4e3a\u663e\u793a\u5668\uff0c\u6211\u4eec\u5229\u7528\u91cd\u5b9a\u5411\u53ef\u4ee5\u5c06\u8f93\u5165\u6539\u4e3a\u6587\u4ef6\uff0c\u6216\u8005\u5c06\u8f93\u51fa\u91cd\u65b0\u5b9a\u5411\u5230\u5176\u4ed6\u8bbe\u5907\u6216\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u91cd\u5b9a\u5411","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u91cd\u5b9a\u5411","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86\u7cfb\u7edf\u9ed8\u8ba4\u7684\u8f93\u5165\u4e3a\u952e\u76d8\uff0c\u6807\u51c6\u8f93\u51fa\u4e0e\u9519\u8bef\u8f93\u51fa\u4e3a\u663e\u793a\u5668\uff0c\u5f53\u6211\u4eec\u5728\u7f16\u5199 Shell \u7684\u65f6\u5019\u6709\u4e00\u4e9b\u975e\u4ea4\u4e92\u7684\u64cd\u4f5c\uff0c\u4e0d\u80fd\u901a\u8fc7\u952e\u76d8\u8f93\u5165\uff0c\u6216\u663e\u793a\u7684\u7ed3\u679c\u6211\u4eec\u4e0d\u5e0c\u671b\u5728\u663e\u793a\u5668\u663e\u793a\u7684\u65f6\u5019\uff0c\u6b64\u573a\u666f\u5c31\u9700\u8981\u5229\u7528\u8f93\u5165\u8f93\u51fa\u91cd\u5b9a\u5411\u4e86\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#2-shell-\u8f93\u5165\u8f93\u51fa\u91cd\u5b9a\u5411","title":"2. Shell \u8f93\u5165\u8f93\u51fa\u91cd\u5b9a\u5411","text":"<p>Linux Shell \u91cd\u5b9a\u5411\u5206\u4e3a\u4e24\u79cd\uff0c\u987e\u540d\u601d\u4e49\uff0c\u8f93\u5165\u91cd\u5b9a\u5411\u5373\u6539\u53d8\u6807\u51c6\u7684\u9ed8\u8ba4\u7cfb\u7edf\u952e\u76d8\u8f93\u5165\uff0c\u8f93\u51fa\u91cd\u5b9a\u5411\u5373\u6539\u53d8\u9ed8\u8ba4\u7684\u7cfb\u7edf\u663e\u793a\u5668\u8f93\u51fa\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#21-\u6587\u4ef6\u63cf\u8ff0\u7b26","title":"2.1 \u6587\u4ef6\u63cf\u8ff0\u7b26","text":"<p>\u5728 Linux \u4e2d\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u5305\u62ec\u6807\u51c6\u8f93\u5165\u8bbe\u5907\uff08\u952e\u76d8\uff09\u548c\u6807\u51c6\u8f93\u51fa\u8bbe\u5907\uff08\u663e\u793a\u5668\uff09\u5728\u5185\u7684\u6240\u6709\u8ba1\u7b97\u673a\u786c\u4ef6\u90fd\u662f\u6587\u4ef6\u3002\u4e3a\u4e86\u8868\u793a\u548c\u533a\u5206\u5df2\u7ecf\u6253\u5f00\u7684\u6587\u4ef6\uff0cLinux \u4f1a\u7ed9\u6bcf\u4e2a\u6587\u4ef6\u5206\u914d\u4e00\u4e2a ID\uff0c\u8fd9\u4e2a ID \u5c31\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u88ab\u79f0\u4e3a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08File Descriptor\uff09\u3002</p> <p>\u5982\u4e0b\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u7c7b\u578b\u53ca\u5176\u5bf9\u5e94\u7684\u8bbe\u5907\u3002</p> \u6587\u4ef6\u63cf\u8ff0\u7b26 \u6587\u4ef6\u540d \u7c7b\u578b \u786c\u4ef6 0 stdin \u6807\u51c6\u8f93\u5165\u6587\u4ef6 \u952e\u76d8 1 stdout \u6807\u51c6\u8f93\u51fa\u6587\u4ef6 \u663e\u793a\u5668 2 stderr \u6807\u51c6\u9519\u8bef\u8f93\u51fa\u6587\u4ef6 \u663e\u793a\u5668 <p>Linux \u7a0b\u5e8f\u5728\u4f60\u6267\u884c\u4efb\u4f55\u5f62\u5f0f\u7684 I/O \u64cd\u4f5c\u65f6\uff0c\u5176\u5b9e\u90fd\u662f\u5728\u5bf9\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u8fdb\u884c\u8bfb\u53d6\u6216\u5199\u5165\uff0c\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u53ea\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u76f8\u5173\u8054\u7684\u6574\u6570\uff0c\u5728\u5176\u80cc\u540e\u5c31\u662f\u786c\u76d8\u4e0a\u4e00\u4e2a\u666e\u901a\u6587\u4ef6\u6216\u7ba1\u9053\uff0c\u952e\u76d8\uff0c\u663e\u793a\u5668\uff0c\u6216\u662f\u4e00\u4e2a\u7f51\u7edc\u94fe\u63a5\u7b49\u3002</p> <p></p> <p>\u5982\u56fe\u66f4\u4e3a\u5f62\u8c61\u7684\u5c55\u793a\u952e\u76d8\u662f Linux \u7cfb\u7edf\u9ed8\u8ba4\u6807\u51c6\u8f93\u5165\u8bbe\u5907\uff0c\u5f53\u7136\u53ef\u4ee5\u91cd\u5b9a\u5411\u4e3a file\uff0c\u5bf9\u5e94\u7684\u547d\u4ee4\u6267\u884c\u7684\u6807\u51c6\u8f93\u51fa\u4e0e\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u8bbe\u5907\u4e3a\u5c4f\u5e55\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#22-\u8f93\u5165\u91cd\u5b9a\u5411","title":"2.2 \u8f93\u5165\u91cd\u5b9a\u5411","text":"<p>\u8f93\u5165\u65b9\u5411\u4e3a\u6570\u636e\u4ece\u90a3\u6d41\u5165\u7a0b\u5e8f\uff0c\u8f93\u5165\u91cd\u5b9a\u5411\u5373\u6539\u53d8\u9ed8\u8ba4\u7684\u7cfb\u7edf\u952e\u76d8\u8f93\u5165\uff0c\u6539\u53d8\u5176\u4ece\u5176\u4ed6\u5bf9\u65b9\u6d41\u5165\u7a0b\u5e8f\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#221-","title":"2.2.1 &lt;","text":"<p>command &lt;file\uff0c\u5c06 file \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u4f5c\u4e3a command \u7684\u8f93\u5165\u3002</p> <p>\u683c\u5f0f\uff1a</p> <pre><code> [n]&lt; word </code></pre> <p>\u6ce8\u610f [n] \u4e0e &lt; \u4e4b\u95f4\u6ca1\u6709\u7a7a\u683c\uff0c\u5176\u4e2d\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26 n \u91cd\u5b9a\u5411\u5230 word \u6307\u4ee3\u7684\u6587\u4ef6\uff08\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6253\u5f00), \u5982\u679c\u4e0d\u663e\u793a\u6307\u660e n\uff0c\u9ed8\u8ba4\u5c31\u4e3a 0\uff0c\u6807\u51c6\u8f93\u5165\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat testfile.txt\ntest content\n[root@xuel-terraform-cvm-0 ~]# cat 0&lt; testfile.txt\ntest content\n[root@xuel-terraform-cvm-0 ~]# cat &lt; testfile.txt\ntest content\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230 <code>testfile.txt</code> \u6587\u4ef6\u5185\u5bb9\u4e3a <code>test content</code>\uff0c\u5728\u8f93\u5165\u91cd\u5b9a\u5411\u65f6\uff0c\u6211\u4eec\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26 0 \u91cd\u5b9a\u5411\u5230 <code>testfile.txt</code>\uff0c\u6240\u4ee5\u5229\u7528\u547d\u4ee4 cat \u67e5\u770b\uff0c\u7ed3\u679c\u5c31\u4e3a\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u9ed8\u8ba4\u5c31\u662f\u6807\u51c6\u8f93\u5165\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e0d\u5199 0\u3002</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# 0&lt; testfile.txt cat\ntest content\n[root@xuel-terraform-cvm-0 ~]# &lt; testfile.txt cat\ntest content\n</code></pre> <p>\u89e3\u6790\u5668\u89e3\u6790\u5230 \u201c&lt;\u201d \u4ee5\u540e\u4f1a\u5148\u5904\u7406\u91cd\u5b9a\u5411\uff0c\u5c06\u6807\u51c6\u8f93\u5165\u91cd\u5b9a\u5411\u5230 file\uff0c\u4e4b\u540e cat \u518d\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u6807\u51c6\u8f93\u5165\u5df2\u7ecf\u91cd\u5b9a\u5411\u5230\u4e86 file \uff0c\u4e8e\u662f cat \u5c31\u4ece file \u4e2d\u8bfb\u53d6\u6307\u4ee4\u4e86\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#222-eof","title":"2.2.2 &lt;&lt;EOF","text":"<p>command &lt;&lt;END\uff0c\u4ece\u6807\u51c6\u8f93\u5165\uff08\u952e\u76d8\uff09\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u76f4\u5230\u9047\u89c1\u5206\u754c\u7b26 END \u624d\u505c\u6b62\uff0c\u5206\u754c\u7b26\u53ef\u4ee5\u662f\u81ea\u5b9a\u4e49\u7684\u4efb\u610f\u5b57\u7b26\uff0c\u5728\u6b64\u5efa\u8bae\u4f7f\u7528 EOF\u3002</p> <p>\u8be5\u8f93\u5165\u91cd\u5b9a\u5411\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7528\u4e8e\u6279\u91cf\u6587\u4ef6\u7684\u8f93\u5165\uff0c\u53ef\u4ee5\u7528\u6b64\u6765\u521b\u5efa\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat &gt; file1.txt &lt;&lt;EOF\n&gt; hello shell\n&gt; hello go\n&gt; test file\n&gt; EOF\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\nhello shell\nhello go\ntest file\n</code></pre> <p>\u5728\u6b64\u5229\u7528\u4e86\u5c06 cat \u7684\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6 <code>file1.txt</code> \u4e2d\uff0c\u4e4b\u540e\u5229\u7528 &lt;&lt;EOF \u6765\u4ece\u6807\u51c6\u8f93\u5165\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u76f4\u5230\u9047\u5230\u7ed3\u675f\u6807\u793a EOF \u505c\u6b62\u3002</p> <p>\u4f8b\u5982\u6211\u4eec\u5728\u5b66\u4e60\u6d41\u7a0b\u63a7\u5236\u4e2d\u7684 while \u5faa\u73af\u8bfb\u53d6\u6587\u4ef6\u5c31\u5229\u7528\u4e86\u8f93\u5165\u91cd\u5b9a\u5411\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat while.sh\n#!/bin/bash\nFILE=file1.txt\nwhile read str; do\necho $str\ndone &lt;$FILE\n[root@xuel-terraform-cvm-0 ~]# bash while.sh\nhello shell\nhello go\ntest file\n</code></pre> <p>\u5728\u6b64\u5c06\u6587\u4ef6\u7ed1\u5b9a\u5230\u8f93\u5165\u91cd\u5b9a\u5411\u4e0a\uff0c\u5229\u7528 while \u6765\u9010\u884c\u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#23-\u8f93\u51fa\u91cd\u5b9a\u5411","title":"2.3 \u8f93\u51fa\u91cd\u5b9a\u5411","text":"<p>\u8f93\u51fa\u65b9\u5411\u4e3a\u6570\u636e\u8f93\u51fa\u5230\u90a3\u4e2a\u7ec8\u7aef\uff0c\u8f93\u51fa\u91cd\u5b9a\u5411\u5373\u6539\u53d8\u9ed8\u8ba4\u7684\u663e\u793a\u5668\u8f93\u51fa\uff0c\u6539\u53d8\u5176\u4ece\u5176\u4ed6\u8bbe\u5907\u8f93\u51fa\u3002</p> <p>\u4e00\u822c\u8f93\u51fa\u91cd\u5b9a\u5411\u7684\u5e94\u7528\u573a\u666f\u591a\u4e3a\u5c06\u6807\u51c6\u8f93\u51fa\u6216\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u5206\u522b\u4fdd\u6301\u5230\u4e0d\u540c\u7684\u6587\u4ef6\uff0c\u6216\u8005\u662f\u6211\u4eec\u4e0d\u5173\u5fc3\u8f93\u51fa\u7b49\u60c5\u51b5\u7b49\u3002</p> <p>\u5982\u4e0b\u6574\u7406\u7684\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u4e0e\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u91cd\u5b9a\u5411\uff1a</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#231-\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411","title":"2.3.1 \u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411","text":"<ul> <li>\u8986\u76d6\u65b9\u5f0f</li> </ul> <p>\u8bed\u6cd5\uff1a<code>command &gt;file</code></p> <p>\u6807\u51c6\u8f93\u5165\u91cd\u5b9a\u5411\u8986\u76d6\u65b9\u5f0f\uff0c\u76f4\u63a5\u5c06 command \u547d\u4ee4\u7684\u6807\u51c6\u8f93\u51fa\uff0c\u4ee5\u8986\u76d6\u65b9\u5f0f\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat file1.txt\nhello shell\nhello go\ntest file\n[root@xuel-terraform-cvm-0 ~]# echo \"test\" &gt; file1.txt\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\ntest\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5c06\u6587\u4ef6\u7684\u539f\u59cb\u5185\u5bb9\u5df2\u7ecf\u8986\u76d6\u6389\u4e86\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u6e05\u7a7a\u6587\u4ef6\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat file1.txt\ntest\n[root@xuel-terraform-cvm-0 ~]# &gt;file1.txt\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\n</code></pre> <ul> <li>\u8ffd\u52a0\u65b9\u5f0f</li> </ul> <p>\u8bed\u6cd5\uff1a<code>command &gt;&gt;file</code></p> <p>\u5c06\u6807\u51c6\u7684\u8f93\u51fa\u8ffd\u52a0\u5230\u6587\u4ef6\u4e2d\uff0c\u6ce8\u610f\u8ffd\u52a0\u4e3a\u4e0d\u8986\u76d6\u539f\u59cb\u6587\u4ef6\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat file1.txt\ntest\n[root@xuel-terraform-cvm-0 ~]# echo \"test222\" &gt;&gt; file1.txt\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\ntest\ntest222\n</code></pre>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#232-\u9519\u8bef\u8f93\u51fa\u91cd\u5b9a\u5411","title":"2.3.2 \u9519\u8bef\u8f93\u51fa\u91cd\u5b9a\u5411","text":"<ul> <li>\u8986\u76d6\u65b9\u5f0f\uff1a</li> </ul> <p>\u8bed\u6cd5\uff1a<code>command 2&gt;file</code></p> <p>\u4e0e\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u4e00\u6837\uff0c\u53ea\u662f\u7ed1\u5b9a\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u6587\u4ef6\u63cf\u8ff0\u7b26 2\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# ls /none\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n[root@xuel-terraform-cvm-0 ~]# ls /none 2&gt; error.txt\n[root@xuel-terraform-cvm-0 ~]# cat error.txt\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>ls</code> \u67e5\u770b\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u4f1a\u8f93\u51fa\u6807\u51c6\u9519\u8bef\u8f93\u51fa\uff0c\u5c06\u5176\u91cd\u5b9a\u5411\u5230 error.txt \u4e2d\u3002</p> <ul> <li>\u8ffd\u52a0\u65b9\u5f0f:</li> </ul> <p>\u8bed\u6cd5\uff1a<code>command 2&gt;&gt;file</code></p> <p>\u4e0e\u6807\u51c6\u8f93\u51fa\u8ffd\u52a0\u65b9\u5f0f\u4e00\u6837\uff0c\u53ea\u662f\u7ed1\u5b9a\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# abc 2&gt;&gt;error.txt\n[root@xuel-terraform-cvm-0 ~]# cat error.txt\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n-bash: abc: command not found\n</code></pre> <p>\u6211\u4eec\u4f7f\u7528\u547d\u4ee4 abc\uff0cShell \u63d0\u793a\u6211\u4eec\u6ca1\u6709\u8fd9\u4e2a\u547d\u4ee4\uff0c\u5728\u6b64\u5c31\u5c06\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u4ee5\u8ffd\u52a0\u5f62\u5f0f\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#233-\u5168\u90e8\u91cd\u5b9a\u5411","title":"2.3.3 \u5168\u90e8\u91cd\u5b9a\u5411","text":"<p>\u5728\u6211\u4eec\u4f7f\u7528\u8f93\u51fa\u91cd\u5b9a\u5411\u5206\u4e3a\u6807\u51c6\u8f93\u51fa\u4e0e\u9519\u8bef\u8f93\u51fa\uff0c\u5f53\u6211\u4eec\u5e0c\u671b\u5c06\u4e24\u8005\u90fd\u91cd\u5b9a\u5411\u5230\u67d0\u6587\u4ef6\u4f7f\u7528\u53ef\u4ee5\u4f7f\u7528 <code>&amp;&gt;</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat totle.txt\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n/tmp:\ncpulimit-0.2\ncvm_init.log\nnet_affinity.log\nnohup.out\nnv_driver_install.log\nnv_gpu_conf.log\nsetRps.log\nv0.2.tar.gz\nvirtio_blk_affinity.log\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u65e0\u8bba\u6807\u51c6\u8f93\u51fa\u6216\u9519\u8bef\u8f93\u51fa\u90fd\u91cd\u5b9a\u5411\u5230\u4e86 <code>totle.txt</code> \u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#24-\u7ec4\u5408\u4f7f\u7528","title":"2.4 \u7ec4\u5408\u4f7f\u7528","text":"<p>\u8f93\u5165\u548c\u8f93\u51fa\u4e5f\u662f\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\u7684\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ec4\u5408\u4e3b\u8981\u5e94\u7528\u4e8e\u5728 Shell \u811a\u672c\u5f53\u4e2d\u4ea7\u751f\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u573a\u666f\u4e0b\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat &gt; file1.txt &lt;&lt;EOF\n&gt; hello shell\n&gt; hello go\n&gt; test file\n&gt; EOF\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\nhello shell\nhello go\ntest file\n</code></pre> <p>\u5728\u6b64\u5c31\u7ec4\u5408\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u4e0e\u8f93\u5165\u91cd\u5b9a\u5411\u7ec4\u5408\u4f7f\u7528\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#25-\u7a7a\u8bbe\u5907","title":"2.5 \u7a7a\u8bbe\u5907","text":"<p>\u5728 Linux \u7cfb\u7edf\u4e2d\u5b58\u5728\u4e00\u4e2a\u7a7a\u8bbe\u5907\uff0c\u4e5f\u6210\u4e3a\u9ed1\u6d1e\u8bbe\u5907\uff0c\u5176\u4e3a <code>/dev/null</code>\u3002\u5f53\u6211\u4eec\u5c06\u5185\u5bb9\u91cd\u5b9a\u5411\u5230\u5b83\u65f6\u4f1a\u88ab\u4e22\u5f03\uff0c\u5bf9\u5176\u4e5f\u65e0\u6cd5\u8fdb\u884c\u8bfb\u53d6\u5185\u5bb9\u64cd\u4f5c\uff0c\u5229\u7528\u5b83\uff0c\u53ef\u4ee5\u5728\u6211\u4eec\u7f16\u5199 Shell \u4e2d\u80fd\u591f\u8d77\u5230\u7981\u6b62\u5f02\u5e38\u8f93\u51fa\u7684\u529f\u6548\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# ls / /none\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n/:\nbin  boot  data  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var\n[root@xuel-terraform-cvm-0 ~]# ls / /none &gt;/dev/null 2&gt;&amp;1\n[root@xuel-terraform-cvm-0 ~]# ls / /none &amp;&gt;/dev/null\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5148\u5c06\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u5230 <code>/dev/null</code>\uff0c\u5bf9\u4e8e\u9519\u8bef\u6807\u51c6\u8f93\u51fa\u5168\u90e8\u53c8\u91cd\u5b9a\u5411\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u4ece\u800c\u8fbe\u5230\u4e86\u5c06\u5168\u90e8\u8f93\u51fa\u7981\u6b62\u6389\u3002</p> <p>\u6216\u8005\u6211\u4eec\u4f7f\u7528 <code>&amp;</code> \u5c06\u6807\u51c6\u8f93\u51fa\u4e0e\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u5168\u90e8\u91cd\u5b9a\u5411\u5230 <code>/dev/null</code>\uff0c\u540c\u6837\u80fd\u8fbe\u5230\u7981\u6b62\u8f93\u51fa\u7684\u6548\u679c\u3002</p> <p>\u91cd\u5b9a\u5411</p> <pre><code>cmd1|cmd2   # pipe;\u5c06cmd1\u7684\u6807\u51c6\u8f93\u51fa\u4f5c\u4e3acmd2\u7684\u6807\u51c6\u8f93\u5165\n&lt;file       # \u4ece\u6587\u4ef6\u4e2d\u83b7\u53d6\u6807\u51c6\u8f93\u5165\n&gt;file       # \u5c06\u6807\u51c6\u8f93\u51fa\u5b9a\u5411\u5230\u6587\u4ef6\n&gt;&gt;file      # \u5c06\u6807\u51c6\u8f93\u51fa\u5b9a\u5411\u5230\u6587\u4ef6;\u5982\u679c\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u9644\u52a0\u5230\u6587\u4ef6\n&gt;|file      # \u5f3a\u5236\u6807\u51c6\u8f93\u51fa\u5230\u6587\u4ef6\uff0c\u5373\u4f7f\u8bbe\u7f6e\u4e86noclobber\u4e5f\u662f\u5982\u6b64\nn&gt;|file     # \u5f3a\u5236\u4ece\u6587\u4ef6\u63cf\u8ff0\u7b26n\u8f93\u51fa\u5230\u6587\u4ef6\uff0c\u5373\u4f7f\u8bbe\u7f6e\u4e86noclobber\u4e5f\u662f\u5982\u6b64\n&lt;&gt;file      # \u4f7f\u7528file\u4f5c\u4e3a\u6807\u51c6\u8f93\u5165\u548c\u6807\u51c6\u8f93\u51fa\nn&lt;&gt;file     # \u4f7f\u7528file\u4f5c\u4e3a\u6587\u4ef6\u63cf\u8ff0\u7b26n\u7684\u8f93\u5165\u548c\u8f93\u51fa\nn&gt;file      # \u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26n\u6307\u5411\u6587\u4ef6\nn&lt;file      # \u4ece\u6587\u4ef6\u4e2d\u83b7\u53d6\u6587\u4ef6\u63cf\u8ff0\u7b26n\nn&gt;&gt;file     # \u5c06\u6587\u4ef6\u63cf\u8ff0n\u6307\u5411\u6587\u4ef6;\u5982\u679c\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728,\u5219\u9644\u52a0\u5230\u6587\u4ef6\nn&gt;&amp;         # \u5c06\u6807\u51c6\u8f93\u51fa\u590d\u5236\u5230\u6587\u4ef6\u63cf\u8ff0\u7b26n\nn&lt;&amp;         # \u590d\u5236\u6587\u4ef6\u63cf\u8ff0\u7b26n\u7684\u6807\u51c6\u8f93\u5165\nn&gt;&amp;m        # \u6587\u4ef6\u63cf\u8ff0\u7b26n\u662f\u8f93\u51fa\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u526f\u672c\nn&lt;&amp;m        # \u6587\u4ef6\u63cf\u8ff0\u7b26n\u662f\u8f93\u5165\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u526f\u672c\n&amp;&gt;file      # \u5c06\u6807\u51c6\u8f93\u51fa\u548c\u6807\u51c6\u9519\u8bef\u6307\u5411\u6587\u4ef6\n&lt;&amp;-         # \u5173\u95ed\u6807\u51c6\u8f93\u5165\n&gt;&amp;-         # \u5173\u95ed\u6807\u51c6\u8f93\u51fa\nn&gt;&amp;-        # \u5173\u95ed\u6587\u4ef6\u63cf\u8ff0\u7b26n\u7684\u8f93\u51fa\nn&lt;&amp;-        # \u5173\u95ed\u6587\u4ef6\u63cf\u8ff0\u7b26n\u7684\u8f93\u5165\n# \u8ffd\u52a0\u5185\u5bb9\u5230\u6587\u4ef6\ncat &gt;&gt; a.log &lt;&lt;EOF\n123\nEOF\n# \u5c06\u6807\u51c6\u9519\u8bef\u91cd\u5b9a\u5411\u5230\u6807\u51c6\u8f93\u51fa\nnohup command &gt; myout.file 2&gt;&amp;1 &amp;\n</code></pre>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#3-\u5b9e\u4f8b","title":"3. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#31-\u9700\u6c42","title":"3.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u83b7\u53d6 Linux \u7cfb\u7edf\u7684 CPU \u548c\u5185\u5b58\u4fe1\u606f\uff0c\u7136\u540e\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#32-\u601d\u8def","title":"3.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u51fd\u6570\u6765\u5206\u522b\u7f16\u5199 CPU \u548c\u5185\u5b58\u4fe1\u606f\uff0c\u6700\u540e\u5229\u7528\u91cd\u5b9a\u5c06\u4fe1\u606f\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#33-\u5b9e\u73b0","title":"3.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# Description: sys check\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: sys check\n# Date: 2020-03-29 14:00\n# Version: 1.0\n[ $(id -u) -gt 0 ] &amp;&amp; echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" &amp;&amp; exit 1\nsysversion=$(rpm -q centos-release|cut -d- -f3)\nline=\"-------------------------------------------------\"\n[ -d logs ] || mkdir logs\n\nsys_check_file=\"logs/$(ip a show dev eth0|grep -w inet|awk '{print $2}'|awk -F '/' '{print $1}')-`date +%Y%m%d`.txt\"\n# \u83b7\u53d6\u7cfb\u7edfcpu\u4fe1\u606f\nfunction get_cpu_info() {\nPhysical_CPUs=$(grep \"physical id\" /proc/cpuinfo| sort | uniq | wc -l)\nVirt_CPUs=$(grep \"processor\" /proc/cpuinfo | wc -l)\nCPU_Kernels=$(grep \"cores\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}')\nCPU_Type=$(grep \"model name\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq)\nCPU_Arch=$(uname -m)\ncat &lt;&lt;EOF | column -t\nCPU\u4fe1\u606f:\n\u7269\u7406CPU\u4e2a\u6570: $Physical_CPUs\n\u903b\u8f91CPU\u4e2a\u6570: $Virt_CPUs\n\u6bcfCPU\u6838\u5fc3\u6570: $CPU_Kernels\nCPU\u578b\u53f7: $CPU_Type\nCPU\u67b6\u6784: $CPU_Arch\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\nfunction get_mem_info() {\ncheck_mem=$(free -m)\nMemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}')  #KB\nMemFree=$(grep MemFree /proc/meminfo| awk '{print $2}')    #KB\nlet MemUsed=MemTotal-MemFree\n    MemPercent=$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\nreport_MemTotal=\"$((MemTotal/1024))\"\"MB\"        #\u5185\u5b58\u603b\u5bb9\u91cf(MB)\nreport_MemFree=\"$((MemFree/1024))\"\"MB\"          #\u5185\u5b58\u5269\u4f59(MB)\nreport_MemUsedPercent=\"$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\"\"%\"   #\u5185\u5b58\u4f7f\u7528\u7387%\ncat &lt;&lt;EOF\n\u5185\u5b58\u4fe1\u606f\uff1a\n${check_mem}\nEOF\n}\n# \u5b9a\u4e49\u4e3b\u51fd\u6570\nfunction sys_check() {\nget_cpu_info\n    echo ${line}\nget_mem_info\n    echo ${line}\n}\n# \u6267\u884c\u4e3b\u51fd\u6570\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u4e2d\nsys_check &gt; ${sys_check_file}\n# \u6267\u884c\u6d4b\u8bd5\n[root@xuel-terraform-cvm-0 ~]# bash sys_check.sh\n[root@xuel-terraform-cvm-0 ~]# cat logs/10.0.1.15-20200329.txt\nCPU\u4fe1\u606f:\n\u7269\u7406CPU\u4e2a\u6570:  1\n\u903b\u8f91CPU\u4e2a\u6570:  1\n\u6bcfCPU\u6838\u5fc3\u6570:  1\nCPU\u578b\u53f7:      Intel(R)  Xeon(R)  CPU  E5-26xx  v4\nCPU\u67b6\u6784:      x86_64\n-------------------------------------------------\n\u5185\u5b58\u4fe1\u606f\uff1a\n             total       used       free     shared    buffers     cached\nMem:           996        920         76          0        191        600\n-/+ buffers/cache:        127        868\nSwap:            0          0          0\n-------------------------------------------------\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5229\u7528\u4e86\u4e24\u4e2a\u51fd\u6570\u6765\u83b7\u53d6\u7cfb\u7edf\u7684\u4fe1\u606f\uff0c\u5c06\u5176\u5229\u7528\u91cd\u5b9a\u5411\u65b9\u5f0f\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#4-\u6ce8\u610f\u4e8b\u9879","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u4e00\u6761 shell \u547d\u4ee4\uff0c\u90fd\u4f1a\u7ee7\u627f\u5176\u7236\u8fdb\u7a0b\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u56e0\u6b64\u6240\u6709\u7684 shell \u547d\u4ee4\uff0c\u90fd\u4f1a\u9ed8\u8ba4\u6709\u4e09\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1b</li> <li>\u6587\u4ef6\u6240\u6709\u8f93\u5165\u8f93\u51fa\u90fd\u662f\u7531\u8be5\u8fdb\u7a0b\u6240\u6709\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u63a7\u5236\u7684\uff0cLinux \u4e00\u5207\u7686\u6587\u4ef6\uff0c\u56e0\u6b64\u4ed6\u4eec\u7684\u8f93\u5165\u8f93\u51fa\u4e5f\u662f\u7531\u6587\u4ef6\u63cf\u8ff0\u7b26\u63a7\u5236\uff1b</li> <li>\u5728 <code>&lt;</code>\u4e2d\u5206\u754c\u7b26\u53ef\u4ee5\u662f\u81ea\u5b9a\u4e49\u7684\u4efb\u610f\u5b57\u7b26\uff0c\u5728\u6b64\u5efa\u8bae\u4f7f\u7528 EOF\uff1b</li> <li>\u5728\u8fdb\u884c\u6587\u4ef6\u8ffd\u52a0\u7684\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528\u8ffd\u52a0\u65b9\u5f0f\u91cd\u5b9a\u5411\uff0c\u5207\u8bb0\u64cd\u4f5c\u6587\u4ef6\u524d\u5907\u4efd\u8001\u6587\u4ef6\uff0c\u4ee5\u514d\u6587\u4ef6\u5185\u5bb9\u5f02\u5e38\u3002</li> </ul>"},{"location":"Linux/shell/10.Shell%E8%BE%93%E5%85%A5_%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#5-\u5c0f\u7ed3","title":"5. \u5c0f\u7ed3","text":"<p>\u5bf9\u4e8e\u91cd\u5b9a\u5411\u7279\u522b\u9002\u7528\u4e8e\u6587\u4ef6\u7684\u64cd\u4f5c\u6216\u8005\u67d0\u4e9b\u4e0d\u5173\u6ce8\u8f93\u51fa\u7ed3\u679c\u7684\u573a\u666f\uff0c\u5728\u672c\u7ae0\u8282\u9700\u8981\u6ce8\u610f\u8986\u76d6\u5f0f\u4e0e\u8ffd\u52a0\u6a21\u5f0f\u7684\u533a\u522b\uff0c\u7075\u6d3b\u914d\u5408\u7a7a\u8bbe\u5907\u5bf9\u7279\u5b9a\u573a\u666f\u8fdb\u884c\u5e94\u7528\uff0c\u7406\u89e3\u4e09\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u767e\u53d8\u4e0d\u79bb\u5176\u4e2d\u7075\u6d3b\u7ec4\u5408\u4f7f\u7528\u3002</p>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/","title":"11.Shell\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#1-shell-\u6b63\u5219\u8868\u8fbe\u5f0f\u6982\u8ff0","title":"1 Shell \u6b63\u5219\u8868\u8fbe\u5f0f\u6982\u8ff0","text":""},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#11-\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4ec0\u4e48","title":"1.1 \u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4ec0\u4e48","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f (regular expression) \u662f\u4e00\u4e9b\u5177\u4f53\u6709\u7279\u6b8a\u542b\u4e49\u7684\u7b26\u53f7\uff0c\u7ec4\u5408\u5728\u4e00\u8d77\u7684\u5171\u540c\u63cf\u8ff0\u5b57\u7b26\u6216\u5b57\u7b26\u4e32\u7684\u65b9\u6cd5\uff0c\u901a\u4fd7\u6765\u8bb2\u6b63\u5219\u4e3a\u63cf\u8ff0\u540c\u4e00\u7c7b\u4e8b\u7269\u7684\u89c4\u5219\uff0c\u4f8b\u5982\u6211\u4eec\u751f\u6d3b\u4e2d\u63cf\u8ff0\u53ef\u4ee5\u98de\u884c\u7684\u662f\u4e8b\u7269\uff0c\u5219\u6ee1\u8db3\u8fd9\u6761\u89c4\u5219\u7684\u53ef\u4ee5\u662f\u9e1f\uff0c\u8774\u8776\uff0c\u4e5f\u53ef\u4ee5\u662f\u98de\u673a\u7b49\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u901a\u5e38\u7528\u6765\u5bf9\u5b57\u7b26\u6216\u5b57\u7b26\u4e32\u6765\u8fdb\u884c\u5904\u7406\uff0c\u5b83\u662f\u7528\u4e8e\u63cf\u8ff0\u5b57\u7b26\u6392\u5217\u6216\u5339\u914d\u6a21\u5f0f\u7684\u4e00\u79cd\u8bed\u8a00\u89c4\u5219\u3002</p>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u6b63\u5219\u8868\u8fbe\u5f0f","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u6211\u4eec\u77e5\u9053\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4e00\u4e2a\u63cf\u8ff0\u5b57\u7b26\u6392\u5217\u6216\u6a21\u5f0f\u5339\u914d\u7684\u89c4\u5219\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5b83\u6765\u5236\u5b9a\u81ea\u5df1\u7684\u89c4\u5219\uff0c\u83b7\u53d6\u5230\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c\u7b49\u3002\u5728\u540e\u7eed\u7684 Shell \u4e09\u5251\u5ba2 grep/awk/sed Shell \u7684\u5b66\u4e60\u4e2d\uff0c\u6211\u4eec\u4f1a\u7ed3\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0e\u8fd9\u4e9b\u547d\u4ee4\u8fdb\u884c\u7ed3\u5408\u4f7f\u7528\uff0c\u6765\u5b9e\u73b0\u66f4\u5f3a\u5927\u7684\u6587\u672c\u5904\u7406\u529f\u80fd\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u6211\u4eec Shell \u5b66\u4e60\u7684\u6838\u5fc3\u4e5f\u662f\u96be\u70b9\uff0c\u5728 Linux \u4e2d\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u591a\u6587\u4ef6\u7684\u5904\u7406\u53ef\u4ee5\u8986\u76d6\u6211\u4eec\u65e5\u5e38\u5de5\u4f5c\u7684 90%\uff0c\u6240\u6709\u719f\u7ec3\u638c\u63e1\u6b63\u5219\u8868\u8fbe\u5f0f\u663e\u5f97\u5c24\u4e3a\u91cd\u8981\uff0c\u5728\u4e4b\u540e\u7075\u6d3b\u914d\u5408\u5176\u4ed6\u547d\u4ee4\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u6ee1\u8db3\u6211\u4eec\u7684\u65e5\u5e38\u5904\u7406\u9700\u6c42\u3002</p>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#2-shell-\u6b63\u5219\u8868\u8fbe\u64cd\u4f5c","title":"2 Shell \u6b63\u5219\u8868\u8fbe\u64cd\u4f5c","text":"<p>\u5728\u5b66\u4e60\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u64cd\u4f5c\u4e4b\u524d\u6211\u4eec\u9700\u8981\u4e86\u89e3\u4e0b POSIX \u53ca\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5206\u7c7b\u3002</p>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#21-\u9884\u5907\u77e5\u8bc6","title":"2.1 \u9884\u5907\u77e5\u8bc6","text":""},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#211-posix","title":"2.1.1 POSIX","text":"<p>POSIX \u79f0\u4e3a\uff1aPortable Operating System Interface\uff08\u672b\u5c3e\u589e\u52a0 X \u53ea\u662f\u4e3a\u4e86\u66f4\u6d41\u7545\uff09\u7684\u7f29\u5199\uff0c\u540e\u6765\u88ab IEEE \u91c7\u7eb3\uff0c\u7531\u4e8e\u5728\u65e9\u671f Unix \u7cfb\u7edf\u65f6\u4ee3\u5404\u5382\u5546\u53d1\u5e03\u4e0d\u540c\u7248\u672c\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5404\u7248\u672c\u4e4b\u95f4\u5b58\u5728\u7740\u4ea7\u54c1\u7684\u5dee\u5f02\uff0c\u4e4b\u540e IEEE \u53d1\u5e03\u4e86\u4e00\u5957 Unix \u548c\u7c7b Unix \u7cfb\u7edf\u5de5\u4f5c\u65b9\u5f0f\u89c4\u8303\uff0c\u81f3\u6b64\u5404\u5e38\u89c1\u9075\u5faa\u6b64\u89c4\u8303\u6765\u8fbe\u5230\u8f6f\u4ef6\u517c\u5bb9\u7684\u6548\u679c\u3002</p>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#212-\u6b63\u5219\u8868\u8fbe\u5f0f\u5206\u7c7b","title":"2.1.2 \u6b63\u5219\u8868\u8fbe\u5f0f\u5206\u7c7b","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u5e38\u89c1\u7684\u6709\u4e24\u79cd\u5206\u7c7b\uff1a</p> <ul> <li>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\uff1aBasic Regular Expression \u53c8\u53eb Basic RegEx \u7b80\u79f0 BREs\uff0c\u5728\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u4f5c\u7528\u7684\u5143\u5b57\u7b26\u4e3a\uff1a^ \u3001$\u3001 . \u3001[\u3001] \u3001*\u3002</li> <li>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff1aExtended Regular Expression \u53c8\u53eb Extended RegEx \u7b80\u79f0 EREs\uff0c\u5176\u4e3a\u5728\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0a\u65b0\u589e\u4e86 (\u3001) \u3001{ \u3001} \u3001?\u3001 + \u3001\u7b49\u5143\u5b57\u7b26\u5143\u5b57\u7b26\uff0c\u4f7f\u5f97\u6b63\u5219\u8868\u8fbe\u5f0f\u66f4\u52a0\u7b80\u6d01\u6613\u7528\u3002</li> </ul>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#213-\u5b57\u7b26","title":"2.1.3 \u5b57\u7b26","text":"<p>\u5728\u5b66\u4e60\u6b63\u5219\u8868\u8fbe\u5f0f\u524d\u9700\u8981\u5148\u5b66\u4e60\u5b57\u7b26\u3002</p> <ul> <li>POSIX \u5b57\u7b26</li> </ul> <p>\u901a\u7528 POSIX \u539f\u5b57\u7b26\u5165\u4e0b\uff1a</p> <pre><code>[:alnum:] \u5b57\u6bcd\u6570\u5b57[a-z A-Z 0-9]\n[:alpha:]   \u5b57\u6bcd[a-z A-Z]\n[:blank:]   \u7a7a\u683c\u6216\u5236\u8868\u952e\n[:cntrl:] \u4efb\u4f55\u63a7\u5236\u5b57\u7b26\n[:digit:] \u6570\u5b57 [0-9]\n[:graph:] \u4efb\u4f55\u53ef\u89c6\u5b57\u7b26\uff08\u65e0\u7a7a\u683c\uff09\n[:lower:] \u5c0f\u5199 [a-z]\n[:print:] \u975e\u63a7\u5236\u5b57\u7b26 [:punct:] \u6807\u70b9\u5b57\u7b26\n[:space:] \u7a7a\u683c\n[:upper:] \u5927\u5199 [A-Z]\n[:xdigit:] \u5341\u516d\u8fdb\u5236\u6570\u5b57 [0-9 a-f A-F]\n</code></pre> <ul> <li>\u7279\u6b8a\u5b57\u7b26</li> </ul> <p>\u5728\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u52a0\u4e0a <code>\\</code> \u5219\u88ab\u8ba4\u4e3a\u5176\u5177\u6709\u7279\u6b8a\u542b\u4e49\uff1a</p> <pre><code>\\w \u5339\u914d\u4efb\u610f\u6570\u5b57\u548c\u5b57\u6bcd\uff0c\u7b49\u6548[a-zA-Z0-9_]\n\\W \u548c\\w\u76f8\u53cd\uff0c\u7b49\u6548[^a-zA-Z0-9_]\n\\b \u5339\u914d\u5b57\u7b26\u4e32\u5f00\u59cb\u6216\u7ed3\u675f\uff0c\u7b49\u6548\\&lt;\u548c\\&gt;\n\\s \u5339\u914d\u4efb\u610f\u7684\u7a7a\u767d\u5b57\u7b26\n\\S \u5339\u914d\u975e\u7a7a\u767d\u5b57\u7b26\n</code></pre>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#214-\u533a\u522b","title":"2.1.4 \u533a\u522b","text":"<ul> <li>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5143\u5b57\u7b26\uff1a\u53ea\u6709 ^$.*\uff1b</li> <li>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u5143\u5b57\u7b26\uff1a^$.*+(){}?|\uff1b</li> <li>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u5bf9\u4e8e {m,n} \u548c () \u4e0d\u9700\u8981\u518d\u5411\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u9700\u8981 <code>\\</code> \u6765\u8f6c\u8bd1\u3002</li> </ul>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#22-\u6b63\u5219\u8868\u8fbe\u5f0f\u64cd\u4f5c","title":"2.2 \u6b63\u5219\u8868\u8fbe\u5f0f\u64cd\u4f5c","text":"<p>\u5728 Linux \u4e2d\u6b63\u5219\u8868\u8fbe\u5f0f\u7528\u6765\u5904\u7406\u6587\u672c\uff0c\u5728\u6b64\u6211\u4eec\u4f7f\u7528 grep \u5de5\u5177\u5bf9\u6b63\u5219\u8868\u8fbe\u5f0f\u8fdb\u884c\u64cd\u4f5c\uff0cgrep \u4e3a\u6587\u672c\u8fc7\u6ee4\u5de5\u5177\uff0c\u5728 grep \u547d\u4ee4\u4e2d\u9ed8\u8ba4\u4f7f\u7528\u7684\u65f6\u5019\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u9009\u9879 <code>-E</code> \u6765\u5f00\u542f\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u6309\u7167\u6307\u5b9a\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u53d6\u51fa\u6211\u4eec\u9700\u6c42\u7684\u5185\u5bb9\u3002</p>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#221-\u5b57\u7b26\u5339\u914d","title":"2.2.1 \u5b57\u7b26\u5339\u914d","text":"<p>\u5728\u5b57\u7b26\u5339\u914d\u524d\u9700\u8981\u5148\u5b66\u4e60\u3002</p> <ul> <li><code>.</code>: \u5339\u914d\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test.txt \nshe\nsh\ns1e\n[root@master reg]# grep \"s.e\" test.txt \nshe\ns1e\n</code></pre> <p><code>.</code> \u5339\u914d\u5fc5\u987b\u4e3a\u5b57\u6bcd s \u4e0e e \u4e2d\u6709\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\u3002</p> <ul> <li></li> </ul> <pre><code>[root@master reg]# cat test.txt \nshe\nsh\ns1e\n[root@master reg]# grep \"s[a-z]e\" test.txt \nshe\n[root@master reg]# grep \"s[1-9]e\" test.txt    \ns1e\n[root@master reg]# grep \"s[[:alnum:]]e\" test.txt      // \u5339\u914d\u5b57\u7b26\u6216\u6570\u5b57  \nshe\ns1e\n[root@master reg]# grep \"s[[:alpha:]]e\" test.txt    \nshe\n[root@master reg]# grep \"s[[:digit:]]e\" test.txt      \ns1e\n</code></pre> <p>\u4e2d\u62ec\u53f7\u5185\u53ef\u4ee5\u5229\u7528\u5143\u5b57\u7b26\u6765\u8868\u793a\u3002</p> <ul> <li></li> </ul> <pre><code>[root@master reg]# cat test.txt \nshe\nsh\ns1e\n[root@master reg]# grep \"s[^[:digit:]]e\" test.txt    \nshe\n[root@master reg]# grep \"s[^a-z]e\" test.txt          \ns1e\n</code></pre> <p>\u5982\u4e0a\uff0c\u5339\u914d\u7684\u5143\u5b57\u7b26\u53d6\u53cd\uff0c\u4e5f\u5c31\u662f\u4e0d\u5305\u542b\u5339\u914d\u7684\u5185\u5bb9\u3002</p>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#222-\u6b21\u6570\u5339\u914d","title":"2.2.2 \u6b21\u6570\u5339\u914d","text":"<p>\u6b21\u6570\u5339\u914d\u7528\u5728\u6307\u5b9a\u7684\u5b57\u7b26\u540e\u9762\uff0c\u8868\u793a\u6307\u5b9a\u5339\u914d\u5230\u524d\u9762\u7684\u5b57\u7b26\u51fa\u73b0\u591a\u5c11\u6b21\u3002</p> <ul> <li><code>*</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u4efb\u610f\u6b21\uff080 \u6b21\u83b7\u65e0\u6570\u6b21\uff09\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s*\" test2.txt \nssssh\nsheee\nhell    </code></pre> <p>\u5982\u4e0a\u5339\u914d\u5b57\u7b26 s\uff0c0 \u6b21\u6216\u591a\u6b21\u3002</p> <ul> <li><code>\\?</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26 0 \u6b21\u6216 1 \u6b21\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\?h\" test2.txt \nssssh                       # \u5339\u914d\u6700\u540e\u7684sh\nsheee                       # \u5339\u914dsh\nhell                        # \u5339\u914dh\n[root@master reg]# grep -E \"s?h\" test2.txt  \nssssh\nsheee\nhell\n</code></pre> <p>\u5982\u4e0a\u5339\u914d s \u53ef\u4ee5\u5b58\u5728 0 \u6b21\uff0c\u6216\u8005\u5b58\u5728 1 \u6b21\u4e4b\u540e\u9700\u8981\u6709 h \u5b57\u7b26\uff0c\u6ce8\u610f\u5229\u7528\u9009\u9879 <code>-E</code> \u5f00\u542f\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u76f8\u8f83\u4e0e\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0d\u9700\u8981 <code>\\</code>\u3002</p> <ul> <li><code>+</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u81f3\u5c11 1 \u6b21\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\+h\" test2.txt  \nssssh                       # \u5339\u914dssssh\nsheee                       # \u5339\u914dsh\n[root@master reg]# grep -E \"s+h\" test2.txt\nssssh\nsheee\n</code></pre> <p>\u5982\u4e0a\u5339\u914d s \u81f3\u5c11\u5b58\u5728 1 \u6b21\u6216\u65e0\u6570\u6b21\u3002</p> <ul> <li><code>\\{m\\,}</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u81f3\u5c11 m \u6b21\uff08\u9ed8\u8ba4\u5de5\u4f5c\u5728\u8d2a\u5a6a\u6a21\u5f0f\u4e0b\uff0c? \u53d6\u6d88\u8d2a\u5a6a\u6a21\u5f0f\uff09\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\{1,\\}\" test2.txt \nssssh\nsheee\n[root@master reg]# grep -E \"s{1,}\" test2.txt   \nssssh\nsheee\n[root@master reg]# grep \"s\\{2,\\}\" test2.txt  \nssssh\n[root@master reg]# grep -E \"s{2,}\" test2.txt   \nssssh\n</code></pre> <p>\u5339\u914d\u5b57\u7b26 s\uff0c\u6700\u5c11 1 \u6b21\u3002</p> <ul> <li><code>\\{,n}</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u6700\u591a n \u6b21\uff08\u9ed8\u8ba4\u5de5\u4f5c\u5728\u8d2a\u5a6a\u6a21\u5f0f\u4e0b\uff0c? \u53d6\u6d88\u8d2a\u5a6a\u6a21\u5f0f\uff09\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\{,2\\}\" test2.txt     \nssssh\nsheee\nhell\n[root@master reg]# grep -E \"s{,2}\" test2.txt  \nssssh\nsheee\nhell\n</code></pre> <p>\u5339\u914d\u5b57\u7b26 s\uff0c\u6700\u591a 2 \u6b21\u3002</p> <ul> <li><code>\\{m,n\\}</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u81f3\u5c11 m \u6b21\uff0c\u81f3\u591a n \u6b21\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\{1,2\\}\" test2.txt    \nssssh\nsheee\n[root@master reg]# grep -E \"s{1,2}\" test2.txt \nssssh\nsheee\n</code></pre> <p>\u5339\u914d\u5b57\u7b26 s\uff0c1-2 \u6b21\u4e4b\u95f4\u3002</p> <ul> <li><code>.*</code>: \u5339\u914d\u4efb\u610f\u5b57\u7b26\u4efb\u610f\u6b21\u6570\u3002</li> </ul>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#223-\u4f4d\u7f6e\u94c6\u5b9a","title":"2.2.3 \u4f4d\u7f6e\u94c6\u5b9a","text":"<ul> <li><code>^</code>: \u884c\u9996\u951a\u5b9a\uff0c\u7528\u4e8e\u6a21\u5f0f\u6700\u5de6\u8fb9\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"^s\" test2.txt \nssssh\nsheee\n</code></pre> <p>\u5339\u914d\u4ee5 s \u5f00\u5934\u7684\u884c\u3002</p> <ul> <li><code>$</code>: \u884c\u5c3e\u951a\u5b9a\uff0c\u7528\u4e8e\u6a21\u5f0f\u6700\u53f3\u8fb9\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"h$\" test2.txt \nssssh\n</code></pre> <p>\u5339\u914d\u4ee5 h \u7ed3\u5c3e\u7684\u884c\u3002</p> <ul> <li><code>\\&lt;</code> \u6216 <code>\\b</code>: \u951a\u5b9a\u8bcd\u9996\uff0c\u7528\u4e8e\u5355\u8bcd\u6a21\u5f0f\u5de6\u4fa7\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \ngo root user\nroot:shell;gousers\nhellorootgouser\n[root@master reg]# grep \"\\&lt;ro\" test2.txt \ngo root user\nroot:shell;gousers\n[root@master reg]# grep \"\\bro\" test2.txt         \ngo root user\nroot:shell;gousers\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6b64\u523b\u5339\u914d\u662f\u4ee5\u5355\u8bcd\u6a21\u5f0f\uff0c\u6ca1\u6709\u5339\u914d helloroot\u3002</p> <ul> <li><code>\\&gt;</code> \u6216 <code>\\b</code>: \u951a\u5b9a\u8bcd\u5c3e\uff0c\u7528\u4e8e\u5355\u8bcd\u6a21\u5f0f\u53f3\u4fa7\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# grep \"gouser\\b\" test2.txt \nhellorootgouser\n[root@master reg]# grep \"gouser\\&gt;\" test2.txt  \nhellorootgouser\n</code></pre>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#224-\u5206\u7ec4\u5f15\u7528","title":"2.2.4 \u5206\u7ec4\u5f15\u7528","text":"<ul> <li><code>()</code> \u5206\u7ec4\uff1a\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\u5f53\u6210\u4e00\u4e2a\u6574\u4f53\u6765\u8fdb\u884c\u540e\u7eed\u5904\u7406\uff1b</li> <li><code>1\u2026\u6570\u5b57</code>\u5f15\u7528\uff1a\u4ece\u5de6\u4fa7\u8d77\uff0c\u5f15\u7528\u7b2c\u4e00\u4e2a\u5de6\u62ec\u53f7\u4ee5\u53ca\u4e0e\u4e4b\u5339\u914d\u53f3\u62ec\u53f7\u4e4b\u95f4\u7684\u6a21\u5f0f\u6240\u5339\u914d\u5230\u7684\u5b57\u7b26\uff0c\u540e\u5411\u5f15\u7528\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>grep -E \"(root).*\\1\" /etc/passwd\n</code></pre> <p>\u5229\u7528 () \u5c06 root \u5f15\u7528\u8d77\u6765\uff0c\u540e\u9762\u5229\u7528\u6570\u5b57 1 \u5f15\u7528\u3002</p>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#3-\u5b9e\u4f8b","title":"3 \u5b9e\u4f8b","text":"<pre><code>1.\u663e\u793a/etc/init.d/functions\u6587\u4ef6\u4e2d\u4ee5\u5927\u5c0fs\u5f00\u5934\u7684\u884c\ngrep '^[Pp]' /etc/init.d/functions\n\n2.\u663e\u793a/etc/passwd\u6587\u4ef6\u4e2d\u4ee5/bin/bash\u7ed3\u5c3e\u7684\u884c\ngrep \"/bin/bash$\" /etc/passwd\n\n3.\u663e\u793a/etc/passwd\u6587\u4ef6\u4e2dID\u53f7\u6700\u5927\u7528\u6237\u7684\u7528\u6237\u540d\nsort -t: -k3 -n /etc/passwd |tail -1 |cut -d: -f1\n\n4.\u5982\u679croot\u7528\u6237\u5b58\u5728,\u663e\u793a\u5176\u9ed8\u8ba4\u7684shell\u7a0b\u5e8f\nid root &amp;&amp; grep '^\\&lt;root\\&gt;' /etc/passwd |awk -F: '{print $NF}'\n5.\u627e\u51fa/etc/passwd\u4e2d\u7684\u4e24\u4f4d\u6216\u4e09\u4f4d\u6570\ngrep -o \"[0-9]\\{2,3\\}\" /etc/passwd\n\n6.\u663e\u793a/etc/rc.d/rc.sysinit\u6587\u4ef6\u4e2d,\u81f3\u5c11\u4ee5\u4e00\u4e2a\u7a7a\u767d\u5b57\u7b26\u5f00\u5934\u7684\u4e14\u540e\u9762\u5b58\u975e\u7a7a\u767d\u5b57\u7b26\u7684\u884c:\ngrep '^[[:space:]]\\+[^[:space:]]' /etc/rc.d/rc.sysinit\n\n7.\u627e\u51fa\"netstat -tan\"\u547d\u4ee4\u7684\u7ed3\u679c\u4ee5\"LISTEN\"\u540e\u8ddf0,1\u6216\u591a\u4e2a\u7a7a\u767d\u5b57\u7b26\u7ed3\u5c3e\u7684\u884c\nnetstat -tan|grep 'LISTEN[[:space:]]*$'\n8.\u5982\u679croot\u7528\u6237\u767b\u5f55\u4e86\u7cfb\u7edf,\u5c31\u663e\u793aroot\u7528\u6237\u5728\u7ebf,\u5426\u5219\u8bf4\u660e\u672a\u767b\u5f55\nw |grep '^\\&lt;root\\&gt;'&gt;/dev/null &amp;&amp; echo \"root\u5728\u7ebf\"|| echo \"root\u672a\u767b\u5f55\"\n9.\u627e\u51fa/etc/rc.d/init.d/functions\u6587\u4ef6\u4e2d\u67d0\u5355\u8bcd\u540e\u9762\u8ddf\u4e00\u5bf9\u5c0f\u62ec\u53f7\u7684\u884c\ngrep '[[:alpha:]]*()' /etc/rc.d/init.d/functions\n\n10.\u4f7f\u7528echo\u8f93\u51fa\u4e00\u4e2a\u8def\u5f84,\u4f7f\u7528egrep\u53d6\u51fa\u57fa\u540d\necho /tmp/tmp1/vmstat.8.gz |grep -E  -o '[^/]+/?$'|cut -d/ -f1\n\n11.\u5339\u914dPPID\u5f00\u5934\uff0c\u884c\u4e2d\u53c8\u518d\u6b21\u51fa\u73b0PPID\u7684\u5185\u5bb9\u3002/etc/init.d/functions\ngrep -E \"(PPID).*\\1\" /etc/init.d/functions\n\n12.\u5229\u7528awk\u627e\u51fa/etc/ssh/sshd_config\u5185\u51fa\u8fc7\u7a7a\u884c\u4e0e\u4ee5#\u5f00\u5934\u7684\u884c\ngrep -v -E '^#|^$' /etc/ssh/sshd_config\n</code></pre>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#4-\u6ce8\u610f\u4e8b\u9879","title":"4 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0e\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u914d\u5408\u5176\u5b83\u64cd\u4f5c\uff0c\u80fd\u591f\u5343\u53d8\u4e07\u5316\uff0c\u975e\u5e38\u7075\u6d3b\uff0c\u6839\u636e\u4e0d\u540c\u573a\u666f\u53ef\u4ee5\u8fdb\u884c\u6b63\u5411\u5339\u914d\u548c\u53cd\u5411\u5339\u914d\uff1b</li> <li>\u6b63\u5219\u8868\u8fbe\u5f0f\u914d\u5408\u547d\u4ee4\u901a\u5e38\u4e3a\u4e09\u5251\u5ba2 grep/awk/sed \u7b49\uff0c\u540e\u671f\u7075\u6d3b\u8fdb\u884c\u7ec4\u5408\u8fbe\u5230\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\uff1b</li> <li>\u6211\u4eec\u5728\u6587\u672c\u6a21\u5f0f\u5339\u914d\u7684\u65f6\u5019\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u6269\u5c55\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4ece\u800c\u907f\u514d\u4f7f\u7528\u8fc7\u591a\u7684\u8f6c\u4e49\u5b57\u7b26\u3002</li> </ul>"},{"location":"Linux/shell/11.Shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#5-\u5c0f\u7ed3","title":"5 \u5c0f\u7ed3","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u8c13 Shell \u4e2d\u7684\u7cbe\u534e\uff0c\u5176\u5b9e\u5728\u5176\u4ed6\u8bed\u8a00\u4e2d\u4e5f\u5f88\u901a\u7528\uff0c\u9700\u8981\u8fdb\u884c\u52e4\u52a0\u7ec3\u4e60\u624d\u80fd\u8fbe\u5230\u719f\u7ec3\u638c\u63e1\uff0c\u6ce8\u610f\u533a\u5206\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0e\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u8bed\u6cd5\u533a\u522b\uff0c\u914d\u5408\u5176\u4ed6\u5de5\u5177\u7075\u6d3b\u8fd0\u7528\u3002\u5728\u4e0d\u540c\u573a\u666f\u53ef\u4ee5\u5229\u7528\u547d\u4ee4\u9009\u9879\u914d\u5408\u4f7f\u7528\uff0c\u5728\u540e\u671f Shell \u811a\u672c\u4e09\u5251\u5ba2\u4e2d\u4e5f\u4f1a\u9891\u7e41\u51fa\u73b0\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u653b\u514b\u6b63\u5219\u8868\u8fbe\u5f0f\u8fd9\u4e2a\u96be\u5173\uff0cShell \u811a\u672c\u7f16\u7a0b\u5c31\u5df2\u7ecf\u4e8b\u534a\u529f\u500d\u3002</p> <ol> <li> <p>\u5339\u914d\u6307\u5b9a\u8303\u56f4\u5916\u7684\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\uff0c\u4f8b\u5982\uff1a\u00a0\u21a9</p> </li> </ol>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/","title":"12.Shell\u4e09\u5251\u5ba2\u4e4bgrep","text":""},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#1-grep\u6982\u8ff0","title":"1 grep\u6982\u8ff0","text":""},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#11-grep\u662f\u4ec0\u4e48","title":"1.1 grep\u662f\u4ec0\u4e48","text":"<p>\u5728\u6211\u4eec\u65e5\u5e38Linux\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\uff0c\u6700\u591a\u7684\u5c31\u662f\u5bf9Linux\u6587\u4ef6\u8fdb\u884c\u5904\u7406\uff0cgrep\uff08global search regular expression(RE) and print out the line\uff09\u4f5c\u4e3a\u4e00\u6b3e\u975e\u5e38\u65b9\u4fbf\u4e14\u5f3a\u5927\u7684\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u5176\u80fd\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u641c\u7d22\u6587\u672c\uff0c\u5e76\u628a\u5339\u914d\u7684\u884c\u6253\u5370\u51fa\u6765\uff0c\u5176\u4f7f\u7528\u5bf9\u8c61\u4e3aLinux\u7cfb\u7edf\u7684\u6240\u6709\u7528\u6237\uff0c\u4f7f\u5f97\u6211\u4eec\u65e5\u5e38\u64cd\u4f5c\u66f4\u52a0\u65b9\u4fbf\u7b80\u5355\u3002</p>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#12-\u4e3a\u4ec0\u4e48\u8981\u7528grep","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528grep","text":"<p>\u5728Linux\u7cfb\u7edf\u4e2d\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u6211\u4eec\u65e5\u5e38\u7684\u5de5\u4f5c\u5c31\u662f\u4e0e\u6587\u4ef6\u6253\u4ea4\u9053\uff0c\u80fd\u591f\u8fd0\u7528grep\u8fd9\u6b3e\u6587\u4ef6\u641c\u7d22\u5de5\u5177\uff0c\u53ef\u4ee5\u5927\u5927\u63d0\u4f9b\u6211\u4eec\u7684\u5de5\u4f5c\u6548\u7387\uff0c\u6211\u4eec\u4e0a\u8282\u8bfe\u5b66\u4e60\u4e86\u6b63\u5219\u8868\u8fbe\u5f0f\uff0cgrep\u914d\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u80fd\u591f\u4f5c\u51fa1+1\u5927\u4e8e2\u7684\u6548\u679c\uff0c\u7075\u6d3b\u4f7f\u7528\u4f7f\u5f97\u6211\u4eec\u7684\u5de5\u4f5c\u66f4\u52a0\u9ad8\u6548\u5feb\u6377\u3002</p>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#2-grep\u8be6\u89e3","title":"2 grep\u8be6\u89e3","text":""},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#21-grep\u5206\u7c7b","title":"2.1 grep\u5206\u7c7b","text":"<p>Unix \u7684 grep \u5bb6\u65cf\u5305\u62ec grep\u3001egrep \u548c fgrep\u3002egrep \u548c fgrep \u7684\u547d\u4ee4\u53ea\u8ddf grep \u6709\u5f88\u5c0f\u4e0d\u540c\u3002</p> <ul> <li>egrep \u662f grep \u7684\u6269\u5c55\uff0c\u5176\u652f\u6301\u66f4\u591a re\u5143\u5b57\u7b26\uff0c\u548c\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u7b49\u3002</li> <li>fgrep \u5c31\u662f fixed grep \u6216 fast grep\uff0c\u5b83\u4eec\u628a\u6240\u6709\u7684\u5b57\u6bcd\u90fd\u770b\u4f5c\u5355\u8bcd\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u7684\u5143\u5b57\u7b26\u8868\u793a\u5176\u81ea\u8eab\u7684\u5b57\u9762\u610f\u4e49\uff0c\u4e0d\u518d\u7279\u6b8a\u3002</li> <li>linux \u4f7f\u7528 GNU \u7248\u672c\u7684 grep\u3002\u5b83\u529f\u80fd\u66f4\u5f3a\uff0c\u53ef\u4ee5\u901a\u8fc7-G\u3001-E\u3001-F\u547d\u4ee4\u884c\u9009\u9879\u6765\u4f7f\u7528 egrep \u548c fgrep \u7684\u529f\u80fd\u3002</li> </ul>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#22-grep\u5de5\u4f5c\u65b9\u5f0f","title":"2.2 grep\u5de5\u4f5c\u65b9\u5f0f","text":"<p>grep \u7684\u5de5\u4f5c\u65b9\u5f0f\u4e3a\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u6587\u4ef6\u4e2d\u641c\u7d22\u5b57\u7b26\u4e32\u6a21\u7248\u3002\u5982\u679c\u6a21\u7248\u5305\u62ec\u7a7a\u683c\uff0c\u5219\u5fc5\u987b\u88ab\u5f15\u7528\uff0c\u6a21\u677f\u540e\u7684\u6240\u6709\u5b57\u7b26\u4e32\u88ab\u770b\u4f5c\u6587\u4ef6\u540d\u3002\u641c\u7d22\u7684\u7ed3\u679c\u88ab\u9001\u5230\u5c4f\u5e55\uff0c\u4e0d\u5f71\u54cd\u539f\u6587\u4ef6\u5185\u5bb9\u3002</p> <p>grep \u547d\u4ee4\u7ed3\u675f\u540e\u901a\u8fc7\u4e00\u4e2a\u72b6\u6001\u503c\u6765\u8bf4\u660e\u641c\u7d22\u72b6\u6001\uff0c\u5982\u679c\u4e3a0\u5219\u610f\u5473\u641c\u7d22\u6210\u529f\uff0c\u53cd\u4e4b\u5219\u4e3a\u5931\u8d25\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5176\u5bf9\u6587\u4ef6\u81ea\u52a8\u5316\u5904\u7406\u3002</p>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#23-grep-\u8bed\u6cd5","title":"2.3 grep \u8bed\u6cd5","text":"<pre><code>grep [OPTION]... PATTERN [FILE]\n</code></pre> <p>\u5176\u4e2d<code>OPTION</code>\u6709\u5f88\u591a\u65b9\u5f0f\uff0c\u4f8b\u5982-A3\u8868\u793a\u663e\u793a\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u90a3\u4e00\u884c\u4e4b\u5916\uff0c\u5e76\u663e\u793a\u8be5\u884c\u4e4b\u540e\u76843\u884c\u5185\u5bb9\u3002</p> <p><code>PATTERN</code>\u8868\u793a\uff1a\u5339\u914d\u7684\u6a21\u5f0f\uff0c\u901a\u5e38\u4e3a\u4e00\u4e2a\u8868\u8fbe\u5f0f\u3002</p> <p><code>FilE</code>\u4e3a\u5177\u4f53\u7684\u9700\u8981\u5904\u7406\u7684\u95ee\u9898\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e3a\u6807\u51c6\u8f93\u5165\u3002</p>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#23-\u53c2\u6570\u8be6\u89e3","title":"2.3 \u53c2\u6570\u8be6\u89e3","text":"<p>\u5728\u4e0a\u4e00\u8282\u4e2d\u6211\u4eec\u8be6\u7ec6\u8bb2\u89e3\u4e86\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5b83\u5c31\u53ef\u4ee5\u7528\u5728 grep \u547d\u4ee4\u7684<code>PATTERN</code> \u5b57\u6bb5\u4e2d,\u4f7f\u5f97grep\u66f4\u52a0\u5f3a\u5927\uff0c\u672c\u7ae0\u8282\u6211\u4eec\u7740\u91cd\u6765\u8bb2\u89e3 grep \u547d\u4ee4\u7684<code>OPTION</code>\u3002</p> <p>\u4e0d\u52a0\u53c2\u6570\uff0c\u5339\u914d /etc/passwd \u6587\u4ef6\u4e2d\u7684 root \u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep \"root\" /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\n</code></pre> <ul> <li>-A\uff1a\u663e\u793a\u6a21\u5f0f\u5339\u914d\u540e\u7684\u51e0\u884c</li> </ul> <p>\u67e5\u627e /etc/passwd \u6587\u4ef6\u4e2d\u4ee5 root \u5f00\u5934\u7684\u540e\u4e24\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -A2 \"^root\" /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n</code></pre> <ul> <li>-B\uff1a\u663e\u793a\u6a21\u5f0f\u5339\u914d\u884c\u7684\u524d\u51e0\u884c</li> </ul> <p>\u67e5\u627e /etc/passwd \u6587\u4ef6\u4e2d\u4ee5 bin \u5f00\u5934\u7684\u524d\u4e00\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -B1 \"^bin\" /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\n</code></pre> <ul> <li>-C\uff1a\u663e\u793a\u6a21\u5f0f\u5339\u914d\u7684\u524d\u540e\u5404\u51e0\u884c</li> </ul> <p>\u67e5\u627e /etc/passwd \u6587\u4ef6\u4e2d\u4ee5 ftp \u5f00\u5934\u7684\u524d\u540e\u5404 2 \u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -C2 \"^ftp\" /etc/passwd     \noperator:x:11:0:operator:/root:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\nftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\nnobody:x:99:99:Nobody:/:/sbin/nologin\nsystemd-network:x:192:192:systemd Network Management:/:/sbin/nologin\n</code></pre> <ul> <li>-i\uff1a\u5ffd\u7565\u5927\u5c0f\u5199\u5339\u914d</li> </ul> <p>\u5339\u914d /etc/passwd \u5305\u542b\"Nobody\"\u7684\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -i \"Nobody\" /etc/passwd\nnobody:x:99:99:Nobody:/:/sbin/nologin\nnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin\n</code></pre> <ul> <li>-o \uff1a\u53ea\u663e\u793a\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32</li> </ul> <p>\u5339\u914d\u51fa /etc/passwd \u6587\u4ef6\u4e2d\u5b57\u7b26\u4e32\u957f\u5ea6\u6700\u5c11 10 \u4f4d\u7684\u5b57\u7b26 \uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -o \"[[:alnum:]]\\{10,\\}\" /etc/passwd\nManagement\nKubernetes\n</code></pre> <ul> <li>-n\uff1a\u8f93\u51fa\u5339\u914d\u5230\u7684\u884c\u7684\u884c\u53f7</li> </ul> <p>\u5339\u914d\u51fa /etc/passwd \u6587\u4ef6\u4e2d\u5305\u542b root \u7684\u5b57\u7b26\u4e32\u7684\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -n \"root\" /etc/passwd\n1:root:x:0:0:root:/root:/bin/bash\n10:operator:x:11:0:operator:/root:/sbin/nologin\n</code></pre> <ul> <li>-v\uff1a\u53cd\u5411\u9009\u62e9\uff0c\u5373\u663e\u793a\u9664\u8fc7 \u5339\u914d'\u641c\u5bfb\u5b57\u7b26\u4e32' \u5185\u5bb9\u7684\u90a3\u4e00\u884c</li> </ul> <p>\u5339\u914d\u51fa /etc/passwd \u4e2d\u4e0d\u5305\u542b bash \u7684\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -v \"nologin\" /etc/passwd    \nroot:x:0:0:root:/root:/bin/bash\nsync:x:5:0:sync:/sbin:/bin/sync\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\nhalt:x:7:0:halt:/sbin:/sbin/halt\n</code></pre> <ul> <li>-c :\u8ba1\u7b97\u627e\u5230 '\u641c\u5bfb\u5b57\u7b26\u4e32' \u7684\u6b21\u6570</li> </ul> <p>\u8ba1\u7b97 /etc/passwd \u6587\u4ef6\u4e2d root \u5b57\u7b26\u4e32\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -c \"root\" /etc/passwd\n2\n</code></pre> <ul> <li>-E: \u5f00\u542f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u76f8\u5f53\u4e8e\u4f7f\u7528\u547d\u4ee4<code>egrep</code></li> </ul> <p>\u67e5\u627e /etc/passwd \u6587\u4ef6\u4e2d\u5305\u542b\u4e09\u4f4d\u6570\u5b57\u7684\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -E \"[[:digit:]]{3}\" /etc/passwd\ngames:x:12:100:games:/usr/games:/sbin/nologin\nsystemd-network:x:192:192:systemd Network Management:/:/sbin/nologin\npolkitd:x:999:997:User for polkitd:/:/sbin/nologin\nceph:x:167:167:Ceph daemons:/var/lib/ceph:/sbin/nologin\nkube:x:998:996:Kubernetes user:/home/kube:/sbin/nologin\netcd:x:997:993:Etcd user:/var/lib/etcd:/bin/nologin\ngluster:x:996:992:GlusterFS daemons:/run/gluster:/sbin/nologin\nnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin\nchrony:x:995:991::/var/lib/chrony:/sbin/nologin\nredis:x:994:990:Redis Database Server:/var/lib/redis:/sbin/nologin\n</code></pre>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#3-\u5b9e\u4f8b","title":"3 \u5b9e\u4f8b","text":""},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#31-\u9700\u6c42","title":"3.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u83b7\u53d6Linux\u7cfb\u7edf\u7684\u670d\u52a1\u4fe1\u606f\uff0c\u5c06\u7ed3\u679c\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#32-\u601d\u8def","title":"3.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u51fd\u6570\u6765\u7f16\u5199\u83b7\u53d6Linux\u670d\u52a1\u76f8\u5173\u4fe1\u606f\uff0c\u6700\u540e\u5229\u7528\u91cd\u5b9a\u5411\u5c06\u4fe1\u606f\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#33-\u5b9e\u73b0","title":"3.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# Description: service check\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: sys check\n# Date: 2020-04-11 14:00\n# Version: 1.0\n[ $(id -u) -gt 0 ] &amp;&amp; echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" &amp;&amp; exit 1\nsysversion=$(rpm -q centos-release|cut -d- -f3)\nline=\"-------------------------------------------------\"\n[ -d logs ] || mkdir logs\n\nservice_check_file=\"logs/service-`date +%Y%m%d`.txt\"\n# \u83b7\u53d6\u670d\u52a1\u4fe1\u606f\nfunction get_service_info() {\nport_listen=$(netstat -lntup|grep -v \"Active Internet\")\nkernel_config=$(sysctl -p 2&gt;/dev/null)\nif [ ${sysversion} -gt 6 ];then\nservice_config=$(systemctl list-unit-files --type=service --state=enabled|grep \"enabled\")\nrun_service=$(systemctl list-units --type=service --state=running |grep \".service\")\nelse\nservice_config=$(/sbin/chkconfig | grep -E \":on|:\u542f\u7528\" |column -t)\nrun_service=$(/sbin/service --status-all|grep -E \"running\")\nfi\ncat &lt;&lt;EOF\n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\n${service_config}\n${line}\n\u8fd0\u884c\u7684\u670d\u52a1:\n${run_service}\n${line}\n\u76d1\u542c\u7aef\u53e3:\n${port_listen}\n${line}\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\n${kernel_config}\nEOF\n}\nfunction sys_check() {\nget_service_info\n    echo ${line}\n}\n# \u6267\u884c\u4e3b\u51fd\u6570\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u4e2d\nsys_check &gt; ${sys_check_file}\n# \u6267\u884c\u6d4b\u8bd5\n[root@xuel-terraform-cvm-0 ~]# bash sys_check.sh\n[root@xuel-terraform-cvm-0 ~]# cat logs/10.0.1.15-20200329.txt\n[root@master grep]# cat logs/service-20200411.txt \n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\nauditd.service                              enabled\nautovt@.service                             enabled\nceph-mon@.service                           enabled\nceph-osd@.service                           enabled\nchronyd.service                             enabled\ncrond.service                               enabled\ndbus-org.freedesktop.NetworkManager.service enabled\ndbus-org.freedesktop.nm-dispatcher.service  enabled\ndocker.service                              enabled\netcd.service                                enabled\ngapd.service                                enabled\ngetty@.service                              enabled\nirqbalance.service                          enabled\nkdump.service                               enabled\nkubelet.service                             enabled\nmicrocode.service                           enabled\nNetworkManager-dispatcher.service           enabled\nNetworkManager.service                      enabled\npostfix.service                             enabled\nrpcbind.service                             enabled\nrsyslog.service                             enabled\nsmarteye-server-agent.service               enabled\nsshd.service                                enabled\nsystemd-readahead-collect.service           enabled\nsystemd-readahead-drop.service              enabled\nsystemd-readahead-replay.service            enabled\ntuned.service                               enabled\n-------------------------------------------------\n\u8fd0\u884c\u7684\u670d\u52a1:\nauditd.service                loaded active running Security Auditing Service\nceph-mon@master.service       loaded active running Ceph cluster monitor daemon\nceph-osd@0.service            loaded active running Ceph object storage daemon\nchronyd.service               loaded active running NTP client/server\ncrond.service                 loaded active running Command Scheduler\ndbus.service                  loaded active running D-Bus System Message Bus\ndocker.service                loaded active running Docker Application Container Engine\netcd.service                  loaded active running etcd docker wrapper\ngapd.service                  loaded active running guest agent for pitrix\ngetty@tty1.service            loaded active running Getty on tty1\ngssproxy.service              loaded active running GSSAPI Proxy Daemon\nirqbalance.service            loaded active running irqbalance daemon\nkubelet.service               loaded active running Kubernetes Kubelet Server\nNetworkManager.service        loaded active running Network Manager\npolkit.service                loaded active running Authorization Manager\npostfix.service               loaded active running Postfix Mail Transport Agent\nrpcbind.service               loaded active running RPC bind service\nrsyslog.service               loaded active running System Logging Service\nsmarteye-server-agent.service loaded active running The Smarteye Monitoring of server\nsshd.service                  loaded active running OpenSSH server daemon\nsystemd-journald.service      loaded active running Journal Service\nsystemd-logind.service        loaded active running Login Service\nsystemd-udevd.service         loaded active running udev Kernel Device Manager\ntuned.service                 loaded active running Dynamic System Tuning Daemon\n-------------------------------------------------\n\u76d1\u542c\u7aef\u53e3:\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    tcp        0      0 127.0.0.1:9099          0.0.0.0:*               LISTEN      10444/calico-node   tcp        0      0 172.16.60.2:2379        0.0.0.0:*               LISTEN      1321/etcd            tcp6       0      0 :::9353                 :::*                    LISTEN      2058/node-cache     udp        0      0 0.0.0.0:37811           0.0.0.0:*                           610/dhclient        udp        0      0 169.254.25.10:53        0.0.0.0:*                           2058/node-cache     udp        0      0 0.0.0.0:68              0.0.0.0:*                           610/dhclient        udp        0      0 0.0.0.0:111             0.0.0.0:*                           1/systemd           udp        0      0 0.0.0.0:123             0.0.0.0:*                           530/chronyd         udp        0      0 127.0.0.1:323           0.0.0.0:*                           530/chronyd         udp        0      0 0.0.0.0:703             0.0.0.0:*                           535/rpcbind         udp6       0      0 :::35267                :::*                                610/dhclient        udp6       0      0 :::111                  :::*                                1/systemd           udp6       0      0 ::1:323                 :::*                                530/chronyd         udp6       0      0 :::703                  :::*                                535/rpcbind         -------------------------------------------------\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_local_reserved_ports = 30000-32767\nnet.bridge.bridge-nf-call-arptables = 1\n-------------------------------------------------\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5229\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\u6765\u83b7\u53d6\u7cfb\u7edf\u7684\u4fe1\u606f\uff0c\u4e3b\u51fd\u6570\u5c06\u8f93\u51fa\u5229\u7528\u91cd\u5b9a\u5411\u65b9\u5f0f\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#4-\u6ce8\u610f\u4e8b\u9879","title":"4 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>grep\u5bf9\u4e8e\u6587\u4ef6\u641c\u7d22\u6548\u7387\u975e\u5e38\u9ad8\uff0c\u5176\u4e0d\u4f1a\u5bf9\u6e90\u6587\u4ef6\u4f5c\u51fa\u4fee\u6539\uff1b</li> <li>\u9ed8\u8ba4Linux\u7cfb\u7edfgrep\u53ef\u4ee5\u4f7f\u7528\u53c2\u6570-E\uff0c-F\u6765\u4f7f\u7528egrep/fgrep\uff1b</li> <li>\u5bf9\u4e8e\u590d\u6742\u7684\u6761\u4ef6\u53ef\u4ee5\u5229\u7528grep\u914d\u5408\u7ba1\u9053\u591a\u5339\u914d\u6765\u8fbe\u5230\u76ee\u7684\u3002</li> </ul>"},{"location":"Linux/shell/12.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#5-\u5c0f\u7ed3","title":"5 \u5c0f\u7ed3","text":"<p>grep\u547d\u4ee4\u662fLinux\u7cfb\u7edf\u975e\u5e38\u5f3a\u5927\u7684\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u53ef\u4ee5\u914d\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u53ca\u5176\u4e30\u5bcc\u7684\u9009\u9879\u6765\u7075\u6d3b\u5904\u7406\uff0c\u540c\u65f6\u5bf9\u4e8e\u590d\u6742\u7684\u6587\u4ef6\u641c\u7d22\uff0c\u53ef\u4ee5\u914d\u5408\u7ba1\u9053\u591a\u6b21\u5339\u914d\u6765\u8fbe\u5230\u641c\u7d22\u7684\u76ee\u7684\uff0c\u7279\u6b8a\u60c5\u51b5\u4e0b\u53ef\u4ee5\u5229\u7528\u9009\u9879-E\uff0c\u5f00\u542f\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u63d0\u4f9b\u5f3a\u5927\u7684\u6a21\u5f0f\u5339\u914d\u5904\u7406\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/","title":"13.Shell\u4e09\u5251\u5ba2\u4e4bsed","text":""},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#1-sed\u6982\u8ff0","title":"1 Sed\u6982\u8ff0","text":""},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#11-sed\u662f\u4ec0\u4e48","title":"1.1 Sed\u662f\u4ec0\u4e48","text":"<p>Sed\u5168\u540d\u4e3aStream EDitor\uff0c\u987e\u540d\u601d\u4e49\u662f\u5bf9\u6570\u636e\u6d41\u8fdb\u884c\u7f16\u8f91\u64cd\u4f5c\u7684\u4e00\u4e2a\u547d\u4ee4\uff0c\u5b83\u80fd\u591f\u904d\u5386\u6587\u4ef6\u6216\u6587\u4ef6\u6d41\uff0c\u5bf9\u8bfb\u5165\u7684\u8f93\u5165\u6d41\u53ef\u4ee5\u5c06\u5176\u5148\u5b58\u50a8\u5728\u6a21\u5f0f\u7a7a\u95f4\u4e2d\uff0c\u5e76\u5c06\u884c\u53f7\u8bb0\u5f55\u5728\u5185\u5b58\u4e2d\uff0c\u5229\u7528\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u4e00\u7cfb\u5217\u6307\u5b9a\u547d\u4ee4\u5bf9\u5176\u8fdb\u884c\u64cd\u4f5c\uff0c\u5f85\u64cd\u4f5c\u5b8c\u6210\u540e\u4ece\u6a21\u5f0f\u7a7a\u95f4\u8f93\u51fa\u5230stdout\uff0c\u7c7b\u4f3c\u4e8e\u5728\u4e00\u4e2a\u7ba1\u9053\u5728\u5176\u4e2d\u5bf9\u6570\u636e\u8fdb\u884c\u52a0\u5de5\uff0c\u5b8c\u6210\u540e\u4ece\u53e6\u4e00\u5934\u8f93\u51fa\uff0c\u63a5\u7740\u8bfb\u53d6\u4e0b\u4e00\u884c\uff0c\u91cd\u590d\u5f80\u8fd4\uff0c\u76f4\u81f3\u5c06\u6240\u6709\u6807\u51c6\u8f93\u5165\u8bfb\u53d6\u5904\u7406\u5b8c\u6210\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#12-\u4e3a\u4ec0\u4e48\u7528sed","title":"1.2 \u4e3a\u4ec0\u4e48\u7528Sed","text":"<p>Sed\u76f8\u8f83\u4e8egrep/awk\uff0c\u5176\u4e3b\u8981\u529f\u80fd\u4e3a\u5bf9\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\u5904\u7406\uff0c\u53ef\u4ee5\u5bf9\u6587\u4ef6\u6216\u6807\u51c6\u8f93\u5165\u6570\u636e\u6d41\u8fdb\u884c\u589e\u5220\u6539\u67e5\u7b49\u64cd\u4f5c\uff0c\u5c24\u5176\u9002\u7528\u4e8e\u5927\u6587\u4ef6\u6216\u6709\u89c4\u5f8b\u7684\u6587\u4ef6\uff0c\u5229\u7528\u6b64\u5de5\u5177\uff0c\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u5feb\u6377\u7684\u5728\u7f16\u5199Shell\u811a\u672c\u4e2d\u5f97\u5fc3\u5e94\u624b\u7684\u5bf9\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#2-sed\u7684\u9002\u7528\u573a\u666f","title":"2 Sed\u7684\u9002\u7528\u573a\u666f","text":"<ul> <li> <p>\u8d85\u5927\u6587\u4ef6\u5904\u7406\uff1b</p> </li> <li> <p>\u6709\u89c4\u5f8b\u7684\u6587\u672c\uff0c\u4f8b\u5982\u683c\u5f0f\u5316\u540e\u7684\u65e5\u5fd7\u6587\u4ef6\u7b49\uff1b</p> </li> <li>\u5bf9\u6587\u4ef6\u8fdb\u884c\u6279\u91cf\u589e\u52a0\uff0c\u66ff\u6362\u7b49\u3002</li> </ul>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#3-sed\u7684\u5904\u7406\u6a21\u5f0f","title":"3 Sed\u7684\u5904\u7406\u6a21\u5f0f","text":"<p>Sed\u5bf9\u8f93\u5165\u7684\u4e00\u884c\u6570\u636e\u8fdb\u884c\u5904\u7406\u7684\u6a21\u5f0f\uff0c\u5bf9\u6574\u4e2a\u6587\u4ef6\u8fdb\u884c\u91cd\u590d\u6267\u884c\u6b64\u6a21\u5f0f\u5904\u7406\uff0c\u5728\u6b64\u8bf4\u660e\u5bf9\u8f93\u5165\u7684\u4e00\u884c\u6570\u636e\u5904\u7406\u7684\u5185\u5728\u673a\u5236\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ol> <li> <p>\u9996\u5148\u8bfb\u5165\u6587\u4ef6\u6d41\u7684\u4e00\u884c\u5230\u6a21\u5f0f\u7a7a\u95f4\uff1b</p> </li> <li> <p>\u5728\u6a21\u5f0f\u7a7a\u95f4\u5185\uff0c\u5bf9\u5185\u5bb9\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u5904\u7406\uff1b</p> </li> <li> <p>\u8f93\u51fa\u5904\u7406\u540e\u7684\u6570\u636e\u5185\u5bb9\uff1b</p> </li> <li> <p>\u6e05\u7a7a\u5f53\u524d\u6a21\u5f0f\u7a7a\u95f4\uff1b</p> </li> <li> <p>\u8bfb\u53d6\u7b2c\u4e8c\u884c\u8f93\u5165\u6d41\u5230\u6a21\u5f0f\u7a7a\u95f4\uff1b</p> </li> <li>\u53c8\u5f00\u59cb\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u5185\u7684\u4e0b\u4e00\u884c\u8f93\u5165\u6570\u636e\u8fdb\u884c\u5904\u7406\u3002</li> </ol>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#4-\u8bed\u6cd5\u8be6\u89e3","title":"4 \u8bed\u6cd5\u8be6\u89e3","text":"<p>sed\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <pre><code>sed [option] 'address command' [file \u2026]\n</code></pre> <p>sed\u7684\u8bed\u6cd5\u683c\u5f0f\u4e3b\u8981\u5206\u4e3a\u56db\u4e2a\u5b57\u6bb5\uff0coptions\u9009\u9879\uff0c\u5f15\u53f7\u5185\u6709\u5730\u5740\u5b9a\u754c/\u547d\u4ee4\uff0c\u4ee5\u53ca\u8981\u5904\u7406\u7684\u6587\u4ef6\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u8be6\u7ec6\u8bb2\u89e3\u6bcf\u4e00\u4e2a\u8bed\u6cd5\u5b57\u6bb5\uff0c\u66f4\u5168\u9762\u7684\u8ba4\u8bc6sed\u8fd9\u4e2a\u811a\u672c\u5229\u5668\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#41-options","title":"4.1 options\uff1a","text":"<p>\u9009\u9879\u4e3a\u53ef\u9009\uff0c\u5229\u7528\u5b83\u6765\u4e3ased\u6307\u5b9a\u4e00\u4e9b\u5904\u7406\u65b9\u5f0f\uff0c\u4e3b\u8981\u7684\u6709\u5982\u4e0b\uff1a</p> <ul> <li>-n:\u9759\u9ed8\u6a21\u5f0f\uff0c\u6211\u4eec\u77e5\u9053sed\u9ed8\u8ba4\u5904\u7406\u5b8c\u6a21\u5f0f\u7a7a\u95f4\u540e\u5c06\u5185\u5bb9\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u5229\u7528\u8fd9\u4e2a\u8fd9\u4e2a\u53c2\u6570\u4ec5\u663e\u793ascript\u5904\u7406\u540e\u7684\u7ed3\u679c\uff0c\u4e0d\u518d\u9ed8\u8ba4\u663e\u793a\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a\u6253\u5370/etc/passwd\u7684\u5730\u4e09\u884c</li> </ul> <pre><code>[root@shell workspace]# sed -n '3p' /etc/passwd\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n</code></pre> <p>\u5728\u6b64\u76f4\u63a5\u6307\u5b9a\u5730\u5740\u5b9a\u754c3\uff0c\u7136\u540ecommand\u4e3ap\u6253\u5370\u8f93\u51fa\uff0c\u7531\u4e8e\u4e0d\u60f3\u8f93\u51fa/etc/passwd\u7684\u5168\u90e8\u5185\u5bb9\uff0c\u56e0\u6b64\u6dfb\u52a0\u4e86-n\u9009\u9879\u3002</p> <pre><code>* -e:&lt;script&gt;\u6216--expression=&lt;script&gt; \u4ee5\u9009\u9879\u4e2d\u6307\u5b9a\u7684script\u6765\u5904\u7406\u8f93\u5165\u7684\u6587\u672c\u6587\u4ef6\uff0c\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u591a\u4e2a\u811a\u672c\uff1b\n* -f:\u5bf9\u5236\u5b9a\u7684\u6587\u4ef6\u76f4\u63a5\u8fdb\u884csed\u7684command\u64cd\u4f5c\uff1b\n* -i:\u76f4\u63a5\u4fee\u6539\u539f\u6587\u4ef6\uff0c\u6211\u4eec\u90fd\u77e5\u9053sed\u9ed8\u8ba4\u4e0d\u5bf9\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\uff0c\u53ea\u662f\u8bfb\u5165\u4e00\u884c\u5230\u6a21\u5f0f\u7a7a\u95f4\u4e2d\uff0c\u5904\u7406\u5b8c\u6210\u540e\u8f93\u51fa\uff0c\u6b64\u53c2\u6570\u4e3a\u4e5f\u76f4\u63a5\u4fee\u6539\u4e86\u6e90\u6587\u4ef6\uff1b\n* -r:\u652f\u6301\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u9ed8\u8ba4\u7684\u57fa\u7840\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u7c7b\u6bd4grep\u547d\u4ee4\u7684egrep\uff0c\u66f4\u52a0\u5feb\u6377\u7b80\u6d01\u7684\u4f7f\u7528\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u56e0\u4e3a\u6709\u4e9b\u5143\u5b57\u7b26\u4e0d\u7528\u518d\u4f7f\u7528\u53cd\u659c\u7ebf\"\\\\\"\u4e86\u3002\n</code></pre>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#42-address","title":"4.2 address:","text":"<p>\u5730\u5740\u5b9a\u754c\u7528\u6765\u6307\u5b9a\u8bfb\u5165\u6587\u4ef6\u7684\u8fb9\u754c\u6216\u6b65\u957f\u3002</p> <ul> <li><code>startline\uff0cendline</code>\uff1a\u6307\u5b9a\u8bfb\u5165\u6587\u4ef6\u7684\u5f00\u59cb\u884c\u4e8e\u7ed3\u675f\u884c\u53f7\u3002</li> <li><code>/regexp/</code>:\u5229\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u5230\u7684\u884c\u8fdb\u884c\u5904\u7406\uff0c\u4f8b\u5982\uff1a\u6253\u5370/etc/passwd\u4ece\u4ee5root\u5f00\u59cb\u5230sync\u7ed3\u675f\u7684\u5185\u5bb9</li> </ul> <pre><code>[root@shell workspace]# sed -n '/^root/,/^sync/p' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\n</code></pre> <p>\u5728\u6b64\u5229\u7528\u4e86\u5339\u914d\u5143\u5b57\u7b26<code>^</code>\u7528\u6765\u5339\u914d\u884c\u9996\uff0c\u6b64\u5185\u5bb9\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u5df2\u7ecf\u8fdb\u884c\u4e86\u8be6\u7ec6\u89e3\u91ca\u3002</p> <ul> <li><code>/pattern1/,/pattern2/</code>:\u7b2c\u4e00\u6b21\u88abpattern1\u5339\u914d\u5230\u7684\u884c\u5f00\u59cb\uff0c\u76f4\u5230\u88abpattern2\u5339\u914d\u5230\u7684\u884c\u7ed3\u675f\uff0c\u4f8b\u5982\uff1a\u6253\u5370/etc/passwd\u7684\u7b2c\u56db\u884c\u5230\u7b2c\u4e03\u884c\u7684\u5185\u5bb9</li> </ul> <pre><code>[root@shell workspace]# sed -n '3,7p' /etc/passwd\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\n</code></pre> <ul> <li><code>linenuber</code>:\u76f4\u63a5\u6307\u5b9a\u884c\u53f7\uff0c\u9700\u8981\u5904\u7406\u54ea\u4e00\u884c\u3002</li> <li><code>startline\uff0c+n</code>:\u4ece\u90a3\u4e00\u884c\u5f00\u59cb\uff0c\u5f80\u540en\u884c\u7ed3\u675f\uff0c\u4f8b\u5982\uff1a\u6253\u5370/etc/passwd\u7684\u4ece\u7b2c\u4e09\u884c\u5f00\u59cb\u5f80\u540e\u76842\u884c\u7684\u5185\u5bb9</li> </ul> <pre><code>[root@shell workspace]# sed -n \"3,+2p\" /etc/passwd\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n</code></pre> <ul> <li><code>startline~step</code>:\u6307\u5b9a\u6b65\u957f\uff0c\u6bcf\u9694step\u6b65\u8fdb\u884c\u5904\u7406\uff0c\u5e38\u7528\u5728\u5947\u5076\u6570\u5904\u7406\uff0c\u4f8b\u5982\uff1a\u6253\u5370\u5947\u6570\u884c</li> </ul> <pre><code>seq 10 |sed -n '1~2p'\n</code></pre> <p>seq\u6765\u8f93\u51fa\u4ee5\u6570\u5b57\u4e3a\u5185\u5bb9\u768410\u884c\uff0c\u7136\u540e\u5229\u7528<code>~2</code>\u4f5c\u4e3a\u6b65\u957f\u6253\u5370\u8f93\u51fa\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#43-command","title":"4.3 command\uff1a","text":"<p>\u5177\u4f53\u5bf9\u6307\u5b9a\u7684\u6587\u4ef6\u8fdb\u884c\u600e\u6837\u7684\u5904\u7406\uff0c\u4f8b\u5982\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u5185\u7684\u5185\u5bb9\u8fdb\u884c\u589e\u5220\u6539\u67e5\u5177\u4f53\u7684\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#431-\u589e","title":"4.3.1 \u589e","text":"<ul> <li>i\uff1ainsert\uff0c\u5728\u5236\u5b9a\u6216\u5339\u914d\u5230\u7684\u884c\u524d\u9762\u6dfb\u52a0\u65b0\u884c\u5185\u5bb9\u4e3astring\uff0c<code>i\\string</code>\uff0c \u4e3a/etc/passwd \u4e2d\u7684\u7b2c\u4e00\u884c\u524d\u9762\u6dfb\u52a0\u4e00\u884c\u5185\u5bb9\u4e3a\"####\"\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@shell workspace]# sed '1i####' /etc/passwd\n####\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n.....\n</code></pre> <ul> <li>a\uff1aappend\uff0c\u5728\u6307\u5b9a\u6216\u5339\u914d\u5230\u7684\u884c\u540e\u9762\u8ffd\u52a0\u65b0\u884c\uff0c\u5185\u5bb9\u4e3astring\uff0c<code>a\\string</code>\u3002 \u4e3a/etc/passwd\u7684\u7b2c\u4e00\u884c\u540e\u9762\u6dfb\u52a0\u5185\u5bb9\"aaa\"\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@shell workspace]# sed '1a###' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\n###\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\n</code></pre>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#432-\u5220","title":"4.3.2 \u5220","text":"<ul> <li>d\uff1adelete\uff0c\u5220\u9664\u7b26\u5408\u5730\u5740\u5b9a\u754c\u6761\u4ef6\u7684\u7684\u884c</li> </ul> <p>\u5220\u9664/etc/inittab\u6587\u4ef6\u4e2d\u6ce8\u91ca\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>sed '/^#/d' /etc/inittab\n</code></pre> <p>\u76f4\u63a5\u5229\u7528\u5143\u5b57\u7b26\u5339\u914d\u94c6\u5b9a\u4ee5<code>#</code>\u5f00\u5934\u7684\u884c\u8fdb\u884c\u5220\u9664\u64cd\u4f5c\uff0c\u6ce8\u610f\u6b64\u5904\u6ca1\u6709\u76f4\u63a5\u4fee\u6539\u6587\u4ef6\uff0c\u5982\u679c\u6dfb\u52a0<code>-i</code>\u9009\u9879\uff0c\u5219\u76f4\u63a5\u5bf9\u6e90\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\uff0c\u4e00\u822c\u9700\u8981\u5148\u5907\u4efd\uff0c\u7136\u540e\u64cd\u4f5c\u4ee5\u514d\u8bef\u64cd\u4f5c\u539f\u59cb\u6587\u4ef6\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#433-\u6539","title":"4.3.3 \u6539","text":"<ul> <li>s\uff1a<code>s/pattern/string/\u4fee\u9970\u7b26</code>: \u67e5\u627e\u5e76\u66ff\u6362\uff0c\u9ed8\u8ba4\u53ea\u66ff\u6362\u6bcf\u884c\u4e2d\u7b2c\u4e00\u6b21\u88ab\u6a21\u5f0f\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32 \uff0c\u5982\u679c\u4fee\u9970\u7b26\u4e3ag,\u5219\u4e3a\u5168\u90e8\u66ff\u6362\u3002 \u66ff\u6362/etc/passwd\u4e2d\u7684root\u4e3a\u5927\u5199\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@shell workspace]# sed 's/root/ROOT/g' /etc/passwd\nROOT:x:0:0:ROOT:/ROOT:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n...\n</code></pre> <p>\u66ff\u6362/etc/inittab\u6587\u4ef6\u4e2d\"id:3:initdefault:\"\u4e00\u884c\u4e2d\u7684\u6570\u5b57\u4e3a5\uff0c\u4f8b\u5982\uff1a</p> <pre><code>sed 's/id:[0-9]/id:5/g' /etc/inittab\n</code></pre> <p>\u5728\u6b64\u5229\u7528\u5143\u5b57\u7b26\u5339\u914d[0-9]\u7684\u4e00\u4e2a\u6570\u5b57\u8fdb\u884c\u66ff\u6362\u4e3a<code>id:5</code>\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#434-\u67e5","title":"4.3.4 \u67e5","text":"<ul> <li>p\uff1aprint\uff0c\u9ed8\u8ba4sed\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u5185\u7684\u5904\u7406\u5b8c\u6bd5\u540e\uff0c\u5c06\u8f93\u51fa\u7684\u7ed3\u679c\u8f93\u51fa\u5728\u6807\u51c6\u8f93\u51fa\uff0c\u6dfb\u52a0p\u547d\u4ee4\uff0c\u76f8\u5f53\u4e8e\u8f93\u51fa\u4e86\u539f\u6587\uff0c\u53c8\u4e00\u6b21\u8f93\u51fa\u4e86\u6a21\u5f0f\u5339\u914d\u5904\u7406\u540e\u7684\u5185\u5bb9\u3002</li> </ul> <p>\u6253\u5370/etc/passwd\u7684\u7b2c\u4e09\u884c\uff0c\u6307\u5b9a\u884c\u53f7\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@shell workspace]# sed -n '3p' /etc/passwd\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n</code></pre> <p>\u5728\u6b64\u76f4\u63a5\u6307\u5b9a\u5730\u5740\u5b9a\u754c3\uff0c\u7136\u540ecommand\u4e3ap\u6253\u5370\u8f93\u51fa\uff0c\u7531\u4e8e\u4e0d\u60f3\u8f93\u51fa/etc/passwd\u7684\u5168\u90e8\u5185\u5bb9\uff0c\u56e0\u6b64\u6dfb\u52a0\u4e86-n\u9009\u9879\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#5-\u5b9e\u4f8b","title":"5 \u5b9e\u4f8b","text":""},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#51-\u9700\u6c42","title":"5.1 \u9700\u6c42","text":"<p>\u76ee\u524d\u817e\u8baf\u4e91\u670d\u52a1\u5668Ubuntu\u7248\u672c\u7528\u6237\u4e3aubuntu\u7528\u6237\uff0c\u73b0\u53c81000\u53f0\u670d\u52a1\u5668\u9700\u8981\u53bb\u5f00\u542froot\u8fdc\u7a0b\u767b\u5f55\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#52-\u601d\u8def","title":"5.2 \u601d\u8def","text":"<p>\u5f00\u542fubuntu\u670d\u52a1\u5668\u7684\u8fdc\u7a0b\u767b\u5f55\u5373\u4fee\u6539\u5176\u7684/etc/ssh/sshd_config \u6587\u4ef6\u7684prohibit-password\u4e3ayes\u5373\u53ef\uff0c\u91cd\u542fsshd\u670d\u52a1\u5373\u53ef\uff0c\u5229\u7528\u811a\u672c\u903b\u8f91\u5904\u7406\u3002</p>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#53-\u5b9e\u73b0","title":"5.3 \u5b9e\u73b0","text":"<p>\u6838\u5fc3\u5229\u7528sed\u4ee3\u7801\uff1a</p> <pre><code>if [ ${ostype} == 'Ubuntu' ];then\nsed -i 's/prohibit-password/yes/g' /etc/ssh/sshd_config\n    # \u91cd\u542fssh\u670d\u52a1\nservice sshd restart\n    [ $? -eq 0] &amp;&amp; echo \"${OSTYPE} sshd \u5f00\u542f\u6210\u529f\" &gt;&gt;${LOG_FILE}\nfi\n</code></pre>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#6-\u6ce8\u610f\u4e8b\u9879","title":"6 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>sed\u4e2d\u5229\u7528\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u914d\u5408\u53ef\u4ee5\u5f97\u52301+1\u5927\u4e8e\u4e8c\u7684\u6548\u679c\uff0c\u914d\u5408\u4f7f\u7528\u529f\u80fd\u66f4\u52a0\u4e30\u5bcc\u5f3a\u5927\uff1b</li> <li>sed\u5e38\u7528\u4e8e\u4fee\u6539\u6587\u4ef6\uff0c\u5982\u679c\u4e3a\u67e5\u8be2\u6587\u4ef6\u53ef\u4ee5\u5229\u7528grep\uff0c\u56e0\u4e3agrep\u68c0\u7d22\u6587\u4ef6\u6548\u7387\u6700\u9ad8\uff0c\u5982\u679c\u4e3a\u683c\u5f0f\u5316\u8f93\u51fa\u5efa\u8bae\u4f7f\u7528awk\uff1b</li> <li>sed\u5728\u4fee\u6539\u6587\u4ef6\u7684\u65f6\u5019\u5c3d\u53ef\u80fd\u5148\u4e0d\u8981\u6dfb\u52a0<code>-i</code> options\uff0c\u4ee5\u514d\u5c06\u6e90\u59cb\u6587\u4ef6\u4fee\u6539\u5f02\u5e38\u96be\u4ee5\u6062\u590d\u3002</li> </ul>"},{"location":"Linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#7-\u5c0f\u7ed3","title":"7 \u5c0f\u7ed3","text":"<p>sed\u7684\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff0c\u5b83\u662f\u6211\u4eecshell\u7f16\u7a0b\u4e2d\u5bf9\u6587\u4ef6\u4fee\u6539\u4e0d\u53ef\u6216\u7f3a\u7684\u5229\u5668\uff0c\u914d\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u5e38\u7528\u6765\u6279\u91cf\u4fee\u6539\u5927\u6587\u4ef6\uff0c\u6216\u6709\u4e00\u5b9a\u683c\u5f0f\u89c4\u5f8b\u7684\u6587\u4ef6\uff0c\u5176\u8fd8\u6709\u5f88\u591a\u9ad8\u7ea7\u529f\u80fd\u3002\u5982\u679c\u5b66\u6709\u4f59\u529b\u5efa\u8bae\u53bbman\u624b\u518c\u8be6\u7ec6\u5b66\u4e60\u67e5\u770b\uff0c\u5728\u5229\u7528sed\u5de5\u5177\u7684\u65f6\u5019\u9700\u8981\u65f6\u523b\u8111\u6d77\u4e2d\u7262\u8bb0\u6c42\u8bed\u6cd5\u683c\u5f0f\uff0c\u4e07\u53d8\u4e0d\u79bb\u5176\u5b97\uff0c\u9075\u5faa\u8bed\u6cd5\u4e3e\u4e00\u53cd\u4e09\u80fd\u591f\u8fbe\u5230\u5b66\u751f\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\u3002</p>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/","title":"14.Shell\u4e09\u5251\u5ba2\u4e4bawk","text":""},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#1-awk\u6982\u8ff0","title":"1 awk\u6982\u8ff0","text":""},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#11-awk\u662f\u4ec0\u4e48","title":"1.1 awk\u662f\u4ec0\u4e48","text":"<p>awk\u4e0d\u540c\u4e8egrep\u7684\u6587\u672c\u641c\u7d22\u4e0esed\u5de5\u5177\u7684\u6587\u672c\u5904\u7406\uff0c\u5b83\u66f4\u504f\u5411\u4e8e\u5bf9\u6587\u672c\u7684\u683c\u5f0f\u5316\u5904\u7406\u8f93\u51fa\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u662f\u4e00\u5757\u5de5\u5177\uff0c\u4e5f\u662f\u4e00\u95e8\u89e3\u91ca\u5f62\u8bed\u8a00\uff0c\u5176\u540d\u5b57\u6765\u6e90\u4e8e\u5b83\u7684\u4e09\u4f4d\u4f5c\u8005\u7684\u59d3\u6c0f\uff1aAlfred Aho\uff0c Peter Weinberger \u548c Brian Kernighan\uff0c\u5728\u6587\u672c\u5904\u7406\u9886\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff0c\u662f\u4e00\u6b3eLinux\u670d\u52a1\u5668\u6587\u672c\u62a5\u544a\u751f\u6210\u5668\u548c\u683c\u5f0f\u5316\u6587\u672c\u8f93\u51fa\u5de5\u5177\u3002</p>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#12-\u4e3a\u4ec0\u4e48\u7528awk","title":"1.2 \u4e3a\u4ec0\u4e48\u7528awk","text":"<p>\u6211\u4eec\u65e5\u5e38\u5de5\u4f5c\u4e2d\u6709\u5f88\u591a\u9700\u8981\u683c\u5f0f\u5316\u6253\u5370\u8f93\u51fa\u7684\u9700\u6c42\uff0c\u66f4\u591a\u7684\u662f\u5173\u6ce8\u5217\u64cd\u4f5c\u65f6\u5c31\u53ef\u4ee5\u5229\u7528awk\u5de5\u5177\u6765\u8fdb\u884c\u5904\u7406\u3002awk\u9664\u4e86\u662f\u5de5\u5177\u4e5f\u540c\u6837\u662f\u4e00\u95e8\u8bed\u8a00\uff0c\u5176\u5141\u8bb8\u7528\u6237\u521b\u5efa\u7b80\u77ed\u7684\u7a0b\u5e8f\u6765\u5904\u7406\u81ea\u5df1\u7684\u9700\u6c42\uff0c\u8fd9\u4e9b\u7a0b\u5e8f\u8bfb\u53d6\u8f93\u5165\u6587\u4ef6\u3001\u4e3a\u6570\u636e\u6392\u5e8f\u3001\u5904\u7406\u6570\u636e\u3001\u5bf9\u8f93\u5165\u6267\u884c\u8ba1\u7b97\u4ee5\u53ca\u751f\u6210\u62a5\u8868\u7b49\u3002\u529f\u80fd\u975e\u5e38\u7684\u5f3a\u5927\uff0c\u76f8\u4fe1\u5728\u638c\u63e1\u4e86awk\uff0c\u65e5\u5e38\u8fd0\u7ef4\u5de5\u4f5c\u66f4\u52a0\u65b9\u4fbf\u9ad8\u6548\u7b80\u5355\u3002</p>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#2-awk\u7684\u9002\u7528\u573a\u666f","title":"2 awk\u7684\u9002\u7528\u573a\u666f","text":"<ul> <li>\u8d85\u5927\u6587\u4ef6\u5904\u7406\uff1b</li> <li>\u8f93\u51fa\u683c\u5f0f\u5316\u7684\u6587\u672c\u62a5\u8868\uff1b</li> <li>\u6267\u884c\u7b97\u6570\u8fd0\u7b97\uff1b</li> <li>\u6267\u884c\u5b57\u7b26\u4e32\u64cd\u4f5c\u7b49\u3002</li> </ul>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#3-awk\u7684\u5904\u7406\u6a21\u5f0f","title":"3 awk\u7684\u5904\u7406\u6a21\u5f0f","text":"<p>\u4e00\u822c\u662f\u904d\u5386\u4e00\u4e2a\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u884c\uff0c\u7136\u540e\u5206\u522b\u5bf9\u6587\u4ef6\u7684\u6bcf\u4e00\u884c\u8fdb\u884c\u5904\u7406\u3002</p> <p>awk\u5bf9\u8f93\u5165\u7684\u4e00\u884c\u6570\u636e\u8fdb\u884c\u5904\u7406\u7684\u6a21\u5f0f\uff0c\u5bf9\u6574\u4e2a\u6587\u4ef6\u8fdb\u884c\u91cd\u590d\u6267\u884c\u6b64\u6a21\u5f0f\u5904\u7406\uff0c\u5728\u6b64\u8bf4\u660e\u5bf9\u8f93\u5165\u7684\u4e00\u884c\u6570\u636e\u5904\u7406\u7684\u5185\u5728\u673a\u5236\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5904\u7406\u8fc7\u7a0b\u4e0d\u65ad\u91cd\u590d\uff0c\u76f4\u5230\u5230\u8fbe\u6587\u4ef6\u7ed3\u5c3e\u3002</p> <ol> <li>\u9996\u5148\u8bfb\u5165\u6587\u4ef6\u6d41\u7684\u4e00\u884c\u5230\u6a21\u5f0f\u7a7a\u95f4\uff1b</li> <li>\u5728\u6a21\u5f0f\u7a7a\u95f4\u5185\uff0c\u5bf9\u5185\u5bb9\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u5904\u7406\uff1b</li> <li>\u7136\u540e\u8f93\u51fa\u5904\u7406\u540e\u7684\u6570\u636e\u5185\u5bb9\uff1b</li> <li>\u6e05\u7a7a\u5f53\u524d\u6a21\u5f0f\u7a7a\u95f4\uff1b</li> <li>\u8bfb\u53d6\u7b2c\u4e8c\u884c\u8f93\u5165\u6d41\u5230\u6a21\u5f0f\u7a7a\u95f4\uff1b</li> <li>\u53c8\u5f00\u59cb\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u5185\u7684\u7b2c\u4e8c\u884c\u8f93\u5165\u6570\u636e\u8fdb\u884c\u5904\u7406\u3002</li> </ol> <p>\u603b\u4f53\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u4e09\u90e8\uff1a</p> <ul> <li> <p>\u8bfb( Read )\uff1aAWK \u4ece\u8f93\u5165\u6d41\uff08\u6587\u4ef6\u3001\u7ba1\u9053\u6216\u8005\u6807\u51c6\u8f93\u5165\uff09\u4e2d\u8bfb\u5165\u4e00\u884c\u7136\u540e\u5c06\u5176\u5b58\u5165\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p>\u6267\u884c(Execute)\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u884c\u8f93\u5165\uff0c\u6240\u6709\u7684 AWK \u547d\u4ee4\u6309\u987a\u6267\u884c\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAWK \u547d\u4ee4\u662f\u9488\u5bf9\u4e8e\u6bcf\u4e00\u884c\u8f93\u5165\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u9650\u5236\u5728\u6307\u5b9a\u7684\u6a21\u5f0f\u4e2d\u3002</p> </li> <li>\u91cd\u590d\uff08Repeate\uff09\uff1a\u4e00\u76f4\u91cd\u590d\u4e0a\u8ff0\u4e24\u4e2a\u8fc7\u7a0b\u76f4\u5230\u6587\u4ef6\u7ed3\u675f\u3002</li> </ul>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#4-\u8bed\u6cd5\u53ca\u7ed3\u6784","title":"4 \u8bed\u6cd5\u53ca\u7ed3\u6784","text":""},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#41-\u8bed\u6cd5","title":"4.1 \u8bed\u6cd5","text":"<p>Awk\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <pre><code>awk [options] 'PATTERN {action}' file1,file2\n</code></pre> <p>awk\u7684\u8bed\u6cd5\u683c\u5f0f\u4e3b\u8981\u5206\u4e3a\u56db\u4e2a\u5b57\u6bb5\uff0coptions\u9009\u9879\uff0c\u5f15\u53f7\u5185\u6709\u6a21\u5757\u4e0e\u52a8\u4f5c\uff0c\u4ee5\u53ca\u8981\u5904\u7406\u7684\u6587\u4ef6\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u8be6\u7ec6\u8bb2\u89e3\u6bcf\u4e00\u4e2a\u8bed\u6cd5\u5b57\u6bb5\uff0c\u66f4\u5168\u9762\u7684\u8ba4\u8bc6awk\u8fd9\u4e2a\u811a\u672c\u5229\u5668\u3002</p>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#42-\u7a0b\u5e8f\u7ed3\u6784","title":"4.2 \u7a0b\u5e8f\u7ed3\u6784","text":"<p>awk\u5728\u5f15\u53f7\u5185\u6709\u4e00\u5b9a\u7684\u7a0b\u5e8f\u7ed3\u6784\uff0c\u4e3b\u8981\u4e3a\u4ee5\u4e0b\uff1a</p> <ul> <li>\u5f00\u59cb\u5757\uff08BEGIN BLOCK\uff09\uff1a</li> </ul> <pre><code>\u8bed\u6cd5\uff1a\nBEGIN{awk-commands}\n\u5f00\u59cb\u5757\u5c31\u662fawk\u7a0b\u5e8f\u542f\u52a8\u65f6\u6267\u884c\u7684\u4ee3\u7801\u90e8\u5206\uff08\u5728\u5904\u7406\u8f93\u5165\u6d41\u4e4b\u524d\u6267\u884c\uff09\uff0c\u5e76\u4e14\u5728\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u53ea\u6267\u884c\u4e00\u6b21\uff1b\n\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5728\u5f00\u59cb\u5757\u4e2d\u521d\u59cb\u5316\u4e00\u4e9b\u53d8\u91cf\u3002BEGIN\u662fawk\u7684\u5173\u952e\u5b57\uff0c\u56e0\u6b64\u5fc5\u987b\u8981\u5927\u5199\u3002\u3010\u6ce8\uff1a\u5f00\u59cb\u5757\u90e8\u5206\u662f\u53ef\u9009\uff0c\u5373\u4f60\u7684awk\u7a0b\u5e8f\u53ef\u4ee5\u6ca1\u6709\u5f00\u59cb\u5757\u90e8\u5206\u3011\n</code></pre> <ul> <li>\u4e3b\u4f53\u5757\uff08Body Block\uff09\uff1a</li> </ul> <pre><code>\u8bed\u6cd5\uff1a\n/pattern/{awk-commands}\n\u9488\u5bf9\u6bcf\u4e00\u4e2a\u8f93\u5165\u7684\u884c\u90fd\u4f1a\u6267\u884c\u4e00\u6b21\u4e3b\u4f53\u90e8\u5206\u7684\u547d\u4ee4\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4e8e\u8f93\u5165\u7684\u6bcf\u4e00\u884c\uff0cawk\u90fd\u4f1a\u6267\u884c\u4e3b\u4f53\u90e8\u5206\u7684\u547d\u4ee4\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528/pattern/\u9650\u5236\u5176\u5728\u6307\u5b9a\u6a21\u5f0f\u4e0b\u3002\n</code></pre> <ul> <li>\u7ed3\u675f\u5757\uff08END BLOCK\uff09\uff1a</li> </ul> <pre><code>\u8bed\u6cd5\uff1a\nEND{awk-commands}\n\u7ed3\u675f\u5757\u662fawk\u7a0b\u5e8f\u7ed3\u675f\u65f6\u6267\u884c\u7684\u4ee3\u7801\uff08\u5728\u5904\u7406\u5b8c\u8f93\u5165\u6d41\u4e4b\u540e\u6267\u884c\uff09\uff0cEND\u4e5f\u662fawk\u7684\u5173\u952e\u5b57\uff0c\u5fc5\u987b\u5927\u5199\uff0c\u4e0e\u5f00\u59cb\u5757\u7c7b\u4f3c\uff0c\u7ed3\u675f\u5757\u4e5f\u662f\u53ef\u9009\u7684\u3002\n</code></pre>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#43-awk\u547d\u4ee4\u8be6\u89e3","title":"4.3 awk\u547d\u4ee4\u8be6\u89e3","text":""},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#431-awk-\u8f93\u51fa","title":"4.3.1 awk \u8f93\u51fa","text":"<ul> <li>awk print\u8f93\u51fa\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>print item1,item2...\n</code></pre> <p>1.\u5404\u5b57\u6bb5\u4e4b\u95f4\u9017\u53f7\u9694\u5f00\uff0c\u8f93\u51fa\u65f6\u4ee5\u7a7a\u767d\u5b57\u7b26\u5206\u5272\uff1b</p> <p>2.\u8f93\u51fa\u7684\u5b57\u6bb5\u53ef\u4ee5\u4e3a\u5b57\u7b26\u4e32\u6216\u6570\u503c\uff0c\u5f53\u524d\u8bb0\u5f55\u7684\u5b57\u6bb5\uff08\u5982$1\uff09\u3001\u53d8\u91cf\u6216awk\u7684\u8868\u8fbe\u5f0f\uff1b\u6570\u503c\u5148\u4f1a\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u7136\u540e\u8f93\u51fa;</p> <p>3.print\u547d\u4ee4\u540e\u9762\u7684item\u53ef\u4ee5\u7701\u7565\uff0c\u6b64\u65f6\u5176\u529f\u80fd\u76f8\u5f53\u4e8e<code>print $0</code>,\u5982\u679c\u60f3\u8f93\u51fa\u7a7a\u767d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>print \"\"</code>;</p> <p>\u4f8b\u5982\uff1a</p> <p><pre><code>[root@master ~]# awk -F: '{print $1,$NF}' /etc/passwd|column -t\nroot             /bin/bash\nbin              /sbin/nologin\ndaemon           /sbin/nologin\nadm              /sbin/nologin\nlp               /sbin/nologin\nsync             /bin/sync\n</code></pre> * awk printf\u8f93\u51fa</p> <p>printf\u547d\u4ee4\u7684\u4f7f\u7528\u683c\u5f0f\uff1a</p> <pre><code>printf &lt;format&gt; item1,item2...\n</code></pre> <p>\u8981\u70b9\uff1a</p> <p>1.\u5176\u4e0eprint\u547d\u4ee4\u6700\u5927\u533a\u522b,printf \u9700\u8981\u6307\u5b9aformat,format\u5fc5\u987b\u7ed9\u51fa\uff1b</p> <p>2.format\u7528\u4e8e\u6307\u5b9a\u540e\u9762\u7684\u6bcf\u4e2aitem\u8f93\u51fa\u683c\u5f0f\uff1b</p> <p>3.printf \u8bed\u53e5\u4e0d\u4f1a\u81ea\u52a8\u6253\u5370\u6362\u884c\u5b57\u7b26<code>\\n</code>\u3002</p> <p>format\u683c\u5f0f\u7684\u6307\u793a\u7b26\u90fd\u4ee5%\u5f00\u5934\uff0c\u540e\u8ddf\u4e00\u4e2a\u5b57\u7b26:</p> <pre><code>%c:\u663e\u793aascall\u7801\n%d:%i:\u5341\u8fdb\u5236\u6574\u6570\n%e\uff0c%E\uff1a\u79d1\u5b66\u8ba1\u6570\u6cd5\n%f:\u6d6e\u70b9\u6570\n%s\uff1a\u5b57\u7b26\u4e32\n%u\uff1a\u65e0\u7b26\u53f7\u6574\u6570\n%%\uff1a\u663e\u793a%\u81ea\u8eab\n\n\u4fee\u9970\u7b26\uff1a\n#[.#]:\u7b2c\u4e00\u4e2a#\u63a7\u5236\u663e\u793a\u7684\u5bbd\u5ea6\uff1a\u7b2c\u4e8c\u4e2a#\u8868\u793a\u5c0f\u6570\u70b9\u540e\u7684\u7cbe\u5ea6\uff1a\n%3.1f\n\n-:\u5de6\u5bf9\u9f50\n+\uff1a\u663e\u793a\u6570\u7ec4\u7b26\u53f7\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# awk -F: '{printf \"Username:%-15s   ,Uid:%d\\n\",$1,$3}' /etc/passwd\nUsername:root              ,Uid:0\nUsername:bin               ,Uid:1\nUsername:daemon            ,Uid:2\nUsername:adm               ,Uid:3\nUsername:lp                ,Uid:4\nUsername:sync              ,Uid:5\nUsername:shutdown          ,Uid:6\n</code></pre>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#432-awk\u53d8\u91cf","title":"4.3.2 awk\u53d8\u91cf","text":"<ul> <li> <p>awk\u5185\u7f6e\u53d8\u91cf\u4e4b\u8bb0\u5f55\u53d8\u91cf\uff1a</p> <ul> <li>IFS:input field separator\uff0c\u8f93\u5165\u5b57\u6bb5\u5206\u9694\u7b26\uff08\u9ed8\u8ba4\u7a7a\u767d\uff09</li> <li>OFS:output field separator\uff0c\u8f93\u51fa\u5b57\u6bb5\u5206\u9694\u7b26</li> <li> <p>RS:Record separator:\u8f93\u5165\u6587\u672c\u6362\u884c\u7b26\uff08\u9ed8\u8ba4\u56de\u8f66\uff09</p> </li> <li> <p>ORS:\u8f93\u51fa\u6587\u672c\u6362\u884c\u7b26</p> </li> </ul> </li> <li> <p>awk\u5185\u7f6e\u53d8\u91cf\u4e4b\u6570\u636e\u53d8\u91cf</p> <ul> <li>NR:the number of input records,awk\u547d\u4ee4\u6240\u5904\u7406\u7684\u6587\u4ef6\u7684\u884c\u6570\uff0c\u5982\u679c\u6709\u591a\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6570\u76ee\u4f1a\u5c06\u5904\u7406\u7684\u591a\u4e2a\u6587\u4ef6\u8ba1\u6570</li> <li>NF:number of field,\u5f53\u524d\u8bb0\u5f55\u7684field\u4e2a\u6570</li> </ul> <pre><code>{print NF},{print $NF}\n</code></pre> <ul> <li> <p>ARGV:\u6570\u7ec4\uff0c\u4fdd\u5b58\u547d\u4ee4\u884c\u672c\u8eab\u8fd9\u4e2a\u5b57\u7b26\u4e32</p> </li> <li> <p>ARGC\uff1aawk\u547d\u4ee4\u7684\u53c2\u6570\u4e2a\u6570</p> </li> <li> <p>FILENAME:awk\u547d\u4ee4\u5904\u7406\u7684\u6587\u4ef6\u540d\u79f0</p> </li> <li> <p>ENVIRON\uff1a\u5f53\u524dshell\u73af\u5883\u53d8\u91cf\u53ca\u5176\u503c\u7684\u5173\u8054\u6570\u7ec4 <pre><code>awk 'BEGIN{print ENVIRON[\"PATH\"]}'\n</code></pre></p> </li> </ul> </li> <li> <p>\u81ea\u5b9a\u4e49\u53d8\u91cf     <code>-v var=value</code></p> <p>\u53d8\u91cf\u540d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]#  awk -v test=\"abc\" 'BEGIN{print test}'\nabc\n[root@master ~]# awk 'BEGIN{var=\"name\";print var}'\nname\n</code></pre> </li> <li> <p>\u7b97\u672f\u8fd0\u7b97</p> <ul> <li>+,-,*,/,^,%\u3002\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk 'BEGIN{a=5;b=3;print \"a + b =\",a+b}'\na + b = 8\n</code></pre> </li> <li> <p>\u5b57\u7b26\u4e32\u64cd\u4f5c</p> <ul> <li>\u65e0\u7b26\u53f7\u64cd\u4f5c\u7b26\uff0c\u8868\u793a\u5b57\u7b26\u4e32\u8fde\u63a5\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk 'BEGIN { str1=\"Hello,\"; str2=\"World\"; str3 = str1 str2; print str3 }'\nHello,World\n</code></pre> </li> <li> <p>\u8d4b\u503c\u64cd\u4f5c\u7b26\uff1a</p> <ul> <li>=\uff0c+=\uff0c-=\uff0c*=\uff0c/=\uff0c%=\uff0c^=\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk 'BEGIN{a=5;b=6;if(a == b) print \"a == b\";else print \"a!=b\"}' \na!=b\n\n[root@master ~]# awk -F: '{sum+=$3}END{print sum}' /etc/passwd\n72349\n</code></pre> </li> <li> <p>\u6bd4\u8f83\u64cd\u4f5c\u7b26\uff1a</p> <ul> <li>&gt;,&gt;=,&lt;,&lt;=,!=,==</li> </ul> </li> <li> <p>\u6a21\u5f0f\u5339\u914d\u7b26\uff1a</p> <ul> <li>~:\u662f\u5426\u5339\u914d</li> <li>!~:\u662f\u5426\u4e0d\u5339\u914d</li> </ul> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# awk -F: '$1~\"root\"{print $0}' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\n</code></pre> </li> <li> <p>\u903b\u8f91\u64cd\u4f5c\u7b26\uff1a</p> <ul> <li>&amp;&amp; \u3001 || \u3001 \uff01\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk 'BEGIN{a=6;if(a &gt; 0 &amp;&amp; a &lt;= 6) print \"true\";else print \"false\"}'\ntrue\n</code></pre> </li> <li> <p>\u51fd\u6570\u8c03\u7528\uff1a</p> <ul> <li>function_name(argu1,augu2)</li> </ul> </li> <li> <p>\u6761\u4ef6\u8868\u8fbe\u5f0f(\u4e09\u5143\u8fd0\u7b97):</p> <ul> <li>selection\uff1fif-true-expresssion\uff1aif-false-expression</li> </ul> <pre><code>[root@master ~]# awk -F: '{$3&gt;=100?usertype=\"common user\":usertype=\"sysadmin\";printf \"%15s:%s\\n\",$1,usertype}' /etc/passwd\nroot:sysadmin\n            bin:sysadmin\n         daemon:sysadmin\n            adm:sysadmin\n             lp:sysadmin\n           sync:sysadmin\n       shutdown:sysadmin\n           halt:sysadmin\n</code></pre> </li> </ul>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#433-\u64cd\u4f5c\u7b26","title":"4.3.3 \u64cd\u4f5c\u7b26","text":""},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#434-pattern","title":"4.3.4 Pattern","text":"<ul> <li>empty:\u7a7a\u6a21\u5f0f\uff0c\u5339\u914d\u6bcf\u4e00\u884c</li> <li> <p>/regular expression/:\u4ec5\u5904\u7406\u80fd\u88ab\u6b64\u5904\u6a21\u5f0f\u5339\u914d\u5230\u7684\u884c\uff0c\u4f8b\u5982\uff1b <pre><code>[root@master ~]# awk -F: '$NF==\"/bin/bash\"{printf \"%15s,%s\\n\",$NF,$1}' /etc/passwd\n/bin/bash,root\n</code></pre></p> </li> <li> <p>relational expression\uff1a\u5173\u7cfb\u8868\u8fbe\u5f0f\uff0c\u7ed3\u679c\u4e3a\u201c\u771f\u201d\u6709\u201c\u5047\u201d\uff0c\u7ed3\u679c\u4e3a\u201c\u771f\u201d\u624d\u4f1a\u88ab\u5904\u7406\u3002</p> </li> </ul> <p>Tips\uff1a\u4f7f\u7528\u6a21\u5f0f\u9700\u8981\u4f7f\u7528\u53cc\u659c\u7ebf\u62ec\u8d77\u6765\uff0c\u771f\uff1a\u7ed3\u679c\u4e3a\u975e0\u503c\uff0c\u975e\u7a7a\u5b57\u7b26\u4e32\u3002</p> <pre><code>[root@master ~]# awk -F: '$3&gt;100{print $1,$3}' /etc/passwd\nsystemd-network 192\npolkitd 999\nceph 167\nkube 998\netcd 997\ngluster 996\nnfsnobody 65534\nchrony 995\nredis 994\n</code></pre> <p><pre><code>awk -F: '$NF==\"/bin/bash\"{printf \"%15s,%s\\n\",$NF,$1}' /etc/passwd\n</code></pre> <pre><code>awk -F: '$NF~/bash$/{printf \"%15s,%s\\n\",$NF,$1}' /etc/passwd\n</code></pre> <pre><code>df -Th|awk '/^\\/dev/{print}'\n</code></pre></p> <ul> <li> <p>line ranges\uff1a\u884c\u8303\u56f4\uff0c\u5236\u5b9astartline\uff0cendline\u3002</p> <pre><code>[root@master ~]# awk -F: '/10/,/20/{print $1}' /etc/passwd\ngames\nftp\nnobody\nsystemd-network\ndbus\npolkitd\npostfix\nsshd\nceph\nkube\netcd\ngluster\nrpc\n</code></pre> </li> <li> <p>BEGIN/END\u6a21\u5f0f</p> <ul> <li>BEGIN{}\uff1a\u4ec5\u5728\u5f00\u59cb\u5904\u7406\u6587\u672c\u4e4b\u524d\u6267\u884c\u4e00\u6b21</li> <li>END{}\uff1a\u4ec5\u5728\u6587\u672c\u5904\u7406\u5b8c\u6210\u4e4b\u540e\u6267\u884c\u4e00\u6b21</li> </ul> </li> </ul> <pre><code>    [root@master ~]# awk -F: 'BEGIN{print \"username     uid\\n--------------------\"}{printf \"%-15s:%d\\n\",$1,$3}END{print \"-----------------\\nend\"}' /etc/passwd\nusername     uid\n    --------------------\n    root           :0\n    bin            :1\n    daemon         :2\n    adm            :3\n    lp             :4\n    rpc            :32\n    rpcuser        :29\n    nfsnobody      :65534\n    chrony         :995\n    redis          :994\n    -----------------\n    end\n</code></pre>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#435-\u63a7\u5236\u8bed\u53e5","title":"4.3.5 \u63a7\u5236\u8bed\u53e5","text":"<ul> <li>if(condition) {statements}\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk -F: '{if($3&gt;100) print $1,$3}' /etc/passwd\nsystemd-network 192\npolkitd 999\nceph 167\nkube 998\netcd 997\ngluster 996\nnfsnobody 65534\nchrony 995\nredis 994\n</code></pre> <ul> <li>if(condition) {statments} [else {statments}]\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk -F: '{if($3&gt;100) {printf \"Common user:%-15s\\n\",$1} else {printf \"sysadmin user:%-15s\\n\",$1}}' /etc/passwd\nsysadmin user:root           sysadmin user:bin            sysadmin user:daemon         sysadmin user:adm            sysadmin user:lp             sysadmin user:sync           sysadmin user:shutdown       sysadmin user:halt           sysadmin user:mail           sysadmin user:operator       sysadmin user:games          </code></pre>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#5-\u5b9e\u4f8b","title":"5 \u5b9e\u4f8b","text":"<pre><code>1.\u7edf\u8ba1/etc/fstab\u6587\u4ef6\u4e2d\u6bcf\u4e2a\u5355\u8bcd\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5e76\u6309\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\nawk '{for(i=1;i&lt;=NF;i++){words[$i]++}}END{for(key in words)print key,words[key]}' /etc/fstab|sort -k2 -nr\n\nawk '{ips[$1]++}END{for(i in ips) print i,ips[i]}' access_nginx.log |column -t|sort -k2 -nr\n\n2.\u7edf\u8ba1/etc/fstab\u6bcf\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b\u51fa\u73b0\u7684\u6b21\u6570\nawk '!/^#/&amp;&amp;!/^$/{dev[$3]++}END{for(i in dev) print i,dev[i]}' /etc/fstab\n\n3.ping\u4e00\u4e2a\u57df\u540d\uff0c\u8f93\u51faping\u6b64\u523b\u7684\u65f6\u95f4\nping baidu.com|awk '{print $0\" \"strftime(\"%Y-%m-%d %H:%M:%S\")}'\n4.\u5229\u7528netstat\u76d1\u63a7\u670d\u52a1\u662f\u5426\u6b63\u5e38\u76d1\u542c\nnetstat -lntup|awk 'NR&gt;2{if($4 ~/.*:22/) print $0\"yes\";exit 0}'\n5.\u7edf\u8ba1web\u670d\u52a1\u5668\u65e5\u5fd7\u72b6\u6001\u7801\nawk '$9~\"[0-9]\"{stat[$9]++}END{for(i in stat) print i,stat[i]}' access_log\n</code></pre>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#6-\u6ce8\u610f\u4e8b\u9879","title":"6 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li> <p><code>awk</code>\u540c<code>sed</code>\u547d\u4ee4\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7<code>sed</code>\u64c5\u957f\u53d6\u884c\uff0c<code>awk</code>\u547d\u4ee4\u64c5\u957f\u53d6\u5217\uff0cawk\u662f\u5bf9\u6587\u672c\u8fdb\u884c\u683c\u5f0f\u5316\u8f93\u51fa\uff0csed\u66f4\u503e\u5411\u4e8e\u5bf9\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u8bfb\u5165\u7684\u6587\u4ef6\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u9700\u6c42\u5bf9IFS/OFS\u5bf9\u8f93\u5165\u548c\u8f93\u51fa\u8fdb\u884c\u4fee\u6539\u3002</p> </li> <li> <p>awk\u975e\u5e38\u7684\u5f3a\u5927\uff0c\u4f46\u662f\u4e5f\u662f\u4e09\u5251\u5ba2\u4e2d\u6700\u96be\u7684\u4e00\u4e2a\uff0c\u5176\u4f5c\u4e3a\u4e00\u95e8\u5355\u72ec\u7684\u8bed\u8a00\uff0c\u6211\u4eec\u5728Shell\u7f16\u7a0b\u4e2d\u5b66\u4e60\u5e38\u7528\u7684\u547d\u4ee4\u53ca\u8bed\u6cd5\u5c31\u5df2\u7ecf\u8db3\u591f\u6211\u4eec\u4f7f\u7528\u3002</p> </li> </ul>"},{"location":"Linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#7-\u5c0f\u7ed3","title":"7 \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u8282\u6211\u4eec\u7cfb\u7edf\u6027\u7684\u5b66\u4e60\u4e86awk\u7684\u8bed\u6cd5\u7ed3\u6784\u53ca\u5904\u7406\u6a21\u5f0f\uff0c\u5176\u76f8\u8f83\u4e8e\u5176\u4ed6\u6587\u672c\u5904\u7406\u5de5\u5177\uff0c\u66f4\u9002\u5408\u5bf9\u6587\u672c\u8fdb\u884c\u683c\u5f0f\u5316\u8f93\u51fa\uff0c\u6211\u4eec\u9700\u8981\u5728\u5408\u9002\u7684\u5730\u65b9\u4f7f\u7528\uff0c\u5176\u4f5c\u4e3aLinux\u7cfb\u7edf\u4e0a\u4e00\u4e2a\u975e\u5e38\u5f3a\u5927\u7684\u6587\u672c\u683c\u5f0f\u8f93\u51fa\u5de5\u5177\uff0c\u4e5f\u662f\u4e00\u95e8\u8bed\u8a00\uff0c\u540e\u671f\u9700\u8981\u5728\u5b9e\u8df5\u5de5\u4f5c\u4e2d\u66f4\u591a\u7684\u7075\u6d3b\u8fd0\u7528\uff0c\u4f7f\u5f97\u811a\u672c\u7f16\u5199\u66f4\u52a0\u65b9\u4fbf\u3002</p>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/","title":"15.Shell\u5e38\u7528\u5de5\u5177","text":"<p>Linux\u4e2d\u6709\u5f88\u591a\u975e\u5e38\u5b9e\u7528\u7684\u5de5\u5177\u6216\u547d\u4ee4\uff0c\u7075\u6d3b\u8fd0\u7528\u8fd9\u4e9b\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5728Shell\u7f16\u7a0b\u4e2d\u5316\u7e41\u4e3a\u7b80\uff0c\u5982\u864e\u6dfb\u7ffc\u3002\u53ef\u80fd\u4e00\u4e2a\u5de5\u5177\u6216\u547d\u4ee4\u5c31\u80fd\u8ba9\u539f\u672c\u8d1f\u8d23\u7684\u95ee\u9898\u5feb\u901f\u89e3\u51b3\uff0c\u672c\u7ae0\u8282\u6211\u4eec\u6765\u4e00\u8d77\u4e30\u5bcc\u6211\u4eec\u7684\u5de5\u5177\u5e93\uff0c\u65e5\u5e38\u53ef\u4ee5\u591a\u79ef\u7d2f\u603b\u7ed3\uff0c\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u7f16\u5199Shell\u3002</p>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#1-sort","title":"1. sort","text":"<p>\u7b80\u4ecb\uff1a\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u7528\u6765\u6392\u5e8f\u7684\u5de5\u5177\uff0c\u5728\u6211\u4eec\u65e5\u5e38\u5de5\u4f5c\u4e2d\u5bf9\u4e8e\u91cd\u590d\u5217\u7684\u591a\u884c\u8f93\u51fa\uff0c\u5982\u679c\u60f3\u8981\u5bf9\u5185\u5bb9\u6309\u7167\u7279\u5b9a\u89c4\u5219\u6392\u5e8f\uff0c\u6b64\u65f6\u5c31\u7528\u5230\u4e86sort\u5de5\u5177\u3002</p> <p>\u539f\u7406\uff1asort \u5c06\u6587\u4ef6\u7684\u6bcf\u4e00\u884c\u4f5c\u4e3a\u4e00\u4e2a\u5355\u4f4d\uff0c\u76f8\u4e92\u6bd4\u8f83\uff0c\u6bd4\u8f83\u539f\u5219\u9ed8\u8ba4\u60c5\u51b5\u662f\u4ece\u9996\u5b57\u7b26\u5411\u540e\uff0c\u4f9d\u6b21\u6309 ASCII \u7801\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c \u540e\u5c06\u4ed6\u4eec\u6309\u5347\u5e8f\u8f93\u51fa\u3002</p> <p>\u8bed\u6cd5\uff1a<code>sort [OPTION]... [FILE]\u2026</code></p> <p>\u9009\u9879\u8bf4\u660e\uff1a</p> <ul> <li>-t\uff1a\u6307\u5b9a\u4ee5\u4ec0\u4e48\u4f5c\u4e3a\u5217\u5206\u5272</li> <li>-k\uff1a\u7528\u6765\u5236\u5b9a\u5229\u7528\u90a3\u5217\u8fdb\u884c\u6392\u5e8f\uff0c\u901a\u5e38<code>-t</code>\u4e8e<code>-k</code>\u914d\u5408\u4f7f\u7528</li> <li>-r\uff1a\u5c06\u6587\u672c\u6587\u4ef6\u964d\u5e8f\u8f93\u51fa</li> <li>-n\uff1a\u4ee5\u6570\u7ec4\u6765\u8fdb\u884c\u751f\u5e8f\u6392\u5e8f</li> <li>-f\uff1a\u5ffd\u7565\u5927\u5c0f\u5199\u5b57\u6bcd</li> <li>-u\uff1a\u53d6\u6d88\u91cd\u590d\u7684\u884c</li> </ul> <p>\u5728\u6b64\u6211\u4eec\u4e0d\u5168\u90e8\u5c55\u5f00\u8d77\u6240\u6709\u9009\u9879\uff0c\u53ea\u6839\u636e\u65e5\u5e38\u7ecf\u9a8c\u7ed3\u5408\u5b9e\u9645\u6848\u4f8b\u5217\u4e3e\u6700\u5e38\u7528\u7684\u9009\u9879\u8fdb\u884c\u8bf4\u660e\u3002</p> <p>\u5b9e\u4f8b\uff1a</p> <ul> <li>\u5bf9/etc/passwd\u4e2d\u4ee5uid\u4ece\u5927\u5230\u5c0f\u6392\u5e8f</li> </ul> <pre><code>[root@10-234-1-235 ~]# sort -t: -k3 -n -r /etc/passwd\nsaslauth:x:499:76:Saslauthd user:/var/empty/saslauth:/sbin/nologin\ngitlab-www:x:498:497::/var/opt/gitlab/nginx:/bin/false\ngit:x:497:496::/var/opt/gitlab:/bin/sh\ngitlab-redis:x:496:495::/var/opt/gitlab/redis:/bin/false\ngitlab-psql:x:495:494::/var/opt/gitlab/postgresql:/bin/sh\ngitlab-prometheus:x:494:493::/var/opt/gitlab/prometheus:/bin/sh\nmongod:x:493:492:mongod:/var/lib/mongo:/bin/false\nnobody:x:99:99:Nobody:/:/sbin/nologin\npostfix:x:89:89::/var/spool/postfix:/sbin/nologin\ndbus:x:81:81:System message bus:/:/sbin/nologin\nsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin\nvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin\napache:x:48:48:Apache:/var/www:/sbin/nologin\nftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\ngopher:x:13:30:gopher:/var/gopher:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\nuucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin\nmail:x:8:12:mail:/var/spool/mail:/sbin/nologin\nhalt:x:7:0:halt:/sbin:/sbin/halt\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\nsync:x:5:0:sync:/sbin:/bin/sync\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nbin:x:1:1:bin:/bin:/sbin/nologin\nroot:x:0:0:root:/root:/bin/bash\n</code></pre> <p>\u901a\u8fc7\u4e0a\u4f8b\u53ef\u4ee5\u770b\u5230\uff0c\u5229\u7528<code>-t</code>\u9009\u9879\u6307\u5b9a/etc/passwd\u6587\u4ef6\u4e2d\uff0c\u4ee5<code>:</code>\u4f5c\u4e3a\u5217\u8fdb\u884c\u5206\u5272\uff0c\u6307\u5b9auid\u7684\u5217\u4e3a<code>k3</code>\uff0c-n\u4ee5\u6570\u5b57\u8fdb\u884c\u6392\u5e8f\uff0c<code>-r</code>\u4e3a\u5012\u5e8f\u6392\u5e8f\u8f93\u51fa\u3002</p>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#2-uniq","title":"2. uniq","text":"<p>\u7b80\u4ecb\uff1a\u5bf9\u4e8e\u4e00\u4e9b\u91cd\u590d\u8f93\u51fa\u7684\u884c\u8fdb\u884c\u53bb\u91cd\u3002</p> <p>\u8bed\u6cd5\uff1a<code>uniq [OPTION]... [INPUT [OUTPUT]]</code></p> <p>\u9009\u9879\u8bf4\u660e\uff1a</p> <ul> <li> <p>-c\uff1a \u6253\u5370\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u53ea\u80fd\u7edf\u8ba1\u76f8\u90bb\u7684\u3002</p> </li> <li> <p>-d\uff1a \u53ea\u6253\u5370\u91cd\u590d\u884c\u3002</p> </li> <li> <p>-u\uff1a \u53ea\u6253\u5370\u4e0d\u91cd\u590d\u884c\u3002</p> </li> <li> <p>-D\uff1a \u53ea\u6253\u5370\u91cd\u590d\u884c\uff0c\u5e76\u4e14\u628a\u6240\u6709\u91cd\u590d\u884c\u6253\u5370\u51fa\u6765\u3002</p> </li> </ul> <p>\u5b9e\u4f8b\uff1a</p> <ul> <li>\u5bf9/etc/passwd\u4e2d\u4ee5<code>:</code>\uff0c\u5bf9\u6700\u540e\u4e00\u5217\u6c42\u51fa\u73b0\u7684\u6b21\u6570</li> </ul> <pre><code>[root@master ~]# awk -F\":\" '{print $NF}' /etc/passwd\n/bin/bash\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/bin/sync\n/sbin/shutdown\n/sbin/halt\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/bin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n[root@master ~]# awk -F\":\" '{print $NF}' /etc/passwd |sort |uniq -c |sort -nr\n22 /sbin/nologin\n      1 /sbin/shutdown\n      1 /sbin/halt\n      1 /bin/sync\n      1 /bin/nologin\n      1 /bin/bash\n</code></pre> <p>\u5148\u5229\u7528awk\u6253\u5370\u51fa\u6700\u540e\u4e00\u5217\u5185\u5bb9\uff0c\u4e4b\u540e\u5229\u7528sort \u6765\u8fdb\u884c\u6392\u5e8f\uff0c\u5c06\u76f8\u540c\u7684\u5b57\u7b26\u89c4\u5728\u4e00\u8d77\u8f93\u51fa\uff0c\u6700\u540e\u5bf9\u76f8\u540c\u7684\u884c\u8fdb\u884c\u53bb\u91cd\uff0c\u5f97\u51fa\u6bcf\u79cd\u4e0d\u540c\u7c7b\u578bshell\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u6700\u540e\u5bf9\u6570\u5b66\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002</p>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#3-find","title":"3. find","text":"<p>\u7b80\u4ecb\uff1a\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u7528\u6765\u5728\u7cfb\u7edf\u4e2d\u67e5\u627e\u6587\u4ef6\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u57fa\u7840\u8d77\u59cb\u76ee\u5f55\uff0c\u6839\u636e\u4e0d\u540c\u7684\u9009\u9879\u67e5\u627e\u4e0d\u540c\u7684\u6587\u4ef6\u3002</p> <p>\u8bed\u6cd5\uff1a<code>find   path   -option   [   -print ]   [ -exec   -ok   command ]   {} \\;</code></p> <p>\u539f\u7406\uff1afind \u6839\u636eoption\u5728\u6307\u5b9a\u7684\u7cfb\u7edf\u8def\u5f84\u4e2d\u67e5\u627e\u6587\u4ef6\uff0c\u5982\u679c\u67e5\u627e\u5230\u4e0e\u5bf9\u5e94\u7684exec\u547d\u4ee4\uff0c\u5219\u6267\u884c\u5bf9\u5e94\u7684command\u3002</p> <p>-print\uff1a find \u547d\u4ee4\u5c06\u5339\u914d\u7684\u6587\u4ef6\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\uff1b -exec\uff1a find \u547d\u4ee4\u5bf9\u5339\u914d\u7684\u6587\u4ef6\u6267\u884c\u8be5\u53c2\u6570\u6240\u7ed9\u51fa\u7684 shell \u547d\u4ee4\u3002\u76f8\u5e94\u547d\u4ee4\u7684\u5f62\u5f0f\u4e3a 'command' {} \\;\uff0c\u6ce8\u610f {} \u548c \\\uff1b\u4e4b\u95f4\u7684\u7a7a\u683c\uff1b -ok\uff1a \u548c - exec \u7684\u4f5c\u7528\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u4ee5\u4e00\u79cd\u66f4\u4e3a\u5b89\u5168\u7684\u6a21\u5f0f\u6765\u6267\u884c\u8be5\u53c2\u6570\u6240\u7ed9\u51fa\u7684 shell \u547d\u4ee4\uff0c\u5728\u6267\u884c\u6bcf\u4e00\u4e2a\u547d\u4ee4\u4e4b\u524d\uff0c\u90fd\u4f1a\u7ed9\u51fa\u63d0\u793a\uff0c\u8ba9\u7528\u6237\u6765\u786e\u5b9a\u662f\u5426\u6267\u884c\uff1b</p> <p>\u9009\u9879\u8bf4\u660e\uff1a</p> <pre><code>- -name   filename               #\u67e5\u627e\u540d\u4e3a filename \u7684\u6587\u4ef6\n- -perm                          #\u6309\u6267\u884c\u6743\u9650\u6765\u67e5\u627e\n- -user    username              #\u6309\u6587\u4ef6\u5c5e\u4e3b\u6765\u67e5\u627e\n- -group groupname               #\u6309\u7ec4\u6765\u67e5\u627e\n- -mtime   -n +n                 #\u6309\u6587\u4ef6\u66f4\u6539\u65f6\u95f4\u6765\u67e5\u627e\u6587\u4ef6\uff0c-n \u6307 n \u5929\u4ee5\u5185\uff0c+n \u6307 n \u5929\u4ee5\u524d\n- -atime    -n +n                #\u6309\u6587\u4ef6\u8bbf\u95ee\u65f6\u95f4\u6765\u67e5 GIN: 0px\"&gt;\n- -ctime    -n +n                #\u6309\u6587\u4ef6\u521b\u5efa\u65f6\u95f4\u6765\u67e5\u627e\u6587\u4ef6\uff0c-n \u6307 n \u5929\u4ee5\u5185\uff0c+n \u6307 n \u5929\u4ee5\u524d\n- -type    b/d/c/p/l/f           #\u67e5\u662f\u5757\u8bbe\u5907\u3001\u76ee\u5f55\u3001\u5b57\u7b26\u8bbe\u5907\u3001\u7ba1\u9053\u3001\u7b26\u53f7\u94fe\u63a5\u3001\u666e\u901a\u6587\u4ef6\n- -size      n [c]               #\u67e5\u957f\u5ea6\u4e3a n \u5757 [\u6216 n \u5b57\u8282] \u7684\u6587\u4ef6\n- -depth                         #\u4f7f\u67e5\u627e\u5728\u8fdb\u5165\u5b50\u76ee\u5f55\u524d\u5148\u884c\u67e5\u627e\u5b8c\u672c\u76ee\u5f55\n- -prune\u3000\u3000                      #\u901a\u5e38\u548c -path \u4e00\u8d77\u4f7f\u7528\uff0c\u7528\u4e8e\u5c06\u7279\u5b9a\u76ee\u5f55\u6392\u9664\u5728\u641c\u7d22\u6761\u4ef6\u4e4b\u5916\u3002\u8fc7\u6ee4\u6761\u4ef6\u5199\u5728\u5176\u4ed6\u6761\u4ef6\u524d\u9762\u3002\n</code></pre> <p>\u5728\u6b64\u6211\u4eec\u5bf9\u547d\u4ee4\u652f\u6301\u7684\u9009\u9879\u5168\u90e8\u5c55\u5f00\u8be6\u89e3\uff0c\u6839\u636e\u65e5\u5e38\u7ecf\u9a8c\u7ed3\u5408\u5b9e\u9645\u6848\u4f8b\u5217\u4e3e\u6700\u5e38\u7528\u7684\u9009\u9879\u8fdb\u884c\u8bf4\u660e\uff1a</p> <p>\u5b9e\u4f8b:</p> <ul> <li>\u5728\u5f53\u524d\u76ee\u5f55\u5bfb\u627e\u6587\u4ef6\u540d\u79f0\u4ee5<code>.txt</code>\u7ed3\u5c3e\u7684\u6587\u4ef6\u5e76\u6253\u5370\u51fa\u6765</li> </ul> <pre><code>[root@master ~]# find   ~   -name   \"*.txt\"   -print \n/root/kubesphere-all-advanced-2.0.2/scripts/os/requirements.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/storages/NFS-Server/files/nfs-server-provisioner/templates/NOTES.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/ks-devops/jenkins/files/jenkins/jenkins-update-center/templates/NOTES.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/ks-devops/harbor/files/harbor/harbor/templates/NOTES.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/metrics-server/files/metrics-server/templates/NOTES.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/openpitrix/files/openpitrix/kubernetes/password.txt\n</code></pre> <ul> <li>\u67e5\u627e/usr/bin\u76ee\u5f55\u4e0b\u5927\u4e8e10M\u7684\u6587\u4ef6</li> </ul> <pre><code>[root@master ~]# find /usr/bin -size +10000k -exec ls -ld {} \\; \n-rwxr-xr-x. 1 root root 13606800 Jul 10  2018 /usr/bin/ceph-dencoder\n-rwxr-xr-x. 1 root root 15863688 Jul 10  2018 /usr/bin/ceph-objectstore-tool\n-rwxr-xr-x. 1 root root 15589080 Jul 10  2018 /usr/bin/ceph-osd\n-rwxr-xr-x. 1 root root 33073928 Feb 10  2019 /usr/bin/docker\n-rwxr-xr-x. 1 root root 38088856 Feb 10  2019 /usr/bin/docker-containerd\n-rwxr-xr-x. 1 root root 68608416 Feb 10  2019 /usr/bin/dockerd\n-rwxr-xr-x. 1 root root 20895160 Feb 10  2019 /usr/bin/docker-containerd-ctr\n-rwxr-xr-x. 1 root root 10785264 Jul 10  2018 /usr/bin/ceph-mon\n</code></pre> <ul> <li>\u67e5\u627e\u5f53\u524d\u76ee\u5f55\u4e0b\u6743\u9650\u4e3a777\u7684\u6587\u4ef6</li> </ul> <pre><code>[root@master ~]# find . -perm 777 -print   \n./.helm/repository/cache/local-index.yaml\n./kubesphere-all-v2.1.0/k8s/extra_playbooks/inventory\n./kubesphere-all-v2.1.0/k8s/extra_playbooks/roles\n./kubesphere-all-v2.1.0/k8s/contrib/terraform/openstack/hosts\n</code></pre>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#4-date","title":"4. date","text":"<p>\u5728\u6211\u4eec\u7f16\u5199Shell\u7684\u65f6\u5019\u7ecf\u5e38\u9047\u5230\u9700\u8981\u8bb0\u5f55\u65e5\u5fd7\u7684\u60c5\u51b5\uff0c\u5728\u8bb0\u5f55\u65e5\u5fd7\u7684\u65f6\u5019\u9700\u8981\u6253\u4e0a\u65f6\u95f4\u6233\uff0c\u4ee5\u4fbf\u540e\u671f\u67e5\u770b\u90a3\u4e2a\u65f6\u95f4\u8282\u70b9\u8fd0\u884c\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u7528\u5230date\u547d\u4ee4</p> <p>\u7b80\u4ecb\uff1adate \u53ef\u4ee5\u7528\u6765\u663e\u793a\u6216\u8bbe\u5b9a\u7cfb\u7edf\u7684\u65e5\u671f\u4e0e\u65f6\u95f4\u3002</p> <p>\u9009\u9879\uff1a</p> <pre><code>-d&lt;\u5b57\u7b26\u4e32&gt;\uff1a\u663e\u793a\u5b57\u7b26\u4e32\u6240\u6307\u7684\u65e5\u671f\u4e0e\u65f6\u95f4\u3002\u5b57\u7b26\u4e32\u524d\u540e\u5fc5\u987b\u52a0\u4e0a\u53cc\u5f15\u53f7\uff1b -s&lt;\u5b57\u7b26\u4e32&gt;\uff1a\u6839\u636e\u5b57\u7b26\u4e32\u6765\u8bbe\u7f6e\u65e5\u671f\u4e0e\u65f6\u95f4\u3002\u5b57\u7b26\u4e32\u524d\u540e\u5fc5\u987b\u52a0\u4e0a\u53cc\u5f15\u53f7\uff1b -u\uff1a\u663e\u793aGMT\uff1b </code></pre> <p>\u65f6\u95f4\u683c\u5f0f\uff1a</p> <pre><code>%Y -- \u5e74\u4efd\n%m -- \u6708\u4efd\n%d -- \u5f53\u6708\u7b2c\u51e0\u5929\n%t -- Tab \u8df3\u683c\n%H -- \u5c0f\u65f6\uff0c24 \u5c0f\u65f6\u683c\u5f0f (0~23)\n%I -- \u5c0f\u65f6\uff0c12 \u5c0f\u65f6\u683c\u5f0f (0~12)\n%M -- \u5206\u949f (00~59)\n%S -- \u79d2 (00~59)\n%j -- \u4eca\u5e74\u4e2d\u7684\u7b2c\u51e0\u5929\n%Z -- \u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8f93\u51fa\u5f53\u524d\u65f6\u533a\n%z -- \u4ee5\u6570\u5b57\u5f62\u5f0f\u8f93\u51fa\u5f53\u524d\u65f6\u533a\n%F --  \u6587\u4ef6\u65f6\u95f4\u683c\u5f0f same as % Y-% m-% d\n%T -- 24 \u5c0f\u65f6\u5236\u65f6\u95f4\u8868\u793a (hh:mm:ss)\n</code></pre> <ul> <li>\u5b9e\u4f8b</li> </ul> <p>\u8ba1\u7b97\u4e00\u4e2a\u547d\u4ee4\u6267\u884c\u6240\u9700\u8981\u7684\u8017\u65f6</p> <pre><code>#!/bin/bash \nstart=$(date +%s) echo \"$(date +%F\" \"%T) \u5f00\u59cb\u6267\u884c\u547d\u4ee4\"\nsleep 5\necho \"$(date +%F\" \"%T) \u6267\u884c\u547d\u4ee4\u5b8c\u6210\"\nend=$(date +%s) difference=$(( end - start )) echo \"\u6267\u884c\u547d\u4ee4\u603b\u8017\u65f6:$difference seconds.\"\n[root@master ~]# bash time.sh \n2020-04-19 10:19:58 \u5f00\u59cb\u6267\u884c\u547d\u4ee4\n2020-04-19 10:20:03 \u6267\u884c\u547d\u4ee4\u5b8c\u6210\n\u6267\u884c\u547d\u4ee4\u603b\u8017\u65f6:5 seconds.\n</code></pre>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#5-xargs","title":"5. xargs","text":"<p>\u7b80\u4ecb\uff1axargs \u5168\u79f0\u662f transform arguments\uff0c\u610f\u4e3a\u8f6c\u6362\u53c2\u6570\uff0c\u5b83\u5c06\u6807\u51c6\u8f93\u5165\u8f6c\u6362\u4e3a\u547d\u4ee4\u884c\u53c2\u6570\u3002\u56e0\u4e3a linux \u547d\u4ee4\u884c\u4e2d\u7ecf\u5e38\u8981\u4f7f\u7528\u5230\u7ba1\u9053\u7b26\u8fde\u63a5\u4e0d\u540c\u7684\u547d\u4ee4\uff0c\u4f46\u662f\u6709\u4e9b\u547d\u4ee4\u4e0d\u652f\u6301\u6807\u51c6\u8f93\u5165\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u4f7f\u7528 xargs \u5c06\u6807\u51c6\u8f93\u5165\u8f6c\u6362\u4e3a\u53c2\u6570\uff0c</p> <p>\u8bed\u6cd5\uff1a<code>stdin_input | xargs [option] cmd</code></p> <p>\u539f\u7406\uff1axargs \u4e00\u822c\u662f\u901a\u8fc7\u7ba1\u9053\u7b26\u63a5\u53d7\u6807\u51c6\u8f93\u5165\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u547d\u4ee4\u884c\u53c2\u6570\u4f20\u9012\u7ed9 cmd\u3002</p> <p>\u5b9e\u4f8b\uff1a</p> <ul> <li>\u5c06\u6807\u51c6\u8f93\u5165\u8f6c\u6362\u6210\u547d\u4ee4\u884c\u53c2\u6570</li> </ul> <pre><code>[root@master ~]# seq 1 6\n1\n2\n3\n4\n5\n6\n[root@master ~]# seq 1 6 |xargs -n 2\n1 2\n3 4\n5 6\n</code></pre> <ul> <li> <p>\u5220\u9664\u65e5\u5fd7\u6587\u4ef6 <pre><code>ls *.log |xargs rm -rf {}\n</code></pre></p> </li> <li> <p>\u67e5\u627e/home/data\u4e0b\u6743\u9650\u4e3a644\u7684\u6587\u4ef6\u4fee\u6539\u6743\u9650\u4e3a600 <pre><code>find /home/data -perm 644 | xargs chmod 600 </code></pre></p> </li> <li> <p>\u67e5\u627ejpg\u6587\u4ef6\u5e76\u6253\u5305 <pre><code>find / -name *.jpg -type f -print | xargs tar -cvzf images.tar.gz\n</code></pre></p> </li> <li> <p>\u4f7f\u7528 -n \u8fdb\u884c\u591a\u884c\u8f93\u51fa <pre><code>cat test.txt | xargs -n3\n\na b c\nd e f\ng h i\nj k l\nm n o\np q r\ns t u\nv w x\ny z\n</code></pre></p> </li> <li> <p>\u4f7f\u7528 -d \u5206\u5272\u8f93\u5165</p> </li> </ul> <p>-d \u9009\u9879 \u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u5b9a\u754c\u7b26\uff1a <pre><code>echo \"nameXnameXnameXname\" | xargs -dX\n\nname name name name\n</code></pre></p> <p>\u7ed3\u5408 -n \u9009\u9879 \u4f7f\u7528\uff1a <pre><code>echo \"nameXnameXnameXname\" | xargs -dX -n2\n\nname name\nname name\n</code></pre></p> <p>\u590d\u5236\u6240\u6709\u56fe\u7247\u6587\u4ef6\u5230 /data/images \u76ee\u5f55\u4e0b\uff1a <pre><code>ls *.jpg | xargs -n1 -I cp {} /data/images\n</code></pre></p> <p>\u7ed3\u5408 find \u547d\u4ee4\u4f7f\u7528</p> <p>xargs \u7ed3\u5408 find \u4f7f\u7528</p> <p>\u7528 rm \u5220\u9664\u592a\u591a\u7684\u6587\u4ef6\u65f6\u5019\uff0c\u53ef\u80fd\u5f97\u5230\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f\uff1a<code>/bin/rm Argument list too long.</code> \u7528 xargs \u53bb\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff1a</p> <pre><code>find . -type f -name \"*.log\" -print0 | xargs -0 rm -f\n</code></pre> <p>xargs -0 \u5c06 \\0 \u4f5c\u4e3a\u5b9a\u754c\u7b26\u3002</p> <p>\u7edf\u8ba1\u4e00\u4e2a\u6e90\u4ee3\u7801\u76ee\u5f55\u4e2d\u6240\u6709 php \u6587\u4ef6\u7684\u884c\u6570\uff1a <pre><code>find . -type f -name \"*.php\" -print0 | xargs -0 wc -l\n</code></pre></p> <p>\u4f7f\u7528 -p \u9009\u9879\u786e\u8ba4\u6267\u884c\u7684\u547d\u4ee4</p> <p>-p \u9009\u9879\u4f1a\u5728\u6267\u884c\u6bcf\u4e00\u4e2a\u547d\u4ee4\u65f6\u5f39\u51fa\u786e\u8ba4\uff0c\u5f53\u4f60\u9700\u8981\u975e\u5e38\u51c6\u786e\u7684\u786e\u8ba4\u6bcf\u4e00\u6b21\u64cd\u4f5c\u65f6\u53ef\u4ee5\u4f7f\u7528 -p \u53c2\u6570\uff0c \u6bd4\u5982\uff0c\u67e5\u627e\u5f53\u524d\u76ee\u5f55\u4e0b .log \u6587\u4ef6\uff0c\u6bcf\u4e00\u6b21\u5220\u9664\u90fd\u9700\u8981\u786e\u8ba4\uff1a</p> <pre><code>find . -maxdepth 1 -name \"*.log\" | xargs -p -I{} rm {}\n</code></pre> <p>\u6267\u884c\u591a\u4e2a\u547d\u4ee4</p> <p>\u4f7f\u7528 -I \u9009\u9879\u53ef\u4ee5\u8ba9 xargs \u6267\u884c\u591a\u4e2a\u547d\u4ee4 <pre><code>cat foo.txt\none\ntwo\nthree\n\ncat foo.txt | xargs -I % sh -c 'echo %; mkdir %'\none\ntwo\nthree\n\nls\none two three\n</code></pre></p> <p>xargs \u5176\u4ed6\u5e94\u7528</p> <p>\u5047\u5982\u4f60\u6709\u4e00\u4e2a\u6587\u4ef6\u5305\u542b\u4e86\u5f88\u591a\u4f60\u5e0c\u671b\u4e0b\u8f7d\u7684 URL\uff0c\u4f60\u80fd\u591f\u4f7f\u7528 xargs \u4e0b\u8f7d\u6240\u6709\u94fe\u63a5\uff1a</p> <pre><code>cat url-list.txt | xargs wget -c\n</code></pre>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#6-\u5b9e\u4f8b","title":"6. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#61-\u9700\u6c42","title":"6.1 \u9700\u6c42","text":"<p>\u6211\u4eec\u7ecf\u5e38\u5728Linux\u7cfb\u7edf\u64cd\u4f5c\u64cd\u4f5c\u6587\u4ef6\uff0c\u4fd7\u8bdd\u8bf4\u5e38\u5728\u6cb3\u8fb9\u8d70\uff0c\u54ea\u6709\u4e0d\u6e7f\u978b\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5220\u9664\u91cd\u8981\u6587\u4ef6\u662f\u975e\u5e38\u5371\u9669\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528Shell\u811a\u672c\u6765\u5236\u4f5c\u4e00\u4e2a\u7c7b\u4f3c\u4e8eWindows\u4e0b\u7684\u56de\u6536\u7ad9\uff0c\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u671f\u6e05\u7406\u8fd9\u4e2a\u56de\u6536\u7ad9\u4e2d\u7684\u5185\u5bb9\uff0c\u4ece\u800c\u8fbe\u5230\u7f13\u51b2\u53ca\u89c4\u907f\u5371\u9669\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#62-\u601d\u8def","title":"6.2 \u601d\u8def","text":"<ul> <li>\u901a\u8fc7 alias rm \u6765\u5c06\u5220\u9664\u7684\u6587\u4ef6\uff0c\u79fb\u52a8\u6587\u4ef6\u5230\u4e00\u4e2a\u56de\u6536\u7ad9\u76ee\u5f55;</li> <li>\u5b9a\u671f\u7684\u5728\u7cfb\u7edf\u78c1\u76d8\u5141\u8bb8\u53ef\u63a7\u7684\u4f7f\u7528\u7387\u60c5\u51b5\u4e0b\uff0c\u5bf9\u56de\u6536\u7ad9\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u5220\u9664\u3002</li> </ul>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#63-\u5b9e\u73b0","title":"6.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# function:\u81ea\u5b9a\u4e49rm\u547d\u4ee4\uff0c\u6bcf\u5929\u665a\u4e0a\u5b9a\u65f6\u6e05\u7406\n# \u6307\u5b9a\u53d8\u91cf\nCMD_SCRIPTS=$HOME/.rm_scripts.sh\nTRASH_DIR=$HOME/.TRASH_DIR\nCRON_FILE=/var/spool/cron/root\nBASHRC=$HOME/.bashrc\n\n[ ! -d ${TRASH_DIR} ] &amp;&amp; mkdir -p ${TRASH_DIR}\ncat &gt; $CMD_SCRIPTS &lt;&lt;EOF\nPARA_CNT=\\$#\nTRASH_DIR=$TRASH_DIR\nfor i in \\$*; do\n     DATE=\\$(date +%F%T)\n     fileName=\\$(basename \\$i)\n     mv \\$i \\$TRASH_DIR/\\$fileName.\\$DATE\ndone\nEOF\nsed -i \"s@$(grep 'alias rm=' $BASHRC)@alias rm='bash ${CMD_SCRIPTS}'@g\" $BASHRC\nsource $HOME/.bashrc\n\n# \u5236\u4f5c\u5b9a\u65f6\u6e05\u7406\u4efb\u52a1\necho \"0 0 * * * rm -rf $TRASH_DIR/*\" &gt;&gt; $CRON_FILE\necho \"\u5220\u9664\u76ee\u5f55:$TRASH_DIR\"\necho \"\u5220\u9664\u811a\u672c:$CMD_SCRIPTS\"\necho \"\u8bf7\u6267\u884c:source $BASHRC \u6765\u52a0\u8f7d\u6587\u4ef6\u6216\u9000\u51fa\u5f53\u524dshell\u91cd\u65b0\u767b\u5f55\"\n</code></pre> <p>\u5bf9\u9632\u6cbb\u8bef\u5220\u9664\u811a\u672c\u8fdb\u884c\u7cfb\u7edf\u6d4b\u8bd5\u3002</p> <pre><code>[root@10-234-1-235 ~]# bash custom_rm.sh \n\u5220\u9664\u76ee\u5f55:/root/.TRASH_DIR\n\u5220\u9664\u811a\u672c:/root/.rm_scripts.sh\n\u8bf7\u6267\u884c:source /root/.bashrc \u6765\u52a0\u8f7d\u6587\u4ef6\u6216\u9000\u51fa\u5f53\u524dshell\u91cd\u65b0\u767b\u5f55\n[root@10-234-1-235 ~]# rm testdir/\n[root@10-234-1-235 ~]# rm wget-log \n[root@10-234-1-235 ~]# ls -la .TRASH_DIR/\ntotal 16\ndrwxr-xr-x.  3 root root 4096 Apr 18 20:11 .\ndr-xr-x---. 13 root root 4096 Apr 18 20:11 ..\ndrwxr-xr-x.  2 root root 4096 Apr 18 20:10 testdir.2020-04-1820:11:37\n-rw-r--r--.  1 root root    0 Jan  9 21:59 wget-log.2020-04-1820:11:40\n\n# \u67e5\u770b\u5b9a\u65f6\u4efb\u52a1\n[root@10-234-1-235 ~]# crontab -l\n0 0 * * * rm -rf /root/.TRASH_DIR/*\n</code></pre>"},{"location":"Linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#7-\u5c0f\u7ed3","title":"7. \u5c0f\u7ed3","text":"<p>Shell\u7f16\u7a0b\u5c31\u662f\u5229\u7528\u5de5\u5177\u52a0\u6570\u636e\u7ed3\u6784\u6d41\u7a0b\u63a7\u5236\u5b9e\u73b0\u4e00\u7ec4\u64cd\u4f5c\uff0c\u6240\u4ee5\u638c\u63e1\u66f4\u591a\u5e38\u7528\u7684\u5de5\u5177\u6216\u547d\u4ee4\u975e\u5e38\u5229\u4e8e\u6211\u4eec\u7f16\u5199Shell\u811a\u672c\uff0c\u5e73\u65f6\u53ef\u4ee5\u591a\u5c1d\u8bd5\u5229\u7528\u5404\u79cd\u547d\u4ee4\u6216\u5de5\u5177\uff0c\u5e76\u5728Shell\u4e2d\u719f\u7ec3\u8fd0\u7528\u5b83\u4eec\uff0c\u52e4\u7ec3\u5e76\u53cd\u601d\u603b\u7ed3\uff0c\u5f52\u7eb3\u6574\u7406\uff0c\u65e5\u79ef\u6708\u7d2f\u5c31\u4f1a\u5f62\u6210\u81ea\u5df1\u5f3a\u5927\u7684\u5de5\u5177\u5e93\u3002</p>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/","title":"16.Shell\u5b9e\u6218\u9879\u76ee","text":""},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#1-\u7cfb\u7edf\u5de1\u68c0","title":"1. \u7cfb\u7edf\u5de1\u68c0","text":""},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#11-\u9700\u6c42","title":"1.1 \u9700\u6c42","text":"<p>\u9700\u8981\u5bf9Linux\u670d\u52a1\u5668\uff0c\u5de1\u68c0\u7cfb\u7edf/\u670d\u52a1/\u7aef\u53e3\u5404\u6307\u6807\u53ca\u53c2\u6570\uff0c\u7f16\u5199\u7cfb\u7edf\u5feb\u901f\u68c0\u67e5\u811a\u672c\uff0c\u8f93\u51fa\u7cfb\u7edf\u4fe1\u606f\u5230\u811a\u672c\u8fd0\u884c\u7684 logs \u76ee\u5f55\u4e0b\u3002</p>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#12-\u601d\u8def","title":"1.2 \u601d\u8def","text":"<p>\u901a\u5e38\u7cfb\u7edf\u7684\u72b6\u6001\u90fd\u5728/proc/\u76ee\u5f55\u4e0b\uff0c\u5bf9\u6587\u4ef6\u4e2d\u7684\u5173\u6ce8\u7cfb\u7edf\u6307\u6807\u6570\u5b57\u8fdb\u884c\u8fc7\u6ee4\u5904\u7406\uff0c\u5f97\u5230\u7cfb\u7edf\u72b6\u6001\uff0c\u5176\u4e2d\u6d89\u53ca\u6570\u7ec4\u7684\u9700\u8981\u8ba1\u7b97\uff0c\u53ef\u4ee5\u5229\u7528\u51fd\u6570\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u9700\u8981\u5de1\u68c0\u7684\u7ed3\u679c\u5229\u7528\u5355\u72ec\u4e00\u4e2a\u51fd\u6570\u7f16\u5199\uff0c\u6700\u540e\u5229\u7528main\u51fd\u6570\u8c03\u7528\u5176\u4ed6\u51fd\u6570\u5f97\u51fa\u6700\u7ec8\u7ed3\u679c\u3002</p>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#13-\u5b9e\u73b0","title":"1.3 \u5b9e\u73b0","text":"<p>\u6838\u5fc3\u5229\u7528sed\u4ee3\u7801\uff1a</p> <pre><code>#!/bin/bash\n# auth:kaliarch\n# func:sys info check\n# version:v1.0\n# sys:centos6.x/7.x\n[ $(id -u) -gt 0 ] &amp;&amp; echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" &amp;&amp; exit 1\nsysversion=$(rpm -q centos-release|cut -d- -f3)\nline=\"-------------------------------------------------\"\n[ -d logs ] || mkdir logs\n\nsys_check_file=\"logs/$(ip a show dev eth0|grep -w inet|awk '{print $2}'|awk -F '/' '{print $1}')-`date +%Y%m%d`.txt\"\n# \u83b7\u53d6\u7cfb\u7edfcpu\u4fe1\u606f\nfunction get_cpu_info() {\nPhysical_CPUs=$(grep \"physical id\" /proc/cpuinfo| sort | uniq | wc -l)\nVirt_CPUs=$(grep \"processor\" /proc/cpuinfo | wc -l)\nCPU_Kernels=$(grep \"cores\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}')\nCPU_Type=$(grep \"model name\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq)\nCPU_Arch=$(uname -m)\ncat &lt;&lt;EOF | column -t \nCPU\u4fe1\u606f:\n\u7269\u7406CPU\u4e2a\u6570: $Physical_CPUs\n\u903b\u8f91CPU\u4e2a\u6570: $Virt_CPUs\n\u6bcfCPU\u6838\u5fc3\u6570: $CPU_Kernels\nCPU\u578b\u53f7: $CPU_Type\nCPU\u67b6\u6784: $CPU_Arch\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\nfunction get_mem_info() {\ncheck_mem=$(free -m)\nMemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}')  #KB\nMemFree=$(grep MemFree /proc/meminfo| awk '{print $2}')    #KB\nlet MemUsed=MemTotal-MemFree\n    MemPercent=$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\nreport_MemTotal=\"$((MemTotal/1024))\"\"MB\"        #\u5185\u5b58\u603b\u5bb9\u91cf(MB)\nreport_MemFree=\"$((MemFree/1024))\"\"MB\"          #\u5185\u5b58\u5269\u4f59(MB)\nreport_MemUsedPercent=\"$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\"\"%\"   #\u5185\u5b58\u4f7f\u7528\u7387%\ncat &lt;&lt;EOF\n\u5185\u5b58\u4fe1\u606f\uff1a\n${check_mem}\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u7f51\u7edc\u4fe1\u606f\nfunction get_net_info() {\npri_ipadd=$(ip a show dev eth0|grep -w inet|awk '{print $2}'|awk -F '/' '{print $1}')\npub_ipadd=$(curl ifconfig.me -s)\ngateway=$(ip route | grep default | awk '{print $3}')\nmac_info=$(ip link| egrep -v \"lo\"|grep link|awk '{print $2}')\ndns_config=$(egrep -v \"^$|^#\" /etc/resolv.conf)\nroute_info=$(route -n)\ncat &lt;&lt;EOF | column -t \nIP\u4fe1\u606f:\n\u7cfb\u7edf\u516c\u7f51\u5730\u5740: ${pub_ipadd}\n\u7cfb\u7edf\u79c1\u7f51\u5730\u5740: ${pri_ipadd}\n\u7f51\u5173\u5730\u5740: ${gateway}\nMAC\u5730\u5740: ${mac_info}\n\u8def\u7531\u4fe1\u606f:\n${route_info}\nDNS \u4fe1\u606f:\n${dns_config}\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u78c1\u76d8\u4fe1\u606f\nfunction get_disk_info() {\ndisk_info=$(fdisk -l|grep \"Disk /dev\"|cut -d, -f1)\ndisk_use=$(df -hTP|awk '$2!=\"tmpfs\"{print}')\ndisk_inode=$(df -hiP|awk '$1!=\"tmpfs\"{print}')\ncat &lt;&lt;EOF\n\u78c1\u76d8\u4fe1\u606f:\n${disk_info}\n\u78c1\u76d8\u4f7f\u7528:\n${disk_use}\ninode\u4fe1\u606f:\n${disk_inode}\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\nfunction get_systatus_info() {\nsys_os=$(uname -o)\nsys_release=$(cat /etc/redhat-release)\nsys_kernel=$(uname -r)\nsys_hostname=$(hostname)\nsys_selinux=$(getenforce)\nsys_lang=$(echo $LANG)\nsys_lastreboot=$(who -b | awk '{print $3,$4}')\nsys_runtime=$(uptime |awk '{print  $3,$4}'|cut -d, -f1)\nsys_time=$(date)\nsys_load=$(uptime |cut -d: -f5)\ncat &lt;&lt;EOF | column -t \n\u7cfb\u7edf\u4fe1\u606f:\n\u7cfb\u7edf: ${sys_os}\n\u53d1\u884c\u7248\u672c:   ${sys_release}\n\u7cfb\u7edf\u5185\u6838:   ${sys_kernel}\n\u4e3b\u673a\u540d:    ${sys_hostname}\nselinux\u72b6\u6001:  ${sys_selinux}\n\u7cfb\u7edf\u8bed\u8a00:   ${sys_lang}\n\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4: ${sys_time}\n\u7cfb\u7edf\u6700\u540e\u91cd\u542f\u65f6\u95f4:   ${sys_lastreboot}\n\u7cfb\u7edf\u8fd0\u884c\u65f6\u95f4: ${sys_runtime}\n\u7cfb\u7edf\u8d1f\u8f7d:   ${sys_load}\nEOF\n}\n# \u83b7\u53d6\u670d\u52a1\u4fe1\u606f\nfunction get_service_info() {\nport_listen=$(netstat -lntup|grep -v \"Active Internet\")\nkernel_config=$(sysctl -p 2&gt;/dev/null)\nif [ ${sysversion} -gt 6 ];then\nservice_config=$(systemctl list-unit-files --type=service --state=enabled|grep \"enabled\")\nrun_service=$(systemctl list-units --type=service --state=running |grep \".service\")\nelse\nservice_config=$(/sbin/chkconfig | grep -E \":on|:\u542f\u7528\" |column -t)\nrun_service=$(/sbin/service --status-all|grep -E \"running\")\nfi\ncat &lt;&lt;EOF\n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\n${service_config}\n${line}\n\u8fd0\u884c\u7684\u670d\u52a1:\n${run_service}\n${line}\n\u76d1\u542c\u7aef\u53e3:\n${port_listen}\n${line}\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\n${kernel_config}\nEOF\n}\nfunction get_sys_user() {\nlogin_user=$(awk -F: '{if ($NF==\"/bin/bash\") print $0}' /etc/passwd)\nssh_config=$(egrep -v \"^#|^$\" /etc/ssh/sshd_config)\nsudo_config=$(egrep -v \"^#|^$\" /etc/sudoers |grep -v \"^Defaults\")\nhost_config=$(egrep -v \"^#|^$\" /etc/hosts)\ncrond_config=$(for cronuser in /var/spool/cron/* ;do ls ${cronuser} 2&gt;/dev/null|cut -d/ -f5;egrep -v \"^$|^#\" ${cronuser} 2&gt;/dev/null;echo \"\";done)\ncat &lt;&lt;EOF\n\u7cfb\u7edf\u767b\u5f55\u7528\u6237:\n${login_user}\n${line}\nssh \u914d\u7f6e\u4fe1\u606f:\n${ssh_config}\n${line}\nsudo \u914d\u7f6e\u7528\u6237:\n${sudo_config}\n${line}\n\u5b9a\u65f6\u4efb\u52a1\u914d\u7f6e:\n${crond_config}\n${line}\nhosts \u4fe1\u606f:\n${host_config}\nEOF\n}\nfunction process_top_info() {\ntop_title=$(top -b n1|head -7|tail -1)\ncpu_top10=$(top b -n1 | head -17 | tail -10)\nmem_top10=$(top -b n1|head -17|tail -10|sort -k10 -r)\ncat &lt;&lt;EOF\nCPU\u5360\u7528top10:\n${top_title}\n${cpu_top10}\n\u5185\u5b58\u5360\u7528top10:\n${top_title}\n${mem_top10}\nEOF\n}\nfunction sys_check() {\nget_cpu_info\n    echo ${line}\nget_mem_info\n    echo ${line}\nget_net_info\n    echo ${line}\nget_disk_info\n    echo ${line}\nget_systatus_info\n    echo ${line}\nget_service_info\n    echo ${line}\nget_sys_user\n    echo ${line}\nprocess_top_info\n}\nsys_check &gt; ${sys_check_file}\n</code></pre>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#14-\u6d4b\u8bd5","title":"1.4 \u6d4b\u8bd5","text":"<pre><code>[root@master workspace]# bash sys_check.sh \n[root@master workspace]# ls\nlogs  sys_check.sh\n[root@master workspace]# cat logs/172.16.60.2-20200419.txt \nCPU\u4fe1\u606f:\n\u7269\u7406CPU\u4e2a\u6570:  4\n\u903b\u8f91CPU\u4e2a\u6570:  4\n\u6bcfCPU\u6838\u5fc3\u6570:  1\nCPU\u578b\u53f7:      QEMU    Virtual  CPU\nCPU\u67b6\u6784:      x86_64\n-------------------------------------------------\n\u5185\u5b58\u4fe1\u606f\uff1a\n\ntotal        used        free      shared  buff/cache   available\nMem:          16047       12536         179         885        3331        2007\nSwap:             0           0           0\n-------------------------------------------------\nIP\u4fe1\u606f:\n\u7cfb\u7edf\u516c\u7f51\u5730\u5740:      4x.xxx.xxx.18\n\u7cfb\u7edf\u79c1\u7f51\u5730\u5740:      172.16.60.2\n\u7f51\u5173\u5730\u5740:          172.16.60.1\nMAC\u5730\u5740:           52:54:73:7b:c9:11\n\u8def\u7531\u4fe1\u606f:\nKernel             IP                 routing          table\nDestination        Gateway            Genmask          Flags  Metric  Ref  Use  Iface\n0.0.0.0            172.16.60.1        0.0.0.0          UG     100     0    0    eth0\n10.233.88.192      172.16.60.5        255.255.255.192  UG     0       0    0    tunl0\n172.16.60.0        0.0.0.0            255.255.255.0    U      100     0    0    eth0\n172.17.0.0         0.0.0.0            255.255.0.0      U      0       0    0    docker0\nDNS                \u4fe1\u606f:\nnameserver         10.17.50.3\nnameserver         1.2.4.8\n-------------------------------------------------\n\u78c1\u76d8\u4fe1\u606f:\n\nDisk /dev/vda: 21.5 GB\nDisk /dev/vdb: 8589 MB\n\u78c1\u76d8\u4f7f\u7528:\n\nFilesystem     Type      Size  Used Avail Use% Mounted on\n/dev/vda1      ext4       20G  5.0G   14G  27% /\ndevtmpfs       devtmpfs  7.9G     0  7.9G   0% /dev\n/dev/vdc       ext4      197G   46G  142G  25% /data\n/dev/vdd       xfs       500G   53G  448G  11% /var/local/osd0\n\ninode\u4fe1\u606f:\n\nFilesystem     Inodes IUsed IFree IUse% Mounted on\n/dev/vda1        1.3M   54K  1.2M    5% /\ndevtmpfs         2.0M   398  2.0M    1% /dev\n/dev/vdc          13M  1.3M   12M   11% /data\n/dev/vdd         250M   14K  250M    1% /var/local/osd0\noverlay           13M  1.3M   12M   11% 2c99089efbac12ffc5d7a8f6ccf99d95ab3c1674b441205a61829ebe635/merged\n\n\u7cfb\u7edf:              GNU/Linux\n\u53d1\u884c\u7248\u672c:          CentOS                 Linux  release  7.4.1708  (Core)\n\u7cfb\u7edf\u5185\u6838:          3.10.0-693.el7.x86_64\n\u4e3b\u673a\u540d:            master\nselinux\u72b6\u6001:       Permissive\n\u7cfb\u7edf\u8bed\u8a00:          en_US.UTF-8\n\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4:      Sun                    Apr    19       12:34:35  CST     2020\n\u7cfb\u7edf\u6700\u540e\u91cd\u542f\u65f6\u95f4:  2020-03-18             16:15\n\u7cfb\u7edf\u8fd0\u884c\u65f6\u95f4:      31                     days\n\u7cfb\u7edf\u8d1f\u8f7d:          1.55,                  1.73,  1.95\n-------------------------------------------------\n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\n\nauditd.service                              enabled\nautovt@.service                             enabled\nceph-mon@.service                           enabled\netcd.service                                enabled\ngapd.service                                enabled\ngetty@.service                              enabled\nirqbalance.service                          enabled\nkdump.service                               enabled\nkubelet.service                             enabled\nmicrocode.service                           enabled\nNetworkManager-dispatcher.service           enabled\nNetworkManager.service                      enabled\npostfix.service                             enabled\nrpcbind.service                             enabled\nrsyslog.service                             enabled\nsmarteye-server-agent.service               enabled\nsshd.service                                enabled\nsystemd-readahead-collect.service           enabled\nsystemd-readahead-drop.service              enabled\nsystemd-readahead-replay.service            enabled\ntuned.service                               enabled\n-------------------------------------------------\n\u8fd0\u884c\u7684\u670d\u52a1:\n\nauditd.service                loaded active running Security Auditing Service\nceph-mon@master.service       loaded active running Ceph cluster monitor daemon\nceph-osd@0.service            loaded active running Ceph object storage daemon\nchronyd.service               loaded active running NTP client/server\ncrond.service                 loaded active running Command Scheduler\ndbus.service                  loaded active running D-Bus System Message Bus\ndocker.service                loaded active running Docker Application Container Engine\netcd.service                  loaded active running etcd docker wrapper\ngapd.service                  loaded active running guest agent for pitrix\ngetty@tty1.service            loaded active running Getty on tty1\ngssproxy.service              loaded active running GSSAPI Proxy Daemon\nirqbalance.service            loaded active running irqbalance daemon\nkubelet.service               loaded active running Kubernetes Kubelet Server\nNetworkManager.service        loaded active running Network Manager\npolkit.service                loaded active running Authorization Manager\npostfix.service               loaded active running Postfix Mail Transport Agent\nrpcbind.service               loaded active running RPC bind service\nrsyslog.service               loaded active running System Logging Service\nsmarteye-server-agent.service loaded active running The Smarteye Monitoring of server\nsshd.service                  loaded active running OpenSSH server daemon\nsystemd-journald.service      loaded active running Journal Service\nsystemd-logind.service        loaded active running Login Service\nsystemd-udevd.service         loaded active running udev Kernel Device Manager\ntuned.service                 loaded active running Dynamic System Tuning Daemon\n-------------------------------------------------\n\u76d1\u542c\u7aef\u53e3:\n\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    tcp        0      0 127.0.0.1:9099          0.0.0.0:*               LISTEN      10444/calico-node   tcp        0      0 172.16.60.2:2379        0.0.0.0:*               LISTEN      1321/etcd           tcp        0      0 127.0.0.1:2379          0.0.0.0:*               LISTEN      1321/etcd           tcp        0      0 172.16.60.2:9100        0.0.0.0:*               LISTEN      2868/./kube-rbac-pr tcp        0      0 127.0.0.1:9100          0.0.0.0:*               LISTEN      2314/node_exporter  tcp        0      0 172.16.60.2:2380        0.0.0.0:*               LISTEN      1321/etcd           tcp        0      0 172.16.60.2:10255       0.0.0.0:*               LISTEN      1222/kubelet        tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      1/systemd           tcp        0      0 0.0.0.0:6800            0.0.0.0:*               LISTEN      850/ceph-osd        tcp        0      0 0.0.0.0:6801            0.0.0.0:*               LISTEN      850/ceph-osd        tcp        0      0 0.0.0.0:6802            0.0.0.0:*               LISTEN      850/ceph-osd        tcp        0      0 0.0.0.0:179             0.0.0.0:*               LISTEN      10755/bird          tcp        0      0 0.0.0.0:6803            0.0.0.0:*               LISTEN      850/ceph-osd        tcp        0      0 169.254.25.10:53        0.0.0.0:*               LISTEN      2058/node-cache     tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      552/sshd            tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      786/master          tcp        0      0 127.0.0.1:40416         0.0.0.0:*               LISTEN      1222/kubelet        tcp        0      0 172.16.60.2:6789        0.0.0.0:*               LISTEN      661/ceph-mon        tcp        0      0 169.254.25.10:9254      0.0.0.0:*               LISTEN      2058/node-cache     tcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      1222/kubelet        tcp        0      0 127.0.0.1:10249         0.0.0.0:*               LISTEN      2854/kube-proxy     tcp        0      0 172.16.60.2:10250       0.0.0.0:*               LISTEN      1222/kubelet        tcp6       0      0 :::10251                :::*                    LISTEN      12358/kube-schedule tcp6       0      0 :::6443                 :::*                    LISTEN      1929/kube-apiserver tcp6       0      0 :::10252                :::*                    LISTEN      12366/kube-controll udp6       0      0 :::111                  :::*                                1/systemd           udp6       0      0 ::1:323                 :::*                                530/chronyd         udp6       0      0 :::703                  :::*                                535/rpcbind         -------------------------------------------------\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\n\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_local_reserved_ports = 30000-32767\nnet.bridge.bridge-nf-call-arptables = 1\n-------------------------------------------------\n\u7cfb\u7edf\u767b\u5f55\u7528\u6237:\n\nroot:x:0:0:root:/root:/bin/bash\n-------------------------------------------------\nssh \u914d\u7f6e\u4fe1\u606f:\n\nHostKey /etc/ssh/ssh_host_rsa_key\nHostKey /etc/ssh/ssh_host_ecdsa_key\nHostKey /etc/ssh/ssh_host_ed25519_key\nSyslogFacility AUTHPRIV\nAuthorizedKeysFile      .ssh/authorized_keys\nPasswordAuthentication yes\nChallengeResponseAuthentication no\nGSSAPIAuthentication no\nGSSAPICleanupCredentials no\nUsePAM yes\nX11Forwarding yes\nAcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES\nAcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT\nAcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE\nAcceptEnv XMODIFIERS\nSubsystem       sftp    /usr/libexec/openssh/sftp-server\nPermitRootLogin yes\nPermitEmptyPasswords no\nUseDNS no\n-------------------------------------------------\nsudo \u914d\u7f6e\u7528\u6237:\n\nroot    ALL=(ALL)       ALL\n%wheel  ALL=(ALL)       ALL\n-------------------------------------------------\n\u5b9a\u65f6\u4efb\u52a1\u914d\u7f6e:\n\nroot\n@weekly /usr/bin/docker system prune -f\n*/30 * * * * /opt/etcd_back/etcd_backup.sh\n-------------------------------------------------\nhosts \u4fe1\u606f:\n\n127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1 localhost6 localhost6.localdomain6 localhost6.localdomain\n172.16.60.2 master\n172.16.60.3 node01\n172.16.60.4 node02\n172.16.60.5 node03\n172.16.60.2 master.cluster.local master\n172.16.60.3 node01.cluster.local node01\n172.16.60.4 node02.cluster.local node02\n172.16.60.5 node03.cluster.local node03\n172.16.60.2  harbor.devops.kubesphere.local\n172.16.60.2  gitlab.devops.kubesphere.local\n-------------------------------------------------\nCPU\u5360\u7528top10:\n\nPID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 1222 root      20   0 1401200 142324  19560 S  11.8  0.9   6197:32 kubelet\n 7119 root      20   0  144632  16016   4840 S   5.9  0.1 263:45.19 coredns\n 9761 1001      20   0  133952  19360   3444 S   5.9  0.1 589:46.42 jaeger-operator\n12366 root      20   0  821212 130924  21304 S   5.9  0.8  20:30.77 kube-controller\n15129 root      20   0  169104  39880   6176 S   5.9  0.2 212:52.15 mixs\n15251 root      20   0  157848   2148   1408 R   5.9  0.0   0:00.02 top\n19934 root      20   0 10.074g  26564   4612 S   5.9  0.2 342:47.40 etcd\n    1 root      20   0  194876   6912   2996 S   0.0  0.0   7:21.74 systemd\n    2 root      20   0       0      0      0 S   0.0  0.0   0:09.02 kthreadd\n    3 root      20   0       0      0      0 S   0.0  0.0  20:13.67 ksoftirqd/0\n\n\u5185\u5b58\u5360\u7528top10:\n\nPID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 1929 root      20   0 1667544 832556  23912 S  11.8  5.1   5571:22 kube-apiserver\n12967 root      20   0  9.914g 6.834g   1580 S   5.9 43.6   3672:00 java\n28651 polkitd   20   0 4161568 217472   2180 S   5.9  1.3 185:46.09 java\n 1321 root      20   0 10.188g 170880  18380 S  11.8  1.0   2154:47 etcd\n12366 root      20   0  821212 130924  21304 S   5.9  0.8  20:30.78 kube-controller\n  661 ceph      20   0  463516  67048   4476 S   5.9  0.4 280:35.51 ceph-mon\n17654 root      20   0  167812  11044   2808 S   5.9  0.1   9:13.12 envoy\n    1 root      20   0  194876   6912   2996 S   0.0  0.0   7:21.74 systemd\n15255 root      20   0  157848   2152   1408 R  11.8  0.0   0:00.03 top\n14093 polkitd   20   0  288608   6848   4208 S   5.9  0.0   0:00.02 postgres\n</code></pre>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#2-elk\u5b89\u88c5","title":"2 ELK\u5b89\u88c5","text":""},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#21-\u9700\u6c42","title":"2.1 \u9700\u6c42","text":"<p>\u5bf9\u4e8e\u8f6f\u4ef6\u5b89\u88c5\uff0c\u901a\u5e38\u4eba\u5de5\u64cd\u4f5c\u4e0d\u4ec5\u7e41\u7410\u8017\u65f6\uff0c\u4e14\u6613\u51fa\u9519\uff0c\u53ef\u4ee5\u7528\u7f16\u5199Shell\u6765\u5b8c\u6210\uff0c\u540e\u671f\u5982\u679c\u6709\u91cd\u590d\u9700\u6c42\uff0c\u53ef\u4ee5\u4e00\u52b3\u6c38\u9038\uff0c\u5b89\u88c5\u4e0d\u6613\u51fa\u9519\u4e14\u63d0\u5347\u6548\u7387\uff0cELK\u4e3a\u5f00\u6e90\u65e5\u5fd7\u7cfb\u7edf \u7531 Elasticsearch\u3001Logstash \u548c Kibana \u4e09\u90e8\u5206\u7ec4\u4ef6\u7ec4\u6210\u3002</p>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#22-\u601d\u8def","title":"2.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u9488\u5bf9\u9700\u8981\u6309\u7167\u7684\u5404\u670d\u52a1\u5355\u72ec\u7f16\u5199\u811a\u672c\u6765\u8fdb\u884c\u6309\u7167\uff0c\u5176\u4e2d\u5229\u7528\u4e86\u7cfb\u7edf\u5185\u7684\u5f88\u591a\u547d\u4ee4\uff0c\u4e5f\u5305\u542b\u6587\u4ef6\u7684\u64cd\u4f5c\u7b49\uff0c\u5728\u6b64\u521a\u597d\u56de\u987e\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u7684\u5185\u5bb9\u3002</p>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#23-\u5b9e\u73b0","title":"2.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n#mail:xuel@anchnet.com\n#data:2020/4/10\n#AutoInstall ELK scripts\n#Software:elasticsearch-5.4.1/logstash-5.4.1/filebeat-5.4.1/kibana-5.4.1\nclear\necho \"##########################################\"\necho \"#       Auto Install ELK.               ##\"\necho \"#       Press Ctrl + C to cancel        ##\"\necho \"#       Any key to continue             ##\"\necho \"##########################################\"\nread -p # \u5b9a\u4e49\u53d8\u91cf\nsoftware_dir=\"/usr/local/software\"\nelasticsearch_url=\"https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.4.1.tar.gz\"\nkibana_url=\"https://artifacts.elastic.co/downloads/kibana/kibana-5.4.1-linux-x86_64.tar.gz\"\nlogstash_url=\"https://artifacts.elastic.co/downloads/logstash/logstash-5.4.1.tar.gz\"\nfilebeat_url=\"https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.4.1-linux-x86_64.tar.gz\"\nsys_version=`cat /etc/redhat-release |awk '{print $4}'|cut -d. -f1`\nIP=`ip addr|grep \"inet \"|grep -v 127.0.0.1|awk '{print $2}'|cut -d/ -f1`\njvm_conf=\"/usr/local/elasticsearch/config/jvm.options\"\nsys_mem=`free -m|grep Mem:|awk '{print $2}'|awk '{sum+=$1} END {print sum/1024}'|cut -d. -f1`\n#wget software\nwget_fun() {\nif [ ! -d ${software_dir} ];then\nmkdir -p ${software_dir} &amp;&amp; cd ${software_dir}\nelse\ncd ${software_dir}\nfi\nfor software in $elasticsearch_url $kibana_url $logstash_url $filebeat_url\ndo\nwget -c $software\ndone\nclear\n}\n#initial system:install java wget;set hostname;disable firewalld\ninit_sys() {\n[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions\n[ \"${sys_version}\" != \"7\" ] &amp;&amp; echo \"Error:This Scripts Support Centos7.xx\" &amp;&amp; exit 1\n[ $(id -u) != \"0\" ] &amp;&amp; echo \"Error: You must be root to run this script\" &amp;&amp; exit 1\nsed -i \"s/SELINUX=enforcing/SELINUX=disabled/\"  /etc/selinux/config\nsetenforce 0\nyum install -y java-1.8.0-openjdk wget net-tools\nhostnamectl set-hostname elk-server          systemctl stop firewalld\ncat &gt;&gt;/etc/security/limits.conf&lt;&lt;EOF\n* soft nofile 65536 \n* hard nofile 65536 \n* soft nproc 65536 \n* hard nproc 65536\nEOF\n}\n#install elasticsearch\ninstall_elasticsearch() {\ncd $software_dir\ntar zxf elasticsearch-5.4.1.tar.gz\nmv elasticsearch-5.4.1 /usr/local/elasticsearch\nmkdir -p /usr/local/elasticsearch/data /usr/local/elasticsearch/logs\nuseradd elasticsearch\nchown -R elasticsearch:elasticsearch /usr/local/elasticsearch\necho \"vm.max_map_count = 655360\" &gt;&gt;/etc/sysctl.conf &amp;&amp; sysctl -p\nif [ ${sys_mem} -eq 0 ];then\nsed -i \"s#`grep \"^-Xmx\" ${jvm_conf}`#\"-Xmx512m\"#g\" ${jvm_conf}\nsed -i \"s#`grep \"^-Xms\" ${jvm_conf}`#\"-Xms512m\"#g\" ${jvm_conf}\nelse\nsed -i \"s#`grep \"^-Xmx\" ${jvm_conf}`#\"-Xmx${sys_mem}g\"#g\" ${jvm_conf}\nsed -i \"s#`grep \"^-Xms\" ${jvm_conf}`#\"-Xms${sys_mem}g\"#g\" ${jvm_conf}\nfi\ncat &gt;&gt;/usr/local/elasticsearch/config/elasticsearch.yml&lt;&lt;EOF\ncluster.name: my-application\nnode.name: elk-server\npath.data: /usr/local/elasticsearch/data\npath.logs: /usr/local/elasticsearch/logs\nnetwork.host: 127.0.0.1\nhttp.port: 9200\ndiscovery.zen.ping.unicast.hosts: [\"elk-server\"]\nEOF\nsu - elasticsearch -c \"nohup /usr/local/elasticsearch/bin/elasticsearch &amp;\"\n}\n#install logstash\ninstall_logstash() {\ncd $software_dir\ntar -zxf logstash-5.4.1.tar.gz\nmv logstash-5.4.1 /usr/local/logstash\ncat&gt;/usr/local/logstash/config/01-syslog.conf&lt;&lt;EOF\ninput {\n    beats {\n        port =&gt; \"5044\"\n        }\n    }\noutput {\n    elasticsearch {\n        hosts =&gt; \"127.0.0.1:9200\"\n    }\n    stdout { codec =&gt; rubydebug }\n}\nEOF\nnohup /usr/local/logstash/bin/logstash -f /usr/local/logstash/config/01-syslog.conf &amp; &gt;/dev/null\n}\n#install filebeat\ninstall_filebeat() {\ncd $software_dir\ntar -zxf filebeat-5.4.1-linux-x86_64.tar.gz\nmv filebeat-5.4.1-linux-x86_64 /usr/local/filebeat\ncat &gt;/usr/local/filebeat/filebeat.yml&lt;&lt;EOF\nfilebeat.prospectors:\n- input_type: log\n  paths:\n    - /var/log/*.log\noutput.logstash:\n  hosts: [\"127.0.0.1:5044\"]\nEOF\ncd /usr/local/filebeat/\nnohup /usr/local/filebeat/filebeat &amp; &gt;/dev/null\n}\n#install kibana\ninstall_kibana() {\ncd $software_dir\ntar -zxf kibana-5.4.1-linux-x86_64.tar.gz\nmv kibana-5.4.1-linux-x86_64 /usr/local/kibana\ncat &gt;&gt; /usr/local/kibana/config/kibana.yml &lt;&lt;EOF\nserver.port: 5601\nserver.host: \"0.0.0.0\"\nelasticsearch.url: \"http://127.0.0.1:9200\"\nEOF\nnohup /usr/local/kibana/bin/kibana &amp; &gt;/dev/null\n}\ncheck() {\nport=$1\nprogram=$2\ncheck_port=`netstat -lntup|grep ${port}|wc -l`\ncheck_program=`ps -ef|grep ${program}|grep -v grep|wc -l`\nif [ $check_port -gt 0 ] &amp;&amp; [ $check_program -gt 0 ];then\naction \"${program} run is ok!\" /bin/true\nelse\naction \"${program} run is error!\" /bin/false\nfi\n}\nmain() {\ninit_sys\nwget_fun\ninstall_elasticsearch\ninstall_filebeat\ninstall_logstash\ninstall_kibana\necho -e \"\\033[32m Checking Elasticsearch...\\033[0m\"\nsleep 20\ncheck :9200 \"elasticsearch\"\necho -e \"\\033[32m Checking Logstash...\\033[0m\"\nsleep 2\ncheck \":9600\" \"logstash\"\necho -e \"\\033[32m Checking Kibana...\\033[0m\"\nsleep 2\ncheck \":5601\" \"kibana\"\naction \"ELK install is success!\" /bin/true\necho \"url:http://$IP:5601\"\n}\nmain\n</code></pre>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#24-\u6d4b\u8bd5","title":"2.4 \u6d4b\u8bd5","text":"<p>\u5b89\u88c5\u5b8c\u6210\u8bbf\u95eehttp://IP:5601\u5373\u53ef\uff0c\u6ce8\u610fIP\u5730\u5740\u4e3a\u6309\u7167ELK\u7684\u670d\u52a1\u5668IP\u5730\u5740\u3002</p> <p></p>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#3-\u5c0f\u7ed3","title":"3. \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u8282\u6211\u4eec\u7b80\u5355\u7684\u5217\u4e3e\u4e86\u4e24\u4e2a\u5177\u4f53\u5b9e\u4f8b\uff0c\u6765\u5b9e\u6218Shell\u811a\u672c\u7f16\u5199\u5904\u7406\u5177\u4f53\u95ee\u9898\uff0c\u81f3\u6b64\u5c31\u7ed3\u675f\u4e86Shell\u7684\u5168\u90e8\u7ae0\u8282\uff0c\u5728\u6b64\u5e0c\u671b\u672c\u6587\u53ef\u4ee5\u5e26\u7ed9\u5927\u5bb6Shell\u5b66\u4e60\u7684\u4e00\u4e9b\u601d\u8def\u8fc7\u65b9\u6cd5\u3002</p> <p>\u5b66\u4e60Shell\u9700\u8981\u591a\u52a8\u624b\u5b9e\u8df5\uff0c\u5728\u65e5\u5e38\u7f16\u5199\u4e2d\u4e3e\u4e00\u53cd\u4e09\uff0c\u9488\u5bf9\u4e00\u4e2a\u811a\u672c\u5982\u4f55\u80fd\u65e0\u72b6\u6001\uff0c\u66f4\u5065\u58ee\uff0c\u66f4\u7075\u6d3b\u6613\u7ef4\u62a4\uff0c\u9700\u8981\u591a\u6b21\u7684\u4fee\u6539\uff0c\u53cd\u590d\u7684\u6267\u884c\u9a8c\u8bc1\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\uff0c\u5c06\u6570\u636e\u62bd\u8c61\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012\uff0c\u53ef\u4ee5\u8fbe\u5230\u662f\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\u3002\u6ce8\u610f\u5c06\u6709\u9650\u7684\u7cbe\u529b\u653e\u5728\u70ed\u70b9\u77e5\u8bc6\u4e0a\uff0c\u5176\u4ed6\u5de5\u5177\u6216\u547d\u4ee4\u7684\u5e38\u7528\u9009\u9879\u6216\u53c2\u6570\u7262\u8bb0\u5373\u53ef\uff0c\u5176\u4ed6\u4e0d\u5e38\u7528\u9009\u9879\u4e0d\u5efa\u8bae\u6b7b\u8bb0\u786c\u80cc\uff0c\u6d3b\u7528<code>\u2014help</code>\u6216<code>man</code>\u624b\u518c\u67e5\u770b\uff0c\u8fd9\u6837\u5728\u540e\u671f\u7684 Shell \u7f16\u5199\u4e2d\u80fd\u591f\u66f4\u52a0\u7684\u5feb\u901f\u9ad8\u6548\u3002</p>"},{"location":"Linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#4-\u94fe\u63a5","title":"4. \u94fe\u63a5","text":"<ul> <li>https://github.com/fengyuhetao/shell</li> <li>https://github.com/daily-scripts/shell-scripts</li> </ul>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/","title":"17.Shell\u811a\u672c\u793a\u4f8b","text":"<p>\u811a\u672c\u7f16\u5199\u6ce8\u610f\u4e8b\u9879</p> <ol> <li>\u5f00\u5934\u52a0\u89e3\u91ca\u5668\uff1a#!/bin/bash </li> <li>\u8bed\u6cd5\u7f29\u8fdb\uff0c\u4f7f\u7528\u56db\u4e2a\u7a7a\u683c\uff1b\u591a\u52a0\u6ce8\u91ca\u8bf4\u660e\u3002 </li> <li>\u547d\u540d\u5efa\u8bae\u89c4\u5219\uff1a\u53d8\u91cf\u540d\u5927\u5199\u3001\u5c40\u90e8\u53d8\u91cf\u5c0f\u5199\uff0c\u51fd\u6570\u540d\u5c0f\u5199\uff0c\u540d\u5b57\u4f53\u73b0\u51fa\u5b9e\u9645\u4f5c\u7528\u3002</li> <li>\u9ed8\u8ba4\u53d8\u91cf\u662f\u5168\u5c40\u7684\uff0c\u5728\u51fd\u6570\u4e2d\u53d8\u91cf local \u6307\u5b9a\u4e3a\u5c40\u90e8\u53d8\u91cf\uff0c\u907f\u514d\u6c61\u67d3\u5176\u4ed6\u4f5c\u7528\u57df\u3002 </li> <li>\u6709\u4e24\u4e2a\u547d\u4ee4\u80fd\u5e2e\u52a9\u6211\u8c03\u8bd5\u811a\u672c\uff1aset -e \u9047\u5230\u6267\u884c\u975e 0 \u65f6\u9000\u51fa\u811a\u672c\uff0cset -x \u548c set +x \u6253\u5370\u6267\u884c\u8fc7\u7a0b\u3002set-x \u548cset+x\u5e38\u7528\u4e8e\u8c03\u8bd5\u51fd\u6570\u3002 </li> <li>\u5199\u811a\u672c\u4e00\u5b9a\u5148\u6d4b\u8bd5\u518d\u5230\u751f\u4ea7\u4e0a\u3002</li> </ol> <pre><code>set -x\nfunction(){\n}\nset +x\n</code></pre> <pre><code># set \u7684\u4e00\u4e9b\u7528\u6cd5\uff1a\nshopt -s -o nounset         #\u5f3a\u8c03\u53d8\u91cf\u5fc5\u987b\u5148\u58f0\u660e\u624d\u80fd\u4f7f\u7528\nset x y z               # \u5c06x,y,z\u7684\u503c\u8d4b\u4e88\u4f4d\u7f6e\u53c2\u65701,2,3\n#\u628a set -u \u6216 set -o nounset \u63d2\u5165\u5230\u811a\u672c\u4e2d, \u5e76\u8fd0\u884c\u5b83, \u5c31\u4f1a\u5728\u6bcf\u4e2a\u8bd5\u56fe\u4f7f\u7528\u672a\u58f0\u660e\u53d8\u91cf\u7684\u5730\u65b9\u7ed9\u51fa\u4e00\u4e2aunbound variable\u9519\u8bef\u4fe1\u606f.\n#set -e     # \u9047\u5230\u6267\u884c\u975e 0 \u65f6\u9000\u51fa\u811a\u672c\uff0cset -x \u6253\u5370\u6267\u884c\u8fc7\u7a0b\nset -o pipefail #\u5728\u8fd9\u4e2a\u8bbe\u7f6e\u6267\u884c\u540e\uff0c\u5176\u540e\u9762\u7684\u4ee3\u7801\uff0c\u5305\u62ec\u7ba1\u9053\u547d\u4ee4\u7684\u8fd4\u56de\u503c\uff0c\u4e3a\u6700\u540e\u4e00\u4e2a\u975e\u96f6\u7684\u547d\u4ee4\u7684\u8fd4\u56de\u503c\uff0c\u6216\u8005\u5f53\u7ba1\u9053\u5185\u7684\u6240\u6709\u547d\u4ee4\u90fd\u6267\u884c\u6210\u529f\u540e\u8fd4\u56de\u96f6\u3002\nset -o nounset      #\u672a\u58f0\u660e\u53d8\u91cf\u5c31\u62a5\u9519\uff0c\u5f3a\u5236\u9000\u51fa\nset +o nounset      # set -/+u,\u7b80\u5199\nset -o errexit      # \u811a\u672c\u53ea\u8981\u53d1\u751f\u9519\u8bef\uff0c\u6267\u884c\u51fa\u73b0\u975e0\u7684\u7ed3\u679c,\u5f53\u811a\u672c\u53d1\u751f\u7b2c\u4e00\u4e2a\u9519\u8bef\u65f6\u9000\u51fa\u811a\u672c\nset +o errexit      # set -/+e,\u7b80\u5199\nset -o xtrace       # \u8868\u793a\u8ddf\u8e2a\u811a\u672c\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u6709\u5229\u4e8e\u8c03\u8bd5,\u8fd0\u884c\u7ed3\u679c\u4e4b\u524d\uff0c\u5148\u8f93\u51fa\u6267\u884c\u7684\u90a3\u4e00\u884c\u547d\u4ee4,\u6bd4set -v\u66f4\u52a0\u5b8c\u6574\u8be6\u7ec6\nset +o xtrace       # set -/+x,\u7b80\u5199\nset -o noclobber    # \u9632\u6b62\u6587\u4ef6\u8986\u76d6\uff0c\u6587\u4ef6\u5b58\u5728\u5c31\u62a5\u9519\uff0c\u4e0d\u5b58\u5728\u5c31\u6b63\u5e38\u521b\u5efa\nset +o noclobber    # set -/+C,\u7b80\u5199\nset -o allexport    # export \u6240\u6709\u5df2\u5b9a\u4e8e\u7684\u53d8\u91cf\nset +o allexport    # set -/+a,\u7b80\u5199\nset -o noexec       # \u8bfb\u53d6\u811a\u672c\u547d\u4ee4\uff0c\u4e0d\u6267\u884c\uff0c\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\nset +o noexec       # set -/+n,\u7b80\u5199\nset -o verbose      # \u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u524d\u6253\u5370\u51fa\u8fd9\u4e2a\u547d\u4ee4\nset +o verbose      # set -/+v,\u7b80\u5199\nset -x\n    uname -a\n    ......\n    set +x              #\u8c03\u8bd5\u67d0\u4e00\u4e2a\u533a\u57df  \u6253\u5370\u6267\u884c\u8fc7\u7a0b,\u7528\u4e8e\u8c03\u8bd5\u51fd\u6570\u5c45\u591a\n</code></pre> <p>\u811a\u672c\u5f00\u5934\u6267\u884c\u65f6\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c \u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u82e5\u9047\u5230\u4f7f\u7528\u4e86\u672a\u5b9a\u4e49\u7684\u53d8\u91cf\u6216\u547d\u4ee4\u8fd4\u56de\u503c\u4e3a\u975e\u96f6\uff0c\u5c06\u76f4\u63a5\u62a5\u9519\u9000\u51fa\uff1a</p> <pre><code>set -eu\nset -euo pipefail\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#1\u5224\u65adcurl\u8fd4\u56de\u72b6\u6001\u7801","title":"1.\u5224\u65adcurl\u8fd4\u56de\u72b6\u6001\u7801","text":"<pre><code>#!/bin/bash\nresponse=$(curl -sL -o /dev/null -w %{http_code} https://baidu.com)\nif [[ $response -ge 200 &amp;&amp; $response -le 299 ]] ;then echo 'check point success'\nelse echo 'check point fail'\nfi\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#2\u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u5230\u53d8\u91cf\u4e2d","title":"2.\u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u5230\u53d8\u91cf\u4e2d","text":"<pre><code>#!/bin/bash\n# \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u9879\u683c\u5f0f\u4e3akey1=value1\uff0c\u4e00\u884c\u4e00\u4e2a\u914d\u7f6e\u9879\nwhile read line;do\neval \"$line\"\ndone &lt; /etc/openvpn/server/smtp.conf\necho $key1\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#3\u6839\u636econsole\u8f93\u5165\u6761\u4ef6\u6267\u884c","title":"3.\u6839\u636econsole\u8f93\u5165\u6761\u4ef6\u6267\u884c","text":"<pre><code>#!/bin/bash\necho \"\u9009\u62e9\u4ee5\u4e0b\u529f\u80fd:\"\necho \"   0) \u529f\u80fd0\"\necho \"   1) \u529f\u80fd1\"\necho \"   2) \u529f\u80fd2\"\necho \"   3) \u529f\u80fd3\"\necho \"   4) \u529f\u80fd4\"\nread -p \"\u529f\u80fd\u9009\u9879[4]: \" option\nuntil [[ -z \"$option\" || \"$option\" =~ ^[0-4]$ ]]; do\nread -p \"$option\u4e3a\u65e0\u6548\u7684\u9009\u9879\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u529f\u80fd\u9009\u9879: \" option\ndone\ncase \"$option\" in\n0) echo \"\u529f\u80fd0\u5df2\u6267\u884c!\" ;;\n1)\necho \"\u529f\u80fd1\u5df2\u6267\u884c!\" exit\n;;\n2)\necho \"\u529f\u80fd2\u5df2\u6267\u884c!\" exit\n;;\n3)\necho \"\u529f\u80fd3\u5df2\u6267\u884c!\"  exit\n;;\n# \u9ed8\u8ba4\u9009\u9879\n4|\"\")\necho \"\u529f\u80fd4\u5df2\u6267\u884c!\" exit\n;;\nesac\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#4\u5c06\u6307\u5b9a\u8f93\u51fa\u5185\u5bb9\u5199\u5165\u6587\u4ef6","title":"4.\u5c06\u6307\u5b9a\u8f93\u51fa\u5185\u5bb9\u5199\u5165\u6587\u4ef6","text":"<pre><code>{\necho \"hahh\"\necho \"lalal\"\n} &gt; /tmp/test\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#5\u5224\u65ad\u53d8\u91cf\u662f\u5426\u5b58\u5728\u6216\u4e3a\u7a7a","title":"5.\u5224\u65ad\u53d8\u91cf\u662f\u5426\u5b58\u5728\u6216\u4e3a\u7a7a","text":"<pre><code>if [ -z ${var+x} ]; then echo \"var is unset\"; else echo \"var is set to '$var'\"; fi\n</code></pre> <p>\u53c2\u8003\uff1ahttps://stackoverflow.com/questions/3601515/how-to-check-if-a-variable-is-set-in-bash</p> <pre><code>#!/bin/bash\n# -z \u9009\u9879\u7528\u4e8e\u68c0\u67e5\u53d8\u91cf\u662f\u5426\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56detrue\nif [ -z \"${VAR}\" ]; then\necho \"VAR is empty\"\nfi\n# -n \u9009\u9879\u7528\u4e8e\u68c0\u67e5\u53d8\u91cf\u662f\u5426\u4e3a\u975e\u7a7a\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56detrue\u3002\nif [ -n \"${VAR}\" ]; then\necho \"VAR is not empty\"\nfi\n</code></pre> <p>\u5728\u6d4b\u8bd5\u53d8\u91cf\u662f\u5426\u4e3a\u7a7a\u65f6\uff0c\u6700\u597d\u4f7f\u7528\u53cc\u5f15\u53f7\u5c06\u53d8\u91cf\u62ec\u8d77\u6765\uff0c\u4ee5\u907f\u514d\u5728\u53d8\u91cf\u4e3a\u7a7a\u65f6\u51fa\u73b0\u8bed\u6cd5\u9519\u8bef\u3002</p>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#51-\u5b57\u7b26\u4e32\u5224\u65ad\u4e2dx\u7684\u4f5c\u7528","title":"5.1 \u5b57\u7b26\u4e32\u5224\u65ad\u4e2dx\u7684\u4f5c\u7528","text":"<pre><code># \u8303\u4f8b\nif [ \"x${var}\" == \"x\" ]\nif [ x\"$DPVS_TYPE\" == x\"SNAT\" ]\n# \u76ee\u7684:\u9632\u6b62\u51fa\u73b0\u8bed\u6cd5\u9519\u8bef\u3002\n[ x$1 = x ] is true if $1 is unset/null/empty or not.\n\nTry yourself with:\nTEST= ;[ x$TEST = x] &amp;&amp; echo \"TEST is unset\"\nand\nTEST=lolz ;[ x$TEST = x ] &amp;&amp; echo \"TEST is unset\"\n# \u7c7b\u4f3c\u4e8e[ -z \"${1:+x}\" ] \u64cd\u4f5c\uff0c\u5f53$1\u4e3a\u7a7a\u65f6\uff0c\u8d4b\u503c\u7ed9x\uff0c\u907f\u514d\u5224\u65ad\u76f4\u63a5\u62a5\u9519\u3002\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#6\u6587\u4ef6\u626b\u63cf\u6821\u9a8c","title":"6.\u6587\u4ef6\u626b\u63cf\u6821\u9a8c","text":"<pre><code>#!/bin/bash\n#func:scan file\n#md5sum -c $SCAN_FILE\nSCAN_DIR=`echo $PATH |sed 's/:/ /g'`\nSCAN_CMD=`which md5sum`\nSCAN_FILE_FALL=\"/tmp/scan_$(date +%F%H%m)_fall.txt\"\nSCAN_FILE_BIN=\"/tmp/scan_$(date +%F%H%m)_bin.txt\"\nscan_fall_disk() {\necho \"\u6b63\u5728\u5168\u76d8\u626b\u63cf\uff0c\u8bf7\u7a0d\u7b49\uff01\u6587\u4ef6\u8def\u5f84:$SCAN_FILE_FALL\"\nfind / -type f -exec $SCAN_CMD \\{\\} \\;&gt;&gt; $SCAN_FILE_FALL 2&gt;/dev/null\n}\nscan_bin() {\necho \"\u6b63\u5728\u626b\u63cfPATH\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8bf7\u7a0d\u7b49\uff0c\u6587\u4ef6\u8def\u5f84\uff1a$SCAN_FILE_BIN\"\nfor file in $SCAN_DIR\ndo\nfind $filae -type f -exec $SCAN_CMD \\{\\} \\;&gt;&gt; $SCAN_FILE_BIN 2&gt;/dev/null\n    done\n}\nmain() {\n[ $# -lt 1 ] &amp;&amp; echo \"\u8bf7\u4f7f\u7528\u53c2\u6570\uff0c1\u8868\u793a\u5168\u76d8\u626b\u63cf\uff0c2\u8868\u793a\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u626b\u63cf\"\nread number\n    case $number in\n1)\nscan_fall_disk;;\n2)\nscan_bin;;\n*)\necho \"\u53c2\u6570\u9519\u8bef\uff0c1\uff0c\u8868\u793a\u5168\u76d8\u626b\u63cf\uff0c2\u8868\u793a\u4e8c\u8fdb\u5236\u6587\u4ef6\u626b\u63cf\"\nesac\n}\nmain\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#7linux\u7cfb\u7edf\u68c0\u6d4b","title":"7.Linux\u7cfb\u7edf\u68c0\u6d4b","text":"<pre><code>#!/bin/bash\n# auth:kaliarch\n# func:sys info check\n# version:v1.0\n# sys:centos6.x/7.x\n[ $(id -u) -gt 0 ] &amp;&amp; echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" &amp;&amp; exit 1\nsysversion=$(rpm -q centos-release|cut -d- -f3)\nline=\"-------------------------------------------------\"\n[ -d logs ] || mkdir logs\n\nsys_check_file=\"logs/$(ip a show dev eth0|grep -w inet|awk '{print $2}'|awk -F '/' '{print $1}')-`date +%Y%m%d`.txt\"\n# \u83b7\u53d6\u7cfb\u7edfcpu\u4fe1\u606f\nfunction get_cpu_info() {\nPhysical_CPUs=$(grep \"physical id\" /proc/cpuinfo| sort | uniq | wc -l)\nVirt_CPUs=$(grep \"processor\" /proc/cpuinfo | wc -l)\nCPU_Kernels=$(grep \"cores\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}')\nCPU_Type=$(grep \"model name\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq)\nCPU_Arch=$(uname -m)\ncat &lt;&lt;EOF | column -t\nCPU\u4fe1\u606f:\n\u7269\u7406CPU\u4e2a\u6570: $Physical_CPUs\n\u903b\u8f91CPU\u4e2a\u6570: $Virt_CPUs\n\u6bcfCPU\u6838\u5fc3\u6570: $CPU_Kernels\nCPU\u578b\u53f7: $CPU_Type\nCPU\u67b6\u6784: $CPU_Arch\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\nfunction get_mem_info() {\ncheck_mem=$(free -m)\nMemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}')  #KB\nMemFree=$(grep MemFree /proc/meminfo| awk '{print $2}')    #KB\nlet MemUsed=MemTotal-MemFree\n    MemPercent=$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\nreport_MemTotal=\"$((MemTotal/1024))\"\"MB\"        #\u5185\u5b58\u603b\u5bb9\u91cf(MB)\nreport_MemFree=\"$((MemFree/1024))\"\"MB\"          #\u5185\u5b58\u5269\u4f59(MB)\nreport_MemUsedPercent=\"$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\"\"%\"   #\u5185\u5b58\u4f7f\u7528\u7387%\ncat &lt;&lt;EOF\n\u5185\u5b58\u4fe1\u606f\uff1a\n${check_mem}\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u7f51\u7edc\u4fe1\u606f\nfunction get_net_info() {\npri_ipadd=$(ip a show dev eth0|grep -w inet|awk '{print $2}'|awk -F '/' '{print $1}')\npub_ipadd=$(curl ifconfig.me -s)\ngateway=$(ip route | grep default | awk '{print $3}')\nmac_info=$(ip link| egrep -v \"lo\"|grep link|awk '{print $2}')\ndns_config=$(egrep -v \"^$|^#\" /etc/resolv.conf)\nroute_info=$(route -n)\ncat &lt;&lt;EOF | column -t\nIP\u4fe1\u606f:\n\u7cfb\u7edf\u516c\u7f51\u5730\u5740: ${pub_ipadd}\n\u7cfb\u7edf\u79c1\u7f51\u5730\u5740: ${pri_ipadd}\n\u7f51\u5173\u5730\u5740: ${gateway}\nMAC\u5730\u5740: ${mac_info}\n\u8def\u7531\u4fe1\u606f:\n${route_info}\nDNS \u4fe1\u606f:\n${dns_config}\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u78c1\u76d8\u4fe1\u606f\nfunction get_disk_info() {\ndisk_info=$(fdisk -l|grep \"Disk /dev\"|cut -d, -f1)\ndisk_use=$(df -hTP|awk '$2!=\"tmpfs\"{print}')\ndisk_inode=$(df -hiP|awk '$1!=\"tmpfs\"{print}')\ncat &lt;&lt;EOF\n\u78c1\u76d8\u4fe1\u606f:\n${disk_info}\n\u78c1\u76d8\u4f7f\u7528:\n${disk_use}\ninode\u4fe1\u606f:\n${disk_inode}\nEOF\n}\n# \u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\nfunction get_systatus_info() {\nsys_os=$(uname -o)\nsys_release=$(cat /etc/redhat-release)\nsys_kernel=$(uname -r)\nsys_hostname=$(hostname)\nsys_selinux=$(getenforce)\nsys_lang=$(echo $LANG)\nsys_lastreboot=$(who -b | awk '{print $3,$4}')\nsys_runtime=$(uptime |awk '{print  $3,$4}'|cut -d, -f1)\nsys_time=$(date)\nsys_load=$(uptime |cut -d: -f5)\ncat &lt;&lt;EOF | column -t\n\u7cfb\u7edf\u4fe1\u606f:\n\u7cfb\u7edf: ${sys_os}\n\u53d1\u884c\u7248\u672c:   ${sys_release}\n\u7cfb\u7edf\u5185\u6838:   ${sys_kernel}\n\u4e3b\u673a\u540d:    ${sys_hostname}\nselinux\u72b6\u6001:  ${sys_selinux}\n\u7cfb\u7edf\u8bed\u8a00:   ${sys_lang}\n\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4: ${sys_time}\n\u7cfb\u7edf\u6700\u540e\u91cd\u542f\u65f6\u95f4:   ${sys_lastreboot}\n\u7cfb\u7edf\u8fd0\u884c\u65f6\u95f4: ${sys_runtime}\n\u7cfb\u7edf\u8d1f\u8f7d:   ${sys_load}\nEOF\n}\n# \u83b7\u53d6\u670d\u52a1\u4fe1\u606f\nfunction get_service_info() {\nport_listen=$(netstat -lntup|grep -v \"Active Internet\")\nkernel_config=$(sysctl -p 2&gt;/dev/null)\nif [ ${sysversion} -gt 6 ];then\nservice_config=$(systemctl list-unit-files --type=service --state=enabled|grep \"enabled\")\nrun_service=$(systemctl list-units --type=service --state=running |grep \".service\")\nelse\nservice_config=$(/sbin/chkconfig | grep -E \":on|:\u542f\u7528\" |column -t)\nrun_service=$(/sbin/service --status-all|grep -E \"running\")\nfi\ncat &lt;&lt;EOF\n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\n${service_config}\n${line}\n\u8fd0\u884c\u7684\u670d\u52a1:\n${run_service}\n${line}\n\u76d1\u542c\u7aef\u53e3:\n${port_listen}\n${line}\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\n${kernel_config}\nEOF\n}\nfunction get_sys_user() {\nlogin_user=$(awk -F: '{if ($NF==\"/bin/bash\") print $0}' /etc/passwd)\nssh_config=$(egrep -v \"^#|^$\" /etc/ssh/sshd_config)\nsudo_config=$(egrep -v \"^#|^$\" /etc/sudoers |grep -v \"^Defaults\")\nhost_config=$(egrep -v \"^#|^$\" /etc/hosts)\ncrond_config=$(for cronuser in /var/spool/cron/* ;do ls ${cronuser} 2&gt;/dev/null|cut -d/ -f5;egrep -v \"^$|^#\" ${cronuser} 2&gt;/dev/null;echo \"\";done)\ncat &lt;&lt;EOF\n\u7cfb\u7edf\u767b\u5f55\u7528\u6237:\n${login_user}\n${line}\nssh \u914d\u7f6e\u4fe1\u606f:\n${ssh_config}\n${line}\nsudo \u914d\u7f6e\u7528\u6237:\n${sudo_config}\n${line}\n\u5b9a\u65f6\u4efb\u52a1\u914d\u7f6e:\n${crond_config}\n${line}\nhosts \u4fe1\u606f:\n${host_config}\nEOF\n}\nfunction process_top_info() {\ntop_title=$(top -b n1|head -7|tail -1)\ncpu_top10=$(top b -n1 | head -17 | tail -10)\nmem_top10=$(top -b n1|head -17|tail -10|sort -k10 -r)\ncat &lt;&lt;EOF\nCPU\u5360\u7528top10:\n${top_title}\n${cpu_top10}\n\u5185\u5b58\u5360\u7528top10:\n${top_title}\n${mem_top10}\nEOF\n}\nfunction sys_check() {\nget_cpu_info\n    echo ${line}\nget_mem_info\n    echo ${line}\nget_net_info\n    echo ${line}\nget_disk_info\n    echo ${line}\nget_systatus_info\n    echo ${line}\nget_service_info\n    echo ${line}\nget_sys_user\n    echo ${line}\nprocess_top_info\n}\nsys_check &gt; ${sys_check_file}\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#71-\u76d1\u63a7100\u53f0\u670d\u52a1\u5668\u78c1\u76d8\u5229\u7528\u7387\u811a\u672c","title":"7.1 \u76d1\u63a7100\u53f0\u670d\u52a1\u5668\u78c1\u76d8\u5229\u7528\u7387\u811a\u672c","text":"<pre><code>#!/bin/bash\nHOST_INFO=host.info\nfor IP in $(awk '/^[^#]/{print $1}' $HOST_INFO); do\nUSER=$(awk -v ip=$IP 'ip==$1{print $2}' $HOST_INFO)\nPORT=$(awk -v ip=$IP 'ip==$1{print $3}' $HOST_INFO)\nTMP_FILE=/tmp/disk.tmp\n    ssh -p $PORT $USER@$IP 'df -h' &gt; $TMP_FILE\nUSE_RATE_LIST=$(awk 'BEGIN{OFS=\"=\"}/^\\/dev/{print $NF,int($5)}' $TMP_FILE)\nfor USE_RATE in $USE_RATE_LIST; do\nPART_NAME=${USE_RATE%=*}\nUSE_RATE=${USE_RATE#*=}\nif [ $USE_RATE -ge 80 ]; then\necho \"Warning: $PART_NAME Partition usage $USE_RATE%!\"\nfi\ndone\ndone\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#8\u542f\u52a8\u811a\u672c\u793a\u4f8b","title":"8.\u542f\u52a8\u811a\u672c\u793a\u4f8b","text":"<pre><code>#!/usr/bin/env bash\n#?$Id:?gmond.init?180?2003-03-07?20:38:36Z?sacerdoti $\n# chkconfig:?2345?70?40\n# description:?gmond?startup?script\n#\u5b9a\u4e49\u53d8\u91cfGMOND\uff0c\u6307\u5b9agmond\u5b88\u62a4\u8fdb\u7a0b\u8def\u5f84\nGMOND=/usr/sbin/gmond\n\n#\u8bfb\u53d6\u5e76\u6267\u884c\u6587\u4ef6 /etc/rc.d/init.d/functions\u7684\u5185\u5bb9\n. /etc/rc.d/init.d/functions\n\n#\u5b9a\u4e49\u53d8\u91cfRETVAL\nRETVAL=0\n#\u4f7f\u7528case\u8bed\u53e5\u6765\u6839\u636e\u6307\u5b9a\u7684\u4e0d\u540c\u53c2\u6570\uff0c\u6267\u884c\u4e0d\u540c\u7684\u884c\u4e3a\ncase $1 in\nstart)\necho -n \"Starting GANGLIA gmond: \"\n#\u5982\u679cgmond\u5b88\u62a4\u8fdb\u7a0b\u4e0d\u5b58\u5728\uff0c\u5219\u9000\u51fa\u811a\u672c\u7684\u6267\u884c\uff0c\u9000\u51fa\u72b6\u6001\u7801\u4e3a1\n[ -f $GMOND ] || exit 1\n#\u5c06gmond\u5b88\u62a4\u8fdb\u7a0b\u653e\u5728\u540e\u53f0\u8fd0\u884c\uff0cdaemon\u662ffunction\u4e2d\u7684\u51fd\u6570\ndaemon $GMOND\n#\u5c06\u4e0a\u4e00\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\u8d4b\u503c\u7ed9\u53d8\u91cfRETVAL\nRETVAL=$?\necho\n##\u82e5gmond\u5b88\u62a4\u8fdb\u7a0b\u6210\u529f\u8fd0\u884c\uff0c\u5219\u521b\u5efa\u4e00\u4e2alock\u6587\u4ef6/var/lock/subsys/gmond\n[ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/gmond\n   ;;\nstop)\n#\u663e\u793a\u505c\u6b62ganglia gmond\u7684\u4fe1\u606f\necho -n \"Shutting down GANGLIA gmond: \"\n#\u505c\u6b62gmond\u5b88\u62a4\u8fdb\u7a0b\uff0ckillproc\u662ffunctions\u4e2d\u5b9a\u4e49\u7684\u51fd\u6570\nkillproc gmond\n        #\u5c06\u4e0a\u4e00\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\u8d4b\u503c\u7ed9\u53d8\u91cfRETVAL\nRETVAL=$?\necho\n#\u82e5gmond\u5b88\u62a4\u8fdb\u7a0b\u6210\u529f\u505c\u6b62\uff0c\u5219\u5220\u9664lock\u6587\u4ef6 /var/lock/subsys/gmond\n[ $RETVAL -eq 0 ] &amp;&amp; rm -rf /var/lock/subsys/gmond\n   ;;\nrestart|reload)\n#\u91cd\u65b0\u8c03\u7528\u6b64\u811a\u672c\uff0c\u547d\u4ee4\u884c\u53c2\u6570\u4e3astop\n$0 stop\n        #\u91cd\u65b0\u8c03\u7528\u6b64\u811a\u672c\uff0c\u547d\u4ee4\u884c\u53c2\u6570\u4e3astart\n$0 start\n        RETVAL=$?\n;;\nstatus)\n#\u663e\u793agmond\u5b88\u62a4\u8fdb\u7a0b\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u5176\u4e2dstatus\u662ffunctions \u5b9a\u4e49\u7684\u51fd\u6570\nstatus gmond\n        RETVAL=$?\n;;\n*)\n#\u663e\u793a\u811a\u672c\u7684\u4f7f\u7528\u65b9\u6cd5\u4fe1\u606f\u5230\u6807\u51c6\u8f93\u51fa\necho \"Usage: $0 {start|stop|restart|status}\"\n#\u9000\u51fa\u811a\u672c\u7684\u8fd0\u884c\uff0c\u9000\u51fa\u72b6\u6001\u7801\u4e3a1\nexit 1\n;;\nesac\n#\u9000\u51fa\u811a\u672c\u7684\u8fd0\u884c\uff0c\u9000\u51fa\u72b6\u6001\u7801\u4e3a\u53d8\u91cfRETVAL\u7684\u503c\nexit $RETVAL\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#9\u5907\u4efd24\u5c0f\u65f6\u88ab\u4fee\u6539\u7684\u6587\u4ef6","title":"9.\u5907\u4efd24\u5c0f\u65f6\u88ab\u4fee\u6539\u7684\u6587\u4ef6","text":"<pre><code>#!/usr/bin/env bash\n#\u5907\u4efd\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709\u524d24\u5c0f\u65f6\u88ab\u4fee\u6539\u7684\u6587\u4ef6\u4e3a\u4e00\u4e2a\u5f52\u6863\u538b\u7f29\u5305\nBACKUPFILE=back-$(date +%m-%d-%Y)   #\u5907\u4efd\u6587\u4ef6\u4e2d\u5d4c\u5165\u65e5\u671f\narchive=${1:-$BACKUPFILE}   #\u5982\u679c\u6ca1\u6709\u5728\u547d\u4ee4\u884c\u4e0a\u6307\u5b9a\u5907\u4efd\u7684\u5f52\u6863\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u4ee5\"back-xxxx\u4f5c\u4e3a\u9ed8\u8ba4\u7684\u6587\u4ef6\u540d\"\ntar cvf - $(find . -mtime -1 -type f -print) &gt;${archive}.tar\ngzip ${archive}.tar\necho \"Directory $PWD backed up in archive file \\\"$archive.tar.gz\\\".\"\n#\u5efa\u8bae\u4f7f\u7528xagrs\u6216\u8005-exec\nfind . -mtime -1 -type f -print0 | xargs -0 tar rvf \"$archive.tar\"\nfind . -mitime -1 -type f -exec tar rvf \"$archive.tar\" '{}' \\ ;\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#10\u5378\u8f7d\u76f8\u5173\u7684rpm\u5305","title":"10.\u5378\u8f7d\u76f8\u5173\u7684rpm\u5305","text":"<pre><code>#!/usr/bin/env bash\nFile_1=unstall.txt\nrpm -qa | grep ssh &gt; $File_1\nwhile read -r line\ndo\nrpm -e $line\n[ $? -eq 0 ] &amp;&amp; echo \"unstall is successful!!\" || exit 1\ndone &lt; $File_1\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#11\u68c0\u67e5rpm\u5305\u7684\u65b9\u6cd5","title":"11.\u68c0\u67e5rpm\u5305\u7684\u65b9\u6cd5","text":"<pre><code>#!/usr/bin/env bash\nif rpm -qa sysstat &amp;&gt; /dev/null; then\necho \"sysstat is already  install\"\nelse\necho \"sysstat is not  install\"\nfi\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#12\u68c0\u67e5\u8f6f\u4ef6\u72b6\u6001","title":"12.\u68c0\u67e5\u8f6f\u4ef6\u72b6\u6001","text":"<pre><code>#!/usr/bin/env bash\nPORT_C=$(ss -anu| grep -c 123)\nPS_C=$(ps -aux| grep ntp| grep -vc grep)\nif [ $PORT_C -eq 0 -o $PS_C -eq 0 ]; then\necho \"Server is fail,restart !!\"\n:\nfi\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#13color\u8f93\u51fa","title":"13.color\u8f93\u51fa","text":"<pre><code>!/usr/bin/env bash\n#\u65b9\u6cd51\ncolor_printf1(){\nif [[ $1 == \"red\" ]]; then\necho -e \"\\033[32;40m$2\\033[0m\"\nelif [[ $1 == \"green\" ]];then\necho -e \"\\033[31;40m$2\\033[0m\"\nfi\n}\n#\u65b9\u6cd52\ncolor_printf2(){\ncase \"$1\" in\n\"red\")\necho -e \"\\033[32;40m$2\\033[0m\"\n;;\n\"green\")\necho -e \"\\033[31;40m$2\\033[0m\"\n;;\n*)\necho -e \"Example: color_printf2 red xxxxxx\"\n;;\nesac\n}\nfunction echo_r (){\n# Color red: Error, Failed\n[ $# -ne 1 ] &amp;&amp; return 1\necho -e \"\\033[31m$1\\033[0m\"\n}\nfunction echo_g (){\n# Color green: Success\n[ $# -ne 1 ] &amp;&amp; return 1\necho -e \"\\033[32m$1\\033[0m\"\n}\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#14nginx\u65e5\u5fd7\u5207\u5272","title":"14.Nginx\u65e5\u5fd7\u5207\u5272","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\n# author\uff1axiaojian\nS_LOG=/usr/local/nginx/logs/access.log\nD_LOG=/data/backup/`date +%Y-%m-%d`\necho -e \"\\033[32mPlease wait start cut shell scripts ....\\033[0m\"\nsleep 2\nif [ ! -d $D_LOG ]; then\nmkdir -p $D_LOG\nfi\nmv $S_LOG $D_LOG\nkill -USR1 `cat /usr/local/nginx/logs/nginx.pid`\necho \"---------------------------------------------\"\necho \"The Nginx log Cutting Successfully! \"\necho \"You can access backup nginx log ${D_LOG}/access.log files.\"\n</code></pre> <pre><code>#!/bin/sh\n#nginx\u65e5\u5fd7\u5207\u5272\n#\u8bbe\u7f6e\nLog_path=/www/server/nginx/logs\nYesterday=$(date -d \"yesterday\" +%Y-%m-%d_%S)\nNginxbin=/www/server/nginx/sbin/nginx\n\n#\u65e5\u5fd7\u6539\u540d\n/bin/mv $Log_path/access.log $Log_path/access.$Yesterday.log\n/bin/mv $Log_path/error.log  $Log_path/error.$Yesterday.log\n\n#\u91cd\u65b0\u751f\u6210\u65e5\u5fd7\n$Nginxbin -s reopen\n\n# #\u5b9a\u65f6\u4efb\u52a1\n# #nginx\u65e5\u5fd7\u5207\u5272\n# 00 00 * * *  /root/sh/cut_log.sh\n# #\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#15\u4e00\u952e\u5b89\u88c5docker","title":"15.\u4e00\u952e\u5b89\u88c5docker","text":"<pre><code>#!/bin/bash\n#Author:\n#Date: 2019-06-06\n#install docker in ubuntu and centos\nfunction install_docker_in_ubuntu\n{\nsudo  apt-get update -y\n    # install some tools\nsudo apt-get install \\\napt-transport-https \\\nca-certificates \\\ncurl \\\ngnupg-agent \\\nsoftware-properties-common \\\nnet-tools \\\nwget -y\n\n# install docker\ncurl -fsSL get.docker.com -o get-docker.sh\n    sh get-docker.sh\n\n# start docker service\nsudo groupadd docker &amp;&gt; /dev/null\n    sudo gpasswd -a \"${USER}\" docker\n    sudo systemctl start docker\n\nrm -rf get-docker.sh\n}\nfunction install_docker_in_centos\n{\n# install some tools\nsudo yum install -y git vim gcc glibc-static telnet bridge-utils\n\n# install docker\ncurl -fsSL get.docker.com -o get-docker.sh\n    sh get-docker.sh\n\n# start docker service\nsudo groupadd docker &amp;&gt; /dev/null\n    sudo gpasswd -a \"${USER}\" docker\n    sudo systemctl start docker\n\nrm -rf get-docker.sh\n\n}\nSYSTEM_NAME=\"$(awk -F= '/^NAME/{print $2}' /etc/os-release)\"\nif [[ \"${SYSTEM_NAME,,}\" =~ \"ubuntu\"  ]] ; then\necho \"Your system is ubuntu.\"\necho \"Installing Docker in ubuntu...\"\ninstall_docker_in_ubuntu\nelif [[ \"${SYSTEM_NAME,,}\" =~ \"centos\" ]] ; then\necho \"Your system is centos.\"\necho \"Installing Docker in centos...\"\ninstall_docker_in_centos\nelse\necho \"This script can only run in ubuntu and centos system.\"\nexit 1\nfi\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#16-\u5907\u4efdmongodb","title":"16. \u5907\u4efdMongoDB","text":"<pre><code>#!/bin/bash\n#backup mongodb\n. /etc/profile\nCMD=`which mongodump`\nDATE=`date +%F`\nDB=\"test\"\nDB_HOST=\"localhost\"\nDB_PORT=\"27017\"\nDB_USER=\"testuser\"\nDB_PWD=\"testpass\"\nBACKUP_DIR=\"/data/mongodb/\"\nTAR_DIR=\"/data/tardir/\"\nTAR_DIR_DATE=\"${TAR_DIR}${DATE}\"\nTAR_BAK=\"mongodb_bak_$DATE.tar.gz\"\ncheck_dir(){\nfor DIR in ${BACKUP_DIR} ${TAR_DIR_DATE}\ndo\nif [ ! -d $DIR ];then\nmkdir -p $DIR\nfi\ndone\n}\nbackup_mongodb(){\n$CMD -h ${DB_HOST}:${DB_PORT} -u $DB_USER -p $DB_PWD -d ${DB} -o ${BACKUP_DIR}${DATE} &gt;/dev/null\n    if [ $? -eq 0 ];then\ntar -zcf ${TAR_DIR_DATE}/${TAR_BAK} ${BACKUP_DIR}${DATE} &amp;&amp; return 0\nfi\n}\nclean_tar() {\nfind ${TAR_DIR} -mtime +7 -exec rm -rf {} \\; &amp;&amp; return 0\n}\nmain() {\ncheck_dir\n    [ $? -eq 0 ] &amp;&amp; backup_mongodb\n    [ $? -eq 0 ] &amp;&amp; clean_tar\n}\nmain\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#17linux\u4e0b\u4ee5\u79d2\u4e3a\u5355\u4f4d\u6267\u884c\u811a\u672c","title":"17.Linux\u4e0b\u4ee5\u79d2\u4e3a\u5355\u4f4d\u6267\u884c\u811a\u672c","text":""},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#example1","title":"example1","text":"<pre><code>\u5199\u4e00\u4e2a\u89e6\u53d1\u7684\u811a\u672c\uff0c\u5728\u89e6\u53d1\u811a\u672c\u4e2d\u4f7f\u7528\u6b7b\u5faa\u73af\u6765\u89e3\u51b3\u6b64\u95ee\u9898\n[root@test ~]# cat kevin.sh\n#!/bin/bash\nwhile : ;do\necho \"beijing is so good!\" &gt;&gt; /root/test.log\nsleep 2\ndone\n[root@test ~]# chmod 755 kevin.sh\n\u53ef\u4ee5\u628a\u5b83\u653e\u5230\u8ba1\u5212\u4efb\u52a1\u4f7f\u5176\u8fd0\u884c\n[root@test ~]# crontab -e\n* * * * * /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n\u7b49\u5f85\u8fd9\u4e2a\u8ba1\u5212\u4efb\u52a1\u6267\u884c\u540e\uff0c\u5c31\u5c06\u8ba1\u5212\u4efb\u52a1\u4e2d\u7684\u6b64\u6761\u76ee\u5220\u9664\u6216\u6ce8\u91ca\uff01\u9632\u6b62\u8be5\u8ba1\u5212\u6761\u76ee\u65e0\u9650\u5236\u5730\u6267\u884c\u4e0b\u53bb\uff08\u53ea\u9700\u6267\u884c\u4e00\u6b21\u5c31\u53ef\u4ee5\uff0c\u56e0\u4e3akevin.sh\u811a\u672c\u91cc\u672c\u8eab\u5c31\u6709\u6b7b\u5faa\u73af\uff09\n[root@test ~]# ps -ef|grep kevin.sh\nroot     29839 29835  0 16:05 ?        00:00:00 /bin/sh -c /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\nroot     29842 29839  0 16:05 ?        00:00:00 /bin/bash -x /root/kevin.sh\nroot     29852 16356  0 16:05 pts/0    00:00:00 grep kevin.sh\n\n[root@test ~]# crontab -e\n#* * * * * /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n\u6700\u540e\u628a\u8fd9\u4e2a\u811a\u672c\u653e\u5230 /etc/rc.local \u8ba9\u5b83\u6bcf\u6b21\u5f00\u673a\u90fd\u53ef\u4ee5\u88ab\u8fd0\u884c\n[root@test ~]# vim /etc/rc.local\n/bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n\u9a8c\u8bc1\uff08\u67e5\u770b\u662f\u4e0d\u662f\u6bcf\u96942\u79d2\u5728/root/test.log\u6587\u4ef6\u4e2d\u5199\u5165\u4e86\uff09\n[root@test ~]# tail -f /root/test.log\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#example2","title":"example2","text":"<pre><code>[root@test ~]# vim kevin.sh\n#!/bin/bash\nfor((i=1;i&lt;=20;i++));do\necho \"beijing is so good!\" &gt;&gt; /root/test.log\nsleep 2\ndone\n\u7136\u540e\u6dfb\u52a0\u811a\u672c\u6267\u884c\u6743\u9650\uff0c \u5199\u5165\u7684crontab\u91cc\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21\n[root@test ~]# chmod 755 kevin.sh\n[root@test ~]# crontab -e\n* * * * * /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n[root@test ~]# ps -ef|grep kevin.sh\nroot     30515 30514  0 16:27 ?        00:00:00 /bin/sh -c /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\nroot     30516 30515  0 16:27 ?        00:00:00 /bin/bash -x /root/kevin.sh\nroot     30527 16356  0 16:27 pts/0    00:00:00 grep kevin.sh\n\n[root@test ~]# tail -f /root/test.log\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\n.......\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#example3","title":"example3","text":"<ul> <li>\u4f7f\u7528crontab\u8ba1\u5212\u4efb\u52a1\u6765\u76f4\u63a5\u5b9e\u73b0\uff01\u7ecf\u9a8c\u8bc1\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u6700\u9760\u8c31\uff0c\u6700\u7a33\u59a5\u7684\uff01</li> </ul> <pre><code>[root@test ~]# cat /root/kevin.sh\n#!/bin/bash\necho \"beijing is so good!\" &gt;&gt; /root/test.log\n\n\u6dfb\u52a0\u811a\u672c\u6267\u884c\u6743\u9650\uff0c\u5e76\u914d\u7f6e\u5230crontab\u8ba1\u5212\u4efb\u52a1\u91cc\uff08\u4f7f\u7528&amp;&amp; \u6216\u8005 \uff1b\u90fd\u662f\u4e00\u6837\u7684\u6548\u679c\uff09\u3002\u601d\u8def\uff1a\u5148\u8fc7\u4e00\u5206\u949f\u6267\u884c\u7b2c\u4e00\u6b21\uff0c\u63a5\u7740\u5c31\u662f\u6bcf\u96942\u79d2\u949f\u6267\u884c\u4e00\u6b21\u3002\n[root@test ~]# chmod 755 /root/kevin.sh\n[root@test ~]# crontab -e\n* * * * * /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 2 &amp;&amp;  /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 4; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 6; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 8; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 10; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 12; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 14; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 16; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 18; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 20; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 22; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 24; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 26; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 28; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 30; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 32; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 34; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 36; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 38; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 40; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 42; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 44; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 46; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 48; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 50; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 52; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 54; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 56; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n* * * * * sleep 58; /bin/bash -x /root/kevin.sh &gt;/dev/null 2&gt;&amp;1\n[root@test ~]# tail -f /root/test.log\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\nbeijing is so good!\n</code></pre> <p>\u4e00\u4e2a\u53d6\u5de7\u7684\u65b9\u6cd5\u5982\u4e0b\u3002</p> <p>\u884c\u79d2\u7ea7\u7684\u5b9a\u65f6\u4efb\u52a1</p> <pre><code>* * * * * cmd\n* * * * * sleep 20; cmd\n* * * * * sleep 40; cmd\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#18\u5907\u4efd\u6587\u4ef6","title":"18.\u5907\u4efd\u6587\u4ef6","text":"<ul> <li>Auto_Backup_Linux_System_Files.sh</li> </ul> <pre><code>#!/usr/bin/env bash\nSOURCE_DIR=(\n$*\n)\nTARGET_DIR=/data/backup/\nYEAR=`date +%Y`\nMONTH=`date +%m`\nDAY=`date +%d`\nWEEK=`date +%u`\nFILES=system_backup.tgz\nCODE=$?\nif [ -z \"$*\" ]; then\necho -e \"\\033[32mUsage:\\nPlease Ebter Your Backup Files or Directories\\n--------------------------------------------\\n\n    \\nUsage:{ $0 /boot/etc}\\033[0m\"\nexit\nfi\n# Deternube Wgether the Target Directory Exists\nif [ ! -d $TARGET_DIR ]; then\nmkdir -p $TARGET_DIR/$YEAR/$MONTH/$DAY\necho -e \"\\033[32mThe $TARGET_DIR Create Successfully ! \\033[0m\"\nfi\n#EXEC Full_Backup Function Command\n#EXEC Full_Backup Function Command\nFull_Backup()\n{\nif\n[ \"$WEEK\" -eq \"7\" ];then\nrm -rf $TARGET_DIR/snapshot\n    cd $TARGET_DIR/$YEAR/$MONTH/$DAY ;tar -g $TARGET_DIR/snapshot -czvf $FILES `echo ${SOURCE_DIR[@]}`\n[ \"$CODE\" == \"0\" ]&amp;&amp;echo -e  \"--------------------------------------------\\nFull_Backup System Files Backup Successfully !\"\nfi\n}\n#Perform incremental BACKUP Function Command\nAdd_Backup()\n{\ncd $TARGET_DIR/$YEAR/$MONTH/$DAY ;\nif\n[ -f $TARGET_DIR/$YEAR/$MONTH/$DAY/$FILES ];then\nread -p \"$FILES Already Exists, overwrite confirmation yes or no ? : \" SURE\n    if [ $SURE == \"no\" -o $SURE == \"n\" ];then\nsleep 1;exit 0\nfi\n#Add_Backup Files System\nif\n[ $WEEK -ne \"7\" ];then\ncd $TARGET_DIR/$YEAR/$MONTH/$DAY;tar -g $TARGET_DIR/snapshot -czvf $$_$FILES `echo ${SOURCE_DIR[@]}`\n[ \"$CODE\" == \"0\" ]&amp;&amp;echo -e  \"-----------------------------------------\\n\\033[32mAdd_Backup System Files Backup Successfully !\\033[0m\"\nfi\nelse\nif\n[ $WEEK -ne \"7\" ];then\ncd $TARGET_DIR/$YEAR/$MONTH/$DAY ;tar -g $TARGET_DIR/snapshot -czvf $FILES `echo ${SOURCE_DIR[@]}`\n[ \"$CODE\" == \"0\" ]&amp;&amp;echo -e  \"-------------------------------------------\\n\\033[32mAdd_Backup System Files Backup Successfully !\\033[0m\"\nfi\nfi\n}\nFull_Backup\nAdd_Backup\n\n# crontab\u8ba1\u5212\u4efb\u52a1\u4e2d\u52a0\u5165\u5982\u4e0b\u8bed\u53e5\uff0c\u6bcf\u5929\u51cc\u66681\u70b9\u6574\u6267\u884c\u5907\u4efd\u811a\u672c\u3002\n# 0 1 *  *  * /bin/sh /data/sh/Auto_Backup_Linux_System_Files.sh /boot /etc/ &gt;&gt; /tmp/back.log 2&gt;&amp;1\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#19\u4fee\u6539ip_\u4e3b\u673a\u540d_\u7f51\u5361\u4fe1\u606f","title":"19.\u4fee\u6539IP_\u4e3b\u673a\u540d_\u7f51\u5361\u4fe1\u606f","text":"<pre><code>#!/usr/bin/env bash\n#\u9759\u6001IP\u4fee\u6539\n#\u52a8\u6001IP\u4fee\u6539\n#\u6839\u636eIP\u751f\u4ea7\u4e3b\u673a\u540d\u5e76\u914d\u7f6e\n#\u4fee\u6539DNS\u57df\u540d\u89e3\u6790\nETHCONF=/etc/sysconfig/network-scripts/ifcfg-ens32\nHOSTS=/etc/hosts\nNETWORK=/etc/sysconfig/network\nDIR=/data/backup/`date +%Y%m%d`\nNETMASK=255.255.255.0\necho \"------------------------------------------------------------------\"\njudeg_ip(){\nread -p \"Please enter ip Address,example 192.168.0.11 ip\":IPADDR\n    echo $IPADDR|grep -v \"[Az-Zz]\"|grep --color -E \"([0-9]{1,3}\\.){3}[0-9]{1,3}\"\n}\ncount_ip(){\ncount=(`echo ${IPADDR}|awk -F. '{print $1,$2,$3,$4}'`)\nIP1=${count[0]}\nIP2=${count[1]}\nIP3=${count[2]}\nIP4=${count[3]}\n}\nip_check(){\njudeg_ip\n\nwhile [ \"$?\" -ne 0 ]; do\njudeg_ip\ndone\ncount_ip\nwhile [ \"$IP1\" -lt 0 -o \"$IP1\" -ge 255 -o \"$IP2\" -ge 255 -o \"$IP3\" -ge 255 -o \"$IP4\" -ge 255 ]; do\njudeg_ip\n    while [ \"$?\" -ne 0 ]; do\njudeg_ip\n    done\ncount_ip\ndone\n}\nchange_ip(){\nif [ ! -d $DIR ]; then\nmkdir -p $DIR\nfi\necho \"The Change ip address to Backup Interface eth0\"\ncp $ETHCONF $DIR\ngrep \"dhcp\" $ETHCONF\nif [ \"$?\" -eq 0 ]; then\nread -p \"Please enter ip Address:\" IPADDR\n    sed -i 's/dhcp/static/g' $ETHCONF\necho -e \"IPADDR=$IPADDR\\nNERMASK=$NETMASK\\nGATEWAY=`echo $IPADDR|awk -F. '{print $1\".\"$2\".\"$3}'`.2\" &gt;&gt; $ETHCONF\necho \"The IP configuration success. !\"\nelse\necho -n \"Static IP has been configured,please confirm whether to modify,yes or No\";\nread i\nfi\nif [ \"$i\" == \"y\" -o \"$i\" == \"yes\" ]; then\nip_check\n    sed -i -e '/IPADDR/d' -e '/NETMASK/d' -e '/GATEWAY/d' $ETHCONF\necho -e \"IPADDR=$IPADDR\\nNETMASK=$NETMASK\\nGATEWAY=`echo  $IPADDR|awk -F. '{print $1\".\"$2\".\"$3}'`.2\" &gt;&gt; $ETHCONF\necho \"The IP configuration success. !\"\necho\nelse\necho \"Static IP already exists,please exit.\"\necho $?\nfi\n}\nchange_hosts(){\nif [ ! -d $DIR ]; then\nmkdir -p $DIR\nfi\ncp $HOSTS $DIR\nip_check\n    host=`echo $IPADDR|sed 's/\\./-/g'|awk '{print \"BJ-IDC-\" $0 \"-Hujianli.net\"}'`\ncat $HOSTS|grep \"$host\"\nif [ \"$?\" -ne 0 ]; then\necho \"$IPADDR    $host\" &gt;&gt; $HOSTS\necho \"The hosts modify success\"\nfi\ngrep \"$host\" $NETWORK\nif [ \"$?\" -ne 0 ]; then\nsed -i 's/^HOSTNAME/#HOSTNAME/g' $NETWORK\necho \"NETWORK=$host\" &gt;&gt; $NETWORK\nhostname $host;su\n    fi\n}\nPS3=\"Please Select configuration ip or configuration host:\"\nselect i in \"modify_ip\" \"modify_hosts\" \"exit\"\ndo\ncase \"$i\" in\nmodify_ip)\nchange_ip\n       ;;\nmodify_hosts)\nchange_hosts\n       ;;\nexit)\nexit\n;;\n*)\necho -e \"1)modify_ip\\n2)modify_host\\n3)exit\"\nesac\ndone\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#20\u68c0\u67e5\u6076\u610fip\u767b\u5f55\u62d2\u7eddssh","title":"20.\u68c0\u67e5\u6076\u610fIP\u767b\u5f55\uff0c\u62d2\u7eddSSH","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\nSEC_FILE=/var/log/secure\nIP_ADDR=`awk '{print $0}' /var/log/secure |grep -i \"fail\"|egrep -o \"([0-9]{1,3}\\.){3}[0-9]{1,3}\"|sort -nr|uniq -c|awk '$1&gt;=15 {prin\nt $2}'`\nIPTABLE_CONF=/etc/sysconfig/iptables\necho\ncat &lt;&lt;EOF\n+++++++++++++++++++++++++++++++++++++= Welcome to yse ssh login drop failed ip ++++++++++++++++++++++++++++++\n++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n+++++++++++++++++++++++++++++++++++-----------------------------------------------=++++++++++++++++++++++++++\nEOF\necho\nfor (( VAR = 0; VAR &lt;=6 ; ++VAR )); do echo -n \"-\";sleep 1;done\necho\nfor i in `cat $IP_ADDR` ; do\ncat $IPTABLE_CONF|grep $i &gt; /dev/null\n    if [ \"$?\" -ne 0 ]; then\nsed -i \"/lo/a -A INPUT -s $i -m state --state NEW -m tcp -p tcp --dport 22 -j DROP\" $IPTABLE_CONF\nfi\ndone\nNUM=`find /etc/sysconfig/ - name -a -mmin -1|wc -l `\nif test \"$NUM\" -eq 1; then\n/etc/init.d/iptables restart\nfi\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#21\u6570\u636e\u5e93\u5907\u4efd","title":"21.\u6570\u636e\u5e93\u5907\u4efd","text":""},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u5907\u4efd\u6570\u636e\u5e93","title":"\u5907\u4efd\u6570\u636e\u5e93","text":"<pre><code>#!/bin/bash\n#\n# Filename:\n# backupdatabase.sh\n# Description:\n# backup cms database and remove backup data before 7 days\n# crontab\n# 55 23 * * * /bin/sh /yundisk/cms/crontab/backupdatabase.sh &gt;&gt; /yundisk/cms/crontab/backupdatabase.log 2&gt;&amp;1\nDATE=`date +%Y-%m-%d`\nOLDDATE=`date +%Y-%m-%d -d '-7 days'`\n#MYSQL=/usr/local/mysql/bin/mysql\n#MYSQLDUMP=/usr/local/mysql/bin/mysqldump\n#MYSQLADMIN=/usr/local/mysql/bin/mysqladmin\nBACKDIR=/yundisk/cms/database\n[ -d ${BACKDIR} ] || mkdir -p ${BACKDIR}\n[ -d ${BACKDIR}/${DATE} ] || mkdir ${BACKDIR}/${DATE}\n[ ! -d ${BACKDIR}/${OLDDATE} ] || rm -rf ${BACKDIR}/${OLDDATE}\nmysqldump --default-character-set=utf8 --no-autocommit --quick --hex-blob --single-transaction -uroot  cms_production  | gzip &gt; ${BACKDIR}/${DATE}/cms-backup-${DATE}.sql.gz\necho \"Database cms_production and bbs has been backup successful\"\n/bin/sleep 5\naws s3 cp ${BACKDIR}/${DATE}/* s3://example-share/cms/databackup/\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>\u4f7f\u7528mysqldump\u8fdb\u884cmysql\u6570\u636e\u5e93\u5907\u4efd\u7684\u5b8c\u6574shell Linux\u5b9a\u65f6\u5907\u4efd\u6570\u636e\u5e93\u5230COS</p>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#mysql\u5b9a\u65f6\u5907\u4efd\u811a\u672c","title":"MySQL\u5b9a\u65f6\u5907\u4efd\u811a\u672c","text":"<p><pre><code>#!/bin/bash\n# \u521d\u59cb\u5316\u65f6\uff0c\u521b\u5efa\u76f8\u5e94\u76ee\u5f55\n# mkdir /home/node/bakmysql/sql/\n# \u5b9a\u65f6\u4efb\u52a1\n# \u6bcf\u5929\u51cc\u66681:00\u6267\u884c\u5907\u4efd\u811a\u672c\n#0 1 * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1\n#2\u5206\u949f\u8fd0\u884c\u4e00\u6b21-\u6d4b\u8bd5\u7528\n#*/2 * * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1\nBakDir=/home/node/bakmysql/sql\nLogFile=/home/node/bakmysql/sql/bak.log\nDate=`date +%Y%m%d`\nBegin=`date +\"%Y\u5e74%m\u6708%d\u65e5 %H:%M:%S\"`\ncd $BakDir\nDumpFile=$Date.sql\n\n# \u5bfc\u51fa\u5230\u672c\u5730\nmysqldump -uroot -p123456 test --quick --single-transaction | gzip &gt; $DumpFile.gz\nLast=`date +\"%Y\u5e74%m\u6708%d\u65e5 %H:%M:%S\"`\necho [FullBack] \u5f00\u59cb:$Begin \u7ed3\u675f:$Last $DumpFile.gz successful &gt;&gt; $LogFile\n# \u5220\u96647\u5929\u524d\u7684\u5907\u4efd\u6587\u4ef6\nfind $BakDir -mtime +7 -type f -name \"*.sql.gz\" | xargs rm -f\n</code></pre> \u4f60\u9700\u8981\u505a\u7684\u5c31\u662f\u4fee\u6539\u6570\u636e\u5e93\u914d\u7f6e\uff0c\u7136\u540e\u5c31\u662f\u914d\u7f6e\u4e00\u4e0b\u5b9a\u65f6\u4efb\u52a1\u5373\u53ef</p>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#mysql\u6570\u636e\u5e93\u5206\u5e93\u5907\u4efd","title":"MySQL\u6570\u636e\u5e93\u5206\u5e93\u5907\u4efd","text":"<p>\u6570\u636e\u5e93\u5bc6\u7801\u4fdd\u5b58\u5728/etc/my.cnf\u6587\u4ef6\u4e2d\uff0c\u6240\u4ee5\u5728\u6267\u884c\u4e0emysql\u76f8\u5173\u7684\u547d\u4ee4\u4e0d\u9700\u8981\u8f93\u5165\u5bc6\u7801</p> <p>\u5206\u5e93\u5907\u4efd\u601d\u8def\uff1a <pre><code>mysqldump  db1 &gt;db1.sql.gz\nmysqldump  db2 &gt;db2.sql.gz\n</code></pre></p> <p>\u62ff\u5230\u5e93\u540d <pre><code>mysql  -e 'show databases' |sed '1d' |grep -v \"_schema\"\n</code></pre></p> <p>\u6ce8\u610f\u770b\u6ce8\u91ca\u4fe1\u606f</p> <pre><code>#!/bin/bash\n# author: xiongminghao\n# mail: jasonminghao@163.com\n# describe\uff1aMysql database backup\n# \u5b9a\u4e49\u53d8\u91cf\nIP=$(ifconfig eth1 |awk 'NR==2{print $2}')\nPath=/backup/database  # \u5907\u4efd\u76ee\u5f55\u8def\u5f84\nTime=$(date +%F)\nBa_Path=$Path/$Time\nBa_Logs=/var/log/db_database_$Time # \u5b9a\u4e49\u4e00\u4e2a\u5b58\u653e\u65e5\u5fd7\u7684\u6587\u4ef6\nMd5_Path=$Path/$Time/md5 # \u5b9a\u4e49\u4e00\u4e2a\u5b58\u653emd5\u6821\u9a8c\u7684\u76ee\u5f55\n# \u521b\u5efa\u4e24\u4e2a\u76ee\u5f55\u4ee5\u5f53\u5929\u65f6\u95f4\u4e3a\u547d\u540d\n[ ! -d $Ba_Path ] &amp;&amp; mkdir $Ba_Path\n[ ! -d $Md5_Path ] &amp;&amp; mkdir $Md5_Path\n# \u5faa\u73af\u83b7\u53d6\u6570\u636e\u5e93\u540d\u8fdb\u884c\u5907\u4efd\u548c\u751f\u6210MD5\u6821\u9a8c\u6587\u4ef6\nfor dbname in `mysql  -e 'show databases' |sed '1d' |grep -v \"_schema\"`\ndo\n# \u5224\u65ad\u662f\u5426\u6709\u6570\u636e\u5e93\u5df2\u7ecf\u5907\u4efd\u4e86,\u5982\u679c\u5907\u4efd\u4e86\u5219continue \u8c03\u51fa\u5f53\u6b21\u5faa\u73af\uff0c\u5426\u5219\u8fdb\u884c\u5907\u4efd\nif [ ! -f $Ba_Path/${dbname}.sql.gz ];then\n# \u5907\u4efd\u53c2\u6570\n# -B \u589e\u52a0use[name]\u8bed\u53e5, -R \u5907\u4efd\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u6570\u636e\n# --master=data2 \u8bb0\u5f55\u5907\u4efd\u65f6\u523b\u7684binlog\u4f4d\u7f6e\u70b9\uff0c2\u8868\u793a\u5c06\u5176\u4f4d\u7f6e\u70b9\u6ce8\u91ca\n# --single-ransaction \u5bf9innodb\u5f15\u64ce\u8fdb\u884c\u70ed\u5907\uff08\u5bf9\u6570\u636e\u8fdb\u884c\u5feb\u7167\uff09\n# gzip \u5bf9\u5907\u4efd\u7684\u6570\u636e\u8fdb\u884cgzip\u538b\u7f29\nmysqldump  -B -R --master-data=2 --single-transaction  |gzip &gt;$Ba_Path/${dbname}.sql.gz\n   RETVAL=$?\n# \u901a\u8fc7\u8fd4\u56de\u503c\u5224\u65ad\u5907\u4efd\u662f\u5426\u6267\u884c\u6210\u529f,\u628a\u6267\u884c\u7684\u6210\u529f\u4e0e\u5426\u7eaa\u5f55\u5230\u65e5\u5fd7\u4e2d\n[ $? -eq 0 ] &amp;&amp; echo \"${dbname} successful\" &gt;&gt;$Ba_Logs || echo \"${dbname} failed\" &gt;&gt;$Ba_Logs\n# \u5bf9\u6570\u636e\u5e93\u7684\u6570\u636e\u5b8c\u6574\u6027\u505aMD5\u6821\u9a8c\nmd5sum $Ba_Path/${dbname}.sql.gz  &gt;$Md5_Path/${dbname}_md5.log\n\nelse\n# \u5982\u679c\u5907\u4efd\u5df2\u5b58\u5728\u5219\u8df3\u51fa\u5f53\u6b21\u5faa\u73af,\u8fdb\u884c\u4e0b\u6b21\u5faa\u73af\ncontinue\nfi\ndone\n# \u5c06\u5907\u4efd\u65e5\u5fd7\u7ed3\u679c\u90ae\u4ef6\u65b9\u5f0f\u53d1\u9001\u7ed9\u7ba1\u7406\u5458\nmail -s \"$HOSTNAME $IP\" jasonminghao@163.com &lt; $Ba_Logs\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#mysql\u6570\u636e\u5e93\u5206\u5e93\u5206\u8868\u5907\u4efd","title":"MySQL\u6570\u636e\u5e93\u5206\u5e93\u5206\u8868\u5907\u4efd","text":"<p>\u6570\u636e\u5e93\u5bc6\u7801\u4fdd\u5b58\u5728/etc/my.cnf\u6587\u4ef6\u4e2d\uff0c\u6240\u4ee5\u5728\u6267\u884c\u4e0emysql\u76f8\u5173\u7684\u547d\u4ee4\u4e0d\u9700\u8981\u8f93\u5165\u5bc6\u7801</p> <p>\u5206\u5e93\u5206\u8868\u5907\u4efd\u601d\u8def\uff1a</p> <p>\u5e93\u540ddb1\uff0c\u4e24\u5f20\u8868 <pre><code>mysqldump  db1 table01 &gt;db1_table01.sql.gz\nmysqldump  db1 table02 &gt;db1_table01.sql.gz\n</code></pre></p> <p>\u5e93\u540ddb2\uff0c\u4e24\u5f20\u8868 <pre><code>mysqldump  db2 table01 &gt;db2_table01.sql.gz\nmysqldump  db2 table02 &gt;db2_table02.sql.gz\n</code></pre></p> <p>\u62ff\u5230\u8868\u540d\u5217\u8868 <pre><code>mysql  -e \"show tables from db1;\" |sed 1d\n</code></pre></p> <p>\u6ce8\u610f\u770b\u6ce8\u91ca\u4fe1\u606f</p> <pre><code>#!/bin/bash\n# author: xiongminghao\n# mail: jasonminghao@163.com\n# describe\uff1aMysql database table backup\n# \u5b9a\u4e49\u53d8\u91cf\nIP=$(ifconfig eth1 |awk 'NR==2{print $2}')\nPath=/backup/table # \u5907\u4efd\u76ee\u5f55\nTime=$(date +%F)\nBa_Path=$Path/$Time\nBa_Logs=/var/log/db_table_$Time  # \u5b9a\u4e49\u4e00\u4e2a\u5b58\u653e\u65e5\u5fd7\u7684\u6587\u4ef6\nMd5_Path=$Path/$Time/md5 # \u5b9a\u4e49\u4e00\u4e2a\u5b58\u653emd5\u6821\u9a8c\u7684\u76ee\u5f55\n# \u521b\u5efa\u4e24\u4e2a\u76ee\u5f55\u4ee5\u5f53\u5929\u65f6\u95f4\u4e3a\u547d\u540d\n[ ! -d $Ba_Path ] &amp;&amp; mkdir $Ba_Path\n[ ! -d $Md5_Path ] &amp;&amp; mkdir $Md5_Path\n# \u5faa\u73af\u83b7\u53d6\u6570\u636e\u5e93\u540d\nfor dbname in `mysql  -e 'show databases' |sed '1d' |grep -v \"_schema\"`\ndo\n# \u5faa\u73af\u83b7\u53d6\u5230\u6570\u636e\u5e93\u540d\u540e\u518d\u6b21\u5faa\u73af\u83b7\u53d6\u5230\u8be5\u5e93\u540d\u4e0b\u7684\u8868\uff0c\u8fdb\u884c\u5907\u4efd\u548cMD5\u6821\u9a8c\nfor tablename in `mysql -e \"show tables from $dbname\" |sed '1d'`\ndo\n# \u5224\u65ad\u662f\u5426\u6709\u8868\u5df2\u7ecf\u5907\u4efd\u4e86,\u5982\u679c\u5907\u4efd\u4e86\u5219continue \u8c03\u51fa\u5f53\u6b21\u5faa\u73af\uff0c\u5426\u5219\u8fdb\u884c\u5907\u4efd\nif [ ! -f $Ba_Path/${dbname}_${tablename}.sql.gz ];then\nmysqldump -R --master-data=2 --single-transaction  ${dbname} ${tablename} |gzip &gt;$Ba_Path/${dbname}_${tablename}.sql.gz\n   RETVAL=$?\n# \u901a\u8fc7\u8fd4\u56de\u503c\u5224\u65ad\u5907\u4efd\u662f\u5426\u6267\u884c\u6210\u529f,\u628a\u6267\u884c\u7684\u6210\u529f\u4e0e\u5426\u7eaa\u5f55\u5230\u65e5\u5fd7\u4e2d\n[ $? -eq 0 ] &amp;&amp; echo \"${dbname}_${tablename} successful\" &gt;&gt;$Ba_Logs || echo \"${dbname}_${tablename} failed\" &gt;&gt;$Ba_Logs\n# \u5bf9\u8868\u7684\u6570\u636e\u5b8c\u6574\u6027\u505aMD5\u6821\u9a8c\nmd5sum $Ba_Path/${dbname}_${tablename}.sql.gz  &gt;$Md5_Path/${dbname}_${tablename}_md5.log\n\nelse\ncontinue\nfi\ndone\ndone\n# \u5c06\u5907\u4efd\u65e5\u5fd7\u7ed3\u679c\u90ae\u4ef6\u65b9\u5f0f\u53d1\u9001\u7ed9\u7ba1\u7406\u5458\nmail -s \"$HOSTNAME $IP\" jasonminghao@163.com &lt; $Ba_Logs\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#22\u5f00\u673a\u6027\u80fd\u4f18\u5316","title":"22.\u5f00\u673a\u6027\u80fd\u4f18\u5316","text":"<pre><code>#!/bin/bash\n#\u6dfb\u52a0epel\u5916\u90e8yum\u6269\u5c55\u6e90\ncd /usr/local/src\nwget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\nrpm -ivh epel-release-6-8.noarch.rpm\n#\u5b89\u88c5gcc\u57fa\u7840\u5e93\u6587\u4ef6\u4ee5\u53casysstat\u5de5\u5177\nyum -y install gcc gcc-c++ vim-enhanced unzip unrar sysstat\n#\u914d\u7f6entpdate\u81ea\u52a8\u5bf9\u65f6\nyum -y install ntp\necho \"01 01 * * * /usr/sbin/ntpdate ntp.api.bz    &gt;&gt; /dev/null 2&gt;&amp;1\" &gt;&gt; /etc/crontab\nntpdate ntp.api.bz\nservice crond restart\n#\u914d\u7f6e\u6587\u4ef6\u7684ulimit\u503c\nulimit -SHn 65535\necho \"ulimit -SHn 65535\" &gt;&gt; /etc/rc.local\ncat&gt;&gt; /etc/security/limits.conf &lt;&lt; EOF\n*                     soft     nofile             65535\n*                     hard     nofile             65535\nEOF\n#\u57fa\u7840\u7cfb\u7edf\u5185\u6838\u4f18\u5316\ncat&gt;&gt; /etc/sysctl.conf &lt;&lt; EOF\nfs.file-max=419430\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_syn_retries = 1\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_fin_timeout = 1\nnet.ipv4.tcp_keepalive_time = 1200\nnet.ipv4.ip_local_port_range = 1024 65535\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.route.gc_timeout = 100\nnet.ipv4.tcp_syn_retries = 1\nnet.ipv4.tcp_synack_retries = 1\nnet.core.somaxconn = 16384\nnet.core.netdev_max_backlog = 16384\nnet.ipv4.tcp_max_orphans = 16384\nEOF\n/sbin/sysctl -p\n\n#\u7981\u7528control-alt-delete\u7ec4\u5408\u952e\u4ee5\u9632\u6b62\u8bef\u64cd\u4f5c\nsed -i 's@ca::ctrlaltdel:/sbin/shutdown -t3 -r now@#ca::ctrlaltdel:/sbin/shutdown -t3 -r now@' /etc/inittab\n#\u5173\u95edSElinux\nsed -i 's@SELINUX=enforcing@SELINUX=disabled@' /etc/selinux/config\n#\u5173\u95ediptables\nservice iptables stop\nchkconfig iptables off\n#ssh\u670d\u52a1\u914d\u7f6e\u4f18\u5316,\u8bf7\u81f3\u5c11\u4fdd\u6301\u673a\u5668\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u5177\u6709sudo\u6743\u9650\u7684\u7528\u6237\uff0c\u4e0b\u9762\u7684\u914d\u7f6e\u4f1a\u7981\u6b62root\u8fdc\u7a0b\u767b\u5f55\nsed -i 's@#PermitRootLogin yes@PermitRootLogin no@' /etc/ssh/sshd_config #\u7981\u6b62root\u8fdc\u7a0b\u767b\u5f55\nsed -i 's@#PermitEmptyPasswords no@PermitEmptyPasswords no@' /etc/ssh/sshd_config #\u7981\u6b62\u7a7a\u5bc6\u7801\u767b\u5f55\nsed -i 's@#UseDNS yes@UseDNS no@' /etc/ssh/sshd_config /etc/ssh/sshd_config\nservice sshd restart\n#\u7981\u7528ipv6\u5730\u5740\necho \"alias net-pf-10 off\" &gt;&gt; /etc/modprobe.d/dist.conf\necho \"alias ipv6 off\" &gt;&gt; /etc/modprobe.d/dist.conf\nchkconfig ip6tables off\n#vim\u57fa\u7840\u8bed\u6cd5\u4f18\u5316\necho \"syntax on\" &gt;&gt; /root/.vimrc\necho \"set nohlsearch\" &gt;&gt; /root/.vimrc\n#\u7cbe\u7b80\u5f00\u673a\u81ea\u542f\u52a8\u670d\u52a1\uff0c\u5b89\u88c5\u6700\u5c0f\u5316\u670d\u52a1\u7684\u673a\u5668\u521d\u59cb\u53ef\u4ee5\u53ea\u4fdd\u7559crond\uff0cnetwork\uff0crsyslog\uff0csshd\u8fd9\u56db\u4e2a\u670d\u52a1\u3002\nfor i in `chkconfig --list|grep 3:on|awk '{print $1}'`;do chkconfig --level 3 $i off;done\nfor CURSRV  in crond rsyslog sshd network;do chkconfig --level 3 $CURSRV on;done\n#\u91cd\u542f\u670d\u52a1\u5668\nreboot\n</code></pre> <p>\u670d\u52a1\u5668\u7cfb\u7edf\u914d\u7f6e\u521d\u59cb\u5316\u811a\u672c <pre><code>#/bin/bash\n# \u8bbe\u7f6e\u65f6\u533a\u5e76\u540c\u6b65\u65f6\u95f4\nln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nif ! crontab -l |grep ntpdate &amp;&gt;/dev/null ; then\n(echo \"* 1 * * * ntpdate time.windows.com &gt;/dev/null 2&gt;&amp;1\";crontab -l) |crontab\nfi\n# \u7981\u7528selinux\nsed -i '/SELINUX/{s/permissive/disabled/}' /etc/selinux/config\n\n# \u5173\u95ed\u9632\u706b\u5899\nif egrep \"7.[0-9]\" /etc/redhat-release &amp;&gt;/dev/null; then\nsystemctl stop firewalld\n    systemctl disable firewalld\nelif egrep \"6.[0-9]\" /etc/redhat-release &amp;&gt;/dev/null; then\nservice iptables stop\n    chkconfig iptables off\nfi\n# \u5386\u53f2\u547d\u4ee4\u663e\u793a\u64cd\u4f5c\u65f6\u95f4\nif ! grep HISTTIMEFORMAT /etc/bashrc; then\necho 'export HISTTIMEFORMAT=\"%F %T `whoami` \"' &gt;&gt; /etc/bashrc\nfi\n# SSH\u8d85\u65f6\u65f6\u95f4\nif ! grep \"TMOUT=600\" /etc/profile &amp;&gt;/dev/null; then\necho \"export TMOUT=600\" &gt;&gt; /etc/profile\nfi\n# \u7981\u6b62root\u8fdc\u7a0b\u767b\u5f55\nsed -i 's/#PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config\n\n# \u7981\u6b62\u5b9a\u65f6\u4efb\u52a1\u5411\u53d1\u9001\u90ae\u4ef6\nsed -i 's/^MAILTO=root/MAILTO=\"\"/' /etc/crontab\n\n# \u8bbe\u7f6e\u6700\u5927\u6253\u5f00\u6587\u4ef6\u6570\nif ! grep \"* soft nofile 65535\" /etc/security/limits.conf &amp;&gt;/dev/null; then\ncat &gt;&gt; /etc/security/limits.conf &lt;&lt; EOF\n    * soft nofile 65535\n    * hard nofile 65535\nEOF\nfi\n# \u7cfb\u7edf\u5185\u6838\u4f18\u5316\ncat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_tw_buckets = 20480\nnet.ipv4.tcp_max_syn_backlog = 20480\nnet.core.netdev_max_backlog = 262144\nnet.ipv4.tcp_fin_timeout = 20\nEOF\n# \u51cf\u5c11SWAP\u4f7f\u7528\necho \"0\" &gt; /proc/sys/vm/swappiness\n\n# \u5b89\u88c5\u7cfb\u7edf\u6027\u80fd\u5206\u6790\u5de5\u5177\u53ca\u5176\u4ed6\nyum install gcc make autoconf vim sysstat net-tools iostat if\n</code></pre></p>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#23\u51fd\u6570\u8f93\u51fa\u5e2e\u52a9\u4fe1\u606f","title":"23.\u51fd\u6570\u8f93\u51fa\u5e2e\u52a9\u4fe1\u606f","text":"<pre><code>#!/bin/bash\n#\u529f\u80fd\u63cf\u8ff0(Description):\u4f7f\u7528\u51fd\u6570\u8f93\u51fa\u5e2e\u52a9\u4fe1\u606f.\nfunction print_usage() {\ncat &lt;&lt; EOF\nUsage: --help | -h\n  Print help information for script.\nUsage: --memory | -m\n  Monitor memory information.\nUsage: --network | -n\n  Monitor network interface information.\nEOF\n}\ncase $1 in\n--memory|-m)\nfree;;\n--network|-n)\nip -s link;;\n--help|-h)\nprint_usage;;\n*)\nprint_usage;;\nesac\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#24\u8bbe\u7f6e\u9501\u6587\u4ef6\u9632\u6b62\u811a\u672c\u91cd\u590d\u6267\u884c","title":"24.\u8bbe\u7f6e\u9501\u6587\u4ef6\u9632\u6b62\u811a\u672c\u91cd\u590d\u6267\u884c","text":"<pre><code>#!/bin/bash\n#\u529f\u80fd\u63cf\u8ff0(Description):\u901a\u8fc7\u8bbe\u7f6e\u9501\u6587\u4ef6\u9632\u6b62\u811a\u672c\u91cd\u590d\u6267\u884c.\n#\u4f7f\u7528Ctrl+C\u4e2d\u65ad\u811a\u672c\u65f6,\u5220\u9664\u9501\u6587\u4ef6.\ntrap 'rm -rf /tmp/lockfile;exit' HUP INT\n\n#\u68c0\u67e5\u662f\u5426\u5b58\u5728\u9501\u6587\u4ef6,\u6ca1\u6709\u9501\u6587\u4ef6\u5c31\u6267\u884cbackup\u5907\u4efd\u51fd\u6570,\u5982\u679c\u6709\u9501\u6587\u4ef6\u811a\u672c\u5219\u811a\u672c\u76f4\u63a5\u9000\u51fa.\nlock_check(){\nif (set -C; :&gt; /tmp/lockfile) 2&gt;/dev/null ;then\nbackup\n    else\necho -e \"\\033[91mWarning:\u5176\u4ed6\u7528\u6237\u5728\u6267\u884c\u8be5\u811a\u672c.\\033[0m\"\nexit 66\nfi\n}\n#\u6267\u884c\u5907\u4efd\u524d\u521b\u5efa\u6240\u6587\u4ef6,\u7136\u540e\u6267\u884c\u5907\u4efd\u6570\u636e\u5e93\u7684\u64cd\u4f5c,\u5907\u4efd\u5b8c\u6210\u540e\u5220\u9664\u9501\u6587\u4ef6.\n#sleep 10\u5b9e\u9a8c\u6d4b\u8bd5\u65f6\u4f7f\u7528,\u4e3a\u4e86\u9632\u6b62\u5c0f\u6570\u636e\u5e93\u5907\u4efd\u592a\u5feb,\u65e0\u6cd5\u9a8c\u8bc1\u91cd\u590d\u6267\u884c\u811a\u672c\u7684\u6548\u679c.\nbackup(){\ntouch /tmp/lockfile\n    mysqldump --all-database &gt; /var/log/mysql-$(date +%Y%m%d).bak\n    sleep 10\nrm -rf /tmp/lockfile\n}\nlock_check\nbackup\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#25\u5bf9\u4e00\u7ec4url\u6d4b\u8bd5\u80fd\u5426\u8bbf\u95ee\u6210\u529f","title":"25.\u5bf9\u4e00\u7ec4url\u6d4b\u8bd5\u80fd\u5426\u8bbf\u95ee\u6210\u529f","text":"<pre><code>#!/bin/bash\nurl_list=(  #\u5b9a\u4e49\u4e00\u4e2a\u5305\u542b\u4e09\u4e2a\u7f51\u5740\u7684\u6570\u7ec4 url_list\nhttp://www.baidu.com\nhttps://www.shiyanlou.com\nhttp://www.google.com\n)\nwait(){   #\u5b9a\u4e49\u5012\u8ba1\u65f6\u51fd\u6570 wait\necho -n 'wait 3 second...'\nfor ((i=0;i&lt;3;i++))\ndo\necho -n \".\";sleep 1  #\u6bcf\u96941\u79d2\u6253\u5370\u4e00\u4e2a\u70b9\ndone\necho\n}\ncheck_url(){\nwait   # \u8c03\u7528\u5df2\u7ecf\u5b9a\u4e49\u7684 wait \u51fd\u6570\n#\u5faa\u73af\u904d\u5386 url_list \u4e2d\u7684\u5730\u5740\nfor ((i=0;i&lt;`echo ${#url_list[*]}`;i++))\ndo\n#\u68c0\u6d4b\u662f\u5426\u53ef\u4ee5\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\u4e2d\u7684\u5730\u5740\nwget -o /dev/null -T 3 --tries=1 --spider ${url_list[$i]} &gt;/dev/null 2&gt;&amp;1  #--tries\u662f\u8bbe\u7f6e\u5c1d\u8bd5\u6b21\u6570\uff0c--spider\u68c0\u67e5\u7f51\u5740\uff0c\u540e\u9762\u7684&gt;/dev/null 2&gt;&amp;1\u662f\u4e0d\u4fdd\u7559\u4efb\u4f55\u8f93\u51fa\nif [ $? -eq 0 ];then   #\u5982\u679c\u8fd4\u56de\u503c\u4e3a0\u5219\u8868\u793a\u8bbf\u95ee\u6210\u529f\necho \"${url_list[$i]} success\"\nelse\necho \"${url_list[$i]} false\"\nfi\ndone\n}\nmain(){  #\u5b9a\u4e49\u4e3b\u51fd\u6570\uff0c\u5373\u5165\u53e3\u51fd\u6570\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u65f6\u9996\u5148\u6267\u884c\u7684\u4ee3\u7801\ncheck_url   #\u8c03\u7528\u5b9a\u4e49\u7684 check_url \u51fd\u6570\n}\nmain    #\u8c03\u7528\u4e3b\u51fd\u6570\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#26mysql\u5355\u8868\u6570\u636e\u540c\u6b65\u811a\u672c","title":"26.MySQL\u5355\u8868\u6570\u636e\u540c\u6b65\u811a\u672c","text":"<pre><code>#!/usr/bin/env bash\n# Auth: liuli\n# Version: v1.0, 2020/6/17\n# Sys: CentOS 7.6\n# Features: \u7528\u4e8e\u540c\u6b65\u7814\u53d1\u6570\u636e\u5e93\u4e2d\u7684\u67d0\u4e9b\u8868\u81f3\u751f\u4ea7\u6570\u636e\u5e93\n# set -xeuo pipefail\ntime=`date '+%Y-%m-%d-%H:%M'`\nmkdir -p ./sql/${time}\ndb_Name=\"temp-tenant\"\ntable_Name=(\ninterface_authority\ninterface_permissions\nt_user_function_authority\nt_user_function_permission\nt_menu\n)\n# \u7814\u53d1\u73af\u5883\ndev_IP=\"192.168.1.15\"\ndev_Port=\"3306\"\ndev_Pass=\"123456Aa.\"\n# \u751f\u4ea7\u73af\u5883\nprod_IP=\"192.168.1.16\"\nprod_Port=\"23306\"\nprod_Pass=\"123456Aa.\"\n# \u5bfc\u51fa\u7814\u53d1\u73af\u5883\u7684\u8868\nfor i in ${table_Name[*]}\ndo\nmysqldump -h${dev_IP} -uroot -P${dev_Port} -p${dev_Pass} ${db_Name} ${i} &gt; ./sql/${time}/dev.sql\ndone\n# \u5bfc\u51fa\u751f\u4ea7\u73af\u5883\u7684\u6574\u4e2a\u5e93\nmysqldump -h${prod_IP} -uroot -P${prod_Port} -p${prod_Pass} ${db_Name} &gt; ./sql/${time}/${db_Name}.sql\n\n# \u5220\u9664\u751f\u4ea7\u73af\u5883\u7684\u8868\nfor i in ${table_Name[*]}\ndo\nmysql -h${prod_IP} -uroot -P${prod_Port} -p${prod_Pass} -e \"USE ${db_Name};DROP TABLE ${i}\"\ndone\n# \u5bfc\u5165\u7814\u53d1\u73af\u5883\u7684\u8868\nmysql -h${prod_IP} -uroot -P${prod_Port} -p${prod_Pass} ${db_Name} &lt; ./sql/${time}/dev.sql\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#27shell\u5b9e\u73b0\u591a\u5e76\u53d1\u63a7\u5236","title":"27.shell\u5b9e\u73b0\u591a\u5e76\u53d1\u63a7\u5236","text":""},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u4e0d\u5e76\u53d1","title":"\u4e0d\u5e76\u53d1","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\nshutdown_instance_array=($(nova list | grep SHUTOFF | awk -F \"|\" '{print $2}'))\nshutdown_instance_Name=($(nova list | grep SHUTOFF | awk -F \"|\" '{print $3}'))\ndeclare -A array_instance\n\n# \u8bbe\u7f6e\u5173\u8054\u6570\u7ec4\nfor i in ${!shutdown_instance_array[@]}; do array_instance[${shutdown_instance_Name[$i]}]=${shutdown_instance_array[$i]}; done\nname_arry=(${!array_instance[@]}) #key -name\nid_arry=(${array_instance[@]})    #value -id\nfor ((i = 0; i &lt; ${#shutdown_instance_array[@]}; i++)); do\n{\n#     echo ${name_arry[$i]}\nmap_dev=$(rbd map ${id_arry[$i]}_disk -p vms)\necho -e \"xfs_repair -L $map_dev &gt; ${name_arry[$i]}.log 2&gt;&amp;1 &amp;\"\n} &amp;\nsleep 1\ndone\nwait\nstop_time=$(date +%s) #\u5b9a\u4e49\u811a\u672c\u8fd0\u884c\u7684\u7ed3\u675f\u65f6\u95f4\necho \"TIME:`expr $stop_time - $start_time`\"\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u63a7\u5236\u5e76\u53d1","title":"\u63a7\u5236\u5e76\u53d1","text":""},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u793a\u4f8b1","title":"\u793a\u4f8b1","text":"<pre><code>#!/usr/bin/env bash\n#usage: To repair the virtual machine hard disk, the virtual machine must be off\nsource /etc/kolla/admin-openrc.sh\nstart_time=$(date +%s)\nNproc=5\nshutdown_instance_array=($(nova list | grep SHUTOFF | awk -F \"|\" '{print $2}'))\nshutdown_instance_Name=($(nova list | grep SHUTOFF | awk -F \"|\" '{print $3}'))\ndeclare -A array_instance\n\n# \u8bbe\u7f6e\u5173\u8054\u6570\u7ec4\nfor i in ${!shutdown_instance_array[@]}; do array_instance[${shutdown_instance_Name[$i]}]=${shutdown_instance_array[$i]}; done\nname_arry=(${!array_instance[@]}) #key -name\nid_arry=(${array_instance[@]})    #value -id\n[ -e /tmp/fifo.$$ ] || mkfifo /tmp/fifo.$$\nexec 3&lt;&gt;/tmp/fifo.$$\nrm -f /tmp/fifo.$$\nfor ((i = 0; i &lt; $Nproc; i++)); do\necho &gt;&amp;3\ndone\nfor ((i = 0; i &lt; ${#shutdown_instance_array[@]}; i++)); do\n{\nread -u3\n    sleep 1\necho \"xfs_repair instamceName: ${name_arry[$i]} instamceID: ${id_arry[$i]} \"\ndevice_name=$(rbd map ${id_arry[$i]}_disk -p vms)\nxfs_repair -L ${device_name} &gt; ${name_arry[$i]}_$$.log 2&gt;&amp;1\necho \"instamceName: ${name_arry[$i]} instamceID: ${id_arry[$i]}\" &gt;&gt; repairInformationSummary.log\n    echo &gt;&amp;3 #\u6267\u884c\u5230\u6700\u540e\uff0c\u628a\u4ee4\u724c\u653e\u56de\u7ba1\u9053\n}&amp;\ndone\nwait\nstop_time=$(date +%s)\necho \"TIME:$(expr $stop_time - $start_time)\"\nexec 3&lt;&amp;-\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u793a\u4f8b2","title":"\u793a\u4f8b2","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\nthread=5\ntmp_fifofile=/tmp/$$.fifo\n\nmkfifo $tmp_fifofile\nexec 8&lt;&gt; $tmp_fifofile\nrm $tmp_fifofile\nfor i in `seq $thread`\ndo\necho $i &amp;&gt; 8\ndone\nfor i in {1..245}\ndo\nread -u8\n    {\nip=192.168.122.$i\nping -c1 -W1 $ip &amp;&gt;/dev/null\n        if [ $? -eq 0 ];then\necho \"$ip is down!\"\nelse\necho \"$ip is up\"\nfi\necho $i &gt;&amp; 8\n}&amp;\ndone\nwait\nexec 8 &lt;&amp;-\necho \"all finished......\"\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u793a\u4f8b3","title":"\u793a\u4f8b3","text":"<pre><code>#!/bin/bash\ndate\n\nDIR=/test/log/\n\nFILE_NAME=65535_`date +\"%Y%m%d\"`;\nFILE_NAME_LAST_DAY=`date -d \"yesterday\" +\"%Y%m%d\"`;\ntime_of_system=`date +\"%Y-%m-%d\"`\nfunction multi_processor(){\n[ -e /tmp/fd1 ] || mkfifo /tmp/fd1\n    exec 3&lt;&gt;/tmp/fd1\n    rm -rf /tmp/fd1\n    for ((i=1;i&lt;=30;i++))\ndo\necho &gt;&amp;3\ndone\nfor file in $1\ndo\nread -u3\n    {\ngrep $3 $file | awk -F\"|\" '{print $7}' | sort | uniq &gt;&gt; $2;\necho &gt;&amp;3\n}&amp;\ndone\nwait\nexec 3&lt;&amp;-\n    exec 3&gt;&amp;-\n}\n#register 1 day ago\nregister_file=register_file_1_day_ago_$HOSTNAME.txt\nfile_modify_time=`stat $register_file | grep Modify | awk '{print $2}'`\nfiles_last_day=`find $DIR -type f -name \"$FILE_NAME_LAST_DAY*\"`\nif [[ $file_modify_time != $time_of_system ]]; then\necho \"$register_file file_modify_time(${file_modify_time}) time_of_system(${time_of_system})\"\nrm $register_file\nmulti_processor \"$files_last_day\" \"$register_file\" \"REGISTER\"\nfi\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u793a\u4f8b4","title":"\u793a\u4f8b4","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\n# author\uff1axiaojian\nNjob=15 #\u4efb\u52a1\u603b\u6570\nNproc=5 #\u6700\u5927\u5e76\u53d1\u8fdb\u7a0b\u6570\nmkfifo ./fifo.$$ &amp;&amp; exec 777&lt;&gt; ./fifo.$$ &amp;&amp; rm -f ./fifo.$$ #\u901a\u8fc7\u6587\u4ef6\u63cf\u8ff0\u7b26777\u8bbf\u95eefifo\u6587\u4ef6\nfor ((i=0; i&lt;$Nproc; i++)); do #\u5411fifo\u6587\u4ef6\u5148\u586b\u5145\u7b49\u4e8eNproc\u503c\u7684\u884c\u6570\necho \"init time add $i\" &gt;&amp;777\ndone\nfor ((i=0; i&lt;$Njob; i++)); do\n{\nread -u 777 #\u4ecefifo\u6587\u4ef6\u8bfb\u4e00\u884c\necho \"progress $i is sleeping for 3 seconds zzz\u2026\"\nsleep 3\necho \"real time add $(($i+$Nproc))\" &gt;&amp;777 #sleep\u5b8c\u6210\u540e\uff0c\u5411fifo\u6587\u4ef6\u91cd\u65b0\u5199\u5165\u4e00\u884c\n} &amp;\ndone\nwait\nexec 777 &gt;&amp;-\nexec 777 &lt;&amp;-\necho -e \"time-consuming: $SECONDS seconds\"\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u793a\u4f8b5","title":"\u793a\u4f8b5","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:${NAME}.sh\n# author\uff1axiaojian\nCE_HOME=\"/data/ContentEnginne\"\nLOG_PATH=\"/data/logs\"\n# \u63a7\u5236\u722c\u866b\u6570\u91cf\u4e3a8\nMAX_SPIDER_COUNT=8\ncount=`ps -ef|grep -v grep|grep run.py|wc -l`\ntry_time=0\ncd $CE_HOME\nwhile [ $count -lt $MAX_SPIDER_COUNT -a $try_time -lt $MAX_SPIDER_COUNT ]; do\nlet try_time +=1\npython run.py &gt;&gt; ${LOG_PATH}/spider.log 2&gt;&amp;1 &amp;\ncount=`ps -ef|grep -v grep|grep run.py|wc -l`\ndone\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#\u793a\u4f8b6","title":"\u793a\u4f8b6","text":"<pre><code>#!/bin/bash\n#Version:3.0\n#\u529f\u80fd\u63cf\u8ff0(Description):\u63a7\u5236\u8fdb\u7a0b\u6570\u91cf\u7684ping\u6d4b\u8bd5\u811a\u672c.\n#\u4f7f\u7528wait\u547d\u4ee4\u7b49\u5f85\u6240\u6709\u5b50\u8fdb\u7a0b\u7ed3\u675f\u540e\u518d\u9000\u51fa\u811a\u672c.\nnum=10             #\u63a7\u5236\u8fdb\u7a0b\u6570\u91cf.\nnet=\"192.168.4\"\npipefile=\"/tmp/multiping_$$.tmp\"\nmulti_ping() {\nping -c2 -i0.2 -W1 $1 &amp;&gt;/dev/null &amp;&amp; echo \"$1 is up.\" || echo \"$1 is down.\"\n}\n#\u521b\u5efa\u547d\u540d\u7ba1\u9053\u6587\u4ef6,\u521b\u5efa\u5176\u6587\u4ef6\u63cf\u8ff0\u7b26,\u901a\u8fc7\u91cd\u5b9a\u5411\u5bfc\u5165\u6570\u636e\u5230\u7ba1\u9053\u6587\u4ef6\u4e2d.\nmkfifo $pipefile\nexec 12&lt;&gt;$pipefile\nfor i in $(seq $num)\ndo\necho \"\" &gt;&amp;12 &amp;\ndone\n#\u901a\u8fc7\u5faa\u73af\u53cd\u590d\u8c03\u7528\u51fd\u6570\u5e76\u5c06\u5176\u653e\u5165\u540e\u53f0\u5e76\u884c\u6267\u884c.\n#\u6210\u529f\u8bfb\u53d6\u547d\u540d\u7ba1\u9053\u4e2d\u7684\u6570\u636e\u540e\u5f00\u542f\u65b0\u7684\u8fdb\u7a0b.\n#\u6240\u6709\u5185\u5bb9\u8bfb\u53d6\u5b8c\u540eread\u88ab\u963b\u585e,\u65e0\u6cd5\u518d\u542f\u52a8\u65b0\u8fdb\u7a0b.\n#\u7b49\u5f85\u524d\u9762\u542f\u52a8\u7684\u8fdb\u7a0b\u7ed3\u675f\u540e,\u7ee7\u7eed\u5f80\u7ba1\u9053\u6587\u4ef6\u4e2d\u5199\u5165\u6570\u636e,\u91ca\u653e\u963b\u585e,\u518d\u6b21\u5f00\u542f\u65b0\u7684\u8fdb\u7a0b.\nfor j in {1..254}\ndo\nread -u12\n    {\nmulti_ping $net.$j\necho \"\" &gt;&amp;12\n} &amp;\ndone\nwait\nrm -rf $pipfile\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#28\u4e00\u4e9b\u5e38\u7528\u7684\u51fd\u6570","title":"28.\u4e00\u4e9b\u5e38\u7528\u7684\u51fd\u6570","text":"<pre><code>#\u5224\u65ad\u662f\u5426\u662ffalse\nis_false() {\ncase \"$1\" in\n[fF] | [nN] | [nN][oO] | [fF][aA][lL][sS][eE] | 0)\nreturn 0\n;;\nesac\nreturn 1\n}\n#\u5224\u65ad\u8fdb\u7a0b\u662f\u5426\u8fd0\u884c\nis_running()\n{\nif [ -f $1 ]; then\nread pid &lt; $1\nif [ -d \"/proc/$pid\" ]; then\nreturn 0\nfi\nfi\nreturn -1\n}\n#\u5b89\u88c5epel\u6e90\nfunction _install_epel {\n# NOTE: We always remove and install latest -- some environments\n# use snapshot images, and if EPEL version updates they break\n# unless we update them to latest version.\nif sudo yum repolist enabled epel | grep -q 'epel'; then\nuninstall_package epel-release || true\nfi\n# This trick installs the latest epel-release from a bootstrap\n# repo, then removes itself (as epel-release installed the\n# \"real\" repo).\n#\n# You would think that rather than this, you could use\n# $releasever directly in .repo file we create below.  However\n# RHEL gives a $releasever of \"6Server\" which breaks the path;\n# see https://bugzilla.redhat.com/show_bug.cgi?id=1150759\ncat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/epel-bootstrap.repo\n[epel-bootstrap]\nname=Bootstrap EPEL\nmirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=epel-7&amp;arch=\\$basearch\nfailovermethod=priority\nenabled=0\ngpgcheck=0\nEOF\n# Enable a bootstrap repo.  It is removed after finishing\n# the epel-release installation.\nis_package_installed yum-utils || install_package yum-utils\n    sudo yum-config-manager --enable epel-bootstrap\n    yum_install epel-release || \\\ndie $LINENO \"Error installing EPEL repo, cannot continue\"\nsudo rm -f /etc/yum.repos.d/epel-bootstrap.repo\n}\n#\u8bb0\u5f55\u65e5\u5fd7\u7684function\nfunction fnLogInfo()\n{\nlocal infomsg=$1\necho ${infomsg}\necho `date \"${data_format}\"` \"Info:${infomsg}\" &gt;&gt; ${log_file}\n}\n#\u5907\u4efd\u6587\u4ef6\u7684function\nfnBackupBeforeModify()\n{\nlocal file=$1\nlocal backupFile=\"${file}.bak\"\nfnLogInfo \"Start to backup file $file\"\ncp ${file} -p ${backupFile}\nfnLogInfo \"End to backup file $file\"\n}\n# 1. change the network config as DHCP\n# 2. delete the 70-persistent-net.rules file\nfnModifyNetworkConfig()\n{\nfnLogInfo \"----------------------------------------\"\nfnLogInfo \"Start to modify the network configuration\"\nlocal files=''\n#1. change the network config as DHCP\ncase $os_type in\n#/etc/sysconfig/network-scripts\n\"redhat\")\nfiles=\"`ls /etc/sysconfig/network-scripts/ifcfg-eth* |grep -v .bak`\"\nfiles=\"${files} `ls /etc/sysconfig/network-scripts/ifcfg-ens* |grep -v .bak`\"\nfor file in $files\ndo\nfnLogInfo \"Start to modify the network configuration: $file\"\n#backup  the file\nfnBackupBeforeModify $file\n#modify the file\nsed -i '/PERSISTENT_DHCLIENT/d' $file\nsed -i '$a\\PERSISTENT_DHCLIENT=yes' $file\nfnLogInfo \"End to modify the network configuration: $file\"\ndone\n;;\n#/etc/sysconfig/network/dhcp\n\"suse\")\nfile='/etc/sysconfig/network/dhcp'\n#first backup file\nfnBackupBeforeModify $file\nsed -i \"s/DHCLIENT_USE_LAST_LEASE=yes\\|DHCLIENT_USE_LAST_LEASE='yes'\\|DHCLIENT_USE_LAST_LEASE=\\\"yes\\\"/DHCLIENT_USE_LAST_LEASE=\\\"no\\\"/g\" $file\n;;\n#/etc/network/interfaces\n\"debian\" | \"ubuntu\")\nfile='/etc/network/interfaces'\n#backup the file\nfnBackupBeforeModify $file\nsed -i \"s/static\\| manual/ dhcp/g\" $file\nsed -i \"s/address /#address /g\" $file\nsed -i \"s/netmask /#netmask /g\" $file\nsed -i \"s/gateway /#gateway /g\" $file\n;;\n*)\nfnLogInfo \"Other Linux, network configuration cannot be modified.\"\n;;\nesac\n#2. delete the 70-persistent-net.rules file\nrm -rf /etc/udev/rules.d/70-persistent-net.rules\n\nfnLogInfo \"Delete 70-persistent-net.rules file, resut: $?\"\nfnLogInfo \"End to modify the network configuration\"\n}\n#check OS\u7684function\nfnGetOSType()\n{\nfnLogInfo \"---------------------------\"\nfnLogInfo \"Start to get the os type\"\nlocal version=\"/proc/version\"\nif ! [ -e \"${version}\" ];then\nreturn 1\nelif [ -n \"$(grep -i 'suse' ${version})\" ];then\nos_type='suse'\nelif [ -n \"$(grep -i 'ubuntu' ${version})\" ];then\nos_type='ubuntu'\nelif [ -n \"$(grep -i 'Red Hat' ${version})\" ];then\nos_type='redhat'\nelif [ -n \"$(grep -i 'debian' ${version})\" ];then\nos_type='debian'\nfi\nfnLogInfo \"End to get the os type: $os_type\"\n}\n#\u8f93\u5165\u9009\u62e9Yes\u548cNo\u51fd\u6570\nYES_NO_choice(){\nread -t 10 -p \"Please input you commit ,wait 5.....to exit: \" input\n\ncase $input in\n[yY]|[yY][eE][sS] )\necho \"YES!!!!!\"\n;;\n[nN]|[nN][oO] )\necho \"NO  Error!!!!!\"\n;;\n*)\necho \"============================\"\n;;\nesac\n#\u9519\u8bef\u63d0\u793a\u51fd\u6570\ndie () {\necho \"ERROR: $1. Aborting!\"\nexit 1\n}\n#\u5224\u65ad\u7528\u6237\u8f93\u5165\u5982\u679c\u6ca1\u6709\u8f93\u5165\uff0c\u9009\u62e9\u9ed8\u8ba4\u503c redis\u4e3a\u4f8b\n_REDIS_PORT=6379\n_MANUAL_EXECUTION=false     #\u6807\u5fd7\u4fe1\u606f\ncheck_input_redis_port(){\nif ! echo $REDIS_PORT | egrep -q '^[0-9]+$' ; then\n_MANUAL_EXECUTION=true      #\u91cd\u7f6e\u6807\u5fd7\u4fe1\u606f\n#Read the redis port\nread  -p \"Please select the redis port for this instance: [$_REDIS_PORT] \" REDIS_PORT\n    if ! echo $REDIS_PORT | egrep -q '^[0-9]+$' ; then\necho \"Selecting default: $_REDIS_PORT\"\nREDIS_PORT=$_REDIS_PORT\nfi\nfi\n}\nGet_OS_Bit()\n{\nif [[ `getconf WORD_BIT` = '32' &amp;&amp; `getconf LONG_BIT` = '64' ]] ; then\nIs_64bit='y'\nelse\nIs_64bit='n'\nfi\n}\nDownload_Files()\n{\nlocal URL=$1\nlocal FileName=$2\nif [ -s \"${FileName}\" ]; then\necho \"${FileName} [found]\"\nelse\necho \"Notice: ${FileName} not found!!!download now...\"\nwget -c --progress=bar:force --prefer-family=IPv4 --no-check-certificate ${URL}\nfi\n}\n#\u6279\u91cf\u5b89\u88c5\u57fa\u7840\u5305\nCentOS_Dependent()\n{\n\\cp /etc/yum.conf /etc/yum.conf.lnmp\n    sed -i 's:exclude=.*:exclude=:g' /etc/yum.conf\n\nEcho_Blue \"[+] Yum installing dependent packages...\"\nfor packages in make cmake gcc gcc-c++ gcc-g77 flex bison file libtool libtool-libs autoconf kernel-devel patch wget crontabs libjpeg libjpeg-devel libpng libpng-devel libpng10 libpng10-devel gd gd-devel libxml2 libxml2-devel zlib zlib-devel glib2 glib2-devel unzip tar bzip2 bzip2-devel libevent libevent-devel ncurses ncurses-devel curl curl-devel libcurl libcurl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel vim-minimal gettext gettext-devel ncurses-devel gmp-devel pspell-devel unzip libcap diffutils ca-certificates net-tools libc-client-devel psmisc libXpm-devel git-core c-ares-devel libicu-devel libxslt libxslt-devel xz;\ndo yum -y install $packages; done\nmv -f /etc/yum.conf.lnmp /etc/yum.conf\n}\n#\u8bbe\u7f6ecron\u8ba1\u5212\u4efb\u52a1\nCrontab_func(){\n#!/bin/bash\ncat  &lt;&lt;EOF &gt; /var/spool/cron/root\n*/30 * * * * sh /home/cheungssh/mysite/mysite/cheungssh/cheungssh_demo.sh 2&gt;&gt;/home/cheungssh/logs/demo.log  &gt;&gt; /home/cheungssh/logs/demo.log\nEOF\n}\n#\u5224\u65ad\u8fdb\u7a0b\u4fe1\u606f\uff0c\u6740\u6389\u8fdb\u7a0b\nkill_Process(){\nps -fel|grep websocket_server_cheung.py|grep  -v \"$$\"|awk  '{print  $4}'|xargs -i kill  -9 {}\n}\n#\u83b7\u53d6MD5\u503c\nMD5_value(){\nmd5sum /etc/hosts |awk '{print $1}'\n}\ndata_format=\"+%Y-%m-%d %H:%M:%S\"\n#\u8bb0\u5f55\u65e5\u5fd7\u7684function\nfunction fnLogInfo()\n{\nlocal infomsg=$1\necho ${infomsg}\necho `date \"${data_format}\"` \"Info:${infomsg}\" &gt;&gt; ${log_file}\n}\n#scritps path\ndir_path(){\npwd=`dirname $0`\n}\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#30\u731c\u968f\u673a\u6570","title":"30.\u731c\u968f\u673a\u6570","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\n#\u53d6\u4f59\u7684\u7b97\u6cd5\u5c06\u968f\u673a\u6570\u53d8\u4e3a1-100\u4e4b\u95f4\nnum=$[RANDOM%100+1]\n#\u4f7f\u7528read\u6355\u83b7\u8f93\u5165\n#\u4f7f\u7528if\u5224\u65ad\nwhile True; do\nread -p \"\u8ba1\u7b97\u751f\u6210\u7684\u4e00\u4e2a1-100\u7684\u968f\u673a\u6570\uff1a\" cai\n    if [ $cai -eq $num ]; then\necho \"\u606d\u559c\uff0c\u731c\u5bf9\u4e86\"\nelif [ $cai -gt $num ]; then\necho \"oops\uff0c\u731c\u5927\u4e86\"\nelse\necho \"oops\uff0c\u731c\u5c0f\u4e86\"\nfi\ndone\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#31test\u591a\u79cd\u5199\u6cd5","title":"31.test\u591a\u79cd\u5199\u6cd5","text":"<pre><code>#!/usr/bin/env bash\nFreeMem=`free -m|awk 'NR==3 {print $NF}'`\nif (( $FreeMem &lt; 1000 )); then\necho \"xxxxxxxxxx\"\nfi\nif [[ $FreeMem -lt 1000 ]]; then\necho \"xxxxxxxx\"\nfi\nif test $FreeMem -lt 1000; then\necho \"xxxxxxxxxxxx\"\nfi\nif grep  /etc/passwd &gt;/dev/null 2&gt;&amp;1; then\necho \"xxxxxxxxxx\"\nfi\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#32\u6362\u7b97\u79d2\u4e3a\u5206\u949f\u5c0f\u65f6","title":"32.\u6362\u7b97\u79d2\u4e3a\u5206\u949f\u3001\u5c0f\u65f6","text":"<pre><code>#!/bin/bash\na=60100\nswap_seconds ()\n{\nSEC=$1\n(( SEC &lt; 60 )) &amp;&amp; echo -e \"\u6301\u7eed\u65f6\u95f4: $SEC\u79d2\\c\"\n(( SEC &gt;= 60 &amp;&amp; SEC &lt; 3600 )) &amp;&amp; echo -e \"\u6301\u7eed\u65f6\u95f4: $(( SEC / 60 ))\u5206\u949f$(( SEC % 60 ))\u79d2\\c\"\n(( SEC &gt; 3600 )) &amp;&amp; echo -e \"\u6301\u7eed\u65f6\u95f4: $(( SEC / 3600 ))\u5c0f\u65f6$(( (SEC % 3600) / 60 ))\u5206\u949f$(( (SEC % 3600) % 60 ))\u79d2\\c\"\n}\nb=`swap_seconds $a`\necho $b\n</code></pre> <p>\u8f93\u51fa</p> <pre><code>\u6301\u7eed\u65f6\u95f4: 16\u5c0f\u65f641\u5206\u949f40\u79d2\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#33\u811a\u672c\u547d\u4ee4\u884c\u53c2\u6570\u7684\u4f20\u9012\u4e0e\u5224\u65ad","title":"33.\u811a\u672c\u547d\u4ee4\u884c\u53c2\u6570\u7684\u4f20\u9012\u4e0e\u5224\u65ad","text":"<pre><code>#!/bin/bash\nmain() {\nif [[ $# == 1 ]]; then\ncase $1 in\n\"-h\")\necho \"\u811a\u672c\u4f7f\u7528\u65b9\u6cd5: \"\necho \"  ./gitlab-pipeline.sh git\u4ed3\u5e93\u540d1 git\u4ed3\u5e93\u540d2 ... tag\u540d(tag\u547d\u540d\u89c4\u5219\u4e3a: *-v\u52a0\u6570\u5b57)\"\nexit\n;;\n\"--help\")\necho \"\u811a\u672c\u4f7f\u7528\u65b9\u6cd5: \"\necho \"  ./gitlab-pipeline.sh git\u4ed3\u5e93\u540d1 git\u4ed3\u5e93\u540d2 ... tag\u540d(tag\u547d\u540d\u89c4\u5219\u4e3a: *-v\u52a0\u6570\u5b57)\"\nexit\n;;\n*)\necho \"\u53c2\u6570\u9519\u8bef\uff01\"\nexit\n;;\nesac\nfi\n}\nmain $*\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#34\u68c0\u6d4bdocker\u5bb9\u5668\u7684\u542f\u52a8\u72b6\u6001","title":"34.\u68c0\u6d4bdocker\u5bb9\u5668\u7684\u542f\u52a8\u72b6\u6001","text":"<pre><code># \u7b2c\u4e00\u6b65\uff1a\u5224\u65ad\u955c\u50cf\u662f\u5426\u5b58\u5728\nif [ `docker images --format {{.Repository}}:{{.Tag}} |grep -Fx 192.168.1.7:32772/applications/$CI_PROJECT_NAME:${CI_COMMIT_SHORT_SHA};echo $?` -eq 0 ];then\ndocker pull 192.168.1.7:32772/applications/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA ;\nfi;\n# \u7b2c\u4e8c\u6b65\uff1a\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u6709\u91cd\u540d\u7684\u5bb9\u5668\u5728\u8fd0\u884c\u6216\u8005\u5904\u5728\u5176\u4ed6\u72b6\u6001\u3002\u91cd\u540d\u7684\uff0c\u5148\u5220\u6389\uff0c\u5728\u542f\u52a8\uff1b\u4e0d\u91cd\u540d\u7684\u76f4\u63a5\u542f\u52a8\nif [ `docker ps -a --format {{.Names}} |grep -Fx $CI_PROJECT_NAME &gt; /dev/null ;echo $?` -eq 0 ] ;then\ndocker rm -f $CI_PROJECT_NAME ;\ndocker run -d --name $CI_PROJECT_NAME -p 30088:8080 192.168.1.7:32772/applications/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA ;\nelse\ndocker run -d --name $CI_PROJECT_NAME -p 30088:8080 192.168.1.7:32772/applications/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA ;\nfi;\n# \u7b2c\u4e09\u6b65\uff1a\u5faa\u73af\u4e94\u6b21\u5224\u65ad\u5bb9\u5668\u7684\u76d1\u63a7\u68c0\u6d4b\u662f\u5426\u5904\u4e8e\u4ec0\u4e48\u72b6\u6001\u3002\u5065\u5eb7\u72b6\u6001\u5c31\u76f4\u63a5\u9000\u51fa\u5faa\u73af\uff0c\u4e0d\u5065\u5eb7\u663e\u793a\u5065\u5eb7\u68c0\u67e5\u65e5\u5fd7\uff0c\u6b63\u5728\u542f\u52a8\u7684\u76f4\u63a5\u663e\u793a\u3002\u5904\u4e8e\u5176\u4ed6\u72b6\u6001\u7684\u76f4\u63a5\u663e\u793a\u72b6\u6001\nn=0;\nwhile true ;do\ncontainer_state=`docker inspect --format='{{json .State.Health.Status}}' $CI_PROJECT_NAME`;\ncase $container_state in\n'\"starting\"' )\necho \"\u5e94\u7528\u5bb9\u5668\u6b63\u5728\u542f\u52a8\uff01\";\n;;\n'\"healthy\"' )\necho \"\u5e94\u7528\u5bb9\u5668\u5df2\u542f\u52a8\uff0c\u72b6\u6001\u5065\u5eb7\uff01\";\nbreak;\n;;\n'\"unhealthy\"' )\necho \"\u5e94\u7528\u5bb9\u5668\u5065\u5eb7\u68c0\u6d4b\u5931\u8d25\uff01\";\ndocker inspect --format='{{json .State.Health.Log}}' $CI_PROJECT_NAME;\n;;\n* )\necho \"\u672a\u77e5\u7684\u72b6\u6001:$container_state\";\n;;\nesac;\nsleep 1s;\nn=$(($n+1));\nif [ $n -eq 5 ];\nthen break ;\nfi ;\ndone\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#35\u68c0\u67e5\u5e38\u89c1\u7cfb\u7edf\u547d\u4ee4\u662f\u5426\u5b89\u88c5","title":"35.\u68c0\u67e5\u5e38\u89c1\u7cfb\u7edf\u547d\u4ee4\u662f\u5426\u5b89\u88c5","text":"<pre><code>check_command() {\nif ! command -v ifconfig &gt;/dev/null 2&gt;&amp;1; then\necho -e \"\\033[31mifconfig\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u6b63\u5728\u4e0b\u8f7d\u5b89\u88c5\uff01\\033[0m\"\nif os=\"ubuntu\"; then\napt install -y net-tools &gt;/dev/null 2&gt;&amp;1\nelif os=\"centos\"; then\nyum install -y net-tools &gt;/dev/null 2&gt;&amp;1\nelif os=\"fedora\"; then\ndnf install -y net-tools &gt;/dev/null 2&gt;&amp;1\nfi\nelif ! command -v ip &gt;/dev/null 2&gt;&amp;1; then\necho -e \"\\033[31mip\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u6b63\u5728\u4e0b\u8f7d\u5b89\u88c5\uff01\\033[0m\"\nif os=\"ubuntu\"; then\napt install -y iproute2 &gt;/dev/null 2&gt;&amp;1\nelif os=\"centos\"; then\nyum install -y iproute2 &gt;/dev/null 2&gt;&amp;1\nelif os=\"fedora\"; then\ndnf install -y iproute2 &gt;/dev/null 2&gt;&amp;1\nfi\nelif ! command -v curl &gt;/dev/null 2&gt;&amp;1; then\necho -e \"\\033[31mcurl\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u6b63\u5728\u4e0b\u8f7d\u5b89\u88c5\uff01\\033[0m\"\nif os=\"ubuntu\"; then\napt install -y curl &gt;/dev/null 2&gt;&amp;1\nelif os=\"centos\"; then\nyum install -y curl &gt;/dev/null 2&gt;&amp;1\nelif os=\"fedora\"; then\ndnf install -y curl &gt;/dev/null 2&gt;&amp;1\nfi\nelif ! command -v wget &gt;/dev/null 2&gt;&amp;1; then\necho -e \"\\033[31mawk\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u6b63\u5728\u4e0b\u8f7d\u5b89\u88c5\uff01\\033[0m\"\nif os=\"ubuntu\"; then\napt install -y wget &gt;/dev/null 2&gt;&amp;1\nelif os=\"centos\"; then\nyum install -y wget &gt;/dev/null 2&gt;&amp;1\nelif os=\"fedora\"; then\ndnf install -y wget &gt;/dev/null 2&gt;&amp;1\nfi\nelif ! command -v tail &gt;/dev/null 2&gt;&amp;1; then\necho -e \"\\033[31mcoreutils\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u6b63\u5728\u4e0b\u8f7d\u5b89\u88c5\uff01\\033[0m\"\nif os=\"ubuntu\"; then\napt install -y coreutils &gt;/dev/null 2&gt;&amp;1\nelif os=\"centos\"; then\nyum install -y coreutils &gt;/dev/null 2&gt;&amp;1\nelif os=\"fedora\"; then\ndnf install -y coreutils &gt;/dev/null 2&gt;&amp;1\nfi\nelif ! command -v sed &gt;/dev/null 2&gt;&amp;1; then\necho -e \"\\033[31msed\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u6b63\u5728\u4e0b\u8f7d\u5b89\u88c5\uff01\\033[0m\"\nif os=\"ubuntu\"; then\napt install -y sed &gt;/dev/null 2&gt;&amp;1\nelif os=\"centos\"; then\nyum install -y sed &gt;/dev/null 2&gt;&amp;1\nelif os=\"fedora\"; then\ndnf install -y sed &gt;/dev/null 2&gt;&amp;1\nfi\nelif ! command -v grep &gt;/dev/null 2&gt;&amp;1; then\necho -e \"\\033[31mgrep\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u6b63\u5728\u4e0b\u8f7d\u5b89\u88c5\uff01\\033[0m\"\nif os=\"ubuntu\"; then\napt install -y grep &gt;/dev/null 2&gt;&amp;1\nelif os=\"centos\"; then\nyum install -y grep &gt;/dev/null 2&gt;&amp;1\nelif os=\"fedora\"; then\ndnf install -y grep &gt;/dev/null 2&gt;&amp;1\nfi\nfi\n}\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#36\u53d1\u9001\u9489\u9489\u901a\u77e5","title":"36.\u53d1\u9001\u9489\u9489\u901a\u77e5","text":"<pre><code>function sendDingDing(){\nDing_Webhook_Token='\u9489\u9489\u673a\u5668\u4eba\u7684WebHook Token'\nDing_Webhook_keyword=\"\u53ef\u7528\u4f5c\u6d88\u606f\u6807\u9898\"\nsend_result=$(curl -sS \\\n-XPOST https://oapi.dingtalk.com/robot/send?access_token=\"$Ding_Webhook_Token\" \\\n-H 'Content-Type: application/json' \\\n-d '{\"msgtype\": \"markdown\",\"markdown\": {\"title\": \"'$Ding_Webhook_Keyword'\",\"text\": \"'\"$*\"'\"},\"at\": {\"isAtAll\": true}}')\nif [ $(echo $send_result | jq -r '.errcode') -eq 0 ]; then\necho \"\u53d1\u9001\u6210\u529f:  \\n\" $*\" \"\nelse\necho \"\u53d1\u9001\u5931\u8d25:  \\n\" $*\"\\n\"\necho $send_result\nfi\n}\nsendDingDing  \"$(date +\"%F %H:%M:%S\") \u9700\u8981\u544a\u8b66\u7684\u6d88\u606f\"\n</code></pre>"},{"location":"Linux/shell/17.Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/#37function\u51fd\u6570\u5e93","title":"37.function\u51fd\u6570\u5e93","text":"<pre><code>#!/usr/bin/env bash\n# -*-Shell-script-*-\n#\n# functions This file contains functions to be used by most or all\n#       shell scripts in the /etc/init.d directory.\n#\n:&lt;&lt;EOF\ncheckpid():\u68c0\u67e5\u662f\u5426\u5df2\u5b58\u5728pid\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u5b58\u5728\uff0c\u8fd4\u56de0\uff08\u901a\u8fc7\u67e5\u770b/proc\u76ee\u5f55\uff09\ndaemon():\u542f\u52a8\u67d0\u4e2a\u670d\u52a1\u3002/etc/init.d\u76ee\u5f55\u90e8\u5206\u811a\u672c\u7684start\u4f7f\u7528\u5230\u8fd9\u4e2a\nkillproc():\u6740\u6b7b\u67d0\u4e2a\u8fdb\u7a0b\u3002/etc/init.d\u76ee\u5f55\u90e8\u5206\u811a\u672c\u7684stop\u4f7f\u7528\u5230\u8fd9\u4e2a\npidfileofproc():\u5bfb\u627e\u67d0\u4e2a\u8fdb\u7a0b\u7684pid\npidofproc():\u7c7b\u4f3c\u4e0a\u9762\u7684\uff0c\u53ea\u662f\u8fd8\u67e5\u627e\u4e86pidof\u547d\u4ee4\nstatus():\u8fd4\u56de\u4e00\u4e2a\u670d\u52a1\u7684\u72b6\u6001\necho_success():\u6253\u5370OK\necho_failure():\u6253\u5370FAILED\necho_passed():\u6253\u5370PASSED\necho_warning():\u6253\u5370WARNING\nsuccess():\u6253\u5370OK\u5e76\u8bb0\u5f55\u65e5\u5fd7\nfailure():\u6253\u5370FAILED\u5e76\u8bb0\u5f55\u65e5\u5fd7\npassed():\u6253\u5370PASSED\u5e76\u8bb0\u5f55\u65e5\u5fd7\naction():\u6253\u5370\u67d0\u4e2a\u4fe1\u606f\u5e76\u6267\u884c\u7ed9\u5b9a\u7684\u547d\u4ee4\uff0c\u5b83\u4f1a\u6839\u636e\u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u6765\u8c03\u7528 success,failure\u65b9\u6cd5\nstrstr():\u5224\u65ad$1\u662f\u5426\u542b\u6709$2\nconfirm():\u63d0\u793a\u662f\u5426\u542f\u52a8\u67d0\u4e2a\u670d\u52a1\nis_ignored_file():\u68c0\u67e5$1\u6587\u4ef6\u662f\u5426\u662f*.bak\u3001*.orig\u3001*.rpmnew....\u7b49\u6587\u4ef6\nis_true()/is_false():\u4ea4\u4e92\u5f0fyes|no\u7684\u9009\u9879\napply_sysctl()\u5e94\u7528sysctl\u8bbe\u7f6e\uff0c\u5305\u62ec/etc/sysctl.d\u4e2d\u7684\u6587\u4ef6\nEOF\nTEXTDOMAIN=initscripts\n\n# Make sure umask is sane\numask 022\n# Set up a default search path.\nPATH=\"/sbin:/usr/sbin:/bin:/usr/bin\"\n#\u5bfc\u51fa\u73af\u5883\u53d8\u91cf\nexport PATH\n\n#\u5224\u65adPPID\u548c\u5b57\u7b26\u4e32\u5426\u4e3a\u7a7a\nif [ $PPID -ne 1 -a -z \"$SYSTEMCTL_SKIP_REDIRECT\" ] &amp;&amp; \\\n[ -d /run/systemd/system ] ; then\ncase \"$0\" in\n/etc/init.d/*|/etc/rc.d/init.d/*)\n_use_systemctl=1\n;;\nesac\nfi\nsystemctl_redirect () {\nlocal s\n    local prog=${1##*/}\nlocal command=$2\nlocal options=\"\"\ncase \"$command\" in\nstart)\ns=$\"Starting $prog (via systemctl): \"\n;;\nstop)\ns=$\"Stopping $prog (via systemctl): \"\n;;\nreload|try-reload)\ns=$\"Reloading $prog configuration (via systemctl): \"\n;;\nrestart|try-restart|condrestart)\ns=$\"Restarting $prog (via systemctl): \"\n;;\nesac\nif [ -n \"$SYSTEMCTL_IGNORE_DEPENDENCIES\" ] ; then\noptions=\"--ignore-dependencies\"\nfi\nif ! systemctl show \"$prog.service\" &gt; /dev/null 2&gt;&amp;1 || \\\nsystemctl show -p LoadState \"$prog.service\" | grep -q 'not-found' ; then\naction $\"Reloading systemd: \" /bin/systemctl daemon-reload\n    fi\naction \"$s\" /bin/systemctl $options $command \"$prog.service\"\n}\n# Get a sane screen width\n[ -z \"${COLUMNS:-}\" ] &amp;&amp; COLUMNS=80\nif [ -z \"${CONSOLETYPE:-}\" ]; then\nif [ -c \"/dev/stderr\" -a -r \"/dev/stderr\" ]; then\nCONSOLETYPE=\"$(/sbin/consoletype &lt; /dev/stderr 2&gt;/dev/null)\"\nelse\nCONSOLETYPE=\"serial\"\nfi\nfi\nif [ -z \"${NOLOCALE:-}\" ] &amp;&amp; [ -z \"${LANGSH_SOURCED:-}\" ] &amp;&amp; \\\n[ -f /etc/sysconfig/i18n -o -f /etc/locale.conf ] ; then\n. /etc/profile.d/lang.sh 2&gt;/dev/null\n    # avoid propagating LANGSH_SOURCED any further\nunset LANGSH_SOURCED\nfi\n# Read in our configuration\nif [ -z \"${BOOTUP:-}\" ]; then\nif [ -f /etc/sysconfig/init ]; then\n. /etc/sysconfig/init\n    else\n# This all seem confusing? Look in /etc/sysconfig/init,\n# or in /usr/share/doc/initscripts-*/sysconfig.txt\nBOOTUP=color\n        RES_COL=60\nMOVE_TO_COL=\"echo -en \\\\033[${RES_COL}G\"\nSETCOLOR_SUCCESS=\"echo -en \\\\033[1;32m\"\nSETCOLOR_FAILURE=\"echo -en \\\\033[1;31m\"\nSETCOLOR_WARNING=\"echo -en \\\\033[1;33m\"\nSETCOLOR_NORMAL=\"echo -en \\\\033[0;39m\"\nLOGLEVEL=1\nfi\nif [ \"$CONSOLETYPE\" = \"serial\" ]; then\nBOOTUP=serial\n        MOVE_TO_COL=\nSETCOLOR_SUCCESS=\nSETCOLOR_FAILURE=\nSETCOLOR_WARNING=\nSETCOLOR_NORMAL=\nfi\nfi\n# Check if any of $pid (could be plural) are running\ncheckpid() {\nlocal i\n\nfor i in $* ; do\n[ -d \"/proc/$i\" ] &amp;&amp; return 0\ndone\nreturn 1\n}\n__kill_pids_term_kill_checkpids() {\nlocal base_stime=$1\nshift 1\nlocal pid=\nlocal pids=$*\nlocal remaining=\nlocal stat=\nlocal stime=\nfor pid in $pids ; do\n[ ! -e  \"/proc/$pid\" ] &amp;&amp; continue\nread -r line &lt; \"/proc/$pid/stat\" 2&gt; /dev/null\n\nstat=($line)\nstime=${stat[21]}\n[ -n \"$stime\" ] &amp;&amp; [ \"$base_stime\" -lt \"$stime\" ] &amp;&amp; continue\nremaining+=\"$pid \"\ndone\necho \"$remaining\"\n[ -n \"$remaining\" ] &amp;&amp; return 1\nreturn 0\n}\n__kill_pids_term_kill() {\nlocal try=0\nlocal delay=3;\nlocal pid=\nlocal stat=($(&lt; /proc/self/stat))\nlocal base_stime=${stat[21]}\nif [ \"$1\" = \"-d\" ]; then\ndelay=$2\nshift 2\nfi\nlocal kill_list=$*\nkill_list=$(__kill_pids_term_kill_checkpids $base_stime $kill_list)\n[ -z \"$kill_list\" ] &amp;&amp; return 0\nkill -TERM $kill_list &gt;/dev/null 2&gt;&amp;1\nusleep 100000\nkill_list=$(__kill_pids_term_kill_checkpids $base_stime $kill_list)\nif [ -n \"$kill_list\" ] ; then\nwhile [ $try -lt $delay ] ; do\nsleep 1\nkill_list=$(__kill_pids_term_kill_checkpids $base_stime $kill_list)\n[ -z \"$kill_list\" ] &amp;&amp; break\nlet try+=1\ndone\nif [ -n \"$kill_list\" ] ; then\nkill -KILL $kill_list &gt;/dev/null 2&gt;&amp;1\nusleep 100000\nkill_list=$(__kill_pids_term_kill_checkpids $base_stime $kill_list)\nfi\nfi\n[ -n \"$kill_list\" ] &amp;&amp; return 1\nreturn 0\n}\n# __proc_pids {program} [pidfile]\n# Set $pid to pids from /var/run* for {program}.  $pid should be declared\n# local in the caller.\n# Returns LSB exit code for the 'status' action.\n__pids_var_run() {\nlocal base=${1##*/}\nlocal pid_file=${2:-/var/run/$base.pid}\nlocal pid_dir=$(/usr/bin/dirname $pid_file &gt; /dev/null)\nlocal binary=$3\n[ -d \"$pid_dir\" -a ! -r \"$pid_dir\" ] &amp;&amp; return 4\npid=\nif [ -f \"$pid_file\" ] ; then\nlocal line p\n\n[ ! -r \"$pid_file\" ] &amp;&amp; return 4 # \"user had insufficient privilege\"\nwhile : ; do\nread line\n            [ -z \"$line\" ] &amp;&amp; break\nfor p in $line ; do\nif [ -z \"${p//[0-9]/}\" ] &amp;&amp; [ -d \"/proc/$p\" ] ; then\nif [ -n \"$binary\" ] ; then\nlocal b=$(readlink /proc/$p/exe | sed -e 's/\\s*(deleted)$//')\n[ \"$b\" != \"$binary\" ] &amp;&amp; continue\nfi\npid=\"$pid $p\"\nfi\ndone\ndone &lt; \"$pid_file\"\nif [ -n \"$pid\" ]; then\nreturn 0\nfi\nreturn 1 # \"Program is dead and /var/run pid file exists\"\nfi\nreturn 3 # \"Program is not running\"\n}\n# Output PIDs of matching processes, found using pidof\n__pids_pidof() {\npidof -c -m -o $$ -o $PPID -o %PPID -x \"$1\" || \\\npidof -c -m -o $$ -o $PPID -o %PPID -x \"${1##*/}\"\n}\n# A function to start a program.\ndaemon() {\n# Test syntax.\nlocal gotbase= force= nicelevel corelimit\n    local pid base= user= nice= bg= pid_file=\nlocal cgroup=\nnicelevel=0\nwhile [ \"$1\" != \"${1##[-+]}\" ]; do\ncase $1 in\n'')\necho $\"$0: Usage: daemon [+/-nicelevel] {program}\" \"[arg1]...\"\nreturn 1\n;;\n--check)\nbase=$2\ngotbase=\"yes\"\nshift 2\n;;\n--check=?*)\nbase=${1#--check=}\ngotbase=\"yes\"\nshift\n;;\n--user)\nuser=$2\nshift 2\n;;\n--user=?*)\nuser=${1#--user=}\nshift\n;;\n--pidfile)\npid_file=$2\nshift 2\n;;\n--pidfile=?*)\npid_file=${1#--pidfile=}\nshift\n;;\n--force)\nforce=\"force\"\nshift\n;;\n[-+][0-9]*)\nnice=\"nice -n $1\"\nshift\n;;\n*)\necho $\"$0: Usage: daemon [+/-nicelevel] {program}\" \"[arg1]...\"\nreturn 1\n;;\nesac\ndone\n# Save basename.\n[ -z \"$gotbase\" ] &amp;&amp; base=${1##*/}\n# See if it's already running. Look *only* at the pid file.\n__pids_var_run \"$base\" \"$pid_file\"\n[ -n \"$pid\" -a -z \"$force\" ] &amp;&amp; return\n# make sure it doesn't core dump anywhere unless requested\ncorelimit=\"ulimit -S -c ${DAEMON_COREFILE_LIMIT:-0}\"\n# if they set NICELEVEL in /etc/sysconfig/foo, honor it\n[ -n \"${NICELEVEL:-}\" ] &amp;&amp; nice=\"nice -n $NICELEVEL\"\n# if they set CGROUP_DAEMON in /etc/sysconfig/foo, honor it\nif [ -n \"${CGROUP_DAEMON}\" ]; then\nif [ ! -x /bin/cgexec ]; then\necho -n \"Cgroups not installed\"; warning\n            echo\nelse\ncgroup=\"/bin/cgexec\";\nfor i in $CGROUP_DAEMON; do\ncgroup=\"$cgroup -g $i\";\ndone\nfi\nfi\n# Echo daemon\n[ \"${BOOTUP:-}\" = \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo -n \" $base\"\n# And start it up.\nif [ -z \"$user\" ]; then\n$cgroup $nice /bin/bash -c \"$corelimit &gt;/dev/null 2&gt;&amp;1 ; $*\"\nelse\n$cgroup $nice runuser -s /bin/bash $user -c \"$corelimit &gt;/dev/null 2&gt;&amp;1 ; $*\"\nfi\n[ \"$?\" -eq 0 ] &amp;&amp; success $\"$base startup\" || failure $\"$base startup\"\n}\n# A function to stop a program.\nkillproc() {\nlocal RC killlevel= base pid pid_file= delay try binary=\nRC=0; delay=3; try=0\n# Test syntax.\nif [ \"$#\" -eq 0 ]; then\necho $\"Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]\"\nreturn 1\nfi\nif [ \"$1\" = \"-p\" ]; then\npid_file=$2\nshift 2\nfi\nif [ \"$1\" = \"-b\" ]; then\nif [ -z $pid_file ]; then\necho $\"-b option can be used only with -p\"\necho $\"Usage: killproc -p pidfile -b binary program\"\nreturn 1\nfi\nbinary=$2\nshift 2\nfi\nif [ \"$1\" = \"-d\" ]; then\ndelay=$(echo $2 | awk -v RS=' ' -v IGNORECASE=1 '{if($1!~/^[0-9.]+[smhd]?$/) exit 1;d=$1~/s$|^[0-9.]*$/?1:$1~/m$/?60:$1~/h$/?60*60:$1~/d$/?24*60*60:-1;if(d==-1) exit 1;delay+=d*$1} END {printf(\"%d\",delay+0.5)}')\nif [ \"$?\" -eq 1 ]; then\necho $\"Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]\"\nreturn 1\nfi\nshift 2\nfi\n# check for second arg to be kill level\n[ -n \"${2:-}\" ] &amp;&amp; killlevel=$2\n# Save basename.\nbase=${1##*/}\n# Find pid.\n__pids_var_run \"$1\" \"$pid_file\" \"$binary\"\nRC=$?\nif [ -z \"$pid\" ]; then\nif [ -z \"$pid_file\" ]; then\npid=\"$(__pids_pidof \"$1\")\"\nelse\n[ \"$RC\" = \"4\" ] &amp;&amp; { failure $\"$base shutdown\" ; return $RC ;}\nfi\nfi\n# Kill it.\nif [ -n \"$pid\" ] ; then\n[ \"$BOOTUP\" = \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo -n \"$base \"\nif [ -z \"$killlevel\" ] ; then\n__kill_pids_term_kill -d $delay $pid\nRC=$?\n[ \"$RC\" -eq 0 ] &amp;&amp; success $\"$base shutdown\" || failure $\"$base shutdown\"\n# use specified level only\nelse\nif checkpid $pid; then\nkill $killlevel $pid &gt;/dev/null 2&gt;&amp;1\nRC=$?\n[ \"$RC\" -eq 0 ] &amp;&amp; success $\"$base $killlevel\" || failure $\"$base $killlevel\"\nelif [ -n \"${LSB:-}\" ]; then\nRC=7 # Program is not running\nfi\nfi\nelse\nif [ -n \"${LSB:-}\" -a -n \"$killlevel\" ]; then\nRC=7 # Program is not running\nelse\nfailure $\"$base shutdown\"\nRC=0\nfi\nfi\n# Remove pid file if any.\nif [ -z \"$killlevel\" ]; then\nrm -f \"${pid_file:-/var/run/$base.pid}\"\nfi\nreturn $RC\n}\n# A function to find the pid of a program. Looks *only* at the pidfile\npidfileofproc() {\nlocal pid\n\n# Test syntax.\nif [ \"$#\" = 0 ] ; then\necho $\"Usage: pidfileofproc {program}\"\nreturn 1\nfi\n__pids_var_run \"$1\"\n[ -n \"$pid\" ] &amp;&amp; echo $pid\nreturn 0\n}\n# A function to find the pid of a program.\npidofproc() {\nlocal RC pid pid_file=\n# Test syntax.\nif [ \"$#\" = 0 ]; then\necho $\"Usage: pidofproc [-p pidfile] {program}\"\nreturn 1\nfi\nif [ \"$1\" = \"-p\" ]; then\npid_file=$2\nshift 2\nfi\nfail_code=3 # \"Program is not running\"\n# First try \"/var/run/*.pid\" files\n__pids_var_run \"$1\" \"$pid_file\"\nRC=$?\nif [ -n \"$pid\" ]; then\necho $pid\nreturn 0\nfi\n[ -n \"$pid_file\" ] &amp;&amp; return $RC\n__pids_pidof \"$1\" || return $RC\n}\nstatus() {\nlocal base pid lock_file= pid_file= binary=\n# Test syntax.\nif [ \"$#\" = 0 ] ; then\necho $\"Usage: status [-p pidfile] {program}\"\nreturn 1\nfi\nif [ \"$1\" = \"-p\" ]; then\npid_file=$2\nshift 2\nfi\nif [ \"$1\" = \"-l\" ]; then\nlock_file=$2\nshift 2\nfi\nif [ \"$1\" = \"-b\" ]; then\nif [ -z $pid_file ]; then\necho $\"-b option can be used only with -p\"\necho $\"Usage: status -p pidfile -b binary program\"\nreturn 1\nfi\nbinary=$2\nshift 2\nfi\nbase=${1##*/}\nif [ \"$_use_systemctl\" = \"1\" ]; then\nsystemctl status ${0##*/}.service\n        ret=$?\n# LSB daemons that dies abnormally in systemd looks alive in systemd's eyes due to RemainAfterExit=yes\n# lets adjust the reality a little bit\nif systemctl show -p ActiveState ${0##*/}.service | grep -q '=active$' &amp;&amp; \\\nsystemctl show -p SubState ${0##*/}.service | grep -q '=exited$' ; then\nret=3\nfi\nreturn $ret\nfi\n# First try \"pidof\"\n__pids_var_run \"$1\" \"$pid_file\" \"$binary\"\nRC=$?\nif [ -z \"$pid_file\" -a -z \"$pid\" ]; then\npid=\"$(__pids_pidof \"$1\")\"\nfi\nif [ -n \"$pid\" ]; then\necho $\"${base} (pid $pid) is running...\"\nreturn 0\nfi\ncase \"$RC\" in\n0)\necho $\"${base} (pid $pid) is running...\"\nreturn 0\n;;\n1)\necho $\"${base} dead but pid file exists\"\nreturn 1\n;;\n4)\necho $\"${base} status unknown due to insufficient privileges.\"\nreturn 4\n;;\nesac\nif [ -z \"${lock_file}\" ]; then\nlock_file=${base}\nfi\n# See if /var/lock/subsys/${lock_file} exists\nif [ -f /var/lock/subsys/${lock_file} ]; then\necho $\"${base} dead but subsys locked\"\nreturn 2\nfi\necho $\"${base} is stopped\"\nreturn 3\n}\necho_success() {\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $MOVE_TO_COL\necho -n \"[\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_SUCCESS\necho -n $\"  OK  \"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_NORMAL\necho -n \"]\"\necho -ne \"\\r\"\nreturn 0\n}\necho_failure() {\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $MOVE_TO_COL\necho -n \"[\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_FAILURE\necho -n $\"FAILED\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_NORMAL\necho -n \"]\"\necho -ne \"\\r\"\nreturn 1\n}\necho_passed() {\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $MOVE_TO_COL\necho -n \"[\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_WARNING\necho -n $\"PASSED\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_NORMAL\necho -n \"]\"\necho -ne \"\\r\"\nreturn 1\n}\necho_warning() {\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $MOVE_TO_COL\necho -n \"[\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_WARNING\necho -n $\"WARNING\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_NORMAL\necho -n \"]\"\necho -ne \"\\r\"\nreturn 1\n}\n# Inform the graphical boot of our current state\nupdate_boot_stage() {\nif [ -x /bin/plymouth ]; then\n/bin/plymouth --update=\"$1\"\nfi\nreturn 0\n}\n# Log that something succeeded\nsuccess() {\n[ \"$BOOTUP\" != \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo_success\n    return 0\n}\n# Log that something failed\nfailure() {\nlocal rc=$?\n[ \"$BOOTUP\" != \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo_failure\n    [ -x /bin/plymouth ] &amp;&amp; /bin/plymouth --details\n    return $rc\n}\n# Log that something passed, but may have had errors. Useful for fsck\npassed() {\nlocal rc=$?\n[ \"$BOOTUP\" != \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo_passed\n    return $rc\n}\n# Log a warning\nwarning() {\nlocal rc=$?\n[ \"$BOOTUP\" != \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo_warning\n    return $rc\n}\n# Run some action. Log its output.\naction() {\nlocal STRING rc\n\nSTRING=$1\necho -n \"$STRING \"\nshift\n\"$@\" &amp;&amp; success $\"$STRING\" || failure $\"$STRING\"\nrc=$?\necho\nreturn $rc\n}\n# returns OK if $1 contains $2\nstrstr() {\n[ \"${1#*$2*}\" = \"$1\" ] &amp;&amp; return 1\nreturn 0\n}\n# Check whether file $1 is a backup or rpm-generated file and should be ignored\nis_ignored_file() {\ncase \"$1\" in\n*~ | *.bak | *.orig | *.rpmnew | *.rpmorig | *.rpmsave)\nreturn 0\n;;\nesac\nreturn 1\n}\n# Evaluate shvar-style booleans\nis_true() {\ncase \"$1\" in\n[tT] | [yY] | [yY][eE][sS] | [tT][rR][uU][eE] | 1)\nreturn 0\n;;\nesac\nreturn 1\n}\n# Evaluate shvar-style booleans\nis_false() {\ncase \"$1\" in\n[fF] | [nN] | [nN][oO] | [fF][aA][lL][sS][eE] | 0)\nreturn 0\n;;\nesac\nreturn 1\n}\n# Apply sysctl settings, including files in /etc/sysctl.d\napply_sysctl() {\nif [ -x /lib/systemd/systemd-sysctl ]; then\n/lib/systemd/systemd-sysctl\n    else\nfor file in /usr/lib/sysctl.d/*.conf ; do\nis_ignored_file \"$file\" &amp;&amp; continue\n[ -f /run/sysctl.d/${file##*/} ] &amp;&amp; continue\n[ -f /etc/sysctl.d/${file##*/} ] &amp;&amp; continue\ntest -f \"$file\" &amp;&amp; sysctl -e -p \"$file\" &gt;/dev/null 2&gt;&amp;1\ndone\nfor file in /run/sysctl.d/*.conf ; do\nis_ignored_file \"$file\" &amp;&amp; continue\n[ -f /etc/sysctl.d/${file##*/} ] &amp;&amp; continue\ntest -f \"$file\" &amp;&amp; sysctl -e -p \"$file\" &gt;/dev/null 2&gt;&amp;1\ndone\nfor file in /etc/sysctl.d/*.conf ; do\nis_ignored_file \"$file\" &amp;&amp; continue\ntest -f \"$file\" &amp;&amp; sysctl -e -p \"$file\" &gt;/dev/null 2&gt;&amp;1\ndone\nsysctl -e -p /etc/sysctl.conf &gt;/dev/null 2&gt;&amp;1\nfi\n}\n# A sed expression to filter out the files that is_ignored_file recognizes\n__sed_discard_ignored_files='/\\(~\\|\\.bak\\|\\.orig\\|\\.rpmnew\\|\\.rpmorig\\|\\.rpmsave\\)$/d'\nif [ \"$_use_systemctl\" = \"1\" ]; then\nif  [ \"x$1\" = xstart -o \\\n\"x$1\" = xstop -o \\\n\"x$1\" = xrestart -o \\\n\"x$1\" = xreload -o \\\n\"x$1\" = xtry-restart -o \\\n\"x$1\" = xforce-reload -o \\\n\"x$1\" = xcondrestart ] ; then\nsystemctl_redirect $0 $1\nexit $?\nfi\nfi\nstrstr \"$(cat /proc/cmdline)\" \"rc.debug\" &amp;&amp; set -x\nreturn 0\n</code></pre>"},{"location":"Linux/shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/","title":"18.Shell\u811a\u672c\u7684\u53c2\u6570\u89e3\u6790\u5de5\u5177","text":""},{"location":"Linux/shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/#\u7b80\u5355demo","title":"\u7b80\u5355demo","text":"<p>\u8be5\u811a\u672c\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u53c2\u6570\u6765\u6307\u5b9a\u4e0d\u540c\u7684\u9009\u9879\u3002</p> <pre><code>#!/bin/bash\nversion=\"1.0.0\"\nstring=\"\"\nflag=0\nwhile [[ \"$1\" =~ ^- &amp;&amp; ! \"$1\" == \"--\" ]]; do\ncase $1 in\n-V | --version )\necho $version\nexit\n;;\n-s | --string )\nshift; string=$1\n;;\n-f | --flag )\nflag=1\n;;\nesac;\nshift; # shift n \u8868\u793a\u628a\u7b2cn+1\u4e2a\u53c2\u6570\u79fb\u5230\u7b2c1\u4e2a\u53c2\u6570, \u5373\u547d\u4ee4\u7ed3\u675f\u540e$1\u7684\u503c\u7b49\u4e8e$n+1\u7684\u503c\ndone\necho $string\necho $flag\n</code></pre> <p>\u5176\u4e2d [options] \u662f\u60a8\u8981\u4f20\u9012\u7ed9\u811a\u672c\u7684\u9009\u9879\u3002\u4e0b\u9762\u662f\u8be5\u811a\u672c\u652f\u6301\u7684\u9009\u9879\u8bf4\u660e\uff1a</p> <pre><code>-V \u6216 --version: \u663e\u793a\u7248\u672c\u4fe1\u606f\u5e76\u9000\u51fa\u811a\u672c\u3002\n-s \u6216 --string: \u6307\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u53c2\u6570\uff0c\u5e76\u5c06\u5176\u8d4b\u503c\u7ed9\u53d8\u91cf string\u3002\n-f \u6216 --flag: \u8bbe\u7f6e\u4e00\u4e2a\u6807\u5fd7\u53d8\u91cf flag\n</code></pre> <p>\u4f7f\u7528 <pre><code>./script.sh -V      # \u663e\u793a\u7248\u672c\u4fe1\u606f\n./script.sh -s hello  # \u6307\u5b9a\u5b57\u7b26\u4e32\u53c2\u6570\u4e3a \"hello\"\n./script.sh -f       # \u8bbe\u7f6e\u6807\u5fd7\u53d8\u91cf flag\n./script.sh -s world -f  # \u6307\u5b9a\u5b57\u7b26\u4e32\u53c2\u6570\u4e3a \"world\" \u5e76\u8bbe\u7f6e\u6807\u5fd7\u53d8\u91cf flag\n</code></pre></p>"},{"location":"Linux/shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/#1-\u4f7f\u7528\u7a7a\u683c\u5206\u9694","title":"1. \u4f7f\u7528\u7a7a\u683c\u5206\u9694","text":"<p>\u5b9e\u9645\u7528\u6cd5</p> <pre><code>./myscript.sh -e conf -s /etc -l /usr/lib /etc/hosts\n</code></pre> <p>\u5b9e\u73b0\u811a\u672c</p> <pre><code>#!/bin/bash\nPOSITIONAL=()\nwhile [[ $# -gt 0 ]]; do\nkey=\"$1\"\ncase $key in\n-e|--extension)\nEXTENSION=\"$2\"\nshift # past argument\nshift # past value\n;;\n-s|--searchpath)\nSEARCHPATH=\"$2\"\nshift # past argument\nshift # past value\n;;\n-l|--lib)\nLIBPATH=\"$2\"\nshift # past argument\nshift # past value\n;;\n--default)\nDEFAULT=YES\n      shift # past argument\n;;\n*)\nPOSITIONAL+=(\"$1\") # save it in an array for later\nshift # past argument\n;;\nesac\ndone\nset -- \"${POSITIONAL[@]}\" # restore positional parameters\necho FILE EXTENSION  = \"${EXTENSION}\"\necho SEARCH PATH     = \"${SEARCHPATH}\"\necho LIBRARY PATH    = \"${LIBPATH}\"\necho DEFAULT         = \"${DEFAULT}\"\necho \"Number files in SEARCH PATH with EXTENSION:\" $(ls -1 \"${SEARCHPATH}\"/*.\"${EXTENSION}\" | wc -l)\nif [[ -n $1 ]]; then\necho \"Last line of file specified as non-opt/last argument:\"\ntail -1 \"$1\"\nfi\n</code></pre>"},{"location":"Linux/shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/#2-\u4f7f\u7528\u7b49\u53f7\u5206\u9694","title":"2. \u4f7f\u7528\u7b49\u53f7\u5206\u9694","text":"<p>\u5b9e\u9645\u7528\u6cd5</p> <pre><code>./myscript.sh -e=conf -s=/etc -l=/usr/lib /etc/hosts\n</code></pre> <p>\u5b9e\u73b0\u811a\u672c</p> <pre><code>#!/bin/bash\nfor key in \"$@\"; do\ncase $key in\n-e=*|--extension=*)\nEXTENSION=\"${key#*=}\"\nshift # past argument=value\n;;\n-s=*|--searchpath=*)\nSEARCHPATH=\"${key#*=}\"\nshift # past argument=value\n;;\n-l=*|--lib=*)\nLIBPATH=\"${key#*=}\"\nshift # past argument=value\n;;\n--default)\nDEFAULT=YES\n      shift # past argument with no value\n;;\n*)\n;;\nesac\ndone\necho \"FILE EXTENSION  = ${EXTENSION}\"\necho \"SEARCH PATH     = ${SEARCHPATH}\"\necho \"LIBRARY PATH    = ${LIBPATH}\"\necho \"Number files in SEARCH PATH with EXTENSION:\" $(ls -1 \"${SEARCHPATH}\"/*.\"${EXTENSION}\" | wc -l)\nif [[ -n $1 ]]; then\necho \"Last line of file specified as non-opt/last argument:\"\ntail -1 $1\nfi </code></pre>"},{"location":"Linux/shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/#3-\u4f7f\u7528-getopts-\u5de5\u5177","title":"3. \u4f7f\u7528 getopts \u5de5\u5177","text":"<p>\u5b9e\u9645\u7528\u6cd5</p> <pre><code>./myscript.sh -h\n./myscript.sh -v -f\n</code></pre> <p>\u5b9e\u73b0\u811a\u672c</p> <pre><code>#!/bin/sh\n# \u91cd\u7f6e\u4ee5\u9632\u6b62\u5728\u524d\u9762\u7684shell\u4e2d\u4f7f\u7528getopts\u5de5\u5177(\u8fd9\u662f\u4e00\u4e2aPOSIX\u53d8\u91cf)\nOPTIND=1\n# \u521d\u59cb\u5316\u53d8\u91cf\u540d\u79f0\nOUTPUT_FILE=\"\"\nVERSION=0\n# getopts\u7684\u7f3a\u70b9\u5c31\u662f\u5b83\u53ea\u80fd\u5904\u7406\u77ed\u9009\u9879\uff0c\u5982-h\uff0c\u800c\u4e0d\u80fd\u662f--help\u683c\u5f0f\nwhile getopts \"h?vf:\" key; do\ncase \"$key\" in\nh|\\?)\nshow_help\n        exit 0\n;;\nv)\nVERSION=1\n;;\nf)\noutput_file=$OPTARG\n;;\nesac\ndone\nshift $((OPTIND-1))\n[ \"${1:-}\" = \"--\" ] &amp;&amp; shift\necho \"verbose=$VERSION, output_file='$output_file', Leftovers: $@\" |\n</code></pre>"},{"location":"Linux/shell/18.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7/#4-\u4f7f\u7528-argbash-\u5de5\u5177","title":"4. \u4f7f\u7528 argbash \u5de5\u5177","text":"<p>\u8fd9\u4e2a\u5de5\u5177\u4e3b\u8981\u63d0\u4f9b\u811a\u672c\u53c2\u6570\u7684\u89e3\u6790\u529f\u80fd\uff0c\u800c\u4e14\u4e0d\u518d\u5f15\u7528\u4efb\u4f55\u7b2c\u4e09\u65b9\u5e93\u7684\u60c5\u51b5\u4e0b\u3002\u4e00\u822c\u4f1a\u6bd4\u666e\u901a\u811a\u672c\u591a30\u591a\u884c\u800c\u4e14\uff0c\u4f46\u662f\u6548\u679c\u975e\u5e38\u597d\u3002 \u8be6\u7ec6\u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9\u7f51\u7ad9\u5730\u5740\u4e86\u89e3\u3002</p> <p>https://argbash.io/generate#results</p> <pre><code>#!/bin/bash\n# This is a rather minimal example Argbash potential\n# Example taken from http://argbash.readthedocs.io/en/stable/example.html\n# [\u53ef\u9009\u53c2\u6570]\n# ARG_OPTIONAL_SINGLE([option], [o], [optional argument help msg])\n# [\u53ef\u9009\u5e03\u5c14\u53c2\u6570]\n# ARG_OPTIONAL_BOOLEAN([print], , [boolean optional argument help msg])\n# [\u56fa\u5b9a\u53c2\u6570]\n# ARG_POSITIONAL_SINGLE([positional-arg], [positional argument help  msg], )\n# [\u5e2e\u52a9\u4fe1\u606f]\n# ARG_HELP([The general script's help msg])\n# ARGBASH_GO\n# [ &lt;-- needed because of Argbash\necho \"Value of --option: $_arg_option\"\necho \"print is $_arg_print\"\necho \"Value of positional-arg: $_arg_positional_arg\"\n# ] &lt;-- needed because of Argbash |\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/","title":"19.\u5b9e\u7528Linux Shell\u811a\u672c\u6848\u4f8b","text":""},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#1\u663e\u793a\u7cfb\u7edf\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f","title":"1.\u663e\u793a\u7cfb\u7edf\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f","text":"<p>\u663e\u793a\u4fe1\u606f\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u7cfb\u7edf\u7248\u672c</p> </li> <li> <p>\u7cfb\u7edf\u5185\u6838</p> </li> <li> <p>\u865a\u62df\u5e73\u53f0</p> </li> <li> <p>\u4e3b\u673a\u540d</p> </li> <li> <p>ip\u5730\u5740</p> </li> <li> <p>\u5f00\u673a\u4fe1\u606f\u6709\u6ca1\u6709\u62a5\u9519\uff0c\u6709\u7684\u8bdd\u8f93\u51fa\u5230\u5c4f\u5e55</p> </li> </ul> <p>\u53ef\u4ee5\u5c06\u8be5\u811a\u672c\u52a0\u5165\u5230\u5f00\u673a\u81ea\u542f\u52a8\u91cc\u9762\uff0c\u8fd9\u6837\u5f00\u673a\u5c31\u4f1a\u8f93\u51fa\u57fa\u672c\u4fe1\u606f</p> <pre><code>#!/bin/bash\ninfo(){\nsystem=$(hostnamectl | grep System | awk '{print $3}')\nkernel_release=$(hostnamectl | grep Kernel | awk -F : '{print $2}')\nVirtualization=$(hostnamectl | grep Virtualization | awk '{print $2}')\nserver_name=$(hostname)\nipaddr=$(hostname -I)\necho \"\u5f53\u524d\u7cfb\u7edf\u7248\u672c\u662f\uff1a${system}\"\necho \"\u5f53\u524d\u7cfb\u7edf\u5185\u6838\u662f\uff1a${kernel_release}\"\necho \"\u5f53\u524d\u865a\u62df\u5e73\u53f0\u662f\uff1a${Virtualization}\"\necho \"\u5f53\u524d\u4e3b\u673a\u540d\u662f\uff1a${server_name}\"\necho \"\u5f53\u524dip\u5730\u5740\uff1a${ipaddr}\"\n}\ncheckerrror(){\nerror_info=$(dmesg | grep error)\nif [ -e ${error_info} ]\nthen\necho \"\u65e0\u9519\u8bef\u65e5\u5fd7\uff01\"\nelse\nehcho ${error_info}\nfi\n}\ninfo\ncheckerrror\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#2\u5173\u95ed\u7cfb\u7edf\u9632\u706b\u5899\u548cselinux","title":"2.\u5173\u95ed\u7cfb\u7edf\u9632\u706b\u5899\u548cSELinux","text":"<ul> <li> <p>\u68c0\u67e5\u9632\u706b\u5899\u72b6\u6001\uff0c\u662f\u5426\u5b89\u88c5\u9632\u706b\u5899\uff0c\u5982\u679c\u5b89\u88c5\u5219\u5173\u95ed</p> </li> <li> <p>\u5173\u95edSELinux</p> </li> <li> <p>\u6e05\u7a7aiptables\u89c4\u5219</p> </li> </ul> <pre><code>#!/bin/bash\nclose_firewalld(){\ncode=$(systemctl status firewalld)\nif [ ${code} -eq 0 ]\nthen\nsystemctl stop firewalld\nfi\n}\nclose_selinux(){\nsed -i  '/^SELINUX/s/=.*/=disabled/' /etc/selinux/config setenforce 0\n}\nclose_iptables(){\niptables -F\nservice iptables  save\nservice iptables  restart\n}\nclose_firewalld\nclose_selinux\nclose_iptables\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#3\u5b9a\u65f6\u4efb\u52a1\u8ba1\u5212\u5f52\u6863\u5907\u4efd","title":"3.\u5b9a\u65f6\u4efb\u52a1\u8ba1\u5212\uff1a\u5f52\u6863\u5907\u4efd","text":"<p>\u6253\u5305\u538b\u7f29/var/log/nginx\u76ee\u5f55\u4e0b\u6240\u6709\u5185\u5bb9\uff0c\u5b58\u653e\u5728/tmp/nginx\u76ee\u5f55\u91cc</p> <p>\u538b\u7f29\u6587\u4ef6\u547d\u540d\u89c4\u8303\uff1ayymmdd_logs.tar.gz\uff0c\u53ea\u4fdd\u5b58\u4e03\u5929\u5185\u7684\u6587\u4ef6\uff0c\u8d85\u8fc7\u4e03\u5929\u7684\u6587\u4ef6\u4f1a\u8fdb\u884c\u6e05\u7406</p> <pre><code>#!bin/bash\ndate=\"$(date +%Y%m%d)\"\ndir='/tmp/nginx'\nbackupfile='yymmdd_logs.tar.gz'\n#\u67e5\u770b/tmp/nginx\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\ncheckbak(){\nif [ ! -e ${dir} ]\nthen\nmkdir ${dir}\nfi\n}\n#\u538b\u7f29\u6587\u4ef6\nbackup(){\ntar -zcvf ${dir}/${backupfile} /var/log/nginx/ &gt; /dev/null 2&gt;&amp;1\necho \"${backupfile} Compressed and packaged successfully \uff01\"\n}\n#\u6e05\u9664\u4e03\u5929\u8fc7\u671f\u6587\u4ef6\ncleanup(){\nfind ${dir} -type f -mtime +7 | xagrs rm -rf\nif [ $? -eq 0 ]\nthen\necho \"Cleaned up successfully\uff01\"\nelse\necho \"data cleaning failed error, please pay attention in time\"\nfi\n}\ncheckbak\nbackup\ncleanup\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#4\u81ea\u52a8\u6279\u91cf\u521b\u5efa\u7528\u6237","title":"4.\u81ea\u52a8\u6279\u91cf\u521b\u5efa\u7528\u6237","text":"<p>\u6279\u91cf\u521b\u5efauser1\u3001user2\u3001user3\u2026..</p> <pre><code>#!/bin/bash\n#\u68c0\u67e5\u7528\u6237\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\ncheckuser(){\nfor i in $(seq 1 20)\ndo\nid user${i} &gt; /dev/null 2&gt;&amp;1\nif [ $? -eq 0 ]\nthen\necho \"user${i} \u5df2\u5b58\u5728\uff01\"\nelse\nuseradd user${i} &amp;&amp; echo \"user${i}\" | passwd --stdin user${i} &gt; /dev/null 2&gt;&amp;1\nfi\ndone\n}\ncheckuser\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#5\u901a\u8fc7\u4f4d\u7f6e\u53c2\u6570\u521b\u5efa\u7528\u6237","title":"5.\u901a\u8fc7\u4f4d\u7f6e\u53c2\u6570\u521b\u5efa\u7528\u6237","text":"<ul> <li> <p>$1\u662f\u6267\u884c\u811a\u672c\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570</p> </li> <li> <p>$2\u662f\u6267\u884c\u811a\u672c\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570</p> </li> </ul> <pre><code>#!/bin/bash  \ncheckuser(){\nid ${1} &gt; /dev/null 2&gt;&amp;1\nif [ $? -eq 0 ]\nthen\necho \"${1} \u5df2\u5b58\u5728\uff01\"\nelse\nuseradd \"$1\"   echo \"$2\"  |  passwd  \u2010\u2010stdin  \"$1\"  fi\n}\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#6\u6279\u91cf\u5220\u9664\u7528\u6237","title":"6.\u6279\u91cf\u5220\u9664\u7528\u6237","text":"<p>\u6279\u91cf\u5220\u9664user1\u2026user20</p> <pre><code>#!/bin/bash\n#\u68c0\u67e5\u7528\u6237\u662f\u5426\u5b58\u5728\uff0c\u5b58\u5728\u5219\u5220\u9664\ncheckuser(){\nfor i in $(seq 1 20)\ndo\nid user${i} &gt; /dev/null 2&gt;&amp;1\nif [ $? -eq 0 ]\nthen\nuserdel -r user${i}\nelse\necho \"user${i} \u4e0d\u5b58\u5728\uff01\"\nfi\ndone\n}\ncheckuser\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#7\u66f4\u65b0\u7cfb\u7edf\u65f6\u95f4\u5e76\u5199\u5165\u786c\u4ef6\u65f6\u95f4\u91cc","title":"7.\u66f4\u65b0\u7cfb\u7edf\u65f6\u95f4\uff0c\u5e76\u5199\u5165\u786c\u4ef6\u65f6\u95f4\u91cc","text":"<ul> <li> <p>\u67e5\u770b\u662f\u5426\u5b89\u88c5ntpdate\u5de5\u5177</p> </li> <li> <p>\u521b\u5efa\u4e0a\u6d77\u65f6\u533a\u6587\u4ef6\u7684\u8f6f\u94fe\u63a5</p> </li> <li> <p>\u66f4\u65b0\u65f6\u95f4\u5e76\u5199\u5165\u5230\u786c\u4ef6\u65f6\u95f4\u91cc</p> </li> </ul> <pre><code>#!/bin/bash\npackage=\"ntpdate\"\ninfo=$(rpm -q ${package})\ncheck_pkgs(){\nif [ ! -e ${info} ]\nthen\necho \"ntpdate already exists\uff01\"\nelse\necho \"start installation\uff01\"\nyum clean all &gt; /dev/null 2&gt;&amp;1\nfi\nyum update -y &amp;&amp; yum install -y ${package} &gt; /dev/null 2&gt;&amp;1\nfi\n}\nmodify_time(){\necho \"\u5f00\u59cb\u4fee\u6539\u65f6\u95f4\"\nrm -rf /etc/localtime &amp;&amp; ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n  /usr/sbin/ntpdate cn.pool.ntp.org &gt; /dev/null 2&gt;&amp;1 &amp;&amp; hwclock -w\n}\ncheck_pkgs\nmodify_time\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#8\u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001","title":"8.\u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001","text":"<p>\u68c0\u67e5\u67d0\u4e00\u670d\u52a1\u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff0c\u6267\u884c\u811a\u672c\u7684\u65f6\u5019\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u670d\u52a1\u540d</p> <pre><code>#!/bin/bash\nresult=$(pidof $1 | wc -l)\necho ${result}\nif [ ${result} -eq 0 ]\nthen\necho \"service does not exist \uff01\"\nelse\necho \"Service is running normally \uff01\"\nfi\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#9\u5bf9\u76ee\u6807\u4e3b\u673a\u8fdb\u884c\u5fc3\u8df3\u68c0\u6d4b","title":"9.\u5bf9\u76ee\u6807\u4e3b\u673a\u8fdb\u884c\u5fc3\u8df3\u68c0\u6d4b","text":"<p>ping\u76ee\u6807\u4e3b\u673a\u770b\u662f\u5426ping\u5f97\u901a\uff0c\u4e09\u6b21ping\u901a\u8868\u793a\u4e3b\u673a\u6b63\u5e38\u8fd0\u884c</p> <p>\u5c06\u76ee\u6807\u4e3b\u673a\u7684ip\u5730\u5740\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u8fdb\u53bb</p> <pre><code>#!/bin/bash\nipaddr=$1\necho ${ipaddr}\nping_status(){\nif ping -c 1 ${ipaddr} &gt; /dev/null 2&gt;&amp;1\nthen\necho \"ping ${ipaddr} is successful!\"\ncontinue\nfi\n}\nfor i in $(seq 1 3)\ndo\nping_status\n  echo \"ping ${ipaddr} is failure!\"\ndone\n</code></pre> <p>\u8fdb\u9636\u7248\uff1a\u5bf9ip\u5730\u5740\u6c60\u91cc\u7684\u4e3b\u673a\u5206\u522b\u8fdb\u884c\u5fc3\u8df3\u68c0\u6d4b</p> <pre><code>ipaddr=(192.168.149.131 192.168.149.130 192.168.149.132 192.168.149.133)\nfor i in ${ipaddr[*]}\ndo\necho \".... begin to ping ${i} .....\"\nif ping -c 3 ${i} &gt; /dev/null 2&gt;&amp;1\nthen\necho \"ping ${i} is successful!\"\nelse\necho \"ping ${i} is failure!\"\nfi\ndone\n</code></pre>"},{"location":"Linux/shell/19.%E5%AE%9E%E7%94%A8Linux-Shell%E8%84%9A%E6%9C%AC%E6%A1%88%E4%BE%8B/#10\u7cfb\u7edf\u78c1\u76d8\u5185\u5b58\u5bb9\u91cf\u544a\u8b66","title":"10.\u7cfb\u7edf\u78c1\u76d8\u5185\u5b58\u5bb9\u91cf\u544a\u8b66","text":"<ul> <li> <p>\u6839\u5206\u533a\u5269\u4f59\u7a7a\u95f4\u5c0f\u4e8e20%\uff08\u5373\u4f7f\u7528\u7a7a\u95f4\u5927\u4e8e80%\uff09 \u8f93\u51fa\u544a\u8b66\u4fe1\u606f</p> </li> <li> <p>\u5185\u5b58\u4f7f\u7528\u7a7a\u95f4\u5927\u4e8e80% \u8f93\u51fa\u544a\u8b66\u4fe1\u606f</p> </li> <li> <p>\u914d\u5408crond\u6bcf5\u5206\u949f\u68c0\u67e5\u4e00\u6b21</p> </li> </ul> <pre><code>#!/bin/bash\ndisk_letfspace=$(df -Th | grep -w / | awk '{print$6}' | cut -d % -f 1)\nmem_used=$(free -m | grep Mem | awk '{print$3}')\nmem_total=$(free -m | grep Mem | awk '{print$2}')\nmem_letfspace=$[${mem_used}*100/${mem_total}]\nif [ ${disk_letfspace} -gt 80 ]\nthen\necho \"Disk free space is less than 20%!\"\nelse\necho \"${disk_letfspace}% of disk space left\"\nfi\nif [ ${mem_letfspace} -gt 80 ]\nthen\necho \"memory space is less than 20%!\"\nelse\necho \"${mem_letfspace}% of memory space left\"\nfi\n</code></pre> <pre><code>crontab -l\n*/5 * * * * /root/check_space.sh\n</code></pre>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/","title":"2.Shell \u53d8\u91cf","text":""},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#1-shell-\u53d8\u91cf\u6982\u8ff0","title":"1. Shell \u53d8\u91cf\u6982\u8ff0","text":"<p>\u53d8\u91cf\u662f\u4efb\u4f55\u7a0b\u5e8f\u6216\u811a\u672c\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u53d8\u91cf\u4e3a\u7a0b\u5e8f\u6216\u811a\u672c\u8bbf\u95ee\u5185\u5b58\u4e2d\u7684\u53ef\u4fee\u6539\u7684\u4e00\u5757\u6570\u636e\u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u65b9\u5f0f\u3002</p> <p>Linux Shell \u4e2d\u7684\u53d8\u91cf\u53ef\u4ee5\u88ab\u6307\u5b9a\u4e3a\u4efb\u610f\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6bd4\u5982\u6587\u672c\u5b57\u7b26\u4e32\u6216\u8005\u6570\u503c\u3002\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 Shell \u4e2d\u7684\u53d8\u91cf\u6765\u6539\u53d8 Shell \u7684\u6837\u5f0f\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u8ba9\u6211\u4eec\u6765\u4e86\u89e3\u548c\u5b66\u4e60\u4e00\u4e0b Shell \u4e2d\u7684\u53d8\u91cf\u5427\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#11-shell-\u53d8\u91cf\u662f\u4ec0\u4e48","title":"1.1 Shell \u53d8\u91cf\u662f\u4ec0\u4e48","text":"<p>Shell \u53d8\u91cf\u662f\u4ec0\u4e48\u5462\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u53ef\u4ee5\u53d8\u5316\u7684\u91cf\uff0c\u5982\u679c\u6709\u7f16\u7a0b\u57fa\u7840\u7684\u8bfb\u8005\u77e5\u9053\u4efb\u4f55\u7a0b\u5e8f\u4e2d\u90fd\u6709\u53d8\u91cf\uff0c\u4ece\u6211\u4eec\u5c0f\u65f6\u5019\u505a\u6570\u5b66\u9898\uff0c\u5b9a\u4e49\u7684 x \u53d8\u91cf\uff0c\u6700\u7ec8\u7ed9\u5b9a\u503c\uff0c\u7528\u503c\u66ff\u6362 x \u53d8\u91cf\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u6700\u521d\u63a5\u89e6\u7684\u53d8\u91cf\uff0c\u5b83\u548c\u6211\u4eec\u5728 Shell \u4e2d\u63a5\u89e6\u7684\u53d8\u91cf\u672c\u8d28\u4e0a\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u53d8\u91cf\u5728 Shell \u4e2d\u662f\u5b58\u50a8\u8ba1\u7b97\u5668\u5185\u5b58\u7684\u5355\u5143\uff0c\u5176\u4e2d\u5b58\u653e\u7684\u503c\u53ef\u4ee5\u6539\u53d8\uff0c\u5f53\u6211\u4eec\u5728\u7f16\u5199 Shell \u811a\u672c\u4e2d\uff0c\u5982\u679c\u4e00\u4e9b\u7ecf\u5e38\u7528\u7684\u5b57\u7b26\u4e32\u6216\u6570\u5b57\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf\uff0c\u5c06\u5177\u4f53\u7684\u503c\u8d4b\u7ed9\u8fd9\u4e2a\u53d8\u91cf\uff0c\u7136\u540e\u5728\u5177\u4f53\u7684\u51fd\u6570\u6216\u811a\u672c\u4e2d\u5f15\u7528\u8fd9\u4e2a\u53d8\u91cf\uff0c\u5c31\u76f8\u5f53\u4e8e\u62ff\u5230\u4e86\u8fd9\u4e2a\u503c\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u53d8\u91cf","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u53d8\u91cf","text":"<p>\u6211\u4eec\u5927\u6982\u4e86\u89e3\u4e86 Shell \u53d8\u91cf\u662f\u4ec0\u4e48\uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u5728 Shell \u811a\u672c\u4e2d\u9700\u8981\u53d8\u91cf\u5462\uff1f</p> <p>\u4f8b\u5982\u5728\u4e00\u4e2a Shell \u811a\u672c\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u76ee\u5f55\uff0c\u811a\u672c\u5185\u591a\u5904\u8c03\u7528\u4e86\u8fd9\u4e2a\u76ee\u5f55\u540d\u79f0\uff0c\u73b0\u5728\u6211\u4eec\u6709\u4e2a\u9700\u6c42\u76ee\u5f55\u540d\u79f0\u6539\u53d8\u4e86\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u529e\u5462\uff0c\u5728\u811a\u672c\u4e2d\u6bcf\u4e2a\u4f7f\u7528\u8be5\u76ee\u5f55\u7684\u5730\u65b9\u90fd\u9700\u8981\u6539\u6210\u65b0\u7684\u76ee\u5f55\u540d\u79f0\uff0c\u6709\u6ca1\u6709\u7b80\u5355\u7684\u65b9\u6cd5\u53ea\u9700\u8981\u6539\u4e00\u5904\u5730\u65b9\u5462\uff0c\u8fd9\u65f6\u5019\u5c31\u7528\u5230\u4e86\u6211\u4eec\u7684\u53d8\u91cf\uff0c\u5728\u811a\u672c\u7684\u5168\u5c40\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf\u4f8b\u5982 <code>BASE_DIR</code>\uff0c\u7136\u540e\u5c06\u76ee\u5f55\u8d4b\u503c\u7ed9\u8fd9\u4e2a\u53d8\u91cf\uff0c\u5728\u5177\u4f53\u5f15\u7528\u7684\u65f6\u5019\u5229\u7528\u8fd9\u4e2a\u76ee\u5f55\u7684\u53d8\u91cf\u540d\u79f0\uff0c\u4e0b\u6b21\u9700\u8981\u6211\u4eec\u6539\uff0c\u53ea\u7528\u6539\u6700\u524d\u9762\u8fd9\u4e2a\u53d8\u91cf\u5373\u53ef\u3002</p> <p>\u56e0\u6b64\u6211\u4eec\u4f7f\u7528\u53d8\u91cf\u5c31\u662f\u4e3a\u65b9\u4fbf\uff0c\u540c\u65f6\u4e5f\u4f7f\u5f97\u6211\u4eec\u7684\u811a\u672c\u66f4\u5177\u7075\u6d3b\u6027\u6269\u5c55\u6027\u4e0e\u540e\u671f\u7684\u53ef\u7ef4\u62a4\u6027\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#2-shell-\u53d8\u91cf\u57fa\u672c\u64cd\u4f5c","title":"2. Shell \u53d8\u91cf\u57fa\u672c\u64cd\u4f5c","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 Shell \u4e2d\u53d8\u91cf\u662f\u4ec0\u4e48\u4ee5\u53ca\u5176\u5728 Shell \u7f16\u5199\u4e2d\u7684\u91cd\u8981\u6027\uff0c\u90a3\u4e48\u8ba9\u6211\u4eec\u5148\u6765\u5b66\u4e60 Shell \u53d8\u91cf\u7684\u57fa\u672c\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#21-\u53d8\u91cf\u7684\u5b9a\u4e49","title":"2.1 \u53d8\u91cf\u7684\u5b9a\u4e49","text":"<p>\u5728\u4f7f\u7528 Shell \u53d8\u91cf\u524d\uff0c\u9700\u8981\u5148\u5b9a\u4e49\u53d8\u91cf\uff0c\u5b9a\u4e49\u53d8\u91cf\u7684\u65b9\u5f0f\u6709\u4e09\u79cd\uff1a</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#211-\u76f4\u63a5\u8d4b\u503c","title":"2.1.1 \u76f4\u63a5\u8d4b\u503c","text":"<p>\u987e\u540d\u601d\u4e49\u5c31\u662f\u76f4\u63a5\u5c06\u4e00\u4e2a\u503c\u8d4b\u503c\u7ed9\u4e00\u4e2a\u53d8\u91cf\u540d\u79f0\uff0c\u8fd9\u79cd\u9700\u8981\u6ce8\u610f\u503c\u4e2d\u4e0d\u80fd\u5305\u542b\u7a7a\u767d\u5b57\u7b26</p> <p>\u4f8b\u5982\uff1a\u6b63\u786e\u7684\u76f4\u63a5\u8d4b\u503c\u53d8\u91cf\uff1a<code>DIR=/tmp</code>\uff0c\u5176\u4e2d <code>DIR</code> \u4e3a\u53d8\u91cf\u540d\uff0c<code>/tmp</code> \u4e3a\u503c</p> <p>\u9519\u8bef\u7684\u76f4\u63a5\u8d4b\u503c\uff1a<code>STRING=hello Shell</code>\uff0c\u5176\u4e2d <code>STRINNG</code> \u4e3a\u53d8\u91cf\u540d\uff0c<code>hello Shell</code> \u4e3a\u503c\uff0c\u5176\u4e2d\u503c\u5305\u542b\u4e86\u7a7a\u767d\u5b57\u7b26\uff0c\u8fd9\u79cd\u8d4b\u503c\u53d8\u91cf\u5c31\u662f\u9519\u8bef\u7684\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#212-\u5355\u5f15\u53f7\u8d4b\u503c","title":"2.1.2 \u5355\u5f15\u53f7\u8d4b\u503c","text":"<p>\u5982\u679c\u503c\u4e2d\u4e3a\u666e\u901a\u5b57\u7b26\uff0c\u90a3\u4e48\u5355\u5f15\u53f7\u8d4b\u503c\u4e0e\u53cc\u5f15\u53f7\u8d4b\u503c\u6ca1\u6709\u533a\u522b\uff0c\u5176\u53ef\u4ee5\u5305\u542b\u7a7a\u767d\u5b57\u7b26\uff0c\u4f46\u662f\u5982\u679c\u5176\u4e2d\u5305\u542b\u4e86\u53d8\u91cf\u7684\u4f7f\u7528\uff0c\u90a3\u4e48\u5355\u5f15\u53f7\u8d4b\u503c\u65b9\u5f0f\u4e3a\u5355\u5f15\u53f7\u91cc\u9762\u7684\u5185\u5bb9\u662f\u4ec0\u4e48\u5c31\u8f93\u51fa\u4ec0\u4e48\uff0c\u6b64\u79cd\u8d4b\u503c\u65b9\u5f0f\u9002\u7528\u4e8e\u4e0d\u5e0c\u671b\u89e3\u6790\u53d8\u91cf\u7684\u573a\u666f\uff0c\u4ec5\u663e\u793a\u7eaf\u5b57\u7b26\u4e32\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n[root@master ~]# DIR='$PATH'\n[root@master ~]# echo $DIR\n$PATH\n[root@master ~]# DATE='$(date)'\n[root@master ~]# echo $DATE\n$(date)\n</code></pre> <p><code>PATH</code> \u4e3a linux \u7cfb\u7edf\u5185\u7f6e\u7684\u4e00\u4e2a\u73af\u5883\u53d8\u91cf\uff0cDIR \u4e3a\u6211\u4eec\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u503c\u4e3a\u5355\u5f15\u53f7\u5f15\u8d77\u6765\u7684 <code>$PATH</code>\uff0c\u67e5\u770b\u5176\u5185\u5bb9\u4e5f\u4e3a <code>$PATH</code>\uff0c\u540c\u7406\u5bf9\u4e8e\u6267\u884c <code>date</code> \u547d\u4ee4\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#213-\u53cc\u5f15\u53f7\u8d4b\u503c","title":"2.1.3 \u53cc\u5f15\u53f7\u8d4b\u503c","text":"<p>\u4e0e\u5355\u5f15\u53f7\u8d4b\u503c\u4e00\u6837\uff0c\u5176\u4e5f\u53ef\u4ee5\u5305\u542b\u7a7a\u767d\u5b57\u7b26\uff0c\u4f46\u662f\u4e0e\u5355\u5f15\u53f7\u8d4b\u503c\u4e0d\u540c\u7684\u662f\uff0c\u53cc\u5f15\u53f7\u8d4b\u503c\u53ef\u4ee5\u89e3\u6790\u5f15\u53f7\u5185\u7684\u53d8\u91cf\u6216\u6267\u884c\u547d\u4ee4\uff0c\u5373\u4e0d\u662f\u5c06\u53cc\u5f15\u53f7\u4e2d\u7684\u53d8\u91cf\u540d\u548c\u547d\u4ee4\u539f\u6837\u8f93\u51fa\uff0c\u800c\u662f\u89e3\u6790\u5176\u4e2d\u53d8\u91cf\u7684\u5185\u5bb9\uff0c\u7136\u540e\u8fdb\u884c\u8f93\u51fa\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n[root@master ~]# DIR=\"$PATH\"\n[root@master ~]# echo $DIR\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n[root@master ~]# DATE=\"$(date)\" \n[root@master ~]# echo $DATE    \nSun Mar 8 22:13:57 CST 2020\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7\u4e0e\u5355\u5f15\u53f7\u793a\u4f8b\u5bf9\u7167\u67e5\u770b\uff0c\u53cc\u5f15\u53f7\u8d4b\u503c\u89e3\u6790\u4e86 <code>PATH</code> \u53d8\u91cf\u7684\u503c\u7136\u540e\u8f93\u51fa\uff0c\u540c\u7406\u5bf9\u4e8e\u6267\u884c\u547d\u4ee4 <code>date</code>\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#22-\u53d8\u91cf\u7684\u4f7f\u7528","title":"2.2 \u53d8\u91cf\u7684\u4f7f\u7528","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86\u53d8\u91cf\u7684\u5b9a\u4e49\u65b9\u5f0f\uff0c\u90a3\u4e48\u8be5\u5982\u4f55\u4f7f\u7528\u53d8\u91cf\u5462\uff1f\u4f7f\u7528\u53d8\u91cf\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u5b9a\u4e49\u7684\u53d8\u91cf\u540d\u524d\u9762\u6dfb\u52a0 <code>$</code> \u5373\u53ef\u4f7f\u7528\u5b9a\u4e49\u7684\u53d8\u91cf</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# DIR=/tmp\n[root@master ~]# echo $DIR\n/tmp\n</code></pre> <p>\u5728\u4f7f\u7528\u53d8\u91cf\u4e2d\u6709\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\uff0c\u9700\u8981\u6211\u4eec\u624b\u52a8\u6307\u5b9a\u53d8\u91cf\u7684\u8fb9\u754c\u662f\u4ec0\u4e48\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u4f7f\u7528\u5230 <code>{}</code>\u3002</p> <pre><code>[root@master ~]# STRING=\"hello Shell\"\n[root@master ~]# echo \"test $STRINGtest\"\ntest [root@master ~]# echo \"test ${STRING}test\"\ntest hello Shelltest\n</code></pre> <p>\u901a\u8fc7\u793a\u4f8b\u6211\u4eec\u80fd\u591f\u770b\u51fa\uff0c\u4e0d\u4f7f\u7528 <code>{}</code> \u5f15\u8d77\u6765\u53d8\u91cf\uff0c\u5982\u679c\u53d8\u91cf\u540d\u540e\u9762\u7ee7\u7eed\u6709\u5b57\u7b26\uff0cShell \u65e0\u6cd5\u5224\u65ad\u6211\u4eec\u7684\u53d8\u91cf\u8fb9\u754c\u5728\u54ea\u91cc\uff0c\u6211\u4eec\u63a8\u8350\u5728\u4f7f\u7528\u53d8\u91cf\u7684\u65f6\u5019\u90fd\u5e26\u4e0a <code>{}</code> \u51cf\u5c11\u51fa\u9519\u7684\u6982\u7387\uff0c\u5e76\u4e14\u65b9\u4fbf\u6211\u4eec\u4eba\u4e3a\u8bc6\u522b\u53d8\u91cf\u7684\u8fb9\u754c\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#23-\u53d8\u91cf\u7684\u66f4\u65b0","title":"2.3 \u53d8\u91cf\u7684\u66f4\u65b0","text":"<p>\u6211\u4eec\u5df2\u7ecf\u5b9a\u4e49\u4e86\u53d8\u91cf\uff0c\u5982\u679c\u5bf9\u53d8\u91cf\u8fdb\u884c\u66f4\u65b0\u4fee\u6539\u5462\uff0c\u66f4\u65b0\u4fee\u6539\u53d8\u91cf\u91cd\u65b0\u8d4b\u503c\u5373\u53ef</p> <p>\u4f8b\u5982:</p> <pre><code>[root@master ~]# DIR=/tmp\n[root@master ~]# echo $DIR\n/tmp\n[root@master ~]# DIR=/root\n[root@master ~]# echo $DIR\n/root\n</code></pre> <p>\u53e6\u5916\u5728\u53d8\u91cf\u4e2d\u5b58\u5728\u53ea\u8bfb\u53d8\u91cf\uff0c\u987e\u540d\u601d\u4e49\u5176\u4e3a\u5b9a\u4e49\u597d\u540e\uff0c\u53ea\u80fd\u53ea\u8bfb\uff0c\u4e0d\u80fd\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\uff0c\u4f7f\u7528 readonly \u547d\u4ee4\u53ef\u4ee5\u5c06\u53d8\u91cf\u5b9a\u4e49\u4e3a\u53ea\u8bfb\u53d8\u91cf</p> <pre><code>[root@master ~]# readonly STRING=\"Shell\"\n[root@master ~]# echo ${STRING}\nShell\n[root@master ~]# STRING=\"test\"\n-bash: STRING: readonly variable\n[root@master ~]# echo ${STRING}\nShell\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u4f7f\u7528 readonly \u5b9a\u4e49\u53d8\u91cf\u540e\uff0c\u5bf9\u53d8\u91cf\u8fdb\u884c\u4fee\u6539\u65f6\u5019\u62a5\u9519\uff0c\u53ea\u8bfb\u53d8\u91cf\u65e0\u6cd5\u8fdb\u884c\u4fee\u6539\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#24-\u53d8\u91cf\u7684\u5220\u9664","title":"2.4 \u53d8\u91cf\u7684\u5220\u9664","text":"<p>\u53d8\u91cf\u7684\u5220\u9664\u4f7f\u7528 unset\uff0c\u5220\u9664\u540e\u5c31\u6d88\u9664\u4e86\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u53d8\u91cf\u88ab\u5220\u9664\u540e\u4e0d\u80fd\u518d\u6b21\u4f7f\u7528\uff1bunset \u547d\u4ee4\u4e0d\u80fd\u5220\u9664\u53ea\u8bfb\u53d8\u91cf\u3002</p> <p>\u4f8b\u5982</p> <pre><code>[root@master ~]# DIR=/tmp \n[root@master ~]# echo \"dir is ${DIR}\"            \ndir is /tmp\n[root@master ~]# unset DIR\n[root@master ~]# echo \"dir is ${DIR}\" \ndir is\n</code></pre>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#3-shell-\u53d8\u91cf\u89c4\u8303","title":"3. Shell \u53d8\u91cf\u89c4\u8303","text":"<p>\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0cShell \u4e2d\u53d8\u91cf\u4e5f\u9700\u8981\u9075\u5faa\u4e00\u5b9a\u7684\u89c4\u8303\uff0c</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#31-\u547d\u540d\u89c4\u8303","title":"3.1 \u547d\u540d\u89c4\u8303","text":"<ul> <li>\u53d8\u91cf\u547d\u540d\u53ea\u80fd\u4f7f\u7528\u82f1\u6587\u5b57\u6bcd\uff0c\u6570\u5b57\u548c\u4e0b\u5212\u7ebf\uff0c\u9996\u5b57\u6bcd\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934</li> <li>\u4f8b\u5982<ul> <li>\u6b63\u5e38\u53d8\u91cf\uff1a<code>BASE_DIR</code>,<code>File_Name</code>,<code>AEG3</code>,<code>_DIR</code> \u7b49\u90fd\u662f\u6b63\u5e38\u7684\u53d8\u91cf</li> <li>\u65e0\u6548\u53d8\u91cf\uff1a<code>1file</code>,<code>#dir</code></li> </ul> </li> <li>\u53d8\u91cf\u540d\u4e2d\u95f4\u4e0d\u80fd\u4f7f\u7528\u7a7a\u683c\u6216\u6807\u70b9\u7b26\u53f7</li> <li>\u4f8b\u5982\uff1a<code>DIR FILE</code>\uff0c<code>DIR?FILE</code> \u5c31\u4e3a\u65e0\u6548\u53d8\u91cf\uff0c</li> <li>\u53d8\u91cf\u547d\u540d\u4e0d\u80fd\u4f7f\u7528 base \u91cc\u9762\u7684\u5173\u952e\u5b57\uff08help \u6765\u67e5\u770b\u5173\u952e\u5b57\uff09</li> <li>Shell \u53d8\u91cf\u5927\u5c0f\u5199\u654f\u611f\uff0c\u4e5f\u5c31\u662f\u5b9a\u4e49\u4e3a\u5927\u5199\u7684\u53d8\u91cf\u540d\uff0c\u5f15\u7528\u7684\u65f6\u5019\u5fc5\u987b\u5b8c\u5168\u4e00\u81f4\u3002</li> <li>\u4f8b\u5982:<code>DIRNAME</code> \u548c <code>dirname</code> \u5c31\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u53d8\u91cf</li> </ul>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#32-\u8d4b\u503c\u89c4\u8303","title":"3.2 \u8d4b\u503c\u89c4\u8303","text":"<ul> <li> <p>\u53d8\u91cf\u4e0e\u503c\u76f4\u63a5\u4f7f\u7528 \"=\" \u8fde\u63a5\uff0c\u7b49\u53f7\u4e24\u8fb9\u4e0d\u80fd\u5b58\u5728\u7a7a\u767d\u5b57\u7b26</p> </li> <li> <p>\u4f8b\u5982\uff1a <code>dirname = \"/tmp\"</code> \u6539\u8d4b\u503c\u65b9\u6cd5\u5c31\u662f\u9519\u8bef\u7684</p> </li> <li> <p>\u5982\u679c\u503c\u4e2d\u6709\u7a7a\u767d\u5b57\u7b26\uff0c\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\uff0c\u53cc\u5f15\u53f7\u5bf9\u4e8e\u5176\u4e2d\u5f15\u7528\u7684\u503c\u5c06\u4f1a\u6839\u636e\u5176\u5185\u5bb9\u8f6c\u5316\uff0c\u5355\u5f15\u53f7\u5185\u7684\u7279\u6b8a\u5b57\u7b26\u5219\u4e00\u5f8b\u5f53\u5b57\u7b26\u4e32\u8fdb\u884c\u5904\u7406\u3002</p> </li> <li> <p>\u4f8b\u5982\uff1a<code>DIRNAME=\"$PATH\"</code> \u7684\u503c\u4e3a\u7cfb\u7edf PATH \u5b9e\u9645\u7684\u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84\uff0c<code>DIRNAME='$PATH'</code> \u7684\u503c\u4e3a $PATH \u7684\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p>\u53ef\u7528 <code>\\</code> \u6765\u8f6c\u8bd1\u53d8\u91cf\uff0c\u8ba9\u5176\u53d8\u4e3a\u4e00\u822c\u5b57\u7b26\u3002</p> </li> <li> <p>\u4f8b\u5982\uff1a<code>DIRNAME=\\$PATH</code> \u7684\u503c\u4e3a $PATH \u7684\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p>\u5982\u679c\u53d8\u91cf\u7684\u503c\u4e3a\u6307\u4ee4\uff0c\u53ef\u7528\u4f7f\u7528\u53cd\u6487\u53f7\uff0c\u6216 $() \u6765\u65f6\u5f15\u7528\u3002</p> </li> <li> <p>\u4f8b\u5982\uff1a\u4e0b\u9762\u4e24\u4e2a\u662f\u4e00\u6837\u7684</p> </li> <li> <p><code>bash   DATE=`date`   DATE=$(date)</code></p> </li> <li> <p>\u5728\u811a\u672c\u4e2d\u5b9a\u4e49\u666e\u901a\u5b57\u7b26\u4e32\u53d8\u91cf\u65f6\uff0c\u5e94\u5c3d\u91cf\u628a\u53d8\u91cf\u7684\u5185\u5bb9\u7528\u53cc\u5f15\u53f7\u62ec\u8d77\u6765\uff1b</p> </li> <li> <p>\u4f8b\u5982\uff1a<code>DIRNAME=\"/tmp\"</code></p> </li> <li> <p>\u5355\u7eaf\u6570\u5b57\u7684\u53d8\u91cf\u5185\u5bb9\u53ef\u4ee5\u4e0d\u52a0\u5f15\u53f7\uff1b</p> </li> <li> <p>\u4f8b\u5982\uff1a<code>NUM=10</code></p> </li> </ul>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#4-\u53d8\u91cf\u7684\u5206\u7c7b","title":"4. \u53d8\u91cf\u7684\u5206\u7c7b","text":"<p>Shell \u7684\u53d8\u91cf\u6709\u4e09\u79cd\u5206\u7c7b\uff0c\u6bcf\u79cd\u90fd\u6709\u5176\u4e0d\u540c\u7684\u4f5c\u7528\u8303\u56f4</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#41-\u5c40\u90e8\u53d8\u91cf","title":"4.1 \u5c40\u90e8\u53d8\u91cf","text":"<p>\u5c40\u90e8\u53d8\u91cf\uff0c\u6545\u540d\u601d\u4e49\u5176\u53ea\u5728 Shell \u811a\u672c\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u6216\u5728 Shell \u811a\u672c\u51fd\u6570\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u53ea\u80fd\u5728 Shell \u811a\u672c\u4e2d\u4f7f\u7528\uff0c\u6216\u53ea\u80fd\u5728 Shell \u811a\u672c\u51fd\u6570\u4e2d\u4f7f\u7528</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell]# cat local_var.sh \n#!/bin/bash\nDIR=/tmp\necho \"dir is ${DIR}\"\n[root@master Shell]# bash local_var.sh \ndir is /tmp\n[root@master Shell]# echo \"dir is ${DIR}\"\ndir is </code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u5728\u811a\u672c\u5185\u90e8\u5b9a\u4e49\u7684\u53d8\u91cf <code>DIR</code> \u53ea\u5728 <code>local_var</code> \u811a\u672c\u5185\u53ef\u4ee5\u4f7f\u7528\uff0c\u5728\u5168\u5c40\u4e0b\u6ca1\u6709\u6b64\u53d8\u91cf\uff0c\u540e\u671f\u6211\u4eec\u5b66\u5230\u51fd\u6570\u518d\u6765\u8bf4\u660e\u51fd\u6570\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#42-\u73af\u5883\u53d8\u91cf","title":"4.2 \u73af\u5883\u53d8\u91cf","text":"<p>\u73af\u5883\u53d8\u91cf\u4e3a\u5f53\u524d Shell \u4e2d\u5b9a\u4e49\u7684\u4e34\u65f6\u53d8\u91cf\uff0c\u5728\u5f53\u524d Shell \u5b9a\u4e49\u7684\u53d8\u91cf\u53ef\u4ee5\u4f20\u9012\u7ed9\u5b50 Shell\uff0c\u6ca1\u6709\u7236\u5b50\u5173\u7cfb\u7684 Shell \u4e0d\u80fd\u4f7f\u7528\u6b64\u53d8\u91cf\uff0c\u5f53\u7136\u53ef\u4ee5\u5229\u7528 <code>export</code> \u5c06\u5f53\u524d Shell \u7684\u53d8\u91cf\u4f20\u9012\u7ed9\u5176\u4ed6\u7ec8\u7aef\u7684 Shell \u4e2d\u3002</p> <p>\u5f53\u524d Shell \u4e3a\u7236 Shell\uff0c\u5728\u5176\u4e0a\u8fd0\u884c <code>bash</code> \u5c31\u53ef\u4ee5\u8fdb\u5165\u5230\u5b50 Shell \u4e2d\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u793a\u4f8b</p> <pre><code># \u5728\u5f53\u524dShell\u4e2d\u5b9a\u4e49\u53d8\u91cfSTR\n[root@master Shell]# STR=\"Shell\"                        \n[root@master Shell]# echo \"hello ${STR}\"\nhello Shell\n# \u8fd0\u884c\u547d\u4ee4bash\u8fdb\u5165\u5b50Shell\n[root@master Shell]# bash\n# \u5728\u5b50Shell\u4e2d\u67e5\u770b\u6ca1\u6709\u53d8STR\n[root@master Shell]# echo \"hello ${STR}\"\nhello # \u9000\u51fa\u5b50Shell\u4f1a\u5230\u7236Shell\n[root@master Shell]# exit\nexit\n# \u5229\u7528export\u5bfc\u5165\u73af\u5883\u53d8\u91cf\n[root@master Shell]# export STR=\"Shell\"\n# \u5728\u6b64\u8fdb\u5165\u5b50Shell\n[root@master Shell]# bash\n# \u67e5\u770b\u5b50Shell\u4e2d\u5df2\u7ecf\u6709\u4e86\u53d8\u91cfSTR\n[root@master Shell]# echo \"hello ${STR}\"\nhello Shell\n</code></pre> <p>\u73af\u5883\u53d8\u91cf\u4e3a\u4e34\u65f6\u7684\uff0c\u5728\u6211\u4eec\u542f\u52a8\u7ec8\u7aef\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u4ece\u7279\u5b9a\u7684\u6587\u4ef6\u4e2d\u52a0\u8f7d\u4e00\u7cfb\u5217\u73af\u5883\u53d8\u91cf\u3002</p> <p>\u7cfb\u7edf\u4e2d\u8fd8\u6709\u4e00\u4e9b\u7cfb\u7edf\u5185\u7f6e\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 <code>PATH</code>\uff0c<code>USER</code> \u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u547d\u4ee4 env \u6216 export \u6765\u67e5\u770b\u5f53\u524d Shell \u7684\u73af\u5883\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell]# env\nXDG_SESSION_ID=1276\nHOSTNAME=master\nSELINUX_ROLE_REQUESTED=\nShell=/bin/bash\nTERM=xterm\nHISTSIZE=1000\nSSH_CLIENT=61.150.11.174 55929 22\nSELINUX_USE_CURRENT_RANGE=\nSSH_TTY=/dev/pts/0\nUSER=root\n...\n\n# \u67e5\u770b\u5f53\u524dShell\n[root@master Shell]# echo $Shell\n/bin/bash\n# \u67e5\u770b\u53ef\u6267\u884c\u547d\u4ee4\u7684\u8def\u5f84\n[root@master Shell]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n# \u67e5\u770b\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7528\u6237\n[root@master Shell]# echo $USER\nroot\n</code></pre> <p>linux \u7cfb\u7edf\u7684\u4e00\u4e9b\u5185\u7f6e\u53c2\u6570</p> <pre><code>$Shell      \u9ed8\u8ba4 Shel\n$HOME       \u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55\n$IFS        \u5185\u90e8\u5b57\u6bb5\u5206\u9694\u7b26\n$LANG       \u9ed8\u8ba4\u8bed\n$PATH       \u9ed8\u8ba4\u53ef\u6267\u884c\u7a0b\u5e8f\u8def\u5f84\n$PWD        \u5f53\u524d\u76ee\u5f55\n$UID        \u5f53\u524d\u7528\u6237 ID\n$USER       \u5f53\u524d\u7528\u6237\n$HISTSIZE   \u5386\u53f2\u547d\u4ee4\u5927\u5c0f\uff0c\u53ef\u901a\u8fc7 HISTTIMEFORMAT \u53d8\u91cf\u8bbe\u7f6e\u547d\u4ee4\u6267\u884c\u65f6\u95f4\n$RANDOM     \u968f\u673a\u751f\u6210\u4e00\u4e2a 0 \u81f3 32767 \u7684\u6574\u6570\n$HOSTNAME   \u4e3b\u673a\u540d\n</code></pre>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#43-\u5168\u5c40\u53d8\u91cf","title":"4.3 \u5168\u5c40\u53d8\u91cf","text":"<p>\u5168\u5c40\u53d8\u91cf\u4e3a\u5728\u5f53\u524d Shell \u8fdb\u7a0b\u4e2d\u8fd0\u884c\u7684\u811a\u672c\u90fd\u53ef\u4ee5\u4f7f\u7528\u8be5\u53d8\u91cf\uff0c\u5728 Shell \u4e2d\u9ed8\u8ba4\u5b9a\u4e49\u7684\u53d8\u91cf\u5c31\u662f\u5168\u5c40\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell]# cat global_var1.sh \n#!/bin/bash\necho \"${STR1}\"              # \u67e5\u770bSTR1\u53d8\u91cf\u7684\u5185\u5bb9\nSTR2=\"sh\"                           # \u5b9a\u4e49STR2\u53d8\u91cf\u7684\u503c\u4e3ash\n[root@master Shell]# cat global_var2.sh \n#!/bin/bash\necho \"${STR2}\"              # \u67e5\u770bSTR2\u53d8\u91cf\u7684\u5185\u5bb9\n[root@master Shell]# STR1=\"Shell\"                    \n[root@master Shell]# . ./global_var1.sh \nShell\n[root@master Shell]# . ./global_var2.sh \nsh\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u5229\u7528<code>.</code> \u6765\u8fd0\u884c Shell \u811a\u672c\uff0c\u662f\u5728\u5f53\u524d\u7528\u6237\u767b\u5f55\u7684 Shell \u7ec8\u7aef\u4e2d\u8fd0\u884c\uff0c\u5176\u53d8\u91cf\u662f\u5728\u5f53\u524d Shell \u8fdb\u7a0b\u4e2d\u53ef\u4ee5\u5171\u4eab\u7684\u3002</p>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#5-\u5b9e\u4f8b","title":"5. \u5b9e\u4f8b","text":"<p>\u6211\u4eec\u901a\u8fc7\u7b80\u5355\u7f16\u5199\u4e00\u4e2a\u83b7\u53d6\u5f53\u524d\u7528\u6237\u767b\u5f55\u4fe1\u606f\u7684\u811a\u672c\uff0c\u6765\u5c55\u793a\u76ee\u524d\u767b\u5f55\u7528\u6237\u7684\u4fe1\u606f</p> <pre><code>[root@master Shell_var]# cat login_info.sh  \n#!/bin/bash\n# Description: login info scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: show user info\n# Date: 2020-03-08 13:36\n# Version: 1.0\necho \"\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7528\u4e3a:  ${USER}\"\necho \"\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u65f6\u95f4:  $(date +\"%Y-%m-%d %H:%M:%S\")\"\necho \"\u5f53\u524d\u767b\u5f55\u7cfb\u7edfShell: ${Shell}\"\necho \"\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55\u4e3a:  ${HOME}\"\n# \u8fd0\u884c\u811a\u672c\u67e5\u770b\u5185\u5bb9\n[root@master Shell_var]# bash login_info.sh \n\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7528\u4e3a:  root\n\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u65f6\u95f4:  2020-03-08 12:16:04\n\u5f53\u524d\u767b\u5f55\u7cfb\u7edfShell: /bin/bash\n\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55\u4e3a:  /root\n</code></pre>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#6-\u6ce8\u610f\u4e8b\u9879","title":"6. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5728\u5f15\u7528\u53d8\u91cf\u662f\u6211\u4eec\u9075\u5b88\u89c4\u8303\uff0c\u5e26\u4e0a <code>{}</code>\uff0c\u53ef\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u9ebb\u70e6\u548c\u5751\uff1b</li> <li>\u547d\u540d\u53d8\u91cf\u89c1\u540d\u77e5\u610f\uff0c\u5f62\u6210\u6709\u81ea\u5df1\u4e00\u5957\u7684\u547d\u540d\u89c4\u8303\uff1b</li> <li>\u5b66\u4e60 Shell \u9700\u8981\u591a\u52a8\u624b\u5b9e\u8df5\uff0c\u5c06\u53d8\u91cf\u7684\u4e09\u79cd\u7c7b\u578b\u901a\u8fc7\u5b9e\u8df5\u771f\u6b63\u7406\u89e3\uff0c\u540e\u671f\u5728\u7f16\u5199 Shell \u7684\u65f6\u5019\u53ef\u4ee5\u7075\u6d3b\u8fd0\u7528\u3002</li> </ul>"},{"location":"Linux/shell/2.Shell%E5%8F%98%E9%87%8F/#7-\u5c0f\u7ed3","title":"7. \u5c0f\u7ed3","text":"<p>\u53d8\u91cf\u5728\u6211\u4eec Shell \u7f16\u7a0b\u4e2d\u7684\u6709\u8fd9\u72ec\u7279\u7684\u5730\u4f4d\uff0c\u5176\u5c06\u6211\u4eec\u7684\u4e00\u4e9b\u6570\u636e\u901a\u8fc7\u4e00\u6b21\u6027\u7684\u8d4b\u503c\uff0c\u5927\u5927\u589e\u5f3a\u4e86\u811a\u672c\u7684\u7075\u6d3b\u6027\u4e0e\u540e\u671f\u53ef\u7ef4\u62a4\u6027\u3002\u6211\u4eec\u9700\u8981\u901a\u8fc7\u672c\u7ae0\u8282\u5145\u5206\u7406\u89e3 Shell \u7684\u57fa\u672c\u64cd\u4f5c\u53ca\u5176\u79cd\u7c7b\uff0c\u5728\u7f16\u5199 Shell \u4e2d\u7075\u6d3b\u8fd0\u7528\uff0c\u9075\u5faa\u5b9a\u4e49\u53ca\u4f7f\u7528\u89c4\u8303\uff0c\u53ef\u4ee5\u4f7f\u5f97\u6211\u4eec\u7f16\u5199\u7684 Shell \u66f4\u52a0\u53cb\u597d\u53ca\u5065\u58ee\u3002</p>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/","title":"20.Shell\u811a\u672c\u7684\u89c4\u8303","text":""},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u8bed\u6cd5\u68c0\u67e5","title":"\u8bed\u6cd5\u68c0\u67e5","text":"<p>\u5229\u7528\u5de5\u5177\u5bf9\u811a\u672c\u8fdb\u884c\u68c0\u67e5\uff0c\u80fd\u6700\u5927\u7a0b\u5ea6\u5730\u53d1\u73b0shell\u811a\u672c\u4e2d\u5b58\u5728\u7684\u8bed\u6cd5\u9519\u8bef\u3002</p> <p>1.\u4f7f\u7528ShellCheck: ShellCheck\u662f\u4e00\u6b3e\u514d\u8d39\u7684\u3001\u5f00\u6e90\u7684Shell\u811a\u672c\u8bed\u6cd5\u68c0\u67e5\u5de5\u5177\u3002</p> <p>\u7ebf\u68c0\u67e5\u7f51\u7ad9</p> <p>\u8be5\u9879\u76ee\u7684github\u5730\u5740</p> <p>2.\u4f7f\u7528Vim\u63d2\u4ef6Syntastic:Syntastic\u662f\u4e00\u6b3eVim\u63d2\u4ef6\uff0c\u5b83\u53ef\u4ee5\u5728\u7f16\u8f91Shell\u811a\u672c\u7684\u65f6\u5019\uff0c\u667a\u80fd\u8bc6\u522bShell\u811a\u672c\u7684\u8bed\u6cd5\u9519\u8bef\uff0c\u5e76\u5728\u7f16\u8f91\u5668\u4e2d\u7ed9\u51fa\u63d0\u793a\u3002</p>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u811a\u672c\u5931\u8d25\u65f6\u5373\u9000\u51fa","title":"\u811a\u672c\u5931\u8d25\u65f6\u5373\u9000\u51fa","text":"<p>\u53ef\u4ee5\u5728\u811a\u672c\u7684\u5f00\u5934\u8bbe\u7f6e\u5982\u4e0b\uff1a</p> <pre><code>set -e\n</code></pre> <p>\u8fd9\u4e5f\u6709\u4e0d\u597d\u7684\u5730\u65b9\uff0c\u6709\u65f6\u5019\u547d\u4ee4\u6267\u884c\u672c\u6765\u5c31\u53ef\u80fd\u662f\u5931\u8d25\u7684\uff0c\u8fd8\u662f\u5e0c\u671b\u5b83\u7ee7\u7eed\uff0c\u53ef\u4ee5\u4e34\u65f6\u52a0\u4e0a|| true\uff1a <pre><code>#\uff01/bin/bash\nset -e\nlp  || true  date\n</code></pre></p> <p>\u5f88\u591a\u65f6\u5019\u5c31\u662f\u9700\u8981\u5904\u7406\u4e0d\u540c\u7684\u9519\u8bef\u60c5\u51b5\uff0c\u800c\u8fd9\u6837\u53ea\u80fd\u8981\u4e48\u9047\u5230\u9519\u8bef\u9000\u51fa\uff0c\u8981\u4e48\u8ba4\u4e3a\u6b63\u786e\uff0c\u5bfc\u81f4\u65e0\u6cd5\u8d70\u5230\u5f02\u5e38\u5206\u652f\u3002 \u901a\u8fc7set +e\u8bbe\u7f6e\u56de\u6765\uff1a</p> <pre><code>set -e\n#command\nset +e\n#other command\n</code></pre>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528set--e\u547d\u4ee4\u7ec8\u6b62\u6267\u884c","title":"\u4f7f\u7528set -e\u547d\u4ee4\u7ec8\u6b62\u6267\u884c","text":"<p>set -e\u547d\u4ee4\u53ef\u4ee5\u5728\u547d\u4ee4\u51fa\u9519\u65f6\u7ec8\u6b62\u811a\u672c\u7684\u6267\u884c\u3002\u4f8b\u5982\uff1a</p> <p><pre><code>#!/bin/bash\nset -e\necho \"Start\"\nls /not/exists\necho \"End\"\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u4e3a\uff1a <pre><code>Start\nls: cannot access '/not/exists': No such file or directory\n</code></pre></p>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528set--u\u663e\u793a\u672a\u5b9a\u4e49\u7684\u53d8\u91cf","title":"\u4f7f\u7528set -u\u663e\u793a\u672a\u5b9a\u4e49\u7684\u53d8\u91cf","text":"<p>shell\u4e2d\u53d8\u91cf\u6ca1\u6709\u5b9a\u4e49\uff0c\u4ecd\u7136\u662f\u53ef\u4ee5\u4f7f\u7528\u7684\uff0c\u4f46\u662f\u5b83\u7684\u7ed3\u679c\u53ef\u80fd\u4e0d\u662f\u6240\u9884\u671f\u7684\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>if [ \"$var\" = \"abc\" ]\nthen\necho  \" not abc\"\nelse\necho \" abc \"\nfi\n</code></pre> <p>\u8fd9\u91cc\u672c\u6765\u60f3\u5224\u65advar\u7684\u5185\u5bb9\u662f\u5426\u4e3aabc\uff0c\u5b9e\u9645\u4e0avar\u5e76\u6ca1\u6709\u5b9a\u4e49\uff0c\u4f46\u662f\u5728\u8fd9\u91cc\u4f7f\u7528\u5e76\u6ca1\u6709\u62a5\u9519\uff0c\u5982\u679c\u60f3\u65e9\u70b9\u53d1\u73b0\u8fd9\u7c7b\u95ee\u9898\uff0c\u907f\u514d\u5728\u590d\u6742\u7684\u811a\u672c\u4e2d\u95ee\u9898\u88ab\u63a9\u76d6\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728\u5f00\u5934\u52a0\u4e0a\uff1a</p> <pre><code>set -u\n</code></pre> <p>\u518d\u60f3\u8c61\u4e00\u4e0b\uff0c\u672c\u6765\u60f3\u5220\u9664\uff1a</p> <p><pre><code>rm -rf $dir/*\n</code></pre> \u7136\u540edir\u662f\u7a7a\u7684\u65f6\u5019\uff0c\u53d8\u6210\u4e86\u4ec0\u4e48\uff1f\u662f\u4e0d\u662f\u6709\u79cd\u540e\u80cc\u53d1\u51c9\u7684\u611f\u89c9\uff1f</p>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528set--x\u547d\u4ee4\u5f00\u542f\u8c03\u8bd5\u6a21\u5f0f","title":"\u4f7f\u7528set -x\u547d\u4ee4\u5f00\u542f\u8c03\u8bd5\u6a21\u5f0f","text":"<p>set\u547d\u4ee4\u53ef\u4ee5\u5f00\u542f\u8c03\u8bd5\u6a21\u5f0f\uff0c\u8f93\u51fa\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u6bcf\u4e2a\u547d\u4ee4\u3002\u4f8b\u5982\uff1a</p> <p><pre><code>#!/bin/bash -x\nname=\"John\"\necho \"My name is $name\"\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>+ name=John\n+ echo 'My name is John'\nMy name is John\n</code></pre> <p><pre><code>sh -x test.sh\n</code></pre> \u8c03\u8bd5\u9636\u6bb5\uff0c\u60f3\u77e5\u9053\u6574\u4e2a\u8fc7\u7a0b\u662f\u6267\u884c\u4e86\u54ea\u4e9b\u547d\u4ee4\uff0c\u6bcf\u6761\u547d\u4ee4\u90fd\u5177\u4f53\u6267\u884c\u4e86\u4ec0\u4e48\uff0c\u53ef\u4ee5\u5229\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u6267\u884c\uff1a</p> <p>\u6216\u8005\uff0c\u548c\u4e0a\u9762\u7c7b\u4f3c\uff0c\u5728\u5f00\u5934\u52a0\u4e0aset -x\uff1a</p> <pre><code>#\uff01/bin/bash\nset -x\nif [ $# -lt 1 ]\nthen\necho  \"no para\"\nelse\necho \"para 1 $1\"\nfi\n</code></pre> <p>\u6267\u884c\u65f6\uff0c\u8f93\u51fa\u5982\u4e0b\uff1a</p> <pre><code>+ [ 0 -le 1 ]\n+ echo no para\nno para\n</code></pre> <p>\u524d\u9762\u5e26+\u7684\u5185\u5bb9\u5c31\u662f\u547d\u4ee4\u5b9e\u9645\u6267\u884c\u7684\uff0c\u53ef\u4ee5\u770b\u5230\u6bd4\u8f83\u6761\u4ef6\u662f\u4ec0\u4e48\uff0c\u53d8\u91cf\u88ab\u5c55\u5f00\u6210\u4e86\u5177\u4f53\u5185\u5bb9\uff0c\u8d70\u5230\u4e86\u54ea\u4e2a\u5206\u652f\uff0c\u975e\u5e38\u6e05\u695a\u3002</p>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528set--o-pipefail\u547d\u4ee4\u68c0\u67e5\u7ba1\u9053\u547d\u4ee4\u4e00\u4e2a\u5931\u8d25\u65f6\u6574\u4e2a\u5931\u8d25","title":"\u4f7f\u7528set -o pipefail\u547d\u4ee4\u68c0\u67e5\u7ba1\u9053\u547d\u4ee4\u4e00\u4e2a\u5931\u8d25\u65f6\u6574\u4e2a\u5931\u8d25","text":"<p>\u6709\u65f6\u5019\u53ef\u80fd\u4f1a\u6267\u884c\u7c7b\u4f3c\u8fd9\u6837\u7684\u547d\u4ee4\uff1a</p> <pre><code>cat test.sh |grep if | cut -d ';' -f 2\n</code></pre> <p>\u4e09\u6761\u547d\u4ee4\u4e00\u884c\u6267\u884c\uff0c\u5982\u679c\u5e0c\u671b\u5728\u5176\u4e2d\u4e00\u6761\u5931\u8d25\uff0c\u6574\u4e2a\u547d\u4ee4\u5c31\u5931\u8d25\uff0c\u800c\u907f\u514d\u6267\u884c\u540e\u9762\u65e0\u610f\u4e49\u7684\u547d\u4ee4\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728\u5f00\u59cb\u8bbe\u7f6e\uff1a</p> <p><pre><code>set -o pipefail\n</code></pre> \u4e0d\u8bbe\u7f6e\u7684\u60c5\u51b5\u4e0b\uff0ccat test.sh\u5373\u4f7f\u6267\u884c\u5931\u8d25\u4e86\uff0c\u540e\u9762\u7684grep\u5b9e\u9645\u4e0a\u8fd8\u4f1a\u7ee7\u7eed\u6267\u884c\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u610f\u60f3\u4e0d\u5230\u7684\u60c5\u51b5\u53d1\u751f\uff0c\u5982\u679c\u4e0d\u60f3\u8fd9\u6837\u7684\u60c5\u51b5\u53d1\u751f\uff0c\u90a3\u4e48\u8fd9\u6837\u8bbe\u7f6e\u662f\u6709\u5e2e\u52a9\u7684\u3002</p> <p>Bash \u9009\u9879</p> <pre><code># - \u8868\u793a\u6253\u5f00\uff0c + \u8868\u793a\u5173\u95ed\nset -u            # \u5982\u679c\u9047\u5230\u4e0d\u5b58\u5728\u7684\u53d8\u91cf\uff0cBash \u9ed8\u8ba4\u5ffd\u7565\u5b83\nset -x            # \u7528\u6765\u5728\u8fd0\u884c\u7ed3\u679c\u4e4b\u524d\uff0c\u5148\u8f93\u51fa\u6267\u884c\u7684\u90a3\u4e00\u884c\u547d\u4ee4\u3002\nset -e            # \u53ea\u8981\u53d1\u751f\u9519\u8bef\uff0c\u5c31\u7ec8\u6b62\u6267\u884c\u3002\nset -n            # \u7b49\u540c\u4e8eset -o noexec\uff0c\u4e0d\u8fd0\u884c\u547d\u4ee4\uff0c\u53ea\u68c0\u67e5\u8bed\u6cd5\u662f\u5426\u6b63\u786e\u3002\nset -f            # \u7b49\u540c\u4e8eset -o noglob\uff0c\u8868\u793a\u4e0d\u5bf9\u901a\u914d\u7b26\u8fdb\u884c\u6587\u4ef6\u540d\u6269\u5c55\u3002\nset -v            # \u7b49\u540c\u4e8eset -o verbose\uff0c\u8868\u793a\u6253\u5370 Shell \u63a5\u6536\u5230\u7684\u6bcf\u4e00\u884c\u8f93\u5165\u3002\nset -o noclobber  # \u907f\u514d\u53e0\u52a0\u6587\u4ef6 (echo \"hi\" &gt; foo)\nset -o errexit    # \u7528\u4e8e\u5728\u51fa\u9519\u65f6\u9000\u51fa\uff0c\u907f\u514d\u7ea7\u8054\u9519\u8bef\nset -o pipefail   # \u7528\u4e8e\u5728\u51fa\u9519\u65f6\u9000\u51fa\uff0c\u907f\u514d\u7ba1\u9053\u4e4b\u95f4\u7684\u8fde\u7eed\u9519\u8bef\nset -o nounset    # \u66b4\u9732\u672a\u8bbe\u7f6e\u7684\u53d8\u91cf\n</code></pre>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u5bf9\u4e8e\u9759\u6001\u53d8\u91cf\u4f7f\u7528readonly","title":"\u5bf9\u4e8e\u9759\u6001\u53d8\u91cf\u4f7f\u7528readonly","text":"<p>\u901a\u5e38\u4f1a\u5728\u811a\u672c\u5f00\u5934\u5b9a\u4e49\u4e00\u4e9b\u9759\u6001\u53d8\u91cf\uff1a</p> <pre><code>MY_PATH=/usr/bin\n</code></pre> <p>\u800c\u4e3a\u4e86\u907f\u514dMY_PATH\u88ab\u610f\u5916\u4fee\u6539\uff0c\u53ef\u4ee5\u8fd9\u6837\uff1a <pre><code>readonly MY_PATH=/usr/bin\n</code></pre></p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u4e00\u65e6\u540e\u9762\u6709\u547d\u4ee4\u5c1d\u8bd5\u4fee\u6539\uff0c\u5c31\u4f1a\u62a5\u9519\u3002</p> <pre><code>#!/bin/bash\nreadonly MY_PATH=/usr/bin\nMY_PATH=/usr/local/bin\n</code></pre> <p>\u8fd0\u884c\u4e00\u4e0b\u8bd5\u8bd5\uff1a</p> <pre><code>$ ./test.sh\ntest.sh: 3: test.sh: MY_PATH: is read only\n</code></pre>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528export\u547d\u4ee4\u8f93\u51fa\u73af\u5883\u53d8\u91cf\u503c","title":"\u4f7f\u7528export\u547d\u4ee4\u8f93\u51fa\u73af\u5883\u53d8\u91cf\u503c","text":"<p>export\u547d\u4ee4\u53ef\u4ee5\u8f93\u51fa\u73af\u5883\u53d8\u91cf\u7684\u503c\uff0c\u65b9\u4fbf\u8c03\u8bd5\u3002\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\nexport name=\"John\"\necho \"My name is $name\"\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u4e3a\uff1a <pre><code>My name is John\n</code></pre></p>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u7ed9\u53d8\u91cf\u8bbe\u7f6e\u53ef\u9009\u7684\u521d\u59cb\u503c","title":"\u7ed9\u53d8\u91cf\u8bbe\u7f6e\u53ef\u9009\u7684\u521d\u59cb\u503c","text":"<p>\u4f8b\u5982\uff1a</p> <pre><code>name=${1:-Fcant}\necho \"${name}\"\n</code></pre> <p>\u8fd9\u91cc\u8ba9name\u4e3a$1\uff0c\u5373\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u800c\u5f53\u5b83\u4e3a\u7a7a\u65f6\uff0c\u4ee4name\u4e3aFcant\u3002</p>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u591a\u6761\u547d\u4ee4\u6267\u884c\u4f7f\u7528","title":"\u591a\u6761\u547d\u4ee4\u6267\u884c\u4f7f\u7528&amp;&amp;","text":"<p>\u4f8b\u5982\uff1a</p> <pre><code>cmd0;cmd1;cmd1\n</code></pre> <p>\u8fd9\u91cc\u5982\u679ccmd0\u5931\u8d25\u4e86\uff0c\u540e\u9762\u7684\u547d\u4ee4\u4ecd\u7136\u4f1a\u6267\u884c\uff0c\u800c\u5982\u679c\u4e0d\u5e0c\u671b\u540e\u9762\u7684\u547d\u4ee4\u6267\u884c\uff0c\u53ef\u4ee5\u4f7f\u7528\uff1a</p> <pre><code>cmd0 &amp;&amp; cmd1 &amp;&amp; cmd1\n</code></pre>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528\u51fd\u6570","title":"\u4f7f\u7528\u51fd\u6570","text":"<p>\u811a\u672c\u672c\u8eab\u6bd4\u8f83\u77ed\u8fd8\u597d\uff0c\u800c\u811a\u672c\u4e00\u65e6\u53d8\u957f\uff0c\u4e0d\u4f7f\u7528\u51fd\u6570\uff0c\u5c06\u4f7f\u5f97\u811a\u672c\u5f88\u96be\u7ef4\u62a4\uff0c\u53ef\u8bfb\u6027\u4e5f\u5f88\u5dee\u3002</p>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#bash\u811a\u672c\u4e2d\u9010\u884c\u8bfb\u53d6\u6587\u4ef6","title":"Bash\u811a\u672c\u4e2d\u9010\u884c\u8bfb\u53d6\u6587\u4ef6","text":""},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528\u8f93\u5165\u91cd\u5b9a\u5411\u5668","title":"\u4f7f\u7528\u8f93\u5165\u91cd\u5b9a\u5411\u5668","text":"<pre><code>$ more example1.sh\n#!/bin/bash\nwhile read y\ndo\necho \"Line contents are : $y \"\ndone &lt; mycontent.txt\n</code></pre>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528cat\u547d\u4ee4","title":"\u4f7f\u7528cat\u547d\u4ee4","text":"<pre><code>$ more example2.sh\n#!/bin/bash\ncat mycontent.txt | while read y\n\ndo\necho \"Line contents are : $y \"\ndone\n</code></pre>"},{"location":"Linux/shell/20.Shell%E8%84%9A%E6%9C%AC%E7%9A%84%E8%A7%84%E8%8C%83/#\u4f7f\u7528\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7684\u6587\u4ef6\u540d","title":"\u4f7f\u7528\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7684\u6587\u4ef6\u540d","text":"<pre><code>$ more example3.sh\n#!/bin/bash\nwhile read y\ndo\necho \"Line contents are : $y \"\ndone &lt; $1\n</code></pre> <pre><code>#!/bin/sh\n# @Author: huxiaojian\n# @Date:   2018-09-28 15:38:08\n# @Last Modified by:   huxiaojian\n# @Last Modified time: 2018-09-28 15:43:04\n# \u8bfb\u53d6\u6587\u4ef6\u65b9\u6cd51\ncount=1\ncat test | while  read line ; do\necho \"Line $count: $line\"\ncount=$[ $count + 1 ]\ndone\necho \"Finished processing the file\"\n# \u8bfb\u53d6\u6587\u4ef6\u65b9\u6cd52\n#!/bin/bash\nwhile read LINE do\nNAME=`echo $LINE | awk '{print $1}'`\nAGE=`echo $LINE | awk '{print $2}'`\nSex=`echo $LINE | awk '{print $3}'`\necho \"My name is $NAME, I'm $AGE years old, I'm a $Sex\"\ndone &lt; student_info.txt\n\n# \u4e3e\u4f8b\n#!/bin/sh\nfile=$1\nif [ $# -lt ]; then\necho \"Usage: $0 FILEPATH\"\nexit\nfi\nwhile read -r f1 f2 f3\ndo\necho \"Field 1: $f1 ===&gt; Field2:$f2===&gt;Field3:$f3\"\ndone &lt;\"$file\"\n## \u8bfb\u53d6\u6587\u4ef63\uff0c\u4f7f\u7528for\u5faa\u73af\u7684\u65b9\u5f0f\n$ cat example.sh\n#!/bin/bash\nfor i in `cat users.txt`\ndo\n#echo \"$i\"\nid $i &amp;&gt;/dev/null\n  if [ \"$?\" -eq 0 ];then\necho \"$i already exists....\"\nelse\necho \"add $i .... &amp;&amp; create $i....\"\nfi\ndone\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/","title":"21.DevOps\u4e0b\u7684Shell\u811a\u672c","text":""},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u5907\u4efd\u7c7b\u811a\u672c","title":"\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u5907\u4efd\u7c7b\u811a\u672c","text":""},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u7248\u672c\u63a7\u5236\u8f6f\u4ef6svn\u7684\u4ee3\u7801\u5e93\u7684\u5907\u4efd\u811a\u672c","title":"\u7248\u672c\u63a7\u5236\u8f6f\u4ef6SVN\u7684\u4ee3\u7801\u5e93\u7684\u5907\u4efd\u811a\u672c","text":"<pre><code>#!/bin/sh\nSVNDIR=/data/svn\nSVNADMIN=/usr/bin/svnadmin\nDATE=`date +%Y-%m-%d`\nOLDDATE=`date +%Y-%m-%d -d '30 days'`\nBACKDIR=/data/backup/svn-backup\n\n[ -d ${BACKDIR} ] || mkdir -p ${BACKDIR}\nLogFile=${BACKDIR}/svnbak.log\n[ -f ${LogFile} ] || touch ${LogFile}\nmkdir ${BACKDIR}/${DATE}\nfor PROJECT in myproject official analysis mypharma\ndo\ncd $SVNDIR\n$SVNADMIN hotcopy $PROJECT  $BACKDIR/$DATE/$PROJECT --clean-logs\n  cd $BACKDIR/$DATE\ntar zcvf ${PROJECT}_svn_${DATE}.tar.gz $PROJECT  &gt; /dev/null\n  rm -rf $PROJECT\nsleep 2\ndone\nHOST=192.168.2.112\nFTP_USERNAME=svn\nFTP_PASSWORD=svn101\n\ncd ${BACKDIR}/${DATE}\nftp -i -n -v &lt;&lt; !\nopen ${HOST}\nuser ${FTP_USERNAME} ${FTP_PASSWORD}\nbin\ncd ${OLDDATE}\nmdelete *\ncd ..\nrmdir ${OLDDATE}\nmkdir ${DATE}\ncd ${DATE}\nmput *\nbye\n!\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u5907\u4efd\u6587\u4ef6shell\u811a\u672c","title":"\u5907\u4efd\u6587\u4ef6shell\u811a\u672c","text":"<p>Auto_Backup_Linux_System_Files.sh</p> <pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\nSOURCE_DIR=(\n$*\n)\nTARGET_DIR=/data/backup/\nYEAR=`date +%Y`\nMONTH=`date +%m`\nDAY=`date +%d`\nWEEK=`date +%u`\nFILES=system_backup.tgz\nCODE=$?\nif [ -z \"$*\" ]; then\necho -e \"\\033[32mUsage:\\nPlease Ebter Your Backup Files or Directories\\n--------------------------------------------\\n\n    \\nUsage:{ $0 /boot/etc}\\033[0m\"\nexit\nfi\n# Deternube Wgether the Target Directory Exists\nif [ ! -d $TARGET_DIR ]; then\nmkdir -p $TARGET_DIR/$YEAR/$MONTH/$DAY\necho -e \"\\033[32mThe $TARGET_DIR Create Successfully ! \\033[0m\"\nfi\n#EXEC Full_Backup Function Command\n#EXEC Full_Backup Function Command\nFull_Backup()\n{\nif\n[ \"$WEEK\" -eq \"7\" ];then\nrm -rf $TARGET_DIR/snapshot\n    cd $TARGET_DIR/$YEAR/$MONTH/$DAY ;tar -g $TARGET_DIR/snapshot -czvf $FILES `echo ${SOURCE_DIR[@]}`\n[ \"$CODE\" == \"0\" ]&amp;&amp;echo -e  \"--------------------------------------------\\nFull_Backup System Files Backup Successfully !\"\nfi\n}\n#Perform incremental BACKUP Function Command\nAdd_Backup()\n{\ncd $TARGET_DIR/$YEAR/$MONTH/$DAY ;\nif\n[ -f $TARGET_DIR/$YEAR/$MONTH/$DAY/$FILES ];then\nread -p \"$FILES Already Exists, overwrite confirmation yes or no ? : \" SURE\n    if [ $SURE == \"no\" -o $SURE == \"n\" ];then\nsleep 1;exit 0\nfi\n#Add_Backup Files System\nif\n[ $WEEK -ne \"7\" ];then\ncd $TARGET_DIR/$YEAR/$MONTH/$DAY;tar -g $TARGET_DIR/snapshot -czvf $$_$FILES `echo ${SOURCE_DIR[@]}`\n[ \"$CODE\" == \"0\" ]&amp;&amp;echo -e  \"-----------------------------------------\\n\\033[32mAdd_Backup System Files Backup Successfully !\\033[0m\"\nfi\nelse\nif\n[ $WEEK -ne \"7\" ];then\ncd $TARGET_DIR/$YEAR/$MONTH/$DAY ;tar -g $TARGET_DIR/snapshot -czvf $FILES `echo ${SOURCE_DIR[@]}`\n[ \"$CODE\" == \"0\" ]&amp;&amp;echo -e  \"-------------------------------------------\\n\\033[32mAdd_Backup System Files Backup Successfully !\\033[0m\"\nfi\nfi\n}\nFull_Backup\nAdd_Backup\n\n# crontab\u8ba1\u5212\u4efb\u52a1\u4e2d\u52a0\u5165\u5982\u4e0b\u8bed\u53e5\uff0c\u6bcf\u5929\u51cc\u66681\u70b9\u6574\u6267\u884c\u5907\u4efd\u811a\u672c\u3002\n# 0 1 *  *  * /bin/sh /data/sh/Auto_Backup_Linux_System_Files.sh /boot /etc/ &gt;&gt; /tmp/back.log 2&gt;&amp;1\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#mysql\u6570\u636e\u5e93\u5907\u4efd\u81f3s3\u6587\u4ef6\u7cfb\u7edf","title":"Mysql\u6570\u636e\u5e93\u5907\u4efd\u81f3S3\u6587\u4ef6\u7cfb\u7edf","text":"<pre><code>#!/bin/bash\n#\n# Filename:\n# backupdatabase.sh\n# Description:\n# backup cms database and remove backup data before 7 days\n# crontab\n# 55 23 * * * /bin/sh /yundisk/cms/crontab/backupdatabase.sh &gt;&gt; /yundisk/cms/crontab/backupdatabase.log 2&gt;&amp;1\nDATE=`date +%Y-%m-%d`\nOLDDATE=`date +%Y-%m-%d -d '-7 days'`\n#MYSQL=/usr/local/mysql/bin/mysql\n#MYSQLDUMP=/usr/local/mysql/bin/mysqldump\n#MYSQLADMIN=/usr/local/mysql/bin/mysqladmin\nBACKDIR=/yundisk/cms/database\n[ -d ${BACKDIR} ] || mkdir -p ${BACKDIR}\n[ -d ${BACKDIR}/${DATE} ] || mkdir ${BACKDIR}/${DATE}\n[ ! -d ${BACKDIR}/${OLDDATE} ] || rm -rf ${BACKDIR}/${OLDDATE}\nmysqldump --default-character-set=utf8 --no-autocommit --quick --hex-blob --single-transaction -uroot  cms_production  | gzip &gt; ${BACKDIR}/${DATE}/cms-backup-${DATE}.sql.gz\necho \"Database cms_production and bbs has been backup successful\"\n/bin/sleep 5\naws s3 cp ${BACKDIR}/${DATE}/* s3://example-share/cms/databackup/\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#mysql\u5b9a\u65f6\u5907\u4efd\u811a\u672c","title":"mysql\u5b9a\u65f6\u5907\u4efd\u811a\u672c","text":"<pre><code>#!/bin/bash\n# \u521d\u59cb\u5316\u65f6\uff0c\u521b\u5efa\u76f8\u5e94\u76ee\u5f55\n# mkdir /home/node/bakmysql/sql/\n# \u5b9a\u65f6\u4efb\u52a1\n# \u6bcf\u5929\u51cc\u66681:00\u6267\u884c\u5907\u4efd\u811a\u672c\n#0 1 * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1\n#2\u5206\u949f\u8fd0\u884c\u4e00\u6b21-\u6d4b\u8bd5\u7528\n#*/2 * * * * /bin/bash -x /home/node/bakmysql/backup.sh &gt;/dev/null 2&gt;&amp;1\nBakDir=/home/node/bakmysql/sql\nLogFile=/home/node/bakmysql/sql/bak.log\nDate=`date +%Y%m%d`\nBegin=`date +\"%Y\u5e74%m\u6708%d\u65e5 %H:%M:%S\"`\ncd $BakDir\nDumpFile=$Date.sql\n\n# \u5bfc\u51fa\u5230\u672c\u5730\nmysqldump -uroot -p123456 test --quick --single-transaction | gzip &gt; $DumpFile.gz\nLast=`date +\"%Y\u5e74%m\u6708%d\u65e5 %H:%M:%S\"`\necho [FullBack] \u5f00\u59cb:$Begin \u7ed3\u675f:$Last $DumpFile.gz successful &gt;&gt; $LogFile\n# \u5220\u96647\u5929\u524d\u7684\u5907\u4efd\u6587\u4ef6\nfind $BakDir -mtime +7 -type f -name \"*.sql.gz\" | xargs rm -f\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#mysql\u6570\u636e\u5e93\u5206\u5e93\u5907\u4efd","title":"MySQL\u6570\u636e\u5e93\u5206\u5e93\u5907\u4efd","text":"<pre><code>#!/bin/bash\n# author: xiongminghao\n# mail: jasonminghao@163.com\n# describe\uff1aMysql database backup\n# \u5b9a\u4e49\u53d8\u91cf\nIP=$(ifconfig eth1 |awk 'NR==2{print $2}')\nPath=/backup/database  # \u5907\u4efd\u76ee\u5f55\u8def\u5f84\nTime=$(date +%F)\nBa_Path=$Path/$Time\nBa_Logs=/var/log/db_database_$Time # \u5b9a\u4e49\u4e00\u4e2a\u5b58\u653e\u65e5\u5fd7\u7684\u6587\u4ef6\nMd5_Path=$Path/$Time/md5 # \u5b9a\u4e49\u4e00\u4e2a\u5b58\u653emd5\u6821\u9a8c\u7684\u76ee\u5f55\n# \u521b\u5efa\u4e24\u4e2a\u76ee\u5f55\u4ee5\u5f53\u5929\u65f6\u95f4\u4e3a\u547d\u540d\n[ ! -d $Ba_Path ] &amp;&amp; mkdir $Ba_Path\n[ ! -d $Md5_Path ] &amp;&amp; mkdir $Md5_Path\n# \u5faa\u73af\u83b7\u53d6\u6570\u636e\u5e93\u540d\u8fdb\u884c\u5907\u4efd\u548c\u751f\u6210MD5\u6821\u9a8c\u6587\u4ef6\nfor dbname in `mysql  -e 'show databases' |sed '1d' |grep -v \"_schema\"`\ndo\n# \u5224\u65ad\u662f\u5426\u6709\u6570\u636e\u5e93\u5df2\u7ecf\u5907\u4efd\u4e86,\u5982\u679c\u5907\u4efd\u4e86\u5219continue \u8c03\u51fa\u5f53\u6b21\u5faa\u73af\uff0c\u5426\u5219\u8fdb\u884c\u5907\u4efd\nif [ ! -f $Ba_Path/${dbname}.sql.gz ];then\n# \u5907\u4efd\u53c2\u6570\n# -B \u589e\u52a0use[name]\u8bed\u53e5, -R \u5907\u4efd\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u6570\u636e\n# --master=data2 \u8bb0\u5f55\u5907\u4efd\u65f6\u523b\u7684binlog\u4f4d\u7f6e\u70b9\uff0c2\u8868\u793a\u5c06\u5176\u4f4d\u7f6e\u70b9\u6ce8\u91ca\n# --single-ransaction \u5bf9innodb\u5f15\u64ce\u8fdb\u884c\u70ed\u5907\uff08\u5bf9\u6570\u636e\u8fdb\u884c\u5feb\u7167\uff09\n# gzip \u5bf9\u5907\u4efd\u7684\u6570\u636e\u8fdb\u884cgzip\u538b\u7f29\nmysqldump  -B -R --master-data=2 --single-transaction  |gzip &gt;$Ba_Path/${dbname}.sql.gz\n   RETVAL=$?\n# \u901a\u8fc7\u8fd4\u56de\u503c\u5224\u65ad\u5907\u4efd\u662f\u5426\u6267\u884c\u6210\u529f,\u628a\u6267\u884c\u7684\u6210\u529f\u4e0e\u5426\u7eaa\u5f55\u5230\u65e5\u5fd7\u4e2d\n[ $? -eq 0 ] &amp;&amp; echo \"${dbname} successful\" &gt;&gt;$Ba_Logs || echo \"${dbname} failed\" &gt;&gt;$Ba_Logs\n# \u5bf9\u6570\u636e\u5e93\u7684\u6570\u636e\u5b8c\u6574\u6027\u505aMD5\u6821\u9a8c\nmd5sum $Ba_Path/${dbname}.sql.gz  &gt;$Md5_Path/${dbname}_md5.log\n\nelse\n# \u5982\u679c\u5907\u4efd\u5df2\u5b58\u5728\u5219\u8df3\u51fa\u5f53\u6b21\u5faa\u73af,\u8fdb\u884c\u4e0b\u6b21\u5faa\u73af\ncontinue\nfi\ndone\n# \u5c06\u5907\u4efd\u65e5\u5fd7\u7ed3\u679c\u90ae\u4ef6\u65b9\u5f0f\u53d1\u9001\u7ed9\u7ba1\u7406\u5458\nmail -s \"$HOSTNAME $IP\" jasonminghao@163.com &lt; $Ba_Logs\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#mysql\u6570\u636e\u5e93\u5206\u5e93\u5206\u8868\u5907\u4efd","title":"MySQL\u6570\u636e\u5e93\u5206\u5e93\u5206\u8868\u5907\u4efd","text":"<pre><code>#!/bin/bash\n# author: xiongminghao\n# mail: jasonminghao@163.com\n# describe\uff1aMysql database table backup\n# \u5b9a\u4e49\u53d8\u91cf\nIP=$(ifconfig eth1 |awk 'NR==2{print $2}')\nPath=/backup/table # \u5907\u4efd\u76ee\u5f55\nTime=$(date +%F)\nBa_Path=$Path/$Time\nBa_Logs=/var/log/db_table_$Time  # \u5b9a\u4e49\u4e00\u4e2a\u5b58\u653e\u65e5\u5fd7\u7684\u6587\u4ef6\nMd5_Path=$Path/$Time/md5 # \u5b9a\u4e49\u4e00\u4e2a\u5b58\u653emd5\u6821\u9a8c\u7684\u76ee\u5f55\n# \u521b\u5efa\u4e24\u4e2a\u76ee\u5f55\u4ee5\u5f53\u5929\u65f6\u95f4\u4e3a\u547d\u540d\n[ ! -d $Ba_Path ] &amp;&amp; mkdir $Ba_Path\n[ ! -d $Md5_Path ] &amp;&amp; mkdir $Md5_Path\n# \u5faa\u73af\u83b7\u53d6\u6570\u636e\u5e93\u540d\nfor dbname in `mysql  -e 'show databases' |sed '1d' |grep -v \"_schema\"`\ndo\n# \u5faa\u73af\u83b7\u53d6\u5230\u6570\u636e\u5e93\u540d\u540e\u518d\u6b21\u5faa\u73af\u83b7\u53d6\u5230\u8be5\u5e93\u540d\u4e0b\u7684\u8868\uff0c\u8fdb\u884c\u5907\u4efd\u548cMD5\u6821\u9a8c\nfor tablename in `mysql -e \"show tables from $dbname\" |sed '1d'`\ndo\n# \u5224\u65ad\u662f\u5426\u6709\u8868\u5df2\u7ecf\u5907\u4efd\u4e86,\u5982\u679c\u5907\u4efd\u4e86\u5219continue \u8c03\u51fa\u5f53\u6b21\u5faa\u73af\uff0c\u5426\u5219\u8fdb\u884c\u5907\u4efd\nif [ ! -f $Ba_Path/${dbname}_${tablename}.sql.gz ];then\nmysqldump -R --master-data=2 --single-transaction  ${dbname} ${tablename} |gzip &gt;$Ba_Path/${dbname}_${tablename}.sql.gz\n   RETVAL=$?\n# \u901a\u8fc7\u8fd4\u56de\u503c\u5224\u65ad\u5907\u4efd\u662f\u5426\u6267\u884c\u6210\u529f,\u628a\u6267\u884c\u7684\u6210\u529f\u4e0e\u5426\u7eaa\u5f55\u5230\u65e5\u5fd7\u4e2d\n[ $? -eq 0 ] &amp;&amp; echo \"${dbname}_${tablename} successful\" &gt;&gt;$Ba_Logs || echo \"${dbname}_${tablename} failed\" &gt;&gt;$Ba_Logs\n# \u5bf9\u8868\u7684\u6570\u636e\u5b8c\u6574\u6027\u505aMD5\u6821\u9a8c\nmd5sum $Ba_Path/${dbname}_${tablename}.sql.gz  &gt;$Md5_Path/${dbname}_${tablename}_md5.log\n\nelse\ncontinue\nfi\ndone\ndone\n# \u5c06\u5907\u4efd\u65e5\u5fd7\u7ed3\u679c\u90ae\u4ef6\u65b9\u5f0f\u53d1\u9001\u7ed9\u7ba1\u7406\u5458\nmail -s \"$HOSTNAME $IP\" jasonminghao@163.com &lt; $Ba_Logs\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u7edf\u8ba1\u7c7b\u811a\u672c","title":"\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u7edf\u8ba1\u7c7b\u811a\u672c","text":""},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u7edf\u8ba1\u8bbe\u5907\u8d44\u4ea7\u660e\u7ec6\u811a\u672c","title":"\u7edf\u8ba1\u8bbe\u5907\u8d44\u4ea7\u660e\u7ec6\u811a\u672c","text":"<pre><code>#!/bin/bash\n#####get cpu info#####\ncpu_num=`cat /proc/cpuinfo| grep \"physical id\"| sort| uniq| wc -l`\ncpu_sum=`cat /proc/cpuinfo |grep processor |wc -l`\ncpu_hz=`cat /proc/cpuinfo |grep 'model name' |uniq -c |awk '{print $NF}'`\n#####get mem info#####\nmem_m=0\nfor i in `dmidecode -t memory |grep Size: |grep -v \"No Module Installed\" |awk '{print $2}'`\ndo\nmem_m=`expr $mem_m + $i`\ndone\nmem_sum=`echo $mem_m / 1024 | bc`\n#####get nic info#####\nqian_num=`lspci |grep Ethernet |egrep -v '10-Gigabit|10 Gigabit' |wc -l`\nwan_num=`lspci |grep Ethernet |egrep  '10-Gigabit|10 Gigabit' |wc -l`\n#####get disk num#####\nB=`date +%s`\nssd_num=0=\nsata_num=0\nfor i in `lsblk |grep \"disk\"|awk '{print $1}'|egrep -v \"ram\"|sort`;\ndo\ncode=`cat /sys/block/$i/queue/rotational`\nif [ \"$code\" = \"0\" ];then\nssd_num=`expr $ssd_num + 1` &amp;&amp; echo $i &gt;&gt;/tmp/$B.ssd\n    else\nsata_num=`expr $sata_num + 1` &amp;&amp; echo $i &gt;&gt;/tmp/$B.sata\n    fi\ndone\n#####get disk sum#####\nC=`date +%N`\nssd_sum=0\nsata_sum=0\nif [ -f /tmp/$B.ssd ];then\nfor n in `cat /tmp/$B.ssd`;do\nfdisk -l /dev/$n &gt;&gt;/tmp/$C.ssd 2&gt;&amp;1\nfor x in `grep \"Disk /dev\" /tmp/$C.ssd |awk '{print $3}'`;do\nu=`echo $x / 1|bc`\ndone\nssd_sum=`expr $ssd_sum + $u + 1`\ndone\nfi\nfor m in `cat /tmp/$B.sata`;do\nfdisk -l /dev/$m &gt;&gt;/tmp/$C.sata 2&gt;&amp;1\nfor y in `grep \"Disk /dev\" /tmp/$C.sata |awk '{print $3}'`;do\nv=`echo $y / 1|bc`\ndone\nsata_sum=`expr $sata_sum + $v + 1`\ndone\n#####show dev info#####\necho -n \"$ip `hostname` $plat $pop $prov \"\necho -n \"CPU(\u7269\u7406\u6838\u6570,\u903b\u8f91\u6838\u6570,\u9891\u7387): $cpu_num $cpu_sum $cpu_hz \"\necho -n \"\u5185\u5b58(GB): $mem_sum \"\necho -n \"\u7f51\u5361\u6570\u91cf(\u5343\u5146,\u4e07\u5146): $qian_num $wan_num \"\necho \"SSD\u6570\u91cf: ${ssd_num} SSD\u5bb9\u91cf: ${ssd_sum}GB SATA\u6570\u91cf: ${sata_num} SATA\u5bb9\u91cf ${sata_sum}GB \"\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u7edf\u8ba1\u91cd\u8981\u4e1a\u52a1\u7a0b\u5e8f\u662f\u5426\u6b63\u5e38\u8fd0\u884c","title":"\u7edf\u8ba1\u91cd\u8981\u4e1a\u52a1\u7a0b\u5e8f\u662f\u5426\u6b63\u5e38\u8fd0\u884c","text":"<pre><code>#!/bin/bash\nsync_redis_status=`ps aux | grep sync_redis.py | grep -v grep | wc -l `\nif [ ${sync_redis_status} != 1 ]; then\necho \"Critical! sync_redis is Died\"\nexit 2\nelse\necho \"OK! sync_redis is Alive\"\nexit 0\nfi\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u7edf\u8ba1\u673a\u5668\u7684ip\u8fde\u63a5\u6570","title":"\u7edf\u8ba1\u673a\u5668\u7684IP\u8fde\u63a5\u6570","text":"<pre><code>#!/bin/bash\n#\u811a\u672c\u7684$1\u548c$2\u62a5\u8b66\u9600\u503c\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u7684\u5b9e\u9645\u60c5\u51b5\u8c03\u6574\u3002\n#$1 = 15000\uff0c$2 = 20000\nip_conns=`netstat -an | grep tcp | grep EST | wc -l`\nmessages=`netstat -ant | awk '/^tcp/ S[$NF]} END {for(a in S) print a, S[a]}'|tr -s '\\n' ',' | sed -r 's/(.*),/\\1\\n/g' `\nif [ $ip_conns -lt $1 ]\nthen\necho \"$messages,OK -connect counts is $ip_conns\"\nexit 0\nfi\nif [ $ip_conns -gt $1 -a $ip_conns -lt $2 ]\nthen\necho \"$messages,Warning -connect counts is $ip_conns\"\nexit 1\nfi\nif [ $ip_conns -gt $2 ]\nthen\necho \"$messages,Critical -connect counts is $ip_conns\"\nexit 2\nfi"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u4fee\u6539ip_\u4e3b\u673a\u540d_\u7f51\u5361\u4fe1\u606f\u811a\u672c","title":"\u4fee\u6539IP_\u4e3b\u673a\u540d_\u7f51\u5361\u4fe1\u606f\u811a\u672c","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\n#\u9759\u6001IP\u4fee\u6539\n#\u52a8\u6001IP\u4fee\u6539\n#\u6839\u636eIP\u751f\u4ea7\u4e3b\u673a\u540d\u5e76\u914d\u7f6e\n#\u4fee\u6539DNS\u57df\u540d\u89e3\u6790\nETHCONF=/etc/sysconfig/network-scripts/ifcfg-ens32\nHOSTS=/etc/hosts\nNETWORK=/etc/sysconfig/network\nDIR=/data/backup/`date +%Y%m%d`\nNETMASK=255.255.255.0\necho \"------------------------------------------------------------------\"\njudeg_ip(){\nread -p \"Please enter ip Address,example 192.168.0.11 ip\":IPADDR\n    echo $IPADDR|grep -v \"[Az-Zz]\"|grep --color -E \"([0-9]{1,3}\\.){3}[0-9]{1,3}\"\n}\ncount_ip(){\ncount=(`echo ${IPADDR}|awk -F. '{print $1,$2,$3,$4}'`)\nIP1=${count[0]}\nIP2=${count[1]}\nIP3=${count[2]}\nIP4=${count[3]}\n}\nip_check(){\njudeg_ip\n\nwhile [ \"$?\" -ne 0 ]; do\njudeg_ip\ndone\ncount_ip\nwhile [ \"$IP1\" -lt 0 -o \"$IP1\" -ge 255 -o \"$IP2\" -ge 255 -o \"$IP3\" -ge 255 -o \"$IP4\" -ge 255 ]; do\njudeg_ip\n    while [ \"$?\" -ne 0 ]; do\njudeg_ip\n    done\ncount_ip\ndone\n}\nchange_ip(){\nif [ ! -d $DIR ]; then\nmkdir -p $DIR\nfi\necho \"The Change ip address to Backup Interface eth0\"\ncp $ETHCONF $DIR\ngrep \"dhcp\" $ETHCONF\nif [ \"$?\" -eq 0 ]; then\nread -p \"Please enter ip Address:\" IPADDR\n    sed -i 's/dhcp/static/g' $ETHCONF\necho -e \"IPADDR=$IPADDR\\nNERMASK=$NETMASK\\nGATEWAY=`echo $IPADDR|awk -F. '{print $1\".\"$2\".\"$3}'`.2\" &gt;&gt; $ETHCONF\necho \"The IP configuration success. !\"\nelse\necho -n \"Static IP has been configured,please confirm whether to modify,yes or No\";\nread i\nfi\nif [ \"$i\" == \"y\" -o \"$i\" == \"yes\" ]; then\nip_check\n    sed -i -e '/IPADDR/d' -e '/NETMASK/d' -e '/GATEWAY/d' $ETHCONF\necho -e \"IPADDR=$IPADDR\\nNETMASK=$NETMASK\\nGATEWAY=`echo  $IPADDR|awk -F. '{print $1\".\"$2\".\"$3}'`.2\" &gt;&gt; $ETHCONF\necho \"The IP configuration success. !\"\necho\nelse\necho \"Static IP already exists,please exit.\"\necho $?\nfi\n}\nchange_hosts(){\nif [ ! -d $DIR ]; then\nmkdir -p $DIR\nfi\ncp $HOSTS $DIR\nip_check\n    host=`echo $IPADDR|sed 's/\\./-/g'|awk '{print \"BJ-IDC-\" $0 \"-Hujianli.net\"}'`\ncat $HOSTS|grep \"$host\"\nif [ \"$?\" -ne 0 ]; then\necho \"$IPADDR    $host\" &gt;&gt; $HOSTS\necho \"The hosts modify success\"\nfi\ngrep \"$host\" $NETWORK\nif [ \"$?\" -ne 0 ]; then\nsed -i 's/^HOSTNAME/#HOSTNAME/g' $NETWORK\necho \"NETWORK=$host\" &gt;&gt; $NETWORK\nhostname $host;su\n    fi\n}\nPS3=\"Please Select configuration ip or configuration host:\"\nselect i in \"modify_ip\" \"modify_hosts\" \"exit\"\ndo\ncase \"$i\" in\nmodify_ip)\nchange_ip\n       ;;\nmodify_hosts)\nchange_hosts\n       ;;\nexit)\nexit\n;;\n*)\necho -e \"1)modify_ip\\n2)modify_host\\n3)exit\"\nesac\ndone\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u76d1\u63a7\u7c7b\u811a\u672c","title":"\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u76d1\u63a7\u7c7b\u811a\u672c","text":""},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u76d1\u63a7nginx\u8fdb\u7a0b\u7684\u811a\u672c","title":"\u76d1\u63a7Nginx\u8fdb\u7a0b\u7684\u811a\u672c","text":"<pre><code>#!/bin/bash\nwhile :\ndo\nnginxpid=`ps -C nginx --no-header | wc -l`\nif [ $nginxpid -eq 0 ];then\nulimit -SHn 65535\n/usr/local/nginx/sbin/nginx\n    sleep 5\nif [ $nginxpid -eq 0 ];then\n/etc/init.d/keepalived stop\n   fi\nfi\nsleep 5\ndone\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u76d1\u63a7httpd\u670d\u52a1\u72b6\u6001\u811a\u672c","title":"\u76d1\u63a7httpd\u670d\u52a1\u72b6\u6001\u811a\u672c","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\n# author\uff1axiaojian\nLogTime=$(date +%Y%m%d-%T)\nLog_File=\"/home/check_httpd.log\"\nwhile true; do\nHTTPD_STATUS=`service httpd status | grep running`\nif test -z \"$HTTPD_STATUS\"; then\necho \"$LogTime  HTTPD is stopped, try to restart\" &gt;&gt; $Log_File\nservice httpd restart\n    else\necho \"HTTPD is running ,wait 2 sec until next check\" &amp;&gt;/dev/null\n        sleep 2\nfi\ndone\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u76d1\u63a7mysql\u6570\u636e\u5e93\u793a\u4f8b","title":"\u76d1\u63a7mysql\u6570\u636e\u5e93\u793a\u4f8b","text":"<pre><code>#!/usr/bin/env bash\n#\u65b9\u6cd51\nif [ `lsof -i tcp:3306|wc -l` -gt 0 ] #&lt;==\u8fc7\u6ee4\u7aef\u53e3\u8f6c\u6210\u6570\u5b57\uff0c\u5f88\u4f18\u79c0\u7684\u53d6\u503c\u5224\u65ad\u65b9\u6cd5\u3002\nthen\necho \"MySQL is Running.\"\nelse\necho \"MySQL is Stopped.\"\n/etc/init.d/mysqld start\nfi\n#\u65b9\u6cd52\nif [ `ps aux| grep -v grep | grep mysql |wc - l`  -gt 0]; then\necho  \"Mysql is Running\"\nelse\necho \"Mysql is Stopped. \"\n/etc/init.d/mysqld start\nfi\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u7cfb\u7edf\u6587\u4ef6\u6570\u6253\u5f00\u76d1\u63a7\u811a\u672c","title":"\u7cfb\u7edf\u6587\u4ef6\u6570\u6253\u5f00\u76d1\u63a7\u811a\u672c","text":"<pre><code>#!/bin/bash\nfor pid in `ps aux |grep nginx |grep -v grep|awk '{print $2}'`\ndo\ncat /proc/${pid}/limits | grep 'Max open files'\ndone\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u76d1\u63a7\u673a\u5668cpu\u5229\u7528\u7387\u811a\u672c","title":"\u76d1\u63a7\u673a\u5668CPU\u5229\u7528\u7387\u811a\u672c","text":"<pre><code>#!/bin/bash\n# CPU Utilization Statistics plugin for Nagios\n#\n# USAGE     :   ./check_cpu_utili.sh [-w &lt;user,system,iowait&gt;] [-c &lt;user,system,iowait&gt;] ( [ -i &lt;intervals in second&gt; ] [ -n &lt;report number&gt; ])\n#\n# Exemple: ./check_cpu_utili.sh\n#          ./check_cpu_utili.sh -w 70,40,30 -c 90,60,40\n#          ./check_cpu_utili.sh -w 70,40,30 -c 90,60,40 -i 3 -n 5\n# Paths to commands used in this script.  These may have to be modified to match your system setup.\nIOSTAT=\"/usr/bin/iostat\"\n# Nagios return codes\nSTATE_OK=0\nSTATE_WARNING=1\nSTATE_CRITICAL=2\nSTATE_UNKNOWN=3\n# Plugin parameters value if not define\nLIST_WARNING_THRESHOLD=\"70,40,30\"\nLIST_CRITICAL_THRESHOLD=\"90,60,40\"\nINTERVAL_SEC=1\nNUM_REPORT=1\n# Plugin variable description\nPROGNAME=$(basename $0)\nif [ ! -x $IOSTAT ]; then\necho \"UNKNOWN: iostat not found or is not executable by the nagios user.\"\nexit $STATE_UNKNOWN\nfi\nprint_usage() {\necho \"\"\necho \"$PROGNAME $RELEASE - CPU Utilization check script for Nagios\"\necho \"\"\necho \"Usage: check_cpu_utili.sh -w -c (-i -n)\"\necho \"\"\necho \"  -w  Warning threshold in % for warn_user,warn_system,warn_iowait CPU (default : 70,40,30)\"\necho \"  Exit with WARNING status if cpu exceeds warn_n\"\necho \"  -c  Critical threshold in % for crit_user,crit_system,crit_iowait CPU (default : 90,60,40)\"\necho \"  Exit with CRITICAL status if cpu exceeds crit_n\"\necho \"  -i  Interval in seconds for iostat (default : 1)\"\necho \"  -n  Number report for iostat (default : 3)\"\necho \"  -h  Show this page\"\necho \"\"\necho \"Usage: $PROGNAME\"\necho \"Usage: $PROGNAME --help\"\necho \"\"\nexit 0\n}\nprint_help() {\nprint_usage\n        echo \"\"\necho \"This plugin will check cpu utilization (user,system,CPU_Iowait in %)\"\necho \"\"\nexit 0\n}\n# Parse parameters\nwhile [ $# -gt 0 ]; do\ncase \"$1\" in\n-h | --help)\nprint_help\n            exit $STATE_OK\n;;\n-v | --version)\nprint_release\n                exit $STATE_OK\n;;\n-w | --warning)\nshift\nLIST_WARNING_THRESHOLD=$1\n;;\n-c | --critical)\nshift\nLIST_CRITICAL_THRESHOLD=$1\n;;\n-i | --interval)\nshift\nINTERVAL_SEC=$1\n;;\n-n | --number)\nshift\nNUM_REPORT=$1\n;;\n*)  echo \"Unknown argument: $1\"\nprint_usage\n            exit $STATE_UNKNOWN\n;;\nesac\nshift\ndone\n# List to Table for warning threshold (compatibility with\nTAB_WARNING_THRESHOLD=(`echo $LIST_WARNING_THRESHOLD | sed 's/,/ /g'`)\nif [ \"${#TAB_WARNING_THRESHOLD[@]}\" -ne \"3\" ]; then\necho \"ERROR : Bad count parameter in Warning Threshold\"\nexit $STATE_WARNING\nelse\nUSER_WARNING_THRESHOLD=`echo ${TAB_WARNING_THRESHOLD[0]}`\nSYSTEM_WARNING_THRESHOLD=`echo ${TAB_WARNING_THRESHOLD[1]}`\nIOWAIT_WARNING_THRESHOLD=`echo ${TAB_WARNING_THRESHOLD[2]}`\nfi\n# List to Table for critical threshold\nTAB_CRITICAL_THRESHOLD=(`echo $LIST_CRITICAL_THRESHOLD | sed 's/,/ /g'`)\nif [ \"${#TAB_CRITICAL_THRESHOLD[@]}\" -ne \"3\" ]; then\necho \"ERROR : Bad count parameter in CRITICAL Threshold\"\nexit $STATE_WARNING\nelse\nUSER_CRITICAL_THRESHOLD=`echo ${TAB_CRITICAL_THRESHOLD[0]}`\nSYSTEM_CRITICAL_THRESHOLD=`echo ${TAB_CRITICAL_THRESHOLD[1]}`\nIOWAIT_CRITICAL_THRESHOLD=`echo ${TAB_CRITICAL_THRESHOLD[2]}`\nfi\nif [ ${TAB_WARNING_THRESHOLD[0]} -ge ${TAB_CRITICAL_THRESHOLD[0]} -o ${TAB_WARNING_THRESHOLD[1]} -ge ${TAB_CRITICAL_THRESHOLD[1]} -o ${TAB_WARNING_THRESHOLD[2]} -ge ${TAB_CRITICAL_THRESHOLD[2]} ]; then\necho \"ERROR : Critical CPU Threshold lower as Warning CPU Threshold \"\nexit $STATE_WARNING\nfi\nCPU_REPORT=`iostat -c $INTERVAL_SEC $NUM_REPORT | sed -e 's/,/./g' | tr -s ' ' ';' | sed '/^$/d' | tail -1`\nCPU_REPORT_SECTIONS=`echo ${CPU_REPORT} | grep ';' -o | wc -l`\nCPU_USER=`echo $CPU_REPORT | cut -d \";\" -f 2`\nCPU_SYSTEM=`echo $CPU_REPORT | cut -d \";\" -f 4`\nCPU_IOWAIT=`echo $CPU_REPORT | cut -d \";\" -f 5`\nCPU_STEAL=`echo $CPU_REPORT | cut -d \";\" -f 6`\nCPU_IDLE=`echo $CPU_REPORT | cut -d \";\" -f 7`\nNAGIOS_STATUS=\"user=${CPU_USER}%,system=${CPU_SYSTEM}%,iowait=${CPU_IOWAIT}%,idle=${CPU_IDLE}%\"\nNAGIOS_DATA=\"CpuUser=${CPU_USER};${TAB_WARNING_THRESHOLD[0]};${TAB_CRITICAL_THRESHOLD[0]};0\"\nCPU_USER_MAJOR=`echo $CPU_USER| cut -d \".\" -f 1`\nCPU_SYSTEM_MAJOR=`echo $CPU_SYSTEM | cut -d \".\" -f 1`\nCPU_IOWAIT_MAJOR=`echo $CPU_IOWAIT | cut -d \".\" -f 1`\nCPU_IDLE_MAJOR=`echo $CPU_IDLE | cut -d \".\" -f 1`\n# Return\nif [ ${CPU_USER_MAJOR} -ge $USER_CRITICAL_THRESHOLD ]; then\necho \"CPU STATISTICS OK:${NAGIOS_STATUS} | CPU_USER=${CPU_USER}%;70;90;0;100\"\nexit $STATE_CRITICAL\nelif [ ${CPU_SYSTEM_MAJOR} -ge $SYSTEM_CRITICAL_THRESHOLD ]; then\necho \"CPU STATISTICS OK:${NAGIOS_STATUS} | CPU_USER=${CPU_USER}%;70;90;0;100\"\nexit $STATE_CRITICAL\nelif [ ${CPU_IOWAIT_MAJOR} -ge $IOWAIT_CRITICAL_THRESHOLD ]; then\necho \"CPU STATISTICS OK:${NAGIOS_STATUS} | CPU_USER=${CPU_USER}%;70;90;0;100\"\nexit $STATE_CRITICAL\nelif [ ${CPU_USER_MAJOR} -ge $USER_WARNING_THRESHOLD ] &amp;&amp; [ ${CPU_USER_MAJOR} -lt $USER_CRITICAL_THRESHOLD ]; then\necho \"CPU STATISTICS OK:${NAGIOS_STATUS} | CPU_USER=${CPU_USER}%;70;90;0;100\"\nexit $STATE_WARNING\nelif [ ${CPU_SYSTEM_MAJOR} -ge $SYSTEM_WARNING_THRESHOLD ] &amp;&amp; [ ${CPU_SYSTEM_MAJOR} -lt $SYSTEM_CRITICAL_THRESHOLD ]; then\necho \"CPU STATISTICS OK:${NAGIOS_STATUS} | CPU_USER=${CPU_USER}%;70;90;0;100\"\nexit $STATE_WARNING\nelif  [ ${CPU_IOWAIT_MAJOR} -ge $IOWAIT_WARNING_THRESHOLD ] &amp;&amp; [ ${CPU_IOWAIT_MAJOR} -lt $IOWAIT_CRITICAL_THRESHOLD ]; then\necho \"CPU STATISTICS OK:${NAGIOS_STATUS} | CPU_USER=${CPU_USER}%;70;90;0;100\"\nexit $STATE_WARNING\nelse\necho \"CPU STATISTICS OK:${NAGIOS_STATUS} | CPU_USER=${CPU_USER}%;70;90;0;100\"\nexit $STATE_OK\nfi\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#monitor_linux\u7cfb\u7edf\u6027\u80fd","title":"monitor_Linux\u7cfb\u7edf\u6027\u80fd","text":"<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:xxx.sh\necho -e \"\\033[34m \\033[1m\"\ncat &lt;&lt;EOF\n++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n++++++++++++++++ Wellcom to use system Collect ++++++++++++++++++++++++++\nEOF\n#\u5b9a\u4e49\u5e38\u91cf\nMysql_ROOT=root\nMysql_password=admin#123\nDB_name=App1\n\nip_info=$(ifconfig|grep \"broadcast\"|tail -1|awk  '{print $2}')\ncpu_info1=$(cat /proc/cpuinfo | grep 'model name'|tail -1|awk -F: '{print $2}'|sed 's/^//g'|awk '{print $1,$3,$4,$NF}')\ncpu_info2=$(cat /proc/cpuinfo | grep 'physical id'|sort|uniq -c|wc -l)\nserv_info=$( hostname| tail -1)\ndisk_info=$(fdisk -l| grep \"\u78c1\u76d8\"|awk '{print $2,$3,$4}'|sed 's/,//g')\nmem_info=$( free -m|grep \"Mem\"|awk '{print \"Total\",$1,$2}')\nload_info=$(uptime|awk '{print \"Current load: \" $(NF-2),$(NF-1),$NF}'|sed 's/\\,//g')\nmakr_info=\"BeiJing_IDC\"\necho -e \"\\033[32m -------------------------------------- \\033[1m\"\necho IPADDR:${ip_info}\necho HOSTNAME:${serv_info}\necho CUP_INFO:${cpu_info1} X${cpu_info2}\necho DISK_INFO:${disk_info}\necho MEM_INFO:${mem_info}\"M\"\necho LOAD_INFO:${load_info}\necho -e \"\\033[32m -------------------------------------- \\033[0m\"\nmonitor_jk () {\nmysql -u${Mysql_ROOT} -p${Mysql_password} -D $DB_name -e \"\n    INSERT INTO system_info VALUES ('','$ip_info' , '$serv_info', '${cpu_info1} X${cpu_info2}', '$disk_info', '$mem_info', '$load_info');\n    \"\n}\necho -e -n \"\\033[36m *******You want to write the data to the databases? \u3010yes|y|Y\u3011: \\033[1m\"; read ensure\nif [ \"$ensure\" == \"yes\" -o \"$ensure\" == \"y\" -o \"$ensure\" == \"Y\" ]; then\necho \"-------------------------------------------------------------\"\nmysql -uroot -padmin#123 -D App1 -e \"select count(*) from system_info;\" &gt; /dev/null 2&gt;&amp;1\nif [ \"$?\" -eq 0 ]; then\nmonitor_jk\n    else\necho -e \"$DB_name is not exists! Create $DB_name\"\nmysql -u${Mysql_ROOT} -p${Mysql_password} -D $DB_name -e \"\n         CREATE TABLE `system_info` (\n          `id` int(10) NOT NULL AUTO_INCREMENT,\n          `address` varchar(15) DEFAULT NULL COMMENT 'IP address',\n          `Hostname` varchar(30) DEFAULT NULL COMMENT 'hostname',\n          `CPU_info` varchar(100) DEFAULT NULL COMMENT 'cpu_info',\n          `Disk_info` varchar(200) DEFAULT NULL COMMENT 'disk_info',\n          `Mem_info` int(8) DEFAULT NULL COMMENT 'mem_info',\n          `Load_info` varchar(80) DEFAULT NULL COMMENT 'load_info',\n          PRIMARY KEY (`id`)\n        ) ENGINE=InnoDB DEFAULT CHARSET=utf8;;\n        \"\nfi\nmonitor_jk\n\nfi\nmysql -u${Mysql_ROOT} -p${Mysql_password} -D $DB_name -e \"select * from system_info;\"\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u76d1\u63a7\u670d\u52a1\u5668\u4e3b\u8981\u6027\u80fd\u53c2\u6570\u6307\u6807","title":"\u76d1\u63a7\u670d\u52a1\u5668\u4e3b\u8981\u6027\u80fd\u53c2\u6570\u6307\u6807","text":"<pre><code>#!/bin/bash\n#\u529f\u80fd\u63cf\u8ff0(Description):\u76d1\u63a7\u670d\u52a1\u5668\u4e3b\u8981\u6027\u80fd\u53c2\u6570\u6307\u6807.\n#\u76d1\u63a7\u9879\u76ee:\u5185\u6838\u4fe1\u606f,\u4e3b\u673a\u540d\u79f0,IP\u5730\u5740,\u767b\u9646\u8d26\u6237,\u5185\u5b58\u4e0eswap\u4fe1\u606f,\u78c1\u76d8\u4fe1\u606f,CPU\u8d1f\u8f7d.\nkernel=$(uname -r)                                         #\u5185\u6838\u4fe1\u606f\nrelease=$(cat /etc/redhat-release)                         #\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\nhostname=$HOSTNAME                                         #\u4e3b\u673a\u540d\u79f0\nlocalip=$(ip a s | awk '/inet /{print $2}')                #\u672c\u5730IP\u5730\u5740\u5217\u8868\nmem_total=$(free | awk '/Mem/{print $2}')                  #\u603b\u5185\u5b58\u5bb9\u91cf\nmem_free=$(free | awk '/Mem/{print $NF}')                  #\u5269\u4f59\u5185\u5b58\u5bb9\u91cf\nswap_total=$(free | awk '/Swap/{print $2}')                #\u603bswap\u5bb9\u91cf\nswap_free=$(free | awk '/Swap/{print $NF}')                #\u5269\u4f59swap\u5bb9\u91cf\ndisk=$(df | awk '/^\\/dev/{print $1,$2,$4}'|column -t)      #\u78c1\u76d8\u4fe1\u606f\nload1=$(uptime | sed 's/,//g' | awk '{print $(NF-2)}')     #CPU\u6700\u8fd11\u5206\u949f\u5e73\u5747\u8d1f\u8f7d\nload5=$(uptime | sed 's/,//g' | awk '{print $(NF-1)}')     #CPU\u6700\u8fd15\u5206\u949f\u5e73\u5747\u8d1f\u8f7d\nload15=$(uptime | sed 's/,//g' | awk '{print $NF}')        #CPU\u6700\u8fd115\u5206\u949f\u5e73\u5747\u8d1f\u8f7d\nlogin_users=$(who | wc -l)                                 #\u767b\u9646\u7528\u6237\u6570\u91cf\nprocs=$(ps aux | wc -l)                                    #\u8fdb\u7a0b\u6570\u91cf\nusers=$(sed -n '$=' /etc/passwd)                           #\u7cfb\u7edf\u603b\u8d26\u6237\u6570\u91cf\ncpu_info=$(LANG=C lscpu | awk -F: '/Model name/ {print $2}')         #CPU\u578b\u53f7\ncpu_core=$(awk '/processor/{core END{print core}' /proc/cpuinfo)  #CPU\u5185\u6838\u6570\u91cf\nyum -y -q install sysstat &amp;&gt;/dev/null                                #\u5b89\u88c5\u6027\u80fd\u76d1\u63a7\u8f6f\u4ef6\necho -e \"\\033[34m\u63d0\u53d6\u78c1\u76d8\u6027\u80fd\u6307\u6807,\u8bf7\u7a0d\u540e...\\033[0m\"\ntps=$(LANG=C sar -d -p 1 6 | awk '/Average/' | tail -n +2 | awk '{print \"[\"$2\"]\u78c1\u76d8\u5e73\u5747IO\u6570\u91cf:\"$3}') &amp;\nread_write=$(LANG=C sar -d -p 1 6 | awk '/Average/' | tail -n +2 | awk '{print \"[\"$2\"]\u5e73\u5747\u6bcf\u79d2\u8bfb\u5199\u6247\u533a\u91cf:\"$4,$5}') &amp;\nirq=$(vmstat 1 2 | tail -n +4 | awk '{print $11}')         #\u4e2d\u65ad\u6570\u91cf\ncs=$(vmstat 1 2 | tail -n +4 | awk '{print $12}')          #\u4e0a\u4e0b\u6587\u5207\u6362\u6570\u91cf\ntop_proc_mem=$(ps --no-headers -eo comm,rss | sort -k2 -n | tail -10) #\u5360\u7528\u5185\u5b58\u8d44\u6e90\u6700\u591a\u768410\u4e2a\u8fdb\u7a0b\u5217\u8868\ntop_proc_cpu=$(ps --no-headers -eo comm,pcpu | sort -k2 -n | tail -5) #\u5360\u7528CPU\u8d44\u6e90\u6700\u591a\u76845\u4e2a\u8fdb\u7a0b\u5217\u8868\n#\u83b7\u53d6\u7f51\u5361\u6d41\u91cf,\u63a5\u6536|\u53d1\u9001\u7684\u6570\u636e\u6d41\u91cf,\u5355\u4f4d\u4e3a\u5b57\u8282bytes).\nnet_monitor=$(cat /proc/net/dev | tail -n +3 | \\\nawk 'BEGIN{ print \"\u7f51\u5361\u540d\u79f0 \u5165\u7ad9\u6570\u636e\u6d41\u91cf(bytes) \u51fa\u7ad9\u6570\u636e\u6d41\u91cf(bytes)\" } \\\n                   { print $1,$2,$10 }' | column -t)\n#\u8f93\u51fa\u6570\u636e\u4fe1\u606f.\necho -e \"\\033[32m--------------\u672c\u673a\u4e3b\u8981\u6570\u636e\u53c2\u6570\u8868-----------------\\033[0m\"\necho -e \"\u672c\u673aIP\u5730\u5740\u5217\u8868:\\033[32m$localip\\033[0m\"\necho -e \"\u672c\u673a\u4e3b\u673a\u540d\u79f0:\\033[32m$hostname\\033[0m\"\necho -e \"\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c:\\033[32m$release\\033[0m,\u5185\u6838\u7248\u672c:\\033[32m$kernel\\033[0m\"\necho -e \"CPU\u578b\u53f7\u4e3a:\\033[32m$cpu_info\\033[0m,CPU\u5185\u6838\u6570\u91cf:\\033[32m$cpu_core\\033[0m\"\necho -e \"\u672c\u673a\u603b\u5185\u5b58\u5bb9\u91cf:\\033[32m$mem_total\\033[0m,\u5269\u4f59\u53ef\u7528\u5185\u5b58\u5bb9\u91cf:\\033[32m$mem_free\\033[0m\"\necho -e \"\u672c\u673aswap\u603b\u5bb9\u91cf:\\033[32m$swap_total\\033[0m,\u5269\u4f59\u5bb9\u91cf:\\033[32m$swap_free\\033[0m\"\necho -e \"CPU\u6700\u8fd11\u5206\u949f,5\u5206\u949f,15\u5206\u949f\u7684\u5e73\u5747\u8d1f\u8f7d\u5206\u522b\u4e3a:\\033[32m$load1 $load5 $load15\\033[0m\"\necho -e \"\u672c\u673a\u603b\u8d26\u6237\u6570\u91cf\u4e3a:\\033[32m$users\\033[0m,\u5f53\u524d\u767b\u9646\u7cfb\u7edf\u7684\u8d26\u6237\u6570\u91cf:\\033[32m$login_users\\033[0m\"\necho -e \"\u5f53\u524d\u7cfb\u7edf\u4e2d\u542f\u52a8\u7684\u8fdb\u7a0b\u6570\u91cf:\\033[32m$procs\\033[0m\"\necho -e \"\u5360\u7528CPU\u8d44\u6e90\u6700\u591a\u76845\u4e2a\u8fdb\u7a0b\u5217\u8868\u4e3a:\"\necho -e \"\\033[32m$top_proc_cpu\\033[0m\"\necho -e \"\u5360\u7528\u5185\u5b58\u8d44\u6e90\u6700\u591a\u768410\u4e2a\u8fdb\u7a0b\u5217\u8868\u4e3a:\"\necho -e \"\\033[32m$top_proc_mem\\033[0m\"\necho -e \"CPU\u4e2d\u65ad\u6570\u91cf:\\033[32m$irq\\033[0m,CPU\u4e0a\u4e0b\u6587\u5207\u6362\u6570\u91cf:\\033[32m$cs\\033[0m\"\necho -e \"\u6bcf\u4e2a\u78c1\u76d8\u5206\u533a\u7684\u603b\u5bb9\u91cf\u4e0e\u5269\u4f59\u5bb9\u91cf\u4fe1\u606f\u5982\u4e0b:\"\necho -e \"$disk\"\necho -e \"$tps\"\necho -e \"$read_write\"\necho -e \"$net_monitor\"\necho -e \"\\033[32m------------------The End------------------------\\033[0m\"\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u751f\u4ea7\u73af\u5883\u4e0b\u8fd0\u7ef4\u5f00\u53d1\u7c7b\u811a\u672c","title":"\u751f\u4ea7\u73af\u5883\u4e0b\u8fd0\u7ef4\u5f00\u53d1\u7c7b\u811a\u672c","text":""},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u7cfb\u7edf\u521d\u59cb\u5316\u811a\u672ccentos6","title":"\u7cfb\u7edf\u521d\u59cb\u5316\u811a\u672cCentos6","text":"<p>\u7cfb\u7edf\u521d\u59cb\u5316\u811a\u672c\u7528\u4e8e\u65b0\u88c5Linux\u7684\u76f8\u5173\u914d\u7f6e\u5de5\u4f5c\uff0c</p>\n<p>\u6bd4\u5982\u7981\u6389iptables\u548cSELinux\u53caIPv6\u3001\u4f18\u5316\u7cfb\u7edf\u5185\u6838\u3001\u505c\u6389\u4e00\u4e9b\u6ca1\u5fc5\u8981\u542f\u52a8\u7684\u7cfb\u7edf\u670d\u52a1\u7b49\u3002</p>\n<p>\u6211\u4eec\u5c06\u7cfb\u7edf\u521d\u59cb\u5316\u811a\u672c\u5e94\u7528\u4e8e\u516c\u53f8\u5185\u90e8\u7684\u8fd0\u7ef4\u5f00\u53d1\u673a\u5668\u7684\u6279\u91cf\u90e8\u7f72\uff08\u6bd4\u5982\u7528Ansible\u6765\u4e0b\u53d1\uff09\u4e0a\u3002\u4e8b\u5b9e\u4e0a\uff0c\u590d\u6742\u7684\u7cfb\u7edf\u4e1a\u52a1\u521d\u59cb\u5316initial\u811a\u672c\u7531\u4e8e\u6d89\u53ca\u4e86\u591a\u6761\u4ea7\u54c1\u7ebf\u548c\u591a\u4e2a\u4e1a\u52a1\u5e73\u53f0\uff0c\u56e0\u6b64\u8fdc\u6bd4\u8fd9\u91cc\u5217\u51fa\u7684\u5f00\u53d1\u73af\u5883\u4e0b\u7684\u521d\u59cb\u5316\u811a\u672c\u590d\u6742\u5f97\u591a\uff0c\u800c\u4e14\u5176\u4ee3\u7801\u91cf\u4e5f\u6781\u5927\uff0c\u57fa\u672c\u4e0a\u90fd\u662f6000\uff5e7000\u884c\u7684Shell\u811a\u672c\uff0c\u5404\u529f\u80fd\u6a21\u5757\u4ee5\u51fd\u6570\u7684\u5f62\u5f0f\u8fdb\u884c\u5c01\u88c5\u3002\u4e0b\u9762\u7684\u811a\u672c\u53ea\u662f\u6d89\u53ca\u4e00\u4e9b\u57fa\u7840\u90e8\u5206\uff0c\u5e0c\u671b\u5927\u5bb6\u6ce8\u610f\u8fd9\u70b9\u3002</p>\n<p>\u811a\u672c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff08\u6b64\u811a\u672c\u5df2\u5728CentOS 6.8 x86_x64\u4e0b\u6d4b\u8bd5\u901a\u8fc7\uff09\uff1a</p>\n<pre><code>#!/bin/bash\n#\u6dfb\u52a0epel\u5916\u90e8yum\u6269\u5c55\u6e90\ncd /usr/local/src\nwget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\nrpm -ivh epel-release-6-8.noarch.rpm\n\n#\u5b89\u88c5gcc\u57fa\u7840\u5e93\u6587\u4ef6\u4ee5\u53casysstat\u5de5\u5177\nyum -y install gcc gcc-c++ vim-enhanced unzip unrar sysstat\n\n#\u914d\u7f6entpdate\u81ea\u52a8\u5bf9\u65f6\nyum -y install ntp\necho \"01 01 * * * /usr/sbin/ntpdate ntp.api.bz    &gt;&gt; /dev/null 2&gt;&amp;1\" &gt;&gt; /etc/crontab\nntpdate ntp.api.bz\nservice crond restart\n\n#\u914d\u7f6e\u6587\u4ef6\u7684ulimit\u503c\nulimit -SHn 65535\necho \"ulimit -SHn 65535\" &gt;&gt; /etc/rc.local\ncat &gt;&gt; /etc/security/limits.conf &lt;&lt; EOF\n*                     soft     nofile             65535\n*                     hard     nofile             65535\nEOF\n#\u57fa\u7840\u7cfb\u7edf\u5185\u6838\u4f18\u5316\ncat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF\nfs.file-max=419430\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_syn_retries = 1\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_fin_timeout = 1\nnet.ipv4.tcp_keepalive_time = 1200\nnet.ipv4.ip_local_port_range = 1024 65535\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.route.gc_timeout = 100\nnet.ipv4.tcp_syn_retries = 1\nnet.ipv4.tcp_synack_retries = 1\nnet.core.somaxconn = 16384\nnet.core.netdev_max_backlog = 16384\nnet.ipv4.tcp_max_orphans = 16384\nEOF\n/sbin/sysctl -p\n\n#\u7981\u7528control-alt-delete\u7ec4\u5408\u952e\u4ee5\u9632\u6b62\u8bef\u64cd\u4f5c\nsed -i 's@ca::ctrlaltdel:/sbin/shutdown -t3 -r now@#ca::ctrlaltdel:/sbin/shutdown -t3 -r now@' /etc/inittab\n\n#\u5173\u95edSELinux\nsed -i 's@SELINUX=enforcing@SELINUX=disabled@' /etc/selinux/config\n\n#\u5173\u95ediptables\nservice iptables stop\nchkconfig iptables off\n\n#ssh\u670d\u52a1\u914d\u7f6e\u4f18\u5316,\u8bf7\u81f3\u5c11\u4fdd\u6301\u673a\u5668\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u5177\u6709sudo\u6743\u9650\u7684\u7528\u6237\uff0c\u4e0b\u9762\u7684\u914d\u7f6e\u4f1a\u7981\u6b62root\u8fdc\u7a0b\u767b\u5f55\nsed -i 's@#PermitRootLogin yes@PermitRootLogin no@' /etc/ssh/sshd_config #\u7981\u6b62root\u8fdc\u7a0b\u767b\u5f55\nsed -i 's@#PermitEmptyPasswords no@PermitEmptyPasswords no@' /etc/ssh/sshd_config #\u7981\u6b62\u7a7a\u5bc6\u7801\u767b\u5f55\nsed -i 's@#UseDNS yes@UseDNS no@' /etc/ssh/sshd_config /etc/ssh/sshd_config\nservice sshd restart\n\n#\u7981\u7528IPv6\u5730\u5740\necho \"alias net-pf-10 off\" &gt;&gt; /etc/modprobe.d/dist.conf\necho \"alias ipv6 off\" &gt;&gt; /etc/modprobe.d/dist.conf\nchkconfig ip6tables off\n\n#vim\u57fa\u7840\u8bed\u6cd5\u4f18\u5316\necho \"syntax on\" &gt;&gt; /root/.vimrc\necho \"set nohlsearch\" &gt;&gt; /root/.vimrc\n\n#\u7cbe\u7b80\u5f00\u673a\u81ea\u542f\u52a8\u670d\u52a1\uff0c\u5b89\u88c5\u6700\u5c0f\u5316\u670d\u52a1\u7684\u673a\u5668\u521d\u59cb\u53ef\u4ee5\u53ea\u4fdd\u7559crond\uff0cnetwork\uff0crsyslog\uff0csshd\u8fd9\u56db\u4e2a\u670d\u52a1\u3002\nfor i in `chkconfig --list|grep 3:on|awk '{print $1}'`;do chkconfig --level 3 $i off;done\nfor CURSRV  in crond rsyslog sshd network;do chkconfig --level 3 $CURSRV on;done\n#\u91cd\u542f\u670d\u52a1\u5668\nreboot\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u7cfb\u7edf\u521d\u59cb\u5316\u811a\u672ccentos7","title":"\u7cfb\u7edf\u521d\u59cb\u5316\u811a\u672cCentos7","text":"<pre><code>#!/bin/bash\n#author shunxin by\n#this script is only for CentOS 7.x\n#check the OS\nplatform=`uname -i`\nif [ $platform != \"x86_64\" ];then\necho \"this script is only for 64bit Operating System !\"\nexit 1\nfi\necho \"the platform is ok\"\ncat &lt;&lt; EOF\n+---------------------------------------+\n|   your system is CentOS 7 x86_64      |\n|      start optimizing.......          |\n+---------------------------------------\nEOF\n#Yum\u6e90\u66f4\u6362\u4e3a\u56fd\u5185\u963f\u91cc\u6e90\nyum install wget -y\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\nwget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n#\u6dfb\u52a0\u963f\u91cc\u7684epel\u6e90\n#add the epel\nwget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\n#yum\u91cd\u65b0\u5efa\u7acb\u7f13\u5b58\nyum clean all\nyum makecache\n#\u540c\u6b65\u65f6\u95f4\nyum -y install ntp\n/usr/sbin/ntpdate ntp1.aliyun.com\necho \"* 3 * * * /usr/sbin/ntpdate ntp1.aliyun.com &gt; /dev/null 2&gt;&amp;1\" &gt;&gt; /var/spool/cron/root\nsystemctl  restart crond.service\n#\u8bbe\u7f6e\u4e3b\u673a\u540d\nhostnamectl   set-hostname qiuyuetao\n#\u8bbe\u7f6e\u5b57\u7b26\u96c6\n#\u8bbe\u7f6e\u6700\u5927\u6253\u5f00\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\necho \"ulimit -SHn 102400\" &gt;&gt; /etc/rc.local\ncat &gt;&gt; /etc/security/limits.conf &lt;&lt; EOF\n*           soft   nofile       655350\n*           hard   nofile       655350\nEOF\n#\u7981\u7528selinux\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config\nsetenforce 0\n#\u5173\u95ed\u9632\u706b\u5899\nsystemctl disable firewalld.service\nsystemctl stop firewalld.service\n#set ssh\nsed -i 's/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/' /etc/ssh/sshd_config\nsed -i 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config\nsystemctl  restart sshd.service\n#\u5185\u6838\u53c2\u6570\u4f18\u5316\ncat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF\n#CTCDN\u7cfb\u7edf\u4f18\u5316\u53c2\u6570\n#\u5173\u95edipv6\nnet.ipv6.conf.all.disable_ipv6 = 1\nnet.ipv6.conf.default.disable_ipv6 = 1\n#\u51b3\u5b9a\u68c0\u67e5\u8fc7\u671f\u591a\u4e45\u90bb\u5c45\u6761\u76ee\nnet.ipv4.neigh.default.gc_stale_time=120\n#\u4f7f\u7528arp_announce / arp_ignore\u89e3\u51b3ARP\u6620\u5c04\u95ee\u9898\nnet.ipv4.conf.default.arp_announce = 2\nnet.ipv4.conf.all.arp_announce=2\nnet.ipv4.conf.lo.arp_announce=2\n# \u907f\u514d\u653e\u5927\u653b\u51fb\nnet.ipv4.icmp_echo_ignore_broadcasts = 1\n# \u5f00\u542f\u6076\u610ficmp\u9519\u8bef\u6d88\u606f\u4fdd\u62a4\nnet.ipv4.icmp_ignore_bogus_error_responses = 1\n#\u5f00\u542f\u8def\u7531\u8f6c\u53d1\nnet.ipv4.ip_forward = 1\nnet.ipv4.conf.all.send_redirects = 1\nnet.ipv4.conf.default.send_redirects = 1\n#\u5f00\u542f\u53cd\u5411\u8def\u5f84\u8fc7\u6ee4\nnet.ipv4.conf.all.rp_filter = 1\nnet.ipv4.conf.default.rp_filter = 1\n#\u5904\u7406\u65e0\u6e90\u8def\u7531\u7684\u5305\nnet.ipv4.conf.all.accept_source_route = 0\nnet.ipv4.conf.default.accept_source_route = 0\n#\u5173\u95edsysrq\u529f\u80fd\nkernel.sysrq = 0\n#core\u6587\u4ef6\u540d\u4e2d\u6dfb\u52a0pid\u4f5c\u4e3a\u6269\u5c55\u540d\nkernel.core_uses_pid = 1\n# \u5f00\u542fSYN\u6d2a\u6c34\u653b\u51fb\u4fdd\u62a4\nnet.ipv4.tcp_syncookies = 1\n#\u4fee\u6539\u6d88\u606f\u961f\u5217\u957f\u5ea6\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\n#\u8bbe\u7f6e\u6700\u5927\u5185\u5b58\u5171\u4eab\u6bb5\u5927\u5c0fbytes\nkernel.shmmax = 68719476736\nkernel.shmall = 4294967296\n#timewait\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4180000\nnet.ipv4.tcp_max_tw_buckets = 6000\nnet.ipv4.tcp_sack = 1\nnet.ipv4.tcp_window_scaling = 1\nnet.ipv4.tcp_rmem = 4096        87380   4194304\nnet.ipv4.tcp_wmem = 4096        16384   4194304\nnet.core.wmem_default = 8388608\nnet.core.rmem_default = 8388608\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\n#\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u63a5\u6536\u6570\u636e\u5305\u7684\u901f\u7387\u6bd4\u5185\u6838\u5904\u7406\u8fd9\u4e9b\u5305\u7684\u901f\u7387\u5feb\u65f6\uff0c\u5141\u8bb8\u9001\u5230\u961f\u5217\u7684\u6570\u636e\u5305\u7684\u6700\u5927\u6570\u76ee\nnet.core.netdev_max_backlog = 262144\n#\u9650\u5236\u4ec5\u4ec5\u662f\u4e3a\u4e86\u9632\u6b62\u7b80\u5355\u7684DoS \u653b\u51fb\nnet.ipv4.tcp_max_orphans = 3276800\n#\u672a\u6536\u5230\u5ba2\u6237\u7aef\u786e\u8ba4\u4fe1\u606f\u7684\u8fde\u63a5\u8bf7\u6c42\u7684\u6700\u5927\u503c\nnet.ipv4.tcp_max_syn_backlog = 262144\nnet.ipv4.tcp_timestamps = 0\n#\u5185\u6838\u653e\u5f03\u5efa\u7acb\u8fde\u63a5\u4e4b\u524d\u53d1\u9001SYNACK \u5305\u7684\u6570\u91cf\nnet.ipv4.tcp_synack_retries = 1\n#\u5185\u6838\u653e\u5f03\u5efa\u7acb\u8fde\u63a5\u4e4b\u524d\u53d1\u9001SYN \u5305\u7684\u6570\u91cf\nnet.ipv4.tcp_syn_retries = 1\n#\u542f\u7528timewait \u5feb\u901f\u56de\u6536\nnet.ipv4.tcp_tw_recycle = 0\n#\u5f00\u542f\u91cd\u7528\u3002\u5141\u8bb8\u5c06TIME-WAIT sockets \u91cd\u65b0\u7528\u4e8e\u65b0\u7684TCP \u8fde\u63a5\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_mem = 94500000 915000000 927000000\nnet.ipv4.tcp_fin_timeout = 1\n#\u5f53keepalive \u8d77\u7528\u7684\u65f6\u5019\uff0cTCP \u53d1\u9001keepalive \u6d88\u606f\u7684\u9891\u5ea6\u3002\u7f3a\u7701\u662f2 \u5c0f\u65f6\nnet.ipv4.tcp_keepalive_time = 1800\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl = 15\n#\u5141\u8bb8\u7cfb\u7edf\u6253\u5f00\u7684\u7aef\u53e3\u8303\u56f4\nnet.ipv4.ip_local_port_range = 1024    65000\n#\u4fee\u6539\u9632\u706b\u5899\u8868\u5927\u5c0f\uff0c\u9ed8\u8ba465536\nnet.netfilter.nf_conntrack_max=655350\nnet.netfilter.nf_conntrack_tcp_timeout_established=1200\n# \u786e\u4fdd\u65e0\u4eba\u80fd\u4fee\u6539\u8def\u7531\u8868\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\nnet.ipv4.conf.all.secure_redirects = 0\nnet.ipv4.conf.default.secure_redirects = 0\nEOF\n/sbin/sysctl -p\n#vim\u5b9a\u4e49\u9000\u683c\u952e\u53ef\u5220\u9664\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u7c7b\u578b\necho 'alias vi=vim' &gt;&gt; /etc/profile\necho 'stty erase ^H' &gt;&gt; /etc/profile\necho 'curl ip.6655.com/ip.aspx&amp;&amp;echo' &gt;&gt; /etc/profile\ncat &gt;&gt; /root/.vimrc &lt;&lt; EOF\nset tabstop=4\nset shiftwidth=4\nset expandtab\nsyntax on\n\"set number\nEOF\n#update soft\nyum -y update\ncat &lt;&lt; EOF\n+-------------------------------------------------+\n|                \u4f18 \u5316 \u5df2 \u5b8c \u6210             |\n|             5s \u540e \u91cd\u542f \u8fd9\u53f0\u670d\u52a1\u5668 !       |\n+-------------------------------------------------+\nEOF\nsleep 5\necho -e \"\\n\\033[31m\u8bf7\u91cd\u542f\u673a\u5668 \u4f7f\u5185\u6838\u4fee\u6539\u751f\u6548\uff01\uff01\uff01\\033[0m\\n\"  ##\u91cd\u542f\u52a0\u8f7d\u5185\u6838\u4fee\u6539\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u63a7\u5236shell\u591a\u8fdb\u7a0b\u6570\u91cf\u7684\u811a\u672c","title":"\u63a7\u5236shell\u591a\u8fdb\u7a0b\u6570\u91cf\u7684\u811a\u672c","text":"<p>\u4e0b\u9762\u7684run.py\u662f\u722c\u866b\u7a0b\u5e8f\uff0c\u7ecf\u6d4b\u8bd5\uff0c\u5728\u673a\u5668\u4e0a\u8fd0\u884c8\u4e2arun.py\u8fdb\u7a0b\u662f\u673a\u5668\u6027\u80fd\u6700\u597d\u7684\u65f6\u5019\uff0c\u8be5\u8fdb\u7a0b\u6570\u91cf\u65e2\u80fd\u5145\u5206\u53d1\u6325\u673a\u5668\u7684\u6027\u80fd\u53c8\u4e0d\u4f1a\u5bfc\u81f4\u673a\u5668\u54cd\u5ea6\u901f\u5ea6\u8fc7\u6162\u3002</p>\n<p>\u800c\u4e14\u6709\u65f6\u4e3a\u4e86\u907f\u514d\u5e76\u53d1\u8fdb\u7a0b\u6570\u8fc7\u591a\u5bfc\u81f4\u673a\u5668\u5361\u6b7b\uff0c\u9700\u8981\u9650\u5236\u5e76\u53d1\u7684\u6570\u91cf\u3002\u4e0b\u9762\u7684\u811a\u672c\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e2a\u9700\u6c42\uff0c\u5176\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p>\n<pre><code>#!/usr/bin/env bash\n#usage:xxx\n#scripts_name:${NAME}.sh\n# author\uff1axiaojian\nCE_HOME=\"/data/ContentEnginne\"\nLOG_PATH=\"/data/logs\"\n# \u63a7\u5236\u722c\u866b\u6570\u91cf\u4e3a8\nMAX_SPIDER_COUNT=8\ncount=`ps -ef|grep -v grep|grep run.py|wc -l`\ntry_time=0\ncd $CE_HOME\n# \u9650\u5236\u5e76\u53d1\u7684\u6570\u91cf\nwhile [ $count -lt $MAX_SPIDER_COUNT -a $try_time -lt $MAX_SPIDER_COUNT ]; do\nlet try_time +=1\npython run.py &gt;&gt; ${LOG_PATH}/spider.log 2&gt;&amp;1 &amp;\ncount=`ps -ef|grep -v grep|grep run.py|wc -l`\ndone\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u624b\u52a8\u5efa\u7acb\u8f6fraid\u7ea7\u522b\u9700\u6c42","title":"\u624b\u52a8\u5efa\u7acb\u8f6fRaid\u7ea7\u522b\u9700\u6c42","text":"<pre><code>#!/bin/bash\nfunction rg_mkfs_interac() {\nread -p \"\u8bf7\u8f93\u5165\u60a8\u8981\u505a\u7684RAID\u7ea7\u522b\uff0c\u53ef\u9009\u62e9\u9879\u4e3a0|1|5|10:\" raid\n    read -p \"\u8bf7\u8f93\u5165\u54ea\u4e9b\u78c1\u76d8\u9700\u8981\u5e76\u8fdbRAID\uff0c\u78c1\u76d8\u4e4b\u95f4\u8bf7\u7528\u7a7a\u683c\u683c\u5f00\uff0c\u4f8b\u5982sdb sdc\u7b49\" mydev\n    echo $raid\necho $mydev\n# create md0\nrg_info \"Create RAID...\"\nmdadm -Ss\n        yes | mdadm -C /dev/md0 --level=$raid --auto=yes $mydev &gt;/dev/null\n        mdadm -D /dev/md0 &gt;/dev/null || rg_info 58 \"Create RAID /dev/md0 failed.\"\n# public\npartprobe /dev/$DISK_SYS 2&gt;/dev/null\n            sleep 3\n# mkfs\nfor i in {${DISK_SYS}4,md0}; do\necho -n \"$MKFS /dev/$i... \"\nif $MKFS /dev/$i &amp;&gt;/dev/null; then\necho OK\n                else\necho failed &amp;&amp; rg_info 55 \"mkfs $i failed\"\nfi\ndone\nrg_info \"Create cache direcotry...\" &amp;&amp; mkdir -p /cache/{cache,logs}\necho -e \"/dev/${DISK_SYS}4 \\t\\t/cache/logs \\t\\t$FS \\tdefaults \\t0 0\" &gt;&gt;/etc/fstab\n            echo -e \"/dev/md0 \\t\\t/cache/cache \\t\\t$FS \\t$MOUNT_OPTS \\t0 0\" &gt;&gt;/etc/fstab\n        echo \"--\"\n#save mdadm.conf\nif (mdadm -Ds 2&gt;/dev/null |grep -q .); then\n[ -f /etc/mdadm.conf ] &amp;&amp; rg_info \"Backup old mdadm.conf...\" &amp;&amp; /bin/cp /etc/mdadm.conf /etc/mdadm.conf.bak\n            rg_info \"Save RAID configration (mdadm.conf)...\"\nif [ \"$VER6\" == 'yes' ]; then\nmdadm -Ds |sed 's!/dev/md[^ ]*:\\([0-9]\\)!/dev/md\\1!; s!metadata[^ ]* !!; s/$/ auto=yes/' &gt;/etc/mdadm.conf\n                else\nmdadm -Ds |sed 's/$/ auto=yes/' &gt;/etc/mdadm.conf\n                fi\nfi\n#mount all\nfgrep -q /cache /etc/fstab || rg_info 48 \"Internal error: f_mkfs has BUG!\"\nrg_info \"\u6302\u8f7d\u6240\u6709\u5206\u533a...\"\nif mount -a; then\nrg_info \"\u521b\u5efamkpart\u9501...\"\necho \"$VERSION\" &gt;$MKFS_LOCK 2&gt;/dev/null &amp;&amp; chattr +i $MKFS_LOCK\nret=0\nelse\nrg_info 49 \"mount -a \u51fa\u9519\"\nfi\nreturn $ret\n}\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u5728\u811a\u672c\u4e2d\u4fee\u6539crontab","title":"\u5728\u811a\u672c\u4e2d\u4fee\u6539crontab","text":"<pre><code>(crontab -l 2&gt;/dev/null; echo '*/2 * * * * bash /usr/local/src/kestrel.openfiles.check &gt; /usr/local/src/logs/kestrel_openfiles.check.$(date \"+\\%Y\\%m\\%d-\\%H\\%M\\%S\").details 2&gt;&amp;1') | crontab -\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u5b57\u7b26\u4e32\u5904\u7406\u5b8c\u6574\u811a\u672c","title":"\u5b57\u7b26\u4e32\u5904\u7406\u5b8c\u6574\u811a\u672c","text":"<pre><code>#!/bin/bash\nstring=\"Bigdata process framework is Hadoop,Hadoop is an open source project\"\nfunction print_tips\n{\necho \"******************************\"\necho \"(1)\u6253\u5370string\u957f\u5ea6\"\necho \"(2)\u5220\u9664\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u7684Hadoop\"\necho \"(3)\u66ff\u6362\u7b2c\u4e00\u4e2aHadoop\u4e3aMapreduce\"\necho \"(4)\u66ff\u6362\u5168\u90e8Hadoop\u4e3aMapreduce\"\necho \"*******************************\"\n}\nfunction len_of_string\n{\necho \"${#string}\"\n}\nfunction del_hadoop\n{\necho \"${string//Hadoop/}\"\n}\nfunction rep_hadoop_mapreduce_first\n{\necho \"${string/Hadoop/Mapreduce}\"\n}\nfunction rep_hadoop_mapreduce_all\n{\necho \"${string//Hadoop/Mapreduce}\"\n}\nwhile true\ndo\necho \"[string=$string]\"\necho\nprint_tips\n    read -p \"Pls input your choice(1|2|3|4|q|Q): \" choice\n\ncase $choice in\n1)\nlen_of_string\n            ;;\n2)\ndel_hadoop\n            ;;\n3)\nrep_hadoop_mapreduce_first\n            ;;\n4)\nrep_hadoop_mapreduce_all\n            ;;\nq|Q)\nexit\n;;\n*)\necho \"Error,input only in {1|2|3|4|q|Q|}\"\n;;\nesac\ndone\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u8bbe\u7f6e\u9501\u6587\u4ef6\u9632\u6b62\u811a\u672c\u91cd\u590d\u6267\u884c","title":"\u8bbe\u7f6e\u9501\u6587\u4ef6\u9632\u6b62\u811a\u672c\u91cd\u590d\u6267\u884c","text":"<pre><code>#!/bin/bash\n#\u529f\u80fd\u63cf\u8ff0(Description):\u901a\u8fc7\u8bbe\u7f6e\u9501\u6587\u4ef6\u9632\u6b62\u811a\u672c\u91cd\u590d\u6267\u884c.\n#\u4f7f\u7528Ctrl+C\u4e2d\u65ad\u811a\u672c\u65f6,\u5220\u9664\u9501\u6587\u4ef6.\ntrap 'rm -rf /tmp/lockfile;exit' HUP INT\n\n#\u68c0\u67e5\u662f\u5426\u5b58\u5728\u9501\u6587\u4ef6,\u6ca1\u6709\u9501\u6587\u4ef6\u5c31\u6267\u884cbackup\u5907\u4efd\u51fd\u6570,\u5982\u679c\u6709\u9501\u6587\u4ef6\u811a\u672c\u5219\u811a\u672c\u76f4\u63a5\u9000\u51fa.\nlock_check(){\nif (set -C; :&gt; /tmp/lockfile) 2&gt;/dev/null ;then\nbackup\n    else\necho -e \"\\033[91mWarning:\u5176\u4ed6\u7528\u6237\u5728\u6267\u884c\u8be5\u811a\u672c.\\033[0m\"\nexit 66\nfi\n}\n#\u6267\u884c\u5907\u4efd\u524d\u521b\u5efa\u6240\u6587\u4ef6,\u7136\u540e\u6267\u884c\u5907\u4efd\u6570\u636e\u5e93\u7684\u64cd\u4f5c,\u5907\u4efd\u5b8c\u6210\u540e\u5220\u9664\u9501\u6587\u4ef6.\n#sleep 10\u5b9e\u9a8c\u6d4b\u8bd5\u65f6\u4f7f\u7528,\u4e3a\u4e86\u9632\u6b62\u5c0f\u6570\u636e\u5e93\u5907\u4efd\u592a\u5feb,\u65e0\u6cd5\u9a8c\u8bc1\u91cd\u590d\u6267\u884c\u811a\u672c\u7684\u6548\u679c.\nbackup(){\ntouch /tmp/lockfile\n    mysqldump --all-database &gt; /var/log/mysql-$(date +%Y%m%d).bak\n    sleep 10\nrm -rf /tmp/lockfile\n}\nlock_check\nbackup\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u4fee\u6539sshd\u914d\u7f6e\u6587\u4ef6","title":"\u4fee\u6539sshd\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>#!/bin/bash\n#\u529f\u80fd\u63cf\u8ff0(Description):\u4fee\u6539SSHD\u914d\u7f6e\u6587\u4ef6,\u63d0\u5347SSH\u5b89\u5168\u6027.\nconfig_file=\"/etc/ssh/sshd_config\"\nPORT=12345\n#\u5c06\u9ed8\u8ba4\u7aef\u53e3\u53f7\u4fee\u6539\u4e3a\u81ea\u5b9a\u4e49\u7aef\u53e3\u53f7.\nif grep -q \"^Port\" $config_file;then\nsed -i \"/^Port/c Port $PORT\" $config_file\nelse\necho \"Port $PORT\" &gt;&gt; $config_file\nfi\n#\u7981\u6b62root\u8fdc\u7a0b\u767b\u9646SSH\u670d\u52a1\u5668.\nif grep -q \"^PermitRootLogin\" $config_file;then\nsed -i '/^PermitRootLogin/s/yes/no/' $config_file\nelse\nsed -i '$a PermitRootLogin no' $config_file\nfi\n#\u7981\u6b62\u4f7f\u7528\u5bc6\u7801\u8fdc\u7a0b\u767b\u9646SSH\u670d\u52a1\u5668.\nif grep -q \"^PasswordAuthentication\" $config_file;then\nsed -i '/^PasswordAuthentication/s/yes/no/' $config_file\nelse\nsed -i '$a PasswordAuthentication no' $config_file\nfi\n#\u7981\u6b62X11\u56fe\u5f62\u8f6c\u53d1\u529f\u80fd.\nif grep -q \"^X11Forwarding\" $config_file;then\nsed -i '/^X11Forwarding/s/yes/no/' $config_file\nelse\nsed -i '$a X11Forwarding no' $config_file\nfi\n#\u7981\u6b62DNS\u67e5\u8be2.\nif grep -q \"^UseDNS\" $config_file;then\nsed -i '/^UseDNS/s/yes/no/' $config_file\nelse\nsed -i '$a UseDNS no' $config_file\nfi\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u591a\u79cdtest\u7684\u5199\u6cd5","title":"\u591a\u79cdtest\u7684\u5199\u6cd5","text":"<pre><code>#!/usr/bin/env bash\nFreeMem=`free -m|awk 'NR==3 {print $NF}'`\nif (( $FreeMem &lt; 1000 )); then\necho \"xxxxxxxxxx\"\nfi\nif [[ $FreeMem -lt 1000 ]]; then\necho \"xxxxxxxx\"\nfi\nif test $FreeMem -lt 1000; then\necho \"xxxxxxxxxxxx\"\nfi\nif grep  /etc/passwd &gt;/dev/null 2&gt;&amp;1; then\necho \"xxxxxxxxxx\"\nfi\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#color\u8f93\u51fa","title":"color\u8f93\u51fa","text":"<pre><code>#!/usr/bin/env bash\n#\u65b9\u6cd51\ncolor_printf1(){\nif [[ $1 == \"red\" ]]; then\necho -e \"\\033[32;40m$2\\033[0m\"\nelif [[ $1 == \"green\" ]];then\necho -e \"\\033[31;40m$2\\033[0m\"\nfi\n}\n#\u65b9\u6cd52\ncolor_printf2(){\ncase \"$1\" in\n\"red\")\necho -e \"\\033[32;40m$2\\033[0m\"\n;;\n\"green\")\necho -e \"\\033[31;40m$2\\033[0m\"\n;;\n*)\necho -e \"Example: color_printf2 red xxxxxx\"\n;;\nesac\n}\n# \u65b9\u6cd53\nfunction echo_r (){\n# Color red: Error, Failed\n[ $# -ne 1 ] &amp;&amp; return 1\necho -e \"\\033[31m$1\\033[0m\"\n}\nfunction echo_g (){\n# Color green: Success\n[ $# -ne 1 ] &amp;&amp; return 1\necho -e \"\\033[32m$1\\033[0m\"\n}\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#\u4e00\u4e9b\u5e38\u7528\u7684\u51fd\u6570","title":"\u4e00\u4e9b\u5e38\u7528\u7684\u51fd\u6570","text":"<pre><code>#\u5224\u65ad\u662f\u5426\u662ffalse\nis_false() {\ncase \"$1\" in\n[fF] | [nN] | [nN][oO] | [fF][aA][lL][sS][eE] | 0)\nreturn 0\n;;\nesac\nreturn 1\n}\n#\u5224\u65ad\u8fdb\u7a0b\u662f\u5426\u8fd0\u884c\nis_running()\n{\nif [ -f $1 ]; then\nread pid &lt; $1\nif [ -d \"/proc/$pid\" ]; then\nreturn 0\nfi\nfi\nreturn -1\n}\n#\u5b89\u88c5epel\u6e90\nfunction _install_epel {\n# NOTE: We always remove and install latest -- some environments\n# use snapshot images, and if EPEL version updates they break\n# unless we update them to latest version.\nif sudo yum repolist enabled epel | grep -q 'epel'; then\nuninstall_package epel-release || true\nfi\n# This trick installs the latest epel-release from a bootstrap\n# repo, then removes itself (as epel-release installed the\n# \"real\" repo).\n#\n# You would think that rather than this, you could use\n# $releasever directly in .repo file we create below.  However\n# RHEL gives a $releasever of \"6Server\" which breaks the path;\n# see https://bugzilla.redhat.com/show_bug.cgi?id=1150759\ncat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/epel-bootstrap.repo\n[epel-bootstrap]\nname=Bootstrap EPEL\nmirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=epel-7&amp;arch=\\$basearch\nfailovermethod=priority\nenabled=0\ngpgcheck=0\nEOF\n# Enable a bootstrap repo.  It is removed after finishing\n# the epel-release installation.\nis_package_installed yum-utils || install_package yum-utils\n    sudo yum-config-manager --enable epel-bootstrap\n    yum_install epel-release || \\\ndie $LINENO \"Error installing EPEL repo, cannot continue\"\nsudo rm -f /etc/yum.repos.d/epel-bootstrap.repo\n}\n#\u8bb0\u5f55\u65e5\u5fd7\u7684function\nfunction fnLogInfo()\n{\nlocal infomsg=$1\necho ${infomsg}\necho `date \"${data_format}\"` \"Info:${infomsg}\" &gt;&gt; ${log_file}\n}\n#\u5907\u4efd\u6587\u4ef6\u7684function\nfnBackupBeforeModify()\n{\nlocal file=$1\nlocal backupFile=\"${file}.bak\"\nfnLogInfo \"Start to backup file $file\"\ncp ${file} -p ${backupFile}\nfnLogInfo \"End to backup file $file\"\n}\n# 1. change the network config as DHCP\n# 2. delete the 70-persistent-net.rules file\nfnModifyNetworkConfig()\n{\nfnLogInfo \"----------------------------------------\"\nfnLogInfo \"Start to modify the network configuration\"\nlocal files=''\n#1. change the network config as DHCP\ncase $os_type in\n#/etc/sysconfig/network-scripts\n\"redhat\")\nfiles=\"`ls /etc/sysconfig/network-scripts/ifcfg-eth* |grep -v .bak`\"\nfiles=\"${files} `ls /etc/sysconfig/network-scripts/ifcfg-ens* |grep -v .bak`\"\nfor file in $files\ndo\nfnLogInfo \"Start to modify the network configuration: $file\"\n#backup  the file\nfnBackupBeforeModify $file\n#modify the file\nsed -i '/PERSISTENT_DHCLIENT/d' $file\nsed -i '$a\\PERSISTENT_DHCLIENT=yes' $file\nfnLogInfo \"End to modify the network configuration: $file\"\ndone\n;;\n#/etc/sysconfig/network/dhcp\n\"suse\")\nfile='/etc/sysconfig/network/dhcp'\n#first backup file\nfnBackupBeforeModify $file\nsed -i \"s/DHCLIENT_USE_LAST_LEASE=yes\\|DHCLIENT_USE_LAST_LEASE='yes'\\|DHCLIENT_USE_LAST_LEASE=\\\"yes\\\"/DHCLIENT_USE_LAST_LEASE=\\\"no\\\"/g\" $file\n;;\n#/etc/network/interfaces\n\"debian\" | \"ubuntu\")\nfile='/etc/network/interfaces'\n#backup the file\nfnBackupBeforeModify $file\nsed -i \"s/static\\| manual/ dhcp/g\" $file\nsed -i \"s/address /#address /g\" $file\nsed -i \"s/netmask /#netmask /g\" $file\nsed -i \"s/gateway /#gateway /g\" $file\n;;\n*)\nfnLogInfo \"Other Linux, network configuration cannot be modified.\"\n;;\nesac\n#2. delete the 70-persistent-net.rules file\nrm -rf /etc/udev/rules.d/70-persistent-net.rules\n\nfnLogInfo \"Delete 70-persistent-net.rules file, resut: $?\"\nfnLogInfo \"End to modify the network configuration\"\n}\n#check OS\u7684function\nfnGetOSType()\n{\nfnLogInfo \"---------------------------\"\nfnLogInfo \"Start to get the os type\"\nlocal version=\"/proc/version\"\nif ! [ -e \"${version}\" ];then\nreturn 1\nelif [ -n \"$(grep -i 'suse' ${version})\" ];then\nos_type='suse'\nelif [ -n \"$(grep -i 'ubuntu' ${version})\" ];then\nos_type='ubuntu'\nelif [ -n \"$(grep -i 'Red Hat' ${version})\" ];then\nos_type='redhat'\nelif [ -n \"$(grep -i 'debian' ${version})\" ];then\nos_type='debian'\nfi\nfnLogInfo \"End to get the os type: $os_type\"\n}\n#\u8f93\u5165\u9009\u62e9Yes\u548cNo\u51fd\u6570\nYES_NO_choice(){\nread -t 10 -p \"Please input you commit ,wait 5.....to exit: \" input\n\ncase $input in\n[yY]|[yY][eE][sS] )\necho \"YES!!!!!\"\n;;\n[nN]|[nN][oO] )\necho \"NO  Error!!!!!\"\n;;\n*)\necho \"============================\"\n;;\nesac\n#\u9519\u8bef\u63d0\u793a\u51fd\u6570\ndie () {\necho \"ERROR: $1. Aborting!\"\nexit 1\n}\n#\u5224\u65ad\u7528\u6237\u8f93\u5165\u5982\u679c\u6ca1\u6709\u8f93\u5165\uff0c\u9009\u62e9\u9ed8\u8ba4\u503c redis\u4e3a\u4f8b\n_REDIS_PORT=6379\n_MANUAL_EXECUTION=false     #\u6807\u5fd7\u4fe1\u606f\ncheck_input_redis_port(){\nif ! echo $REDIS_PORT | egrep -q '^[0-9]+$' ; then\n_MANUAL_EXECUTION=true      #\u91cd\u7f6e\u6807\u5fd7\u4fe1\u606f\n#Read the redis port\nread  -p \"Please select the redis port for this instance: [$_REDIS_PORT] \" REDIS_PORT\n    if ! echo $REDIS_PORT | egrep -q '^[0-9]+$' ; then\necho \"Selecting default: $_REDIS_PORT\"\nREDIS_PORT=$_REDIS_PORT\nfi\nfi\n}\nGet_OS_Bit()\n{\nif [[ `getconf WORD_BIT` = '32' &amp;&amp; `getconf LONG_BIT` = '64' ]] ; then\nIs_64bit='y'\nelse\nIs_64bit='n'\nfi\n}\nDownload_Files()\n{\nlocal URL=$1\nlocal FileName=$2\nif [ -s \"${FileName}\" ]; then\necho \"${FileName} [found]\"\nelse\necho \"Notice: ${FileName} not found!!!download now...\"\nwget -c --progress=bar:force --prefer-family=IPv4 --no-check-certificate ${URL}\nfi\n}\n#\u6279\u91cf\u5b89\u88c5\u57fa\u7840\u5305\nCentOS_Dependent()\n{\n\\cp /etc/yum.conf /etc/yum.conf.lnmp\n    sed -i 's:exclude=.*:exclude=:g' /etc/yum.conf\n\nEcho_Blue \"[+] Yum installing dependent packages...\"\nfor packages in make cmake gcc gcc-c++ gcc-g77 flex bison file libtool libtool-libs autoconf kernel-devel patch wget crontabs libjpeg libjpeg-devel libpng libpng-devel libpng10 libpng10-devel gd gd-devel libxml2 libxml2-devel zlib zlib-devel glib2 glib2-devel unzip tar bzip2 bzip2-devel libevent libevent-devel ncurses ncurses-devel curl curl-devel libcurl libcurl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel vim-minimal gettext gettext-devel ncurses-devel gmp-devel pspell-devel unzip libcap diffutils ca-certificates net-tools libc-client-devel psmisc libXpm-devel git-core c-ares-devel libicu-devel libxslt libxslt-devel xz;\ndo yum -y install $packages; done\nmv -f /etc/yum.conf.lnmp /etc/yum.conf\n}\n#\u8bbe\u7f6ecron\u8ba1\u5212\u4efb\u52a1\nCrontab_func(){\n#!/bin/bash\ncat  &lt;&lt;EOF &gt; /var/spool/cron/root\n*/30 * * * * sh /home/cheungssh/mysite/mysite/cheungssh/cheungssh_demo.sh 2&gt;&gt;/home/cheungssh/logs/demo.log  &gt;&gt; /home/cheungssh/logs/demo.log\nEOF\n}\n#\u5224\u65ad\u8fdb\u7a0b\u4fe1\u606f\uff0c\u6740\u6389\u8fdb\u7a0b\nkill_Process(){\nps -fel|grep websocket_server_cheung.py|grep  -v \"$$\"|awk  '{print  $4}'|xargs -i kill  -9 {}\n}\n#\u83b7\u53d6MD5\u503c\nMD5_value(){\nmd5sum /etc/hosts |awk '{print $1}'\n}\ndata_format=\"+%Y-%m-%d %H:%M:%S\"\n#\u8bb0\u5f55\u65e5\u5fd7\u7684function\nfunction fnLogInfo()\n{\nlocal infomsg=$1\necho ${infomsg}\necho `date \"${data_format}\"` \"Info:${infomsg}\" &gt;&gt; ${log_file}\n}\n#scritps path\ndir_path(){\npwd=`dirname $0`\n}\n</code></pre>"},{"location":"Linux/shell/21.DevOps%E4%B8%8B%E7%9A%84Shell%E8%84%9A%E6%9C%AC/#linux\u4e0bfunction\u51fd\u6570\u5e93\u53c2\u8003","title":"Linux\u4e0bfunction\u51fd\u6570\u5e93\u53c2\u8003","text":"<ul>\n<li>\n<p>\u5728cenntos7 \u4e2d <code>/etc/init.d/functions</code> \u662f\u7cfb\u7edf\u81ea\u5e26\u7684\u51fd\u6570\u5e93\u3002</p>\n</li>\n<li>\n<p>\u5728 Ubuntu 20.04 \u4e2d\uff0c\u7c7b\u4f3c\u4e8e <code>/etc/init.d/functions</code> \u7684\u7cfb\u7edf\u81ea\u5e26\u7684\u51fd\u6570\u5e93 functions.sh \u53ef\u4ee5\u5728 <code>/lib/lsb/init-functions</code>\u8def\u5f84\u4e0b\u627e\u5230\u3002</p>\n</li>\n</ul>\n<pre><code>#!/usr/bin/env bash\n# -*-Shell-script-*-\n#\n# functions This file contains functions to be used by most or all\n#       shell scripts in the /etc/init.d directory.\n#\n:&lt;&lt;EOF\ncheckpid():\u68c0\u67e5\u662f\u5426\u5df2\u5b58\u5728pid\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u5b58\u5728\uff0c\u8fd4\u56de0\uff08\u901a\u8fc7\u67e5\u770b/proc\u76ee\u5f55\uff09\ndaemon:\u542f\u52a8\u67d0\u4e2a\u670d\u52a1\u3002/etc/init.d\u76ee\u5f55\u90e8\u5206\u811a\u672c\u7684start\u4f7f\u7528\u5230\u8fd9\u4e2a\nkillproc():\u6740\u6b7b\u67d0\u4e2a\u8fdb\u7a0b\u3002/etc/init.d\u76ee\u5f55\u90e8\u5206\u811a\u672c\u7684stop\u4f7f\u7528\u5230\u8fd9\u4e2a\npidfileofproc():\u5bfb\u627e\u67d0\u4e2a\u8fdb\u7a0b\u7684pid\npidofproc():\u7c7b\u4f3c\u4e0a\u9762\u7684\uff0c\u53ea\u662f\u8fd8\u67e5\u627e\u4e86pidof\u547d\u4ee4\nstatus():\u8fd4\u56de\u4e00\u4e2a\u670d\u52a1\u7684\u72b6\u6001\necho_success():\u6253\u5370OK\necho_failure():\u6253\u5370FAILED\necho_passed():\u6253\u5370PASSED\necho_warning():\u6253\u5370WARNING\nsuccess():\u6253\u5370OK\u5e76\u8bb0\u5f55\u65e5\u5fd7\nfailure():\u6253\u5370FAILED\u5e76\u8bb0\u5f55\u65e5\u5fd7\npassed():\u6253\u5370PASSED\u5e76\u8bb0\u5f55\u65e5\u5fd7\naction():\u6253\u5370\u67d0\u4e2a\u4fe1\u606f\u5e76\u6267\u884c\u7ed9\u5b9a\u7684\u547d\u4ee4\uff0c\u5b83\u4f1a\u6839\u636e\u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u6765\u8c03\u7528 success,failure\u65b9\u6cd5\nstrstr():\u5224\u65ad$1\u662f\u5426\u542b\u6709$2\nconfirm:\u663e\u793a \u201cStart service $1 (Y)es/(N)o/(C)ontinue? [Y]\u201c\u7684\u63d0\u793a\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u9009\u62e9\u7ed3\u679c\nis_ignored_file():\u68c0\u67e5$1\u6587\u4ef6\u662f\u5426\u662f*.bak\u3001*.orig\u3001*.rpmnew....\u7b49\u6587\u4ef6\nis_true()/is_false():\u4ea4\u4e92\u5f0fyes|no\u7684\u9009\u9879\napply_sysctl()\u5e94\u7528sysctl\u8bbe\u7f6e\uff0c\u5305\u62ec/etc/sysctl.d\u4e2d\u7684\u6587\u4ef6\nEOF\nTEXTDOMAIN=initscripts\n\n# Make sure umask is sane\numask 022\n# Set up a default search path.\nPATH=\"/sbin:/usr/sbin:/bin:/usr/bin\"\n#\u5bfc\u51fa\u73af\u5883\u53d8\u91cf\nexport PATH\n\n#\u5224\u65adPPID\u548c\u5b57\u7b26\u4e32\u5426\u4e3a\u7a7a\nif [ $PPID -ne 1 -a -z \"$SYSTEMCTL_SKIP_REDIRECT\" ] &amp;&amp; \\\n[ -d /run/systemd/system ] ; then\ncase \"$0\" in\n/etc/init.d/*|/etc/rc.d/init.d/*)\n_use_systemctl=1\n;;\nesac\nfi\nsystemctl_redirect () {\nlocal s\n    local prog=${1##*/}\nlocal command=$2\nlocal options=\"\"\ncase \"$command\" in\nstart)\ns=$\"Starting $prog (via systemctl): \"\n;;\nstop)\ns=$\"Stopping $prog (via systemctl): \"\n;;\nreload|try-reload)\ns=$\"Reloading $prog configuration (via systemctl): \"\n;;\nrestart|try-restart|condrestart)\ns=$\"Restarting $prog (via systemctl): \"\n;;\nesac\nif [ -n \"$SYSTEMCTL_IGNORE_DEPENDENCIES\" ] ; then\noptions=\"--ignore-dependencies\"\nfi\nif ! systemctl show \"$prog.service\" &gt; /dev/null 2&gt;&amp;1 || \\\nsystemctl show -p LoadState \"$prog.service\" | grep -q 'not-found' ; then\naction $\"Reloading systemd: \" /bin/systemctl daemon-reload\n    fi\naction \"$s\" /bin/systemctl $options $command \"$prog.service\"\n}\n# Get a sane screen width\n[ -z \"${COLUMNS:-}\" ] &amp;&amp; COLUMNS=80\nif [ -z \"${CONSOLETYPE:-}\" ]; then\nif [ -c \"/dev/stderr\" -a -r \"/dev/stderr\" ]; then\nCONSOLETYPE=\"$(/sbin/consoletype &lt; /dev/stderr 2&gt;/dev/null)\"\nelse\nCONSOLETYPE=\"serial\"\nfi\nfi\nif [ -z \"${NOLOCALE:-}\" ] &amp;&amp; [ -z \"${LANGSH_SOURCED:-}\" ] &amp;&amp; \\\n[ -f /etc/sysconfig/i18n -o -f /etc/locale.conf ] ; then\n. /etc/profile.d/lang.sh 2&gt;/dev/null\n    # avoid propagating LANGSH_SOURCED any further\nunset LANGSH_SOURCED\nfi\n# Read in our configuration\nif [ -z \"${BOOTUP:-}\" ]; then\nif [ -f /etc/sysconfig/init ]; then\n. /etc/sysconfig/init\n    else\n# This all seem confusing? Look in /etc/sysconfig/init,\n# or in /usr/share/doc/initscripts-*/sysconfig.txt\nBOOTUP=color\n        RES_COL=60\nMOVE_TO_COL=\"echo -en \\\\033[${RES_COL}G\"\nSETCOLOR_SUCCESS=\"echo -en \\\\033[1;32m\"\nSETCOLOR_FAILURE=\"echo -en \\\\033[1;31m\"\nSETCOLOR_WARNING=\"echo -en \\\\033[1;33m\"\nSETCOLOR_NORMAL=\"echo -en \\\\033[0;39m\"\nLOGLEVEL=1\nfi\nif [ \"$CONSOLETYPE\" = \"serial\" ]; then\nBOOTUP=serial\n        MOVE_TO_COL=\nSETCOLOR_SUCCESS=\nSETCOLOR_FAILURE=\nSETCOLOR_WARNING=\nSETCOLOR_NORMAL=\nfi\nfi\n# Check if any of $pid (could be plural) are running\ncheckpid() {\nlocal i\n\nfor i in $* ; do\n[ -d \"/proc/$i\" ] &amp;&amp; return 0\ndone\nreturn 1\n}\n__kill_pids_term_kill_checkpids() {\nlocal base_stime=$1\nshift 1\nlocal pid=\nlocal pids=$*\nlocal remaining=\nlocal stat=\nlocal stime=\nfor pid in $pids ; do\n[ ! -e  \"/proc/$pid\" ] &amp;&amp; continue\nread -r line &lt; \"/proc/$pid/stat\" 2&gt; /dev/null\n\nstat=($line)\nstime=${stat[21]}\n[ -n \"$stime\" ] &amp;&amp; [ \"$base_stime\" -lt \"$stime\" ] &amp;&amp; continue\nremaining+=\"$pid \"\ndone\necho \"$remaining\"\n[ -n \"$remaining\" ] &amp;&amp; return 1\nreturn 0\n}\n__kill_pids_term_kill() {\nlocal try=0\nlocal delay=3;\nlocal pid=\nlocal stat=($(&lt; /proc/self/stat))\nlocal base_stime=${stat[21]}\nif [ \"$1\" = \"-d\" ]; then\ndelay=$2\nshift 2\nfi\nlocal kill_list=$*\nkill_list=$(__kill_pids_term_kill_checkpids $base_stime $kill_list)\n[ -z \"$kill_list\" ] &amp;&amp; return 0\nkill -TERM $kill_list &gt;/dev/null 2&gt;&amp;1\nusleep 100000\nkill_list=$(__kill_pids_term_kill_checkpids $base_stime $kill_list)\nif [ -n \"$kill_list\" ] ; then\nwhile [ $try -lt $delay ] ; do\nsleep 1\nkill_list=$(__kill_pids_term_kill_checkpids $base_stime $kill_list)\n[ -z \"$kill_list\" ] &amp;&amp; break\nlet try+=1\ndone\nif [ -n \"$kill_list\" ] ; then\nkill -KILL $kill_list &gt;/dev/null 2&gt;&amp;1\nusleep 100000\nkill_list=$(__kill_pids_term_kill_checkpids $base_stime $kill_list)\nfi\nfi\n[ -n \"$kill_list\" ] &amp;&amp; return 1\nreturn 0\n}\n# __proc_pids {program} [pidfile]\n# Set $pid to pids from /var/run* for {program}.  $pid should be declared\n# local in the caller.\n# Returns LSB exit code for the 'status' action.\n__pids_var_run() {\nlocal base=${1##*/}\nlocal pid_file=${2:-/var/run/$base.pid}\nlocal pid_dir=$(/usr/bin/dirname $pid_file &gt; /dev/null)\nlocal binary=$3\n[ -d \"$pid_dir\" -a ! -r \"$pid_dir\" ] &amp;&amp; return 4\npid=\nif [ -f \"$pid_file\" ] ; then\nlocal line p\n\n[ ! -r \"$pid_file\" ] &amp;&amp; return 4 # \"user had insufficient privilege\"\nwhile : ; do\nread line\n            [ -z \"$line\" ] &amp;&amp; break\nfor p in $line ; do\nif [ -z \"${p//[0-9]/}\" ] &amp;&amp; [ -d \"/proc/$p\" ] ; then\nif [ -n \"$binary\" ] ; then\nlocal b=$(readlink /proc/$p/exe | sed -e 's/\\s*(deleted)$//')\n[ \"$b\" != \"$binary\" ] &amp;&amp; continue\nfi\npid=\"$pid $p\"\nfi\ndone\ndone &lt; \"$pid_file\"\nif [ -n \"$pid\" ]; then\nreturn 0\nfi\nreturn 1 # \"Program is dead and /var/run pid file exists\"\nfi\nreturn 3 # \"Program is not running\"\n}\n# Output PIDs of matching processes, found using pidof\n__pids_pidof() {\npidof -c -m -o $$ -o $PPID -o %PPID -x \"$1\" || \\\npidof -c -m -o $$ -o $PPID -o %PPID -x \"${1##*/}\"\n}\n# A function to start a program.\ndaemon() {\n# Test syntax.\nlocal gotbase= force= nicelevel corelimit\n    local pid base= user= nice= bg= pid_file=\nlocal cgroup=\nnicelevel=0\nwhile [ \"$1\" != \"${1##[-+]}\" ]; do\ncase $1 in\n'')\necho $\"$0: Usage: daemon [+/-nicelevel] {program}\" \"[arg1]...\"\nreturn 1\n;;\n--check)\nbase=$2\ngotbase=\"yes\"\nshift 2\n;;\n--check=?*)\nbase=${1#--check=}\ngotbase=\"yes\"\nshift\n;;\n--user)\nuser=$2\nshift 2\n;;\n--user=?*)\nuser=${1#--user=}\nshift\n;;\n--pidfile)\npid_file=$2\nshift 2\n;;\n--pidfile=?*)\npid_file=${1#--pidfile=}\nshift\n;;\n--force)\nforce=\"force\"\nshift\n;;\n[-+][0-9]*)\nnice=\"nice -n $1\"\nshift\n;;\n*)\necho $\"$0: Usage: daemon [+/-nicelevel] {program}\" \"[arg1]...\"\nreturn 1\n;;\nesac\ndone\n# Save basename.\n[ -z \"$gotbase\" ] &amp;&amp; base=${1##*/}\n# See if it's already running. Look *only* at the pid file.\n__pids_var_run \"$base\" \"$pid_file\"\n[ -n \"$pid\" -a -z \"$force\" ] &amp;&amp; return\n# make sure it doesn't core dump anywhere unless requested\ncorelimit=\"ulimit -S -c ${DAEMON_COREFILE_LIMIT:-0}\"\n# if they set NICELEVEL in /etc/sysconfig/foo, honor it\n[ -n \"${NICELEVEL:-}\" ] &amp;&amp; nice=\"nice -n $NICELEVEL\"\n# if they set CGROUP_DAEMON in /etc/sysconfig/foo, honor it\nif [ -n \"${CGROUP_DAEMON}\" ]; then\nif [ ! -x /bin/cgexec ]; then\necho -n \"Cgroups not installed\"; warning\n            echo\nelse\ncgroup=\"/bin/cgexec\";\nfor i in $CGROUP_DAEMON; do\ncgroup=\"$cgroup -g $i\";\ndone\nfi\nfi\n# Echo daemon\n[ \"${BOOTUP:-}\" = \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo -n \" $base\"\n# And start it up.\nif [ -z \"$user\" ]; then\n$cgroup $nice /bin/bash -c \"$corelimit &gt;/dev/null 2&gt;&amp;1 ; $*\"\nelse\n$cgroup $nice runuser -s /bin/bash $user -c \"$corelimit &gt;/dev/null 2&gt;&amp;1 ; $*\"\nfi\n[ \"$?\" -eq 0 ] &amp;&amp; success $\"$base startup\" || failure $\"$base startup\"\n}\n# A function to stop a program.\nkillproc() {\nlocal RC killlevel= base pid pid_file= delay try binary=\nRC=0; delay=3; try=0\n# Test syntax.\nif [ \"$#\" -eq 0 ]; then\necho $\"Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]\"\nreturn 1\nfi\nif [ \"$1\" = \"-p\" ]; then\npid_file=$2\nshift 2\nfi\nif [ \"$1\" = \"-b\" ]; then\nif [ -z $pid_file ]; then\necho $\"-b option can be used only with -p\"\necho $\"Usage: killproc -p pidfile -b binary program\"\nreturn 1\nfi\nbinary=$2\nshift 2\nfi\nif [ \"$1\" = \"-d\" ]; then\ndelay=$(echo $2 | awk -v RS=' ' -v IGNORECASE=1 '{if($1!~/^[0-9.]+[smhd]?$/) exit 1;d=$1~/s$|^[0-9.]*$/?1:$1~/m$/?60:$1~/h$/?60*60:$1~/d$/?24*60*60:-1;if(d==-1) exit 1;delay+=d*$1} END {printf(\"%d\",delay+0.5)}')\nif [ \"$?\" -eq 1 ]; then\necho $\"Usage: killproc [-p pidfile] [ -d delay] {program} [-signal]\"\nreturn 1\nfi\nshift 2\nfi\n# check for second arg to be kill level\n[ -n \"${2:-}\" ] &amp;&amp; killlevel=$2\n# Save basename.\nbase=${1##*/}\n# Find pid.\n__pids_var_run \"$1\" \"$pid_file\" \"$binary\"\nRC=$?\nif [ -z \"$pid\" ]; then\nif [ -z \"$pid_file\" ]; then\npid=\"$(__pids_pidof \"$1\")\"\nelse\n[ \"$RC\" = \"4\" ] &amp;&amp; { failure $\"$base shutdown\" ; return $RC ;}\nfi\nfi\n# Kill it.\nif [ -n \"$pid\" ] ; then\n[ \"$BOOTUP\" = \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo -n \"$base \"\nif [ -z \"$killlevel\" ] ; then\n__kill_pids_term_kill -d $delay $pid\nRC=$?\n[ \"$RC\" -eq 0 ] &amp;&amp; success $\"$base shutdown\" || failure $\"$base shutdown\"\n# use specified level only\nelse\nif checkpid $pid; then\nkill $killlevel $pid &gt;/dev/null 2&gt;&amp;1\nRC=$?\n[ \"$RC\" -eq 0 ] &amp;&amp; success $\"$base $killlevel\" || failure $\"$base $killlevel\"\nelif [ -n \"${LSB:-}\" ]; then\nRC=7 # Program is not running\nfi\nfi\nelse\nif [ -n \"${LSB:-}\" -a -n \"$killlevel\" ]; then\nRC=7 # Program is not running\nelse\nfailure $\"$base shutdown\"\nRC=0\nfi\nfi\n# Remove pid file if any.\nif [ -z \"$killlevel\" ]; then\nrm -f \"${pid_file:-/var/run/$base.pid}\"\nfi\nreturn $RC\n}\n# A function to find the pid of a program. Looks *only* at the pidfile\npidfileofproc() {\nlocal pid\n\n# Test syntax.\nif [ \"$#\" = 0 ] ; then\necho $\"Usage: pidfileofproc {program}\"\nreturn 1\nfi\n__pids_var_run \"$1\"\n[ -n \"$pid\" ] &amp;&amp; echo $pid\nreturn 0\n}\n# A function to find the pid of a program.\npidofproc() {\nlocal RC pid pid_file=\n# Test syntax.\nif [ \"$#\" = 0 ]; then\necho $\"Usage: pidofproc [-p pidfile] {program}\"\nreturn 1\nfi\nif [ \"$1\" = \"-p\" ]; then\npid_file=$2\nshift 2\nfi\nfail_code=3 # \"Program is not running\"\n# First try \"/var/run/*.pid\" files\n__pids_var_run \"$1\" \"$pid_file\"\nRC=$?\nif [ -n \"$pid\" ]; then\necho $pid\nreturn 0\nfi\n[ -n \"$pid_file\" ] &amp;&amp; return $RC\n__pids_pidof \"$1\" || return $RC\n}\nstatus() {\nlocal base pid lock_file= pid_file= binary=\n# Test syntax.\nif [ \"$#\" = 0 ] ; then\necho $\"Usage: status [-p pidfile] {program}\"\nreturn 1\nfi\nif [ \"$1\" = \"-p\" ]; then\npid_file=$2\nshift 2\nfi\nif [ \"$1\" = \"-l\" ]; then\nlock_file=$2\nshift 2\nfi\nif [ \"$1\" = \"-b\" ]; then\nif [ -z $pid_file ]; then\necho $\"-b option can be used only with -p\"\necho $\"Usage: status -p pidfile -b binary program\"\nreturn 1\nfi\nbinary=$2\nshift 2\nfi\nbase=${1##*/}\nif [ \"$_use_systemctl\" = \"1\" ]; then\nsystemctl status ${0##*/}.service\n        ret=$?\n# LSB daemons that dies abnormally in systemd looks alive in systemd's eyes due to RemainAfterExit=yes\n# lets adjust the reality a little bit\nif systemctl show -p ActiveState ${0##*/}.service | grep -q '=active$' &amp;&amp; \\\nsystemctl show -p SubState ${0##*/}.service | grep -q '=exited$' ; then\nret=3\nfi\nreturn $ret\nfi\n# First try \"pidof\"\n__pids_var_run \"$1\" \"$pid_file\" \"$binary\"\nRC=$?\nif [ -z \"$pid_file\" -a -z \"$pid\" ]; then\npid=\"$(__pids_pidof \"$1\")\"\nfi\nif [ -n \"$pid\" ]; then\necho $\"${base} (pid $pid) is running...\"\nreturn 0\nfi\ncase \"$RC\" in\n0)\necho $\"${base} (pid $pid) is running...\"\nreturn 0\n;;\n1)\necho $\"${base} dead but pid file exists\"\nreturn 1\n;;\n4)\necho $\"${base} status unknown due to insufficient privileges.\"\nreturn 4\n;;\nesac\nif [ -z \"${lock_file}\" ]; then\nlock_file=${base}\nfi\n# See if /var/lock/subsys/${lock_file} exists\nif [ -f /var/lock/subsys/${lock_file} ]; then\necho $\"${base} dead but subsys locked\"\nreturn 2\nfi\necho $\"${base} is stopped\"\nreturn 3\n}\necho_success() {\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $MOVE_TO_COL\necho -n \"[\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_SUCCESS\necho -n $\"  OK  \"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_NORMAL\necho -n \"]\"\necho -ne \"\\r\"\nreturn 0\n}\necho_failure() {\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $MOVE_TO_COL\necho -n \"[\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_FAILURE\necho -n $\"FAILED\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_NORMAL\necho -n \"]\"\necho -ne \"\\r\"\nreturn 1\n}\necho_passed() {\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $MOVE_TO_COL\necho -n \"[\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_WARNING\necho -n $\"PASSED\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_NORMAL\necho -n \"]\"\necho -ne \"\\r\"\nreturn 1\n}\necho_warning() {\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $MOVE_TO_COL\necho -n \"[\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_WARNING\necho -n $\"WARNING\"\n[ \"$BOOTUP\" = \"color\" ] &amp;&amp; $SETCOLOR_NORMAL\necho -n \"]\"\necho -ne \"\\r\"\nreturn 1\n}\n# Inform the graphical boot of our current state\nupdate_boot_stage() {\nif [ -x /bin/plymouth ]; then\n/bin/plymouth --update=\"$1\"\nfi\nreturn 0\n}\n# Log that something succeeded\nsuccess() {\n[ \"$BOOTUP\" != \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo_success\n    return 0\n}\n# Log that something failed\nfailure() {\nlocal rc=$?\n[ \"$BOOTUP\" != \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo_failure\n    [ -x /bin/plymouth ] &amp;&amp; /bin/plymouth --details\n    return $rc\n}\n# Log that something passed, but may have had errors. Useful for fsck\npassed() {\nlocal rc=$?\n[ \"$BOOTUP\" != \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo_passed\n    return $rc\n}\n# Log a warning\nwarning() {\nlocal rc=$?\n[ \"$BOOTUP\" != \"verbose\" -a -z \"${LSB:-}\" ] &amp;&amp; echo_warning\n    return $rc\n}\n# Run some action. Log its output.\naction() {\nlocal STRING rc\n\nSTRING=$1\necho -n \"$STRING \"\nshift\n\"$@\" &amp;&amp; success $\"$STRING\" || failure $\"$STRING\"\nrc=$?\necho\nreturn $rc\n}\n# returns OK if $1 contains $2\nstrstr() {\n[ \"${1#*$2*}\" = \"$1\" ] &amp;&amp; return 1\nreturn 0\n}\n# Check whether file $1 is a backup or rpm-generated file and should be ignored\nis_ignored_file() {\ncase \"$1\" in\n*~ | *.bak | *.orig | *.rpmnew | *.rpmorig | *.rpmsave)\nreturn 0\n;;\nesac\nreturn 1\n}\n# Evaluate shvar-style booleans\nis_true() {\ncase \"$1\" in\n[tT] | [yY] | [yY][eE][sS] | [tT][rR][uU][eE] | 1)\nreturn 0\n;;\nesac\nreturn 1\n}\n# Evaluate shvar-style booleans\nis_false() {\ncase \"$1\" in\n[fF] | [nN] | [nN][oO] | [fF][aA][lL][sS][eE] | 0)\nreturn 0\n;;\nesac\nreturn 1\n}\n# Apply sysctl settings, including files in /etc/sysctl.d\napply_sysctl() {\nif [ -x /lib/systemd/systemd-sysctl ]; then\n/lib/systemd/systemd-sysctl\n    else\nfor file in /usr/lib/sysctl.d/*.conf ; do\nis_ignored_file \"$file\" &amp;&amp; continue\n[ -f /run/sysctl.d/${file##*/} ] &amp;&amp; continue\n[ -f /etc/sysctl.d/${file##*/} ] &amp;&amp; continue\ntest -f \"$file\" &amp;&amp; sysctl -e -p \"$file\" &gt;/dev/null 2&gt;&amp;1\ndone\nfor file in /run/sysctl.d/*.conf ; do\nis_ignored_file \"$file\" &amp;&amp; continue\n[ -f /etc/sysctl.d/${file##*/} ] &amp;&amp; continue\ntest -f \"$file\" &amp;&amp; sysctl -e -p \"$file\" &gt;/dev/null 2&gt;&amp;1\ndone\nfor file in /etc/sysctl.d/*.conf ; do\nis_ignored_file \"$file\" &amp;&amp; continue\ntest -f \"$file\" &amp;&amp; sysctl -e -p \"$file\" &gt;/dev/null 2&gt;&amp;1\ndone\nsysctl -e -p /etc/sysctl.conf &gt;/dev/null 2&gt;&amp;1\nfi\n}\n# A sed expression to filter out the files that is_ignored_file recognizes\n__sed_discard_ignored_files='/\\(~\\|\\.bak\\|\\.orig\\|\\.rpmnew\\|\\.rpmorig\\|\\.rpmsave\\)$/d'\nif [ \"$_use_systemctl\" = \"1\" ]; then\nif  [ \"x$1\" = xstart -o \\\n\"x$1\" = xstop -o \\\n\"x$1\" = xrestart -o \\\n\"x$1\" = xreload -o \\\n\"x$1\" = xtry-restart -o \\\n\"x$1\" = xforce-reload -o \\\n\"x$1\" = xcondrestart ] ; then\nsystemctl_redirect $0 $1\nexit $?\nfi\nfi\nstrstr \"$(cat /proc/cmdline)\" \"rc.debug\" &amp;&amp; set -x\nreturn 0\n</code></pre>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/","title":"3.Shell \u53c2\u6570","text":""},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#1-shell-\u53c2\u6570\u6982\u8ff0","title":"1. Shell \u53c2\u6570\u6982\u8ff0","text":"<p>\u5728 Shell \u811a\u672c\u7f16\u5199\u4e2d\uff0c\u6211\u4eec\u4e3a\u4e86\u4f7f\u5f97\u7a0b\u5e8f\u7075\u6d3b\u548c\u65e0\u72b6\u6001\uff0c\u6709\u4e9b\u53d8\u91cf\u6211\u4eec\u4e0d\u4fbf\u4e8e\u5728\u811a\u672c\u4e2d\u5199\u6b7b\uff0c\u9700\u8981\u8fd0\u7528\u5916\u90e8\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c\u6bcf\u6b21\u4f20\u9012\u7684\u4e1c\u897f\u4e0d\u4e00\u6837\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e5f\u4e0d\u5c3d\u76f8\u540c\uff0c\u53c2\u6570\u662f\u4e0e\u53d8\u91cf\u76f8\u8f85\u76f8\u6210\u7684\uff0c\u5c06\u53c2\u6570\u4f20\u9012\u8fdb Shell \u811a\u672c\u4e2d\uff0c\u4e5f\u5c31\u6210\u4e86\u53d8\u91cf\uff0c\u53c2\u6570\u7684\u4f7f\u7528\u4f7f\u5f97\u6211\u4eec\u7684\u811a\u672c\u66f4\u52a0\u7684\u7075\u6d3b\u548c\u53ef\u6269\u5c55\uff0c\u540c\u6837\u4e5f\u66f4\u6613\u7ef4\u62a4\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#11-shell-\u53c2\u6570\u662f\u4ec0\u4e48","title":"1.1 Shell \u53c2\u6570\u662f\u4ec0\u4e48","text":"<p>Shell \u53c2\u6570\u662f\u6211\u4eec\u5728\u811a\u672c\u6587\u4ef6\u5916\u90e8\u4f20\u5165\u7684\u4e00\u7cfb\u5217\u53c2\u6570\uff0c\u6216\u662f\u5728 Shell \u811a\u672c\u4e2d\u7ed9\u51fd\u6570\u4f20\u9012\u7684\u53c2\u6570\uff0c\u5176\u5b9e\u8d28\u4e5f\u5c31\u662f\u4e0a\u4e00\u8282\u6211\u4eec\u5b66\u4e60\u7684\u53d8\u91cf\uff0c\u5176\u4e0e\u53d8\u91cf\u76f8\u8f85\u76f8\u6210\uff0c\u5171\u540c\u7ec4\u6210 Shell \u811a\u672c\u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u53c2\u6570","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u53c2\u6570","text":"<p>\u6211\u4eec\u5728\u53d8\u91cf\u4e00\u8282\u77e5\u9053\u4e86\u4e3a\u4ec0\u4e48\u5229\u7528\u53d8\u91cf\uff0c\u5728\u6b64\u539f\u56e0\u4e0e\u53d8\u91cf\u7c7b\u4f3c\uff0c\u53c2\u6570\u7684\u4f7f\u7528\u4f7f\u5f97\u6211\u4eec\u7684 Shell \u811a\u672c\u66f4\u52a0\u7075\u6d3b\uff0c\u4e0d\u9700\u8981\u5728\u811a\u672c\u4e2d\u5199\u6b7b\u4e00\u4e9b\u540d\u79f0\uff0c\u6839\u636e\u7528\u6237\u7684\u8f93\u51fa\u5b8c\u6210\u7279\u5b9a\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u7f16\u5199\u811a\u672c\u8ba1\u7b97 100 \u5185\u6570\u5b57\u7684\u548c\uff0c\u4f46\u662f\u5982\u679c\u4e3a\u4eec\u60f3\u8ba1\u7b97 1000 \u5462\uff1f100000 \u5462\uff1f\u6bcf\u6b21\u90fd\u9700\u8981\u4fee\u6539\u811a\u672c\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u53c2\u6570\u4f20\u9012\u8fdb\u8ba1\u7b97\u811a\u672c\u4e2d\uff0c\u8fd9\u6837\u9700\u8981\u8ba1\u7b97\u591a\u5c11\u5c31\u53c8\u6211\u4eec\u81ea\u5df1\u63a7\u5236\uff0c\u8fd9\u6837\u7684\u811a\u672c\u4e5f\u66f4\u52a0\u7075\u6d3b\uff0c\u53c2\u6570\u8d4b\u4e88\u811a\u672c\u66f4\u5f3a\u5927\u7684\u529f\u80fd\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#2-shell-\u53c2\u6570\u5206\u7c7b","title":"2. Shell \u53c2\u6570\u5206\u7c7b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 Shell \u4e2d\u53c2\u6570\u662f\u4ec0\u4e48\uff0c\u6765\u770b\u4e00\u4e0b Shell \u811a\u672c\u4e2d\u53c2\u6570\u7684\u5206\u7c7b\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#21-\u4f4d\u7f6e\u53c2\u6570","title":"2.1 \u4f4d\u7f6e\u53c2\u6570","text":"<p>\u4f4d\u7f6e\u53c2\u6570\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u4f20\u9012\u7ed9\u811a\u672c\u53c2\u6570\u7684\u4f4d\u7f6e\uff0c\u4f8b\u5982\u7ed9\u4e00\u4e2a\u811a\u672c\u4f20\u9012\u4e00\u4e2a\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 Shell \u811a\u672c\u5185\u90e8\u83b7\u53d6\u4f20\u5165\u7684\u4f4d\u7f6e\u53c2\u6570\uff0c\u83b7\u53d6\u53c2\u6570\u7684\u683c\u5f0f\u4e3a\uff1a<code>$n</code>\u3002n \u4ee3\u8868\u4e00\u4e2a\u6570\u5b57\u3002\u4f8b\u5982\u4f20\u9012\u7ed9\u811a\u672c\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u4e3a <code>$1</code>\uff0c\u7b2c 2 \u4e2a\u53c2\u6570\u5c31\u4e3a <code>$2</code>, \u4ee5\u6b64\u7c7b\u63a8\u2026\u2026\uff0c\u5176\u4e2d <code>$0</code> \u4e3a\u8be5\u811a\u672c\u7684\u540d\u79f0\u3002</p> <p>\u5728\u6211\u4eec\u8bb2\u89e3\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u53d8\u91cf\u7684\u4e00\u6761\u89c4\u8303\u5c31\u662f\u540d\u5b57\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934\uff0c\u5728\u6b64\u5c31\u662f\u4e3a\u4e86\u907f\u514d\u4e0e Shell \u7684\u4f4d\u7f6e\u53c2\u6570\u76f8\u540c\u5f15\u53d1\u5f02\u5e38\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell_args]# cat args1.sh \n#!/bin/bash\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: $1\"\necho \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: $2\"\necho \"\u811a\u672c\u540d\u79f0\u4e3a: $0\"\n[root@master Shell_args]# bash args1.sh Shell linux\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: Shell\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: linux\n\u811a\u672c\u540d\u79f0\u4e3a: args1.sh\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4f20\u9012\u7ed9 <code>args1.sh</code> \u811a\u672c\u4e24\u4e2a\u4f4d\u7f6e\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u4e3a <code>python</code>, \u7b2c\u4e8c\u4e2a\u4e3a <code>go</code>, \u811a\u672c\u540d\u79f0\u4e3a <code>args1.sh</code></p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#22-\u7279\u6b8a\u53c2\u6570","title":"2.2 \u7279\u6b8a\u53c2\u6570","text":"<p>\u5728 Shell \u4e2d\u4e5f\u5b58\u5728\u7279\u6b8a\u542b\u4e49\u7684\u53c2\u6570\u5982\u4e0b\u8868\uff1a</p> \u53d8\u91cf \u542b\u4e49 $# \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u53c2\u6570\u4e2a\u6570\u603b\u548c $* \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6240\u6709\u7684\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u4e00\u4e2a\u5b57\u7b26\u4e32 $@ \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u72ec\u7acb\u7684\u5b57\u7b26\u4e32 $? \u4e0a\u4e2a\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\uff0c\u6216\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c0 \u4e3a\u6267\u884c\u6210\u529f\uff0c\u975e 0 \u5219\u4e3a\u6267\u884c\u5931\u8d25 $$ \u5f53\u524d Shell \u8fdb\u7a0b ID\u3002\u5bf9\u4e8e Shell \u811a\u672c\uff0c\u5c31\u662f\u8fd9\u4e9b\u811a\u672c\u6240\u5728\u7684\u8fdb\u7a0b ID\u3002 <p>\u793a\u4f8b\uff1a</p> <pre><code>[root@master Shell_args]# cat args2.sh                 \n#!/bin/bash\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: $1\"\necho \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: $2\"\necho \"\u811a\u672c\u540d\u79f0\u4e3a: $0\"\necho \"\u811a\u672c\u63a5\u53d7\u53c2\u6570\u603b\u6570\u4e3a: $#\"\ncurl -I baidu.com\necho \"\u8fd0\u884c\u547d\u4ee4\u7684\u72b6\u6001\u4e3a:$?\"\necho \"\u811a\u672c\u7684ID\u4e3a:$$\"\necho \"\\$*\u7684\u7ed3\u679c\u4e3a:$*\"\necho \"\\$@\u7684\u7ed3\u679c\u4e3a:$@\"\nfor i in \"$*\";\ndo\necho $i\ndone\nfor j in \"$@\";\ndo echo $j\ndone\n# \u8fd0\u884c\u811a\u672c\u6765\u8fdb\u884c\u6d4b\u8bd5\n[root@master Shell_args]# bash args2.sh go python Shell\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: go\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: python\n\u811a\u672c\u540d\u79f0\u4e3a: args2.sh\n\u811a\u672c\u63a5\u53d7\u53c2\u6570\u603b\u6570\u4e3a: 3\nHTTP/1.1 200 OK\nDate: Sun, 08 Mar 2020 07:32:22 GMT\nServer: Apache\nLast-Modified: Tue, 12 Jan 2010 13:48:00 GMT\nETag: \"51-47cf7e6ee8400\"\nAccept-Ranges: bytes\nContent-Length: 81\nCache-Control: max-age=86400\nExpires: Mon, 09 Mar 2020 07:32:22 GMT\nConnection: Keep-Alive\nContent-Type: text/html\n\n\u8fd0\u884c\u547d\u4ee4\u7684\u72b6\u6001\u4e3a:0\n\u811a\u672c\u7684ID\u4e3a:23333\n$*\u7684\u7ed3\u679c\u4e3a:go python Shell\n$@\u7684\u7ed3\u679c\u4e3a:go python Shell\ngo python Shell\ngo\npython\nShell\n</code></pre> <p>\u6211\u4eec\u80fd\u591f\u901a\u8fc7\u4e0a\u8ff0\u4f8b\u5b50\u770b\u51fa\uff0c\u8fd0\u884c <code>curl -I baidu.com</code> \u7684\u8f93\u51fa\u4e3a 0\uff0c\u5373\u4e3a\u547d\u4ee4\u8fd0\u884c\u6b63\u5e38\uff0c\u83b7\u53d6\u5230\u4e86\u6b63\u5e38\u7684\u8fd4\u56de\u503c\uff1b</p> <p><code>$@</code>\u4e0e <code>$*</code> \u770b\u4e0a\u53bb\u5f88\u50cf\uff0c\u90fd\u662f\u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff1b</p> <p><code>$*</code> \u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6240\u6709\u7684\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u7528 for \u5faa\u73af\u904d\u5386\u7684\u65f6\u5019\u53ef\u4ee5\u770b\u5230\u8f93\u51fa\u4e3a\u4e00\u884c\uff1b</p> <p><code>$@</code>\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u72ec\u7acb\u7684\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u7528 for \u5faa\u73af\u904d\u5386\u7684\u65f6\u5019\u53ef\u4ee5\u770b\u5230\u4e3a\u6bcf\u4e2a\u5b57\u7b26\u4e32\u8f93\u51fa\u4e3a\u5355\u72ec\u7684\u4e00\u884c\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#3-shell-\u53c2\u6570\u7684\u4f7f\u7528","title":"3. Shell \u53c2\u6570\u7684\u4f7f\u7528","text":""},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#31-\u811a\u672c\u4f20\u9012","title":"3.1 \u811a\u672c\u4f20\u9012","text":"<p>\u811a\u672c\u4f20\u9012\u53c2\u6570\uff0c\u5c31\u662f\u5728\u8fd0\u884c\u811a\u672c\u7684\u65f6\u5019\u901a\u8fc7\u4f4d\u7f6e\u53c2\u6570\u4f20\u9012\u8fdb\u811a\u672c\u5185\uff0c\u6bcf\u4e2a\u53c2\u6570\u5229\u7528\u4e00\u4e2a\u7a7a\u683c\u6765\u8fdb\u884c\u5206\u5272\uff0c\u5982\u679c\u4f20\u9012\u7684\u53c2\u6570\u672c\u8eab\u5c31\u6709\u7a7a\u683c\uff0c\u5219\u53ef\u4ee5\u5229\u7528 <code>\"\"</code> \u6765\u5f15\u8d77\u6765\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u4f20\u9012\uff0c\u5728\u811a\u672c\u5185\u901a\u8fc7 <code>$n</code> \u6765\u83b7\u53d6\u3002</p> <pre><code>[root@master Shell_args]# cat args1.sh \n#!/bin/bash\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: $1\"\necho \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: $2\"\necho \"\u811a\u672c\u540d\u79f0\u4e3a: $0\"\n[root@master Shell_args]# bash args1.sh go \"python Shell java\"\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: go\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: python Shell java\n\u811a\u672c\u540d\u79f0\u4e3a: args1.sh\n</code></pre> <p>\u4f8b\u5982\u6211\u4eec\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u4e00\u4e2a\u5e26\u6709\u7a7a\u683c\u7684\u591a\u4e2a\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\u4f5c\u4e3a\u4e00\u4e2a\u4f4d\u7f6e\u53c2\u6570\u8fdb\u884c\u4f20\u5165\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#32-\u51fd\u6570\u4f20\u9012","title":"3.2 \u51fd\u6570\u4f20\u9012","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u53c2\u6570\u4f20\u9012\u5c31\u662f\u5728\u51fd\u6570\u5916\u90e8\u8fdb\u884c\u53c2\u6570\u7684\u4f20\u5165\uff0c\u7531\u4e8e\u51fd\u6570\u90e8\u5206\u5728\u540e\u7eed\u6709\u4e13\u95e8\u7ae0\u8282\u8be6\u89e3\uff0c\u5728\u6b64\u6211\u4eec\u5c31\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\u8fdb\u884c\u8bf4\u660e\u3002\u51fd\u6570\u4f20\u9012\u4e0e\u811a\u672c\u4f20\u9012\u975e\u5e38\u7c7b\u4f3c\uff0c\u53ea\u662f\u5728\u8c03\u7528\u51fd\u6570\u7684\u65f6\u5019\u8fdb\u884c\u4f20\u9012\u4f4d\u7f6e\u53c2\u6570\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell_args]# cat args_fun.sh \n#!/bin/bash\n# \u51fd\u6570\u5b9a\u4e49\nfunction show_args() {\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: $1\"\necho \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: $2\"\necho \"\u811a\u672c\u540d\u79f0\u4e3a: $0\"\n}\n# \u51fd\u6570\u8c03\u7528\nshow_args go Shell\n[root@master Shell_args]# bash args_fun.sh \n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: go\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: Shell\n\u811a\u672c\u540d\u79f0\u4e3a: args_fun.sh\n</code></pre> <p>\u5728\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6ca1\u6709\u901a\u8fc7\u5728\u811a\u672c\u5916\u90e8\u8fdb\u884c\u53c2\u6570\u4f20\u9012\uff0c\u800c\u662f\u5728\u8c03\u7528 <code>show_args</code> \u51fd\u6570\u7684\u65f6\u5019\u4f20\u5165\u6765\u4e24\u4e2a\u53c2\u6570\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#4-\u5b9e\u4f8b","title":"4. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#41-\u9700\u6c42","title":"4.1 \u9700\u6c42","text":"<p>\u6211\u4eec\u6765\u505a\u4e00\u4e2a\u5185\u7f51\u6279\u91cf\u626b\u63cf\u53ef\u7528 IP \u811a\u672c\uff0c\u7528\u6765\u5224\u65ad\u67d0\u4e00\u4e2a\u7f51\u6bb5\u4e2d\u7684\u7f51\u7edc\u53ef\u8fbe\u6027\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#42-\u601d\u8def","title":"4.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>ping</code> \u547d\u4ee4\u6765\u68c0\u6d4b\u53ef\u4ee5 ping \u901a\u7684 IP\uff0c\u5c06\u8fd4\u56de\u6b63\u5e38\u7684\u5185\u5165\u8bb0\u5f55\u5728 <code>success.log</code> \u4e2d\uff0c\u5931\u8d25\u7684\u5185\u5bb9\u8bb0\u5f55\u5728 <code>fail.log</code> \u4e2d\u3002</p> <p>\u4f20\u9012\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u7f51\u7edc\u524d\u7f00\uff0c\u4f8b\u5982 <code>192.168.0.</code>\uff0c\u7136\u540e\u5728\u811a\u672c\u5185\u90e8\u5faa\u73af <code>1-255</code> \u6765\u68c0\u6d4b\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a ping \u5305\u7684\u4e2a\u6570\uff0c\u5982\u679c\u5305\u592a\u591a\uff0c\u65f6\u95f4\u82b1\u8d39\u592a\u957f\uff0c\u592a\u77ed\u6709\u53ef\u80fd\u9020\u6210\u8bef\u5224\uff0c\u5728\u6b64\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 2 \u4e2a\u5305\u6765\u5224\u65ad\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#43-\u5b9e\u73b0","title":"4.3 \u5b9e\u73b0","text":"<pre><code>[root@master Shell_args]# cat ping.sh \n#!/bin/bash\n# Description: net check scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: net check\n# Date: 2020-03-08 14:00\n# Version: 1.0\n# \u65e5\u5fd7\u76ee\u5f55\nLOG_DIR=\"/tmp/netlog/\"\n# \u5982\u679c\u65e5\u5fd7\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u521b\u5efa\n[ ! -d ${LOG_DIR} ] &amp;&amp; mkdir -p ${LOG_DIR}\n# \u5b9a\u4e49\u6210\u529f\u4e0e\u5931\u8d25\u65e5\u5fd7\u6587\u4ef6\nSUCCESS_LOGFILE=\"success.log\"\nFAIL_LOGFILE=\"fail.log\"\n# \u7f51\u7edc\u524d\u7f00\nNET_PREFIX=$1\n# \u68c0\u6d4b\u5305\u6570\u91cf\nPACKAGE_NUM=$2\nfor num in `seq 1 255`;\ndo\n# \u8fdb\u884cping\u68c0\u6d4b\necho \"check ${NET_PREFIX}${num}...\"\nping -c ${PACKAGE_NUM} ${NET_PREFIX}${num} &amp;&gt;/dev/null\n        # \u5982\u679c\u8fd4\u56de\u6b63\u5e38\u5219\u8bb0\u5f55\u53ef\u4ee5ping\u901a\u7684ip\u5230successlog\u4e2d\n[ $? -eq 0 ] &amp;&amp; echo ${NET_PREFIX}${num} &gt;&gt; ${LOG_DIR}${SUCCESS_LOGFILE} || echo ${NET_PREFIX}${num} &gt;&gt; ${LOG_DIR}${SUCCESS_LOGFILE}\ndone\n# \u6d4b\u8bd5\n[root@master Shell_args]# bash ping.sh 172.16.60. 2\ncheck 172.16.60.1...\ncheck 172.16.60.2...\ncheck 172.16.60.3...\ncheck 172.16.60.4...\ncheck 172.16.60.5...\ncheck 172.16.60.6...\n</code></pre> <p>\u5f53\u811a\u672c\u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5728 <code>/tmp/netlog/</code> \u76ee\u5f55\u4e0b\u67e5\u770b\u6210\u529f\u4e0e\u5931\u8d25\u7684 IP \u4fe1\u606f\u3002</p>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#5-\u6ce8\u610f\u4e8b\u9879","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u9700\u8981\u5728\u5b9e\u6218\u4e2d\u7406\u89e3\u53c2\u6570\u7684\u7279\u6b8a\u7528\u5904\uff0c\u5728\u7f16\u5199\u811a\u672c\u4e2d\u5c3d\u53ef\u80fd\u591a\u7528\u53c2\u6570\uff0c\u4f7f\u5f97\u811a\u672c\u65e0\u72b6\u6001\uff1b</li> <li>\u9700\u8981\u7406\u89e3 <code>$@</code>\u4e8e <code>$*</code> \u4e24\u4e2a\u7684\u4e0d\u540c\u4e4b\u5904\uff0c\u5728\u4f7f\u7528\u5faa\u73af\u7684\u65f6\u5019\u9700\u8981\u683c\u5916\u6ce8\u610f\uff1b</li> <li>\u5728\u5229\u7528\u4f4d\u7f6e\u53c2\u6570\u4f20\u5165\u811a\u672c\u7684\u65f6\u5019\uff0c\u6700\u597d\u5229\u7528\u53d8\u91cf\u53bb\u63a5\u6536\u4f20\u9012\u7684\u5916\u90e8\u4f4d\u7f6e\u53c2\u6570\uff0c\u4fbf\u4e8e\u6211\u4eec\u5728\u811a\u672c\u5185\u8bc6\u522b\u53c2\u6570\u7684\u5177\u4f53\u542b\u4e49\u3002</li> </ul>"},{"location":"Linux/shell/3.Shell%E5%8F%82%E6%95%B0/#6-\u5c0f\u7ed3","title":"6. \u5c0f\u7ed3","text":"<p>\u53c2\u6570\u4e0e\u53d8\u91cf\u662f\u76f8\u8f85\u76f8\u6210\u7684\uff0c\u5c06\u53d8\u91cf\u4f20\u9012\u8fdb\u811a\u672c\u6216\u51fd\u6570\u5c31\u4e3a\u53c2\u6570\uff0c\u811a\u672c\u4e0e\u53d8\u91cf\u914d\u5408\u4f7f\u5f97\u6211\u4eec\u7684\u811a\u672c\u66f4\u52a0\u901a\u7528\uff0c\u9002\u5e94\u66f4\u5e7f\u7684\u9700\u6c42\u3002\u9700\u8981\u7262\u8bb0\u7279\u6b8a\u53c2\u6570\u7684\u5f62\u5f0f\uff0c\u5728\u540e\u671f\u7684 Shell \u7f16\u7a0b\u4e2d\uff0c\u8fd9\u4e9b\u53c2\u6570\u662f\u811a\u672c\u7f16\u7a0b\u7684\u57fa\u77f3\uff0c\u53ea\u6709\u57fa\u7840\u7262\u9760\uff0c\u540e\u7eed\u7684\u4f7f\u7528\u624d\u4f1a\u5f97\u5fc3\u5e94\u624b\uff0c\u5bf9\u4e0a\u8ff0\u7684\u4f8b\u5b50\u53ef\u4ee5\u4e3e\u4e00\u53cd\u4e09\uff0c\u4f8b\u5982\u63a2\u6d4b\u67d0\u4e00\u4e2a IP \u7684\u6240\u6709\u7aef\u53e3\u662f\u5426\u5f00\u653e\u7b49\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\u719f\u6089\u5404\u79cd\u53c2\u6570\u7684\u7528\u6cd5\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/","title":"4.Shell\u6570\u7ec4","text":""},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#4shell-\u6570\u7ec4","title":"4.Shell \u6570\u7ec4","text":""},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#1-shell-\u6570\u7ec4\u6982\u8ff0","title":"1. Shell \u6570\u7ec4\u6982\u8ff0","text":"<p>\u6211\u4eec\u5b66\u4e60\u4e86\u53d8\u91cf\uff0c\u77e5\u9053\u4e86\u53d8\u91cf\u4e3a\u5b58\u50a8\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5c0f\u5355\u5143\uff0c\u672c\u8282\u6211\u4eec\u6765\u5b66\u4e60\u6570\u7ec4\u6765\u5b58\u653e\u591a\u4e2a\u5143\u7d20\u7684\u96c6\u5408\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#11-shell-\u6570\u7ec4\u662f\u4ec0\u4e48","title":"1.1 Shell \u6570\u7ec4\u662f\u4ec0\u4e48","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u6570\u7ec4\u5c31\u662f\u4e00\u7cfb\u5217\u6570\u636e\u7684\u96c6\u5408\uff0c\u8fd9\u4e2a\u6570\u636e\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u7684\u5b58\u50a8\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5c0f\u5355\u5143\u53d8\u91cf\uff0c\u4e5f\u5c31\u662f\u8bf4\u5c06\u4e00\u4e9b\u5217\u7684\u5143\u7d20\u6574\u5408\u5230\u4e00\u4e2a\u96c6\u5408\u5185\uff0c\u8fd9\u4e2a\u96c6\u5408\u7684\u540d\u79f0\u5c31\u53eb\u6570\u7ec4\u3002\u5f53\u7136\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0c\u6570\u7ec4\u5177\u5907\u51e0\u4e2a\u6761\u4ef6\uff0c\u5728 Shell \u4e2d\u6570\u7ec4\u4ec5\u652f\u6301\u4e00\u7ef4\u6570\u7ec4\uff0c\u6570\u7ec4\u5143\u7d20\u7684\u4e0b\u6807\u4ece 0 \u5f00\u59cb\uff0c\u6570\u7ec4\u5143\u7d20\u6ca1\u6709\u6700\u5927\u9650\u5236\u7b49\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u6570\u7ec4","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u6570\u7ec4","text":"<p>\u4e0e\u53d8\u91cf\u7c7b\u4f3c\uff0c\u5f53\u6211\u4eec\u64cd\u4f5c\u6279\u91cf\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e00\u4e2a\u4e00\u4e2a\u53d8\u91cf\u64cd\u4f5c\u975e\u5e38\u4e0d\u4fbf\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6570\u7ec4\u96c6\u5408\uff0c\u5bf9\u6574\u4e2a\u6570\u7ec4\u96c6\u5408\u8fdb\u884c\u904d\u5386\u6216\u5176\u4ed6\u64cd\u4f5c\uff0c\u6700\u7ec8\u5b9e\u73b0\u6279\u91cf\u7684\u6548\u679c\uff0c\u6570\u7ec4\u4f7f\u5f97\u6211\u4eec\u7684\u811a\u672c\u66f4\u5177\u6269\u5c55\u6027\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#13-\u53d8\u91cf\u4e0e\u6570\u7ec4\u7684\u5dee\u5f02","title":"1.3 \u53d8\u91cf\u4e0e\u6570\u7ec4\u7684\u5dee\u5f02","text":"<p>\u53d8\u91cf\u662f\u5b58\u50a8\u5355\u4e2a\u6570\u636e\u7684\u5355\u5143\uff0c\u5176\u5728\u5185\u5b58\u4e2d\u662f\u968f\u673a\u5b58\u50a8\u7684\uff0c\u6570\u7ec4\u662f\u5b58\u50a8\u4e00\u7cfb\u5217\u6570\u636e\u7684\u96c6\u5408\uff0c\u662f\u4e8b\u5148\u5728\u5185\u5b58\u4e2d\u5f00\u8f9f\u8fde\u7eed\u7684\u4e00\u7cfb\u5217\u7a7a\u95f4\uff0c\u4e4b\u540e\u5c06\u6570\u7ec4\u5143\u7d20\u6709\u5e8f\u7684\u5b58\u50a8\u5728\u5176\u4e2d\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#2-\u6570\u7ec4\u7684\u57fa\u672c\u4f7f\u7528","title":"2. \u6570\u7ec4\u7684\u57fa\u672c\u4f7f\u7528","text":""},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#21-\u6570\u7ec4\u7684\u5b9a\u4e49","title":"2.1 \u6570\u7ec4\u7684\u5b9a\u4e49","text":"<p>\u6570\u7ec4\u7684\u5b9a\u4e49\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u53ef\u5206\u4e3a\u76f4\u63a5\u5b9a\u4e49\u548c\u5355\u5143\u7d20\u5b9a\u4e49\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#211-\u76f4\u63a5\u5b9a\u4e49","title":"2.1.1 \u76f4\u63a5\u5b9a\u4e49","text":"<p>\u6570\u7ec4\u7c7b\u4f3c\u4e8e\u53d8\u91cf\u5b9a\u4e49\uff0c\u53ea\u4e0d\u8fc7\u5c06\u91cc\u9762\u7684\u503c\u7528\u5c0f\u62ec\u53f7\u62ec\u8d77\u6765\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5143\u7d20\u4f7f\u7528\u7a7a\u683c\u5206\u5272\u3002Shell \u662f\u5f31\u7c7b\u578b\u7684\uff0c\u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u7c7b\u578b\u53ef\u4ee5\u4e0d\u4e00\u6837\uff0c\u4f8b\u5982\u5176\u4e2d\u53ef\u4ee5\u5305\u542b\u6570\u5b57\u4e0e\u5b57\u7b26\u4e32\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>ARG1=(1 2 3 \"hello Shell\")\n</code></pre> <p><code>ARG1</code> \u4e3a\u6570\u7ec4\u540d\u79f0\uff0c\u5176\u503c\u524d\u4e09\u4e2a\u4e3a\u6570\u5b57\uff0c\u6700\u540e\u4e00\u4e2a\u4e3a\u5b57\u7b26\u4e32\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#212-\u5355\u5143\u7d20\u5b9a\u4e49","title":"2.1.2 \u5355\u5143\u7d20\u5b9a\u4e49","text":"<p>Shell \u4e2d\u6570\u7ec4\u4e0b\u6807\u4ece 0 \u5f00\u59cb\uff0c\u5229\u7528\u5355\u4e2a\u5143\u7d20\u6765\u5b9a\u4e49\u6570\u7ec4\u3002</p> <p>\u4f8b\u5982:</p> <pre><code>[root@master scripts]# ARG2[0]=1\n[root@master scripts]# ARG2[1]=2\n[root@master scripts]# ARG2[2]=3\n[root@master scripts]# ARG2[3]=\"hello Shell\" \n</code></pre>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#22-\u5143\u7d20\u83b7\u53d6","title":"2.2 \u5143\u7d20\u83b7\u53d6","text":""},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#221-\u83b7\u53d6\u5355\u4e2a\u5143\u7d20","title":"2.2.1 \u83b7\u53d6\u5355\u4e2a\u5143\u7d20","text":"<p>\u4e0e\u53d8\u91cf\u7684\u5f15\u7528\u4e00\u6837\uff0c\u6570\u7ec4\u53ef\u4ee5\u83b7\u53d6\u5355\u4e2a\u4f4d\u7f6e\u7684\u5143\u7d20\uff0c\u5229\u7528 <code>${ARG[num]}</code>\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[0]}          //\u83b7\u53d6AEG1\u6570\u7ec4\u4e2d\u7b2c\u4e00\u4e2a\u5143\u7d20\n1\n[root@master scripts]# echo ${ARG1[3]}          //\u83b7\u53d6AEG1\u6570\u7ec4\u4e2d\u7b2c\u56db\u4e2a\u5143\u7d20\nhello Shell\n</code></pre>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#222-\u83b7\u53d6\u5168\u90e8\u5143\u7d20","title":"2.2.2 \u83b7\u53d6\u5168\u90e8\u5143\u7d20","text":"<ul> <li>\u83b7\u53d6\u6570\u7ec4\u503c</li> </ul> <p>\u83b7\u53d6\u6570\u7ec4\u5168\u90e8\u5143\u7d20\u4f7f\u7528 <code>${ARG[*]}</code> \u6216 <code>${ARG[@]}</code>\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[@]}\n1 2 3 hello Shell\n[root@master scripts]# echo ${ARG1[*]}\n1 2 3 hello Shell\n</code></pre> <ul> <li>\u83b7\u53d6\u6570\u7ec4\u4e0b\u6807</li> </ul> <p>\u83b7\u53d6\u6570\u7ec4\u5168\u90e8\u4e0b\u6807\u4f7f\u7528 <code>${!ARG[*]}</code> \u6216 <code>${!ARG[@]}</code>\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo ${!ARG1[@]}\n0 1 2 3\n[root@master ~]# echo ${!ARG1[*]}\n0 1 2 3\n</code></pre>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#223-\u83b7\u53d6\u6570\u7ec4\u957f\u5ea6","title":"2.2.3 \u83b7\u53d6\u6570\u7ec4\u957f\u5ea6","text":"<ul> <li>\u83b7\u53d6\u6574\u4e2a\u6570\u7ec4\u957f\u5ea6</li> </ul> <p>\u6570\u7ec4\u957f\u5ea6\u53ca\u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\uff0c\u53ef\u4ee5\u5229\u7528 <code>${#ARG[*]}</code> \u6216 <code>${#ARG[@]}</code>\uff0c\u6211\u4eec\u53d1\u73b0\u5176\u5b9e\u5c31\u662f\u5728\u83b7\u53d6\u6570\u7ec4\u5168\u90e8\u5143\u7d20\u524d\u6dfb\u52a0<code>#</code>\u6765\u83b7\u53d6\u6570\u7ec4\u4e2a\u6570\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${#ARG1[*]}\n4\n[root@master scripts]# echo ${#ARG1[@]}\n4\n</code></pre> <ul> <li>\u83b7\u53d6\u5355\u4e2a\u5143\u7d20\u7684\u957f\u5ea6</li> </ul> <p>\u5bf9\u4e8e\u6570\u7ec4\u4e2d\u7684\u67d0\u4e2a\u5143\u6211\u4eec\u4e5f\u53ef\u4ee5\u8fdb\u884c\u957f\u5ea6\u7684\u83b7\u53d6\uff0c\u53ef\u4ee5\u5229\u7528 <code>${#ARG1[num]}</code>\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[@]} \n100 2 3 hello Shell 10\n[root@master scripts]# echo ${ARG1[3]}      //\u83b7\u53d6\u7b2c\u56db\u4e2a\u5143\u7d20\u5185\u5bb9\u4e3a\uff1ahello Shell\nhello Shell\n[root@master scripts]# echo ${#ARG1[3]}     //\u83b7\u53d6\u56db\u4e2a\u5143\u7d20\u957f\u5ea6\u4e3a11\n11\n</code></pre>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#224-\u6570\u7ec4\u5143\u7d20\u7684\u4fee\u6539","title":"2.2.4 \u6570\u7ec4\u5143\u7d20\u7684\u4fee\u6539","text":"<p>\u6570\u7ec4\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9b\u5217\u5bf9\u5176\u5143\u7d20\u7684\u64cd\u4f5c\u3002</p> <ul> <li>\u4fee\u6539</li> </ul> <p>\u5bf9\u6570\u7ec4\u5143\u7d20\u7684\u4fee\u6539\uff0c\u76f4\u63a5\u5bf9\u5355\u4e2a\u5143\u7d20\u4fee\u6539\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# AEG1[0]=100\n[root@master scripts]# echo ${ARG1[@]}\n100 2 3 hello Shell\n</code></pre> <ul> <li>\u589e\u52a0</li> </ul> <p>\u5bf9\u6570\u7ec4\u5143\u7d20\u7684\u589e\u52a0\uff0c\u548c\u5bf9\u4fee\u6539\u4e00\u81f4\uff0c\u76f4\u63a5\u5bf9\u5355\u4e2a\u4f4d\u7f6e\u5143\u7d20\u589e\u52a0\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# ARG1[10]=10\n[root@master scripts]# echo ${ARG1[@]}\n100 2 3 hello Shell 10\n[root@master scripts]# echo ${#ARG1[@]}\n5\n</code></pre> <p>Tips\uff1a\u5728\u6b64\u6211\u4eec\u53d1\u73b0\u5143\u7d20\u4e4b\u524d\u6709 4 \u4e2a\u5143\u7d20\uff0c\u6211\u4eec\u5c06\u4e0b\u6807 10 \u7684\u5143\u7d20\u8d4b\u503c\u4e3a 10\uff0c\u6570\u7ec4\u662f\u6309\u7167\u4ece\u524d\u5f80\u540e\u987a\u5e8f\u8d4b\u503c\u7684\u3002</p> <ul> <li>\u5220\u9664</li> </ul> <p>\u5220\u9664\u6570\u7ec4\u53ef\u4ee5\u4f7f\u7528 unset\uff0c<code>unset ARG1[num]</code> \u53ef\u4ee5\u5220\u9664\u5bf9\u5e94\u4e0b\u6807\u7684\u6570\u7ec4\u5143\u7d20\uff0c\u5982\u679c\u4e0d\u5e26\u4e0b\u6807\u5219\u5220\u9664\u6570\u7ec4\u7684\u5168\u90e8\u5143\u7d20\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[@]} \n100 3 hello Shell 10\n[root@master scripts]# unset ARG1[0]            //\u5220\u9664\u4e0b\u6807\u4e3a0\u7684\u5143\u7d20\n[root@master scripts]# echo ${ARG1[@]}\n3 hello Shell 10\n[root@master scripts]# unset ARG1           //\u5220\u9664\u6574\u4e2a\u6570\u7ec4\u5143\u7d20\n[root@master scripts]# echo ${ARG1[@]}\n</code></pre>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#225-\u6570\u7ec4\u7684\u5207\u7247","title":"2.2.5 \u6570\u7ec4\u7684\u5207\u7247","text":"<p>\u548c\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0c\u53ef\u4ee5\u5bf9\u6570\u7ec4\u8fdb\u884c\u5207\u7247\u4e5f\u79f0\u622a\u53d6\u64cd\u4f5c\u3002\u53ef\u4ee5\u901a\u8fc7 <code>${AEG1[@\u6216*]:\u8d77\u59cb\u4f4d\u7f6e\uff1a\u957f\u5ea6}</code> \u5bf9\u539f\u6570\u7ec4\u8fdb\u884c\u5207\u7247\uff0c\u8fd4\u56de\u7684\u4e3a\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[@]}\n1 2 3 hello Shell\n[root@master scripts]# echo ${ARG1[@]:0:2}              //\u4ece\u7b2c1\u4e2a\u5143\u7d20\u5f80\u540e2\u4e2a\u5143\u7d20\u8fdb\u884c\u5207\u7247\n1 2\n</code></pre>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#226-\u6570\u7ec4\u7684\u66ff\u6362","title":"2.2.6 \u6570\u7ec4\u7684\u66ff\u6362","text":"<p>\u53ef\u4ee5\u66ff\u6362\u6570\u7ec4\u4e2d\u7684\u67d0\u4e00\u4e2a\u5143\u7d20\uff0c\u4f8b\u5982\u6211\u4eec\u5c06 <code>ARG1</code> \u6570\u7ec4\u4e2d\u7684\u7b2c 1 \u4e2a\u5143\u7d20\u66ff\u6362\u4e3a 110\u3002</p> <pre><code>[root@master scripts]# echo ${ARG1[@]}\n1 2 3 hello Shell\n[root@master scripts]# echo ${ARG1[@]/1/110}\n110 2 3 hello Shell\n</code></pre>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#3-shell-\u6570\u7ec4\u5206\u7c7b","title":"3. Shell \u6570\u7ec4\u5206\u7c7b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 Shell \u4e2d\u6570\u7ec4\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u6765\u770b\u4e00\u4e0b\u6570\u7ec4\u7684\u5206\u7c7b\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#31-\u666e\u901a\u6570\u7ec4","title":"3.1 \u666e\u901a\u6570\u7ec4","text":"<p>\u666e\u901a\u6570\u7ec4\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u4ee5\u6570\u5b57\u4e3a\u4e0b\u6807\u7684\u6570\u7ec4\uff0c\u4e0a\u8ff0\u7684\u4f8b\u5b50\u90fd\u4e3a\u666e\u901a\u6570\u7ec4\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#32-\u5173\u8054\u6570\u7ec4","title":"3.2 \u5173\u8054\u6570\u7ec4","text":"<p>\u5173\u8054\u6570\u7ec4\u662f\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u5f53\u4f5c\u6570\u7ec4\u4e0b\u6807\u7684\u4e00\u7c7b\u6570\u7ec4\uff0c\u5728\u4f7f\u7528\u5173\u8054\u6570\u7ec4\u524d\uff0c\u5fc5\u987b\u5148\u4f7f\u7528 <code>declare -A</code> \u58f0\u660e\u5b83\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# declare -A ARGFILE                         //\u5b9a\u4e49\u7ba1\u7406\u6570\u7ec4\n[root@master ~]# ARGFILE=([name1]=Shell [name2]=linux [name3]=arg)      //\u5173\u8054\u6570\u7ec4\u5143\u7d20\u8d4b\u503c\n[root@master ~]# echo ${ARGFILE[@]}                         //\u67e5\u770b\u6240\u6709\u5143\u7d20\narg linux Shell\n[root@master ~]# echo ${ARGFILE[name1]}                 //\u67e5\u770b\u7d22\u5f15\u4e3aname1\u7684\u5143\u7d20\u503c\nShell\n</code></pre> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u5bf9\u5355\u4e2a\u5143\u7d20\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\uff0c \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5173\u8054\u6570\u7ec4\u5c31\u6ca1\u6709\u6392\u5e8f\u4e86\uff0c\u7c7b\u4f3c\u4e8e\u5176\u4ed6\u8bed\u8a00\u4e2d\u7684\u5b57\u5178\uff0ckey \u503c\u4e5f\u662f\u5b57\u7b26\u4e32\u5f62\u5f0f\u3002</p> <pre><code>[root@master ~]# declare -A ARGLIST\n[root@master ~]# ARGLIST[n1]=1\n[root@master ~]# ARGLIST[n2]=2\n[root@master ~]# ARGLIST[n3]=\"hello Shell\" \n[root@master ~]# echo ${ARGLIST[@]}                 //\u83b7\u53d6\u5173\u8054\u6570\u7ec4\u7684\u6240\u6709\u503c\n2 hello Shell 1\n[root@master ~]# echo ${#ARGLIST[@]}                //\u83b7\u53d6\u5173\u8054\u6570\u7ec4\u7684\u5143\u7d20\u4e2a\u6570\n3\n[root@master ~]# echo ${!ARGLIST[@]}                //\u83b7\u53d6\u5173\u8054\u6570\u7ec4\u7684\u4e0b\u6807\nn2 n3 n1\n</code></pre>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#4-\u5b9e\u4f8b","title":"4. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#41-\u9700\u6c42","title":"4.1 \u9700\u6c42","text":"<p>\u6211\u4eec\u60f3\u5229\u7528\u6570\u7ec4\u7edf\u8ba1 linux \u670d\u52a1\u5668\u7684\u6bcf 5 \u5206\u949f\u7684\u7f51\u7edc\u94fe\u63a5\u60c5\u51b5\uff0c\u67e5\u770b\u5904\u4e8e\u5404\u4e2a\u65f6\u95f4\u6bb5\u7684\u670d\u52a1\u5668 TCP \u94fe\u63a5\u7684\u60c5\u51b5\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#42-\u601d\u8def","title":"4.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>netstat -ant</code> \u547d\u4ee4\u6765\u67e5\u770b\u7f51\u7edc\u94fe\u63a5\u60c5\u51b5\uff0c\u4f46\u662f\u8f93\u51fa\u7684\u5185\u5bb9\u6211\u4eec\u53ea\u5173\u5fc3\u6700\u540e\u4e00\u5217\u7684\u72b6\u6001\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5229\u7528 awk \u6765\u6253\u5370\u4ece\u7b2c\u4e8c\u884c\u5f00\u59cb\u5230\u6700\u540e\u4e00\u5217\u72b6\u6001\uff0c\u7531\u4e8e awk \u547d\u4ee4\u5728\u540e\u7eed\u6211\u4eec\u4f1a\u8be6\u89e3\uff0c\u5728\u6b64\u4ec5\u4f5c\u4e3a\u5de5\u5177\u4f7f\u7528\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# netstat -ant|awk 'NR&gt;2 {print $NF}'\nLISTEN\nLISTEN\nESTABLISHED\nTIME_WAIT\n</code></pre> <p>\u6253\u5370\u51fa\u6765\u7684\u5c31\u662f\u6700\u540e\u4e00\u5217\u7684\u72b6\u6001\uff0c\u6211\u4eec\u5c06\u5176\u5185\u5bb9\u4f5c\u4e3a\u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u503c\u4e3a\u5176\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7edf\u8ba1 TCP \u94fe\u63a5\u5230\u72b6\u6001\uff0c\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u6765\u5b9a\u65f6\u7edf\u8ba1\u670d\u52a1\u5668\u7684 tcp \u94fe\u63a5\u72b6\u6001\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#43-\u5b9e\u73b0","title":"4.3 \u5b9e\u73b0","text":"<pre><code>[root@master Shell_args]# cat tcp_status.sh \n#!/bin/bash\n# Description: check tcp status\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: net check\n# Date: 2020-03-14 14:00\n# Version: 1.0\n# \u65e5\u5fd7\u76ee\u5f55\nLOG_FILE=\"/tmp/tcp_status.log\"\n# \u5b9a\u4e49\u7ba1\u7406\u6570\u7ec4\ndeclare -A TCP_STATUS\n\n# \u5bf9\u6570\u7ec4\u8fdb\u884c\u5185\u5bb9\u8d4b\u503c\n# \u5229\u7528netstat\u547d\u4ee4\u6765\u8fc7\u6ee4\u51fa\u5173\u7cfb\u7684\u4e00\u5217\u6570\u636e\nfor status in $(netstat -ant|awk 'NR&gt;2 {print $NF}')\ndo\n# \u5bf9\u72b6\u6001\u76f8\u540c\u72b6\u6001\u7684TCP\u8fdb\u884c\u6570\u503c\u7d2f\u52a0\nlet TCP_STATUS[${status}]++\ndone\n# \u5c06\u7edf\u8ba1\u5b8c\u6210\u7684TCP\u94fe\u63a5\u72b6\u6001\u53ca\u6570\u636e\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\nfor i in ${!TCP_STATUS[@]}\ndo echo \"$(date +%F\" \"%H:%m)  \u670d\u52a1\u5668\u7684TCP\u72b6\u6001\u4e3a: ${i} \u7684\u6570\u91cf\u4e3a: ${TCP_STATUS[${i}]}\" &gt;&gt; ${LOG_FILE}\ndone\n# \u6d4b\u8bd5\n[root@master ~]# bash tcp_status.sh \n[root@master ~]# cat /tmp/tcp_status.log \n2020-03-14 15:03  \u670d\u52a1\u5668\u7684TCP\u72b6\u6001\u4e3a: TIME_WAIT \u7684\u6570\u91cf\u4e3a: 138\n2020-03-14 15:03  \u670d\u52a1\u5668\u7684TCP\u72b6\u6001\u4e3a: ESTABLISHED \u7684\u6570\u91cf\u4e3a: 501\n2020-03-14 15:03  \u670d\u52a1\u5668\u7684TCP\u72b6\u6001\u4e3a: LISTEN \u7684\u6570\u91cf\u4e3a: 59\n</code></pre> <p>\u67e5\u770b\u6211\u4eec\u5355\u72ec\u8fd0\u884c\u811a\u672c\u5df2\u7ecf\u6210\u529f\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u811a\u672c\u52a0\u5165 crontab \u4e2d\uff0c\u6765\u5b9a\u65f6\u6267\u884c\uff0c\u540e\u671f\u5c31\u53ef\u4ee5\u901a\u8fc7\u65e5\u5fd7\u6765\u67e5\u770b\u5f53\u65f6\u670d\u52a1\u5668\u7684\u72b6\u6001\u4e86\u3002</p>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#5-\u6ce8\u610f\u4e8b\u9879","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u9700\u8981\u5728\u5b9e\u6218\u4e2d\u7406\u89e3\u6570\u7ec4\u7684\u5177\u4f53\u7528\u9014\uff0c\u5c24\u5176\u6ce8\u610f\u5173\u8054\u6570\u7ec4\u7684\u7075\u6d3b\u8fd0\u7528\uff1b</li> <li>\u9700\u8981\u7406\u89e3\u6570\u7ec4\u7684\u5168\u90e8\u5143\u7d20\uff0c\u5143\u7d20\u4e0b\u6807\u4ee5\u53ca\u5143\u7d20\u7684\u5207\u7247\u548c\u66ff\u6362\uff0c\u5177\u4f53\u573a\u666f\u914d\u5408\u4f7f\u7528\uff1b</li> <li>\u6570\u7ec4\u4e00\u822c\u7528\u6765\u7edf\u8ba1\u6279\u91cf\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\u6279\u91cf\u6587\u4ef6\u7684\u8ba1\u7b97\u7b49\uff0c\u914d\u5408\u5176\u4ed6\u547d\u4ee4\u4f7f\u7528\u3002</li> </ul>"},{"location":"Linux/shell/4.Shell%E6%95%B0%E7%BB%84/#6-\u5c0f\u7ed3","title":"6. \u5c0f\u7ed3","text":"<p>\u6570\u7ec4\u53ef\u8c13\u4e3a\u6211\u4eec\u5728 Shell \u7f16\u7a0b\u4e2d\u63d0\u4f9b\u4e86\u96c6\u5408\u7c7b\u578b\u6570\u636e\u5b58\u50a8\u7684\u65b9\u6848\uff0c\u5bf9\u4e8e\u6279\u91cf\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u6570\u7ec4\u529f\u4e0d\u53ef\u6ca1\u3002\u5728\u5177\u4f53\u7684\u5b9e\u8df5\u4e2d\u6839\u636e\u6570\u636e\u7279\u5f81\uff0c\u660e\u786e\u9700\u6c42\u662f\u5229\u7528\u6570\u5b57\u4f5c\u4e3a\u4e0b\u6807\u7684\u6570\u7ec4\uff0c\u8fd8\u662f\u4f7f\u7528\u5173\u8054\u6570\u7ec4\uff0c\u6700\u540e\u5728\u5b9e\u8df5\u4e2d\u7075\u6d3b\u8fd0\u7528\u6570\u7ec4\u7684\u6574\u4f53\u957f\u5ea6\uff0c\u5207\u7247\uff0c\u66ff\u6362\u7b49\u64cd\u4f5c\uff0c\u914d\u5408\u5176\u4ed6\u547d\u4ee4\u5b9e\u73b0\u5177\u4f53\u4e1a\u52a1\u9700\u6c42\u3002</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/","title":"5.Shell \u8fd0\u7b97\u7b26","text":""},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#1-shell-\u8fd0\u7b97\u7b26\u6982\u8ff0","title":"1. Shell \u8fd0\u7b97\u7b26\u6982\u8ff0","text":""},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#11-shell-\u8fd0\u7b97\u7b26\u662f\u4ec0\u4e48","title":"1.1 Shell \u8fd0\u7b97\u7b26\u662f\u4ec0\u4e48","text":"<p>\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0cShell \u4e5f\u6709\u8fd0\u7b97\u7b26\uff0c\u5728 Shell \u4e2d\u5176\u6839\u636e\u7c7b\u578b\u4e0d\u540c\u4e5f\u6709\u4e0d\u5c11\u8fd0\u7b97\u7b26\u5206\u7c7b\uff0c\u90a3\u4e48\u4ec0\u4e48\u662f\u8fd0\u7b97\u7b26\u5462\uff1f\u4f8b\u5982\u5927\u5bb6\u90fd\u77e5\u9053\u5728\u7b97\u672f\u8fd0\u7b97\u4e2d\u7684\u52a0\u51cf\u4e58\u9664\uff0c<code>+</code> \u5c31\u662f\u6211\u4eec Shell \u4e2d\u7684\u7b97\u672f\u8fd0\u7b97\u7b26\u7684\u4e00\u79cd\uff0c\u5f53\u7136\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7684\u529f\u80fd\u5404\u5f02\u7684\u8fd0\u7b97\u7b26\uff0c\u4f5c\u4e3a\u6761\u4ef6\u5224\u65ad\u4e0e\u7b97\u672f\u64cd\u4f5c\u7b49\u91cd\u8981\u529f\u80fd\uff0c\u6784\u6210\u4e86 Shell \u4e2d\u7684\u57fa\u672c\u5143\u7d20\u3002</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u8fd0\u7b97\u7b26","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u8fd0\u7b97\u7b26","text":"<p>\u5f53\u6211\u4eec\u5bf9\u6570\u503c\u8fdb\u884c\u7b97\u672f\u8fd0\u7b97\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u6587\u4ef6\u8fdb\u884c\u5224\u65ad\uff0c\u5f53\u6211\u4eec\u9700\u8981\u591a\u903b\u8f91\u8fdb\u884c\u5224\u65ad\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u60c5\u51b5\u90fd\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u8fd0\u7b97\u7b26\uff0c\u4f7f\u5f97\u6211\u4eec\u811a\u672c\u66f4\u4e3a\u7075\u6d3b\u4fbf\u6377\u3002</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#2-shell-\u8fd0\u7b97\u7b26\u5206\u7c7b","title":"2. Shell \u8fd0\u7b97\u7b26\u5206\u7c7b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 shell \u4e2d\u8fd0\u7b97\u7b26\u662f\u4ec0\u4e48\u53ca\u5176\u529f\u80fd\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u770b\u4e00\u4e0b Shell \u811a\u672c\u8fd0\u7b97\u7b26\u7684\u5206\u7c7b\u53ca\u6bcf\u79cd\u8fd0\u7b97\u7b26\u7684\u57fa\u672c\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#21-\u7b97\u672f\u8fd0\u7b97\u7b26","title":"2.1 \u7b97\u672f\u8fd0\u7b97\u7b26","text":"<p>\u7b97\u672f\u8fd0\u7b97\u7b26\u987e\u540d\u601d\u4e49\uff0c\u5176\u5c31\u662f\u8fdb\u884c\u52a0\u51cf\u4e58\u9664\u6570\u503c\u8fd0\u7b97\uff0c\u5728 shell \u4e2d\uff0cbash \u4e0d\u652f\u6301\u539f\u751f\u7684\u6570\u5b66\u8fd0\u7b97\uff0c\u9700\u8981\u5229\u7528\u7b2c\u4e09\u65b9\u5de5\u5177\u6765\u5982 <code>let</code>\uff0c<code>expr</code> \u7b49\u6765\u5b9e\u73b0\u3002</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b + \u52a0\u6cd5 <code>expr $a + $b</code> \u7ed3\u679c\u4e3a 30\u3002 - \u51cf\u6cd5 <code>expr $a - $b</code> \u7ed3\u679c\u4e3a -10\u3002 * \u4e58\u6cd5 <code>expr $a \\* $b</code> \u7ed3\u679c\u4e3a 200\u3002 / \u9664\u6cd5 <code>expr $b / $a</code> \u7ed3\u679c\u4e3a 2\u3002 % \u53d6\u4f59 <code>expr $b % $a</code> \u7ed3\u679c\u4e3a 0\u3002 = \u8d4b\u503c a=$b \u5c06\u628a\u53d8\u91cf b \u7684\u503c\u8d4b\u7ed9 a\u3002 == \u76f8\u7b49 \u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u6570\u5b57\uff0c\u76f8\u540c\u5219\u8fd4\u56de true\u3002 [$a == $b] \u8fd4\u56de false\u3002 != \u4e0d\u76f8\u7b49 \u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u6570\u5b57\uff0c\u4e0d\u76f8\u540c\u5219\u8fd4\u56de true\u3002 [$a != $b] \u8fd4\u56de true\u3002"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#211-let","title":"2.1.1 let","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>let</code> \u5bf9\u6570\u503c\u8fdb\u884c\u8fd0\u7b97\uff0c<code>let C=$A+$B</code>, \u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# A=1\n[root@master ~]# B=2\n[root@master ~]# let C=${A}+${B}\n[root@master ~]# echo $C\n3\n</code></pre> <p>\u6ce8\u610f\uff1a<code>let</code> \u8fd0\u7b97\u540e\u9700\u8981\u5c06\u5176\u8d4b\u503c\u7ed9\u4e00\u4e2a\u53d8\u91cf\u3002</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#212-expr","title":"2.1.2 expr","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>expr</code> \u5bf9\u6570\u7ec4\u8fdb\u884c\u8fd0\u7b97\uff0c<code>C=$(expr $A+$B)</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# C=`expr $A + $B`\n[root@master ~]# echo $C\n3\n</code></pre> <p>\u6ce8\u610f <code>+</code> \u53f7\u4e24\u8fb9\u9700\u8981\u6709\u7a7a\u683c\uff0c\u4e0d\u7136\u4f1a\u5c06\u5176\u5f53\u4f5c\u5b57\u7b26\u4e32\u8fde\u63a5</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#213-","title":"2.1.3 []","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>[]</code> \u6765\u5bf9\u6570\u503c\u8fdb\u884c\u8fd0\u7b97\uff0c<code>C=[A+B]</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# C=$[$A+$B]\n[root@master ~]# echo $C\n3\n</code></pre>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#214-","title":"2.1.4 (())","text":"<p>\u5229\u7528 <code>(())</code> \u6765\u5bf9\u6570\u503c\u8fdb\u884c\u8fd0\u7b97\uff0c<code>C=$(($A+$B))</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# C=$(($A+$B))\n[root@master ~]# echo $C\n3\n</code></pre>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#215-\u603b\u7ed3","title":"2.1.5 \u603b\u7ed3","text":"<p>\u57fa\u672c\u7b97\u6570</p> <pre><code>let\nlet result=num1+num2\nlet num++\nlet num--\nlet num+=5\nlet num-=5\n$(())\nresult=$((num1+num2))\nresult=$(($num+5))\n$[]\nresult=$[ num1+num2 ]\nresult=$[ $num+5 ]\n</code></pre> <p>\u5728\u5faa\u73afuntil\u4e2d\u9012\u589e\u53d8\u91cf\u7684\u793a\u4f8b\uff1a</p> <pre><code>i=0\nuntil [ $i -gt 3 ]\ndo\necho i: $i\n((i=i+1))\ndone\n</code></pre> <p>while\u5faa\u73af\u4e2d\uff0c\u6211\u4eec\u5c06i\u53d8\u91cf\u7684\u503c\u9012\u51cf5</p> <pre><code>i=20\nwhile [ $i -ge 5 ]\ndo\necho Number: $i\nlet \"i-=5\" done\n</code></pre> <p>\u5728bash\u811a\u672c\u4e2d\u4f7f\u7528\u540e\u7f00\u589e\u91cf\u5668\u7684\u793a\u4f8b\uff1a</p> <pre><code>#!/bin/bash\ni=0\nwhile true; do\nif [[ \"$i\" -gt 3 ]]; then\nexit 1\nfi\necho i: $i\n((i++))\ndone\n</code></pre> <p>expr\u5173\u952e\u5b57\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u53d8\u91cf\u7684\u52a0\u51cf\u3002</p> <pre><code>var=`expr $var + 1`\n</code></pre> <p>\u9ad8\u7ea7\u7b97\u6570</p> <pre><code>expr\nresult=expr 3+4\nresult=$(expr $num+5)\nbc\n\u666e\u901a\u7528\u6cd5 echo \"4 * 0.56\" | bc\n\u8bbe\u5b9a\u5c0f\u6570\u7cbe\u5ea6 echo \"scale=2; 3/8\" | bc\n\u5341\u8fdb\u5236\u8f6c\u4e8c\u8fdb\u5236 echo \"obase=2; $num\" | bc\n\u4e8c\u8fdb\u5236\u8f6c\u5341\u8fdb\u5236 echo \"obase=10; ibase=2; $num\" | bc\n\u5e73\u65b9\u6839 echo \"sqrt(100)\" | bc\n\u8ba1\u7b97\u5e73\u65b9 echo \"10^10\" | bc\n</code></pre>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#22-\u5173\u7cfb\u8fd0\u7b97\u7b26","title":"2.2 \u5173\u7cfb\u8fd0\u7b97\u7b26","text":"<p>\u4e86\u89e3\u4e86\u7b97\u672f\u8fd0\u7b97\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u5b66\u4e60\u5173\u7cfb\u8fd0\u7b97\u3002</p> \u6bd4\u8f83\u7b26 \u63cf\u8ff0 \u793a\u4f8b -eq\uff0cequal \u7b49\u4e8e [1 -eq 1] \u4e3a true -ne\uff0cnot equal \u4e0d\u7b49\u4e8e [ 1 -ne 1 \u4e3a false -gt\uff0cgreater than \u5927\u4e8e [2 -gt 1] \u4e3a true -lt\uff0clesser than \u5c0f\u4e8e [2 -lt 1] \u4e3a false -ge\uff0cgreater or equal \u5927\u4e8e\u6216\u7b49\u4e8e [2 -ge 1] \u4e3a true -le\uff0clesser or equal \u5c0f\u4e8e\u6216\u7b49\u4e8e [2 -le 1] \u4e3a false <p>\u5173\u7cfb\u8fd0\u7b97\u987e\u540d\u601d\u4e49\u5c31\u662f\u6bd4\u8f83\u6570\u5b57\u7684\u5927\u5c0f\uff0c\u6ce8\u610f\u5173\u7cfb\u8fd0\u7b97\u7b26\u4f5c\u7528\u7684\u4e3a\u6570\u5b57\uff0c\u4e0d\u80fd\u7528\u5176\u6765\u6bd4\u8f83\u5b57\u7b26\u4e32\u3002</p> <pre><code>#!/bin/bash\nnum1=1\nnum2=2\necho \"num1 \u4e3a\uff1a${num1}\"\necho \"num2 \u4e3a\uff1a${num2}\"\nif [ $num1 -eq $num2 ]\nthen\necho \"$num1 -eq $num2 : num1 \u7b49\u4e8e num2\"\nelse\necho \"$num1 -eq $num2: num1 \u4e0d\u7b49\u4e8e num2\"\nfi\nif [ $num1 -ne $num2 ]\nthen\necho \"$num1 -ne $num2: num1 \u4e0d\u7b49\u4e8e num2\"\nelse\necho \"$num1 -ne $num2 : num1 \u7b49\u4e8e num2\"\nfi\nif [ $num1 -gt $num2 ]\nthen\necho \"$num1 -gt $num2: num1 \u5927\u4e8e num2\"\nelse\necho \"$num1 -gt $num2: num1 \u4e0d\u5927\u4e8e num2\"\nfi\nif [ $num1 -lt $num2 ]\nthen\necho \"$num1 -lt $num2: num1 \u5c0f\u4e8e num2\"\nelse\necho \"$num1 -lt $num2: num1 \u4e0d\u5c0f\u4e8e num2\"\nfi\nif [ $num1 -ge $num2 ]\nthen\necho \"$num1 -ge $num2: num1 \u5927\u4e8e\u6216\u7b49\u4e8e num2\"\nelse\necho \"$num1 -ge $num2: num1 \u5c0f\u4e8e num2\"\nfi\nif [ $num1 -le $num2 ]\nthen\necho \"$num1 -le $num2: num1 \u5c0f\u4e8e\u6216\u7b49\u4e8e num2\"\nelse\necho \"$num1 -le $num2: num1 \u5927\u4e8e num2\"\nfi\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>num1 \u4e3a\uff1a1\nnum2 \u4e3a\uff1a2\n1 -eq 2: num1 \u4e0d\u7b49\u4e8e num2\n1 -ne 2: num1 \u4e0d\u7b49\u4e8e num2\n1 -gt 2: num1 \u4e0d\u5927\u4e8e num2\n1 -lt 2: num1 \u5c0f\u4e8e num2\n1 -ge 2: num1 \u5c0f\u4e8e num2\n1 -le 2: num1 \u5c0f\u4e8e\u6216\u7b49\u4e8e num2\n</code></pre>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#23-\u5e03\u5c14\u8fd0\u7b97\u7b26","title":"2.3 \u5e03\u5c14\u8fd0\u7b97\u7b26","text":"<p>\u5e03\u5c14\u8fd0\u7b97\u7b26\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u4e0e\u6216\u975e</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b -a \u4e0e\u8fd0\u7b97\uff0c\u4e24\u4e2a\u8868\u8fbe\u5f0f\u90fd\u4e3a true \u624d\u8fd4\u56de true\u3002 [1 -lt 2 -a 10 -gt 2] \u8fd4\u56de true\u3002 -o \u6216\u8fd0\u7b97\uff0c\u6709\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e3a true \u5219\u8fd4\u56de true\u3002 [1 -lt 2 -o 2 -gt 10] \u8fd4\u56de true\u3002 ! \u975e\u8fd0\u7b97\uff0c\u8868\u8fbe\u5f0f\u4e3a true \u5219\u8fd4\u56de false\uff0c\u5426\u5219\u8fd4\u56de true\u3002 [! false] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\nnum1=10\nnum2=20\necho \"num1 \u4e3a\uff1a ${num1}\"\necho \"num2 \u4e3a\uff1a ${num2}\"\nif [ $num1 -lt 40 -a $num2 -gt 15 ];then\necho \"$num1 \u5c0f\u4e8e 40 \u4e14 $num2 \u5927\u4e8e 15 : \u8fd4\u56de true\"\nelse\necho \"$num1 \u5c0f\u4e8e 40 \u4e14 $num2 \u5927\u4e8e 15 : \u8fd4\u56de fnum1lse\"\nfi\necho \"\u6216\u8fd0\u7b97\"\nif [ $num1 -lt 40 -o $num2 -gt 40 ];then\necho \"$num1 \u5c0f\u4e8e 40 \u6216 $num2 \u5927\u4e8e 40 : \u8fd4\u56de true\"\nelse\necho \"$num1 \u5c0f\u4e8e 40 \u6216 $num2 \u5927\u4e8e 40 : \u8fd4\u56de fnum1lse\"\nfi\necho \"\u975e\u8fd0\u7b97\"\nif [ $num1 != $num2 ];then\necho \"$num1 != $num2 : num1 \u4e0d\u7b49\u4e8e num2\"\nelse\necho \"$num1 != $num2: num1 \u7b49\u4e8e num2\"\nfi\n</code></pre> <p>\u8fd4\u56de\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>num1 \u4e3a\uff1a 10\nnum2 \u4e3a\uff1a 20\n10 \u5c0f\u4e8e 40 \u4e14 20 \u5927\u4e8e 15 : \u8fd4\u56de true\n\u6216\u8fd0\u7b97\n10 \u5c0f\u4e8e 40 \u6216 20 \u5927\u4e8e 40 : \u8fd4\u56de true\n\u975e\u8fd0\u7b97\n10 != 20 : num1 \u4e0d\u7b49\u4e8e num2\n[root@master scripts]# vim 2.sh \n[root@master scripts]# bash 2.sh \nnum1 \u4e3a\uff1a 10\nnum2 \u4e3a\uff1a 20\n10 \u5c0f\u4e8e 40 \u4e14 20 \u5927\u4e8e 15 : \u8fd4\u56de true\n\u6216\u8fd0\u7b97\n10 \u5c0f\u4e8e 40 \u6216 20 \u5927\u4e8e 40 : \u8fd4\u56de true\n\u975e\u8fd0\u7b97\n10 != 20 : num1 \u4e0d\u7b49\u4e8e num2        </code></pre>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#24-\u903b\u8f91\u8fd0\u7b97\u7b26","title":"2.4 \u903b\u8f91\u8fd0\u7b97\u7b26","text":"<p>\u903b\u8f91\u8fd0\u7b97\u7b26\u4e3a\uff0c\u4ee5\u4e0b\u4ecb\u7ecd Shell \u7684\u903b\u8f91\u8fd0\u7b97\u7b26\uff0c\u5047\u5b9a\u53d8\u91cf A \u4e3a 1\uff0c\u53d8\u91cf b \u4e3a 2\uff1a</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b &amp;&amp; \u903b\u8f91\u7684 AND <code>[[ $A -lt 10 &amp;&amp; $B -gt 100 ]] \u8fd4\u56de false</code> || \u903b\u8f91\u7684 OR <code>[[ $A -lt 10 || $B -gt 100 ]] \u8fd4\u56de true</code> <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\nnum1=1\nnum2=2\necho \"num1 \u4e3a:${num1}\"\necho \"num2 \u4e3a:${num2}\"\nif [[ $num1 -lt 5 &amp;&amp; $num2 -gt 5 ]];then\necho \"\u8fd4\u56de true\"\nelse\necho \"\u8fd4\u56de false\"\nfi\nif [[ $num1 -lt 5 || $num2 -gt 5 ]];then\necho \"\u8fd4\u56de true\"\nelse\necho \"\u8fd4\u56de false\"\nfi\n</code></pre> <p>\u8fd4\u56de\uff1a</p> <pre><code>num1 \u4e3a:1\nnum2 \u4e3a:2\n\u8fd4\u56de false\n\u8fd4\u56de true\n</code></pre>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#25-\u5b57\u7b26\u4e32\u8fd0\u7b97\u7b26","title":"2.5 \u5b57\u7b26\u4e32\u8fd0\u7b97\u7b26","text":"<p>\u5bf9\u4e8e\u5b57\u7b26\u4e32\u8fdb\u884c\u4e00\u4e9b\u5224\u65ad\u64cd\u4f5c\uff0c\u5047\u5b9a\u53d8\u91cf a \u4e3a \u201clinux\u201d\uff0c\u53d8\u91cf b \u4e3a \u201cshell\u201d\uff1a</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b = \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u76f8\u7b49\u8fd4\u56de true\u3002 [$a = $b] \u8fd4\u56de false\u3002 != \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u8fd4\u56de true\u3002 [$a != $b] \u8fd4\u56de true\u3002 -z \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a 0\uff0c\u4e3a 0 \u8fd4\u56de true\u3002 [-z $a] \u8fd4\u56de false\u3002 -n \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a 0\uff0c\u4e0d\u4e3a 0 \u8fd4\u56de true\u3002 [-n \u201c$a\u201d ] \u8fd4\u56de true\u3002 $ \u68c0\u6d4b\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u7a7a\uff0c\u4e0d\u4e3a\u7a7a\u8fd4\u56de true\u3002 [$a] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\nstr1=\"linux\"\nstr2=\"shell\"\necho \"str1 \u4e3a\uff1a${str1}\"\necho \"str2 \u4e3a\uff1a${str2}\"\nif [ $str1 = $str2 ];then\necho \"$str1 = $str2 : str1 \u7b49\u4e8e str2\"\nelse\necho \"$str1 = $str2: str1 \u4e0d\u7b49\u4e8e str2\"\nfi\nif [ $str1 != $str2 ];then\necho \"$str1 != $str2 : str1 \u4e0d\u7b49\u4e8e str2\"\nelse\necho \"$str1 != $str2: str1 \u7b49\u4e8e str2\"\nfi\nif [ -z $str1 ];then\necho \"-z $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a 0\"\nelse\necho \"-z $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\"\nfi\nif [ -n \"$str1\" ];then\necho \"-n $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\"\nelse\necho \"-n $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a 0\"\nfi\nif [ ${str1} ];then\necho \"str1 : \u5b57\u7b26\u4e32\u4e0d\u4e3a\u7a7a\"\nelse\necho \"str1 : \u5b57\u7b26\u4e32\u4e3a\u7a7a\"\nfi\n</code></pre> <p>\u8fd4\u56de\u4e3a\uff1a</p> <pre><code>str1 \u4e3a\uff1alinux\nstr2 \u4e3a\uff1ashell\nlinux = shell: str1 \u4e0d\u7b49\u4e8e str2\nlinux != shell : str1 \u4e0d\u7b49\u4e8e str2\n-z linux : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\n-n linux : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\nstr1 : \u5b57\u7b26\u4e32\u4e0d\u4e3a\u7a7a   </code></pre> <p>\u4e0d\u8981\u6df7\u6dc6\"=\"\u8d4b\u503c\u64cd\u4f5c\u7b26\u4e0e=\u6d4b\u8bd5\u64cd\u4f5c\u7b26. <pre><code>#    = \u5728\u8fd9\u91cc\u662f\u6d4b\u8bd5\u64cd\u4f5c\u7b26\nstring1=\"hujianli1\"\nstring2=\"hujianli1\"\nif [ \"$string1\" = \"$string2\" ]; then\necho \"$string1  == $string2\"\nfi\n# \u66f4\u5b89\u5168\u7684\u505a\u6cd5\n# \u8fd9\u6837\u53ef\u4ee5\u9632\u6b62\u4e24\u4e2a\u53d8\u91cf\u4e2d\u7684\u4e00\u4e2a\u4e3a\u7a7a\u6240\u4ea7\u751f\u7684\u9519\u8bef.\n# (\u5b57\u7b26\"X\"\u4f5c\u4e3a\u524d\u7f00\u5728\u7b49\u5f0f\u4e24\u8fb9\u662f\u53ef\u4ee5\u76f8\u4e92\u62b5\u6d88\u7684.)\nif [[ \"X${string1}\" == \"X${string2}\" ]]; then\necho \"The two strings are the same\"\nfi\n</code></pre></p> <p>\u7279\u522b\u6ce8\u610f\uff1a\u5728\u4e00\u4e2a\u6df7\u5408\u6d4b\u8bd5\u4e2d, \u5373\u4f7f\u4f7f\u7528\u5f15\u7528\u7684\u5b57\u7b26\u4e32\u53d8\u91cf\u4e5f\u53ef\u80fd\u8fd8\u4e0d\u591f\u3002\u5982\u679cstring\u4e3a\u7a7a\u7684\u8bdd,<code>[ \u2212n \"string\" -o \"a\"=\"b\" ]</code>\u53ef\u80fd\u4f1a\u5728\u67d0\u4e9b\u7248\u672c\u7684Bash\u4e2d\u4ea7\u751f\u9519\u8bef.  \u5b89\u5168\u7684\u505a\u6cd5\u662f\u9644\u52a0\u4e00\u4e2a\u989d\u5916\u7684\u5b57\u7b26\u7ed9\u53ef\u80fd\u7684\u7a7a\u53d8\u91cf, <code>[ \"x$string\" != x -o \"x$a\" = \"x$b\" ]</code> (\"x\"\u5b57\u7b26\u662f\u53ef\u4ee5\u76f8\u4e92\u62b5\u6d88\u7684).</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#26-\u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26","title":"2.6 \u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26","text":"<p>\u6587\u4ef6\u6d4b\u8bd5\u5728\u6211\u4eec\u7f16\u5199 shell \u4e2d\u4e0e\u6587\u4ef6\u64cd\u4f5c\u975e\u5e38\u5e38\u7528\uff0c\u719f\u7ec3\u638c\u63e1\u6587\u4ef6\u64cd\u4f5c\u53ef\u4ee5\u5728\u540e\u7eed\u7684 shell \u7f16\u5199\u4e2d\u5f97\u5fc3\u5e94\u624b\uff0c\u4f8b\u5982 file \u53d8\u91cf\u4e3a:</p> \u64cd\u4f5c\u7b26 \u8bf4\u660e \u4e3e\u4f8b -d file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u76ee\u5f55\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-d $file] \u8fd4\u56de false\u3002 -f file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u666e\u901a\u6587\u4ef6\uff08\u65e2\u4e0d\u662f\u76ee\u5f55\uff0c\u4e5f\u4e0d\u662f\u8bbe\u5907\u6587\u4ef6\uff09\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-f $file] \u8fd4\u56de true\u3002 -c file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5b57\u7b26\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-c $file] \u8fd4\u56de false\u3002 -b file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5757\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-b $file] \u8fd4\u56de false\u3002 -g file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SGID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-g $file] \u8fd4\u56de false\u3002 -u file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SUID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-u $file] \u8fd4\u56de false\u3002 -k file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86\u7c98\u7740\u4f4d (Sticky Bit)\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-k $file] \u8fd4\u56de false\u3002 -p file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u6709\u540d\u7ba1\u9053\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-p $file] \u8fd4\u56de false\u3002 -r file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u8bfb\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-r $file] \u8fd4\u56de true\u3002 -w file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u5199\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-w $file] \u8fd4\u56de true\u3002 -x file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u6267\u884c\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-x $file] \u8fd4\u56de true\u3002 -s file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u4e3a\u7a7a\uff08\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u5927\u4e8e 0\uff09\uff0c\u4e0d\u4e3a\u7a7a\u8fd4\u56de true\u3002 [-s $file] \u8fd4\u56de true\u3002 -e file \u68c0\u6d4b\u6587\u4ef6\uff08\u5305\u62ec\u76ee\u5f55\uff09\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-e $file] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\nTEST_FILE=\"/etc/fstab\"\necho \"\u68c0\u6d4b\u7684\u6587\u4ef6\u4e3a:${TEST_FILE}\"\necho \"\u6587\u4ef6\u4fe1\u606f\u4e3a:$(ls -l ${TEST_FILE})\"\nif [ -r $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u53ef\u8bfb\"\nelse\necho \"\u6587\u4ef6\u4e0d\u53ef\u8bfb\"\nfi\nif [ -w $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u53ef\u5199\"\nelse\necho \"\u6587\u4ef6\u4e0d\u53ef\u5199\"\nfi\nif [ -x $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u53ef\u6267\u884c\"\nelse\necho \"\u6587\u4ef6\u4e0d\u53ef\u6267\u884c\"\nfi\nif [ -f $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u4e3a\u666e\u901a\u6587\u4ef6\"\nelse\necho \"\u6587\u4ef6\u4e3a\u7279\u6b8a\u6587\u4ef6\"\nfi\nif [ -d $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u662f\u4e2a\u76ee\u5f55\"\nelse\necho \"\u6587\u4ef6\u4e0d\u662f\u4e2a\u76ee\u5f55\"\nfi\nif [ -s $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u4e0d\u4e3a\u7a7a\"\nelse\necho \"\u6587\u4ef6\u4e3a\u7a7a\"\nfi\nif [ -e $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u5b58\u5728\"\nelse\necho \"\u6587\u4ef6\u4e0d\u5b58\u5728\"\nfi\n</code></pre> <p>\u8fd4\u56de\u4e3a\uff1a</p> <pre><code>\u68c0\u6d4b\u7684\u6587\u4ef6\u4e3a:/etc/fstab\n\u6587\u4ef6\u4fe1\u606f\u4e3a:-rw-r--r--. 1 root root 500 Jan 17 14:23 /etc/fstab\n\u6587\u4ef6\u53ef\u8bfb\n\u6587\u4ef6\u53ef\u5199\n\u6587\u4ef6\u4e0d\u53ef\u6267\u884c\n\u6587\u4ef6\u4e3a\u666e\u901a\u6587\u4ef6\n\u6587\u4ef6\u4e0d\u662f\u4e2a\u76ee\u5f55\n\u6587\u4ef6\u4e0d\u4e3a\u7a7a\n\u6587\u4ef6\u5b58\u5728\n</code></pre>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#3-\u5b9e\u4f8b","title":"3. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#31-\u9700\u6c42","title":"3.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u4f20\u5165\u4e00\u4e2a linux \u6587\u4ef6\u7cfb\u7edf\u7684\u8def\u5f84\uff0c\u5224\u65ad\u5176\u4e0b\u9762\u6587\u4ef6\u53ca\u76ee\u5f55\u7684\u6570\u91cf\u3002</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#32-\u601d\u8def","title":"3.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26\u6765\u5224\u65ad\u8f93\u51fa\u7684\u76ee\u5f55\u662f\u5426\u6b63\u786e\uff0c\u4e4b\u540e\u5229\u7528\u7b97\u672f\u8fd0\u7b97\u7b26\u914d\u5408\u6570\u7ec4\u5bf9\u6587\u4ef6\u6216\u76ee\u5f55\u8fdb\u884c\u7edf\u8ba1\u3002</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#33-\u5b9e\u73b0","title":"3.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# Description: count file scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: count file\n# Date: 2020-03-08 14:00\n# Version: 1.0\n# \u5224\u65ad\u8f93\u5165\u53c2\u6570\n[ $# -ne 1 ] &amp;&amp; echo \"\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c${0} check_dir\" &amp;&amp; exit 1\n# \u5224\u65ad\u8f93\u5165\u7684\u662f\u5426\u4e3a\u5b58\u5728\u7684\u76ee\u5f55,\u4e0d\u5b58\u5728\u5219\u9000\u51fa\nCHECK_DIR=$1\n[ ! -d ${CHECK_DIR} ] &amp;&amp; echo \"\u68c0\u6d4b\u7cfb\u7edf\u4e0d\u5b58\u5728\u76ee\u5f55\uff1a${CHECK_DIR}, \u8bf7\u8f93\u5165\u6b63\u786e\u7684\u76ee\u5f55\" &amp;&amp; exit 1\n# \u5bf9\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u7edf\u8ba1\nDIR_NUM=0\nFILE_NUM=0\nOTHER_NUM=0\nfor item in ${CHECK_DIR}/*\ndo\nif [ -d ${item} ];then\n# \u5982\u679c\u4e3a\u76ee\u5f55\uff0c\u5219\u76ee\u5f55\u603b\u6570\u52a0\u4e00\nDIR_NUM=$((${DIR_NUM}+1))\nelif [ -f ${item} ];then\nFILE_NUM=$((${FILE_NUM}+1))\nelse\nOTHER_NUM=$((${OTHER_NUM}+1))\nfi\ndone\necho \"\u68c0\u6d4b\u76ee\u5f55\u4e3a\uff1a${CHECK_DIR}\"\necho \"\u6587\u4ef6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a${FILE_NUM}\"\necho \"\u76ee\u5f55\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a${DIR_NUM}\"\necho \"\u5176\u4ed6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a${OTHER_NUM}\"\n[root@master scripts]# bash count_file.sh \n\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0ccount_file.sh check_dir\n[root@master scripts]# bash count_file.sh aaaa\n\u68c0\u6d4b\u7cfb\u7edf\u4e0d\u5b58\u5728\u76ee\u5f55\uff1aaaaa, \u8bf7\u8f93\u5165\u6b63\u786e\u7684\u76ee\u5f55\n[root@master scripts]# bash count_file.sh /tmptmptmp\n\u68c0\u6d4b\u7cfb\u7edf\u4e0d\u5b58\u5728\u76ee\u5f55\uff1a/tmptmptmp, \u8bf7\u8f93\u5165\u6b63\u786e\u7684\u76ee\u5f55\n[root@master scripts]# bash count_file.sh /\n\u68c0\u6d4b\u76ee\u5f55\u4e3a\uff1a/\n\u6587\u4ef6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a0\n\u76ee\u5f55\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a23\n\u5176\u4ed6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a0\n[root@master scripts]# bash count_file.sh /root\n\u68c0\u6d4b\u76ee\u5f55\u4e3a\uff1a/root\n\u6587\u4ef6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a8\n\u76ee\u5f55\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a5\n\u5176\u4ed6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a0\n[root@master scripts]# bash count_file.sh /dev/\n\u68c0\u6d4b\u76ee\u5f55\u4e3a\uff1a/dev/\n\u6587\u4ef6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a1\n\u76ee\u5f55\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a19\n\u5176\u4ed6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a139\n</code></pre> <p>\u5f53\u6211\u4eec\u4e0d\u8f93\u5165\u4efb\u4f55\u53c2\u6570\u7684\u65f6\u5019\uff0c\u63d0\u793a\u9700\u8981\u8f93\u5165\u4e00\u4e2a\u8def\u5f84\u53c2\u6570\uff0c\u8f93\u5165\u4e86\u6587\u4ef6\u540d\u79f0\u6216\u4e0d\u5b58\u5728\u7684\u8def\u5f84\u65f6\uff0c\u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26\u5224\u65ad\u8f93\u5165\u5f02\u5e38\uff0c\u4e0d\u662f\u4e00\u4e2a\u6709\u6548\u7684\u6587\u4ef6\u76ee\u5f55\u3002</p> <p>\u5f53\u6211\u4eec\u8f93\u5165\u6b63\u5e38\u7684\u76ee\u5f55\u65f6\uff0c\u5373\u53ef\u83b7\u5f97\u6b63\u786e\u7684\u76ee\u5f55\u6216\u6587\u4ef6\u6570\u3002</p>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#4-\u6ce8\u610f\u4e8b\u9879","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5bf9\u4e8e\u7b97\u672f\u8fd0\u7b97\uff0c\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u573a\u666f\u548c\u73af\u5883\u6765\u9009\u62e9\uff0c\u4f8b\u5982\u7cfb\u7edf\u5185\u6ca1\u6709\u8ba1\u7b97\u5de5\u5177\u7b49\uff0c\u53ef\u4ee5\u4f18\u5148\u9009\u62e9 <code>[]</code> \u548c <code>(())</code> \u6765\u8fdb\u884c\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u559c\u597d\u9009\u62e9\u3002</li> <li>\u5bf9\u4e8e\u5173\u7cfb\u8fd0\u7b97\uff0c\u6bd4\u8f83\u7684\u6570\u5b57\uff0c\u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u4e00\u5b9a\u8981\u7262\u8bb0\u8fd9\u4e2a\u6ce8\u610f\u70b9\uff0c\u5bf9\u4e8e\u5b57\u7b26\u4e32\u5224\u65ad\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u8fd0\u7b97\u7b26\u3002</li> <li>\u5bf9\u4e8e\u5e03\u5c14\u8fd0\u7b97\u548c\u903b\u8f91\u8fd0\u7b97\u5176\u5b9e\u662f\u4e00\u4e2a\u4e1c\u897f\uff0c\u53ea\u4e0d\u8fc7\u5e03\u5c14\u8fd0\u7b97\u7b26\u6709\u4e00\u4e2a\u975e\u8fd0\u7b97\uff0c\u53ef\u4ee5\u8fdb\u884c\u7075\u6d3b\u8fd0\u7528\u3002</li> <li>\u6587\u4ef6\u6d4b\u8bd5\u7b26\u5e38\u7528\u4e0e\u5224\u65ad linux \u7cfb\u7edf\u6587\u4ef6\u7684\u64cd\u4f5c\uff0c\u5728\u540e\u671f shell \u7f16\u7a0b\u53ef\u8c13\u4e3e\u8db3\u8f7b\u91cd\uff0c\u7262\u8bb0\u6bcf\u4e2a\u6587\u4ef6\u8fd0\u7b97\u7b26\u4f1a\u4f7f\u5f97\u540e\u671f\u7f16\u7a0b\u5f97\u5fc3\u5e94\u624b\u3002</li> </ul>"},{"location":"Linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#5-\u5c0f\u7ed3","title":"5. \u5c0f\u7ed3","text":"<p>\u8fd0\u7b97\u7b26\u53ef\u8c13 Shell \u811a\u672c\u7684\u7075\u9b42\uff0c\u540e\u671f\u6211\u4eec\u7684\u5faa\u73af\u548c\u5224\u65ad\u91cc\u9762\u7684\u6761\u4ef6\u90fd\u662f\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u6784\u6210\uff0c\u5b83\u662f\u6d41\u7a0b\u6846\u67b6\u7684\u57fa\u7840\uff0c\u719f\u7ec3\u638c\u63e1\u8fd0\u7b97\u7b26\u7684\u5206\u7c7b\u53ca\u6bcf\u4e2a\u7684\u7528\u6cd5\uff0c\u901a\u8fc7\u52a8\u624b\u5b9e\u8df5\u533a\u5206\u5176\u7279\u5f81\uff0c\u4e3e\u4e00\u53cd\u4e09\u7075\u6d3b\u8fd0\u7528\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/","title":"6.Shell echo/printf \u547d\u4ee4","text":""},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#1-shell-\u663e\u793a\u547d\u4ee4","title":"1. Shell \u663e\u793a\u547d\u4ee4","text":""},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#11-shell-\u663e\u793a\u547d\u4ee4","title":"1.1 Shell \u663e\u793a\u547d\u4ee4","text":"<p>\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0cShell \u4e5f\u6709\u5b57\u7b26\u4e32\u7684\u8f93\u51fa\u53ca\u683c\u5f0f\u5316\u5b57\u7b26\u7684\u9700\u6c42\uff0c\u5728\u672c\u7ae0\u8282\u6211\u4eec\u7740\u91cd\u8bb2\u89e3 Shell \u4e2d\u7684 echo \u4e0e printf \u547d\u4ee4\uff0c\u7075\u6d3b\u8fd0\u7528\u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c\u57fa\u672c\u4e0a\u5c31\u80fd\u6ee1\u8db3\u6211\u4eec\u5728 Shell \u7f16\u5199\u4e2d\u7684\u5927\u591a\u6570\u663e\u793a\u8f93\u51fa\u53ca\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7684\u9700\u6c42\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u663e\u793a\u547d\u4ee4","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u663e\u793a\u547d\u4ee4","text":"<p>\u5728\u6211\u4eec\u7f16\u5199 Shell \u811a\u672c\u7684\u65f6\u5019\u9700\u8981\u4e3a\u7528\u6237\u63d0\u4f9b\u4fe1\u606f\u63d0\u793a\u4ee5\u53ca\u4ea4\u4e92\u5f0f\u663e\u793a\uff0c\u4e5f\u5b58\u5728\u9700\u8981\u8bb0\u5f55\u811a\u672c\u7684\u6267\u884c\u65e5\u5fd7\u7b49\uff0c\u6b64\u65f6\u90fd\u9700\u8981\u6211\u4eec\u6765\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\uff0c\u5229\u7528 Shell \u7684\u663e\u793a\u547d\u4ee4\u4e5f\u79f0\u8f93\u51fa\u547d\u4ee4\u6765\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#2-shell-\u663e\u793a-echo-\u547d\u4ee4\u64cd\u4f5c","title":"2. Shell \u663e\u793a echo \u547d\u4ee4\u64cd\u4f5c","text":"<p>\u6211\u4eec\u660e\u786e\u4e86 Shell \u663e\u793a\u547d\u4ee4\u7684\u542b\u4e49\u53ca\u4f5c\u7528\uff0c\u9996\u9009\u8ba9\u6211\u4eec\u6765\u770b echo \u547d\u4ee4\u53ca\u57fa\u672c\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#21-echo-\u8bed\u6cd5","title":"2.1 echo \u8bed\u6cd5","text":"<p>echo \u547d\u4ee4\u8bed\u6cd5\u975e\u5e38\u7b80\u5355\uff1a<code>echo [option] [arguments]</code>\uff0c\u5176\u4e2d\u6839\u636e <code>option</code> \u7684\u4e0d\u540c\uff0c\u8d4b\u4e88\u4e86 echo \u5f88\u591a\u5f3a\u5927\u7684\u529f\u80fd\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#22-echo-\u5e38\u7528\u64cd\u4f5c","title":"2.2 echo \u5e38\u7528\u64cd\u4f5c","text":""},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#221-\u6253\u5370\u666e\u901a\u5b57\u7b26\u4e32","title":"2.2.1 \u6253\u5370\u666e\u901a\u5b57\u7b26\u4e32","text":"<p>\u901a\u5e38\u9ed8\u8ba4\u4e0d\u5e26\u53c2\u6570\u5c31\u662f\u5904\u7406\u6253\u5370\u666e\u901a\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo \"hello shell\"\nhello shell\n</code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#222-\u4e0d\u6362\u884c\u8f93\u51fa","title":"2.2.2 \u4e0d\u6362\u884c\u8f93\u51fa","text":"<p>\u9ed8\u8ba4 echo \u8f93\u51fa\u666e\u901a\u5b57\u7b26\u4e32\u4e3a\u81ea\u52a8\u6362\u884c\u7684\uff0c\u5982\u679c\u4e0d\u60f3\u8f93\u51fa\u81ea\u52a8\u6362\u884c\uff0c\u53ef\u4ee5\u6dfb\u52a0\u9009\u9879 <code>-n</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo -n \"hello shell\"\nhello shell[root@master ~]# \n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6b64\u65f6\u8f93\u51fa\u5c31\u4e0d\u81ea\u52a8\u6362\u884c\uff0c\u8be5\u9700\u6c42\u53ef\u4ee5\u5728\u6211\u4eec\u5199\u6587\u4ef6\u7684\u65f6\u5019\u4f7f\u7528\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#223-\u8f93\u51fa\u53d8\u91cf","title":"2.2.3 \u8f93\u51fa\u53d8\u91cf","text":"<p>\u5728\u6211\u4eec\u524d\u9762\u8bb2\u89e3\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u6709\u63d0\u5230\u8fc7\u5728\u5f15\u7528\u53d8\u91cf\u7684\u65f6\u5019\u53ef\u4ee5\u5229\u7528 <code>echo</code> \u547d\u4ee4\uff0c\u4f46\u662f\u6b64\u65f6\u9700\u8981\u6211\u4eec\u6ce8\u610f\u5355\u5f15\u53f7\u4e0e\u53cc\u5f15\u53f7\u7684\u533a\u522b\u3002</p> <ul> <li>\u5355\u5f15\u53f7</li> </ul> <p>\u5355\u5f15\u53f7\u4e3a\u5c06\u53d8\u91cf\u540d\u539f\u6837\u8f93\u51fa\uff0c\u4e0d\u5f15\u7528\u5176\u7684\u503c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# STR1=\"hello shell\"\n[root@master ~]# echo '${STR1}'\n${STR1}\n</code></pre> <ul> <li>\u53cc\u5f15\u53f7</li> </ul> <p>\u53cc\u5f15\u53f7\u4e3a\u5f15\u7528\u53d8\u91cf\u7684\u503c\u8fdb\u884c\u8f93\u51fa\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo \"${STR1}\"\nhello shell\n[root@master ~]# echo ${STR1}\nhello shell\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5728\u7ec8\u7aef\u5982\u679c\u4e0d\u663e\u5f0f\u4e66\u5199\u5f15\u53f7\uff0c\u9ed8\u8ba4\u5c31\u4e3a\u53cc\u5f15\u53f7\uff0c\u4e5f\u5c31\u662f\u5f15\u7528\u6211\u4eec\u53d8\u91cf\u7684\u503c\uff0c\u4f46\u662f\u6211\u4eec\u5728\u7f16\u5199 Shell \u811a\u672c\u7684\u65f6\u5019\u5c3d\u53ef\u80fd\u5730\u663e\u793a\u5199\u4e0a\u5f15\u53f7\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u5f02\u5e38\u53d1\u751f\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#224--e-\u8f6c\u4e49","title":"2.2.4 -e \u8f6c\u4e49","text":"<p><code>echo</code> \u547d\u4ee4\u4f7f\u7528 <code>-e</code> \u9009\u9879\u53ef\u4ee5\u5f00\u542f\u8f6c\u4e49\uff0c\u5904\u7406\u7279\u6b8a\u5b57\u7b26\u3002</p> <ul> <li><code>\\n</code>: \u6362\u884c\u7b26\u53f7</li> </ul> <pre><code>[root@master ~]# echo -e \"hello\\nshell\" \nhello\nshell\n</code></pre> <ul> <li><code>\\t</code>: \u5236\u8868\u7b26\uff0c\u4e5f\u5c31\u662f\u6309\u6211\u4eec\u7684 tab \u952e</li> </ul> <pre><code>[root@master ~]# echo -e \"hello\\tshell\" \nhello   shell\n</code></pre> <ul> <li><code>\\r</code>: \u56de\u8f66\u952e\uff0cRETURN</li> </ul> <pre><code>[root@master ~]# echo -e \"hello\\r\"    \nhello       </code></pre> <ul> <li><code>\\a</code>: \u4ece\u7cfb\u7edf\u5587\u53ed\u9001\u51fa\u94c3\u58f0\uff0cALERT</li> </ul> <pre><code>    [root@master ~]# echo -e \"\\a\"\n</code></pre> <ul> <li><code>\\\\</code>\uff1a\u663e\u793a\u53cd\u659c\u7ebf\u672c\u8eab</li> </ul> <pre><code>[root@master ~]# echo -e \"hello \\\\ shell\"\nhello \\ shell\n</code></pre> <ul> <li><code>\\f</code>:FORMFEED\uff0c\u6362\u9875\u5b57\u7b26</li> </ul> <pre><code>[root@master ~]# echo -e \"hello\\fshell\" \nhello\n     shell\n</code></pre> <ul> <li><code>\\E</code>:ESCAPE\uff0c\u8df3\u8131\u952e</li> </ul> <pre><code>[root@master ~]# echo -e \"hello \\Eshell\"\nhello hell\n</code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#225-\u6587\u4ef6\u64cd\u4f5c","title":"2.2.5 \u6587\u4ef6\u64cd\u4f5c","text":"<ul> <li>\u521b\u5efa\u6587\u4ef6</li> </ul> <p>\u53ef\u4ee5\u5229\u7528 echo \u547d\u4ee4\u6765\u521b\u5efa\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# ls test.sh\nls: cannot access test.sh: No such file or directory\n[root@master ~]# echo \"hello shell\" &gt;test.sh\n[root@master ~]# cat test.sh \nhello shell\n[root@master ~]#\n</code></pre> <p>\u5982\u679c\u9700\u8981\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u5199\u5165\u7b80\u5355\u5185\u5bb9\uff0c\u4e0d\u7528\u521b\u5efa\u6587\u4ef6\u7136\u540e\u6253\u5f00\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528 echo \u547d\u4ee4\u5c06\u5185\u5bb9\u8f93\u5165\u5230\u6587\u4ef6\u4e2d\uff0c\u6587\u4ef6\u4f1a\u81ea\u52a8\u521b\u5efa\u3002</p> <ul> <li>\u6e05\u7a7a\u6587\u4ef6</li> </ul> <p>\u53ef\u4ee5\u5229\u7528 echo \u6765\u6e05\u7a7a\u6587\u4ef6\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# cat test.sh \nhello shell\n[root@master ~]# echo &gt;test.sh \n[root@master ~]# cat test.sh \n</code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#226-\u611f\u53f9\u53f7","title":"2.2.6 \u611f\u53f9\u53f7","text":"<p>\u5728 echo \u4e2d\uff0c\u5982\u679c\u4f7f\u7528\u53cc\u5f15\u53f7\u5176\u4e2d\u5e26\u6709 <code>!</code> \u5219\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u8fd9\u662f\u56e0\u4e3a\u9ed8\u8ba4 Shell \u5f00\u542f\u4e86\u611f\u53f9\u53f7\u5f15\u7528\u5185\u5b58\u4e2d\u7684\u5386\u53f2\u547d\u4ee4\uff0c\u53ef\u4ee5\u5229\u7528 <code>set +H</code> \u8fdb\u884c\u5173\u95ed\uff0c\u5982\u679c\u4e0d\u5173\u95ed\u8be5\u8bbe\u7f6e\u8fd8\u60f3\u4f7f\u7528\u611f\u53f9\u53f7\uff0c\u53ef\u4ee5\u4f7f\u7528\u5355\u5f15\u53f7\u3002</p> <pre><code>[root@master ~]# echo \"hello !\"\n-bash: !\": event not found\n[root@master ~]# echo 'hello !'\nhello !\n</code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#227-\u989c\u8272\u8f93\u51fa","title":"2.2.7 \u989c\u8272\u8f93\u51fa","text":"<p>\u5728 Shell \u4e2d\u6211\u4eec\u6709\u65f6\u5019\u9700\u8981\u4e0e\u7528\u6237\u8fdb\u884c\u4ea4\u4e92\u5f0f\u64cd\u4f5c\uff0c\u5982\u679c\u8f93\u51fa\u7684\u5185\u5bb9\u6709\u989c\u8272\uff0c\u5bf9\u4e8e\u7528\u6237\u8bc6\u522b\u66f4\u4e3a\u660e\u663e\u3002Shell \u4e2d echo \u53ef\u4ee5\u5bf9\u5b57\u4f53\u989c\u8272 / \u80cc\u666f / \u663e\u793a\u65b9\u5f0f\u8fdb\u884c\u63a7\u5236\uff0c\u5982\u4e0b\u8868\uff1a</p> \u5b57\u4f53\u989c\u8272 \u5b57\u4f53\u80cc\u666f\u989c\u8272 \u663e\u793a\u65b9\u5f0f 30\uff1a\u9ed1 40\uff1a\u9ed1 31\uff1a\u7ea2 41\uff1a\u6df1\u7ea2 0\uff1a\u7ec8\u7aef\u9ed8\u8ba4\u8bbe\u7f6e 32\uff1a\u7eff 42\uff1a\u7eff 1\uff1a\u9ad8\u4eae\u663e\u793a 33\uff1a\u9ec4 43\uff1a\u9ec4\u8272 4\uff1a\u4e0b\u5212\u7ebf 34\uff1a\u84dd\u8272 44\uff1a\u84dd\u8272 5\uff1a\u95ea\u70c1 35\uff1a\u7d2b\u8272 45\uff1a\u7d2b\u8272 7\uff1a\u53cd\u767d\u663e\u793a 36\uff1a\u6df1\u7eff 46\uff1a\u6df1\u7eff 8\uff1a\u9690\u85cf 37\uff1a\u767d\u8272 47\uff1a\u767d\u8272 \u683c\u5f0f\uff1a \\033[1;31;40m # 1 \u662f\u663e\u793a\u65b9\u5f0f\uff0c\u53ef\u9009\u300231 \u662f\u5b57\u4f53\u989c\u8272\u300240m \u662f\u5b57\u4f53\u80cc\u666f\u989c\u8272\u3002 \\033[0m # \u6062\u590d\u7ec8\u7aef\u9ed8\u8ba4\u989c\u8272\uff0c\u5373\u53d6\u6d88\u989c\u8272\u8bbe\u7f6e\u3002 <ul> <li>\u663e\u793a\u65b9\u5f0f</li> </ul> <pre><code>for i in {1..8};do echo -e \"\\033[$i;31;40m hello shell \\033[0m\";done\n</code></pre> <ul> <li>\u5b57\u4f53\u989c\u8272</li> </ul> <pre><code>for i in {30..37};do echo -e \"\\033[$i;40m hello shell \\033[0m\";done\n</code></pre> <ul> <li>\u80cc\u666f\u989c\u8272</li> </ul> <pre><code>for i in {40..47};do echo -e \"\\033[47;${i}m hello shell \\033[0m\";done\n</code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#3-shell-\u4e2d-printf-\u547d\u4ee4\u64cd\u4f5c","title":"3. Shell \u4e2d printf \u547d\u4ee4\u64cd\u4f5c","text":"<p>\u6211\u4eec\u5b66\u4e60\u4e86 echo \u547d\u4ee4\uff0c\u5b83\u901a\u5e38\u7528\u4e8e\u5904\u7406\u5e38\u89c4\u7684\u9700\u6c42\uff0c\u8fd8\u6709\u4e00\u4e9b\u66f4\u9ad8\u7ea7\u7684\u9700\u6c42\uff0c\u4f8b\u5982\u6211\u4eec\u5e0c\u671b\u8f93\u51fa\u5185\u5bb9\u6307\u5b9a\u5b57\u7b26\u7684\u5bbd\u5ea6\uff0c\u5de6\u53f3\u5bf9\u9f50\uff0c\u683c\u5f0f\u5c0f\u6570\u8f93\u51fa\u7b49\uff0c\u6b64\u573a\u666f\u4e0b\u9700\u8981\u5229\u7528 <code>printf</code> \u547d\u4ee4\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#31-printf-\u8bed\u6cd5","title":"3.1 printf \u8bed\u6cd5","text":"<p>printf \u529f\u80fd\u4e3a\u683c\u5f0f\u5316\u6253\u5370\u6570\u636e\uff0c\u8bed\u6cd5\u4e3a\uff1a<code>printf format-string [arguments]</code>\u3002</p> <ul> <li>format-string: \u4e3a\u683c\u5f0f\u63a7\u5236\u5b57\u7b26\u4e32\uff1b</li> <li>arguments: \u4e3a\u53c2\u6570\u5217\u8868\u3002</li> </ul>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#32-printf-\u6ce8\u610f\u70b9","title":"3.2 printf \u6ce8\u610f\u70b9","text":"<p>\u5176\u5f15\u7528 C \u8bed\u8a00\u4e2d\u7684 <code>printf</code> \u547d\u4ee4\uff0c\u4f46 \u4e5f\u6709\u4e00\u4e9b\u533a\u522b\uff0c\u9700\u8981\u6ce8\u610f\uff1a</p> <ul> <li>printf \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u672b\u5c3e\u4e0d\u52a0\u6362\u884c\u7b26\u53f7\uff0c\u6240\u4ee5\u5982\u679c\u9700\u8981\u6362\u884c\uff0c\u9700\u8981\u663e\u793a\u624b\u52a8\u6dfb\u52a0 <code>\\n</code>;</li> <li>printf \u4e3a\u683c\u5f0f\u5316\u8f93\u51fa\u4e0d\u5bf9\u5185\u5bb9\u505a\u6539\u53d8\u64cd\u4f5c\uff0c\u5c24\u5176\u5728\u6d6e\u70b9\u6570\u8f93\u51fa\u7684\u65f6\u5019\uff0c\u5bf9\u5176\u7ed3\u679c\u4e0d\u8fdb\u884c\u6539\u53d8\uff0c\u8fd9\u662f\u73b0\u5b9e\u7ed3\u679c\u6709\u5dee\u5f02\uff1b</li> <li>\u5728 printf \u4e2d\u5e74 arguments \u4e3a\u53c2\u6570\u5217\u8868\uff0c\u4f8b\u5982\u5b57\u7b26\u4e32\u6216\u8005\u53d8\u91cf\uff0c\u5efa\u8bae\u4e2a\u6570\u4e0e format-string \u8981\u6c42\u7684\u6570\u91cf\u76f8\u540c\uff1b</li> <li>printf \u4e0d\u7528\u52a0\u62ec\u53f7\uff0carguments \u4f7f\u7528\u7a7a\u683c\u5206\u9694\uff0c\u4e0d\u7528\u9017\u53f7\u3002</li> </ul>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#33-printf-\u5e38\u7528\u64cd\u4f5c","title":"3.3 printf \u5e38\u7528\u64cd\u4f5c","text":""},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#331-\u6253\u5370\u666e\u901a\u5b57\u7b26\u4e32","title":"3.3.1 \u6253\u5370\u666e\u901a\u5b57\u7b26\u4e32","text":"<pre><code>[root@master ~]# printf \"hello shell\"\nhello shell[root@master ~]# printf \"hello shell\\n\"\nhello shell\n</code></pre> <p>\u5982\u679c\u9700\u8981\u6362\u884c\uff0c\u9700\u8981\u624b\u52a8\u663e\u5f0f\u6dfb\u52a0 <code>\\n</code>\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#332-\u683c\u5f0f\u5b57\u7b26\u4e32","title":"3.3.2 \u683c\u5f0f\u5b57\u7b26\u4e32","text":"<p>\u5728\u638c\u63e1 printf \u524d\u9700\u8981\u5148\u4e86\u89e3 <code>format-string</code>\uff0c\u5176\u5bf9\u5e94\u7740\u4e0d\u540c\u7684\u542b\u4e49\uff0c\u5728\u6b64\u6211\u4eec\u4ecb\u7ecd\u6700\u5e38\u7528\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\u3002</p> <ul> <li><code>%s</code></li> </ul> <p>\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\uff0c\u5176\u4e2d <code>%s</code> \u5c31\u662f\u5f15\u7528\u540e\u9762\u7684\u5b57\u7b26 <code>shell</code></p> <pre><code>[root@master ~]# printf \"hello %s\\n\" shell\nhello shell\n</code></pre> <ul> <li><code>%d</code></li> </ul> <p>\u5341\u8fdb\u5236\u6574\u6570</p> <pre><code>[root@master ~]# printf \"age: %d\\n\" 20      \nage: 20\n</code></pre> <ul> <li>\u5de6\u5bf9\u9f50</li> </ul> <p>printf \u53ef\u4ee5\u4f7f\u5f97\u5de6\u5bf9\u9f50\uff0c\u4f8b\u5982 <code>%-10s</code> \u6307\u4e00\u4e2a\u5bbd\u5ea6\u4e3a 10 \u4e2a\u5b57\u7b26\uff0c\u5de6\u5bf9\u9f50\u5229\u7528 <code>-</code> \u8868\u793a\uff0c\u4efb\u4f55\u5b57\u7b26\u90fd\u4f1a\u88ab\u663e\u793a\u5728 10 \u4e2a\u5b57\u7b26\u5bbd\u7684\u5b57\u7b26\u5185\uff0c\u5982\u679c\u4e0d\u8db3\u5219\u81ea\u52a8\u4ee5\u7a7a\u683c\u586b\u5145\uff0c\u8d85\u8fc7\u4e5f\u4f1a\u5c06\u5185\u5bb9\u5168\u90e8\u663e\u793a\u51fa\u6765\u3002</p> <pre><code>[root@master ~]# printf \"hello %-10s%s\\n\" shell \u3002      \nhello shell     \u3002\n</code></pre> <ul> <li>\u53f3\u8fb9\u5bf9\u9f50</li> </ul> <p>\u53f3\u5bf9\u9f50\u5229\u7528 <code>+</code> \u8868\u793a\uff0c<code>%+10.2f</code> \u6307\u683c\u5f0f\u5316\u4e3a\u5c0f\u6570\uff0c\u5176\u4e2d 10 \u8868\u793a 4 \u4e2a\u5b57\u7b26\u5bbd\u5ea6\uff0c.2 \u6307\u4fdd\u7559 2 \u4f4d\u5c0f\u6570\u3002</p> <pre><code>[root@master ~]# printf \"hello %+10s%s\\n\" shell \u3002 \nhello      shell\u3002\n\n[root@master ~]# printf \"hello %+10.2f %s\\n\" 3.1415 \u3002   \nhello      +3.14 \u3002\n</code></pre> <ul> <li>\u5176\u4ed6</li> </ul> <p>\u5f53\u7136\u4e00\u4e9b\u5176\u4ed6\u683c\u5f0f\u5316\u5b57\u7b26\uff0c\u5728\u6b64\u4e3e\u4f8b\u6700\u5e38\u7528\u7684\uff0c\u5176\u4ed6\u7684\u53ef\u53c2\u8003\u5982\u4e0b\uff1a</p> <pre><code>%c ASCII\u5b57\u7b26.\u663e\u793a\u76f8\u5bf9\u5e94\u53c2\u6570\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\n%d,%i \u5341\u8fdb\u5236\u6574\u6570\uff08\u5e38\u7528\uff09\n%e \u6d6e\u70b9\u683c\u5f0f([-d].precisione [+-dd])\n%E \u6d6e\u70b9\u683c\u5f0f([-d].precisionE [+-dd])\n%g %e\u6216%f\u8f6c\u6362,\u770b\u54ea\u4e00\u4e2a\u8f83\u77ed,\u5219\u5220\u9664\u7ed3\u5c3e\u7684\u96f6\n%G %E\u6216%f\u8f6c\u6362,\u770b\u54ea\u4e00\u4e2a\u8f83\u77ed,\u5219\u5220\u9664\u7ed3\u5c3e\u7684\u96f6\n%s \u5b57\u7b26\u4e32\uff08\u5e38\u7528\uff09\n%u \u4e0d\u5e26\u6b63\u8d1f\u53f7\u7684\u5341\u8fdb\u5236\u503c\n%x \u4e0d\u5e26\u6b63\u8d1f\u53f7\u7684\u5341\u516d\u8fdb\u5236.\u4f7f\u7528a\u81f3f\u8868\u793a10\u81f315\n%% \u5b57\u9762\u610f\u4e49\u7684%\n%X \u4e0d\u5e26\u6b63\u8d1f\u53f7\u7684\u5341\u516d\u8fdb\u5236.\u4f7f\u7528A\u81f3F\u8868\u793a10\u81f315\n</code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#333-\u5176\u4ed6","title":"3.3.3 \u5176\u4ed6","text":"<ul> <li>\u5355\u53cc\u5f15\u53f7</li> </ul> <p>\u5728 printf \u4e2d\uff0c\u5355\u53cc\u5f15\u53f7\u90fd\u4e00\u81f4\u3002</p> <pre><code>[root@master ~]# printf \"hello %s\\n\" shell\nhello shell\n[root@master ~]# printf 'hello %s\\n' shell \nhello shell\n</code></pre> <ul> <li>\u683c\u5f0f\u53ea\u6307\u5b9a\u4e86\u4e00\u4e2a\u53c2\u6570\uff0c\u4f46\u591a\u51fa\u7684\u53c2\u6570\u4ecd\u7136\u4f1a\u6309\u7167\u8be5\u683c\u5f0f\u8f93\u51fa\uff0cformat-string \u88ab\u91cd\u7528\u8fdb\u884c\u591a\u884c\u8f93\u51fa</li> </ul> <pre><code>[root@master ~]# printf 'hello %s\\n' shell python go\nhello shell\nhello python\nhello go\n\n[root@master ~]# printf \"%s %s %s %s\\n\" a b c d e f g h i j\na b c d\ne f g h\ni j  </code></pre> <ul> <li>\u5982\u679c\u6ca1\u6709 arguments\uff0c\u90a3\u4e48\u5219\u5bf9\u5e94\u4f7f\u7528\u9ed8\u8ba4\u503c\u8868\u793a\uff0c % s \u7528 NULL \u4ee3\u66ff\uff0c% d \u7528 0 \u4ee3\u66ff</li> </ul> <pre><code>[root@master ~]# printf \"%s default  %d \\n\" \ndefault  0 </code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#334-printf-\u8f6c\u4e49","title":"3.3.4 printf \u8f6c\u4e49","text":"<p>printf \u7684\u8f6c\u4e49\u4e0e echo \u4e2d\u7684\u4e00\u81f4\uff0c\u53ef\u53c2\u8003 echo \u4e2d\u7684\u8f6c\u4e49\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#4-\u5b9e\u4f8b","title":"4. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#41-\u9700\u6c42","title":"4.1 \u9700\u6c42","text":"<p>\u4f8b\u5982\u7ed9\u51fa\u5982\u4e0b nginx \u7684\u8bbf\u95ee\u65e5\u5fd7\uff0c\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u5206\u6790\u5e76\u4e14\u8f93\u51fa\u4e0d\u540c\u7684\u72b6\u6001\u5417\uff0c\u5229\u7528\u989c\u8272\u4e0d\u540c\u8fdb\u884c\u533a\u5206\u4e0d\u540c\u7684\u72b6\u6001\u7801\u3002</p> <pre><code>112.65.61.117 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/chunk-2eca3a5a.2f1d5ea3.js HTTP/1.1\" 200 5276 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/chunk-91d36e6e.a1444c20.js HTTP/1.1\" 200 12674 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/chunk-vendors.3a6c246c.js HTTP/1.1\" 404  260490 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) Apessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/app.ec4e6290.js HTTP/1.1\" 200 11149 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /js/chunk-vendors.3a6c246c.js HTTP/1.1\" 200 260482 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /api/2 HTTP/1.1\" 500 502 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /js/chunk-2eca3a5a.2f1d5ea3.js HTTP/1.1\" 200 5276 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /css/chunk-91d36e6e.a5cb4df4.css HTTP/1.1\" 200 1133 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /js/chunk-03341f87.78501520.js HTTP/1.1\" 200 1059 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /js/chunk-91d36e6e.a1444c20.js HTTP/1.1\" 200 12674 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:56 +0800] \"GET /api/1 HTTP/1.1\" 500 39193 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:56 +0800] \"GET /img/download.f4b65200.png HTTP/1.1\" 200 7737 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:57 +0800] \"GET /img/background.fc2d80f1.png HTTP/1.1\" 200 57711 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:57 +0800] \"GET /img/peitu.a89ef99f.svg HTTP/1.1\" 301 106569 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:57 +0800] \"GET /fonts/element-icons.535877f5.woff HTTP/1.1\" 200 28200 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:59 +0800] \"GET /img/download.f4b65200.png HTTP/1.1\" 200 7737 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:59 +0800] \"GET /img/scan.d3d981fc.png HTTP/1.1\" 404 39193 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:59 +0800] \"GET /img/background.fc2d80f1.png HTTP/1.1\" 200 57711 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:11:00 +0800] \"GET /img/peitu.a89ef99f.svg HTTP/1.1\" 200 106569 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n14.106.162.188 - - [05/Nov/2019:17:14:40 +0800] \"GET /index HTTP/1.1\" 200 535 \"-\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.8(0x17000820) NetType/4G Language/zh_CN\" \"-\"\n14.106.162.188 - - [05/Nov/2019:17:14:40 +0800] \"GET /css/app.7d918353.css HTTP/1.1\" 200 1290 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.8(0x17000820) NetType/4G Language/zh_CN\" \"-\"\n14.106.162.188 - - [05/Nov/2019:17:14:40 +0800] \"GET /js/app.ec4e6290.js HTTP/1.1\" 404 11149 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.8(0x17000820) NetType/4G Language/zh_CN\" \"-\"\n</code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#42-\u601d\u8def","title":"4.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u4e0a\u8282\u8bfe\u7684\u6570\u7ec4\u8fdb\u884c\u72b6\u6001\u5b58\u50a8\uff0c\u4e4b\u540e\u5229\u7528\u7edf\u8ba1\u6bcf\u4e2a\u72b6\u6001\u7684\u6570\u91cf\u6765\u5229\u7528 echo \u989c\u8272\u8fdb\u884c\u533a\u5206\u663e\u793a\u3002</p>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#43-\u5b9e\u73b0","title":"4.3 \u5b9e\u73b0","text":"<ul> <li>\u5c06 nginx \u8bbf\u95ee\u65e5\u5fd7\u6587\u4ef6\u5b58\u50a8\u4e3a nginx.log\uff0c\u53ef\u4ee5\u5229\u7528 cat \u547d\u4ee4\u6765\u521b\u5efa\u6587\u4ef6</li> </ul> <pre><code>cat &gt; nginx.log &lt;&lt;EOF\n112.65.61.117 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/chunk-2eca3a5a.2f1d5ea3.js HTTP/1.1\" 200 5276 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n...\nEOF\n</code></pre> <ul> <li>\u7f16\u5199\u4ee3\u7801\uff0c\u5176\u4e2d\u4e3a\u4eec\u5229\u7528 cut \u5bf9 nginx \u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u5206\u5272\uff0c\u72b6\u6001\u7801\u7684\u5217\u5c3e\u7b2c\u4e5d\u5217\u3002</li> </ul> <pre><code>#!/bin/bash\n# Description: nginx status\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: nginx status check\n# Date: 2020-03-21 14:00\n# Version: 1.0\n# \u5bf9\u8f93\u5165\u7684nginx\u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u5224\u65ad\nNGINX_LOG=$1\n# \u5b9a\u4e49\u7ba1\u7406\u6570\u7ec4\ndeclare -A HTTP_STATUS\n\n# \u5bf9\u6570\u7ec4\u8fdb\u884c\u5185\u5bb9\u8d4b\u503c\n# \u5229\u7528netstat\u547d\u4ee4\u6765\u8fc7\u6ee4\u51fa\u5173\u7cfb\u7684\u4e00\u5217\u6570\u636e\nfor status in $(cat ${NGINX_LOG} |cut -d\" \" -f9)\ndo\n# \u5bf9\u72b6\u6001\u76f8\u540c\u72b6\u6001\u7684HTTP\u8fdb\u884c\u6570\u503c\u7d2f\u52a0\nlet HTTP_STATUS[${status}]++\ndone\n# \u5c06\u7edf\u8ba1\u5b8c\u6210\u7684TCP\u94fe\u63a5\u72b6\u6001\u53ca\u6570\u636e\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\nfor i in ${!HTTP_STATUS[@]}\ndo if [ ${i} -eq 404 ];then\necho -e \"\\033[34;40m\u6587\u4ef6${NGINX_LOG}\u4e2d\u72b6\u6001\u7801\u4e3a${i}\u7684\u6570\u91cf\u4e3a${HTTP_STATUS[${i}]} \\033[0m\"\nelif [ ${i} -eq 500 ];then\necho -e \"\\033[31;40m\u6587\u4ef6${NGINX_LOG}\u4e2d\u72b6\u6001\u7801\u4e3a${i}\u7684\u6570\u91cf\u4e3a${HTTP_STATUS[${i}]} \\033[0m\"\nelif [ ${i} -eq 200 ];then\necho -e \"\\033[32;40m\u6587\u4ef6${NGINX_LOG}\u4e2d\u72b6\u6001\u7801\u4e3a${i}\u7684\u6570\u91cf\u4e3a${HTTP_STATUS[${i}]} \\033[0m\"\nelse\necho -e \"\\033[36;40m\u6587\u4ef6${NGINX_LOG}\u4e2d\u72b6\u6001\u7801\u4e3a${i}\u7684\u6570\u91cf\u4e3a${HTTP_STATUS[${i}]} \\033[0m\"\nfi\ndone\n</code></pre> <ul> <li>\u6267\u884c\u7ed3\u679c</li> </ul> <pre><code>[root@master shell_echo]# bash nginx_status.sh nginx.log \n\u6587\u4ef6nginx.log\u4e2d\u72b6\u6001\u7801\u4e3a200\u7684\u6570\u91cf\u4e3a17 \u6587\u4ef6nginx.log\u4e2d\u72b6\u6001\u7801\u4e3a301\u7684\u6570\u91cf\u4e3a1 \u6587\u4ef6nginx.log\u4e2d\u72b6\u6001\u7801\u4e3a404\u7684\u6570\u91cf\u4e3a2 \u6587\u4ef6nginx.log\u4e2d\u72b6\u6001\u7801\u4e3a500\u7684\u6570\u91cf\u4e3a2 </code></pre>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#5-\u6ce8\u610f\u4e8b\u9879","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5728 echo \u53d8\u91cf\u5f15\u7528\u65f6\uff0c\u6211\u4eec\u63a8\u8350\u52e4\u7528\u5f15\u53f7\uff0c\u5355\u5f15\u53f7\u4e3a\u539f\u6837\u8f93\u51fa\u5b57\u7b26\u4e32\uff0c\u53cc\u5f15\u53f7\u4e3a\u8f93\u51fa\u53d8\u91cf\u7684\u503c\uff1b</li> <li>printf \u7531 POSIX \u6807\u51c6\u6240\u5b9a\u4e49\uff0c\u56e0\u6b64\u4f7f\u7528 printf \u7684\u811a\u672c\u6bd4\u4f7f\u7528 echo \u79fb\u690d\u66f4\u597d\uff0c\u5982\u679c\u540e\u671f\u8003\u8651\u5e73\u53f0\u79fb\u690d\u95ee\u9898\uff0c\u5efa\u8bae\u4f7f\u7528 <code>printf</code>\u3002</li> </ul>"},{"location":"Linux/shell/6.Shell-echo_printf%E5%91%BD%E4%BB%A4/#6-\u5c0f\u7ed3","title":"6. \u5c0f\u7ed3","text":"<p>\u5728 shell \u4e2d\u6211\u4eec\u53ef\u4ee5\u5229\u7528 echo \u6765\u8bb0\u5f55\u7a0b\u5e8f\u7684\u65e5\u5fd7\uff0c\u6216\u5bf9\u6587\u4ef6\u8fdb\u884c\u65b0\u589e\u5185\u5bb9\u8f93\u5165\uff0c\u6216\u5229\u7528\u5176\u8fdb\u884c\u989c\u8272\u6253\u5370\uff0c\u53ef\u4ee5\u8f93\u51fa\u5e26\u6709\u989c\u8272\u7684\u6f02\u4eae\u63d0\u793a\u3002\u5728\u8bbe\u8ba1\u591a\u5e73\u53f0\u79fb\u690d\u6027\u95ee\u9898\u7684\u65f6\u5019\uff0c\u4e3a\u4eec\u53ef\u4ee5\u4f18\u5148\u8003\u8651 <code>printf</code>\uff0c\u5bf9\u4e8e\u6570\u7ec4\u663e\u53ef\u4ee5\u4f7f\u7528 <code>printf</code> \u6765\u5b8c\u6210\uff0c\u7075\u6d3b\u8fd0\u7528\u663e\u793a\u4f7f\u5f97\u811a\u672c\u7f16\u5199\u66f4\u4e3a\u65b9\u4fbf\u7075\u6d3b\u3002</p>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/","title":"7.Shell test\u547d\u4ee4","text":""},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#1-shell-test-\u547d\u4ee4\u6982\u8ff0","title":"1. Shell test \u547d\u4ee4\u6982\u8ff0","text":""},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#11-shell-test-\u547d\u4ee4\u7b80\u4ecb","title":"1.1 Shell test \u547d\u4ee4\u7b80\u4ecb","text":"<p>\u5728\u6211\u4eec\u4e4b\u524d\u7ae0\u8282\u5b66\u4e60\u4e86 Shell \u7684\u8fd0\u7b97\u7b26\uff0c\u5176\u4e2d\u5927\u591a\u6570\u8fd0\u7b97\u90fd\u53ef\u4ee5\u7ed3\u5408 <code>test</code> \u547d\u4ee4\u6765\u5b8c\u6210\u6d4b\u8bd5\u4e0e\u6bd4\u8f83\u64cd\u4f5c\uff0c<code>test</code> \u547d\u4ee4\u914d\u5408\u5404\u64cd\u4f5c\u7b26\u53f7\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5b8c\u6210\u6d4b\u8bd5\u903b\u8f91\u8868\u8fbe\u5f0f\uff0c\u8fd8\u53ef\u4ee5\u8fdb\u884c\u6587\u4ef6\uff0c\u6570\u5b57\uff0c\u5b57\u7b26\u4e32\u7684\u6bd4\u8f83\u3002\u672c\u6587\u662f\u4e00\u4e9b\u5e38\u89c1\u7528\u6cd5\u7684\u5f52\u7eb3\u603b\u7ed3\u3002</p>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#12-\u4e3a\u4ec0\u4e48\u8981\u7528-test-\u547d\u4ee4","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528 test \u547d\u4ee4","text":"<p>\u5728 Shell \u4e2d\u6bcf\u4e2a\u547d\u4ee4\u90fd\u6709\u5176\u5e94\u7528\u573a\u666f\uff0ctest \u547d\u4ee4\u4e5f\u4e0d\u4f8b\u5916\uff0c\u5176\u5e94\u7528\u573a\u666f\u51e0\u4e4e\u904d\u5e03\u6211\u4eec\u6574\u4e2a Shell \u811a\u672c\u7684\u751f\u547d\u5468\u671f\uff0c\u57fa\u672c\u4e0a Shell \u811a\u672c\u91cc\u9762\u90fd\u4f1a\u6709\u5176\u8eab\u5f71\u3002</p> <p>\u5f53\u6211\u4eec\u5bf9\u6570\u503c\u8fdb\u884c\u7b97\u672f\u8fd0\u7b97\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u6587\u4ef6\u8fdb\u884c\u5224\u65ad\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u903b\u8f91\u6216\u5b57\u7b26\u4e32\u8fdb\u884c\u5224\u65ad\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u60c5\u51b5\u90fd\u9700\u8981\u4f7f\u7528 test \u547d\u4ee4\u6765\u914d\u5408\u8fd0\u7b97\u7b26\u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#2-shell-test-\u547d\u4ee4\u7b80\u4ecb","title":"2. Shell test \u547d\u4ee4\u7b80\u4ecb","text":""},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#21-\u72b6\u6001\u8fd4\u56de\u503c","title":"2.1 \u72b6\u6001\u8fd4\u56de\u503c","text":"<p>\u5728\u6211\u4eec\u5b66\u4e60 test \u547d\u4ee4\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u5728 Linux \u4e2d\u6267\u884c\u547d\u4ee4\u8fd4\u56de 0 \u4e3a\u6b63\u5e38\uff0c\u8fd4\u56de\u975e 0 \u8868\u793a\u5f02\u5e38\uff0c\u53ef\u4ee5\u5229\u7528 <code>$?</code> \u6765\u83b7\u53d6\u8fd4\u56de\u503c\u3002\u5728\u4e0b\u9762\u7684 test \u64cd\u4f5c\u4e2d\u6211\u4eec\u5c31\u4f1a\u8fd0\u7528\u6b64\u7279\u6027\u6765\u8fdb\u884c\u6d4b\u8bd5\u6bd4\u8f83\u3002</p>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#22-test-\u547d\u4ee4\u7b80\u4ecb","title":"2.2 test \u547d\u4ee4\u7b80\u4ecb","text":"<ul> <li>test \u547d\u4ee4</li> </ul> <p>test \u4e3a Shell \u5185\u7f6e\u547d\u4ee4\uff0c\u5176\u901a\u5e38\u9700\u8981\u4e0e if \u8bed\u53e5\u4e00\u5757\u4f7f\u7528\u3002</p> <ul> <li>\u8bed\u6cd5\u683c\u5f0f</li> </ul> <p>\u8bed\u6cd5\u683c\u5f0f\u4e3a <code>test expression</code>, \u5f53 test \u5224\u65ad expression \u4e3a\u6210\u7acb\u65f6\uff0c\u8fd4\u56de\u72b6\u6001\u4e3a 0\uff0c\u5426\u5219\u4e3a\u975e 0 \u503c\u3002</p> <p>test \u547d\u4ee4\u8fd8\u53ef\u4ee5\u7b80\u5199\u4e3a <code>[ ]</code>, \u9700\u8981\u5728\u4e24\u8fb9\u4e2d\u62ec\u53f7\u4e0e expression \u662f\u6709\u4e00\u4e2a\u7a7a\u683c\uff0c\u8fd9\u4e2a\u7a7a\u683c\u662f\u5fc5\u987b\u7684\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u8bed\u6cd5\u9519\u8bef\u3002<code>[]</code> \u7684\u5199\u6cd5\u66f4\u52a0\u7b80\u6d01\uff0c\u6bd4 test \u4f7f\u7528\u9891\u7387\u66f4\u9ad8\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u6765\u770b\u793a\u4f8b\uff1a</p> <pre><code>[root@master shell_test]# cat test1.sh \n#!/bin/bash\n// \u4f7f\u7528\u4e2d\u62ec\u53f7\nif test 10 -ne 1;then\necho \"true\"\nelse\necho \"false\"\nfi\n[root@master shell_test]# bash test1.sh \ntrue\n[root@master shell_test]# cat test2.sh \n#!/bin/bash\n// \u4f7f\u7528test\nif [ 10 -eq 1 ];then\necho \"true\"\nelse\necho \"false\"\nfi\n[root@master shell_test]# bash test2.sh \ntrue\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#3-test-\u547d\u4ee4\u64cd\u4f5c","title":"3. test \u547d\u4ee4\u64cd\u4f5c","text":"<p>test \u547d\u4ee4\u64cd\u4f5c\u4e3b\u8981\u914d\u5408\u6bd4\u8f83\u8fd0\u7b97\u7b26\u8fdb\u884c\uff0c\u53ef\u5927\u4f53\u5206\u4e3a\u6587\u4ef6\u5224\u65ad / \u6570\u7ec4\u6bd4\u8f83 / \u5b57\u7b26\u4e32\u5224\u65ad / \u903b\u8f91\u8fd0\u7b97\u7b49\u3002</p>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#31-\u6570\u503c\u6bd4\u8f83","title":"3.1 \u6570\u503c\u6bd4\u8f83","text":"<p>\u6570\u7ec4\u6bd4\u8f83\u5176\u5b9e\u5c31\u662f test \u547d\u4ee4\u914d\u5408\u5173\u7cfb\u8fd0\u7b97\u7b26\u8fdb\u884c\u6570\u5b57\u6bd4\u8f83\u3002</p> \u6bd4\u8f83\u7b26 \u63cf\u8ff0 \u793a\u4f8b -eq\uff0cequal \u7b49\u4e8e [1 -eq 1] \u4e3a true -ne\uff0cnot equal \u4e0d\u7b49\u4e8e [ 1 -ne 1 \u4e3a false -gt\uff0cgreater than \u5927\u4e8e [2 -gt 1] \u4e3a true -lt\uff0clesser than \u5c0f\u4e8e [2 -lt 1] \u4e3a false -ge\uff0cgreater or equal \u5927\u4e8e\u6216\u7b49\u4e8e [2 -ge 1] \u4e3a true -le\uff0clesser or equal \u5c0f\u4e8e\u6216\u7b49\u4e8e [2 -le 1] \u4e3a false <p>\u5173\u7cfb\u8fd0\u7b97\u987e\u540d\u601d\u4e49\u5c31\u662f\u6bd4\u8f83\u6570\u5b57\u7684\u5927\u5c0f\uff0c\u6ce8\u610f\u5173\u7cfb\u8fd0\u7b97\u7b26\u4f5c\u7528\u7684\u5bf9\u8c61\u4e3a\u6570\u5b57\u3002</p> <pre><code>#!/bin/bash\nnum1=1\nnum2=2\necho \"num1 \u4e3a\uff1a${num1}\"\necho \"num2 \u4e3a\uff1a${num2}\"\nif [ $num1 -eq $num2 ]\nthen\necho \"$num1 -eq $num2 : num1 \u7b49\u4e8e num2\"\nelse\necho \"$num1 -eq $num2: num1 \u4e0d\u7b49\u4e8e num2\"\nfi\nif [ $num1 -ne $num2 ]\nthen\necho \"$num1 -ne $num2: num1 \u4e0d\u7b49\u4e8e num2\"\nelse\necho \"$num1 -ne $num2 : num1 \u7b49\u4e8e num2\"\nfi\nif [ $num1 -gt $num2 ]\nthen\necho \"$num1 -gt $num2: num1 \u5927\u4e8e num2\"\nelse\necho \"$num1 -gt $num2: num1 \u4e0d\u5927\u4e8e num2\"\nfi\nif [ $num1 -lt $num2 ]\nthen\necho \"$num1 -lt $num2: num1 \u5c0f\u4e8e num2\"\nelse\necho \"$num1 -lt $num2: num1 \u4e0d\u5c0f\u4e8e num2\"\nfi\nif [ $num1 -ge $num2 ]\nthen\necho \"$num1 -ge $num2: num1 \u5927\u4e8e\u6216\u7b49\u4e8e num2\"\nelse\necho \"$num1 -ge $num2: num1 \u5c0f\u4e8e num2\"\nfi\nif [ $num1 -le $num2 ]\nthen\necho \"$num1 -le $num2: num1 \u5c0f\u4e8e\u6216\u7b49\u4e8e num2\"\nelse\necho \"$num1 -le $num2: num1 \u5927\u4e8e num2\"\nfi\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>num1 \u4e3a\uff1a1\nnum2 \u4e3a\uff1a2\n1 -eq 2: num1 \u4e0d\u7b49\u4e8e num2\n1 -ne 2: num1 \u4e0d\u7b49\u4e8e num2\n1 -gt 2: num1 \u4e0d\u5927\u4e8e num2\n1 -lt 2: num1 \u5c0f\u4e8e num2\n1 -ge 2: num1 \u5c0f\u4e8e num2\n1 -le 2: num1 \u5c0f\u4e8e\u6216\u7b49\u4e8e num\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#32-\u6587\u4ef6\u5224\u65ad","title":"3.2 \u6587\u4ef6\u5224\u65ad","text":"<p>\u5728\u672c\u7ae0\u8282\u7531\u4e8e test \u547d\u4ee4\u4e0e\u8fd0\u7b97\u7b26\u914d\u5408\u4f7f\u7528\uff0c\u4e0e\u4e4b\u524d\u8fd0\u7b97\u7b26\u7ae0\u8282\u6709\u91cd\u590d\uff0c\u6211\u4eec\u5728\u6b64\u6e29\u6545\u77e5\u65b0\uff0c\u7740\u624b test \u547d\u4ee4\u6765\u5b66\u4e60\u6587\u4ef6\u5224\u65ad\u3002</p> <p>\u6587\u4ef6\u6d4b\u8bd5\u5728\u6211\u4eec\u7f16\u5199 Shell \u4e2d\u4e0e\u6587\u4ef6\u64cd\u4f5c\u975e\u5e38\u5e38\u7528\uff0c\u719f\u7ec3\u638c\u63e1\u6587\u4ef6\u64cd\u4f5c\u53ef\u4ee5\u5728\u540e\u7eed\u7684 Shell \u7f16\u5199\u4e2d\u5f97\u5fc3\u5e94\u624b\uff0c\u4f8b\u5982 file \u53d8\u91cf\u4e3a:</p> \u64cd\u4f5c\u7b26 \u8bf4\u660e \u4e3e\u4f8b -d file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u76ee\u5f55\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-d $file] \u8fd4\u56de false\u3002 -f file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u666e\u901a\u6587\u4ef6\uff08\u65e2\u4e0d\u662f\u76ee\u5f55\uff0c\u4e5f\u4e0d\u662f\u8bbe\u5907\u6587\u4ef6\uff09\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-f $file] \u8fd4\u56de true\u3002 -c file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5b57\u7b26\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-c $file] \u8fd4\u56de false\u3002 -b file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5757\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-b $file] \u8fd4\u56de false\u3002 -g file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SGID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-g $file] \u8fd4\u56de false\u3002 -u file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SUID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-u $file] \u8fd4\u56de false\u3002 -k file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86\u7c98\u7740\u4f4d (Sticky Bit)\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-k $file] \u8fd4\u56de false\u3002 -p file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u6709\u540d\u7ba1\u9053\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-p $file] \u8fd4\u56de false\u3002 -r file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u8bfb\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-r $file] \u8fd4\u56de true\u3002 -w file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u5199\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-w $file] \u8fd4\u56de true\u3002 -x file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u6267\u884c\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-x $file] \u8fd4\u56de true\u3002 -s file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u4e3a\u7a7a\uff08\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u5927\u4e8e 0\uff09\uff0c\u4e0d\u4e3a\u7a7a\u8fd4\u56de true\u3002 [-s $file] \u8fd4\u56de true\u3002 -e file \u68c0\u6d4b\u6587\u4ef6\uff08\u5305\u62ec\u76ee\u5f55\uff09\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-e $file] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\nTEST_FILE=\"/etc/fstab\"\necho \"\u68c0\u6d4b\u7684\u6587\u4ef6\u4e3a:${TEST_FILE}\"\necho \"\u6587\u4ef6\u4fe1\u606f\u4e3a:$(ls -l ${TEST_FILE})\"\nif [ -r $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u53ef\u8bfb\"\nelse\necho \"\u6587\u4ef6\u4e0d\u53ef\u8bfb\"\nfi\nif [ -w $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u53ef\u5199\"\nelse\necho \"\u6587\u4ef6\u4e0d\u53ef\u5199\"\nfi\nif [ -x $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u53ef\u6267\u884c\"\nelse\necho \"\u6587\u4ef6\u4e0d\u53ef\u6267\u884c\"\nfi\nif [ -f $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u4e3a\u666e\u901a\u6587\u4ef6\"\nelse\necho \"\u6587\u4ef6\u4e3a\u7279\u6b8a\u6587\u4ef6\"\nfi\nif [ -d $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u662f\u4e2a\u76ee\u5f55\"\nelse\necho \"\u6587\u4ef6\u4e0d\u662f\u4e2a\u76ee\u5f55\"\nfi\nif [ -s $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u4e0d\u4e3a\u7a7a\"\nelse\necho \"\u6587\u4ef6\u4e3a\u7a7a\"\nfi\nif [ -e $TEST_FILE ]\nthen\necho \"\u6587\u4ef6\u5b58\u5728\"\nelse\necho \"\u6587\u4ef6\u4e0d\u5b58\u5728\"\nfi\n</code></pre> <p>\u8fd4\u56de\u4e3a\uff1a</p> <pre><code>\u68c0\u6d4b\u7684\u6587\u4ef6\u4e3a:/etc/fstab\n\u6587\u4ef6\u4fe1\u606f\u4e3a:-rw-r--r--. 1 root root 500 Jan 17 14:23 /etc/fstab\n\u6587\u4ef6\u53ef\u8bfb\n\u6587\u4ef6\u53ef\u5199\n\u6587\u4ef6\u4e0d\u53ef\u6267\u884c\n\u6587\u4ef6\u4e3a\u666e\u901a\u6587\u4ef6\n\u6587\u4ef6\u4e0d\u662f\u4e2a\u76ee\u5f55\n\u6587\u4ef6\u4e0d\u4e3a\u7a7a\n\u6587\u4ef6\u5b58\u5728\n</code></pre> <p>\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728</p> <pre><code>FILE=/etc/resolv.conf\nif test -f \"$FILE\"; then\necho \"$FILE exists.\"\nfi\nFILE=/etc/resolv.conf\nif [ -f \"$FILE\" ]; then\necho \"$FILE exists.\"\nfi\nFILE=/etc/resolv.conf\nif [[ -f \"$FILE\" ]]; then\necho \"$FILE exists.\"\nfi\n</code></pre> <p>\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0d\u5e26if\u8bed\u53e5\u7684test\u547d\u4ee4\u3002&amp;&amp;\u4ec5\u5f53\u6d4b\u8bd5\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u4e3atrue\u65f6\uff0c\u624d\u6267\u884c\u64cd\u4f5c\u5458\u4e4b\u540e\u7684\u547d\u4ee4\uff0c <pre><code>test -f /etc/resolv.conf &amp;&amp; echo \"$FILE exists.\"\n[ -f /etc/resolv.conf ] &amp;&amp; echo \"$FILE exists.\"\n[[ -f /etc/resolv.conf ]] &amp;&amp; echo \"$FILE exists.\"\n</code></pre></p> <p>\u5982\u679c\u8981\u5728&amp;&amp;\u8fd0\u7b97\u7b26\u540e\u8fd0\u884c\u4e00\u7cfb\u5217\u547d\u4ee4\uff0c\u53ea\u9700\u5c06\u547d\u4ee4\u62ec\u5728\u7528;\u6216\u62ec\u8d77\u6765\u7684\u5927\u62ec\u53f7\u4e2d&amp;&amp;\uff1a</p> <pre><code>[ -f /etc/resolv.conf ] &amp;&amp; { echo \"$FILE exist.\"; cp \"$FILE\" /tmp/; }\n</code></pre> <p>\u76f8\u53cd&amp;&amp;\uff0c||\u4ec5\u5f53test\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u4e3a\u65f6\uff0c\u624d\u6267\u884c\u8fd0\u7b97\u7b26\u540e\u7684\u8bed\u53e5false\u3002</p> <pre><code>[ -f /etc/resolv.conf ] &amp;&amp; echo \"$FILE exist.\" || echo \"$FILE does not exist.\"\n</code></pre> <p>\u5224\u65ad\u6587\u4ef6\u662f\u5426\u4e0d\u5b58\u5728</p> <pre><code>[ ! -f /etc/docker ] &amp;&amp; echo \"$FILE does not exist.\"\n</code></pre> <p>\u68c0\u67e5\u76ee\u5f55\u662f\u5426\u5b58\u5728</p> <pre><code>[ -d /etc/docker ] &amp;&amp; echo \"$FILE is a directory.\"\n</code></pre> <p>\u68c0\u67e5\u662f\u5426\u5b58\u5728\u591a\u4e2a\u6587\u4ef6</p> <pre><code>[ -f /etc/resolv.conf -a -f /etc/hosts ] &amp;&amp; echo \"Both files exist.\"\n[[ -f /etc/resolv.conf &amp;&amp; -f /etc/hosts ]] &amp;&amp; echo \"Both files exist.\"\n</code></pre> <p>\u6216\u8005\u4f7f\u7528if\u8bed\u53e5</p> <pre><code>if [ -f /etc/resolv.conf -a -f /etc/hosts ]; then\necho \"Both files exist.\"\nfi\nif [[ -f /etc/resolv.conf &amp;&amp; -f /etc/hosts ]]; then\necho \"Both files exist.\"\nfi\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#33-\u5b57\u7b26\u4e32\u5224\u65ad","title":"3.3 \u5b57\u7b26\u4e32\u5224\u65ad","text":"<p>\u5bf9\u4e8e\u5b57\u7b26\u4e32\u5224\u65ad\u4e0e\u6570\u5b57\u5bf9\u6bd4\uff0c\u5176\u4f5c\u7528\u7684\u5bf9\u8c61\u4e0d\u540c\u9700\u8981\u683c\u5916\u6ce8\u610f\uff0c\u5229\u7528 test \u547d\u4ee4\u5bf9\u4e8e\u5b57\u7b26\u4e32\u8fdb\u884c\u4e00\u4e9b\u5224\u65ad\u64cd\u4f5c\uff0c\u5047\u5b9a\u53d8\u91cf a \u4e3a \u201clinux\u201d\uff0c\u53d8\u91cf b \u4e3a \u201cshell\u201d\uff1a</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b \u2260= \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u5176\u4e2d = \u548c == \u662f\u76f8\u540c\u7684\uff0c\u76f8\u7b49\u8fd4\u56de true\u3002 [$a = $b] \u8fd4\u56de false\u3002 != \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u8fd4\u56de true\u3002 [$a != $b] \u8fd4\u56de true\u3002 -z \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a 0\uff0c\u4e3a 0 \u8fd4\u56de true\u3002 [-z $a] \u8fd4\u56de false\u3002 -n \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a 0\uff0c\u4e0d\u4e3a 0 \u8fd4\u56de true\u3002 [-n \u201c$a\u201d ] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\nstr1=\"linux\"\nstr2=\"shell\"\necho \"str1 \u4e3a\uff1a${str1}\"\necho \"str2 \u4e3a\uff1a${str2}\"\nif [ $str1 = $str2 ];then\necho \"$str1 = $str2 : str1 \u7b49\u4e8e str2\"\nelse\necho \"$str1 = $str2: str1 \u4e0d\u7b49\u4e8e str2\"\nfi\nif [ $str1 != $str2 ];then\necho \"$str1 != $str2 : str1 \u4e0d\u7b49\u4e8e str2\"\nelse\necho \"$str1 != $str2: str1 \u7b49\u4e8e str2\"\nfi\nif [ -z $str1 ];then\necho \"-z $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a 0\"\nelse\necho \"-z $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\"\nfi\nif [ -n \"$str1\" ];then\necho \"-n $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\"\nelse\necho \"-n $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a 0\"\nfi\nif [ ${str1} ];then\necho \"str1 : \u5b57\u7b26\u4e32\u4e0d\u4e3a\u7a7a\"\nelse\necho \"str1 : \u5b57\u7b26\u4e32\u4e3a\u7a7a\"\nfi\n</code></pre> <p>\u8fd4\u56de\u4e3a\uff1a</p> <pre><code>str1 \u4e3a\uff1alinux\nstr2 \u4e3a\uff1ashell\nlinux = shell: str1 \u4e0d\u7b49\u4e8e str2\nlinux != shell : str1 \u4e0d\u7b49\u4e8e str2\n-z linux : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\n-n linux : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\nstr1 : \u5b57\u7b26\u4e32\u4e0d\u4e3a\u7a7a   </code></pre> <p>\u68c0\u67e5\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49</p> <pre><code>#!/bin/bash\nVAR1=\"Linuxize\"\nVAR2=\"Linuxize\"\nif [ \"$VAR1\" = \"$VAR2\" ]; then\necho \"Strings are equal.\"\nelse\necho \"Strings are not equal.\"\nfi\n</code></pre> <pre><code>[[ \"string1\" == \"string2\" ]] &amp;&amp; echo \"Equal\" || echo \"Not equal\"\nNot equal\n</code></pre> <p>\u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u7a7a</p> <pre><code>#!/bin/bash\nVAR=''\nif [[ -z $VAR ]]; then\necho \"String is empty.\"\nfi\nString is empty.\n\n#!/bin/bash\nVAR='Linuxize'\nif [[ -n $VAR ]]; then\necho \"String is not empty.\"\nfi\nString is not empty.\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#34-\u903b\u8f91\u8fd0\u7b97","title":"3.4 \u903b\u8f91\u8fd0\u7b97","text":"<p>\u5229\u7528 test \u547d\u4ee4\u53ef\u4ee5\u8fdb\u884c\u903b\u8f91\u5224\u65ad\uff0c\u4ee5\u4e0b\u4ecb\u7ecd Shell \u7684\u903b\u8f91\u8fd0\u7b97\u7b26\uff0c\u5047\u5b9a\u53d8\u91cf A \u4e3a 1\uff0c\u53d8\u91cf b \u4e3a 2\uff1a</p> <p>\u5982\u679c\u9700\u8981\u5728\u4e00\u4e2a test \u4e2d\u6267\u884c\u591a\u4e2a\u5224\u65ad\uff0c\u9700\u8981\u4f7f\u7528 <code>[[]]</code>, test \u662f Shell \u5185\u7f6e\u5173\u952e\u5b57\uff0c\u4e0d\u662f\u547d\u4ee4\uff0c\u514d\u9664\u51fd\u6570\u4f20\u9012\u8fc7\u7a0b\uff0c\u56e0\u6b64\u66f4\u52a0\u5efa\u8bae\u4f7f\u7528 <code>[[]]</code>\u3002\u53cc\u4e2d\u62ec\u53f7\u6709\u4e00\u4e0b\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u4e0d\u9700\u8981\u628a\u53d8\u91cf\u540d\u7528\u53cc\u5f15\u53f7 <code>\"\"</code> \u5305\u56f4\u8d77\u6765\uff0c\u5373\u4f7f\u53d8\u91cf\u662f\u7a7a\u503c\uff0c\u4e5f\u4e0d\u4f1a\u51fa\u9519\uff1b</li> <li>\u4e0d\u9700\u8981\u3001\u4e5f\u4e0d\u80fd\u5bf9 &gt;\u3001&lt; \u8fdb\u884c\u8f6c\u4e49\uff0c\u8f6c\u4e49\u540e\u4f1a\u51fa\u9519\uff1b</li> <li>\u5176\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u7ec4\u5408\u903b\u8f91\u53ef\u4ee5\u4e0d\u4f7f\u7528 test \u7684 - a,-o \u800c\u4f7f\u7528 &amp;&amp; ||\u3002</li> </ul> <p>\u4e0e\u903b\u8f91\u8fd0\u7b97\u7b26\u53f7\u5bf9\u5e94\u7684 <code>&amp;&amp;</code> \u53ef\u4ee5\u4f7f\u7528 <code>-a</code>\uff0c<code>||</code> \u53ef\u4ee5\u4f7f\u7528 <code>-o</code> \u6765\u66ff\u6362\u3002</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b &amp;&amp; \u903b\u8f91\u7684 AND <code>[[ $A -lt 10 &amp;&amp; $B -gt 100 ]] \u8fd4\u56de false</code> || \u903b\u8f91\u7684 OR <code>[[ $A -lt 10 || $B -gt 100 ]] \u8fd4\u56de true</code> <p>\u4f8b\u5982:</p> <pre><code>#!/bin/bash\nnum1=1\nnum2=2\necho \"num1 \u4e3a:${num1}\"\necho \"num2 \u4e3a:${num2}\"\nif [[ $num1 -lt 5 &amp;&amp; $num2 -gt 5 ]];then\necho \"\u8fd4\u56de true\"\nelse\necho \"\u8fd4\u56de false\"\nfi\nif [[ $num1 -lt 5 || $num2 -gt 5 ]];then\necho \"\u8fd4\u56de true\"\nelse\necho \"\u8fd4\u56de false\"\nfi\nif [ $num1 -lt 5 ] &amp;&amp; [ $num2 -gt 5 ];then\necho \"\u8fd4\u56de true\"\nelse\necho \"\u8fd4\u56de false\"\nfi\nif [ $num1 -lt 5 ] || [ $num2 -gt 5 ];then\necho \"\u8fd4\u56de true\"\nelse\necho \"\u8fd4\u56de false\"\nfi\nif [ $num1 -lt 5  -a  $num2 -gt 5 ];then\necho \"\u8fd4\u56de true\"\nelse\necho \"\u8fd4\u56de false\"\nfi\nif [ $num1 -lt 5 -o  $num2 -gt 5 ];then\necho \"\u8fd4\u56de true\"\nelse\necho \"\u8fd4\u56de false\"\nfi\n</code></pre> <p>\u8fd4\u56de\uff1a</p> <pre><code>num1 \u4e3a:1\nnum2 \u4e3a:2\n\u8fd4\u56de false\n\u8fd4\u56de true\n\u8fd4\u56de false\n\u8fd4\u56de true\n\u8fd4\u56de false\n\u8fd4\u56de true\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#35-bash\u4e2d\u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u5305\u542b\u5b50\u5b57\u7b26\u4e32","title":"3.5 Bash\u4e2d\u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u5305\u542b\u5b50\u5b57\u7b26\u4e32","text":""},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#1\u4f7f\u7528\u901a\u914d\u7b26","title":"1.\u4f7f\u7528\u901a\u914d\u7b26","text":"<p>if\u8bed\u53e5\u5b9e\u73b0</p> <pre><code>    #!/bin/bash\nSTR='GNU/Linux is an operating system'\nSUB='Linux'\nif [[ \"$STR\" == *\"$SUB\"* ]]; then\necho \"It's there.\"\nfi\n</code></pre> <p>\u9664\u4e86\u4f7f\u7528 if \u8bed\u53e5\uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528case\u8bed\u53e5 \u6765\u68c0\u67e5\u4e00\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u5305\u542b\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002</p> <pre><code>    #!/bin/bash\nSTR='GNU/Linux is an operating system'\nSUB='Linux'\ncase $STR in\n*\"$SUB\"*)\necho -n \"It's there.\"\n;;\nesac\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#2\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8fd0\u7b97\u7b26","title":"2.\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8fd0\u7b97\u7b26","text":"<pre><code>#!/bin/bash\nSTR='GNU/Linux is an operating system'\nSUB='Linux'\nif [[ \"$STR\" =~ .*\"$SUB\".* ]]; then\necho \"It's there.\"\nfi\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#3\u4f7f\u7528grep","title":"3.\u4f7f\u7528grep","text":"<pre><code>#!/bin/bash\nSTR='GNU/Linux is an operating system'\nSUB='Linux'\nif grep -q \"$SUB\" &lt;&lt;&lt; \"$STR\"; then\necho \"It's there\"\nfi\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#4-\u5b9e\u4f8b","title":"4. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#41-\u9700\u6c42","title":"4.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u53ef\u4ee5\u4f20\u5165\u4efb\u610f\u591a\u4e2a\u6570\u503c\uff0c\u8981\u6c42\u8f93\u5165\u7684\u6570\u5b57\u5927\u4e8e\u7b49\u4e8e 0\uff0c\u811a\u672c\u6267\u884c\u8f93\u51fa\u6700\u5c0f\u7684\u548c\u6700\u5927\u7684\u6570\u5b57\u3002</p>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#42-\u601d\u8def","title":"4.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26\u6765\u5224\u65ad\u8f93\u51fa\u7684\u76ee\u5f55\u662f\u5426\u6b63\u786e\uff0c\u4e4b\u540e\u5229\u7528\u7b97\u672f\u8fd0\u7b97\u7b26\u914d\u5408\u6570\u7ec4\u5bf9\u6587\u4ef6\u6216\u76ee\u5f55\u8fdb\u884c\u7edf\u8ba1\u3002</p>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#43-\u5b9e\u73b0","title":"4.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# Description: count file scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: count file\n# Date: 2020-03-21 14:00\n# Version: 1.0\n# \u5224\u65ad\u8f93\u5165\u81f3\u5c11\u4e00\u4e2a\u53c2\u6570\n[ $# -le 1 ] &amp;&amp; echo \"\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\" &amp;&amp; exit 1\nfor num in $*;\ndo\n# \u5224\u65ad\u8f93\u5165\u7684\u90fd\u4e3a\u6570\u5b57\u4e14\u8f93\u5165\u6570\u5b57\u5927\u4e8e\u7b49\u4e8e0\n[ \"${num}\" -ge 0 ] 2&gt;/dev/null\n        [ $? -ne 0 ] &amp;&amp; echo \"\u8f93\u5165\u7684${num}\u4e0d\u7b26\u5408\u53c2\u6570\u89c4\u8303\" &amp;&amp; exit 1\ndone\n# \u5bf9\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u7edf\u8ba1\nMIN_NUM=$1\nMAX_NUM=$1\nfor num in $*;\ndo\nif [    ${num} -gt ${MAX_NUM}   ];then\nMAX_NUM=${num}\nelif [ ${num} -lt ${MIN_NUM} ];then\nMIN_NUM=${num}\nelse\necho -e \"\"\nfi\ndone\necho \"\u8f93\u5165\u7684\u53c2\u6570\u603b\u5171\u4e3a\uff1a$#\"\necho \"\u8f93\u5165\u7684\u6570\u5b57\u4e3a\uff1a$*\"\necho \"\u5176\u4e2d\u6700\u5927\u7684\u6570\u5b57\u4e3a\uff1a${MAX_NUM}\"\necho \"\u5176\u4e2d\u6700\u5c0f\u7684\u6570\u5b57\u4e3a\uff1a${MIN_NUM}\"\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#44-\u6d4b\u8bd5","title":"4.4 \u6d4b\u8bd5","text":"<p>\u5f53\u6211\u4eec\u4e0d\u8f93\u5165\u4efb\u4f55\u53c2\u6570\uff0c\u6216\u8f93\u5165\u5355\u4e2a\u53c2\u6570\u7684\u65f6\u5019\uff0c\u63d0\u793a\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\uff1b</p> <p>\u5982\u679c\u8f93\u5165\u6709\u5305\u542b\u5b57\u7b26\u4e32\uff0c\u5219\u63d0\u793a\u53c2\u6570\u4e0d\u89c4\u8303\uff1b</p> <p>\u5f53\u8f93\u5165\u4e00\u4e9b\u5217\u6570\u5b57\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002</p> <pre><code>[root@master shell_test]# bash num_check.sh \n\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\n[root@master shell_test]# bash num_check.sh 1\n\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\n[root@master shell_test]# bash num_check.sh 1 \"hell\"\n\u8f93\u5165\u7684hell\u4e0d\u7b26\u5408\u53c2\u6570\u89c4\u8303\n[root@master shell_test]# bash num_check.sh 12 13 32 435 0\n\u8f93\u5165\u7684\u53c2\u6570\u603b\u5171\u4e3a\uff1a5\n\u8f93\u5165\u7684\u6570\u5b57\u4e3a\uff1a12 13 32 435 0\n\u5176\u4e2d\u6700\u5927\u7684\u6570\u5b57\u4e3a\uff1a435\n\u5176\u4e2d\u6700\u5c0f\u7684\u6570\u5b57\u4e3a\uff1a\n</code></pre>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#4-\u6ce8\u610f\u4e8b\u9879","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5bf9\u4e8e\u5173\u7cfb\u8fd0\u7b97\uff0ctest \u547d\u4ee4\u6bd4\u8f83\u7684\u5bf9\u8c61\u4e3a\u6570\u5b57\uff0c\u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u4e00\u5b9a\u8981\u7262\u8bb0\u8fd9\u4e2a\u6ce8\u610f\u70b9\uff1b</li> <li>\u5bf9\u4e8e\u5b57\u7b26\u4e32\u5224\u65ad\uff0ctest \u547d\u4ee4\u4f5c\u7528\u7684\u4e3a\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u60f3\u6bd4\u8f83\u6570\u5b57\uff0c\u53ef\u4ee5\u5229\u7528\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\u901a\u8fc7\u5b57\u7b26\u4e32\u5224\u65ad\u3002</li> </ul>"},{"location":"Linux/shell/7.Shell-test%E5%91%BD%E4%BB%A4/#5-\u5c0f\u7ed3","title":"5. \u5c0f\u7ed3","text":"<p>\u5728\u672c\u7ae0\u8282\u7531\u4e8e test \u547d\u4ee4\u4e0e\u8fd0\u7b97\u7b26\u914d\u5408\u4f7f\u7528\uff0c\u4e0e\u4e4b\u524d\u8fd0\u7b97\u7b26\u7ae0\u8282\u6709\u91cd\u590d\uff0c\u5728\u6b64\u6e29\u6545\u77e5\u65b0\uff0c\u901a\u8fc7\u793a\u4f8b\u6765\u66f4\u52a0\u719f\u6089 test \u547d\u4ee4\u53ca\u76f8\u5173\u8fd0\u7b97\u7b26\uff0c\u5176\u662f\u540e\u671f Shell \u811a\u672c\u7f16\u5199\u7684\u6d41\u7a0b\u6846\u67b6\uff0c\u719f\u7ec3\u638c\u63e1 test \u547d\u4ee4\u7684\u6570\u503c\uff0c\u6587\u4ef6\uff0c\u5b57\u7b26\u4e32\u4e0e\u903b\u8f91\u8fd0\u7b97\uff0c\u4f7f\u5f97\u6211\u4eec\u7f16\u5199 Shell \u811a\u672c\u66f4\u52a0\u5f97\u5fc3\u5e94\u624b\u3002</p>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/","title":"8.Shell\u6d41\u7a0b\u63a7\u5236","text":""},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#1-\u6d41\u7a0b\u63a7\u5236\u6982\u8ff0","title":"1. \u6d41\u7a0b\u63a7\u5236\u6982\u8ff0","text":""},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#11-\u6d41\u7a0b\u63a7\u5236\u7b80\u4ecb","title":"1.1 \u6d41\u7a0b\u63a7\u5236\u7b80\u4ecb","text":"<p>Shell \u811a\u672c\u9ed8\u8ba4\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u6267\u884c\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u4e2d\uff0c\u4f1a\u9047\u5230\u5f88\u591a\u79cd\u60c5\u51b5\uff0c\u5bf9\u5e94\u4e0d\u540c\u60c5\u51b5\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u5bf9\u4e8e\u4e00\u6279\u6570\u636e\u9700\u8981\u8fdb\u884c\u6267\u884c\u91cd\u590d\u5de5\u4f5c\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u6211\u4eec\u4f7f\u7528\u7279\u5b9a\u7684\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u6765\u5b9e\u73b0\uff0c\u6211\u4eec\u60f3\u8981\u7a0b\u5e8f\u5b8c\u6210\u9884\u5b9a\u7684\u64cd\u4f5c\uff0c\u5c31\u9700\u8981\u719f\u7ec3\u638c\u63e1\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\uff0c\u4e0d\u540c\u7684\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u6709\u4e0d\u540c\u7684\u9002\u5e94\u573a\u666f\u3002</p>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u6d41\u7a0b\u63a7\u5236","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u6d41\u7a0b\u63a7\u5236","text":"<p>\u6d41\u7a0b\u63a7\u5236\u662f\u6bcf\u79cd\u7f16\u7a0b\u8bed\u8a00\u63a7\u5236\u903b\u8f91\u8d70\u5411\u548c\u6267\u884c\u6b21\u5e8f\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u6d41\u7a0b\u63a7\u5236\u53ef\u4ee5\u8bf4\u662f\u4e00\u95e8\u8bed\u8a00\u7684 \u201c\u7ecf\u8109\u201d\uff0c\u5176\u63a7\u5236\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\u8d70\u5411\uff0c\u6240\u4ee5\u719f\u7ec3\u638c\u63e1\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u624d\u80fd\u66f4\u597d\u7684\u63a7\u5236\u6574\u4e2a\u811a\u672c\u7684\u8fd0\u884c\u7ed3\u679c\uff0c\u6765\u5b8c\u6210\u6211\u4eec\u7684\u9700\u6c42\u3002</p>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#2-shell-\u6d41\u7a0b\u63a7\u5236\u64cd\u4f5c","title":"2. Shell \u6d41\u7a0b\u63a7\u5236\u64cd\u4f5c","text":""},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#21-\u6761\u4ef6\u8bed\u53e5","title":"2.1 \u6761\u4ef6\u8bed\u53e5","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u6267\u884c\u5bf9\u5e94\u64cd\u4f5c\uff0c\u6309\u7167\u987a\u5e8f\u4ece\u4e0a\u5230\u4e0b\uff0c\u6761\u4ef6\u8bed\u53e5 if \u901a\u5e38\u9700\u8981\u4e0e test \u547d\u4ee4\u914d\u5408\u4f7f\u7528\uff0c\u5f53\u6ee1\u8db3\u6761\u4ef6\u5219\u6267\u884c <code>then</code> \u540e\u7684 command\uff0c\u5426\u5219\u7ee7\u7eed\u5f80\u4e0b\u8fd0\u884c\u6267\u884c\u5bf9\u5e94\u7684 command\uff0c\u6761\u4ef6\u8bed\u53e5 if \u662f Shell \u7f16\u7a0b\u4e2d\u6700\u57fa\u7840\u7684\u6761\u4ef6\u5224\u65ad\u6d41\u7a0b\u8bed\u53e5\u3002</p>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#211-\u5355\u5206\u652f-if-\u8bed\u53e5","title":"2.1.1 \u5355\u5206\u652f if \u8bed\u53e5","text":"<p>\u987e\u540d\u601d\u4e49\u5c31\u662f\u53ea\u6709\u4e00\u4e2a if \u8bed\u53e5\u5757\u5305\u542b\u7684\u8bed\u53e5\uff0ccondition \u4e3a\u6b63\u786e\u5219\u6267\u884c then \u5185\u7684\u547d\u4ee4\uff0c\u8bed\u6cd5\uff1a</p> <pre><code>if condition\nthen\ncommand1 command2\n    ...\n    commandN fi\n</code></pre> <p>\u5bf9\u4e8e sshd \u8fdb\u7a0b\u662f\u5426\u5b58\u5728\uff0c\u53ef\u4ee5\u4f7f\u7528\u5355\u5206\u652f if \u8bed\u53e5\u6765\u5224\u65ad\uff0c\u4f8b\u5982\uff1a</p> <pre><code>if [ $(ps -ef |grep /usr/sbin/sshd|grep -v grep|wc -l) -eq 1 ];then echo \"sshd server exist\"\nfi\n</code></pre>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#212-\u53cc\u5206\u652f-if-\u8bed\u53e5","title":"2.1.2 \u53cc\u5206\u652f if \u8bed\u53e5","text":"<p>\u591a\u5206\u652f if \u8bed\u53e5\u5b58\u5728 else \u60c5\u51b5\uff0c\u8bed\u6cd5\uff1a</p> <pre><code>if condition\nthen\ncommand1 command2\n    ...\n    commandN\nelse\ncommand\nfi\n</code></pre> <p>\u7edf\u4e00\u5224\u65ad sshd \u670d\u52a1\uff0c\u53ef\u4ee5\u5728 else \u4e2d\u8fdb\u884c\u4e00\u4e9b\u5217\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>if [ $(ps -ef |grep /usr/sbin/sshd|grep -v grep|wc -l) -eq 1 ];then echo \"sshd server exist\"\nelse\nservice sshd start &amp;&amp; echo \"\u542f\u52a8sshd\u670d\u52a1\"\nfi\n</code></pre>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#213-\u591a\u5206\u949f-if-\u8bed\u53e5","title":"2.1.3 \u591a\u5206\u949f if \u8bed\u53e5","text":"<p>\u987e\u540d\u601d\u4e49\u6709\u591a\u4e2a if \u6761\u4ef6\uff0c\u5728\u6b64\u5229\u7528 elif \u6765\u8868\u793a\uff0c\u6ce8\u610f\u6700\u540e\u6709\u4e00\u4e2a else \u7ed3\u5c3e\u3002</p> <pre><code>if condition1;then\ncommand1\nelif condition2;then command2\n    ...\n...\nelif conditionN,then\n        commandN\nelse\ncommand\nfi\n</code></pre> <p>\u6211\u4eec\u7684 linux \u7cfb\u7edf\u6709\u591a\u4e2a\u7248\u672c\uff0c\u53ef\u4ee5\u5229\u7528\u591a\u5206\u652f if \u8bed\u53e5\u6765\u8fdb\u884c\u5224\u65ad\uff0c\u4f8b\u5982\uff1a</p> <pre><code>#! /bin/bash\nsys_version=$(rpm -q centos-release|cut -d- -f3)\nif [ $sys_version -eq 6 ];then\necho \"sysversion is $sys_version\"\nelif [ $sys_version -eq 7 ];then\necho \"sysversion is $sys_version\"\nelse\necho \"sysversion is ${sys_version}\"\nfi\n</code></pre>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#22-\u5faa\u73af\u8bed\u53e5","title":"2.2 \u5faa\u73af\u8bed\u53e5","text":"<p>\u5bf9\u4e8e\u4e00\u6279\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5176\u91cd\u590d\u8fdb\u884c\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5229\u7528\u5faa\u73af\u8bed\u53e5\u6765\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#221-for-\u5faa\u73af","title":"2.2.1 for \u5faa\u73af","text":"<p>for \u5faa\u73af\u8bed\u53e5\u901a\u5e38\u5e94\u7528\u5728\u53ef\u9884\u4f30\u6570\u91cf\u7684\u4e00\u6279\u5bf9\u8c61\u64cd\u4f5c\u4e2d\uff0c\u9ed8\u8ba4 for \u5faa\u73af\u7684\u53d6\u503c\u5217\u8868\u662f\u4ee5 <code>$IFS</code> \u5206\u5272\uff0c\u9ed8\u8ba4 <code>$IFS</code> \u4e3a\u7a7a\u767d\u7b26\uff0c\u5982\u679c\u6211\u4eec\u6709\u5176\u4ed6\u9700\u6c42\u53ef\u4ee5\u66f4\u6539\uff0c\u8bed\u6cd5\u4e3a\uff1a</p> <pre><code>for var in item1 item2 ... itemN\ndo\ncommand1\n    command2\n    ...\n    commandN\ndone\n</code></pre> <p>\u901a\u8fc7 for \u5faa\u73af\u6bcf\u6b21\u904d\u5386\u4e00\u4e2a\u540e\u9762\u8ddf\u7684\u5bf9\u8c61\uff0c\u5728 <code>do\u2026done</code> \u64cd\u4f5c\u5757\u4e2d\u5bf9\u5bf9\u8c61\u8fdb\u884c\u4e00\u4e9b\u5217\u64cd\u4f5c\u3002</p> <p>\u4f8b\u5982\u6211\u4eec\u6765\u6c42\u548c 1-10 \u7684\u548c\uff1a</p> <pre><code>SUM=0\nfor num in $(seq 1 10)\ndo\nlet SUM=${SUM}+${num}\ndone\necho \"1-10\u7684\u548c\u4e3a\uff1a${SUM}\"\n</code></pre> <p>\u5f53\u7136\u5728 for \u5faa\u73af\u8bed\u53e5\u91cc\u9762\u4e5f\u53ef\u4ee5\u914d\u5408 if \u6761\u4ef6\u5224\u65ad\u6216\u5176\u4ed6\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u5728\u6b64\u6211\u4eec\u4e3e\u4f8b\u4fee\u6539 <code>$IFS</code> \u7684\u5e94\u7528\u573a\u666f\uff0c\u9996\u9009\u5907\u4efd\u9ed8\u8ba4\u5f53\u524d\u7684 <code>$IFS</code>\uff0c\u4e4b\u540e\u4e3a\u5176\u8d4b\u503c\u65b0\u7684 <code>$IFS</code> \u4e3a<code>:</code>\uff0c\u5728\u5bf9 /etc/passwd \u8fdb\u884c\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u6062\u590d\u4e4b\u524d\u7684 <code>$IFS</code>, \u5728\u6b64\u6211\u4eec\u5c31\u5229\u7528\u6539\u53d8 <code>$IFS</code> \u5bf9 /etc/passwd \u7684\u5355\u4e2a\u5b57\u6bb5\u8fdb\u884c\u4e86\u53d8\u91cf\u64cd\u4f5c\u3002</p> <pre><code>#!/bin/bash\nOLD_IFS=$IFS\nIFS=\":\"\nfor i in $(head -1 /etc/passwd); do\necho $i\ndone\nIFS=${OLD_IFS}\n[root@xuel-terraform-cvm-0 ~]# bash 1.sh\nroot\nx\n0\n0\nroot\n/root\n/bin/bash\n[root@xuel-terraform-cvm-0 ~]# cat /etc/passwd |head -1\nroot:x:0:0:root:/root:/bin/bash\n</code></pre> <p>for \u5faa\u73af\u5982\u679c\u6761\u4ef6\u6c38\u8fdc\u6ee1\u8db3\u5219\uff0c\u4e00\u76f4\u6267\u884c\u5185\u90e8\u7684\u547d\u4ee4\u3002</p> <pre><code>for (( ; ; ))\n</code></pre>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#222-while-\u5faa\u73af","title":"2.2.2 while \u5faa\u73af","text":"<p>while \u5faa\u73af\u540c\u6837\u4e3a\u5faa\u73af\uff0c\u4e0e for \u5faa\u73af\u529f\u80fd\u4e00\u6837\uff0c\u5229\u7528 for \u5faa\u73af\u7684\u8bed\u53e5\u540c\u6837\u4e5f\u53ef\u4ee5\u4f7f\u7528 while \u5faa\u73af\u5b8c\u6210\uff0c\u4f46\u662f while \u5faa\u73af\u901a\u5e38\u7528\u4e8e\u5904\u7406\u672a\u77e5\u6570\u91cf\u5bf9\u8c61\u7684\u64cd\u4f5c\uff0c\u8bed\u6cd5\uff1a</p> <pre><code>while \u6761\u4ef6\u8868\u8fbe\u5f0f:do\n    command\ndone\n</code></pre> <p>while \u901a\u5e38\u4e0e test \u8bed\u53e5\u914d\u5408\u4f7f\u7528\uff0c\u5982\u679c\u6761\u4ef6\u8868\u8fbe\u5f0f\u6210\u7acb\uff0c\u5219\u4e00\u76f4\u6267\u884c\u3002</p> <p>\u4f8b\u5982\u6c42\u548c\u6253\u5370 1-5 \u4e2a\u6570\uff1a</p> <pre><code>#!/bin/bash\nN=0\nwhile [ $N -lt 5 ]; do\nlet N++\n  echo $N\ndone\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5229\u7528 read \u8bfb\u5165\u6587\u4ef6\uff0c\u4f8b\u5982\u6211\u4eec\u6765\u8bfb\u5165\u4e00\u4e2a\u5199\u6709 ip \u6216\u57df\u540d\u5217\u8868\u7684\u6587\u4ef6\uff0c\u6765\u5224\u65ad\u8be5\u6587\u4ef6\u5185\u7684\u57df\u540d\u6216 IP \u7f51\u7edc\u662f\u5426\u53ef\u8fbe\u3002</p> <pre><code>#!/bin/bash\n#function:check url\nfilename=urllist.txt\nfor url in $(cat $filename)\ndo\nstatus=`curl -I --connect-timeout 5 $url -s|awk '/HTTP/{print $2}'`\nif [[ $status == \"200\" ]];then\necho \"Url:$url is ok!   status is $status\"\nelse\necho \"Url:$url is error! status is $status\"\nfi\ndone\n</code></pre> <p>\u7f16\u5199 <code>urllist.txt</code>\u3002</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat urllist.txt\nbaidu.com\n114.114.114.114\n[root@xuel-terraform-cvm-0 ~]# bash urlcheck.sh\nUrl:baidu.com is ok!   status is 200\nUrl:114.114.114.114 is error! status is\n</code></pre> <p>\u5982\u679c while \u7684\u5224\u65ad\u6761\u4ef6\u4e3a\u6c38\u8fdc\u4e3a true\uff0c\u5219\u79f0\u4e3a\u65e0\u9650\u5faa\u73af\uff0c\u4f1a\u4e00\u76f4\u6267\u884c\u5185\u90e8\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>while :\ndo\ncommand\ndone\n\u6216\u8005\nwhile true\ndo\ncommand\ndone\n</code></pre> <p>\u6b7b\u5faa\u73af\u7684\u4e09\u79cd\u5199\u6cd5</p> <pre><code>#!/usr/bin/env bash\nwhile :; do\necho \"ctrl +c to stop....\"\nsleep 1\ndone\nwhile ((1)); do\necho \"ctrl +c to stop....\"\nsleep 1\ndone\nwhile true; do\necho \"ctrl +c to stop....\"\nsleep 1\ndone\n</code></pre>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#223-until-\u5faa\u73af","title":"2.2.3 until \u5faa\u73af","text":"<p>until \u5faa\u73af\u4e0e while \u5faa\u73af\u521a\u597d\u76f8\u53cd\uff0c\u5176\u4e5f\u6709\u4e00\u5b9a\u7684\u5e94\u7528\u573a\u666f\uff0c\u5176\u4e3a\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e3a true \u65f6\u505c\u6b62\uff0c\u5426\u5219\u4e00\u76f4\u8fd0\u884c\uff0c\u8bed\u6cd5\uff1a</p> <pre><code>until \u6761\u4ef6\u8868\u8fbe\u5f0f\ndo\ncommand\ndone\n</code></pre> <p>\u4f8b\u5982\u6211\u4eec\u4f7f\u7528 until \u6765\u6253\u5370 1-5 \u6570\u5b57\uff1a</p> <pre><code>NUM=0\nuntil [ ${NUM} -ge 5 ]\ndo let NUM++\n    echo $NUM\ndone\n</code></pre>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#224-break-\u4e0e-continue","title":"2.2.4 break \u4e0e continue","text":"<p>\u4e0e\u4e0a\u9762\u4e09\u4e2a\u5faa\u73af\u8bed\u53e5\u4e0d\u540c\u7684\u662f\uff0cbreak \u4e3a\u8df3\u51fa\u5faa\u73af\uff0ccontinue \u5219\u4e3a\u4e0d\u6267\u884c\u4e0b\u4e00\u6b21\u64cd\u4f5c\uff0c\u76f4\u63a5\u8df3\u5230\u4e0b\u4e00\u6b21\u5faa\u73af\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6765\u5229\u7528 break \u6765\u8df3\u51fa\u7ec8\u6b62\u5faa\u73af\u3002</p> <ul> <li>break</li> </ul> <pre><code>#!/bin/bash\nN=0\nwhile true; do\nlet N++\n    if [ $N -eq 5 ]; then\nbreak\nfi\necho $N\ndone\n</code></pre> <ul> <li>continue</li> </ul> <pre><code>#!/bin/bash\nN=0\nwhile [ $N -lt 5 ]; do\nlet N++\n    if [ $N -eq 3 ]; then\ncontinue\nfi\necho $N\ndone\n</code></pre> <p>\u5229\u7528 continue \u6765\u8df3\u8fc7\u7279\u5b9a\u7684\u6761\u4ef6\u64cd\u4f5c\u3002</p>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#23-\u9009\u62e9\u8bed\u53e5","title":"2.3 \u9009\u62e9\u8bed\u53e5","text":""},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#231-case-\u8bed\u53e5","title":"2.3.1 case \u8bed\u53e5","text":"<p>\u9009\u62e9\u8bed\u53e5 case \u53ef\u4ee5\u5728\u7279\u5b9a\u7684\u51e0\u4e2a\u6761\u4ef6\u4e2d\u9009\u62e9\u67d0\u4e00\u4e2a\u8fdb\u884c\u6267\u884c\uff0c\u5176\u4ed6 case \u53ef\u4ee5\u5229\u7528 if \u591a\u5206\u652f\u6765\u66ff\u4ee3\u3002</p> <pre><code>case \u6a21\u5f0f\u540d    in\n\u6a21\u5f0f 1)\n\u547d\u4ee4\n        ;;\n\u6a21\u5f0f 2)\n\u547d\u4ee4\n        ;;\n*)\n\u4e0d\u7b26\u5408\u4ee5\u4e0a\u6a21\u5f0f\u6267\u884c\u7684\u547d\u4ee4\nesac\n</code></pre> <p>\u4f8b\u5982\u6211\u4eec\u670d\u52a1\u7684\u542f\u52a8\u64cd\u4f5c\u811a\u672c\u5c31\u662f\u5229\u7528 case \u8bed\u53e5\u6765\uff0c\u5f53\u7528\u6237\u7684\u8f93\u5165\u4e0e\u6a21\u5f0f\u540d\u76f8\u5339\u914d\u5219\u6267\u884c\u5bf9\u5e94\u7684\u547d\u4ee4\u3002</p> <pre><code>#!/bin/bash\ncase $1 in\nstart)\necho \"start.\"   ;;\nstop)\necho \"stop.\"\n;;\nrestart)\necho \"restart.\"\n;;\n*)\necho \"Usage: $0 {start|stop|restart}\"\nesac\n</code></pre>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#3-\u5b9e\u4f8b","title":"3. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#31-\u9700\u6c42","title":"3.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u6765\u5bf9\u5f53\u524d\u7cfb\u7edf <code>PATH</code> \u76ee\u5f55\u4e0b\u7684\u4e8c\u8fdb\u5236\u6267\u884c\u6587\u4ef6\u8fdb\u884c\uff0c\u6216\u8005\u5bf9\u6307\u5b9a\u5168\u76d8\u8fdb\u884c md5 \u626b\u63cf\uff0c\u540e\u671f\u53ef\u4ee5\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u6765\u76d1\u63a7\u6587\u4ef6\u662f\u5426\u53d8\u5316\uff0c\u7528\u4e8e\u6587\u4ef6\u6743\u9650\u53ca\u5185\u5bb9\u7684\u7ba1\u63a7\u3002</p>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#32-\u601d\u8def","title":"3.2 \u601d\u8def","text":"<p>\u6587\u4ef6\u626b\u63cf\u53ef\u4ee5\u4f7f\u7528 md5sum \u5de5\u5177\u6267\u884c\uff0c\u5bf9\u76ee\u5f55\u904d\u5386\u9700\u8981\u4f7f\u7528 for \u5faa\u73af\uff0c\u73b0\u5728\u6267\u884c\u65b9\u5f0f\u53ef\u4ee5\u4f7f\u7528 case \u6765\u64cd\u4f5c\uff0c\u5176\u4e2d\u4e00\u4e9b\u64cd\u4f5c\u4f1a\u6d89\u53ca\u5230 sed \u7684\u547d\u4ee4\uff0c\u540e\u671f\u6211\u4eec\u4f1a\u9488\u5bf9\u8fd9\u4e9b\u547d\u4ee4\u8fdb\u884c\u5355\u72ec\u7ae0\u8282\u8be6\u7ec6\u8bb2\u89e3\uff0c\u5728\u672c\u9700\u6c42\u6848\u4f8b\u4e2d\u7740\u91cd\u601d\u8003 Shell \u4e2d\u6d41\u7a0b\u63a7\u5236\u7684\u4f5c\u7528\u3002</p>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#33-\u5b9e\u73b0","title":"3.3 \u5b9e\u73b0","text":"<ul> <li>\u5177\u4f53\u5b9e\u73b0 shell \u811a\u672c</li> </ul> <pre><code>#!/bin/bash\n# Description: count file scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: count file\n# Date: 2020-03-28 14:00\n# Version: 1.0\n# \u5b9a\u4e49\u6587\u4ef6\u626b\u63cf\u76ee\u5f55\nSCAN_DIR=`echo $PATH |sed 's/:/ /g'`\nSCAN_CMD=`which md5sum`\nSCAN_FILE_FAIL=\"/tmp/scan_$(date +%F%H%m)_fall.txt\"\nSCAN_FILE_BIN=\"/tmp/scan_$(date +%F%H%m)_bin.txt\"\nscan_fall_disk() {\necho \"\u6b63\u5728\u5168\u76d8\u626b\u63cf\uff0c\u8bf7\u7a0d\u7b49\uff01\u6587\u4ef6\u8def\u5f84:$SCAN_FILE_FALL\"\nfind / -type f ! -path \"/proc/*\" -exec $SCAN_CMD \\{\\} \\;&gt;&gt; $SCAN_FILE_FAIL 2&gt;/dev/null\n    echo \"\u626b\u63cf\u5b8c\u6210,\u53ef\u5229\u7528\u4ee5\u4e0b\u547d\u4ee4\u540e\u671f\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c\"\necho \"$SCAN_CMD -c $SCAN_FILE_FAIL |grep -v 'OK$'\"\n}\nscan_bin() {\necho \"\u6b63\u5728\u626b\u63cf$PATH\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8bf7\u7a0d\u7b49\uff0c\u6587\u4ef6\u8def\u5f84\uff1a$SCAN_FILE_BIN\"\nfor file in $SCAN_DIR\ndo\nfind $file -type f -exec $SCAN_CMD \\{\\} \\;&gt;&gt; $SCAN_FILE_BIN 2&gt;/dev/null\n    done\necho \"\u626b\u63cf\u5b8c\u6210,\u53ef\u5229\u7528\u4ee5\u4e0b\u547d\u4ee4\u540e\u671f\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c\"\necho \"$SCAN_CMD -c $SCAN_FILE_BIN |grep -v 'OK$'\"\n}\nclear\necho \"##########################################\"\necho \"#                                        #\"\necho \"#        \u5229\u7528md5sum\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c        #\"\necho \"#                                        #\"\necho \"##########################################\"\necho \"1: \u5168\u76d8\u626b\u63cf\"\necho \"2: bin path\u626b\u63cf\"\necho \"3: EXIT\"\n# \u9009\u62e9\u626b\u63cf\u65b9\u5f0f\nread -p \"Please input your choice:\" method\ncase $method in 1)\nscan_fall_disk;;\n2)\nscan_bin;;\n3)\necho \"you choce channel!\" &amp;&amp; exit 1;;\n*)\necho \"input Error! Place input{1|2|3}\" &amp;&amp; exit 0;;\nesac\n</code></pre> <ul> <li>\u6d4b\u8bd5</li> </ul> <pre><code>[root@xuel-terraform-cvm-0 ~]# bash file_scan.sh\n##########################################\n#                                        #\n#        \u5229\u7528md5sum\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c        #\n#                                        #\n##########################################\n1: \u5168\u76d8\u626b\u63cf\n2: bin path\u626b\u63cf\n3: EXIT\nPlease input your choice:2\n\u6b63\u5728\u626b\u63cf/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8bf7\u7a0d\u7b49\uff0c\u6587\u4ef6\u8def\u5f84\uff1a/tmp/scan_2020-03-271703_bin.txt\n\u626b\u63cf\u5b8c\u6210,\u53ef\u5229\u7528\u4ee5\u4e0b\u547d\u4ee4\u540e\u671f\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c\n/usr/bin/md5sum -c /tmp/scan_2020-03-271703_bin.txt |grep -v 'OK$'\n[root@xuel-terraform-cvm-0 ~]# /usr/bin/md5sum -c /tmp/scan_2020-03-271703_bin.txt |grep -v 'OK$'\n/sbin/mii-tool: \u786e\u5b9a\n/sbin/wipefs: \u786e\u5b9a\n/sbin/blkdiscard: \u786e\u5b9a\n/sbin/rtmon: \u786e\u5b9a\n/sbin/shutdown: \u786e\u5b9a\n/sbin/aureport: \u786e\u5b9a\n/sbin/plymouthd: \u786e\u5b9a\n/sbin/udevd: \u786e\u5b9a\n/sbin/lvmetad: \u786e\u5b9a\n/sbin/e2undo: \u786e\u5b9a\n...\n</code></pre> <p>\u5f53\u6211\u4eec\u8f93\u5165\u6570\u5b57 2 \u7684\u65f6\u5019\u5373\u5bf9 bin \u8def\u5f84\u6267\u884c\u626b\u63cf\uff0c\u626b\u63cf\u5b8c\u6210\u540e\u4f1a\u751f\u6210\u5bf9\u5e94\u7684\u626b\u63cf\u6587\u4ef6\uff0c\u53ef\u4ee5\u6267\u884c <code>/usr/bin/md5sum -c /tmp/scan_2020-03-271703_bin.txt |grep -v 'OK$'</code> \u6765\u8fdb\u884c\u540e\u671f\u6587\u4ef6\u6821\u9a8c\u3002</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# bash file_scan.sh\n##########################################\n#                                        #\n#        \u5229\u7528md5sum\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c           #\n#                                        #\n##########################################\n1: \u5168\u76d8\u626b\u63cf\n2: bin path\u626b\u63cf\n3: EXIT\nPlease input your choice:3\nyou choce channel!\n</code></pre> <p>\u5f53\u8f93\u5165 3 \u7a0b\u5e8f\u9000\u51fa\uff0c\u5728\u6b64\u5c31\u662f\u4f7f\u7528 case \u6765\u5b8c\u6210\u3002</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# bash file_scan.sh\n##########################################\n#                                        #\n#        \u5229\u7528md5sum\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c             #\n#                                        #\n##########################################\n1: \u5168\u76d8\u626b\u63cf\n2: bin path\u626b\u63cf\n3: EXIT\nPlease input your choice:1\n\u6b63\u5728\u5168\u76d8\u626b\u63cf\uff0c\u8bf7\u7a0d\u7b49\uff01\u6587\u4ef6\u8def\u5f84:\n\u626b\u63cf\u5b8c\u6210,\u53ef\u5229\u7528\u4ee5\u4e0b\u547d\u4ee4\u540e\u671f\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c\n/usr/bin/md5sum -c /tmp/scan_2020-03-271703_fall.txt |grep -v 'OK$'\n[root@xuel-terraform-cvm-0 ~]# /usr/bin/md5sum -c /tmp/scan_2020-03-271703_fall.txt |grep -v 'OK$' |more\n/sys/devices/platform/uevent: \u786e\u5b9a\n/sys/devices/platform/power/control: \u786e\u5b9a\n/sys/devices/platform/power/wakeup: \u786e\u5b9a\n/sys/devices/platform/pcspkr/uevent: \u786e\u5b9a\n/sys/devices/platform/pcspkr/modalias: \u786e\u5b9a\n/sys/devices/platform/pcspkr/power/control: \u786e\u5b9a\n/sys/devices/platform/pcspkr/power/wakeup: \u786e\u5b9a\n/sys/devices/platform/platform-framebuffer.0/uevent: \u786e\u5b9a\n/sys/devices/platform/platform-framebuffer.0/modalias: \u786e\u5b9a\n/sys/devices/platform/platform-framebuffer.0/power/control: \u786e\u5b9a\n/sys/devices/platform/platform-framebuffer.0/power/wakeup: \u786e\u5b9a\n/sys/devices/platform/serial8250/uevent: \u786e\u5b9a\n/sys/devices/platform/serial8250/modalias: \u786e\u5b9a\n/sys/devices/platform/serial8250/power/control: \u786e\u5b9a\n/sys/devices/platform/serial8250/power/wakeup: \u786e\u5b9a\n/sys/devices/platform/serial8250/tty/ttyS1/uevent: \u786e\u5b9a\n/sys/devices/platform/serial8250/tty/ttyS1/dev: \u786e\u5b9a\n/sys/devices/platform/serial8250/tty/ttyS1/power/cont\n</code></pre>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#4-\u6ce8\u610f\u4e8b\u9879","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5bf9\u4e8e\u6761\u4ef6\u8bed\u53e5\u4e2d\u7684\u591a\u5206\u652f if \u8bed\u53e5\uff0c\u7ed3\u5c3e\u80af\u5b9a\u662f\u6709\u4e00\u4e2a else \u6765\u5b8c\u6210\uff0c\u9700\u8981\u6ce8\u610f\u6b64\u70b9\uff1b</li> <li>\u5728\u7f16\u5199\u6d41\u7a0b\u63a7\u5236\u65f6\u5019\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u4e60\u60ef\u5bf9\u4e8e <code>command</code> \u4e2d\u7684\u64cd\u4f5c\u8fdb\u884c\u7f29\u8fdb\uff0c\u53ef\u4ee5\u4e3a\u51e0\u4e2a\u7a7a\u683c\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u4e00\u4e2a tab \u952e\uff0c\u5efa\u8bae\u4f7f\u7528\u4e00\u4e2a\u5236\u8868\u7b26\uff1b</li> <li>\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u53ef\u4ee5\u76f8\u4e92\u5d4c\u5957\uff0c\u4f8b\u5982 for \u5faa\u73af\u4e2d\u53ef\u4ee5\u6709 if \u6761\u4ef6\u5224\u65ad\uff0cif \u6dfb\u52a0\u5224\u65ad\u4e2d\u4e5f\u53ef\u4ee5\u6dfb\u52a0 for \u5faa\u73af\u7b49\uff0c\u6839\u636e\u9700\u6c42\u5177\u4f53\u7075\u6d3b\u8fd0\u7528\uff1b</li> <li>case \u8bed\u53e5\u4e0e if \u591a\u5206\u652f\u8bed\u53e5\u4e00\u6837\uff0c\u4e0d\u540c\u70b9\u5728\u4e0e case \u8bed\u53e5\u53ea\u80fd\u5224\u65ad\u4e00\u79cd\u6761\u4ef6\u5173\u7cfb\uff0c\u800c if \u591a\u5206\u652f\u53ef\u4ee5\u5bf9\u591a\u79cd\u6761\u4ef6\u8fdb\u884c\u5224\u65ad\u3002</li> </ul>"},{"location":"Linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#5-\u5c0f\u7ed3","title":"5. \u5c0f\u7ed3","text":"<p>\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u662f\u6211\u4eec Shell \u7f16\u5199\u7684\u7ecf\u7edc\uff0c\u5229\u7528\u5b83\u6765\u63a7\u5236\u7a0b\u5e8f\u7684\u8d70\u5411\uff0c\u9700\u8981\u6211\u4eec\u80fd\u719f\u7ec3\u638c\u63e1\u6700\u5e38\u7528\u7684\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\uff0c\u5e76\u77e5\u9053\u5176\u5bf9\u5e94\u7684\u9002\u5e94\u573a\u666f\uff0c\u7075\u6d3b\u914d\u5408\u4f7f\u7528\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/","title":"9.Shell\u51fd\u6570","text":""},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#1-shell-\u51fd\u6570\u6982\u8ff0","title":"1. Shell \u51fd\u6570\u6982\u8ff0","text":""},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#11-shell-\u51fd\u6570\u7b80\u4ecb","title":"1.1 Shell \u51fd\u6570\u7b80\u4ecb","text":"<p>Shell \u548c\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0c\u4e5f\u6709\u51fd\u6570\uff0c\u5176\u672c\u8d28\u5c31\u662f\u4e00\u6bb5\u53ef\u4ee5\u590d\u7528\u7684\u4ee3\u7801\u3002\u5c06\u6570\u636e\u8fdb\u884c\u62bd\u79bb\u5904\u7406\uff0c\u4f20\u9012\u4e0d\u540c\u7684\u503c\u8f93\u51fa\u4e0d\u540c\u7684\u7ed3\u679c\uff0c\u5728\u6307\u5b9a\u7684\u5730\u65b9\u8fdb\u884c\u8c03\u7528\u5373\u53ef\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#12-\u4e3a\u4ec0\u4e48\u8981\u7528\u51fd\u6570","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u51fd\u6570","text":"<p>\u5982\u679c\u6211\u4eec\u8981\u91cd\u590d\u6267\u884c\u4e00\u6279\u76f8\u540c\u7684\u64cd\u4f5c\uff0c\u4e0d\u60f3\u91cd\u590d\u53bb\u5199\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e00\u7cfb\u5217\u64cd\u4f5c\u62bd\u8c61\u4e3a\u4e00\u4e2a\u51fd\u6570\uff0c\u540e\u671f\u53ef\u4ee5\u5229\u7528\u53d8\u91cf\u4f20\u503c\u8c03\u8be5\u51fd\u6570\uff0c\u4ece\u800c\u5927\u5927\u51cf\u5c11\u91cd\u590d\u6027\u52b3\u52a8\uff0c\u63d0\u5347\u6548\u7387\u51cf\u5c11\u4ee3\u7801\u91cf\uff0c\u4f7f\u5f97 Shell \u811a\u672c\u66f4\u52a0\u7684\u7075\u6d3b\u548c\u901a\u7528\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#2-shell-\u51fd\u6570\u64cd\u4f5c","title":"2. Shell \u51fd\u6570\u64cd\u4f5c","text":""},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#21-\u51fd\u6570\u8bed\u6cd5","title":"2.1 \u51fd\u6570\u8bed\u6cd5","text":""},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#211-\u6807\u51c6\u8bed\u6cd5","title":"2.1.1 \u6807\u51c6\u8bed\u6cd5","text":"<pre><code>function fnname() { statements\n    return value\n}\n</code></pre> <p>\u5bf9\u5404\u4e2a\u90e8\u5206\u7684\u8bf4\u660e\uff1a</p> <ul> <li><code>function</code> \u662f Shell \u4e2d\u7684\u5173\u952e\u5b57\uff0c\u4e13\u95e8\u7528\u6765\u5b9a\u4e49\u51fd\u6570\uff1b</li> <li><code>fname</code> \u662f\u51fd\u6570\u540d\uff1b</li> <li><code>statements</code> \u662f\u51fd\u6570\u8981\u6267\u884c\u7684\u4ee3\u7801\uff0c\u4e5f\u5c31\u662f\u4e00\u7ec4\u8bed\u53e5\uff1b</li> <li><code>return value</code> \u8868\u793a\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u5176\u4e2d return \u662f Shell \u5173\u952e\u5b57\uff0c\u4e13\u95e8\u7528\u5728\u51fd\u6570\u4e2d\u8fd4\u56de\u4e00\u4e2a\u503c\uff0c\u8fd9\u4e00\u90e8\u5206\u53ef\u4ee5\u5199\u4e5f\u53ef\u4ee5\u4e0d\u5199\u3002</li> </ul> <p>\u7531\u5927\u62ec\u53f7\u5305\u56f4\u7684\u90e8\u5206\u79f0\u4e3a\u51fd\u6570\u4f53\uff0c\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u6267\u884c\u51fd\u6570\u4f53\u4e2d\u7684\u4ee3\u7801\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>function checkuser() { echo \"\u5f53\u524d\u7528\u6237\u4e3a:$USER\"\nreturn 0\n}\n</code></pre> <p>\u5982\u4e0a\u5c31\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>checkuser</code> \u51fd\u6570\uff0c\u5176\u8f93\u51fa\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7684\u7528\u6237\u540d\uff0c\u8fd4\u56de\u503c\u4e3a 0\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#212-\u7b80\u5316\u8bed\u6cd5","title":"2.1.2 \u7b80\u5316\u8bed\u6cd5","text":"<ul> <li>\u51fd\u6570\u540d\u540e\u65e0\u62ec\u53f7</li> </ul> <pre><code>#\u7b80\u5316\u5199\u6cd51\nfunction fname{ statements\n    return n\n}\n</code></pre> <ul> <li>\u51fd\u6570\u4e0d\u5199 function</li> </ul> <pre><code>#\u7b80\u5316\u5199\u6cd52\uff1a\nfname() {\nstatements\n    return n\n}\n</code></pre> <p>\u4e0a\u8ff0\u4e24\u79cd\u5b9a\u4e49\u51fd\u6570\u7684\u65b9\u6cd5\u90fd\u53ef\u4ee5\uff0c\u4f46\u662f\u8fd8\u662f\u5efa\u8bae\u5728\u7f16\u5199 Shell \u7684\u65f6\u5019\uff0c\u4e5f\u4e0d\u5dee\u6d6a\u8d39\u8fd9\u70b9\u65f6\u95f4\uff0c\u5efa\u8bae\u5927\u5bb6\u90fd\u7528\u5b8c\u6574\u51fd\u6570\u5b9a\u4e49\uff0c\u5199 function \u5173\u952e\u5b57\uff0c\u5728\u4e3a\u51fd\u6570\u5b9a\u4e49\u5e26\u4e0a ()\uff0c\u8fd9\u6837\u66f4\u52a0\u89c4\u8303\uff0c\u800c\u4e14\u4fbf\u4e8e\u522b\u4eba\u9605\u8bfb\u4fee\u6539\u4f60\u7684\u811a\u672c\u3002</p> <p>Tips\uff1a\u5728\u51fd\u6570\u5b9a\u4e49\u4e2d\u9700\u8981\u51fd\u6570\u540d\u79f0\u540e\u53ef\u4ee5\u6709\u591a\u4e2a\u7a7a\u683c\uff0c\u62ec\u53f7\u5185\u4e5f\u53ef\u4ee5\u6709\u591a\u4e2a\u7a7a\u683c\uff0c\u5982\u679c\u51fd\u6570\u4f53\u5199\u5728\u4e00\u884c\uff0c\u9700\u8981\u5728\u8bed\u53e5\u672b\u5c3e\u52a0\u4e0a <code>;</code>\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#22-\u51fd\u6570\u8c03\u7528","title":"2.2 \u51fd\u6570\u8c03\u7528","text":"<p>\u5f53\u51fd\u6570\u5b9a\u4e49\u597d\u4e86\uff0c\u5728\u9700\u8981\u4f7f\u7528\u51fd\u6570\u7684\u5730\u65b9\uff0c\u8c03\u7528\u5176\u51fd\u6570\u540d\u79f0\u5373\u53ef\uff0c\u6ce8\u610f\u51fd\u6570\u8c03\u7528\u9700\u8981\u5728\u51fd\u6570\u5b9a\u4e49\u4e4b\u540e\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#221-\u65e0\u53c2\u6570\u8c03\u7528","title":"2.2.1 \u65e0\u53c2\u6570\u8c03\u7528","text":"<p>\u5f53\u51fd\u6570\u6ca1\u6709\u53c2\u6570\u7684\u65f6\u5019\uff0c\u8c03\u7528\u975e\u5e38\u7b80\u5355\uff0c\u76f4\u63a5\u5199\u51fd\u6570\u540d\u79f0\u5373\u53ef\uff0c\u8c03\u7528\u51fd\u6570\u5c31\u662f\u5728\u7279\u5b9a\u5730\u65b9\u6267\u884c\u51fd\u6570\u4f53\u5185\u7684\u64cd\u4f5c\u3002</p> <pre><code>// \u5b9a\u4e49\u51fd\u6570\nfunction fnname() { statements\n    return value\n}\n// \u8c03\u7528\u51fd\u6570\nfname\n</code></pre>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#222-\u4f20\u9012\u53c2\u6570\u8c03\u7528","title":"2.2.2 \u4f20\u9012\u53c2\u6570\u8c03\u7528","text":"<ul> <li>\u8bed\u6cd5</li> </ul> <p>\u6211\u4eec\u4e4b\u524d\u5728\u53d8\u91cf\u4e00\u7ae0\u8282\u4ecb\u7ecd\u4e86 Shell \u811a\u672c\u7684\u53c2\u6570\uff0c\u77e5\u9053\u4e86\u53c2\u6570\u7684\u91cd\u8981\u6027\u8d28\u53ca\u5176\u5404\u79cd\u7c7b\u7279\u5f81\uff0c\u4e0e Shell \u811a\u672c\u4f20\u9012\u53c2\u6570\u4e00\u6837\uff0c\u51fd\u6570\u4e5f\u53ef\u4ee5\u4f20\u9012\u53c2\u6570\uff0c\u4f8b\u5982\uff1a</p> <pre><code>// \u5b9a\u4e49\u51fd\u6570\nfunction fnname() { statements\n    return value\n}\n// \u8c03\u7528\u51fd\u6570\nfname param1 param2 param3\n</code></pre> <p>\u5982\u4e0a\u6240\u793a\uff0c\u5728\u8c03\u7528\u51fd\u6570 <code>fname</code> \u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f20\u9012\u4e86\u4e09\u4e2a\u53c2\u6570\uff0c\u53c2\u6570\u4e4b\u95f4\u5229\u7528\u7a7a\u683c\u5206\u5272\uff0c\u548c Shell \u811a\u672c\u4f20\u9012\u53c2\u6570\u4e00\u6837\uff0c\u4f46\u9700\u8981\u6ce8\u610f Shell \u811a\u672c\u4e2d\uff0c\u51fd\u6570\u5728\u5b9a\u4e49\u65f6\u5019\u4e0d\u80fd\u6307\u5b9a\u53c2\u6570\uff0c\u5728\u8c03\u7528\u7684\u65f6\u5019\u4f20\u9012\u53c2\u6570\u5373\u53ef\uff0c\u5e76\u4e14\u5728\u8c03\u7528\u51fd\u6570\u65f6\u4f20\u9012\u4ec0\u4e48\u53c2\u6570\u51fd\u6570\u5c31\u63a5\u53d7\u4ec0\u4e48\u53c2\u6570\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#23-\u51fd\u6570\u53c2\u6570","title":"2.3 \u51fd\u6570\u53c2\u6570","text":"<p>\u4e0a\u8ff0\u6211\u4eec\u4e86\u89e3\u4e86\u51fd\u6570\u7684\u5b9a\u4e49\uff0c\u5728\u5176\u4e2d\u65e0\u53c2\u51fd\u6570\u8c03\u7528\u5373\u8c03\u7528\u51fd\u6570\u540d\u5373\u53ef\uff0c\u5bf9\u4e8e\u6709\u53c2\u51fd\u6570\uff0c\u9700\u8981\u4f20\u9012\u4e00\u5b9a\u7684\u53c2\u6570\u6765\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\uff0c\u51fd\u6570\u7684\u53c2\u6570\u548c\u811a\u672c\u7684\u53c2\u6570\u7c7b\u578b\u53ca\u7528\u6cd5\u4e00\u81f4\uff0c\u5728\u6b64\u6211\u4eec\u7b80\u5355\u56de\u987e\u4e0b\uff0c\u770b\u53c2\u6570\u5728\u51fd\u6570\u4e2d\u90fd\u6709\u54ea\u4e9b\u5206\u7c7b\uff0c\u53ca\u8be5\u5982\u4f55\u4f7f\u7528\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#231-\u4f4d\u7f6e\u53c2\u6570","title":"2.3.1 \u4f4d\u7f6e\u53c2\u6570","text":"<p>\u4f4d\u7f6e\u53c2\u6570\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u4f20\u9012\u7ed9\u51fd\u6570\u53c2\u6570\u7684\u4f4d\u7f6e\uff0c\u4f8b\u5982\u7ed9\u4e00\u4e2a\u51fd\u6570\u4f20\u9012\u4e00\u4e2a\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6267\u884c Shell \u811a\u672c\u83b7\u53d6\u5bf9\u5e94\u4f4d\u7f6e\u7684\u53c2\u6570\uff0c\u83b7\u53d6\u53c2\u6570\u7684\u683c\u5f0f\u4e3a\uff1a$n\u3002n \u4ee3\u8868\u4e00\u4e2a\u6570\u5b57\uff0c\u5728\u6b64\u9700\u8981\u6ce8\u610f\u4e0e\u811a\u672c\u4f20\u9012\u53c2\u6570\u4e0d\u4e00\u6837\uff0c<code>$0</code> \u4e3a\u4f9d\u65e7\u4e3a\u811a\u672c\u7684\u540d\u79f0\uff0c\u5728\u51fd\u6570\u53c2\u6570\u4f20\u9012\u4e2d\uff0c\u4f8b\u5982\u4f20\u9012\u7ed9\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u83b7\u53d6\u5c31\u4e3a <code>$1</code>\uff0c\u7b2c 2 \u4e2a\u53c2\u6570\u5c31\u4e3a <code>$2</code>, \u4ee5\u6b64\u7c7b\u63a8\u2026\u2026\uff0c\u9700\u8981\u5176 <code>$0</code> \u4e3a\u8be5\u51fd\u6570\u7684\u540d\u79f0\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master func]# cat f1.sh \n#!/bin/bash\nfunction f1() {\necho \"\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: ${1}\"\necho \"\u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: ${2}\"\necho \"\u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: ${3}\"\n}\n# \u8c03\u7528\u51fd\u6570\nf1 shell linux python go\n\n[root@master func]# bash f1.sh \n\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: shell\n\u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: linux\n\u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: python\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4f20\u9012\u7ed9 <code>f1</code> \u51fd\u6570\u5171 4 \u4e2a\u4f4d\u7f6e\u53c2\u6570\uff0c\u5728\u7ed3\u679c\u8f93\u51fa\u4e2d\u53ef\u4ee5\u770b\u5230\u7531\u4e8e\u51fd\u6570\u4f53\u5185\u90e8\u53ea\u5bf9\u4e09\u4e2a\u53c2\u6570\u8fdb\u884c\u4e86\u5904\u7406\uff0c\u540e\u7eed\u7684\u53c2\u6570\u4e5f\u5c31\u4e0d\u518d\u5904\u7406\u4e86\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#232-\u7279\u6b8a\u53c2\u6570","title":"2.3.2 \u7279\u6b8a\u53c2\u6570","text":"<p>\u5728 Shell \u4e2d\u4e5f\u5b58\u5728\u7279\u6b8a\u542b\u4e49\u7684\u53c2\u6570\u5982\u4e0b\u8868\uff1a</p> \u53d8\u91cf \u542b\u4e49 $# \u4f20\u9012\u7ed9\u51fd\u6570\u7684\u53c2\u6570\u4e2a\u6570\u603b\u548c $* \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6240\u6709\u7684\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u4e00\u4e2a\u5b57\u7b26\u4e32 $@ \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u72ec\u7acb\u7684\u5b57\u7b26\u4e32 $? <code>$?</code> \u8868\u793a\u51fd\u6570\u7684\u9000\u51fa\u72b6\u6001\uff0c\u8fd4\u56de\u4e3a 0 \u4e3a\u6267\u884c\u6210\u529f\uff0c\u975e 0 \u5219\u4e3a\u6267\u884c\u5931\u8d25 <p>\u793a\u4f8b\uff1a</p> <pre><code>[root@master func]# cat f1.sh \n#!/bin/bash\nfunction fsum() {\necho \"\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: ${1}\"\necho \"\u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: ${2}\"\necho \"\u51fd\u6570\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: ${3}\"\necho \"\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: ${#}\"\necho \"\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: ${@}\"\nlocal sum=0\nfor num in ${@};\ndo\nlet sum=${sum}+${num}\ndone\necho \"\u8ba1\u7b97\u7684\u603b\u548c\u4e3a: ${sum}\"\nreturn 0\n}\n# \u8c03\u7528\u51fd\u6570\nfsum 10 20 1 2\necho $?\n[root@master func]# bash f1.sh \n\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: 10\n\u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: 20\n\u51fd\u6570\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: 1\n\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: 4\n\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: 10 20 1 2\n\u8ba1\u7b97\u7684\u603b\u548c\u4e3a: 33\n0\n</code></pre> <p>\u5982\u4e0a\u53ef\u4ee5\u770b\u5230\u7279\u6b8a\u53c2\u6570\u4e0e Shell \u811a\u672c\u4f20\u9012\u53c2\u6570\u4e00\u6837\u3002</p> <p>Tips\uff1a\u5c40\u90e8\u53d8\u91cf\u9700\u8981\u7279\u522b\u58f0\u660e\u5728\u51fd\u6570\u5185\u90e8\u5229\u7528 <code>local</code> \u5173\u952e\u5b57\u6765\u58f0\u660e\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#24-\u51fd\u6570\u8fd4\u56de\u503c","title":"2.4 \u51fd\u6570\u8fd4\u56de\u503c","text":"<p>\u51fd\u6570\u8fd4\u56de\u503c\u5229\u7528 <code>$?</code> \u6765\u63a5\u6536\uff0c\u5728\u4e0a\u8ff0\u793a\u4f8b\u4e2d\u6211\u4eec\u5c06\u8ba1\u7b97\u7684\u7ed3\u679c\u5229\u7528 echo \u547d\u4ee4\u6253\u5370\u51fa\u6765\uff0c\u5982\u679c\u6211\u4eec\u5728\u540e\u7eed\u7684\u811a\u672c\u4e2d\u9700\u8981\u5229\u7528\u6b64\u51fd\u6570\u7ed3\u7b97\u7684\u7ed3\u679c\uff0c\u5c31\u9700\u8981\u5f97\u5230\u8fd9\u4e2a\u8fd4\u56de\u503c\uff0c\u6b64\u523b\u5c31\u9700\u8981\u5c06\u8ba1\u7b97\u7684\u7ed3\u679c\u4e0d\u4ec5\u4ec5\u662f\u6253\u5370\u800c\u662f\u8fd4\u56de\u4e86\uff0c\u51fd\u6570\u4e2d\u8fd4\u56de\u5229\u7528 <code>return</code> \u5173\u952e\u5b57\uff0c\u5728\u51fd\u6570\u8c03\u7528\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5229\u7528 <code>$?</code> \u6765\u63a5\u53d7\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u4f8b\u5982\u5c06\u6211\u4eec\u4e0a\u9762\u7684\u793a\u4f8b\u6539\u9020\u6210\u8fd4\u56de\u7ed3\u6784\u7684\u51fd\u6570\u3002</p> <p>\u6ce8\u610f\uff1ashell \u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u53ea\u80fd\u662f\u6574\u5f62\uff0c\u5e76\u4e14\u5728 0-257 \u4e4b\u95f4\uff0c\u4e0d\u80fd\u662f\u5b57\u7b26\u4e32\u6216\u5176\u4ed6\u5f62\u5f0f\u3002\u5e76\u4e14\u5728\u8c03\u7528\u65b9\u6cd5\u548c\u53d6\u5f97\u8fd4\u56de\u503c\u4e4b\u95f4\uff0c\u4e0d\u80fd\u6709\u4efb\u4f55\u64cd\u4f5c\uff0c\u4e0d\u7136\u53d6\u4e0d\u5230 return \u7684\u503c\u3002</p> <pre><code>[root@master func]# cat f1.sh \n#!/bin/bash\nfunction fsum() {\necho \"\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: ${1}\"\necho \"\u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: ${2}\"\necho \"\u51fd\u6570\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: ${3}\"\necho \"\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: ${#}\"\necho \"\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: ${@}\"\nlocal sum=0\nfor num in ${@};\ndo\nlet sum=${sum}+${num}\ndone\nreturn $sum\n}\nfsum 10 20 1 2\necho $?\n[root@master func]# bash f1.sh \n\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: 10\n\u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: 20\n\u51fd\u6570\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: 1\n\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: 4\n\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: 10 20 1 2\n33\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5c06\u5728\u51fd\u6570\u5185\u90e8\u8ba1\u7b97\u7684\u6570\u7ec4\u4e4b\u548c\uff0c\u5229\u7528 return \u4f5c\u4e3a\u8fd4\u56de\uff0c\u6b64\u523b\u5728\u51fd\u6570\u8c03\u7528\u7684\u65f6\u5019\uff0c\u5229\u7528 <code>$?</code> \u5c31\u53ef\u4ee5\u62ff\u5230\u51fd\u6570\u8fd4\u56de\u7684\u503c\u8fdb\u4e00\u6b65\u5904\u7406\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#25-\u9012\u5f52\u51fd\u6570","title":"2.5 \u9012\u5f52\u51fd\u6570","text":"<p>Shell \u652f\u6301\u9012\u5f52\u51fd\u6570\uff0c\u9012\u5f52\u51fd\u6570\u4e5f\u5c31\u662f\u81ea\u5df1\u8c03\u7528\u81ea\u5df1\uff0c\u5373\u5728\u51fd\u6570\u4f53\u5185\u90e8\u53c8\u4e00\u6b21\u8c03\u7528\u51fd\u6570\u81ea\u5df1\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master func]# cat recursion.sh \n#!/bin/bash\nfunction myecho() {\necho \"$(date)\"\nsleep 1\nmyecho inner\n}\nmyecho\n[root@master func]# bash recursion.sh \nSat Mar 28 13:14:38 CST 2020\nSat Mar 28 13:14:39 CST 2020\nSat Mar 28 13:14:40 CST 2020\nSat Mar 28 13:14:41 CST 2020\nSat Mar 28 13:14:42 CST 2020\n...\n</code></pre> <p>\u5982\u4e0a\u5c31\u662f\u4e00\u4e2a\u9012\u5f52\u51fd\u6570\uff0c\u5728\u51fd\u6570\u4f53\u5185\u90e8\u53c8\u8c03\u7528\u4e86\u51fd\u6570 <code>myecho</code>\uff0c\u5728\u6267\u884c\u7684\u65f6\u5019\u5c31\u4f1a\u9677\u5165\u65e0\u9650\u5faa\u73af\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#3-\u5b9e\u4f8b","title":"3. \u5b9e\u4f8b","text":""},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#31-\u9700\u6c42","title":"3.1 \u9700\u6c42","text":"<p>\u7cfb\u7edf\u7ecf\u5e38\u5728\u6267\u884c\u5b9a\u65f6\u811a\u672c\u671f\u95f4\u4f1a\u5c06 Linux \u7cfb\u7edf CPU \u5229\u7528\u7387\u8dd1\u6ee1\uff0c\u5bfc\u81f4\u5176\u4ed6\u670d\u52a1\u53d7\u5230\u5f71\u54cd\uff0c\u6545\u67e5\u9605\u8d44\u6599\u53d1\u73b0\u6709\u5927\u795e\u5199\u7684 CPU \u5229\u7528\u7387\u9650\u5236\u7a0b\u5e8f\u3002 \u5730\u5740\uff1aCPU Usage Limiter for Linux</p> <p>\u5229\u7528\u6b64\u5de5\u5177\u53ef\u4ee5\uff0c\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u653e\u7f6e\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u8fbe\u5230\u9650\u5236\u7a0b\u5e8f CPU \u60c5\u51b5\uff0c\u53ef\u6839\u636e\u81ea\u5df1\u7cfb\u7edf CPU \u6838\u5fc3\u6570\u8fdb\u884c\u53c2\u6570\u914d\u7f6e\uff0c\u4f1a\u8bb0\u5f55 CPU \u8d85\u8fc7\u9600\u503c\u7684\u65e5\u5fd7\uff0c\u53ef\u4f9b\u540e\u671f\u8fdb\u884c\u67e5\u770b\u5206\u6790\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#32-\u601d\u8def","title":"3.2 \u601d\u8def","text":"<p>\u5229\u7528\u51fd\u6570\u7f16\u5199\u5b89\u88c5 cpulimit \u5de5\u5177\u7684\u51fd\u6570\uff0c\u5982\u679c\u7cfb\u7edf\u4e0d\u5b58\u5728\u8be5\u547d\u4ee4\u5219\u5b89\u88c5\u5e76\u6267\u884c CPU \u9650\u5236\uff0c\u5982\u679c\u5b58\u5728\u5219\u6267\u884c cpulimit \u51fd\u6570\u5bf9\u8d85\u8fc7\u6307\u5b9a CPU \u7684\u8fdb\u7a0b\u8fdb\u884c\u9650\u5236\uff0c\u6700\u540e\u6267\u884c\u603b\u4f53 main \u51fd\u6570\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#33-\u5b9e\u73b0","title":"3.3 \u5b9e\u73b0","text":"<ul> <li>\u5b9e\u73b0\u811a\u672c</li> </ul> <pre><code>#!/bin/bash\n# Description: count file scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: count file\n# Date: 2020-03-29 14:00\n# Version: 1.0\n[ $(id -u) -gt 0 ] &amp;&amp; exit 1\n# cpu\u4f7f\u7528\u8d85\u8fc7\u767e\u5206\u4e4b\u591a\u5c11\u8fdb\u884c\u9650\u5236\nPEC_CPU=80\n# \u9650\u5236\u8fdb\u7a0b\u4f7f\u7528\u767e\u5206\u4e4b\u591a\u5c11,\u5982\u679c\u7a0b\u5e8f\u4e3a\u591a\u7ebf\u7a0b\uff0c\u5355\u4e2acpu\u9650\u5236\u4e3a85\uff0c\u5982\u679c\u4e3a\u591a\u6838\u5fc3\uff0c\u5c31\u9700\u8981\u6309\u7167\u6bd4\u4f8b\u5199\uff0c\u4f8b\u5982cpu\u4e3a2c\uff0c\u50cf\u9650\u5236\u591a\u7ebf\u7a0b\u5360\u6bd480%\uff0c\u5c31\u5199170\nLIMIT_CPU=85\n# \u65e5\u5fd7\nLOG_DIR=/var/log/cpulimit/\n\n# \u8d85\u8fc7\u9600\u503c\u8fdb\u7a0bpid\nPIDARG=$(ps -aux |awk -v CPU=${PEC_CPU} '{if($3 &gt; CPU) print $2}')\n# \u5b89\u88c5cpulimit \u51fd\u6570\ninstall_cpulimit() {\n[ ! -d /tmp ] &amp;&amp; mkdir /tmp || cd /tmp\n    wget -c https://github.com/opsengine/cpulimit/archive/v0.2.tar.gz\n    tar -zxf v0.2.tar.gz\n    cd cpulimit-0.2 &amp;&amp; make\n    [ $? -eq 0 ] &amp;&amp; cp src/cpulimit /usr/bin/\n}\n# \u6267\u884ccpulimit\ndo_cpulimit() {\n[ ! -d ${LOG_DIR} ] &amp;&amp; mkdir -p ${LOG_DIR}\nfor i in ${PIDARG};\ndo\nCPULIMITCMD=$(which cpulimit)\nMSG=$(ps -aux |awk -v pid=$i '{if($2 == pid) print $0}')\necho ${MSG}\n[ ! -d /tmp ] &amp;&amp; mkdir /tmp || cd /tmp\n    nohup ${CPULIMITCMD} -p $i -l ${LIMIT_CPU} &amp;\necho \"$(date) -- ${MSG}\" &gt;&gt; ${LOG_DIR}$(date +%F).log\ndone\n}\n# \u4e3b\u51fd\u6570\nmain() {\nhash cpulimit\n    if [ $? -eq 0 ];then\n# \u8c03\u7528\u51fd\u6570\ndo_cpulimit\n    else\ninstall_cpulimit &amp;&amp; do_cpulimit\n    fi\n}\nmain\n</code></pre> <ul> <li>\u6d4b\u8bd5</li> </ul> <p>\u9700\u7f16\u5199 CPU \u538b\u529b\u6d4b\u8bd5 python \u811a\u672c\uff0c\u540e\u671f\u53ef\u4ee5\u653e\u5165\u8ba1\u5212\u4efb\u52a1\u6765\u76d1\u63a7\u5e76\u9650\u5236 CPU \u4f7f\u7528\u7387\u3002</p> <pre><code>#!/bin/env python\nimport math\nimport random\n\na=10000\nb=10000\nc=10000\nsum=0\nfor i in range(0,a):\n    for j in range(0,b):\n        randomfloat=random.uniform(1,10)\nrandompow=random.uniform(1,10)\nsum+=math.pow(randomfloat, randompow)\nprint \"sum is %s\" % sum\n</code></pre> <p>\u5f53\u6211\u4eec\u6267\u884c python \u7684 CPU \u538b\u529b\u6d4b\u8bd5\u811a\u672c\u540e\uff0c\u53d1\u73b0\u5355\u6838\u670d\u52a1 CPU \u8dd1\u5230\u4e86 100%\u3002</p> <p></p> <p>\u4e4b\u540e\u8fd0\u884c\u6211\u4eec\u7684 CPU \u9650\u5236\u811a\u672c\uff0c\u53ef\u4ee5\u770b\u5230 CPU \u88ab\u6210\u529f\u9650\u5236\u3002</p> <p></p> <p>\u5728\u6b64\u6848\u4f8b\u4e2d\uff0c\u6211\u4eec\u7740\u91cd\u6765\u770b Shell \u51fd\u6570\uff0c\u5728\u5b9e\u4f8b\u4e2d\u6211\u4eec\u7f16\u5199\u4e86\u5b89\u88c5\u4e0e\u6267\u884c CPU \u9650\u5236\u4e24\u4e2a\u51fd\u6570\uff0c\u6700\u540e\u7f16\u5199\u4e3b\u51fd\u6570\uff0c\u5728\u4e3b\u51fd\u6570\u4e2d\u8c03\u7528\u5176\u4ed6\u51fd\u6570\uff0c\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u5c31\u80fd\u8fbe\u5230\u9650\u5236\u67d0\u8fdb\u7a0b\u7684 CPU\u3002</p>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#4-\u6ce8\u610f\u4e8b\u9879","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u51fd\u6570\u5b9a\u4e49\u5efa\u8bae\u4f7f\u7528\u7b80\u660e\u77e5\u610f\u5e76\u9700\u8981\u6709\u4e00\u5b9a\u539f\u5219\uff0c\u4e0d\u4ec5\u4e3a\u4e86\u7f8e\u89c2\u66f4\u662f\u4e3a\u4e86\u89c4\u8303\uff0c\u4f7f\u5f97\u5176\u4ed6\u4eba\u66f4\u597d\u7406\u89e3\u4e0e\u9605\u8bfb\u4f60\u7684 Shell \u811a\u672c\uff0c\u589e\u5f3a\u811a\u672c\u53ef\u7ef4\u62a4\u6027\uff1b</li> <li>\u5bf9\u4e8e\u51fd\u6570\u8c03\u7528\uff0c\u5fc5\u987b\u5728\u51fd\u6570\u5b9a\u4e49\u4e4b\u540e\uff0cShell \u8fd0\u884c\u4e3a\u987a\u5e8f\u8fd0\u884c\uff0c\u6ca1\u6709\u5b9a\u4e49\u51fd\u6570\u5219\u8c03\u7528\u51fd\u6570\u4f1a\u6709\u5f02\u5e38\uff1b</li> <li>\u51fd\u6570\u5b9a\u4e49\u4e0d\u80fd\u6307\u5b9a\u53c2\u6570\uff0c\u5728\u8c03\u7528\u7684\u65f6\u5019\u4f20\u9012\u53c2\u6570\u5373\u53ef\uff0c\u5e76\u4e14\u8c03\u7528\u51fd\u6570\u4f20\u9012\u4ec0\u4e48\u53c2\u6570\uff0c\u51fd\u6570\u5c31\u63a5\u53d7\u4ec0\u4e48\u53c2\u6570\uff1b</li> <li>\u51fd\u6570\u4f20\u9012\u53c2\u6570\u4e0e Shell \u811a\u672c\u4f20\u9012\u53c2\u6570\u7684\u7c7b\u578b\u53ca\u7528\u6cd5\u4e00\u81f4\uff0c\u5728\u6b64\u53ef\u4ee5\u878d\u4f1a\u8d2f\u901a\uff0c\u5bf9\u6bd4\u7406\u89e3\u8bb0\u5fc6\uff1b</li> <li>shell \u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u53ea\u80fd\u662f\u6574\u5f62\uff0c\u5e76\u4e14\u5728 0-257 \u4e4b\u95f4\uff0c\u4e0d\u80fd\u4e3a\u5b57\u7b26\u4e32\u6216\u5176\u4ed6\u5f62\u5f0f\u3002</li> </ul>"},{"location":"Linux/shell/9.Shell%E5%87%BD%E6%95%B0/#5-\u5c0f\u7ed3","title":"5. \u5c0f\u7ed3","text":"<p>\u6211\u4eec\u7f16\u5199 Shell \u5c31\u662f\u4e3a\u4e86\u5b9e\u73b0\u7b80\u5316\u64cd\u4f5c\uff0c\u901a\u5e38\u5c06\u6570\u636e\u548c\u7a0b\u5e8f\u5206\u79bb\uff0c\u6211\u4eec\u5c06\u4e00\u7ec4\u5b9e\u73b0\u5177\u4f53\u4e1a\u52a1\u7684\u903b\u8f91\u7f16\u5199\u4e3a\u4e00\u4e2a\u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u4e00\u6bb5\u4ee3\u7801\u5757\uff0c\u5c06\u5176\u6a21\u5757\u5316\uff0c\u8d4b\u4e88\u51fd\u6570\u540d\u79f0\uff0c\u5229\u7528\u51fd\u6570\u53ef\u4ee5\u8fbe\u5230\u4ee3\u7801\u590d\u7528\uff0c\u4f7f\u5f97\u6570\u636e\u4e0e\u903b\u8f91\u5206\u79bb\uff0c\u811a\u672c\u66f4\u52a0\u4fbf\u4e8e\u7ef4\u62a4\u548c\u7ba1\u7406\u3002</p>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/","title":"Shell \u6559\u7a0b\u6982\u8ff0","text":""},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#1-shell-\u6982\u8ff0","title":"1. Shell \u6982\u8ff0","text":""},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#11-shell-\u662f\u4ec0\u4e48","title":"1.1 Shell \u662f\u4ec0\u4e48","text":"<p>\u6211\u4eec\u8981\u7cfb\u7edf\u6027\u7684\u5b66\u4e60 Shell \u811a\u672c\uff0c\u9996\u5148\u9700\u8981\u77e5\u9053\u4ec0\u4e48\u662f Shell\uff0cShell \u7ffb\u8bd1\u8fc7\u6765\u4e3a\u58f3\uff0c\u4f8b\u5982\u5927\u5bb6\u5e38\u89c1\u7684\u58f3\u724c\u77f3\u6cb9\u7684\u56fe\u6807\u4e0a\u9762\u7684\u8d1d\u58f3\uff0c\u987e\u540d\u601d\u4e49\u5176\u5c31\u662f\u4e00\u4e2a\u5957\u5728\u64cd\u4f5c\u7cfb\u7edf\u5916\u5c42\u7684\u58f3\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u4e0e\u8fd9\u5c42\u58f3\u7684\u4ea4\u4e92\uff0c\u5c06\u81ea\u5df1\u7684\u9700\u6c42\u5229\u7528\u8fd9\u5c42 Shell \u6765\u6267\u884c\u6765\u5b9e\u73b0\u5bf9\u670d\u52a1\u5668\u7684\u64cd\u4f5c\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a Shell \u662f\u5c06\u7528\u6237\u7684\u547d\u4ee4\u89e3\u6790\u4e3a\u5185\u6838\u53ef\u4ee5\u6267\u884c\u7684\u547d\u4ee4\uff0c\u8d77\u5230\u547d\u4ee4\u89e3\u91ca\u7684\u4f5c\u7528\uff0c\u662f\u7528\u6237\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u76f4\u63a5\u7684\u4e00\u4e2a\u6865\u6881\u7ebd\u5e26\u3002</p> <p></p>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#12-\u4e3a\u4ec0\u4e48\u8981\u7528-shell","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528 Shell","text":"<p>\u6211\u4eec\u60f3\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u6211\u4eec\u5e72\u4e00\u4ef6\u4e8b\u60c5\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u53bb\u4e86\u89e3\u5185\u5728\u7684\u5185\u6838\u6307\u4ee4\uff0c\u800c\u662f\u53ea\u9700\u8981\u4e86\u89e3\u53ef\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u7684 Shell \u547d\u4ee4\u5373\u53ef\uff0cShell \u4e3a\u6211\u4eec\u5c4f\u853d\u6765\u64cd\u4f5c\u7cfb\u7edf\u4f4e\u5c42\u7684\u7ec6\u8282\uff0c\u4e5f\u5904\u4e8e\u5b89\u5168\u6027\u8003\u8651\uff0c\u4e0d\u80fd\u8ba9\u7528\u6237\u968f\u4fbf\u7684\u8fdb\u884c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u64cd\u4f5c\uff0c\u901a\u4fd7\u6765\u8bf4\uff0cshell \u5c31\u662f\u8ba9\u7528\u6237\u66f4\u7b80\u5355\u7684\u64cd\u4f5c\u8ba1\u7b97\u673a\u3002</p>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#13-shell-\u811a\u672c\u662f\u4ec0\u4e48","title":"1.3 Shell \u811a\u672c\u662f\u4ec0\u4e48","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 Shell \u662f\u4e00\u4e2a\u7528\u6237\u4e0e Linux \u7cfb\u7edf\u5185\u6838\u7684\u901a\u8baf\u7684\u6865\u6881\u540e\uff0c\u90a3\u4e48 Shell \u811a\u672c\u662f\u4ec0\u4e48\u5462\uff1f</p> <p>Shell \u811a\u672c\u5c31\u662f\u64cd\u4f5c Shell \u7684\u6307\u4ee4\u96c6\u5408\u7f16\u5199\u6210\u7684\u4e00\u6bb5\u5b9e\u73b0\u76ee\u7684\u9700\u6c42\u7684\u4ee3\u7801\uff0c\u4e5f\u4e3a\u4e00\u79cd\u7ba1\u7406 Linux \u7cfb\u7edf\u7684\u811a\u672c\u8bed\u8a00\uff0c\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7684\u5c06\u5176\u7406\u89e3\u4e3a\uff0cLinux \u7684\u5404\u79cd\u6307\u4ee4\u52a0\u4e0a\u4e00\u4e9b\u6d41\u7a0b\u63a7\u5236\u548c\u6570\u636e\u7684\u96c6\u5408\uff0c\u56e0\u4e3a\u5b83\u8fd8\u6709\u4e0d\u5c11\u7684\u8bed\u6cd5\u53ca\u683c\u5f0f\uff0c\u540e\u9762\u6211\u4eec\u6765\u901a\u8fc7\u5b66\u4e60\uff0c\u8be6\u7ec6\u5256\u6790\u5176\u5185\u5728\u7cbe\u9ad3\u3002</p>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#14-\u5e02\u573a\u4f4d\u7f6e","title":"1.4 \u5e02\u573a\u4f4d\u7f6e","text":"<p>\u76ee\u524d Shell \u811a\u672c\u7531\u4e8e\u5176\u4f5c\u4e3a\u76f4\u63a5\u4e0e Linux \u7cfb\u7edf\u4ea4\u4e92\uff0c\u5728\u6279\u91cf / \u5b9a\u65f6\u4efb\u52a1\u4e2d\u6709\u7740\u72ec\u7279\u65e0\u53ef\u53d6\u4ee3\u7684\u4f5c\u7528\uff0c\u4e0d\u7ba1\u662f\u8fd0\u7ef4\u4eba\u5458\u8fd8\u662f\u5f00\u53d1\u4eba\u5458\u6570\u91cf\u638c\u63e1 Shell \u811a\u672c\uff0c\u90fd\u4f1a\u7ed9\u65e5\u540e\u7684\u5de5\u4f5c\u4ee3\u7406\u975e\u5e38\u5927\u7684\u4fbf\u5229\uff0cShell \u4f5c\u4e3a\u4e00\u79cd\u811a\u672c\u8bed\u8a00\uff0c\u7f16\u5199\u5b8c\u6e90\u7801\u540e\u4e0d\u7528\u7f16\u8bd1\uff0c\u76f4\u63a5\u8fd0\u884c\u6e90\u7801\u5373\u53ef\uff0c\u662f\u5b9e\u73b0 Linux/UNIX \u7cfb\u7edf\u7ba1\u7406\u53ca\u81ea\u52a8\u5316\u8fd0\u7ef4\u6240\u5fc5\u5907\u7684\u91cd\u8981\u5de5\u5177\uff0c \u53ea\u6709\u719f\u7ec3\u638c\u63e1 Shell \u624d\u80fd\u63d0\u5347\u8fd0\u7ef4\u4eba\u5458\u7684\u5de5\u4f5c\u6548\u7387\uff0c\u9002\u5e94\u66f0\u76ca\u590d\u6742\u7684\u5de5\u4f5c\u73af\u5883\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u91cd\u590d\u5de5\u4f5c\uff0c\u4ece\u800c\u4e3a\u4e2a\u4eba\u7684\u804c\u573a\u53d1\u5c55\u5960\u5b9a\u8f83\u597d\u7684\u57fa\u7840\u3002</p>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#2-shell-\u5206\u7c7b","title":"2. Shell \u5206\u7c7b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e0e Linux \u5185\u6838\u6211\u4eec\u6253\u4ea4\u9053\u7684\u90fd\u6709\u4ec0\u4e48\u5462\uff1f\u901a\u5e38\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u5373\u56fe\u5f62\u754c\u9762 \uff08GUI Shell\uff09\u548c\u7ec8\u7aef\u547d\u4ee4\u884c \uff08CLI Shell\uff09\u3002</p>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#21-gui-shell","title":"2.1 GUI Shell","text":"<p>\u5982\u679c\u6211\u4eec\u4e0d\u719f\u6089 Linux \u547d\u4ee4\uff0c\u6211\u4eec\u901a\u8fc7 VNC \u767b\u5f55\u5230 Linux \u7cfb\u7edf\u540e\uff0c\u5229\u7528\u9f20\u6807\u53bb\u53cc\u51fb\u6587\u4ef6\u5939\u8fdb\u5165\u76ee\u5f55\uff0c\u6216\u65b0\u5efa\u6587\u4ef6\u5939\uff0c\u7f16\u8f91\u6587\u4ef6\uff0c\u5b89\u88c5 rpm \u5305\u7b49\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u662f\u5229\u7528 GUI Shell \u4e0e Linux \u7cfb\u7edf\u5185\u6838\u901a\u8baf\uff0c\u5b83\u4e3a\u6211\u4eec\u6784\u9020\u4e86\u4e00\u5957\u7c7b\u4f3c Windows \u7684\u754c\u9762\u4f18\u5316\u7684\u684c\u9762\u73af\u5883\uff0c\u76ee\u524d\u7684\u684c\u9762\u73af\u5883\u4f8b\u5982 Gnome/KDE \u7b49\uff0c\u6b64\u7c7b\u4e3a GUI Shell\u3002</p>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#22-cli-shell","title":"2.2 CLI Shell","text":"<p>Linux \u4f5c\u4e3a\u670d\u52a1\u5668\u7aef\uff0c\u8fd0\u884c\u684c\u9762\u73af\u5883\u975e\u5e38\u6d88\u8017\u8d44\u6e90\uff0c\u56e0\u6b64 CLI Shell \u624d\u662f\u6211\u4eec\u672c\u6b21\u7684\u91cd\u70b9\uff0c\u5176\u6839\u636e\u4e0d\u540c\u7684\u7cfb\u7edf\u6709\u5f88\u591a\u79cd\u7c7b\uff0c \u4f8b\u5982\u6211\u4eec\u6700\u5e38\u7528\u7684\u4e3b\u6d41\u7248\u672c\u7684 Linux \u7cfb\u7edf CentOS/RHEL \u7684\u9ed8\u8ba4 Shell \u4e3a <code>bash</code>\uff0c\u5f53\u7136\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7684 Shell\uff0c\u4e3a\u4ec0\u4e48\u6709\u8fd9\u4e48\u591a\u7c7b\u578b\u7684 Shell \u5185\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u7c7b\u578b\uff0c\u5176\u5185\u6838\u90fd\u96be\u514d\u5b58\u5728\u5dee\u5f02\uff0c\u56e0\u6b64\u4e0e\u5185\u6838\u4ea4\u4e92\u7684 Shell \u4e5f\u5c31\u5206\u6765\u4e0d\u5c11\u79cd\u7c7b\uff0c\u76ee\u524d\u5728 Linux \u7cfb\u7edf\u4e0a\u4e3b\u6d41\u7684 CLI Shell \u90fd\u4e3a Bash\uff0c\u662f\u8bb8\u591a Linux \u53d1\u884c\u7248\u9ed8\u8ba4\u7684 Shell\u3002\u8fd8\u6709\u8bb8\u591a Unix \u4e0a Shell\u3002\u6211\u4eec\u53ef\u4ee5\u5728 Linux \u7cfb\u7edf\u4e0a <code>cat /etc/shells</code> \u6765\u67e5\u770b\u672c\u7248\u672c\u652f\u6301\u7684\u5404 Shell \u7c7b\u578b\uff0c\u540c\u65f6\u53ef\u4ee5\u5229\u7528\u547d\u4ee4 <code>echo $SHELL</code> \u6765\u67e5\u770b\u5f53\u524d\u73af\u5883\u4e2d\u7684\u9ed8\u8ba4 Shell\uff0c\u4e0d\u540c\u7684 Shell \u90fd\u6709\u5176\u5404\u81ea\u7684\u7279\u70b9\uff0c\u76ee\u524d\u4e3b\u6d41\u7684 Shell \u7c7b\u578b\u5982\u4e0b\uff1a</p> <ul> <li>Bourne Again Shell\uff08/bin/bash\uff09\uff1a\u5176\u4e3a\u76ee\u524d\u4e3b\u6d41 Linux \u53d1\u884c\u7248\u9ed8\u8ba4\u7684 Shell\uff0c\u5176\u4e5f\u662f Bourne shell \u6700\u65e9\u7684\u53d1\u578b\u5e76\u514d\u8d39\u7684\u7248\u672c\uff0c\u7528\u6237\u53ef\u4ee5\u5229\u7528\u5176 help \u547d\u4ee4\u6765\u67e5\u770b\u51e0\u4e4e Shell \u7684\u6240\u7528\u529f\u80fd\u3002</li> <li>Bourne Shell\uff08/usr/bin/sh \u6216 /bin/sh\uff09\uff1a\u662f\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\uff0c\u540e\u5df2\u7ecf\u88ab /bin/bash \u6240\u53d6\u4ee3\u3002</li> <li>C Shell\uff08/usr/bin/csh\uff09\uff1a\u7b80\u5355\u9ad8\u6548\uff0c\u5176\u4f7f\u7528\u7c7b\u4f3c C \u8bed\u8a00\u7684\u8bed\u6cd5\uff0c\u540e\u5df2\u88ab tcsh \u53d6\u4ee3\u3002</li> <li>K Shell\uff08/usr/bin/ksh\uff09\uff1aKorn shell \u7684\u8bed\u6cd5\u4e0e Bourne shell \u76f8\u540c\uff0c\u540c\u65f6\u5177\u5907\u4e86 C shell \u7684\u6613\u7528\u7279\u70b9\uff0c\u8bb8\u591a\u5b89\u88c5\u811a\u672c\u90fd\u4f7f\u7528 ksh\u3002</li> </ul>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#3-\u5e94\u7528\u573a\u666f","title":"3. \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u5e94\u7528\u5b89\u88c5\uff1a\u6211\u4eec\u90fd\u77e5\u9053\u5728 Linux \u670d\u52a1\u5668\u7ecf\u5e38\u9700\u8981\u6211\u4eec\u5b89\u88c5\u7f6e\u4e00\u4e9b\u8f6f\u4ef6\u6216\u914d\u7f6e\u73af\u5883\uff0c\u4eba\u624b\u5de5\u7684\u4e00\u6761\u547d\u540d\u4e00\u6761\u547d\u4ee4\u6267\u884c\uff0c\u5f88\u5bb9\u6613\u51fa\u73b0\u9519\u8bef\uff0c\u800c\u4e14\u5982\u679c\u6210\u767e\u4e0a\u5343\u53f0\u670d\u52a1\u5668\uff0c\u90a3\u4e48\u6b64\u573a\u666f\u4e0b Shell \u811a\u672c\u5c31\u975e\u5e38\u9002\u5408\uff0c\u7f16\u5199\u4e00\u4e2a\u5e94\u7528\u5b89\u88c5\u914d\u7f6e\u811a\u672c\uff0c\u540e\u671f\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\uff0c\u4e14\u4e0d\u5bb9\u6613\u51fa\u9519\uff0cShell \u811a\u672c\u9002\u7528\u4e8e\u91cd\u590d\u6027\u7684\u5de5\u4f5c\u3002</li> <li>\u5b9a\u65f6\u4efb\u52a1\uff1a\u4f8b\u5982\u6211\u4eec\u9700\u8981\u6bcf\u5206\u4e0a\u62a5\u670d\u52a1\u5668\u7684\u5404\u9879\u6027\u80fd\u6307\u6807\u5230\u76d1\u63a7\u670d\u52a1\u7aef\uff0c\u6b64\u65f6\u53ef\u4ee5\u5199\u4e00\u4e2a\u91c7\u96c6\u7cfb\u7edf\u5404\u9879\u6307\u6807\u7684\u811a\u672c\uff0c\u7136\u540e\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u6765\u6bcf\u5206\u949f\u6267\u884c\u6307\u6807\u6570\u636e\u4e0a\u62a5\uff0cShell \u811a\u672c\u975e\u5e38\u9002\u7528\u4e8e\u5468\u671f\u6027\u7684\u5de5\u4f5c\u3002</li> <li>\u5e94\u7528\u64cd\u4f5c\uff1a\u4f8b\u5982\u6211\u4eec\u81ea\u5df1\u5199\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u4e3a\u5176\u7f16\u5199\u542f\u52a8 / \u505c\u6b62 / \u91cd\u542f\u7b49\u64cd\u4f5c\u7684\u811a\u672c\uff0c\u5c06\u811a\u672c\u6dfb\u52a0\u8fdb\u7cfb\u7edf\u73af\u5883\u4e2d\uff0c\u540e\u671f\u5f88\u65b9\u4fbf\u8fdb\u884c\u670d\u52a1\u7ba1\u7406\u3002</li> <li>\u5907\u4efd\u6062\u590d\uff1a\u53ef\u4ee5\u5229\u7528\u811a\u672c\u6765\u8fdb\u884c\u7f51\u7ad9\u6587\u4ef6\u6216\u6570\u636e\u5e93\u7684\u5f02\u5730\u5907\u4efd\uff0c\u4ee5\u53ca\u6062\u590d\u5230\u6d4b\u8bd5\u73af\u5883\u8fdb\u884c\u9a8c\u8bc1\u7b49\u3002</li> <li>CI/CD: Shell \u811a\u672c\u9002\u7528\u4e0e DevOPS \u4e2d\u7684\u5728\u670d\u52a1\u5668\u4e2d\u6301\u7eed\u96c6\u6210\u6301\u7eed\u90e8\u7f72\u7684 pipeline \u6d41\u7a0b\u4e2d\uff0c\u9002\u7528\u4e8e\u5e94\u7528\u53d1\u5e03\u6700\u540e\u4e00\u516c\u91cc\u914d\u7f6e\u3002</li> <li>\u5176\u4ed6\uff1a\u5f53\u7136 Shell \u8fd8\u53ef\u4ee5\u505a\u4e00\u4e9b\u5176\u4ed6\u5de5\u4f5c\uff0c\u6bd4\u5982\u8fd0\u7b97 / \u751f\u6210\u62a5\u8868\uff0c\u751a\u81f3\u6709\u5927\u4f6c\u7528 Shell \u7f16\u5199\u6e38\u620f\u7b49\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u6765\u5229\u7528\u597d Shell \u811a\u672c\u6765\u4e3a\u81ea\u5df1\u670d\u52a1\u3002</li> </ul>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#4-\u5b66\u4e60\u524d\u63d0","title":"4. \u5b66\u4e60\u524d\u63d0","text":"<p>\u5b66\u4e60 Shell \u811a\u672c\u975e\u5e38\u7b80\u5355\uff0c\u9700\u8981\u6709\u4e00\u53f0 Linux \u7cfb\u7edf\uff0c\u7cfb\u7edf\u7c7b\u578b\u53ef\u4ee5\u662f CentOS/RedHat \u6216 Ubuntu\uff0c\u7531\u4e8e\u4e0d\u540c\u7684\u7cfb\u7edf\u4f7f\u7528\u7684 Shell \u7c7b\u578b\u53ef\u80fd\u5b58\u5728\u5f02\u5e38\uff0c\u5efa\u8bae\u4f7f\u7528 CentOS 7 \u7cfb\u7edf\u6765\u5b66\u4e60\u672c\u793a\u4f8b\u3002</p>"},{"location":"Linux/shell/Shell%E7%AE%80%E4%BB%8B/#5-\u94fe\u63a5","title":"5. \u94fe\u63a5","text":"<ul> <li>https://github.com/fengyuhetao/shell</li> <li>https://github.com/daily-scripts/shell-scripts</li> </ul>"},{"location":"Linux/system/0.Linux%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD/","title":"Linux\u7cfb\u7edf\u955c\u50cf\u4e0b\u8f7d","text":"\u56fd\u5185\u955c\u50cfCentOSUbuntuDebianKali linuxArchlinuxSUSEFedoraDeepinCygwinalpinerockylinux <p>\u5927\u5b66</p> <ul> <li>\u534e\u5317-\u6e05\u534e\u5927\u5b66</li> <li>\u534e\u5317-\u6e05\u534e\u5927\u5b66\u955c\u50cf\u4f7f\u7528\u5e2e\u52a9</li> <li> <p>\u5e38\u89c1\u8f6f\u4ef6\u955c\u50cf\u8bbe\u7f6e</p> </li> <li> <p>\u534e\u5317-\u5317\u4eac\u4ea4\u901a\u5927\u5b66</p> </li> <li>\u534e\u4e1c-\u4e2d\u56fd\u79d1\u5b66\u6280\u672f</li> <li>\u534e\u4e1c-\u4e0a\u6d77\u4ea4\u901a\u5927\u5b66</li> <li>\u534e\u4e1c-\u6d59\u6c5f\u5927\u5b66</li> <li>\u534e\u4e1c-\u5357\u4eac\u5927\u5b66</li> <li>\u897f\u5317-\u5170\u5dde\u5927\u5b66</li> <li>\u4e1c\u5317-\u4e1c\u5317\u5927\u5b66</li> <li>\u4e1c\u5317-\u4e1c\u8f6f\u4fe1\u606f</li> <li>\u4e1c\u5317-\u54c8\u5c14\u6ee8\u5de5\u4e1a\u5927\u5b66</li> <li>\u897f\u5357-\u91cd\u5e86\u5927\u5b66</li> </ul> <p>\u5546\u4e1a\u516c\u53f8</p> <ul> <li>\u963f\u91cc\u4e91</li> <li>\u817e\u8baf</li> <li>\u7f51\u6613</li> <li>\u7f51\u6613\u5f00\u6e90\u955c\u50cf\u7ad9</li> <li>\u641c\u72d0</li> <li>\u534e\u4e3a</li> <li>\u5fae\u8f6fazure</li> <li>pypi-\u8c46\u74e3</li> <li>npm-\u6dd8\u5b9d</li> </ul> <p>\u5176\u4ed6</p> <ul> <li>Linux\u7cfb\u7edf\u4e0b\u8f7d</li> </ul> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://cdimage.debian.org/cdimage/archive/10.13.0/amd64/iso-dvd/debian-10.13.0-amd64-DVD-1.iso</p> <p>https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-DVD-2207-02.iso</p> <p>https://hkg.mirror.rackspace.com/centos-stream/9-stream/BaseOS/x86_64/iso/CentOS-Stream-9-latest-x86_64-dvd1.iso</p> <p>\u5176\u4ed6</p> <p>http://mirror-status.centos.org/#cn</p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://mirrors.aliyun.com/ubuntu-releases/kinetic/ubuntu-22.10-live-server-amd64.iso</p> <p>\u5176\u4ed6</p> <p>http://releases.ubuntu.com/releases/</p> <p>http://cdimage.ubuntu.com/</p> <p>https://launchpad.net/ubuntu/+cdmirrors</p> <p>http://old-releases.ubuntu.com/releases/</p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://cdimage.debian.org/cdimage/archive/10.13.0/amd64/iso-dvd/debian-10.13.0-amd64-DVD-1.iso</p> <p>https://cdimage.debian.org/debian-cd/current/amd64/iso-dvd/debian-11.6.0-amd64-DVD-1.iso</p> <p>https://iso.mirrors.ustc.edu.cn/debian-cd/current/amd64/iso-dvd/debian-11.6.0-amd64-DVD-1.iso</p> <p>\u5176\u4ed6</p> <p>http://www.debian.org/mirror/</p> <p>https://cdimage.debian.org/cdimage/archive/</p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://iso.mirrors.ustc.edu.cn/kali-images/current/kali-linux-2022.4-live-amd64.iso</p> <p>\u5176\u4ed6</p> <p>https://www.kali.org/downloads/ </p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://mirrors.aliyun.com/archlinux/iso/2023.02.01/archlinux-2023.02.01-x86_64.iso</p> <p>\u5176\u4ed6</p> <p>https://www.archlinux.org/mirrors/status/</p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://mirrors.aliyun.com/opensuse/distribution/leap/15.3/iso/openSUSE-Leap-15.3-DVD-x86_64-Current.iso</p> <p>\u5176\u4ed6</p> <p>http://download.opensuse.org/</p> <p>https://mirrors.opensuse.org/</p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://iso.mirrors.ustc.edu.cn/fedora/releases/37/Spins/x86_64/iso/Fedora-Xfce-Live-x86_64-37-1.7.iso</p> <p>\u5176\u4ed6</p> <p>http://mirrors.fedoraproject.org/publiclist</p> <p>https://torrents.fedoraproject.org/</p> <p>https://admin.fedoraproject.org/mirrormanager/mirrors</p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://mirrors.aliyun.com/deepin-cd/20.8/deepin-desktop-community-20.8-amd64.iso</p> <p>\u5176\u4ed6</p> <p>https://www.deepin.org/mirrors/releases/</p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://www.cygwin.com/mirrors.html </p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/releases/x86_64/alpine-xen-3.17.1-x86_64.iso</p> <p>\u5e38\u7528\u4e0b\u8f7d\u955c\u50cf</p> <p>https://mirrors.aliyun.com/rockylinux/9.1/isos/x86_64/Rocky-9.1-20221214.1-x86_64-dvd.iso</p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/","title":"Linux\u5b89\u5168\u52a0\u56fa","text":""},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u5f53\u4e91\u8ba1\u7b97\u91cd\u6784IT\u4ea7\u4e1a\u7684\u540c\u65f6\uff0c\u4e5f\u8d4b\u4e88\u4e86\u4f01\u4e1a\u5d2d\u65b0\u7684\u589e\u957f\u673a\u9047\u3002\u901a\u8fc7\u5145\u5206\u5229\u7528\u4e91\u8ba1\u7b97\u7684\u80fd\u529b\uff0c\u4f01\u4e1a\u53ef\u4ee5\u91ca\u653e\u66f4\u591a\u7cbe\u529b\u4e13\u6ce8\u4e8e\u81ea\u5df1\u7684\u4e1a\u52a1\u3002\u4e91\u8ba1\u7b97\u6781\u5927\u5730\u964d\u4f4e\u4e86\u4f01\u4e1a\u7684\u6570\u5b57\u5316\u8f6c\u578b\u6210\u672c\uff0c\u91ca\u653e\u66f4\u591a\u6548\u80fd\u8fdb\u884c\u4e1a\u52a1\u521b\u65b0\uff0c\u4e91\u8ba1\u7b97\u4e3a\u4f01\u4e1a\u4e1a\u52a1\u521b\u65b0\u5e26\u6765\u65e0\u9650\u53ef\u80fd\u3002\u4f46\u662f\u5f53\u4eba\u4eec\u5728\u4eab\u53d7\u4f7f\u7528\u4e91\u8ba1\u7b97\u5e26\u6765\u7684\u4fbf\u5229\u7684\u540c\u65f6\uff0c\u670d\u52a1\u5668\u5b89\u5168\u4e5f\u4e0d\u5bb9\u5ffd\u89c6\u3002</p> <p>Linux\u662f\u4e00\u5957\u514d\u8d39\u4f7f\u7528\u548c\u81ea\u7531\u4f20\u64ad\u7684\u7c7bUnix\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5f00\u653e\u6e90\u4ee3\u7801\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0cLinux\u670d\u52a1\u5668\u4ee5\u5176\u5b89\u5168\u3001\u9ad8\u6548\u548c\u7a33\u5b9a\u7684\u663e\u8457\u4f18\u52bf\u800c\u5f97\u4ee5\u5e7f\u6cdb\u5e94\u7528\uff0c\u4f46\u5982\u679c\u4e0d\u505a\u597d\u6743\u9650\u7684\u5408\u7406\u5206\u914d\uff0cLinux\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u8fd8\u662f\u4f1a\u5f97\u4e0d\u5230\u66f4\u597d\u7684\u4fdd\u969c\u3002</p> <p>\u4e0d\u8fc7\u7ecf\u8fc7\u5b89\u5168\u52a0\u56fa\u540e\u7684Linux\u7cfb\u7edf\u53ef\u8fbe\u5230B1\u7684\u5b89\u5168\u7ea7\u522b\uff0c\u76f8\u4fe1\u5927\u591a\u6570\u540c\u5b66\u90fd\u6709\u670d\u52a1\u5668\u88ab\u9ed1\u5ba2\u5165\u4fb5\u7684\u7ecf\u5386\uff0c\u901a\u8fc7\u672c\u6587Linux\u7cfb\u7edf\u4ece\u4e0d\u540c\u7ef4\u5ea6\u8fdb\u884c\u5b89\u5168\u52a0\u56fa\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u589e\u52a0\u7cfb\u7edf\u7684\u5b89\u5168\u6027\uff0c\u6784\u7b51\u66f4\u52a0\u575a\u5b9e\u7684\u5b89\u5168\u58c1\u5792\u3002</p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#\u4e00-\u8eab\u4efd\u9274\u522b","title":"\u4e00 \u8eab\u4efd\u9274\u522b","text":""},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#11-\u5bc6\u7801\u5b89\u5168\u7b56\u7565","title":"1.1 \u5bc6\u7801\u5b89\u5168\u7b56\u7565","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u548c\u6570\u636e\u5e93\u7cfb\u7edf\u7ba1\u7406\u7528\u6237\u8eab\u4efd\u9274\u522b\u4fe1\u606f\u5e94\u5177\u6709\u4e0d\u6613\u88ab\u5192\u7528\u7684\u7279\u70b9\uff0c\u53e3\u4ee4\u5e94\u6709\u590d\u6742\u5ea6\u8981\u6c42\u5e76\u5b9a\u671f\u66f4\u6362\u3002</p> <p>\u8bbe\u7f6e\u6709\u6548\u7684\u5bc6\u7801\u7b56\u7565\uff0c\u9632\u6b62\u653b\u51fb\u8005\u7834\u89e3\u51fa\u5bc6\u7801</p> <ul> <li>\u67e5\u770b\u7a7a\u53e3\u4ee4\u5e10\u53f7\u5e76\u4e3a\u5f31/\u7a7a\u53e3\u4ee4\u5e10\u53f7\u8bbe\u7f6e\u5f3a\u5bc6\u7801</li> </ul> <pre><code># awk -F: '($2 == \"\"){print $1}' /etc/shadow\n</code></pre> <p>\u53ef\u7528\u79bb\u7ebf\u7834\u89e3\u3001\u66b4\u529b\u5b57\u5178\u7834\u89e3\u6216\u8005\u5bc6\u7801\u7f51\u7ad9\u67e5\u8be2\u51fa\u5e10\u53f7\u5bc6\u94a5\u7684\u5bc6\u7801\u662f\u5426\u662f\u5f31\u53e3\u4ee4</p> <ul> <li>\u4fee\u6539vi /etc/login.defs\u914d\u7f6e\u5bc6\u7801\u5468\u671f\u7b56\u7565</li> </ul> <pre><code>vim /etc/login.defs\n--\nPASS_MAX_DAYS  90  # \u5bc6\u7801\u6700\u5927\u8fc7\u671f\u65f6\u95f4\uff0c\u4e0d\u5927\u4e8e90\u5219\u5408\u89c4\nPASS_MIN_DAYS  7   # \u53e3\u4ee4\u66f4\u6539\u6700\u5c0f\u95f4\u9694\u5929\u6570\u5e94\u5927\u4e8e\u7b49\u4e8e7\nPASS_MIN_LEN   8\nPASS_WARN_AGE  7   # \u53e3\u4ee4\u8fc7\u671f\u8b66\u544a\u63d0\u524d\u5929\u6570\n</code></pre> <p>\u6b64\u7b56\u7565\u53ea\u5bf9\u7b56\u7565\u5b9e\u65bd\u540e\u6240\u521b\u5efa\u7684\u5e10\u53f7\u751f\u6548\uff0c \u4ee5\u524d\u7684\u5e10\u53f7\u8fd8\u662f\u630999999\u5929\u5468\u671f\u65f6\u95f4\u6765\u7b97\u3002</p> <ul> <li>/etc/pam.d/system-auth\u914d\u7f6e\u5bc6\u7801\u590d\u6742\u5ea6\uff1a</li> </ul> <pre><code>password requisite  pam_cracklib.so retry=3 difok=2 minlen=8 lcredit=-1 dcredit=-1\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\u5982\u4e0b\u6240\u793a\uff1a</p> <p>difok\uff1a\u672c\u6b21\u5bc6\u7801\u4e0e\u4e0a\u6b21\u5bc6\u7801\u81f3\u5c11\u4e0d\u540c\u5b57\u7b26\u6570</p> <p>minlen\uff1a\u5bc6\u7801\u6700\u5c0f\u957f\u5ea6\uff0c\u6b64\u914d\u7f6e\u4f18\u5148\u4e8elogin.defs\u4e2d\u7684PASS_MAX_DAYS</p> <p>ucredit\uff1a\u6700\u5c11\u5927\u5199\u5b57\u6bcd</p> <p>lcredit\uff1a\u6700\u5c11\u5c0f\u5199\u5b57\u6bcd</p> <p>dcredit\uff1a\u6700\u5c11\u6570\u5b57</p> <p>retry\uff1a\u91cd\u8bd5\u591a\u5c11\u6b21\u540e\u8fd4\u56de\u5bc6\u7801\u4fee\u6539\u9519\u8bef</p> <p>\u3010\u6ce8\u3011\u7528root\u4fee\u6539\u5176\u4ed6\u5e10\u53f7\u90fd\u4e0d\u53d7\u5bc6\u7801\u5468\u671f\u53ca\u590d\u6742\u5ea6\u914d\u7f6e\u7684\u5f71\u54cd\u3002</p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#12-\u767b\u5f55\u5931\u8d25\u7b56\u7565","title":"1.2 \u767b\u5f55\u5931\u8d25\u7b56\u7565","text":"<p>\u5e94\u542f\u7528\u767b\u5f55\u5931\u8d25\u5904\u7406\u529f\u80fd\uff0c\u53ef\u91c7\u53d6\u7ed3\u675f\u4f1a\u8bdd\u3001\u9650\u5236\u975e\u6cd5\u767b\u5f55\u6b21\u6570\u548c\u81ea\u52a8\u9000\u51fa\u7b49\u63aa\u65bd\u3002</p> <p>\u906d\u9047\u5bc6\u7801\u7834\u89e3\u65f6\uff0c\u6682\u65f6\u9501\u5b9a\u5e10\u53f7\uff0c\u964d\u4f4e\u5bc6\u7801\u88ab\u731c\u89e3\u7684\u53ef\u80fd\u6027</p> <ul> <li>\u65b9\u6cd5\u4e00\uff1a/etc/pam.d/login\u4e2d\u8bbe\u5b9a\u63a7\u5236\u53f0\uff1b/etc/pam.d/sshd\u4e2d\u8bbe\u5b9aSSH</li> </ul> <p>/etc/pam.d/sshd\u4e2d\u7b2c\u4e8c\u884c\u6dfb\u52a0\u4e0b\u5217\u4fe1\u606f</p> <pre><code>auth required  pam_tally2.so deny=5 lock_time=2 even_deny_root unlock_time=60\n</code></pre> <p># pam_tally2 --user root</p> <p>\u89e3\u9501\u7528\u6237</p> <p># pam_tally2 -r -u root</p> <p>even_deny_root    \u4e5f\u9650\u5236root\u7528\u6237(\u9ed8\u8ba4\u914d\u7f6e\u5c31\u9501\u5b9aroot\u5e10\u53f7)\uff1b  deny     \u8bbe\u7f6e\u666e\u901a\u7528\u6237\u548croot\u7528\u6237\u8fde\u7eed\u9519\u8bef\u767b\u9646\u7684\u6700\u5927\u6b21\u6570\uff0c\u8d85\u8fc7\u6700\u5927\u6b21\u6570\uff0c\u5219\u9501\u5b9a\u8be5\u7528\u6237  unlock_time     \u8bbe\u5b9a\u666e\u901a\u7528\u6237\u9501\u5b9a\u540e\uff0c\u591a\u5c11\u65f6\u95f4\u540e\u89e3\u9501\uff0c\u5355\u4f4d\u662f\u79d2\uff1b </p> <p>root_unlock_time      \u8bbe\u5b9aroot\u7528\u6237\u9501\u5b9a\u540e\uff0c\u591a\u5c11\u65f6\u95f4\u540e\u89e3\u9501\uff0c\u5355\u4f4d\u662f\u79d2\uff1b</p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#13-\u5b89\u5168\u7684\u8fdc\u7a0b\u7ba1\u7406\u65b9\u5f0f","title":"1.3 \u5b89\u5168\u7684\u8fdc\u7a0b\u7ba1\u7406\u65b9\u5f0f","text":"<p>\u5f53\u5bf9\u670d\u52a1\u5668\u8fdb\u884c\u8fdc\u7a0b\u7ba1\u7406\u65f6\uff0c\u5e94\u91c7\u53d6\u5fc5\u8981\u63aa\u65bd\uff0c\u9632\u6b62\u9274\u522b\u4fe1\u606f\u5728\u7f51\u7edc\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u88ab\u7a83\u542c\u3002</p> <p>\u9632\u6b62\u8fdc\u7a0b\u7ba1\u7406\u8fc7\u7a0b\u4e2d\uff0c\u5bc6\u7801\u7b49\u654f\u611f\u4fe1\u606f\u88ab\u7a83\u542c</p> <p>\u6267\u884c\u5982\u4e0b\u8bed\u53e5\uff0c\u67e5\u770btelnet\u670d\u52a1\u662f\u5426\u5728\u8fd0\u884c</p> <p></p> <p>\u7981\u6b62telnet\u8fd0\u884c\uff0c\u7981\u6b62\u5f00\u673a\u542f\u52a8\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#\u4e8c-\u8bbf\u95ee\u63a7\u5236","title":"\u4e8c \u8bbf\u95ee\u63a7\u5236","text":""},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#21-\u8d26\u53f7\u53ca\u5bc6\u7801","title":"2.1 \u8d26\u53f7\u53ca\u5bc6\u7801","text":"<p>\u5e94\u53ca\u65f6\u5220\u9664\u591a\u4f59\u7684\u3001\u8fc7\u671f\u7684\u5e10\u6237\uff0c\u907f\u514d\u5171\u4eab\u5e10\u6237\u7684\u5b58\u5728\u3002</p> <p>\u5220\u9664\u6216\u7981\u7528\u4e34\u65f6\u3001\u8fc7\u671f\u53ca\u53ef\u7591\u7684\u5e10\u53f7\uff0c\u9632\u6b62\u88ab\u975e\u6cd5\u5229\u7528\u3002</p> <p>\u4e3b\u8981\u662f\u7ba1\u7406\u5458\u521b\u5efa\u7684\u666e\u901a\u5e10\u53f7\uff0c\u5982\uff1atest</p> <pre><code># usermod -L user \u7981\u7528\u5e10\u53f7\uff0c\u5e10\u53f7\u65e0\u6cd5\u767b\u5f55\uff0c/etc/shadow\u7b2c\u4e8c\u680f\u663e\u793a\u4e3a!\u5f00\u5934\n# userdel user \u5220\u9664user\u7528\u6237\n# userdel -r user\u5c06\u5220\u9664user\u7528\u6237\uff0c\u5e76\u4e14\u5c06/home\u76ee\u5f55\u4e0b\u7684user\u76ee\u5f55\u4e00\u5e76\u5220\u9664\n</code></pre>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#22-\u68c0\u67e5\u7279\u6b8a\u8d26\u53f7","title":"2.2 \u68c0\u67e5\u7279\u6b8a\u8d26\u53f7","text":"<p>\u68c0\u67e5\u662f\u5426\u5b58\u5728\u7a7a\u53e3\u4ee4\u548croot\u6743\u9650\u7684\u8d26\u53f7\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4</p> <ol> <li>\u67e5\u770b\u7a7a\u53e3\u4ee4\u548croot\u6743\u9650\u8d26\u53f7\uff0c\u786e\u8ba4\u662f\u5426\u5b58\u5728\u5f02\u5e38\u8d26\u53f7\uff1a</li> <li>\u4f7f\u7528\u547d\u4ee4 <code>awk -F: '($2==\"\")' /etc/shadow</code> \u67e5\u770b\u7a7a\u53e3\u4ee4\u8d26\u53f7\u3002</li> <li>\u4f7f\u7528\u547d\u4ee4 <code>awk -F: '($3==0)' /etc/passwd</code> \u67e5\u770bUID\u4e3a\u96f6\u7684\u8d26\u53f7\u3002</li> <li>\u52a0\u56fa\u7a7a\u53e3\u4ee4\u8d26\u53f7\uff1a</li> <li>\u4f7f\u7528\u547d\u4ee4 <code>passwd &lt;\u7528\u6237\u540d&gt;</code> \u4e3a\u7a7a\u53e3\u4ee4\u8d26\u53f7\u8bbe\u5b9a\u5bc6\u7801\u3002</li> <li>\u786e\u8ba4UID\u4e3a\u96f6\u7684\u8d26\u53f7\u53ea\u6709root\u8d26\u53f7\u3002</li> </ol>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#23-\u6dfb\u52a0\u5bc6\u7801\u7b56\u7565","title":"2.3 \u6dfb\u52a0\u5bc6\u7801\u7b56\u7565","text":"<p>\u52a0\u5f3a\u53e3\u4ee4\u7684\u590d\u6742\u5ea6\u7b49\uff0c\u964d\u4f4e\u88ab\u731c\u89e3\u7684\u53ef\u80fd\u6027\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4</p> <ol> <li>\u4f7f\u7528\u547d\u4ee4</li> </ol> <pre><code>vi /etc/login.defs \n</code></pre> <p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u3002</p> <ul> <li><code>PASS_MAX_DAYS 90 #\u65b0\u5efa\u7528\u6237\u7684\u5bc6\u7801\u6700\u957f\u4f7f\u7528\u5929\u6570</code></li> <li><code>PASS_MIN_DAYS 0 #\u65b0\u5efa\u7528\u6237\u7684\u5bc6\u7801\u6700\u77ed\u4f7f\u7528\u5929\u6570</code></li> <li> <p><code>PASS_WARN_AGE 7 #\u65b0\u5efa\u7528\u6237\u7684\u5bc6\u7801\u5230\u671f\u63d0\u524d\u63d0\u9192\u5929\u6570</code></p> </li> <li> <p>\u4f7f\u7528chage\u547d\u4ee4\u4fee\u6539\u7528\u6237\u8bbe\u7f6e\u3002    \u4f8b\u5982\uff0c<code>chage -m 0 -M 30 -E 2000-01-01 -W 7 &lt;\u7528\u6237\u540d&gt;</code>\u8868\u793a\u5c06\u6b64\u7528\u6237\u7684\u5bc6\u7801\u6700\u957f\u4f7f\u7528\u5929\u6570\u8bbe\u4e3a30\uff0c\u6700\u77ed\u4f7f\u7528\u5929\u6570\u8bbe\u4e3a0\uff0c\u5bc6\u78012000\u5e741\u67081\u65e5\u8fc7\u671f\uff0c\u8fc7\u671f\u524d\u4e03\u5929\u8b66\u544a\u7528\u6237\u3002</p> </li> <li> <p>\u8bbe\u7f6e\u8fde\u7eed\u8f93\u9519\u4e09\u6b21\u5bc6\u7801\uff0c\u8d26\u53f7\u9501\u5b9a\u4e94\u5206\u949f\u3002\u4f7f\u7528\u547d\u4ee4 <code>vi /etc/pam.d/common-auth</code>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0 <code>auth required pam_tally.so onerr=fail deny=3 unlock_time=300</code>\u3002</p> </li> </ul>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#24-\u9650\u5236\u80fdsu\u5230root\u7684\u7528\u6237\u53ca\u7981\u7528root\u767b\u9646","title":"2.4 \u9650\u5236\u80fdsu\u5230root\u7684\u7528\u6237\u53ca\u7981\u7528root\u767b\u9646","text":"<p>\u4f7f\u7528\u547d\u4ee4 <code>vi /etc/pam.d/su</code>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u884c\u3002\u4f8b\u5982\uff0c\u53ea\u5141\u8bb8test\u7ec4\u7528\u6237su\u5230root\uff0c\u5219\u6dfb\u52a0 <code>auth required pam_wheel.so group=test</code>\u3002</p> <p>\u7981\u6b62root\u76f4\u63a5\u767b\u9646\u3002</p> <ol> <li>\u521b\u5efa\u666e\u901a\u6743\u9650\u8d26\u53f7\u5e76\u914d\u7f6e\u5bc6\u7801,\u9632\u6b62\u65e0\u6cd5\u8fdc\u7a0b\u767b\u5f55;</li> <li>\u4f7f\u7528\u547d\u4ee4 <code>vi /etc/ssh/sshd_config</code>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u5c06PermitRootLogin\u7684\u503c\u6539\u6210no\uff0c\u5e76\u4fdd\u5b58\uff0c\u7136\u540e\u4f7f\u7528<code>service sshd restart</code>\u91cd\u542f\u670d\u52a1\u3002</li> </ol>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#\u4e09-\u5b89\u5168\u5ba1\u8ba1","title":"\u4e09 \u5b89\u5168\u5ba1\u8ba1","text":""},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#31-\u5ba1\u6838\u7b56\u7565\u5f00\u542f","title":"3.1 \u5ba1\u6838\u7b56\u7565\u5f00\u542f","text":"<p>\u5ba1\u8ba1\u8303\u56f4\u5e94\u8986\u76d6\u5230\u670d\u52a1\u5668\u548c\u91cd\u8981\u5ba2\u6237\u7aef\u4e0a\u7684\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7528\u6237\u548c\u6570\u636e\u5e93\u7528\u6237\uff1b</p> <p>\u5f00\u542f\u5ba1\u6838\u7b56\u7565\uff0c\u82e5\u65e5\u540e\u7cfb\u7edf\u51fa\u73b0\u6545\u969c\u3001\u5b89\u5168\u4e8b\u6545\u5219\u53ef\u4ee5\u67e5\u770b\u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6\uff0c\u6392\u9664\u6545\u969c\u3001\u8ffd\u67e5\u5165\u4fb5\u8005\u7684\u4fe1\u606f\u7b49\u3002</p> <p>\u67e5\u770brsyslog\u4e0eauditd\u670d\u52a1\u662f\u5426\u5f00\u542f</p> <p>rsyslog\u4e00\u822c\u90fd\u4f1a\u5f00\u542f\uff0cauditd\u5982\u6ca1\u5f00\u542f\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <p>```shell</p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#systemctl-start-auditd","title":"systemctl start auditd","text":"<p>```</p> <p>auditd\u670d\u52a1\u5f00\u673a\u542f\u52a8</p> <pre><code># systemctl start auditd\n</code></pre>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#32-\u65e5\u5fd7\u5c5e\u6027\u8bbe\u7f6e","title":"3.2 \u65e5\u5fd7\u5c5e\u6027\u8bbe\u7f6e","text":"<p>\u5e94\u4fdd\u62a4\u5ba1\u8ba1\u8bb0\u5f55\uff0c\u907f\u514d\u53d7\u5230\u672a\u9884\u671f\u7684\u5220\u9664\u3001\u4fee\u6539\u6216\u8986\u76d6\u7b49\u3002</p> <p>\u9632\u6b62\u91cd\u8981\u65e5\u5fd7\u4fe1\u606f\u88ab\u8986\u76d6</p> <p>\u8ba9\u65e5\u5fd7\u6587\u4ef6\u8f6c\u50a8\u4e00\u4e2a\u6708\uff0c\u4fdd\u75596\u4e2a\u6708\u7684\u4fe1\u606f\uff0c\u5148\u67e5\u770b\u76ee\u524d\u914d\u7f6e\uff0c</p> <pre><code># more /etc/logrotate.conf | grep -v \"^#\\|^$\"\n</code></pre> <p></p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#33-\u542f\u7528syslog","title":"3.3 \u542f\u7528syslog","text":"<p>\u542f\u7528\u65e5\u5fd7\u529f\u80fd\uff0c\u5e76\u914d\u7f6e\u65e5\u5fd7\u8bb0\u5f55\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4</p> <p>Linux\u7cfb\u7edf\u9ed8\u8ba4\u542f\u7528\u4ee5\u4e0b\u7c7b\u578b\u65e5\u5fd7\uff1a</p> <ul> <li>\u7cfb\u7edf\u65e5\u5fd7\uff08\u9ed8\u8ba4\uff09/var/log/messages</li> <li>cron\u65e5\u5fd7\uff08\u9ed8\u8ba4\uff09/var/log/cron</li> <li>\u5b89\u5168\u65e5\u5fd7\uff08\u9ed8\u8ba4\uff09/var/log/secure</li> </ul> <p>\u6ce8\u610f\uff1a\u90e8\u5206\u7cfb\u7edf\u53ef\u80fd\u4f7f\u7528syslog-ng\u65e5\u5fd7\uff0c\u914d\u7f6e\u6587\u4ef6\u4e3a\uff1a/etc/syslog-ng/syslog-ng.conf\u3002</p> <p>\u60a8\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u914d\u7f6e\u8be6\u7ec6\u65e5\u5fd7\u3002</p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#\u56db-\u5165\u4fb5\u9632\u5fa1","title":"\u56db \u5165\u4fb5\u9632\u5fa1","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u9075\u5faa\u6700\u5c0f\u5b89\u88c5\u7684\u539f\u5219\uff0c\u4ec5\u5b89\u88c5\u9700\u8981\u7684\u7ec4\u4ef6\u548c\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u901a\u8fc7\u8bbe\u7f6e\u5347\u7ea7\u670d\u52a1\u5668\u7b49\u65b9\u5f0f\u4fdd\u6301\u7cfb\u7edf\u8865\u4e01\u53ca\u65f6\u5f97\u5230\u66f4\u65b0\u3002</p> <p>\u5173\u95ed\u4e0e\u7cfb\u7edf\u4e1a\u52a1\u65e0\u5173\u6216\u4e0d\u5fc5\u8981\u7684\u670d\u52a1\uff0c\u51cf\u5c0f\u7cfb\u7edf\u88ab\u9ed1\u5ba2\u88ab\u653b\u51fb\u3001\u6e17\u900f\u7684\u98ce\u9669\u3002</p> <p>\u7981\u7528\u84dd\u7259\u670d\u52a1</p> <pre><code># systemctl stop bluetooth\n</code></pre>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#\u4e94-\u7cfb\u7edf\u8d44\u6e90\u63a7\u5236","title":"\u4e94 \u7cfb\u7edf\u8d44\u6e90\u63a7\u5236","text":""},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#51-\u8bbf\u95ee\u63a7\u5236","title":"5.1 \u8bbf\u95ee\u63a7\u5236","text":"<p>\u5e94\u901a\u8fc7\u8bbe\u5b9a\u7ec8\u7aef\u63a5\u5165\u65b9\u5f0f\u3001\u7f51\u7edc\u5730\u5740\u8303\u56f4\u7b49\u6761\u4ef6\u9650\u5236\u7ec8\u7aef\u767b\u5f55\u3002</p> <p>\u5bf9\u63a5\u5165\u670d\u52a1\u5668\u7684IP\u3001\u65b9\u5f0f\u7b49\u8fdb\u884c\u9650\u5236\uff0c\u53ef\u4ee5\u963b\u6b62\u975e\u6cd5\u5165\u4fb5\u3002</p> <ul> <li>\u5728/etc/hosts.allow\u548c/etc/hosts.deny\u6587\u4ef6\u4e2d\u914d\u7f6e\u63a5\u5165\u9650\u5236</li> </ul> <p>\u6700\u597d\u7684\u7b56\u7565\u5c31\u662f\u963b\u6b62\u6240\u6709\u7684\u4e3b\u673a\u5728\u201c/etc/hosts.deny\u201d\u6587\u4ef6\u4e2d\u52a0\u5165\u201c ALL:ALL@ALL, PARANOID \u201d\uff0c\u7136\u540e\u518d\u5728\u201c/etc/hosts.allow\u201d \u6587\u4ef6\u4e2d\u52a0\u5165\u6240\u6709\u5141\u8bb8\u8bbf\u95ee\u7684\u4e3b\u673a\u5217\u8868\u3002\u5982\u4e0b\u64cd\u4f5c\uff1a</p> <p>\u7f16\u8f91 hosts.deny\u6587\u4ef6\uff08vi /etc/hosts.deny\uff09\uff0c\u52a0\u5165\u4e0b\u9762\u8be5\u884c\uff1a</p> <pre><code># Deny access to everyone. \nALL: ALL@ALL, PARANOID\n</code></pre> <p>\u7f16\u8f91hosts.allow \u6587\u4ef6\uff08vi /etc/hosts.allow\uff09\uff0c\u52a0\u5165\u5141\u8bb8\u8bbf\u95ee\u7684\u4e3b\u673a\u5217\u8868\uff0c\u6bd4\u5982\uff1a</p> <p>ftp: 202.54.15.99 foo.com    //202.54.15.99\u662f\u5141\u8bb8\u8bbf\u95ee ftp \u670d\u52a1\u7684 IP \u5730\u5740</p> <p>//foo.com \u662f\u5141\u8bb8\u8bbf\u95ee ftp \u670d\u52a1\u7684\u4e3b\u673a\u540d\u79f0\u3002</p> <ul> <li>\u4e5f\u53ef\u4ee5\u7528iptables\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236 </li> </ul>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#52-\u8d85\u65f6\u9501\u5b9a","title":"5.2 \u8d85\u65f6\u9501\u5b9a","text":"<p>\u5e94\u6839\u636e\u5b89\u5168\u7b56\u7565\u8bbe\u7f6e\u767b\u5f55\u7ec8\u7aef\u7684\u64cd\u4f5c\u8d85\u65f6\u9501\u5b9a\u3002</p> <p>\u8bbe\u7f6e\u767b\u5f55\u8d85\u65f6\u65f6\u95f4\uff0c\u91ca\u653e\u7cfb\u7edf\u8d44\u6e90\uff0c\u4e5f\u63d0\u9ad8\u670d\u52a1\u5668\u7684\u5b89\u5168\u6027\u3002</p> <p>/etc/profile\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4e00\u884c</p> <pre><code>exprot TMOUT=900  //15\u5206\u949f# source /etc/profile\n</code></pre> <p>\u6539\u53d8\u8fd9\u9879\u8bbe\u7f6e\u540e\uff0c\u5fc5\u987b\u5148\u6ce8\u9500\u7528\u6237\uff0c\u518d\u7528\u8be5\u7528\u6237\u767b\u5f55\u624d\u80fd\u6fc0\u6d3b\u8fd9\u4e2a\u529f\u80fd\u3002</p> <p>\u5982\u679c\u6709\u9700\u8981\uff0c\u5f00\u542f\u5c4f\u5e55\u4fdd\u62a4\u529f\u80fd</p> <p>\u8bbe\u7f6e\u5c4f\u5e55\u4fdd\u62a4\uff1a\u8bbe\u7f6e -&gt; \u7cfb\u7edf\u8bbe\u7f6e -&gt; \u5c4f\u5e55\u4fdd\u62a4\u7a0b\u5e8f\uff0c\u8fdb\u884c\u64cd\u4f5c</p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#\u516d--\u6700\u4f73\u7ecf\u9a8c\u5b9e\u8df5","title":"\u516d  \u6700\u4f73\u7ecf\u9a8c\u5b9e\u8df5","text":"<p>\u5bf9Linux\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u63d0\u5347\u6709\u4e00\u5b9a\u5e2e\u52a9\u3002</p>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#61-dos\u653b\u51fb\u9632\u5fa1","title":"6.1 DOS\u653b\u51fb\u9632\u5fa1","text":"<p>\u9632\u6b62\u62d2\u7edd\u670d\u52a1\u653b\u51fb</p> <p>TCP SYN\u4fdd\u62a4\u673a\u5236\u7b49\u8bbe\u7f6e</p> <ul> <li>\u6253\u5f00 syncookie\uff1a</li> </ul> <pre><code># echo\u201c1\u201d&gt;/proc/sys/net/ipv4/tcp_syncookies  //\u9ed8\u8ba4\u4e3a1\uff0c\u4e00\u822c\u4e0d\u7528\u8bbe\u7f6e\n</code></pre> <p>\u8868\u793a\u5f00\u542fSYN Cookies\u3002\u5f53\u51fa\u73b0SYN\u7b49\u5f85\u961f\u5217\u6ea2\u51fa\u65f6\uff0c\u542f\u7528cookies\u6765\u5904\u7406\uff0c\u53ef\u9632\u8303\u5c11\u91cfSYN\u653b\u51fb\uff0c\u9ed8\u8ba4\u4e3a0\uff0c\u8868\u793a\u5173\u95ed\uff1b</p> <ul> <li>\u9632syn \u653b\u51fb\u4f18\u5316</li> </ul> <p>\u7528vi\u7f16\u8f91/etc/sysctl.conf\uff0c\u6dfb\u52a0\u5982\u4e0b\u884c\uff1a</p> <pre><code>net.ipv4.tcp_max_syn_backlog = 2048\n</code></pre>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#62-\u5386\u53f2\u547d\u4ee4","title":"6.2 \u5386\u53f2\u547d\u4ee4","text":"<p>\u4e3a\u5386\u53f2\u7684\u547d\u4ee4\u589e\u52a0\u767b\u5f55\u7684IP\u5730\u5740\u3001\u6267\u884c\u547d\u4ee4\u65f6\u95f4\u7b49</p> <ul> <li>\u4fdd\u5b581\u4e07\u6761\u547d\u4ee4</li> </ul> <pre><code># sed -i 's/^HISTSIZE=1000/HISTSIZE=10000/g' /etc/profile\n</code></pre> <ul> <li>\u5728/etc/profile\u7684\u6587\u4ef6\u5c3e\u90e8\u6dfb\u52a0\u5982\u4e0b\u884c\u6570\u914d\u7f6e\u4fe1\u606f\uff1a</li> </ul> <pre><code>USER_IP=`who -u am i 2&gt;/dev/null| awk '{print $NF}' |sed -e 's/[()]//g'`if [ \"$USER_IP\" = \"\" ]thenUSER_IP=`hostname`fiexport HISTTIMEFORMAT=\"%F %T $USER_IP `whoami` \"shopt -s histappendexport PROMPT_COMMAND=\"history -a\"\n</code></pre>"},{"location":"Linux/system/1.Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/#\u53c2\u8003\u94fe\u63a5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://mp.weixin.qq.com/s/Sq1Kdl6OfIR_0VM7IXCHOA</li> </ul>"},{"location":"Linux/system/2.Systemd/","title":"Systemd","text":""},{"location":"Linux/system/2.Systemd/#1systemd-\u547d\u4ee4\u7bc7","title":"1.Systemd \u547d\u4ee4\u7bc7","text":""},{"location":"Linux/system/2.Systemd/#11-\u7531\u6765","title":"1.1 \u7531\u6765","text":"<p>\u5386\u53f2\u4e0a\uff0cLinux \u7684\u542f\u52a8\u4e00\u76f4\u91c7\u7528init\u8fdb\u7a0b\u3002 \u4e0b\u9762\u7684\u547d\u4ee4\u7528\u6765\u542f\u52a8\u670d\u52a1\u3002 <pre><code>$ sudo /etc/init.d/apache2 start\n# \u6216\u8005\n$ service apache2 start\n</code></pre></p> <p>\u8fd9\u79cd\u65b9\u6cd5\u6709\u4e24\u4e2a\u7f3a\u70b9\u3002 \u4e00\u662f\u542f\u52a8\u65f6\u95f4\u957f\u3002init\u8fdb\u7a0b\u662f\u4e32\u884c\u542f\u52a8\uff0c\u53ea\u6709\u524d\u4e00\u4e2a\u8fdb\u7a0b\u542f\u52a8\u5b8c\uff0c\u624d\u4f1a\u542f\u52a8\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u3002</p> <p>\u4e8c\u662f\u542f\u52a8\u811a\u672c\u590d\u6742\u3002init\u8fdb\u7a0b\u53ea\u662f\u6267\u884c\u542f\u52a8\u811a\u672c\uff0c\u4e0d\u7ba1\u5176\u4ed6\u4e8b\u60c5\u3002\u811a\u672c\u9700\u8981\u81ea\u5df1\u5904\u7406\u5404\u79cd\u60c5\u51b5\uff0c\u8fd9\u5f80\u5f80\u4f7f\u5f97\u811a\u672c\u53d8\u5f97\u5f88\u957f\u3002</p>"},{"location":"Linux/system/2.Systemd/#12-systemd-\u6982\u8ff0","title":"1.2 Systemd \u6982\u8ff0","text":"<p>Systemd \u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u800c\u8bde\u751f\u7684\u3002\u5b83\u7684\u8bbe\u8ba1\u76ee\u6807\u662f\uff0c\u4e3a\u7cfb\u7edf\u7684\u542f\u52a8\u548c\u7ba1\u7406\u63d0\u4f9b\u4e00\u5957\u5b8c\u6574\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u6839\u636eLinux\u60ef\u4f8b\uff0c\u5b57\u6bcdd\u662f\u5b88\u62a4\u8fdb\u7a0b\uff08daemon\uff09\u7684\u7f29\u5199\u3002 Systemd \u8fd9\u4e2a\u540d\u5b57\u7684\u542b\u4e49\uff0c\u5c31\u662f\u5b83\u8981\u5b88\u62a4\u6574\u4e2a\u7cfb\u7edf\u3002</p> <p>\u4f7f\u7528\u4e86 Systemd\uff0c\u5c31\u4e0d\u9700\u8981\u518d\u7528init\u4e86\u3002Systemd \u53d6\u4ee3\u4e86initd\uff0c\u6210\u4e3a\u7cfb\u7edf\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\uff08PID \u7b49\u4e8e 1\uff09\uff0c\u5176\u4ed6\u8fdb\u7a0b\u90fd\u662f\u5b83\u7684\u5b50\u8fdb\u7a0b\u3002</p> <pre><code># systemctl --version\nsystemd 245 (245.4-4ubuntu3.20)\n+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD +IDN2 -IDN +PCRE2 default-hierarchy=hybrid\n</code></pre>"},{"location":"Linux/system/2.Systemd/#13-\u7cfb\u7edf\u7ba1\u7406","title":"1.3 \u7cfb\u7edf\u7ba1\u7406","text":"<p>Systemd \u5e76\u4e0d\u662f\u4e00\u4e2a\u547d\u4ee4\uff0c\u800c\u662f\u4e00\u7ec4\u547d\u4ee4\uff0c\u6d89\u53ca\u5230\u7cfb\u7edf\u7ba1\u7406\u7684\u65b9\u65b9\u9762\u9762\u3002</p>"},{"location":"Linux/system/2.Systemd/#131-systemctl","title":"1.3.1 systemctl","text":"<p>systemctl\u662f Systemd \u7684\u4e3b\u547d\u4ee4\uff0c\u7528\u4e8e\u7ba1\u7406\u7cfb\u7edf\u3002 <pre><code># \u91cd\u542f\u7cfb\u7edf\n$ sudo systemctl reboot\n# \u5173\u95ed\u7cfb\u7edf\uff0c\u5207\u65ad\u7535\u6e90\n$ sudo systemctl poweroff\n# CPU\u505c\u6b62\u5de5\u4f5c\n$ sudo systemctl halt\n# \u6682\u505c\u7cfb\u7edf\n$ sudo systemctl suspend\n# \u8ba9\u7cfb\u7edf\u8fdb\u5165\u51ac\u7720\u72b6\u6001\n$ sudo systemctl hibernate\n# \u8ba9\u7cfb\u7edf\u8fdb\u5165\u4ea4\u4e92\u5f0f\u4f11\u7720\u72b6\u6001\n$ sudo systemctl hybrid-sleep\n# \u542f\u52a8\u8fdb\u5165\u6551\u63f4\u72b6\u6001\uff08\u5355\u7528\u6237\u72b6\u6001\uff09\n$ sudo systemctl rescue\n\n# \u663e\u793a\u7cfb\u7edf\u72b6\u6001\nsystemctl status # \u8f93\u51fa\u5df2\u52a0\u8f7d\u7684\u5355\u5143\nsystemctl list-units #  \u8f93\u51fa\u5df2\u52a0\u8f7d\u7684\u5355\u5143\uff08\u5305\u542b\u672a\u6fc0\u6d3b\uff09\nsystemctl list-units --all\n\n# \u8f93\u51fa\u8fd0\u884c\u5931\u8d25\u7684\u5355\u5143\nsystemctl list-units --failed\n</code></pre></p>"},{"location":"Linux/system/2.Systemd/#132-systemd-analyze","title":"1.3.2 systemd-analyze","text":"<p>systemd-analyze\u547d\u4ee4\u7528\u4e8e\u67e5\u770b\u542f\u52a8\u8017\u65f6\u3002</p> <pre><code># \u67e5\u770b\u542f\u52a8\u8017\u65f6\n$ systemd-analyze                                                                                       # \u67e5\u770b\u6bcf\u4e2a\u670d\u52a1\u7684\u542f\u52a8\u8017\u65f6\n$ systemd-analyze blame\n# \u663e\u793a\u7011\u5e03\u72b6\u7684\u542f\u52a8\u8fc7\u7a0b\u6d41\n$ systemd-analyze critical-chain\n# \u663e\u793a\u6307\u5b9a\u670d\u52a1\u7684\u542f\u52a8\u6d41\n$ systemd-analyze critical-chain atd.service\n</code></pre>"},{"location":"Linux/system/2.Systemd/#133-hostnamectl","title":"1.3.3 hostnamectl","text":"<p>hostnamectl\u547d\u4ee4\u7528\u4e8e\u67e5\u770b\u5f53\u524d\u4e3b\u673a\u7684\u4fe1\u606f\u3002 <pre><code># \u663e\u793a\u5f53\u524d\u4e3b\u673a\u7684\u4fe1\u606f\n$ hostnamectl\n# \u8bbe\u7f6e\u4e3b\u673a\u540d\u3002\n$ sudo hostnamectl set-hostname rhel7\n</code></pre></p>"},{"location":"Linux/system/2.Systemd/#134-localectl","title":"1.3.4 localectl","text":"<p>localectl\u547d\u4ee4\u7528\u4e8e\u67e5\u770b\u672c\u5730\u5316\u8bbe\u7f6e\u3002</p> <pre><code># \u67e5\u770b\u672c\u5730\u5316\u8bbe\u7f6e\n$ localectl\n# \u8bbe\u7f6e\u672c\u5730\u5316\u53c2\u6570\u3002\n$ sudo localectl set-locale LANG=en_GB.utf8\n$ sudo localectl set-keymap en_GB\n</code></pre>"},{"location":"Linux/system/2.Systemd/#135-timedatectl","title":"1.3.5 timedatectl","text":"<p>timedatectl\u547d\u4ee4\u7528\u4e8e\u67e5\u770b\u5f53\u524d\u65f6\u533a\u8bbe\u7f6e\u3002</p> <pre><code># \u67e5\u770b\u5f53\u524d\u65f6\u533a\u8bbe\u7f6e\n$ timedatectl\n# \u663e\u793a\u6240\u6709\u53ef\u7528\u7684\u65f6\u533a\n$ timedatectl list-timezones                                                                                   # \u8bbe\u7f6e\u5f53\u524d\u65f6\u533a\n$ sudo timedatectl set-timezone America/New_York\n$ sudo timedatectl set-time YYYY-MM-DD\n$ sudo timedatectl set-time HH:MM:SS\n</code></pre>"},{"location":"Linux/system/2.Systemd/#136-loginctl","title":"1.3.6 loginctl","text":"<p>loginctl\u547d\u4ee4\u7528\u4e8e\u67e5\u770b\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002</p> <pre><code># \u5217\u51fa\u5f53\u524dsession\n$ loginctl list-sessions\n# \u5217\u51fa\u5f53\u524d\u767b\u5f55\u7528\u6237\n$ loginctl list-users\n# \u5217\u51fa\u663e\u793a\u6307\u5b9a\u7528\u6237\u7684\u4fe1\u606f\n$ loginctl show-user ruanyf\n</code></pre>"},{"location":"Linux/system/2.Systemd/#14-unit","title":"1.4 Unit","text":""},{"location":"Linux/system/2.Systemd/#141-\u542b\u4e49","title":"1.4.1 \u542b\u4e49","text":"<p>Systemd \u53ef\u4ee5\u7ba1\u7406\u6240\u6709\u7cfb\u7edf\u8d44\u6e90\u3002\u4e0d\u540c\u7684\u8d44\u6e90\u7edf\u79f0\u4e3a Unit\uff08\u5355\u4f4d\uff09\u3002 Unit \u4e00\u5171\u5206\u621012\u79cd\u3002</p> <pre><code>\u25cf Service unit\uff1a\u7cfb\u7edf\u670d\u52a1\n\u25cf Target unit\uff1a\u591a\u4e2a Unit \u6784\u6210\u7684\u4e00\u4e2a\u7ec4\n\u25cf Device Unit\uff1a\u786c\u4ef6\u8bbe\u5907\n\u25cf Mount Unit\uff1a\u6587\u4ef6\u7cfb\u7edf\u7684\u6302\u8f7d\u70b9\n\u25cf Automount Unit\uff1a\u81ea\u52a8\u6302\u8f7d\u70b9\n\u25cf Path Unit\uff1a\u6587\u4ef6\u6216\u8def\u5f84\n\u25cf Scope Unit\uff1a\u4e0d\u662f\u7531 Systemd \u542f\u52a8\u7684\u5916\u90e8\u8fdb\u7a0b\n\u25cf Slice Unit\uff1a\u8fdb\u7a0b\u7ec4\n\u25cf Snapshot Unit\uff1aSystemd \u5feb\u7167\uff0c\u53ef\u4ee5\u5207\u56de\u67d0\u4e2a\u5feb\u7167\n\u25cf Socket Unit\uff1a\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684 socket\n\u25cf Swap Unit\uff1aswap \u6587\u4ef6\n\u25cf Timer Unit\uff1a\u5b9a\u65f6\u5668\n</code></pre> <p><code>systemctl list-units</code>\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u7684\u6240\u6709 Unit \u3002 <pre><code># \u5217\u51fa\u6b63\u5728\u8fd0\u884c\u7684 Unit\n$ systemctl list-units\n# \u5217\u51fa\u6240\u6709Unit\uff0c\u5305\u62ec\u6ca1\u6709\u627e\u5230\u914d\u7f6e\u6587\u4ef6\u7684\u6216\u8005\u542f\u52a8\u5931\u8d25\u7684\n$ systemctl list-units --all\n# \u5217\u51fa\u6240\u6709\u6ca1\u6709\u8fd0\u884c\u7684 Unit\n$ systemctl list-units --all --state=inactive\n# \u5217\u51fa\u6240\u6709\u52a0\u8f7d\u5931\u8d25\u7684 Unit\n$ systemctl list-units --failed\n# \u5217\u51fa\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684\u3001\u7c7b\u578b\u4e3a service \u7684 Unit\n$ systemctl list-units --type=service\n</code></pre></p>"},{"location":"Linux/system/2.Systemd/#141-unit-\u7684\u72b6\u6001","title":"1.4.1 Unit \u7684\u72b6\u6001","text":"<p>systemctl status\u547d\u4ee4\u7528\u4e8e\u67e5\u770b\u7cfb\u7edf\u72b6\u6001\u548c\u5355\u4e2a Unit \u7684\u72b6\u6001\u3002 <pre><code># \u663e\u793a\u7cfb\u7edf\u72b6\u6001\n$ systemctl status\n# \u663e\u793a\u5355\u4e2a Unit \u7684\u72b6\u6001\n$ sysystemctl status bluetooth.service\n# \u663e\u793a\u8fdc\u7a0b\u4e3b\u673a\u7684\u67d0\u4e2a Unit \u7684\u72b6\u6001\n$ systemctl -H root@rhel7.example.com status httpd.service\n</code></pre></p> <p>\u9664\u4e86status\u547d\u4ee4\uff0csystemctl\u8fd8\u63d0\u4f9b\u4e86\u4e09\u4e2a\u67e5\u8be2\u72b6\u6001\u7684\u7b80\u5355\u65b9\u6cd5\uff0c\u4e3b\u8981\u4f9b\u811a\u672c\u5185\u90e8\u7684\u5224\u65ad\u8bed\u53e5\u4f7f\u7528\u3002</p> <pre><code># \u663e\u793a\u67d0\u4e2a Unit \u662f\u5426\u6b63\u5728\u8fd0\u884c\n$ systemctl is-active application.service\n# \u663e\u793a\u67d0\u4e2a Unit \u662f\u5426\u5904\u4e8e\u542f\u52a8\u5931\u8d25\u72b6\u6001\n$ systemctl is-failed application.service\n# \u663e\u793a\u67d0\u4e2a Unit \u670d\u52a1\u662f\u5426\u5efa\u7acb\u4e86\u542f\u52a8\u94fe\u63a5\n$ systemctl is-enabled application.service\n</code></pre>"},{"location":"Linux/system/2.Systemd/#143-unit-\u7ba1\u7406","title":"1.4.3 Unit \u7ba1\u7406","text":"<p>\u5bf9\u4e8e\u7528\u6237\u6765\u8bf4\uff0c\u6700\u5e38\u7528\u7684\u662f\u4e0b\u9762\u8fd9\u4e9b\u547d\u4ee4\uff0c\u7528\u4e8e\u542f\u52a8\u548c\u505c\u6b62 Unit\uff08\u4e3b\u8981\u662f service\uff09\u3002 <pre><code># \u7acb\u5373\u542f\u52a8\u4e00\u4e2a\u670d\u52a1\n$ sudo systemctl start apache.service\n# \u7acb\u5373\u505c\u6b62\u4e00\u4e2a\u670d\u52a1\n$ sudo systemctl stop apache.service\n# \u91cd\u542f\u4e00\u4e2a\u670d\u52a1\n$ sudo systemctl restart apache.service\n# \u6740\u6b7b\u4e00\u4e2a\u670d\u52a1\u7684\u6240\u6709\u5b50\u8fdb\u7a0b\n$ sudo systemctl kill apache.service\n# \u91cd\u65b0\u52a0\u8f7d\u4e00\u4e2a\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\n$ sudo systemctl reload apache.service\n# \u91cd\u8f7d\u6240\u6709\u4fee\u6539\u8fc7\u7684\u914d\u7f6e\u6587\u4ef6\n$ sudo systemctl daemon-reload\n# \u663e\u793a\u67d0\u4e2a Unit \u7684\u6240\u6709\u5e95\u5c42\u53c2\u6570\n$ systemctl show httpd.service\n# \u663e\u793a\u67d0\u4e2a Unit \u7684\u6307\u5b9a\u5c5e\u6027\u7684\u503c\n$ systemctl show -p CPUShares httpd.service\n# \u8bbe\u7f6e\u67d0\u4e2a Unit \u7684\u6307\u5b9a\u5c5e\u6027\n$ sudo systemctl set-property httpd.service CPUShares=500\n</code></pre></p>"},{"location":"Linux/system/2.Systemd/#144-\u4f9d\u8d56\u5173\u7cfb","title":"1.4.4 \u4f9d\u8d56\u5173\u7cfb","text":"<p>Unit \u4e4b\u95f4\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\uff1aA \u4f9d\u8d56\u4e8e B\uff0c\u5c31\u610f\u5473\u7740 Systemd \u5728\u542f\u52a8 A \u7684\u65f6\u5019\uff0c\u540c\u65f6\u4f1a\u53bb\u542f\u52a8 B\u3002 systemctl list-dependencies\u547d\u4ee4\u5217\u51fa\u4e00\u4e2a Unit \u7684\u6240\u6709\u4f9d\u8d56 <pre><code>$ systemctl list-dependencies nginx.service\n</code></pre></p> <p>\u4e0a\u9762\u547d\u4ee4\u7684\u8f93\u51fa\u7ed3\u679c\u4e4b\u4e2d\uff0c\u6709\u4e9b\u4f9d\u8d56\u662f Target \u7c7b\u578b\uff08\u8be6\u89c1\u4e0b\u6587\uff09\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u5c55\u5f00\u663e\u793a\u3002\u5982\u679c\u8981\u5c55\u5f00 Target\uff0c\u5c31\u9700\u8981\u4f7f\u7528--all\u53c2\u6570\u3002</p> <pre><code>$ systemctl list-dependencies --all nginx.service\n</code></pre>"},{"location":"Linux/system/2.Systemd/#15-unit-\u7684\u914d\u7f6e\u6587\u4ef6","title":"1.5 Unit \u7684\u914d\u7f6e\u6587\u4ef6","text":""},{"location":"Linux/system/2.Systemd/#151-\u6982\u8ff0","title":"1.5.1 \u6982\u8ff0","text":"<p>\u6bcf\u4e00\u4e2a Unit \u90fd\u6709\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u544a\u8bc9 Systemd \u600e\u4e48\u542f\u52a8\u8fd9\u4e2a Unit \u3002</p> <p>Systemd \u9ed8\u8ba4\u4ece\u76ee\u5f55<code>/etc/systemd/system/</code>\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u4f46\u662f\uff0c\u91cc\u9762\u5b58\u653e\u7684\u5927\u90e8\u5206\u6587\u4ef6\u90fd\u662f\u7b26\u53f7\u94fe\u63a5\uff0c\u6307\u5411\u76ee\u5f55/usr/lib/systemd/system/\uff0c\u771f\u6b63\u7684\u914d\u7f6e\u6587\u4ef6\u5b58\u653e\u5728\u90a3\u4e2a\u76ee\u5f55\u3002</p> <p><code>systemctl enable</code>\u547d\u4ee4\u7528\u4e8e\u5728\u4e0a\u9762\u4e24\u4e2a\u76ee\u5f55\u4e4b\u95f4\uff0c\u5efa\u7acb\u7b26\u53f7\u94fe\u63a5\u5173\u7cfb\u3002</p> <p><pre><code>$ sudo systemctl enable clamd@scan.service\n# \u7b49\u540c\u4e8e\n$ sudo ln -s '/usr/lib/systemd/system/clamd@scan.service' '/etc/systemd/system/multi-user.target.wants/clamd@scan.service'\n</code></pre> \u5982\u679c\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u8bbe\u7f6e\u4e86\u5f00\u673a\u542f\u52a8\uff0c<code>systemctl enable</code>\u547d\u4ee4\u76f8\u5f53\u4e8e\u6fc0\u6d3b\u5f00\u673a\u542f\u52a8\u3002 \u4e0e\u4e4b\u5bf9\u5e94\u7684\uff0c<code>systemctl disable</code>\u547d\u4ee4\u7528\u4e8e\u5728\u4e24\u4e2a\u76ee\u5f55\u4e4b\u95f4\uff0c\u64a4\u9500\u7b26\u53f7\u94fe\u63a5\u5173\u7cfb\uff0c\u76f8\u5f53\u4e8e\u64a4\u9500\u5f00\u673a\u542f\u52a8\u3002 <pre><code>$ sudo systemctl disable clamd@scan.service\n</code></pre></p> <p>\u914d\u7f6e\u6587\u4ef6\u7684\u540e\u7f00\u540d\uff0c\u5c31\u662f\u8be5 Unit \u7684\u79cd\u7c7b\uff0c\u6bd4\u5982sshd.socket\u3002\u5982\u679c\u7701\u7565\uff0cSystemd \u9ed8\u8ba4\u540e\u7f00\u540d\u4e3a.service\uff0c\u6240\u4ee5sshd\u4f1a\u88ab\u7406\u89e3\u6210sshd.service\u3002</p>"},{"location":"Linux/system/2.Systemd/#152-\u914d\u7f6e\u6587\u4ef6\u7684\u72b6\u6001","title":"1.5.2 \u914d\u7f6e\u6587\u4ef6\u7684\u72b6\u6001","text":"<p>systemctl list-unit-files\u547d\u4ee4\u7528\u4e8e\u5217\u51fa\u6240\u6709\u914d\u7f6e\u6587\u4ef6\u3002 <pre><code># \u5217\u51fa\u6240\u6709\u914d\u7f6e\u6587\u4ef6\n$ systemctl list-unit-files\n# \u5217\u51fa\u6307\u5b9a\u7c7b\u578b\u7684\u914d\u7f6e\u6587\u4ef6\n$ systemctl list-unit-files --type=service\n</code></pre></p> <p>\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u8f93\u51fa\u4e00\u4e2a\u5217\u8868\u3002 <pre><code>$ systemctl list-unit-files\nUNIT FILE              STATE\nchronyd.service        enabled\nclamd@.service         static\nclamd@scan.service     disabled\n</code></pre> \u8fd9\u4e2a\u5217\u8868\u663e\u793a\u6bcf\u4e2a\u914d\u7f6e\u6587\u4ef6\u7684\u72b6\u6001\uff0c\u4e00\u5171\u6709\u56db\u79cd\u3002</p> <pre><code>\u25cf enabled\uff1a\u5df2\u5efa\u7acb\u542f\u52a8\u94fe\u63a5\n\u25cf disabled\uff1a\u6ca1\u5efa\u7acb\u542f\u52a8\u94fe\u63a5\n\u25cf static\uff1a\u8be5\u914d\u7f6e\u6587\u4ef6\u6ca1\u6709[Install]\u90e8\u5206\uff08\u65e0\u6cd5\u6267\u884c\uff09\uff0c\u53ea\u80fd\u4f5c\u4e3a\u5176\u4ed6\u914d\u7f6e\u6587\u4ef6\u7684\u4f9d\u8d56\n\u25cf masked\uff1a\u8be5\u914d\u7f6e\u6587\u4ef6\u88ab\u7981\u6b62\u5efa\u7acb\u542f\u52a8\u94fe\u63a5\n</code></pre> <p>\u6ce8\u610f\uff0c\u4ece\u914d\u7f6e\u6587\u4ef6\u7684\u72b6\u6001\u65e0\u6cd5\u770b\u51fa\uff0c\u8be5 Unit \u662f\u5426\u6b63\u5728\u8fd0\u884c\u3002\u8fd9\u5fc5\u987b\u6267\u884c\u524d\u9762\u63d0\u5230\u7684systemctl status\u547d\u4ee4\u3002 <pre><code>$ systemctl status bluetooth.service\n</code></pre></p> <p>\u4e00\u65e6\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5c31\u8981\u8ba9 SystemD \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u65b0\u542f\u52a8\uff0c\u5426\u5219\u4fee\u6539\u4e0d\u4f1a\u751f\u6548\u3002 <pre><code>$ sudo systemctl daemon-reload\n$ sudo systemctl restart httpd.service\n</code></pre></p>"},{"location":"Linux/system/2.Systemd/#153-\u914d\u7f6e\u6587\u4ef6\u7684\u683c\u5f0f","title":"1.5.3 \u914d\u7f6e\u6587\u4ef6\u7684\u683c\u5f0f","text":"<p>\u914d\u7f6e\u6587\u4ef6\u5c31\u662f\u666e\u901a\u7684\u6587\u672c\u6587\u4ef6\uff0c\u53ef\u4ee5\u7528\u6587\u672c\u7f16\u8f91\u5668\u6253\u5f00\u3002 systemctl cat\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u914d\u7f6e\u6587\u4ef6\u7684\u5185\u5bb9\u3002</p> <pre><code>$ systemctl cat sshd\n# /lib/systemd/system/ssh.service\n[Unit]\nDescription=OpenBSD Secure Shell server\nDocumentation=man:sshd(8) man:sshd_config(5)\nAfter=network.target auditd.service\nConditionPathExists=!/etc/ssh/sshd_not_to_be_run\n\n[Service]\nEnvironmentFile=-/etc/default/ssh\nExecStartPre=/usr/sbin/sshd -t\nExecStart=/usr/sbin/sshd -D $SSHD_OPTS\nExecReload=/usr/sbin/sshd -t\nExecReload=/bin/kill -HUP $MAINPID\nKillMode=process\nRestart=on-failure\nRestartPreventExitStatus=255\nType=notify\nRuntimeDirectory=sshd\nRuntimeDirectoryMode=0755\n[Install]\nWantedBy=multi-user.target\nAlias=sshd.service\n</code></pre>"},{"location":"Linux/system/2.Systemd/#154-\u914d\u7f6e\u6587\u4ef6\u7684\u533a\u5757","title":"1.5.4 \u914d\u7f6e\u6587\u4ef6\u7684\u533a\u5757","text":"<p>[Unit]\u533a\u5757\u901a\u5e38\u662f\u914d\u7f6e\u6587\u4ef6\u7684\u7b2c\u4e00\u4e2a\u533a\u5757\uff0c\u7528\u6765\u5b9a\u4e49 Unit \u7684\u5143\u6570\u636e\uff0c\u4ee5\u53ca\u914d\u7f6e\u4e0e\u5176\u4ed6 Unit \u7684\u5173\u7cfb\u3002\u5b83\u7684\u4e3b\u8981\u5b57\u6bb5\u5982\u4e0b\u3002 <pre><code>\u25cf Description\uff1a\u7b80\u77ed\u63cf\u8ff0\n\u25cf Documentation\uff1a\u6587\u6863\u5730\u5740\n\u25cf Requires\uff1a\u5f53\u524d Unit \u4f9d\u8d56\u7684\u5176\u4ed6 Unit\uff0c\u5982\u679c\u5b83\u4eec\u6ca1\u6709\u8fd0\u884c\uff0c\u5f53\u524d Unit \u4f1a\u542f\u52a8\u5931\u8d25\n\u25cf Wants\uff1a\u4e0e\u5f53\u524d Unit \u914d\u5408\u7684\u5176\u4ed6 Unit\uff0c\u5982\u679c\u5b83\u4eec\u6ca1\u6709\u8fd0\u884c\uff0c\u5f53\u524d Unit \u4e0d\u4f1a\u542f\u52a8\u5931\u8d25\n\u25cf BindsTo\uff1a\u4e0eRequires\u7c7b\u4f3c\uff0c\u5b83\u6307\u5b9a\u7684 Unit \u5982\u679c\u9000\u51fa\uff0c\u4f1a\u5bfc\u81f4\u5f53\u524d Unit \u505c\u6b62\u8fd0\u884c\n\u25cf Before\uff1a\u5982\u679c\u8be5\u5b57\u6bb5\u6307\u5b9a\u7684 Unit \u4e5f\u8981\u542f\u52a8\uff0c\u90a3\u4e48\u5fc5\u987b\u5728\u5f53\u524d Unit \u4e4b\u540e\u542f\u52a8\n\u25cf After\uff1a\u5982\u679c\u8be5\u5b57\u6bb5\u6307\u5b9a\u7684 Unit \u4e5f\u8981\u542f\u52a8\uff0c\u90a3\u4e48\u5fc5\u987b\u5728\u5f53\u524d Unit \u4e4b\u524d\u542f\u52a8\n\u25cf Conflicts\uff1a\u8fd9\u91cc\u6307\u5b9a\u7684 Unit \u4e0d\u80fd\u4e0e\u5f53\u524d Unit \u540c\u65f6\u8fd0\u884c\n\u25cf Condition...\uff1a\u5f53\u524d Unit \u8fd0\u884c\u5fc5\u987b\u6ee1\u8db3\u7684\u6761\u4ef6\uff0c\u5426\u5219\u4e0d\u4f1a\u8fd0\u884c\n\u25cf Assert...\uff1a\u5f53\u524d Unit \u8fd0\u884c\u5fc5\u987b\u6ee1\u8db3\u7684\u6761\u4ef6\uff0c\u5426\u5219\u4f1a\u62a5\u542f\u52a8\u5931\u8d25\n</code></pre></p> <p>[Install]\u901a\u5e38\u662f\u914d\u7f6e\u6587\u4ef6\u7684\u6700\u540e\u4e00\u4e2a\u533a\u5757\uff0c\u7528\u6765\u5b9a\u4e49\u5982\u4f55\u542f\u52a8\uff0c\u4ee5\u53ca\u662f\u5426\u5f00\u673a\u542f\u52a8\u3002\u5b83\u7684\u4e3b\u8981\u5b57\u6bb5\u5982\u4e0b\u3002</p> <pre><code>\u25cf WantedBy\uff1a\u5b83\u7684\u503c\u662f\u4e00\u4e2a\u6216\u591a\u4e2a Target\uff0c\u5f53\u524d Unit \u6fc0\u6d3b\u65f6\uff08enable\uff09\u7b26\u53f7\u94fe\u63a5\u4f1a\u653e\u5165/etc/systemd/system\u76ee\u5f55\u4e0b\u9762\u4ee5 Target \u540d + .wants\u540e\u7f00\u6784\u6210\u7684\u5b50\u76ee\u5f55\u4e2d\n\u25cf RequiredBy\uff1a\u5b83\u7684\u503c\u662f\u4e00\u4e2a\u6216\u591a\u4e2a Target\uff0c\u5f53\u524d Unit \u6fc0\u6d3b\u65f6\uff0c\u7b26\u53f7\u94fe\u63a5\u4f1a\u653e\u5165/etc/systemd/system\u76ee\u5f55\u4e0b\u9762\u4ee5 Target \u540d + .required\u540e\u7f00\u6784\u6210\u7684\u5b50\u76ee\u5f55\u4e2d\n\u25cf Alias\uff1a\u5f53\u524d Unit \u53ef\u7528\u4e8e\u542f\u52a8\u7684\u522b\u540d\n\u25cf Also\uff1a\u5f53\u524d Unit \u6fc0\u6d3b\uff08enable\uff09\u65f6\uff0c\u4f1a\u88ab\u540c\u65f6\u6fc0\u6d3b\u7684\u5176\u4ed6 Unit\n</code></pre> <p>[Service]\u533a\u5757\u7528\u6765 Service \u7684\u914d\u7f6e\uff0c\u53ea\u6709 Service \u7c7b\u578b\u7684 Unit \u624d\u6709\u8fd9\u4e2a\u533a\u5757\u3002\u5b83\u7684\u4e3b\u8981\u5b57\u6bb5\u5982\u4e0b\u3002</p> <p><pre><code>\u25cf Type\uff1a\u5b9a\u4e49\u542f\u52a8\u65f6\u7684\u8fdb\u7a0b\u884c\u4e3a\u3002\u5b83\u6709\u4ee5\u4e0b\u51e0\u79cd\u503c\u3002\n\u25cf Type=simple\uff1a\u9ed8\u8ba4\u503c\uff0c\u6267\u884cExecStart\u6307\u5b9a\u7684\u547d\u4ee4\uff0c\u542f\u52a8\u4e3b\u8fdb\u7a0b\n\u25cf Type=forking\uff1a\u4ee5 fork \u65b9\u5f0f\u4ece\u7236\u8fdb\u7a0b\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u521b\u5efa\u540e\u7236\u8fdb\u7a0b\u4f1a\u7acb\u5373\u9000\u51fa\n\u25cf Type=oneshot\uff1a\u4e00\u6b21\u6027\u8fdb\u7a0b\uff0cSystemd \u4f1a\u7b49\u5f53\u524d\u670d\u52a1\u9000\u51fa\uff0c\u518d\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\n\u25cf Type=dbus\uff1a\u5f53\u524d\u670d\u52a1\u901a\u8fc7D-Bus\u542f\u52a8\n\u25cf Type=notify\uff1a\u5f53\u524d\u670d\u52a1\u542f\u52a8\u5b8c\u6bd5\uff0c\u4f1a\u901a\u77e5Systemd\uff0c\u518d\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\n\u25cf Type=idle\uff1a\u82e5\u6709\u5176\u4ed6\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\uff0c\u5f53\u524d\u670d\u52a1\u624d\u4f1a\u8fd0\u884c\n\u25cf ExecStart\uff1a\u542f\u52a8\u5f53\u524d\u670d\u52a1\u7684\u547d\u4ee4\n\u25cf ExecStartPre\uff1a\u542f\u52a8\u5f53\u524d\u670d\u52a1\u4e4b\u524d\u6267\u884c\u7684\u547d\u4ee4\n\u25cf ExecStartPost\uff1a\u542f\u52a8\u5f53\u524d\u670d\u52a1\u4e4b\u540e\u6267\u884c\u7684\u547d\u4ee4\n\u25cf ExecReload\uff1a\u91cd\u542f\u5f53\u524d\u670d\u52a1\u65f6\u6267\u884c\u7684\u547d\u4ee4\n\u25cf ExecStop\uff1a\u505c\u6b62\u5f53\u524d\u670d\u52a1\u65f6\u6267\u884c\u7684\u547d\u4ee4\n\u25cf ExecStopPost\uff1a\u505c\u6b62\u5f53\u5176\u670d\u52a1\u4e4b\u540e\u6267\u884c\u7684\u547d\u4ee4\n\u25cf RestartSec\uff1a\u81ea\u52a8\u91cd\u542f\u5f53\u524d\u670d\u52a1\u95f4\u9694\u7684\u79d2\u6570\n\u25cf Restart\uff1a\u5b9a\u4e49\u4f55\u79cd\u60c5\u51b5 Systemd \u4f1a\u81ea\u52a8\u91cd\u542f\u5f53\u524d\u670d\u52a1\uff0c\u53ef\u80fd\u7684\u503c\u5305\u62ecalways\uff08\u603b\u662f\u91cd\u542f\uff09\u3001on-success\u3001on-failure\u3001on-abnormal\u3001on-abort\u3001on-watchdog\n\u25cf TimeoutSec\uff1a\u5b9a\u4e49 Systemd \u505c\u6b62\u5f53\u524d\u670d\u52a1\u4e4b\u524d\u7b49\u5f85\u7684\u79d2\u6570\n\u25cf Environment\uff1a\u6307\u5b9a\u73af\u5883\u53d8\u91cf\n</code></pre> Unit \u914d\u7f6e\u6587\u4ef6\u7684\u5b8c\u6574\u5b57\u6bb5\u6e05\u5355\uff0c\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"Linux/system/2.Systemd/#16-target","title":"1.6. Target","text":"<p>\u542f\u52a8\u8ba1\u7b97\u673a\u7684\u65f6\u5019\uff0c\u9700\u8981\u542f\u52a8\u5927\u91cf\u7684 Unit\u3002\u5982\u679c\u6bcf\u4e00\u6b21\u542f\u52a8\uff0c\u90fd\u8981\u4e00\u4e00\u5199\u660e\u672c\u6b21\u542f\u52a8\u9700\u8981\u54ea\u4e9b Unit\uff0c\u663e\u7136\u975e\u5e38\u4e0d\u65b9\u4fbf\u3002Systemd \u7684\u89e3\u51b3\u65b9\u6848\u5c31\u662f Target\u3002 \u7b80\u5355\u8bf4\uff0cTarget \u5c31\u662f\u4e00\u4e2a Unit \u7ec4\uff0c\u5305\u542b\u8bb8\u591a\u76f8\u5173\u7684 Unit \u3002\u542f\u52a8\u67d0\u4e2a Target \u7684\u65f6\u5019\uff0cSystemd \u5c31\u4f1a\u542f\u52a8\u91cc\u9762\u6240\u6709\u7684 Unit\u3002\u4ece\u8fd9\u4e2a\u610f\u4e49\u4e0a\u8bf4\uff0cTarget \u8fd9\u4e2a\u6982\u5ff5\u7c7b\u4f3c\u4e8e\"\u72b6\u6001\u70b9\"\uff0c\u542f\u52a8\u67d0\u4e2a Target \u5c31\u597d\u6bd4\u542f\u52a8\u5230\u67d0\u79cd\u72b6\u6001\u3002 \u4f20\u7edf\u7684init\u542f\u52a8\u6a21\u5f0f\u91cc\u9762\uff0c\u6709 RunLevel \u7684\u6982\u5ff5\uff0c\u8ddf Target \u7684\u4f5c\u7528\u5f88\u7c7b\u4f3c\u3002\u4e0d\u540c\u7684\u662f\uff0cRunLevel \u662f\u4e92\u65a5\u7684\uff0c\u4e0d\u53ef\u80fd\u591a\u4e2a RunLevel \u540c\u65f6\u542f\u52a8\uff0c\u4f46\u662f\u591a\u4e2a Target \u53ef\u4ee5\u540c\u65f6\u542f\u52a8\u3002</p> <pre><code># \u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u7684\u6240\u6709 Target\n$ systemctl list-unit-files --type=target\n# \u67e5\u770b\u4e00\u4e2a Target \u5305\u542b\u7684\u6240\u6709 Unit\n$ systemctl list-dependencies multi-user.target\n# \u67e5\u770b\u542f\u52a8\u65f6\u7684\u9ed8\u8ba4 Target\n$ systemctl get-default\n# \u8bbe\u7f6e\u542f\u52a8\u65f6\u7684\u9ed8\u8ba4 Target\n$ sudo systemctl set-default multi-user.target\n# \u5207\u6362 Target \u65f6\uff0c\u9ed8\u8ba4\u4e0d\u5173\u95ed\u524d\u4e00\u4e2a Target \u542f\u52a8\u7684\u8fdb\u7a0b\uff0c\n# systemctl isolate \u547d\u4ee4\u6539\u53d8\u8fd9\u79cd\u884c\u4e3a\uff0c\n# \u5173\u95ed\u524d\u4e00\u4e2a Target \u91cc\u9762\u6240\u6709\u4e0d\u5c5e\u4e8e\u540e\u4e00\u4e2a Target \u7684\u8fdb\u7a0b\n$ sudo systemctl isolate multi-user.target\n</code></pre> <p>Target \u4e0e \u4f20\u7edf RunLevel \u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\u3002</p> <p><pre><code>Traditional runlevel      New target name     Symbolically linked to...\nRunlevel 0           |    runlevel0.target -&gt; poweroff.target\nRunlevel 1           |    runlevel1.target -&gt; rescue.target\nRunlevel 2           |    runlevel2.target -&gt; multi-user.target\nRunlevel 3           |    runlevel3.target -&gt; multi-user.target\nRunlevel 4           |    runlevel4.target -&gt; multi-user.target\nRunlevel 5           |    runlevel5.target -&gt; graphical.target\nRunlevel 6           |    runlevel6.target -&gt; reboot.target\n</code></pre> \u5b83\u4e0einit\u8fdb\u7a0b\u7684\u4e3b\u8981\u5dee\u522b\u5982\u4e0b:</p> <pre><code>\uff081\uff09\u9ed8\u8ba4\u7684 RunLevel\uff08\u5728/etc/inittab\u6587\u4ef6\u8bbe\u7f6e\uff09\u73b0\u5728\u88ab\u9ed8\u8ba4\u7684 Target \u53d6\u4ee3\uff0c\u4f4d\u7f6e\u662f/etc/systemd/system/default.target\uff0c\u901a\u5e38\u7b26\u53f7\u94fe\u63a5\u5230graphical.target\uff08\u56fe\u5f62\u754c\u9762\uff09\u6216\u8005multi-user.target\uff08\u591a\u7528\u6237\u547d\u4ee4\u884c\uff09\u3002\n\n\uff082\uff09\u542f\u52a8\u811a\u672c\u7684\u4f4d\u7f6e\uff0c\u4ee5\u524d\u662f/etc/init.d\u76ee\u5f55\uff0c\u7b26\u53f7\u94fe\u63a5\u5230\u4e0d\u540c\u7684 RunLevel \u76ee\u5f55 \uff08\u6bd4\u5982/etc/rc3.d\u3001/etc/rc5.d\u7b49\uff09\uff0c\u73b0\u5728\u5219\u5b58\u653e\u5728/lib/systemd/system\u548c/etc/systemd/system\u76ee\u5f55\u3002\n\n\uff083\uff09\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u4ee5\u524dinit\u8fdb\u7a0b\u7684\u914d\u7f6e\u6587\u4ef6\u662f/etc/inittab\uff0c\u5404\u79cd\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\u5b58\u653e\u5728/etc/sysconfig\u76ee\u5f55\u3002\u73b0\u5728\u7684\u914d\u7f6e\u6587\u4ef6\u4e3b\u8981\u5b58\u653e\u5728/lib/systemd\u76ee\u5f55\uff0c\u5728/etc/systemd\u76ee\u5f55\u91cc\u9762\u7684\u4fee\u6539\u53ef\u4ee5\u8986\u76d6\u539f\u59cb\u8bbe\u7f6e\u3002\n</code></pre>"},{"location":"Linux/system/2.Systemd/#17-\u65e5\u5fd7\u7ba1\u7406","title":"1.7 \u65e5\u5fd7\u7ba1\u7406","text":"<p>Systemd \u7edf\u4e00\u7ba1\u7406\u6240\u6709 Unit \u7684\u542f\u52a8\u65e5\u5fd7\u3002\u5e26\u6765\u7684\u597d\u5904\u5c31\u662f\uff0c\u53ef\u4ee5\u53ea\u7528journalctl\u4e00\u4e2a\u547d\u4ee4\uff0c\u67e5\u770b\u6240\u6709\u65e5\u5fd7\uff08\u5185\u6838\u65e5\u5fd7\u548c\u5e94\u7528\u65e5\u5fd7\uff09\u3002</p> <p>\u65e5\u5fd7\u7684\u914d\u7f6e\u6587\u4ef6\u662f<code>/etc/systemd/journald.conf</code>\u3002</p> <p>journalctl\u529f\u80fd\u5f3a\u5927\uff0c\u7528\u6cd5\u975e\u5e38\u591a\u3002</p> <pre><code># \u67e5\u770b\u6240\u6709\u65e5\u5fd7\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b \uff0c\u53ea\u4fdd\u5b58\u672c\u6b21\u542f\u52a8\u7684\u65e5\u5fd7\uff09\n$ sudo journalctl\n# \u67e5\u770b\u5185\u6838\u65e5\u5fd7\uff08\u4e0d\u663e\u793a\u5e94\u7528\u65e5\u5fd7\uff09\n$ sudo journalctl -k\n# \u67e5\u770b\u7cfb\u7edf\u672c\u6b21\u542f\u52a8\u7684\u65e5\u5fd7\n$ sudo journalctl -b\n$ sudo journalctl -b -0\n# \u67e5\u770b\u4e0a\u4e00\u6b21\u542f\u52a8\u7684\u65e5\u5fd7\uff08\u9700\u66f4\u6539\u8bbe\u7f6e\uff09\n$ sudo journalctl -b -1\n# \u67e5\u770b\u6307\u5b9a\u65f6\u95f4\u7684\u65e5\u5fd7\n$ sudo journalctl --since=\"2012-10-30 18:17:16\"\n$ sudo journalctl --since \"20 min ago\"\n$ sudo journalctl --since yesterday\n$ sudo journalctl --since \"2015-01-10\" --until \"2015-01-11 03:00\"\n$ sudo journalctl --since 09:00 --until \"1 hour ago\"\n# \u663e\u793a\u5c3e\u90e8\u7684\u6700\u65b010\u884c\u65e5\u5fd7\n$ sudo journalctl -n\n# \u663e\u793a\u5c3e\u90e8\u6307\u5b9a\u884c\u6570\u7684\u65e5\u5fd7\n$ sudo journalctl -n 20\n# \u5b9e\u65f6\u6eda\u52a8\u663e\u793a\u6700\u65b0\u65e5\u5fd7\n$ sudo journalctl -f\n\n# \u67e5\u770b\u6307\u5b9a\u670d\u52a1\u7684\u65e5\u5fd7\n$ sudo journalctl /usr/lib/systemd/systemd\n\n# \u67e5\u770b\u6307\u5b9a\u8fdb\u7a0b\u7684\u65e5\u5fd7\n$ sudo journalctl _PID=1\n# \u67e5\u770b\u67d0\u4e2a\u8def\u5f84\u7684\u811a\u672c\u7684\u65e5\u5fd7\n$ sudo journalctl /usr/bin/bash\n# \u67e5\u770b\u6307\u5b9a\u7528\u6237\u7684\u65e5\u5fd7\n$ sudo journalctl _UID=33 --since today\n# \u67e5\u770b\u67d0\u4e2a Unit \u7684\u65e5\u5fd7\n$ sudo journalctl -u nginx.service\n$ sudo journalctl -u nginx.service --since today\n# \u5b9e\u65f6\u6eda\u52a8\u663e\u793a\u67d0\u4e2a Unit \u7684\u6700\u65b0\u65e5\u5fd7\n$ sudo journalctl -u nginx.service -f\n# \u5408\u5e76\u663e\u793a\u591a\u4e2a Unit \u7684\u65e5\u5fd7\n$ journalctl -u nginx.service -u php-fpm.service --since today\n# \u67e5\u770b\u6307\u5b9a\u4f18\u5148\u7ea7\uff08\u53ca\u5176\u4ee5\u4e0a\u7ea7\u522b\uff09\u7684\u65e5\u5fd7\uff0c\u5171\u67098\u7ea7\n# 0: emerg\n# 1: alert\n# 2: crit\n# 3: err\n# 4: warning\n# 5: notice\n# 6: info\n# 7: debug\n$ sudo journalctl -p err -b\n# \u65e5\u5fd7\u9ed8\u8ba4\u5206\u9875\u8f93\u51fa\uff0c--no-pager \u6539\u4e3a\u6b63\u5e38\u7684\u6807\u51c6\u8f93\u51fa\n$ sudo journalctl --no-pager\n# \u4ee5 JSON \u683c\u5f0f\uff08\u5355\u884c\uff09\u8f93\u51fa\n$ sudo journalctl -b -u nginx.service -o json\n# \u4ee5 JSON \u683c\u5f0f\uff08\u591a\u884c\uff09\u8f93\u51fa\uff0c\u53ef\u8bfb\u6027\u66f4\u597d\n$ sudo journalctl -b -u nginx.serviceqq\n -o json-pretty\n# \u663e\u793a\u65e5\u5fd7\u5360\u636e\u7684\u786c\u76d8\u7a7a\u95f4\n$ sudo journalctl --disk-usage\n# \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u5360\u636e\u7684\u6700\u5927\u7a7a\u95f4\n$ sudo journalctl --vacuum-size=1G\n# \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u4fdd\u5b58\u591a\u4e45\n$ sudo journalctl --vacuum-time=1years\n</code></pre>"},{"location":"Linux/system/2.Systemd/#2systemd\u5b9e\u6218\u7bc7","title":"2.Systemd\u5b9e\u6218\u7bc7","text":""},{"location":"Linux/system/2.Systemd/#21-\u5f00\u673a\u542f\u52a8","title":"2.1 \u5f00\u673a\u542f\u52a8","text":"<pre><code>$ sudo systemctl enable httpd\n</code></pre> <p>\u4e0a\u9762\u7684\u547d\u4ee4\u76f8\u5f53\u4e8e\u5728/etc/systemd/system\u76ee\u5f55\u6dfb\u52a0\u4e00\u4e2a\u7b26\u53f7\u94fe\u63a5\uff0c\u6307\u5411/usr/lib/systemd/system\u91cc\u9762\u7684httpd.service\u6587\u4ef6\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5f00\u673a\u65f6\uff0cSystemd\u53ea\u6267\u884c/etc/systemd/system\u76ee\u5f55\u91cc\u9762\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u8fd9\u4e5f\u610f\u5473\u7740\uff0c\u5982\u679c\u628a\u4fee\u6539\u540e\u7684\u914d\u7f6e\u6587\u4ef6\u653e\u5728\u8be5\u76ee\u5f55\uff0c\u5c31\u53ef\u4ee5\u8fbe\u5230\u8986\u76d6\u539f\u59cb\u914d\u7f6e\u7684\u6548\u679c\u3002</p>"},{"location":"Linux/system/2.Systemd/#22-\u542f\u52a8\u670d\u52a1","title":"2.2 \u542f\u52a8\u670d\u52a1","text":"<pre><code>$ sudo systemctl start httpd\n</code></pre>"},{"location":"Linux/system/2.Systemd/#23-\u505c\u6b62\u670d\u52a1","title":"2.3 \u505c\u6b62\u670d\u52a1","text":"<pre><code>$ sudo systemctl stop httpd.service\n# \u6709\u65f6\u5019\uff0c\u8be5\u547d\u4ee4\u53ef\u80fd\u6ca1\u6709\u54cd\u5e94\uff0c\u670d\u52a1\u505c\u4e0d\u4e0b\u6765\u3002\u8fd9\u65f6\u5019\u5c31\u4e0d\u5f97\u4e0d\"\u6740\u8fdb\u7a0b\"\u4e86\uff0c\u5411\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u53d1\u51fakill\u4fe1\u53f7\u3002\n$ sudo systemctl kill httpd.service\n\n# \u91cd\u542f\u670d\u52a1\n$ sudo systemctl restart httpd.service\n</code></pre>"},{"location":"Linux/system/2.Systemd/#24-\u8bfb\u61c2\u914d\u7f6e\u6587\u4ef6","title":"2.4 \u8bfb\u61c2\u914d\u7f6e\u6587\u4ef6","text":"<p>systemctl cat\u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u67e5\u770b\u914d\u7f6e\u6587\u4ef6\uff0c\u4e0b\u9762\u4ee5sshd.service\u6587\u4ef6\u4e3a\u4f8b\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u542f\u52a8\u4e00\u4e2a SSH \u670d\u52a1\u5668\uff0c\u4f9b\u5176\u4ed6\u7528\u6237\u4ee5 SSH \u65b9\u5f0f\u767b\u5f55\u3002 <pre><code>$ systemctl cat sshd.service\n[Unit]\nDescription=OpenSSH server daemon\nDocumentation=man:sshd(8) man:sshd_config(5)\nAfter=network.target sshd-keygen.service\nWants=sshd-keygen.service\n[Service]\nEnvironmentFile=/etc/sysconfig/sshd\nExecStart=/usr/sbin/sshd -D $OPTIONS\nExecReload=/bin/kill -HUP $MAINPID\nType=simple\nKillMode=process\nRestart=on-failure\nRestartSec=42s\n[Install]\nWantedBy=multi-user.target\n</code></pre></p>"},{"location":"Linux/system/2.Systemd/#25--unit-\u533a\u5757\u542f\u52a8\u987a\u5e8f\u4e0e\u4f9d\u8d56\u5173\u7cfb","title":"2.5  [Unit] \u533a\u5757\uff1a\u542f\u52a8\u987a\u5e8f\u4e0e\u4f9d\u8d56\u5173\u7cfb\u3002","text":"<p>Unit\u533a\u5757</p> <p>Description\u5b57\u6bb5\u7ed9\u51fa\u5f53\u524d\u670d\u52a1\u7684\u7b80\u5355\u63cf\u8ff0\uff0cDocumentation\u5b57\u6bb5\u7ed9\u51fa\u6587\u6863\u4f4d\u7f6e\u3002</p> <p>After\u5b57\u6bb5\uff1a\u8868\u793a\u5982\u679cnetwork.target\u6216sshd-keygen.service\u9700\u8981\u542f\u52a8\uff0c\u90a3\u4e48sshd.service\u5e94\u8be5\u5728\u5b83\u4eec\u4e4b\u540e\u542f\u52a8\u3002</p> <p>Before\u5b57\u6bb5\uff0c\u5b9a\u4e49sshd.service\u5e94\u8be5\u5728\u54ea\u4e9b\u670d\u52a1\u4e4b\u524d\u542f\u52a8\u3002</p> <p>\u6ce8\u610f\uff0cAfter\u548cBefore\u5b57\u6bb5\u53ea\u6d89\u53ca\u542f\u52a8\u987a\u5e8f\uff0c\u4e0d\u6d89\u53ca\u4f9d\u8d56\u5173\u7cfb\u3002</p> <p>\u4e3e\u4f8b\u6765\u8bf4\uff0c\u67d0 Web \u5e94\u7528\u9700\u8981 postgresql \u6570\u636e\u5e93\u50a8\u5b58\u6570\u636e\u3002\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5b83\u53ea\u5b9a\u4e49\u8981\u5728 postgresql \u4e4b\u540e\u542f\u52a8\uff0c\u800c\u6ca1\u6709\u5b9a\u4e49\u4f9d\u8d56 postgresql \u3002\u4e0a\u7ebf\u540e\uff0c\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0cpostgresql \u9700\u8981\u91cd\u65b0\u542f\u52a8\uff0c\u5728\u505c\u6b62\u670d\u52a1\u671f\u95f4\uff0c\u8be5 Web \u5e94\u7528\u5c31\u4f1a\u65e0\u6cd5\u5efa\u7acb\u6570\u636e\u5e93\u8fde\u63a5\u3002</p> <p>\u8bbe\u7f6e\u4f9d\u8d56\u5173\u7cfb\uff0c\u9700\u8981\u4f7f\u7528Wants\u5b57\u6bb5\u548cRequires\u5b57\u6bb5\u3002</p> <p>Wants\u5b57\u6bb5\uff1a\u8868\u793asshd.service\u4e0esshd-keygen.service\u4e4b\u95f4\u5b58\u5728\"\u5f31\u4f9d\u8d56\"\u5173\u7cfb\uff0c\u5373\u5982\u679c\"sshd-keygen.service\"\u542f\u52a8\u5931\u8d25\u6216\u505c\u6b62\u8fd0\u884c\uff0c\u4e0d\u5f71\u54cdsshd.service\u7ee7\u7eed\u6267\u884c\u3002</p> <p>Requires\u5b57\u6bb5\u5219\u8868\u793a\"\u5f3a\u4f9d\u8d56\"\u5173\u7cfb\uff0c\u5373\u5982\u679c\u8be5\u670d\u52a1\u542f\u52a8\u5931\u8d25\u6216\u5f02\u5e38\u9000\u51fa\uff0c\u90a3\u4e48sshd.service\u4e5f\u5fc5\u987b\u9000\u51fa\u3002</p> <p>\u6ce8\u610f\uff0cWants\u5b57\u6bb5\u4e0eRequires\u5b57\u6bb5\u53ea\u6d89\u53ca\u4f9d\u8d56\u5173\u7cfb\uff0c\u4e0e\u542f\u52a8\u987a\u5e8f\u65e0\u5173\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u540c\u65f6\u542f\u52a8\u7684\u3002</p>"},{"location":"Linux/system/2.Systemd/#26-service-\u533a\u5757\u542f\u52a8\u884c\u4e3a","title":"2.6 [Service] \u533a\u5757\uff1a\u542f\u52a8\u884c\u4e3a","text":"<p>Service\u533a\u5757\u5b9a\u4e49\u5982\u4f55\u542f\u52a8\u5f53\u524d\u670d\u52a1\u3002</p>"},{"location":"Linux/system/2.Systemd/#61-\u542f\u52a8\u547d\u4ee4","title":"6.1 \u542f\u52a8\u547d\u4ee4","text":"<p>\u8bb8\u591a\u8f6f\u4ef6\u90fd\u6709\u81ea\u5df1\u7684\u73af\u5883\u53c2\u6570\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u53ef\u4ee5\u7528EnvironmentFile\u5b57\u6bb5\u8bfb\u53d6\u3002</p> <p>EnvironmentFile\u5b57\u6bb5\uff1a\u6307\u5b9a\u5f53\u524d\u670d\u52a1\u7684\u73af\u5883\u53c2\u6570\u6587\u4ef6\u3002\u8be5\u6587\u4ef6\u5185\u90e8\u7684key=value\u952e\u503c\u5bf9\uff0c\u53ef\u4ee5\u7528$key\u7684\u5f62\u5f0f\uff0c\u5728\u5f53\u524d\u914d\u7f6e\u6587\u4ef6\u4e2d\u83b7\u53d6\u3002</p> <p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0csshd \u7684\u73af\u5883\u53c2\u6570\u6587\u4ef6\u662f/etc/sysconfig/sshd\u3002</p> <p>\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6700\u91cd\u8981\u7684\u5b57\u6bb5\u662fExecStart\u3002</p> <p>ExecStart\u5b57\u6bb5\uff1a\u5b9a\u4e49\u542f\u52a8\u8fdb\u7a0b\u65f6\u6267\u884c\u7684\u547d\u4ee4\u3002 </p> <p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u542f\u52a8sshd\uff0c\u6267\u884c\u7684\u547d\u4ee4\u662f/usr/sbin/sshd -D \\(OPTIONS\uff0c\u5176\u4e2d\u7684\u53d8\u91cf\\)OPTIONS\u5c31\u6765\u81eaEnvironmentFile\u5b57\u6bb5\u6307\u5b9a\u7684\u73af\u5883\u53c2\u6570\u6587\u4ef6\u3002 \u4e0e\u4e4b\u4f5c\u7528\u76f8\u4f3c\u7684\uff0c\u8fd8\u6709\u5982\u4e0b\u8fd9\u4e9b\u5b57\u6bb5\u3002 <pre><code>\u25cf ExecReload\u5b57\u6bb5\uff1a\u91cd\u542f\u670d\u52a1\u65f6\u6267\u884c\u7684\u547d\u4ee4\n\u25cf ExecStop\u5b57\u6bb5\uff1a\u505c\u6b62\u670d\u52a1\u65f6\u6267\u884c\u7684\u547d\u4ee4\n\u25cf ExecStartPre\u5b57\u6bb5\uff1a\u542f\u52a8\u670d\u52a1\u4e4b\u524d\u6267\u884c\u7684\u547d\u4ee4\n\u25cf ExecStartPost\u5b57\u6bb5\uff1a\u542f\u52a8\u670d\u52a1\u4e4b\u540e\u6267\u884c\u7684\u547d\u4ee4\n\u25cf ExecStopPost\u5b57\u6bb5\uff1a\u505c\u6b62\u670d\u52a1\u4e4b\u540e\u6267\u884c\u7684\u547d\u4ee4\n</code></pre></p> <p>\u8bf7\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\u3002 <pre><code>[Service]\nExecStart=/bin/echo execstart1\nExecStart=\nExecStart=/bin/echo execstart2\nExecStartPost=/bin/echo post1\nExecStartPost=/bin/echo post2\n</code></pre></p> <p>\u4e0a\u9762\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u7b2c\u4e8c\u884cExecStart\u8bbe\u4e3a\u7a7a\u503c\uff0c\u7b49\u4e8e\u53d6\u6d88\u4e86\u7b2c\u4e00\u884c\u7684\u8bbe\u7f6e\uff0c\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\u3002 <pre><code>execstart2\npost1\npost2\n</code></pre> \u6240\u6709\u7684\u542f\u52a8\u8bbe\u7f6e\u4e4b\u524d\uff0c\u90fd\u53ef\u4ee5\u52a0\u4e0a\u4e00\u4e2a\u8fde\u8bcd\u53f7\uff08-\uff09\uff0c\u8868\u793a\"\u6291\u5236\u9519\u8bef\"\uff0c\u5373\u53d1\u751f\u9519\u8bef\u7684\u65f6\u5019\uff0c\u4e0d\u5f71\u54cd\u5176\u4ed6\u547d\u4ee4\u7684\u6267\u884c\u3002</p> <p>\u6bd4\u5982\uff0cEnvironment<code>File=-/etc/sysconfig/sshd</code>\uff08\u6ce8\u610f\u7b49\u53f7\u540e\u9762\u7684\u90a3\u4e2a\u8fde\u8bcd\u53f7\uff09\uff0c\u5c31\u8868\u793a\u5373\u4f7f<code>/etc/sysconfig/sshd</code>\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u4e5f\u4e0d\u4f1a\u629b\u51fa\u9519\u8bef\u3002</p>"},{"location":"Linux/system/2.Systemd/#62-\u542f\u52a8\u7c7b\u578b","title":"6.2 \u542f\u52a8\u7c7b\u578b","text":"<p>Type\u5b57\u6bb5\u5b9a\u4e49\u542f\u52a8\u7c7b\u578b\u3002\u5b83\u53ef\u4ee5\u8bbe\u7f6e\u7684\u503c\u5982\u4e0b\u3002 <pre><code>\u25cf simple\uff08\u9ed8\u8ba4\u503c\uff09\uff1aExecStart\u5b57\u6bb5\u542f\u52a8\u7684\u8fdb\u7a0b\u4e3a\u4e3b\u8fdb\u7a0b\n\u25cf forking\uff1aExecStart\u5b57\u6bb5\u5c06\u4ee5fork()\u65b9\u5f0f\u542f\u52a8\uff0c\u6b64\u65f6\u7236\u8fdb\u7a0b\u5c06\u4f1a\u9000\u51fa\uff0c\u5b50\u8fdb\u7a0b\u5c06\u6210\u4e3a\u4e3b\u8fdb\u7a0b\n\u25cf oneshot\uff1a\u7c7b\u4f3c\u4e8esimple\uff0c\u4f46\u53ea\u6267\u884c\u4e00\u6b21\uff0cSystemd \u4f1a\u7b49\u5b83\u6267\u884c\u5b8c\uff0c\u624d\u542f\u52a8\u5176\u4ed6\u670d\u52a1\n\u25cf dbus\uff1a\u7c7b\u4f3c\u4e8esimple\uff0c\u4f46\u4f1a\u7b49\u5f85 D-Bus \u4fe1\u53f7\u540e\u542f\u52a8\n\u25cf notify\uff1a\u7c7b\u4f3c\u4e8esimple\uff0c\u542f\u52a8\u7ed3\u675f\u540e\u4f1a\u53d1\u51fa\u901a\u77e5\u4fe1\u53f7\uff0c\u7136\u540e Systemd \u518d\u542f\u52a8\u5176\u4ed6\u670d\u52a1\n\u25cf idle\uff1a\u7c7b\u4f3c\u4e8esimple\uff0c\u4f46\u662f\u8981\u7b49\u5230\u5176\u4ed6\u4efb\u52a1\u90fd\u6267\u884c\u5b8c\uff0c\u624d\u4f1a\u542f\u52a8\u8be5\u670d\u52a1\u3002\u4e00\u79cd\u4f7f\u7528\u573a\u5408\u662f\u4e3a\u8ba9\u8be5\u670d\u52a1\u7684\u8f93\u51fa\uff0c\u4e0d\u4e0e\u5176\u4ed6\u670d\u52a1\u7684\u8f93\u51fa\u76f8\u6df7\u5408\n</code></pre></p> <p>\u4e0b\u9762\u662f\u4e00\u4e2aoneshot\u7684\u4f8b\u5b50\uff0c\u7b14\u8bb0\u672c\u7535\u8111\u542f\u52a8\u65f6\uff0c\u8981\u628a\u89e6\u6478\u677f\u5173\u6389\uff0c\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u8fd9\u6837\u5199\u3002 <pre><code>[Unit]\nDescription=Switch-off Touchpad\n[Service]\nType=oneshot\nExecStart=/usr/bin/touchpad-off\n[Install]\nWantedBy=multi-user.target\n</code></pre> \u4e0a\u9762\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u542f\u52a8\u7c7b\u578b\u8bbe\u4e3aoneshot\uff0c\u5c31\u8868\u660e\u8fd9\u4e2a\u670d\u52a1\u53ea\u8981\u8fd0\u884c\u4e00\u6b21\u5c31\u591f\u4e86\uff0c\u4e0d\u9700\u8981\u957f\u671f\u8fd0\u884c\u3002 \u5982\u679c\u5173\u95ed\u4ee5\u540e\uff0c\u5c06\u6765\u67d0\u4e2a\u65f6\u5019\u8fd8\u60f3\u6253\u5f00\uff0c\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u5982\u4e0b\u3002</p> <p><pre><code>[Unit]\nDescription=Switch-off Touchpad\n[Service]\nType=oneshot\nExecStart=/usr/bin/touchpad-off start\nExecStop=/usr/bin/touchpad-off stop\nRemainAfterExit=yes\n[Install]\nWantedBy=multi-user.target\n</code></pre> \u4e0a\u9762\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0cRemainAfterExit\u5b57\u6bb5\u8bbe\u4e3ayes\uff0c\u8868\u793a\u8fdb\u7a0b\u9000\u51fa\u4ee5\u540e\uff0c\u670d\u52a1\u4ecd\u7136\u4fdd\u6301\u6267\u884c\u3002</p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u4e00\u65e6\u4f7f\u7528systemctl stop\u547d\u4ee4\u505c\u6b62\u670d\u52a1\uff0cExecStop\u6307\u5b9a\u7684\u547d\u4ee4\u5c31\u4f1a\u6267\u884c\uff0c\u4ece\u800c\u91cd\u65b0\u5f00\u542f\u89e6\u6478\u677f\u3002</p>"},{"location":"Linux/system/2.Systemd/#63-\u91cd\u542f\u884c\u4e3a","title":"6.3 \u91cd\u542f\u884c\u4e3a","text":"<p>Service\u533a\u5757\u6709\u4e00\u4e9b\u5b57\u6bb5\uff0c\u5b9a\u4e49\u4e86\u91cd\u542f\u884c\u4e3a\u3002</p> <p>KillMode\u5b57\u6bb5\uff1a\u5b9a\u4e49 Systemd \u5982\u4f55\u505c\u6b62 sshd \u670d\u52a1\u3002 </p> <p>\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5c06KillMode\u8bbe\u4e3aprocess\uff0c\u8868\u793a\u53ea\u505c\u6b62\u4e3b\u8fdb\u7a0b\uff0c\u4e0d\u505c\u6b62\u4efb\u4f55sshd \u5b50\u8fdb\u7a0b\uff0c\u5373\u5b50\u8fdb\u7a0b\u6253\u5f00\u7684 SSH session \u4ecd\u7136\u4fdd\u6301\u8fde\u63a5\u3002\u8fd9\u4e2a\u8bbe\u7f6e\u4e0d\u592a\u5e38\u89c1\uff0c\u4f46\u5bf9 sshd \u5f88\u91cd\u8981\uff0c\u5426\u5219\u4f60\u505c\u6b62\u670d\u52a1\u7684\u65f6\u5019\uff0c\u4f1a\u8fde\u81ea\u5df1\u6253\u5f00\u7684 SSH session \u4e00\u8d77\u6740\u6389\u3002</p> <p>KillMode\u5b57\u6bb5\u53ef\u4ee5\u8bbe\u7f6e\u7684\u503c\u5982\u4e0b\u3002 <pre><code>\u25cf control-group\uff08\u9ed8\u8ba4\u503c\uff09\uff1a\u5f53\u524d\u63a7\u5236\u7ec4\u91cc\u9762\u7684\u6240\u6709\u5b50\u8fdb\u7a0b\uff0c\u90fd\u4f1a\u88ab\u6740\u6389\n\u25cf process\uff1a\u53ea\u6740\u4e3b\u8fdb\u7a0b\n\u25cf mixed\uff1a\u4e3b\u8fdb\u7a0b\u5c06\u6536\u5230 SIGTERM \u4fe1\u53f7\uff0c\u5b50\u8fdb\u7a0b\u6536\u5230 SIGKILL \u4fe1\u53f7\n\u25cf none\uff1a\u6ca1\u6709\u8fdb\u7a0b\u4f1a\u88ab\u6740\u6389\uff0c\u53ea\u662f\u6267\u884c\u670d\u52a1\u7684 stop \u547d\u4ee4\u3002\n</code></pre> \u63a5\u4e0b\u6765\u662fRestart\u5b57\u6bb5\u3002</p> <p>Restart\u5b57\u6bb5\uff1a\u5b9a\u4e49\u4e86 sshd \u9000\u51fa\u540e\uff0cSystemd \u7684\u91cd\u542f\u65b9\u5f0f\u3002 \u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cRestart\u8bbe\u4e3aon-failure\uff0c\u8868\u793a\u4efb\u4f55\u610f\u5916\u7684\u5931\u8d25\uff0c\u5c31\u5c06\u91cd\u542fsshd\u3002\u5982\u679c sshd \u6b63\u5e38\u505c\u6b62\uff08\u6bd4\u5982\u6267\u884csystemctl stop\u547d\u4ee4\uff09\uff0c\u5b83\u5c31\u4e0d\u4f1a\u91cd\u542f\u3002 </p> <p>Restart\u5b57\u6bb5\u53ef\u4ee5\u8bbe\u7f6e\u7684\u503c\u5982\u4e0b\u3002 <pre><code>\u25cf no\uff08\u9ed8\u8ba4\u503c\uff09\uff1a\u9000\u51fa\u540e\u4e0d\u4f1a\u91cd\u542f\n\u25cf on-success\uff1a\u53ea\u6709\u6b63\u5e38\u9000\u51fa\u65f6\uff08\u9000\u51fa\u72b6\u6001\u7801\u4e3a0\uff09\uff0c\u624d\u4f1a\u91cd\u542f\n\u25cf on-failure\uff1a\u975e\u6b63\u5e38\u9000\u51fa\u65f6\uff08\u9000\u51fa\u72b6\u6001\u7801\u975e0\uff09\uff0c\u5305\u62ec\u88ab\u4fe1\u53f7\u7ec8\u6b62\u548c\u8d85\u65f6\uff0c\u624d\u4f1a\u91cd\u542f\n\u25cf on-abnormal\uff1a\u53ea\u6709\u88ab\u4fe1\u53f7\u7ec8\u6b62\u548c\u8d85\u65f6\uff0c\u624d\u4f1a\u91cd\u542f\n\u25cf on-abort\uff1a\u53ea\u6709\u5728\u6536\u5230\u6ca1\u6709\u6355\u6349\u5230\u7684\u4fe1\u53f7\u7ec8\u6b62\u65f6\uff0c\u624d\u4f1a\u91cd\u542f\n\u25cf on-watchdog\uff1a\u8d85\u65f6\u9000\u51fa\uff0c\u624d\u4f1a\u91cd\u542f\n\u25cf always\uff1a\u4e0d\u7ba1\u662f\u4ec0\u4e48\u9000\u51fa\u539f\u56e0\uff0c\u603b\u662f\u91cd\u542f\n</code></pre> \u5bf9\u4e8e\u5b88\u62a4\u8fdb\u7a0b\uff0c\u63a8\u8350\u8bbe\u4e3aon-failure\u3002\u5bf9\u4e8e\u90a3\u4e9b\u5141\u8bb8\u53d1\u751f\u9519\u8bef\u9000\u51fa\u7684\u670d\u52a1\uff0c\u53ef\u4ee5\u8bbe\u4e3aon-abnormal\u3002</p> <p>\u6700\u540e\u662fRestartSec\u5b57\u6bb5\u3002</p> <p>RestartSec\u5b57\u6bb5\uff1a\u8868\u793a Systemd \u91cd\u542f\u670d\u52a1\u4e4b\u524d\uff0c\u9700\u8981\u7b49\u5f85\u7684\u79d2\u6570\u3002\u4e0a\u9762\u7684\u4f8b\u5b50\u8bbe\u4e3a\u7b49\u5f8542\u79d2\u3002</p>"},{"location":"Linux/system/2.Systemd/#27-install-\u533a\u5757","title":"2.7 [Install] \u533a\u5757","text":"<p>Install\u533a\u5757\uff0c\u5b9a\u4e49\u5982\u4f55\u5b89\u88c5\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u5373\u600e\u6837\u505a\u5230\u5f00\u673a\u542f\u52a8\u3002</p> <p>WantedBy\u5b57\u6bb5\uff1a\u8868\u793a\u8be5\u670d\u52a1\u6240\u5728\u7684 Target\u3002</p> <p>Target\u7684\u542b\u4e49\u662f\u670d\u52a1\u7ec4\uff0c\u8868\u793a\u4e00\u7ec4\u670d\u52a1\u3002WantedBy=multi-user.target\u6307\u7684\u662f\uff0csshd \u6240\u5728\u7684 Target \u662fmulti-user.target\u3002 \u8fd9\u4e2a\u8bbe\u7f6e\u975e\u5e38\u91cd\u8981\uff0c\u56e0\u4e3a\u6267\u884csystemctl enable sshd.service\u547d\u4ee4\u65f6\uff0csshd.service\u7684\u4e00\u4e2a\u7b26\u53f7\u94fe\u63a5\uff0c\u5c31\u4f1a\u653e\u5728/etc/systemd/system\u76ee\u5f55\u4e0b\u9762\u7684multi-user.target.wants\u5b50\u76ee\u5f55\u4e4b\u4e2d\u3002</p> <p>Systemd \u6709\u9ed8\u8ba4\u7684\u542f\u52a8 Target\u3002 <pre><code>$ systemctl get-default\n</code></pre> multi-user.target \u4e0a\u9762\u7684\u7ed3\u679c\u8868\u793a\uff0c\u9ed8\u8ba4\u7684\u542f\u52a8 Target \u662fmulti-user.target\u3002\u5728\u8fd9\u4e2a\u7ec4\u91cc\u7684\u6240\u6709\u670d\u52a1\uff0c\u90fd\u5c06\u5f00\u673a\u542f\u52a8\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48systemctl enable\u547d\u4ee4\u80fd\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8\u7684\u539f\u56e0\u3002</p> <p>\u4f7f\u7528 Target \u7684\u65f6\u5019\uff0csystemctl list-dependencies\u547d\u4ee4\u548csystemctl isolate\u547d\u4ee4\u4e5f\u5f88\u6709\u7528\u3002 <pre><code># \u67e5\u770b multi-user.target \u5305\u542b\u7684\u6240\u6709\u670d\u52a1\n$ systemctl list-dependencies multi-user.target\n# \u5207\u6362\u5230\u53e6\u4e00\u4e2a target\n# shutdown.target \u5c31\u662f\u5173\u673a\u72b6\u6001\n$ sudo systemctl isolate shutdown.target\n</code></pre> \u4e00\u822c\u6765\u8bf4\uff0c\u5e38\u7528\u7684 Target \u6709\u4e24\u4e2a\uff1a\u4e00\u4e2a\u662fmulti-user.target\uff0c\u8868\u793a\u591a\u7528\u6237\u547d\u4ee4\u884c\u72b6\u6001\uff1b\u53e6\u4e00\u4e2a\u662fgraphical.target\uff0c\u8868\u793a\u56fe\u5f62\u7528\u6237\u72b6\u6001\uff0c\u5b83\u4f9d\u8d56\u4e8emulti-user.target\u3002</p> <p>\u5b98\u65b9\u6587\u6863\u6709\u4e00\u5f20\u975e\u5e38\u6e05\u6670\u7684 Target \u4f9d\u8d56\u5173\u7cfb\u56fe\u3002</p>"},{"location":"Linux/system/2.Systemd/#28-target-\u7684\u914d\u7f6e\u6587\u4ef6","title":"2.8 Target \u7684\u914d\u7f6e\u6587\u4ef6","text":"<p>Target \u4e5f\u6709\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\u3002 <pre><code>$ systemctl cat multi-user.target\n[Unit]\nDescription=Multi-User System\nDocumentation=man:systemd.special(7)\nRequires=basic.target\nConflicts=rescue.service rescue.target\nAfter=basic.target rescue.service rescue.target\nAllowIsolate=yes\n</code></pre></p> <p>\u6ce8\u610f\uff0cTarget \u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6ca1\u6709\u542f\u52a8\u547d\u4ee4\u3002</p> <p>\u4e0a\u9762\u8f93\u51fa\u7ed3\u679c\u4e2d\uff0c\u4e3b\u8981\u5b57\u6bb5\u542b\u4e49\u5982\u4e0b\u3002</p> <p>Requires\u5b57\u6bb5\uff1a\u8981\u6c42basic.target\u4e00\u8d77\u8fd0\u884c\u3002  Conflicts\u5b57\u6bb5\uff1a\u51b2\u7a81\u5b57\u6bb5\u3002\u5982\u679crescue.service\u6216rescue.target\u6b63\u5728\u8fd0\u884c\uff0cmulti-user.target\u5c31\u4e0d\u80fd\u8fd0\u884c\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002  After\uff1a\u8868\u793amulti-user.target\u5728basic.target \u3001 rescue.service\u3001 rescue.target\u4e4b\u540e\u542f\u52a8\uff0c\u5982\u679c\u5b83\u4eec\u6709\u542f\u52a8\u7684\u8bdd\u3002  AllowIsolate\uff1a\u5141\u8bb8\u4f7f\u7528systemctl isolate\u547d\u4ee4\u5207\u6362\u5230multi-user.target\u3002</p>"},{"location":"Linux/system/2.Systemd/#29-\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\u91cd\u542f","title":"2.9 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\u91cd\u542f","text":"<p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4ee5\u540e\uff0c\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u65b0\u542f\u52a8\u76f8\u5173\u670d\u52a1\u3002 <pre><code># \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\n$ sudo systemctl daemon-reload\n# \u91cd\u542f\u76f8\u5173\u670d\u52a1\n$ sudo systemctl restart foobar\n</code></pre></p>"},{"location":"Linux/system/2.Systemd/#3systemd\u793a\u4f8b","title":"3.Systemd\u793a\u4f8b","text":""},{"location":"Linux/system/2.Systemd/#31-supervisord","title":"3.1 supervisord","text":"<pre><code>$  vim /usr/lib/systemd/system/supervisord.service\n[Unit]\nDescription=Process Monitoring and Control Daemon\nAfter=rc-local.service nss-user-lookup.target\n\n[Service]\nType=forking\nExecStart=/usr/bin/supervisord -c /etc/supervisord.conf\nExecReload=/usr/bin/supervisorctl reload\nExecStop=/usr/bin/supervisorctl shutdown\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <pre><code># \u8bbe\u7f6e754\u6743\u9650\nchmod 754 /usr/lib/systemd/system/supervisord.service\nsystemctl daemon-reload\n</code></pre>"},{"location":"Linux/system/2.Systemd/#32-banjo","title":"3.2 banjo","text":"<pre><code>$ cat banjo.service\n[Unit]\nDescription=banjo - banjo rserver\nAfter=network.target remote-fs.target nss-lookup.target\n\n[Service]\nType=forking\nExecStart=/app/oscbin/banjo/bin/banjo -D\nExecStop=/app/oscbin/banjo/bin/banjo -s stop\nExecReload=/app/oscbin/banjo/bin/banjo -s restart\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n\n# \u8bbe\u7f6e\u6743\u9650\n$ chmod 644 /usr/lib/systemd/system/banjo.service\n$ systemctl daemon-reload\n</code></pre>"},{"location":"Linux/system/2.Systemd/#33-nginx_exporter","title":"3.3 nginx_exporter","text":"<pre><code>#\u521b\u5efanginx_exporter\u76ee\u5f55\uff0c\u79fb\u52a8\u6587\u4ef6\n$ mkdir -p /etc/nginx_exporter/bin/\n$ mv /opt/nginx_exporter /etc/nginx_exporter/bin/\n\n#\u5c01\u88c5service\n$ vim /lib/systemd/system/nginx_exporter.service\n[Unit]\nDescription=nginx monitor\nAfter=network.target\n\n[Service]\nExecStart=/etc/nginx_exporter/bin/nginx_exporter -nginx.scrape_uri=\"http://127.0.0.1:8011/nginx_status\"\nExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5\nTimeoutStopSec=5\nKillMode=mixed\n\n[Install]\nWantedBy=multi-user.target\n\n# \u91cd\u65b0\u52a0\u8f7dservice\u914d\u7f6e\u6587\u4ef6\uff0c\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8\uff0c\u5e76\u542f\u52a8\u670d\u52a1\n$ systemctl daemon-reload\n$ systemctl enable nginx_exporter.service\n$ systemctl start nginx_exporter.service\n\n# \u67e5\u770b\u7aef\u53e3\n$ netstat -anpt|grep nginx_exporte\ntcp        0      0 127.0.0.1:33780         127.0.0.1:8011          ESTABLISHED 19006/nginx_exporte\ntcp6       0      0 :::9113                 :::*                    LISTEN      19006/nginx_exporte\ntcp6       0      0 192.168.1.24:9113       172.17.0.2:50776        ESTABLISHED 19006/nginx_e\n</code></pre>"},{"location":"Linux/system/2.Systemd/#34-java_xxsh","title":"3.4 java_xx.sh","text":"<p>\u521b\u5efa\u811a\u672c</p> <p>\u5728/usr/bin\u76ee\u5f55\u4e0b\u521b\u5efa\u811a\u672c\uff0c\u6bd4\u5982\u6211\u7684\u811a\u672c\u540d\u4e3a<code>/usr/bin/ruoyi-gen.sh</code>\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>#!/bin/bash\njava -jar /root/xf-service/ruoyi-modules-gen-2.3.0.jar &gt; /root/xf-service/ilogs/modules-gen-`date \"+%Y-%m-%d\"`.log 2&gt;&amp;1 &amp;\n\u7136\u540e\u4e3a\u811a\u672c\u8bbe\u7f6e\u6267\u884c\u6743\u9650 chmod +x /usr/bin/ruoyi-gen.sh\n\n# \u6dfb\u52a0\u670d\u52a1\n\u7f16\u8f91 /etc/systemd/system/ruoyi-gen.service \u6587\u4ef6\u540d\u6700\u540e\u8ddf\u4f60\u7684\u670d\u52a1\u76f8\u5173\uff0c\u6bd4\u5982\u6211\u7684\u53eb ruoyi-gen\u3002\u5185\u5bb9\u5927\u4f53\u5982\u4e0b\uff1a\n\n[Unit]\nDescription=ruoyi-gen\nAfter=network.target ali-nacos.target ali-sentinel.target ruoyi-gateway.target ruoyi-auth.target\n\n[Service]\nType=forking\nExecStart=/usr/bin/ruoyi-gen.sh\n\n[Install]\nWantedBy=multi-user.target\n</code></pre></p> <p>\u7136\u540e\u91cd\u8f7d\u7cfb\u7edf\u670d\u52a1\u6587\u4ef6 </p> <pre><code>$ systemctl daemon-reload\n</code></pre> <p>\u670d\u52a1\u7ba1\u7406 <pre><code># \u542f\u52a8\n$ sudo systemctl start ruoyi-gen\n\n# \u67e5\u770b\u72b6\u6001\n$ sudo systemctl status ruoyi-gen\n\n# \u505c\u6b62\u670d\u52a1\n$ sudo systemctl stop ruoyi-gen\n\n# \u91cd\u542f\u670d\u52a1\n$ sudo systemctl restart ruoyi-gen\n\n#\u5f00\u673a\u81ea\u542f\n$ sudo systemctl enable ruoyi-gen\n</code></pre></p>"},{"location":"Linux/system/2.Systemd/#4systemd\u81ea\u52a8\u751f\u6210\u5de5\u5177","title":"4.Systemd\u81ea\u52a8\u751f\u6210\u5de5\u5177","text":"<p>https://www.mogublog.net/app/systemd</p> <p>\u53c2\u8003\u6587\u732e</p> <p>CentOS7\u4e3b\u673a\u4f7f\u7528systemd\u7ba1\u7406\u5e94\u7528</p> <p>https://blog.csdn.net/yuesichiu/article/details/51485147</p> <p>https://www.cnblogs.com/occl/p/12942171.html</p> <p>https://blog.csdn.net/yuanfangPOET/article/details/89410312</p>"},{"location":"Linux/system/3.Superivisor/","title":"Superivisor","text":"<p>\u8fdb\u7a0b\u7ba1\u7406\u5229\u5668</p> <p>supervisor\u662f\u7528Python\u8bed\u8a00\u7f16\u5199\u7684\u57fa\u4e8eLinux\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u6b3e\u8fdb\u7a0b\u7ba1\u7406\u5de5\u5177\uff0c\u7528\u4e8e\u76d1\u63a7\u8fdb\u7a0b\u7684\u8fd0\u884c\uff0c\u5f53\u53d1\u73b0\u8fdb\u7a0b\u95ea\u9000\u65f6\u80fd\u81ea\u52a8\u91cd\u542f\u3002</p> <p>\u6bd4\u5982\u5f00\u53d1\u4eba\u5458\u60f3\u5728\u540e\u53f0\u8fd0\u884c\u4e00\u4e2a\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u53d6\u51fa\u6d88\u606f\u518d\u53d1\u9001\u5230\u90ae\u4ef6\u7684\u811a\u672csendmail.sh\uff0c\u5e38\u5e38\u4f1a\u4f7f\u7528&amp;\u5728\u7a0b\u5e8f\u7ed3\u5c3e\u8ba9\u7a0b\u5e8f\u81ea\u52a8\u8fd0\u884c\uff0c\u5e76\u4e14\u5728\u9000\u51fa\u767b\u5f55\u540e\u4e5f\u7ee7\u7eed\u6267\u884c\uff0c\u91c7\u7528\u5982\u4e0b\u7684\u547d\u4ee4\u3002</p> <pre><code>nohupsh /data/sendmail.sh 2&gt;&amp;1 &gt;&gt; /data/logs/sendmail.log &amp;\n</code></pre> <p>\u5f53\u8981\u628a\u8fd0\u884csh\u811a\u672c\u7684\u8fdb\u7a0bkill\u6389\uff0c\u5219\u9700\u8981\u901a\u8fc7\u4e0b\u9762\u4e24\u6b65: <pre><code>[root@k8s-master ~]# ps aux |grep *.sh |grep -v grep\nroot     3263335  0.0  0.0 113184   824 pts/0    S    12:01   0:00 /bin/sh sendmail.sh\n[root@k8s-master ~]# kill -9 3263335\n</code></pre></p> <p>\u4e0a\u9762\u7ba1\u7406\u8fdb\u7a0b\u7684\u65b9\u6cd5\u6709\u5982\u4e0b\u7684\u7f3a\u70b9\u3002</p> <ul> <li>\u4e0d\u77e5\u9053\u8fdb\u7a0b\u7684\u72b6\u6001\uff0c\u4e0d\u77e5\u9053\u8fdb\u7a0b\u5728\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\u662f\u5426\u7ec8\u6b62\u3002 </li> <li>\u6bcf\u6b21\u91cd\u542f\u8fdb\u7a0b\uff0ckill\u8fdb\u7a0b\u90fd\u9700\u8981\u70e6\u7410\u7684\u6b65\u9aa4\u3002 </li> <li>\u5982\u679c\u9700\u8981\u8fd0\u884c\u5927\u91cf\u7684\u5b88\u62a4\u8fdb\u7a0b\uff0c\u7528\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u65b9\u4fbf\u7ba1\u7406\u3002</li> </ul> <p>\u4f7f\u7528supervisor\u7ba1\u7406\u8fdb\u7a0b\u6709\u5982\u4e0b\u7684\u4f18\u70b9\u3002</p> <ul> <li>\u80fd\u81ea\u52a8\u542f\u52a8\u914d\u7f6e\u597d\u7684\u8fdb\u7a0b\uff0c\u5e76\u76d1\u63a7\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u72b6\u6001\uff0c\u4f8b\u5982\u8fdb\u7a0b\u662f\u8fd0\u884c\u7740\u8fd8\u662f\u505c\u6b62\u7684\u3002 </li> <li>\u76d1\u63a7\u7684\u8fdb\u7a0b\u5982\u679c\u56e0\u4e3a\u5404\u79cd\u539f\u56e0\u95ea\u9000\uff0c\u80fd\u81ea\u52a8\u91cd\u542f\u6539\u8fdb\u7a0b\u3002</li> </ul>"},{"location":"Linux/system/3.Superivisor/#1supervisor\u5b89\u88c5","title":"1.Supervisor\u5b89\u88c5","text":"<p>\u5b89\u88c5supervisor\u5f88\u7b80\u5355 <pre><code>pip install supervisor\n\n# \u6216\u8005\nyum -y install supervisor\n\n# \u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6\uff1a\necho_supervisord_conf &gt; supervisor.conf\n</code></pre></p> <p>supervisor\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5728<code>/usr/bin/</code>\u76ee\u5f55\u4e0b\u589e\u52a0\u4e86\u4e24\u4e2a\u547d\u4ee4\uff1a</p> <ul> <li>supervisord : supervisor\u7684\u670d\u52a1\u5668\u7aef\uff0c\u542f\u52a8supervisor\u5c31\u662f\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4\u3002 </li> <li>supervisorctl\uff1a\u901a\u8fc7\u8be5\u547d\u4ee4\u548csupervisord\u8fdb\u884c\u4ea4\u6362\u3002</li> </ul> <p>\u542f\u52a8supervisor\uff0c\u5148\u4e3a\u5176\u521b\u5efa\u914d\u7f6e\u6587\u4ef6<code>/etc/supervisord.conf</code>\uff0c\u5185\u5bb9\u5982\u4e0b\u3002</p> <pre><code>[unix_http_server]\nfile=/var/run/supervisor/supervisor.sock   ; (the path to the socket file)\n;chmod=0700                 ; sockef file mode (default 0700)\n;chown=nobody:nogroup       ; socket file uid:gid owner\n;username=user              ; (default is no username (open server))\n;password=123               ; (default is no password (open server))\n\n;[inet_http_server]         ; inet (TCP) server disabled by default\n;port=127.0.0.1:9001        ; (ip_address:port specifier, *:port for all iface)\n;username=user              ; (default is no username (open server))\n;password=123               ; (default is no password (open server))\n\n[supervisord]\nlogfile=/var/log/supervisor/supervisord.log  ; (main log file;default $CWD/supervisord.log)\nlogfile_maxbytes=50MB       ; (max main logfile bytes b4 rotation;default 50MB)\nlogfile_backups=10          ; (num of main logfile rotation backups;default 10)\nloglevel=info               ; (log level;default info; others: debug,warn,trace)\npidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)\nnodaemon=false              ; (start in foreground if true;default false)\nminfds=1024                 ; (min. avail startup file descriptors;default 1024)\nminprocs=200                ; (min. avail process descriptors;default 200)\n;umask=022                  ; (process file creation umask;default 022)\n;user=chrism                 ; (default is current user, required if root)\n;identifier=supervisor       ; (supervisord identifier, default is 'supervisor')\n;directory=/tmp              ; (default is not to cd during start)\n;nocleanup=true              ; (don't clean up tempfiles at start;default false)\n;childlogdir=/tmp            ; ('AUTO' child log dir, default $TEMP)\n;environment=KEY=value       ; (key value pairs to add to environment)\n;strip_ansi=false            ; (strip ansi escape codes in logs; def. false)\n\n[rpcinterface:supervisor]\nsupervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface\n\n[supervisorctl]\nserverurl=unix:///var/run/supervisor/supervisor.sock ; use a unix:// URL  for a unix socket\n\n[include]\nfiles = /etc/supervisord.conf.d/*.conf\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u6587\u4ef6\u4e2d\uff0c\u4e3a\u4e86\u66f4\u597d\u5730\u7ba1\u7406\u8fdb\u7a0b\u76d1\u63a7\u811a\u672c\uff0c\u628a\u8fdb\u7a0b\u76d1\u63a7\u811a\u672c\u653e\u5728<code>/etc/supervisord.conf.d/</code>\u3002</p>"},{"location":"Linux/system/3.Superivisor/#2\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e","title":"2.\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e","text":"<p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u6700\u5e95\u90e8\u6dfb\u52a0\u76f8\u5e94\u914d\u7f6e\uff0cgunicorn\u7a0b\u5e8f\u542f\u52a8\u7684\u793a\u4f8b\uff1a</p> <pre><code>[include]\n[program:project]\ndirectory = /home/jerry/Code/project       ; \u7a0b\u5e8f\u7684\u542f\u52a8\u76ee\u5f55\ncommand = /home/jerry/.virtualenvs/parsing/bin/gunicorn -w 4 -worker-class gevent -bind 0.0.0.0:9600 app:app  ; \u542f\u52a8\u547d\u4ee4\n\nnumprocs=1           ; number of processes copies to start (def 1)\nautostart = true     ; \u5728 supervisord \u542f\u52a8\u7684\u65f6\u5019\u4e5f\u81ea\u52a8\u542f\u52a8\nstartsecs = 1        ; \u542f\u52a8 1 \u79d2\u540e\u6ca1\u6709\u5f02\u5e38\u9000\u51fa\uff0c\u5c31\u5f53\u4f5c\u5df2\u7ecf\u6b63\u5e38\u542f\u52a8\u4e86\nautorestart = true   ; \u7a0b\u5e8f\u5f02\u5e38\u9000\u51fa\u540e\u81ea\u52a8\u91cd\u542f\nstartretries = 3     ; \u542f\u52a8\u5931\u8d25\u81ea\u52a8\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba4\u662f 3\nuser = root          ; \u7528\u54ea\u4e2a\u7528\u6237\u542f\u52a8\nredirect_stderr = true          ; \u628a stderr \u91cd\u5b9a\u5411\u5230 stdout\uff0c\u9ed8\u8ba4 false\nstdout_logfile_maxbytes = 20MB  ; stdout \u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\uff0c\u9ed8\u8ba4 50MB\nstdout_logfile_backups = 10     ; stdout \u65e5\u5fd7\u6587\u4ef6\u5907\u4efd\u6570\nstdout_logfile=/home/jerry/Code/project/log/gunicorn.log       ; log \u65e5\u5fd7\nstderr_logfile=/home/jerry/Code/project/log/gunicorn.error     ; \u9519\u8bef\u65e5\u5fd7\n</code></pre> <p>\u7f16\u8f91\u5b8c\u4e4b\u540e\u4fdd\u5b58\uff0c\u542f\u52a8 supervisor\u3002\u8fd9\u91cc\u7684\u542f\u52a8\u547d\u4ee4\u548c\u5728\u547d\u4ee4\u884c\u7528 gunicorn \u542f\u52a8\u7684\u547d\u4ee4\u662f\u4e00\u81f4\u7684\uff0c\u5176\u4e2d -w \u662f\u6307\u670d\u52a1\u7684\u8fdb\u7a0b\u6570\u3002</p> <p>\u4f8b\u5982\uff0c\u4e3a\u76d1\u63a7\u8fd0\u884c\u811a\u672c/data/sendmail.sh\uff0c\u521b\u5efa\u6587\u4ef6/etc/supervisord.conf.d/mail.conf\uff0c\u5185\u5bb9\u5982\u4e0b</p> <pre><code>[program:mail]                        ; \u5728supervisor \u76d1\u63a7\u5217\u8868\u4e2d\u7684\u6807\u8bc6\ndirectory = /data                     ; \u542f\u52a8\u547d\u4ee4\u65f6\u8fdb\u5165\u7684\u76ee\u5f55\uff0c\u5982\u679ccommand \u4e2d\u7684\u547d\u4ee4\u6ca1\u6709\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\uff0c\u8fd9\u9879\u4e00\u5b9a\u8981\u8bbe\u7f6e\ncommand = /bin/sh /data/sendmail.sh   ; \u542f\u52a8\u7684\u547d\u4ee4\nautostart = true                      ; \u968f\u7740supervisor \u542f\u52a8\u800c\u542f\u52a8\u3002\nautoRESTart = true                    ; \u81ea\u52a8\u91cd\u542f\u3002\nstartretries = 10                     ; \u542f\u52a8\u5931\u8d25\u65f6\u7684\u6700\u591a\u91cd\u8bd5\u6b21\u6570\nstartsecs = 5                         ; supervisor \u542f\u52a85 \u79d2\u540e\u542f\u52a8\nuser = root                           ; \u4ee5root \u7528\u6237\u7684\u8eab\u4efd\u8fd0\u884c\nredirect_stderr = true                ; \u91cd\u5b9a\u5411stderr \u5230stdout\nnumprocs=1                            ; \u542f\u52a81\u4e2a\u8fdb\u7a0b\nstdout_logfile = /data/logs/mail.log  ; \u8f93\u51fa\u65e5\u5fd7\u7684\u4f4d\u7f6e\n</code></pre> <p><code>mkdir -p /data/logs/</code>\u76ee\u5f55</p>"},{"location":"Linux/system/3.Superivisor/#3supervisor\u7684\u542f\u52a8","title":"3.Supervisor\u7684\u542f\u52a8","text":"<pre><code>supervisord -c /etc/supervisord.conf\n\n#\u67e5\u770b supervisor \u7684\u72b6\u6001\nsupervisorctl -c supervisor.conf status\n\n#\u91cd\u65b0\u8f7d\u5165\u914d\u7f6e\u6587\u4ef6,\u6bcf\u6b21\u4fee\u6539\u4e4b\u540e\u8bb0\u5f97\u91cd\u65b0\u8f7d\u5165\nsupervisorctl -c supervisor.conf reload\n\n#\u542f\u52a8\u6307\u5b9a/\u6240\u6709 supervisor \u7ba1\u7406\u7684\u7a0b\u5e8f\u8fdb\u7a0b\nsupervisorctl -c supervisor.conf start [all]|[appname]\n#\u5173\u95ed\u6307\u5b9a/\u6240\u6709 supervisor\u7ba1\u7406\u7684\u7a0b\u5e8f\u8fdb\u7a0b\nsupervisorctl -c supervisor.conf stop [all]|[appname]\n</code></pre> <p>\u8fd0\u884csupervisord\u670d\u52a1\u7aef\u7a0b\u5e8f <pre><code>/usr/bin/python /usr/bin/supervisord -c /etc/supervisord.conf\n</code></pre></p> <p>\u4f7f\u7528supervisorctl\u67e5\u770bsupervisor\u7ba1\u7406\u8fdb\u7a0b\u7684\u72b6\u6001\u3002 <pre><code>[root@k8s-master data]# supervisorctl status\nmail                             RUNNING   pid 3360232, uptime 0:02:24\n</code></pre></p> <p>\u6d4b\u8bd5\u81ea\u52a8\u91cd\u542f <pre><code>[root@k8s-master data]# ps aux|grep *.sh|grep -v grep|awk '{print $2}'|xargs kill -9\n[root@k8s-master data]# ps aux|grep *.sh\nroot     3370736  0.2  0.0 113184   528 ?        S    12:32   0:00 /bin/sh /data/sendmail.sh\nroot     3370771  0.0  0.0    440     4 pts/0    S+   12:32   0:00 grep --color=auto sendmail.sh\n</code></pre></p> <p>\u505c\u6b62\u540d\u4e3a\"mail\"\u7684\u8fdb\u7a0b\u3002</p> <p><pre><code>[root@k8s-master data]# supervisorctl stop mail\nmail: stopped\n\n[root@k8s-master data]# ps aux|grep *.sh\nroot     3380991  0.0  0.0    436     4 pts/0    R+   12:35   0:00 grep --color=auto sendmail.sh\n</code></pre> supervisor\u8fd8\u5305\u542b\u4e86\u5f88\u591a\u5b9e\u7528\u7684\u547d\u4ee4\uff0c\u53ef\u901a\u8fc7\u5e2e\u52a9\u67e5\u770b\u8fd9\u4e9b\u547d\u4ee4</p> <pre><code>[root@k8s-master data]# supervisorctl help\ndefault commands (type help &lt;topic&gt;):\n=====================================\nadd    clear  fg        open  quit    remove  restart   start   stop  update\navail  exit   maintail  pid   reload  reread  shutdown  status  tail  version\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>\u4f7f\u7528supervisor\u7ba1\u7406tomcat\uff0cnginx\u7b49\u8fdb\u7a0b\u8be6\u89e3</p>"},{"location":"Linux/system/3.Superivisor/#4supervisor\u7ba1\u7406\u591a\u4e2aredis\u5b9e\u4f8b","title":"4.Supervisor\u7ba1\u7406\u591a\u4e2aredis\u5b9e\u4f8b","text":"<pre><code>[program:redis_6376]\ncommand=/usr/local/bin/redis-server /etc/redis_6376.conf\nstdout_logfile=/var/log/supervisor/%(program_name)s.log\nstderr_logfile=/var/log/supervisor/%(program_name)s.log\nprocess_name=%(program_name)s\nnumprocs=l\ndirectory=/tmp\numask=022\npriority=999\nautostart=true\nautorestart=true\n\n[program:redis_6377]\ncommand=/usr/local/bin/redis-server /etc/redis_6377.conf\nstdout_logfile=/var/log/supervisor/%(program_name)s.log\nstderr_logfile=/var/log/supervisor/%(program_name)s.log\nprocess_name=%(program_name)s\nnumprocs=l\ndirectory=/tmp\numask=022\npriority=999\nautostart=true\nautorestart=true\n\n[program:redis_6378]\ncommand=/usr/local/bin/redis-server /etc/redis_6378.conf\nstdout_logfile=/var/log/supervisor/%(program_name)s.log\nstderr_logfile=/var/log/supervisor/%(program_name)s.log\nprocess_name=%(program_name)s\nnumprocs=l\ndirectory=/tmp\numask=022\npriority=999\nautostart=true\nautorestart=true\n\n[program:redis_6379]\ncommand=/usr/local/bin/redis-server /etc/redis_6379.conf\nstdout_logfile=/var/log/supervisor/%(program_name)s.log\nstderr_logfile=/var/log/supervisor/%(program_name)s.log\nprocess_name=%(program_name)s\nnumprocs=l\ndirectory=/tmp\numask=022\npriority=999\nautostart=true\nautorestart=true\n</code></pre>"},{"location":"Linux/system/3.Superivisor/#5-supervisord\u7ba1\u7406go","title":"5. Supervisord\u7ba1\u7406go","text":"<p>\u53c2\u8003\u6587\u732e\u5982\u4e0b<p>\u4f7f\u7528Supervisord\u8f6f\u4ef6\u7ba1\u7406go\u670d\u52a1\u8fdb\u7a0b</p> </p>"},{"location":"Linux/system/3.Superivisor/#6supervisor\u5728docker\u4e2d\u7684\u5e94\u7528","title":"6.Supervisor\u5728Docker\u4e2d\u7684\u5e94\u7528","text":""},{"location":"Linux/system/3.Superivisor/#61-\u5728docker\u4e2d\u4f7f\u7528supervisor","title":"6.1 \u5728Docker\u4e2d\u4f7f\u7528Supervisor","text":"<ul> <li>\u76d1\u63a7 apache2\u548cmysql</li> </ul> <p><code>cat /etc/supervisor/supervisord.conf</code></p> <pre><code>; supervisor config file\n\n[unix_http_server]\nfile=/var/run/supervisor.sock   ; (the path to the socket file)\nchmod=0700                       ; sockef file mode (default 0700)\n\n[supervisord]\nlogfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)\npidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)\nchildlogdir=/var/log/supervisor            ; ('AUTO' child log dir, default $TEMP)\n\n[rpcinterface:supervisor]\nsupervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface\n\n[supervisorctl]\nserverurl=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket\n\n[include]\nfiles = /etc/supervisor/conf.d/*.conf\n</code></pre> <pre><code>$ ls /etc/supervisor/conf.d/\nsupervisord-apache2.conf  supervisord-mysqld.conf\n\nroot@98643c960e69:/etc/supervisor/conf.d# cat supervisord-apache2.conf\n[program:apache2]\ncommand=/start-apache2.sh\nnumprocs=1\nautostart=true\nroot@98643c960e69:/etc/supervisor/conf.d# cat supervisord-mysqld.conf\n[program:mysqld]\ncommand=/start-mysqld.sh\nnumprocs=1\nautostart=true\nautorestart=trueroot@98643c960e69:/etc/supervisor/conf.d# cat /start-apache2.sh\n#!/bin/bash\nsource /etc/apache2/envvars\nexec apache2 -D FOREGROUND\n\nroot@98643c960e69:/etc/supervisor/conf.d# cat /start-mysqld.sh\n#!/bin/bash\nexec mysqld_safe\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>Supervisor\u9879\u76ee\u90e8\u7f72</p>"},{"location":"Linux/system/3.Superivisor/#7-go\u91cd\u5199\u4e86supervisor","title":"7 Go\u91cd\u5199\u4e86Supervisor","text":"<p>\u4ed3\u5e93\u5730\u5740</p> <p>https://github.com/ochinchina/supervisord</p>"},{"location":"Linux/system/4.Linux%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8SSH%E7%99%BB%E5%BD%95%E4%B9%8B%E5%89%8D%E6%98%BE%E7%A4%BA%E6%A8%AA%E5%B9%85/","title":"Linux\u7cfb\u7edf\u4f7f\u7528SSH\u767b\u5f55\u4e4b\u524d\u663e\u793a\u6a2a\u5e45","text":"<p>https://www.yuque.com/fcant/linux/uiup78</p>"},{"location":"Linux/system/5.Linux%E4%B8%AD%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5/","title":"Linux\u4e2d\u7aef\u53e3\u5360\u7528\u6392\u67e5","text":"<p>https://www.yuque.com/fcant/linux/uxz930</p>"},{"location":"Linux/system/6.%E4%BD%BF%E7%94%A8curl%E5%8F%91%E9%80%81REST-API%E8%AF%B7%E6%B1%82/","title":"\u4f7f\u7528curl\u53d1\u9001REST API\u8bf7\u6c42","text":"<p>\u4f7f\u7528curl\u53d1\u9001REST API\u8bf7\u6c42</p>"},{"location":"Linux/system/7.%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE%E5%99%A8fzf/","title":"\u547d\u4ee4\u884c\u6a21\u7cca\u67e5\u627e\u5668fzf","text":"<p>Using git</p> <pre><code>git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf &amp;&amp; \\\n~/.fzf/install\n</code></pre> <p>\u7ec8\u7aef\u547d\u4ee4\u5de5\u5177\u6536\u96c6fd fzf</p> <p>\u6bcf\u5929\u5b66\u4e60\u4e00\u4e2a\u547d\u4ee4\uff1afzf \u4f7f\u7528\u7b14\u8bb0</p> <p>github</p>"},{"location":"Linux/system/8.centos7.9%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9/","title":"8.centos7.9\u7cfb\u7edf\u76d8\u6269\u5bb9","text":"<p># 8.centos7.9\u7cfb\u7edf\u6269\u5bb9</p> <p>\u6269\u5927\u5df2\u6709MBR\u5206\u533a </p> <p>\u4ee5\u201cCentOS 7.9 64bit\u201d\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u4f8b(\u4e91\u670d\u52a1\u5668\u9009\u62e9\u6269\u5bb9\u7cfb\u7edf\u76d8\u8d2d\u4e70\u9002\u91cf\u7a7a\u95f4)\uff0c\u7cfb\u7edf\u76d8\u201c/dev/sda\u201d\u539f\u6709\u5bb9\u91cf40GB\uff0c\u53ea\u6709\u4e00\u4e2a\u5206\u533a\u201c/dev/sda1\u201d\u3002\u5c06\u7cfb\u7edf\u76d8\u5bb9\u91cf\u6269\u5927\u81f3100GB\uff0c\u672c\u793a\u4f8b\u5c06\u65b0\u589e\u768460GB\u5212\u5206\u81f3\u5df2\u6709\u7684MBR\u5206\u533a\u5185\u201c/dev/sda1\u201d\u5185\u3002</p> <p>\u6267\u884c\u547d\u4ee4growpart\uff0c\u68c0\u67e5\u5f53\u524d\u7cfb\u7edf\u662f\u5426\u5df2\u5b89\u88c5growpart\u6269\u5bb9\u5de5\u5177\u3002 \u82e5\u56de\u663e\u4e3a\u5de5\u5177\u4f7f\u7528\u4ecb\u7ecd\uff0c\u5219\u8868\u793a\u5df2\u5b89\u88c5\uff0c\u65e0\u9700\u91cd\u590d\u5b89\u88c5\uff0c\u53ef\u8df3\u8fc7\u6b65\u9aa42\u3002</p> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5b89\u88c5growpart\u6269\u5bb9\u5de5\u5177\u3002</p> <p><code>yum install cloud-utils-growpart</code></p> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u67e5\u770b\u7cfb\u7edf\u76d8\u201c/dev/sda\u201d\u7684\u603b\u5bb9\u91cf\u3002</p> <p><code>fdisk -l</code></p> <pre><code>\u56de\u663e\u7c7b\u4f3c\u5982\u4e0b\u4fe1\u606f\uff1a\n[root@ecs-test-0001 ~]# fdisk -l\n\nDisk /dev/sda: 107.4 GB, 107374182400 bytes, 209715200 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x000bcb4e\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sda1   *        2048    83886079    41942016   83  Linux\n</code></pre> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u67e5\u770b\u7cfb\u7edf\u76d8\u5206\u533a\u201c/dev/sda1\u201d\u7684\u5bb9\u91cf\u3002 <code>df -TH</code></p> <pre><code>\u56de\u663e\u7c7b\u4f3c\u5982\u4e0b\u4fe1\u606f\uff1a\n[root@ecs-test-0001 ~]# df -TH\nFilesystem     Type      Size  Used Avail Use% Mounted on\n/dev/sda1      ext4       43G  2.0G   39G   5% /\ndevtmpfs       devtmpfs  2.0G     0  2.0G   0% /dev\ntmpfs          tmpfs     2.0G     0  2.0G   0% /dev/shm\ntmpfs          tmpfs     2.0G  9.0M  2.0G   1% /run\ntmpfs          tmpfs     2.0G     0  2.0G   0% /sys/fs/cgroup\ntmpfs          tmpfs     398M     0  398M   0% /run/user/0\n</code></pre> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6307\u5b9a\u7cfb\u7edf\u76d8\u5f85\u6269\u5bb9\u7684\u5206\u533a\uff0c\u901a\u8fc7growpart\u8fdb\u884c\u6269\u5bb9\u3002 growpart \u7cfb\u7edf\u76d8 \u5206\u533a\u7f16\u53f7</p> <p>\u547d\u4ee4\u793a\u4f8b\uff1a</p> <p><code>growpart /dev/sda 1</code></p> <pre><code>\u56de\u663e\u7c7b\u4f3c\u5982\u4e0b\u4fe1\u606f\uff1a\n[root@ecs-test-0001 ~]# growpart /dev/sda 1\nCHANGED: partition=1 start=2048 old: size=83884032 end=83886080 new: size=209713119,end=209715167\n</code></pre> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6269\u5c55\u78c1\u76d8\u5206\u533a\u6587\u4ef6\u7cfb\u7edf\u7684\u5927\u5c0f\u3002 resize2fs \u78c1\u76d8\u5206\u533a</p> <p>\u547d\u4ee4\u793a\u4f8b\uff1a</p> <p><code>resize2fs /dev/sda1</code></p> <pre><code>\u56de\u663e\u7c7b\u4f3c\u5982\u4e0b\u4fe1\u606f\uff1a\n[root@ecs-test-0001 ~]# resize2fs /dev/sda1\nresize2fs 1.42.9 (28-Dec-2013)\nFilesystem at /dev/sda1 is mounted on /; on-line resizing required\nold_desc_blocks = 5, new_desc_blocks = 13\nThe filesystem on /dev/sda1 is now 26214139 blocks long.\n</code></pre> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u67e5\u770b\u6269\u5bb9\u540e\u7cfb\u7edf\u76d8\u5206\u533a\u201c/dev/sda1\u201d\u7684\u5bb9\u91cf\u3002 <code>df -TH</code></p> <pre><code>\u56de\u663e\u7c7b\u4f3c\u5982\u4e0b\u4fe1\u606f\uff1a\n[root@ecs-test-0001 ~]# df -TH\nFilesystem     Type      Size  Used Avail Use% Mounted on\n/dev/sda1      ext4      106G  2.0G   99G   2% /\ndevtmpfs       devtmpfs  2.0G     0  2.0G   0% /dev\ntmpfs          tmpfs     2.0G     0  2.0G   0% /dev/shm\ntmpfs          tmpfs     2.0G  9.0M  2.0G   1% /run\ntmpfs          tmpfs     2.0G     0  2.0G   0% /sys/fs/cgroup\ntmpfs          tmpfs     398M     0  398M   0% /run/user/0\n</code></pre>"},{"location":"Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/","title":"1.PicGo\u56fe\u5e8a","text":""},{"location":"Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/#11-\u914d\u7f6e\u624b\u518c","title":"1.1 \u914d\u7f6e\u624b\u518c","text":"<p>PicGo\u7684\u914d\u7f6e\u6587\u4ef6\u5728\u4e0d\u540c\u7cfb\u7edf\u91cc\u662f\u4e0d\u4e00\u6837\u7684\u3002</p> <p>Windows: %APPDATA%\\picgo\\data.json </p> <p>Linux: $XDG_CONFIG_HOME/picgo/data.json or ~/.config/picgo/data.json </p> <p>macOS: ~/Library/Application Support/picgo/data.json</p> <p>\u4e3e\u4f8b\uff0c\u5728windows\u91cc\u4f60\u53ef\u4ee5\u5728\uff1a</p> <p><code>C:\\Users\\\u4f60\u7684\u7528\u6237\u540d\\AppData\\Roaming\\picgo\\data.json</code>\u627e\u5230\u5b83\u3002</p> <p>\u5728linux\u91cc\u4f60\u53ef\u4ee5\u5728\uff1a</p> <p><code>~/.config/picgo/data.json</code>\u91cc\u627e\u5230\u5b83\u3002</p> <p>macOS\u540c\u7406\u3002</p> <p>!!! example \u53c2\u8003\u6587\u732e\uff1a</p> <pre><code>https://picgo.github.io/PicGo-Doc/zh/guide/config.html\n</code></pre>"},{"location":"Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/#12-\u56fe\u5e8a\u533a","title":"1.2 \u56fe\u5e8a\u533a","text":""},{"location":"Other/tools/1.PicGo%E5%9B%BE%E5%BA%8A/#1-github\u56fe\u5e8a","title":"1. GitHub\u56fe\u5e8a","text":"<p><pre><code>{\n\"github\": {\n\"repo\": \"hujianli94/Picgo-atlas\", // \u4ed3\u5e93\u540d\uff0c\u683c\u5f0f\u662fusername/reponame\n\"branch\": \"main\",       // \u5206\u652f\u540d\uff0c\u9ed8\u8ba4\u662fmain\n\"token\": \"xxxxxxxxx\",  // github token\n\"path\": \"img/\",       // \u81ea\u5b9a\u4e49\u5b58\u50a8\u8def\u5f84\uff0c\u6bd4\u5982img/\n\"customUrl\": \"\"       // \u81ea\u5b9a\u4e49\u57df\u540d\uff0c\u6ce8\u610f\u8981\u52a0http://\u6216\u8005https://\n}\n}\n</code></pre> 1. \u9996\u5148\u4f60\u5f97\u6709\u4e00\u4e2aGitHub\u8d26\u53f7\u3002\u6ce8\u518cGitHub\u5c31\u4e0d\u7528\u6211\u591a\u8a00\u3002</p> <ol> <li>\u65b0\u5efa\u4e00\u4e2a\u4ed3\u5e93,\u8bb0\u4e0b\u4f60\u53d6\u7684\u4ed3\u5e93\u540d\u3002</li> <li>\u751f\u6210\u4e00\u4e2atoken\u7528\u4e8ePicGo\u64cd\u4f5c\u4f60\u7684\u4ed3\u5e93\u3002\u8bbf\u95ee\uff1ahttps://github.com/settings/tokens  \u7136\u540e\u70b9\u51fb<code>Generate new token</code>\u3002</li> </ol> <p></p> <p>\u7136\u540e\u70b9\u51fbGenerate new token\u3002</p> <p>\u628arepo\u7684\u52fe\u6253\u4e0a\u5373\u53ef\u3002\u7136\u540e\u7ffb\u5230\u9875\u9762\u6700\u5e95\u90e8\uff0c\u70b9\u51fbGenerate token\u7684\u7eff\u8272\u6309\u94ae\u751f\u6210token\u3002 </p> <p>**\u6ce8\u610f\uff1a**\u8fd9\u4e2atoken\u751f\u6210\u540e\u53ea\u4f1a\u663e\u793a\u4e00\u6b21\uff01\u4f60\u8981\u628a\u8fd9\u4e2atoken\u590d\u5236\u4e00\u4e0b\u5b58\u5230\u5176\u4ed6\u5730\u65b9\u4ee5\u5907\u4ee5\u540e\u8981\u7528\u3002</p> <ol> <li>\u914d\u7f6ePicGo</li> </ol> <p>**\u6ce8\u610f\uff1a**\u4ed3\u5e93\u540d\u7684\u683c\u5f0f\u662f\u7528\u6237\u540d/\u4ed3\u5e93\uff0c\u6bd4\u5982\u6211\u521b\u5efa\u4e86\u4e00\u4e2a\u53eb\u505atest\u7684\u4ed3\u5e93\uff0c\u5728PicGo\u91cc\u6211\u8981\u8bbe\u5b9a\u7684\u4ed3\u5e93\u540d\u5c31\u662fhujianli94/Picgo-atlas\u3002 \u4e00\u822c\u6211\u4eec\u9009\u62e9main\u5206\u652f\u5373\u53ef\u3002\u7136\u540e\u8bb0\u5f97\u70b9\u51fb\u786e\u5b9a\u4ee5\u751f\u6548\uff0c\u7136\u540e\u53ef\u4ee5\u70b9\u51fb\u8bbe\u4e3a\u9ed8\u8ba4\u56fe\u5e8a\u6765\u786e\u4fdd\u4e0a\u4f20\u7684\u56fe\u5e8a\u662fGitHub\u3002</p> <p></p> <p>\u4f7f\u7528\u6307\u5357</p> <p>https://picgo.github.io/PicGo-Doc/zh/guide/</p>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/","title":"2.Markdown\u57fa\u7840\u8bed\u6cd5","text":""},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#1\u6807\u9898","title":"1.\u6807\u9898","text":"<pre><code># \u4e00\u7ea7\u6807\u9898\n## \u4e8c\u7ea7\u6807\u9898\n### \u4e09\u7ea7\u6807\u9898\n#### \u56db\u7ea7\u6807\u9898\n##### \u4e94\u7ea7\u6807\u9898\n###### \u6700\u5c0f\u53ea\u6709\u516d\n</code></pre>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#2\u52a0\u7c97","title":"2.\u52a0\u7c97","text":"<pre><code>**\u6211\u8981\u88ab\u52a0\u7c97\u4e86**\n</code></pre>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#3\u4ee3\u7801\u5f15\u7528\u5f0f","title":"3.\u4ee3\u7801\u5f15\u7528\uff08&gt;\u5f0f\uff09","text":"<pre><code>&gt; hello markdown!\n\n&gt; hello markdown!\n&gt;&gt; hello markdown!\n</code></pre> <p>\u6548\u679c</p> <p>hello markdown!</p> <p>hello markdown!</p> <p>hello markdown!</p>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#4\u4ee3\u7801\u5f15\u7528\u5f0f","title":"4.\u4ee3\u7801\u5f15\u7528\uff08```\u5f0f\uff09","text":"<pre><code>hello markdown!\n</code></pre>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#5\u4ee3\u7801\u5f15\u7528tab\u5f0f","title":"5.\u4ee3\u7801\u5f15\u7528\uff08Tab\u5f0f\uff09","text":"<pre><code>    hello markdown!\n</code></pre>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#6\u63d2\u5165\u94fe\u63a5\u7b80\u5355\u5f0f","title":"6.\u63d2\u5165\u94fe\u63a5\uff08\u7b80\u5355\u5f0f\uff09","text":"<pre><code>&lt;http://example.com&gt;\n</code></pre> <p>\u6548\u679c</p> <p>http://example.com</p>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#7\u63d2\u5165\u94fe\u63a5\u5185\u5d4c\u5f0f","title":"7.\u63d2\u5165\u94fe\u63a5\uff08\u5185\u5d4c\u5f0f\uff09","text":"<pre><code>[\u641c\u72d7](https://www.sogo.com \"\u641c\u72d7\u4e00\u4e0b\")\n</code></pre> <p>\u6548\u679c</p> <p>\u641c\u72d7</p>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#8\u63d2\u5165\u56fe\u7247","title":"8.\u63d2\u5165\u56fe\u7247","text":"<pre><code>![](https://upload-images.jianshu.io/upload_images/6912209-8c53b79a706bb7c2.png '\u63cf\u8ff0')\n</code></pre>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#9\u6709\u5e8f\u5217\u8868","title":"9.\u6709\u5e8f\u5217\u8868","text":"<pre><code>1. one\n2. two 3. three\n</code></pre>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#10\u65e0\u5e8f\u5217\u8868","title":"10.\u65e0\u5e8f\u5217\u8868","text":"<pre><code>* one\n* two\n* three\n</code></pre>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#11\u5206\u5272\u7ebf","title":"11.\u5206\u5272\u7ebf","text":"<pre><code>---\n</code></pre>"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#12\u8868\u683c","title":"12.\u8868\u683c","text":"<pre><code>| name | age | sex |\n|:------:|:------|------:|\n|tony|20|\u7537|\n|lucy|18|\u5973|\n</code></pre> <p>\u6548\u679c\uff1a</p> name age sex tony 20 \u7537 lucy 18 \u5973"},{"location":"Other/tools/2.Markdown%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#10\u603b\u7ed3","title":"10.\u603b\u7ed3","text":"<p>\u603b\u7ed3 \u4ee5\u4e0a\u6240\u8ff0\u5c31\u662fMarkdown\u7684\u57fa\u672c\u6807\u7b7e\uff0c\u867d\u7136\u4e0d\u591a\uff0c\u4f46\u662f\u53ef\u4ee5\u89e3\u51b3\u5927\u90e8\u5206\u60c5\u51b5\u3002 \u53ef\u4ee5\u752820%\u7684\u6807\u7b7e\u5b8c\u621080%\u7684\u6548\u679c</p>"},{"location":"Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/","title":"Python Linux\u7ba1\u7406\u4e0e\u81ea\u52a8\u5316\u8fd0\u7ef4","text":"<p>\u7cfb\u7edf\u5168\u9762\u7684\u5b66\u4e60Python Linux\u7ba1\u7406\u4e0e\u81ea\u52a8\u5316\u8fd0\u7ef4</p>"},{"location":"Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/#\u76ee\u5f55","title":"\u76ee\u5f55","text":""},{"location":"Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/#1\u57fa\u7840\u7bc7","title":"1.\u57fa\u7840\u7bc7","text":"<p>1.Python\u751f\u6001\u5de5\u5177</p> <p>2.Python\u7b2c\u4e09\u65b9\u5e93\u5b89\u88c5</p> <p>3.Python\u5de5\u4f5c\u73af\u5883\u7ba1\u7406</p> <p>4.VSCode\u4e2dPython\u73af\u5883\u914d\u7f6e</p> <p>5.\u5176\u4ed6\u5f00\u53d1\u5de5\u5177</p>"},{"location":"Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/#2\u9ad8\u7ea7\u7bc7","title":"2.\u9ad8\u7ea7\u7bc7","text":"<p>6.\u6253\u9020\u547d\u4ee4\u884c\u5de5\u5177</p> <p>7.\u6587\u672c\u5904\u7406</p> <p>8.Linux\u7cfb\u7edf\u7ba1\u7406</p> <p>9.\u76d1\u63a7Linux</p> <p>10.\u6587\u6863\u4e0e\u62a5\u544a</p>"},{"location":"Python/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Pythjon-auto-ops/#3\u6848\u4f8b\u7bc7","title":"3.\u6848\u4f8b\u7bc7","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/","title":"1.Python\u751f\u6001\u5de5\u5177","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/#1-1\u79d2\u949f\u542f\u52a8\u4e00\u4e2a\u4e0b\u8f7d\u670d\u52a1\u5668","title":"1. 1\u79d2\u949f\u542f\u52a8\u4e00\u4e2a\u4e0b\u8f7d\u670d\u52a1\u5668","text":"<p>\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5c31\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u542f\u52a8\u4e00\u4e2a\u6587\u4ef6\u4e0b\u8f7d\u670d\u52a1\u5668\uff0c\u9ed8\u8ba4\u6253\u5f008000\u7aef\u53e3\u3002</p> <p>\u5b8c\u6210\u4ee5\u540e\uff0c\u53ea\u9700\u8981\u5c06IP\u548c\u7aef\u53e3\u544a\u8bc9\u540c\u4e8b\uff0c\u8ba9\u540c\u4e8b\u81ea\u5df1\u53bb\u64cd\u4f5c\u5373\u53ef\uff0c\u975e\u5e38\u65b9\u4fbf\u9ad8\u6548\u3002</p> Python2Python3 <pre><code>python -m SimpleHTTPServer\n</code></pre> <pre><code>python -m http.server\n</code></pre> <p>\u4e0a\u9762\u4f7f\u7528\u7684Python\u8bed\u53e5\uff0c\u4ece\u5de5\u4f5c\u539f\u7406\u6765\u8bf4\uff0c\u4ec5\u4ec5\u662f\u542f\u52a8\u4e86\u4e00\u4e2aPython\u5185\u7f6e\u7684Web\u670d\u52a1\u5668\u3002</p> <p>\u5982\u679c\u5f53\u524d\u76ee\u5f55\u4e0b\u5b58\u5728\u4e00\u4e2a\u540d\u4e3aindex.html\u7684\u6587\u4ef6\uff0c\u5219\u9ed8\u8ba4\u663e\u793a\u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u3002</p> <p>\u5982\u679c\u5f53\u524d\u76ee\u5f55\u4e0b\u4e0d\u5b58\u5728\u8fd9\u6837\u4e00\u4e2a\u6587\u4ef6\uff0c\u5219\u9ed8\u8ba4\u663e\u793a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5217\u8868\uff0c\u4e5f\u5c31\u662f\u5927\u5bb6\u770b\u5230\u7684\u4e0b\u8f7d\u670d\u52a1\u5668\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/#2-\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3ajson","title":"2. \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3aJSON","text":"<p>\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u5c06\u4e00\u4e2aJSON\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3aJSON\u5bf9\u8c61\uff0c\u4ee5\u63d0\u9ad8\u65e5\u5fd7\u7684\u53ef\u8bfb\u6027\u3002 \u9664\u4e86\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u4f7f\u7528\u5728\u7ebfJSON\u683c\u5f0f\u5316\u5de5\u5177\u4ee5\u5916\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u7ec8\u7aef\u7684Python\u89e3\u91ca\u5668\u6765\u89e3\u6790JSON\u4e32\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ echo '{\"job\": \"developer\", \"name\": \"lmx\", \"sex\": \"male\"}' | python -m json.tool\n{\n\"job\": \"developer\",\n    \"name\": \"lmx\",\n    \"sex\": \"male\"\n}\n</code></pre> <p>\u4f7f\u7528\u547d\u4ee4\u884c\u89e3\u91ca\u5668\u89e3\u6790JSON\u4e32\u975e\u5e38\u65b9\u4fbf\uff0c\u800c\u4e14\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u9605\u8bfb\uff0c\u8be5\u5de5\u5177\u8fd8\u4f1a\u81ea\u52a8\u5c06\u8f6c\u6362\u7684\u7ed3\u679c\u8fdb\u884c\u5bf9\u9f50\u548c\u683c\u5f0f\u5316\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ echo '{\"address\": {\"province\": \"zhejiang\", \"city\": \"hangzhou\"}, \"name\": \"lmx\", \"sex\": \"male\"}' | python -m json.tool\n{\n\"address\": {\n\"province\": \"zhejiang\",\n        \"city\": \"hangzhou\"\n},\n    \"name\": \"lmx\",\n    \"sex\": \"male\"\n}\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/1.Python%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/#3-\u68c0\u67e5\u7b2c\u4e09\u65b9\u5e93\u662f\u5426\u6b63\u786e\u5b89\u88c5","title":"3. \u68c0\u67e5\u7b2c\u4e09\u65b9\u5e93\u662f\u5426\u6b63\u786e\u5b89\u88c5","text":"<p><pre><code>$ python -c \"import paramiko\"\n</code></pre> \u4f7f\u7528\u8fd9\u79cd\u9a8c\u8bc1\u65b9\u5f0f\uff0c\u4e0d\u7528\u767b\u5f55\u5230\u670d\u52a1\u5668\u8fdb\u5165\u4ea4\u4e92\u5f0f\u7684\u754c\u9762\uff0c\u66f4\u91cd\u8981\u7684\u662f\uff0c\u80fd\u591f\u5728\u811a\u672c\u4e2d\u5b9e\u73b0\u5bf9\u4e8e\u8fdc\u7a0b\u670d\u52a1\u5668\u7684\u9a8c\u8bc1\u64cd\u4f5c\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/","title":"2.Python\u7b2c\u4e09\u65b9\u5e93\u5b89\u88c5","text":"<p>\u4e3a\u4e86\u4fbf\u4e8e\u7528\u6237\u5b89\u88c5\u548c\u7ba1\u7406\u7b2c\u4e09\u65b9\u5e93\u548c\u8f6f\u4ef6\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u7f16\u7a0b\u8bed\u8a00\u62e5\u6709\u81ea\u5df1\u7684\u5305\u7ba1\u7406\u5de5\u5177\uff0c \u5982nodejs\u7684npm\uff0cruby\u7684gem\u3002</p> <p>Python\u4e5f\u4e0d\u4f8b\u5916\uff0c\u73b0\u5728Python\u751f\u6001\u4e3b\u6d41\u7684\u5305\u7ba1\u7406\u5de5\u5177\u662fpip\u3002</p> <p>Python\u4e2d\u5b89\u88c5\u7b2c\u4e09\u65b9\u5e93\u7684\u65b9\u5f0f\u6709\u591a\u79cd\uff0c\u5177\u4f53\u5982\u4e0b\u3002</p> <ul> <li> <p>\u672c\u5730\u6e90\u7801\u5b89\u88c5\u3002</p> </li> <li> <p>\u901a\u8fc7easy_install\u5305\u7ba1\u7406\u5de5\u5177\u5b89\u88c5\u3002</p> </li> <li> <p>\u901a\u8fc7pip\u5305\u7ba1\u7406\u5de5\u5177\u5b89\u88c5\u3002</p> </li> </ul>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/#1\u672c\u5730\u6e90\u7801\u5b89\u88c5","title":"1.\u672c\u5730\u6e90\u7801\u5b89\u88c5","text":"<p>\u5982\u679c\u7528\u6237\u6ca1\u6709\u5c06\u8f6f\u4ef6\u6253\u5305\u4e0a\u4f20\u5230pypi.python.org\uff0c\u5219\u65e0\u6cd5\u4f7f\u7528pip\u8fdb\u884c\u5b89\u88c5\u3002\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0cPython\u751f\u6001\u4e5f\u6709\u6807\u51c6\u7684\u505a\u6cd5\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u5c1d\u8bd5\u4ece\u6e90\u7801\u5b89\u88c5paramiko\u3002 <pre><code>$ git clone https://github.com/paramiko/paramiko.git\n$ cd paramiko\n$ python setup.py install\n</code></pre></p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/#2easy_install\u5b89\u88c5","title":"2.easy_install\u5b89\u88c5","text":"<p>\u5f53\u7136\uff0c\u672c\u5730\u6e90\u7801\u5b89\u88c5\u65b9\u5f0f\u5e76\u4e0d\u662f\u6700\u597d\u7684\u9009\u62e9\uff0c\u901a\u5e38\u6211\u4eec\u90fd\u4f1a\u4f7f\u7528Python\u7684\u5305\u7ba1\u7406\u5de5\u5177\u6765\u5b89\u88c5\u7b2c\u4e09\u65b9\u5e93\u3002</p> <p>\u5728\u65e9\u671f\u7684Python\u7248\u672c\u4e2d\uff0c\u901a\u5e38\u90fd\u4f1a\u81ea\u5e26\u4e00\u4e2aeasy_install\u5de5\u5177\uff0c\u901a\u8fc7\u8be5\u5de5\u5177\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b89\u88c5\u516c\u5f00\u53d1\u5e03\u7684\u7b2c\u4e09\u65b9\u5e93\u3002</p> <p>easy_install\u5b89\u88c5\u7b2c\u4e09\u65b9\u5e93\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> <p><pre><code>$ easy_install install requests\n</code></pre> \u6267\u884c\u8be5\u547d\u4ee4\u540e\uff0ceasy_install\u4f1a\u4ecePython\u7684\u7b2c\u4e09\u65b9\u5e93\u53d1\u884c\u7ad9\u70b9--PyPI\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u5e93\u7684\u5b89\u88c5\u5305\uff0c\u5e76\u5728\u672c\u5730\u81ea\u52a8\u8fdb\u884c\u89e3\u538b\u548c\u5b89\u88c5\uff0c\u5176\u5b89\u88c5\u6548\u679c\u548c\u672c\u5730\u6e90\u7801\u5b89\u88c5\u65b9\u5f0f\u4e00\u6837\u3002</p> <p>easy_install\u4f7f\u7528\u56fd\u5185\u6e90 <pre><code>cat &gt;&gt; ~/.pydistutils.cfg  &lt;&lt;EOF\n[easy_install]\nindex-url = https://mirrors.aliyun.com/pypi/simple\nEOF\n</code></pre></p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/#3pip\u9ad8\u7ea7\u7528\u6cd5","title":"3.pip\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/#31-\u624b\u52a8\u5b89\u88c5pip","title":"3.1 \u624b\u52a8\u5b89\u88c5pip","text":"<p>Python pip \u5b89\u88c5\u4e0e\u4f7f\u7528</p> <p>Python3 pip</p> <p>pip\u7684\u5e38\u7528\u547d\u4ee4\u5982\u4e0b\uff1a</p> <ul> <li>install</li> <li>list</li> <li>search</li> <li>freeze</li> <li>uninstall</li> </ul> <pre><code>sudo apt-get install python-pip\n\n# \u5347\u7ea7pip\npip install -U pip\n\n# \u6216\u8005\npip install --upgrade pip\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/#32-pip\u5e38\u7528\u547d\u4ee4","title":"3.2 pip\u5e38\u7528\u547d\u4ee4","text":"<p>pip\u7684\u5b50\u547d\u4ee4</p> \u5b50\u547d\u4ee4 \u89e3\u91ca\u8bf4\u660e install \u5b89\u88c5\u8f6f\u4ef6\u5305 download \u4e0b\u8f7d\u5b89\u88c5\u5305 uninstall \u5378\u8f7d\u5b89\u88c5\u5305 freeze \u6309\u7167requirements\u683c\u5f0f\u8f93\u51fa\u5b89\u88c5\u5305\uff0c\u53ef\u4ee5\u5230\u5176\u4ed6\u670d\u52a1\u5668\u4e0a\u6267\u884cpip install -r requirements.txt\u76f4\u63a5\u5b89\u88c5 list \u5217\u51fa\u5f53\u524d\u7cfb\u7edf\u7684\u5b89\u88c5\u5305 show \u67e5\u770b\u5b89\u88c5\u5305\u7684\u4fe1\u606f\u3001\u5305\u62ec\u7248\u672c\u3001\u4f9d\u8d56\u3001\u8bb8\u53ef\u8bc1\u7b49 check pip 9.01\u63d0\u4f9b\u7684\u6700\u65b0\u5b50\u547d\u4ee4\uff0c\u68c0\u67e5\u5b89\u88c5\u5305\u662f\u5426\u5b8c\u6574 search \u67e5\u627e\u5b89\u88c5\u5305 wheel \u6253\u5305\u8f6f\u4ef6\u5230whell\u683c\u5f0f hash \u8ba1\u7b97\u8f6f\u4ef6\u5305\u7684hash\u503c completion \u751f\u6210\u547d\u4ee4\u8865\u5168\u914d\u7f6e help \u83b7\u53d6pip\u548c\u5b50\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f <pre><code># 1\uff09\u67e5\u627e\u5b89\u88c5\u5305\uff1a\npip search flask\n\n# 2\uff09\u5b89\u88c5\u7279\u5b9a\u7684\u5b89\u88c5\u5305\u7248\u672c\uff1a\npip install flask              # \u6700\u65b0\u7248\u672c\npip install flask==0.8         # \u6307\u5b9a\u7248\u672c\npip install 'flask&gt;=0.8'       # \u6700\u5c0f\u7248\u672c\npip install Django==1.7        # \u5b89\u88c5 Django\n# \u6216\u8005\u4f60\u53ea\u662f\u60f3\u5347\u7ea7\u5f53\u524d\u7248\u672c\u7684\u7b2c\u4e09\u65b9\u5e93\uff0c\u5219\u9700\u8981\u5728\u4f7f\u7528install\u547d\u4ee4\u65f6\uff0c\u6dfb\u52a0\u4e0a\u5347\u7ea7\u9009\u9879\uff0c\u6bd4\u5982\uff1a\npip install -U requests\n\n# \u66f4\u65b0\u67d0\u4e2a\u5305\npip install --upgrade package_name  # \u6216\u8005\u662f  \npip install -U package_name\n\n# 3\uff09\u5220\u9664\u5b89\u88c5\u5305\uff1a\npip uninstall Werkzeug\n\n# 4\uff09\u67e5\u770b\u5b89\u88c5\u5305\u7684\u4fe1\u606f\uff1a\npip show flask\nName: Flask\nVersion: 0.12\nSummary: A microframework based on Werkzeug, Jinja2 and good intentions\nHome-page: http://github.com/pallets/flask/\n......\n# \u6216\u8005\npip show -f requests\n\n# 5\uff09\u68c0\u67e5\u5b89\u88c5\u5305\u7684\u4f9d\u8d56\u662f\u5426\u5b8c\u6574\uff1a\npip check flask\nFlask 0.12 requires Werkzeug, which is not installed.\n\n# 6\uff09\u67e5\u770b\u5df2\u5b89\u88c5\u7684\u5b89\u88c5\u5305\u5217\u8868\uff1a\npip list\n\n# 7\uff09\u5bfc\u51fa\u7cfb\u7edf\u5df2\u5b89\u88c5\u7684\u5b89\u88c5\u5305\u5217\u8868\u5230requirements\u6587\u4ef6\uff1a\npip freeze &gt; requirements.txt\n\n# 8\uff09\u4ecerequirements\u6587\u4ef6\u5b89\u88c5\uff1a\npip install -r requirements.txt\n\n# 9\uff09\u4f7f\u7528pip\u547d\u4ee4\u8865\u5168\uff1a\npip completion --bash &gt;&gt; ~/.profile\nsource ~/.profile\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/#33-\u52a0\u901fpip\u5b89\u88c5\u7684\u6280\u5de7","title":"3.3 \u52a0\u901fpip\u5b89\u88c5\u7684\u6280\u5de7","text":"<p>\u6307\u5b9a\u56fd\u5185\u6e90\u6765\u5b89\u88c5,\u53ef\u4ee5-i\u4f7f\u7528\u5982\u4e0b\u56fd\u5185\u5382\u5546\u7684pip\u6e90</p> \u5382\u5546 \u56fd\u5185\u6e90 \u6e05\u534e https://pypi.tuna.tsinghua.edu.cn/simple \u963f\u91cc\u4e91 https://mirrors.aliyun.com/pypi/simple/ \u4e2d\u56fd\u79d1\u6280\u5927\u5b66 https://pypi.mirrors.ustc.edu.cn/simple/ \u534e\u4e2d\u7406\u5de5\u5927\u5b66 https://pypi.hustunique.com/ \u5c71\u4e1c\u7406\u5de5\u5927\u5b66 https://pypi.sdutlinux.org/ \u8c46\u74e3 https://pypi.doubanio.com/simple/ <p>1.\u4f7f\u7528\u8c46\u74e3\u6216\u963f\u91cc\u4e91\u7684\u6e90\u52a0\u901f\u8f6f\u4ef6\u5b89\u88c5</p> <pre><code>pip install -i https://pypi.douban.com/simple/ flask\n</code></pre> <p>\u4e34\u65f6\u4f7f\u7528\u955c\u50cf\u6e90\u4e0b\u8f7d</p> <pre><code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package\n</code></pre> <p>\u6bcf\u6b21\u90fd\u8981\u6307\u5b9a\u955c\u50cf\u6e90\u7684\u5730\u5740\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4fee\u6539pip\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06\u955c\u50cf\u6e90\u5199\u5165\u914d\u7f6e\u6587\u4ef6\u4e2d\u3002</p> <p>\u5bf9\u4e8eLinux\u7cfb\u7edf\u6765\u8bf4\uff0c\u9700\u8981\u521b\u5efa<code>~/.pip/pip.conf</code>\u6587\u4ef6\uff0c\u7136\u540e\u5728\u6587\u4ef6\u4e2d\u4fdd\u5b58\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code># cat pip.conf\n[global]\nindex-url = https://pypi.douban.com/simple/\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/2.Python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%AE%89%E8%A3%85/#34-\u6279\u91cf\u5b89\u88c5\u8f6f\u4ef6\u5305","title":"3.4 \u6279\u91cf\u5b89\u88c5\u8f6f\u4ef6\u5305","text":"<pre><code># \u5bfc\u51fa\u7cfb\u7edf\u5df2\u5b89\u88c5\u7684\u5b89\u88c5\u5305\u5217\u8868\u5230requirements\u6587\u4ef6\npip freeze &gt; requirements.txt\n\n# \u4ecerequirements.txt\u6587\u4ef6\u5b89\u88c5\npip install -r requirements.txt\n\n# \u4f7f\u7528\u56fd\u5185\u6e90\u52a0\u901f\u5b89\u88c5requirements.txt\u4e09\u65b9\u5e93\npip install -i https://pypi.tuna.tsinghua.edu.cn/simple --no-cache-dir -r requirements.txt\n\n# \u4f7f\u7528\u56fd\u5185\u963f\u91cc\u6e90\u52a0\u901f\u5b89\u88c5requirements\npip install --no-cache-dir -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple\n</code></pre> <p>uninstall\u547d\u4ee4\u6765\u5220\u9664\u6307\u5b9a\u7684\u7b2c\u4e09\u65b9\u5e93\uff0c\u5177\u4f53\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>pip uninstall requests\n</code></pre> <p>2.\u5c06\u8f6f\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730\u90e8\u7f72</p> <pre><code># \u8f7d\u5305\u4f46\u662f\u4e0d\u5b89\u88c5\npip download package_name -d \"\u67d0\u4e2a\u8def\u5f84\"\n# \u4f8b\u5982\npip download requests -d \".\"\n# \u4e0b\u8f7d\u5230\u672c\u5730\npip install --download=`pwd` -r requirements.txt\n\n# \u672c\u5730\u5b89\u88c5\npip install --no-index -f file://'pwd'  -r requirements.txt\n</code></pre> <p>\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ea\u9700\u8981\u4e0b\u8f7d\u4e00\u6b21\uff0c\u5c31\u53ef\u4ee5\u591a\u5904\u5b89\u88c5\uff0c\u4e0d\u7528\u62c5\u5fc3\u7f51\u7edc\u4e0d\u7a33\u5b9a\u7684\u95ee\u9898\u3002\u5e76\u4e14\uff0cpip\u80fd\u591f\u81ea\u52a8\u5904\u7406\u8f6f\u4ef6\u4f9d\u8d56\u95ee\u9898\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u4e0b\u8f7dFlask\u5230\u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u5219Flask\u7684\u4f9d\u8d56click\u3001itsdangerous\u3001Jinja2\u3001MarkupSafe\u548cWerkzeug\u4e5f\u4f1a\u88ab\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>pip install --download='pwd' flask\n\nls\nclick-6.7-py2.py3-none-any.whl   itsdangerous-0.24.tar.gz\nMarkupSafe-0.23.tar.gz  Flask-0.12-py2.py3-none-any.whl\nJinja2-2.9.5-py2.py3-none-any.whl  Werkzeug-0.11.15-py2.py3-none-any.whl\n</code></pre> <p>\u4e0b\u8f7d\u65f6\u4f7f\u7528</p> <pre><code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple Django\n</code></pre> <p>\u6c38\u4e45\u4fee\u6539</p> <pre><code>pip install pip -U\npip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6</p> <ul> <li> <p>linux : <code>~/.pip/pip.conf</code></p> </li> <li> <p>windows : <code>C:\\User\\\u7528\u6237\\pip\\pip.ini</code> \u6216 <code>C:\\Users\\18793\\AppData\\Roaming\\pip\\pip.ini</code></p> </li> </ul> <p>\u8c46\u74e3 <pre><code>[global]\ntimeout = 600\nindex-url = https://pypi.doubanio.com/simple/\n[install]\ntrusted-host = pypi.doubanio.com\n</code></pre></p> <p>\u963f\u91cc\u4e91 <pre><code>[global]\ntimeout = 600\nindex-url = https://mirrors.aliyun.com/pypi/simple/\n\n[install]\ntrusted-host=mirrors.aliyun.com\n</code></pre></p> <p>pip\u5e38\u7528\u547d\u4ee4\u53ca\u8bbe\u7f6e</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/","title":"3.Python\u5de5\u4f5c\u73af\u5883\u7ba1\u7406","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#1python3\u7684\u5b89\u88c5","title":"1.Python3\u7684\u5b89\u88c5","text":"<p>(1) \u547d\u4ee4\u884c\u5b89\u88c5</p> CentOS\u3001Red HatUbuntu\u3001Debian \u548c Deepin <p>Python 3.5 \u7248\u672c\uff1a <pre><code>sudo yum install -y https://centos7.iuscommunity.org/ius-release.rpm\nsudo yum update\nsudo yum install -y python35u python35u-libs python35u-devel python35u-pip\n</code></pre></p> <p>\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u4fbf\u53ef\u4ee5\u6210\u529f\u5b89\u88c5 Python 3.5 \u53ca pip 3 \u4e86\u3002</p> <p>Python 3.4 \u7248\u672c\uff1a <pre><code>sudo yum groupinstall -y development tools\nsudo yum install -y epel-release python34-devel  libxslt-devel libxml2-devel openssl-devel\nsudo yum install -y python34\nsudo yum install -y python34-setuptools\nsudo easy_install-3.4 pip\n</code></pre> \u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u4fbf\u53ef\u4ee5\u6210\u529f\u5b89\u88c5 Python 3.4 \u53ca pip 3 \u4e86\u3002</p> <p>\u9996\u5148\u5b89\u88c5 Python 3\uff0c\u8fd9\u91cc\u4f7f\u7528 apt-get \u5b89\u88c5\u5373\u53ef\u3002\u5728\u5b89\u88c5\u524d\uff0c\u8fd8\u9700\u5b89\u88c5\u4e00\u4e9b\u57fa\u7840\u5e93\uff0c\u76f8\u5173\u547d\u4ee4\u5982\u4e0b\uff1a <pre><code>sudo apt-get install -y python3-dev build-essential libssl-dev libffi-dev libxml2 libxml2-dev libxslt1-dev zlib1g-dev libcurl4-openssl-dev\nsudo apt-get install -y python3\n</code></pre></p> <p>\u6267\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u540e\uff0c\u5c31\u53ef\u4ee5\u6210\u529f\u5b89\u88c5 Python 3 \u4e86\u3002 \u7136\u540e\u8fd8\u9700\u8981\u5b89\u88c5 pip3\uff0c\u8fd9\u91cc\u4ecd\u7136\u4f7f\u7528 apt-get \u5b89\u88c5\u5373\u53ef\uff0c\u76f8\u5173\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>sudo apt-get install -y python3-pip\n</code></pre> <p>(2) \u6e90\u7801\u5b89\u88c5</p> <p>\u5982\u679c\u547d\u4ee4\u884c\u7684\u5b89\u88c5\u65b9\u5f0f\u6709\u95ee\u9898\uff0c\u8fd8\u53ef\u4ee5\u4e0b\u8f7d Python 3 \u6e90\u7801\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u6e90\u7801\u4e0b\u8f7d\u5730\u5740\u4e3a<code>https://www.python.org/ftp/python/</code>\uff0c\u53ef\u4ee5\u81ea\u884c\u9009\u7528\u60f3\u8981\u7684\u7248\u672c\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u8fd9\u91cc\u4ee5 Python 3.6.2 \u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\uff0c\u5b89\u88c5\u8def\u5f84\u8bbe\u7f6e\u4e3a<code>/usr/local/python3</code>\u3002</p> <p>\u4e0b\u8f7d Python 3 \u6e90\u7801\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u9996\u5148\uff0c\u521b\u5efa\u5b89\u88c5\u76ee\u5f55\uff0c\u76f8\u5173\u547d\u4ee4\u5982\u4e0b\uff1a <pre><code>sudo mkdir /usr/local/python3\nwget --no-check-certificate https://www.python.org/ftp/python/3.6.2/Python-3.6.2.tgz\ntar -xzvf Python-3.6.2.tgz\ncd Python-3.6.2\nsudo ./configure --prefix=/usr/local/python3\nsudo make\nsudo make install\n\n# \u521b\u5efaPython3\u94fe\u63a5\nsudo ln -s /usr/local/python3/bin/python3 /usr/bin/python3\n</code></pre></p> <p>\u968f\u540e\u4e0b\u8f7d pip \u5b89\u88c5\u5305\u5e76\u5b89\u88c5\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>wget --no-check-certificate https://github.com/pypa/pip/archive/9.0.1.tar.gz\ntar -xzvf 9.0.1.tar.gz\ncd pip-9.0.1\npython3 setup.py install\n\n# \u521b\u5efapip3\u94fe\u63a5\nsudo ln -s /usr/local/python3/bin/pip /usr/bin/pip3\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>https://cuiqingcai.com/5059.html</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#2pyenv\u7ba1\u7406\u4e0d\u540cpython\u7248\u672c","title":"2.pyenv\u7ba1\u7406\u4e0d\u540cPython\u7248\u672c","text":"<p>1.pyenv\u7684\u5b89\u88c5</p> <p>\u4e00\u952e\u5b89\u88c5</p> <pre><code>curl https://pyenv.run | bash\n#or\ncurl -L https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer | bash\nexec $SHELL\n</code></pre> <p>\u624b\u52a8\u5b89\u88c5</p> <p>\u6211\u4eec\u76f4\u63a5\u4eceGitHub\u4e0b\u8f7d\u9879\u76ee\u5230\u672c\u5730\uff0c\u7136\u540e\uff0c\u5206\u522b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u5b89\u88c5\u5373\u53ef\uff1a</p> <pre><code>$ git clone https://github.com/yyuu/pyenv.git ~/.pyenv\n\u6b63\u514b\u9686\u5230 '/home/hujianli/.pyenv'...\nremote: Enumerating objects: 22935, done.\nremote: Counting objects: 100% (481/481), done.\nremote: Compressing objects: 100% (159/159), done.\nremote: Total 22935 (delta 391), reused 346 (delta 316), pack-reused 22454\n\u63a5\u6536\u5bf9\u8c61\u4e2d: 100% (22935/22935), 4.66 MiB | 1.82 MiB/s, \u5b8c\u6210.\n\u5904\u7406 delta \u4e2d: 100% (15532/15532), \u5b8c\u6210.\n\n$ echo 'export PYENV_ROOT=\"$HOME/.pyenv\"' &gt;&gt; ~/.bash_profile\n$ echo 'export PATH=\"$PYENV_ROOT/bin:$PATH\"' &gt;&gt; ~/.bash_profile\n$ echo 'eval \"$(pyenv init -)\"' &gt;&gt; ~/.bash_profile\n</code></pre> <p>\u66f4\u591aLinux\u7cfb\u7edf\u5b89\u88c5pyenv\u7684\u8be6\u7ec6\u8bf4\u660e\u89c1\u5b98\u7f51github\u3002 \u5982\u679cgithub\u4e0b\u8f7d\u4e0d\u4e86\u7684\uff0c\u53ef\u4ee5\u4ece\u8fd9\u91cc\u4e0b\u8f7dzip\u5305</p> <p>\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\u9700\u8981\u91cd\u65b0\u8f7d\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u6216\u8005\u9000\u51fa\u4ee5\u540e\u91cd\u65b0\u767b\u5f55\uff0c\u4ee5\u4f7f~/.bash_profile\u4e2d\u7684\u914d\u7f6e\u751f\u6548\u3002\u7b14\u8005\u4e00\u822c\u9009\u62e9\u4f7f\u7528source\u547d\u4ee4\u91cd\u65b0\u8f7d\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>$ source ~/.bash_profile\n</code></pre></p> <p>\u81f3\u6b64\uff0cpyenv\u5c31\u5b89\u88c5\u5b8c\u6210\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u9a8c\u8bc1pyenv\u662f\u5426\u6b63\u786e\u5b89\u88c5\u5e76\u83b7\u53d6pyenv\u7684\u5e2e\u52a9\u4fe1\u606f\uff1a</p> <pre><code>$ pyenv --help\nUsage: pyenv &lt;command&gt; [&lt;args&gt;]\nSome useful pyenv commands are:\n    commands    List all available pyenv commands\n    local       Set or show the local application-specific Python version\n    global      Set or show the global Python version\n    shell       Set or show the shell-specific Python version\n    install     Install a Python version using python-build\n    uninstall   Uninstall a specific Python version\n    rehash      Rehash pyenv shims (run this after installing executables)\nversion     Show the current Python version and its origin\n    versions    List all Python versions available to pyenv\n    which       Display the full path to an executable\n    whence      List all Python versions that contain the given executable\n\nSee 'pyenv help &lt;command&gt;' for information on a specific command.\nFor full documentation, see: https://github.com/yyuu/pyenv#readme\n</code></pre> <p>2.pyenv\u7684\u4f7f\u7528</p> <p>\u6211\u4eec\u901a\u8fc7pyenv\u7684install\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770bpyenv\u5f53\u524d\u652f\u6301\u54ea\u4e9bPython\u7248\u672c\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>$ pyenv  install --list\nAvailable versions:\n    3.6.0\n    3.6-dev\n    3.7-dev\n    ...\n</code></pre></p> <p>\u7531\u4e8epyenv\u53ef\u4ee5\u5b89\u88c5\u7684Python\u7248\u672c\u5217\u8868\u975e\u5e38\u957f\uff0c\u6240\u4ee5\uff0c\u8fd9\u91cc\u8fdb\u884c\u4e86\u7701\u7565\u3002\u8bfb\u8005\u53ef\u4ee5\u5728\u81ea\u5df1\u7535\u8111\u4e0a\u5b89\u88c5pyenv\uff0c\u7136\u540e\u6267\u884cpyenv install--list\u547d\u4ee4\u8fdb\u884c\u67e5\u770b\u3002\u53ef\u4ee5\u770b\u5230\uff0cpyenv\u4e0d\u4f46\u53ef\u4ee5\u5b89\u88c5\u4e0d\u540c\u7684Python\u7248\u672c\uff0c\u800c\u4e14\u8fd8\u53ef\u4ee5\u5b89\u88c5\u4e0d\u540c\u7684Python\u5b9e\u73b0\uff0c\u4e5f\u53ef\u4ee5\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684Python\u7528\u4ee5\u5b66\u4e60\u3002</p> <p>\u4f7f\u7528pyenv\u5b89\u88c5\u4e0d\u540c\u7684Python\u7248\u672c\uff1a</p> <pre><code>$ pyenv install -v 3.6.0\n$ pyenv install -v 2.7.13\n</code></pre> <p>\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u4e2d\u5305\u542b\u7684Python\u7248\u672c\uff1a <pre><code>$ pyenv versions\n* system (set by /home/lmx/.pyenv/version)\n2.7.13\n    3.6.0\n</code></pre></p> <p>\u7531\u4e8e\u6211\u4eec\u5b89\u88c5\u4e862\u4e2aPython\u7248\u672c\uff0c\u52a0\u4e0a\u6211\u4eec\u7cfb\u7edf\u81ea\u8eab\u7684Python\uff0c\u5f53\u524d\u7cfb\u7edf\u4e2d\u5b58\u57283\u4e2a\u4e0d\u540c\u7684Python\u7248\u672c\u3002</p> <p>\u5176\u4e2d\uff0c\u8f93\u51fa\u7ed3\u679c\u524d\u9762\u7684\u201c*\u201d\u8868\u793a\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u7248\u672c\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7pyenv global\u9009\u62e9\u4e0d\u540c\u7684Python\u7248\u672c\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ pyenv global 3.6.0\n$ pyenv versions\n    system\n    2.7.13\n* 3.6.0 (set by /home/lmx/.pyenv/version)\n$ python\nPython 3.6.0 (default, Feb  8 2017, 15:53:33)\n[GCC 4.7.2] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; exit()\n$ pyenv global 2.7.13\n$ python\nPython 2.7.13 (default, Feb  8 2017, 16:03:42)\n[GCC 4.7.2] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n</code></pre> <p>\u4f7f\u7528pyenv\u4ee5\u540e\uff0c\u53ef\u4ee5\u5feb\u901f\u5207\u6362Python\u7684\u7248\u672c\u3002\u5207\u6362Python\u7248\u672c\u4ee5\u540e\uff0c\u4e0e\u7248\u672c\u76f8\u5173\u7684\u4f9d\u8d56\u4e5f\u4f1a\u4e00\u8d77\u5207\u6362\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u4e0d\u7528\u62c5\u5fc3\u4e0d\u540c\u7684\u7248\u672c\u5728\u7cfb\u7edf\u4e2d\u662f\u5426\u4f1a\u76f8\u4e92\u5e72\u6270\u3002</p> <p>\u4f8b\u5982\uff0c\u5207\u6362Python\u7248\u672c\u4ee5\u540e\uff0c\u76f8\u5e94\u7684pip\u4e5f\u4f1a\u8ddf\u7740\u5207\u6362\uff0c\u6240\u4ee5\u4e0d\u7528\u62c5\u5fc3\u81ea\u5df1\u4f7f\u7528\u7684pip\u7248\u672c\u548cPython\u7248\u672c\u4e0d\u5339\u914d\u7684\u95ee\u9898\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ pyenv global 3.6.0\n$ pip --version\npip 9.0.1 from /home/lmx/.pyenv/versions/3.6.0/lib/python3.6/site-packages (python 3.6)\n$ pyenv global 2.7.13\n$ pip --version\npip 9.0.1 from /home/lmx/.pyenv/versions/2.7.13/lib/python2.7/site-packages (python 2.7)\n</code></pre> <p>\u5982\u679c\u60f3\u8981\u5220\u9664Python\u7248\u672c\uff0c\u4f7f\u7528uninstall\u547d\u4ee4\u5373\u53ef\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ pyenv uninstall 2.7.10\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#3\u521b\u5efa\u865a\u62df\u73af\u5883","title":"3.\u521b\u5efa\u865a\u62df\u73af\u5883","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#31-virtualenv","title":"3.1 virtualenv","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#311-\u5b89\u88c5","title":"3.1.1 \u5b89\u88c5","text":"pip\u5b89\u88c5apt\u5b89\u88c5 <pre><code># 1. \u5b89\u88c5\u8f6f\u4ef6\u5305\npip3 install virtualenv\n\n# 2. \u68c0\u6d4b\u5b89\u88c5\u662f\u5426\u6210\u529f\nvirtualenv --version\n\n# 3. \u521b\u5efa\u865a\u62df\u73af\u5883\n## cd\u5230\u8981\u521b\u5efa\u865a\u62df\u73af\u5883\u7684\u9879\u76ee\u6839\ncd github/test\n\n# 4. \u521b\u5efa\u865a\u62df\u73af\u5883\nvirtualenv venv\n\n# 5. \u6fc0\u6d3b\u865a\u62df\u73af\u5883\nsource venv/bin/activate(activate\u8def\u5f84)\n# 6. \u9000\u51fa\u865a\u62df\u73af\u5883\ndeactivate\n</code></pre> <pre><code>$ sudo apt-get install python3-venv\n# \u521b\u5efa\u865a\u62df\u73af\u5883\u7684\u547d\u4ee4\u683c\u5f0f\u5982\u4e0b\uff1a\n$ python3 -m venv virtualName -m venv $ python3 -m venv venv\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#312-\u4f7f\u7528\u865a\u62df\u73af\u5883","title":"3.1.2 \u4f7f\u7528\u865a\u62df\u73af\u5883","text":"<pre><code># \u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f Linux \u6216 macOS\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u6fc0\u6d3b\u865a\u62df\u73af\u5883\uff1a\n$ source venv/bin/activate\n\n# \u5982\u679c\u4f7f\u7528\u5fae\u8f6f Windows \u7cfb\u7edf\uff0c\u6fc0\u6d3b\u547d\u4ee4\u662f\uff1a\n$ venv\\Scripts\\activate\n\n# \u9000\u51fa\u865a\u62df\u73af\u5883\uff1a\n$ deactivate\n</code></pre> <p>\u867d\u7136\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u5e94\u8be5\u6fc0\u6d3b\u865a\u62df\u73af\u5883\uff0c\u4f46\u662f\u4e0d\u6fc0\u6d3b\u4e5f\u80fd\u4f7f\u7528\u865a\u62df\u73af\u5883\u3002</p> <p>\u4f8b\u5982\uff0c\u4e3a\u4e86\u542f\u52a8 venv \u865a\u62df\u73af\u5883\u4e2d\u7684 Python \u63a7\u5236\u53f0\uff0c </p> <ul> <li> <p>\u5728Linux\u6216macOS\u4e2d\u53ef\u4ee5\u6267\u884c<code>venv/bin/python</code>\u547d\u4ee4\uff0c </p> </li> <li> <p>\u5728Windows\u4e2d\u53ef\u4ee5\u6267\u884c<code>venv\\Scripts\\python</code>\u547d\u4ee4\u3002</p> </li> </ul> <p>\u865a\u62df\u73af\u5883\u4e2d\u7684\u5de5\u4f5c\u7ed3\u675f\u540e\uff0c\u5728\u547d\u4ee4\u63d0\u793a\u7b26\u4e2d\u8f93\u5165 deactivate \uff0c\u8fd8\u539f\u5f53\u524d\u7ec8\u7aef\u4f1a\u8bdd\u7684 PATH \u73af\u5883\u53d8\u91cf\uff0c\u628a\u547d\u4ee4\u63d0\u793a\u7b26\u91cd\u7f6e\u4e3a\u6700\u521d\u7684\u72b6\u6001\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#32-pipenv","title":"3.2 pipenv","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#321-\u5b89\u88c5","title":"3.2.1 \u5b89\u88c5","text":"<pre><code>$ pip install pipenv\n$ pipenv \u2013-version\n</code></pre> <ol> <li>\u521b\u5efa\u865a\u62df\u73af\u5883 <pre><code># \u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u865a\u62df\u73af\u5883\n$ pipenv install\n\n# \u5f53\u524d\u865a\u62df\u73af\u5883\u4e0b\u5b89\u88c5requests\u5e93\n$ pipenv install requests\n\n# \u5b89\u88c5\u6307\u5b9a\u4f9d\u8d56\u6587\u4ef6\u4e2d\u7684\u4e09\u65b9\u5e93\n$ pipenv install -r /path/to/requirements.txt\n\n# \u5b89\u88c5setpu.py\u6e90\u7801\u5e93\n$ pipenv install -e .\n</code></pre></li> </ol> <p>\u6ce8\u610f\uff1a\u5b89\u88c5\u524d\u9700\u8981\u914d\u7f6e\u4e0b\u865a\u62df\u73af\u5883\u76ee\u5f55\u4e0b\u7684Pipfile\u6587\u4ef6\u4e2durl\u5b57\u6bb5\uff0c\u66f4\u65b0\u4e3a\u56fd\u5185\u4e09\u65b9\u5e93\u7684\u6e90\uff08http://mirrors.aliyun.com/pypi/simple/\uff09</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#322-\u4f7f\u7528","title":"3.2.2 \u4f7f\u7528","text":"<p>\u4ea4\u4e92\u5f0f\u865a\u62df\u73af\u5883</p> <pre><code>$ pipenv shell\n$ python /path/to/script.py\n</code></pre> <p>\u4e00\u6b21\u6027\u865a\u62df\u73af\u5883 <pre><code>$ pipenv run python /path/to/script.py\n</code></pre></p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#323-\u5378\u8f7d","title":"3.2.3 \u5378\u8f7d","text":"<pre><code># \u5220\u9664requests\u5e93\n$ pipenv uninstall requests\n\n# \u5220\u9664\u6240\u6709\u5df2\u5b89\u88c5\u7684\u4e09\u65b9\u5e93\n$ pipenv uninstall -all\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#324-\u4e09\u65b9\u5e93\u8fc1\u79fb\u5907\u4efd","title":"3.2.4 \u4e09\u65b9\u5e93\u8fc1\u79fb\u5907\u4efd","text":"<p>pipenv\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4f9d\u8d56\u5e93\u8fc1\u79fb\u7684\u529f\u80fd\uff0c\u5373\u53ef\u4ee5\u628a\u5f53\u524d\u865a\u62df\u73af\u5883\u4e2d\u5df2\u5b89\u88c5\u7684\u4f9d\u8d56\u5e93\u4fe1\u606f\u5bfc\u51fa\u5230requirements.txt\u6587\u4ef6</p> <p>\u8fd9\u6837\u5728\u65b0\u7684\u73af\u5883\u4e2d\u5c31\u53ef\u4ee5\u901a\u8fc7\u8be5requirements.txt\u6587\u4ef6\u5b89\u88c5\u5168\u90e8\u7684\u4f9d\u8d56\u5e93\uff0c\u4ece\u800c\u8fbe\u5230\u4f9d\u8d56\u5e93\u51c6\u786e\u8fc1\u79fb\u7684\u76ee\u7684\u3002\u63d0\u53d6\u4f9d\u8d56\u5e93\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>$ pipenv lock -r\n</code></pre> <p>\u8be5\u547d\u4ee4\u4f1a\u751f\u6210\u4e00\u4e2a\u540d\u4e3arequirements.txt\u7684\u4f9d\u8d56\u5e93\u6587\u4ef6\u4e2d\uff0c\u8be5\u6587\u4ef6\u5305\u542b\u4e86\u5f53\u524d\u865a\u62df\u73af\u5883\u4e2d\u7684\u6240\u6709\u4e09\u65b9\u5e93\u7684\u7248\u672c\u4fe1\u606f\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/3.Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/#4pyenv-virtualenv","title":"4.pyenv-virtualenv","text":"<p>virtualenv\u672c\u8eab\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u9879\u76ee\uff0c\u7528\u4ee5\u9694\u79bb\u4e0d\u540c\u9879\u76ee\u7684\u5de5\u4f5c\u73af\u5883\u3002</p> <p>\u4f8b\u5982\uff0c\u7528\u6237lmx\u5e0c\u671b\u5728\u9879\u76eeA\u4e2d\u4f7f\u7528Flask0.8\u8fd9\u4e2a\u7248\u672c\uff0c\u4e0e\u6b64\u540c\u65f6\uff0c\u53c8\u60f3\u5728\u9879\u76eeB\u4e2d\u4f7f\u7528Flask0.9\u8fd9\u4e2a\u7248\u672c\u3002</p> <p>\u5982\u679c\u6211\u4eec\u5168\u5c40\u5b89\u88c5Flask\uff0c\u5fc5\u7136\u65e0\u6cd5\u6ee1\u8db3\u7528\u6237\u7684\u9700\u6c42\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528virtualenv\u3002</p> <p>1.pyenv-virtualenv\u7684\u5b89\u88c5</p> <p>\u5b89\u88c5\u548c\u4f7f\u7528pyenv-virtualenv\u63d2\u4ef6\u5982\u4e0b\u6240\u793a\uff1a <pre><code>$ git clone https://github.com/yyuu/pyenv-virtualenv.git $(pyenv root)/plugins/pyenv-virtualenv\nCloning into '/home/lmx/.pyenv/plugins/pyenv-virtualenv'...\nremote: Counting objects: 1860, done.\nremote: Total 1860 (delta 0), reused 0 (delta 0), pack-reused 1860\nReceiving objects: 100% (1860/1860), 530.62 KiB | 213 KiB/s, done.\nResolving deltas: 100% (1274/1274), done.\n\n$ echo 'eval \"$(pyenv virtualenv-init -)\"' &gt;&gt; ~/.bash_profile\n</code></pre></p> <p>\u4e0e\u5b89\u88c5pyenv\u7c7b\u4f3c\uff0c\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\u9700\u8981\u91cd\u65b0\u8f7d\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u6216\u8005\u9000\u51fa\u7528\u6237\u518d\u767b\u5f55\uff0c\u4ee5\u4f7f\u5f97\u914d\u7f6e\u6587\u4ef6\u751f\u6548\uff1a</p> <pre><code>$ source  ~/.bash_profile\n</code></pre> <p>2.pyenv-virtualenv\u7684\u4f7f\u7528</p> <p>\u6709\u4e86pyenv-virtualenv\u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a\u540c\u4e00\u4e2aPython\u89e3\u91ca\u5668\uff0c\u521b\u5efa\u591a\u4e2a\u4e0d\u540c\u7684\u5de5\u4f5c\u73af\u5883\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u65b0\u5efa\u4e24\u4e2a\u5de5\u4f5c\u73af\u5883\uff1a <pre><code>$ pyenv virtualenv 2.7.13 first_project\n$ pyenv virtualenv 2.7.13 second_project\n</code></pre></p> <p>\u53ef\u4ee5\u4f7f\u7528virtualenvs\u5b50\u547d\u4ee4\u67e5\u770b\u5de5\u4f5c\u73af\u5883\uff1a <pre><code>$ pyenv virtualenvs\n  2.7.13/envs/first_project (created from /home/lmx/.pyenv/versions/2.7.13)\n2.7.13/envs/second_project (created from /home/lmx/.pyenv/versions/2.7.13)\nfirst_project (created from /home/lmx/.pyenv/versions/2.7.13)\nsecond_project (created from /home/lmx/.pyenv/versions/2.7.13)\n</code></pre></p> <p>\u521b\u5efa\u5b8c\u5de5\u4f5c\u73af\u5883\u4ee5\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7activate\u548cdeactivate\u5b50\u547d\u4ee4\u8fdb\u5165\u6216\u9000\u51fa\u4e00\u4e2a\u5de5\u4f5c\u73af\u5883\u3002\u8fdb\u5165\u5de5\u4f5c\u73af\u5883\u4ee5\u540e\uff0c\u5de6\u8fb9\u7684\u63d0\u793a\u7b26\u4f1a\u663e\u793a\u4f60\u5f53\u524d\u6240\u5728\u7684\u5de5\u4f5c\u73af\u5883\uff0c\u4ee5\u514d\u56e0\u4e3a\u73af\u5883\u592a\u591a\u5bfc\u81f4\u64cd\u4f5c\u9519\u8bef\u3002</p> <p><pre><code>$ pyenv activate first_project\n(first_project) $ pip install flask==0.8\n(first_project) $ pyenv deactivate\n</code></pre> \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u4e00\u4e0b\u5728\u4e0d\u540c\u7684\u5de5\u4f5c\u73af\u5883\u5b89\u88c5\u4e0d\u540c\u7684Flask\u7248\u672c\uff1a</p> <pre><code>$ pyenv activate first_project\n(first_project) $ pip install flask==0.8\n(first_project) $ pyenv deactivate\n$ pyenv activate second_project\n(second_project) $ pip install flask==0.9\n</code></pre> <p>\u5982\u679c\u60f3\u8981\u5220\u9664\u865a\u62df\u73af\u5883\uff0c\u5219\u4f7f\u7528\uff1a</p> <pre><code>$ pyenv virtualenv-delete first_project\n</code></pre> <p>\u4f7f\u7528pyenv\u548cpython-virtualenv\u63d2\u4ef6\uff0c\u6211\u4eec\u5c31\u80fd\u591f\u81ea\u7531\u5730\u5728\u4e0d\u540c\u7684\u7248\u672c\u4e4b\u95f4\u8fdb\u884c\u5207\u6362\uff0c\u76f8\u6bd4\u7ba1\u7406Python\u7248\u672c\uff0c\u4e0d\u4f46\u8282\u7701\u4e86\u65f6\u95f4\uff0c\u4e5f\u907f\u514d\u4e86\u5de5\u4f5c\u8fc7\u7a0b\u4e2d\u7684\u76f8\u4e92\u5e72\u6270\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/","title":"4.Python\u5f00\u53d1\u73af\u5883","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#1anaconda","title":"1.Anaconda","text":"<p>Python\u652f\u6301\u591a\u79cd\u65b9\u5f0f\u5b89\u88c5\uff0c\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528Anaconda,\u66f4\u65b9\u4fbf\u7ba1\u7406\u7248\u672c\u7b49\u4fe1\u606f\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#11-anaconda\u4ecb\u7ecd","title":"1.1 Anaconda\u4ecb\u7ecd","text":"<p>Anaconda \u662f\u4e00\u4e2a\u7528\u4e8e\u79d1\u5b66\u8ba1\u7b97\u7684Python \u53d1\u884c\u7248\uff0c\u652f\u6301Linux\u3001Mac\u3001Windows \u7cfb\u7edf\uff0c\u5305\u542b\u4e86\u4f17\u591a\u6d41\u884c\u7684\u79d1\u5b66\u8ba1\u7b97\u3001\u6570\u636e\u5206\u6790\u7684Python \u5305\u3002</p> <p>\u6b64\u5916\uff0cAnaconda \u63d0\u4f9b\u4e86\u5305\u7ba1\u7406\u4e0e\u73af\u5883\u7ba1\u7406\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u89e3\u51b3\u591a\u7248\u672cpython \u5e76\u5b58\u3001\u5207\u6362\u4ee5\u53ca\u5404\u79cd\u7b2c\u4e09\u65b9\u5305\u5b89\u88c5\u95ee\u9898\u3002</p> <p>conda\u5206\u4e3aanaconda\u548cminiconda\u3002</p> <p>anaconda\u662f\u5305\u542b\u4e00\u4e9b\u5e38\u7528\u5305\u7684\u7248\u672c\uff0cminiconda\u5219\u662f\u7cbe\u7b80\u7248\uff0c\u9700\u8981\u5565\u88c5\u5565\uff0c\u6240\u4ee5\u63a8\u8350\u4f7f\u7528miniconda\u3002</p> <ul> <li> <p>Anaconda</p> </li> <li> <p>miniconda</p> </li> </ul> <p>\u7279\u70b9\uff1a\u76f8\u6bd4Anaconda\u5b89\u88c5\u6587\u4ef6\u4f53\u79ef\u5c0f\uff0c\u53ef\u4ee5\u6309\u7167\u5b9e\u9645\u9700\u6c42\u5b89\u88c5\u76f8\u5173\u4f9d\u8d56\u548c\u5305\u3002</p> <p>\u63a8\u8350\u5b89\u88c5 miniconda</p> <p>\u4e0b\u8f7d\u7f51\u5740</p> <p>miniconda\u5b98\u7f51\uff1ahttps://conda.io/miniconda.html</p> <p>\u8fd9\u91cc\u6211\u672c\u5730\u7b14\u8bb0\u672c\u5b89\u88c5\u7684\u5982\u4e0b\u7248\u672c\uff1a</p> <p><code>Miniconda3-latest-Windows-x86_64.exe</code></p> <p>\u9009\u62e9\u9002\u5408\u81ea\u5df1\u7684\u7248\u672c\uff0c\u7528wget\u547d\u4ee4\u4e0b\u8f7d\u3002</p> <pre><code># \u8fd9\u4e2a\u7248\u672c\u662f\u9002\u5408\u4e8elinux\u7684\uff0c\u8981\u770b\u6e05\u695a\u5662\u3002\nwget -c https://repo.anaconda.com/miniconda/Miniconda3-py39_4.9.2-Linux-x86_64.sh\n\n# mac\u7528\u6237\u8bf7\u7528\uff1a\ncurl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh\n# mac\u7528\u6237\u9009\u62e9\u56fe\u5f62\u5316\u754c\u9762\u7684anaconda\u7248\u672c\u4e5f\u53ef\u3002\n# \u4f20\u9001\u95e8\uff1ahttps://www.anaconda.com/products/individual\n# \u5f80\u4e0b\u7ffb\uff0c\u9009\u62e964-Bit Graphical Installer\n# \u8fd9\u91cc\u9009\u62e9\u7684\u662flatest-Linux\u7248\u672c\uff0c\u6240\u4ee5\u4e0b\u8f7d\u7684\u7a0b\u5e8f\u4f1a\u968f\u7740python\u7684\u7248\u672c\u66f4\u65b0\u800c\u66f4\u65b0\uff08\u73b0\u5728\u4e0b\u8f7d\u7684\u7248\u672c\u9ed8\u8ba4\u7684python\u7248\u672c\u5df2\u7ecf\u662f3.9\u4e86\uff09\n# \u5b89\u88c5\u547d\u4ee4\nchmod 777 Miniconda3-latest-Linux-x86_64.sh #\u7ed9\u6267\u884c\u6743\u9650\nbash Miniconda3-latest-Linux-x86_64.sh #\u8fd0\u884c\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#12-\u955c\u50cf\u6e90","title":"1.2 \u955c\u50cf\u6e90","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#121-\u4e0b\u8f7d\u65b9\u5f0f","title":"1.2.1 \u4e0b\u8f7d\u65b9\u5f0f","text":"<ul> <li> <p>\u56fd\u5185\u5730\u5740: https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive</p> </li> <li> <p>\u5b98\u7f51\u5730\u5740: https://www.anaconda.com/</p> </li> </ul> <p>\u4ece\u5b98\u7f51\u4e0b\u8f7d\u6bd4\u8f83\u6162\uff0c\u63a8\u8350\u4f7f\u7528\u56fd\u5185\u4e0b\u8f7d\u5730\u5740\uff0c\u7136\u540e\u9009\u62e9\u81ea\u5df1\u7cfb\u7edf\u5bf9\u5e94\u7684\u7248\u672c\uff0c\u4e0b\u8f7d\u5373\u53ef</p> <p>Anaconda\u4e0ePython\u7248\u672c\u5bf9\u5e94\u5173\u7cfb\uff1a\u4f20\u9001\u95e8</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#122-\u66f4\u6362\u56fd\u5185\u955c\u50cf\u6e90","title":"1.2.2 \u66f4\u6362\u56fd\u5185\u955c\u50cf\u6e90","text":"<p>\u901a\u5e38anaconda\u7684\u9ed8\u8ba4\u6e90\u5728\u5883\u5916\uff0c\u4e0b\u8f7d\u901f\u5ea6\u4f1a\u975e\u5e38\u6162\u751a\u81f3\u5bfc\u81f4\u7f51\u7edc\u9519\u8bef\u4e0b\u8f7d\u5305\u5931\u8d25\uff0c\u8fd9\u91cc\u63a8\u8350\u6e05\u534e\u5927\u5b66\u955c\u50cf\u6e90\uff0c\u6dfb\u52a0\u65b9\u6cd5\u5982\u4e0b:</p> <pre><code># \u521b\u5efa.condarc\u6587\u4ef6\n$ conda config --set show_channel_urls yes\n\n$ conda config --show-sources\n==&gt; C:\\Users\\18793\\.condarc &lt;==\nchannels:\n  - defaults\ncustom_channels:\n  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  pytorch-lts: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\ndefault_channels:\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2\nshow_channel_urls: True\n\n# \u7f16\u8f91.condarc\u6587\u4ef6\nchannels:\n  - defaults\nshow_channel_urls: true\ndefault_channels:\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2\ncustom_channels:\n  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  pytorch-lts: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n</code></pre> <p>Anaconda \u955c\u50cf\u4f7f\u7528\u5e2e\u52a9</p> <p>\u6ce8\uff1a\u7531\u4e8e\u66f4\u65b0\u8fc7\u5feb\u96be\u4ee5\u540c\u6b65\uff0c\u8be5\u955c\u50cf\u6e90\u4e0d\u4f1a\u540c\u6b65pytorch-nightly, pytorch-nightly-cpu, ignite-nightly\u8fd9\u4e09\u4e2a\u5305\u3002</p> <p>\u66f4\u591a\u4fe1\u606f\u53ef\u67e5\u770b\u5b98\u65b9\u6587\u6863:https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#123-\u6e05\u9664\u7f13\u5b58","title":"1.2.3 \u6e05\u9664\u7f13\u5b58","text":"<p>\u6dfb\u52a0\u955c\u50cf\u6e90\u6210\u529f\u540e\uff0c\u9700\u8981\u624b\u52a8\u6e05\u9664\u7d22\u5f15\u7f13\u5b58\uff0c\u4fdd\u8bc1\u7528\u7684\u662f\u955c\u50cf\u662f\u6700\u65b0\u7684\u914d\u7f6e\uff1b\u6e05\u9664\u547d\u4ee4\u5982\u4e0b: <pre><code># \u6e05\u9664\u7d22\u5f15\u7f13\u5b58\n$ conda clean -i\n</code></pre></p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#124-\u66f4\u65b0\u955c\u50cf\u6e90","title":"1.2.4 \u66f4\u65b0\u955c\u50cf\u6e90","text":"<pre><code>$ conda update --all\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#125-\u7248\u672c\u5347\u7ea7","title":"1.2.5 \u7248\u672c\u5347\u7ea7","text":"<pre><code># \u67e5\u770b\u5f53\u524d\u7248\u672c\n$ conda  -V\nconda 22.9.0\n\n# \u5347\u7ea7\u7248\u672c\n$ conda update conda\n\n$ conda update conda          #\u57fa\u672c\u5347\u7ea7\n$ conda update anaconda       #\u5927\u7684\u5347\u7ea7\n$ conda update anaconda-navigator    #update\u6700\u65b0\u7248\u672c\u7684anaconda-navigator   \n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#13-\u7ba1\u7406python\u73af\u5883","title":"1.3 \u7ba1\u7406python\u73af\u5883","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#131-\u67e5\u770b\u53ef\u7528\u7248\u672c","title":"1.3.1 \u67e5\u770b\u53ef\u7528\u7248\u672c","text":"<p>\u4f7f\u7528conda search x\u641c\u7d22\u67d0\u4e2a\u8f6f\u4ef6\u5305\u7684\u53ef\u7528\u7248\u672c\u3002</p> <pre><code>$ conda search python\nLoading channels: done\n# Name                       Version           Build  Channel\npython                        2.7.13     h32f5f24_13  anaconda/pkgs/main\n....\npython                        3.9.15      h218abb5_2  anaconda/pkgs/main\n...\npython                        3.10.0      h88f2d9e_0  anaconda/pkgs/main\n....\npython                        3.11.0      h1fd4e5f_2  anaconda/pkgs/main\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#132-\u521b\u5efa\u73af\u5883","title":"1.3.2 \u521b\u5efa\u73af\u5883","text":"<p>\u4f7f\u7528<code>conda create --name \u73af\u5883\u540d\u79f0 python=x</code>\u521b\u5efapython\u65b0\u73af\u5883\uff0cx\u53ef\u6307\u5b9a\u5177\u4f53\u7248\u672c,\u5982\u4e0b\u793a\u4f8b\u521b\u5efapython3.10\u7248\u672c</p> <pre><code># \u521b\u5efapython3.10\u5f00\u53d1\u73af\u5883\uff0c\u73af\u5883\u540d\u79f0\u4e3a: py310\n$ conda create --name py310 python=3.10\nCollecting package metadata (current_repodata.json): done\nSolving environment: done\n## Package Plan ##\nenvironment location: /Users/liuqh/opt/anaconda3/envs/py310\n  added / updated specs:\n    - python=3.10\n\nThe following packages will be downloaded:\n\npackage                    |            build\n    ---------------------------|-----------------\n    pip-23.0.1                 |  py310hecd8cb5_0         2.6 MB  defaults\n    python-3.10.11             |       h218abb5_2        13.1 MB  defaults\n    setuptools-66.0.0          |  py310hecd8cb5_0         1.2 MB  defaults\n    wheel-0.38.4               |  py310hecd8cb5_0          66 KB  defaults\n    ------------------------------------------------------------\n                                           Total:        17.0 MB\n...\nProceed ([y]/n)?\n# \u8f93\u5165:y\nDownloading and Extracting Packages\npython-3.10.11       | 13.1 MB   | ######################################################################## | 100%\nwheel-0.38.4         | 66 KB     | ######################################################################## | 100%\npip-23.0.1           | 2.6 MB    | ######################################################################## | 100%\nsetuptools-66.0.0    | 1.2 MB    | ######################################################################## | 100%\nPreparing transaction: done\nVerifying transaction: done\nExecuting transaction: done\n#\n# To activate this environment, use\n#\n#     $ conda activate py310\n#\n# To deactivate an active environment, use\n#\n#     $ conda deactivate\nRetrieving notices: ...working... done\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#133-\u5217\u51fa\u73af\u5883","title":"1.3.3 \u5217\u51fa\u73af\u5883","text":"<p>\u4f7f\u7528<code>conda env list</code>\u53ef\u4ee5\u5217\u51fa\u6211\u4eec\u521b\u5efa\u7684\u6240\u6709\u5f00\u53d1\u73af\u5883\uff1b</p> <pre><code># \u5217\u51fa\u521b\u5efa\u7684\u6240\u6709\u5f00\u53d1\u73af\u5883\n$ conda env list\n# conda environments:\nbase                  *  /Users/liuqh/opt/anaconda3 # \u8fd9\u91cc\u7684*\u4ee3\u8868\u5f53\u524d\u4f7f\u7528\u73af\u5883\npy310                    /Users/liuqh/opt/anaconda3/envs/py310\npython3.11               /Users/liuqh/opt/anaconda3/envs/python3.11\npython3.7                /Users/liuqh/opt/anaconda3/envs/python3.7\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#134-\u6fc0\u6d3b\u73af\u5883","title":"1.3.4 \u6fc0\u6d3b\u73af\u5883","text":"<p>\u5f53\u6211\u4eec\u4f7f\u7528\u7684\u9879\u76ee\uff0c\u7528\u4e86\u4e0d\u540c\u7684python\u7248\u672c\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u6fc0\u6d3b\u5bf9\u5e94\u7684\u73af\u5883\uff0c\u6765\u9009\u62e9\u9002\u5e94\u7684\u7248\u672c;</p> <p>\u6fc0\u6d3b\u73af\u5883\u7684\u547d\u4ee4\u5982\u4e0b:</p> <pre><code># \u6fc0\u6d3bpython3.11\u5f00\u53d1\u73af\u5883\n$ conda activate python3.11\n(python3.11)  ~ python -V\nPython 3.11.3\n\n# \u6fc0\u6d3b\u521a\u624d\u521b\u5efa\u7684py310\u5f00\u53d1\u73af\u5883\n$ conda activate py310\n(py310) \u279c  ~ python -V\nPython 3.10.11\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#135-\u5220\u9664\u73af\u5883","title":"1.3.5 \u5220\u9664\u73af\u5883","text":"<p>\u5f53\u6211\u4eec\u4e0d\u60f3\u4f7f\u7528\u67d0\u4e9b\u73af\u5883\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4:<code>conda env remove --name \u73af\u5883\u540d\u79f0</code> \u6765\u5220\u9664\u73af\u5883\uff0c</p> <p>\u5982\u4e0b\u793a\u4f8b\u5220\u9664py310\u73af\u5883</p> <pre><code># \u5220\u9664\n$ conda env remove --name py310\n\nRemove all packages in environment /Users/liuqh/opt/anaconda3/envs/py310:\n# \u67e5\u770b\u662f\u5426\u5220\u9664\n$ conda env list\n# conda environments:\nbase                  *  /Users/liuqh/opt/anaconda3 # \u8fd9\u91cc\u7684*\u4ee3\u8868\u5f53\u524d\u4f7f\u7528\u73af\u5883\npython3.11               /Users/liuqh/opt/anaconda3/envs/python3.11\npython3.7                /Users/liuqh/opt/anaconda3/envs/python3.7\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#136-\u5bfc\u51fa\u73af\u5883","title":"1.3.6 \u5bfc\u51fa\u73af\u5883","text":"<p>\u5982\u679c\u60f3\u628a\u672c\u5730\u5f00\u53d1\u73af\u5883\uff0c\u5206\u4eab\u7ed9\u540c\u4e8b\uff0c\u53ef\u4ee5\u901a\u8fc7\u5bfc\u51fa\u547d\u4ee4<code>conda env export</code>,\u5982\u4e0b:</p> <pre><code># \u5bfc\u51fa\u5f53\u524d\u73af\u5883\n(python3.7) $ conda env export &gt; py37.yaml\n# \u67e5\u770b\u5bfc\u51fa\u6587\u4ef6\n(python3.7) $ ls\npy37.yaml\n# \u67e5\u770b\u6587\u4ef6\u5185\u5bb9\n$ cat py37.yaml\nname: python3.7\nchannels:\n  - defaults\ndependencies:\n  - ca-certificates=2023.01.10=hecd8cb5_0\n  ...\n  - pip:\n    - numpy==1.19.1\n    ...\nprefix: /Users/liuqh/opt/anaconda3/envs/python3.7\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#137-\u5bfc\u5165\u73af\u5883","title":"1.3.7 \u5bfc\u5165\u73af\u5883","text":"<p>\u6709\u5bfc\u51fa\u81ea\u7136\u5c31\u6709\u5bfc\u51fa\uff0c\u6bd4\u5982\u540c\u4e8b\u7ed9\u4f60\u7684\u73af\u5883\u6587\u4ef6\u662fpy37.yaml\uff0c\u4f60\u53ef\u4ee5\u57fa\u4e8e\u8fd9\u4e2a\u6587\u4ef6\u76f4\u63a5\u5bfc\u5165\u672c\u5730\uff0c\u5bfc\u5165\u547d\u4ee4\u5982\u4e0b:</p> <pre><code># \u57fa\u4e8e\u73af\u5883\u6587\u4ef6\u521b\u5efa\u73af\u5883\n$ conda env create -f py37.yaml\nCollecting package metadata (repodata.json): done\nSolving environment: done\nPreparing transaction: done\nVerifying transaction: done\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#138-\u9ed8\u8ba4\u73af\u5883","title":"1.3.8 \u9ed8\u8ba4\u73af\u5883","text":"<ol> <li>\u5173\u95edbase\u73af\u5883</li> </ol> <p>\u5b89\u88c5\u5b8c Conda \u4e4b\u540e\uff0c\u5f00\u542f\u7ec8\u7aef\u5c06\u9ed8\u8ba4\u8fdb\u5165base \u73af\u5883\uff0c\u5982\u679c\u60f3\u5173\u95ed\u53ef\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4: <pre><code># \u6267\u884c\u540e\uff0c\u65b0\u542f\u52a8\u7ec8\u7aef\u53d1\u73b0\u5df2\u7ecf\u4e0d\u5728\u8fdb\u5165base\u73af\u5883\n$ conda config --set auto_activate_base false\n</code></pre></p> <ol> <li>\u6307\u5b9a\u9ed8\u8ba4\u73af\u5883(mac)</li> </ol> <p>\u4fee\u6539<code>~/.bashrc</code></p> <pre><code># \u4f60\u672c\u5730\u7684anaconda3\u5b89\u88c5\u8def\u4e2d\u7684etc/profile.d/conda.sh\nsource /Users/liuqh/opt/anaconda3/etc/profile.d/conda.sh\n\n# \u5207\u6362\u5230\u67d0\u4e2a\u73af\u5883\nconda activate python3.11\n</code></pre> <p>\u4fee\u6539\u4e4b\u540e\u6267\u884csource ~/.bashrc,\u540e\u9762\u65b0\u521b\u5efa\u7684\u7ec8\u7aef\u90fd\u662f\u6307\u5b9a\u73af\u5883</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#14-\u4f9d\u8d56\u7ba1\u7406","title":"1.4 \u4f9d\u8d56\u7ba1\u7406","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#141-\u5b89\u88c5\u4f9d\u8d56","title":"1.4.1 \u5b89\u88c5\u4f9d\u8d56","text":"<p>python\u5b89\u88c5\u4f9d\u8d56(\u7b2c\u4e09\u65b9\u5305)\uff0c\u5e38\u89c1\u7684\u65b9\u5f0f\u662f\u4f7f\u7528<code>pip install</code>,\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528<code>conda install</code>,\u4e0b\u9762\u4ee5\u5b89\u88c5requests\u4e3a\u793a\u4f8b,\u4e24\u79cd\u65b9\u5f0f\u4f7f\u7528\u5206\u522b\u5982\u4e0b:</p> <pre><code># \u4f7f\u7528pip \u5b89\u88c5\n$ pip install requests\n\n# \u4f7f\u7528 conda\n$ conda install requests\n\n# \u5b89\u88c5\u6307\u5b9a\u7248\u672c\n$ conda install requests=2.29.0\n</code></pre> <pre><code># \u901a\u8fc7pip \u5b89\u88c5\u4f9d\u8d56\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 -i\u6307\u5b9a\u52a0\u901f\u6e90\u6765\u63d0\u5347\u4e0b\u8f7d\u901f\u5ea6,\u5982\u4e0b\u793a\u4f8b:\n# \u6839\u636erequirements.txt \u4e0b\u8f7d\u4f9d\u8d56\n$ pip install -r requirements.txt -i \u52a0\u901f\u6e90\n\n# \u76f4\u63a5\u4e0b\u8f7d\u5305\n$ pip install -i \u52a0\u901f\u6e90 numpy\n</code></pre> <p>\u56fd\u5185\u52a0\u901f\u6e90\u90e8\u5206\u6574\u7406\u5982\u4e0b:</p> <pre><code>1. \u6e05\u534e\u5927\u5b66\u5f00\u6e90\u8f6f\u4ef6\u955c\u50cf\u7ad9\uff1ahttps://pypi.tuna.tsinghua.edu.cn/simple/\n2. \u963f\u91cc\u4e91 PyPI \u955c\u50cf\uff1ahttp://mirrors.aliyun.com/pypi/simple/\n3. \u534e\u4e3a\u4e91 PyPI \u955c\u50cf\uff1ahttp://mirrors.huaweicloud.com/repository/pypi/simple/\n4. \u8c46\u74e3 PyPI \u955c\u50cf\uff1ahttp://pypi.douban.com/simple/\n5. ustc PyPI \u955c\u50cf\uff1ahttp://mirrors.ustc.edu.cn/pypi/web/simple/\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#142-\u5220\u9664\u4f9d\u8d56","title":"1.4.2 \u5220\u9664\u4f9d\u8d56","text":"<pre><code>$ conda remove requests\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#143-\u67e5\u770b\u5df2\u5b89\u88c5\u4f9d\u8d56","title":"1.4.3 \u67e5\u770b\u5df2\u5b89\u88c5\u4f9d\u8d56","text":"<pre><code># \u67e5\u770b\u6240\u6709\n$ conda list\n(base) \u279c  ~ conda list\n# packages in environment at /Users/liuqh/opt/anaconda3:\n# Name                    Version                   Build  Channel\n_anaconda_depends         2023.03                  py39_0    defaults\n_ipyw_jlab_nb_ext_conf    0.1.0            py39hecd8cb5_1    defaults\nalabaster                 0.7.12             pyhd3eb1b0_0    defaults\n...\n# \u901a\u8fc7\u6a21\u7cca\u641c\u7d22\n$ conda list | grep req\nrequests                  2.29.0           py39hecd8cb5_0    defaults\nrequests-file             1.5.1              pyhd3eb1b0_0    defaults\nrequests-toolbelt         0.9.1              pyhd3eb1b0_0    defaults\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#15-conda\u73af\u5883\u57fa\u672c\u547d\u4ee4","title":"1.5 conda\u73af\u5883\u57fa\u672c\u547d\u4ee4","text":"<pre><code>conda update -n base conda        #update\u6700\u65b0\u7248\u672c\u7684conda\nconda update --all                #update\u6700\u65b0\u7248\u672c\u7684conda\nconda create -n xxxx python=3.5   #\u521b\u5efapython3.5\u7684xxxx\u865a\u62df\u73af\u5883\nconda activate xxxx               #\u5f00\u542fxxxx\u73af\u5883\nconda deactivate                  #\u5173\u95ed\u73af\u5883\nconda env list                    #\u663e\u793a\u6240\u6709\u7684\u865a\u62df\u73af\u5883\nconda info --envs                 #\u663e\u793a\u6240\u6709\u7684\u865a\u62df\u73af\u5883\n####### \u66f4\u65b0\uff0c\u5378\u8f7d\u5b89\u88c5\u5305\uff1a\nconda list         #\u67e5\u770b\u5df2\u7ecf\u5b89\u88c5\u7684\u6587\u4ef6\u5305\nconda list -n xxx       #\u6307\u5b9a\u67e5\u770bxxx\u865a\u62df\u73af\u5883\u4e0b\u5b89\u88c5\u7684package\nconda update xxx   #\u66f4\u65b0xxx\u6587\u4ef6\u5305\nconda uninstall xxx   #\u5378\u8f7dxxx\u6587\u4ef6\u5305\n##\u5220\u9664\u865a\u62df\u73af\u5883\nconda remove -n xxxx --all   #\u521b\u5efaxxxx\u865a\u62df\u73af\u5883\n## \u6e05\u7406\uff08conda\u7626\u8eab\uff09\nconda clean -p      #\u5220\u9664\u6ca1\u6709\u7528\u7684\u5305\nconda clean -t      #\u5220\u9664tar\u5305\nconda clean -y --all #\u5220\u9664\u6240\u6709\u7684\u5b89\u88c5\u5305\u53cacache\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>Python\u865a\u62df\u73af\u5883\uff0c\u5b66\u4f1a\u8fd9\u7bc7\u5c31\u591f\u4e86</p> <p>conda\u5e38\u7528\u547d\u4ee4</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#2ipython","title":"2.ipython","text":"<p>IPython\u662f\u4e00\u4e2a\u7b2c\u4e09\u65b9\u5de5\u5177\uff0c\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u4e4b\u524d\u9700\u8981\u5148\u5b89\u88c5\u3002\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u5305\u7ba1\u7406\u5de5\u5177\u6216pip\u8fdb\u884c\u5b89\u88c5\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> apt\u5b89\u88c5pip\u5b89\u88c5 <pre><code>sudo apt-get install -y ipython\n\n# \u5728 Ubuntu 20.04 \u4e0a\uff0c\u9ed8\u8ba4\u7684 IPython \u5305\u5df2\u88ab\u5206\u5272\u4e3a ipython3 \u548c ipython\nsudo apt install -y ipython3\n</code></pre> <pre><code>pip install ipython\n</code></pre> <p>\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\uff0c\u5728\u547d\u4ee4\u884c\u7ec8\u7aef\u8f93\u5165ipython\u5c31\u8fdb\u5165\u4e86IPython\u4ea4\u4e92\u5f0f\u7f16\u7a0b\u754c\u9762\uff1a</p> <pre><code>$ ipython\nPython 2.7.3 (default, Jun 21 2016, 18:38:19)\nType \"copyright\", \"credits\" or \"license\" for more information.\n\nIPython 0.13.1 -- An enhanced Interactive Python.\n?         -&gt; Introduction and overview of IPython's features.\n%quickref -&gt; Quick reference.\nhelp      -&gt; Python's own help system.\nobject?   -&gt; Details about 'object', use 'object??' for extra details.\n</code></pre> <p>\u4e00\u4e2a\u5178\u578b\u7684MySQL\u7269\u7406\u5907\u4efd\u65e5\u5fd7\u5982\u4e0b\u6240\u793a\uff1a</p> <p>\u5373\u4f7f\u8bfb\u8005\u5bf9MySQL\u4e0d\u4e86\u89e3\u4e5f\u6ca1\u6709\u5173\u7cfb\uff0c\u6211\u4eec\u73b0\u5728\u7684\u9700\u6c42\u662f\u89e3\u6790\u4e0b\u9762\u8fd9\u4e00\u884c\u65e5\u5fd7\uff0c\u5e76\u83b7\u53d6\u65e5\u5fd7\u4e2d\u7684host\u3001filename\u548cposition\u7684\u503c\u3002\u867d\u7136\u5728\u65e5\u5fd7\u4e2dposition\u7684\u503c\u5305\u542b\u5728\u4e00\u5bf9\u5355\u5f15\u53f7\u5185\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u5e0c\u671b\u89e3\u6790\u4ee5\u540eposition\u7684\u503c\u662f\u4e00\u4e2a\u6574\u6570\u3002</p> <pre><code>MySQL slave binlog position: master host '10.173.33.35', filename 'mysql-bin.000002', position '524993060'\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u4e3b\u8981\u5c31\u662f\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u63d0\u53d6\u76f8\u5e94\u7684\u503c\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5f53\u7136\u4e0d\u96be\uff0c\u4f46\u662f\uff0c\u5982\u679c\u4e0d\u501f\u52a9\u4ea4\u4e92\u5f0f\u7f16\u7a0b\u5de5\u5177\uff0c\u9700\u8981\u5de5\u7a0b\u5e08\u4e00\u6b21\u5728\u4ee3\u7801\u4e2d\u7f16\u5199\u6b63\u786e\u4e5f\u4e0d\u7b80\u5355\u3002</p> <p>\u5982\u679c\u5de5\u7a0b\u5e08\u4e0d\u77e5\u9053\u4ea4\u4e92\u5f0f\u7f16\u7a0b\u5de5\u5177\uff0c\u5c31\u53ea\u80fd\u5728\u7f16\u8f91\u5668\u91cc\u9762\u7f16\u5199\u4ee3\u7801\uff0c\u7136\u540e\u8fd0\u884c\u3002\u5982\u679c\u6709\u9519\u8bef\u518d\u4fee\u6539\uff0c\u76f4\u5230\u83b7\u53d6\u6b63\u786e\u7684\u53d6\u503c\uff0c\u6574\u4e2a\u8fc7\u7a0b\u5c06\u4f1a\u975e\u5e38\u8017\u65f6\u3002</p> <p>\u5982\u679c\u9879\u76ee\u5e9e\u5927\uff0c\u8c03\u8bd5\u8d77\u6765\u4e5f\u4f1a\u6bd4\u8f83\u56f0\u96be\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u501f\u52a9Python\u7684\u4ea4\u4e92\u5f0f\u7f16\u7a0b\u5de5\u5177\uff0c\u5148\u9a8c\u8bc1\u4ee3\u7801\u7684\u6b63\u786e\u6027\uff0c\u7136\u540e\u5c06\u9a8c\u8bc1\u8fc7\u7684\u4ee3\u7801\u4ece\u4ea4\u4e92\u5f0f\u7f16\u7a0b\u5de5\u5177\u590d\u5236\u5230\u7f16\u8f91\u5668\u4e2d\u3002</p> <p>\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>hujianli@hujianli-OptiPlex-7010:~$ ipython\nIn [1]: line = \"MySQL slave binlog position: master host '10.173.33.35', filename 'mysql-bin.000002', position '524993060'\"\n...: In [2]:  line.split(\"'\")\nOut[2]: ['MySQL slave binlog position: master host ',\n '10.173.33.35',\n ', filename ',\n 'mysql-bin.000002',\n ', position ',\n '524993060',\n '']\nIn [3]: host = line.split(\"'\")[1]\n...: In [4]: filename = line.split(\"'\")[3]\nIn [5]: position = line.split(\"'\")[5]\nIn [6]: print(host, filename, position)\n10.173.33.35 mysql-bin.000002 524993060\nIn [7]: type(position)\nOut[7]: str\n\nIn [8]: position = int(position)\nIn [9]: print(host, filename, position)\n10.173.33.35 mysql-bin.000002 524993060\n</code></pre> <p>ipython\u7684\u4f18\u52bf</p> <ol> <li>\u8fd0\u884cipython\u63a7\u5236\u53f0</li> <li>\u4f7f\u7528ipython\u4f5c\u4e3a\u7cfb\u7edfshell</li> <li>\u4f7f\u7528\u5386\u53f2\u8f93\u5165(history)</li> <li>Tab\u8865\u5168</li> <li>\u4f7f\u7528%run\u547d\u4ee4\u8fd0\u884c\u811a\u672c</li> <li>\u4f7f\u7528%timeit\u547d\u4ee4\u5feb\u901f\u6d4b\u91cf\u65f6\u95f4</li> <li>\u4f7f\u7528%pdb\u547d\u4ee4\u5feb\u901fdebug</li> <li>\u4f7f\u7528pylab\u8fdb\u884c\u4ea4\u4e92\u8ba1\u7b97</li> <li>\u4f7f\u7528IPython Notebook</li> </ol>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#3jupyter\u7684\u4f7f\u7528","title":"3.jupyter\u7684\u4f7f\u7528","text":"<p>Jupyter\uff08\u732a\u76ae\u7279\uff09</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#31-jupyter\u4ecb\u7ecd","title":"3.1 jupyter\u4ecb\u7ecd","text":"<p>jupyter\u5c31\u662f\u4ee5\u524d\u7684IPython Notebook\uff0c\u662f\u4e00\u79cd\u65b0\u5174\u7684\u4ea4\u4e92\u5f0f\u6570\u636e\u5206\u6790\u4e0e\u8bb0\u5f55\u5de5\u5177\u3002</p> <p>\u5b83\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\u672c\u5730\u6216\u8005\u8fdc\u7aef\u7684IPython\u8fdb\u7a0b\uff0c\u5e76\u5229\u7528\u6d4f\u89c8\u5668\u7684\u56fe\u5f62\u754c\u9762\uff0c\u589e\u5f3aIPython\u7684\u53ef\u89c6\u5316\u8f93\u51fa\u3002jupyter\u5b9a\u4e49\u4e86\u4e00\u79cd\u5168\u65b0\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u6587\u4ef6\u7684\u540e\u7f00\u540d\u662fipynb\u3002ipynb\u6587\u4ef6\u5305\u542b\u4e86\u4ee3\u7801\uff0c\u7528\u4ee5\u8bf4\u660e\u6bcf\u4e00\u6b65\u7684\u8ba1\u7b97\u548c\u8f93\u51fa\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cipynb\u6587\u4ef6\u5b8c\u6574\u8bb0\u5f55\u4e86\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709\u76f8\u5173\u4fe1\u606f\uff0c\u5e76\u4e14\uff0c\u80fd\u591f\u652f\u6301\u56fe\u7247\u3001\u89c6\u9891\u548c\u516c\u5f0f\u7b49\u526f\u6587\u672c\u683c\u5f0f\uff0c\u662f\u79d1\u5b66\u8ba1\u7b97\u3001\u6570\u636e\u5206\u6790\u548c\u7f16\u7a0b\u6559\u5b66\u7684\u4f18\u79c0\u5de5\u5177\u3002</p> <p>\u6b63\u662f\u7531\u4e8ejupyter\u4e30\u5bcc\u7684\u53ef\u89c6\u5316\u8f93\u51fa\uff0c\u5176\u5e7f\u6cdb\u5e94\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f\uff1a</p> <ul> <li> <p>\u7f16\u7a0b\u6559\u5b66\uff1b</p> </li> <li> <p>\u6570\u636e\u5206\u6790\uff1b</p> </li> <li> <p>\u79d1\u5b66\u8ba1\u7b97\uff1b</p> </li> <li> <p>\u5e7b\u706f\u7247\u6f14\u793a\u3002</p> </li> </ul>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#32-jupyter-notebook\u7684\u4f7f\u7528","title":"3.2 jupyter notebook\u7684\u4f7f\u7528","text":"<pre><code># \u5b89\u88c5 Jupyter \u548c Jupyter Notebook \u5230\u60a8\u7684 Python \u73af\u5883\u4e2d\u3002\npip install jupyter\npip install jupyter notebook\n\n# \u5b89\u88c5 jupyter_contrib_nbextensions \u6269\u5c55\u5305\u3002\npip install jupyter_contrib_nbextensions\n\n#\u5b89\u88c5\u4e00\u4e9b\u63d2\u4ef6\u5e76\u542f\u7528\u63d2\u4ef6\u7ba1\u7406\u5668\njupyter nbextensions_configurator install --user\njupyter nbextensions_configurator enable --user\n</code></pre> <p>\u5f00\u542fjupyter</p> <p>1.Linux\u4e0b\uff0c\u6253\u5f00\u547d\u4ee4\u884c\uff0c\u91cd\u65b0\u751f\u6210\u4e00\u4e2ajupyter\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>$ jupyter notebook --generate-config\nWriting default config to: /home/hujianli/.jupyter/jupyter_notebook_config.py\n</code></pre> <p>2.\u4fee\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u627e\u5230\u8fd9\u4e2a\u65b0\u751f\u6210\u7684\u6587\u4ef6\uff1a</p> <ul> <li> <p>Linux: <code>/home/hujianli/.jupyter/jupyter_notebook_config.py</code></p> </li> <li> <p>Windows: <code>C:\\Users\\18793\\.jupyter\\jupyter_notebook_config.py</code></p> </li> </ul> <pre><code>\u641c\u7d22 NotebookApp.allow_password_change\uff0c\u6539\u4e3a\uff1aNotebookApp.allow_password_change=False \uff0c\u8bb0\u5f97\u53bb\u6389\u6ce8\u91ca\u7684#\n</code></pre> <p>3.\u56de\u5230Linuxs\u547d\u4ee4\u884c\uff0c\u8fd0\u884cjupyter notebook password <pre><code>$ jupyter notebook password\n\n# \u8f93\u5165\u4e24\u6b21\u5bc6\u7801,\u6211\u8fd9\u91cc\u8bbe\u7f6e123456 \u6d4b\u8bd5\u4f7f\u7528\nEnter password: Verify password: [NotebookPasswordApp] Wrote hashed password to /home/hujianli/.jupyter/jupyter_notebook_config.json\n</code></pre></p> <p>\u5728 jupyter_notebook_config.py \u4e2d\u627e\u5230\u4e0b\u9762\u7684\u884c\uff0c\u53d6\u6d88\u6ce8\u91ca\u5e76\u4fee\u6539\u3002</p> <pre><code>$ cat /home/hujianli/.jupyter/jupyter_notebook_config.py|grep -v \"^#\"|grep -v \"^$\"\nc.NotebookApp.allow_credentials = False\nc.NotebookApp.allow_password_change = False\n# \u661f\u53f7\u4ee3\u8868\u4efb\u610fip\uff0c\u8fd9\u4e2a\u8ddfmysql\u7684\u6743\u9650\u8bbe\u7f6e\u4e00\u6837\uff0c\u6240\u4ee5\u8bf4\u662f\u4e92\u901a\u7684\nc.NotebookApp.ip = '*'\nc.NotebookApp.notebook_dir = '/data/jupyter'\n#\u4e0d\u81ea\u52a8\u6253\u5f00\u6d4f\u89c8\u5668\nc.NotebookApp.open_browser = False\n#\u5c31\u662f\u628a\u751f\u6210\u7684\u5bc6\u7801json\u6587\u4ef6\u91cc\u9762\u7684\u4e00\u4e32\u5bc6\u7801\u653e\u8fd9\u91cc\nc.NotebookApp.password = 'argon2:$argon2id$v=19$m=10240,t=10,p=8$Fg1/ibZ7CifMOahxeKVefw$QCIAXslhaDonokdqoHXx+Q'\n#\u53ef\u81ea\u884c\u6307\u5b9a\u4e00\u4e2a\u7aef\u53e3, \u8bbf\u95ee\u65f6\u4f7f\u7528\u8be5\u7aef\u53e3\nc.NotebookApp.port = 9999\n</code></pre> <pre><code># \u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e--no-browser\u548c--ip=0.0.0.0 \u8fdb\u884c\u5916\u90e8\u8bbf\u95ee\u3002\u5982\u679c\u4e0d\u6307\u5b9aip\uff0c\u9ed8\u8ba4IP\u662flocalhost\uff0c\u4e5f\u5c31\u662f\u53ea\u6709\u672c\u5730\u624d\u80fd\u8bbf\u95ee\u3002\n# \u5f00\u542f\u65f6\uff0c\u81ea\u52a8\u5f39\u51fa\u6d4f\u89c8\u5668\njupyter notebook\n\n#\u540e\u53f0\u8fd0\u884c\uff1a\nnohup jupyter notebook &gt;~/jupyter.log 2&gt;&amp;1 &amp;\n</code></pre> <p>\u70b9\u51fbNbextensionsa\u5b89\u88c5\u63d2\u4ef6\u3002</p> <p>\u4e0b\u9762\u5217\u4e3e\u51e0\u4e2a\u6bd4\u8f83\u6709\u7528\u7684\u6269\u5c55</p> <pre><code>Code prettify\nCodefolding\nCollapsible Headings\nExecuteTime\nHighlight selected word\nHighlighter\nHinterland\nNotify\nScratchpad\nToggle all line numbers\nTable of Contents (2)\nVariable Inspector\ntable of content\nsnippets\ncodefolding\nautopep8\nhide input\nsplit cell notebook\nzenmode\n</code></pre> <p>jupyter-lab\u542f\u52a8\u4e00\u4e2a\u7c7b\u4f3c\u5728\u7ebf\u7f16\u8f91\u7684\u9875\u9762</p> <p>\u73a9\u8f6cJupyter Notebook2-(\u63a8\u835016\u4e2a\u8d85\u5b9e\u7528\u63d2\u4ef6)</p> <p>\u53c2\u8003\u6587\u732e</p> <p>Jupyter Notebook\u914d\u7f6e\u4f7f\u7528\u6559\u7a0b</p> <p>Jupyter Notebook\u5165\u95e8\u6559\u7a0b(\u8d85\u8be6\u7ec6)</p> <p>\u6ce3\u8840\u6574\u7406\uff0cJupyter Notebook\u6700\u5e38\u7528\u7684\u4e94\u5927\u914d\u7f6e\u6280\u5de7</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#4pycharm","title":"4.Pycharm","text":"<p>\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740: \u4f20\u9001\u95e8</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#41-pycharm\u6c38\u4e45\u7834\u89e3","title":"4.1 Pycharm\u6c38\u4e45\u7834\u89e3","text":"<p>\u7834\u89e3\u65b9\u5f0f\u53c2\u8003</p> <p>windows</p> <p>\u94fe\u63a5: https://pan.baidu.com/s/1JfoH4NSzf89AEXuFx9Li7g \u63d0\u53d6\u7801: 9j5h</p> <p>PyCharm 2020.1</p> <p>\u5b98\u7f51\uff1ahttps://www.jetbrains.com/pycharm/</p> <p>\u5b98\u7f51\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.jetbrains.com/pycharm/download/other.html</p> <p>\u4e0b\u8f7d\u94fe\u63a5\uff08Windows\uff09\uff1ahttps://download.jetbrains.com/python/pycharm-professional-2020.1.exe</p> <p>\u4e0b\u8f7d\u94fe\u63a5\uff08macOS\uff09\uff1ahttps://download.jetbrains.com/python/pycharm-professional-2020.1.dmg</p> <p>\u4e0b\u8f7d\u94fe\u63a5\uff08Linux\uff09\uff1ahttps://download.jetbrains.com/python/pycharm-professional-2020.1.tar.gz</p> <p>\u53c2\u8003\u6587\u732e</p> <p>python-pycharm windows\u5b89\u88c5</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#42-pycharm\u4e2d\u4f7f\u7528github","title":"4.2 Pycharm\u4e2d\u4f7f\u7528GitHub","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>https://www.cnblogs.com/feixuelove1009/p/5955332.html</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#43-pycharm\u5e38\u7528\u5feb\u6377\u952e\u5927\u5168","title":"4.3 Pycharm\u5e38\u7528\u5feb\u6377\u952e\u5927\u5168","text":"<p>Pycharm\u4e2d\u4e00\u4e9b\u4e0d\u4e3a\u4eba\u77e5\u7684\u6280\u5de7</p> \u529f\u80fd \u8bf4\u660e \u5feb\u901f\u67e5\u627e\u6587\u4ef6 \u7528\u5feb\u6377<code>Ctrl + E</code>\u53ef\u6253\u5f00\u6700\u8fd1\u8bbf\u95ee\u8fc7\u7684\u6587\u4ef6\u6216\u8005\u7528<code>Ctrl+Shift+E</code>\u6253\u5f00\u6700\u8fd1\u7f16\u8f91\u8fc7\u7684\u6211\u6587\u4ef6 \u4e07\u80fd\u641c\u7d22 \u8fde\u7eed\u6309\u4e24\u4e0b Shitf \u952e\u53ef\u4ee5\u641c\u7d22\u6587\u4ef6\u540d\u3001\u7c7b\u540d\u3001\u65b9\u6cd5\u540d\uff0c\u8fd8\u53ef\u4ee5\u641c\u7d22\u76ee\u5f55\u540d\uff0c\u641c\u7d22\u76ee\u5f55\u7684\u6280\u5de7\u662f\u5728\u5728\u5173\u952e\u5b57\u524d\u9762\u52a0\u659c\u6760/\u3002 \u5168\u5c40\u9879\u76ee\u8303\u56f4\u5185\u641c\u7d22\u6587\u4ef6\u91cc\u9762\u7684\u5173\u952e\u5b57 <code>Ctrl + Shfit + F</code>\uff0c\u6216\u8005 <code>Ctrl + Shfit + R</code>\u5168\u5c40\u66ff\u6362 \u5386\u53f2\u7c98\u8d34\u7248 <code>Ctrl + Shift + V</code>\u53ef\u8bbf\u95ee\u5386\u53f2\u7c98\u8d34\u677f \u5206\u5272\u7a97\u53e3 Pycharm\u7684\u9ed8\u8ba4\u914d\u7f6e\u6ca1\u6709\u8bbe\u7f6e\u5206\u5272\u7684\u5feb\u6377\u952e,\u4f60\u53ef\u4ee5\u5728Settings\u4e2d\u7684Keymap\u81ea\u5b9a\u4e49\u5feb\u6377\u952e \u667a\u80fd\u63d0\u793a \u4f7f\u7528<code>Alt + Enter</code>\u667a\u80fd\u63d0\u793a\u4f60\u9009\u62e9\u5408\u9002\u7684\u64cd\u4f5c \u4efb\u610f\u4f4d\u7f6e\u6362\u884c \u4f7f\u7528<code>Shfit + Enter</code>\u53e6\u8d77\u4e00\u884c\uff0c\u8fd9\u6837\u65e0\u9700\u628a\u5149\u6807\u79fb\u5230\u672b\u5c3e\u53bb\u64cd\u4f5c \u5355\u884c\u6267\u884c\u67d0\u6bb5\u4ee3\u7801 \u5355\u884c\u6267\u884c\uff1a\u9009\u4e2d\u4ee3\u7801\u7136\u540e<code>alt +shift + e</code> <p>Pycharm\u6559\u7a0b</p> <p>20\u4e2aPycharm\u6700\u5b9e\u7528\u6700\u9ad8\u6548\u7684\u5feb\u6377\u952e(\u52a8\u6001\u5c55\u793a)</p> <p>Pycharm\u6559\u7a0b</p> <ol> <li>\u683c\u5f0f\u5316\u4ee3\u7801 \u3010Ctrl + Alt + L\u3011</li> <li>\u591a\u884c\u4ee3\u7801\u5408\u5e76\u4e3a\u4e00\u884c\u3010Crtl+Shift+J\u3011</li> <li>\u4fee\u6b63\u62a5\u8b66\u544a\u7684\u4ee3\u7801\u3010Ctrl + Enter\u3011</li> <li>\u5f53\u51fa\u73b0\u9ec4\u8272\u6ce2\u6d6a\u53f7\u65f6\uff0c\u53ef\u4ee5\u5728\u5bf9\u5e94\u4ee3\u7801\u51fa\u6309\u4e0b\u3010Ctrl + Enter\u3011\u8fdb\u884c\u4fee\u6b63\u4ee3\u7801\u7684\u64cd\u4f5c        \u6309\u4e0b\u540e\uff0c\u4f1a\u6709\u591a\u79cd\u9009\u62e9\u4f9b\u4f60\u4fee\u6b63\uff0c\u5305\u62ec:\u683c\u5f0f\u5316\u4ee3\u7801\uff0c\u5ffd\u7565\u8be5\u8b66\u544a\uff0c\u81ea\u52a8\u4fee\u6539\u4ee3\u7801\u7b49    </li> <li>\u5305\u88c5\u4ee3\u7801\u3010Crtl+Alt+T\u3011</li> <li>\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u7684\u4e3a\u8f93\u5165\u7684\u4ee3\u7801\u6dfb\u52a0if\u3001while\u3001\u6355\u83b7\u5f02\u5e38\u7b49\u6761\u4ef6.\u6211\u4eec\u9009\u4e2d\u8be5\u4ee3\u7801\u540e\u6309\u4e0b\u3010Crtl+Alt+T\u3011\u4f1a\u5f39\u7a97\u8ba9\u6211\u4eec\u9009\u62e9\u8981\u5305\u88c5\u7684\u6761\u4ef6\uff0c\u4f8b\u5982\u9009\u62e9\u3010try/except\u3011</li> <li>\u5feb\u901f\u6ce8\u91ca/\u53d6\u6d88\u6ce8\u91ca\u3010Crtl+/\u3011</li> <li>\u5411\u53f3\u7f29\u8fdb\u4e00\u4e2a\u5236\u8868\u4f4d\u3010Tab\u3011</li> <li>\u5411\u5de6\u7f29\u8fdb\u4e00\u4e2a\u5236\u8868\u4f4d\u3010Shift + Tab\u3011</li> <li>\u5728\u4e0a\u65b9\u63d2\u5165\u65b0\u884c\u3010Ctrl + Alt + Enter\u3011</li> <li>\u5728\u4e0b\u65b9\u63d2\u5165\u65b0\u884c\u3010Shift + Enter\u3011</li> <li>\u4e0a\u4e0b\u79fb\u52a8\u9009\u4e2d\u4ee3\u7801\u3010Alt + Shift + \u4e0a\u3001\u4e0b\u952e\u3011</li> <li>\u4e0a\u4e0b\u79fb\u52a8\u9009\u4e2d\u65b9\u6cd5\u4f53\u3010Ctrl + Shift + \u4e0a\u3001\u4e0b\u952e\u3011</li> <li>\u590d\u5236\u4ee3\u7801\u3010Ctrl + D\u3011</li> <li>\u6298\u53e0\u4ee3\u7801\u3010Ctrl + -\u3011</li> <li>\u5c55\u5f00\u4ee3\u7801\u3010Ctrl + +\u3011</li> <li>\u5c06\u4ee3\u7801\u62bd\u53d6\u4e3a\u4e00\u4e2a\u65b9\u6cd5\u3010Ctrl + Shift+M\u3011</li> <li>\u91cd\u547d\u540d\u6587\u4ef6\u3010Shift+F6\u3011</li> <li>\u67e5\u627e\u7c7b\u88ab\u5f15\u7528\u7684\u5730\u65b9\u3010Ctrl+N\u3011<ol> <li>\u6309\u4e0b\u3010Ctrl+N\u3011\u8f93\u5165\u7c7b\u7684\u5173\u952e\u5b57\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u88ab\u5f15\u7528\u7684\u7c7b\uff0c\u70b9\u51fb\u5bf9\u5e94\u7684\u6761\u76ee\u53ef\u8df3\u8f6c\u5230\u5bf9\u5e94\u6587\u4ef6</li> </ol> </li> <li>\u67e5\u627e/\u5168\u5c40\u67e5\u627e\u3010Ctrl+F / Ctrl + Shift+F\u3011<ol> <li>\u5f53\u524d\u6587\u4ef6\u7684\u67e5\u627e\u53ef\u4ee5\u6309\u4e0b\u3010Ctrl+F \u3011\u5e76\u8f93\u5165\u8981\u67e5\u627e\u7684\u5173\u952e\u5b57\u5c31\u4f1a\u9ad8\u4eae\u5305\u542b\u5173\u952e\u5b57\u7684\u4ee3\u7801</li> <li>\u70b9\u51fb\u56fe\u4e2d\u7ea2\u6b3e\u7684\u7bad\u5934\uff0c\u53ef\u4ee5\u9010\u884c\u67e5\u770b\u5305\u542b\u5173\u952e\u5b57\u7684\u4ee3\u7801\uff1b\u53e6\u5916\uff0c\u6309\u4e0b\u3010Shift + F3\u3011\u6216\u3010F3\u3011\u4e5f\u53ef\u4ee5\u5b9e\u73b0\uff01</li> <li>\u5168\u5c40\u67e5\u8be2\u7684\u8bdd\u6309\u4e0b\u3010Ctrl + Shift+F\u3011\u5373\u53ef\uff01</li> </ol> </li> <li>\u66ff\u6362/\u5168\u5c40\u66ff\u6362\u3010Ctrl+R / Ctrl + Shift+R\u3011</li> <li>\u5feb\u901f\u8df3\u8f6c\u62a5\u9519\u7684\u4ee3\u7801\u3010F2\u3011</li> <li>\u5b9a\u4e49\u4e00\u4e2a\u4e66\u7b7e\u3010F11\u3011<ol> <li>\u5728\u76f8\u5e94\u4ee3\u7801\u5904\u6309\u4e0b\u3010F11\u3011\u53ef\u4ee5\u5c06\u5176\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u4e66\u7b7e</li> <li>\u518d\u6309\u4e0b\u3010Shift+F11\u3011\uff0c\u53ef\u4ee5\u67e5\u770b\u4e66\u7b7e\u5bf9\u5e94\u7684\u4ee3\u7801</li> </ol> </li> <li>\u4ee3\u7801\u5c0f\u5199\u8f6c\u5927\u5199\u3010Ctrl + Shift+U\u3011</li> <li>\u8fdb\u5165\u4e00\u4e2a\u65b9\u6cd5\u3010Ctrl + B / Ctrl +\u9f20\u6807\u5de6\u952e\u3011</li> <li>\u5feb\u6377\u67e5\u770b\u65b9\u6cd5\u7684\u5b9e\u73b0(\u6e90\u7801)\u3010Ctrl + Shift + I\u3011</li> <li>\u67e5\u770b\u6587\u6863\u63cf\u8ff0\u3010Ctrl + Q\u3011</li> <li>\u67e5\u770b\u6587\u4ef6\u4e2d\u7684\u65b9\u6cd5\u3010Ctrl + F12\u3011<ol> <li>\u6309\u4e0b\u3010Ctrl + F12\u3011\u53ef\u4ee5\u770b\u8be5\u6587\u4ef6\u4e2d\u6709\u54ea\u4e9b\u65b9\u6cd5\u3001\u7c7b</li> </ol> </li> <li>\u6700\u8fd1\u7f16\u8f91\u7684\u6587\u4ef6\u5217\u8868\u3010Ctrl + E\u3011 </li> <li>\u5feb\u6377\u8fd0\u884c\u4ee3\u7801\u3010Shift + F10\u3011<ol> <li>\u5feb\u6377\u8fd0\u884c\u5f53\u524d\u6587\u4ef6\u4ee3\u7801</li> </ol> </li> <li>\u5feb\u6377\u8c03\u8bd5\u4ee3\u7801\u3010Shift + F9\u3011 </li> <li>\u5355\u884c\u6267\u884c\u67d0\u6bb5\u4ee3\u7801<ol> <li>\u5355\u884c\u6267\u884c\uff1a\u9009\u4e2d\u4ee3\u7801\u7136\u540e\u3010Alt +Shift + e\u3011</li> </ol> </li> <li>\u67e5\u770b\u5386\u53f2\u7c98\u8d34\u590d\u5236\u8bb0\u5f55\u3010Ctrl + Shift+ V\u3011</li> <li>\u667a\u80fd\u63d0\u793a<ol> <li>\u667a\u80fd\u63d0\u793a\u662f IDE \u7684\u6807\u914d\u529f\u80fd\uff0cPycharm \u9ed8\u8ba4\u6709\u81ea\u52a8\u63d0\u793a\u529f\u80fd\uff0c\u4f46\u662f\u8fd8\u4e0d\u591f\u667a\u80fd\uff0c\u6bd4\u5982\u8981\u4f7f\u7528\u8fd8\u6ca1\u6709\u5f15\u5165\u5230\u6a21\u5757\u5219\u6ca1\u6cd5\u81ea\u52a8\u63d0\u793a\u4e86\uff0c\u4f7f\u7528 Alt + Enter \u667a\u80fd\u63d0\u793a\u4f60\u9009\u62e9\u5408\u9002\u7684\u64cd\u4f5c\u3002</li> </ol> </li> <li>\u5feb\u6377\u5207\u6362\u89c6\u56fe/\u76ee\u5f55\u3010Ctrl + Tab\u3011</li> <li>\u67e5\u770b\u6700\u8fd1\u66f4\u6539\u3010Alt + Shift + C\u3011</li> <li>\u5c06\u5149\u6807\u79fb\u52a8\u5230\u4ee3\u7801\u884c\u5c3e\u3010End\u3011<ol> <li>\u5f53\u4f60\u7684\u4ee3\u7801\u5f88\u957f\u7684\u65f6\u5019\uff0c\u5df2\u7ecf\u8d85\u8fc7\u5c4f\u5e55\u663e\u793a\u8303\u56f4\u4e86\uff01 \u53ef\u4ee5\u6309\u4e0b\u3010End\u3011(\u7b14\u8bb0\u672c\u4e00\u822c\u4e3a\u3010Fn+End\u3011)\u53ef\u4ee5\u8df3\u8f6c\u5230\u884c\u5c3e</li> <li>\u6309\u4e0b\u3010Home\u3011(\u7b14\u8bb0\u672c\u4e00\u822c\u4e3a\u3010Fn+Home\u3011)\u53ef\u56de\u5230\u884c\u9996\uff01</li> </ol> </li> <li>\u5168\u9009\u4e00\u884c\u5e76\u79fb\u81f3\u884c\u5c3e\u3010Shift + End\u3011</li> <li>\u5c06\u5149\u6807\u79fb\u52a8\u5230\u65b9\u6cd5\u4f53\u6216\u5faa\u73af\u7684\u5f00\u59cb\u3010Ctrl + {\u3011<ol> <li>\u5f53\u4f60\u7684\u65b9\u6cd5\u6216\u5faa\u73af\u4f53\u5f88\u957f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6309\u4e0b\u3010Ctrl + {\u3011\u56de\u5230\u51fd\u6570\u6216\u5faa\u73af\u5934</li> </ol> </li> <li>\u5c06\u5149\u6807\u79fb\u52a8\u5230\u65b9\u6cd5\u4f53\u6216\u5faa\u73af\u7684\u7ed3\u675f\u3010Ctrl + \uff5d\u3011<ol> <li>\u5f53\u4f60\u7684\u65b9\u6cd5\u6216\u5faa\u73af\u4f53\u5f88\u957f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6309\u4e0b\u3010Ctrl + }\u3011\u56de\u5230\u51fd\u6570\u5c3e\u6216\u5faa\u73af\u5c3e</li> </ol> </li> <li>\u6700\u5927\u5316\u7f16\u8f91\u4ee3\u7801\u7a97\u53e3\u3010Ctrl + Shift + F12\u3011</li> <li>\u5feb\u6377\u6dfb\u52a0\u4ee3\u7801\u3010Ctrl + J\u3011</li> </ol> <p>Pycharm \u5e38\u7528\u5feb\u6377\u952e</p> <p>https://mp.weixin.qq.com/s/1KNb8QCa1dPu8fAi41Ci9A https://www.cnblogs.com/mollyviron/p/9297381.html https://www.2bboy.com/archives/153.html</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#44-pycharm\u63d2\u4ef6","title":"4.4 Pycharm\u63d2\u4ef6","text":"<ol> <li>Chinese (Simplified) Language Pack: \u4e2d\u6587\u8bed\u8a00\u5305\u3002</li> <li>.ignore: \u901a\u8fc7\u6a21\u677f\uff0c\u5feb\u6377\u751f\u6210\u5e38\u89c1\u7684\u5ffd\u7565\u6587\u4ef6\u3002</li> <li>Material Theme UI: Material Theme UI\u4e5f\u662f\u4e00\u4e2a\u901a\u7528\u7684UI\u4e3b\u9898\uff0c\u7f8e\u5316UI \u754c\u9762\uff0c\u514d\u8d39\u7248\u63d0\u4f9b\u7684\u529f\u80fd\u8db3\u591f\u4f7f\u7528\u3002</li> <li>Atom Material Icons: \u7f8e\u5316Pycharm \u56fe\u6807\u3002</li> <li>Translation: \u7ffb\u8bd1\u3002</li> <li>CodeGlance Pro: \u4ee3\u7801\u5c0f\u5730\u56fe\u5d4c\u5165\u5230\u7f16\u8f91\u5668\u7a97\u683c\u4e2d\u3002 \u4f7f\u7528\u81ea\u5b9a\u4e49\u989c\u8272\u8fdb\u884c\u8bed\u6cd5\u9ad8\u4eae\uff0c\u540c\u65f6\u4f7f\u7528\u660e\u6697\u4e3b\u9898\u3002</li> <li>Key Promoter X: \u5982\u4f55\u7528\u952e\u76d8\u952e\u66ff\u6362\u7e41\u7410\u7684\u9f20\u6807\u5de5\u4f5c\u3002</li> <li>Json Parser: \u5728\u53f3\u4fa7\u6709\u663e\u793a\uff0cJSON Parser\u662f\u4e00\u4e2a\u7528\u4e8e\u9a8c\u8bc1\u548c\u683c\u5f0f\u5316JSON\u5b57\u7b26\u4e32\u7684\u8f7b\u91cf\u7ea7\u63d2\u4ef6\u3002</li> <li>Rainbow Brackets: \u901a\u8fc7\u989c\u8272\uff0c\u5feb\u901f\u533a\u5206\u62ec\u53f7\u5bf9\u5e94\u7684\u4ee3\u7801\u5757\u3002</li> <li>Git Commit Template: \u53c2\u8003\u88ab\u63d0\u5021\u7684git cimmit \u89c4\u8303\u3002</li> <li>GitToolBox: \u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u5f88\u65b9\u4fbf\u7684\u83b7\u53d6git commit \u4fe1\u606f\u3002</li> <li>kubernetes\uff1aKubernetes support</li> <li>Jenkins Pipeline Linter: Jenkinsfile\u6587\u4ef6\u8bed\u6cd5\u68c0\u67e5</li> <li>Python smart execute: \u9009\u4e2d\u6d4b\u8bd5\u90e8\u5206\u4ee3\u7801\uff0c\u53f3\u952e execute\uff0c\u5728\u63a7\u5236\u53f0debug\u9009\u4e2d\u90e8\u5206\u4ee3\u7801</li> <li>Requirements: \u68c0\u6d4bpip\u5e93\u7248\u672c\u4fe1\u606f</li> <li>ReST Console: \u6d4b\u8bd5API\u63a5\u53e3</li> <li>Reloadium: Python\u70ed\u91cd\u8f7d\u8c03\u8bd5\u5de5\u5177\u3002\u5b83\u53ef\u4ee5\u5728\u4e0d\u91cd\u65b0\u8fd0\u884c\u7a0b\u5e8f\u7684\u524d\u63d0\u4e0b\uff0c\u67e5\u770b\u7a0b\u5e8f\u4fee\u6539\u540e\u7684\u8fd0\u884c\u6548\u679c </li> <li>.env files support: \u914d\u7f6e\u6587\u4ef6\u652f\u6301</li> <li>Json parse: json\u5b57\u7b26\u5728\u7ebf\u683c\u5f0f\u6821\u9a8c</li> <li>aiXcoder Code Completer </li> <li>Tabnine AI code completion</li> </ol>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#45-pycharm\u6587\u4ef6\u81ea\u52a8\u6dfb\u52a0\u8bf4\u660e","title":"4.5 Pycharm\u6587\u4ef6\u81ea\u52a8\u6dfb\u52a0\u8bf4\u660e","text":"<ol> <li>\u6253\u5f00pycharm\uff0c\u9009\u62e9File-Settings </li> <li>\u4f9d\u6b21\u9009\u62e9Editor--Color&amp;Style--File and Templates--Python-Script\uff0c\u5e76\u5728\u56fe\u4e2d\u7f16\u8f91\u6a21\u677f\u5185\u5bb9 </li> </ol> <pre><code># -*- coding:utf8 -*-\n# @Time    : ${DATE} ${TIME}\n# @Author  : ${USER}\n# @File    : ${NAME}.py\n# @Software: ${PRODUCT_NAME}\n# @Desc    :   \n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#46-pycharm\u8fdc\u7a0b\u5f00\u53d1\u8c03\u8bd5","title":"4.6 Pycharm\u8fdc\u7a0b\u5f00\u53d1\u8c03\u8bd5","text":"<p>Pycharm\u8fdc\u7a0b\u5f00\u53d1\u8c03\u8bd5</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#47-webstrom\u63d2\u4ef6","title":"4.7 webstrom\u63d2\u4ef6","text":"<ol> <li>HighlightBracketPair: \u9ad8\u4eae\u62ec\u53f7</li> <li>IntelliVue: Vue\u529f\u80fd\u589e\u5f3a</li> <li>npm-dependency-checker: \u68c0\u6d4b\u5305\u7248\u672c\u4fe1\u606f</li> </ol>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#5-vscode","title":"5. VSCode","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#51-\u8f6f\u4ef6\u51c6\u5907","title":"5.1 \u8f6f\u4ef6\u51c6\u5907","text":"<p>\u9274\u4e8e PyCharm \u662f\u6536\u8d39\u7684\u5de5\u5177\uff0c\u4e0d\u5c11\u540c\u5b66\u5728\u60f3\u65b9\u8bbe\u6cd5\u5bfb\u627e\u7834\u89e3\u4e4b\u6cd5\u3002</p> <p>\u800c VSCode \u662f\u514d\u8d39\u5f00\u6e90\u7684\u5de5\u5177\uff0c\u5e76\u4e14\u662f\u5fae\u8f6f\u65d7\u4e0b\u4ea7\u54c1\uff0c\u5982\u679c\u80fd\u591f\u5ab2\u7f8e PyCharm \u7684\u8bdd\uff0c\u4e5f\u4e0d\u5931\u4e3a\u4e00\u4e2a\u826f\u597d\u7684\u9009\u62e9\u3002</p> <p>VSCode \u662f\u4e00\u4e2a\u76f8\u5f53\u4f18\u79c0\u7684 IDE \uff0c\u5177\u5907\u5f00\u6e90\u3001\u8de8\u5e73\u53f0\u3001\u6a21\u5757\u5316\u3001\u63d2\u4ef6\u4e30\u5bcc\u3001\u542f\u52a8\u65f6\u95f4\u5feb\u3001\u989c\u503c\u9ad8\u3001\u53ef\u9ad8\u5ea6\u5b9a\u5236\u7b49\u7b49\u4f18\u79c0\u7684\u7279\u8d28\uff0c\u6700\u8fd1\u51e0\u5e74\u6d41\u884c\u5ea6\u4e5f\u662f\u8d8a\u6765\u8d8a\u9ad8\u3002</p> <p>\u4eca\u5929\u6765\u8ddf\u5927\u5bb6\u5206\u4eab\u4e0b\u5728 VSCode \u4e0b\u914d\u7f6e\u548c\u4f7f\u7528 Python \uff0c\u4f5c\u4e3a\u5bf9 PyCharm \u7684\u66ff\u4ee3\u9009\u62e9\u4e4b\u4e00\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#52-python\u5b89\u88c5","title":"5.2 Python\u5b89\u88c5","text":"<p>\u5173\u4e8e Python \u7684\u5b89\u88c5\uff0c\u53ef\u4ee5\u4ece Python \u5b98\u7f51\u4e0b\u8f7d Python \u8fdb\u884c\u5b89\u88c5\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 Anaconda \u6765\u5b89\u88c5\uff0c\u5efa\u8bae\u76f4\u63a5\u5b89\u88c5<code>Anaconda</code>\u3002</p> <p><code>Anaconda</code>\u662f\u4e00\u4e2a\u5f00\u6e90\u7684 Python \u53d1\u884c\u7248\u672c\uff0c\u5176\u5305\u542b\u4e86 conda \u3001 Python \u7b49 100 \u591a\u4e2a\u79d1\u5b66\u5305\u53ca\u5176\u4f9d\u8d56\u9879\u3002</p> <p>Anaconda \u5b98\u65b9\u7f51\u7ad9\u4e0b\u8f7d\u5730\u5740\u5982\u4e0b\uff1a https://www.anaconda.com/products/individual</p> <p>\u5728\u7f16\u5199\u6b64\u6587\u65f6\uff0c Anaconda \u5bf9\u5e94\u7684 Python \u7248\u672c\u662f Python 3.8 \uff0c\u5927\u5bb6\u53ef\u4ee5\u4e0b\u8f7d\u8ddf\u7535\u8111\u7cfb\u7edf\u5bf9\u5e94\u7684\u7248\u672c\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u66f4\u591a\u53c2\u8003</p> <p>conda\u7684\u5b89\u88c5\u4e0e\u4f7f\u7528 2.0\u7248</p> <p>conda\u5e38\u7528\u547d\u4ee4</p> <p>Python\u8f6f\u4ef6\u5305\u53ca\u73af\u5883\u7ba1\u7406\u5668conda\u5b9e\u6218\u7bc7</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#53-vscode\u5b89\u88c5","title":"5.3 VSCode\u5b89\u88c5","text":"<p>\u5173\u4e8e VS Code\u5b89\u88c5\uff0c\u5728\u5fae\u8f6f\u5b98\u65b9\u7f51\u7ad9\uff1a</p> <p>\u63d0\u4f9b\u514d\u8d39\u4e0b\u8f7d\uff0c </p> <p>https://code.visualstudio.com</p> <p>VS Code \u652f\u6301 Windows, Linux , Mac OS \u4e09\u79cd\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5efa\u8bae\u53bb\u5b98\u65b9\u4e0b\u8f7d\uff0c\u4e0d\u8981\u5728\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u4e0b\u8f7d\u7f51\u7ad9\u4e0b\u8f7d\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#54-\u5728\u7ec8\u7aef\u8fd0\u884c\u7a0b\u5e8f","title":"5.4 \u5728\u7ec8\u7aef\u8fd0\u884c\u7a0b\u5e8f","text":"<p>\u5728\u6ca1\u6709\u5b89\u88c5\u5176\u4ed6 Python \u63d2\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728 VSCode \u4e2d\u901a\u8fc7\u4f7f\u7528\u7ec8\u7aef(Terminal)\u76f4\u63a5\u8fd0\u884cpython\u4ee3\u7801,\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u7701\u53bb\u914d\u7f6e\u8fc7\u7a0b\u3002</p> <p>\u5728 VS Code \u83dc\u5355\u680f\u9009\u62e9 \u201cview - Terminal\u201d \uff08\u4e2d\u6587\u83dc\u5355\uff1a\u67e5\u770b \u2014 \u7ec8\u7aef\uff09\uff0c\u6216\u8005\u76f4\u63a5\u5feb\u6377\u952e<code>\u300c Ctrl + \u2018 \u300d</code>\u6253\u5f00\u7ec8\u7aef\uff0c\u4f1a\u5728\u4e0b\u65b9\u4ea7\u751f\u4e00\u4e2a CMD \u63a7\u5236\u53f0\u3002</p> <p>\u53ef\u4ee5\u5728\u7ec8\u7aef\u4e2d\u901a\u8fc7\u8f93\u5165<code>python xxx.py</code>\u6765\u8fd0\u884c\u7a0b\u5e8f\uff0c\u6548\u679c\u5982\u4e0b\uff1a <pre><code>$ python3 hello-world.py Hello world\n</code></pre></p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#55-python\u73af\u5883\u914d\u7f6e","title":"5.5 Python\u73af\u5883\u914d\u7f6e","text":"<p>\u4e0b\u9762\u4ecb\u7ecd\u4e0b\u51e0\u4e2a\u5e38\u7528\u7684\u63d2\u4ef6\uff1a</p> <p>python\u76f8\u5173</p> <ul> <li>python:\u63d0\u4f9b\u4e86\u4ee3\u7801\u5206\u6790\uff0c\u9ad8\u4eae\uff0c\u89c4\u8303\u5316\uff0c\u4ee5\u53ca\u91cd\u6784\u7b49\u5f88\u591a\u57fa\u672c\u529f\u80fd</li> <li>Pylance \uff1a\u7c7b\u578b\u4fe1\u606f\u3001\u81ea\u52a8\u5bfc\u5165\u3001\u7c7b\u578b\u68c0\u67e5\u8bca\u65ad\u7b49\u76f8\u5173\u529f\u80fd</li> <li>koroFileHeader\uff1a\u6587\u4ef6\u5934\u6ce8\u91ca\uff08ctrl+alt+i\uff09 \u548c\u51fd\u6570\u5934\u6ce8\u91ca\uff08ctrl+alt+t\uff09\u5feb\u6377\u5de5\u5177\uff0c\u4f7f\u7528\u5feb\u6377\u952e\u4e00\u952e\u751f\u6210\uff1b</li> <li>Gitlens\uff1a\u53ef\u4ee5\u5e2e\u52a9\u4f60\u7ba1\u7406github\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u5386\u53f2\u8bb0\u5f55</li> <li>Settings Sync\uff1a\u81ea\u52a8\u5c06VS code\u7684\u914d\u7f6e\u4e0a\u4f20\u5230</li> <li>Pylnit:\u5feb\u6377\u751f\u6210_init_\u6587\u4ef6\u3002</li> <li>run code:\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\uff0c\u53f3\u952e\u7a0b\u5e8f\u53ef\u4ee5\u7528\u201crun code\"\u547d\u4ee4\u6765\u8fd0\u884c\u591a\u79cd\u7a0b\u5e8f\uff08\u51e0\u4e4e\u6240\u6709\uff09\u3002</li> <li>PYQT Integration\uff1a\u5728VS code\u4e2d\u7f16\u7801PyQt\u6587\u4ef6\u3002</li> </ul> <p>\u524d\u7aef\u76f8\u5173</p> <ul> <li>Auto Rename Tag\uff1a\u91cd\u547d\u540d\u4e00\u4e2aHTML / XML\u6807\u7b7e\u65f6\uff0c\u81ea\u52a8\u91cd\u547d\u540d\u914d\u5bf9\u7684HTML / XML\u6807\u7b7e\u3002</li> <li>Beautify:\u5728VS code\u4e2d\u7f8e\u5316javascript\uff0cJSON\uff0cCSS\uff0cSass\u548cHTML\u3002</li> <li>Easy LESS:\u6bcf\u6b21\u4fdd\u5b58less\u6587\u4ef6\u65f6\uff0c\u81ea\u52a8\u751f\u6210\u4e00\u4e2acss\u6587\u4ef6\u3002</li> <li>HTML Preview\uff1a\u5728vs code\u4e2d\u9884\u89c8html\u6587\u4ef6\u3002</li> <li>JS-CSS-HTML Formatter\uff1a\u6b64\u6269\u5c55\u7a0b\u5e8f\u5305\u88c5\u4e86js-beautify\uff0c\u53ef\u4ee5\u683c\u5f0f\u5316JS\uff0cCSS\uff0cHTML\uff0cJSON\u6587\u4ef6\u3002</li> <li>Prettier - Code formatter\uff1a\u652f\u6301\u591a\u79cd\u524d\u7aef\u4ee3\u7801\u7684\u683c\u5f0f\u5316\u3002</li> <li>px to rem &amp; rpx (cssrem)\uff1a\u5728\u5355\u4f4dpx\u548crem\u95f4\u76f8\u4e92\u8f6c\u5316\u3002</li> <li>Vetur\uff1a\u7f8e\u5316VUE\u4ee3\u7801\u7684\u6a21\u5757\uff0c\u652f\u6301\u9ad8\u4eae\uff0c\u683c\u5f0f\u5316\uff0c\u9519\u8bef\u68c0\u67e5\u7b49\u529f\u80fd\u3002</li> </ul> <p>vscode\u4e00\u4e9b\u5e38\u7528\u7684\u8bbe\u7f6e</p> <pre><code>{\n\"workbench.colorTheme\": \"Default Dark+\",\n\"workbench.iconTheme\": \"material-icon-theme\",\n\"git.enableSmartCommit\": true,\n\"editor.bracketPairColorization.enabled\": true,\n\"editor.guides.bracketPairs\":\"active\",\n\"editor.tabSize\": 2,\n\"editor.detectIndentation\": false,\n\"editor.formatOnSave\": true,\n\"editor.formatOnType\": true,\n\"editor.formatOnPaste\": true,\n\"editor.mouseWheelZoom\": true,\n\"editor.defaultFormatter\": \"esbenp.prettier-vscode\",\n\"editor.fontSize\": 16,\n\"editor.rulers\": [\n120,\n],\n\"workbench.colorCustomizations\": {\n\"editorRuler.foreground\": \"#ff4081\"\n},\n\"editor.suggestSelection\": \"first\",\n\"files.autoGuessEncoding\": true,\n\"files.autoSave\": \"afterDelay\",\n\"terminal.integrated.inheritEnv\": false,\n\"vetur.experimental.templateInterpolationService\": true,\n\"[typescript]\": {\n\"editor.tabSize\": 2\n},\n\"[javascript]\": {\n\"editor.tabSize\": 2\n},\n\"[python]\": {\n\"editor.tabSize\": 4,\n\"editor.defaultFormatter\": \"ms-python.python\"\n},\n\"python.languageServer\": \"Pylance\",\n\"python.formatting.provider\": \"yapf\",\n\"python.autoComplete.addBrackets\": true,\n\"python.linting.flake8Args\": [\"--ignore=E501\"],\n\"python.linting.flake8Enabled\": true,\n\"python.linting.pylintEnabled\": false,\n\"tabnine.experimentalAutoImports\": true,\n\"[shellscript]\": {\n\"editor.defaultFormatter\": \"foxundermoon.shell-format\"\n},\n\"[dockerfile]\": {\n\"editor.defaultFormatter\": \"ms-azuretools.vscode-docker\"\n},\n\"vs-kubernetes\": {\n\"vs-kubernetes.crd-code-completion\": \"disabled\"\n},\n\"code-runner.clearPreviousOutput\": true,\n\"jenkins.pipeline.linter.connector.url\": \"http://106.xx.xx.8:30088/pipeline-model-converter/validate\",\n\"jenkins.pipeline.linter.connector.token\": \"xxxxx\",\n\"jenkins.pipeline.linter.connector.user\": \"admin\",\n// \u5934\u90e8\u6ce8\u91ca\n\"fileheader.customMade\": {\n// Author\u5b57\u6bb5\u662f\u6587\u4ef6\u7684\u521b\u5efa\u8005 \u53ef\u4ee5\u5728specialOptions\u4e2d\u66f4\u6539\u7279\u6b8a\u5c5e\u6027\n// \u516c\u53f8\u9879\u76ee\u548c\u4e2a\u4eba\u9879\u76ee\u53ef\u4ee5\u914d\u7f6e\u4e0d\u540c\u7684\u7528\u6237\u540d\u4e0e\u90ae\u7bb1 \u641c\u7d22: gitconfig includeIf  \u6bd4\u5982: https://ayase.moe/2021/03/09/customized-git-config/\n// \u81ea\u52a8\u63d0\u53d6\u5f53\u524dgit config\u4e2d\u7684: \u7528\u6237\u540d\u3001\u90ae\u7bb1\n// \"Author\": \"git config user.name &amp;&amp; git config user.email\", // \u540c\u65f6\u83b7\u53d6\u7528\u6237\u540d\u4e0e\u90ae\u7bb1\n// \"Author\": \"git config user.name\", // \u4ec5\u83b7\u53d6\u7528\u6237\u540d\n// \"Author\": \"git config user.email\", // \u4ec5\u83b7\u53d6\u90ae\u7bb1\n\"Author\": \"hujianli@oschina.cn\", // \u5199\u6b7b\u7684\u56fa\u5b9a\u503c \u4e0d\u4ecegit config\u4e2d\u83b7\u53d6\n\"Date\": \"Do not edit\", // \u6587\u4ef6\u521b\u5efa\u65f6\u95f4(\u4e0d\u53d8)\n// LastEditors\u3001LastEditTime\u3001FilePath\u5c06\u4f1a\u81ea\u52a8\u66f4\u65b0 \u5982\u679c\u89c9\u5f97\u65f6\u95f4\u66f4\u65b0\u7684\u592a\u9891\u7e41\u53ef\u4ee5\u4f7f\u7528throttleTime(\u9ed8\u8ba4\u4e3a1\u5206\u949f)\u914d\u7f6e\u66f4\u6539\u66f4\u65b0\u65f6\u95f4\u3002\n// \"LastEditors\": \"git config user.name &amp;&amp; git config user.email\", // \u6587\u4ef6\u6700\u540e\u7f16\u8f91\u8005 \u4e0eAuthor\u5b57\u6bb5\u4e00\u81f4\n// \u7531\u4e8e\u7f16\u8f91\u6587\u4ef6\u5c31\u4f1a\u53d8\u66f4\u6700\u540e\u7f16\u8f91\u65f6\u95f4\uff0c\u591a\u4eba\u534f\u4f5c\u4e2d\u5408\u5e76\u7684\u65f6\u5019\u4f1a\u5bfc\u81f4merge\n// \u53ef\u4ee5\u5c06\u65f6\u95f4\u9897\u7c92\u5ea6\u6539\u4e3a\u5468\u3001\u6216\u8005\u6708\uff0c\u8fd9\u6837\u51b2\u7a81\u5c31\u51cf\u5c11\u5f88\u591a\u3002\u641c\u7d22\u53d8\u66f4\u65f6\u95f4\u683c\u5f0f: dateFormat\n\"LastEditTime\": \"Do not edit\", // \u6587\u4ef6\u6700\u540e\u7f16\u8f91\u65f6\u95f4\n// \u8f93\u51fa\u76f8\u5bf9\u8def\u5f84\uff0c\u7c7b\u4f3c: /\u6587\u4ef6\u5939\u540d\u79f0/src/index.js\n\"FilePath\": \"Do not edit\", // \u6587\u4ef6\u5728\u9879\u76ee\u4e2d\u7684\u76f8\u5bf9\u8def\u5f84 \u81ea\u52a8\u66f4\u65b0\n// \u63d2\u4ef6\u4f1a\u81ea\u52a8\u5c06\u5149\u6807\u79fb\u52a8\u5230Description\u9009\u9879\u4e2d \u65b9\u4fbf\u8f93\u5165 Description\u5b57\u6bb5\u53ef\u4ee5\u5728specialOptions\u66f4\u6539\n\"Description\": \"\", // \u4ecb\u7ecd\u6587\u4ef6\u7684\u4f5c\u7528\u3001\u6587\u4ef6\u7684\u5165\u53c2\u3001\u51fa\u53c2\u3002\n// custom_string_obkoro1~custom_string_obkoro100\u90fd\u53ef\u4ee5\u8f93\u51fa\u81ea\u5b9a\u4e49\u4fe1\u606f\n// \u53ef\u4ee5\u8bbe\u7f6e\u591a\u6761\u81ea\u5b9a\u4e49\u4fe1\u606f \u8bbe\u7f6e\u4e2a\u6027\u7b7e\u540d\u3001\u7559\u4e0bQQ\u3001\u5fae\u4fe1\u8054\u7cfb\u65b9\u5f0f\u3001\u8f93\u5165\u7a7a\u884c\u7b49\n\"custom_string_obkoro1\": \"\", // \u7248\u6743\u58f0\u660e \u4fdd\u7559\u6587\u4ef6\u6240\u6709\u6743\u5229 \u81ea\u52a8\u66ff\u6362\u5e74\u4efd \u83b7\u53d6git\u914d\u7f6e\u7684\u7528\u6237\u540d\u548c\u90ae\u7bb1\n// \u7248\u6743\u58f0\u660e\u83b7\u53d6git\u914d\u7f6e, \u4e0eAuthor\u5b57\u6bb5\u4e00\u81f4: ${git_name} ${git_email} ${git_name_email}\n\"custom_string_obkoro1_copyright\": \"Copyright (c) ${now_year} by ${git_name_email}, All Rights Reserved. \"\n// \"custom_string_obkoro1_copyright\": \"Copyright (c) ${now_year} by \u5199\u6b7b\u7684\u516c\u53f8\u540d/\u7528\u6237\u540d, All Rights Reserved. \"\n},\n// \u51fd\u6570\u6ce8\u91ca\n\"fileheader.cursorMode\": {\n\"description\": \"\", // \u51fd\u6570\u6ce8\u91ca\u751f\u6210\u4e4b\u540e\uff0c\u5149\u6807\u79fb\u52a8\u5230\u8fd9\u91cc\n\"param\": \"\", // param \u5f00\u542f\u51fd\u6570\u53c2\u6570\u81ea\u52a8\u63d0\u53d6 \u9700\u8981\u5c06\u5149\u6807\u653e\u5728\u51fd\u6570\u884c\u6216\u8005\u51fd\u6570\u4e0a\u65b9\u7684\u7a7a\u767d\u884c\n\"return\": \"\",\n},\n\"workbench.editor.enablePreview\": false,\n\"diffEditor.ignoreTrimWhitespace\": false,\n}\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#56-\u8c03\u8bd5\u9879\u76ee","title":"5.6 \u8c03\u8bd5\u9879\u76ee","text":"<p>\u8c03\u8bd5\u5feb\u6377\u952e\u5927\u81f4\u5982\u4e0b\uff1a</p> <ul> <li>F5\uff1a\u6682\u505c/\u7ee7\u7eed\u3002 </li> <li>F10\uff1a\u5355\u6b65\u8df3\u8fc7 </li> <li>F11\uff1a\u5355\u6b65\u8fdb\u5165 </li> <li>Shif + F11\uff1a\u8df3\u51fa</li> <li>F9\uff1a\u5207\u6362\u65ad\u70b9 </li> <li>Ctrl+F5: \u4ee5\u975e\u8c03\u8bd5\u6a21\u5f0f\u8fd0\u884c</li> </ul>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/4.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/#57-vscode\u540c\u6b65\u6587\u4ef6\u5230\u670d\u52a1\u5668","title":"5.7 vscode\u540c\u6b65\u6587\u4ef6\u5230\u670d\u52a1\u5668","text":"<p>vscode\u540c\u6b65\u6587\u4ef6\u5230\u670d\u52a1\u5668</p> <p>VSCode \u5feb\u6377\u952e\u96c6\u5408\uff0c\u52a8\u753b\u5c55\u793a</p> <p>vscode\u8fdb\u9636\uff1aPython\u5f00\u53d1\u73af\u5883\u914d\u7f6e</p> <p>https://zhuanlan.zhihu.com/p/345806901</p> <p>https://www.yuque.com/u2278269/gq5x74/gst4x6</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","title":"5.Python\u6570\u636e\u7ed3\u6784","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#1\u5217\u8868-list","title":"1.\u5217\u8868 List","text":"<pre><code>list() #\u521b\u5efa\u4e00\u4e2a\u7a7a\u5217\u8868\n[]     #\u521b\u5efa\u4e00\u4e2a\u7a7a\u5217\u8868\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#11-\u5217\u8868\u7684\u5185\u7f6e\u65b9\u6cd5","title":"1.1 \u5217\u8868\u7684\u5185\u7f6e\u65b9\u6cd5","text":"\u65b9\u6cd5 \u8bf4\u660e <code>list.append(obj)</code> \u5411\u5217\u8868\u672b\u5c3e\u6dfb\u52a0\u65b0\u5bf9\u8c61 <code>list.count(obj)</code> \u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61obj\u5728\u5217\u8868\u4e2d\u51fa\u73b0\u7684\u6b21\u6570 <code>list.extend(seq)</code> \u628a\u5e8f\u5217seq\u7684\u5185\u5bb9\u6dfb\u52a0\u5230\u5217\u8868\u4e2d <code>list.index(obj)</code> \u4ece\u5217\u8868\u4e2d\u627e\u51fa\u67d0\u4e2a\u503c\u7b2c\u4e00\u4e2a\u5339\u914d\u9879\u7684\u7d22\u5f15\u4f4d\u7f6e <code>list.insert(index.obj)</code> \u5728\u7d22\u5f15\u91cf\u4e3aindex\u7684\u4f4d\u7f6e\u63d2\u5165\u5bf9\u8c61obj <code>list.pop(index=-1)</code> \u5220\u9664\u5e76\u8fd4\u56de\u6307\u5b9a\u4f4d\u7f6e\u7684\u5bf9\u8c61,\u9ed8\u8ba4\u662f\u6700\u540e\u4e00\u4e2a\u5bf9\u8c61 <code>list.remove(obj)</code> \u4ece\u5217\u8868\u4e2d\u5220\u9664\u5bf9\u8c61obj <code>list.reverse()</code> \u539f\u5730\u7ffb\u8f6c\u5217\u8868 <code>list.sort(func=None,key=None,reverse=False)</code> \u4ee5\u6307\u5b9a\u7684\u65b9\u5f0f\u6392\u5e8f\u5217\u8868\u4e2d\u6210\u5458,\u5982\u679cfunc\u548ckey\u53c2\u6570\u6307\u5b9a,\u5219\u6309\u7167\u6307\u5b9a\u7684\u65b9\u5f0f\u6bd4\u8f83\u5404\u4e2a\u5143\u7d20,\u5982\u679creverse\u6807\u5fd7\u88ab\u7f6e\u4e3aTrue,\u5219\u5217\u8868\u4ee5\u53cd\u5e8f\u6392\u5217 <code>list.claer()</code> \u6e05\u7a7a\u5217\u8868 <code>list.copy()</code> \u590d\u5236\u5217\u8868"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#12-\u5217\u8868\u7684\u5185\u7f6e\u64cd\u4f5c","title":"1.2 \u5217\u8868\u7684\u5185\u7f6e\u64cd\u4f5c","text":"\u64cd\u4f5c\u7b26/\u65b9\u6cd5 \u63cf\u8ff0 <code>len(sequence)</code> \u8fd4\u56de\u5e8f\u5217\u4e2d\u5143\u7d20\u7684\u6570\u3002 <code>item in sequence</code> \u68c0\u67e5 <code>sequence</code> \u4e2d\u662f\u5426\u5305\u542b\u5143\u7d20 <code>item</code>\uff0c\u8fd4\u56de\u5e03\u503c\u3002 <code>max(sequence)</code> \u8fd4\u56de\u5e8f\u5217\u4e2d\u7684\u6700\u503c\u3002 <code>min(sequence)</code> \u8fd4\u56de\u5e8f\u5217\u4e2d\u7684\u6700\u503c\u3002 <code>all(sequence)</code> sequence\u4e2d\u7684\u6240\u6709\u9879\u4e3a\u771f\uff0c\u5219\u4e3a\u771f\uff0c\u5426\u5219\u4e3a\u5047 <code>any(sequence)</code> sequence\u4e2d\u6709\u4e00\u9879\u4e3a\u771f\uff0c\u5219\u4e3a\u771f\uff0c\u5426\u5219\u4e3a\u5047 <code>sum(sequence)</code> \u8fd4\u56desequence\u7684\u603b\u548c"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#13-\u5217\u8868\u7684\u5207\u7247","title":"1.3 \u5217\u8868\u7684\u5207\u7247","text":"\u5207\u7247\u8bed\u6cd5 \u63cf\u8ff0 <code>list[start:stop]</code> \u8fd4\u56de\u4ece\u7d22\u5f15 <code>start</code> \u5230 <code>stop-1</code> \u7684\u5143\u7d20 <code>list[start:]</code> \u8fd4\u56de\u4ece\u7d22\u5f15 <code>start</code> \u5230\u5217\u8868\u672b\u5c3e\u7684\u5143\u7d20 <code>list[:stop]</code> \u8fd4\u56de\u4ece\u5217\u8868\u5f00\u5934\u5230\u7d22\u5f15 <code>stop-1</code> \u7684\u5143\u7d20 <code>list[:]</code> \u8fd4\u56de\u5305\u542b\u6574\u4e2a\u5217\u8868\u7684\u526f\u672c <code>list[start:stop:step]</code> \u8fd4\u56de\u4ece\u7d22\u5f15 <code>start</code> \u5230 <code>stop-1</code>\uff0c\u6309\u6b65\u957f <code>step</code> \u8fdb\u884c\u5207\u7247 <code>list[::-1]</code> \u8fd4\u56de\u9006\u5e8f\u6392\u5217\u7684\u5217\u8868"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#2\u5143\u7956-tuple","title":"2.\u5143\u7956 Tuple","text":"<p>tuple()\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u7a7a\u5143\u7956</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#21-\u5143\u7956\u7279\u6027","title":"2.1 \u5143\u7956\u7279\u6027","text":"<ul> <li>\u4e0d\u53ef\u53d8\u5e8f\u5217\uff08\u4e0d\u80fd\u6dfb\u52a0\u3001\u4fee\u6539\u548c\u5220\u9664\u5143\u7d20\uff0c\u53ef\u4ee5\u6574\u4f53\u66ff\u6362\uff09</li> <li>\u652f\u6301\u5207\u7247\u7684\u64cd\u4f5c\uff08\u53ea\u80fd\u8bbf\u95ee\u5143\u7956\u4e2d\u7684\u5143\u7d20\uff09</li> <li>\u5143\u7956\u8bbf\u95ee\u901f\u5ea6\u5feb</li> <li>\u5143\u7956\u53ef\u4ee5\u4f5c\u4e3a\u5b57\u5178\u7684\u952e</li> </ul> <pre><code># \u548c\u5217\u8868\u64cd\u4f5c\u5f88\u7c7b\u4f3c\uff0c\u4f46\u4e0d\u53ef\u53d8\nzoo = ('wolf', 'elephant', 'penguin')\n# \u5143\u7956\u7684\u5c0f\u62ec\u53f7\u5e76\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u53ea\u8981\u5c06\u4e00\u7ec4\u6570\u7528\u9017\u53f7\u5206\u9694\u5f00\u6765\uff0cpython\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u5b83\u662f\u5143\u7956\u3002\nIn [1]: tmp=\"aa\",\"bb\",\"cc\"\nIn [2]: type(tmp)\nOut[2]: tuple\n# \u5143\u7956\u4f7f\u7528+\u53f7\u53ef\u4ee5\u7ec4\u5408\uff0c\u7c7b\u4f3c\u5217\u8868\n#!/usr/bin/env python\n#-*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2019/4/15 20:09\n# filename: \u5143\u7956.py\nplay1=(\"\u6885\u897f\",\"C\u7f57\",\"\u5361\u5361\u897f\",\"\u80e1\u6b4c\")\nprint(\"\u539f\u59cb\u7684\u5143\u7956\uff1a{}\".format(play1))\nplay2=play1+(\"\u80e1\u5efa\u529b\",\"\u5c0f\u8d31\",\"\u80e1\u5c0f\u5065\")\nprint(\"\u7ec4\u5408\u540e\u7684\u5143\u7956\uff1a{}\".format(play2))\n# \u5728\u5143\u7956\u6dfb\u52a0\u65f6\uff0c\u82e5\u53ea\u67091\u4e2a\u5143\u7956\uff0c\u9700\u8981\u5728\u540e\u9762\u52a0\u4e0a\u9017\u53f7\nplay3= play2+(\"\u8def\u98de\",)\nprint(\"\u6dfb\u52a0\u5143\u7956\uff0c\u5f53\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\u65f6\uff0c\u9700\u8981\u5728\u540e\u9762\u52a0\u4e0a\u9017\u53f7:{}\".format(play3))\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#22-\u5143\u7956\u89e3\u5305","title":"2.2 \u5143\u7956(\u89e3\u5305)","text":"<pre><code>In [25]: marx_tuple = (\"hu\",\"jian\",\"li\")\nIn [27]: a,b,c = marx_tuple\nIn [28]: a\nOut[28]: 'hu'\nIn [29]: b\nOut[29]: 'jian'\nIn [30]: c\nOut[30]: 'li'\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#23-zip\u51fd\u6570","title":"2.3 zip()\u51fd\u6570","text":"<pre><code>list_a = [\"hu1\",\"hu2\",\"hu3\",\"hu4\"]\nlist_b = (\"python1\",\"python2\",\"python3\")\nfor i in zip(list_a,list_b):\nprint(i)\n# ('hu1', 'python1')\n# ('hu2', 'python2')\n# ('hu3', 'python3')\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#24-\u5177\u540d\u5143\u7956","title":"2.4 \u5177\u540d\u5143\u7956","text":"<p>\u5177\u540d\u5143\u7ec4\u5728\u4fdd\u7559\u666e\u901a\u5143\u7ec4\u529f\u80fd\u7684\u57fa\u7840\u4e0a\uff0c\u5141\u8bb8\u4e3a\u5143\u7ec4\u7684\u6bcf\u4e2a\u6210\u5458\u547d\u540d\uff0c\u8fd9\u6837\u4f60\u4fbf\u80fd\u901a\u8fc7\u540d\u79f0\u800c\u4e0d\u6b62\u662f\u6570\u5b57\u7d22\u5f15\u8bbf\u95ee\u6210\u5458\u3002</p> <p>\u5728<code>Python 3.6\u7248\u672c\u4ee5\u540e\uff0c\u9664\u4e86\u4f7f\u7528namedtuple()\u51fd\u6570\u4ee5\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u7528typing.NamedTuple\u548c\u7c7b\u578b\u6ce8\u89e3\u8bed\u6cd5\u6765\u5b9a\u4e49\u5177\u540d\u5143\u7ec4\u7c7b\u578b</code>\u3002\u8fd9\u79cd\u65b9\u5f0f\u5728\u53ef\u8bfb\u6027\u4e0a\u66f4\u80dc\u4e00\u7b79\uff1a</p> <pre><code>from collections import namedtuple\nRectangle = namedtuple('Rectangle', 'width,height')\nfrom typing import NamedTuple\nclass Rectangle1(NamedTuple):\nwidth: int\nheight: int\n# rect = rectangle(100, 20)\nrect = Rectangle(width=100, height=20)\n# \u53ef\u4ee5\u50cf\u666e\u901a\u5143\u7ec4\u4e00\u6837\uff0c\u901a\u8fc7\u6570\u5b57\u7d22\u5f15\u8bbf\u95ee\u6210\u5458\nprint(rect[0])\n# \u4e5f\u80fd\u901a\u8fc7\u5b57\u6bb5\u540d\u79f0\u6765\u8bbf\u95ee\nprint(rect.width)\nprint(rect.height)\nrect_str = Rectangle('string', 'not_a_number')\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#3\u5b57\u5178-dict","title":"3.\u5b57\u5178 Dict","text":"<p>dict()\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u7a7a\u5b57\u5178\uff0c\u5b57\u5178\u662f\u65e0\u5e8f\u7684\u3002</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#31-\u5b57\u5178\u7684\u5185\u7f6e\u65b9\u6cd5","title":"3.1 \u5b57\u5178\u7684\u5185\u7f6e\u65b9\u6cd5","text":"\u65b9\u6cd5 \u63cf\u8ff0 <code>dict.clear()</code> \u5220\u9664\u5b57\u5178\u4e2d\u6240\u6709\u5143\u7d20\u3002 <code>dict.copy()</code> \u8fd4\u56de\u5b57\u5178\uff08\u6d45\u590d\u5236\uff09\u7684\u4e00\u4e2a\u526f\u672c\u3002 <code>dict.fromkeys(seq,val=None)</code> \u521b\u5efa\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u5b57\u5178\uff0c\u4ee5 <code>seq</code> \u4e2d\u7684\u5143\u7d20\u4f5c\u4e3a\u8be5\u5b57\u5178\u7684\u952e\uff0c<code>val</code> \u4f5c\u4e3a\u8be5\u5b57\u5178\u4e2d\u6240\u6709\u952e\u5bf9\u7684\u521d\u59cb\u503c\u3002 <code>dict.get(key,default=None)</code> \u5bf9\u5b57\u5178 <code>dict</code> \u4e2d\u7684\u952e <code>key</code>\uff0c\u8fd4\u56de\u5b83\u5bf9\u5e94\u7684\u503c <code>value</code>\uff0c\u5982\u679c\u5b57\u5178\u4e2d\u4e0d\u5b58\u5728\u6b64\u952e\uff0c\u5219\u8fd4\u56de <code>default</code> \u503c\u3002 <code>dict.has_key(key)</code> \u5982\u679c\u952e\u5728\u5b57\u5178\u4e2d\u5b58\u5728\uff0c\u5219\u8fd4\u56de <code>True</code>\u3002\uff08Python3 \u4e2d\u7528 <code>in</code> \u548c <code>not in</code> \u4ee3\u66ff\u4e86\uff09 <code>dict.items()</code> \u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5b57\u5178\u4e2d\u952e\u503c\u5bf9\u5143\u7ec4\u7684\u5217\u8868\u3002 <code>dict.keys()</code> \u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5b57\u5178\u4e2d\u952e\u7684\u5217\u8868\u3002 <code>dict.iter()</code> \u65b9\u6cd5 <code>iteritems()</code>\u3001<code>iterkeys()</code>\u3001<code>itervalues()</code> \u4e0e\u5b83\u4eec\u5bf9\u5e94\u7684\u975e\u8fed\u4ee3\u65b9\u6cd5\u4e00\u6837\uff0c\u4e0d\u540c\u7684\u662f\u5b83\u4eec\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u5217\u8868\u3002 <code>dict.pop(key[,default])</code> \u548c\u65b9\u6cd5 <code>get()</code> \u76f8\u4f3c\u3002\u5982\u679c\u5b57\u5178\u4e2d <code>key</code> \u952e\u5b58\u5728\uff0c\u5220\u9664\u5e76\u8fd4\u56de <code>dict[key]</code>\u3002 <code>dict.setdefault(key,default=None)</code> \u548c <code>set()</code> \u76f8\u4f3c\uff0c\u4f46\u5982\u679c\u5b57\u5178\u4e2d\u4e0d\u5b58\u5728 <code>key</code> \u952e\uff0c\u5219\u901a\u8fc7 <code>dict[key]=default</code> \u4e3a\u5b83\u8d4b\u503c\u3002 <code>dict[key] = [value]</code> \u66ff\u4ee3\u4e86 <code>setdefault</code> \u65b9\u6cd5\uff0c\u76f4\u63a5\u7ed9\u952e\u5bf9\u5e94\u7684\u503c\u8fdb\u884c\u6dfb\u52a0\u5230\u5b57\u5178\u3002 <code>dict.update(dict2)</code> \u5c06\u5b57\u5178 <code>dict2</code> \u7684\u952e\u503c\u5bf9\u6dfb\u52a0\u5230\u5b57\u5178 <code>dict</code>\u3002 <code>dict.values()</code> \u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5b57\u5178\u4e2d\u6240\u6709\u503c\u7684\u5217\u8868\u3002 <code>dict([container])</code> \u521b\u5efa\u5b57\u5178\u7684\u5de5\u5382\u51fd\u6570\u3002\u63d0\u4f9b\u5bb9\u5668\u7c7b (<code>container</code>)\uff0c\u5c31\u7528\u5176\u4e2d\u7684\u6761\u76ee\u586b\u5145\u5b57\u5178\u3002 <code>len(mapping)</code> \u8fd4\u56de\u6620\u5c04\u7684\u957f\u5ea6\uff08\u952e-\u503c\u5bf9\u7684\u4e2a\u6570\uff09\u3002 <code>hash(obj)</code> \u8fd4\u56de <code>obj</code> \u7684\u54c8\u5e0c\u503c\uff0c\u5224\u65ad\u67d0\u4e2a\u5bf9\u8c61\u662f\u5426\u53ef\u4f5c\u4e3a\u4e00\u4e2a\u5b57\u5178\u7684\u952e\u3002 <code>del dict[\"key\"]</code> \u5220\u9664\u5177\u6709\u6307\u5b9a\u952e\u7684\u5143\u7d20\u3002"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#32-\u6dfb\u52a0\u4fee\u6539\u5220\u9664\u5b57\u5178\u5143\u7d20","title":"3.2 \u6dfb\u52a0/\u4fee\u6539/\u5220\u9664\u5b57\u5178\u5143\u7d20","text":"<pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\n#\u5411\u5b57\u5178\u91cc\u9762\u6dfb\u52a0\u5143\u7d20\ndict1 = {\"1\":\"hujianli\",\"2\":\"xiaojian\",\"3\":\"xiaojian3\"}\ndict1[\"4\"] = \"xiaojian4\"\nprint(dict1)\n#\u4fee\u6539\u5b57\u5178\u7684\u5143\u7d20\ndict1['1'] = \"hujianli1\"\ndict1['2'] = \"hujianli2\"\nprint(dict1)\n#\u5220\u9664\u5143\u7d20\ndel dict1['1']\ndel dict1['2']\n#\u8fdb\u884c\u5224\u65ad\uff0c\u5224\u65ad\u952e\u662f\u5426\u5728\u5b57\u5178\u5f53\u4e2d\nif \"1\" in dict1:\ndel dict1['1']\nprint(dict1)\n&gt;&gt;&gt; dict.fromkeys(['a', 'b'], 0)\n{'a': 0, 'b': 0}\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#33-\u5b57\u5178\u63a8\u5bfc\u5f0f","title":"3.3 \u5b57\u5178\u63a8\u5bfc\u5f0f","text":"<pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\n#\u63a8\u5bfc\u5f0f\u53ef\u4ee5\u5feb\u901f\u751f\u6210\u5b57\u5178\n'''\n{\u952e\u8868\u8fbe\u5f0f\uff1a\u503c\u8868\u8fbe\u5f0f for \u5faa\u73af}\n'''\nimport random\n#\u751f\u6210\u968f\u673a\u6570\u5b57\u5178\uff0c\u952e\u4e3a1~4\uff0c\u503c\u4e3a10~100\u7684\u968f\u673a\u6570\nrandomdict = {i: random.randint(10,100) for i in range(1,5)}\nprint(randomdict)\nname = [\"\u4f9d\u68a6\",\"\u51b7\u4f9d\u4f9d\",\"\u9999\u83f1\",\"\u6234\u5170\"]\nsign = [\"\u6c34\u74f6\",\"\u5c04\u624b\",\"\u53cc\u9c7c\",\"\u53cc\u5b50\"]\ndict1 = {i:j for i,j in zip(name,sign)}\nprint(dict1)\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#34-\u5b57\u5178\u7684\u91cd\u8bbf\u5d4c\u5957","title":"3.4 \u5b57\u5178\u7684\u91cd\u8bbf\u5d4c\u5957","text":"<pre><code>In [17]: rec = {\"name\":{\"first\":\"Bob\",\"hujianli\":\"smith\",\"job\":[\"dev\",\"mgr\"],\"age\":\"22\"}}\nIn [19]: rec[\"name\"]\nOut[19]: {'age': '22', 'first': 'Bob', 'hujianli': 'smith', 'job': ['dev', 'mgr']}\nIn [20]: rec[\"name\"][\"job\"]\nOut[20]: ['dev', 'mgr']\nIn [21]: rec[\"name\"][\"job\"][1]\nOut[21]: 'mgr'\nIn [22]: rec[\"name\"][\"job\"][-1]\nOut[22]: 'mgr'\nIn [24]: rec[\"name\"][\"job\"].append(\"IT\")\nIn [25]: rec\nOut[25]:\n{'name': {'age': '22',\n'first': 'Bob',\n'hujianli': 'smith',\n'job': ['dev', 'mgr', 'IT']}}\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#35-\u5b57\u5178\u683c\u5f0f\u5316\u5b57\u7b26\u4e32","title":"3.5 \u5b57\u5178\u683c\u5f0f\u5316\u5b57\u7b26\u4e32","text":"<pre><code>temp = \"\u4e66\u540d\u662f\uff1a%(name)s,\u4ef7\u683c\u662f:%(price)010.2f,\u51fa\u7248\u793e\u662f:%(publish)s\"\nbook1 = {'name': \"\u75af\u72c2python\u8bb2\u4e49\", 'price': 88.9, 'publish': '\u7535\u5b50\u793e1'}\nprint(temp % book1)\nbook2 = {'name': \"\u75af\u72c2java\u8bb2\u4e49\", 'price': 78.9, 'publish': '\u7535\u5b50\u793e2'}\nprint(temp % book2)\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#36-\u7528\u5b57\u5178\u5206\u652f\u6784\u5efa\u7a0b\u5e8f","title":"3.6 \u7528\u5b57\u5178\u5206\u652f\u6784\u5efa\u7a0b\u5e8f","text":"<pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport random\n#\u5b9a\u4e493\u4e2a\u5206\u652f\u51fd\u6570\ndef print_a():\nprint(\"\u8def\u5f84\u5206\u652fA\")\ndef print_b():\nprint(\"\u8def\u5f84\u5206\u652fB\")\ndef print_c():\nprint(\"\u8def\u5f84\u5206\u652fC\")\nif __name__ == '__main__':\npath_dict = {}\npath_dict['a'] = print_a\npath_dict['b'] = print_b\npath_dict['c'] = print_c\npaths = 'abc'\nfor i in range(4):\npath = random.choice(paths)\nprint(\"\u9009\u62e9\u4e86\u8def\u5f84:\",path)\npath_dict[path]()\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#36-\u5b57\u5178\u952e\u503c\u5224\u65ad","title":"3.6 \u5b57\u5178\u952e\u503c\u5224\u65ad","text":"<pre><code>##\u4e0d\u63a8\u8350\nif my_dict.has_key(key):\n# ...do something with d[key]\n##\u63a8\u8350\nif key in my_dict:\n# ...do something with d[key]\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#37-\u5b57\u5178get\u548csetdefault\u65b9\u6cd5","title":"3.7 \u5b57\u5178get\u548csetdefault\u65b9\u6cd5","text":"<pre><code>##\u4e0d\u63a8\u8350\nnavs = {}\nfor (portfolio, equity, position) in data:\nif portfolio not in navs:\nnavs[portfolio] = 0\nnavs[portfolio] += position * prices[equity]\n##\u63a8\u8350\nnavs = {}\nfor (portfolio, equity, position) in data:\n# \u4f7f\u7528 get \u65b9\u6cd5\nnavs[portfolio] = navs.get(portfolio, 0) + position * prices[equity]\n# \u6216\u8005\u4f7f\u7528 setdefault \u65b9\u6cd5\nnavs.setdefault(portfolio, 0)\nnavs[portfolio] += position * prices[equity]\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#4\u96c6\u5408-set","title":"4.\u96c6\u5408 Set","text":"<p><code>set()</code>\u51fd\u6570\u53ef\u4ee5\u5c06\u5217\u8868\u8f6c\u6362\u4e3a\u96c6\u5408</p> <p>\u53ef\u4ee5\u7528\u4e8e\u53bb\u91cd\u590d\u6570\u636e</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#41-\u96c6\u5408\u7684\u65b9\u6cd5","title":"4.1 \u96c6\u5408\u7684\u65b9\u6cd5","text":"\u65b9\u6cd5 \u63cf\u8ff0 <code>s.update(t)</code> \u7528 <code>t</code> \u4e2d\u7684\u5143\u7d20\u4fee\u6539 <code>s</code>\uff0c<code>s</code> \u73b0\u5728\u5305\u542b <code>s</code> \u6216 <code>t</code> \u7684\u6210\u5458\u3002 <code>s.intersection_update(t)</code> <code>s</code> \u4e2d\u7684\u6210\u5458\u662f\u5171\u7528\u5c5e\u4e8e <code>s</code> \u548c <code>t</code> \u7684\u5143\u7d20\u3002 <code>s.difference_update(t)</code> <code>s</code> \u4e2d\u7684\u6210\u5458\u662f\u5c5e\u4e8e <code>s</code> \u4f46\u4e0d\u5305\u542b\u5728 <code>t</code> \u4e2d\u7684\u5143\u7d20\u3002 <code>s.symmetric_difference_update(t)</code> <code>s</code> \u4e2d\u7684\u6210\u5458\u66f4\u65b0\u4e3a\u90a3\u4e9b\u5305\u542b\u5728 <code>s</code> \u6216 <code>t</code> \u4e2d\uff0c\u4f46\u4e0d\u662f <code>s</code> \u548c <code>t</code> \u5171\u6709\u7684\u5143\u7d20\u3002 <code>s.add(obj)</code> \u5728\u96c6\u5408 <code>s</code> \u4e2d\u6dfb\u52a0\u5bf9\u8c61 <code>obj</code>\u3002 <code>s.remove(obj)</code> \u4ece\u96c6\u5408 <code>s</code> \u4e2d\u5220\u9664\u5bf9\u8c61 <code>obj</code>\uff1b\u5982\u679c <code>obj</code> \u4e0d\u662f\u96c6\u5408 <code>s</code> \u4e2d\u7684\u5143\u7d20\uff0c\u5219\u5f15\u53d1 <code>KeyError</code> \u9519\u8bef\u3002 <code>s.discard(obj)</code> \u5982\u679c <code>obj</code> \u662f\u96c6\u5408 <code>s</code> \u4e2d\u7684\u5143\u7d20\uff0c\u5219\u4ece\u96c6\u5408 <code>s</code> \u4e2d\u5220\u9664\u5bf9\u8c61 <code>obj</code>\u3002 <code>s.pop()</code> \u5220\u9664\u96c6\u5408 <code>s</code> \u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5e76\u8fd4\u56de\u5b83\u3002 <code>s.clear()</code> \u5220\u9664\u96c6\u5408 <code>s</code> \u4e2d\u7684\u6240\u6709\u5143\u7d20\u3002 <code>s.issubset(t)</code> \u5982\u679c <code>s</code> \u662f <code>t</code> \u7684\u5b50\u96c6\uff0c\u5219\u8fd4\u56de <code>True</code>\u3002 <code>s.issuperset(t)</code> \u5982\u679c <code>t</code> \u662f <code>s</code> \u7684\u8d85\u96c6\uff0c\u5219\u8fd4\u56de <code>True</code>\u3002 <code>s.union(t)</code> \u5408\u5e76\u64cd\u4f5c\uff1b\u8fd4\u56de\u4e00\u4e2a\u65b0\u96c6\u5408\uff0c\u8be5\u96c6\u5408\u662f <code>s</code> \u548c <code>t</code> \u7684\u5e76\u96c6\u3002 <code>s.intersection(t)</code> \u4ea4\u96c6\u64cd\u4f5c\uff1b\u8fd4\u56de\u4e00\u4e2a\u65b0\u96c6\u5408\uff0c\u8be5\u96c6\u5408\u662f <code>s</code> \u548c <code>t</code> \u7684\u4ea4\u96c6\u3002 <code>s.difference(t)</code> \u8fd4\u56de\u4e00\u4e2a\u65b0\u96c6\u5408\uff0c\u8be5\u96c6\u5408\u662f <code>s</code> \u7684\u6210\u5458\uff0c\u4f46\u4e0d\u662f <code>t</code> \u7684\u6210\u5458\u3002 <code>s.symmetric_difference(t)</code> \u8fd4\u56de\u4e00\u4e2a\u65b0\u96c6\u5408\uff0c\u8be5\u96c6\u5408\u662f <code>s</code> \u6216 <code>t</code> \u7684\u6210\u5458\uff0c\u4f46\u4e0d\u662f <code>s</code> \u548c <code>t</code> \u5171\u6709\u7684\u6210\u5458\u3002 <code>s.copy()</code> \u8fd4\u56de\u4e00\u4e2a\u65b0\u96c6\u5408\uff0c\u5b83\u662f\u96c6\u5408 <code>s</code> \u7684\u6d45\u590d\u5236\u3002 <code>obj in s</code> \u6210\u5458\u6d4b\u8bd5\uff1b<code>obj</code> \u662f <code>s</code> \u4e2d\u7684\u5143\u7d20\uff0c\u8fd4\u56de <code>True</code>\u3002 <code>obj not in s</code> \u975e\u6210\u5458\u6d4b\u8bd5\uff1b<code>obj</code> \u4e0d\u662f <code>s</code> \u4e2d\u7684\u5143\u7d20\uff0c\u8fd4\u56de <code>True</code>\u3002 <code>s == t</code> \u7b49\u4ef7\u6d4b\u8bd5\uff0c\u5224\u65ad\u96c6\u5408 <code>s</code> \u548c <code>t</code> \u662f\u5426\u5177\u6709\u76f8\u540c\u7684\u5143\u7d20\u3002 <code>s != t</code> \u4e0d\u7b49\u4ef7\u6d4b\u8bd5\uff0c\u5224\u65ad\u96c6\u5408 <code>s</code> \u548c <code>t</code> \u662f\u5426\u4e0d\u5177\u6709\u76f8\u540c\u7684\u5143\u7d20\u3002 <code>s &lt; t</code> \u5b50\u96c6\u6d4b\u8bd5\uff1b<code>s != t</code> \u4e14 <code>s</code> \u4e2d\u6240\u6709\u5143\u7d20\u90fd\u662f <code>t</code> \u7684\u6210\u5458\u3002 <code>s &gt; t</code> \u8d85\u96c6\u6d4b\u8bd5\uff1b<code>s != t</code> \u4e14 <code>t</code> \u4e2d\u6240\u6709\u5143\u7d20\u90fd\u662f <code>s</code> \u7684\u6210\u5458\u3002"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#5\u5927\u578b\u6570\u636e\u7ed3\u6784","title":"5.\u5927\u578b\u6570\u636e\u7ed3\u6784","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#51\u5143\u7956\u91cc\u9762\u5d4c\u5957\u5217\u8868","title":"5.1\u5143\u7956\u91cc\u9762\u5d4c\u5957\u5217\u8868","text":"<pre><code>In [31]: list1=[\"hujianli\",\"leijun\",\"hushiqiang\",\"zhangyong\"]\nIn [32]: list2=[\"wuhan\",\"caidian\",\"xiaogan\",\"yingcheng\"]\nIn [33]: list3=[\"21\",\"22\",\"23\",\"24\"]\nIn [34]: tuple_of_list= list1,list2,list3\n\nIn [35]: tuple_of_list\n(['hujianli', 'leijun', 'hushiqiang', 'zhangyong'],\n ['wuhan', 'caidian', 'xiaogan', 'yingcheng'],\n ['21', '22', '23', '24'])\nIn [36]: tuple_of_list[1]\nOut[36]: ['wuhan', 'caidian', 'xiaogan', 'yingcheng']\nIn [37]: tuple_of_list[2]\nOut[37]: ['21', '22', '23', '24']\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#52-\u5217\u8868\u91cc\u9762\u5d4c\u5957\u5217\u8868","title":"5.2 \u5217\u8868\u91cc\u9762\u5d4c\u5957\u5217\u8868","text":"<pre><code>In [40]: list_of_list = [list1,list2,list3]\nIn [41]: list_of_list\nOut[41]:\n[['hujianli', 'leijun', 'hushiqiang', 'zhangyong'],\n ['wuhan', 'caidian', 'xiaogan', 'yingcheng'],\n ['21', '22', '23', '24']]\nIn [42]: list_of_list[0]\nOut[42]: ['hujianli', 'leijun', 'hushiqiang', 'zhangyong']\nIn [43]: list_of_list[1]\nOut[43]: ['wuhan', 'caidian', 'xiaogan', 'yingcheng']\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#53-\u5b57\u5178\u91cc\u9762\u5d4c\u5957\u5217\u8868","title":"5.3 \u5b57\u5178\u91cc\u9762\u5d4c\u5957\u5217\u8868","text":"<pre><code>In [44]: dict_of_list = { \"dict1\":list1,\"dict2\":list2,\"dict3\":list3 }\nIn [45]: dict_of_list\n{'dict1': ['hujianli', 'leijun', 'hushiqiang', 'zhangyong'],\n 'dict2': ['wuhan', 'caidian', 'xiaogan', 'yingcheng'],\n 'dict3': ['21', '22', '23', '24']}\nIn [47]: dict_of_list.keys()\nOut[47]: dict_keys(['dict1', 'dict2', 'dict3'])\nIn [48]: dict_of_list.values()\nOut[48]: dict_values([['hujianli', 'leijun', 'hushiqiang', 'zhangyong'], ['wuhan', 'caidian', 'xiaogan', 'yingcheng'], ['21', '22', '23', '24']])\nIn [49]: dict_of_list.items()\nOut[49]: dict_items([('dict1', ['hujianli', 'leijun', 'hushiqiang', 'zhangyong']), ('dict2', ['wuhan', 'caidian', 'xiaogan', 'yingcheng']), ('dict3', ['21', '22', '23', '24'])])\n# \u53ef\u4ee5\u4e00\u5c42\u4e00\u5c42\u6253\u5f00\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u4f7f\u7528in\u8fdb\u884c\u5224\u65ad\u5143\u7d20\u3002\nIn [59]: for i in dict_of_list.values():\n    ...:     for j in i:\n    ...:         if \"hujianli\" in j:\n    ...:             print(\"\u627e\u5230'hujianli'....\")\n...:\n    ...:\n\u627e\u5230'hujianli'....\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#6\u6570\u636e\u7c7b\u578b\u8f6c\u6362","title":"6.\u6570\u636e\u7c7b\u578b\u8f6c\u6362","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#61-\u6574\u6570-\u6d6e\u70b9\u6570-\u5b57\u7b26\u4e32\u4e4b\u95f4\u7684\u8f6c\u6362","title":"6.1 \u6574\u6570-\u6d6e\u70b9\u6570-\u5b57\u7b26\u4e32\u4e4b\u95f4\u7684\u8f6c\u6362","text":"<pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nprint(\"int('12.3')\",int(12.3))\nprint(\"int('12.0002')\",int(12.0002))\nprint(\"int('123')\",int(\"123\"))\nprint('\u6574\u6570\u8f6c\u4e3a\u6d6e\u70b9\u6570',float(12))\nprint('\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570',float(\"123\"))\nprint(\"\u6574\u6570\u3001\u6d6e\u70b9\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\".center(100,\"#\"))\nprint(\"str('123')\",str(123))\nprint(\"str('123.001')\",str(123.001))\ninput_number = input(\"please input int:\")\nprint(input_number)\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#62-\u5b57\u7b26\u4e32\u8f6c\u5217\u8868-\u5217\u8868\u8f6c\u5b57\u7b26\u4e32","title":"6.2 \u5b57\u7b26\u4e32\u8f6c\u5217\u8868-\u5217\u8868\u8f6c\u5b57\u7b26\u4e32","text":"<pre><code>In [1]: hu = \"abc\"\nIn [2]: list(hu)\nOut[2]: ['a', 'b', 'c']\nIn [3]: hu = \"my name is 123\"\nIn [4]: hu.split()\nOut[4]: ['my', 'name', 'is', '123']\nIn [7]: lst = [\"1\",\"2\",\"3\",\"4\",\"hu\"]\nIn [8]: \",\".join(lst)\nOut[8]: '1,2,3,4,hu'\n#\u5f15\u5165\u5b66\u4e60\u4e00\u4e2a\u5185\u5efa\u51fd\u6570,join()\u51fd\u6570\u662f\u5b57\u7b26\u4e32\u64cd\u4f5c\u51fd\u6570\uff0c\u7528\u4e8e\u5b57\u7b26\u4e32\u8fde\u63a5\u3002 \u62fc\u63a5\u5b57\u7b26\u4e32\u6709 + \u548cjoin\u4e24\u79cd\u65b9\u5f0f\n#join\u6709\u62fc\u63a5\u5b57\u7b26\u4e32\u548c\u8f6c\u5217\u8868\u4e3a\u5b57\u7b26\u4e32\u7684\u4f5c\u7528\u548cstr\u7684spllit()\u529f\u80fd\u53cd\u8fc7\u6765\nIn [44]: list1 = [\"1\",\"2\",\"3\",\"4\"]\nIn [46]: \"+\".join(list1)\nOut[46]: '1+2+3+4'\n#\u4e0d\u89c4\u5219\u7684\u7c7b\u522b\uff0c\u5148\u8f6c\u4e3a\u6807\u51c6\u5217\u8868\uff0c\u518d\u8f6c\u4e3a\u5b57\u7b26\u4e32\nIn [13]: hu_list = [1,2,3,4,5,\"jianli\"]\nIn [14]: hu_list1 = [str(hu) for hu in hu_list ]\nIn [17]: \",\".join(hu_list1)\nOut[17]: '1,2,3,4,5,jianli'\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#63-\u5217\u8868\u8f6c\u5143\u7956-\u5143\u7956\u8f6c\u5217\u8868","title":"6.3 \u5217\u8868\u8f6c\u5143\u7956-\u5143\u7956\u8f6c\u5217\u8868","text":"<pre><code>In [9]: lst\nOut[9]: ['1', '2', '3', '4', 'hu']\nIn [10]: tuple(lst)\nOut[10]: ('1', '2', '3', '4', 'hu')\nIn [11]: hu_tuple = tuple(lst)\nIn [12]: list(hu_tuple)\nOut[12]: ['1', '2', '3', '4', 'hu']\nIn [14]: a_tuple = ('ready','fire','aim')\nIn [15]: list(a_tuple)\nOut[15]: ['ready', 'fire', 'aim']\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#64-\u5b57\u5178\u683c\u5f0f\u5b57\u7b26\u4e32-\u5b57\u5178","title":"6.4 \u5b57\u5178\u683c\u5f0f\u5b57\u7b26\u4e32-\u5b57\u5178","text":"<pre><code>#\u65b9\u5f0f\u4e00\n#\u5f15\u5165\u5b66\u4e60\u4e00\u4e2a\u5185\u5efa\u51fd\u6570\n#eval()\u51fd\u6570\u5c06\u5b57\u7b26\u4e32\u5f53\u6210 Python \u8868\u8fbe\u5f0f\u6765\u5904\u7406\nIn [38]: hu = 1\nIn [39]: eval('hu+1')\nOut[39]: 2\nIn [23]: s = '{\"a\": 1, \"b\": 2, \"c\": 3}'\nIn [24]: type(s)\nOut[24]: str\nIn [25]: d = eval(s)\nIn [26]: type(d)\nOut[26]: dict\nIn [27]: d\nOut[27]: {'a': 1, 'b': 2, 'c': 3}\n#\u65b9\u5f0f\u4e8c\nIn [32]: import json\nIn [33]: s = '{\"a\": 1, \"b\": 2, \"c\": 3}'\nIn [34]: type(s)\nOut[34]: str\nIn [35]: d = json.loads(s)\nIn [36]: type(d)\nOut[36]: dict\nIn [37]: d\nOut[37]: {'a': 1, 'b': 2, 'c': 3}\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#65-\u4e8c\u8fdb\u5236bytes\u4e0e\u5b57\u7b26\u4e32\u7684\u4e92\u8f6c","title":"6.5 \u4e8c\u8fdb\u5236bytes\u4e0e\u5b57\u7b26\u4e32\u7684\u4e92\u8f6c","text":"<pre><code># bytes\u8f6c\u5b57\u7b26\u4e32\u65b9\u5f0f\u4e00\nb=b'\\xe9\\x80\\x86\\xe7\\x81\\xab'\nstring=str(b,'utf-8')\nprint(string)\n# bytes\u8f6c\u5b57\u7b26\u4e32\u65b9\u5f0f\u4e8c\nb=b'\\xe9\\x80\\x86\\xe7\\x81\\xab'\nstring=b.decode() # \u7b2c\u4e00\u53c2\u6570\u9ed8\u8ba4utf8\uff0c\u7b2c\u4e8c\u53c2\u6570\u9ed8\u8ba4strict\nprint(string)\n# bytes\u8f6c\u5b57\u7b26\u4e32\u65b9\u5f0f\u4e09\nb=b'\\xe9\\x80\\x86\\xe7\\x81haha\\xab'\nstring=b.decode('utf-8','ignore') # \u5ffd\u7565\u975e\u6cd5\u5b57\u7b26\uff0c\u7528strict\u4f1a\u629b\u51fa\u5f02\u5e38\nprint(string)\n# bytes\u8f6c\u5b57\u7b26\u4e32\u65b9\u5f0f\u56db\nb=b'\\xe9\\x80\\x86\\xe7\\x81haha\\xab'\nstring=b.decode('utf-8','replace') # \u7528\uff1f\u53d6\u4ee3\u975e\u6cd5\u5b57\u7b26\nprint(string)\n# \u5b57\u7b26\u4e32\u8f6cbytes\u65b9\u5f0f\u4e00\nstr1='\u9006\u706b'\nb=bytes(str1, encoding='utf-8')\nprint(b)\n# \u5b57\u7b26\u4e32\u8f6cbytes\u65b9\u5f0f\u4e8c\nb=str1.encode('utf-8')\nprint(b)\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/5.Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#66-\u6574\u6570\u548cbytes\u4e92\u76f8\u8f6c\u6362","title":"6.6 \u6574\u6570\u548cbytes\u4e92\u76f8\u8f6c\u6362","text":"<pre><code>import struct\ndef byte2int(b):\nif isinstance(b, int):\nreturn b\nelse:\nreturn struct.unpack(\"!B\", b)[0]\ndef int2byte(i):\nreturn struct.pack(\"!B\", i)\nif __name__ == '__main__':\nprint(int2byte(2))\nprint(byte2int(b'\\x02'))\n</code></pre>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/","title":"6.Python\u9879\u76ee\u7684\u7ec4\u7ec7\u7ed3\u6784","text":""},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/#python\u9879\u76ee\u7ed3\u6784","title":"Python\u9879\u76ee\u7ed3\u6784","text":"<p>\u9879\u76ee\u7ed3\u6784\u4e3a\u7edf\u4e00\u7684\u7ec4\u7ec7\u539f\u5219\u3002</p> <p>\u7ec4\u7ec7\u539f\u5219\u53ef\u4ee5\u603b\u7ed3\u4e3a\u4e00\u53e5\u8bdd\uff1a\u8ba9\u4e00\u5207\u66f4\u7b80\u5355\u66f4\u8f7b\u677e</p> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u901a\u7528\u7684\u7ed3\u6784</p> <pre><code>download_demo\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 MANIFEST.in\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 conf\n\u251c\u2500\u2500 fabfile\n\u251c\u2500\u2500 others\n\u251c\u2500\u2500 src\n\u251c\u2500\u2500 setup.py\n\u2514\u2500\u2500 .gitignore\n\u251c\u2500\u2500 requirements.txt\n\u2514\u2500\u2500 venv\n\u2514\u2500\u2500 img\n</code></pre> <p>\u8fd9\u662fpython\u9879\u76ee\u6700\u5916\u5c42\u7684\u4e00\u4e2a\u7ed3\u6784\uff1a</p> <ul> <li>LICENSE: \u8868\u793a\u5f00\u6e90\u534f\u8bae</li> <li>README.md\uff1a\u9879\u76ee\u4ecb\u7ecd</li> <li>conf\uff1a\u5b58\u653e\u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u90e8\u7f72\u65f6\u7528\u5230\u7684Nginx\u7684\u914d\u7f6e\u3001Supervisor\u7684\u914d\u7f6e\u6216\u8005\u5176\u4ed6\u914d\u7f6e</li> <li>fabfile\uff1a\u9488\u5bf9Fabric\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2afabfile.py\u6587\u4ef6\u3002\u5982\u679c\u529f\u80fd\u8f83\u591a\uff0c\u53ef\u4ee5\u62c6\u5206\u591a\u4e2a\u6a21\u5757\uff0c\u653e\u5230fabfile\u5305\u4e0b\uff0c\u7528<code>__init__.py</code>\u8fdb\u884c\u66b4\u9732</li> <li>src\uff1a\u9879\u76ee\u6e90\u7801\u76ee\u5f55</li> <li>requirements.txt\uff1a\u9879\u76ee\u4f9d\u8d56\u6a21\u5757\uff0c\u901a\u8fc7pip install -r requirements.txt\u5c31\u53ef\u4ee5\u5b89\u88c5\u597d\u9879\u76ee\u7684\u6240\u6709\u4f9d\u8d56</li> <li>setup.py\uff1a\u7528\u6765\u6253\u5305\u9879\u76ee</li> <li>others\uff1a\u5176\u4ed6\u4e00\u4e9b\u6709\u5fc5\u8981\u653e\u5230\u6e90\u7801\u7ba1\u7406\u7684\u6587\u4ef6\u3002</li> <li>.gitignore: \u5ffd\u7565\u4e00\u4e9b\u4e0d\u9700\u8981\u88ab\u7eb3\u7ba1\u7684\u7ba1\u7406\u6587\u4ef6\uff0c\u5982pyc\u548clog\u3001env\u3001.swp\u7b49\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u5e38\u7528\u8fc7\u6ee4\u6389\u7684\u8fd8\u6709dist/\u548c build/\u7b49\u76ee\u5f55\uff0c\u5982\u52a0\u5165\u5e38\u89c1\u7684build\u3001dist\u3001.so\u3001.pyc\u3002</li> <li>MANIFEST.in\uff1a\u8ddfsetup.py\u914d\u5408\u4f7f\u7528</li> <li>venv\uff1a\u865a\u62df\u73af\u5883\u76ee\u5f55\u3002</li> <li>img\uff1aREADME.md\u8bf4\u660e\u6587\u6863\u4e2d\u5f15\u7528\u56fe\u7247\u56fe\u6807\u7684\u653e\u7f6e\u76ee\u5f55</li> </ul>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/#django\u9879\u76ee\u7684\u7ec4\u7ec7\u7ed3\u6784","title":"Django\u9879\u76ee\u7684\u7ec4\u7ec7\u7ed3\u6784","text":"<pre><code>project(src)\n\u251c\u2500\u2500 app1\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 admin.py\n\u2502   \u251c\u2500\u2500 apps.py\n\u2502   \u251c\u2500\u2500 migrations\n\u2502   \u251c\u2500\u2500 models.py\n\u2502   \u251c\u2500\u2500 script\n\u2502   \u251c\u2500\u2500 serializers.py\n\u2502   \u251c\u2500\u2500 tests.py\n\u2502   \u2514\u2500\u2500 views.py\n\u251c\u2500\u2500 app2\n\u251c\u2500\u2500 db.sqlite3\n\u251c\u2500\u2500 project\n\u2502   \u251c\u2500\u2500 asgi.py\n\u2502   \u251c\u2500\u2500 settings.py\n\u2502   \u251c\u2500\u2500 urls.py\n\u2502   \u2514\u2500\u2500 wsgi.py\n\u251c\u2500\u2500 manage.py\n\u251c\u2500\u2500 requirements.txt\n\u251c\u2500\u2500 templates\n\u251c\u2500\u2500 upload\n\u2514\u2500\u2500 venv\n    \u251c\u2500\u2500 Lib\n    \u251c\u2500\u2500 pyvenv.cfg\n    \u2514\u2500\u2500 Scripts\n</code></pre> <p>Django\u4e2d\u7684\u6587\u4ef6\u53ca\u8bf4\u660e</p> \u6587\u4ef6 \u8bf4\u660e manage.py Django\u7a0b\u5e8f\u6267\u884c\u7684\u5165\u53e3 db.sqlite3 SQLite\u7684\u6570\u636e\u6587\u4ef6\uff0cDjango\u9ed8\u8ba4\u7528\u8fd9\u79cd\u5c0f\u578b\u6570\u636e\u5e93\u5b58\u50a8\u6570\u636e\uff0c\u975e\u5fc5\u987b templates Django\u751f\u6210\u7684HTML\u6587\u4ef6\u5939\uff0c\u4e5f\u53ef\u4ee5\u5728\u6bcf\u4e2aAPP\u4e2d\u4f7f\u7528\u6a21\u677f\u6587\u4ef6\u5939 project Django\u751f\u6210\u7684\u548c\u9879\u76ee\u540c\u540d\u7684\u914d\u7f6e\u6587\u4ef6\u5939 settings.py Django\u603b\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u914d\u7f6eAPP\u3001\u6570\u636e\u5e93\u3001\u4e2d\u95f4\u4ef6\u3001\u6a21\u677f\u7b49\u8bf8\u591a\u9009\u9879 urls.py Django\u9ed8\u8ba4\u7684\u8def\u7531\u914d\u7f6e\u6587\u4ef6 wsgi.py Django\u5b9e\u73b0\u7684WSGI\u63a5\u53e3\u7684\u6587\u4ef6\uff0c\u7528\u6765\u5904\u7406Web\u8bf7\u6c42"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/#settings\u7684\u62c6\u5206","title":"settings\u7684\u62c6\u5206","text":"<p>\u6b63\u5e38\u60c5\u51b5\u4e0bDjango\u4f1a\u4e3a\u6211\u4eec\u521b\u5efa\u4e00\u4e2asettings.py\u6587\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u533a\u5206\u5f00\u53d1\u73af\u5883\u548c\u7ebf\u4e0a\u73af\u5883\u3002</p> <p>\u5177\u4f53\u7684\u505a\u6cd5\u662f\u5728\u4e4b\u524d settings\u76ee\u5f55\u4e2d\u65b0\u5efasettings\u5305\uff0c\u628a\u4e4b\u524dsettings.py\u7684\u5185\u5bb9\u653e\u7f6e\u5230<code>settings/base.py</code>\u4e2d\uff0c\u5220\u9664\u539f\u6765\u7684<code>settings.py</code>\u6587\u4ef6\uff0c\u540c\u65f6\u65b0\u589e<code>__init__.py</code>\u3001<code>develop.py</code>\u3001<code>product.py</code>\u6587\u4ef6\u3002</p> <p>\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>project(src)\n\u251c\u2500\u2500 app1\n\u251c\u2500\u2500 app2\n\u251c\u2500\u2500 db.sqlite3\n\u251c\u2500\u2500 project\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 asgi.py\n\u251c\u2500\u2500 settings\n\u2502   \u251c\u2500\u2500 base.py\n\u2502   \u251c\u2500\u2500 develop.py\n\u2502   \u2514\u2500\u2500 product.py\n\u251c\u2500\u2500 urls.py\n\u2514\u2500\u2500 wsgi.py\n\u251c\u2500\u2500 manage.py\n\u251c\u2500\u2500 requirements.txt\n\u251c\u2500\u2500 templates\n</code></pre> <p>base.py\u7684\u5185\u5bb9\u548c\u4e4b\u524dsettings.py\u7684\u5185\u5bb9\u4e00\u81f4\u3002</p> <p>develop.py(\u5f00\u53d1)\u73af\u5883\u914d\u7f6e</p> <pre><code>from .base import *\nSECRET_KEY = '\u8fd9\u91cc\u662f\u4f60pycharm\u81ea\u5df1\u751f\u6210\u7684\u79d8\u94a5'\n# \u5f00\u53d1\u73af\u5883\u6570\u636e\u5e93\nDATABASES = {\n'default': {\n'ENGINE': 'django.db.backends.mysql',\n'NAME': 'mytest',\n'USER': 'root',\n'PASSWORD': 'OSChina@2020',\n'HOST': '127.0.0.1',\n# \u7b2c\u4e09\u65b9\u767b\u5f55\u529f\u80fd\u5fc5\u987b\u52a0\u4e0a\n\"OPTIONS\": {\"init_command\": \"SET default_storage_engine=INNODB;\"}\n}\n}\n# \u7ebf\u4e0b\u5f00\u53d1\u6a21\u5f0f\u662fTrue\nDEBUG = True\nALLOWED_HOSTS = [\"*\"]\n</code></pre> <p>product.py(\u751f\u4ea7)\u73af\u5883\u914d\u7f6e</p> <pre><code>from .base import *\nSECRET_KEY = '\u8fd9\u91cc\u662f\u4f60pycharm\u81ea\u5df1\u751f\u6210\u7684\u79d8\u94a5'\n# \u7ebf\u4e0a\u6570\u636e\u5e93\nDATABASES = {\n'default': {\n'ENGINE': 'django.db.backends.mysql',\n'NAME': 'openvpndb',\n'USER': 'root',\n'PASSWORD': 'OSChina@2020',\n'HOST': '192.168.1.132',\n# \u7b2c\u4e09\u65b9\u767b\u5f55\u529f\u80fd\u5fc5\u987b\u52a0\u4e0a\n'CONN_MAX_AGE': 5*60,\n\"OPTIONS\": {\"init_command\": \"SET default_storage_engine=INNODB;\"}\n}\n}\n# \u7ebf\u4e0a\u8c03\u8bd5\u6a21\u5f0f\u662fFalse\nDEBUG = False\nALLOWED_HOSTS = [www.hujianlirunjs.com]\n</code></pre> <p>\u62c6\u5206\u5b8csettings.py\u540e\uff0c\u6211\u4eec\u9700\u8981\u4fee\u6539\u4e24\u4e2a\u6587\u4ef6\uff1amanage.py\u3001wsgi.py</p> <p>manage.py\u548cwsgi.py\u90fd\u66f4\u6539\u4e3a</p> <pre><code>profile = os.environ.get('PROJECT_PROFILE', 'develop')\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'download_demo.settings.{}'.format(profile))\n</code></pre> <p>pychrm\u4e2d\u4fee\u6539\u8fd0\u884c\u6309\u94ae\u4e3a\uff1a</p> <pre><code>PYTHONUNBUFFERED=1;DJANGO_SETTINGS_MODULE=project.settings.develop\n</code></pre> <p>\u62c6\u5206<code>settings.py</code>\u7684\u4f5c\u7528\u662f\u4fdd\u8bc1\u5f00\u53d1\u7684\u7ec4\u7ec7\u5408\u7406\u6027\uff0c\u964d\u4f4e\u540e\u671f\u5f00\u53d1\u7ef4\u62a4\u7684\u6210\u672c</p>"},{"location":"Python/1.%E5%9F%BA%E7%A1%80%E7%AF%87/6.Python%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/#django-\u751f\u4ea7\u5f00\u53d1\u914d\u7f6e\u5206\u79bb","title":"Django \u751f\u4ea7\u5f00\u53d1\u914d\u7f6e\u5206\u79bb","text":"<p>Django \u751f\u4ea7\u5f00\u53d1\u914d\u7f6e\u5206\u79bb</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/","title":"10.\u6587\u6863\u4e0e\u62a5\u544a","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#1\u4f7f\u7528csv\u8bfb\u5199csv\u6587\u4ef6","title":"1.\u4f7f\u7528csv\u8bfb\u5199CSV\u6587\u4ef6","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#11-\u5199\u5165csv\u6570\u636e","title":"1.1 \u5199\u5165CSV\u6570\u636e","text":"<ul> <li>\u5199\u5165\u5143\u7956\u5e8f\u5217\u7684\u6570\u636e</li> </ul> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nimport csv\nheaders = ['ID', 'UserName', 'Password', 'Age', 'Country']\nrows = [(1001, \"qiye\", \"qiye_pass\", 24, \"China\"),\n(1002, \"Mary\", \"Mary_pass\", 20, \"USA\"),\n(1003, \"Jack\", \"Jack_pass\", 20, \"USA\"),\n]\nwith open('qiye.csv', 'w', newline=\"\") as f:\nf_csv = csv.writer(f)\nf_csv.writerow(headers)\nf_csv.writerows(rows)\n</code></pre> <ul> <li>\u5199\u5165\u5b57\u5178\u5e8f\u5217\u7684\u6570\u636e</li> </ul> <pre><code>import csv\nheaders = ['ID', 'UserName', 'Password', 'Age', 'Country']\nrows = [{'ID': 1001, 'UserName': \"qiye\", 'Password': \"qiye_pass\", 'Age': 24, 'Country': \" China\"},\n{'ID': 1002, 'UserName': \"Mary\", 'Password': \"Mary_pass\", 'Age': 20, 'Country': \"USA\"},\n{'ID': 1003, 'UserName': \"Jack\", 'Password': \"Jack_pass\", 'Age': 20, 'Country': \"USA\"},\n]\nwith open('qiye2.csv', 'w') as f:\nf_csv = csv.DictWriter(f, headers)\nf_csv.writeheader()\nf_csv.writerows(rows)\n</code></pre> <ul> <li>\u5199\u5165\u666e\u901a\u6570\u636e</li> </ul> <pre><code>import csv\nwith open(\"sr.csv\", \"w\") as f:\nw = csv.writer(f, delimiter=\",\")\nw.writerow([\"one\", \"two\", \"three\"])\nw.writerow([\"four\", \"five\", \"six\"])\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#12-\u8bfb\u53d6csv\u6570\u636e","title":"1.2 \u8bfb\u53d6CSV\u6570\u636e","text":"<pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2020/5/6 13:11\n# filename: sample03.py\nimport csv\nwith open('qiye.csv') as f:\nf_csv = csv.reader(f)\nheaders = next(f_csv)\nprint(headers)\nfor row in f_csv:\nprint(row)\n</code></pre> <ul> <li>\u4ee5\u5217\u8868\u5f62\u5f0f\u8f93\u51fa</li> </ul> <pre><code>import csv\ncsvfile = open('csv_test.csv', 'r')\n# \nreader = csv.reader(csvfile)\nfor row in reader:\nif '\u5c0fP' in row:\nprint(row)\n</code></pre> <ul> <li>\u4ee5\u5b57\u5178\u5f62\u5f0f\u8f93\u51fa</li> </ul> <pre><code># \u4ee5\u5b57\u5178\u5f62\u5f0f\u8f93\u51fa\uff0c\u7b2c\u4e00\u884c\u4f5c\u4e3a\u5b57\u5178\u7684\u952e\nreader = csv.DictReader(csvfile)\nfor row in reader:\nif row['\u59d3\u540d']== '\u5c0fP':\nprint(row)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#13-\u8bfb\u5199csv\u6587\u4ef6","title":"1.3 \u8bfb\u5199CSV\u6587\u4ef6","text":"<pre><code>import csv\nwith open('pingan.csv', 'r') as rf:\nreader = csv.reader(rf)\nwith open('pingan2.csv', 'w') as wf:\nwriter = csv.writer(wf)\nheaders = next(reader)\nwriter.writerow(headers)\nfor row in reader:\nif row[0] &lt; '2016-01-01':\nbreak\nif int(row[5]) &gt;= int(50000000):\nwriter.writerow(row)\n</code></pre> <p>\u8bfb\u53d6-\u5199\u5165-\u8bfb\u53d6</p> <pre><code># writer()\u51fd\u6570\n# \u5148\u8bfb\u53d6csv\u6587\u4ef6\uff0c\u518d\u5c06\u8bfb\u53d6\u7684\u6570\u636e\u5904\u7406\u540e\u5199\u5165\u65b0\u7684csv\u4e2d\nimport csv\nheaders = ['\u7f16\u53f7', '\u4e66\u540d', '\u4f5c\u8005', '\u51fa\u7248\u793e', '\u51fa\u7248\u65f6\u95f4', '\u7ea7\u522b']\nrows = [\n\"10,\u8f6f\u4ef6\u5de5\u7a0b1,\u80e1\u5efa\u529b,\u673a\u68b0\u5de5\u4e1a\u51fa\u7248\u793e,199407226517,2\",\n\"11,\u6c47\u7f16\u8bed\u8a001,\u80e1\u5efa\u529b2,\u5317\u4eac\u5de5\u4e1a\u5927\u5b66\u51fa\u7248\u793e,199407126517,2\",\n\"12,\u8ba1\u7b97\u673a\u8bed\u8a001,\u80e1\u5efa\u529b3,\u7ecf\u6d4e\u79d1\u5b66\u51fa\u7248\u793e,199417126517,1\",\n\"13,FLASH\u7cbe\u90091,\u80e1\u5efa\u529b4,\u4e2d\u56fd\u7eba\u7ec7\u51fa\u7248\u793e,199417126511,3\",\n\"14,JAVA\u57fa\u78401,\u80e1\u5efa\u529b5,\u7535\u5b50\u5de5\u4e1a\u51fa\u7248\u793e,199117126511,3\",\n\"15,JAVA\u7a0b\u5e8f\u8bbe\u8ba11,\u80e1\u5efa\u529b6,\u4e16\u754c\u51fa\u7248\u793e,199117126512,2\",\n\"16,\u65b0\u4e1c\u65b9\u82f1\u8bed1,\u80e1\u5efa\u529b7,\u5916\u8bed\u51fa\u7248\u793e,192117126512,1\"\n]\nwith open(\"test.csv\", \"r\", encoding=\"utf-8\") as rf:\nreader = csv.reader(rf)\nprint(\"\u5f00\u59cb\u8bfb\u53d6test.csv\u6587\u4ef6\u5185\u5bb9......................\")\nwith open(\"test_bak.csv\", \"w\", newline=\"\", encoding=\"utf-8\") as wf:\nwriter = csv.writer(wf, delimiter=\",\")\nheader = [\"|\".join(headers)]\nprint(\"\u5f00\u59cb\u5199\u5165\u6807\u9898header \u5230test_bak.csv\u6587\u4ef6......................\")\nwriter.writerow(header)\nprint(\"\u5f00\u59cb\u5199\u5165\u6587\u4ef6\u65e7\u6570\u636e \u5230test_bak.csv\u6587\u4ef6......................\")\nfor row in reader:\n# print(row)\nwriter.writerow(row)\nrows_list = [str(row).split(\",\") for row in rows]\nprint(\"\u5f00\u59cb\u5199\u5165\u65b0\u7684\u6570\u636e \u5230test_bak.csv\u6587\u4ef6......................\")\nfor row_new in rows_list:\nwriter.writerow(row_new)\nprint(\"\u8bfb\u5199\u5b8c\u6bd5\uff0c\u67e5\u770b\u5199\u5165\u540e\u7684\u5185\u5bb9................\")\nwith open(\"test_bak.csv\", \"r\", encoding=\"utf-8\") as rf:\nreader = csv.reader(rf)\nfor info in reader:\nprint(\"|\".join(info))\n</code></pre> <p>python3\u5199\u5165csv\u6587\u4ef6\u4e2d\u6587\u4e71\u7801\u7684\u89e3\u51b3</p> <pre><code># \u52a0\u5165encoding='utf-8-sig'\u5c31\u4e0d\u4f1a\u4e71\u7801\u4e86\nwith open(\"haha.csv\",'w',newline='',encoding='utf-8-sig') as csvfile:\nwriter = csv.writer(csvfile)\nwriter.writerow([\"\u98de\u673a\u8f6c\u573a\u8bb0\u5f55\u53f7\", \"\u767b\u673a\u53e3\"])\n</code></pre> <p>csv\u64cd\u4f5c\u51fd\u6570</p> <pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport csv\n# \u5c06\u6570\u636e\u5199\u5165csv\u6587\u4ef6\ndef write_csv_file(path, head, data):\n'''\n    :param path: CSV\u6587\u4ef6\u7684\u8def\u5f84\u548c\u6587\u4ef6\u540d\n    :param head: \u751f\u6210\u7684CSV\u6587\u4ef6\u7684\u6587\u4ef6\u5934\n    :param data: data\u4e3a\u9700\u8981\u5199\u5165CSV\u6587\u4ef6\u7684\u6570\u636e\uff0c\u4e5f\u9700\u8981\u4f20\u5165\u4e00\u4e2a\u5217\u8868\n    :return:\n    '''\ntry:\nwith open(path, \"w\", newline='') as csv_file:\nwriter = csv.writer(csv_file, dialect='excel')\nif head is not None:\nwriter.writerow(head)\nfor row in data:\nwriter.writerow(row)\nprint(\"Write a CSV file to path %s Successful.\" % path)\nexcept Exception as e:\nprint(\"Write an CSV file to path: %s, Case: %s\" % (path, e))\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#2\u4f7f\u7528python\u5904\u7406excel\u6587\u6863","title":"2.\u4f7f\u7528Python\u5904\u7406Excel\u6587\u6863","text":"<p>Python\u64cd\u4f5c\u7684Excel\u5305\u6709<code>xlrd\u3001xlwt\u3001pyExcelerator\u548copenpyxl</code>\u3002</p> <p>\u5176\u4e2d\uff0cpyExcelerator\u53ea\u652f\u63012003\u7248\u672c\uff0copenpyxl\u53ea\u652f\u63012007\u7248\u672c\uff0cxlrd\u652f\u6301Excel\u4efb\u4f55\u7248\u672c\u7684\u8bfb\u53d6\uff0cxlwt\u652f\u6301Excel\u4efb\u4f55\u7248\u672c\u7684\u5199\u5165\u3002</p> <p>Python\u81ea\u5e26\u7684\u6a21\u5757\u4e2d\u6709\u9488\u5bf9xls\u683c\u5f0f\u7684xlrd\u548cxlwt\u6a21\u5757\uff0c\u4f46\u8fd9\u4e24\u4e2a\u5e93\u4ec5\u4ec5\u662f\u9488\u5bf9xls\u7684\u64cd\u4f5c\uff0c\u8981\u64cd\u4f5cxlsx\u683c\u5f0f\u6587\u4ef6\u65f6\uff0c\u5219\u9700\u8981\u4f7f\u7528\u5230openpyxl\u7b2c\u4e09\u65b9\u5e93\u3002</p> \u6a21\u5757 \u6765\u6e90 \u8bfb \u5199 \u652f\u6301\u683c\u5f0f xlrd \u6807\u51c6\u5e93 \u221a \u00d7 xls xlwt \u6807\u51c6\u5e93 \u00d7 \u221a xls openpyxl \u4e09\u65b9\u5e93 \u221a \u221a xlsx <p>\u6574\u4f53\u601d\u8def</p> <p>\u867d\u7136\u8fd9\u51e0\u4e2a\u5e93\u5df2\u7ecf\u628aExcel\u7684\u6587\u4ef6\u3001\u8868\u3001\u884c\u3001\u5217\u7684\u6982\u5ff5\u5b8c\u5168\u8f6c\u6362\u4e3aPython\u4e2d\u7684\u5bf9\u8c61\uff0c\u4f46\u6bcf\u6b21\u64cd\u4f5c\u90fd\u9700\u8981\u904d\u5386\u6bcf\u4e00\u4e2a\u5355\u5143\u683c\uff0c \u751a\u81f3\u5f88\u591a\u65f6\u5019\u8981\u82b1\u8d39\u5927\u91cf\u7684\u65f6\u95f4\u5728\u601d\u8003\u5faa\u73af\u5355\u5143\u683c\u7684\u8fb9\u754c\u4e0a\uff0c\u8fd9\u672c\u8eab\u5c31\u662f\u5728\u91cd\u590d\u9020\u8f6e\u5b50\uff0c\u56e0\u6b64\u82b1\u4e86\u534a\u5929\u65f6\u95f4\u6574\u7406\u4e86\u4ee5\u4e0b\u516d\u4e2a\u51fd\u6570\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#21-\u4f7f\u7528xlrd\u548cxlwt\u8bfb\u5199excel","title":"2.1 \u4f7f\u7528xlrd\u548cxlwt\u8bfb\u5199Excel","text":"<p>\u4e3a\u4e86\u7248\u672c\u7684\u517c\u5bb9\u6027\uff0c\u5927\u591a\u6570\u5f00\u53d1\u4eba\u5458\u9009\u62e9\u4f7f\u7528xlrd\u548cxlwt\u64cd\u4f5cExcel\u3002xlrd\u548cxlwt\u7684\u5b89\u88c5\u5982\u4e0b\uff1a</p> <pre><code>pip install xlrd\npip install xlwt\n</code></pre> <p>\u5b8c\u6210\u5b89\u88c5\u540e\uff0c\u5728Python\u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c\u67e5\u770bxlrd\u548cxlwt\u6a21\u5757\u7684\u7248\u672c\u4fe1\u606f\uff1a</p> <pre><code>&gt;&gt;&gt; import xlwt\n&gt;&gt;&gt; import xlrd\n&gt;&gt;&gt; xlrd.__VERSION__\n'2.0.1'\n&gt;&gt;&gt; xlwt.__VERSION__\n'1.3.0'\n</code></pre> <p>Excel\u7684\u5199\u5165\u76f8\u5bf9\u6bd4CVS\u590d\u6742\uff0c\u4f46Excel\u53ef\u4ee5\u5b9e\u73b0\u8bbe\u7f6e\u6570\u636e\u683c\u5f0f\u3001\u5408\u5e76\u5355\u5143\u683c\u3001\u8bbe\u7f6e\u516c\u5f0f\u548c\u63d2\u5165\u56fe\u7247\u7b49\u529f\u80fd\u3002\u4f7f\u7528xlwt\u5b9e\u73b0\u4e0a\u8ff0\u529f\u80fd\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#211-\u4f7f\u7528xlwt\u5199\u5165\u6587\u4ef6\u6570\u636e","title":"2.1.1 \u4f7f\u7528xlwt\u5199\u5165\u6587\u4ef6\u6570\u636e","text":"<p>\u6570\u636e\u6837\u672c</p> <p><code>car.txt</code></p> <pre><code>\u8f66\u8f86\u6982\u51b5       \u8f66\u9f84    \u5168\u6b3e\u4ef7    \u539f\u4ef7\n\u4e09\u83f11          2      50001   60001\n\u4e09\u83f12          2      50002   60002\n\u4e09\u83f13          2      50003   60003\n</code></pre> <pre><code>import xlwt\n# \u6807\u9898\u5217\u8868\ncolumns = []\n# \u6570\u636e\u5217\u8868\ndatas = []\nwith open('car.txt', encoding='utf-8') as f:\n# \u9996\u884c\u5224\u65ad\nis_first_line = True\nfor line in f:\nline = line[:-1]\nif is_first_line:\nis_first_line = False\ncolumns = line.split('\\t')\ncontinue\ndatas.append(line.split('\\t'))\n# print(columns)\n#\n# for data in datas:\n#     print(data)\ndef Using_xlwt():\n\"\"\"\n    \u4f7f\u7528xlwt\u751f\u6210xls\u7684excel\u6587\u4ef6\n    :return:\n    \"\"\"\nworkbook = xlwt.Workbook(encoding='utf-8')\nsheet = workbook.add_sheet('\u74dc\u5b50\u4e8c\u624b\u8f66')\nfor col, column in enumerate(columns):\nsheet.write(0, col, column)\nfor row, data in enumerate(datas):\nfor col, column_data in enumerate(data):\nsheet.write(row + 1, col, column_data)\nworkbook.save('\u74dc\u5b50\u4e8c\u624b\u8f661.xls')\nif __name__ == '__main__':\nUsing_xlwt()\n</code></pre> <p>\u6216\u8005\u5982\u4e0b\u65b9\u5f0f</p> <pre><code>def write_xls_excel(url,sheet_name,two_dimensional_data):\n\"\"\"\n    \u5199\u5165xls\u683c\u5f0f\u6587\u4ef6\n    \u53c2\u6570\uff1a\n        url:\u6587\u4ef6\u8def\u5f84\n        sheet_name:\u8868\u540d\n        two_dimensional_data\uff1a\u5c06\u8981\u5199\u5165\u8868\u683c\u7684\u6570\u636e\uff08\u4e8c\u7ef4\u5217\u8868\uff09\n    \"\"\"\n# \u521b\u5efa\u5de5\u4f5c\u7c3f\u5bf9\u8c61\nworkbook = xlwt.Workbook()\n# \u521b\u5efa\u5de5\u4f5c\u8868\u5bf9\u8c61\nsheet = workbook.add_sheet(sheet_name)\n# \u904d\u5386\u6bcf\u4e00\u884c\u6570\u636e\nfor i in range(0,len(two_dimensional_data)):\n# \u904d\u5386\u6bcf\u4e00\u5217\u6570\u636e\nfor j in range(0,len(two_dimensional_data[i])):\n# \u5199\u5165\u6570\u636e\nsheet.write(i,j,two_dimensional_data[i][j])\n# \u4fdd\u5b58\nworkbook.save(url)\nprint(\"\u5199\u5165\u6210\u529f\")\n</code></pre> <p>\u4f7f\u7528xlwt\u6a21\u5757\u628a\u6570\u636e\u5199\u5165Excel\u6587\u4ef6\u7684\u6574\u4f53\u601d\u8def\u5982\u4e0b\uff1a</p> <ol> <li>xlwt\u521b\u5efa\u751f\u6210\u4e34\u65f6Excel\u5bf9\u8c61\u3002</li> <li>\u6dfb\u52a0WorkSheets\u5bf9\u8c61\u3002</li> <li>\u5355\u5143\u683c\u7684\u4f4d\u7f6e\u7531\u884c\u5217\u7d22\u5f15\u51b3\u5b9a\uff0c\u7d22\u5f15\u4ece0\u5f00\u59cb\u3002</li> <li>\u6570\u636e\u5199\u5165\u4e3b\u8981\u7531write_merge()\u548cwrite()\u5b9e\u73b0\uff0c\u4e24\u8005\u5206\u522b\u662f\u5408\u5e76\u5355\u5143\u683c\u518d\u5199\u5165\u548c\u5355\u5143\u683c\u5199\u5165\u3002</li> <li>\u8bbe\u7f6e\u6570\u636e\u683c\u5f0f\u662f\u5728\u5199\u5165\uff08write_merge()\u548cwrite()\uff09\u7684\u6570\u636e\u4e2d\u4f20\u5165\u53c2\u6570style\u3002</li> </ol> <p>\u9664\u6b64\u4e4b\u5916\uff0cxlwt\u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u5355\u5143\u683c\u80cc\u666f\u989c\u8272\u3001\u6dfb\u52a0\u5355\u5143\u683c\u8fb9\u6846\u3001\u8bbe\u7f6e\u5355\u5143\u683c\u9ad8\u5bbd\u5ea6\u3001\u8bbe\u7f6e\u5b57\u4f53\u989c\u8272\u548c\u6570\u636e\u7c7b\u578b\u7b49\uff0c\u7531\u4e8e\u7bc7\u5e45\u8f83\u5927\uff0c\u672c\u4e66\u5c31\u4e0d\u8be6\u7ec6\u8bb2\u89e3\u4e86\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#212-xls\u6587\u4ef6\u8ffd\u52a0\u5199\u5165\u6570\u636e","title":"2.1.2 xls\u6587\u4ef6\u8ffd\u52a0\u5199\u5165\u6570\u636e","text":"<pre><code>def\u00a0write_xls_excel_add(url,\u00a0two_dimensional_data,\u00a0index):\n\"\"\"\n\u00a0\u00a0\u00a0\u00a0\u8ffd\u52a0\u5199\u5165xls\u683c\u5f0f\u6587\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u53c2\u6570\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0url:\u6587\u4ef6\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 two_dimensional_data\uff1a\u5c06\u8981\u5199\u5165\u8868\u683c\u7684\u6570\u636e\uff08\u4e8c\u7ef4\u5217\u8868\uff09\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 index\uff1a\u6307\u5b9a\u8981\u8ffd\u52a0\u7684\u8868\u7684\u5e8f\u53f7\uff08\u7b2c\u51e0\u4e2a\u5de5\u4f5c\u8868\uff0c\u4f20\u5165\u53c2\u6570\u4ece1\u5f00\u59cb\u6570\uff09\n\u00a0\u00a0\u00a0\u00a0\"\"\"\n#\u00a0\u6253\u5f00\u6307\u5b9a\u7684\u5de5\u4f5c\u7c3f\nworkbook\u00a0=\u00a0xlrd.open_workbook(url)\n#\u00a0\u83b7\u53d6\u5de5\u4f5c\u7c3f\u4e2d\u7684\u6240\u6709\u8868\u683c\nsheets\u00a0=\u00a0workbook.sheet_names()\n#\u00a0\u83b7\u53d6\u6307\u5b9a\u7684\u8868\nworksheet\u00a0=\u00a0workbook.sheet_by_name(sheets[index-1])\n#\u00a0\u83b7\u53d6\u8868\u683c\u4e2d\u5df2\u5b58\u5728\u7684\u6570\u636e\u7684\u884c\u6570\nrows_old\u00a0=\u00a0worksheet.nrows\n#\u00a0\u5c06xlrd\u5bf9\u8c61\u62f7\u8d1d\u8f6c\u5316\u4e3axlwt\u5bf9\u8c61\nnew_workbook\u00a0=\u00a0copy(workbook)\n#\u00a0\u83b7\u53d6\u8f6c\u5316\u540e\u5de5\u4f5c\u7c3f\u4e2d\u7684\u7b2cindex\u4e2a\u8868\u683c\nnew_worksheet\u00a0=\u00a0new_workbook.get_sheet(index-1)\n#\u00a0\u904d\u5386\u6bcf\u4e00\u884c\u6570\u636e\nfor\u00a0i\u00a0in\u00a0range(0,\u00a0len(two_dimensional_data)):\n#\u00a0\u904d\u5386\u6bcf\u4e00\u5217\u6570\u636e\nfor\u00a0j\u00a0in\u00a0range(0,\u00a0len(two_dimensional_data[i])):\n#\u00a0\u8ffd\u52a0\u5199\u5165\u6570\u636e\uff0c\u6ce8\u610f\u662f\u4ecei+rows_old\u884c\u5f00\u59cb\u5199\u5165\nnew_worksheet.write(i+rows_old,\u00a0j,\u00a0two_dimensional_data[i][j])\n#\u00a0\u4fdd\u5b58\u5de5\u4f5c\u7c3f\nnew_workbook.save(url)\nprint(\"\u8ffd\u52a0\u5199\u5165\u6210\u529f\")\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#213-\u4f7f\u7528xlrd\u8bfb\u53d6\u6587\u4ef6\u6570\u636e","title":"2.1.3 \u4f7f\u7528xlrd\u8bfb\u53d6\u6587\u4ef6\u6570\u636e","text":"<pre><code>def Using_xlrd():\n\"\"\"\n    \u4f7f\u7528xlrd\u8bfb\u53d6xls\u7684excel\u6587\u4ef6\n    :return:\n    \"\"\"\ndf = xlrd.open_workbook('./\u74dc\u5b50\u4e8c\u624b\u8f661.xls')\ntable = df.sheet_by_name('\u74dc\u5b50\u4e8c\u624b\u8f66')\nfor i in range(table.nrows):\nprint(table.row_values(i))\n</code></pre> <p>\u6216\u8005\u5982\u4e0b\u65b9\u5f0f</p> <pre><code>def read_xls_excel(url,index):\n\"\"\"\n    \u8bfb\u53d6xls\u683c\u5f0f\u6587\u4ef6\n    \u53c2\u6570\uff1a\n        url:\u6587\u4ef6\u8def\u5f84\n        index\uff1a\u5de5\u4f5c\u8868\u5e8f\u53f7\uff08\u7b2c\u51e0\u4e2a\u5de5\u4f5c\u8868\uff0c\u4f20\u5165\u53c2\u6570\u4ece1\u5f00\u59cb\u6570\uff09\n    \u8fd4\u56de\uff1a\n        data:\u8868\u683c\u4e2d\u7684\u6570\u636e\n    \"\"\"\n# \u6253\u5f00\u6307\u5b9a\u7684\u5de5\u4f5c\u7c3f\nworkbook = xlrd.open_workbook(url)\n# \u83b7\u53d6\u5de5\u4f5c\u7c3f\u4e2d\u7684\u6240\u6709\u8868\u683c\nsheets = workbook.sheet_names()\n# \u83b7\u53d6\u5de5\u4f5c\u7c3f\u4e2d\u6240\u6709\u8868\u683c\u4e2d\u7684\u7684\u7b2c index \u4e2a\u8868\u683c\nworksheet = workbook.sheet_by_name(sheets[index-1])\n# \u5b9a\u4e49\u5217\u8868\u5b58\u50a8\u8868\u683c\u6570\u636e\ndata = []\n# \u904d\u5386\u6bcf\u4e00\u884c\u6570\u636e\nfor i in range(0, worksheet.nrows):\n# \u5b9a\u4e49\u8868\u683c\u5b58\u50a8\u6bcf\u4e00\u884c\u6570\u636e\nda = []\n# \u904d\u5386\u6bcf\u4e00\u5217\u6570\u636e\nfor j in range(0, worksheet.ncols):\n# \u5c06\u884c\u6570\u636e\u5b58\u50a8\u5230da\u5217\u8868\nda.append(worksheet.cell_value(i, j))\n# \u5b58\u50a8\u6bcf\u4e00\u884c\u6570\u636e\ndata.append(da)\n# \u8fd4\u56de\u6570\u636e\nreturn data\n</code></pre> <p>\u8bfb\u53d6Excel\u6587\u4ef6\u7684\u6570\u636e\u601d\u8def\u5927\u81f4\u5982\u4e0b\uff1a</p> <ol> <li>xlrd\u751f\u6210Workbook\u5bf9\u8c61\uff0c\u5e76\u6307\u5411Excel\u6587\u4ef6\u3002</li> <li>\u9009\u62e9Workbook\u91cc\u9762\u67d0\u4e2aWorkSheets\u5bf9\u8c61\u3002</li> <li>\u83b7\u53d6WorkSheets\u91cc\u9762\u7684\u6570\u636e\u5df2\u5360\u7528\u7684\u603b\u884c\u6570\u548c\u603b\u5217\u6570(\u67d0\u4e2a\u5355\u5143\u683c\u7684\u6570\u636e)\u3002</li> <li>\u5faa\u73af\u603b\u884c\u6570\u548c\u603b\u5217\u6570\uff0c\u8bfb\u53d6\u6bcf\u4e00\u4e2a\u5355\u5143\u683c\u7684\u6570\u636e\u3002</li> </ol>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#22-\u4f7f\u7528openpyxl\u8bfb\u5199excel","title":"2.2 \u4f7f\u7528openpyxl\u8bfb\u5199Excel","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#221-\u8bfb\u53d6excel\u6587\u4ef6","title":"2.2.1 \u8bfb\u53d6Excel\u6587\u4ef6","text":"<pre><code>import openpyxl\ndef read_xlsx_excel(url, sheet_name):\n\"\"\"\n    \u8bfb\u53d6xlsx\u683c\u5f0f\u6587\u4ef6\n    \u53c2\u6570\uff1a\n        url:\u6587\u4ef6\u8def\u5f84\n        sheet_name:\u8868\u540d\n    \u8fd4\u56de\uff1a\n        data:\u8868\u683c\u4e2d\u7684\u6570\u636e\n    \"\"\"\n# \u4f7f\u7528openpyxl\u52a0\u8f7d\u6307\u5b9a\u8def\u5f84\u7684Excel\u6587\u4ef6\u5e76\u5f97\u5230\u5bf9\u5e94\u7684workbook\u5bf9\u8c61\nworkbook = openpyxl.load_workbook(url)\n# \u6839\u636e\u6307\u5b9a\u8868\u540d\u83b7\u53d6\u8868\u683c\u5e76\u5f97\u5230\u5bf9\u5e94\u7684sheet\u5bf9\u8c61\nsheet = workbook[sheet_name]\n# \u5b9a\u4e49\u5217\u8868\u5b58\u50a8\u8868\u683c\u6570\u636e\ndata = []\n# \u904d\u5386\u8868\u683c\u7684\u6bcf\u4e00\u884c\nfor row in sheet.rows:\n# \u5b9a\u4e49\u8868\u683c\u5b58\u50a8\u6bcf\u4e00\u884c\u6570\u636e\nda = []\n# \u4ece\u6bcf\u4e00\u884c\u4e2d\u904d\u5386\u6bcf\u4e00\u4e2a\u5355\u5143\u683c\nfor cell in row:\n# \u5c06\u884c\u6570\u636e\u5b58\u50a8\u5230da\u5217\u8868\nda.append(cell.value)\n# \u5b58\u50a8\u6bcf\u4e00\u884c\u6570\u636e\ndata.append(da)\n# \u8fd4\u56de\u6570\u636e\nreturn data\nif __name__ == '__main__':\nfn = '\u74dc\u5b50\u4e8c\u624b\u8f662.xlsx'\nsheet_name = \"\u9ed8\u8ba4title\"\nfor i in read_xlsx_excel(fn, sheet_name):\nprint(i)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#222-\u5199\u5165excel\u6587\u4ef6","title":"2.2.2 \u5199\u5165Excel\u6587\u4ef6","text":"<pre><code>import openpyxl\ndef write_xlsx_excel(url, sheet_name, two_dimensional_data, header=None):\n\"\"\"\n    \u5199\u5165xlsx\u683c\u5f0f\u6587\u4ef6\n    \u53c2\u6570\uff1a\n        url:\u6587\u4ef6\u8def\u5f84\n        sheet_name:\u8868\u540d\n        two_dimensional_data\uff1a\u5c06\u8981\u5199\u5165\u8868\u683c\u7684\u6570\u636e\uff08\u4e8c\u7ef4\u5217\u8868\uff09\n        header:\u8868\u5934\u6570\u636e\uff08\u53ef\u9009\uff09\n    \"\"\"\n# \u521b\u5efa\u5de5\u4f5c\u7c3f\u5bf9\u8c61\nworkbook = openpyxl.Workbook()\n# \u521b\u5efa\u5de5\u4f5c\u8868\u5bf9\u8c61\nsheet = workbook.active\n# \u8bbe\u7f6e\u8be5\u5de5\u4f5c\u8868\u7684\u540d\u5b57\nsheet.title = sheet_name\n# \u5199\u5165\u8868\u5934\nif header:\nfor j in range(0, len(header)):\nsheet.cell(row=1, column=j + 1, value=str(header[j]))\n# \u904d\u5386\u8868\u683c\u7684\u6bcf\u4e00\u884c\nfor i in range(len(two_dimensional_data)):\n# \u904d\u5386\u8868\u683c\u7684\u6bcf\u4e00\u5217\nfor j in range(len(two_dimensional_data[i])):\n# \u5199\u5165\u6570\u636e\uff08\u6ce8\u610fopenpyxl\u7684\u884c\u548c\u5217\u662f\u4ece1\u5f00\u59cb\u7684\uff09\nsheet.cell(row=i + 2, column=j + 1, value=str(two_dimensional_data[i][j]))\n# \u4fdd\u5b58\u5230\u6307\u5b9a\u4f4d\u7f6e\nworkbook.save(url)\nprint(\"\u5199\u5165\u6210\u529f\")\n</code></pre> <p>\u8c03\u7528\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>data = [\n[\"\u59d3\u540d\", \"\u5e74\u9f84\", \"\u6027\u522b\"],\n[\"\u5f20\u4e09\", 20, \"\u7537\"],\n[\"\u674e\u56db\", 25, \"\u5973\"],\n[\"\u738b\u4e94\", 30, \"\u7537\"]\n]\nwrite_xlsx_excel(\"example.xlsx\", \"Sheet1\", data, header=[\"Name\", \"Age\", \"Gender\"])\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#223-xlsx\u6587\u4ef6\u8ffd\u52a0\u5199\u5165\u6570\u636e","title":"2.2.3 xlsx\u6587\u4ef6\u8ffd\u52a0\u5199\u5165\u6570\u636e","text":"<pre><code>def\u00a0write_xlsx_excel_add(url,\u00a0sheet_name,\u00a0two_dimensional_data):\n\"\"\"\n\u00a0\u00a0\u00a0\u00a0\u8ffd\u52a0\u5199\u5165xlsx\u683c\u5f0f\u6587\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u53c2\u6570\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0url:\u6587\u4ef6\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sheet_name:\u8868\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 two_dimensional_data\uff1a\u5c06\u8981\u5199\u5165\u8868\u683c\u7684\u6570\u636e\uff08\u4e8c\u7ef4\u5217\u8868\uff09\n\u00a0\u00a0\u00a0\u00a0\"\"\"\n#\u00a0\u4f7f\u7528openpyxl\u52a0\u8f7d\u6307\u5b9a\u8def\u5f84\u7684Excel\u6587\u4ef6\u5e76\u5f97\u5230\u5bf9\u5e94\u7684workbook\u5bf9\u8c61\nworkbook\u00a0=\u00a0openpyxl.load_workbook(url)\n#\u00a0\u6839\u636e\u6307\u5b9a\u8868\u540d\u83b7\u53d6\u8868\u683c\u5e76\u5f97\u5230\u5bf9\u5e94\u7684sheet\u5bf9\u8c61\nsheet\u00a0=\u00a0workbook[sheet_name]\nfor\u00a0tdd\u00a0in\u00a0two_dimensional_data:\nsheet.append(tdd)\n#\u00a0\u4fdd\u5b58\u5230\u6307\u5b9a\u4f4d\u7f6e\nworkbook.save(url)\nprint(\"\u8ffd\u52a0\u5199\u5165\u6210\u529f\")\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#23-\u6848\u4f8b-\u5408\u5e76\u591a\u4e2aexcel\u5230\u4e00\u4e2aexcel\u4e2d","title":"2.3 \u6848\u4f8b-\u5408\u5e76\u591a\u4e2aExcel\u5230\u4e00\u4e2aExcel\u4e2d","text":"<pre><code>#!/usr/bin/python\nimport os\nimport glob\nimport openpyxl\ndef merge_xlsx_files(xlsx_files):\nwb = openpyxl.load_workbook(xlsx_files[0])\nws = wb.active\nws.title = \"merged result\"\nfor filename in xlsx_files[1:]:\nworkbook = openpyxl.load_workbook(filename)\nsheet = workbook.active\nfor row in sheet.iter_rows(min_row=2):\nvalues = [cell.value for cell in row]\nws.append(values)\nreturn wb\ndef get_all_xlsx_files(path):\nxlsx_files = glob.glob(os.path.join(path, '*.xlsx'))\nsorted(xlsx_files, key=str.lower)\nreturn xlsx_files\ndef main():\nxlsx_files = get_all_xlsx_files(os.path.expanduser('./'))\nwb = merge_xlsx_files(xlsx_files)\nwb.save('merged_form.xlsx')\nif __name__ == '__main__':\nmain()\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u901a\u8fc7glob\u83b7\u53d6\u4e86\u6307\u5b9a\u76ee\u5f55\u4e0b\u6240\u6709\u7684Excel\u6587\u6863\u3002\u7136\u540e\uff0c\u6211\u4eec\u5c06\u8fd9\u4e9b\u6587\u6863\u6309\u7167\u6587\u4ef6\u540d\u79f0\u8fdb\u884c\u4e86\u6392\u5e8f\u3002 \u6392\u5e8f\u4ee5\u540e\uff0c\u5728<code>merge_xlsx_files</code>\u51fd\u6570\u4e2d\u5c1d\u8bd5\u5408\u5e76\u591a\u4e2aExcel\u6587\u6863\u3002\u6211\u4eec\u5408\u5e76Excel\u7684\u601d\u8def\u4e5f\u5f88\u7b80\u5355\uff1a</p> <ol> <li>\u83b7\u53d6\u7b2c\u4e00\u4e2a\u6587\u6863\u4e2d\u7684\u8868\u683c(\u6211\u4eec\u7684Excel\u6587\u6863\u4e2d\u53ea\u6709\u4e00\u4e2a\u8868\u683c)</li> <li>\u4f9d\u6b21\u904d\u5386\u5176\u4ed6\u6587\u4ef6\u4e2d\u7684\u62a5\u540d\u8868\uff0c\u5e76\u901a\u8fc7<code>iter_rows\u51fd\u6570</code>\u5ffd\u7565\u62a5\u540d\u8868\u4e2d\u7684\u9996\u884c\u5185\u5bb9\uff1b</li> <li>\u901a\u8fc7\u5217\u8868\u63a8\u5bfc\u83b7\u53d6\u62a5\u540d\u8868\u4e2d\u7684\u6570\u636e\uff0c\u7136\u540e\u8c03\u7528Worksheet\u7684<code>append\u51fd\u6570</code>\u5c06\u6570\u636e\u6dfb\u52a0\u5230\u6c47\u603b\u8868\u7684\u672b\u5c3e\u3002</li> <li>\u4e0a\u8ff0\u64cd\u4f5c\u5b8c\u6210\u4ee5\u540e\uff0c\u8fd4\u56deWorkbook\u5bf9\u8c61\u3002\u5728main\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u8c03\u7528Workbook\u7684save\u65b9\u6cd5\u5c06\u6c47\u603b\u8868\u4fdd\u5b58\u5230merged form.xlsx\u6587\u4ef6\u4e2d\u3002</li> </ol> <p>\u6211\u4eec\u53ea\u82b1\u8d39\u51e0\u5206\u949f\u65f6\u95f4\u7f16\u5199\u4e86\u4e0d\u523030\u884c\u7684Python\u4ee3\u7801\uff0c\u5c31\u5b9e\u73b0\u4e86\u5c06\u591a\u4e2aExcel\u6587\u6863\u5408\u5e76\u6210\u5355\u4e2a\u6587\u4ef6\u7684\u529f\u80fd\u3002</p> <p>\u56e0\u4e3a\u662fPython\u7a0b\u5e8f\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u65e0\u8bba\u6709\u591a\u5c11\u5f20\u8868\u9700\u8981\u5408\u5e76\u90fd\u80fd\u591f\u5feb\u901f\u5904\u7406\uff0c\u5e76\u4e14\u4e0d\u4f1a\u51fa\u9519\uff0c\u4e5f\u4e0d\u4f1a\u62b1\u6028\u5904\u7406\u7684\u8868\u683c\u592a\u591a\u3002</p> <p>\u6269\u5c55\u9605\u8bfb<p>Python\u8bfb\u5199\u64cd\u4f5cExcel\u6570\u636e</p> <p>Python \u64cd\u4f5c Excel\u5e93\u5bf9\u6bd4</p> <p>Python \u64cd\u4f5c Excel\u5e93\u5bf9\u6bd4\u603b\u7ed3\u6574\u7406</p> <p>\u7528Python\u81ea\u52a8\u5316\u64cd\u4f5cExcel\u5236\u4f5c\u62a5\u8868</p> <p>Python\u5b9e\u73b0\u6570\u636e\u5199\u5165 Excel \u7684\u4e09\u79cd\u6a21\u5757</p> </p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#3\u4f7f\u7528python-docx\u8bfb\u5199word\u6587\u4ef6","title":"3.\u4f7f\u7528python-docx\u8bfb\u5199Word\u6587\u4ef6","text":"<p>\u5982\u679c\u5c06\u6570\u636e\u5b58\u50a8\u5728Word\u6587\u4ef6\u4e2d\uff0c\u4e00\u822c\u4ee5\u6587\u7ae0\u3001\u65b0\u95fb\u62a5\u9053\u548c\u5c0f\u8bf4\u8fd9\u7c7b\u6587\u5b57\u5185\u5bb9\u8f83\u957f\u7684\u6570\u636e\u4e3a\u4e3b\u3002Python\u8bfb\u5199Word\u6587\u4ef6\u9700\u8981\u7b2c\u4e09\u65b9\u5e93\u6269\u5c55\u652f\u6301\uff0c\u4f7f\u7528pip\u5b89\u88c5\uff1a</p> <pre><code>pip install python-docx\n</code></pre> <p>\u6a21\u5757\u5b89\u88c5\u540e\uff0c\u9a8c\u8bc1\u6a21\u5757\u662f\u5426\u5b89\u88c5\u6210\u529f\uff0c\u5728Python\u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c\u67e5\u770bpython-docx\u6a21\u5757\u7684\u7248\u672c\u4fe1\u606f\uff1a</p> <pre><code>&gt;&gt;&gt; import docx\n&gt;&gt;&gt; docx.__version__\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#31-\u5199\u5165word\u6587\u4ef6","title":"3.1 \u5199\u5165Word\u6587\u4ef6","text":"<pre><code># \u6570\u636e\u5199\u5165\nfrom docx import Document\nfrom docx.shared import Inches\n# \u521b\u5efa\u5bf9\u8c61\ndocument = Document()\n# \u6dfb\u52a0\u6807\u9898\uff0c\u5176\u4e2d\u201c0\u201d\u4ee3\u8868\u6807\u9898\u7c7b\u578b\uff0c\u5171\u67094\u79cd\u7c7b\u578b\uff0c\u5177\u4f53\u53ef\u5728Word\u7684\u201c\u5f00\u59cb\u201d\u2192\u201c\u6837\u5f0f\u201d\u4e2d\u67e5\u770b\ndocument.add_heading('Python \u722c\u866b', 0)\n# \u6dfb\u52a0\u6b63\u6587\u5185\u5bb9\u5e76\u8bbe\u7f6e\u90e8\u5206\u5185\u5bb9\u683c\u5f0f\np = document.add_paragraph('Python \u722c\u866b\u5f00\u53d1-')\n# \u8bbe\u7f6e\u5185\u5bb9\u52a0\u7c97\np.runs[0].bold = True\n# \u6dfb\u52a0\u5185\u5bb9\u5e76\u52a0\u7c97\np.add_run('\u6570\u636e\u5b58\u50a8-').bold = True\n# \u6dfb\u52a0\u5185\u5bb9\np.add_run('Word-')\n# \u6dfb\u52a0\u5185\u5bb9\u5e76\u8bbe\u7f6e\u5b57\u4f53\u659c\u4f53\np.add_run('\u5b58\u50a8\u5b9e\u4f8b\u3002').italic = True\n# \u6dfb\u52a0\u6b63\u6587\uff0c\u8bbe\u7f6e\u201c\u6837\u5f0f\u201d\u2192\u201c\u660e\u663e\u5f15\u7528\u201d\ndocument.add_paragraph('\u6837\u5f0f'  '\u660e\u663e\u5f15\u7528', style='IntenseQuote')\n# \u6dfb\u52a0\u6b63\u6587\uff0c\u8bbe\u7f6e\u201c\u9879\u76ee\u7b26\u53f7\u201d\ndocument.add_paragraph(\n'\u9879\u76ee\u7b26\u53f71', style='ListBullet'\n)\ndocument.add_paragraph(\n'\u9879\u76ee\u7b26\u53f72', style='ListNumber'\n)\n# \u6dfb\u52a0\u56fe\u7247\ndocument.add_picture('test.png', width=Inches(1.25))\n# \u6dfb\u52a0\u8868\u683c\ntable = document.add_table(rows=1, cols=3)\nhdr_cells = table.rows[0].cells\nhdr_cells[0].text = 'Qty'\nhdr_cells[1].text = 'Id'\nhdr_cells[2].text = 'Desc'\nfor item in range(2):\nrow_cells = table.add_row().cells\nrow_cells[0].text = 'a'\nrow_cells[1].text = 'b'\nrow_cells[2].text = 'c'\n# \u4fdd\u5b58\u6587\u4ef6\ndocument.add_page_break()\ndocument.save('test.docx')\n</code></pre> <p>\u5206\u6790\u4e0a\u8ff0\u4ee3\u7801\uff0c\u5728Word\u6587\u4ef6\u4e2d\u5199\u5165\u6570\u636e\u7684\u6574\u4f53\u601d\u8def\u5982\u4e0b\uff1a</p> <ol> <li>\u521b\u5efa\u751f\u6210\u4e34\u65f6Word\u5bf9\u8c61\u3002</li> <li>\u5206\u522b\u4f7f\u7528<code>add_paragraph()</code>\u548c<code>add_heading()</code>\u5bf9Word\u5bf9\u8c61\u6dfb\u52a0\u6807\u9898\u548c\u6b63\u6587\u5185\u5bb9\u3002</li> <li>\u5982\u679c\u60f3\u8bbe\u7f6e\u6b63\u6587\u5185\u5bb9\u7684\u5b57\u4f53\u52a0\u7c97\u548c\u659c\u4f53\u7b49\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u6b63\u6587\u5185\u5bb9p\u5bf9\u8c61\u7684\u5c5e\u6027<code>runs[0].bold</code>\u548c<code>add_run('XX').italic</code>\u8bbe\u7f6e\u4e3aTrue\u3002</li> <li>\u5982\u679c\u8981\u63d2\u5165\u56fe\u7247\u548c\u6dfb\u52a0\u8868\u683c\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728Word\u5bf9\u8c61\u4e2d\u4f7f\u7528\u65b9\u6cd5<code>add_picture()</code>\u548c<code>add_table()</code>\u3002</li> <li>\u5b8c\u6210\u6570\u636e\u5199\u5165\uff0c\u9700\u8981\u5c06Word\u5bf9\u8c61\u4fdd\u5b58\u6210Word\u6587\u4ef6\u3002</li> </ol>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#32-\u8bfb\u53d6word\u6570\u636e","title":"3.2 \u8bfb\u53d6Word\u6570\u636e","text":"<p>\u8bfb\u53d6Word\u6570\u636e\u6bd4\u5199\u5165\u6570\u636e\u76f8\u5bf9\u7b80\u5355\uff0c\u56e0\u4e3a\u4e0d\u7528\u8bbe\u7f6e\u5185\u5bb9\u683c\u5f0f\uff0c\u76f4\u63a5\u83b7\u53d6\u6570\u636e\u5373\u53ef\uff0c\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code># \u6570\u636e\u8bfb\u53d6\nimport docx\ndef readDocx(docName):\nfullText = []\ndoc = docx.Document(docName)\n# \u8bfb\u53d6\u5168\u90e8\u5185\u5bb9\nparas = doc.paragraphs\n# \u5c06\u6bcf\u884c\u6570\u636e\u5b58\u5165\u5217\u8868\nfor p in paras:\nfullText.append(p.text)\n# \u5c06\u5217\u8868\u6570\u636e\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\nreturn '\\n'.join(fullText)\nprint(readDocx('test.docx'))\n</code></pre> <p>\u5206\u6790\u4e0a\u8ff0\u4ee3\u7801\uff0c\u5728Word\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u6574\u4f53\u601d\u8def\u5982\u4e0b\uff1a</p> <ol> <li>\u751f\u6210Word\u5bf9\u8c61\uff0c\u5e76\u6307\u5411Word\u6587\u4ef6\u3002</li> <li>\u4f7f\u7528<code>paragraphs()</code>\u83b7\u53d6Word\u5bf9\u8c61\u5168\u90e8\u5185\u5bb9\u3002</li> <li>\u5faa\u73afparagraphs\u5bf9\u8c61\uff0c\u83b7\u53d6\u6bcf\u884c\u6570\u636e\u5e76\u5199\u5165\u5217\u8868\u3002</li> <li>\u5c06\u5217\u8868\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2a\u5217\u8868\u5143\u7d20\u4f7f\u7528\u6362\u884c\u7b26\u8fde\u63a5\uff0c\u8f6c\u6362\u540e\u6570\u636e\u7684\u6bb5\u843d\u5e03\u5c40\u4e0eWord\u6587\u4ef6\u76f8\u4f3c\u3002</li> </ol> <p>\u6269\u5c55\u9605\u8bfb</p> <p>\u7528Python\u81ea\u52a8\u5316\u8bfb\u5199Word\u6587\u6863</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#4\u5b9e\u8df5-\u591a\u6587\u4ef6\u8bfb\u5199\u529f\u80fd","title":"4.\u5b9e\u8df5-\u591a\u6587\u4ef6\u8bfb\u5199\u529f\u80fd","text":"<p>\u6837\u672c\u6587\u4ef6</p> <p><code>test.txt</code></p> <pre><code>[settings]\nusername = hujianli\npassword = 123123\n</code></pre> <p>main.py</p> <pre><code>import csv\nimport configparser\nimport xlrd\nimport docx\nimport xlwt\nclass ReadWrite():\ndef __init__(self, name):\nself.name = name\nself.fileStyle = name.split(\".\")[1]\ndef reads(self):\nvalue = None\nif self.fileStyle == 'txt':\nf = open(self.name, 'r', encoding='utf-8')\nvalue = f.read()\nf.close()\nif self.fileStyle == 'csv':\ncsvfile = open(self.name, 'r')\nvalue = csv.DictReader(csvfile)\nif self.fileStyle == 'ini':\nvalue = configparser.ConfigParser()\nvalue.read(self.name)\nif self.fileStyle in ['xls', 'xlsx']:\nvalue = xlrd.open_workbook(self.name)\nif self.fileStyle in ['doc', 'docx']:\ndoc = docx.Document(self.name)\nvalue = doc.paragraphs\nreturn value\ndef writes(self):\ntarget = None\nif self.fileStyle == 'txt':\ntarget = open(self.name, 'w', encoding='utf-8')\nif self.fileStyle == 'csv':\ncsvfile = open(self.name, 'w', newline='')\ntarget = csv.writer(csvfile)\nif self.fileStyle == 'ini':\ntarget = configparser.ConfigParser()\ntarget.read(self.name)\nif self.fileStyle in ['xls', 'xlsx']:\ntarget = xlwt.Workbook()\nif self.fileStyle in ['doc', 'docx']:\ntarget = docx.Document()\nreturn target\nif __name__ == '__main__':\nf = ReadWrite('test1.ini')\n# \u8bfb\u53d6\u6570\u636e\nvalue = f.reads()\nusername = value.get(\"settings\", \"username\")\npassword = value.getint(\"settings\", \"password\")\nprint(f'\u7528\u6237\u540d\u4e3a\uff1a{username}\uff0c\u5bc6\u7801\u4e3a\uff1a{password}')\n# \u5199\u5165\u6570\u636e\ntarget = f.writes()\ntarget.set(\"settings\", \"address\", \"GZ\")\nwith open(\"test1.ini\", \"w+\") as f:\ntarget.write(f)\n</code></pre> <p>\u6211\u4eec\u5b9a\u4e49\u4e86ReadWrite\u7c7b\uff0c\u5e76\u91cd\u5199\u4e86\u7c7b\u7684\u521d\u59cb\u5316\u65b9\u6cd5__init__()\uff0c\u5b9a\u4e49\u4e86\u5b9e\u4f8b\u65b9\u6cd5reads()\u548cwrites()\uff0c\u6bcf\u4e2a\u65b9\u6cd5\u7684\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ol> <li>\u521d\u59cb\u5316\u65b9\u6cd5__init__()\u8bbe\u7f6e\u7c7b\u5b9e\u4f8b\u5316\u7684\u53c2\u6570\uff0c\u5728\u7c7b\u7684\u5b9e\u4f8b\u5316\u8fc7\u7a0b\u4e2d\u5fc5\u987b\u4f20\u5165\u53c2\u6570name\uff0c\u8be5\u53c2\u6570\u4ee3\u8868\u6587\u4ef6\u7684\u8def\u5f84\u4fe1\u606f\u3002</li> <li>\u5b9e\u4f8b\u65b9\u6cd5reads()\u901a\u8fc7\u5224\u65ad\u6587\u4ef6\u540e\u7f00\u540d\u7684\u65b9\u5f0f\u9009\u62e9\u76f8\u5e94\u7684\u6587\u4ef6\u8bfb\u53d6\u64cd\u4f5c\uff0c\u7531\u4e8e\u6bcf\u4e2a\u6587\u4ef6\u7684\u8bfb\u53d6\u65b9\u5f0f\u5404\u4e0d\u76f8\u540c\uff0c\u53ea\u6709TXT\u3001CSV\u548cDocx\u6587\u4ef6\u662f\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0cINI\u548cExcel\u6587\u4ef6\u662f\u8fd4\u56de\u6587\u4ef6\u5bf9\u8c61\u3002</li> <li>\u5b9e\u4f8b\u65b9\u6cd5writes()\u4e5f\u662f\u901a\u8fc7\u5224\u65ad\u6587\u4ef6\u540e\u7f00\u540d\u7684\u65b9\u5f0f\u9009\u62e9\u76f8\u5e94\u7684\u6587\u4ef6\u5199\u5165\u64cd\u4f5c\uff0c\u6bcf\u4e2a\u6587\u4ef6\u7684\u6570\u636e\u5199\u5165\u65b9\u5f0f\u4e0d\u540c\uff0c\u6240\u4ee5\u8be5\u65b9\u6cd5\u8fd4\u56de\u76f8\u5e94\u7684\u6587\u4ef6\u5bf9\u8c61\uff0c\u5177\u4f53\u7684\u5199\u5165\u8fc7\u7a0b\u4e0d\u5728\u65b9\u6cd5\u5185\u5b9e\u73b0\u3002</li> </ol>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#5\u4f7f\u7528python\u64cd\u4f5cpdf\u6587\u6863","title":"5.\u4f7f\u7528Python\u64cd\u4f5cPDF\u6587\u6863","text":"<p>PDF\uff08Portable Document Format\uff09\u662f\u4e00\u79cd\u4fbf\u643a\u5f0f\u6587\u6863\u683c\u5f0f\uff0c\u8fd9\u79cd\u6587\u6863\u683c\u5f0f\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\u65e0\u5173\u3002</p> <p>PDF\u6587\u4ef6\u65e0\u8bba\u662f\u5728Windows\uff0cUnix\u8fd8\u662f\u5728\u82f9\u679c\u516c\u53f8\u7684Mac OS\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u90fd\u662f\u901a\u7528\u7684\uff0c\u8fd9\u4e00\u7279\u70b9\u4f7f\u5b83\u6210\u4e3a\u5728Internet\u4e0a\u8fdb\u884c\u7535\u5b50\u6587\u6863\u53d1\u884c\u548c\u6570\u5b57\u5316\u4fe1\u606f\u4f20\u64ad\u7684\u7406\u60f3\u6587\u6863\u683c\u5f0f\u3002</p> <p>\u867d\u7136PDF\u4fbf\u4e8e\u4f20\u8f93\u548c\u9605\u8bfb\uff0c\u4f46\u662f\uff0c\u7f16\u8f91PDF\u5374\u5f88\u4e0d\u5bb9\u6613\u3002PyPDF2\u5bf9\u7f16\u8f91PDF\u63d0\u4f9b\u4e86\u6709\u9650\u7684\u652f\u6301\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528PyPDF2\u6a21\u5757\u8bfb\u53d6\u3001\u5408\u5e76\u548c\u5199\u5165PDF\u6587\u6863\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#51-pypdf2\u5b89\u88c5\u4e0e\u4ecb\u7ecd","title":"5.1 PyPDF2\u5b89\u88c5\u4e0e\u4ecb\u7ecd","text":"<p>PyPDF2\u662f\u4e00\u4e2a\u7eafPython\u7684\u5f00\u6e90\u5e93\uff0c\u80fd\u591f\u5206\u5272\u6216\u5408\u5e76PDF\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u88c1\u526a\u6216\u8f6c\u6362PDF\u6587\u4ef6\u4e2d\u7684\u9875\u9762\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528PyPDF2\u67e5\u770bPDF\u6587\u4ef6\u7684\u5143\u4fe1\u606f\uff0c\u5bf9PDF\u6587\u4ef6\u8fdb\u884c\u52a0\u5bc6\uff0c\u7834\u89e3PDF\u6587\u4ef6\u7684\u5bc6\u7801\u7b49\u3002</p> <p>PyPDF2\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5e93\uff0c\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u4e4b\u524d\u9700\u8981\u5148\u5b89\u88c5\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>pip install PyPDF2\n</code></pre> <p>PyPDF2\u7684\u5b98\u65b9\u6587\u6863: https://pythonhosted.org/PyPDF2/index.html  \u4e2d\u627e\u5230PyPDF2\u7684\u4f7f\u7528\u6587\u6863\u3002</p> <p>\u4ece\u5b98\u65b9\u6587\u6863\u4e2d\u6211\u4eec\u77e5\u9053\uff0cPyPDF2\u63d0\u4f9b\u4e864\u4e2a\u4e3b\u8981\u7684\u7c7b\uff0c\u5206\u522b\u662f<code>PdfFileWriter</code>\u3001<code>PdfFileReader</code>\u3001<code>PdfFileMerger</code>\u548c<code>PageObject</code>\u3002</p> <p>\u524d\u4e09\u4e2a\u7c7b\u5206\u522b\u7528\u4ee5\u8bfb\u53d6PDF\u6587\u4ef6\u3001\u5199\u5165PDF\u6587\u4ef6\u4e0e\u5408\u5e76PDF\u6587\u4ef6\u3002</p> <p>PageObject\u7c7b\u4ee3\u8868\u4e86\u4e00\u4e2aPDF\u9875\u9762\uff0c\u53ef\u4ee5\u4f7f\u7528PdfFileReader\u7c7b\u7684getPage\u65b9\u6cd5\u5f97\u5230\u4e00\u4e2aPageObject\u5bf9\u8c61\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#52-\u4f7f\u7528pdffilereader\u8bfb\u53d6pdf\u6587\u4ef6","title":"5.2 \u4f7f\u7528PdfFileReader\u8bfb\u53d6PDF\u6587\u4ef6","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5PyPDF2\uff0c\u6211\u4eec\u4f7f\u7528\u6570\u636e\u5e93\u9886\u57df\u7684\u7ea2\u5b9d\u4e66\u8fdb\u884c\u6d4b\u8bd5\u3002\u8bfb\u8005\u53ef\u4ee5\u5728http://www.redbook.io/\u4e0b\u8f7d\u7ea2\u5b9d\u4e66\uff0c\u4e5f\u53ef\u4ee5\u5728\u672c\u4e66\u7684\u9644\u4ef6\u4e0b\u8f7d\u540d\u4e3aredbooks.pdf\u7684\u6587\u4ef6\u3002</p> <p>\u4e0b\u8f7d\u5b8c\u6210\u4ee5\u540e\uff0c\u6253\u5f00\u8be5PDF\u6587\u4ef6\u3002\u8fd9\u662f\u4e00\u4efd54\u9875\u7684PDF\u6587\u6863</p> <pre><code>import PyPDF2\nreader = PyPDF2.PdfReader(open('redbooks.pdf', 'rb'))\n# \u83b7\u53d6PDF\u6587\u4ef6\u9875\u6570\nprint(len(reader.pages))\n# is_encrypted\u5c5e\u6027\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8868\u793aPDF\u662f\u5426\u7ecf\u8fc7\u4e86\u52a0\u5bc6\u3002\nprint(reader.is_encrypted)\n# \u6211\u4eec\u901a\u8fc7PageObject\u7c7b\u7684extract_text\u65b9\u6cd5\u63d0\u53d6\u9875\u9762\u4e2d\u7684\u6587\u672c\u3002\npage = reader.pages[4]\nprint(page.extract_text())\n# \u901a\u8fc7PdfReader\u7c7b\u7684metadata\u5c5e\u6027\u83b7\u53d6PDF\u6587\u4ef6\u7684\u5143\u4fe1\u606f\u3002\nprint(reader.metadata)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#53-\u4f7f\u7528pdffilewriter\u521b\u5efapdf\u6587\u4ef6","title":"5.3 \u4f7f\u7528PdfFileWriter\u521b\u5efaPDF\u6587\u4ef6","text":"<p>\u6709\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u7f16\u8f91PDF\u9875\u9762\u3002\u4f8b\u5982\uff0c\u53bb\u9664PDF\u6587\u4ef6\u4e2d\u7684\u7b2c\u4e00\u9875\uff0c\u4ece\u4e00\u4e2aPDF\u6587\u4ef6\u4e2d\u63d0\u53d6\u51e0\u4e2a\u9875\u9762\u4fdd\u5b58\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\u3002</p> <p>PyPDF2\u5e76\u4e0d\u80fd\u76f4\u63a5\u7f16\u8f91PDF\u6587\u4ef6\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528PyPDF2\u4ece\u4e00\u4e2aPDF\u6587\u6863\u62f7\u8d1d\u9700\u8981\u7684\u9875\u9762\u5230\u53e6\u4e00\u4e2aPDF\u6587\u6863\uff0c\u901a\u8fc7\u8fd9\u79cd\u8fc2\u56de\u7684\u65b9\u5f0f\u5b9e\u73b0\u7f16\u8f91PDF\u7684\u529f\u80fd\u3002</p> <p>pdf\u52a0\u5bc6\u521b\u5efa</p> <pre><code>import PyPDF2\n# \u521b\u5efa\u4e86\u4e00\u4e2aPdfWriter\u5bf9\u8c61\u548c\u4e00\u4e2aPdfReader\u5bf9\u8c61\nreader = PyPDF2.PdfReader(open('redbooks.pdf', 'rb'))\noutput = PyPDF2.PdfWriter()\n# \u901a\u8fc7PdfWriter\u5bf9\u8c61\u7684add_page\u65b9\u6cd5\u589e\u52a0\u9875\u9762\noutput.add_page(reader.pages[1])\noutput.add_page(reader.pages[4])\noutput.add_page(reader.pages[5])\n# \u4f7f\u7528\u4e86len(output.pages)\u83b7\u53d6PdfFileWriter\u62e5\u6709\u7684PDF\u9875\u9762\u6570\nprint(len(output.pages))\n# \u4f7f\u7528encrypt\u65b9\u6cd5\u5bf9PDF\u6587\u4ef6\u8fdb\u884c\u52a0\u5bc6\noutput.encrypt('123456', use_128bit=True)\noutputStream = open(\"PyPDF2-output.pdf\", \"wb\")\n# \u8c03\u7528PdfWriter\u5bf9\u8c61\u7684write\u65b9\u6cd5,\u751f\u6210\u4e00\u4e2a\u65b0\u7684PDF\u6587\u4ef6\noutput.write(outputStream)\noutputStream.close()\n</code></pre> <p>pdf\u89e3\u5bc6</p> <p>\u89e3\u5bc6\u662f\u5728\u8bfb\u53d6\u6587\u4ef6\u65f6\u7528\u7684\uff0c\u7528\u5230<code>derypt()</code>\u51fd\u6570\u3002</p> <pre><code>from PyPDF2 import PdfWriter, PdfReader\ninput_pdf = 'PyPDF2-output.pdf'\noutput_pdf = 'reportlab.pdf'\npassword = '123456'\npdf_writer = PdfWriter()\nreader = PdfReader(open(input_pdf, 'rb'))\npdf_reader = reader.decrypt(password)\nfor page in range(len(reader.pages)):\npdf_writer.add_page(reader.pages[page])\nwith open(output_pdf, 'wb') as fh:\npdf_writer.write(fh)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#54-\u4fee\u6539pdf\u9875\u9762","title":"5.4 \u4fee\u6539PDF\u9875\u9762","text":"<p>\u5982\u679c\u9700\u8981\u4fee\u6539PDF\u7684\u9875\u9762\uff0cPyPDF2\u4e5f\u63d0\u4f9b\u4e86\u90e8\u5206\u652f\u6301\uff0c\u5982\u65cb\u8f6c\u9875\u9762\u3001\u6dfb\u52a0\u6c34\u5370\u3002</p> <p>PageObject\u7c7b\u4e2d\u6709\u90e8\u5206\u65b9\u6cd5\u53ef\u4ee5\u4fee\u6539PDF\u9875\u9762\uff0c\u5176\u4e2d\uff0c<code>rotateClockwise</code>\u548c<code>rotateCounter-Clockwise</code>\u65b9\u6cd5\u7528\u6765\u65cb\u8f6c\u9875\u9762\u3002</p> <p>\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff0c\u4e14\u53c2\u6570\u53d6\u503c\u5fc5\u987b\u662f90\u7684\u500d\u6570\uff0c\u8868\u793a\u65cb\u8f6c\u591a\u5c11\u5ea6\u3002</p> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u5c06<code>redbooks.pdf</code>\u6587\u4ef6\u7684\u9996\u9875\u65cb\u8f6c180\u5ea6\uff0c\u5e76\u4fdd\u5b58\u5230\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u4e2d\u3002</p> <p>\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>import PyPDF2\n# \u521b\u5efaPdfReader\u5bf9\u8c61\u548cPdfWriter\u5bf9\u8c61\uff0c\u5e76\u901a\u8fc7pages\u65b9\u6cd5\u83b7\u53d6redbooks.pdf\u6587\u4ef6\u7684\u9996\u9875\u3002\nreader = PyPDF2.PdfReader(open('redbooks.pdf', 'rb'))\noutput = PyPDF2.PdfWriter()\npage = reader.pages[0]\n# rotate\u65b9\u6cd5\u7528\u6765\u65cb\u8f6c\u9875\u9762\u3002\npage.rotate(180)\noutput.add_page(page)\n# \u5c06\u65cb\u8f6c\u540e\u7684\u9875\u9762\u5199\u5165rotate-page-test.pdf\u6587\u4ef6\u4e2d\noutputStream = open(\"PyPDF2-page-test.pdf\", \"wb\")\noutput.write(outputStream)\noutputStream.close()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#55-\u4e3apdf\u6dfb\u52a0\u6c34\u5370","title":"5.5 \u4e3aPDF\u6dfb\u52a0\u6c34\u5370","text":"<p>PageObject\u8fd8\u6709\u4e00\u4e2a\u540d\u4e3amergePage\u7684\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7528\u6765\u5c06\u4e24\u4e2a\u9875\u9762\u8fdb\u884c\u5408\u5e76\uff0c\u5408\u5e76\u4ee5\u540e\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684\u9875\u9762\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8be5\u65b9\u6cd5\u4e3aPDF\u6dfb\u52a0\u6c34\u5370\u3002</p> <p>\u4f8b\u5982\uff0c\u5b9e\u9a8c\u8fc7\u7a0b\u4e2d\u4f7f\u7528Micsoft Word\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Word\u6587\u6863\uff0c\u5728Word\u6587\u6863\u4e2d\u63d2\u5165\u201c\u52a0\u5bc6\u6587\u4ef6\u201d\u8fd9\u51e0\u4e2a\u827a\u672f\u5b57\uff0c\u7136\u540e\u5c06Word\u6587\u6863\u4fdd\u5b58\u4e3aPDF\u6587\u4ef6\u3002</p> <pre><code># \u4e3aPDF\u589e\u52a0\u6c34\u5370\nimport PyPDF2\n# \u521b\u5efa\u4e86\u4e24\u4e2aPdfReader\u5bf9\u8c61\u548c\u4e00\u4e2aPdfWriter\u5bf9\u8c61\nreader = PyPDF2.PdfReader(open('redbooks.pdf', 'rb'))\nwatermark = PyPDF2.PdfReader(open('watermark.pdf', 'rb'))\nwriter = PyPDF2.PdfWriter()\n# \u8fc7for\u5faa\u73af\u904d\u5386redbooks.pdf\u6587\u4ef6\uff0c\u5bf9\u8be5PDF\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u9875\u9762\u90fd\u5408\u5e76\u6211\u4eec\u521b\u5efa\u7684\u6c34\u5370\u6587\u4ef6\u3002\nfor i in range(len(reader.pages)):\npage = reader.pages[i]\npage.merge_page(watermark.pages[0])\n# \u4f7f\u7528add_page\u65b9\u6cd5\u5c06\u5408\u5e76\u540e\u7684\u9875\u9762\u6dfb\u52a0\u5230PdfWriter\u5bf9\u8c61\u4e2d\nwriter.add_page(page)\n# \u5c06PdfWriter\u5bf9\u8c61\u4fdd\u5b58\u5230watermark-test.pdf\u6587\u4ef6\u4e2d\noutputStream = open(\"watermark-test.pdf\", \"wb\")\nwriter.write(outputStream)\noutputStream.close()\n</code></pre> <p>\u6253\u5f00\u6587\u6863\uff0c\u53d1\u73b0redbooks.pdf\u6587\u4ef6\u6bcf\u4e00\u9875pdf\u5185\u5bb9\u90fd\u5df2\u7ecf\u6dfb\u52a0\u4e86\u6c34\u5370\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/10.%E6%96%87%E6%A1%A3%E4%B8%8E%E6%8A%A5%E5%91%8A/#56-\u4f7f\u7528pdffilemerger\u5408\u5e76\u591a\u4e2apdf\u6587\u4ef6","title":"5.6 \u4f7f\u7528PdfFileMerger\u5408\u5e76\u591a\u4e2aPDF\u6587\u4ef6","text":"<p>\u5047\u5b9a\u73b0\u5728\u6709\u4e00\u4e2a\u5f88\u65e0\u804a\u7684\u4efb\u52a1\uff0c\u9700\u8981\u5c06\u591a\u4e2aPDF\u6587\u4ef6\u5408\u5e76\u6210\u4e00\u4e2aPDF\u6587\u4ef6\u3002\u5e76\u4e14\uff0c\u6bcf\u4e2aPDF\u6587\u4ef6\u90fd\u6709\u76f8\u540c\u7684\u5c01\u9762\uff0c\u5408\u5e76\u6210\u4e00\u4e2aPDF\u6587\u4ef6\u4ee5\u540e\u53ea\u6709\u4e00\u4e2a\u5c01\u9762\u3002</p> <p>\u6709\u4e86PdfMerger\u5bf9\u8c61\u4ee5\u540e\uff0c\u8981\u5c06\u76ee\u5f55\u4e0b\u7684\u591a\u4e2aPDF\u6587\u4ef6\u5408\u5e76\u6210\u4e00\u4e2aPDF\u6587\u4ef6\u5c31\u975e\u5e38\u5bb9\u6613\u4e86\uff0c\u57fa\u672c\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u627e\u5230\u5de5\u4f5c\u76ee\u5f55\u4e0b\u6240\u6709PDF\u6587\u4ef6\uff1b</li> <li>\u4e3a\u4e86\u6709\u5e8f\u6dfb\u52a0PDF\u6587\u4ef6\uff0c\u5c06\u6240\u6709PDF\u6587\u4ef6\u6309\u6587\u4ef6\u540d\u8fdb\u884c\u6392\u5e8f\uff1b</li> <li>\u9664\u4e86\u7b2c\u4e00\u9875\u5916\uff0c\u5c06\u6bcf\u4e2aPDF\u7684\u6240\u6709\u9875\u9762\u6dfb\u52a0\u5230PdfMerger\u5bf9\u8c61\u4e2d\uff1b</li> <li>\u5c06PdfMerger\u5bf9\u8c61\u4fdd\u5b58\u5230\u78c1\u76d8\u4e2d\u3002</li> </ol> <p>\u5b8c\u6574\u7684\u7a0b\u5e8f\u5982\u4e0b\uff1a <pre><code>import os\nimport glob\nimport PyPDF2\ndef get_all_pdf_files(path):\n\"\"\"\n    \u9996\u5148\u901a\u8fc7glob\u6a21\u5757\u83b7\u53d6path\u76ee\u5f55\u4e0b\u6240\u6709PDF\u6587\u4ef6\uff0c\u5e76\u6839\u636e\u6587\u4ef6\u540d\u5bf9\u6587\u4ef6\u8fdb\u884c\u4e86\u6392\u5e8f\u3002\n    :param path: \u8def\u5f84\n    :return:\n    \"\"\"\nall_pdfs = glob.glob(\"{0}/*.pdf\".format(path))\nall_pdfs.sort(key=str.lower)\nreturn all_pdfs\ndef main():\nall_pdfs = get_all_pdf_files(os.path.expanduser('./'))\nif not all_pdfs:\nraise SystemExit('No pdf file found!')\n# \u521b\u5efa\u4e86\u4e00\u4e2aPdfMerger\u5bf9\u8c61\uff0c\u5e76\u4f7f\u7528append\u65b9\u6cd5\u5c06\u7b2c\u4e00\u4e2aPDF\u6587\u4ef6\u5b8c\u6574\u4fdd\u5b58\uff0c\u63a5\u7740\u5c06\u5176\u4ed6PDF\u6587\u4ef6\u4f9d\u6b21\u6dfb\u52a0\u5230PdfFileMerger\u5bf9\u8c61\u4e2d\u3002\nmerger = PyPDF2.PdfMerger()\nwith open(all_pdfs[0], 'rb') as first_obj:\nmerger.append(first_obj)\n# \u5176\u4ed6PDF\u6587\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u53bb\u9664\u7b2c\u4e00\u9875\uff0c\u4fdd\u7559\u5176\u4ed6\u9875\u9762\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u5148\u6784\u5efa\u4e86PdfReader\u5bf9\u8c61\u3002\n# \u6784\u9020PdfReader\u5bf9\u8c61\u662f\u4e3a\u4e86\u83b7\u53d6PDF\u603b\u9875\u6570\uff0c\u77e5\u9053PDF\u6709\u591a\u5c11\u9875\u9762\u4ee5\u540e\u624d\u80fd\u591f\u7ed9pages\u53c2\u6570\u4f20\u9012\u6b63\u786e\u7684\u53c2\u6570\u3002\nfor pdf in all_pdfs[1:]:\nwith open(pdf, 'rb') as obj:\nreader = PyPDF2.PdfReader(obj)\nmerger.append(fileobj=obj, pages=(1, len(reader.pages)))\n# \u5c06\u8fd9\u4e9b\u5185\u5bb9\u5199\u5165\u786c\u76d8\u4e0a\u7684\u4e00\u4e2a\u6587\u4ef6\u4e2d\nwith open('merge-pdfs.pdf', 'wb') as f:\nmerger.write(f)\nif __name__ == '__main__':\nmain()\n</code></pre></p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/","title":"6.\u6253\u9020\u547d\u4ee4\u884c\u5de5\u5177","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#sysargv","title":"sys.argv","text":"<p>\u4ece\u547d\u4ee4\u884c\u53c2\u6570\u83b7\u53d6\u6587\u4ef6\u7684\u540d\u79f0\uff0c\u7136\u540e\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728</p> <pre><code>from __future__ import print_function\nimport os\nimport sys\ndef main():\nsys.argv.append(\"\")\nfilename = sys.argv[1]\nif not os.path.isfile(filename):\nraise SystemExit(filename + ' does not exists')\nelif not os.access(filename, os.R_OK):\nraise SystemExit(filename + ' is not accessible')\nelse:\nprint(filename + ' is accessible')\nif __name__ == '__main__':\nmain()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#sysstdin\u548cfileinput","title":"sys.stdin\u548cfileinput","text":"<p>\u5728Python\u6807\u51c6\u5e93\u7684sys\u5e93\u4e2d\uff0c\u6709\u4e09\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5206\u522b\u662fstdin\u3001stdout\u548cstderr\uff0c\u8fd9\u4e09\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u5206\u522b\u4ee3\u8868\u6807\u51c6\u8f93\u5165\u3001\u6807\u51c6\u8f93\u51fa\u548c\u9519\u8bef\u8f93\u51fa\u3002\u6211\u4eec\u4e0d\u9700\u8981\u8c03\u7528open\u51fd\u6570\u6253\u5f00\u8fd9\u51e0\u4e2a\u6587\u4ef6\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u540d\u4e3aread_stdin.py\u7684\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u4ec5\u4ec5\u662f\u4ece\u6807\u51c6\u8f93\u5165\u4e2d\u8bfb\u53d6\u5185\u5bb9\uff0c\u7136\u540e\u6253\u5370\u5230\u547d\u4ee4\u884c\u7ec8\u7aef\u3002\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>from __future__ import print_function\nimport sys\nfor line in sys.stdin:\nprint(line, end=\"\")\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u50cfShell\u811a\u672c\u4e00\u6837\uff0c\u901a\u8fc7\u6807\u51c6\u8f93\u5165\u7ed9\u8be5\u7a0b\u5e8f\u8f93\u5165\u5185\u5bb9\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>cat /etc/passwd | python read_stdin.py\npython read_stdin.py &lt; /etc/passwd\npython read_stdin.py -\n</code></pre> <p>\u8c03\u7528readlines\u51fd\u6570\u5c06\u6807\u51c6\u8f93\u5165\u7684\u5185\u5bb9\u8bfb\u53d6\u5230\u4e00\u4e2a\u5217\u8868\u4e2d\u3002</p> <pre><code>from __future__ import print_function\nimport sys\ndef get_content():\nreturn sys.stdin.readlines()\nprint(get_content())\n</code></pre> <p>fileinput\u662fPython\u8bed\u8a00\u7684\u4e00\u4e2a\u6807\u51c6\u5e93\uff0c\u5b83\u63d0\u4f9b\u4e86\u6bd4sys.stdin\u66f4\u52a0\u901a\u7528\u7684\u529f\u80fd\u3002</p> <p>\u4f7f\u7528fileinput\uff0c\u53ef\u4ee5\u4f9d\u6b21\u8bfb\u53d6\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u7ed9\u51fa\u7684\u591a\u4e2a\u6587\u4ef6\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cfileinput\u4f1a\u904d\u5386<code>sys.argv[1\uff1a]</code>\u5217\u8868\uff0c\u5e76\u6309\u884c\u4f9d\u6b21\u8bfb\u53d6\u5217\u8868\u4e2d\u7684\u6587\u4ef6\u3002</p> <p>\u5982\u679c\u8be5\u5217\u8868\u4e3a\u7a7a\uff0c\u5219fileinput\u9ed8\u8ba4\u8bfb\u53d6\u6807\u51c6\u8f93\u5165\u4e2d\u7684\u5185\u5bb9\u3002</p> <p>\u56e0\u4e3afileinput\u53ef\u4ee5\u8bfb\u53d6\u591a\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\uff0cfileinput\u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u6cd5\u8ba9\u6211\u4eec\u77e5\u9053\u5f53\u524d\u6240\u8bfb\u53d6\u7684\u5185\u5bb9\u5c5e\u4e8e\u54ea\u4e00\u4e2a\u6587\u4ef6\u3002fileinput\u4e2d\u5e38\u7528\u7684\u65b9\u6cd5\u6709\uff1a</p> <ul> <li> <p>filename\uff1a\u5f53\u524d\u6b63\u5728\u8bfb\u53d6\u7684\u6587\u4ef6\u540d\uff1b </p> </li> <li> <p>fileno\uff1a\u6587\u4ef6\u7684\u63cf\u8ff0\u7b26\uff1b </p> </li> <li> <p>filelineno\uff1a\u6b63\u5728\u8bfb\u53d6\u7684\u884c\u662f\u5f53\u524d\u6587\u4ef6\u7684\u7b2c\u51e0\u884c\uff1b</p> </li> <li> <p>isfirstline\uff1a\u6b63\u5728\u8bfb\u53d6\u7684\u884c\u662f\u5426\u5f53\u524d\u6587\u4ef6\u7684\u7b2c\u4e00\u884c\uff1b</p> </li> <li> <p>isstdin fileinput\uff1a\u6b63\u5728\u8bfb\u53d6\u6587\u4ef6\u8fd8\u662f\u76f4\u63a5\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6\u5185\u5bb9\u3002</p> </li> </ul> <pre><code>#!/usr/bin/python\nfrom __future__ import print_function\nimport fileinput\nfor line in fileinput.input():\nmeta = [fileinput.filename(), fileinput.fileno(), fileinput.filelineno(),\nfileinput.isfirstline(), fileinput.isstdin()]\nprint(*meta, end=\" \")\nprint(line, end=\"\")\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#systemexit","title":"SystemExit","text":"<p>\u4f7f\u7528sys.stdout\u4e0esys.stderr\u8f93\u51fa</p> <pre><code>import sys\nsys.stdout.write('hello\\n')\nsys.stderr.write('world \\n')\n</code></pre> <pre><code>$ python3 sys-error.py hello\nworld $ python3 sys-error.py 2&gt; /dev/null\nhello\n\n$ python3 sys-error.py &gt; /dev/null\nworld </code></pre> <p>\u5728Python\u7a0b\u5e8f\u4e2d\uff0cprint\u51fd\u6570\u9ed8\u8ba4\u8f93\u51fa\u5230\u547d\u4ee4\u884c\u7ec8\u7aef\uff0c\u56e0\u6b64\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4e0d\u4f1a\u76f4\u63a5\u8c03\u7528sys.stdout\u6765\u8f93\u51fa\u5185\u5bb9\u3002\u5982\u679c\u6211\u4eec\u7684Python\u7a0b\u5e8f\u6267\u884c\u5931\u8d25\uff0c\u9700\u8981\u5728\u6807\u51c6\u9519\u8bef\u4e2d\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\uff0c\u7136\u540e\u4ee5\u975e\u96f6\u7684\u8fd4\u56de\u7801\u9000\u51fa\u7a0b\u5e8f\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528sys.stderr\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <p><pre><code>import sys\nsys.stderr.write('error message')\nsys.exit(1)\n</code></pre> \u5bf9\u4e8e\u201cPython\u811a\u672c\u6267\u884c\u51fa\u9519\uff0c\u9700\u8981\u5411\u9519\u8bef\u8f93\u51fa\u4e2d\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\uff0c\u5e76\u4e14\u4ee5\u975e\u96f6\u7684\u8fd4\u56de\u7801\u9000\u51fa\u7a0b\u5e8f\u201d\u7684\u9700\u6c42\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u629b\u51fa\u4e00\u4e2aSystemExit\u5f02\u5e38\u3002\u5982\u4e0b\u6240\u793a\uff1a <pre><code>$ python test_system_exit.py\nerror message\n\n$ echo $?\n1\n</code></pre></p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#getpass","title":"getpass","text":"<p>getpass\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684Python\u6807\u51c6\u5e93\uff0c\u4e3b\u8981\u5305\u542bgetuser\u51fd\u6570\u548cgetpass\u51fd\u6570\u3002</p> <p>getpass\u51fd\u6570\u4e0einput\u51fd\u6570\u7684\u533a\u522b\u5728\u4e8e\uff0c\u5b83\u4e0d\u4f1a\u5c06\u6211\u4eec\u8f93\u5165\u7684\u5bc6\u7801\u663e\u793a\u5728\u547d\u4ee4\u884c\u4e2d\uff0c\u4ece\u800c\u907f\u514d\u6211\u4eec\u8f93\u5165\u7684\u5bc6\u7801\u88ab\u4ed6\u4eba\u770b\u5230\u3002</p> <pre><code>from __future__ import print_function\nimport getpass\nuser = getpass.getuser()\npasswd = getpass.getpass('your password: ')\nprint(user, passwd)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#configparse","title":"ConfigParse","text":"<p>\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b</p> <p><code>example.cfg</code></p> <pre><code>[default]\nserveraliveinterval = 45\ncompression = yes\ncompressionlevel = 9\n\n[bitbucket.org]\nuser = hg\n\n[topsecret.server.com]\nport = 50022\nforwardx11 = no\nskip-external-locking\n</code></pre> <p>python\u751f\u6210\u914d\u7f6e\u6587\u4ef6</p> <pre><code>import configparser\nconfig = configparser.ConfigParser()\nconfig['default'] = {'ServerAliveInterval': '45',\n'Compression': 'yes',\n'CompressionLevel': '9'}\nconfig['bitbucket.org'] = {}\nconfig['bitbucket.org']['User'] = 'hg'\nconfig['topsecret.server.com'] = {'port': '50022',\n'Forwardx11': 'no'}\nconfig.add_section('mysql')\nconfig.set('mysql', 'host', '127.0.0.1')\nconfig.set('mysql', 'port', 3306)\nwith open('example.cfg', 'w') as configfile:\nconfig.write(configfile)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#1\u8bfb\u53d6\u914d\u7f6e\u9879\u793a\u4f8b","title":"1.\u8bfb\u53d6\u914d\u7f6e\u9879\u793a\u4f8b","text":"<p>\u5148\u751f\u6210\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6 <pre><code>import configparser\n'''\n[client]\nport        = 3306\nuser        = mysql\npassword    = mysql\nhost        = 127.0.0.1\n[mysqld]\nbasedir         = /usr\ndatadir         = /var/lib/mysql\ntmpdir          = /tmp\nskip-external-locking\n'''\ncf = configparser.ConfigParser(allow_no_value=True)\ncf.add_section('client')\ncf.set('client', 'port', '3306')\ncf.set('client', 'user', 'mysql')\ncf.set('client', 'password', 'mysql')\ncf.set('client', 'host', '127.0.0.1')\ncf.add_section('mysqld')\ncf.set('mysqld', 'basedir', '/usr')\ncf.set('mysqld', 'datadir', '/var/lib/mysql')\ncf.set('mysqld', 'tmpdir', '/tmp')\ncf.set('mysqld', 'skip-external-locking')\nwith open('my.cnf', 'w') as f:\ncf.write(f)\n</code></pre></p> <p>ConfigParser\u4e2d\u6709\u5f88\u591a\u7684\u65b9\u6cd5\uff0c\u5176\u4e2d\u4e0e\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u5224\u65ad\u914d\u7f6e\u9879\u76f8\u5173\u7684\u65b9\u6cd5\u6709\uff1a</p> <ul> <li>sections\uff1a\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u6240\u6709\u7ae0\u8282\u7684\u5217\u8868\uff1b</li> <li>has_section\uff1a\u5224\u65ad\u7ae0\u8282\u662f\u5426\u5b58\u5728\uff1b</li> <li>items\uff1a\u4ee5\u5143\u7ec4\u7684\u5f62\u5f0f\u8fd4\u56de\u6240\u6709\u9009\u9879\uff1b</li> <li>options\uff1a\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u7ae0\u8282\u4e0b\u6240\u6709\u9009\u9879\u7684\u5217\u8868\uff1b</li> <li>has_option\uff1a\u5224\u65ad\u67d0\u4e2a\u9009\u9879\u662f\u5426\u5b58\u5728\uff1b</li> <li>get\u3001getboolean\u3001getinit\u3001getfloat\uff1a\u83b7\u53d6\u9009\u9879\u7684\u503c\u3002</li> </ul> <pre><code>import configparser\ncf = configparser.ConfigParser(allow_no_value=True)\ncf.read('my.cnf')\nprint(cf.sections())\n# ['client', 'mysqld']\nprint(cf.has_section('client'))\n# True\nprint(cf.options('client'))\n# ['port', 'user', 'password', 'host']\nprint(cf.has_option('client', 'user'))\n# True\nprint(cf.get('client', 'host'))\n# '127.0.0.1'\nprint(cf.getint('client', 'port'))\n# 3306\n</code></pre> <p>ConfigParser\u4e5f\u63d0\u4f9b\u4e86\u8bb8\u591a\u65b9\u6cd5\u4fbf\u4e8e\u6211\u4eec\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <ul> <li>remove_section\uff1a\u5220\u9664\u4e00\u4e2a\u7ae0\u8282\uff1b</li> <li>add_section\uff1a\u6dfb\u52a0\u4e00\u4e2a\u7ae0\u8282\uff1b</li> <li>remote_option\uff1a\u5220\u9664\u4e00\u4e2a\u9009\u9879\uff1b</li> <li>set\uff1a\u6dfb\u52a0\u4e00\u4e2a\u9009\u9879\uff1b</li> <li>write\u5c06ConfigParser\u5bf9\u8c61\u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002</li> </ul> <pre><code>import configparser\ncf = configparser.ConfigParser(allow_no_value=True)\ncf.read('my.cnf')\ncf.remove_section('client')\ncf.add_section('mysql')\ncf.set('mysql', 'host', '127.0.0.1')\ncf.set('mysql', 'port', '3306')\ncf.write(open('my_copy.cnf', 'w'))\n</code></pre> <p>\u4fee\u6539\u5b8c\u6210\u4ee5\u540e\uff0c\u65b0\u7684my_copy.cnf\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>[mysqld]\nbasedir = /usr\ndatadir = /var/lib/mysql\ntmpdir = /tmp\nskip-external-locking\n\n[mysql]\nhost = 127.0.0.1\nport = 3306\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#2\u914d\u7f6e\u9879\u589e\u5220\u6539\u67e5","title":"2.\u914d\u7f6e\u9879\u589e\u5220\u6539\u67e5","text":"<p>\u914d\u7f6e\u6587\u4ef6Background.ini</p> <pre><code>[Background]\nImage        = Whitecristal.png\nLeftMargin   = 8\nTopMargin    = 8\nRightMargin  = 8\nBottomMargin = 8\nOutside-LeftMargin   = 8\nOutside-TopMargin    = 8\nOutside-RightMargin  = 8\nOutside-BottomMargin = 8\n[Background2]\nImage        = Whitecristal2.png\nLeftMargin   = 18\nTopMargin    = 28\nRightMargin  = 38\nBottomMargin = 48\nOutside-LeftMargin   = 8\nOutside-TopMargin    = 8\nOutside-RightMargin  = 8\nOutside-BottomMargin = 8\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u8bfb\u53d6","title":"\u8bfb\u53d6","text":"<pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nimport configparser\nconfig = configparser.ConfigParser()\nconfig.read(\"Background.ini\")\nsections = config.sections()  # \u8fd4\u56de\u6240\u6709\u7684\u914d\u7f6e\u5757\nprint(\"\\033[31m\u914d\u7f6e\u5757\\033[0m\uff1a\", sections)\no = config.options(\"Background2\")  # \u8fd4\u56de\u6240\u6709\u7684\u914d\u7f6e\u9879\nprint(\"\\033[31m\u914d\u7f6e\u9879:\\033[0m\", o)\nv = config.items(\"Background2\")  # \u8fd4\u56de\u914d\u7f6e\u9879\u7684\u5185\u5bb9\nprint(\"\\033[31m\u5185\u5bb9\uff1a\\033[0m\", v)\n# \u6839\u636e\u914d\u7f6e\u5757\u548c\u914d\u7f6e\u9879\u8fd4\u56de\u5185\u5bb9\naccess = config.get(\"Background\", \"Outside-RightMargin\")\nprint(access)\nImage_info = config.get(\"Background\", \"Image\")\nprint(Image_info)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u65b0\u589e","title":"\u65b0\u589e","text":"<pre><code>#!/usr/bin/env python\nimport configparser\nconfig = configparser.ConfigParser()\nconfig.add_section(\"Mysqld\")            #\u6dfb\u52a0\u65b0\u7684\u914d\u7f6e\u5757\nconfig.set(\"Mysqld\", \"port\", \"3306\")    #\u6dfb\u52a0\u65b0\u7684\u914d\u7f6e\u9879\nf = open(\"Background.ini\",\"a+\")\nconfig.write(f)\nf.close()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u4fee\u6539","title":"\u4fee\u6539","text":"<pre><code>import configparser\nini_name = \"Background.ini\"\nconfig = configparser.ConfigParser()\nconfig.read(ini_name)\nconfig.set(\"Mysqld\", \"port\", \"3307\")  # \u4fee\u6539\u914d\u7f6e\u9879\nf = open(ini_name, \"r+\")\nconfig.write(f)\nf.close()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u5220\u9664","title":"\u5220\u9664","text":"<pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nimport configparser\nini_name = \"Background.ini\"\nconfig = configparser.ConfigParser()\nconfig.read(ini_name)\nconfig.remove_option(\"Mysqld\", \"port\")  # \u5220\u9664\u914d\u7f6e\u9879\nconfig.remove_section(\"Mysqld\")  # \u5220\u9664\u914d\u7f6e\u5757\nf = open(ini_name, \"w+\")\nconfig.write(f)\nf.close()\n</code></pre> <pre><code>import configparser\n# \u521b\u5efaconfigparser\u5bf9\u8c61\ncf = configparser.ConfigParser()\n# read(filename)\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u751f\u6210\u6587\u4ef6\u5bf9\u8c61\nfilename = cf.read(\"test.ini\")\nprint(filename)\n# sections()\u5f97\u5230\u6240\u6709\u7684section\uff0c\u4ee5\u5217\u8868\u5f62\u5f0f\u8fd4\u56de\nsec = cf.sections()\nprint(sec)\n# options(section)\u5f97\u5230section\u4e0b\u7684\u6240\u6709option\nopt = cf.options(\"settings\")\nprint(opt)\n# items()\u5f97\u5230section\u7684\u6240\u6709\u952e\u503c\u5bf9\nvalue = cf.items(\"settings\")\nprint(value)\n# get(section,option) \u5f97\u5230section\u4e2d\u7684option\u503c\uff0c\u8fd4\u56destring\u7c7b\u578b\u7684\u7ed3\u679c\n# getint(section,option) \u5f97\u5230section\u4e2d\u7684option\u503c\uff0c\u8fd4\u56deint\u7c7b\u578b\u7684\u7ed3\u679c\nusername = cf.get(\"settings\", \"username\")\npassword = cf.getint(\"settings\", \"password\")\nprint(username, password)\nimport configparser\n# \u521b\u5efaconfigparser\u5bf9\u8c61\ncf = configparser.ConfigParser()\n# \u5f80\u914d\u7f6e\u6587\u4ef6\u5199\u5165\u5185\u5bb9\n# add_section() \u662f\u6dfb\u52a0section\n# set(section,option,value) \u662f\u7ed9section\u9879\u4e2d\u5199\u5165\u952e\u503c\u5bf9\ncf.add_section(\"mysql\")\ncf.set(\"mysql\", \"user\", \"root\")\ncf.add_section(\"redis\")\ncf.set(\"redis\", \"user\", \"admin\")\n# \u4f7f\u7528open()\u521b\u5efa\u65b0\u7684\u6587\u4ef6\uff0c\u5e76\u5c06\u914d\u7f6e\u4fe1\u606f\u5199\u5165\u6587\u4ef6\nwith open(\"test1.ini\", \"w+\") as f:\ncf.write(f)\nimport configparser\n# \u521b\u5efaconfigparser\u5bf9\u8c61\ncf = configparser.ConfigParser()\n# \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u751f\u6210\u6587\u4ef6\u5bf9\u8c61\ncf.read(\"test1.ini\")\n# \u4fee\u6539\u5df2\u6709\u7684\u914d\u7f6e\u4fe1\u606f\ncf.set(\"mysql\", \"user\", \"roots\")\n# \u65b0\u589e\u914d\u7f6e\u4fe1\u606f\ncf.set(\"mysql\", \"password\", \"123456\")\n# remove_option() \u662f\u5220\u9664option\ncf.remove_option(\"redis\", \"user\")\n# remove_section() \u662f\u5220\u9664section\n# \u5982\u679c\u5220\u9664\u7684section\u6709option\uff0c\u90a3\u4e48\u4f1a\u5c06option\u4e00\u5e76\u5220\u9664\ncf.remove_section(\"redis\")\n# \u4f7f\u7528open()\u5199\u5165\u6587\u4ef6\uff0c\u5e76\u5c06\u914d\u7f6e\u4fe1\u606f\u5199\u5165\u6587\u4ef6\nwith open(\"test1.ini\", \"w+\") as f:\ncf.write(f)\n</code></pre> <p>\u7efc\u4e0a\u6240\u8ff0\uff0cPython\u7684\u5185\u7f6e\u6a21\u5757configparser\u8bfb\u5199\u914d\u7f6e\u6587\u4ef6\u4e3b\u8981\u8c03\u7528\u4ee5\u4e0b\u51fd\u6570\u53ca\u65b9\u6cd5\uff1a</p> <ol> <li>read(filename)\uff1a\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u751f\u6210\u6587\u4ef6\u5bf9\u8c61\u3002</li> <li>sections()\uff1a\u5f97\u5230\u6240\u6709\u7684section\uff0c\u4ee5\u5217\u8868\u5f62\u5f0f\u8fd4\u56de\u3002</li> <li>options(section)\uff1a\u5f97\u5230section\u4e0b\u7684\u6240\u6709option\u3002</li> <li>items()\uff1a\u5f97\u5230section\u7684\u6240\u6709\u952e\u503c\u5bf9\u3002</li> <li>get(section,option)\uff1a\u5f97\u5230section\u4e2d\u7684option\u503c\uff0c\u8fd4\u56destring\u7c7b\u578b\u7684\u7ed3\u679c\u3002</li> <li>getint(section,option)\uff1a\u5f97\u5230section\u4e2d\u7684option\u503c\uff0c\u8fd4\u56deint\u7c7b\u578b\u7684\u7ed3\u679c\u3002</li> <li>add_section()\uff1a\u6dfb\u52a0section\u3002</li> <li>set(section,option,value)\uff1a\u7ed9section\u9879\u4e2d\u5199\u5165\u952e\u503c\u5bf9\u3002</li> <li>remove_option()\uff1a\u5220\u9664option\u3002</li> <li>remove_section()\uff1a\u5220\u9664section\uff0c\u82e5\u8981\u5220\u9664\u7684section\u8bbe\u6709option\uff0c\u4e5f\u4f1a\u5c06option\u4e00\u5e76\u5220\u9664\u3002</li> </ol> <p>\u53c2\u8003\u5730\u5740<p>\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6</p> <p>\u5e38\u7528\u6a21\u5757\u548c\u4f7f\u7528\u6848\u4f8b</p> <p>Python3\u8bfb\u5199ini\u914d\u7f6e\u6587\u4ef6</p> </p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#argparse","title":"argparse","text":"<p>\u5728Python\u4e2d\uff0cargparse\u662f\u6807\u51c6\u5e93\u4e2d\u7528\u6765\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570\u7684\u6a21\u5757\uff0c\u7528\u6765\u66ff\u4ee3\u5df2\u7ecf\u8fc7\u65f6\u7684optparse\u6a21\u5757\u3002 </p> <p>\u73b0\u5728optparse\u5df2\u7ecf\u5e9f\u5f03\u3002</p> <p>argparse\u80fd\u591f\u6839\u636e\u7a0b\u5e8f\u4e2d\u7684\u5b9a\u4e49\u4ecesys.argv\u4e2d\u89e3\u6790\u51fa\u8fd9\u4e9b\u53c2\u6570\uff0c\u5e76\u81ea\u52a8\u751f\u6210\u5e2e\u52a9\u548c\u4f7f\u7528\u4fe1\u606f\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#argumentparse\u89e3\u6790\u5668","title":"ArgumentParse\u89e3\u6790\u5668","text":"<p>\u4f7f\u7528argparse\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570\u65f6\uff0c\u9996\u5148\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u89e3\u6790\u5668\uff0c\u521b\u5efa\u65b9\u5f0f\u5982\u4e0b\u6240\u793a\uff1a</p> <p><pre><code>import argparse\nparser = argparse.ArgumentParser()\n</code></pre> ArgumentParser\u7c7b\u7684\u521d\u59cb\u5316\u51fd\u6570\u6709\u591a\u4e2a\u53c2\u6570\uff0c\u5176\u4e2d\u6bd4\u8f83\u5e38\u7528\u7684\u662fdescription\u3002description\u662f\u7a0b\u5e8f\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u5373\u5e2e\u52a9\u4fe1\u606f\u524d\u7684\u6587\u5b57\u3002</p> <p>\u4e3a\u5e94\u7528\u7a0b\u5e8f\u6dfb\u52a0\u53c2\u6570\u9009\u9879\u9700\u8981\u7528ArgumentParser\u5bf9\u8c61\u7684add_argument\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>add_argument(name or flags...[, action][, nargs][, const][, default][, type][, choices][, required][, help][, metavar][, dest])\n</code></pre> <p>\u5404\u4e2a\u53c2\u6570\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li> <p>name/flags\uff1a\u53c2\u6570\u7684\u540d\u5b57\uff1b </p> </li> <li> <p>action\uff1a\u9047\u5230\u53c2\u6570\u65f6\u7684\u52a8\u4f5c\uff0c\u9ed8\u8ba4\u503c\u662fstore\uff1b</p> </li> <li> <p>nargs\uff1a\u53c2\u6570\u7684\u4e2a\u6570\uff0c\u53ef\u4ee5\u662f\u5177\u4f53\u7684\u6570\u5b57\uff0c\u6216\u8005\u662f\u201c+\u201d\u53f7\u4e0e\u201c\u201d\u53f7\u3002\u5176\u4e2d\uff0c\u201c\u201d\u53f7\u8868\u793a0\u6216\u591a\u4e2a\u53c2\u6570\uff0c\u201c+\u201d\u53f7\u8868\u793a1\u6216\u591a\u4e2a\u53c2\u6570\uff1b</p> </li> <li> <p>const action\u548cnargs\uff1a\u9700\u8981\u7684\u5e38\u91cf\u503c\uff1b</p> </li> <li> <p>default\uff1a\u4e0d\u6307\u5b9a\u53c2\u6570\u65f6\u7684\u9ed8\u8ba4\u503c\uff1b</p> </li> <li> <p>type\uff1a\u53c2\u6570\u7684\u7c7b\u578b\uff1b</p> </li> <li> <p>choices\uff1a\u53c2\u6570\u5141\u8bb8\u7684\u503c\uff1b</p> </li> <li> <p>required\uff1a\u53ef\u9009\u53c2\u6570\u662f\u5426\u53ef\u4ee5\u7701\u7565\uff1b</p> </li> <li> <p>help\uff1a\u53c2\u6570\u7684\u5e2e\u52a9\u4fe1\u606f\uff1b</p> </li> <li> <p>metavar\uff1a\u5728usage\u8bf4\u660e\u4e2d\u7684\u53c2\u6570\u540d\u79f0\uff1b</p> </li> <li> <p>dest\uff1a\u89e3\u6790\u540e\u7684\u53c2\u6570\u540d\u79f0\u3002</p> </li> </ul> <p>\u89e3\u6790\u53c2\u6570\u9700\u8981\u7528ArgumentParser\u5bf9\u8c61\u7684parse_args\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2aNamespace\u5bf9\u8c61\u3002\u83b7\u53d6\u5bf9\u8c61\u4ee5\u540e\uff0c\u53c2\u6570\u503c\u901a\u8fc7\u5c5e\u6027\u7684\u65b9\u5f0f\u8fdb\u884c\u8bbf\u95ee\u3002</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# filename: apgparse\u6a21\u5757.py\nimport argparse\ndef _argparse():\nparser = argparse.ArgumentParser(description=\"This is description\")\nparser.add_argument(\"--host\", action=\"store\",\ndest=\"server\", default=\"localhost\", help=\"connect to host\")\nparser.add_argument(\"-t\", action=\"store_true\",\ndest=\"boolean_switch\", default=False, help=\"Set a switch to true\")\nreturn parser.parse_args()\ndef main():\nparser = _argparse()\nprint(parser)\nprint(\"host = \", parser.server)\nprint(\"boolean_switch=\", parser.boolean_switch)\nif __name__ == '__main__':\nmain()\n</code></pre> <p>\u8f93\u51fa\u4fe1\u606f <pre><code>$ python apgparse\u6a21\u5757.py\n$ Namespace(boolean_switch=False, server='localhost')\nhost =  localhost\nboolean_switch= False\n\npython apgparse\u6a21\u5757.py --host=127.0.0.1 -t\nNamespace(boolean_switch=True, server='127.0.0.1')\nhost =  127.0.0.1\nboolean_switch= True\n</code></pre></p> <p>\u901a\u8fc7help\u9009\u9879\u83b7\u53d6\u5e2e\u52a9\u4fe1\u606f</p> <pre><code>$ python apgparse\u6a21\u5757.py --help\nusage: apgparse\u6a21\u5757.py [-h] [--host SERVER] [-t]\nThis is description\n\noptional arguments:\n  -h, --help     show this help message and exit\n--host SERVER  connect to host\n  -t             Set a switch to true\n</code></pre> <p>\u6a21\u4effMysql\u5ba2\u6237\u7aef\u7684\u547d\u4ee4\u884c\u53c2\u6570 <pre><code>import argparse\ndef _argparse():\nparser = argparse.ArgumentParser(description=\"A Python-MySQL client\")\nparser.add_argument(\"--host\", action=\"store\",\ndest=\"host\", required=True, help=\"connect to host\")\nparser.add_argument(\"-u\", \"--user\", action=\"store\",\ndest=\"user\", required=True, help=\"user for login\")\nparser.add_argument(\"-p\", \"--password\", action=\"store\",\ndest=\"password\", required=True,\nhelp=\"password to use when connecting to server\")\nparser.add_argument(\"-P\", \"--port\", action=\"store\",\ndest=\"port\", default=3306, type=int,\nhelp=\"port number to use for connection or 3306 for default\")\nparser.add_argument(\"-v\", \"--version\", action=\"version\", version='%(prog)s 0.1')\nreturn parser.parse_args()\ndef main():\nparser = _argparse()\nconn_args = dict(host=parser.host, user=parser.user,\npassword=parser.password,port=parser.port)\nprint(conn_args)\nif __name__ == '__main__':\nmain()\n</code></pre></p> <p>\u8f93\u51fa\u4fe1\u606f</p> <pre><code>$ python apgparse\u6a21\u5757.py --help\n\nusage: apgparse\u6a21\u5757.py [-h] --host HOST -u USER -p PASSWORD [-P PORT] [-v]\nA Python-MySQL client\n\noptional arguments:\n  -h, --help            show this help message and exit\n--host HOST           connect to host\n  -u USER, --user USER  user for login\n  -p PASSWORD, --password PASSWORD\n                        password to use when connecting to server\n  -P PORT, --port PORT  port number to use for connection or 3306 for default\n  -v, --version         show program's version number and exit\n</code></pre> <p>\u793a\u4f8b\u4ee3\u7801</p> <pre><code>#!/usr/bin/env python\n# -*- coding: utf-8 -*-\nimport argparse\ndef get_argparse():\nparser = argparse.ArgumentParser(description='A email client in terminal')\nparser.add_argument('-s', action='store', dest='subject', required=True, help='specify a subject (must be in quotes if it has spaces)')\nparser.add_argument('-a', action='store', nargs='*', dest='attaches', required=False, help='attach file(s) to the message')\nparser.add_argument('-f', action='store', dest='conf', required=False, help='specify an alternate .emcli.cnf file')\nparser.add_argument('-r', action='store', nargs='*', dest='recipients', required=True, help='recipient who you are sending the email to')\nparser.add_argument('-v', action='version', version='%(prog)s 0.2')\nreturn parser.parse_args()\nif __name__ == '__main__':\nparser = get_argparse()\nprint(parser)\nprint(\"s = \", parser.subject)\nprint(\"r = \", parser.recipients)\nprint(\"f = \", parser.conf)\n</code></pre> <pre><code>$ python argparse02.py -s hu -r huajianli -f \"config.cfg\"\nNamespace(attaches=None, conf='config.cfg', recipients=['huajianli'], subject='hu')\ns =  hu\nr =  ['huajianli']\nf =  config.cfg\n</code></pre> <p>Python\u547d\u4ee4\u884c\u53c2\u6570\u76843\u79cd\u4f20\u5165\u65b9\u5f0f</p> <p>Python \u547d\u4ee4\u884c\u53c2\u6570\u76843\u79cd\u4f20\u5165\u65b9\u5f0f Python \u547d\u4ee4\u884c\u53c2\u6570\u5316</p> <p>argparse\u6a21\u5757\u793a\u4f8b</p> <p>\u89e3\u6790\u547d\u4ee4\u884c\u9009\u9879</p> <p>Python\u5b9e\u7528\u6a21\u5757(\u4e8c\u5341\u516d)argparse</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#logging","title":"logging","text":"<p>\u4f7f\u7528\u65e5\u5fd7\uff0c\u5c24\u5176\u662f\u6807\u51c6\u5e93\u4e2d\u7684\u65e5\u5fd7\u6a21\u5757\u5177\u6709\u975e\u5e38\u591a\u7684\u597d\u5904\u3002\u5305\u62ec\uff1a</p> <p>1\uff09\u6240\u6709\u65e5\u5fd7\u5177\u6709\u7edf\u4e00\u7684\u683c\u5f0f\uff0c\u4fbf\u4e8e\u540e\u7eed\u5904\u7406\uff1b</p> <p>2\uff09\u4e30\u5bcc\u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u53ea\u9700\u8981\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u5c31\u53ef\u4ee5\u4fee\u6539\u65e5\u5fd7\u7684\u683c\u5f0f\uff0c\u4e0d\u9700\u8981\u4fee\u6539\u4ee3\u7801\uff1b</p> <p>3\uff09\u6839\u636e\u91cd\u8981\u6027\u5bf9\u65e5\u5fd7\u8fdb\u884c\u5206\u7c7b\uff0c\u53ef\u4ee5\u53ea\u663e\u793a\u91cd\u8981\u7684\u65e5\u5fd7\uff1b</p> <p>4\uff09\u81ea\u52a8\u7ba1\u7406\u65e5\u5fd7\u6587\u4ef6\uff0c\u5982\u6309\u5929\u5207\u6362\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\uff0c\u53ea\u4fdd\u7559\u4e00\u4e2a\u6708\u7684\u65e5\u5fd7\u6587\u4ef6\u7b49\u3002</p> <p>python\u7684logging\u6a21\u5757\u63d0\u4f9b\u4e86\u6807\u51c6\u7684\u65e5\u5fd7\u63a5\u53e3\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5b83\u5b58\u50a8\u5404\u79cd\u683c\u5f0f\u7684\u65e5\u5fd7.</p> <p>\u65e5\u5fd7\u7ea7\u522b\u5927\u5c0f\u5173\u7cfb\u4e3a: critical &gt; error &gt; warning &gt; info &gt; debug &gt; notset \u4e5f\u53ef\u81ea\u5b9a\u4e49\u65e5\u5fd7\u7ea7\u522b</p> \u7ea7\u522b \u7ea7\u522b\u6570\u503c \u4f7f\u7528\u65f6\u673a DEBUG 10 \u8be6\u7ec6\u4fe1\u606f\uff0c\u5e38\u7528\u4e8e\u8c03\u8bd5\u3002 INFO 20 \u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u4e00\u4e9b\u4fe1\u606f\u3002 WARNING 30 \u8b66\u544a\u7528\u6237\uff0c\u867d\u7136\u7a0b\u5e8f\u8fd8\u5728\u6b63\u5e38\u5de5\u4f5c\uff0c\u4f46\u6709\u53ef\u80fd\u53d1\u751f\u9519\u8bef\u3002 ERROR 40 \u7531\u4e8e\u66f4\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u7a0b\u5e8f\u5df2\u4e0d\u80fd\u6267\u884c\u4e00\u4e9b\u529f\u80fd\u4e86\u3002 CRITICAL 50 \u4e25\u91cd\u9519\u8bef\uff0c\u7a0b\u5e8f\u5df2\u4e0d\u80fd\u7ee7\u7eed\u8fd0\u884c\u3002 <p>\u9ed8\u8ba4\u7ea7\u522b\u662fWARNING\uff0c\u8868\u793a\u53ea\u6709WARING\u548c\u6bd4WARNING\u66f4\u4e25\u91cd\u7684\u4e8b\u4ef6\u624d\u4f1a\u88ab\u8bb0\u5f55\u5230\u65e5\u5fd7\u5185\uff0c\u4f4e\u7ea7\u522b\u7684\u4fe1\u606f\u4f1a\u88ab\u5ffd\u7565\u3002\u56e0\u6b64\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cDEBUG\u548cINFO\u4f1a\u88ab\u5ffd\u7565\uff0cWARING\u3001ERROR\u548cCRITICAL\u4f1a\u88ab\u8bb0\u5f55\u3002</p> <pre><code>import logging\nlogging.debug('debug')                 # \u9ed8\u8ba4\u65e5\u5fd7\u7ea7\u522b\u4e3a warning ,\u6545debug\u65e5\u5fd7\u4e0d\u505a\u6253\u5370\nlogging.warning('warning')             # \u8fbe\u5230\u9ed8\u8ba4\u65e5\u5fd7\u7ea7\u522b\u4e3aWARNING,\u6253\u5370\u5230\u5c4f\u5e55 warning\n</code></pre> <pre><code>import logging\nlogging.basicConfig(level=logging.ERROR)    #\u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\u4e3aERROR\nlogging.debug(\"\u8fd9\u662fDEBUG\u7ea7\u522b\u4fe1\u606f\")\nlogging.info(\"\u8fd9\u662fINFO\u7ea7\u522b\u4fe1\u606f\")\nlogging.warning(\"\u8fd9\u662fWARNING\u7ea7\u522b\u4fe1\u606f\")\nlogging.error(\"\u8fd9\u662fERROR\u7ea7\u522b\u4fe1\u606f\")\nlogging.critical(\"\u8fd9\u662fCRITICAL\u7ea7\u522b\u4fe1\u606f\")\n</code></pre> <p>getLogger()\u51fd\u6570\u521b\u5efa\u81ea\u5df1\u7684\u65e5\u5fd7\u5668\u5bf9\u8c61\uff0c\u672c\u4f8b\u4e2d__name__\u662f\u5f53\u524d\u6a21\u5757\u540d\u3002\u4f7f\u7528\u81ea\u5b9a\u4e49\u65e5\u5fd7\u5668\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>import logging\nlogging.basicConfig(level=logging.DEBUG)    #\u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\u4e3aDEBUG\nlogger = logging.getLogger(__name__)\nlogger.debug(\"\u8fd9\u662fDEBUG\u7ea7\u522b\u4fe1\u606f\")\nlogger.info(\"\u8fd9\u662fINFO\u7ea7\u522b\u4fe1\u606f\")\nlogger.warning(\"\u8fd9\u662fWARNING\u7ea7\u522b\u4fe1\u606f\")\nlogger.error(\"\u8fd9\u662fERROR\u7ea7\u522b\u4fe1\u606f\")\nlogger.critical(\"\u8fd9\u662fCRITICAL\u7ea7\u522b\u4fe1\u606f\")\n</code></pre></p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u65e5\u5fd7\u4fe1\u606f\u683c\u5f0f\u5316","title":"\u65e5\u5fd7\u4fe1\u606f\u683c\u5f0f\u5316","text":"<p>format\u53c2\u6570\u4e2d\u53ef\u80fd\u7528\u5230\u7684\u683c\u5f0f\u5316\u4e32\uff1a <pre><code>%(name)s Logger\u7684\u540d\u5b57\n%(levelno)s \u6570\u5b57\u5f62\u5f0f\u7684\u65e5\u5fd7\u7ea7\u522b\n%(levelname)s \u6587\u672c\u5f62\u5f0f\u7684\u65e5\u5fd7\u7ea7\u522b\n%(pathname)s \u8c03\u7528\u65e5\u5fd7\u8f93\u51fa\u51fd\u6570\u7684\u6a21\u5757\u7684\u5b8c\u6574\u8def\u5f84\u540d\uff0c\u53ef\u80fd\u6ca1\u6709\n%(filename)s \u8c03\u7528\u65e5\u5fd7\u8f93\u51fa\u51fd\u6570\u7684\u6a21\u5757\u7684\u6587\u4ef6\u540d\n%(module)s \u8c03\u7528\u65e5\u5fd7\u8f93\u51fa\u51fd\u6570\u7684\u6a21\u5757\u540d\n%(funcName)s \u8c03\u7528\u65e5\u5fd7\u8f93\u51fa\u51fd\u6570\u7684\u51fd\u6570\u540d\n%(lineno)d \u8c03\u7528\u65e5\u5fd7\u8f93\u51fa\u51fd\u6570\u7684\u8bed\u53e5\u6240\u5728\u7684\u4ee3\u7801\u884c\n%(created)f \u5f53\u524d\u65f6\u95f4\uff0c\u7528UNIX\u6807\u51c6\u7684\u8868\u793a\u65f6\u95f4\u7684\u6d6e \u70b9\u6570\u8868\u793a\n%(relativeCreated)d \u8f93\u51fa\u65e5\u5fd7\u4fe1\u606f\u65f6\u7684\uff0c\u81eaLogger\u521b\u5efa\u4ee5 \u6765\u7684\u6beb\u79d2\u6570\n%(asctime)s \u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u5f53\u524d\u65f6\u95f4\u3002\u9ed8\u8ba4\u683c\u5f0f\u662f \u201c2003-07-08 16:49:45,896\u201d\u3002\u9017\u53f7\u540e\u9762\u7684\u662f\u6beb\u79d2\n%(thread)d \u7ebf\u7a0bID\u3002\u53ef\u80fd\u6ca1\u6709\n%(threadName)s \u7ebf\u7a0b\u540d\u3002\u53ef\u80fd\u6ca1\u6709\n%(process)d \u8fdb\u7a0bID\u3002\u53ef\u80fd\u6ca1\u6709\n%(message)s\u7528\u6237\u8f93\u51fa\u7684\u6d88\u606f\n\nlogging.basicConfig                    # \u901a\u8fc7logging.basicConfig\u51fd\u6570\u5bf9\u65e5\u5fd7\u7684\u8f93\u51fa\u683c\u5f0f\u53ca\u65b9\u5f0f\u505a\u76f8\u5173\u914d\u7f6e\n    # basicConfig \u76f8\u5173\u53c2\u6570\u5e2e\u52a9\n    filename               # \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u540d\n    filemode               # \u548cfile\u51fd\u6570\u610f\u4e49\u76f8\u540c\uff0c\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u7684\u6253\u5f00\u6a21\u5f0f\uff0c'w'\u6216'a'\n    datefmt                # \u6307\u5b9a\u65f6\u95f4\u683c\u5f0f\uff0c\u540ctime.strftime()\n    level                  # \u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\uff0c\u9ed8\u8ba4\u4e3alogging.WARNING\n    stream                 # \u6307\u5b9a\u5c06\u65e5\u5fd7\u7684\u8f93\u51fa\u6d41\uff0c\u53ef\u4ee5\u6307\u5b9a\u8f93\u51fa\u5230sys.stderr,sys.stdout\u6216\u8005\u6587\u4ef6\uff0c\u9ed8\u8ba4\u8f93\u51fa\u5230sys.stderr\uff0c\u5f53stream\u548cfilename\u540c\u65f6\u6307\u5b9a\u65f6\uff0cstream\u88ab\u5ffd\u7565\n    format                 # \u6307\u5b9a\u8f93\u51fa\u7684\u683c\u5f0f\u548c\u5185\u5bb9\uff0cformat\u53ef\u4ee5\u8f93\u51fa\u5f88\u591a\u6709\u7528\u4fe1\u606f\uff0c\u5982\u4e0a\u4f8b\u6240\u793a:\n        %(levelno)s        # \u6253\u5370\u65e5\u5fd7\u7ea7\u522b\u7684\u6570\u503c\n        %(levelname)s      # \u6253\u5370\u65e5\u5fd7\u7ea7\u522b\u540d\u79f0\n        %(pathname)s       # \u6253\u5370\u5f53\u524d\u6267\u884c\u7a0b\u5e8f\u7684\u8def\u5f84\uff0c\u5176\u5b9e\u5c31\u662fsys.argv[0]\n        %(filename)s       # \u6253\u5370\u5f53\u524d\u6267\u884c\u7a0b\u5e8f\u540d\n        %(funcName)s       # \u6253\u5370\u65e5\u5fd7\u7684\u5f53\u524d\u51fd\u6570\n        %(lineno)d         # \u6253\u5370\u65e5\u5fd7\u7684\u5f53\u524d\u884c\u53f7\n        %(asctime)s        # \u6253\u5370\u65e5\u5fd7\u7684\u65f6\u95f4\n        %(thread)d         # \u6253\u5370\u7ebf\u7a0bID\n        %(threadName)s     # \u6253\u5370\u7ebf\u7a0b\u540d\u79f0\n        %(process)d        # \u6253\u5370\u8fdb\u7a0bID\n        %(message)s        # \u6253\u5370\u65e5\u5fd7\u4fe1\u606f\n\nlogging.basicConfig(level=logging.DEBUG,\n                format='%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s',\n                datefmt='%a, %d %b %Y %H:%M:%S',\n                filename='myapp.log',\n                filemode='w')\n# \u65e5\u5fd7\u7ea7\u522bwarning\u6216\u9ad8\u4e8ewarning\u7684\u4f1a\u5199\u5165\u6587\u4ef6 myapp.log \u4e2d\n</code></pre></p> <p>\u793a\u4f8b <pre><code>import logging\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(threadName)s - %(name)s - %(funcName)s - %(levelname)s'\n'-%(message)s')\nlogger = logging.getLogger(__name__)\nlogger.debug(\"\u8fd9\u662fDEBUG\u7ea7\u522b\u4fe1\u606f.\")\nlogger.info(\"\u8fd9\u662fINFO\u7ea7\u522b\u4fe1\u606f.\")\nlogger.warning(\"\u8fd9\u662fWARNING\u7ea7\u522b\u4fe1\u606f.\")\nlogger.error(\"\u8fd9\u662fERROR\u7ea7\u522b\u4fe1\u606f\u3002\")\nlogger.critical(\"\u8fd9\u662fCRITICAL\u7ea7\u522b\u4fe1\u606f\u3002\")\ndef funlog():\nlogger.info(\"\u8fdb\u5165funlog\u51fd\u6570\u3002\")\nlogger.info(\"\u8c03\u7528funlog\u51fd\u6570\u3002\")\nfunlog()\n</code></pre></p> <p>\u8f93\u51fa\u7ed3\u679c <pre><code>2019-05-21 16:31:33,371 - MainThread - __main__ - &lt;module&gt; - INFO-\u8fd9\u662fINFO\u7ea7\u522b\u4fe1\u606f.\n2019-05-21 16:31:33,371 - MainThread - __main__ - &lt;module&gt; - WARNING-\u8fd9\u662fWARNING\u7ea7\u522b\u4fe1\u606f.\n2019-05-21 16:31:33,371 - MainThread - __main__ - &lt;module&gt; - ERROR-\u8fd9\u662fERROR\u7ea7\u522b\u4fe1\u606f\u3002\n2019-05-21 16:31:33,371 - MainThread - __main__ - &lt;module&gt; - CRITICAL-\u8fd9\u662fCRITICAL\u7ea7\u522b\u4fe1\u606f\u3002\n2019-05-21 16:31:33,371 - MainThread - __main__ - &lt;module&gt; - INFO-\u8c03\u7528funlog\u51fd\u6570\u3002\n2019-05-21 16:31:33,371 - MainThread - __main__ - funlog - INFO-\u8fdb\u5165funlog\u51fd\u6570\u3002\n</code></pre></p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u65e5\u5fd7\u91cd\u5b9a\u4f4d","title":"\u65e5\u5fd7\u91cd\u5b9a\u4f4d","text":"<p>\u5c06\u65e5\u5fd7\u4fe1\u606f\u8f93\u51fa\u5230test.log\u6587\u4ef6\u4e2d</p> <pre><code>import logging\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(threadName)s - %(name)s - %(funcName)s - %(levelname)s'\n'-%(message)s', filename=\"test.log\")\nlogger = logging.getLogger(__name__)\nlogger.debug(\"\u8fd9\u662fDEBUG\u7ea7\u522b\u4fe1\u606f.\")\nlogger.info(\"\u8fd9\u662fINFO\u7ea7\u522b\u4fe1\u606f.\")\nlogger.warning(\"\u8fd9\u662fWARNING\u7ea7\u522b\u4fe1\u606f.\")\nlogger.error(\"\u8fd9\u662fERROR\u7ea7\u522b\u4fe1\u606f\u3002\")\nlogger.critical(\"\u8fd9\u662fCRITICAL\u7ea7\u522b\u4fe1\u606f\u3002\")\ndef funlog():\nlogger.info(\"\u8fdb\u5165funlog\u51fd\u6570\u3002\")\nlogger.info(\"\u8c03\u7528funlog\u51fd\u6570\u3002\")\nfunlog()\n</code></pre> <p>\u5c06\u65e5\u5fd7\u91cd\u5b9a\u5411\u5230testLog.txt\u4e2d</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2020/1/7 14:13\n# filename: Logging01.py\n__author__ = 'hstking hstking@hotmail.com'\nimport logging\nclass TestLogging(object):\ndef __init__(self):\nlogFormat = '%(asctime)-12s %(levelname)-8s %(name)-10s %(message)-12s'\nlogFileName = './testLog.txt'\nlogging.basicConfig(level=logging.INFO,\nformat=logFormat,\nfilename=logFileName,\nfilemode='w')\nlogging.debug('debug message')\nlogging.info('info message')\nlogging.warning('warning message')\nlogging.error('error message')\nlogging.critical('critical message')\nif __name__ == '__main__':\ntl = TestLogging()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u5c01\u88c5logging\u7c7b","title":"\u5c01\u88c5logging\u7c7b","text":"<pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2019/9/17 10:40\n# filename: loggingClass.py\nimport logging\nimport getpass\nimport sys\n# \u5b9a\u4e49MyLog\u7c7b\nclass MyLog(object):\n'''\n    \u8fd9\u4e2a\u7c7b\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u81ea\u7528\u7684log\n    '''\ndef __init__(self):  # \u7c7bMyLog\u7684\u6784\u9020\u51fd\u6570\nuser = getpass.getuser()\nself.logger = logging.getLogger(user)\nself.logger.setLevel(logging.DEBUG)\nlogFile = './' + str(sys.argv[0]).split(\"/\")[-1][0:-3] + '.log'  # \u65e5\u5fd7\u6587\u4ef6\u540d\nprint(logFile)\nformatter = logging.Formatter('%(asctime)-12s %(levelname)-8s %(name)-10s %(message)-12s')\n''' \u65e5\u5fd7\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u5e76\u8f93\u51fa\u5230\u65e5\u5fd7\u6587\u4ef6\u5185'''\nlogHand = logging.FileHandler(logFile)\nlogHand.setFormatter(formatter)\nlogHand.setLevel(logging.ERROR)  # \u53ea\u6709\u9519\u8bef\u624d\u4f1a\u88ab\u8bb0\u5f55\u5230logfile\u4e2d\nlogHandSt = logging.StreamHandler()\nlogHandSt.setFormatter(formatter)\nself.logger.addHandler(logHand)\nself.logger.addHandler(logHandSt)\n''' \u65e5\u5fd75\u4e2a\u57fa\u672c\u5bf9\u5e94\u4ee5\u4e0b5\u4e2a\u51fd\u6570  '''\ndef debug(self, msg):\nself.logger.debug(msg)\ndef info(self, msg):\nself.logger.info(msg)\ndef warn(self, msg):\nself.logger.warn(msg)\ndef error(self, msg):\nself.logger.error(msg)\ndef critical(self, msg):\nself.logger.critical(msg)\nif __name__ == '__main__':\nmylog = MyLog()\nmylog.debug(\"I'm debug\")\nmylog.warn(\"I'm warn\")\nmylog.error(\"I'm error\")\nmylog.critical(\"I'm critical\")\n</code></pre> <p>\u5c06loggingClass.py\u4f5c\u4e3a\u6a21\u5757\u5bfc\u5165\u4f7f\u7528</p> <pre><code>#!/usr/bin/env python\n# filename: testmylog.py\nfrom loggingClass import MyLog\nif __name__ == '__main__':\nt1 = MyLog()\nt1.info(\"This is info\")\nt1.debug(\"This is debug\")\nt1.warn(\"This is warnning\")\nt1.error(\"This is error\")\nt1.critical(\"This is critcal\")\n</code></pre> <pre><code>#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @auther:   18793\n# @Date\uff1a    2021/3/15 16:07\n# @filename: logging\u6a21\u5757\u5c01\u88c5.py\n# @Email:    1879324764@qq.com\n# @Software: PyCharm\nimport logging\n\"\"\"\n\u57fa\u4e8elogging\u5c01\u88c5\u64cd\u4f5c\u7c7b\n\"\"\"\nclass My_logger:\n_logger = None\ndef __init__(self, path, console_level=logging.DEBUG, file_level=logging.DEBUG):\nself._logger = logging.getLogger(path)\nself._logger.setLevel(logging.DEBUG)\nfmt = logging.Formatter('%(asctime)-12s %(levelname)-8s %(name)-10s %(message)-12s')\n# \u8bbe\u7f6e\u547d\u4ee4\u884c\u65e5\u5fd7\nsh = logging.StreamHandler()\nsh.setLevel(console_level)\nsh.setFormatter(fmt)\n# \u8bbe\u7f6e\u6587\u4ef6\u65e5\u5fd7\nfh = logging.FileHandler(path, encoding=\"utf-8\")\nfh.setFormatter(fmt)\nfh.setLevel(file_level)\nself._logger.addHandler(sh)\nself._logger.addHandler(fh)\n# debug\ndef debug(self, message):\nself._logger.debug(message)\n# info\ndef info(self, message):\nself._logger.info(message)\n# warning\ndef warning(self, message):\nself._logger.warning(message)\n# error\ndef error(self, message):\nself._logger.error(message)\n# critical\ndef critical(self, message):\nself._logger.critical(message)\nif __name__ == '__main__':\nlogger = My_logger(\"./2012log.log\")\nlogger.debug(\"debug info \")\n# logger.info(\"202cdssssssssss\")\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6","title":"\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# filename: logging\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6.py\nimport logging\nimport logging.config\nlogging.config.fileConfig(\"logger.conf\")        #\u914d\u7f6e\u4fe1\u606f\u4ece\u6587\u4ef6logger.conf\u4e2d\u8bfb\u53d6\nlogger = logging.getLogger(\"logger1\")           #\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bfb\u53d6logger1\u914d\u7f6e\u4fe1\u606f\u521b\u5efa\u65e5\u5fd7\u5668\nlogger.debug(\"\u8fd9\u662fDEBUG\u7ea7\u522b\u4fe1\u606f\")\nlogger.info(\"\u8fd9\u662fINFO\u7ea7\u522b\u4fe1\u606f\")\nlogger.warning(\"\u8fd9\u662fWARNING\u7ea7\u522b\u4fe1\u606f\")\nlogger.error(\"\u8fd9\u662fERROR\u7ea7\u522b\u4fe1\u606f\")\nlogger.critical(\"\u8fd9\u662fCRITICAL\u7ea7\u522b\u4fe1\u606f\")\ndef funlog():\nlogger.info(\"\u8fdb\u5165funlog\u51fd\u6570\")\nlogger.info(\"\u8c03\u7528funlog\u51fd\u6570\u3002\")\nfunlog()\n</code></pre> <p><code>logger.conf</code></p> <p>\u4f7f\u7528\u65f6\u6ce8\u610f\u8981\u53bb\u6389 #\u6ce8\u91ca\u7684\u4fe1\u606f</p> <pre><code>[loggers]                       #\u914d\u7f6e\u65e5\u5fd7\u5668\nkeys=root,simpleExample         #\u65e5\u5fd7\u5668\u5305\u542b\u4e86root\u548csimpleExample\n\n[logger_root]                   #\u914d\u7f6e\u6839\u65e5\u5fd7\u5668\nlevel=DEBUG\nhandlers=consoleHandler         #\u65e5\u5fd7\u5668\u5bf9\u5e94\u7684\u5904\u7406\u5668\n\n[logger_simpleExample]          #\u914d\u7f6esimpleExample\u65e5\u5fd7\u5668\nlevel=DEBUG\nhandlers=fileHandler            #\u65e5\u5fd7\u5668\u5bf9\u5e94\u7684\u5904\u7406\u5668\nqualname=logger1                #\u65e5\u5fd7\u5668\u540d\u79f0\npropagate=0\n\n[handlers]                      #\u914d\u7f6e\u5904\u7406\u5668\nkeys=consoleHandler,fileHandler #\u5305\u542b\u4e86\u4e24\u4e2a\u5904\u7406\u5668\n\n[handler_consoleHandler]       # \u914d\u7f6econsoleHandler\u65e5\u5fd7\u5668\nclass=StreamHandler\nlevel=DEBUG\nformatter=simpleFormatter\nargs=(sys.stdout,)\n\n[handler_fileHandler]          #\u914d\u7f6efileHandler\u65e5\u5fd7\u5668\nclass=FileHandler\nlevel=DEBUG\nformatter=simpleFormatter\nargs=('test.log','a')\n\n[formatters]                  #\u914d\u7f6e\u683c\u5f0f\u5316\u5668\nkeys=simpleFormatter          #\u65e5\u5fd7\u5668\u5305\u542bsimpleFormatter\n\n[formatter_simpleFormatter]   #\u914d\u7f6esimpleFormatter\u683c\u5f0f\u5316\u5668\nformat=%(asctime)s %(filename)s[line:%(lineno)d] %(funcName)s %(levelname)s %(message)s\n</code></pre> <p>\u6267\u884c\u4e4b\u540e\uff0c\u65e5\u5fd7\u4f1a\u8bb0\u5f55\u5230test.log\u4e2d\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u57fa\u4e8eyaml\u914d\u7f6e\u6587\u4ef6\u7684\u65e5\u5fd7","title":"\u57fa\u4e8eYAML\u914d\u7f6e\u6587\u4ef6\u7684\u65e5\u5fd7","text":"<p>\u8fd9\u91cc\u8981\u5148\u901a\u8fc7pip\u5b89\u88c5yaml\u6a21\u5757\uff1a</p> <pre><code>pip install pyyaml\n</code></pre> <p>logging.conf.yaml\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>version: 1\nformatters:\n  simple:\n    format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'\nhandlers:\n  console:\n    class: logging.StreamHandler\n    level: DEBUG\n    formatter: simple\n    stream: ext://sys.stdout\nloggers:\n  simpleExample:\n    level: DEBUG\n    handlers: [console]\n    propagate: no\nroot:\n  level: DEBUG\n  handlers: [console]\n</code></pre> <p>\u4f7f\u7528\u4ee3\u7801\u793a\u4f8b\uff1a</p> <pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\n# filename: logging_yaml.py\nimport logging\nimport logging.config\nimport yaml\n# \u901a\u8fc7yaml\u6587\u4ef6\u914d\u7f6elogging\nf = open(\"logging.conf.yaml\")\ndic = yaml.load(f)\nf.close()\nlogging.config.dictConfig(dic)\n# \u521b\u5efalogger\nlogger = logging.getLogger('simpleExample')\n# \u8f93\u51fa\u65e5\u5fd7\nlogger.debug('debug message')\nlogger.info('info message')\nlogger.warn('warn message')\nlogger.error('error message')\nlogger.critical('critical message')\n'''\n\u8f93\u51fa\u4fe1\u606f\n2019-12-23 22:55:44,532 - simpleExample - DEBUG - debug message\n2019-12-23 22:55:44,532 - simpleExample - INFO - info message\n2019-12-23 22:55:44,532 - simpleExample - WARNING - warn message\n2019-12-23 22:55:44,532 - simpleExample - ERROR - error message\n2019-12-23 22:55:44,532 - simpleExample - CRITICAL - critical message\n'''\n</code></pre> <p>\u8bb0\u5f55\u65e5\u5fd7\u53ca\u6309\u5929\u5207\u5272\u5b9e\u4f8b</p> <pre><code>import os\nimport logging\nfrom logging.handlers import TimedRotatingFileHandler\nbase = os.path.abspath(os.path.dirname(__file__))\nlogfile = os.path.join(base, 'test', 'testlog')\nhandler = TimedRotatingFileHandler(filename=logfile, when='MIDNIGHT',\ninterval=1, backupCount=365)\nhandler.suffix = \"%Y%m%d.log\"\nhandler.setFormatter(logging.Formatter('%(asctime)s\\t%(levelname)-8s\\t%(message)s'))\nhandler.setLevel(logging.DEBUG)\napipartnerlogger = logging.getLogger(logfile)\napipartnerlogger.addHandler(handler)\napipartnerlogger.setLevel(logging.INFO)\n</code></pre> <p>\u53c2\u8003\u6587\u732e</p> <p>logging\u6a21\u5757</p> <p>logging</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u4e0e\u547d\u4ee4\u884c\u76f8\u5173\u7684\u5f00\u6e90\u9879\u76ee","title":"\u4e0e\u547d\u4ee4\u884c\u76f8\u5173\u7684\u5f00\u6e90\u9879\u76ee","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#\u4f7f\u7528click\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570","title":"\u4f7f\u7528click\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570","text":"<p>Click\u662fFlask\u7684\u4f5c\u8005\uff08Armin Ronacher\uff09\u5f00\u53d1\u7684\u4e00\u4e2a\u7b2c\u4e09\u65b9\u6a21\u5757\uff0c\u7528\u4e8e\u5feb\u901f\u521b\u5efa\u547d\u4ee4\u884c\u3002\u5b83\u7684\u4f5c\u7528\u4e0ePytho\u6807\u51c6\u5e93\u7684argparse\u76f8\u540c\uff0c\u4f46\u662f\uff0c\u4f7f\u7528\u66f4\u52a0\u7b80\u5355\u3002</p> <p>Click\u76f8\u5bf9\u4e8e\u6807\u51c6\u5e93\u7684argparse\uff0c\u5c31\u597d\u6bd4requests\u76f8\u5bf9\u4e8e\u6807\u51c6\u5e93\u7684urllib\u3002</p> <p>click\u662f\u4e00\u4e2a\u7b2c\u4e09\u65b9\u5e93\uff0c\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u4e4b\u524d\u9700\u8981\u5148\u5b89\u88c5\uff1a</p> <pre><code>pip install click -i https://mirrors.aliyun.com/pypi/simple\n</code></pre> <pre><code>import click\n@click.command()\n@click.option('--count', default=1, help='Number of greetings.')\n@click.option('--name', prompt='Your name',\nhelp='The person to greet.')\ndef hello(count, name):\n\"\"\"Simple program that greets NAME for a total of COUNT times.\"\"\"\nfor x in range(count):\nclick.echo('Hello %s!' % name)\nif __name__ == '__main__':\nhello()\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u51fd\u6570hello\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662fcount\u548cname\uff0c\u5b83\u4eec\u7684\u53d6\u503c\u4ece\u547d\u4ee4\u884c\u4e2d\u83b7\u53d6\u3002\u5728\u8fd9\u6bb5\u7a0b\u5e8f\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86click\u6a21\u5757\u4e2d\u7684command\u3001option\u548cecho\uff0c\u5b83\u4eec\u7684\u4f5c\u7528\u5982\u4e0b\uff1a</p> <ul> <li> <p>command\uff1a\u4f7f\u51fd\u6570hello\u6210\u4e3a\u547d\u4ee4\u884c\u63a5\u53e3\uff1b</p> </li> <li> <p>option\uff1a\u589e\u52a0\u547d\u4ee4\u884c\u9009\u9879\uff1b</p> </li> <li> <p>echo\uff1a\u8f93\u51fa\u7ed3\u679c\uff0c\u4f7f\u7528echo\u8fdb\u884c\u8f93\u51fa\u662f\u4e3a\u4e86\u83b7\u5f97\u66f4\u597d\u7684\u517c\u5bb9\u6027\uff0c\u56e0\u4e3aPython2\u4e2dprint\u662f\u4e00\u4e2a\u8bed\u53e5\uff0cPython3\u4e2dprint\u662f\u4e00\u4e2a\u51fd\u6570\u3002</p> </li> </ul> <p>\u6267\u884c\u7ed3\u679c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>(venv) hujianli@hujianli-OptiPlex-7010:/data/coder/click-sample$ python main.py --count=3\nYour name: hujianli\nHello hujianli!\nHello hujianli!\nHello hujianli!\n</code></pre></p> <p>\u4e0eargparse\u4e00\u6837\uff0cClick\u4e5f\u4f1a\u81ea\u52a8\u4e3a\u6211\u4eec\u4ea7\u751f\u5e2e\u52a9\u4fe1\u606f</p> <pre><code>$ python main.py --help\nUsage: main.py [OPTIONS]\nSimple program that greets NAME for a total of COUNT times.\n\nOptions:\n  --count INTEGER  Number of greetings.\n  --name TEXT      The person to greet.\n  --help           Show this message and exit.\n</code></pre> <p>option\u6700\u57fa\u672c\u7684\u7528\u6cd5\u5c31\u662f\u901a\u8fc7\u6307\u5b9a\u547d\u4ee4\u884c\u9009\u9879\u7684\u540d\u79f0\uff0c\u4ece\u547d\u4ee4\u884c\u8bfb\u53d6\u53c2\u6570\u503c\uff0c\u518d\u5c06\u5176\u4f20\u9012\u7ed9\u51fd\u6570\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u9664\u4e86\u8bbe\u7f6e\u547d\u4ee4\u884c\u9009\u9879\u7684\u540d\u79f0\uff0c\u6211\u4eec\u8fd8\u6307\u5b9a\u4e86\u9ed8\u8ba4\u503c\u548c\u5e2e\u52a9\u4fe1\u606f\u3002</p> <p>option\u5e38\u7528\u7684\u8bbe\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> <ul> <li> <p>default\uff1a\u8bbe\u7f6e\u547d\u4ee4\u884c\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\uff1b</p> </li> <li> <p>help\uff1a\u53c2\u6570\u8bf4\u660e\uff1b</p> </li> <li> <p>type\uff1a\u53c2\u6570\u7c7b\u578b\uff0c\u53ef\u4ee5\u662fstring\u3001int\u3001float\u7b49\uff1b</p> </li> <li> <p>prompt\uff1a\u5f53\u5728\u547d\u4ee4\u884c\u4e2d\u6ca1\u6709\u8f93\u5165\u76f8\u5e94\u7684\u53c2\u6570\u65f6\uff0c\u4f1a\u6839\u636eprompt\u63d0\u793a\u7528\u6237\u8f93\u5165\uff1b</p> </li> <li> <p>nargs\uff1a\u6307\u5b9a\u547d\u4ee4\u884c\u53c2\u6570\u63a5\u53d7\u7684\u503c\u7684\u4e2a\u6570\u3002</p> </li> </ul> <p>\u5b98\u65b9\u7ed9\u51fa\u7684Click\u4f7f\u7528\u6848\u4f8b\u3002</p> <pre><code>import codecs\nimport click\n@click.command()\n@click.option('--pos', nargs=2, type=float)\ndef findme(pos):\nclick.echo('%s / %s' % pos)\n@click.command()\n@click.option('--hash-type', type=click.Choice(['md5', 'sha1']))\ndef digest(hash_type):\nclick.echo(hash_type)\nif __name__ == '__main__':\n# findme()\n# digest()\npass\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u4f7f\u7528\u4e86 Click \u6a21\u5757\u6765\u521b\u5efa\u547d\u4ee4\u884c\u754c\u9762\uff0c\u5e76\u5b9a\u4e49\u4e86\u4e09\u4e2a\u547d\u4ee4\uff1afindme()\u3001digest() \u548c encrypt()\u3002</p> <p>\u8981\u6267\u884c\u8fd9\u6bb5\u4ee3\u7801\uff0c\u60a8\u53ef\u4ee5\u4fdd\u5b58\u4e3a\u4e00\u4e2a Python \u811a\u672c\u6587\u4ef6\uff08\u4f8b\u5982 script.py\uff09\uff0c\u7136\u540e\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>python main.py [command]\n</code></pre> <p>\u5176\u4e2d [command] \u662f\u60a8\u60f3\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002</p> <p>\u5982\u679c\u60f3\u8981\u6267\u884c findme() \u547d\u4ee4\uff0c\u53d6\u6d88\u6ce8\u91ca findme() \u884c\uff0c\u5e76\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>python main.py findme --pos 1.0 2.0\n#\u8fd9\u5c06\u8f93\u51fa\uff1a1.0 / 2.0\n</code></pre> <p>\u5982\u679c\u60f3\u8981\u6267\u884c digest() \u547d\u4ee4\uff0c\u53d6\u6d88\u6ce8\u91ca digest() \u884c\uff0c\u5e76\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>python main.py digest --hash-type md5\n#\u8fd9\u5c06\u8f93\u51fa\uff1amd5\n</code></pre> <pre><code>import codecs\nimport click\n@click.group()\ndef cli():\npass\n@cli.command(\"encrypt\")\n@click.option('--password', prompt=True, hide_input=True,\nconfirmation_prompt=True)\ndef encrypt(password):\nencrypted_password = codecs.encode(password, 'rot_13')\nclick.echo('Encrypting password to %s' % encrypted_password)\nif __name__ == '__main__':\ncli()\n</code></pre> <p><pre><code>python main.py encrypt\n</code></pre> \u7136\u540e\uff0c\u6839\u636e\u63d0\u793a\u8f93\u5165\u5bc6\u7801\u5e76\u6309\u56de\u8f66\u952e\u3002\u811a\u672c\u5c06\u8f93\u51fa\u7ecf\u8fc7 rot13 \u52a0\u5bc6\u7684\u5bc6\u7801\u3002</p> <p>Click\u662f\u4e00\u4e2a\u4f18\u79c0\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u6709\u7740\u975e\u5e38\u8be6\u7ec6\u7684\u5b98\u65b9\u6587\u6863\uff0c\u8bfb\u8005\u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9\u6587\u6863\u4e86\u89e3Click\u7684\u66f4\u591a\u7528\u6cd5\u3002</p> <p>Click\u5b98\u65b9\u6587\u6863\u7684\u5730\u5740\u662fhttp://click.pocoo.org/5/\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/6.%E6%89%93%E9%80%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#prompt_toolkit\u6253\u9020\u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c\u5de5\u5177","title":"prompt_toolkit\u6253\u9020\u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c\u5de5\u5177","text":"<p>prompt_toolkit\u662f\u4e00\u4e2a\u5904\u7406\u4ea4\u4e92\u5f0f\u573a\u666f\u7684\u5f00\u6e90\u5e93\uff0c\u7528\u6765\u53d6\u4ee3\u5f00\u6e90\u7684readline\u4e0ecurses\u3002</p> <p>prompt_toolkit\u63d0\u4f9b\u4e86\u5f88\u591a\u9ad8\u7ea7\u529f\u80fd\uff0c\u53ef\u4ee5\u6709\u6548\u63d0\u5347\u4ea4\u4e92\u7f16\u7a0b\u7684\u6613\u7528\u6027\u3002</p> <p>prompt_toolkit\u7684\u7279\u6027\u5305\u62ec\uff1a</p> <p>1\uff09\u8bed\u6cd5\u9ad8\u4eae\uff1b</p> <p>2\uff09\u652f\u6301\u591a\u884c\u7f16\u8f91\uff1b</p> <p>3\uff09\u652f\u6301\u4ee3\u7801\u8865\u5168\uff1b</p> <p>4\uff09\u652f\u6301\u81ea\u52a8\u63d0\u793a\uff1b</p> <p>5\uff09\u53ef\u4ee5\u4f7f\u7528\u9f20\u6807\u79fb\u52a8\u5149\u6807\uff1b</p> <p>6\uff09\u652f\u6301Emacs\u4e0eVi\u98ce\u683c\u7684\u5feb\u6377\u952e\uff1b</p> <p>7\uff09\u652f\u6301\u67e5\u8be2\u5386\u53f2\uff1b</p> <p>8\uff09\u5bf9Unicode\u652f\u6301\u53cb\u597d\uff1b</p> <p>9\uff09\u4f7f\u7528Python\u8bed\u8a00\u5f00\u53d1\uff0c\u8de8\u5e73\u53f0\u3002</p> <p>prompt_toolkit\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5e93\uff0c\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u4e4b\u524d\u9700\u8981\u5148\u5b89\u88c5\uff1a</p> <pre><code>pip install prompt_toolkit -i https://mirrors.aliyun.com/pypi/simple\n</code></pre> <p>\u4f7f\u7528prompt_toolkit\u4e2d\u7684prompt\u51fd\u6570\u6765\u63a5\u53d7\u7528\u6237\u8f93\u5165</p> <p><pre><code>from prompt_toolkit import prompt\nwhile True:\nuser_input = prompt('&gt;')\nprint(user_input)\n</code></pre> \u5728\u8fd9\u6bb5\u7a0b\u5e8f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528Bash\u4e0b\u5e38\u7528\u7684\u5feb\u6377\u952e\u3002 \u4f8b\u5982\uff0c\u4f7f\u7528ctrl+a\u8df3\u5230\u8f93\u5165\u7684\u5f00\u5934\uff0c\u4f7f\u7528ctrl+e\u8df3\u8f6c\u5230\u8f93\u5165\u7684\u6a21\u5757\uff0c\u4f7f\u7528ctrl+k\u5220\u9664\u5149\u6807\u5230\u672b\u5c3e\u7684\u5185\u5bb9\u3002</p> <p>\u4e3a\u4e86\u5b9e\u73b0\u67e5\u627e\u5386\u53f2\u7684\u529f\u80fd\uff0c\u6211\u4eec\u9700\u8981\u7528\u5230prompt_toolkit.history\u6a21\u5757\u4e0b\u7684FileHistory\u7c7b\uff0c\u968f\u540e\uff0c\u5728\u8c03\u7528prompt\u65f6\u6784\u9020\u4e00\u4e2aFileHistory\u5bf9\u8c61\uff0c\u5e76\u4f20\u9012\u7ed9history\u53c2\u6570\u3002 \u5982\u4e0b\u6240\u793a\uff1a</p> <p><pre><code>from __future__ import unicode_literals\nfrom prompt_toolkit import prompt\nfrom prompt_toolkit.history import FileHistory\nwhile True:\nuser_input = prompt('&gt;',\nhistory=FileHistory('history.txt'),\n)\nprint(user_input)\n</code></pre> \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ea\u589e\u52a0\u4e86\u4e24\u884c\u4ee3\u7801\u5c31\u5b9e\u73b0\u4e86\u67e5\u770b\u5386\u53f2\u8f93\u5165\u7684\u529f\u80fd\u3002</p> <p>\u5229\u7528\u5386\u53f2\u8f93\u5165\u7684\u6570\u636e\uff0c\u5728\u7528\u6237\u8f93\u5165\u65f6\u8fdb\u884c\u81ea\u52a8\u63d0\u793a\u3002</p> <pre><code>from __future__ import unicode_literals\nfrom prompt_toolkit import prompt\nfrom prompt_toolkit.history import FileHistory\nfrom prompt_toolkit.auto_suggest import AutoSuggestFromHistory\nwhile True:\nuser_input = prompt('&gt;',\nhistory=FileHistory('history.txt'),\nauto_suggest=AutoSuggestFromHistory(),\n)\nprint(user_input)\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5148\u8f93\u5165\u4e86\u4e24\u4e2a\u5b57\u7b26\u4e32\uff0c\u968f\u540e\uff0c\u5f53\u6211\u4eec\u7684\u8f93\u5165\u5339\u914d\u5386\u53f2\u8f93\u5165\u65f6\uff0cprompt_toolkit\u5c06\u4ee5\u6697\u8272\u5b57\u4f53\u663e\u793a\u5339\u914d\u7684\u5386\u53f2\u8f93\u5165\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6309\u4e0b\u56de\u8f66\u5c31\u80fd\u81ea\u52a8\u8f93\u5165\u4e4b\u524d\u7684\u4e00\u957f\u4e32\u5b57\u7b26\u4e32\u3002</p> <p>\u81ea\u52a8\u8865\u5168+tab\u952e\u8865\u5168\u9009\u62e9\u63d0\u793a\u7684\u5185\u5bb9</p> <p>\u6211\u4eec\u53ea\u9700\u4f7f\u7528prompt-toolkit\u4e2d\u4e00\u4e2a\u540d\u4e3aWordCompleter\u7684\u51fd\u6570\u5373\u53ef\u5b9e\u73b0\u3002</p> <p>prompt-toolkit\u5c06\u7528\u6237\u8f93\u5165\u4e0e\u53ef\u80fd\u5efa\u8bae\u7684\u5b57\u5178\u8fdb\u884c\u5339\u914d\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a\u5217\u8868\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528tab\u952e\u4ece\u5217\u8868\u4e2d\u9009\u62e9\u8f93\u5165\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <p><pre><code>from __future__ import print_function\nfrom __future__ import unicode_literals\nfrom prompt_toolkit import prompt\nfrom prompt_toolkit.history import FileHistory\nfrom prompt_toolkit.auto_suggest import AutoSuggestFromHistory\nfrom prompt_toolkit.completion import WordCompleter\nSQLCompleter = WordCompleter(['select', 'from', 'insert', 'update', 'delete', 'drop'],\nignore_case=True)\nwhile True:\nuser_input = prompt('SQL&gt;', history=FileHistory('history.txt'),\nauto_suggest=AutoSuggestFromHistory(),\ncompleter=SQLCompleter)\nif user_input.strip().lower() == 'exit':\nbreak\nprint(user_input)\n</code></pre> \u7ed9\u51fa\u4e86\u81ea\u52a8\u8865\u5168\u7684\u4f8b\u5b50\uff0c\u6613\u7528\u6027\u51e0\u4e4e\u4e0eIPython\u4e2d\u7684tab\u952e\u81ea\u52a8\u8865\u5168\u4e00\u6a21\u4e00\u6837\u3002</p> <p>\u6211\u4eec\u73b0\u5728\u6709\u4e86\u4e00\u4e2aREPL\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4f7f\u7528\u5feb\u6377\u952e\u3001\u67e5\u627e\u5386\u53f2\u3001\u81ea\u52a8\u5b8c\u6210\u4ee5\u53ca\u81ea\u52a8\u63d0\u793a\u7b49\u529f\u80fd\u3002\u6211\u53ea\u7528\u4e86\u5c11\u91cf\u4ee3\u7801\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u3001\u6613\u7528\u6027\u5f3a\u7684REPL\u7a0b\u5e8f\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/","title":"7.\u6587\u672c\u5904\u7406","text":"<p>\u6b63\u662f\u7531\u4e8e\u7cfb\u7edf\u7ba1\u7406\u5458\u9700\u8981\u7ecf\u5e38\u5904\u7406\u6587\u672c\uff0cLinux\u624d\u6709\u4e86\u8bb8\u591a\u4e0e\u6587\u672c\u5904\u7406\u76f8\u5173\u7684\u5de5\u5177\uff0c\u5982grep\u3001awk\u3001sed\u3001wc\u3001tr\u3001cut\u3001cat\u7b49\u3002</p> <p>\u6587\u672c\u5904\u7406\u662f\u4e00\u4e2a\u5982\u6b64\u5e38\u89c1\u7684\u9700\u6c42\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u5e94\u8be5\u638c\u63e1\u4e00\u79cd\u5f3a\u5927\u7684\u6587\u672c\u5904\u7406\u5de5\u5177\u5e76\u5c06\u5176\u5e94\u7528\u5728\u65e5\u5e38\u7684\u6240\u6709\u5de5\u4f5c\u5f53\u4e2d\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#11-\u5b57\u7b26\u4e32\u5e38\u91cf","title":"1.1 \u5b57\u7b26\u4e32\u5e38\u91cf","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#111-\u5b9a\u4e49\u5b57\u7b26\u4e32","title":"1.1.1 \u5b9a\u4e49\u5b57\u7b26\u4e32","text":"<p>Python\u53ef\u4ee5\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u6765\u5b9a\u4e49\u5b57\u7b26\u4e32</p> <pre><code>In [1]: greet = \"Hello, world\"\nIn [2]: greet = 'Hello, world'\n</code></pre> <p>\u4f7f\u7528\u201c\\\u201d\u52a0\u4e0a\u4e00\u4e2a\u53ef\u4ee5\u663e\u793a\u7684\u5b57\u7b26\u6765\u5b9a\u4e49\u3002</p> <pre><code>In [5]: intro = 'He\\'s a teacher'\nIn [6]: statement = \"John said to me: \\\"Can you do me a favour tonight\\\"\"\n</code></pre> <p>\u9664\u4e86\u4f7f\u7528\u8f6c\u4e49\u7b26\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u539f\u59cb\u5b57\u7b26\u4e32\uff08raw string\uff09\u3002</p> <pre><code>import os\npath = r\"c:\\next\"\nprint(path)\nprint(os.path.isdir(path))\n</code></pre> <p>Python\u7684\u4e09\u5f15\u53f7\u5b9a\u4e49\u5b57\u7b26\u4e32</p> <pre><code>In [1]: message = ''' Type \"copyright\", \"credits\" or \"license\" for more information.\n   ...: object?   -&gt; Details about 'object', use 'object??' for extra details.'''\nIn [2]: message = \"\"\" Type \"copyright\", \"credits\" or \"license\" for more information.\n   ...: object?   -&gt; Details about 'object', use 'object??' for extra details.\"\"\"\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#112-\u5b57\u7b26\u4e32\u662f\u4e0d\u53ef\u53d8\u7684\u6709\u5e8f\u96c6\u5408","title":"1.1.2 \u5b57\u7b26\u4e32\u662f\u4e0d\u53ef\u53d8\u7684\u6709\u5e8f\u96c6\u5408","text":"<p>Python\u5b57\u7b26\u4e32\u7684\u4e0d\u53ef\u53d8\u6027.\u6240\u4ee5\u64cd\u4f5c\u5b57\u7b26\u4e32\u65f6\u9700\u8981\u907f\u514d\u4ea7\u751f\u592a\u591a\u7684\u4e2d\u95f4\u7ed3\u679c.\u9519\u8bef\u7684\u64cd\u4f5c.</p> <p>\u7528for\u5faa\u73af\u548c\u5b57\u7b26\u4e32\u7684\u201c+\u201d\u64cd\u4f5c\u8fde\u63a5\u5b57\u7b26\u4e32 <pre><code>In [1]: fruits = ['orange', 'apple', 'banana', 'pear']\nIn [2]: statement = fruits[0]\nIn [3]: for item in fruits[1:]:\n   ...:     statement = statement + \", \" + item\n   ...:\n\nIn [4]: print(statement)\norange, apple, banana, pear\n</code></pre></p> <p>\u6b63\u786e\u7684\u64cd\u4f5c <pre><code>In [5]: \", \".join(fruits)\nOut[5]: 'orange, apple, banana, pear'\n</code></pre></p> <p>\u5b57\u7b26\u4e32\u7684\u7d22\u5f15 <pre><code>In [6]: s = \"Hello,world\"\nIn [7]: s[:5]\nOut[7]: 'Hello'\nIn [8]: s[0:5]\nOut[8]: 'Hello'\nIn [9]: s[6:]\nOut[9]: 'world'\nIn [10]: s[::-1]\nOut[10]: 'dlrow,olleH'\nIn [11]: s[0:5:2]\nOut[11]: 'Hlo'\n#\u7f6e\u9006\u4e00\u4e2a\u5b57\u7b26\u4e32\nIn [12]: s[::-1]\nOut[12]: 'dlrow,olleH'\n#\u4f7f\u7528reversed\u51fd\u6570\nIn [13]: ''.join(reversed(s))\nOut[13]: 'dlrow,olleH'\n</code></pre></p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#113-\u5b57\u7b26\u4e32\u51fd\u6570","title":"1.1.3 \u5b57\u7b26\u4e32\u51fd\u6570","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#1\u901a\u7528\u64cd\u4f5c","title":"1.\u901a\u7528\u64cd\u4f5c","text":"<pre><code>In [1]: s = \"Hello,world\"\nIn [2]: len(s)\nOut[2]: 11\nIn [3]: \"Hello\" in s\nOut[3]: True\n\nIn [4]: \"Hello\" not in s\nOut[4]: False\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#2\u4e0e\u5927\u5c0f\u5199\u76f8\u5173\u7684\u65b9\u6cd5","title":"2.\u4e0e\u5927\u5c0f\u5199\u76f8\u5173\u7684\u65b9\u6cd5","text":"<p>\u4ee5\u4e0b\u51e0\u4e2a\u51fd\u6570\u662f\u4e0e\u5b57\u7b26\u5927\u5c0f\u5199\u76f8\u5173\u7684\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\uff1a</p> \u51fd\u6570 \u529f\u80fd s.upper \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5927\u5199 s.lower \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5c0f\u5199 s.isupper \u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u90fd\u4e3a\u5927\u5199 s.islower \u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u90fd\u4e3a\u5c0f\u5199 s.swapcase \u5c06\u5b57\u7b26\u4e32\u4e2d\u7684\u5927\u5199\u8f6c\u6362\u4e3a\u5c0f\u5199\u3001\u5c0f\u5199\u8f6c\u6362\u4e3a\u5927\u5199 s.capitalize \u5c06\u9996\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5927\u5199 s.istitle \u5224\u65ad\u5b57\u7b26\u4e32\u662f\u4e0d\u662f\u4e00\u4e2a\u6807\u9898 <p>\u7531\u4e8ePython\u8bbe\u8ba1\u4f18\u79c0\uff0c\u5e76\u62e5\u6709\u6e05\u6670\u7684\u547d\u540d\uff0c\u6240\u4ee5\uff0c\u901a\u8fc7\u540d\u5b57\u5c31\u80fd\u77e5\u9053\u51fd\u6570\u7684\u4f5c\u7528\u3002</p> <p>\u5982\u679c\u901a\u8fc7\u540d\u5b57\u65e0\u6cd5\u77e5\u9053\u51fd\u6570\u7684\u5177\u4f53\u4f5c\u7528\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e8c\u7ae0\u4ecb\u7ecd\u7684IPython\u83b7\u53d6\u51fd\u6570\u7684\u5e2e\u52a9\u4fe1\u606f\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>In [1]: s = \"hello, world\"\nIn [2]: s.capitalize?\nSignature: s.capitalize()\nDocstring:\nReturn a capitalized version of the string.\n\nMore specifically, make the first character have upper case and the rest lower\ncase.\nType:      builtin_function_or_method\n</code></pre></p> <p>\u4e0b\u9762\u662f\u4f7f\u7528IPython\u5bf9Python\u4e2d\u7684\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\u8fdb\u884c\u6d4b\u8bd5\u7684\u4f8b\u5b50\uff1a</p> <pre><code>In [1]: \"lai ming xing\".upper()\nOut[1]: 'LAI MING XING'\nIn [2]: \"Lai Ming Xing\".upper()\nOut[2]: 'LAI MING XING'\nIn [3]: \"Lai Ming Xing\".lower()\nOut[3]: 'lai ming xing'\nIn [4]: \"lai ming xing\".isupper()\nOut[4]: False\n\nIn [5]: \"LAI MING XING\".isupper()\nOut[5]: True\n\nIn [6]: \"Lai Ming Xing\".swapcase()\nOut[6]: 'lAI mING xING'\nIn [7]: \"lai ming xing\".capitalize()\nOut[7]: 'Lai ming xing'\nIn [8]: \"Lai ming xing\".istitle()\nOut[8]: False\n\nIn [9]: \"Lai Ming Xing\".istitle()\nOut[9]: True\n</code></pre> <p>\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5927\u5199\u6216\u8005\u5c0f\u5199\u662f\u5f88\u5b9e\u7528\u7684\u65b9\u6cd5\u3002\u4f8b\u5982\uff0c\u7a0b\u5e8f\u7b49\u5f85\u7528\u6237\u8f93\u5165\uff0c\u5728\u7528\u6237\u8f93\u5165\u201cyes\u201d\u7684\u65f6\u5019\uff0c\u6267\u884c\u67d0\u9879\u64cd\u4f5c\uff0c\u5426\u5219\u5c31\u9000\u51fa\u7a0b\u5e8f\u3002 \u4e3a\u4e86\u5bf9\u7528\u6237\u66f4\u52a0\u53cb\u597d\uff0c\u589e\u5f3a\u7528\u6237\u7684\u4f53\u9a8c\u611f\uff0c\u7a0b\u5e8f\u5e94\u8be5\u5728\u7528\u6237\u8f93\u5165\u201cyes\u201d\uff0c\u201cYes\u201d\uff0c\u201cYES\u201d\uff0c\u201cyES\u201d\uff0c\u201cYeS\u201d\u65f6\u90fd\u5224\u65ad\u4e3a\u771f\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u7528\u6237\u7684\u8f93\u5165\u5168\u90e8\u8f6c\u6362\u4e3a\u5c0f\u5199\uff0c\u7136\u540e\u4e0e\u201cyes\u201d\u8fdb\u884c\u6bd4\u8f83\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>yes_or_no = input('Plese input yes or no : ')\nif yes_or_no.lower() == \"yes\":\nprint(\"continue do something\")\nelse:\nprint(\"exit...\")\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#3\u5224\u65ad\u7c7b\u65b9\u6cd5","title":"3.\u5224\u65ad\u7c7b\u65b9\u6cd5","text":"<p>Python\u7684\u5b57\u7b26\u4e32\u6709\u5f88\u591a\u4ee5\u201cis\u201d\u5f00\u5934\u7684\u65b9\u6cd5\uff0c\u5982\u524d\u9762\u4ecb\u7ecd\u7684istitle\u3001isupper\u548cislower\u3002</p> <p>\u8fd9\u7c7b\u65b9\u6cd5\u90fd\u662f\u5224\u65ad\u7c7b\u7684\u65b9\u6cd5\uff0c\u5b83\u4eec\u4e0d\u4f1a\u4ea7\u751f\u65b0\u7684\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u603b\u662f\u8fd4\u56deTrue\u6216\u8005False\u3002</p> <p>\u5176\u4ed6\u5e38\u89c1\u7684\u5b57\u7b26\u4e32\u5224\u65ad\u7c7b\u65b9\u6cd5\u6709\uff1a</p> \u65b9\u6cd5 \u529f\u80fd s.isalpha \u5982\u679c\u5b57\u7b26\u4e32\u53ea\u5305\u542b\u5b57\u6bcd\uff0c\u5e76\u4e14\u975e\u7a7a\uff0c\u5219\u8fd4\u56deTrue\uff0c\u5426\u5219\u8fd4\u56deFalse s.isalnum \u5982\u679c\u5b57\u7b26\u4e32\u503c\u5305\u542b\u5b57\u6bcd\u548c\u6570\u5b57\uff0c\u5e76\u4e14\u975e\u7a7a\uff0c\u5219\u8fd4\u56deTrue\uff0c\u5426\u5219\u8fd4\u56deFalse s.isspace \u5982\u679c\u5b57\u7b26\u4e32\u503c\u5305\u542b\u7a7a\u683c\u3001\u5236\u8868\u7b26\u3001\u6362\u884c\u7b26\uff0c\u5e76\u4e14\u975e\u7a7a\uff0c\u5219\u8fd4\u56deTrue\uff0c\u5426\u5219\u8fd4\u56deFalse s.isdecimal \u5982\u679c\u5b57\u7b26\u4e32\u53ea\u5305\u542b\u6570\u5b57\u5b57\u7b26\uff0c\u5e76\u4e14\u975e\u7a7a\uff0c\u5219\u8fd4\u56deTrue\uff0c\u5426\u5219\u8fd4\u56deFalse <p>\u4e0b\u9762\u662f\u5728IPython\u4e2d\u6d4b\u8bd5\u7684\u4f8b\u5b50\uff1a</p> <pre><code>In [1]: \"Python\".isalpha()\nOut[1]: True\n\nIn [2]: \"Python 3.6\".isalpha()\nOut[2]: False\n\nIn [3]: \"Python 3.6\".isalnum()\nOut[3]: False\n\nIn [4]: \" \\t\\n\".isspace()\nOut[4]: True\n\nIn [5]: \"Python 3.6\".isdecimal()\nOut[5]: False\n\nIn [6]: \"3.6\".isdecimal()\nOut[6]: False\n\nIn [7]: \"36\".isdecimal()\nOut[7]: True\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#4startswith\u548cendswith","title":"4.startswith\u548cendswith","text":"\u65b9\u6cd5 \u529f\u80fd s.startswith \u5224\u65ad\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u5426\u4e3a\u5b57\u7b26\u4e32\u7684\u524d\u7f00 s.endswith \u5224\u65ad\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u5426\u4e3a\u5b57\u7b26\u4e32\u7684\u540e\u7f00 <pre><code>In [5]: s = \"hu jian li\"\nIn [6]: s.startswith('hu')\nOut[6]: True\n\nIn [7]: s.startswith('hua')\nOut[7]: False\n\nIn [8]: s.startswith('hu j')\nOut[8]: True\n\nIn [9]: s.endswith('li')\nOut[9]: True\n</code></pre> <p>\u627e\u51fa\u6240\u6709\u6587\u672c\u6587\u4ef6\u6216Python\u6587\u4ef6\uff0c\u5728Python\u4e2d\u4f7f\u7528\u5185\u7f6e\u7684\u5b57\u7b26\u4e32\u65b9\u6cd5\u5373\u53ef\uff0c\u975e\u5e38\u65b9\u4fbf\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [1]: import os\n\nIn [2]: [ item for item in os.listdir('.') if item.endswith('.py') ]\nOut[2]: ['e.py', 'f.py', 'g.py']\nIn [3]: [ item for item in os.listdir('.') if item.endswith('.txt') ]\nOut[3]: ['a.txt', 'b.txt', 'c.txt', 'd.txt']\n</code></pre> <p>\u4e0b\u9762\u5c31\u4ee5MongoDB\u7684\u65e5\u5fd7\u4e3a\u4f8b\u6f14\u793aPython\u4e2d\u7684\u524d\u7f00\u5339\u914d\u3002\u4e00\u4e2a\u5178\u578b\u7684MongoDB\u65e5\u5fd7\u76ee\u5f55\u5982\u4e0b\u6240\u793a\uff1a <pre><code>$ ls\nmongod.log  mongod.log.2017-03-01T12-52-22  mongod.log.2017-03-01T12-52-23\nmongod.log.2017-03-01T12-52-26  mongod.log.2017-03-01T12-52-27\n</code></pre></p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u77e5\u9053\u6240\u6709MongoDB\u65e5\u5fd7\u6587\u4ef6\u5360\u7528\u7684\u78c1\u76d8\u5927\u5c0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>import os\nmongod_logs = [item for item in os.listdir('/var/mongo/log') if item.startswith('mongod.log')]\nsum_size = sum(os.path.getsize(os.path.join('/var/mongo/log', item)) for item in mongod_logs)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#5\u67e5\u627e\u7c7b\u51fd\u6570","title":"5.\u67e5\u627e\u7c7b\u51fd\u6570","text":"\u65b9\u6cd5 \u529f\u80fd s.find \u67e5\u627e\u5b50\u4e32\u51fa\u73b0\u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u67e5\u627e\u5931\u8d25\uff0c\u8fd4\u56de-1 s.index \u4e0efind\u51fd\u6570\u7c7b\u4f3c\uff0c\u5982\u679c\u67e5\u627e\u5931\u8d25\uff0c\u629b\u51faValueError\u5f02\u5e38 s.rfind \u4e0efind\u51fd\u6570\u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8erfind\u662f\u4ece\u540e\u5411\u524d\u67e5\u627e s.rindex \u4e0eindex\u51fd\u6570\u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8erindex\u662f\u4ece\u540e\u5411\u524d\u67e5\u627e\u3002 <p><pre><code>In [1]:  s = \"Return the lowest index in S where substring sub is found\"\nIn [2]: s.find(\"in\")\nOut[2]: 18\nIn [3]: s.find(\"in\",19)\nOut[3]: 24\nIn [4]: s.find(\"not exists\")\nOut[4]: -1\n</code></pre> \u5bf9\u4e8e\u5224\u65ad\u4e00\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u662f\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u5b50\u4e32\uff0c\u6b63\u786e\u7684\u505a\u6cd5\u662f\u4f7f\u7528in\u548cnot in\uff1a</p> <p><pre><code>In [5]: 'in' in s\nOut[5]: True\n\nIn [6]: 'not exists' in s\nOut[6]: False\n\nIn [7]: 'not exists' not in s\nOut[7]: True\n</code></pre> find\u51fd\u6570\u6700\u5bb9\u6613\u88ab\u9519\u7528\u7684\u5730\u65b9\u5728\u4e8e\u4f7f\u7528find\u51fd\u6570\u5224\u65ad\u4e00\u4e2a\u5b50\u4e32\u662f\u5426\u51fa\u73b0\u5728\u5b57\u7b26\u4e32\u4e2d\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <p>\u9519\u8bef\u7684\u7528\u6cd5</p> <pre><code>In [1]: if \"hello, world\".find(\"not exists\"):\n   ...:     print(True)\n...: else:\n   ...:     print(False)\n...: True\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#114-\u6848\u4f8b\u4f7f\u7528python\u5206\u6790apache\u7684\u8bbf\u95ee\u65e5\u5fd7","title":"1.1.4 \u6848\u4f8b\uff1a\u4f7f\u7528Python\u5206\u6790Apache\u7684\u8bbf\u95ee\u65e5\u5fd7","text":"<p>\u4e00\u6761\u5178\u578b\u7684Apache\u9ed8\u8ba4\u683c\u5f0f\u7684\u65e5\u5fd7\u5982\u4e0b\uff1a</p> <p><pre><code>193.252.243.232 - - [29/Mar/2009:06:05:34 +0200] \"GET /index.php HTTP/1.1\" 200 8714 \"-\" \"Mozilla/5.0 (compatible; PJBot/3.0; +http://crawl.pagesjaunes.fr/robot)\" \"-\"\n</code></pre> Apache\u9ed8\u8ba4\u683c\u5f0f\u7684\u65e5\u5fd7\u5305\u542b12\u5217\uff0c\u5206\u522b\u662f\uff1a</p> <p>1\uff09\u5ba2\u6237\u7aefIP\uff1b</p> <p>2\uff09\u8fdc\u7a0b\u767b\u5f55\u540d\u79f0\uff1b</p> <p>3\uff09\u8ba4\u8bc1\u7684\u8fdc\u7a0b\u7528\u6237\uff1b</p> <p>4\uff09\u8bf7\u6c42\u7684\u65f6\u95f4\uff1b</p> <p>5\uff09UTC\u65f6\u95f4\u5dee\uff1b</p> <p>6\uff09\u8bf7\u6c42\u7684HTTP\u65b9\u6cd5\uff1b</p> <p>7\uff09\u8bf7\u6c42\u7684\u8d44\u6e90\uff1b</p> <p>8\uff09HTTP\u534f\u8bae\uff1b</p> <p>9\uff09HTTP\u7684\u72b6\u6001\u7801\uff1b</p> <p>10\uff09\u670d\u52a1\u7aef\u53d1\u9001\u7684\u5b57\u8282\u6570\uff1b</p> <p>11\uff09\u8bbf\u95ee\u6765\u6e90\uff1b</p> <p>12\uff09\u5ba2\u6237\u6d4f\u89c8\u5668\u4fe1\u606f\uff08\u5728\u672c\u4f8b\u4e2d\u4e0d\u5177\u4f53\u62c6\u5206\u6d4f\u89c8\u5668\u4fe1\u606f\uff09\u3002</p> <p>\u5bf9\u4e8e\u524d\u9762\u8fd9\u4e00\u884cApache\u65e5\u5fd7\uff0c\u5982\u679c\u76f4\u63a5\u4f7f\u7528\u5b57\u7b26\u4e32\u7684split\u51fd\u6570\u8fdb\u884c\u62c6\u5206\uff0c\u90a3\u4e48\uff0c\u62c6\u5206\u4ee5\u540e\u83b7\u5f97\u7684\u65e5\u5fd7\u5217\u8868\u4e2d\uff0c</p> <p>\u4e0b\u6807\u4e3a0\u7684\u5143\u7d20\u662f\u7528\u6237\u7684IP\uff0c \u4e0b\u6807\u4e3a6\u7684\u5143\u7d20\u662f\u7528\u6237\u8bf7\u6c42\u7684\u8d44\u6e90\uff0c \u4e0b\u6807\u662f8\u7684\u5143\u7d20\u662f\u672c\u6b21\u8bf7\u6c42\u7684HTTP CODE\u3002</p> <p>\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [1]: line = '193.252.243.232 - - [29/Mar/2009:06:05:34 +0200] \"GET /index.php HTTP/1.1\" 200 8714 \"-\" \"Mozilla/5.0 (compatible; PJBot/3.0; +http://crawl.pagesjaunes.fr/robot)\" \"-\"'\n...: In [2]: line.split()\nOut[2]: ['193.252.243.232',\n '-',\n '-',\n '[29/Mar/2009:06:05:34',\n '+0200]',\n '\"GET',\n '/index.php',\n 'HTTP/1.1\"',\n '200',\n '8714',\n '\"-\"',\n '\"Mozilla/5.0',\n '(compatible;',\n 'PJBot/3.0;',\n '+http://crawl.pagesjaunes.fr/robot)\"',\n '\"-\"']\nIn [3]: line.split()[0]\nOut[3]: '193.252.243.232'\nIn [4]: line.split()[6]\nOut[4]: '/index.php'\nIn [5]: line.split()[7]\nOut[5]: 'HTTP/1.1\"'\nIn [6]: line.split()[8]\nOut[6]: '200'\n</code></pre> <p>\u6709\u4e86\u7528\u6237IP\u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u83b7\u53d6\u5230\u7f51\u7ad9\u7684PV\u548cUV\uff08PV\u662f\u7f51\u7ad9\u7684\u8bbf\u95ee\u8bf7\u6c42\u6570\uff0cUV\u662f\u7f51\u7ad9\u7684\u72ec\u7acb\u8bbf\u5ba2\u6570\uff09\u3002 \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5047\u8bbeApache\u7684\u8bbf\u95ee\u65e5\u5fd7\u5b58\u653e\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u7684access.log\u6587\u4ef6\u4e2d\u3002\u6211\u4eec\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\uff0c\u9010\u884c\u8fdb\u884c\u904d\u5386\uff0c\u7136\u540e\u4f7f\u7528\u5b57\u7b26\u4e32\u7684split\u51fd\u6570\u62c6\u5206\u6bcf\u4e00\u884c\u65e5\u5fd7\uff0c\u62c6\u5206\u65e5\u5fd7\u4ee5\u540e\u901a\u8fc7\u4e0b\u68070\u83b7\u53d6\u5230\u7528\u6237\u7684IP\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <p><pre><code>#!/usr/bin/python\n#-*- coding: UTF-8 -*-\nfrom __future__ import print_function\nips = []\nwith open('access.log') as f:\nfor line in f:\nips.append(line.split()[0])\nprint(\"PV is {0}\".format(len(ips)))\nprint(\"UV is {0}\".format(len(set(ips))))\n</code></pre> \u6211\u4eec\u5c06\u89e3\u6790\u51fa\u6765\u7684IP\u6dfb\u52a0\u5230\u4e00\u4e2a\u5217\u8868\u4e4b\u4e2d\uff0c\u90a3\u4e48\uff0c\u5217\u8868\u7684\u957f\u5ea6\u5c31\u662f\u7f51\u7ad9\u7684\u8bbf\u95ee\u6570\u3002 \u5f53\u6211\u4eec\u8981\u6c42UV\u65f6\uff0c\u53ea\u9700\u8981\u5bf9\u521a\u624d\u7684\u5217\u8868\u8fdb\u884c\u53bb\u91cd\uff0c\u7136\u540e\u7edf\u8ba1\u53bb\u91cd\u4ee5\u540e\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u5c31\u5f97\u5230\u4e86UV\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u9700\u6c42\uff0c\u5728Python\u4e2d\u53ef\u4ee5\u901a\u8fc7\u5c06\u5217\u8868\u4fdd\u5b58\u5230\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u3002</p> <p>\u96c6\u5408\u5929\u7136\u5c31\u62e5\u6709\u53bb\u91cd\u529f\u80fd\uff0c\u5f88\u9002\u5408\u7528\u6765\u5b9e\u73b0\u8fd9\u91cc\u7684\u9700\u6c42\u3002</p> <p>\u63a5\u4e0b\u6765\u770b\u53e6\u5916\u4e00\u4e2a\u9700\u6c42\uff0c\u627e\u5230\u7f51\u7ad9\u4e2d\u6700\u70ed\u7684\u8d44\u6e90\u3002\u6240\u8c13\u6700\u70ed\u7684\u8d44\u6e90\u5c31\u662f\u8fd9\u4e2a\u7f51\u7ad9\u4e2d\uff0c\u88ab\u8bbf\u95ee\u7684\u6700\u591a\u7684\u8d44\u6e90\u3002\u8fd9\u4e2a\u4fe1\u606f\u5bf9\u4e8e\u5de5\u7a0b\u5e08\u6765\u8bf4\u975e\u5e38\u6709\u7528\u3002\u5de5\u7a0b\u5e08\u77e5\u9053\u54ea\u4e9b\u8d44\u6e90\u662f\u6bd4\u8f83\u70ed\u95e8\u7684\u8d44\u6e90\u4ee5\u540e\uff0c\u53ef\u4ee5\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u7684\u8bbf\u95ee\u8fdb\u884c\u989d\u5916\u7684\u4f18\u5316\uff08\u5982\u7f13\u5b58\u3001\u53cd\u5411\u4ee3\u7801\u3001CDN\u7b49\u6280\u672f\u624b\u6bb5\uff09\u3002</p> <p>\u8981\u7edf\u8ba1\u7f51\u7ad9\u4e2d\u6700\u70ed\u7684\u8d44\u6e90\uff0c\u663e\u7136\u9700\u8981\u5bf9\u8bbf\u95ee\u65e5\u5fd7\u4e2d\u8bf7\u6c42\u7684\u8d44\u6e90\u8fdb\u884c\u7edf\u8ba1\u3002\u5728Python\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u5b57\u5178\u6765\u4fdd\u5b58\u8d44\u6e90\u7684\u70ed\u5ea6\uff0c\u4f8b\u5982\uff0c\u5b57\u5178\u7684\u952e\u662f\u8d44\u6e90\u7684\u540d\u79f0\uff0c\u5b57\u5178\u7684\u503c\u662f\u8bbf\u95ee\u7684\u6b21\u6570\u3002\u9664\u4e86\u4f7f\u7528\u5b57\u5178\u6765\u4fdd\u5b58\u8d44\u6e90\u7684\u70ed\u5ea6\u4ee5\u5916\uff0cPython\u4e2d\u8fd8\u53ef\u4ee5\u4f7f\u7528collections.Counter\u4fdd\u5b58\u8d44\u6e90\u7684\u70ed\u5ea6\u3002</p> <p>Counter\u662fdict\u7684\u5b50\u7c7b\uff0c\u4f7f\u7528\u65b9\u5f0f\u4e0e\u5b57\u5178\u7c7b\u4f3c\u3002\u5bf9\u4e8e\u666e\u901a\u7684\u8ba1\u6570\u529f\u80fd\uff0cCounter\u6bd4\u5b57\u5178\u66f4\u52a0\u597d\u7528\u3002\u5982\u4e0b\u6240\u793a</p> <pre><code>In [1]: from collections import Counter\n\nIn [2]: c = Counter('abcba')\nIn [3]: c\nOut[3]: Counter({'a': 2, 'b': 2, 'c': 1})\nIn [4]: c['a']+=1\nIn [5]: c['d']+=1\nIn [6]: c\nOut[6]: Counter({'a': 3, 'b': 2, 'c': 1, 'd': 1})\nIn [7]: c.most_common?\nSignature: c.most_common(n=None)\nDocstring:\nList the n most common elements and their counts from the most\ncommon to the least.  If n is None, then list all element counts.\n\n&gt;&gt;&gt; Counter('abracadabra').most_common(3)\n[('a', 5), ('b', 2), ('r', 2)]\nFile:      ~/anaconda3/lib/python3.9/collections/__init__.py\nType:      method\n\nIn [8]: c.most_common(2)\nOut[8]: [('a', 3), ('b', 2)]\nIn [9]:\n</code></pre> <p>\u5bf9\u4e8eCounter\u6765\u8bf4\uff0c\u5982\u679c\u4e00\u4e2a\u952e\u4e0d\u5b58\u5728\u4e8e\u8ba1\u6570\u5668\u4e2d\uff0c\u76f4\u63a5\u5bf9\u8fd9\u4e2a\u952e\u8fdb\u884c\u8fd0\u7b97\u4e5f\u4e0d\u4f1a\u62a5\u9519\uff0c\u5982\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u4e2d\u7684\u201cc['d']+=1\u201d\u3002 \u6b64\u5916\uff0cCounter\u4f5c\u4e3a\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u8fd8\u63d0\u4f9b\u4e00\u4e2a\u540d\u4e3amost_common\u7684\u51fd\u6570\uff0c\u7528\u6765\u663e\u793aCounter\u4e2d\u53d6\u503c\u6700\u5927\u7684\u51e0\u4e2a\u5143\u7d20\u3002</p> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u4f7f\u7528Counter\u7edf\u8ba1\u7f51\u7ad9\u4e2d\u6700\u70ed\u95e8\u7684\u5341\u9879\u8d44\u6e90\uff1a</p> <pre><code>#!/usr/bin/python\n#-*- coding: UTF-8 -*-\nfrom __future__ import print_function\nfrom collections import Counter\nc = Counter()\nwith open('access.log') as f:\nfor line in f:\nc[line.split()[6]] += 1\nprint(\"Popular resources : {0}\".format(c.most_common(10)))\n</code></pre> <p>\u63a5\u4e0b\u6765\u770b\u4e00\u4e2a\u4e0e\u7528\u6237\u4f53\u9a8c\u76f8\u5173\u7684\u95ee\u9898\u3002</p> <p>\u7f51\u7ad9\u7684\u7528\u6237\u4f53\u9a8c\u975e\u5e38\u91cd\u8981\uff0c\u5982\u679c\u7528\u6237\u8bbf\u95ee\u7f51\u7ad9\u7ecf\u5e38\u51fa\u9519\uff0c\u4e0d\u4f46\u4f1a\u5bfc\u81f4\u7528\u6237\u53e3\u7891\u53d8\u5dee\u3001\u964d\u4f4e\u8425\u6536\uff0c\u8fd8\u4f1a\u5bfc\u81f4\u7528\u6237\u6d41\u5931\uff0c\u5bf9\u516c\u53f8\u9020\u6210\u8f83\u5927\u7684\u4f24\u5bb3\u3002</p> <p>\u957f\u6b64\u4ee5\u5f80\uff0c\u751a\u81f3\u53ef\u80fd\u5bfc\u81f4\u516c\u53f8\u5012\u95ed\u3002\u56e0\u6b64\uff0c\u7f51\u7ad9\u7684\u51fa\u9519\u6bd4\u4f8b\u662f\u5f88\u91cd\u8981\u7684\u4e00\u4efd\u6570\u636e\u3002\u8981\u7edf\u8ba1\u7528\u6237\u8bbf\u95ee\u51fa\u9519\u7684\u6bd4\u4f8b\uff0c\u53ef\u4ee5\u901a\u8fc7\u7edf\u8ba1\u6bcf\u4e2a\u8bf7\u6c42\u7684HTTP CODE\u5f97\u5230\u3002</p> <p>\u5728HTTP\u534f\u8bae\u4e2d\uff0c\u5982\u679cHTTP CODE\u4e3a2xx\u62163xx\uff0c\u5219\u89c6\u4e3a\u8bbf\u95ee\u6b63\u786e\uff0c\u5982\u679cHTTP CODE\u4e3a4xx\u62165xx\uff0c\u5219\u89c6\u4e3a\u8bbf\u95ee\u51fa\u9519\u3002</p> <p>\u56e0\u6b64\uff0c\u7edf\u8ba1\u7f51\u7ad9\u7684\u51fa\u9519\u6bd4\u4f8b\uff0c\u5c31\u662f\u7edf\u8ba1\u51fa\u9519\u7684\u8bf7\u6c42\u5360\u603b\u8bf7\u6c42\u6570\u7684\u6bd4\u4f8b\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#!/usr/bin/python\n#-*-coding: UTF-8 -*-\nfrom __future__ import print_function\nd = {}\nwith open('access.log') as f:\nfor line in f:\nkey = line.split()[8]\nd.setdefault(key, 0)\nd[key] += 1\nsum_requests= 0\nerror_requests= 0\nfor key, val in d.iteritems():\nif int(key) &gt;= 400:\nerror_requests+= val\nsum_requests+= val\nprint('error rate: {0:.2f}%'.format(error_requests * 100.0 / sum_requests))\n</code></pre> <p>\u6211\u4eec\u5df2\u7ecf\u4f7f\u7528Python\u5206\u6790\u4e86\u7f51\u7ad9\u7684UV\u3001PV\u3001\u6700\u70ed\u95e8\u7684\u8d44\u6e90\u548c\u51fa\u9519\u7684\u6bd4\u4f8b\u3002 \u6b64\u5916\uff0c\u901a\u8fc7Apache\u7684\u8bbf\u95ee\u65e5\u5fd7\uff0c\u8fd8\u53ef\u4ee5\u7edf\u8ba1\u7f51\u7ad9\u6bcf\u5c0f\u65f6\u7684\u6d41\u91cf\u5e76\u4ee5\u6b64\u627e\u5230\u7f51\u7ad9\u7684\u8bf7\u6c42\u9ad8\u5cf0\uff0c\u4ee5\u53ca\u5206\u6790\u6d4f\u89c8\u5668\u5b57\u6bb5\u7edf\u8ba1\u7528\u6237\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u7c7b\u578b\u7b49\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#115-\u5b57\u7b26\u4e32\u683c\u5f0f\u5316","title":"1.1.5 \u5b57\u7b26\u4e32\u683c\u5f0f\u5316","text":"<p>\u5728Python\u4e2d\uff0c\u5b58\u5728\u4e24\u79cd\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7684\u65b9\u6cd5\uff0c\u5373%\u8868\u8fbe\u5f0f\u548cformat\u51fd\u6570\u3002 %\u8868\u8fbe\u5f0f\u4ecePython\u8bde\u751f\u4e4b\u65e5\u5c31\u5f00\u59cb\u5b58\u5728\u4e86\uff0c\u662f\u57fa\u4e8eC\u8bed\u8a00\u7684printf\u6a21\u578b\uff0c\u76ee\u524d\u8fd8\u5e7f\u6cdb\u4f7f\u7528\u3002 format\u51fd\u6570\u662fPython2.6\u548cPython3.0\u65b0\u589e\u52a0\u7684\u6280\u672f\uff0c\u662fPython\u72ec\u6709\u7684\u65b9\u6cd5\uff0c\u5e76\u4e14\u548c\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8868\u8fbe\u5f0f\u7684\u529f\u80fd\u6709\u4e0d\u5c11\u7684\u91cd\u53e0\u3002</p> <p>\u867d\u7136%\u8868\u8fbe\u5f0f\u76ee\u524d\u8fd8\u5e7f\u6cdb\u4f7f\u7528\uff0c\u4f46\u662f\uff0cformat\u51fd\u6570\u624d\u662f\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u7684\u672a\u6765\uff0c%\u8868\u8fbe\u5f0f\u5728Python\u672a\u6765\u7684\u7248\u672c\u4e2d\u53ef\u80fd\u4f1a\u88ab\u5f03\u7528\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#1format\u51fd\u6570","title":"1.format\u51fd\u6570","text":"<p>\u6211\u4eec\u901a\u8fc7\u4e0b\u9762\u7684\u4f8b\u5b50\u6765\u5b66\u4e60format\u51fd\u6570\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p> <p>\u901a\u8fc7{}\u6765\u8868\u793a\u4e00\u4e2a\u5360\u4f4d\u7b26\uff0cPython\u4f1a\u81ea\u52a8\u5c06format\u51fd\u6570\u7684\u53c2\u6570\u4f9d\u6b21\u4f20\u9012\u7ed9{}\u5360\u4f4d\u7b26\u3002</p> <pre><code>In [1]: \"{} is better than {}. {} is better than {}.\".format('Beautiful', 'ugly', 'Explicit', 'implicit')\nOut[1]: 'Beautiful is better than ugly. Explicit is better than implicit.'\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4e0b\u6807\u7684\u65b9\u5f0f\u6765\u8bbf\u95eeformat\u51fd\u6570\u7684\u53c2\u6570\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [2]: \"{0} is better than {1}. {2} is better than {3}.\".format('Beautiful', 'ugly', 'Explicit', 'implicit')\nOut[2]: 'Beautiful is better than ugly. Explicit is better than implicit.'\n</code></pre> <p>\u901a\u8fc7\u4e0b\u6807\u8bbf\u95ee\u53c2\u6570\u4ee5\u540e\uff0c\u4e00\u4e2a\u53c2\u6570\u53ef\u4ee5\u51fa\u73b0\u591a\u6b21\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>In [3]: \"Beautiful is {0} than ugly. Explicit is {0} than implicit.\".format ('better')\nOut[3]: 'Beautiful is better than ugly. Explicit is better than implicit.'\n</code></pre></p> <p>\u5728\u53c2\u6570\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7\u5360\u4f4d\u7b26\u6216\u4e0b\u6807\u7684\u5f62\u5f0f\u8bbf\u95eeformat\u51fd\u6570\u7684\u53c2\u6570\u5e76\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\u3002\u5982\u679c\u53c2\u6570\u8f83\u591a\u5c31\u4e0d\u592a\u9002\u5408\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528\u89e3\u91ca\u6027\u66f4\u5f3a\u7684\u5173\u952e\u5b57\u53c2\u6570\u5f62\u5f0f\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [4]: d = dict(good1='Beautiful', bad1='ugly', good2='Explicit', bad2='implicit')\nIn [5]: \"{good1} is better than {bad1}. {good2} is better than {bad2}.\".format(**d)\nOut[5]: 'Beautiful is better than ugly. Explicit is better than implicit.'\n</code></pre> <p>format\u51fd\u6570\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [6]: from collections import namedtuple\n   ...: In [7]: Person = namedtuple('Person', 'name age sex')\nIn [8]: xm =  Person('Xiaoming', 20, 'male')\n...: In [9]: \"{p.name} {p.age} old this year\".format(p=xm)\nOut[9]: 'Xiaoming 20 old this year'\n</code></pre> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u5206\u522b\u662f\u5bf9format\u51fd\u6570\u7684\u7cbe\u5ea6\u3001\u7b26\u53f7\u3001\u5bbd\u5ea6\u3001\u5bf9\u9f50\u65b9\u5f0f\u3001\u5b57\u7b26\u586b\u5145\u3001\u9017\u53f7\u5206\u9694\u7b49\u683c\u5f0f\u8fdb\u884c\u6d4b\u8bd5\uff1a</p> <pre><code>In [10]:  \"{:.2f}\".format(3.1415926)\nOut[10]: '3.14'\nIn [11]: \"{:+.2f}\".format(3.1415926)\nOut[11]: '+3.14'\nIn [12]: \"{:10.2f}\".format(3.1415926)\nOut[12]: '      3.14'\nIn [13]: \"{:^10.2f}\".format(3.1415926)\nOut[13]: '   3.14   '\nIn [14]: \"{:_^10.2f}\".format(3.1415926)\nOut[14]: '___3.14___'\nIn [15]: \"{:,}\".format(1234567)\nOut[15]: '1,234,567'\nIn [16]: \"{:_^+20,.2f}\".format(1234.5678)\nOut[16]: '_____+1,234.57______'\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#2\u63d2\u503c\u683c\u5f0f\u5b57\u7b26\u4e32","title":"2.\u63d2\u503c\u683c\u5f0f\u5b57\u7b26\u4e32","text":"<p>Python 3.6\u6dfb\u52a0\u4e86\u4e00\u79cd\u65b0\u7684\u7279\u6027\uff0c\u53eb\u4f5c\u63d2\u503c\u683c\u5f0f\u5b57\u7b26\u4e32\uff08interpolated formatstring\uff0c\u7b80\u79f0f-string\uff09\uff0c\u53ef\u4ee5\u89e3\u51b3\u4e0a\u9762\u63d0\u5230\u7684\u6240\u6709\u95ee\u9898\u3002\u65b0\u8bed\u6cd5\u7279\u6027\u8981\u6c42\u5728\u683c\u5f0f\u5b57\u7b26\u4e32\u7684\u524d\u9762\u52a0\u5b57\u6bcdf\u4f5c\u4e3a\u524d\u7f00\uff0c\u8fd9\u8ddf\u5b57\u6bcdb\u4e0e\u5b57\u6bcdr\u7684\u7528\u6cd5\u7c7b\u4f3c\uff0c\u4e5f\u5c31\u662f\u5206\u522b\u8868\u793a\u5b57\u8282\u5f62\u5f0f\u7684\u5b57\u7b26\u4e32\u4e0e\u539f\u59cb\u7684\uff08\u6216\u8005\u8bf4\u672a\u7ecf\u8f6c\u4e49\u7684\uff09\u5b57\u7b26\u4e32\u7684\u524d\u7f00\u3002 <pre><code>key = \"my_var\"\nvalue = 1.234\nformatted = f'{key} = {value}'\nprint(formatted)\n</code></pre></p> <pre><code>pantry = [\n(\"avocados\", 1.25),\n(\"bananas\", 2.5),\n(\"cherries\", 15)\n]\n#  %\u7684\u65b9\u5f0f\u683c\u5f0f\u5316\nfor i, (item, count) in enumerate(pantry):\nprint(\"#%d: %-10s = %d\" % (\ni + 1,\nitem.title(),\nround(count)))\nprint(\"*\" * 100)\n# format\u51fd\u6570\u683c\u5f0f\u5316\nfor i, (item, count) in enumerate(pantry):\nprint(\"#{}: {:&lt;10s} ={}\".format(\ni + 1,\nitem.title(),\nround(count)))\nprint(\"*\" * 100)\n# \u63d2\u503c\u683c\u5f0f\u5b57\u7b26\u4e32\nfor i, (item, count) in enumerate(pantry):\nprint(f\"#{i + 1}: {item.title():&lt;10s} ={round(count)}\")\n#\u6216\u8005\u5199\u591a\u884c\nfor i, (item, count) in enumerate(pantry):\nprint(f\"#{i + 1}: \"\nf\"{item.title():&lt;10s} =\"\nf\"{round(count)}\")\n</code></pre> <p>\u5728%\u65b9\u6cd5\u4e2d%s\u53ea\u80fd\u66ff\u4ee3\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u800c\u5728format\u4e2d\u4e0d\u9700\u8981\u7406\u4f1a\u6570\u636e\u7c7b\u578b\uff1b</p> <pre><code># 1\u3001\u6309\u7167\u9ed8\u8ba4\u987a\u5e8f\uff0c\u4e0d\u6307\u5b9a\u4f4d\u7f6e\nprint(\"{} {}\".format(\"hello\",\"world\"))\n&gt;&gt;&gt; hello world\n\n# 2\u3001\u8bbe\u7f6e\u6307\u5b9a\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u591a\u6b21\u4f7f\u7528\nprint(\"{0} {1} {0}\".format(\"hello\",\"or\"))\n&gt;&gt;&gt; hello or hello\n\n# 3\u3001\u4f7f\u7528\u5217\u8868\u683c\u5f0f\u5316\nperson = {\"name\":\"opcai\",\"age\":20}\nprint(\"My name is {name} . I am {age} years old .\".format(**person))\n&gt;&gt;&gt; My name is opcai . I am 20 years old .\n\n# 4\u3001\u901a\u8fc7\u5217\u8868\u683c\u5f0f\u5316\nstu = [\"opcai\",\"linux\",\"MySQL\",\"Python\"]\nprint(\"My name is {0[0]} , I love {0[1]} !\".format(stu))\n&gt;&gt;&gt; My name is opcai , I love linux !\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#12-\u6b63\u5219\u8868\u8fbe\u5f0f","title":"1.2 \u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u9700\u8981\u540c\u65f6\u4f7f\u7528\u201c\uff1a\u201d\u548c\u201c.\u201d\u8fdb\u884csplit\uff0c\u8fd9\u5bf9\u4e8ePython\u5185\u7f6e\u7684\u5b57\u7b26\u4e32\u51fd\u6570\u6765\u8bf4\uff0c\u5c31\u663e\u5f97\u6bd4\u8f83\u68d8\u624b\u4e86\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528\u66f4\u5177\u6709\u8868\u8fbe\u80fd\u529b\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>In [1]: data = \"Last login: Thu Mar  2 10:04:52 2017 from 114.113.197.131\"\nIn [2]: import re; re.split('[:.]\\s*', data)\nOut[2]: ['Last login', 'Thu Mar  2 10', '04', '52 2017 from 114', '113', '197', '131']\n</code></pre> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4e2a\u5904\u7406\u6587\u672c\u7684\u5f3a\u5927\u5de5\u5177\uff0c\u5728\u6587\u672c\u5904\u7406\u7a0b\u5e8f\u4e2d\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5982Office world\u3001OpenOffice\u3001Vim\u548cEmacs\u3002</p> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u5728Linux\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528\u66f4\u52a0\u5e7f\u6cdb\uff0c\u5927\u90e8\u5206\u6587\u672c\u5904\u7406\u5de5\u5177\u90fd\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5982grep\uff0cawk\uff0csed\u7b49\u3002\u6b63\u56e0\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f\u5f3a\u5927\u7684\u8868\u8fbe\u80fd\u529b\uff0c\u4e0d\u4ec5\u8f6f\u4ef6\u5de5\u7a0b\u5e08\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u90e8\u5206\u7535\u8111\u7231\u597d\u8005\u4e5f\u5f00\u59cb\u5b66\u4e60\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5e0c\u671b\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u8282\u7ea6\u6587\u672c\u5904\u7406\u7684\u65f6\u95f4\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#121-\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u57fa\u672c\u8bed\u6cd5","title":"1.2.1 \u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u57fa\u672c\u8bed\u6cd5","text":"\u6b63\u5219\u8868\u8fbe\u5f0f\u6a21\u5f0f \u63cf\u8ff0 \u793a\u4f8b \\d \u5339\u914d\u4efb\u610f\u4e00\u4e2a\u6570\u5b57\u5b57\u7b26 <code>\\d</code> \u53ef\u4ee5\u5339\u914d\u5230\u5b57\u7b26\u4e32\u4e2d\u7684\u6570\u5b57\u5b57\u7b26\uff0c\u5982 \"123\" \\w \u5339\u914d\u4efb\u610f\u4e00\u4e2a\u5b57\u6bcd\u6570\u5b57\u5b57\u7b26 <code>\\w</code> \u53ef\u4ee5\u5339\u914d\u5230\u5b57\u7b26\u4e32\u4e2d\u7684\u5b57\u6bcd\u548c\u6570\u5b57\u5b57\u7b26\uff0c\u5982 \"a1b2c3\" \\s \u5339\u914d\u4efb\u610f\u4e00\u4e2a\u7a7a\u767d\u5b57\u7b26 <code>\\s</code> \u53ef\u4ee5\u5339\u914d\u5230\u5b57\u7b26\u4e32\u4e2d\u7684\u7a7a\u683c\u3001\u5236\u8868\u7b26\u7b49\u7a7a\u767d\u5b57\u7b26 ^ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u4f4d\u7f6e <code>^abc</code> \u53ef\u4ee5\u5339\u914d\u4ee5 \"abc\" \u5f00\u59cb\u7684\u5b57\u7b26\u4e32 $ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u4f4d\u7f6e <code>xyz$</code> \u53ef\u4ee5\u5339\u914d\u4ee5 \"xyz\" \u7ed3\u675f\u7684\u5b57\u7b26\u4e32 [...] \u5b57\u7b26\u96c6\uff0c\u5339\u914d\u65b9\u62ec\u53f7\u5185\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26 <code>[abc]</code> \u53ef\u4ee5\u5339\u914d\u5b57\u7b26\u4e32\u4e2d\u7684 \"a\"\u3001\"b\" \u6216 \"c\" [^...] \u5426\u5b9a\u5b57\u7b26\u96c6\uff0c\u5339\u914d\u9664\u65b9\u62ec\u53f7\u5185\u5b57\u7b26\u4e4b\u5916\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26 <code>[^abc]</code> \u53ef\u4ee5\u5339\u914d\u9664\u4e86 \"a\"\u3001\"b\" \u548c \"c\" \u4ee5\u5916\u7684\u5b57\u7b26 * \u5339\u914d\u524d\u9762\u7684\u5143\u7d20\u96f6\u6b21\u6216\u591a\u6b21 <code>ab*c</code> \u53ef\u4ee5\u5339\u914d \"ac\"\u3001\"abc\"\u3001\"abbc\" \u7b49 + \u5339\u914d\u524d\u9762\u7684\u5143\u7d20\u4e00\u6b21\u6216\u591a\u6b21 <code>ab+c</code> \u53ef\u4ee5\u5339\u914d \"abc\"\u3001\"abbc\"\u3001\"abbbc\" \u7b49 ? \u5339\u914d\u524d\u9762\u7684\u5143\u7d20\u96f6\u6b21\u6216\u4e00\u6b21 <code>ab?c</code> \u53ef\u4ee5\u5339\u914d \"ac\" \u6216 \"abc\" {n} \u5339\u914d\u524d\u9762\u7684\u5143\u7d20\u6070\u597d n \u6b21 <code>a{3}</code> \u53ef\u4ee5\u5339\u914d \"aaa\" {n,} \u5339\u914d\u524d\u9762\u7684\u5143\u7d20\u81f3\u5c11 n \u6b21 <code>a{2,}</code> \u53ef\u4ee5\u5339\u914d \"aa\"\u3001\"aaa\"\u3001\"aaaa\" \u7b49 {n,m} \u5339\u914d\u524d\u9762\u7684\u5143\u7d20\u81f3\u5c11 n \u6b21\u3001\u6700\u591a m \u6b21 <code>a{2,4}</code> \u53ef\u4ee5\u5339\u914d \"aa\"\u3001\"aaa\" \u6216 \"aaaa\" (\u2026) \u5206\u7ec4\uff0c\u6355\u83b7\u5339\u914d\u7684\u6587\u672c <code>(ab)+</code> \u53ef\u4ee5\u5339\u914d \"ab\"\u3001\"abab\"\u3001\"ababab\" \u7b49 | \u903b\u8f91\u6216\uff0c\u5339\u914d\u4e24\u4fa7\u4efb\u610f\u4e00\u4e2a\u8868\u8fbe\u5f0f <code>a\\|b</code> \u53ef\u4ee5\u5339\u914d \"a\" \u6216 \"b\" <code>\\.</code> \u8f6c\u4e49\u5b57\u7b26\uff0c\u5339\u914d\u70b9\u53f7\u5b57\u7b26 <code>\\.</code> \u53ef\u4ee5\u5339\u914d\u5b57\u7b26\u4e32\u4e2d\u7684 \".\" <code>\\d{4}</code> \u9884\u5b9a\u4e49\u5339\u914d\u5b57\u7b26\u96c6\uff0c\u5339\u914d\u56db\u4f4d\u6570\u5b57 <code>\\d{4}</code> \u53ef\u4ee5\u5339\u914d\u5b57\u7b26\u4e32\u4e2d\u7684\u56db\u4f4d\u6570\u5b57 <code>.*</code> \u91cd\u590d\u5339\u914d\uff0c\u5339\u914d\u4efb\u610f\u5b57\u7b26\u96f6\u6b21\u6216\u591a\u6b21 <code>.*</code> \u53ef\u4ee5\u5339\u914d\u4efb\u610f\u957f\u5ea6\u7684\u5b57\u7b26\u4e32 <code>(?i)abc</code> \u5ffd\u7565\u5927\u5c0f\u5199\u5339\u914d\uff0c\u5339\u914d \"abc\" \u4e0d\u533a\u5206\u5927\u5c0f\u5199 <code>(?i)abc</code> \u53ef\u4ee5\u5339\u914d \"abc\"\u3001\"AbC\"\u3001\"ABC\" \u7b49 <code>(?m)^abc$</code> \u591a\u884c\u6a21\u5f0f\u5339\u914d\uff0c\u5339\u914d\u4ee5 \"abc\" \u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32 <code>(?m)^abc$</code> \u53ef\u4ee5\u5339\u914d \"abc\" \u4ee5\u53ca\u591a\u884c\u6587\u672c\u4e2d\u7684\u6bcf\u4e00\u884c\u90fd\u662f \"abc\" <code>.*?</code> \u975e\u8d2a\u5a6a\u6a21\u5f0f\u5339\u914d\uff0c\u5339\u914d\u5c3d\u91cf\u5c11\u7684\u5b57\u7b26 <code>.*?</code> \u53ef\u4ee5\u5339\u914d\u4efb\u610f\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\uff0c\u4f46\u5c3d\u91cf\u5339\u914d\u6700\u5c11\u7684\u5b57\u7b26 <p>\u5e38\u7528\u7684\u7279\u6b8a\u5b57\u7b26\u3002</p> \u7279\u6b8a\u5b57\u7b26 \u63cf\u8ff0 /d \u5339\u914d\u4efb\u4f55\u5341\u8fdb\u5236\u6570\u5b57\uff0c\u4e0e\u30100-9\u3011\u4e00\u81f4 /D \u5339\u914d\u4efb\u610f\u6570\u5b57 /w \u5339\u914d\u4efb\u4f55\u5b57\u6bcd\u6570\u5b57\u4e0b\u5212\u7ebf\u4ee5\u53caunicode\u5b57\u7b26\u96c6 /W \u5339\u914d\u4efb\u4f55\u975e\u5b57\u6bcd\u6570\u5b57\u4ee5\u53ca\u4e0b\u5212\u7ebf /s \u5339\u914d\u4efb\u4f55\u7a7a\u683c\u5b57\u7b26\uff0c\u4e0e\u3010\\n\\t\\r\\v\\f\u3011\u76f8\u540c /S \u5339\u914d\u4efb\u610f\u5b57\u7b26 \\A \u5339\u914d\u5b57\u7b26\u4e32\u7684\u8d77\u59cb \\Z \u5339\u914d\u5b57\u7b26\u4e32\u7684\u7ed3\u675f . \u5339\u914d\u4efb\u4f55\u5b57\u7b26\u4e32 <p>\u4ee3\u7801\u6f14\u793a\uff1a</p> <pre><code>import re\n# \u51c6\u5907\u9700\u8981\u88ab\u5339\u914d\u7684\u5b57\u7b26\u4e32\ndata = 'hello jie you are 22 age old'\n# \u5339\u914d\u4efb\u4f55\u5341\u8fdb\u5236\u6570\u5b57\uff0c\u4e0e\u30100-9\u3011\u4e00\u81f4\nprint(re.findall('\\d', data))\n# \u5339\u914d\u4efb\u4f55\u7a7a\u683c\u5b57\u7b26\nprint(re.findall('\\s', data))\n# \u5339\u914d\u4efb\u4f55\u5b57\u6bcd\u6570\u5b57\u4e0b\u5212\u7ebf\u4ee5\u53caunicode\u5b57\u7b26\u96c6\nprint(re.findall('\\w', data))\n# \u5339\u914d\u5b57\u7b26\u4e32\u7684\u8d77\u59cb\nprint(re.findall('\\Ahello', data))\n</code></pre> <p>\u91cf\u8bcd\u7b26\u53f7\u3002</p> \u7b26\u53f7 \u63cf\u8ff0 re1|re2 \u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0fre1 \u6216\u8005  re2 ^ \u5339\u914d\u5b57\u7b26\u4e32\u8d77\u59cb\u90e8\u5206 $ \u5339\u914d\u5b57\u7b26\u4e32\u7ec8\u6b62\u90e8\u5206 * \u5339\u914d0\u6b21\u6216\u8005\u591a\u6b21\u524d\u9762\u51fa\u73b0\u7684\u6b63\u5219\u8868\u8fbe\u5f0f + \u5339\u914d\u4e00\u6b21\u6216\u8005\u591a\u6b21\u524d\u9762\u51fa\u73b0\u7684\u6b63\u5219\u8868\u8fbe\u5f0f {N} \u5339\u914dN\u6b21\u524d\u9762\u51fa\u73b0\u7684\u6b63\u5219\u8868\u8fbe\u5f0f {M,N} \u7ed9\u51fa\u5339\u914d\u5230\u7684\u6570\u636e\u8303\u56f4 [...] \u5339\u914d\u6765\u81ea\u5b57\u7b26\u96c6\u7684\u4efb\u610f\u5355\u4e00\u5b57\u7b26 [..x-y..] \u5339\u914dx~y\u8303\u56f4\u4e2d\u7684\u4efb\u610f\u5355\u4e00\u5b57\u7b26 [^...] \u4e0d\u5339\u914d\u6b64\u5b57\u7b26\u96c6\u4e2d\u51fa\u73b0\u7684\u4efb\u4f55\u4e00\u4e2a\u5b57\u7b26\uff0c \u5305\u62ec\u67d0\u4e00\u8303\u56f4\u7684\u5b57\u7b26\uff08\u5982\u679c\u5728\u6b64\u5b57\u7b26\u96c6\u4e2d\u51fa\u73b0\uff09 \\ \u5c06\u7279\u6b8a\u5b57\u7b26\u65e0\u6548\u5316 <p>\u4ee3\u7801\u6f14\u793a</p> <pre><code> import re\n# \u51c6\u5907\u9700\u8981\u88ab\u5339\u914d\u7684\u5b57\u7b26\u4e32\ndata = 'hello jie you are 22 age old'\n# \u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f re1 \u6216\u8005  re2 \u6ce8\u610f \uff1a \u5339\u914d\u7684\u6570\u636e\u53ea\u6309\u5b57\u7b26\u4e32\u6570\u636e\u8fd4\u56de\uff0c\u800c\u4e0d\u662f\u6309\u7167\u5339\u914d\u89c4\u5219\u8fd4\u56de\nprint(re.findall('hello|jie|21', data))\n# \u5339\u914d\u5b57\u7b26\u4e32\u8d77\u59cb\u90e8\u5206\nprint(re.findall('^hello', data))\n# \u5339\u914d\u5b57\u7b26\u4e32\u7ec8\u6b62\u90e8\u5206\nprint(re.findall('old$', data))\n# W* \u5339\u914d0\u6b21\u6216\u591a\u6b21\u6570\u5b57\u6216\u5b57\u6bcd\nprint(re.findall('\\w*', data))\n# W+ \u5339\u914d\u4e00\u6b21\u6216\u8005\u591a\u6b21\u6570\u5b57\u6216\u5b57\u6bcd \u7a7a\u5c5e\u4e8e0\u6b21\u8303\u56f4\u4e0d\u4f1a\u914d\u5339\u914d\u51fa\u6765\nprint(re.findall('\\w+', data))\n# \u5bf9\u4e8e\u5339\u914d\u5230\u7684\u6570\u636e\u53ea\u83b7\u53d63\u4e2a\nprint(re.findall('\\w{3}', data))\n# \u5339\u914da~z\u8303\u56f4\u4e2d\u7684\u4efb\u610f\u5355\u4e00\u5b57\u7b26 [a-zA-Z0-9]\u7b49\u540c\u4e8e\\w\nprint(re.findall('[a-z]{3}', data))\n# \u5339\u914d1\u6216\u80055\u6b21 {N,M}\u4e2d\u95f4\u7684\u9017\u53f7\u5de6\u53f3\u4e0d\u8981\u51fa\u73b0\u7a7a\u683c\nprint(re.findall('\\w{1,5}', data))\n# \u4e0d\u5339\u914d\u6b64\u5b57\u7b26\u96c6\u4e2d\u51fa\u73b0\u7684\u4efb\u4f55\u4e00\u4e2a\u5b57\u7b26 \u5b57\u7b26\u96c6\u4e2d\u7684^\u53f7\u4e0d\u4ee3\u8868\u5f00\u59cb\u7684\u610f\u601d\u800c\u662f\u8fc7\u6ee4\u6389\nprint(re.findall('[^jie]', data))\n</code></pre> <p>\u7ec4</p> \u7b26\u53f7 \u63cf\u8ff0 \uff08\uff09 \u5728\u5339\u914d\u89c4\u5219\u4e2d\u83b7\u53d6\u6307\u5b9a\u7684\u6570\u636e <p>\u4ee3\u7801\u6f14\u793a\uff1a</p> <pre><code>In [1]: import re\n\nIn [2]: data = 'hello jie you are 22 age old'\nIn [3]: result = re.search('hello (.*)jie (.*)', data)\nIn [4]: print(result.groups())\n('', 'you are 22 age old')\nIn [5]: print(\"1:\" + result.group(1))\n1:\n\nIn [6]: print(\"2:\" + result.group(2))\n2:you are 22 age old\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#122--\u5229\u7528re\u5e93\u5904\u7406\u6b63\u5219\u8868\u8fbe\u5f0f","title":"1.2.2  \u5229\u7528re\u5e93\u5904\u7406\u6b63\u5219\u8868\u8fbe\u5f0f","text":"\u65b9\u6cd5 \u63cf\u8ff0 \u8fd4\u56de\u503c compile(pattern[, flags]) \u6839\u636e\u5305\u542b\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5b57\u7b26\u4e32\u521b\u5efa\u6a21\u5f0f\u5bf9\u8c61 re\u5bf9\u8c61 search(pattern, string[, flags]) \u5728\u5b57\u7b26\u4e32\u4e2d\u67e5\u627e \u7b2c\u4e00\u4e2a\u5339\u914d\u5230\u7684\u5bf9\u8c61\u6216\u8005None match(pattern, string[, flags]) \u5728\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u5904\u5339\u914d\u6a21\u5f0f \u5728\u5b57\u7b26\u4e32\u5f00\u5934\u5339\u914d\u5230\u7684\u5bf9\u8c61\u6216\u8005None split(pattern, string[, maxsplit=0,flags]) \u6839\u636e\u6a21\u5f0f\u7684\u5339\u914d\u9879\u6765\u5206\u5272\u5b57\u7b26\u4e32 \u5206\u5272\u540e\u7684\u5b57\u7b26\u4e32\u5217\u8868 findall(pattern, string,flags) \u5217\u51fa\u5b57\u7b26\u4e32\u4e2d\u6a21\u5f0f\u7684\u6240\u6709\u5339\u914d\u9879 \u6240\u6709\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\u5217\u8868 sub(pat,repl, string[,count=0,flags]) \u5c06\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u7684pat\u7684\u5339\u914d\u9879\u7528repl\u66ff\u6362 \u5b8c\u6210\u66ff\u6362\u540e\u7684\u65b0\u5b57\u7b26\u4e32 finditer(pattern, string,flags) \u5c06\u6240\u6709\u5339\u914d\u5230\u7684\u9879\u751f\u6210\u4e00\u4e2a\u8fed\u4ee3\u5668 \u6240\u6709\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\u7ec4\u5408\u6210\u7684\u8fed\u4ee3\u5668 subn(pat,repl, string[,count=0,flags]) \u5728\u66ff\u6362\u5b57\u7b26\u4e32\u540e\uff0c\u540c\u65f6\u62a5\u544a\u66ff\u6362\u7684\u6b21\u6570 \u5b8c\u6210\u66ff\u6362\u540e\u7684\u65b0\u5b57\u7b26\u4e32\u53ca\u66ff\u6362\u6b21\u6570 escape\uff08string \u5c06\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u7279\u6b8a\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\u8f6c\u4e49 \u8f6c\u4e49\u540e\u7684\u5b57\u7b26\u4e32 purge(pattern) \u6e05\u7a7a\u6b63\u5219\u8868\u8fbe\u5f0f template(pattern[,flags]) \u7f16\u8bd1\u4e00\u4e2a\u5339\u914d\u6a21\u677f \u6a21\u5f0f\u5bf9\u8c61 fullmatch(pattern, string[, flags]) match\u65b9\u6cd5\u7684\u5168\u5b57\u7b26\u4e32\u5339\u914d\u7248\u672c \u7c7b\u4f3cmatch\u7684\u8fd4\u56de\u503c <p>re\u7684\u989d\u5916\u5339\u914d\u8981\u6c42</p> <p>re\u6a21\u5757\u7684\u989d\u5916\u5339\u914d\u8981\u6c42,\u5176\u5b9e\u8fd9\u4e9b\u5339\u914d\u8981\u6c42\u90fd\u662f\u4e00\u4e9b\u5c5e\u6027\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u4f7f\u7528\u7387\u4e0d\u9ad8\uff0c\u4e86\u89e3\u5373\u53ef\u3002</p> \u5c5e\u6027 \u63cf\u8ff0 re.I \u3001re.IGNORECASE \u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u5339\u914d re.L\u3001re.LOCALE \u6839\u636e\u6240\u4f7f\u7528\u7684\u672c\u5730\u8bed\u8a00\u73af\u5883\u901a\u8fc7\\w\u3001\\W\u3001\\s\u3001\\S\u5b9e\u73b0\u5339\u914d re.M\u3001re.MULTILINE ^\u548c$\u5206\u522b\u5339\u914d\u76ee\u6807\u5b57\u7b26\u4e32\u4e2d\u884c\u7684\u8d77\u59cb\u548c\u7ed3\u5c3e\uff0c\u800c\u4e0d\u662f\u4e25\u683c\u5339\u914d\u6574\u4e2a\u5b57\u7b26\u4e32\u672c\u8eab\u7684\u8d77\u59cb\u548c\u7ed3\u5c3e\u3002 re.S\u3001rer.DOTALL \".\"(\u70b9\u53f7)\u901a\u5e38\u5339\u914d\u9664\u4e86\\n\uff08\u6362\u884c\u7b26\uff09\u4e4b\u5916\u7684\u6240\u6709\u5355\u4e2a\u5b57\u7b26\uff1b\u8be5\u6807\u8bb0\u8868\u793a\".\"\uff08\u70b9\u53f7\uff09\u80fd\u591f\u5339\u914d\u5168\u90e8\u5b57\u7b26 re.X\u3001re.VERBOSE \u5ffd\u7565\u89c4\u5219\u8868\u8fbe\u5f0f\u4e2d\u7684\u7a7a\u767d\u548c\u6ce8\u91ca <p>\u4f8b\u5982\uff0c\u6700\u5e38\u7528\u7684\u662fre\u6a21\u5757\u4e0b\u7684findall\u51fd\u6570\uff0c\u7528\u6765\u8f93\u51fa\u6240\u6709\u7b26\u5408\u6a21\u5f0f\u5339\u914d\u7684\u5b50\u4e32\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [1]: import re\n\nIn [2]: data = \"What is the difference between python 2.7.13 and Python 3.6.0 ?\"\nIn [3]: re.findall('python [0-9]\\.[0-9]\\.[0-9]', data)\nOut[3]: ['python 2.7.1']\n</code></pre> <p>re\u6a21\u5757\u5728\u6a21\u5f0f\u5339\u914d\u7684\u65f6\u5019\u5ffd\u7565\u5b57\u7b26\u7684\u5927\u5c0f\u5199\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f20\u9012\u6807\u5fd7\u7684\u5f62\u5f0f\u544a\u8bc9re\u6a21\u5757\u5ffd\u7565\u5927\u5c0f\u5199\u8fd9\u4e2a\u9700\u6c42\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [4]: re.findall('python [0-9]\\.[0-9]\\.[0-9]', data, flags=re.IGNORECASE)\nOut[4]: ['python 2.7.1', 'Python 3.6.0']\n</code></pre> <p>Python\u4e2d\u6709\u4e24\u79cd\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u65b9\u5f0f\u3002</p> <ol> <li> <p>\u7b2c\u4e00\u79cd\u662f\u76f4\u63a5\u4f7f\u7528re\u6a21\u5757\u4e2d\u7684\u51fd\u6570\uff0c\u6b63\u5982\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\u6f14\u793a\u7684\u4e00\u6837\u3002</p> </li> <li> <p>\u7b2c\u4e8c\u79cd\u662f\u521b\u5efa\u4e00\u4e2a\u7279\u5b9a\u6a21\u5f0f\u7f16\u8bd1\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5bf9\u8c61\uff0c\u7136\u540e\u4f7f\u7528\u8fd9\u4e2a\u5bf9\u8c61\u4e2d\u7684\u65b9\u6cd5\u3002</p> </li> </ol> <p>\u7f16\u8bd1\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a <pre><code>In [1]: import re\n\nIn [2]: data = \"What is the difference between python 2.7.13 and Python 3.6.0 ?\"\nIn [3]: re_obj = re.compile('python [0-9]\\.[0-9]\\.[0-9]', flags=re.IGNORECASE)\nIn [4]: re_obj.findall(data)\nOut[4]: ['python 2.7.1', 'Python 3.6.0']\n</code></pre></p> <p>\u4e24\u79cd\u65b9\u5f0f\u8fdb\u884c\u6bd4\u8f83</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u4f7f\u7528Linux\u4e0b\u7684seq\u547d\u4ee4\u4ea7\u751f1000\u4e07\u4e2a\u6574\u6570\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002 \u8be5\u6570\u636e\u6587\u4ef6\u5927\u7ea6\u670976M\uff0c\u5e76\u4e0d\u7b97\u5f88\u5927\uff0c\u4f46\u662f\u8db3\u4ee5\u7528\u6765\u6bd4\u8f83\u7f16\u8bd1\u7248\u672c\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u548c\u975e\u7f16\u8bd1\u7248\u672c\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4e4b\u95f4\u7684\u6027\u80fd\u3002 \u63a5\u4e0b\u6765\uff0c\u5bf9\u6587\u4ef6\u7684\u6bcf\u4e00\u884c\u5e94\u7528\u6a21\u5f0f\u201c<code>[0-9]+</code>\u201d\uff0c\u5e76\u4f7f\u7528Linux\u4e0b\u7684time\u5de5\u5177\u7edf\u8ba1\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u95f4\u3002</p> <pre><code>hujianli@hujianli-OptiPlex-7010:~$ seq 1 10000000 &gt; data.txt\nhujianli@hujianli-OptiPlex-7010:~$ du -sh data.txt 76M data.txt\n</code></pre> <p>\u975e\u7f16\u8bd1\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u7248\u672c\u6e90\u7801\u5982\u4e0b\uff1a <pre><code># $ cat re_nocompile.py \n#!/usr/bin/python\n#-*- coding: UTF-8 -*-\nimport re\ndef main():\npattern = \"[0-9]+\"\nwith open('data.txt') as f:\nfor line in f:\nre.findall(pattern, line)\nif __name__ == '__main__':\nmain()\n</code></pre></p> <p>\u7f16\u8bd1\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u7248\u672c\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code># $ cat re_compile.py \n#!/usr/bin/python\n#-*- coding: UTF-8 -*-\nimport re\ndef main():\npattern = \"[0-9]+\"\nre_obj = re.compile(pattern)\nwith open('data.txt') as f:\nfor line in f:\nre_obj.findall(line)\nif __name__ == '__main__':\nmain()\n</code></pre> <p><pre><code>hujianli@hujianli-OptiPlex-7010:~$ time python re_nocompile.py\n\nreal    0m10.055s\nuser    0m9.968s\nsys 0m0.040s\nhujianli@hujianli-OptiPlex-7010:~$ time python re_compile.py\n\nreal    0m4.182s\nuser    0m4.160s\nsys 0m0.021s\n</code></pre> \u5728\u6570\u636e\u91cf\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u5efa\u8bae\u4f7f\u7528\u7f16\u8bd1\u7248\u672c\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> <p>\u5f3a\u70c8\u63a8\u8350\u5de5\u5177\uff01</p> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u751f\u6210\u4ee3\u7801\u7f51\u7ad9</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#123-\u5e38\u7528\u7684re\u65b9\u6cd5","title":"1.2.3 \u5e38\u7528\u7684re\u65b9\u6cd5","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#1\u5339\u914d\u7c7b\u7684\u51fd\u6570","title":"1.\"\u5339\u914d\"\u7c7b\u7684\u51fd\u6570","text":"<ul> <li>findall\u51fd\u6570</li> </ul> <p>\u8be5\u51fd\u6570\u5728\u5b57\u7b26\u4e32\u4e2d\u67e5\u627e\u6a21\u5f0f\u5339\u914d\uff0c\u5c06\u6240\u6709\u7684\u5339\u914d\u5b57\u7b26\u4e32\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u8fd4\u56de</p> <pre><code>In [1]: import re\n\nIn [2]: data = \"What is the difference between python 2.7.13 and Python 3.6.0 ?\"\nIn [3]: re.findall('[0-9]\\.[0-9]\\.[0-9]', data)\nOut[3]: ['2.7.1', '3.6.0']\nIn [4]: re.findall('Pytho [0-9]\\.[0-9]\\.[0-9]', data)\nOut[4]: []\nIn [5]: re.findall('Python [0-9]\\.[0-9]\\.[0-9]', data)\nOut[5]: ['Python 3.6.0']\nIn [6]: re.findall('[0-9]\\.[0-9]\\.[0-9]', data)\nOut[6]: ['2.7.1', '3.6.0']\n</code></pre> <ul> <li>match\u51fd\u6570</li> </ul> <p>\u8be5\u51fd\u6570\u7528\u4ee5\u5339\u914d\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u90e8\u5206\uff0c\u5982\u679c\u6a21\u5f0f\u5339\u914d\u6210\u529f\uff0c\u8fd4\u56de\u4e00\u4e2aSRE_Match\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u5982\u679c\u6a21\u5f0f\u5339\u914d\u5931\u8d25\uff0c\u8fd4\u56de\u4e00\u4e2aNone\u3002</p> <pre><code>In [7]: data.startswith('What')\nOut[7]: True\n\nIn [8]: data.startswith('Not What')\nOut[8]: False\n\nIn [9]: re.match('What', data)\nOut[9]: &lt;_sre.SRE_Match object; span=(0, 4), match='What'&gt;\n\nIn [10]: if re.match('What', data):\n    ...:     print(True)\n...: else:\n    ...:     print(False)\n...:     True\n\nIn [11]: if re.match('Not What', data):\n    ...:     print(True)\n...: else:\n    ...:     print(False)\n...:     False\n</code></pre> <p>\u867d\u7136\u7b80\u5355\u4f7f\u7528\u65f6match\u51fd\u6570\u548cstartswith\u51fd\u6570\u6bd4\u8f83\u7c7b\u4f3c\uff0c\u4f46\u662f\uff0c\u5bf9\u4e8e\u590d\u6742\u7684\u60c5\u51b5\uff0cmatch\u51fd\u6570\u80fd\u591f\u8f7b\u6613\u89e3\u51b3\uff0cstarswith\u5219\u65e0\u80fd\u4e3a\u529b\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad\u4e00\u4e2a\u6587\u672c\u5b57\u7b26\u4e32\u662f\u5426\u4ee5\u4e00\u4e2a\u6570\u5b57\u5f00\u5934\u3002\u7531\u4e8e\u6211\u4eec\u4e0d\u77e5\u9053\u5177\u4f53\u662f\u54ea\u4e2a\u6570\u5b57\uff0c\u53ea\u77e5\u9053\u8981\u6c42\u662f\u6570\u5b57\uff0c\u56e0\u6b64\uff0c\u65e0\u6cd5\u4f7f\u7528startswith\u51fd\u6570\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528re\u6a21\u5757\u7684match\u51fd\u6570\u8f7b\u677e\u89e3\u51b3\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>In [12]: re.match('\\d+', \"123 is one hundred and twenty-three\")\nOut[12]: &lt;_sre.SRE_Match object; span=(0, 3), match='123'&gt;\n</code></pre></p> <p>match\u5339\u914d\u6210\u529f\u65f6\u8fd4\u56deSRE_Match\u7c7b\u578b\u7684\u5bf9\u8c61\u3002\u8be5\u5bf9\u8c61\u5305\u542b\u4e86\u76f8\u5173\u7684\u6a21\u5f0f\u548c\u539f\u59cb\u5b57\u7b26\u4e32\uff0c\u6a21\u5f0f\u5339\u914d\u6210\u529f\u7684\u5b50\u4e32\u8d77\u59cb\u4f4d\u7f6e\u548c\u7ed3\u675f\u4f4d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8be5\u5bf9\u8c61\u83b7\u53d6\u5339\u914d\u7684\u5b57\u7b26\u4e32\u3002</p> <pre><code>In [13]: r = re.match('\\d+', \"123 is one hundred and twenty-three\")\nIn [14]: r.start()\nOut[14]: 0\nIn [15]: r.end()\nOut[15]: 3\nIn [16]: r.re Out[16]: re.compile(r'\\d+', re.UNICODE)\nIn [17]: r.string Out[17]: '123 is one hundred and twenty-three'\nIn [18]: r.group()\nOut[18]: '123'\n</code></pre> <ul> <li>search\u51fd\u6570</li> </ul> <p>\u8be5\u51fd\u6570\u6a21\u5f0f\u5339\u914d\u6210\u529f\u65f6\uff0c\u4e5f\u4f1a\u8fd4\u56de\u4e00\u4e2aSRE_Match\u5bf9\u8c61\u3002</p> <p>search\u51fd\u6570\u4e0ematch\u51fd\u6570\u7528\u6cd5\u51e0\u4e4e\u4e00\u6837\uff0c\u533a\u522b\u5728\u4e8e\u524d\u8005\u5728\u5b57\u7b26\u4e32\u7684\u4efb\u610f\u4f4d\u7f6e\u8fdb\u884c\u5339\u914d\uff0c\u540e\u8005\u4ec5\u5bf9\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u90e8\u5206\u8fdb\u884c\u5339\u914d\u3002 \u5b83\u4eec\u7684\u5171\u540c\u70b9\u662f\uff0c\u5982\u679c\u5339\u914d\u6210\u529f\uff0c\u8fd4\u56deSRE_Match\u5bf9\u8c61\uff0c\u5982\u679c\u5339\u914d\u5931\u8d25\uff0c\u8fd4\u56de\u4e00\u4e2aNone\u3002</p> <ul> <li>finditer\u51fd\u6570 </li> </ul> <p>\u8be5\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u904d\u5386\u8fed\u4ee3\u5668\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2aSRE_Match\u5bf9\u8c61\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [19]: data = \"What is the difference between python 2.7.13 and Python 3.6.0 ?\"\nIn [20]: r = re.finditer('[0-9]\\.[0-9]\\.[0-9]', data)\nIn [21]: for it in r:\n    ...:     print(it.group(0))\n...:     2.7.1\n3.6.0\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#2\u4fee\u6539\u7c7b\u51fd\u6570","title":"2.\"\u4fee\u6539\u7c7b\"\u51fd\u6570","text":"<ul> <li>sub\u51fd\u6570</li> </ul> <p>\u8be5\u51fd\u6570\u7c7b\u4f3c\u4e8e\u5b57\u7b26\u4e32\u7684replace\u51fd\u6570\uff0c\u53ea\u662fsub\u51fd\u6570\u652f\u6301\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> <p>\u6240\u4ee5\uff0cre\u6a21\u5757\u4e2d\u7684sub\u51fd\u6570\u4f7f\u7528\u573a\u666f\u66f4\u52a0\u5e7f\u6cdb\uff0c\u4f7f\u7528\u65b9\u5f0f\u4e5f\u66f4\u52a0\u7075\u6d3b\u3002\u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u6a21\u5f0f\uff0c\u53ef\u4ee5\u540c\u65f6\u5339\u914d\u201c2.7.13\u201d\u548c\u201c3.6.0\u201d\uff0c\u5e76\u5c06\u5b83\u4eec\u90fd\u66ff\u6362\u4e3a\u201cx.x.x\u201d\u3002\u8fd9\u4e2a\u9700\u6c42\u770b\u4f3c\u7b80\u5355\uff0c\u5982\u679c\u4f7f\u7528Python\u5b57\u7b26\u4e32\u7684replace\u51fd\u6570\uff0c\u9700\u8981\u8fdb\u884c\u4e24\u6b21\u66ff\u6362\u3002\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u7684sub\u51fd\u6570\uff0c\u53ea\u9700\u8981\u4e00\u6b21\u66ff\u6362\u5373\u53ef\u5b8c\u6210\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [22]: re.sub('[0-9]+\\.[0-9]+\\.[0-9]+', 'x.x.x', data)\nOut[22]: 'What is the difference between python x.x.x and Python x.x.x ?'\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u7ed3\u5408sub\u51fd\u6570\u548c\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u529f\u80fd\u5b9e\u73b0\u66f4\u52a0\u590d\u6742\u7684\u66ff\u6362\u3002\u4f8b\u5982\uff0c\u5c06\u4e0b\u9762\u7684\u65e5\u671f\u8fdb\u884c\u683c\u5f0f\u5316\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [23]: text = 'Today is 3/2/2017. PyCon starts 5/25/2017.'\nIn [24]: re.sub(r'(\\d+)/(\\d+)/(\\d+)', r'\\3-\\1-\\2', text)\nOut[25]: 'Today is 2017-3-2. PyCon starts 2017-5-25.'\n</code></pre> <ul> <li>split\u51fd\u6570</li> </ul> <p>split\u51fd\u6570\u4e0ePython\u5b57\u7b26\u4e32\u7684split\u51fd\u6570\u529f\u80fd\u4e00\u6837\uff0c\u90fd\u662f\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u62c6\u5206\u6210\u5b50\u4e32\u7684\u5217\u8868\u3002</p> <p>\u533a\u522b\u5728\u4e8ere\u6a21\u5757\u7684split\u51fd\u6570\u80fd\u591f\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e0b\u9762\u8fd9\u4e00\u6bb5\u5305\u542b\u5192\u53f7\uff0c\u9017\u53f7\uff0c\u5355\u5f15\u53f7\u548c\u82e5\u5e72\u7a7a\u683c\u7684\u6587\u672c\uff0c\u6211\u4eec\u5e0c\u671b\u62c6\u5206\u51fa\u6bcf\u4e00\u4e2a\u5355\u8bcd\u3002</p> <p>\u9762\u5bf9\u8fd9\u4e2a\u9700\u6c42\uff0cPython\u5185\u7f6e\u7684split\u51fd\u6570\u65e0\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u56e0\u6b64\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528re\u6a21\u5757\u7684split\u51fd\u6570\u3002re\u6a21\u5757\u7684split\u51fd\u6570\u80fd\u591f\u6307\u5b9a\u591a\u4e2a\u5206\u9694\u7b26\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [26]: text = \"MySQL slave binlog position: master host '10.173.33.35', filename 'mysql-bin.000002', position '524993060'\"\nIn [27]: re.split(r\"[':,\\s]+\", text.strip(\"'\"))\nOut[27]: ['MySQL',\n 'slave',\n 'binlog',\n 'position',\n 'master',\n 'host',\n '10.173.33.35',\n 'filename',\n 'mysql-bin.000002',\n 'position',\n '524993060']\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#3\u5927\u5c0f\u5199\u4e0d\u654f\u611f","title":"3.\u5927\u5c0f\u5199\u4e0d\u654f\u611f","text":"<p>\u6211\u4eec\u4f7f\u7528Python\u7684re\u6a21\u5757\uff0c\u5e76\u4e0d\u4e00\u5b9a\u603b\u662f\u4e3a\u4e86\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8fdb\u884c\u590d\u6742\u7684\u5339\u914d\u3002 \u6709\u65f6\u5019\u4e00\u4e9b\u5f88\u5c0f\u7684\u9700\u6c42\uff0c\u4f7f\u7528re\u6a21\u5757\u4e5f\u4f1a\u6bd4\u8f83\u65b9\u4fbf\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u5728\u5b57\u7b26\u4e32\u67e5\u627e\u6216\u66ff\u6362\u7684\u65f6\u5019\u9700\u8981\u5ffd\u7565\u5b57\u7b26\u7684\u5927\u5c0f\u5199\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [28]: text = 'UPPER PYTHON, lower python, Mixed Python'\nIn [29]: re.findall('python', text, flags=re.IGNORECASE)\nOut[29]: ['PYTHON', 'python', 'Python']\nIn [30]: re.sub('python', 'snake', text, flags=re.IGNORECASE)\nOut[30]: 'UPPER snake, lower snake, Mixed snake'\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#4\u975e\u8d2a\u5a6a\u5339\u914d","title":"4.\u975e\u8d2a\u5a6a\u5339\u914d","text":"<p>\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5b57\u7b26\u4e32\u5339\u914d\u4e2d\uff0c\u6709\u8d2a\u5a6a\u5339\u914d\u548c\u975e\u8d2a\u5a6a\u5339\u914d\u7684\u533a\u522b\u3002\u8d2a\u5a6a\u5339\u914d\u603b\u662f\u5339\u914d\u5230\u6700\u957f\u7684\u90a3\u4e2a\u5b57\u7b26\u4e32\uff0c\u76f8\u5e94\u7684\uff0c\u975e\u8d2a\u5a6a\u5339\u914d\u662f\u6307\u5339\u914d\u5230\u6700\u5c0f\u7684\u90a3\u4e2a\u5b57\u7b26\u4e32\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u8981\u5339\u914d\u4ee5\u201cBeautiful\u201d\u5f00\u5934\u5e76\u4e14\u4ee5\u70b9\u53f7\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u663e\u7136\uff0c\u5b58\u5728\u4e24\u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u5339\u914d\uff0c\u5206\u522b\u662f\u201cBeautiful is better than ugly.Explicit is better than implicit.\u201d\u548c\u201cBeautiful is better than ugly.\u201d\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u4f7f\u7528\u8d2a\u5a6a\u5339\u914d\uff0c\u5982\u679c\u8981\u4f7f\u7528\u975e\u8d2a\u5a6a\u5339\u914d\uff0c\u53ea\u9700\u8981\u5728\u5339\u914d\u5b57\u7b26\u4e32\u65f6\u52a0\u4e0a\u4e00\u4e2a\u201c\uff1f\u201d\u3002</p> <pre><code>In [31]: text = \"Beautiful is better than ugly. Explicit is better than implicit.\"\nIn [32]: re.findall('Beautiful.*\\.', text)\nOut[33]: ['Beautiful is better than ugly. Explicit is better than implicit.']\nIn [34]: re.findall('Beautiful.*?\\.', text)\nOut[35]: ['Beautiful is better than ugly.']\n</code></pre> <pre><code>import re\n# \u51c6\u5907\u9700\u8981\u88ab\u5339\u914d\u7684\u5b57\u7b26\u4e32\ndata = 'hello jie you are 22 age old'\n# ? \u53ef\u5c06\u8d2a\u5a6a\u6a21\u5f0f\u8f6c\u4e3a\u975e\u8d2a\u5a6a\u6a21\u5f0f \u5c31\u662f\u5339\u914d\u591a\u6b21\u8f6c\u4e3a\u5339\u914d\u4e00\u6b21\nre_obj = re.compile('hello (.*?) you')\nresult = re_obj.findall(data)\nprint(result)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#124-\u6848\u4f8b\u83b7\u53d6html\u9875\u9762\u4e2d\u7684\u6240\u6709\u8d85\u94fe\u63a5","title":"1.2.4 \u6848\u4f8b\uff1a\u83b7\u53d6HTML\u9875\u9762\u4e2d\u7684\u6240\u6709\u8d85\u94fe\u63a5","text":"<p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u5f00\u6e90\u7684requests\u5e93\u83b7\u53d6Hack News\u7684\u5185\u5bb9\uff0c\u7136\u540e\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u89e3\u6790\u51fa\u6240\u6709\u7684http\u6216https\u94fe\u63a5\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [1]: import re\n\nIn [2]: import requests\n\nIn [3]: r = requests.get('https://news.ycombinator.com/')\nIn [4]: re.findall('\"(https?://.*?)\"', r.content)\nOut[4]: ['http://www.ycombinator.com',\n\n'https://pages.nist.gov/800-63-3/',\n 'http://chaosinmotion.com/blog/?p=1184',\n  ......\n 'https://iohk.io/blog/proof-refinement-basics/',\n 'https://www.youtube.com/watch?v=xkdPjbaLngE',\n 'https://github.com/HackerNews/API',\n 'http://www.ycombinator.com/apply/']\n</code></pre> <p>requests\u8865\u5145\uff1a </p> <p>requests\u662f\u7528\u6765\u53d1\u9001HTTP\u8bf7\u6c42\u7684\u5e93\uff0c\u4e5f\u662fPython\u751f\u6001\u4e2d\u6700\u77e5\u540d\u7684\u5f00\u6e90\u9879\u76ee\u4e4b\u4e00\uff0c\u5728Python\u722c\u866b\u4e2d\u5e7f\u6cdb\u4f7f\u7528\u3002</p> <p>requests\u7684\u529f\u80fd\u4e0e\u6807\u51c6\u5e93\u7684urllib2\u7c7b\u4f3c\uff0c\u53ea\u662f\u524d\u8005\u7684\u63a5\u53e3\u8bbe\u8ba1\u5bf9\u5de5\u7a0b\u5e08\u66f4\u52a0\u53cb\u597d\u3002\u5b9e\u73b0\u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f7f\u7528requests\u6bd4\u4f7f\u7528urllib2\u80fd\u591f\u8282\u7701\u66f4\u591a\u7684\u65f6\u95f4\u3002\u7531\u4e8erequests\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u800c\u4e0d\u662f\u6807\u51c6\u5e93\uff0c\u6240\u4ee5\uff0c\u4f7f\u7528\u4e4b\u524d\u5fc5\u987b\u5148\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u5b98\u65b9\u7f51\u7ad9</p> <p>\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>pip install requests\npython -m \"import requests\"\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#13-\u5b57\u7b26\u96c6\u7f16\u7801","title":"1.3 \u5b57\u7b26\u96c6\u7f16\u7801","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#ascii","title":"ASCII","text":"<p>ASCII\uff08American Standard Code for Information Interchange\uff0c\u7f8e\u56fd\u6807\u51c6\u4fe1\u606f\u4ea4\u6362\u4ee3\u7801\uff09\u662f\u57fa\u4e8e\u62c9\u4e01\u5b57\u6bcd\u7684\u4e00\u5957\u7535\u8111\u7f16\u7801\u7cfb\u7edf\uff0c\u4e3b\u8981\u7528\u4e8e\u663e\u793a\u73b0\u4ee3\u82f1\u8bed\u548c\u5176\u4ed6\u897f\u6b27\u8bed\u8a00\uff0c\u5176\u6700\u591a\u53ea\u80fd\u7528 8 \u4f4d\u6765\u8868\u793a\uff08\u4e00\u4e2a\u5b57\u8282\uff09\uff0c\u5373\uff1a2**8 = 256\uff0c\u6240\u4ee5\uff0cASCII\u7801\u6700\u591a\u53ea\u80fd\u8868\u793a 256 \u4e2a\u7b26\u53f7\u3002</p> <p>\u663e\u7136ASCII\u7801\u65e0\u6cd5\u5c06\u4e16\u754c\u4e0a\u7684\u5404\u79cd\u6587\u5b57\u548c\u7b26\u53f7\u5168\u90e8\u8868\u793a\uff0c\u6240\u4ee5\uff0c\u5c31\u9700\u8981\u65b0\u51fa\u4e00\u79cd\u53ef\u4ee5\u4ee3\u8868\u6240\u6709\u5b57\u7b26\u548c\u7b26\u53f7\u7684\u7f16\u7801\uff0c\u5373\uff1aUnicode</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#unicod","title":"Unicod","text":"<p>Unicod\uff08\u7edf\u4e00\u7801\u3001\u4e07\u56fd\u7801\u3001\u5355\u4e00\u7801\uff09\u662f\u4e00\u79cd\u5728\u8ba1\u7b97\u673a\u4e0a\u4f7f\u7528\u7684\u5b57\u7b26\u7f16\u7801\u3002Unicode \u662f\u4e3a\u4e86\u89e3\u51b3\u4f20\u7edf\u7684\u5b57\u7b26\u7f16\u7801\u65b9\u6848\u7684\u5c40\u9650\u800c\u4ea7\u751f\u7684\uff0c\u5b83\u4e3a\u6bcf\u79cd\u8bed\u8a00\u4e2d\u7684\u6bcf\u4e2a\u5b57\u7b26\u8bbe\u5b9a\u4e86\u7edf\u4e00\u5e76\u4e14\u552f\u4e00\u7684\u4e8c\u8fdb\u5236\u7f16\u7801\uff0c\u89c4\u5b9a\u867d\u6709\u7684\u5b57\u7b26\u548c\u7b26\u53f7\u6700\u5c11\u7531 16 \u4f4d\u6765\u8868\u793a\uff082\u4e2a\u5b57\u8282\uff09\uff0c\u5373\uff1a2 **16 = 65536\uff0c</p> <pre><code>\u6ce8\uff1a\u6b64\u5904\u8bf4\u7684\u7684\u662f\u6700\u5c112\u4e2a\u5b57\u8282\uff0c\u53ef\u80fd\u66f4\u591a\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#utf-8","title":"UTF-8","text":"<p>UTF-8\uff0c\u662f\u5bf9Unicode\u7f16\u7801\u7684\u538b\u7f29\u548c\u4f18\u5316\uff0c\u4ed6\u4e0d\u518d\u4f7f\u7528\u6700\u5c11\u4f7f\u75282\u4e2a\u5b57\u8282\uff0c\u800c\u662f\u5c06\u6240\u6709\u7684\u5b57\u7b26\u548c\u7b26\u53f7\u8fdb\u884c\u5206\u7c7b\uff1a</p> <p>ascii\u7801\u4e2d\u7684\u5185\u5bb9\u75281\u4e2a\u5b57\u8282\u4fdd\u5b58\u3001\u6b27\u6d32\u7684\u5b57\u7b26\u75282\u4e2a\u5b57\u8282\u4fdd\u5b58\uff0c\u4e1c\u4e9a\u7684\u5b57\u7b26\u75283\u4e2a\u5b57\u8282\u4fdd\u5b58\u3002</p> <pre><code>Python2.x\u7248\u672c\uff0c\u9ed8\u8ba4\u652f\u6301\u7684\u5b57\u7b26\u7f16\u7801\u4e3aASCll\n\nPython3.x\u7248\u672c\uff0c\u9ed8\u8ba4\u652f\u6301\u7684\u662fUnicode\uff0c\u4e0d\u7528\u58f0\u660e\u5b57\u7b26\u7f16\u7801\u53ef\u4ee5\u76f4\u63a5\u663e\u793a\u4e2d\u6587\n</code></pre> <p>\u7b80\u5355\u6765\u8bf4\uff1a</p> <pre><code>#encode(\"utf-8\")          # \u7f16\u7801\u4e3autf-8\uff0c\u89e3\u7801\u5fc5\u987b\u4e00\u81f4\n#decode(\"utf-8\")          # \u89e3\u7801utf-8\n\nUnicode \u6700\u7eaf\uff0c\nutf-8 \u2014\u2014\u2014\u2014&gt; Unicode -----&gt; gbk\ngbk -------&gt; Unicode -----utf-8\n</code></pre> <p>\u4ee3\u7801\u6f14\u793a\uff1a</p> <pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nwd = \"\u80e1\u5efa\u529b\u5b66python\"\nwd_encode = wd.encode()\nprint(wd_encode)\nwd_decode = wd_encode.decode()\nprint(wd_decode)\nwd_encode_gb2312 = wd.encode(\"gb2312\")\nprint(wd_encode_gb2312)\nwd_decode_gb2312 = wd_encode_gb2312.decode(\"gb2312\")\nprint(wd_decode_gb2312)\nwd_encode_utf8 = wd.encode(\"utf-8\")\nprint(wd_encode_utf8)\nwd_decode_utf8 = wd_encode_utf8.decode(\"utf-8\")\nprint(wd_decode_utf8)\n</code></pre> <p>\u5728Python3\u4e2d\uff0c\u5185\u7f6e\u7684open\u51fd\u6570\u53ef\u4ee5\u6307\u5b9a\u5b57\u7b26\u96c6\u7f16\u7801\uff1a</p> <pre><code>&gt;&gt;&gt; name = '\u8d56\u660e\u661f'\n&gt;&gt;&gt; name\n'\u8d56\u660e\u661f'\n&gt;&gt;&gt; with open('/tmp/data.txt', 'w', encoding='utf-8') as f:\n... f.write(name)\n3\n</code></pre> <p>Python3\u7684\u5b57\u7b26\u96c6\u5904\u7406\u8f85\u52a9\u51fd\u6570\uff1a</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther: 18793\n# Date\uff1a2021/10/20 11:23\n# filename: to_str_hu.py\ndef to_str(bytes_or_str):\nif isinstance(bytes_or_str, bytes):\nvalue = bytes_or_str.decode(\"utf-8\")\nelse:\nvalue = bytes_or_str\nreturn value\ndef to_bytes(bytes_or_str):\nif isinstance(bytes_or_str, str):\nvalue = bytes_or_str.encode(\"utf-8\")\nelse:\nvalue = bytes_or_str\nreturn value\nprint(repr(to_str(b\"hujianli1\")))\nprint(repr(to_str(\"hujianli1\")))\nprint(repr(to_bytes(b\"hujianli2\")))\nprint(repr(to_bytes(\"hujianli2\")))\n</code></pre> <p>\u201c\u5b57\u7b26\u4e32\u201d\u548c\u201c\u5b57\u8282\u4e32\u201d\u7684\u8f6c\u6362\uff0c\u5b57\u8282\u4e32\u5728\u5b57\u7b26\u4e32\u58f0\u660e\u65f6\u524d\u9762\u65b0\u589eb</p> <pre><code>def upper_s(s):\n\"\"\"\u628a\u8f93\u5165\u5b57\u7b26\u4e32\u91cc\u7684\u6240\u6709 \"s\" \u90fd\u8f6c\u4e3a\u5927\u5199\"\"\"\nreturn s.replace('s', 'S')\nbin_obj = b'super sunflowers.'\nprint(bin_obj)\nstr_obj = bin_obj.decode('utf-8')\nprint(upper_s(str_obj))\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#14-jinja2\u6a21\u677f","title":"1.4 Jinja2\u6a21\u677f","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#141-\u6a21\u677f\u4ecb\u7ecd","title":"1.4.1 \u6a21\u677f\u4ecb\u7ecd","text":"<p>\u6a21\u677f\u5728Python\u7684web\u5f00\u53d1\u4e2d\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5b83\u80fd\u591f\u6709\u6548\u5730\u5c06\u4e1a\u52a1\u903b\u8f91\u548c\u9875\u9762\u903b\u8f91\u5206\u79bb\uff0c\u4f7f\u5f97\u5de5\u7a0b\u5e08\u7f16\u5199\u51fa\u53ef\u8bfb\u6027\u66f4\u597d\u3001\u66f4\u52a0\u5bb9\u6613\u7406\u89e3\u548c\u7ef4\u62a4\u7684\u4ee3\u7801\u3002</p> <p>\u8bd5\u60f3\u4e00\u4e0b\uff0c\u8981\u4e3a\u4e00\u4e2a\u5927\u578b\u7684\u8868\u683c\u6784\u5efaHTML\u4ee3\u7801\uff0c\u8868\u683c\u4e2d\u7684\u6570\u636e\u7531\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u7684\u6570\u636e\u4ee5\u53ca\u5fc5\u8981\u7684HTML\u5b57\u7b26\u4e32\u8fde\u63a5\u5728\u4e00\u8d77\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u6700\u7b80\u5355\u4e5f\u6700\u76f4\u63a5\u7684\u65b9\u5f0f\u5c31\u662f\u5728Python\u4ee3\u7801\u4e2d\u4f7f\u7528\u5b57\u7b26\u4e32\u62fc\u63a5\u7684\u65b9\u5f0f\u751f\u6210HTML\u4ee3\u7801\u3002\u5982\u679c\u771f\u7684\u8fd9\u4e48\u505a\u4e86\uff0c\u5bf9\u5de5\u7a0b\u5e08\u6765\u8bf4\u5c06\u662f\u4e2a\u5669\u68a6\uff0c\u800c\u4e14\u4ee3\u7801\u65e0\u6cd5\u7ef4\u62a4\u3002</p> <p>Python\u7684\u6807\u51c6\u5e93\u81ea\u5e26\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u6a21\u677f\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\u4fbf\u662f\u4e00\u4e2a\u6a21\u677f\u4f7f\u7528\u7684\u4f8b\u5b50\u3002</p> <pre><code>In [1]: from string import Template\n\nIn [2]: s = Template('$who is a $role')\nIn [3]: s.substitute(who='bob', role='teacher')\nOut[3]: 'bob is a teacher'\nIn [4]: s.substitute(who='lily', role='student')\nOut[4]: 'lily is a student'\n</code></pre> <p>Python\u81ea\u5e26\u7684\u6a21\u677f\u529f\u80fd\u975e\u5e38\u6709\u9650\uff0c\u4f8b\u5982\u65e0\u6cd5\u5728\u6a21\u677f\u4e2d\u4f7f\u7528\u63a7\u5236\u8bed\u53e5\u548c\u8868\u8fbe\u5f0f\uff0c\u4e0d\u652f\u6301\u7ee7\u627f\u548c\u91cd\u7528\u7b49\u64cd\u4f5c\u3002</p> <p>\u8fd9\u5bf9\u4e8eweb\u5f00\u53d1\u6765\u8bf4\u8fdc\u8fdc\u4e0d\u591f\uff0c\u56e0\u6b64\uff0c\u51fa\u73b0\u4e86\u7b2c\u4e09\u65b9\u7684\u6a21\u677f\u7cfb\u7edf\u3002\u76ee\u524d\u5e02\u9762\u4e0a\u6709\u975e\u5e38\u591a\u7684\u6a21\u677f\u7cfb\u7edf\uff0c\u5176\u4e2d\u6700\u77e5\u540d\u7684\u662fJinja2\u548cMako\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#142-jinja2\u8bed\u6cd5\u5165\u95e8","title":"1.4.2 Jinja2\u8bed\u6cd5\u5165\u95e8","text":"<p>\u8865\u5145\u8d44\u6599\uff1aFlask\u662f\u4e00\u4e2a\u4f7f\u7528Python\u7f16\u5199\u7684\u8f7b\u91cf\u7ea7Web\u5e94\u7528\u6846\u67b6\uff0c\u672c\u6765\u53ea\u662f\u4f5c\u8005\u7684\u4e00\u4e2a\u611a\u4eba\u8282\u73a9\u7b11\uff0c\u4e0d\u8fc7\u53d1\u5e03\u4ee5\u540e\u5927\u53d7\u6b22\u8fce\uff0c\u8fdb\u800c\u6210\u4e3a\u4e00\u4e2a\u6b63\u5f0f\u7684\u9879\u76ee\u3002</p> <p>Flask\u662fPython\u751f\u6001\u4e2d\u6700\u6d41\u884c\u7684Web\u6846\u67b6\u4e4b\u4e00\uff0c\u672c\u8eab\u7684\u4ee3\u7801\u4e5f\u5199\u5f97\u975e\u5e38\u4f18\u96c5\uff0c\u6240\u4ee5\u6709\u4e0d\u5c11Python\u5de5\u7a0b\u5e08\u5b66\u4e60Flask\u7684\u6e90\u7801\u3002</p> <p>Jinja2\u6a21\u677f\u5f15\u64ce\u4e4b\u6240\u4ee5\u4f7f\u7528\u5e7f\u6cdb\uff0c\u662f\u56e0\u4e3a\u5b83\u5177\u6709\u4ee5\u4e0b\u4f18\u70b9\uff1a</p> <ul> <li> <p>\u76f8\u5bf9\u4e8eTemplate\uff0cJinja2\u66f4\u52a0\u7075\u6d3b\uff0c\u5b83\u63d0\u4f9b\u4e86\u63a7\u5236\u7ed3\u6784\u3001\u8868\u8fbe\u5f0f\u548c\u7ee7\u627f\u7b49\uff0c\u5de5\u7a0b\u5e08\u53ef\u4ee5\u5728\u6a21\u677f\u4e2d\u505a\u66f4\u591a\u7684\u4e8b\u60c5\uff1b</p> </li> <li> <p>\u76f8\u5bf9\u4e8eMako\uff0cJinja2\u63d0\u4f9b\u4e86\u4ec5\u6709\u7684\u63a7\u5236\u7ed3\u6784\uff0c\u4e0d\u5141\u8bb8\u5728\u6a21\u677f\u4e2d\u7f16\u5199\u592a\u591a\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u907f\u514d\u4e86\u5de5\u7a0b\u5e08\u4e71\u7528\u884c\u4e3a\uff1b</p> </li> <li> <p>\u76f8\u5bf9\u4e8eDjango\u6a21\u677f\uff0cJinja2\u7684\u6027\u80fd\u66f4\u597d\uff1b</p> </li> <li> <p>Jinja2\u6a21\u677f\u7684\u53ef\u8bfb\u6027\u5f88\u597d\u3002</p> </li> </ul> <p>Jinja2\u662fFlask\u7684\u4e00\u4e2a\u4f9d\u8d56\uff0c\u5982\u679c\u5df2\u7ecf\u5b89\u88c5\u4e86Flask\uff0cJinja2\u4e5f\u4f1a\u968f\u4e4b\u5b89\u88c5\u3002\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u5355\u72ec\u5b89\u88c5Jinja2\uff1a</p> <pre><code>pip install jinja2\npython -c \"import jinja2\"\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c06\u8be6\u7ec6\u4ecb\u7ecdJinja2\u7684\u8bed\u6cd5\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#1\u8bed\u6cd5\u5757","title":"1.\u8bed\u6cd5\u5757","text":"<p>\u5728Jinja2\u4e2d\uff0c\u5b58\u5728\u4e09\u79cd\u8bed\u6cd5\uff1a</p> <ul> <li> <p>\u63a7\u5236\u7ed3\u6784{%%}</p> </li> <li> <p>\u53d8\u91cf\u53d6\u503c{{}}</p> </li> <li> <p>\u6ce8\u91ca{##}</p> </li> </ul> <p>\u4e0b\u9762\u662f\u4f7f\u7528Jinja\u63a7\u5236\u7ed3\u6784\u548c\u6ce8\u91ca\u7684\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <p><pre><code>{# note: disabled template because we no longer use this\n    {% for user in users %}\n        ...\n    {% endfor%}\n#}\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0cfor\u5faa\u73af\u7684\u4f7f\u7528\u4e0ePython\u6bd4\u8f83\u7c7b\u4f3c\uff0c\u4f46\u662f\uff0c\u6ca1\u6709\u4e86\u590d\u5408\u8bed\u53e5\u672b\u5c3e\u7684\u5192\u53f7\u3002 \u6b64\u5916\u9700\u8981\u4f7f\u7528endfor\u4f5c\u4e3a\u7ed3\u675f\u6807\u5fd7\u3002</p> <p>Jinja2\u4e2d\u7684if\u8bed\u53e5\u4e5f\u4e00\u6837\uff0c\u6ca1\u6709\u590d\u5408\u8bed\u53e5\u672b\u5c3e\u7684\u5192\u53f7\uff0c\u9700\u8981\u4f7f\u7528endif\u4f5c\u4e3a\u7ed3\u675f\u6807\u5fd7\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>{% if users %}\n    &lt;ul&gt;\n    {% for user in users %}\n        &lt;li&gt;{{ user.username }}&lt;/li&gt;\n    {% endfor%}\n    &lt;/ul&gt;\n{% endif %}\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#2\u53d8\u91cf","title":"2.\u53d8\u91cf","text":"<p>Jinja2\u6a21\u677f\u4e2d\u4f7f\u7528\u7684{{}}\u8bed\u6cd5\u8868\u793a\u4e00\u4e2a\u53d8\u91cf\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u5360\u4f4d\u7b26\uff0c\u544a\u8bc9\u6a21\u677f\u5f15\u64ce\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u503c\u5728\u6e32\u67d3\u6a21\u677f\u65f6\u83b7\u53d6\u3002</p> <p>Jinja2\u8bc6\u522b\u6240\u6709\u7684Python\u6570\u636e\u7c7b\u578b\uff0c\u751a\u81f3\u662f\u4e00\u4e9b\u590d\u6742\u7684\u7c7b\u578b\uff0c\u5982\u5217\u8868\u3001\u5b57\u5178\u548c\u5bf9\u8c61\u7b49\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>&lt;p&gt;A value from a dictionary: {{ mydict['key'] }}.&lt;/p&gt;\n&lt;p&gt;A value from a list: {{ mylist[3] }}.&lt;/p&gt;\n&lt;p&gt;A value from a list, with a variable index: {{ mylist[myintvar] }}.&lt;/p&gt;\n&lt;p&gt;A value from an object's method: {{ myobj.somemethod() }}.&lt;/p&gt;\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#3jinja2\u4e2d\u7684\u8fc7\u6ee4\u5668","title":"3.Jinja2\u4e2d\u7684\u8fc7\u6ee4\u5668","text":"<p>\u53d8\u91cf\u53ef\u4ee5\u901a\u8fc7\u201c\u8fc7\u6ee4\u5668\u201d\u8fdb\u884c\u4fee\u6539\uff0c\u8fc7\u6ee4\u5668\u53ef\u4ee5\u7406\u89e3\u4e3a\u662fJinja2\u91cc\u9762\u7684\u5185\u7f6e\u51fd\u6570\u548c\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\u3002\u4f8b\u5982\uff0c\u5b58\u5728\u4e00\u4e2a\u540d\u4e3alower\u7684\u8fc7\u6ee4\u5668\uff0c\u5b83\u7684\u4f5c\u7528\u4e0e\u5b57\u7b26\u4e32\u5bf9\u8c61\u7684lower\u65b9\u6cd5\u4e00\u6a21\u4e00\u6837\u3002</p> <p>\u5728Jinja2\u4e2d\uff0c\u53d8\u91cf\u53ef\u4ee5\u901a\u8fc7\u201c\u8fc7\u6ee4\u5668\u201d\u4fee\u6539\uff0c\u8fc7\u6ee4\u5668\u4e0e\u53d8\u91cf\u7528\u7ba1\u9053\uff08|\uff09\u5206\u5272\u3002\u591a\u4e2a\u8fc7\u6ee4\u5668\u53ef\u4ee5\u94fe\u5f0f\u8c03\u7528\uff0c\u524d\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7684\u8f93\u51fa\u4f1a\u4f5c\u4e3a\u540e\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7684\u8f93\u5165\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>{{ \"Hello World\" | replace(\"Hello\", \"Goodbye\") }}\n    -&gt; Goodbye World\n\n{{ \"Hello World\" | replace(\"Hello\", \"Goodbye\") | upper }}\n    -&gt; GOODBYE WORLD\n\n{ 42.55 | round }}\n    -&gt; 43.0\n\n{{ 42.55 | round | int }}\n    -&gt; 43\n</code></pre> <p>Jinja2\u53d8\u91cf\u8fc7\u6ee4\u5668</p> \u8fc7\u6ee4\u5668\u540d\u79f0 \u8bf4\u660e safe \u6e32\u67d3\u503c\u65f6\u4e0d\u8f6c\u4e49 capitalize \u628a\u503c\u7684\u9996\u5b57\u6bcd\u8f6c\u6362\u6210\u5927\u5199\uff0c\u5176\u4ed6\u5b57\u6bcd\u8f6c\u6362\u6210\u5c0f\u5199 lower \u628a\u503c\u8f6c\u6362\u6210\u5c0f\u5199\u5f62\u5f0f upper \u628a\u503c\u8f6c\u6362\u6210\u5927\u5199\u5f62\u5f0f title \u628a\u503c\u4e2d\u6bcf\u4e2a\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\u90fd\u8f6c\u6362\u6210\u5927\u5199 trim \u628a\u503c\u7684\u9996\u5c3e\u7a7a\u683c\u5220\u6389 striptags \u6e32\u67d3\u4e4b\u524d\u628a\u503c\u4e2d\u6240\u6709\u7684 HTML \u6807\u7b7e\u90fd\u5220\u6389"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#4jinja2\u7684\u63a7\u5236\u7ed3\u6784","title":"4.Jinja2\u7684\u63a7\u5236\u7ed3\u6784","text":"<p>Jinja2\u4e2d\u7684if\u8bed\u53e5\u7c7b\u4f3c\u4e8ePython\u4e2d\u7684if\u8bed\u53e5\uff0c\u4f46\u662f\uff0c\u9700\u8981\u4f7f\u7528endif\u8bed\u53e5\u4f5c\u4e3a\u6761\u4ef6\u5224\u65ad\u7684\u7ed3\u675f\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528if\u8bed\u53e5\u5224\u65ad\u4e00\u4e2a\u53d8\u91cf\u662f\u5426\u5b9a\u4e49\uff0c\u662f\u5426\u4e3a\u7a7a\uff0c\u662f\u5426\u4e3a\u771f\u503c\u3002\u4e0ePython\u4e2d\u7684if\u8bed\u53e5\u4e00\u6837\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528elif\u548celse\u6784\u5efa\u591a\u4e2a\u5206\u652f\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>{% if kenny.sick %}\n    Kenny is sick.\n{% elif kenny.dead %}\n    You killed Kenny! You bastard!!!\n{% else %}\n    Kenny looks okay ---so far\n{% endif %}\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#5jinja2\u7684for\u5faa\u73af","title":"5.Jinja2\u7684for\u5faa\u73af","text":"<p>Jinja2\u4e2d\u7684for\u8bed\u53e5\u53ef\u7528\u4e8e\u8fed\u4ee3Python\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5305\u62ec\u5217\u8868\u3001\u5143\u7ec4\u548c\u5b57\u5178\u3002 \u5728Jinja\u4e2d\u4e0d\u5b58\u5728while\u5faa\u73af\uff0c\u8fd9\u4e5f\u7b26\u5408\u4e86Jinja2\u7684\u201c\u63d0\u4f9b\u4ec5\u6709\u7684\u63a7\u5236\u7ed3\u6784\uff0c\u4e0d\u5141\u8bb8\u5728\u6a21\u677f\u4e2d\u7f16\u5199\u592a\u591a\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u907f\u514d\u4e86\u5de5\u7a0b\u5e08\u4e71\u7528\u884c\u4e3a\u201d\u8bbe\u8ba1\u539f\u5219\u3002</p> <p>\u5728Jinja2\u4e2d\u8fed\u4ee3\u5217\u8868\uff1a <pre><code>&lt;h1&gt;Members&lt;/h1&gt;\n&lt;ul&gt;\n    {% for user in users %}\n        &lt;li&gt;{{ user.username }}&lt;/li&gt;\n    {% endfor%}\n&lt;/ul&gt;\n</code></pre></p> <p>\u5728Jinja2\u4e2d\u4e5f\u53ef\u4ee5\u904d\u5386\u5b57\u5178\uff1a</p> <pre><code>&lt;dl&gt;\n    {% for key, value in d.iteritems() %}\n        &lt;dt&gt;{{ key }}&lt;/dt&gt;\n&lt;dd&gt;{{ value }}&lt;/dd&gt;\n    {% endfor%}\n&lt;/dl&gt;\n</code></pre> <p>\u9664\u4e86\u57fa\u672c\u7684for\u5faa\u73af\u4f7f\u7528\u4ee5\u5916\uff0cJinja2\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7279\u6b8a\u7684\u53d8\u91cf\uff0c\u6211\u4eec\u4e0d\u7528\u5b9a\u4e49\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u53d8\u91cf\u3002</p> <p>\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u4fdd\u5b58\u4e86\u8054\u7cfb\u4eba\u4fe1\u606f\u7684\u5b57\u5178\uff0c\u5b57\u5178\u7684key\u662f\u8054\u7cfb\u4eba\u7684\u540d\u5b57\uff0c\u5b57\u5178\u7684value\u662f\u8054\u7cfb\u4eba\u7684\u7535\u8bdd\u3002\u4f60\u73b0\u5728\u60f3\u628a\u8054\u7cfb\u4eba\u7684\u4fe1\u606f\u4ee5\u8868\u683c\u7684\u5f62\u5f0f\u663e\u793a\u5728HTML\u9875\u9762\u4e0a\u3002\u6b64\u65f6\uff0c\u9664\u4e86\u59d3\u540d\u548c\u7535\u8bdd\u4ee5\u5916\uff0c\u4f60\u8fd8\u5e0c\u671b\u8868\u683c\u7684\u7b2c\u4e00\u5217\u662f\u5e8f\u53f7\u3002\u8fd9\u4e2a\u9700\u6c42\u5982\u679c\u5728Python\u4ee3\u7801\u4e2d\u5b9e\u73b0\uff0c\u5c06\u4f1a\u50cf\u4e0b\u9762\u8fd9\u6837</p> <pre><code>data = dict(bob=13000000001, lily=130000000002, robin=130000000003)\nindex = 0\nfor key, value in data.viewitems():\nindex += 1\nprint(index, key, value, sep=\",\")\n</code></pre> <p>Jinja2\u4e3a\u4e86\u8ba9\u5de5\u7a0b\u5e08\u5c3d\u53ef\u80fd\u5728\u6a21\u677f\u4e2d\u5c11\u5199Python\u4ee3\u7801\u5904\u7406\u4e1a\u52a1\u903b\u8f91\uff0c\u4ec5\u5728\u6a21\u677f\u4e2d\u5904\u7406\u663e\u793a\u5de5\u4f5c\u95ee\u9898\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7279\u6b8a\u53d8\u91cf\u3002\u5bf9\u4e8e\u524d\u9762\u7684\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u5728Jinja2\u4e2d\u7684\u6b63\u786e\u505a\u6cd5\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>{% for key, value in data.iteritems() %}\n    &lt;tr class=\"info\"&gt;\n&lt;td&gt;{{ loop.index}}&lt;/td&gt;\n&lt;td&gt;{{ key }}&lt;/td&gt;\n&lt;td&gt;{{ value }}&lt;/td&gt;\n&lt;/tr&gt;\n{% endfor%}\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#6jinja2\u7684\u5b8f","title":"6.Jinja2\u7684\u5b8f","text":"<p>\u5b8f\u7c7b\u4f3c\u4e8e\u7f16\u7a0b\u8bed\u8a00\u4e2d\u7684\u51fd\u6570\uff0c\u5b83\u7528\u4e8e\u5c06\u884c\u4e3a\u62bd\u8c61\u6210\u53ef\u91cd\u590d\u8c03\u7528\u7684\u4ee3\u7801\u5757\u3002\u4e0e\u51fd\u6570\u4e00\u6837\uff0c\u5b8f\u5206\u4e3a\u5b9a\u4e49\u548c\u8c03\u7528\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u58f0\u660e\u5b8f\u7684\u4f8b\u5b50\uff1a</p> <pre><code>{% macro input(name, type='text', value='') %}\n    &lt;input type=\"{{ type }}\" name=\"{{ name }}\" value=\"{{ value }}\"&gt;\n{% endmacro %}\n</code></pre> <p>\u5728\u5b8f\u7684\u5b9a\u4e49\u4e2d\uff0c\u4f7f\u7528macro\u5173\u952e\u5b57\u5b9a\u4e49\u4e00\u4e2a\u5b8f\uff0cinput\u662f\u5b8f\u7684\u540d\u79f0\u3002 \u5b83\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662fname\uff0ctype\u548cvalue\uff0c\u5176\u4e2dtype\u548cvalue\u53c2\u6570\u6709\u9ed8\u8ba4\u503c\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u5b8f\u7684\u5b9a\u4e49\u4e0ePython\u7684\u51fd\u6570\u5b9a\u4e49\u975e\u5e38\u76f8\u4f3c\uff0c\u6b64\u5916\uff0c\u5b83\u4e0eJinja2\u4e2d\u7684for\u5faa\u73af\u548cif\u8bed\u53e5\u4e00\u6837\uff0c\u4e0d\u9700\u8981\u4f7f\u7528\u590d\u5408\u8bed\u53e5\u7684\u5192\u53f7\uff0c\u4f7f\u7528endmacro\u7ed3\u675f\u5b8f\u7684\u5b9a\u4e49\u3002</p> <p>\u4e0b\u9762\u662f\u5b8f\u7684\u8c03\u7528\uff0c\u4e0e\u51fd\u6570\u8c03\u7528\u7c7b\u4f3c\uff1a <pre><code>&lt;p&gt;{{ input('username', value='user') }}&lt;/p&gt;\n&lt;p&gt;{{ input('password', 'password') }}&lt;/p&gt;\n&lt;p&gt;{{ input('submit', 'submit', 'Submit') }}&lt;/p&gt;\n</code></pre></p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#7jinja2\u7684\u7ee7\u627f\u548csuper\u51fd\u6570","title":"7.Jinja2\u7684\u7ee7\u627f\u548cSuper\u51fd\u6570","text":"<p>\u5982\u679c\u53ea\u662f\u4f7f\u7528Jinja2\u8fdb\u884c\u914d\u7f6e\u6587\u4ef6\u7ba1\u7406\uff0c\u5c06\u57fa\u672c\u7528\u4e0d\u5230Jinja2\u7ee7\u627f\u529f\u80fd\u3002\u5982\u679c\u662f\u4f7f\u7528Jinja2\u8fdb\u884cweb\u5f00\u53d1\uff0c\u90a3\u4e48\uff0c\u7ee7\u627f\u662fJinja2\u6700\u5438\u5f15\u4eba\u7684\u529f\u80fd\u3002</p> <p>Jinja2\u4e2d\u6700\u5f3a\u5927\u7684\u90e8\u5206\u5c31\u662f\u6a21\u677f\u7ee7\u627f\u3002\u6a21\u677f\u7ee7\u627f\u5141\u8bb8\u4f60\u6784\u5efa\u4e00\u4e2a\u5305\u542b\u7ad9\u70b9\u5171\u540c\u5143\u7d20\u7684\u57fa\u672c\u6a21\u677f\u201c\u9aa8\u67b6\u201d\uff0c\u5e76\u5b9a\u4e49\u5b50\u6a21\u677f\u53ef\u4ee5\u8986\u76d6\u7684\u5757\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u540d\u4e3abase.html\u7684HTML\u6587\u6863\uff0c\u91cc\u9762\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    {% block head %}\n    &lt;link rel=\"stylesheet\" href=\"style.css\" /&gt;\n&lt;title&gt;{% block title %}{% endblock %}-My Webpage&lt;/title&gt;\n    {% endblock %}\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div id=\"content\"&gt;\n    {% block content %}{% endblock %}\n&lt;/div&gt;\n&lt;/body&gt;\n</code></pre> <p>\u5728base.html\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528{%block name%}\u7684\u65b9\u5f0f\u5b9a\u4e49\u4e86\u4e09\u4e2a\u5757\uff0c\u8fd9\u4e9b\u5757\u53ef\u4ee5\u5728\u5b50\u6a21\u677f\u4e2d\u8fdb\u884c\u66ff\u6362\u6216\u8c03\u7528\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u540d\u4e3aindex.html\u7684HTML\u6587\u6863\uff0c\u6587\u6863\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>{% extends \"base.html\" %}\n\n{% block title %}Index{% endblock%}\n\n{% block head %}\n    {{ super() }}\n    &lt;style type=\"text/css\"&gt;\n.important { color: #336699; }\n&lt;/style&gt;\n{% endblock%}\n\n{% block content %}\n    &lt;h1&gt;Index&lt;/h1&gt;\n&lt;p class=\"important\"&gt; Welcome on my awesome homepage.  &lt;/p&gt;\n{% endblock%}\n</code></pre> <p>\u5728index.html\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528<code>{%extends\"base.html\"%}</code>\u7ee7\u627fbase.html\uff0c\u7ee7\u627f\u4ee5\u540e\uff0cbase.html\u4e2d\u7684\u6240\u6709\u5185\u5bb9\u90fd\u4f1a\u5728index.html\u4e2d\u5c55\u73b0\u3002</p> <p>\u5728index.html\u4e2d\uff0c\u6211\u4eec\u91cd\u65b0\u5b9a\u4e49\u4e86title\u548ccontent\u8fd9\u4e24\u4e2a\u5757\u7684\u5185\u5bb9\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#8jinja2\u7684\u5176\u4ed6\u8fd0\u7b97","title":"8.Jinja2\u7684\u5176\u4ed6\u8fd0\u7b97","text":"<p>Jinja2\u4e2d\u53ef\u4ee5\u5b9a\u4e49\u53d8\u91cf\uff0c\u4e3a\u4e86\u5bf9\u53d8\u91cf\u8fdb\u884c\u64cd\u4f5c\uff0cJinja2\u63d0\u4f9b\u4e86\u7b97\u6570\u64cd\u4f5c\u3001\u6bd4\u8f83\u64cd\u4f5c\u548c\u903b\u8f91\u64cd\u4f5c\u3002\u4f7f\u7528Jinja2\u6a21\u677f\u65f6\uff0c\u5e94\u8be5\u5c3d\u53ef\u80fd\u5728Python\u4ee3\u7801\u4e2d\u8fdb\u884c\u903b\u8f91\u5904\u7406\uff0c\u5728Jinja2\u4e2d\u4ec5\u5904\u7406\u663e\u793a\u95ee\u9898\u3002</p> <p>\u56e0\u6b64\uff0c\u4e00\u822c\u5f88\u5c11\u7528\u5230Jinja2\u7684\u53d8\u91cf\u548c\u53d8\u91cf\u7684\u8fd0\u7b97\u64cd\u4f5c\u3002</p> <p>\u90e8\u5206Jinja2\u4e2d\u7684\u8fd0\u7b97\u64cd\u4f5c\uff1a</p> <ul> <li> <p>\u7b97\u6570\u8fd0\u7b97<code>+-*///%***</code></p> </li> <li> <p>\u6bd4\u8f83\u64cd\u4f5c<code>==\uff01=&gt;&gt;=&lt;&lt;=</code></p> </li> <li> <p>\u903b\u8f91\u8fd0\u7b97<code>not and or</code></p> </li> </ul>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#143-jinja2\u5b9e\u6218","title":"1.4.3 Jinja2\u5b9e\u6218","text":"<p>\u4e0b\u9762\u6765\u770b\u4e24\u4e2a\u4f8b\u5b50\u4ee5\u5de9\u56fa\u524d\u9762\u7684\u77e5\u8bc6\u3002 \u5982\u679c\u8bfb\u8005\u5728Flask\u4e2d\u4f7f\u7528Jinja2\uff0c\u5219\u51e0\u4e4e\u4e0d\u9700\u8981\u5173\u5fc3Jinja2\u7684\u4f7f\u7528\u3002\u56e0\u4e3aJinja2\u7684\u5f00\u53d1\u8005\u548cFlask\u7684\u5f00\u53d1\u8005\u662f\u540c\u4e00\u4e2a\u4eba\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u5de5\u7a0b\u5e08\u5728Flask\u4e2d\u4f7f\u7528Jinja2 \uff0c\u4f5c\u8005\u5728Flask\u4e2d\u5f88\u597d\u5730\u96c6\u6210\u4e86Jinja2\u3002</p> <p>\u96c6\u6210\u4ee5\u540e\uff0c\u60f3\u8981\u5728Flask\u4e2d\u4f7f\u7528Jinja2\uff0c\u53ea\u9700\u4f7f\u7528Flask\u5305\u4e0b\u7684render_template\u51fd\u6570\u8bbf\u95ee\u6a21\u677f\u5373\u53ef\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#1\u57fa\u672c\u529f\u80fd\u6f14\u793a","title":"1.\u57fa\u672c\u529f\u80fd\u6f14\u793a","text":"<p>\u521b\u5efa\u4e00\u4e2a\u6700\u7b80\u5355\u7684flask-demo\u7a0b\u5e8f</p> <p>\u5b89\u88c5\u865a\u62df\u73af\u5883</p> <pre><code>$ sudo apt-get install python3-venv\n$ mkdir flask-sample1/\n$ cd flask-sample1/\n$ mkdir static\n$ mkdir templates\n\n#\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\n+ flask-sample1 - static\n    - templates\n\n#\u521b\u5efa\u865a\u62df\u73af\u5883\n# \u4f7f\u7528Python 3\u81ea\u5e26\u7684 venv \u521b\u5efa\u865a\u62df\u73af\u5883\n$ python3 -m venv venv\n$ source venv/bin/activate\n(venv) $ pip install flask\n(venv) $ pip freeze\n(venv) $ python -c \"import flask\"\n</code></pre> <p>vim app.py</p> <p>app.py\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>from flask import Flask\napp = Flask(__name__)\n@app.route('/')\ndef hello_world():\nreturn 'Hello World!'\nif __name__ == '__main__':\napp.run(port=9011, host=\"0.0.0.0\")  # \u5982\u679c\u4e0d\u662f\u672c\u5730\u8bbf\u95ee\u9700\u8981\u52a0IP\n</code></pre> <pre><code>flask run --host=0.0.0.0 --port=9011\n</code></pre> <p>flask-sample1/templates/simple.html \u5982\u4e0b</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;!-- \u4f7f\u7528\u8fc7\u6ee4\u5668\u5904\u7406\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c --&gt;\n&lt;title&gt;{{ title | trim }}&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;!-- \u6ce8\u91ca --&gt;\n        {# This is a Comment #}\n        &lt;ul id=\"navigation\"&gt;\n&lt;!-- for\u8bed\u53e5\uff0c\u4ee5endfor\u7ed3\u675f --&gt;\n            {% for item in items %}\n                &lt;!-- \u8bbf\u95ee\u53d8\u91cf\u7684\u5c5e\u6027 --&gt;\n&lt;li&gt;&lt;a href=\"{{ item.href }}\"&gt;{{ item['caption'] }}&lt;/a&gt;&lt;/li&gt;\n            {% endfor %}\n        &lt;/ul&gt;\n&lt;p&gt;{{ content }}&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u5728\u8fd9\u4e2aHTML\u6a21\u677f\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528for\u5faa\u73af\u904d\u5386\u4e00\u4e2a\u5217\u8868\uff0c\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u9879\u662f\u4e00\u4e2a\u5b57\u5178\u3002 \u5b57\u5178\u4e2d\u5305\u542b\u4e86\u6587\u5b57\u548c\u8fde\u63a5\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u5b57\u5178\u4e2d\u7684\u6570\u636e\u6e32\u67d3\u6210HTML\u7684\u8d85\u94fe\u63a5\u3002\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u4f1a\u4f7f\u7528Jinja2\u63d0\u4f9b\u7684\u8fc7\u6ee4\u5668trim\u5220\u9664title\u4e2d\u7684\u7a7a\u683c\u3002</p> <p>\u4fee\u6539app.py\u6587\u4ef6 <pre><code>from flask import Flask, render_template\napp = Flask(__name__)\n@app.route('/')\ndef hello_world():\ntitle = \"Title  H   \"\nitems = [{'href': 'a.com', 'caption': 'ACaption'}, {'href': 'b.com', 'caption': 'Bcaption'}]\ncontent = \"This is content\"\nreturn render_template('simple.html', **locals())\nif __name__ == '__main__':\napp.run()\n</code></pre></p> <p>\u6267\u884c\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u6e32\u67d3\u6a21\u677f\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>$ curl http://127.0.0.1:5000/\n</code></pre> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;!-- \u4f7f\u7528\u8fc7\u6ee4\u5668\u5904\u7406\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c --&gt;\n&lt;title&gt;Title  H&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;!-- \u6ce8\u91ca --&gt;\n&lt;ul id=\"navigation\"&gt;\n&lt;!-- for\u8bed\u53e5\uff0c\u4ee5endfor\u7ed3\u675f --&gt;\n&lt;!-- \u8bbf\u95ee\u53d8\u91cf\u7684\u5c5e\u6027 --&gt;\n&lt;li&gt;&lt;a href=\"a.com\"&gt;ACaption&lt;/a&gt;&lt;/li&gt;\n&lt;!-- \u8bbf\u95ee\u53d8\u91cf\u7684\u5c5e\u6027 --&gt;\n&lt;li&gt;&lt;a href=\"b.com\"&gt;Bcaption&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;This is content&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528Jinja2\u6e32\u67d3\u6a21\u677f\u4ee5\u540etitle\u4e2d\u7684\u7a7a\u683c\u5df2\u7ecf\u88ab\u5220\u9664\uff0cfor\u5faa\u73af\u4e5f\u6b63\u786e\u6e32\u67d3\u4e86\u591a\u4e2a\u8d85\u94fe\u63a5\u6807\u7b7e\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#2\u7ee7\u627f\u529f\u80fd\u6f14\u793a","title":"2.\u7ee7\u627f\u529f\u80fd\u6f14\u793a","text":"<p>\u4e3a\u4e86\u6f14\u793a\u7ee7\u627f\u7684\u529f\u80fd\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u4e24\u4e2aHTML\u6587\u4ef6\uff0c\u5206\u522b\u662fbase.html\u548cindex.html\u3002</p> <p>base.html\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;!-- \u5b9a\u4e49\u4ee3\u7801\u5757\uff0c\u53ef\u4ee5\u5728\u5b50\u6a21\u5757\u4e2d\u91cd\u8f7d --&gt;\n        {% block head %}\n            &lt;link rel=\"stylesheet\" href=\"style.css\" /&gt;\n&lt;title&gt;{% block title %}{% endblock %} - My Webpage&lt;/title&gt;\n        {% endblock %}\n    &lt;/head&gt;\n&lt;body&gt;\n&lt;div id=\"content\"&gt;\n&lt;!-- \u5b9a\u4e49\u4ee3\u7801\u5757\uff0c\u6ca1\u6709\u63d0\u4f9b\u9ed8\u8ba4\u5185\u5bb9 --&gt;\n            {% block content %}\n            {% endblock %}\n        &lt;/div&gt;\n&lt;div id=\"footer\"&gt;\n&lt;!-- \u5b9a\u4e49\u4ee3\u7801\u5757\uff0c\u6ca1\u6709\u63d0\u4f9b\u9ed8\u8ba4\u5185\u5bb9 --&gt;\n            {% block footer %}\n            {% endblock %}\n        &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>index.html\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>&lt;!-- \u5199\u5728\u5f00\u5934\uff0c\u7528\u4ee5\u7ee7\u627f --&gt;\n{% extends \"base.html\" %}\n\n&lt;!-- \u6807\u9898\u6a21\u5757\u88ab\u91cd\u8f7d --&gt;\n{% block title %}Index{% endblock %}\n\n&lt;!-- head\u6a21\u5757\u88ab\u91cd\u8f7d\uff0c\u5e76\u4e14\uff0c\u4f7f\u7528super\u7ee7\u627f\u4e86base.html\u4e2dhead\u7684\u5185\u5bb9 --&gt;\n{% block head %}\n    {{ super() }}\n&lt;style type=\"text/css\"&gt; .important { color: #336699; } &lt;/style&gt;\n{% endblock %}\n\n&lt;!-- \u8986\u76d6\u4e86content\u6a21\u5757 --&gt;\n{% block content %}\n&lt;h1&gt;This is h1 content&lt;/h1&gt;\n&lt;p class=\"important\"&gt;Welcome on my awesome homepage.&lt;/p&gt;\n{% endblock %}\n</code></pre> <p>\u6211\u4eec\u4f7f\u7528\u4e0b\u9762\u7684Python\u4ee3\u7801\u6e32\u67d3Jinja2\u6a21\u677f\uff1a</p> <pre><code>from flask import Flask, render_template\napp = Flask(__name__)\n@app.route('/')\ndef hello_world():\nreturn render_template('index.html')\nif __name__ == '__main__':\napp.run()\n</code></pre> <p>\u6e32\u67d3\u4ee5\u540e\u751f\u6210\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>&lt;!-- \u5199\u5728\u5f00\u5934\uff0c\u7528\u4ee5\u7ee7\u627f --&gt;\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;!-- \u5b9a\u4e49\u4ee3\u7801\u5757\uff0c\u53ef\u4ee5\u5728\u5b50\u6a21\u5757\u4e2d\u91cd\u8f7d --&gt;\n&lt;link rel=\"stylesheet\" href=\"style.css\" /&gt;\n&lt;title&gt;Index - My Webpage&lt;/title&gt;\n&lt;style type=\"text/css\"&gt; .important { color: #336699; } &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div id=\"content\"&gt;\n&lt;!-- \u5b9a\u4e49\u4ee3\u7801\u5757\uff0c\u6ca1\u6709\u63d0\u4f9b\u9ed8\u8ba4\u5185\u5bb9 --&gt;\n&lt;h1&gt;This is h1 content&lt;/h1&gt;\n&lt;p class=\"important\"&gt;Welcome on my awesome homepage.&lt;/p&gt;\n&lt;/div&gt;\n&lt;div id=\"footer\"&gt;\n&lt;!-- \u5b9a\u4e49\u4ee3\u7801\u5757\uff0c\u6ca1\u6709\u63d0\u4f9b\u9ed8\u8ba4\u5185\u5bb9 --&gt;\n&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u4ece\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u53ef\u4ee5\u770b\u5230\uff1a</p> <p>1\uff09\u6211\u4eec\u6e32\u67d3\u7684\u662findex.html\uff0c\u5e76\u6ca1\u6709\u76f4\u63a5\u6e32\u67d3base.html\uff0c\u4f46\u662f\u6700\u540e\u751f\u6210\u7684\u6a21\u677f\u4e2d\u5305\u542b\u4e86\u5b8c\u6574\u7684HTML\u6846\u67b6\uff0c\u8fd9\u4e5f\u662f\u7ee7\u627f\u5e7f\u6cdb\u7684\u4f7f\u7528\u573a\u666f\uff1b</p> <p>2\uff09\u6211\u4eec\u867d\u7136\u5728index.html\u4e2d\u5b9a\u4e49\u4e86title\u5757\uff0c\u4f46\u662f\uff0c\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528{{super\uff08\uff09}}\u5f15\u7528\u4e86base.html\u4e2d\u7684HEAD\u5757\uff0c\u56e0\u6b64\uff0c\u6700\u540e\u6e32\u67d3\u7684\u7ed3\u679c\u4e2d\u5305\u542b\u4e86base.html\u4e2d\u7684head\u5757\u548cindex.html\u4e2d\u7684head\u5757\u3002 \u4f8b\u5982\uff0c\u6700\u540e\u6e32\u67d3\u7684\u7ed3\u679c\u4e2dtitle\u6807\u7b7e\u7684\u5185\u5bb9\u662f\u201cIndex-My Webpage\u201d\uff0c\u8fd9\u4e2a\u5b57\u7b26\u4e32\u5c31\u6765\u81eaindex.html\u548cbase.html\uff1b</p> <p>3\uff09\u6211\u4eec\u5728index.html\u4e2d\u91cd\u65b0\u5b9a\u4e49\u4e86content\u5757\u7684\u5185\u5bb9\uff0c\u56e0\u6b64\uff0c\u6700\u540e\u751f\u6210\u7684\u6587\u6863\u4e2d\u5728\u6b63\u786e\u4f4d\u7f6e\u663e\u793a\u4e86content\u5757\u7684\u5185\u5bb9\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#144-\u6848\u4f8b\u4f7f\u7528jinja2\u751f\u6210html\u8868\u683c","title":"1.4.4 \u6848\u4f8b\uff1a\u4f7f\u7528Jinja2\u751f\u6210HTML\u8868\u683c","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/7.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/#1\u4f7f\u7528jinja2\u751f\u6210html\u8868\u683c","title":"1.\u4f7f\u7528Jinja2\u751f\u6210HTML\u8868\u683c","text":"<p>\u5982\u679c\u4e0d\u4f7f\u7528\u6a21\u677f\uff0c\u53ea\u80fd\u5728Python\u4ee3\u7801\u4e2d\u62fc\u63a5HTML\u4ee3\u7801\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#!/usr/bin/python\n# -*- coding: UTF-8 -*-\nfrom __future__ import print_function\nfrom __future__ import unicode_literals\nlinks = [{'title': u'\u676d\u5dde\u5730\u94c1\u4e09\u671f\u89c4\u5212\u6b63\u5f0f\u83b7\u6279 3\u53f7\u7ebf\u5373\u5c06\u4e0a\u9a6c',\n'href': 'http://zzhz.zjol.com.cn/system/2016/12/21/021404496.shtml'},\n{'title': u'\u6d89\u53ca\u623f\u5730\u4ea7\u7684\u56db\u4e2a\u5173\u952e\u70b9',\n'href': 'http://zzhz.zjol.com.cn/system/2016/12/19/021402558.shtml'},\n{'title': u'\u6f6e\u9e23\u9879\u76ee\u5b9a\u540d\u201c\u51e4\u8d77\u6f6e\u9e23\u201d\uff0c\u7eff\u57ce\u8bf4\u7684\u201c\u676d\u5dde\u751f\u6d3b\u6837\u672c\u201d\u5c06\u5982\u4f55\u5448\u73b0',\n'href': 'http://zzhz.zjol.com.cn/system/2016/12/19/021402558.shtml'}]\ncontent = \"\"\"\n&lt;html&gt;\n    &lt;body&gt;\n        &lt;table&gt;\n\"\"\"\nfor index, link in enumerate(links, 1):\nitem = \"&lt;tr&gt;&lt;td&gt;{0}&lt;/td&gt;&lt;td&gt;&lt;a href = '{1}'&gt;{2}&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;\\n\".format(\nindex, link['href'], link['title'])\ncontent += item\ncontent += \"\"\"\n        &lt;/table&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n\"\"\"\nprint(content)\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u5c06\u4e1a\u52a1\u903b\u8f91\u548c\u8868\u73b0\u903b\u8f91\u6df7\u5408\u5728\u4e00\u8d77\uff0c\u663e\u5f97\u6bd4\u8f83\u6df7\u4e71\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u4f7f\u7528Jinja2\u6a21\u677f\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u4f7f\u7528Jinja2\u4ee5\u540e\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6a21\u677f\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6a21\u677f\u7684\u540d\u79f0\u4e3ahzfc.html\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>&lt;html&gt;\n&lt;body&gt;\n&lt;table&gt;\n            {% for item in items %}\n            &lt;tr&gt;\n&lt;td&gt;{{ loop.index }}&lt;/td&gt;\n&lt;td&gt;&lt;a href = \"{{ item['href'] }}\"&gt;{{ item['title'] }}&lt;/a&gt;&lt;/td&gt;\n&lt;/tr&gt;\n            {% endfor %}\n        &lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u4f7f\u7528\u6a21\u677f\u4ee5\u540e\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728Python\u4ee3\u7801\u4e2d\u8c03\u7528\u6e32\u67d3\u51fd\u6570\u5373\u53ef\uff0c\u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u75284.4.3\u8282\u4e2d\u7684\u8f85\u52a9\u51fd\u6570render\u3002\u6e32\u67d3\u6a21\u677f\u7684Python\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code># -*- coding: UTF-8 -*-\nimport jinja2\nlinks = [\n{'title': u'\u676d\u5dde\u5730\u94c1\u4e09\u671f\u89c4\u5212\u6b63\u5f0f\u83b7\u6279 3\u53f7\u7ebf\u5373\u5c06\u4e0a\u9a6c', 'href': 'http://zzhz.zjol.com.cn/system/2016/12/21/021404496.shtml'},\n{'title': u'\u6d89\u53ca\u623f\u5730\u4ea7\u7684\u56db\u4e2a\u5173\u952e\u70b9', 'href': 'http://zzhz.zjol.com.cn/system/2016 /12/19/021402558.shtml'},\n{'title': u'\u6f6e\u9e23\u9879\u76ee\u5b9a\u540d\u201c\u51e4\u8d77\u6f6e\u9e23\u201d\uff0c\u7eff\u57ce\u8bf4\u7684\u201c\u676d\u5dde\u751f\u6d3b\u6837\u672c\u201d\u5c06\u5982\u4f55\u5448\u73b0', 'href': 'http://zzhz.zjol.com.cn/system/2016/12/19/021402558.shtml'}\n]\nenv = jinja2.Environment(loader=jinja2.FileSystemLoader('.'))\ntemplate = env.get_template('hzfc.html')\ncontent = template.render(items=links)\nprint(content)\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u6211\u4eec\u5c06\u4e1a\u52a1\u903b\u8f91\u4e0e\u8868\u73b0\u903b\u8f91\u5206\u79bb\u4ee5\u540e\uff0c\u4ee3\u7801\u81ea\u7136\u5c31\u53d8\u5f97\u6e05\u6670\u6613\u61c2\u3001\u6613\u4e8e\u7ef4\u62a4\u4e86\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/","title":"8.Linux\u7cfb\u7edf\u7ba1\u7406","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#1\u6587\u4ef6\u8bfb\u5199","title":"1.\u6587\u4ef6\u8bfb\u5199","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#11-python\u5185\u7f6e\u7684open\u51fd\u6570","title":"1.1 Python\u5185\u7f6e\u7684open\u51fd\u6570","text":"<p>\u5728Python\u4e2d\uff0c\u8981\u5bf9\u4e00\u4e2a\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\uff0c\u53ea\u9700\u8981\u4f7f\u7528\u5185\u7f6e\u7684open\u51fd\u6570\u6253\u5f00\u6587\u4ef6\u5373\u53ef\u3002open\u51fd\u6570\u63a5\u53d7\u6587\u4ef6\u540d\u548c\u6253\u5f00\u6a21\u5f0f\u4f5c\u4e3a\u53c2\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8c61\u3002\u5de5\u7a0b\u5e08\u901a\u8fc7\u6587\u4ef6\u5bf9\u8c61\u6765\u64cd\u4f5c\u6587\u4ef6\uff0c\u5b8c\u6210\u4ee5\u540e\uff0c\u8c03\u7528\u6587\u4ef6\u5bf9\u8c61\u7684close\u65b9\u6cd5\u5173\u95ed\u6587\u4ef6\u5373\u53ef\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u6709\u4e00\u4e2a\u540d\u4e3adata.txt\u7684\u6587\u4ef6\uff0c\u5b83\u7684\u5185\u5bb9\u5982\u4e0b</p> <pre><code>Beautiful is better than ugly.\nExplicit is better than implicit.\nSimple is better than complex.\nComplex is better than complicated.\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u4f7f\u7528open\u51fd\u6570\u6253\u5f00\u6587\u4ef6\uff0c\u8c03\u7528\u6587\u4ef6\u5bf9\u8c61\u7684read\u65b9\u6cd5\u8bfb\u53d6\u6587\u4ef6\u7684\u6240\u6709\u5185\u5bb9\uff0c\u5b8c\u6210\u4ee5\u540e\uff0c\u8c03\u7528\u6587\u4ef6\u5bf9\u8c61\u7684close\u65b9\u6cd5\u5173\u95ed\u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [1]: f = open('data.txt')\nIn [2]: print(f.read())\nBeautiful is better than ugly.\nExplicit is better than implicit.\nSimple is better than complex.\nComplex is better than complicated.\n\nIn [3]: f.close()\n</code></pre> <p>\u88681-1\u3000\u6587\u4ef6\u7684\u6253\u5f00\u6a21\u5f0f</p> \u6a21\u5f0f \u542b\u4e49 r \u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\u3002\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u629b\u51faFileNotFoundError\u5f02\u5e38 rb \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u53ea\u8bfb\u3002\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u5f00\u5934\u3002\u8fd9\u662f\u9ed8\u8ba4\u6a21\u5f0f\u3002 r+ \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u5f00\u5934\u3002 rb+ \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u5f00\u5934\u3002 w \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u53ea\u7528\u4e8e\u5199\u5165\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\u5219\u5c06\u5176\u8986\u76d6\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u3002 wb \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u53ea\u7528\u4e8e\u5199\u5165\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\u5219\u5c06\u5176\u8986\u76d6\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u3002 w+ \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\u5219\u5c06\u5176\u8986\u76d6\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u3002 wb+ \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\u5219\u5c06\u5176\u8986\u76d6\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u3002 x \u521b\u5efa\u4e00\u4e2a\u65b0\u6587\u4ef6\uff0c\u5982\u679c\u6587\u4ef6\u5b58\u5728\uff0c\u629b\u51faFileExistsError\u5f02\u5e38 a \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8ffd\u52a0\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u65b0\u7684\u5185\u5bb9\u5c06\u4f1a\u88ab\u5199\u5165\u5230\u5df2\u6709\u5185\u5bb9\u4e4b\u540e\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u8fdb\u884c\u5199\u5165\u3002 ab \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8ffd\u52a0\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u65b0\u7684\u5185\u5bb9\u5c06\u4f1a\u88ab\u5199\u5165\u5230\u5df2\u6709\u5185\u5bb9\u4e4b\u540e\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u8fdb\u884c\u5199\u5165\u3002 a+ \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002\u6587\u4ef6\u6253\u5f00\u65f6\u4f1a\u662f\u8ffd\u52a0\u6a21\u5f0f\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002 ab+ \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8ffd\u52a0\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002 <p>\u4e0b\u9762\u7684\u4ee3\u7801\u5206\u522b\u6f14\u793a\uff0c\u6253\u5f00\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u6587\u4ef6\u65f6'w'\u6a21\u5f0f\u4e0e'x'\u6a21\u5f0f\u7684\u533a\u522b\uff1a</p> <pre><code>In [4]: f = open('data1.txt', 'w')\nIn [5]: f.write('hello, world')\nOut[5]: 12\nIn [6]: f.close()\nIn [7]: f = open('data1.txt', 'x')\n-------------------------------------------------\nFileExistsError        Traceback (most recent call last)\n&lt;ipython-input-16-e24c4c04f3d8&gt; in &lt;module&gt;()\n----&gt; 1 f = open('data1.txt', 'x')\nFileExistsError: [Errno 17] File exists: 'data1.txt'\nIn [8]: f = open('data2.txt', 'x')\nIn [9]: f.write('hello, world')\nOut[9]: 12\nIn [10]: f.close()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#12-\u907f\u514d\u6587\u4ef6\u53e5\u67c4\u6cc4\u9732","title":"1.2 \u907f\u514d\u6587\u4ef6\u53e5\u67c4\u6cc4\u9732","text":"<p>\u4e3a\u4e86\u907f\u514d\u6253\u5f00\u6587\u4ef6\u540e\u6ca1\u6709\u53ca\u65f6\u5173\u95ed\uff0c\u5927\u591a\u6570\u7f16\u7a0b\u8bed\u8a00\u4e2d\u90fd\u4f7f\u7528finally\u5173\u95ed\u6587\u4ef6\u53e5\u67c4\u3002\u5728Python\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528finally\u8bed\u53e5\u6765\u4fdd\u8bc1\uff0c\u65e0\u8bba\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u6587\u4ef6\u90fd\u4f1a\u88ab\u5173\u95ed\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>try:\nf = open('data.txt')\nprint(f.read())\nfinally:\nf.close()\n</code></pre> <p>\u5982\u679c\u5de5\u7a0b\u5e08\u5728\u53ef\u4ee5\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u4e86finally\u8bed\u53e5\uff0c\u5c06\u4f1a\u88ab\u8ba4\u4e3a\u4ee3\u7801\u7f16\u5199\u5f97\u4e0d\u591fPythonic\u3002</p> <p>\u5bf9\u4e8e\u6587\u4ef6\u6253\u5f00\u3001\u5904\u7406\u3001\u518d\u5173\u95ed\u7684\u903b\u8f91\uff0c\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p><pre><code>with open('data.txt') as f:\nprint(f.read())\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u4ee5\u540e\u4ee3\u7801\u884c\u6570\u53d8\u5c11\u4e86\u3002\u5728Python\u4e2d\uff0c\u5982\u679c\u60f3\u628a\u4ee3\u7801\u5199\u5f97\u7b80\u6d01\u4f18\u7f8e\uff0c\u5c31\u5e94\u8be5\u5728\u4fdd\u8bc1\u53ef\u8bfb\u6027\u7684\u524d\u63d0\u4e0b\u4ee3\u7801\u884c\u6570\u8d8a\u5c11\u8d8a\u597d\u3002</p> <p>with\u5de5\u4f5c\u539f\u7406</p> <ol> <li> <p>\u7d27\u8ddfwith\u540e\u9762\u7684\u8bed\u53e5\u88ab\u6c42\u503c\u540e\uff0c\u8fd4\u56de\u5bf9\u8c61\u7684\u201center()\u201d\u65b9\u6cd5\u88ab\u8c03\u7528\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5c06\u88ab\u8d4b\u503c\u7ed9as\u540e\u9762\u7684\u53d8\u91cf\uff1b </p> </li> <li> <p>\u5f53with\u540e\u9762\u7684\u4ee3\u7801\u5757\u5168\u90e8\u88ab\u6267\u884c\u5b8c\u4e4b\u540e\uff0c\u5c06\u8c03\u7528\u524d\u9762\u8fd4\u56de\u5bf9\u8c61\u7684\u201cexit()\u201d\u65b9\u6cd5\u3002</p> </li> </ol> <pre><code>class Sample:\ndef __enter__(self):\nprint(\"in __enter__\")\nreturn \"Foo\"\ndef __exit__(self, exc_type, exc_val, exc_tb):\nprint(\"in __exit__\")\ndef get_sample():\nreturn Sample()\nwith get_sample() as sample:\nprint(\"Sample: \", sample)\n</code></pre> <p>with\u8bed\u53e5\u4e3a\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\uff0c__enter__\u548c __exit__\u4e24\u4e2a\u65b9\u6cd5\u5b9e\u73b0\uff0c\u4f7f\u7528with\u64cd\u4f5c\u6587\u4ef6\u4f1a\u81ea\u52a8\u5173\u95ed\u6587\u4ef6\u53e5\u67c4\uff0c\u65e0\u9700\u989d\u5916\u8fdb\u884cfile.close()</p> <p>\u81ea\u5b9a\u4e49\u6587\u4ef6\u64cd\u4f5c\u7684\u7c7b</p> <pre><code>class myopen:\ndef __init__(self,path,mode='r'):\nself.path = path\nself.mode = mode\ndef __enter__(self):\nprint('start')\nself.f = open(self.path,mode=self.mode)\nreturn self.f\ndef __exit__(self, exc_type, exc_val, exc_tb):\nself.f.close()\nprint('exit')\nwith myopen('userinfo','a') as f:\nf.write('hello,world')\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#13-\u5e38\u89c1\u7684\u6587\u4ef6\u64cd\u4f5c\u51fd\u6570","title":"1.3 \u5e38\u89c1\u7684\u6587\u4ef6\u64cd\u4f5c\u51fd\u6570","text":"\u6587\u4ef6\u64cd\u4f5c \u529f\u80fd\u63cf\u8ff0 file.read \u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u5185\u5bb9 file.readline \u4e00\u6b21\u8bfb\u53d6\u4e00\u884c file.readlines \u5c06\u6587\u4ef6\u5185\u5bb9\u5b58\u5230\u4e00\u4e2a\u5217\u8868\u4e2d\uff0c\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u884c\u5bf9\u5e94\u4e8e\u6587\u4ef6\u4e2d\u7684\u4e00\u884c\u3002 file.write \u5199\u5b57\u7b26\u4e32\u5230\u6587\u4ef6\u4e2d\uff0c\u5e76\u8fd4\u56de\u5199\u5165\u7684\u5b57\u7b26\u6570 file.writelines \u5199\u4e00\u4e2a\u5b57\u7b26\u4e32\u5217\u8868\u5230\u6587\u4ef6\u4e2d <p>\u6211\u4eec\u4f7f\u7528data.txt\u6587\u4ef6\uff0c\u5206\u522b\u6d4b\u8bd5\u8fd9\u4e09\u4e2a\u8bfb\u51fd\u6570\u7684\u6548\u679c\uff1a</p> <p><pre><code>In [1]: f = open('data.txt')\nIn [2]: f.read()\nOut[2]: 'Beautiful is better than ugly.\\nExplicit is better than implicit.\\nSimple is better than complex.\\nComplex is better than complicated.\\n'\nIn [3]: f.seek(0)\nOut[3]: 0\nIn [4]: f.readline()\nOut[4]: 'Beautiful is better than ugly.\\n'\nIn [5]: f.seek(0)\nOut[5]: 0\nIn [6]: f.readlines()\nOut[6]:\n['Beautiful is better than ugly.\\n',\n'Explicit is better than implicit.\\n',\n'Simple is better than complex.\\n',\n'Complex is better than complicated.\\n']\n</code></pre> \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\uff0cread\u51fd\u6570\u548creadlines\u51fd\u6570\u90fd\u662f\u4e00\u6b21\u5c31\u5c06\u6240\u6709\u5185\u5bb9\u8bfb\u5165\u5230\u5185\u5b58\u4e2d\uff0c\u5bf9\u4e8e\u6587\u4ef6\u8f83\u5c0f\u7684\u60c5\u51b5\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u5904\u7406\u7684\u662f\u5927\u6587\u4ef6\uff0c\u8fd9\u79cd\u4f7f\u7528\u65b9\u5f0f\u4f1a\u5360\u7528\u5927\u91cf\u7684\u5185\u5b58\uff0c\u751a\u81f3\u6709\u53ef\u80fd\u56e0\u4e3a\u5185\u5b58\u5360\u7528\u592a\u591a\u51fa\u73b0Out-Of-Memory\u9519\u8bef\u3002</p> <p>\u4f9d\u7136\u4f7f\u7528IPython\u5bf9\u6587\u4ef6\u5bf9\u8c61\u7684\u5199\u5165\u51fd\u6570\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5e76\u5728\u5199\u5165\u5b8c\u6210\u4ee5\u540e\u4f7f\u7528Linux\u7684cat\u547d\u4ee4\u67e5\u770b\u6587\u4ef6\u5185\u5bb9\uff1a</p> <pre><code>In [1]: f = open('/tmp/data.txt', 'w')\nIn [2]: f.write('Beautiful is better than ugly.')\nOut[2]: 30\nIn [3]: f.writelines(['Explicit is better than implicit.', 'Simple is better than complex.'])\nIn [4]: ! cat /tmp/data.txt\nBeautiful is better than ugly.Explicit is better than implicit.Simple is better than complex.\n</code></pre> <p>\u5728Python\u4e2d\uff0c\u9664\u4e86\u4f7f\u7528\u6587\u4ef6\u5bf9\u8c61\u7684write\u51fd\u6570\u548cwritelines\u51fd\u6570\u5411\u6587\u4ef6\u5199\u5165\u6570\u636e\u4ee5\u5916\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528print\u51fd\u6570\u5c06\u8f93\u51fa\u7ed3\u679c\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002print\u51fd\u6570\u6bd4write\u548cwritelines\u51fd\u6570\u66f4\u52a0\u7075\u6d3b\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>from __future__ import print_function\nwith open('/tmp/data.txt', 'w') as f:\nprint(1, 2, 'hello, world', sep=\",\", file=f)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#14-python\u7684\u6587\u4ef6\u662f\u4e00\u4e2a\u53ef\u8fed\u4ee3\u5bf9\u8c61","title":"1.4 Python\u7684\u6587\u4ef6\u662f\u4e00\u4e2a\u53ef\u8fed\u4ee3\u5bf9\u8c61","text":"<p>Python\u7684for\u5faa\u73af\u6bd4\u5927\u5bb6\u5b9e\u9645\u770b\u5230\u7684\u8fd8\u8981\u901a\u7528\uff0c\u5b83\u4e0d\u4f46\u53ef\u4ee5\u904d\u5386\u5982\u5b57\u7b26\u4e32\u3001\u5217\u8868\u3001\u5143\u7ec4\u8fd9\u6837\u7684\u53ef\u8fed\u4ee3\u5e8f\u5217\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u8fed\u4ee3\u5668\u534f\u8bae\u904d\u5386\u53ef\u8fed\u4ee3\u5bf9\u8c61\u3002</p> <p>\u800cPython\u7684\u6587\u4ef6\u5bf9\u8c61\u5b9e\u73b0\u4e86\u8fed\u4ee3\u5668\u534f\u8bae\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5728for\u5faa\u73af\u4e2d\u904d\u5386\u6587\u4ef6\u5185\u5bb9\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cPython\u7684for\u5faa\u73af\u4f7f\u7528\u8fed\u4ee3\u5668\u534f\u8bae\u8bbf\u95ee\u5bf9\u8c61\uff0c\u53ea\u8981\u5bf9\u8c61\u5b9e\u73b0\u4e86\u8fed\u4ee3\u5668\u534f\u8bae\uff0c\u5c31\u53ef\u4ee5\u5728Python\u7684for\u5faa\u73af\u4e2d\u904d\u5386\u8be5\u5bf9\u8c61\u3002</p> <p>\u4f7f\u7528for\u5faa\u73af\u904d\u5386\u6587\u4ef6\u5185\u5bb9\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>with open('data.txt') as inf:\nfor line in inf:\nprint(line.upper())\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#15-\u6848\u4f8b\u5c06\u6587\u4ef6\u4e2d\u6240\u6709\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\u53d8\u6210\u5927\u5199","title":"1.5 \u6848\u4f8b\uff1a\u5c06\u6587\u4ef6\u4e2d\u6240\u6709\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\u53d8\u6210\u5927\u5199","text":"<pre><code>with open('data.txt') as inf, open('out.txt', 'w') as outf:\nfor line in inf:\noutf.write(\" \".join([word.capitalize() for word in line.split()]))\noutf.write(\"\\n\")\n</code></pre> <p>\u5904\u7406\u5b8c\u6210\u4ee5\u540e\uff0cout.txt\u6587\u4ef6\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>Beautiful Is Better Than Ugly.\nExplicit Is Better Than Implicit.\nSimple Is Better Than Complex.\nComplex Is Better Than Complicated.\n</code></pre> <p>\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528print\u51fd\u6570\u6765\u7b80\u5316\u8f93\u51fa\u8bed\u53e5\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>from __future__ import print_function\nwith open('data.txt') as inf, open('out.txt', 'w') as outf:\nfor line in inf:\nprint(*[word.capitalize() for word in line.split()], file=outf)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#2\u6587\u4ef6\u4e0e\u6587\u4ef6\u8def\u5f84\u7ba1\u7406","title":"2.\u6587\u4ef6\u4e0e\u6587\u4ef6\u8def\u5f84\u7ba1\u7406","text":"<p>\u4ecb\u7ecdos\u6a21\u5757\u7684\u5b50\u6a21\u5757os.path\uff0cos.path\u6a21\u5757\u4e0b\u7684\u51fd\u6570\u6bd4\u8f83\u5e38\u7528\uff0c\u800c\u4e14\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u5f88\u9002\u5408\u7528\u6765\u4f5c\u4e3a\u5b66\u4e60os\u6a21\u5757\u7684\u5207\u5165\u70b9\u3002</p> \u51fd\u6570 \u8bf4\u660e os.popen('id').read() \u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u5f97\u5230\u8fd4\u56de\u7ed3\u679c os.system() \u5f97\u5230\u8fd4\u56de\u72b6\u6001 \u8fd4\u56de\u65e0\u6cd5\u622a\u53d6 os.name \u8fd4\u56de\u7cfb\u7edf\u5e73\u53f0 Linux/Unix\u7528\u6237\u662f'posix' os.getenv() \u8bfb\u53d6\u73af\u5883\u53d8\u91cf os.putenv() \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf os.getcwd() \u5f53\u524d\u5de5\u4f5c\u8def\u5f84 os.stat('path/filename') \u83b7\u53d6\u6587\u4ef6/\u76ee\u5f55\u4fe1\u606f os.chdir() \u6539\u53d8\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 os.walk('/root/') \u9012\u5f52\u8def\u5f84 os.environ['HOME'] \u67e5\u770b\u7cfb\u7edf\u73af\u5883\u53d8\u91cf os.statvfs(\"/\") \u83b7\u53d6\u78c1\u76d8\u4fe1\u606f os.path.abspath(path) \u8fd4\u56de\u7edd\u5bf9\u8def\u5f84 os.path.basename(path) \u8fd4\u56de\u6587\u4ef6\u540d os.path.commonprefix(list) \u8fd4\u56delist(\u591a\u4e2a\u8def\u5f84)\u4e2d\uff0c\u6240\u6709path\u5171\u6709\u7684\u6700\u957f\u7684\u8def\u5f84 os.path.dirname(path) \u8fd4\u56de\u6587\u4ef6\u6240\u5728\u8def\u5f84\uff08\u76ee\u5f55\uff09 os.path.dirname(os.path.abspath(file)) \u8fd4\u56de\u6587\u4ef6\u5f53\u524d\u5de5\u4f5c\u8def\u5f84 os.path.exists(path) \u8def\u5f84\u5b58\u5728\u5219\u8fd4\u56deTrue,\u8def\u5f84\u635f\u574f\u8fd4\u56deFalse os.path.lexists \u8def\u5f84\u5b58\u5728\u5219\u8fd4\u56deTrue,\u8def\u5f84\u635f\u574f\u4e5f\u8fd4\u56deTrue os.path.expanduser(path) \u628apath\u4e2d\u5305\u542b\u7684\"<sub>\"\u548c\"</sub>user\"\u8f6c\u6362\u6210\u7528\u6237\u76ee\u5f55 os.path.expandvars(path) \u6839\u636e\u73af\u5883\u53d8\u91cf\u7684\u503c\u66ff\u6362path\u4e2d\u5305\u542b\u7684\u201d\\(name\u201d\u548c\u201d\\)\u201d os.path.getatime(path) \u8fd4\u56de\u6700\u540e\u4e00\u6b21\u8fdb\u5165\u6b64path\u7684\u65f6\u95f4 os.path.getmtime(path) \u8fd4\u56de\u5728\u6b64path\u4e0b\u6700\u540e\u4e00\u6b21\u4fee\u6539\u7684\u65f6\u95f4 os.path.getctime(path) \u8fd4\u56depath\u7684\u5927\u5c0f os.path.getsize(path) \u8fd4\u56de\u6587\u4ef6\u5927\u5c0f\uff0c\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u5c31\u8fd4\u56de\u9519\u8bef os.path.isabs(path) \u5224\u65ad\u662f\u5426\u4e3a\u7edd\u5bf9\u8def\u5f84 os.path.isfile(path) \u5224\u65ad\u8def\u5f84\u662f\u5426\u4e3a\u6587\u4ef6 os.path.isdir(path) \u5224\u65ad\u8def\u5f84\u662f\u5426\u4e3a\u76ee\u5f55 os.path.islink(path) \u5224\u65ad\u8def\u5f84\u662f\u5426\u4e3a\u94fe\u63a5 os.path.ismount(path) \u5224\u65ad\u8def\u5f84\u662f\u5426\u4e3a\u6302\u8f7d\u70b9\uff08\uff09 os.path.ismount(path) \u5224\u65ad\u8def\u5f84\u662f\u5426\u4e3a\u6302\u8f7d\u70b9\uff08\uff09 os.path.join(path1[, path2[, ...]]) \u628a\u76ee\u5f55\u548c\u6587\u4ef6\u540d\u5408\u6210\u4e00\u4e2a\u8def\u5f84 os.path.normcase(path) \u8f6c\u6362path\u7684\u5927\u5c0f\u5199\u548c\u659c\u6760 os.path.normpath(path) \u89c4\u8303path\u5b57\u7b26\u4e32\u5f62\u5f0f os.path.realpath(path) \u8fd4\u56depath\u7684\u771f\u5b9e\u8def\u5f84 os.path.relpath(path[, start]) \u4ecestart\u5f00\u59cb\u8ba1\u7b97\u76f8\u5bf9\u8def\u5f84 os.path.samefile(path1, path2) \u5224\u65ad\u76ee\u5f55\u6216\u6587\u4ef6\u662f\u5426\u76f8\u540c os.path.sameopenfile(fp1, fp2) \u5224\u65adfp1\u548cfp2\u662f\u5426\u6307\u5411\u540c\u4e00\u6587\u4ef6 os.path.samestat(stat1, stat2) \u5224\u65adstat tuple stat1\u548cstat2\u662f\u5426\u6307\u5411\u540c\u4e00\u4e2a\u6587\u4ef6 os.path.split(path) \u628a\u8def\u5f84\u5206\u5272\u6210dirname\u548cbasename\uff0c\u8fd4\u56de\u4e00\u4e2a\u5143\u7ec4 os.path.splitdrive(path) \u4e00\u822c\u7528\u5728windows\u4e0b\uff0c\u8fd4\u56de\u9a71\u52a8\u5668\u540d\u548c\u8def\u5f84\u7ec4\u6210\u7684\u5143\u7ec4 os.path.splitext(path) \u5206\u5272\u8def\u5f84\uff0c\u8fd4\u56de\u8def\u5f84\u540d\u548c\u6587\u4ef6\u6269\u5c55\u540d\u7684\u5143\u7ec4 os.path.splitunc(path) \u628a\u8def\u5f84\u5206\u5272\u4e3a\u52a0\u8f7d\u70b9\u4e0e\u6587\u4ef6 os.path.walk(path, visit, arg) \u904d\u5386path\uff0c\u8fdb\u5165\u6bcf\u4e2a\u76ee\u5f55\u90fd\u8c03\u7528visit\u51fd\u6570\uff0cvisit\u51fd\u6570\u5fc5\u987b\u6709"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#21-\u4f7f\u7528ospath\u8fdb\u884c\u8def\u5f84\u548c\u6587\u4ef6\u7ba1\u7406","title":"2.1 \u4f7f\u7528os.path\u8fdb\u884c\u8def\u5f84\u548c\u6587\u4ef6\u7ba1\u7406","text":"<p>\u524d\u8005\u83b7\u53d6\u5f53\u524d\u76ee\u5f55\uff0c\u540e\u8005\u7528\u6765\u5217\u51fa\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u548c\u6587\u4ef6\u5939</p> <pre><code>In [1]: import os\n\nIn [2]: os.getcwd()\nOut[2]: '/home/lmx/t'\nIn [3]: os.listdir('.')\nOut[3]:\n['dir1',\n 'dir3',\n 'c.txt',\n '2.jpg',\n 'a.py',\n 'a.txt',\n '1.jpg',\n 'b.txt',\n 'dir2',\n 'access.log']\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#1\u62c6\u5206\u8def\u5f84","title":"1.\u62c6\u5206\u8def\u5f84","text":"<p>os.path\u6a21\u5757\u7528\u6765\u5bf9\u6587\u4ef6\u548c\u8def\u5f84\u8fdb\u884c\u7ba1\u7406\uff0c\u663e\u7136\uff0c\u5b83\u4f1a\u5305\u542b\u5f88\u591a\u62c6\u5206\u8def\u5f84\u7684\u51fd\u6570\u3002os.path\u6a21\u5757\u4e2d\u4e0e\u62c6\u5206\u8def\u5f84\u76f8\u5173\u7684\u51fd\u6570\u6709\uff1a</p> <ul> <li> <p>split\uff1a\u8fd4\u56de\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c\u5305\u542b\u6587\u4ef6\u7684\u8def\u5f84\u4e0e\u6587\u4ef6\u540d\uff1b </p> </li> <li> <p>dirname\uff1a\u8fd4\u56de\u6587\u4ef6\u7684\u8def\u5f84\uff1b</p> </li> <li> <p>basename\uff1a\u8fd4\u56de\u6587\u4ef6\u7684\u6587\u4ef6\u540d\uff1b</p> </li> <li> <p>splitext\uff1a\u8fd4\u56de\u4e00\u4e2a\u9664\u53bb\u6587\u4ef6\u6269\u5c55\u540d\u7684\u90e8\u5206\u548c\u6269\u5c55\u540d\u7684\u4e8c\u5143\u7ec4\u3002</p> </li> </ul> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u6d4b\u8bd5\u4e86split\u3001dirname\u3001basename\u548csplitext\u8fd9\u51e0\u4e2a\u51fd\u6570\u7684\u529f\u80fd\uff1a</p> <pre><code>In [1]: import os\n\nIn [2]: path = \"/home/lmx/t/access.log\"\nIn [3]: os.path.split(path)\nOut[3]: ('/home/lmx/t', 'access.log')\nIn [4]: os.path.dirname(path)\nOut[4]: '/home/lmx/t'\nIn [5]: os.path.basename(path)\nOut[5]: 'access.log'\nIn [6]: os.path.splitext(path)\nOut[6]: ('/home/lmx/t/access', '.log')\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#2\u6784\u5efa\u8def\u5f84","title":"2.\u6784\u5efa\u8def\u5f84","text":"<p>os.path\u6a21\u5757\u4e5f\u5305\u542b\u4e86\u7528\u4ee5\u6784\u5efa\u8def\u5f84\u7684\u51fd\u6570\u3002\u5176\u4e2d\u6700\u5e38\u7528\u7684\u4fbf\u662fexpanduser\u3001abspath\u548cjoin\u51fd\u6570\uff1a</p> <ul> <li> <p>expanduser\uff1a\u5c55\u5f00\u7528\u6237\u7684HOME\u76ee\u5f55\uff0c\u5982<sub>\u3001</sub>username\uff1b</p> </li> <li> <p>abspath\uff1a\u5f97\u5230\u6587\u4ef6\u6216\u8def\u5f84\u7684\u7edd\u5bf9\u8def\u5f84\uff1b</p> </li> <li> <p>join\uff1a\u6839\u636e\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\uff0c\u4f7f\u7528\u4e0d\u540c\u7684\u8def\u5f84\u5206\u9694\u7b26\u62fc\u63a5\u8def\u5f84\u3002</p> </li> <li> <p>pardir: \u8fd4\u56de\u7236\u7ea7\u76ee\u5f55\uff08..\uff09</p> </li> </ul> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u6f14\u793a\u4e86\u5404\u4e2a\u51fd\u6570\u7684\u7528\u6cd5\uff1a</p> <pre><code>In [1]: import os\n\nIn [2]: os.getcwd()\nOut[2]: '/home/lmx/t'\nIn [3]: os.path.expanduser('~')\nOut[3]: '/home/lmx'\nIn [4]: os.path.expanduser('~mysql')\nOut[4]: '/home/mysql'\nIn [5]: os.path.expanduser('~lmx/t')\nOut[5]: '/home/lmx/t'\nIn [6]: os.path.abspath('.')\nOut[6]: '/home/lmx/t'\nIn [7]: os.path.abspath('..')\nOut[7]: '/home/lmx'\nIn [8]: os.path.abspath('../t/a.py')\nOut[8]: '/home/lmx/t/a.py'\nIn [9]: os.path.join('~', 't', 'a.py')\nOut[9]: '~/t/a.py'\nIn [10]: os.path.join(os.path.expanduser('~mysql'), 't', 'a.py')\nOut[10]: '/home/mysql/t/a.py'\n</code></pre> <p>\u524d\u9762\u4ecb\u7ecdos.path\u6a21\u5757\u6784\u5efa\u8def\u5f84\u65f6\uff0c\u4ecb\u7ecd\u4e86abspath\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7528\u6765\u8fd4\u56de\u4e00\u4e2a\u76f8\u5bf9\u8def\u5f84\u7684\u7edd\u5bf9\u8def\u5f84\u3002\u76f8\u5e94\u7684\uff0cos.path\u6a21\u5757\u4e5f\u5b58\u5728\u4e00\u4e2a\u51fd\u6570\u7528\u6765\u68c0\u67e5\u4e00\u4e2a\u8def\u5f84\u662f\u5426\u4e3a\u7edd\u5bf9\u8def\u5f84\u3002</p> <pre><code>In [11]: os.path.isabs('/home/lmx/t/a.py')\nOut[11]: True\n\nIn [12]: os.path.isabs('.')\nOut[12]: False\n</code></pre> <p>\u5728Python\u4ee3\u7801\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528__file__\u8fd9\u4e2a\u7279\u6b8a\u7684\u53d8\u91cf\u8868\u793a\u5f53\u524d\u4ee3\u7801\u6240\u5728\u7684\u6e90\u6587\u4ef6\u3002 \u5728\u7f16\u5199\u4ee3\u7801\u65f6\uff0c\u6709\u65f6\u9700\u8981\u5bfc\u5165\u5f53\u524d\u6e90\u6587\u4ef6\u7236\u76ee\u5f55\u4e0b\u7684\u8f6f\u4ef6\u5305\uff08\u5982\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\uff09\u3002\u56e0\u6b64\uff0c\u9700\u8981\u7528\u5230\u8fd9\u91cc\u7684\u8def\u5f84\u51fd\u6570\u83b7\u53d6\u6e90\u6587\u4ef6\u7684\u7236\u76ee\u5f55\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#!/usr/bin/python\n#-*- coding: UTF-8 -*-\nfrom __future__ import print_function\nimport os\nprint(\"current directory :\", os.getcwd())\npath = os.path.abspath(__file__)\nprint(\"full path of current file :\", path)\nprint(\"parent directory of current file :\",\nos.path.abspath(os.path.join(os.path.dirname(path), os.path.pardir)))\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>current directory : /home/lmx/t\nfull path of current file : /home/lmx/t/a.py\nparent directory of current file : /home/lmx\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#3\u83b7\u53d6\u6587\u4ef6\u5c5e\u6027","title":"3.\u83b7\u53d6\u6587\u4ef6\u5c5e\u6027","text":"<p>os.path\u6a21\u5757\u4e5f\u5305\u542b\u4e86\u82e5\u5e72\u51fd\u6570\u7528\u6765\u83b7\u53d6\u6587\u4ef6\u7684\u5c5e\u6027\uff0c\u5305\u62ec\u6587\u4ef6\u7684\u521b\u5efa\u65f6\u95f4\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6587\u4ef6\u7684\u5927\u5c0f\u7b49\uff1a</p> <ul> <li> <p>getatime\uff1a\u83b7\u53d6\u6587\u4ef6\u7684\u8bbf\u95ee\u65f6\u95f4\uff1b</p> </li> <li> <p>getmtime\uff1a\u83b7\u53d6\u6587\u4ef6\u7684\u4fee\u6539\u65f6\u95f4\uff1b</p> </li> <li> <p>getctime\uff1a\u83b7\u53d6\u6587\u4ef6\u7684\u521b\u5efa\u65f6\u95f4\uff1b</p> </li> <li> <p>getsize\uff1a\u83b7\u53d6\u6587\u4ef6\u7684\u5927\u5c0f\u3002</p> </li> </ul>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#4\u5224\u65ad\u6587\u4ef6\u7c7b\u578b","title":"4.\u5224\u65ad\u6587\u4ef6\u7c7b\u578b","text":"<p>os.path\u6a21\u5757\u4e5f\u63d0\u4f9b\u4e86\u82e5\u5e72\u51fd\u6570\u7528\u6765\u5224\u65ad\u8def\u5f84\u662f\u5426\u5b58\u5728\uff0c\u4ee5\u53ca\u8def\u5f84\u6240\u6307\u6587\u4ef6\u7684\u7c7b\u578b\uff0c\u8fd9\u4e9b\u5224\u65ad\u7c7b\u51fd\u6570\u4e00\u822c\u4ee5\u201cis\u201d\u5f00\u5934\uff0c\u5e76\u4e14\u8fd4\u56de\u4e00\u4e2aBoolean\u578b\u7ed3\u679c\u3002</p> <p>os.path\u6a21\u5757\u63d0\u4f9b\u7684\u5224\u65ad\u7c7b\u51fd\u6570\u5305\u62ec\uff1a</p> <ul> <li> <p>exists\uff1a\u53c2\u6570path\u6240\u6307\u5411\u7684\u8def\u5f84\u662f\u5426\u5b58\u5728\uff1b</p> </li> <li> <p>isfile\uff1a\u53c2\u6570path\u6240\u6307\u5411\u7684\u8def\u5f84\u5b58\u5728\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u6587\u4ef6\uff1b</p> </li> <li> <p>isdir\uff1a\u53c2\u6570path\u6240\u6307\u5411\u7684\u8def\u5f84\u5b58\u5728\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u6587\u4ef6\u5939\uff1b</p> </li> <li> <p>islink\uff1a\u53c2\u6570path\u6240\u6307\u5411\u7684\u8def\u5f84\u5b58\u5728\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u94fe\u63a5\uff1b</p> </li> <li> <p>ismount\uff1a\u53c2\u6570path\u6240\u6307\u5411\u7684\u8def\u5f84\u5b58\u5728\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u6302\u8f7d\u70b9\u3002</p> </li> </ul> <p>\u5145\u5206\u4f7f\u7528os.path\u6a21\u5757\u7684\u51fd\u6570\uff0c\u5c31\u80fd\u591f\u5b9e\u73b0\u5f88\u591a\u6709\u7528\u7684\u7cfb\u7edf\u7ba1\u7406\u529f\u80fd\u3002\u4f8b\u5982\uff1a</p> <p>1\uff09\u83b7\u53d6\u5f53\u524d\u7528\u6237home\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u6587\u4ef6\u5217\u8868\uff1a</p> <pre><code>import  os\n[item for item in os.listdir(os.path.expanduser('~')) if os.path.isfile(item)]\n</code></pre> <p>2\uff09\u83b7\u53d6\u5f53\u524d\u7528\u6237home\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u76ee\u5f55\u5217\u8868\uff1a</p> <pre><code>import os\n[item for item in os.listdir(os.path.expanduser('\uff5e')) if os.path.isdir(item)]\n</code></pre> <p>3\uff09\u83b7\u53d6\u5f53\u524d\u7528\u6237home\u76ee\u5f55\u4e0b\u6240\u6709\u76ee\u5f55\u7684\u76ee\u5f55\u540d\u5230\u7edd\u5bf9\u8def\u5f84\u4e4b\u95f4\u7684\u5b57\u5178\uff1a</p> <pre><code>import os\n{item: os.path.realpath(item) for item in os.listdir(os.path.expanduser('\uff5e')) if os.path.isdir(item)}\n</code></pre> <p>4\uff09\u83b7\u53d6\u5f53\u524d\u7528\u6237home\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u5230\u6587\u4ef6\u5927\u5c0f\u4e4b\u95f4\u7684\u5b57\u5178\uff1a</p> <pre><code>import os\n{item: os.path.getsize(item) for item in os.listdir(os.path.expanduser('\uff5e')) if os.path.isfile(item)}\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#22-\u4f7f\u7528os\u6a21\u5757\u7ba1\u7406\u6587\u4ef6\u548c\u76ee\u5f55","title":"2.2 \u4f7f\u7528os\u6a21\u5757\u7ba1\u7406\u6587\u4ef6\u548c\u76ee\u5f55","text":"<p>\u524d\u9762\u5df2\u7ecf\u4ecb\u7ecd\u4e86getcwd\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7528\u6765\u83b7\u53d6\u5f53\u524d\u76ee\u5f55\uff0c\u4e0e\u4e4b\u76f8\u5173\u7684\u662fchdir\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7528\u6765\u4fee\u6539\u5f53\u524d\u76ee\u5f55\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [1]: import os\n\nIn [2]: os.getcwd()\nOut[2]: '/home/lmx/t'\nIn [3]: os.chdir(os.path.expanduser('\uff5elmx'))\nIn [4]: os.getcwd()\nOut[4]: '/home/lmx'\n</code></pre> <p>os\u6a21\u5757\u4e5f\u5305\u542b\u4e86\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u64cd\u4f5c\u51fd\u6570\uff0c\u5305\u62ec\u521b\u5efa\u76ee\u5f55\u3001\u5220\u9664\u76ee\u5f55\u3001\u5220\u9664\u6587\u4ef6\u3001\u91cd\u547d\u540d\u6587\u4ef6\u7b49\u3002</p> <ul> <li> <p>unlink/remove\uff1a\u5220\u9664path\u8def\u5f84\u6240\u6307\u5411\u7684\u6587\u4ef6\uff1b</p> </li> <li> <p>rmdir\uff1a\u5220\u9664path\u8def\u5f84\u9501\u6307\u5411\u7684\u6587\u4ef6\u5939\uff0c\u8be5\u6587\u4ef6\u5939\u5fc5\u987b\u4e3a\u7a7a\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff1b</p> </li> <li> <p>mkdir\uff1a\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\uff1b</p> </li> <li> <p>rename\uff1a\u91cd\u547d\u540d\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u3002</p> </li> </ul> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u6f14\u793a\u4e86\u4f7f\u7528os\u6a21\u5757\u8fdb\u884c\u76ee\u5f55\u548c\u6587\u4ef6\u7ba1\u7406\u7684\u7528\u6cd5\uff1a</p> <pre><code>In [5]: ls\n1.jpg  2.jpg  access.log  a.py  a.txt  b.txt  c.txt  dir1/  dir2/  dir3/\n\nIn [6]: os.remove('1.jpg')\nIn [7]: os.unlink('2.jpg')\nIn [8]: os.rmdir('dir1')\nIn [9]: os.removedirs('dir2')\nIn [10]: ls\naccess.log  a.py  a.txt  b.txt  c.txt  dir3/\n\nIn [11]: os.mkdir('mydir')\nIn [12]: ls\naccess.log  a.py  a.txt  b.txt  c.txt  dir3/  mydir/\n\nIn [13]: os.rename('mydir', 'newdir')\nIn [14]: ls\naccess.log  a.py  a.txt  b.txt  c.txt  dir3/  newdir/\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u6d4b\u8bd5\u6587\u4ef6\u662f\u5426\u5b58\u5728","title":"\u6d4b\u8bd5\u6587\u4ef6\u662f\u5426\u5b58\u5728","text":"<pre><code>&gt;&gt;&gt; import os\n&gt;&gt;&gt; os.path.exists('/etc/passwd')\nTrue\n&gt;&gt;&gt; os.path.exists('/tmp/spam')\n&gt;&gt;&gt; # Is a regular file\n&gt;&gt;&gt; os.path.isfile('/etc/passwd')\nTrue\n\n&gt;&gt;&gt; # Is a directory\n&gt;&gt;&gt; os.path.isdir('/etc/passwd')\nFalse\n\n&gt;&gt;&gt; # Is a symbolic link\n&gt;&gt;&gt; os.path.islink('/usr/local/bin/python3')\nTrue\n\n&gt;&gt;&gt; # Get the file linked to\n&gt;&gt;&gt; os.path.realpath('/usr/local/bin/python3')\n'/usr/local/bin/python3.3'\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u76ee\u5f55\u6587\u4ef6\u8d4b\u6743","title":"\u76ee\u5f55\u6587\u4ef6\u8d4b\u6743","text":"<p>os\u6a21\u5757\u4e5f\u5305\u542b\u4e86\u4fee\u6539\u6587\u4ef6\u6743\u9650\u3001\u5224\u65ad\u6587\u4ef6\u6743\u9650\u7684\u51fd\u6570\uff0c\u5373chmod\u548caccess\u3002chmod\u7528\u6765\u4fee\u6539\u6587\u4ef6\u7684\u6743\u9650\uff0caccess\u7528\u6765\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5177\u6709\u76f8\u5e94\u7684\u6743\u9650\u3002\u5728Linux\u4e2d\uff0c\u6743\u9650\u5206\u4e3a\u8bfb\u3001\u5199\u548c\u6267\u884c\u3002</p> <p>\u56e0\u6b64\uff0cos\u6a21\u5757\u4e5f\u63d0\u4f9b\u4e86\u4e09\u4e2a\u5e38\u91cf\u6765\u8868\u793a\u8bfb\u3001\u5199\u3001\u53ef\u6267\u884c\u6743\u9650\uff0c\u5373R_OK\u3001W_OK\u548cX_OK\u3002</p> <p>\u4e0b\u9762\u7684\u7a0b\u5e8f\u6f14\u793a\u4e86chmod\u548caccess\u51fd\u6570\u7684\u7528\u6cd5\u3002\u9996\u5148\u901a\u8fc7\u547d\u4ee4\u884c\u8bfb\u53d6\u6587\u4ef6\u7684\u540d\u79f0\uff0c\u5148\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u76f4\u63a5\u9000\u51fa\u3002</p> <p>\u7136\u540e\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5177\u6709\u8bfb\u6743\u9650\uff0c\u5982\u679c\u6ca1\u6709\u8bfb\u6743\u9650\uff0c\u5219\u5c06\u6587\u4ef6\u8d4b\u4e88\u6240\u6709\u7528\u6237\u90fd\u5177\u6709\u8bfb\u3001\u5199\u3001\u6267\u884c\u6743\u9650\u3002\u5982\u679c\u6587\u4ef6\u5b58\u5728\u5e76\u4e14\u5df2\u7ecf\u5177\u6709\u8bfb\u6743\u9650\uff0c\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u3002</p> <pre><code>#!/usr/bin/python\n#-*- coding: UTF-8 -*-\nfrom __future__ import print_function\nimport os\nimport sys\ndef main():\nsys.argv.append(\"\")\nfilename = sys.argv[1]\nif not os.path.isfile(filename):\nraise SystemExit(filename + ' does not exists')\nelif not os.access(filename, os.R_OK):\nos.chmod(filename, 0777)\nelse:\nwith open(filename) as f:\nprint(f.read())\nif __name__ == '__main__':\nmain()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u521b\u5efa\u76ee\u5f55","title":"\u521b\u5efa\u76ee\u5f55","text":"<pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport os\n#os.mkdir(path=None,mode=None)\n#os.mkdir(\"D:\\\\deam\")        #\u521b\u5efa\u76ee\u5f55\uff0c\u5982\u679c\u76ee\u5f55\u5b58\u5728\uff0c\u4f1a\u629b\u51fa\u5f02\u5e38\n'''\nif not os.path.exists(\"D:\\\\deam\"):\n    os.mkdir(\"D:\\\\deam\")\nelse:\n    print(\"\u8be5\u76ee\u5f55\u5df2\u7ecf\u5b58\u5728\uff01\uff01\uff01\uff01\")\n'''\n#\u521b\u5efa\u4e00\u4e2a\u9012\u5f52\u51fd\u6570\uff0c\u7528\u4e8e\u521b\u5efa\u76ee\u5f55\ndef mkdir(path):    #\u521b\u5efa\u4e00\u4e2a\u9012\u5f52\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u76ee\u5f55\nif not os.path.isdir(path):  #\u5224\u65ad\u662f\u5426\u4e3a\u8def\u5f84\nmkdir(os.path.split(path)[0])\nelse:\nreturn\nos.mkdir(path)      #\u521b\u5efa\u76ee\u5f55\nmkdir('D:\\\\deam\\\\test\\\\aaa')\n#\u521b\u5efa\u591a\u7ea7\u76ee\u5f55\u7684\u51fd\u6570\n#os.makedirs()\n\"\"\"makedirs(name [, mode=0o777][, exist_ok=False])\"\"\"\nos.makedirs(\"D:\\\\deam\\\\test\\\\bbb\")\n</code></pre> <pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport os\n#\u83b7\u53d6\u5f53\u524d\u7684\u76ee\u5f55\nprint(\"\u5f53\u524d\u76ee\u5f55\u662f:{}\".format(os.getcwd()))\n#\u83b7\u53d6\u76ee\u5f55\u4e2d\u7684\u5185\u5bb9\nprint(\"\u76ee\u5f55\u4e2d\u7684\u5185\u5bb9\u6709\uff1a{}\".format(os.listdir()))\n#\u521b\u5efa\u76ee\u5f55\nif not os.path.exists(\"test_hu\"):\nprint(\"\u5f00\u59cb\u521b\u5efa\u76ee\u5f55.....test_hu\")\nos.mkdir(\"test_hu\")\nelse:\nprint(\"\u76ee\u5f55\u4e2d\u7684\u5185\u5bb9\u6709\uff1a{}\".format(os.listdir()))\n#\u5220\u9664\u76ee\u5f55\nprint(\"\u5f00\u59cb\u5220\u9664\u76ee\u5f55......test_hu\",)\nos.rmdir(\"test_hu\")\nprint(\"\u76ee\u5f55\u4e2d\u7684\u5185\u5bb9\u6709\uff1a{}\".format(os.listdir()))\nos.mkdir(\"test_hu\")\n#\u5224\u65ad\u662f\u5426\u662f\u76ee\u5f55\nprint(\"\u5224\u65ad\u662f\u5426\u662f\u76ee\u5f55\uff1f\")\nprint(os.path.isdir(\"test_hu\"))\nprint(os.path.isdir(\"fab.txt\"))\n#\u5224\u65ad\u662f\u5426\u662f\u6587\u4ef6\nprint(\"\u5224\u65ad\u662f\u5426\u4e3a\u6587\u4ef6?\")\nwith open(\"fab1.txt\",\"w+\") as f:\nf.write(\"hello this is file test\")\nprint(os.path.isfile(\"fab1.txt\"))\nprint(os.path.isfile(\"test_hu\"))\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u5220\u9664\u76ee\u5f55","title":"\u5220\u9664\u76ee\u5f55","text":"<pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\n#\u5220\u9664\u76ee\u5f55\nimport os,shutil\n'''\nif os.path.exists(\"D:\\deam\\\\test\\\\bbb\"):\n    os.rmdir(\"D:\\deam\\\\test\\\\bbb\")\nif os.path.exists(\"D:\\deam\"):\n    os.rmdir(\"D:\\\\deam\")\n'''\naaa_path = \"D:\\deam\\\\test\\\\aaa\"\nif os.path.exists(aaa_path):\nshutil.rmtree(\"D:\\deam\\\\test\\\\aaa\")\nelse:\nprint(\"\u76ee\u5f55\u4e0d\u5b58\u5728\uff01\uff01\uff01\")\nshutil.rmtree(path)\n</code></pre> <p>\u6c38\u4e45\u5220\u9664\u6587\u4ef6\u6216\u6587\u4ef6\u5939</p> <pre><code>os.rmdir(path)      # \u5c06\u5220\u9664 path \u5904\u7684\u6587\u4ef6\u5939\u3002\u8be5\u6587\u4ef6\u5939\u5fc5\u987b\u4e3a\u7a7a\uff0c\u5176\u4e2d\u6ca1\u6709\u4efb\u4f55\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u3002\nos.remove()         # \u5220\u9664\u5355\u4e00\u6587\u4ef6\n# \u4e00\u822c\u4f7f\u7528\u5982\u4e0b\uff1a\nos.unlink(path)         # \u5c06\u5220\u9664 path \u5904\u7684\u6587\u4ef6\nshutil.rmtree(path)     # \u5c06\u5220\u9664 path \u5904\u7684\u6587\u4ef6\u5939\uff0c\u5b83\u5305\u542b\u7684\u6240\u6709\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u90fd\u4f1a\u88ab\u5220\u9664,\u65e0\u8bba\u76ee\u5f55\u6216\u6587\u4ef6\u5939\u662f\u5426\u4e3a\u7a7a\n</code></pre> <p>\u5220\u9664\u6587\u4ef6\u4e4b\u524d\uff0c\u6700\u597d\u5148\u8fdb\u884c<code>print()</code>\u6253\u5370,\u9632\u6b62\u8bef\u5220\u9664\u3002 <pre><code>import os\nfor filename in os.listdir():\nif filename.endswith('.rxt'):\n#os.unlink(filename)\nprint(filename)\n</code></pre></p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#23-\u6848\u4f8b-\u6253\u5370\u6700\u5e38\u7528\u768410\u6761linux\u547d\u4ee4","title":"2.3 \u6848\u4f8b: \u6253\u5370\u6700\u5e38\u7528\u768410\u6761Linux\u547d\u4ee4","text":"<p>~/.bash_history\u6587\u4ef6\u4fdd\u5b58\u4e86\u547d\u4ee4\u7684\u5386\u53f2\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8be5\u6587\u4ef6\u83b7\u53d6\u547d\u4ee4\u7684\u5217\u8868\u7edf\u8ba1\u547d\u4ee4\u7684\u6267\u884c\u6b21\u6570\u3002</p> <p>\u5728\u7edf\u8ba1\u65f6\uff0c\u6211\u4eec\u53ea\u7edf\u8ba1\u547d\u4ee4\u7684\u540d\u79f0\u5373\u53ef\uff0c\u4ee5\u4e0d\u540c\u7684\u53c2\u6570\u8c03\u7528\u76f8\u540c\u7684\u547d\u4ee4\u4e5f\u8ba4\u4e3a\u662f\u540c\u4e00\u4e2a\u547d\u4ee4\u3002\u4e0b\u9762\u7684\u7a0b\u5e8f\u7528\u6765\u7edf\u8ba1\u6bcf\u6761\u547d\u4ee4\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u7136\u540e\u627e\u51fa\u51fa\u73b0\u6b21\u6570\u6700\u591a\u768410\u6761\u547d\u4ee4\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [1]: import os\n\nIn [2]: from collections import Counter\n\nIn [3]: c = Counter()\nIn [4]: with open(os.path.expanduser('~/.bash_history')) as f:\n   ...:     for line in f:\n   ...:         cmd = line.strip().split()\n...:         if cmd:\n   ...:             c[cmd[0]]+=1\n...:\n\nIn [5]: c.most_common(10)\nOut[5]:\n[('ls', 116),\n ('vi', 55),\n ('cd', 47),\n ('fab', 32),\n ('cat', 25),\n ('python', 13),\n ('ps', 13),\n ('ssh', 11),\n ('pwd', 11),\n ('vim', 11)]\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#24-\u6848\u4f8b-\u7528python\u6765\u521b\u5efa7\u79cd\u4e0d\u540c\u7684\u6587\u4ef6\u683c\u5f0f","title":"2.4 \u6848\u4f8b: \u7528Python\u6765\u521b\u5efa7\u79cd\u4e0d\u540c\u7684\u6587\u4ef6\u683c\u5f0f","text":"<p>\u53c2\u8003\u6587\u732e</p> <p>\u7528Python\u6765\u521b\u5efa7\u79cd\u4e0d\u540c\u7684\u6587\u4ef6\u683c\u5f0f</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#3\u67e5\u627e\u6587\u4ef6","title":"3.\u67e5\u627e\u6587\u4ef6","text":"<p>\u4f7f\u7528Python\u67e5\u627e\u7279\u5b9a\u7c7b\u578b\u7684\u6587\u4ef6\uff0c\u5305\u62ec\u4f7f\u7528\u5b57\u7b26\u4e32\u5339\u914d\u6587\u4ef6\u540d\u7684\u6807\u51c6\u5e93fnmatch\u548cglob\uff0c\u8fd8\u6709\u904d\u5386\u76ee\u5f55\u6811\u7684\u51fd\u6570os.walk\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#31-\u4f7f\u7528fnmatch\u627e\u5230\u7279\u5b9a\u7684\u6587\u4ef6","title":"3.1 \u4f7f\u7528fnmatch\u627e\u5230\u7279\u5b9a\u7684\u6587\u4ef6","text":"<p>\u83b7\u53d6\u6587\u4ef6\u5939\u4e2d\u7684\u6587\u4ef6\u5217\u8868</p> <p>\u4f7f\u7528<code>os.listdir()</code>\u51fd\u6570\u6765\u83b7\u53d6\u67d0\u4e2a\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u5217\u8868\uff1a</p> <pre><code>import os\nnames = os.listdir('somedir')\n</code></pre> <p>\u7ed3\u679c\u4f1a\u8fd4\u56de\u76ee\u5f55\u4e2d\u6240\u6709\u6587\u4ef6\u5217\u8868\uff0c\u5305\u62ec\u6240\u6709\u6587\u4ef6\uff0c\u5b50\u76ee\u5f55\uff0c\u7b26\u53f7\u94fe\u63a5\u7b49\u7b49\u3002 \u5982\u679c\u4f60\u9700\u8981\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\u8fc7\u6ee4\u6570\u636e\uff0c\u53ef\u4ee5\u8003\u8651\u7ed3\u5408 os.path \u5e93\u4e2d\u7684\u4e00\u4e9b\u51fd\u6570\u6765\u4f7f\u7528\u5217\u8868\u63a8\u5bfc\u3002\u6bd4\u5982\uff1a</p> <pre><code>import os.path\n# Get all regular files\nnames = [name for name in os.listdir('somedir')\nif os.path.isfile(os.path.join('somedir', name))]\n# Get all dirs\ndirnames = [name for name in os.listdir('somedir')\nif os.path.isdir(os.path.join('somedir', name))]\n</code></pre> <p>\u5b57\u7b26\u4e32\u7684<code>startswith()</code>\u548c<code>endswith()</code>\u65b9\u6cd5\u5bf9\u4e8e\u8fc7\u6ee4\u4e00\u4e2a\u76ee\u5f55\u7684\u5185\u5bb9\u4e5f\u662f\u5f88\u6709\u7528\u7684\u3002\u6bd4\u5982\uff1a</p> <pre><code>pyfiles = [name for name in os.listdir('somedir')\nif name.endswith('.py')]\n</code></pre> <p>\u5bf9\u4e8e\u6587\u4ef6\u540d\u7684\u5339\u914d,\u4f7f\u7528 fnmatch \u6a21\u5757\u3002</p> <p>\u6bd4\u5982\uff1a</p> <pre><code>from fnmatch import fnmatch\npyfiles = [name for name in os.listdir('somedir')\nif fnmatch(name, '*.py')]\n</code></pre> <p>Python fnmatch\u6a21\u5757\u5e38\u7528\u51fd\u6570\u53ca\u529f\u80fd</p> \u51fd\u6570\u540d \u529f\u80fd fnmatch.filter(names, pattern) \u5bf9 names \u5217\u8868\u8fdb\u884c\u8fc7\u6ee4\uff0c\u8fd4\u56de names \u5217\u8868\u4e2d\u5339\u914d pattern \u7684\u6587\u4ef6\u540d\u7ec4\u6210\u7684\u5b50\u96c6\u5408 fnmatch.fnmatch(filename, pattern) \u5224\u65ad filename \u6587\u4ef6\u540d\uff0c\u662f\u5426\u548c\u6307\u5b9a pattern \u5b57\u7b26\u4e32\u5339\u914d fnmatch.fnmatchcase(filename, pattern) \u548c fnmatch() \u51fd\u6570\u529f\u80fd\u5927\u81f4\u76f8\u540c\uff0c\u53ea\u662f\u8be5\u51fd\u6570\u533a\u5206\u5927\u5c0f\u5199 fnmatch.translate(pattern) \u5c06\u4e00\u4e2a UNIX shell \u98ce\u683c\u7684 pattern \u5b57\u7b26\u4e32\uff0c\u8f6c\u6362\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f <p>fnmatch\u548cfnmatchcase\u7684\u4f7f\u7528</p> <pre><code>In [1]: from fnmatch import fnmatch, fnmatchcase\n\nIn [2]: fnmatch('foo.txt', '*.txt')\nOut[2]: True\n\nIn [3]: fnmatch('foo.txt', '?oo.txt')\nOut[3]: True\n\nIn [4]: fnmatch('Dat45.csv', 'Dat[0-9]*')\nOut[4]: True\n\nIn [5]: fnmatchcase('foo.txt', '*.TXT')\nOut[5]: False\n\nIn [6]: addresses = [\n...:     '5412 N CLARK ST',\n   ...:     '1060 W ADDISON ST',\n   ...:     '1039 W GRANVILLE AVE',\n   ...:     '2122 N CLARK ST',\n   ...:     '4802 N BROADWAY',\n   ...: ]\nIn [7]: [addr for addr in addresses if fnmatchcase(addr, '* ST')]\nOut[7]: ['5412 N CLARK ST', '1060 W ADDISON ST', '2122 N CLARK ST']\nIn [8]: [addr for addr in addresses if fnmatchcase(addr, '54[0-9][0-9] *CLARK*')]\nOut[8]: ['5412 N CLARK ST']\n</code></pre> <p>fnmatchcase\u4e3e\u4f8b</p> <pre><code>In [1]: !touch {a..b}1.txt {c..d}2.jpg\n\nIn [2]: ls\na1.txt  b1.txt  c2.jpg  d2.jpg\n\nIn [3]: import os\n\nIn [4]: os.listdir('.')\nOut[4]: ['c2.jpg', 'b1.txt', 'd2.jpg', 'a1.txt']\nIn [5]: import fnmatch\n\nIn [6]: [ name for name in os.listdir('.') if fnmatch.fnmatch(name, \"*.jpg\")]\nOut[6]: ['c2.jpg', 'd2.jpg']\nIn [7]: [ name for name in os.listdir('.') if fnmatch.fnmatch(name, '[a-c]*')]\nOut[7]: ['c2.jpg', 'b1.txt', 'a1.txt']\nIn [8]: [ name for name in os.listdir('.') if fnmatch.fnmatch(name, '[a-c]?.txt')]\nOut[8]: ['b1.txt', 'a1.txt']\nIn [9]: [ name for name in os.listdir('.') if fnmatch.fnmatch(name, '[!a-c]*')]\nOut[9]: ['d2.jpg']\n</code></pre> <p>filter\u4f7f\u7528\u4e3e\u4f8b</p> <pre><code>In [1]: import os\n\nIn [2]: name = os.listdir('.')\nIn [3]: name\nOut[3]: ['c2.jpg', 'b1.txt', 'd2.jpg', 'a1.txt']\nIn [4]: from fnmatch import filter\n\nIn [5]: filter(name,'[a-c]?.txt')\nOut[5]: ['b1.txt', 'a1.txt']\nIn [6]: filter(name,'[!a-c]*')\nOut[6]: ['d2.jpg']\n</code></pre> <p>\u66f4\u591a\u53c2\u8003\u6587\u6863</p> <p>fnmatch \u2014 Unix-style Glob Pattern Matching</p> <p>\u7528Shell\u901a\u914d\u7b26\u5339\u914d\u5b57\u7b26\u4e32</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#32-\u4f7f\u7528glob\u627e\u5230\u7279\u5b9a\u6587\u4ef6","title":"3.2 \u4f7f\u7528glob\u627e\u5230\u7279\u5b9a\u6587\u4ef6","text":"<p>\u76ee\u524d\u6211\u4eec\u8981\u83b7\u53d6\u5230\u7279\u5b9a\u7c7b\u578b\u7684\u6587\u4ef6\u5217\u8868\uff0c\u6211\u4eec\u9996\u5148\u901a\u8fc7os.listdir\u83b7\u53d6\u6587\u4ef6\u5217\u8868\uff0c\u7136\u540e\u901a\u8fc7\u5b57\u7b26\u4e32\u5339\u914d\u6216\u8005\u4f7f\u7528fnmatch\u8fdb\u884c\u6587\u4ef6\u540d\u6a21\u5f0f\u5339\u914d\u8fdb\u884c\u8fc7\u6765\uff0c\u800c\u5728Python\u4e2d\u6d77\u6cb9\u66f4\u52a0\u7b80\u5355\u7684\u65b9\u5f0f\uff0c\u5373\u4f7f\u7528\u6807\u51c6\u5e93\u7684glob\u5e93\u3002</p> <p>glob\u5e93\u7684\u4f5c\u7528\u76f8\u5f53\u4e8eos.listdir\u52a0\u4e0afnmatch\u3002\u4f7f\u7528glob\u4ee5\u540e\uff0c\u4e0d\u9700\u8981\u8c03\u7528os.listdir\u83b7\u53d6\u6587\u4ef6\u5217\u8868\uff0c\u76f4\u63a5\u901a\u8fc7\u6a21\u5f0f\u5339\u914d\u5373\u53ef\uff0c\u5982\u4e0b\u6240\u793a</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2020/3/19 20:57\n# filename: glob\u6a21\u5757.py\n\"\"\"\n\u4f7f\u7528glob\u4ee5\u540e\uff0c\u4e0d\u9700\u8981\u8c03\u7528os.listdir\u83b7\u53d6\u6587\u4ef6\u5217\u8868\uff0c\u76f4\u63a5\u901a\u8fc7\u6a21\u5f0f\u5339\u914d\u5373\u53ef\u3002\n\"\"\"\nimport glob\n\nprint(glob.glob(\"*.txt\"))\nprint(glob.glob(\"[a-z]?.txt\"))\nprint(glob.glob(\"[!a-z]?.txt\"))\n</code></pre> <p>\u5982\u679c\u76ee\u5f55\u5305\u542b\u4ee5.\u5f00\u5934\u7684\u6587\u4ef6\u3002\u9ed8\u8ba4\u5c06\u4e0d\u4f1a\u5339\u914d\u5230\u5b83\u4eec\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u5305\u542bcard.gif\u548c.card.gif\u7684\u76ee\u5f55\uff1a</p> <pre><code>&gt;&gt;&gt; import glob\n&gt;&gt;&gt; glob.glob('*.gif')\n['card.gif']\n&gt;&gt;&gt; glob.glob('.c*')\n['.card.gif']\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0cPython\u975e\u5e38\u7075\u6d3b\uff0c\u4ec5\u4ec5\u662f\u627e\u5230\u76ee\u5f55\u4e0b\u7279\u5b9a\u7684\u6587\u4ef6\u7c7b\u578b\uff0c\u6211\u4eec\u5c31\u5df2\u7ecf\u4f7f\u7528\u4e86 \u4e09\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u5339\u914d\u6587\u4ef6\uff0c\u5206\u522b\u662f\u5b57\u7b26\u4e32\u540e\u7f00\u5339\u914d\uff0cfnmatch\u6a21\u5f0f\u5339\u914d\u548cglob\u6a21\u5f0f\u5339\u914d\u3002</p> <p>\u867d\u7136\u5b57\u7b26\u4e32\u540e\u7f00\u5339\u914d\u529f\u80fd\u6709\u9650\uff0c\u4f46\u662f\uff0c\u7531\u4e8e\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u9700\u6c42\u6bd4\u8f83\u7b80\u5355\uff0cPython\u5de5\u7a0b\u5e08\u4e5f \u5bf9Pythor\u7684\u5b57\u7b26\u4e32\u51fd\u6570\u6bd4\u8f83\u719f\u6089\uff0c\u6240\u4ee5\u6210\u4e3a\u4e86\u4f7f\u7528\u6700\u5e7f\u6cdb\u7684\u65b9\u5f0f\u3002</p> <p>\u5982\u679c\u9700\u8981\u66f4\u52a0\u7075\u6d3b\u7684\u5339\u914d\u6587\u4ef6\u540d\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528fnmath\u548cglob\u3002</p> <p>\u66f4\u591a\u53c2\u8003\u6587\u6863</p> <p>glob \u2014 Filename Pattern Matching</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#33-\u4f7f\u7528oswalk\u904d\u5386\u76ee\u5f55\u6811","title":"3.3 \u4f7f\u7528os.walk\u904d\u5386\u76ee\u5f55\u6811","text":"<p>\u524d\u9762\u7684\u4f8b\u5b50\u90fd\u662f\u67e5\u627e\u67d0\u4e00\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5e76\u901a\u8fc7\u6a21\u5f0f\u5339\u914d\u53bb\u9009\u62e9\u81ea\u5df1\u9700\u8981\u7684\u6587\u4ef6\u7c7b\u578b\u3002</p> <p>\u5728\u5b9e\u9645\u5de5\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u66f4\u6709\u53ef\u80fd\u9047\u5230\u7684\u662f\u67e5\u627e\u67d0\u4e2a\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002\u4f8b\u5982\uff0c\u67e5\u627e\u67d0\u4e2a\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u56fe\u7247\u6587\u4ef6\uff0c\u67e5\u627e\u67d0\u4e2a\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u6700\u5927\u7684\u5341\u4e2a\u6587\u4ef6\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u7c7b\u9700\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528os\u6a21\u5757\u7684walk\u51fd\u6570\u3002</p> <p>walk\u51fd\u6570\u904d\u5386\u67d0\u4e2a\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u76ee\u5f55\uff0cwalk\u8fd4\u56de\u4e00\u4e2a\u4e09\u5143\u7ec4(dirpath,dirnames,filenames)\u3002</p> <ul> <li> <p>dirpath\u4fdd\u5b58\u7684\u662f\u5f53\u524d\u76ee\u5f55</p> </li> <li> <p>dirnames\u662f\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u5217\u8868</p> </li> <li> <p>filenames\u662f\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5217\u8868\u3002</p> </li> </ul> <pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport os\n#os.walk(top, topdown=True, onerror=None, followlinks=False)\n'''\n   dirpath, dirnames, filenames\n    dirpath is a string, the path to the directory.\n    dirnames is a list of the names of the subdirectories in dirpath (excluding '.' and '..').\n    filenames is a list of the names of the non-directory files in dirpath.\n'''\npath = r\"D:\\Cisco_iso\"\nprint(\"\u3010\", path, \"\u3011\u76ee\u5f55\u4e0b\u5305\u542b\u7684\u6587\u4ef6\u548c\u76ee\u5f55\uff1a\")\nfor root,dirs,files in os.walk(path,topdown=True):  #\u904d\u5386\u6307\u5b9a\u76ee\u5f55\nfor name in dirs:\nprint(os.path.join(root, name))      #\u8f93\u51fa\u904d\u5386\u5230\u7684\u76ee\u5f55\nfor name in files:\nprint('\\t', os.path.join(root, name))      #\u8f93\u51fa\u904d\u5386\u5230\u7684\u6587\u4ef6\n</code></pre> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u6f14\u793a\u4e86os.walk\u51fd\u6570\u7684\u7528\u6cd5\uff0c\u4f7f\u7528os.walk\u51fd\u6570\u904d\u5386<code>/tmp/code-sample</code>\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\uff0c\u5e76\u627e\u5230\u6240\u6709\u7684\u56fe\u7247\u6587\u4ef6\uff1a</p> <pre><code>import os\nimport fnmatch\nimages = ['*.png', '*.jpg', '*.jpeg', '*.tif', '*.tiff']\nmatches = []\nfor root, dirnames, filenames in os.walk(os.path.expanduser('/tmp/code-sample')):\nfor image in images:\nfor filenname in fnmatch.filter(filenames, image):\nmatches.append(os.path.join(root,filenname))\nprint(matches)\n</code></pre> <p>\u5728\u904d\u5386\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u65f6\uff0c\u5982\u679c\u60f3\u8981\u5ffd\u7565\u6389\u67d0\u4e00\u4e2a\u5b50\u76ee\u5f55\uff0c\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u4e09\u5143\u7ec4\u4e2d\u7684dirnames,\u5373\u4ecedirnames\u5217\u8868\u4e2d\u79fb\u9664\u9700\u8981\u5ffd\u7565\u6389\u7684\u76ee\u5f55\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>import os\nimport fnmatch\nimages = ['*.png', '*.jpg', '*.jpeg', '*.tif', '*.tiff']\nmatches = []\nfor root, dirnames, filenames in os.walk(os.path.expanduser('/tmp/code-sample')):\n# \u5ffd\u7565\u6389\u67d0\u4e9b\u76ee\u5f55\nif \"aaa\" in dirnames:\ndirnames.remove('aaaa')\n.....\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u76ee\u5f55\u8fed\u4ee3\u7684\u4e24\u79cd\u65b9\u5f0f","title":"\u76ee\u5f55\u8fed\u4ee3\u7684\u4e24\u79cd\u65b9\u5f0f","text":"<p>\u65b9\u5f0f1-\u9012\u5f52\u8c03\u7528</p> <pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport os\nimport os.path\ndef traverse(pathname):\nfor item in os.listdir(pathname):\nfullitem = os.path.join(pathname,item)\nprint(fullitem)\nif os.path.isdir(fullitem):\ntraverse(fullitem)\ntraverse(\"D:\\GitHub\")\n</code></pre> <p>\u65b9\u5f0f2-os.walk\u51fd\u6570</p> <pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport os\nimport os.path\ndef trav_walk(pathname):\n'''\n    root:\u5f53\u524d\u76ee\u5f55\n    dirs\uff1a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\n    files\uff1a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\n    '''\nfor root,dirs,files in os.walk(pathname):\nfor file in files:\nfname = os.path.abspath(os.path.join(root,file))\nprint(fname)\ntrav_walk(\"D:\\GitHub\")\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u6848\u4f8b-\u6587\u4ef6\u5c5e\u6027\u6d4f\u89c8","title":"\u6848\u4f8b: \u6587\u4ef6\u5c5e\u6027\u6d4f\u89c8","text":"<ul> <li> <p>\u904d\u5386path\u6307\u5b9a\u7684\u76ee\u5f55\uff0c\u83b7\u53d6\u6bcf\u4e2a\u5b50\u76ee\u5f55\u7684\u8def\u5f84\u3002</p> </li> <li> <p>\u904d\u5386\u5b50\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\uff0c\u8fd4\u56de\u6587\u4ef6\u7684\u5c5e\u6027\u5217\u8868\u3002</p> </li> <li> <p>\u5206\u89e3\u5c5e\u6027\u5217\u8868\uff0c\u5bf9\u5c5e\u6027\u5217\u8868\u8fdb\u884c\u683c\u5f0f\u5316\u8f93\u51fa</p> </li> </ul> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2019/7/20 14:56\n# filename: \u67e5\u770b\u6240\u6709\u6587\u4ef6\u7684\u5c5e\u6027.py\ndef ShowFileProperties(path):\n\"\"\"\n    \u663e\u793a\u6587\u4ef6\u5c5e\u6027\uff0c\u5305\u62ec\u8def\u5f84\u3001\u5927\u5c0f\u3001\u521b\u5efa\u65e5\u671f\u3001\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3001\u6700\u540e\u8bbf\u95ee\u65f6\u95f4\n    :param path:\n    :return:\n    \"\"\"\nimport os, time\nfor root, dirs, files in os.walk(path, True):\nprint(\"\u4f4d\u7f6e\uff1a\" + root)\nfor filename in files:\nstate = os.stat(os.path.join(root, filename))\ninfo = \"\u6587\u4ef6\u540d\uff1a\" + filename + \" \"\ninfo = info + \"\u5927\u5c0f\uff1a\" + (\"%d\" % state[-4]) + \" \"\nt = time.strftime(\"%Y-%m-%d %X\", time.localtime(state[-1]))\ninfo = info + \"\u521b\u5efa\u65f6\u95f4\uff1a\" + t + \" \"\nt = time.strftime(\"%Y-%m-%d %X\", time.localtime(state[-2]))\ninfo = info + \"\u4fee\u6539\u65f6\u95f4\uff1a\" + t + \" \"\nt = time.strftime(\"%Y-%m-%d %X\", time.localtime(state[-3]))\ninfo = info + \"\u6700\u540e\u8bbf\u95ee\u65f6\u95f4\uff1a\" + t + \" \"\nprint(info)\nif __name__ == '__main__':\npath = r\"D:\\GitHub\\21_staduy_python\\13.python\u6587\u4ef6\u64cd\u4f5c\\\u57fa\u672c\u6587\u4ef6\u64cd\u4f5c\"\nShowFileProperties(path)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u6848\u4f8b-\u627e\u5230\u76ee\u5f55\u4e0b\u6700\u5927\u6700\u8001\u7684\u5341\u4e2a\u6587\u4ef6","title":"\u6848\u4f8b: \u627e\u5230\u76ee\u5f55\u4e0b\u6700\u5927\u6700\u8001\u7684\u5341\u4e2a\u6587\u4ef6","text":"<pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2020/3/19 21:16\n# filename: main.py\nimport os\nimport fnmatch\nimport time\ndef is_file_match(filename, patterns):\nfor pattern in patterns:\nif fnmatch.fnmatch(filename, pattern):\nreturn True\nreturn False\ndef find_specific_files(root, patterns=['*'], exclude_dirs=[]):\n'''\n    :param root: \u67e5\u627e\u7684\u6839\u8def\u5f84\n    :param patterns:\u5339\u914d\u7684\u6587\u4ef6\u6a21\u5f0f\u5217\u8868\n    :param exclude_dirs:\u9700\u8981\u6392\u9664\u7684\u76ee\u5f55\u5217\u8868\n    :return:\n    '''\nfor root, dirnames, filenames in os.walk(root):\nfor filename in filenames:\nif is_file_match(filename, patterns):\nyield os.path.join(root, filename)\nfor d in exclude_dirs:\nif d in dirnames:\ndirnames.remove(d)\nif __name__ == '__main__':\n# \u67e5\u5230\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\nfor item in find_specific_files(\"../\"):\nprint(item)\n# \u67e5\u627e\u76ee\u5f55\u4e0b\u7684\u6240\u6709py\u548ctxt\u6587\u4ef6\npatterns = ['*.txt', '*.py']\nfor item in find_specific_files(\"../\", patterns):\nprint(item)\n# \u67e5\u627e\u76ee\u5f55\u4e0b\u9664\u4e86dir\u76ee\u5f55\u4ee5\u5916\u5176\u4ed6\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\npatterns = ['*.txt', '*.py']\nexclude_dirs = ['dir']\nfor item in find_specific_files(\"../\", patterns, exclude_dirs):\nprint(item)\n# \u627e\u5230\u67d0\u4e2a\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e0b\u6700\u8001\u7684\u5341\u4e2a\u6587\u4ef6\nfiles = {name: os.path.getmtime(name) for name in find_specific_files(\"../\")}\nresult = sorted(files.items(), key=lambda d: d[1])[:10]\nfor i, t in enumerate(result, 1):\nprint(i, t[0], time.ctime(t[1]))\n# \u627e\u5230\u67d0\u4e2a\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e0b\uff0c\u6240\u6709\u6587\u4ef6\u540d\u5305\u542b\u201cpython\u201d\u7684\u6587\u4ef6\nfile2 = [name for name in find_specific_files(\"../\", patterns=['*python*'])]\nfor i, name in enumerate(file2, 1):\nprint(i, name)\n# \u627e\u5230\u67d0\u4e2a\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e0b\uff0c\u6392\u9664.git\u5b50\u76ee\u5f55\u4ee5\u540e\u6240\u6709\u7684Python\u6587\u4ef6\nfile3 = [name for name in find_specific_files(\"../\", patterns=['*.py'], exclude_dirs=['.git'])]\nfor i, name in enumerate(file3, 1):\nprint(i, name)\n# \u5220\u9664\u67d0\u4e2a\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e0b\u7684\u6240\u6709pyc\u6587\u4ef6\nfile4 = [name for name in find_specific_files(\"../\", patterns=['*.pyc'])]\nfor name in file4:\nos.remove(name)\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#4\u9ad8\u7ea7\u6587\u4ef6\u5904\u7406\u63a5\u53e3shutil","title":"4.\u9ad8\u7ea7\u6587\u4ef6\u5904\u7406\u63a5\u53e3shutil","text":"<p>Shutil \u6a21\u5757\u5305\u62ec\u9ad8\u7ea7\u6587\u4ef6\u64cd\u4f5c\uff0c\u5982\u590d\u5236\u548c\u5f52\u6863\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#41-\u590d\u5236\u6587\u4ef6","title":"4.1 \u590d\u5236\u6587\u4ef6","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#copyfile\u65b9\u6cd5","title":"copyfile\u65b9\u6cd5","text":"<pre><code># shutil_copyfile.py\nimport glob\nimport shutil\nprint('BEFORE:', glob.glob('shutil_copyfile.*'))\nshutil.copyfile('shutil_copyfile.py', 'shutil_copyfile.py.copy')\nprint('AFTER:', glob.glob('shutil_copyfile.*'))\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#copy\u65b9\u6cd5","title":"copy\u65b9\u6cd5","text":"<p>\u7c7b\u4f3c\u4e8eUNIX\u547d\u4ee4\u884c\u5de5\u5177cp,Copy()\u51fd\u6570\u4f1a\u7528\u540c\u6837\u7684\u65b9\u5f0f\u89e3\u91ca\u8f93\u51fa\u540d\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u7684\u76ee\u6807\u6307\u793a\u4e00\u4e2a\u76ee\u5f55\u800c\u4e0d\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u5219\u4f1a\u4f7f\u7528\u6e90\u6587\u4ef6\u7684\u57fa\u540d\u5728\u8be5\u76ee\u5f55\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u6587\u4ef6\u3002</p> <pre><code># shutil_copy.py\nimport glob\nimport os\nimport shutil\nos.mkdir('example')\nprint('BEFORE:', glob.glob('example/*'))\nshutil.copy('shutil_copy.py', 'example')\nprint('AFTER :', glob.glob('example/*'))\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#copy2\u65b9\u6cd5","title":"copy2\u65b9\u6cd5","text":"<p>copy2()\u7684\u5de5\u4f5c\u7c7b\u4f3c\u4e8ecopy(),\u4e0d\u8fc7\u4f1a\u5728\u590d\u5236\u5230\u65b0\u6587\u4ef6\u7684\u5143\u6570\u636e\u4e2d\u5305\u542b\u8bbf\u95ee\u548c\u4fee\u6539\u65f6\u95f4\u3002</p> <pre><code># shutil_copy2.py\nimport os\nimport shutil\nimport time\ndef show_file_info(filename):\nstat_info = os.stat(filename)\nprint('  Mode    :', oct(stat_info.st_mode))\nprint('  Created :', time.ctime(stat_info.st_ctime))\nprint('  Accessed:', time.ctime(stat_info.st_atime))\nprint('  Modified:', time.ctime(stat_info.st_mtime))\nos.mkdir('example')\nprint('SOURCE:')\nshow_file_info('shutil_copy2.py')\nshutil.copy2('shutil_copy2.py', 'example')\nprint('DEST:')\nshow_file_info('example/shutil_copy2.py')\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#copymode\u65b9\u6cd5","title":"copymode\u65b9\u6cd5","text":"<p>\u9ed8\u8ba4\u5730\uff0c\u5728UNIX\u4e0b\u521b\u5efa\u4e00\u4e2a\u65b0\u6587\u4ef6\u65f6\uff0c\u5b83\u4f1a\u6839\u636e\u5f53\u524d\u7528\u6237\u7684umask\u63a5\u53d7\u6743\u9650\u3002</p> <p>\u8981\u628a\u6743\u9650\u4ece\u4e00\u4e2a\u6587\u4ef6\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528copymode()\u3002</p> <pre><code># shutil_copymode.py\nimport os\nimport shutil\nimport subprocess\nwith open('file_to_change.txt', 'wt') as f:\nf.write('content')\nos.chmod('file_to_change.txt', 0o444)\nprint('BEFORE:', oct(os.stat('file_to_change.txt').st_mode))\nshutil.copymode('shutil_copymode.py', 'file_to_change.txt')\nprint('AFTER :', oct(os.stat('file_to_change.txt').st_mode))\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#copytree\u65b9\u6cd5","title":"copytree\u65b9\u6cd5","text":"<pre><code># ls\na.py  dir1\n\nIn [1]: import shutil\n\nIn [2]: shutil.copy('a.py','b.py')\nOut[2]: 'b.py'\nIn [3]: !ls\na.py  b.py  dir1\n\nIn [6]: shutil.copytree('dir1','dir2')\nOut[6]: 'dir2'\nIn [7]: !ls\na.py  b.py  dir1  dir2\n</code></pre> <pre><code>shutil_copytree.py\nimport glob\nimport pprint\nimport shutil\nprint('BEFORE:')\npprint.pprint(glob.glob('/tmp/example/*'))\nshutil.copytree('../shutil', '/tmp/example')\nprint('\\nAFTER:')\npprint.pprint(glob.glob('/tmp/example/*'))\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#42-move","title":"4.2 move","text":"<p>\u8fd9\u4e2a\u51fd\u6570\u7b49\u540c\u4e8eLinux\u4e0a\u7684move\u3002\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u7684\u79fb\u52a8\u548c\u6539\u540d</p> <pre><code>In [1]: import shutil\n\nIn [2]:\n\nIn [2]: shutil.move(\"a.py\",\"a1.py\")\nOut[2]: 'a1.py'\nIn [3]: !ls\na1.py  dir1\n\nIn [4]: shutil.move(\"a1.py\",\"/tmp/\")\nOut[4]: '/tmp/a1.py'\nIn [5]: !ls /tmp/a1.py\n/tmp/a1.py\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#43-\u5220\u9664\u76ee\u5f55","title":"4.3 \u5220\u9664\u76ee\u5f55","text":"<p>\u5728Python\u4e2d\uff0c\u5982\u679c\u8981\u5220\u9664\u6587\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528os\u6a21\u5757\u7684remove\u548cunlink\u51fd\u6570\uff0c\u5982\u679c\u8981\u5220\u9664\u76ee\u5f55\uff0c\u53ef\u4ee5\u4f7f\u7528os\u6a21\u5757\u7684rmdir\u548cremovedirs\u51fd\u6570\u3002</p> <p>\u90a3\u4e48\uff0c\u4e3a\u4ec0\u4e48shutil\u6a21\u5757\u8fd8\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u540d\u4e3armtree\u7684\u51fd\u6570\u5462\uff1f</p> <p>\u4e3b\u8981\u662f\u56e0\u4e3aos.rmdir\u548cremovedirs\u90fd\u8981\u6c42\u88ab\u5220\u9664\u7684\u76ee\u5f55\u975e\u7a7a\uff0c\u4e0d\u80fd\u8fdb\u884c\u5f3a\u5236\u5220\u9664\u3002</p> <p>\u800cshutil.rmtree\u4e0d\u7ba1\u76ee\u5f55\u662f\u5426\u975e\u7a7a\uff0c\u90fd\u76f4\u63a5\u5220\u9664\u6574\u4e2a\u76ee\u5f55\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u7b14\u8005\u7684\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u4e00\u822c\u4f7f\u7528os.unlink\u5220\u9664\u5355\u4e2a\u6587\u4ef6\uff0c\u4f7f\u7528shutil.rmtree\u5220\u9664\u6574\u4e2a\u76ee\u5f55\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>In [1]: import shutil\n\nIn [2]: import os\n\nIn [3]: os.unlink('shutil_make_archive.py')\nIn [4]: !ls\ndir1  example.tar.gz\n\nIn [5]: os.rmdir('dir1')\n---------------------------------------------------------------------------\nOSError                                   Traceback (most recent call last)\n&lt;ipython-input-5-fc3e3e614220&gt; in &lt;module&gt;\n----&gt; 1 os.rmdir('dir1')\nOSError: [Errno 39] Directory not empty: 'dir1'\nIn [6]: shutil.rmtree('dir1')\nIn [7]: !ls\nexample.tar.gz\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#44-\u5f52\u6863\u538b\u7f29","title":"4.4 \u5f52\u6863\u538b\u7f29","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u538b\u7f29","title":"\u538b\u7f29","text":"<p>\u53ef\u4ee5\u4f7f\u7528make archive()\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5f52\u6863\u6587\u4ef6\u3002</p> <p>\u5b83\u7684\u8f93\u5165\u88ab\u8bbe\u8ba1\u4e3a\u80fd\u6700\u597d\u5730\u652f\u6301\u5c06\u6574\u4e2a\u76ee\u5f55\u53ca\u5176\u6240\u6709\u5185\u5bb9\u9012\u5f52\u5730\u5f52\u6863\u3002</p> <p>\u9ed8\u8ba4\u5730\u4f1a\u4f7f\u7528\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\uff0c\u6240\u4ee5\u6240\u6709\u6587\u4ef6\u548c\u5b50\u76ee\u5f55\u51fa\u73b0\u5728\u5f52\u6863\u6587\u4ef6\u7684\u9876\u5c42\u3002</p> <p>\u8981\u6539\u53d8\u8fd9\u79cd\u884c\u4e3a\uff0c\u53ef\u4ee5\u4f7f\u7528root dir\u53c2\u6570\u79fb\u81f3\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u65b0\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u53e6\u5916\u53ef\u4ee5\u7528base dir\u53c2\u6570\u6307\u5b9a\u4e00\u4e2a\u76ee\u5f55\u589e\u52a0\u5230\u5f52\u6863\u3002</p> <pre><code># shutil_make_archive.py\nimport logging\nimport shutil\nimport sys\nimport tarfile\n# \u65e5\u5fd7\u6d88\u606f\u5c06\u88ab\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u6d41 (sys.stdout) \u4e2d\uff0c\u5e76\u4e14\u65e5\u5fd7\u7ea7\u522b\u8bbe\u7f6e\u4e3a logging.DEBUG\u3002\nlogging.basicConfig(\nformat='%(message)s',\nstream=sys.stdout,\nlevel=logging.DEBUG,\n)\nlogger = logging.getLogger('pymotw')\nprint('Creating archive:')\nshutil.make_archive(\n'example', 'gztar',\nroot_dir='.',\nbase_dir='example',\nlogger=logger,\n)\nprint('\\nArchive contents:')\nwith tarfile.open('example.tar.gz', 'r') as t:\nfor n in t.getnames():\nprint(n)\n</code></pre> <p>\u8fd9\u4e2a\u4f8b\u5b50\u4ece\u793a\u4f8b\u6e90\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u5f00\u59cb\uff0c\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6240\u5728\u76ee\u5f55\uff1b\u7136\u540e\u5c06\u8fd9\u4e2aexample\u76ee\u5f55\u589e\u52a0\u5230\u4e00\u4e2atar\u5f52\u6863\uff0c'\u5e76\u7528gzip\u538b\u7f29\u3002</p> <p>logging\u6a21\u5757\u88ab\u914d\u7f6e\u4e3a\u663e\u793amake_archive()\u4e2d\u64cd\u4f5c\u7684\u6709\u5173\u6d88\u606f\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u89e3\u538b\u7f29","title":"\u89e3\u538b\u7f29","text":"<pre><code># shutil_unpack_archive.py\nimport pathlib\nimport shutil\nimport sys\nimport tempfile\nwith tempfile.TemporaryDirectory() as d:\nprint('Unpacking archive:')\nshutil.unpack_archive(\n'example.tar.gz',\nextract_dir=d,\n)\nprint('\\nCreated:')\nprefix_len = len(d) + 1\nfor extracted in pathlib.Path(d).rglob('*'):\nprint(str(extracted)[prefix_len:])\n</code></pre> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u5c06\u6587\u4ef6\u89e3\u538b\u5230\u4e00\u4e2a\u4e34\u65f6\u76ee\u5f55\u4e2d\uff0c\u8be5\u4e34\u65f6\u76ee\u5f55\u7531<code>tempfile.TemporaryDirectory()</code>\u51fd\u6570\u521b\u5efa\u3002</p> <p>\u4e34\u65f6\u76ee\u5f55\u662f\u5728 with \u8bed\u53e5\u5757\u5185\u90e8\u521b\u5efa\u7684\uff0c\u5e76\u4e14\u5728\u9000\u51fa with \u8bed\u53e5\u5757\u65f6\u81ea\u52a8\u6e05\u7406\u548c\u5220\u9664\u3002</p> <p>\u66f4\u591a\u53c2\u8003\u6587\u6863</p> <p>shutil \u2014 High-level File Operations</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#5\u6587\u4ef6\u5185\u5bb9\u7ba1\u7406","title":"5.\u6587\u4ef6\u5185\u5bb9\u7ba1\u7406","text":"<p>\u4f7f\u7528filecmp_mkexamples.py\u521b\u5efa\u4e00\u7ec4\u6d4b\u8bd5\u6587\u4ef6\u3002</p> <pre><code># -*- coding:utf8 -*-\n# @Time    : 2023/8/7 16:49\n# @Author  : 18793\n# @File    : filecmp_mkexamples.py\n# @Software: PyCharm\n# @Desc    :\nimport os\ndef mkfile(filename, body=None):\nwith open(filename, 'w') as f:\nf.write(body or filename)\nreturn\ndef make_example_dir(top):\nif not os.path.exists(top):\nos.mkdir(top)\ncurdir = os.getcwd()\nos.chdir(top)\nos.mkdir('dir1')\nos.mkdir('dir2')\nmkfile('dir1/file_only_in_dir1')\nmkfile('dir2/file_only_in_dir2')\nos.mkdir('dir1/dir_only_in_dir1')\nos.mkdir('dir2/dir_only_in_dir2')\nos.mkdir('dir1/common_dir')\nos.mkdir('dir2/common_dir')\nmkfile('dir1/common_file', 'this file is the same')\nos.link('dir1/common_file', 'dir2/common_file')\nmkfile('dir1/contents_differ')\nmkfile('dir2/contents_differ')\n# Update the access and modification times so most of the stat\n# results will match.\nst = os.stat('dir1/contents_differ')\nos.utime('dir2/contents_differ', (st.st_atime, st.st_mtime))\nmkfile('dir1/file_in_dir1', 'This is a file in dir1')\nos.mkdir('dir2/file_in_dir1')\nos.chdir(curdir)\nreturn\nif __name__ == '__main__':\nos.chdir(os.path.dirname(__file__) or os.getcwd())\nmake_example_dir('example')\nmake_example_dir('example/dir1/common_dir')\nmake_example_dir('example/dir2/common_dir')\n</code></pre> <p>\u8fd0\u884c\u8be5\u811a\u672c\u4f1a\u5728\u76ee\u5f55\u793a\u4f8b\u4e0b\u751f\u6210\u4e00\u4e2a\u6587\u4ef6\u6811:</p> <pre><code>tree example/\nexample/\n\u251c\u2500\u2500 dir1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 common_dir\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 dir1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 common_dir\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 common_file\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 contents_differ\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 dir_only_in_dir1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 file_in_dir1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 file_only_in_dir1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 dir2\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 common_dir\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 common_file\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 contents_differ\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 dir_only_in_dir2\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 file_in_dir1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 file_only_in_dir2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 common_file\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 contents_differ\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dir_only_in_dir1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 file_in_dir1\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 file_only_in_dir1\n\u2514\u2500\u2500 dir2\n    \u251c\u2500\u2500 common_dir\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 dir1\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 common_dir\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 common_file\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 contents_differ\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 dir_only_in_dir1\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 file_in_dir1\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 file_only_in_dir1\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 dir2\n    \u2502\u00a0\u00a0     \u251c\u2500\u2500 common_dir\n    \u2502\u00a0\u00a0     \u251c\u2500\u2500 common_file\n    \u2502\u00a0\u00a0     \u251c\u2500\u2500 contents_differ\n    \u2502\u00a0\u00a0     \u251c\u2500\u2500 dir_only_in_dir2\n    \u2502\u00a0\u00a0     \u251c\u2500\u2500 file_in_dir1\n    \u2502\u00a0\u00a0     \u2514\u2500\u2500 file_only_in_dir2\n    \u251c\u2500\u2500 common_file\n    \u251c\u2500\u2500 contents_differ\n    \u251c\u2500\u2500 dir_only_in_dir2\n    \u251c\u2500\u2500 file_in_dir1\n    \u2514\u2500\u2500 file_only_in_dir2\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#51-\u76ee\u5f55\u548c\u6587\u4ef6\u6bd4\u8f83","title":"5.1 \u76ee\u5f55\u548c\u6587\u4ef6\u6bd4\u8f83","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#cmp","title":"cmp","text":"<p>cmp\u7528\u4e8e\u6bd4\u8f83\u7cfb\u7edf\u4e0a\u7684\u4e24\u4e2a\u6587\u4ef6</p> <pre><code># filecmp_cmp.py\nimport filecmp\nprint('common_file    :', end=' ')\nprint(filecmp.cmp('example/dir1/common_file',\n'example/dir2/common_file',\nshallow=True),\nend=' ')\nprint(filecmp.cmp('example/dir1/common_file',\n'example/dir2/common_file',\nshallow=False))\nprint('contents_differ:', end=' ')\nprint(filecmp.cmp('example/dir1/contents_differ',\n'example/dir2/contents_differ',\nshallow=True),\nend=' ')\nprint(filecmp.cmp('example/dir1/contents_differ',\n'example/dir2/contents_differ',\nshallow=False))\nprint('identical      :', end=' ')\nprint(filecmp.cmp('example/dir1/file_only_in_dir1',\n'example/dir1/file_only_in_dir1',\nshallow=True),\nend=' ')\nprint(filecmp.cmp('example/dir1/file_only_in_dir1',\n'example/dir1/file_only_in_dir1',\nshallow=False))\n</code></pre> <p>shallow\u53c2\u6570\u544a\u8bc9cmp()\u9664\u4e86\u6587\u4ef6\u7684\u5143\u6570\u636e\u5916\uff0c\u662f\u5426\u8fd8\u8981\u67e5\u770b\u6587\u4ef6\u7684\u5185\u5bb9\u3002\u9ed8\u8ba4\u60c5 \u51b5\u4e0b\uff0c\u4f1a\u4f7f\u7528\u75310s.stat()\u5f97\u5230\u7684\u4fe1\u606f\u6765\u5b8c\u6210\u4e00\u4e2a\u6d45\u6bd4\u8f83\u3002</p> <p>\u5982\u679c\u7ed3\u679c\u662f\u4e00\u6837\u7684\uff0c\u5219\u8ba4\u4e3a\u6587\u4ef6\u76f8\u540c\u3002</p> <p>\u56e0\u6b64\uff0c\u5bf9\u4e8e\u540c\u65f6\u521b\u5efa\u7684\u76f8\u540c\u5927\u5c0f\u7684\u6587\u4ef6\uff0c\u5373\u4f7f\u5b83\u4eec\u7684\u5185\u5bb9\u4e0d\u540c\uff0c\u4e5f\u4f1a\u62a5\u544a\u4e3a\u662f\u76f8\u540c\u7684\u6587\u4ef6\u3002\u5f53shallow\u4e3aFalse\u65f6\uff0c\u5219\u8981\u6bd4\u8f83\u6587\u4ef6\u7684\u5185\u5bb9\u3002</p> <pre><code>$ python3 filecmp_cmp.py\ncommon_file    : True True\ncontents_differ: True False\nidentical      : True True\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#cmpfiles","title":"cmpfiles","text":"<p><pre><code># filecmp_cmpfiles.py\nimport filecmp\nimport os\n# Determine the items that exist in both directories\nd1_contents = set(os.listdir('example/dir1'))\nd2_contents = set(os.listdir('example/dir2'))\ncommon = list(d1_contents &amp; d2_contents)\ncommon_files = [\nf\nfor f in common\nif os.path.isfile(os.path.join('example/dir1', f))\n]\nprint('Common files:', common_files)\n# Compare the directories\nmatch, mismatch, errors = filecmp.cmpfiles(\n'example/dir1',\n'example/dir2',\ncommon_files,\n)\nprint('Match       :', match)\nprint('Mismatch    :', mismatch)\nprint('Errors      :', errors)\n</code></pre> cmpfiles()\u8fd4\u56de3\u4e2a\u6587\u4ef6\u540d\u5217\u8868\uff0c\u5206\u522b\u5305\u542b\u5339\u914d\u7684\u6587\u4ef6\u3001\u4e0d\u5339\u914d\u7684\u6587\u4ef6\u548c\u4e0d\u80fd\u6bd4\u8f83\u7684\u6587\u4ef6\uff08\u7531\u4e8e\u6743\u9650\u95ee\u9898\u6216\u51fa\u4e8e\u5176\u4ed6\u539f\u56e0\uff09\u3002</p> <pre><code>$ python3 filecmp_cmpfiles.py\nCommon files: ['contents_differ', 'file_in_dir1', 'common_file']\nMatch       : ['contents_differ', 'common_file']\nMismatch    : ['file_in_dir1']\nErrors      : []\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#dircmp\u7c7b","title":"dircmp\u7c7b","text":"<p>\u524d\u9762\u4ecb\u7ecd\u7684\u51fd\u6570\u9002\u5408\u5b8c\u6210\u76f8\u5bf9\u7b80\u5355\u7684\u6bd4\u8f83\u3002\u5bf9\u4e8e\u5927\u76ee\u5f55\u6811\u7684\u9012\u5f52\u6bd4\u8f83\u6216\u8005\u66f4\u5b8c\u6574\u7684\u5206\u6790\uff0cdircmp\u7c7b\u4f1a\u66f4\u6709\u7528\u3002 \u5728\u6700\u7b80\u5355\u7684\u7528\u4f8b\u4e2d\uff0creport()\u4f1a\u6253\u5370\u6bd4\u8f83\u4e24\u4e2a\u76ee\u5f55\u7684\u62a5\u544a\u3002</p> <pre><code># filecmp_dircmp_report.py\nimport filecmp\ndc = filecmp.dircmp('example/dir1', 'example/dir2')\ndc.report()\n</code></pre> <pre><code>$ python3 filecmp_dircmp_report.py\n\ndiff example/dir1 example/dir2\nOnly in example/dir1 : ['dir_only_in_dir1', 'file_only_in_dir1']\nOnly in example/dir2 : ['dir_only_in_dir2', 'file_only_in_dir2']\nIdentical files : ['common_file']\nDiffering files : ['contents_differ']\nCommon subdirectories : ['common_dir']\nCommon funny cases : ['file_in_dir1']\n</code></pre> <p>\u4e3a\u4e86\u66f4\u591a\u7684\u7ec6\u8282\uff0c\u4e5f\u4e3a\u4e86\u5b8c\u6210\u4e00\u4e2a\u9012\u5f52\u6bd4\u8f83\uff0c\u53ef\u4ee5\u4f7f\u7528report_full_closure():</p> <pre><code>import filecmp\ndc = filecmp.dircmp('example/dir1', 'example/dir2')\ndc.report_full_closure()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u6848\u4f8b-\u6587\u4ef6\u4e0e\u76ee\u5f55\u5dee\u5f02\u5bf9\u6bd4\u65b9\u6cd5","title":"\u6848\u4f8b: \u6587\u4ef6\u4e0e\u76ee\u5f55\u5dee\u5f02\u5bf9\u6bd4\u65b9\u6cd5","text":"<p>Python\u7684\u6807\u51c6\u5e93filecmp\u6a21\u5757\u53ef\u4ee5\u5b9e\u73b0\u6587\u4ef6\u3001\u76ee\u5f55\u3001\u904d\u5386\u5b50\u76ee\u5f55\u7684\u5dee\u5f02\u5bf9\u6bd4\u529f\u80fd\u3002</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2019/8/17 10:18\n# filename: \u6821\u9a8c\u6e90\u4e0e\u5907\u4efd\u76ee\u5f55\u5dee\u5f02.py\nimport os, sys\nimport filecmp\nimport re\nimport shutil\nPWd_path = os.path.abspath(os.path.dirname(__file__))\n# \u521b\u5efa\u4e00\u4e2a\u7a7a\u5217\u8868\nholderlist = []\ndef compareme(dir1, dir2):\n\"\"\"\n    \u9012\u5f52\u83b7\u53d6\u66f4\u65b0\u9879\u51fd\u6570\n    :param dir1: source dir\n    :param dir2: target dir\n    :return:\n    \"\"\"\ndircomp = filecmp.dircmp(dir1, dir2)\nonly_in_one = dircomp.left_only  # \u6e90\u76ee\u5f55\u65b0\u6587\u4ef6\u6216\u76ee\u5f55\ndiff_in_one = dircomp.diff_files  # \u4e0d\u5339\u914d\u6587\u4ef6\uff0c\u6e90\u76ee\u5f55\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\ndirpath = os.path.abspath(dir1)  # \u83b7\u53d6\u6e90\u76ee\u5f55\u7edd\u5bf9\u8def\u5f84\n[holderlist.append(os.path.abspath(os.path.join(dir1, x))) for x in only_in_one]\n[holderlist.append(os.path.abspath(os.path.join(dir1, x))) for x in diff_in_one]\nif len(dircomp.common_dirs) &gt; 0:\nfor item in dircomp.common_dirs:\ncompareme(os.path.abspath(os.path.join(dir1, item)), \\\n                      os.path.abspath(os.path.join(dir2, item)))\nreturn holderlist\nelse:\nreturn holderlist\ndef main():\n# if len(sys.argv) &gt; 2:\n#     # dir1 = sys.argv[1]\n#     dir1 = \"D:/1.\u5b66\u4e60\u77e5\u8bc6\u5f85\u6574\u7406\\DevOps\u81ea\u52a8\u5316\u8fd0\u7ef4/https-github.com-yorkoliu-pyauto-master/\u7b2c\u4e8c\u7ae0/filecmp/dir1\"\n#     # dir2 = sys.argv[2]\n#     dir2 = \"D:/1.\u5b66\u4e60\u77e5\u8bc6\u5f85\u6574\u7406\\DevOps\u81ea\u52a8\u5316\u8fd0\u7ef4/https-github.com-yorkoliu-pyauto-master/\u7b2c\u4e8c\u7ae0/filecmp/dir2\"\n# else:\n#     print(\"Usage: \", sys.argv[0], \"datadir backupdir\")\n#     sys.exit()\ndir1 = PWd_path + \"/dir1/\"\ndir2 = PWd_path + \"/dir2/\"\nsource_files = compareme(dir1, dir2)\nif not dir2.endswith('/'): dir2 = dir2 + '/'\ndir1 = dir1.replace(\"\\\\\", \"/\")\ndir2 = dir2.replace(\"\\\\\", \"/\")\ndestination_files = []\ncreatedir_bool = False\n#\nfor item in source_files:\nitem = item.replace(\"\\\\\", \"/\")\n# print(dir1, dir2, item)\ndestination_dir = re.sub(dir1, dir2, item)\ndestination_files.append(destination_dir)\n# print(destination_files)\nif os.path.isdir(item):\nif not os.path.exists(destination_dir):\nos.makedirs(destination_dir)\ncreatedir_bool = True\nif createdir_bool:\ndestination_files = []\nsource_files = []\nsource_files = compareme(dir1, dir2)\nfor item in source_files:\ndestination_dir = re.sub(dir1, dir2, item)\ndestination_files.append(destination_dir)\nprint(\"update item:\")\nprint(\"---------------------------------------\")\nprint(source_files)     # \u8f93\u51fa\u66f4\u65b0\u5217\u8868\u6e05\u5355\nprint(\"---------------------------------------\")\n#\ncopy_pair = zip(source_files, destination_files)\nfor item in copy_pair:\nif os.path.isfile(item[0]):\nshutil.copyfile(item[0], item[1])\nif __name__ == '__main__':\nmain()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#52-md5\u6821\u9a8c\u6bd4\u8f83","title":"5.2 MD5\u6821\u9a8c\u6bd4\u8f83","text":"<p>MD5\u54c8\u5e0c\u4e00\u822c\u7528\u4e8e\u68c0\u67e5\u6587\u4ef6\u5b8c\u6574\u6027\uff0c\u5c24\u5176\u5e38\u7528\u4e8e\u68c0\u6d4b\u6587\u4ef6\u4f20\u8f93\u3001\u78c1\u76d8\u9519\u8bef\u6216\u5176\u4ed6\u60c5\u51b5\u4e0b\u6587\u4ef6\u7684\u6b63\u786e\u6027\u3002</p> <p>\u5728Linux\u4e0b\u8ba1\u7b97\u4e00\u4e2a\u6587\u4ef6\u7684MD5\u6821\u9a8c\u7801\uff0c\u53ea\u9700\u8981\u4ee5\u6587\u4ef6\u540d\u4e3a\u53c2\u6570\u8c03\u7528md5sum\u547d\u4ee4\u5373\u53ef\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>md5sum /etc/passwd\na511925e8fece8970fd45f4c49e4b3a7    /etc/passwd\n</code></pre> <p>\u5728Python\u4e2d\u8ba1\u7b97\u6587\u4ef6\u7684MD5\u6821\u9a8c\u7801\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u4f7f\u7528\u6807\u51c6\u5e93\u4e2d\u7684hashlib\u6a21\u5757\u5373\u53ef\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <p>md5\u52a0\u5bc6</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2020/3/20 10:19\n# filename: sample01.py\nimport hashlib\nd = hashlib.md5()\nwith open(\"passwd.txt\") as f:\n# d.update(f.read().encode(\"utf-8\"))\nfor line in f:\nd.update(line.encode(\"utf-8\"))\nprint(d.hexdigest())\n</code></pre> <p>\u83b7\u53d6\u6587\u4ef6\u7684MD5</p> <pre><code>import os\nimport hashlib\ndef md5sum(filename):\n\"\"\"\n  \u7528\u4e8e\u83b7\u53d6\u6587\u4ef6\u7684md5\u503c\n  :param filename: \u6587\u4ef6\u540d\n  :return: MD5\u7801\n  \"\"\"\nif not os.path.isfile(filename):  # \u5982\u679c\u6821\u9a8cmd5\u7684\u6587\u4ef6\u4e0d\u662f\u6587\u4ef6\uff0c\u8fd4\u56de\u7a7a\nreturn\nmyhash = hashlib.md5()\nf = open(filename, 'rb')\nwhile True:\nb = f.read(8096)\nif not b:\nbreak\nmyhash.update(b)   \nf.close()\nreturn myhash.hexdigest()\n</code></pre> <p>sha1\u52a0\u5bc6</p> <pre><code>hash = hashlib.sha1()\nhash.update('admin'.encode('utf-8'))\nprint(hash.hexdigest())\n# d033e22ae348aeb5660fc2140aec35850c4da997\n</code></pre> <p>sha256\u52a0\u5bc6</p> <pre><code>hash = hashlib.sha256()\nhash.update('admin'.encode('utf-8'))\nprint(hash.hexdigest())\n# 8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918\n</code></pre> <p>sha512\u52a0\u5bc6</p> <pre><code>hash = hashlib.sha512()\nhash.update('admin'.encode('utf-8'))\nprint(hash.hexdigest())\nc7ad44cbad762a5da0a452f9e854fdc1e0e7a52a38015f23f3eab1d80b931dd472634dfac71cd34ebc35d16ab7fb8a90c81f975113d6c7538dc69dd8de9077ec\n</code></pre> <p>SHA512\u548cMD5\u7684\u7b80\u5355\u6bd4\u8f83\uff1a</p> <ul> <li> <p>SHA512\uff1a\u66f4\u957f\u3001\u5b89\u5168\uff0c\u4f46\u662f\u6162</p> </li> <li> <p>MD5\uff1a\u5feb\uff0c\u4f46\u662f\u73b0\u5728\u88ab\u53cd\u63a8\u4e86</p> </li> </ul> <p>\u767b\u9646\u7684\u7528\u6237\u540d\u53ca\u5bc6\u7801\u751f\u6210\u5bc6\u6587</p> <pre><code>import hashlib\ndef get_md5(username,password):\n# \u52a0\u76d0\nmd5 = hashlib.md5(username.encode('utf-8'))\n# \u5229\u7528\u4e4b\u524d\u7684\u76d0\u4e0e\u5bc6\u7801\u751f\u6210\u5bc6\u6587\nmd5.update(password.encode('utf-8'))\n# \u6700\u7ec8\u751f\u6210\u5bc6\u6587\nreturn md5.hexdigest()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#53-\u6848\u4f8b-\u627e\u5230\u76ee\u5f55\u4e0b\u7684\u91cd\u590d\u6587\u4ef6","title":"5.3 \u6848\u4f8b: \u627e\u5230\u76ee\u5f55\u4e0b\u7684\u91cd\u590d\u6587\u4ef6","text":"<pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# auther; 18793\n# Date\uff1a2020/3/20 10:32\n# filename: sample02.py\nimport fnmatch\nimport os\nimport hashlib\nimport sys\nCHUNK_SIZE = 8192\ndef is_file_match(filename, patterns):\nfor pattern in patterns:\nif fnmatch.fnmatch(filename, pattern):\nreturn True\nreturn False\ndef find_specific_files(root, patterns=['*'], exclude_dirs=[]):\n'''\n    :param root: \u67e5\u627e\u7684\u6839\u8def\u5f84\n    :param patterns:\u5339\u914d\u7684\u6587\u4ef6\u6a21\u5f0f\u5217\u8868\n    :param exclude_dirs:\u9700\u8981\u6392\u9664\u7684\u76ee\u5f55\u5217\u8868\n    :return:\n    '''\nfor root, dirnames, filenames in os.walk(root):\nfor filename in filenames:\nif is_file_match(filename, patterns):\nyield os.path.join(root, filename)\nfor d in exclude_dirs:\nif d in dirnames:\ndirnames.remove(d)\ndef get_chunk(filename):\n\"\"\"\n    :param filename: \u6587\u4ef6\u540d\n    :return:  \u8bfb\u53d6\u6587\u4ef6\uff0c\u4f7f\u7528while\uff0cyield\u751f\u6210\u5668\u65b9\u5f0f\u8bfb\u53d6\u8282\u7701\u5185\u5b58\n    \"\"\"\nwith open(filename) as f:\nwhile True:\nchunk = f.read(CHUNK_SIZE)\nif not chunk:\nbreak\nelse:\nyield chunk\ndef get_file_checksum(filename):\n\"\"\"\n    :param filename: \u6587\u4ef6\u540d\n    :return: \u8fd4\u56de\u6587\u4ef6\u7684MD5\u503c\n    \"\"\"\nh = hashlib.md5()\nfor chunk in get_chunk(filename):\nh.update(chunk)\nreturn h.hexdigest()\ndef main():\n# \u5224\u65ad\u7528\u6237\u8f93\u5165\uff0c\u6355\u83b7\u7528\u6237\u8f93\u5165\u7684\u53c2\u65701\nsys.argv.append(\"\")\ndirectory = sys.argv[1]\nif not os.path.isdir(directory):\nraise SystemExit(\"{0} is not a directory \".format(directory))\n# \u5f00\u59cb\u6821\u9a8c\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u5c06\u6587\u4ef6MD5\u503c\u4e0e\u5b57\u5178\u4e2d\u7684key\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u5728\u5b57\u5178\u4e2d\u8005\u663e\u793a\u91cd\u590d\nrecord = {}\nfor item in find_specific_files(directory):\nchecksum = get_file_checksum(item)\nif checksum in record:\n# \u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\u4e8e\u5b57\u5178\u4e4b\u4e2d\nprint(\"find duplicate file:{0} vs {1}\".format(record[checksum], item))\nelse:\n# \u4fdd\u5b58\u5230\u5b57\u5178\u4e2d\nrecord[checksum] = item\nif __name__ == '__main__':\nmain()\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u901a\u8fc7\u547d\u4ee4\u884c\u6307\u5b9a\u9700\u8981\u67e5\u627e\u7684\u76ee\u5f55\uff0c\u5e76\u5728main\u51fd\u6570\u4e2d\u5224\u65ad\u7528\u6237\u8f93\u4eba\u7684\u53c2\u6570\u662f\u5426\u4e3a\u4e00\u4e2a\u6b63\u786e\u7684\u76ee\u5f55\u3002</p> <p>\u5224\u65ad\u5b8c\u6210\u4ee5\u540e\uff0c\u4f7f\u7528find_specific files\u51fd\u6570\u904d\u5386\u8be5\u76ee\u5f55\uff0c\u5f97\u5230\u8be5\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002</p> <p>\u904d\u5386\u5f97\u5230\u6587\u4ef6\u5217\u8868\uff0c\u5e76\u5c06\u6587\u4ef6\u548c\u6587\u4ef6\u7684MD5\u6821\u9a8c\u7801\u4fdd\u5b58\u5230\u4e00\u4e2a\u5b57\u5178\u4e4b\u4e2d\u3002</p> <p>\u8fd9\u91cc\u6709\u4e00\u4e2a\u5b9e\u73b0\u4e0a\u7684\u5c0f\u6280\u5de7\uff0c\u4e3a\u4e86\u5728\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u5230\u6765\u65f6\uff0c\u5224\u65ad\u8be5\u6587\u4ef6\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u4e8e\u5b57\u5178\u4e2d\uff0c\u5b57\u5178\u7684\u952e\u662f\u6587\u4ef6\u7684MD5\u6821\u9a8c\u7801\uff0c\u5b57\u5178\u7684\u503c\u662f\u6587\u4ef6\u7684\u540d\u79f0\u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5c31\u80fd\u591f\u5feb\u901f\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u4e8e\u5b57\u5178\u4e4b\u4e2d\u3002</p> <p>\u5982\u679c\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\u4e8e\u5b57\u5178\u4e4b\u4e2d\uff0c\u5219\u8ba4\u4e3a\u5f53\u524d\u8fd9\u4e2a\u6587\u4ef6\u548c\u5df2\u7ecf\u5b58\u5728\u7684\u67d0\u4e2a\u6587\u4ef6\u91cd\u590d\uff0c\u6253\u5370\u8fd9\u4e2a\u91cd\u590d\u6587\u4ef6\u3002</p> <p>\u66f4\u591a\u53c2\u8003\u6587\u6863</p> <p>hashlib \u2014 Cryptographic Hashing</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#6\u4f7f\u7528python\u7ba1\u7406\u538b\u7f29\u5305","title":"6.\u4f7f\u7528Python\u7ba1\u7406\u538b\u7f29\u5305","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#61-\u4f7f\u7528tarfile\u5e93\u8bfb\u53d6\u4e0e\u521b\u5efatar\u5305","title":"6.1 \u4f7f\u7528tarfile\u5e93\u8bfb\u53d6\u4e0e\u521b\u5efatar\u5305","text":"<p>Python\u7684tarfile\u6807\u51c6\u5e93\u63d0\u4f9b\u4e86tar\u547d\u4ee4\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b83\u521b\u5efa\u4e00\u4e2a\u538b\u7f29\u6216\u975e\u538b\u7f29\u7684tar\u5305\u3002</p> <p>Python\u5411\u6765\u4ee5\u7b80\u5355\u6613\u7528\u8457\u79f0\uff0c\u5bf9\u4e8e\u4e00\u540d\u8ba1\u7b97\u673a\u521d\u5b66\u8005\u6765\u8bf4\uff0cPython\u6807\u51c6\u5e93\u7684tarfile\u6a21\u5757\u6216\u8bb8\u6bd4Linux\u4e0b\u7684tar\u547d\u4ee4\u66f4\u52a0\u597d\u7528\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#1\u8bfb\u53d6tar\u5305","title":"1.\u8bfb\u53d6tar\u5305","text":"<pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport tarfile\nwith tarfile.open('example.tar.gz') as t:\nfor member_info in t.getmembers():\nprint(member_info.name)\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u5bfc\u5165tarfile\u5e93\uff0c\u7136\u540e\u4f7f\u7528\u9ed8\u8ba4\u7684\u8bfb\u6a21\u5f0f\u6253\u5f00tar\u5305\u3002</p> <p>tarfile.open\u51fd\u6570\u4f1a\u8fd4\u56de\u4e00\u4e2aTarFile\u7684\u5bf9\u8c61\uff0c\u7528\u8fd9\u4e2a\u5bf9\u8c61\u8868\u793a\u5f53\u524d\u6253\u5f00\u7684tar\u5305\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5\u64cd\u4f5c\u548c\u8bfb\u53d6tar\u5305\u7684\u5185\u5bb9\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7TarFile\u5bf9\u8c61\u7684getmembers\u65b9\u6cd5\u83b7\u53d6\u4e86tar\u5305\u4e2d\u7684\u6587\u4ef6\u5217\u8868\u3002</p> <p>tarfile\u4e2d\u6709\u4e0d\u5c11\u51fd\u6570\uff0c\u5176\u4e2d\uff0c\u6700\u5e38\u7528\u7684\u662f\uff1a</p> \u65b9\u6cd5 \u7528\u9014 t = tarfile.open() \u6253\u5f00\u6216\u65b0\u5efa\u4e00\u4e2a\u5f52\u6863\u6587\u4ef6\uff0c\u8fd4\u56de\u4e00\u4e2aTarFile\u7c7b\u578b\u7684\u5bf9\u8c61t t.getmembers() \u83b7\u53d6\u5305\u5185\u6240\u6709\u6210\u5458\u7684\u4fe1\u606f t.add() \u5c06\u6307\u5b9a\u6587\u4ef6\u52a0\u5165\u5305\u5185 t.extract() \u89e3\u5305\u6307\u5b9a\u6587\u4ef6 t.extractall() \u89e3\u5305\u6240\u6709\u6587\u4ef6 TarFile.close() \u5173\u95edTarFile\u6587\u4ef6"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#2\u521b\u5efatar\u5305","title":"2.\u521b\u5efatar\u5305","text":"<pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport tarfile\nwith tarfile.open('tarfile_add.tar',mode='w') as out:\nout.add(\"shutil_make_archive.py\")\n</code></pre> <pre><code># \u538b\u7f29tar.gz\nimport os\nimport tarfile\ntar = tarfile.open(\"/tmp/tartest.tar.gz\",\"w:gz\")   # \u521b\u5efa\u538b\u7f29\u5305\u540d\nfor path,dir,files in os.walk(\"/tmp/tartest\"):     # \u9012\u5f52\u6587\u4ef6\u76ee\u5f55\nfor file in files:\nfullpath = os.path.join(path,file)\ntar.add(fullpath)                          # \u521b\u5efa\u538b\u7f29\u5305\ntar.close()\ndef tar_gz(fname, pwd):\n\"\"\"\n    \u628a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684fname\uff0c\u6253\u6210fname.tar.gz\n    :param fname:\n    :return:\n    \"\"\"\nt = tarfile.open(fname + \".tar.gz\", \"w:gz\")\nfor root, dir, files in os.walk(fname):\nfor file in files:\nfullpath = os.path.join(root, file)\nt.add(fullpath)\nt.close()\n# \u89e3\u538btar.gz\nimport tarfile\ntar = tarfile.open(\"/tmp/tartest.tar.gz\")\n#tar.extract(\"/tmp\")                               # \u5168\u90e8\u89e3\u538b\u5230\u6307\u5b9a\u8def\u5f84\nnames = tar.getnames()                             # \u5305\u5185\u6587\u4ef6\u540d\nfor name in names:\ntar.extract(name,path=\"./\")                    # \u89e3\u538b\u6307\u5b9a\u6587\u4ef6\ntar.close()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#62-\u4f7f\u7528tarfile\u8bfb\u53d6\u4e0e\u521b\u5efa\u538b\u7f29\u5305","title":"6.2 \u4f7f\u7528tarfile\u8bfb\u53d6\u4e0e\u521b\u5efa\u538b\u7f29\u5305","text":"<p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2atar\u5305\u7684\u65f6\u5019\u90fd\u4f1a\u4f7f\u7528\u538b\u7f29\u7b97\u6cd5\u8fdb\u884c\u538b\u7f29\uff0c\u4ee5\u51cf\u5c11\u6570\u636e\u4f20\u8f93\u7684\u5e26\u5bbd\u548c\u78c1\u76d8\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</p> <p>\u4f7f\u7528tarfile\u521b\u5efa\u548c\u8bfb\u53d6\u538b\u7f29\u5305\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u8981\u5728\u6253\u5f00\u6587\u4ef6\u65f6\u6307\u5b9a\u538b\u7f29\u7b97\u6cd5\u5373\u53ef\u3002</p> <p>\u5bf9\u4e8etarfile\u7684open\u51fd\u6570\uff0c\u4ee5\"\u6253\u5f00\u6a21\u5f0f\uff1a\u538b\u7f29\u7b97\u6cd5\"\u7684\u5f62\u5f0f\u6253\u5f00\u5373\u53ef\u3002\u4f8b\u5982\uff1a</p> <p>1\uff09\u8bfb\u53d6\u4e00\u4e2a\u7528gzip\u7b97\u6cd5\u538b\u7f29\u7684tar\u5305\uff1a</p> <pre><code>with tarfile.open('tarfile_add.tar',mode='r:gz')as out:\n</code></pre> <p>2)\u521b\u5efa\u4e00\u4e2a\u7528bzip2\u7b97\u6cd5\u538b\u7f29\u7684tar\u5305\uff1a</p> <pre><code>with tarfile.open('tarfile_add.tar',mode='w:bz2')as out:\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#63-\u6848\u4f8b-\u5907\u4efd\u6307\u5b9a\u7684\u6587\u4ef6\u5230\u538b\u7f29\u5305\u4e2d","title":"6.3 \u6848\u4f8b: \u5907\u4efd\u6307\u5b9a\u7684\u6587\u4ef6\u5230\u538b\u7f29\u5305\u4e2d","text":"<p>\u8fd9\u91cc\u8fd8\u662f\u4ee5\u5907\u4efd\u6240\u6709\u56fe\u7247\u4e3a\u4f8b\uff0c\u5c06\u6240\u6709\u56fe\u7247\u6587\u4ef6\u5907\u4efd\u5230\u538b\u7f29\u5305\u4e2d\uff0c\u5e76\u5728\u538b\u7f29\u5305\u7684\u540d\u79f0\u4e2d\u52a0\u5165\u5f53\u524d\u65f6\u95f4\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#!/usr/bin/env python\n#-*- coding:utf8 -*-\nimport os\nimport tarfile\nimport fnmatch\nimport datetime\ndef is_file_match(filename,patterns):\nfor pattern in patterns:\nif fnmatch.fnmatch(filename,pattern):\nreturn True\nreturn False\ndef find_specific_files(root,patterns=['*'],exclude_dirs=[]):\n'''\n    :param root: \u67e5\u627e\u7684\u6839\u8def\u5f84\n    :param patterns:\u5339\u914d\u7684\u6587\u4ef6\u6a21\u5f0f\u5217\u8868\n    :param exclude_dirs:\u9700\u8981\u6392\u9664\u7684\u76ee\u5f55\u5217\u8868\n    :return:\n    '''\nfor root,dirnames,filenames in os.walk(root):\nfor finame in filenames:\nif is_file_match(finame,patterns):\nyield os.path.join(root,finame)\nfor d in exclude_dirs:\nif d in dirnames:\ndirnames.remove(d)\ndef main():\npatterns = ['*.jpg','*.jpeg','*.png','*.tif','*.tiff']\nnow = datetime.datetime.now().strftime(\"%Y_%m_%d_%H_%M_%S\")\nfilename = \"all_images_{}.tar.gz\".format(now)\nwith tarfile.open(filename,\"w:gz\") as f:\nfor item in find_specific_files(\".\",patterns):\nf.add(item)\nif __name__ == '__main__':\nmain()\n</code></pre> <p>\u6211\u4eec\u5b9a\u4e49\u7684<code>find_specific_files</code>\u51fd\u6570\u5341\u5206\u901a\u7528\uff0c\u6240\u4ee5\uff0c\u5b9e\u73b0\u5907\u4efd\u6307\u5b9a\u76ee\u5f55\u4e0b\u67d0\u4e00\u7c7b\u6587\u4ef6\u7684\u529f\u80fd\u4e5f\u975e\u5e38\u7b80\u5355\u3002</p> <p>\u91cd\u70b9\u5728\u4e8e\u5c06\u904d\u5386\u5230\u7684\u6587\u4ef6\u6dfb\u52a0\u5230\u538b\u7f29\u5305\u4e2d\u3002\u5907\u4efd\u5b8c\u6210\u4ee5\u540e\uff0c\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u4e0b\u9762\u8fd9\u4e2a\u6587\u4ef6\u540d\u7684\u3001\u5305\u542b\u5f53\u524d\u65f6\u95f4\u7684\u538b\u7f29\u5305\uff1a</p> <pre><code>a11_images._2017_03_15_20_43_32.tar.gz\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#64-\u4f7f\u7528zipfile\u8bfb\u53d6\u4e0e\u521b\u5efazip\u538b\u7f29\u5305","title":"6.4 \u4f7f\u7528zipfile\u8bfb\u53d6\u4e0e\u521b\u5efazip\u538b\u7f29\u5305","text":"<p>\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5728Linux\u4e0b\u4f7f\u7528gzip\u6216bzip2\u8fdb\u884c\u538b\u7f29\uff0c\u5728Windows\u4e0b\u4f7f\u7528zip\u8fdb\u884c\u538b\u7f29\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u538b\u7f29zip","title":"\u538b\u7f29zip","text":"<pre><code>import zipfile,os\nf = zipfile.ZipFile('filename.zip', 'w' ,zipfile.ZIP_DEFLATED)    # ZIP_STORE \u4e3a\u9ed8\u8ba4\u8868\u4e0d\u538b\u7f29. ZIP_DEFLATED \u8868\u538b\u7f29\n#f.write('file1.txt')                              # \u5c06\u6587\u4ef6\u5199\u5165\u538b\u7f29\u5305\nfor path,dir,files in os.walk(\"tartest\"):          # \u9012\u5f52\u538b\u7f29\u76ee\u5f55\nfor file in files:\nf.write(os.path.join(path,file))           # \u5c06\u6587\u4ef6\u9010\u4e2a\u5199\u5165\u538b\u7f29\u5305\nf.close()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#\u89e3\u538bzip","title":"\u89e3\u538bzip","text":"<pre><code>import zipfile\nif zipfile.is_zipfile('filename.zip'):             # \u5224\u65ad\u4e00\u4e2a\u6587\u4ef6\u662f\u4e0d\u662fzip\u6587\u4ef6\nf = zipfile.ZipFile('filename.zip')\nfor file in f.namelist():                      # \u8fd4\u56de\u6587\u4ef6\u5217\u8868\nf.extract(file, r'/tmp/')                  # \u89e3\u538b\u6307\u5b9a\u6587\u4ef6\n#f.extractall()                                # \u89e3\u538b\u5168\u90e8\nf.close()\n</code></pre> <p>\u5c01\u88c5\u4e3a\u51fd\u6570\u6848\u4f8b</p> <pre><code>import zipfile\ndef unzip_file(zip_path, extract_path):\n\"\"\"\n    \u89e3\u538b ZIP \u6587\u4ef6\n    :param zip_path: ZIP \u6587\u4ef6\u8def\u5f84\n    :param extract_path: \u89e3\u538b\u8def\u5f84\n    \"\"\"\nwith zipfile.ZipFile(zip_path, 'r') as zip_ref:\nzip_ref.extractall(extract_path)\ndef create_zip(files, zip_path):\n\"\"\"\n    \u521b\u5efa ZIP \u6587\u4ef6\n    :param files: \u8981\u6dfb\u52a0\u5230 ZIP \u6587\u4ef6\u4e2d\u7684\u6587\u4ef6\u5217\u8868\n    :param zip_path: ZIP \u6587\u4ef6\u4fdd\u5b58\u8def\u5f84\n    \"\"\"\nwith zipfile.ZipFile(zip_path, 'w') as zip_ref:\nfor file in files:\nzip_ref.write(file)\n# \u793a\u4f8b\u7528\u6cd5\n# \u89e3\u538b ZIP \u6587\u4ef6\nunzip_file('path/to/archive.zip', 'path/to/extract')\n# \u521b\u5efa ZIP \u6587\u4ef6\nfiles_to_zip = ['file1.txt', 'file2.txt', 'file3.txt']\ncreate_zip(files_to_zip, 'path/to/archive.zip')\n</code></pre> <p>\u66f4\u591a\u53c2\u8003\u6587\u6863</p> <p>tarfile \u2014 Tar Archive Access zipfile \u2014 ZIP Archive Access</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#65-\u6848\u4f8b-\u66b4\u529b\u7834\u89e3zp\u538b\u7f29\u5305\u7684\u5bc6\u7801","title":"6.5 \u6848\u4f8b: \u66b4\u529b\u7834\u89e3zp\u538b\u7f29\u5305\u7684\u5bc6\u7801","text":"<p>\u5c06\u5bc6\u7801\u672c\u91cc\u9762\u7684\u5bc6\u7801\u9010\u4e00\u5c1d\u8bd5\u8f93\u5165\u8fdb\u884c\u7834\u89e3</p> <p><code>pojie.py</code></p> <pre><code>import zipfile\nimport argparse\nimport os\nfrom os.path import *\ndef tryZipPwd(zipFile, password, savePath):\ntry:\nzipFile.extractall(path=savePath, pwd=password.encode('utf-8'))\nprint('[+] Zip File decompression success,password: %s' % (password))\nreturn True\nexcept:\nprint('[-] Zip File decompression failed,password: %s' % (password))\nreturn False\ndef main():\n# \u8fd9\u91cc\u7528\u63cf\u8ff0\u521b\u5efa\u4e86 ArgumentParser \u5bf9\u8c61\nparser = argparse.ArgumentParser(description='Brute Crack Zip')\n# \u6dfb\u52a0 - H \u547d\u4ee4 dest \u53ef\u4ee5\u7406\u89e3\u4e3a\u54b1\u4eec\u89e3\u6790\u65f6\u83b7\u53d6 - H \u53c2\u6570\u540e\u9762\u503c\u7684\u53d8\u91cf\u540d, help \u662f\u8fd9\u4e2a\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f\nparser.add_argument('-f', dest='zFile', type=str, help='The zip file path.')\nparser.add_argument('-w', dest='pwdFile', type =str, help='Password dictionary file.')\nzFilePath = None\npwdFilePath = None\ntry:\noptions = parser.parse_args()\nzFilePath = options.zFile\npwdFilePath = options.pwdFile\nexcept:\nprint(parser.parse_args(['-h']))\nexit(0)\nif zFilePath == None or pwdFilePath == None:\nprint(parser.parse_args(['-h']))\nexit(0)\nwith zipfile.ZipFile(zFilePath) as zFile:\nwith open(pwdFilePath) as f:\nfor pwd in f.readlines():\np,f = split(zFilePath)\ndirName = f.split('.')[0]\ndirPath = join(p, dirName)\ntry:\nos.mkdir(dirPath)\nexcept:\npass\nok = tryZipPwd(zFile, pwd.strip('\\n'), dirPath)\nif ok:\nbreak\nif __name__ == '__main__':\nmain()\n</code></pre> <p>\u6700\u540e\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u6d4b\u8bd5\u7684\u5bc6\u7801\u5b57\u5178 pwd.txt\uff1a</p> <pre><code>1256\n4345\n2323\n1234\n4556\n......\n</code></pre> <pre><code> python3 pojie.py -f 1.zip -w pwd.txt </code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#7python\u6267\u884c\u5916\u90e8\u547d\u4ee4","title":"7.Python\u6267\u884c\u5916\u90e8\u547d\u4ee4","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#71-subprocess\u6a21\u5757\u4ecb\u7ecd","title":"7.1 subprocess\u6a21\u5757\u4ecb\u7ecd","text":"<p>subprocess\u6a21\u5757\u6700\u65e9\u662f\u5728Python2.4\u7248\u672c\u4e2d\u5f15\u5165\u7684\uff0c\u6b63\u5982\u5b83\u540d\u5b57\u6240\u53cd\u6620\u7684\uff0c\u8fd9\u4e2a\u6a21\u5757\u7528\u4e8e\u521b\u5efa\u548c\u7ba1\u7406\u5b50\u8fdb\u7a0b\u3002</p> <p>\u5b83\u63d0\u4f9b\u4e86\u9ad8\u5c42\u6b21\u7684\u63a5\u53e3\uff0c\u7528\u6765\u66ff\u6362<code>os.system()</code>,<code>os.spawn*()</code>,<code>os.popen*()</code>,<code>popen2.*()</code>\u548c<code>commands.*</code>\u7b49\u6a21\u5757\u4e0e\u51fd\u6570\u3002</p> <p>subprocess\u5176\u5b9e\u975e\u5e38\u7b80\u5355\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u540d\u4e3aPopen\u7684\u7c7b\u6765\u542f\u52a8\u548c\u8bbe\u7f6e\u5b50\u8fdb\u7a0b\u7684\u53c2\u6570\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e2a\u7c7b\u6bd4\u8f83\u590d\u6742\uff0csubprocess\u8fd8\u63d0\u4f9b\u4e86\u82e5\u5e72\u4fbf\u5229\u51fd\u6570\u3002</p> <p>\u8fd9\u4e9b\u4fbf\u5229\u51fd\u6570\u90fd\u662f\u5bf9Popen\u8fd9\u4e2a\u7c7b\u7684\u5c01\u88c5\uff0c\u4ee5\u4fbf\u5de5\u7a0b\u5e08\u80fd\u591f\u5feb\u901f\u542f\u52a8\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u5e76\u83b7\u53d6\u5b83\u4eec\u7684\u8f93\u51fa\u7ed3\u679c\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#72-subprocess\u7684\u4fbf\u5229\u51fd\u6570","title":"7.2 subprocess\u7684\u4fbf\u5229\u51fd\u6570","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#1call","title":"1.call","text":"<p>\u6267\u884c\u547d\u4ee4\uff0c\u5e76\u8fd4\u56de\u72b6\u6001\u7801\uff0c\u72b6\u6001\u78010\u4ee3\u8868\u547d\u4ee4\u6267\u884c\u6210\u529f\uff0c\u5176\u4ed6\u7684\u90fd\u8868\u793a\u547d\u4ee4\u6267\u884c\u4e0d\u6210\u529f</p> <pre><code>In [1]: import subprocess\n\nIn [2]: ret = subprocess.call([\"ls\", \"-l\"], shell=False)\ntotal 24\ndrwxr-xr-x 4 root root 4096 Apr 23 15:47 conf\ndrwxr-xr-x 6 root root 4096 Apr 23 16:31 data\n.....\n\nIn [3]: ret\nOut[3]: 0\n# call\u51fd\u6570\u6267\u884c\u7684\u5916\u90e8\u547d\u4ee4\u4ee5\u4e00\u4e2a\u5b57\u7b26\u4e32\u5217\u8868\u7684\u5f62\u5f0f\u8fdb\u884c\u4f20\u9012\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86shell\u4e3aTrue,\u5219\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u5b57\u7b26\u4e32\u547d\u4ee4\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u5217\u8868\u6765\u8fd0\u884c\u5b50\u8fdb\u7a0b\u3002\n# \u5982\u679c\u8bbe\u7f6e\u4e86shll\u4e3aTrue,Python\u5c06\u5148\u8fd0\u884c\u4e00\u4e2ashell,\u518d\u7528\u8fd9\u4e2ashell\u6765\u89e3\u91ca\u6574\u4e2a\u5b57\u7b26\u4e32\u3002\nIn [4]: ret = subprocess.call(\"ls -l\", shell=True)\nIn [5]: ret\nOut[5]: 0\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#2check_call","title":"2.check_call","text":"<p>\u6267\u884c\u547d\u4ee4\uff0c\u5982\u679c\u6267\u884c\u72b6\u6001\u7801\u662f0\uff0c\u5219\u8fd4\u56de0\uff0c\u5426\u5219\u629b<code>subprocess.CalledProcessError</code>\u5f02\u5e38</p> <pre><code>In [1]: import subprocess\n\nIn [2]: subprocess.check_call([\"ls\", \"-l\"])\ntotal 24\ndrwxr-xr-x 4 root root 4096 Apr 23 15:47 conf\ndrwxr-xr-x 6 root root 4096 Apr 23 16:31 data\n-rw-r--r-- 1 root root 1470 May 29 17:25 docker-compose.yml\n-rw-r--r-- 1 root root 1120 Apr 23 14:41 Dockerfile\n-rw-r--r-- 1 root root  368 Apr 23 14:41 README.md\ndrwxr-xr-x 2 root root 4096 Apr 23 14:42 scripts\nOut[2]: 0\nIn [3]: subprocess.check_call(\"exit 1\", shell=True)\n---------------------------------------------------------------------------\nCalledProcessError                        Traceback (most recent call last)\n&lt;ipython-input-3-35752273f909&gt; in &lt;module&gt;\n----&gt; 1 subprocess.check_call(\"exit 1\", shell=True)\n/usr/lib/python3.8/subprocess.py in check_call(*popenargs, **kwargs)\n362         if cmd is None:\n    363             cmd = popenargs[0]\n--&gt; 364         raise CalledProcessError(retcode, cmd)\n365     return 0\n366\nCalledProcessError: Command 'exit 1' returned non-zero exit status 1.\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#3check_output","title":"3.check_output","text":"<p>\u6267\u884c\u547d\u4ee4\uff0c\u5982\u679c\u72b6\u6001\u7801\u662f0\uff0c\u5219\u8fd4\u56de\u6267\u884c\u7ed3\u679c\uff0c\u5426\u5219\u629b\u5f02\u5e38</p> <pre><code># \u6267\u884c\u6210\u529f\u5c31\u628a\u6267\u884c\u7684\u7ed3\u679c\u8d4b\u503c\u7ed9\u53d8\u91cfV\n&gt;&gt;&gt; V = subprocess.check_output(\"python -V\", shell=True)\n# \u6267\u884c\u9519\u8bef\u7684\u547d\u4ee4\u5c31\u4f1a\u8f93\u51fa\u5f02\u5e38\n&gt;&gt;&gt; subprocess.check_output(\"pasas\", shell=True)\n'pasas' \u4e0d\u662f\u5185\u90e8\u6216\u5916\u90e8\u547d\u4ee4\uff0c\u4e5f\u4e0d\u662f\u53ef\u8fd0\u884c\u7684\u7a0b\u5e8f\n\u6216\u6279\u5904\u7406\u6587\u4ef6\u3002\nTraceback (most recent call last):\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\n  File \"C:\\Python35\\lib\\subprocess.py\", line 629, in check_output\n    **kwargs).stdout\n  File \"C:\\Python35\\lib\\subprocess.py\", line 711, in run\n    output=stdout, stderr=stderr)\nsubprocess.CalledProcessError: Command 'pasas' returned non-zero exit status 1\n</code></pre> <p>\u4ee5\u4e0a\u7684\u4e09\u79cd\u6267\u884c\u65b9\u5f0f\u5728\u6267\u884c\u547d\u4ee4\u7684\u65f6\u5019\uff0cshell\u9ed8\u8ba4\u7b49\u4e8eTrue\uff0c\u7b49\u4e8eTrue\u7684\u65f6\u5019\uff0c\u62ec\u53f7\u5185\u7684\u547d\u4ee4\u662f\u4e00\u884c\u7684\uff0c</p> <p>\u5982\u679cshell\u7b49\u4e8eFalse\uff0c\u90a3\u4e48<code>[]</code>\u5185\u7684\u5b57\u7b26\u4e32\u5c31\u662f\u547d\u4ee4\u7684\u4e00\u4e2a\u5143\u7d20\uff0c\u6267\u884c\u7684\u65f6\u5019\u4f1a\u628a<code>[]</code>\u5185\u7684\u5b57\u7b26\u4e32\u62fc\u63a5\u8d77\u6765\u6267\u884c\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#4callcheck_callcheck_output","title":"4.call\u3001check_call\u3001check_output","text":"<p><code>protest.py</code></p> <pre><code>print(Hello World!)\n</code></pre> <p><code>python import subprocess print('call() test:',subprocess.call(['python','protest.py'])) print('') print('check_call() test:',subprocess.check_call(['python','protest.py'])) print('') print('getstatusoutput() test:',subprocess.getstatusoutput(['python','protest.py'])) print('') print('getoutput() test:',subprocess.getoutput(['python','protest.py'])) print('') print('check_output() test:',subprocess.check_output(['python','protest.py']))</code></p> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>Hello World!\ncall() test: 0\nHello World!\ncheck_call() test: 0\ngetstatusoutput() test: (0, 'Hello World!')\ngetoutput() test: Hello World!\n\ncheck_output() test: b'Hello World!\\r\\n'\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#73-subprocess\u6a21\u5757\u7684popen\u7c7b","title":"7.3 subprocess\u6a21\u5757\u7684Popen\u7c7b","text":"<p>call()\u3001check_call()\u3001check_output()\u9ed8\u8ba4\u5185\u90e8\u8c03\u7528\u7684\u90fd\u662fsubprocess.Popen()\uff0c\u800csubprocess.Popen()\u5219\u7528\u4e8e\u6267\u884c\u66f4\u590d\u6742\u7684\u7cfb\u7edf\u547d\u4ee4\u3002</p> <p>\u6784\u9020\u51fd\u6570\uff1a</p> <pre><code>class subprocess.Popen(args, bufsize=-1, executable=None, stdin=None, stdout=None, stderr=None, \npreexec_fn=None, close_fds=True, shell=False, cwd=None, env=None, universal_newlines=False, \nstartupinfo=None, creationflags=0,restore_signals=True, start_new_session=False, pass_fds=(),\n*, encoding=None, errors=None)\n</code></pre> <p>\u5e38\u7528\u53c2\u6570\uff1a</p> \u53c2\u6570 \u8bf4\u660e args shell\u547d\u4ee4\uff0c\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u8005\u5e8f\u5217\u7c7b\u578b\uff08\u5982\uff1alist\uff0c\u5143\u7ec4\uff09 bufsize \u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5f53\u521b\u5efa\u6807\u51c6\u6d41\u7684\u7ba1\u9053\u5bf9\u8c61\u65f6\u4f7f\u7528\uff0c\u9ed8\u8ba4-1\u3002 0\uff1a\u4e0d\u4f7f\u7528\u7f13\u51b2\u533a1\uff1a\u8868\u793a\u884c\u7f13\u51b2\uff0c\u4ec5\u5f53universal_newlines=True\u65f6\u53ef\u7528\uff0c\u4e5f\u5c31\u662f\u6587\u672c\u6a21\u5f0f stdin, stdout, stderr \u5206\u522b\u8868\u793a\u7a0b\u5e8f\u7684\u6807\u51c6\u8f93\u5165\u3001\u8f93\u51fa\u3001\u9519\u8bef\u53e5\u67c4 shell \u5982\u679c\u8be5\u53c2\u6570\u4e3a True\uff0c\u5c06\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684 shell \u6267\u884c\u6307\u5b9a\u7684\u547d\u4ee4\u3002 cwd \u7528\u4e8e\u8bbe\u7f6e\u5b50\u8fdb\u7a0b\u7684\u5f53\u524d\u76ee\u5f55 env \u7528\u4e8e\u6307\u5b9a\u5b50\u8fdb\u7a0b\u7684\u73af\u5883\u53d8\u91cf <p>Popen \u5bf9\u8c61\u65b9\u6cd5:</p> \u5bf9\u8c61 \u65b9\u6cd5 poll() \u68c0\u67e5\u8fdb\u7a0b\u662f\u5426\u7ec8\u6b62\uff0c\u5982\u679c\u7ec8\u6b62\u8fd4\u56de returncode\uff0c\u5426\u5219\u8fd4\u56de None\u3002 wait(timeout) \u7b49\u5f85\u5b50\u8fdb\u7a0b\u7ec8\u6b62\u3002 communicate(input,timeout) \u548c\u5b50\u8fdb\u7a0b\u4ea4\u4e92\uff0c\u53d1\u9001\u548c\u8bfb\u53d6\u6570\u636e\u3002 send_signal(singnal) \u53d1\u9001\u4fe1\u53f7\u5230\u5b50\u8fdb\u7a0b \u3002 terminate() \u505c\u6b62\u5b50\u8fdb\u7a0b,\u4e5f\u5c31\u662f\u53d1\u9001SIGTERM\u4fe1\u53f7\u5230\u5b50\u8fdb\u7a0b kill() \u6740\u6b7b\u5b50\u8fdb\u7a0b\u3002\u53d1\u9001 SIGKILL \u4fe1\u53f7\u5230\u5b50\u8fdb\u7a0b <p>\u5176\u4e2d\uff0c\u4f7f\u7528communicate\u51fd\u6570\u53ef\u4ee5\u4e0e\u5b50\u8fdb\u7a0b\u8fdb\u884c\u4ea4\u4e92\uff0c\u5305\u62ec\u8f93\u4eba\u6570\u636e\uff0c\u83b7\u53d6\u5b50\u547d\u4ee4\u7684 \u6807\u51c6\u8f93\u51fa\u548c\u9519\u8bef\u8f93\u51fa\u3002</p> <p>\u4e0b\u9762\u7684\u51fd\u6570\u5bf9Popen\u6267\u884cshell\u547d\u4ee4\u8fdb\u884c\u5c01\u88c5\uff0c\u5c01\u88c5\u4ee5\u540e\uff0c\u53ea\u8981\u5c06\u9700\u8981\u6267\u884c\u7684shll\u547d\u4ee4\u4f20\u9012\u7ed9\u8be5\u51fd\u6570\u5373\u53ef\u3002</p> <p>\u5f53\u547d\u4ee4\u6267\u884c\u6210\u529f\u65f6\uff0c\u5c06\u8fd4\u56de\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\u548c\u6807\u51c6\u8f93\u51fa\uff0c\u5f53\u547d\u4ee4\u6267\u884c\u5931\u8d25\u65f6\uff0c\u5c06\u8fd4\u56de\u9000\u51fa\u72b6\u6001\u7801\u548c\u9519\u8bef\u8f93\u51fa\u3002</p> <pre><code>import time\nimport subprocess\ndef cmd(command):\nsubp = subprocess.Popen(command,shell=True,stdout=subprocess.PIPE,stderr=subprocess.PIPE,encoding=\"utf-8\")\nsubp.wait(2)\nif subp.poll() == 0:\nprint(subp.communicate()[1])\nelse:\nprint(\"\u5931\u8d25\")\n</code></pre> <pre><code>def execute_cmd(cmd):\nprcs = subprocess.Popen(cmd,\nstdin=subprocess.PIPE,\nstdout=subprocess.PIPE,\nstderr=subprocess.PIPE)\nstdout, stderr = prcs.communicate()\nif prcs.returncode != 0:\nreturn prcs.returncode, stderr\nreturn (prcs.returncode, prcs.stdout)\n</code></pre> <pre><code>def exec_cmd(cmd):\n\"\"\"\n    Execute arbitrary commands as sub-processes.\n    \"\"\"\nproc = subprocess.Popen(cmd,\nstdout=subprocess.PIPE,\nstdin=subprocess.PIPE,\nstderr=subprocess.PIPE,\nuniversal_newlines=True,\nshell=True)\nstdout, stderr = proc.communicate()\nreturn (proc.returncode, stdout, stderr)\n</code></pre> <p>\u901a\u8fc7Python\u6807\u51c6\u5e93\u7684subprocess\u6a21\u5757\uff0c\u53ef\u4ee5\u8fd0\u884c\u5916\u90e8\u7a0b\u5e8f\u3002</p> <p>\u8fd9\u6781\u5927\u5730\u62d3\u5c55\u4e86Python\u7684\u529f\u80fd\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u4f7f\u7528subprocess\u5728Python\u4e2d\u6267\u884c\u590d\u6742\u7684Linux\u547d\u4ee4\u3002</p> <p>python\u6267\u884clinux\u7cfb\u7edf\u547d\u4ee4\u7684\u51e0\u79cd\u65b9\u6cd5</p> <ol> <li>\u4f7f\u7528os.system</li> </ol> <p>\u4ec5\u4ec5\u5728\u4e00\u4e2a\u5b50\u7ec8\u7aef\u8fd0\u884c\u7cfb\u7edf\u547d\u4ee4\uff0c\u800c\u4e0d\u80fd\u83b7\u53d6\u547d\u4ee4\u6267\u884c\u540e\u7684\u8fd4\u56de\u4fe1\u606f</p> <ol> <li>\u4f7f\u7528os.popen</li> </ol> <p>\u8be5\u65b9\u6cd5\u4e0d\u4f46\u6267\u884c\u547d\u4ee4\u8fd8\u8fd4\u56de\u6267\u884c\u540e\u7684\u4fe1\u606f\u5bf9\u8c61\uff0c\u597d\u5904\u5728\u4e8e\uff1a\u5c06\u8fd4\u56de\u7684\u7ed3\u679c\u8d4b\u4e8e\u4e00\u53d8\u91cf\uff0c\u4fbf\u4e8e\u7a0b\u5e8f\u7684\u5904\u7406\u3002</p> <pre><code>cmd = os.popen('df -h').read().split('\\n')\n</code></pre> <ol> <li>\u4f7f\u7528\u6a21\u5757 subprocess</li> </ol> <p>subprocess \u2014 Spawning Additional Processes</p> <p>\u6267\u884c\u5916\u90e8\u547d\u4ee4\u5e76\u83b7\u53d6\u5b83\u7684\u8f93\u51fa</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/8.Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/#8\u7efc\u5408\u6848\u4f8b-\u4f7f\u7528python\u90e8\u7f72mongodb","title":"8.\u7efc\u5408\u6848\u4f8b: \u4f7f\u7528Python\u90e8\u7f72MongoDB","text":"<p>\u5b89\u88c5\u5305\u548c\u811a\u672c\u7684\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b</p> <pre><code>|__depoly_mongo.py\n|__mongodb-linux-x86_64-debian71-3.4.0.tgz\n0 directories,2 files\n</code></pre> <p>MongoDB\u662f\u5f53\u4e0b\u6700\u6d41\u884c\u7684\u6587\u6863\u6570\u636e\u5e93\uff0c\u5177\u6709\u5f88\u597d\u7684\u6613\u7528\u6027\u3002\u542f\u52a8\u4e00\u4e2aMongoDB\u6570\u636e\u5e93\u5b9e\u4f8b\uff0c\u53ea\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u51e0\u6761shell\u547d\u4ee4\u5373\u53ef\uff1a</p> <pre><code>tar -zxf mongodb-linux-x86_64-debian71-3.4.0.tgz\nmv mongodb-linux-x86_64-debian71-3.4.0 mongo\nmkdir mongodata\nmongo/bin/mongod --fork --logpath mongodata/mongod.log --dbpath mongodata\n</code></pre> <p>\u4e0b\u9762\u7684\u7a0b\u5e8f\u662f\u4f7f\u7528Python\u90e8\u7f72MongoDB\u6570\u636e\u5e93\u7684\u5b8c\u6574\u4ee3\u7801\u5305\u62ec\u4e0e\u8def\u5f84\u76f8\u5173\u7684os.path\u6a21\u5757\uff0c\u4e0e\u6587\u4ef6\u7ba1\u7406\u76f8\u5173\u7684shutil\u6a21\u5757\uff0c\u4e0e\u538b\u7f29\u5305\u76f8\u5173\u7684tarfile\u6a21\u5757\u4ee5\u53ca\u5728Python\u4e2d\u6267\u884cShell\u547d\u4ee4\u7684subprocess\u6a21\u5757\u3002</p> <p>\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#!/usr/bin/python\n#-*- coding: UTF-8 -*-\nfrom __future__ import print_function\nimport os\nimport shutil\nimport tarfile\nimport subprocess\ndef execute_cmd(cmd):\np = subprocess.Popen(cmd,\nshell=True,\nstdin=subprocess.PIPE,\nstdout=subprocess.PIPE,\nstderr=subprocess.PIPE)\nstdout, stderr = p.communicate()\nif p.returncode != 0:\nreturn p.returncode, stderr\nreturn p.returncode, stdout\ndef unpackage_mongo(package, package_dir):\nunpackage_dir = os.path.splitext(package)[0]\nif os.path.exists(unpackage_dir):\nshutil.rmtree(unpackage_dir)\nif os.path.exists(package_dir):\nshutil.rmtree(package_dir)\nt = tarfile.open(package, 'r:gz')\nt.extractall('.')\nshutil.move(unpackage_dir, package_dir)\ndef create_datadir(data_dir):\nif os.path.exists(data_dir):\nshutil.rmtree(data_dir)\nos.mkdir(data_dir)\ndef format_mongod_command(package_dir, data_dir, logfile):\nmongod = os.path.join(package_dir, 'bin', 'mongod')\nmongod_format = \"\"\"{0} --fork --dbpath {1} --logpath {2}\"\"\"\nreturn mongod_format.format(mongod, data_dir, logfile)\ndef start_mongod(cmd):\nreturncode, out = execute_cmd(cmd)\nif returncode != 0:\nraise SystemExit('execute {0} error :{1}'.format(cmd, out))\nelse:\nprint(\"execute command ({0}) successful\".format(cmd))\ndef main():\n#mongo\u6587\u4ef6\u540d\u79f0\npackage = \"mongodbxxxx.tar.gz\"\n#\u5f53\u524d\u8def\u5f84\ncur_dir = os.path.abspath(\".\")\n#mongodb\u7684\u8def\u5f84\npackage_dir = os.path.join(cur_dir,\"mongo\")\n#mongodb\u6570\u636e\u76ee\u5f55\ndata_dir = os.path.join(cur_dir,\"mogodata\")\n#mongodb\u65e5\u5fd7\u76ee\u5f55\nlogfile = os.path.join(cur_dir,\"mongod.log\")\n#\u5982\u679c\u5305\u4e0d\u5b58\u5728\uff0c\u5c31\u629b\u51fa\u5f02\u5e38\nif not os.path.exists(package):\nraise SystemExit(\"{0} not found\".format(package))\n#\u89e3\u538bmongodb\u5b89\u88c5\u5305\nunpackage_mongo(package,package_dir)\n#\u521b\u5efa\u5b89\u88c5\u76ee\u5f55\ncreate_datadir(data_dir)\n#\u6267\u884c\u5b89\u88c5\nstart_mongod(format_mongod_command(package_dir,data_dir,logfile))\nif __name__ == '__main__':\nmain()\n</code></pre> <p>\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\u7684\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b</p> <pre><code>|__depoly_mongo.py\n|__mongo\n  |_____bin\n        |__mongod\n|__mongodata\n  |_____mongod.log\n|__mongodb-linux-x86_64-debian71-3.4.0.tgz\n2 directories,2 files\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/","title":"9.\u76d1\u63a7Linux","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#1python\u7f16\u5199\u7684\u76d1\u63a7\u5de5\u5177","title":"1.Python\u7f16\u5199\u7684\u76d1\u63a7\u5de5\u5177","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#11-dstat","title":"1.1 dstat","text":"<ul> <li>\u4e00\u6b3e\u591a\u529f\u80fd\u7cfb\u7edf\u8d44\u6e90\u7edf\u8ba1\u5de5\u5177</li> </ul> <p>\u7efc\u5408\u4e86 vmstat, iostat, ifstat, netstat \u7b49\u76d1\u63a7\u5de5\u5177\u7684\u529f\u80fd\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u76d1\u63a7\u4fe1\u606f\uff1b</p> <p>\u5b9e\u65f6\u663e\u793a\u76d1\u63a7\u6570\u636e\uff1b</p> <p>\u5728\u95ee\u9898\u5206\u6790\u548c\u6545\u969c\u6392\u67e5\u65f6\uff0c\u53ef\u4ee5\u76d1\u89c6\u6700\u91cd\u8981\u7684\u8ba1\u6570\u5668\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u8ba1\u6570\u5668\u8fdb\u884c\u6392\u5e8f\uff1b</p> <p>\u5b89\u88c5</p> <pre><code>yum install -y dstat\ndstat --version\ndstat --listi\n\n# dstat\u8f93\u51fa\u9ed8\u8ba4\u76d1\u63a7\u3001\u62a5\u8868\u8f93\u51fa\u7684\u65f6\u95f4\u95f4\u9694\u4e3a3\u79d2\u949f,\u5e76\u4e14\u62a5\u8868\u4e2d\u8f93\u51fa10\u4e2a\u7ed3\u679c\uff1a\ndstat 3 10\n</code></pre> <pre><code># 1.\u67e5\u770b\u5168\u90e8\u5185\u5b58\u90fd\u6709\u8c01\u5728\u5360\u7528\ndstat -g -l -m -s --top-mem\n\n# 2.\u663e\u793a\u4e00\u4e9b\u5173\u4e8eCPU\u8d44\u6e90\u635f\u8017\u7684\u6570\u636e\uff1a\ndstat -c -y -l --proc-count --top-cpu\n\n# 3.\u67e5\u770b\u5f53\u524d\u5360\u7528I/O\u3001CPU\u3001\u5185\u5b58\u7b49\u6700\u9ad8\u7684\u8fdb\u7a0b\u4fe1\u606f\ndstat --top-mem --top-io --top-cpu\n\n# 4.\u5c06\u7ed3\u679c\u8f93\u51fa\u5230CSV\u6587\u4ef6\uff0c\u5e76\u8f93\u51fa\u5230\u684c\u9762\ndstat --output dstat_output.csv\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#12-glances","title":"1.2 glances","text":"<ul> <li>\u4e00\u6b3e\u4ea4\u4e92\u6027\u76d1\u63a7\u5de5\u5177</li> </ul> <pre><code>sudo apt update\nsudo apt install glances\n</code></pre> <ol> <li>glances\u7684\u4f7f\u7528</li> </ol> <p>glances\u7684\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u76f4\u63a5\u8f93\u5165glances\u547d\u4ee4\u4fbf\u8fdb\u5165\u4e86\u4e00\u4e2a\u7c7b\u4f3c\u4e8etop\u547d\u4ee4\u7684\u4ea4\u4e92\u5f0f\u754c\u9762\u3002</p> <p>\u5728\u8fd9\u4e2a\u754c\u9762\u4e2d\uff0c\u663e\u793a\u4e86\u6bd4top\u66f4\u52a0\u5168\u9762\uff0c\u66f4\u52a0\u5177\u6709\u53ef\u8bfb\u6027\u7684\u4fe1\u606f\u3002</p> <p>\u4e3a\u4e86\u589e\u52a0\u53ef\u8bfb\u6027\uff0cglances\u4f1a\u4ee5\u4e0d\u540c\u7684\u989c\u8272\u8868\u793a\u4e0d\u540c\u7684\u72b6\u6001\u3002 \u5176\u4e2d\uff0c</p> <ul> <li> <p>\u7eff\u8272\u8868\u793a\u6027\u80fd\u826f\u597d\uff0c\u5143\u987b\u505a\u4efb\u4f55\u989d\u5916\u5de5\u4f5c\uff1b</p> </li> <li> <p>\u84dd\u8272\u8868\u793a\u7cfb\u7edf\u6027\u80fd\u6709\u4e00\u4e9b\u5c0f\u95ee\u9898\uff0c\u7528\u6237\u5e94\u5f53\u5f00\u59cb\u5173\u6ce8\u7cfb\u7edf\u6027\u80fd\uff1b</p> </li> <li> <p>\u7d2b\u8272\u8868\u793a\u6027\u80fd\u62a5\u8b66\uff0c\u5e94\u5f53\u91c7\u53d6\u63aa\u65bd\uff1b</p> </li> <li> <p>\u7ea2\u8272\u8868\u793a\u6027\u80fd\u95ee\u9898\u4e25\u91cd\uff0c\u5e94\u5f53\u7acb\u5373\u5904\u7406\u3002\u3000\u3000</p> </li> </ul> <p>glances\u662f\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u7684\u5de5\u5177\uff0e\u56e0\u6b64\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8f93\u5165\u547d\u4ee4\u6765\u63a7\u5236glances\u7684\u884c\u4e3a\u3002</p> <ol> <li>glances\u4e2d\u5e38\u89c1\u7684\u547d\u4ee4</li> </ol> <pre><code>h\uff1a\u663e\u793a\u5e2e\u52a9\u4fe1\u606f\uff1b\n\nq\uff1a\u79bb\u5f00\u7a0b\u5e8f\u9000\u51fa\uff1b\n\nc\uff1a\u6309\u7167 CPU \u5b9e\u65f6\u8d1f\u8f7d\u5bf9\u7cfb\u7edf\u8fdb\u7a0b\u6392\u5e8f\uff1b\n\nm\uff1a\u6309\u7167\u5185\u5b58\u4f7f\u7528\u72b6\u51b5\u5bf9\u7cfb\u7edf\u8fdb\u7a0b\u6392\u5e8f\uff1b\n\ni\uff1a\u6309\u7167 I/O \u4f7f\u7528\u72b6\u51b5\u5bf9\u7cfb\u7edf\u8fdb\u7a0b\u6392\u5e8f\uff1b\n\np\uff1a\u6309\u7167\u8fdb\u7a0b\u540d\u79f0\u6392\u5e8f\uff1b\n\nd\uff1a\u663e\u793a\u6216\u9690\u85cf\u78c1\u76d8\u8bfb\u5199\u72b6\u51b5\uff1b\n\nf\uff1a\u663e\u793a\u6216\u9690\u85cf\u6587\u4ef6\u7cfb\u7edf\u4fe1\u606f\uff1b1\uff1a\u5206\u5f00\u663e\u793a\u6bcf\u4e2a CPU \u7684\u4f7f\u7528\u60c5\u51b5\u3002\n</code></pre> <ol> <li>\u5982\u679c\u6211\u4eec\u5b89\u88c5\u4e86 Bottle \u8fd9\u4e2a web \u6846\u67b6\uff0c\u8fd8\u80fd\u591f\u901a\u8fc7 web \u6d4f\u89c8\u5668\u663e\u793a\u548c\u547d\u4ee4\u884c\u7ec8\u7aef\u76f8\u540c\u7684\u76d1\u63a7\u754c\u9762</li> </ol> <pre><code>pip install bottle\n\n# glances-w ##\u9ed8\u8ba4\u7aef\u53e3\u662f61208\uff0c\u8bbf\u95ee\u5730\u5740\u6ca1\u6709\u9650\u5236\n# Glances web server started on http://0.0.0.0:61208\n</code></pre> <p>glances\u8fd8\u652f\u6301\u5c06\u91c7\u96c6\u7684\u6570\u636e\u5bfc\u4eba\u5230\u5176\u4ed6\u670d\u52a1\u4e2d\u5fc3\uff0c\u5305\u62ecInfluxDB,Cassandra,CouchDB,OpenTSDB,Prometheus,StatsD,ElasticSearch,RabbitMQ/ActiveMQ,ZeroMQ,Kafka\u548cRiemann\u3002</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#2\u4f7f\u7528python\u7f16\u5199\u76d1\u63a7\u5de5\u5177","title":"2.\u4f7f\u7528Python\u7f16\u5199\u76d1\u63a7\u5de5\u5177","text":"<p>shell\u67e5\u770b\u78c1\u76d8\u7684\u76d1\u63a7\u4fe1\u606f\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>root@gdc-ci-base:/tmp/code-sample# ll /proc/ | wc -l\n2331\n</code></pre> <pre><code># cat /proc/diskstats\n7       0 loop0 12 0 24 0 0 0 0 0 0 12 0 0 0 0 0\n7       1 loop1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n7       2 loop2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n7       3 loop3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n7       4 loop4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n7       5 loop5 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n7       6 loop6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n7       7 loop7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n252       0 vda 4634559 442053 265265899 5611938 36326346 53118803 1555421512 166771992 0 26407556 147944608 0 0 0 0\n252       1 vda1 4634307 442053 265251101 5611781 36326345 53118803 1555421504 166771991 0 26407548 147944548 0 0 0 0\n252      16 vdb 45964412 433933 5080426842 352020611 183451762 124363374 20504026654 3402797863 0 198956720 3533727868 0 0 0 0\n252      17 vdb1 45963690 433933 5080390358 352020457 183451761 124363374 20504026646 3402797863 0 198956516 3533727868 0 0 0 0\n252      32 vdc 41352916 127036 2241160380 36782174 43786752 138866851 12318474211 2402011844 0 69681444 2365804540 0 0 0 0\n252      33 vdc1 41349948 127036 2240997254 36781428 43785598 138866851 12317950805 2402010037 0 69678760 2365803824 0 0 0 0\n253       0 dm-0 41478166 0 2240976566 36830068 177342351 0 12317949968 72220588 0 67537260 109050656 0 0 0 0\n</code></pre> <p>shell\u811a\u672c\u76d1\u63a7Linux</p> <p>monitor.sh\u6587\u4ef6</p> <pre><code>#/bin/sh\ncpu_idle=$(top -n2 | grep 'Cpu' | tail -n 1 | awk '{print $8}')\ncpu_usage=$(printf \"%.2f\" `echo \"scale=2; 100 - $cpu_idle\" | bc`)\nmem_free=$(free -m | awk '/Mem:/{print $4 + $6}')\nmem_total=$(free -m | awk '/Mem:/{print $2}')\nmem_used=$(echo \"$mem_total - $mem_free\" | bc)\nmem_rate=$(echo \"$mem_used * 100 / $mem_total\" | bc)\ndisk_usage=$(df -h / | tail -n 1 | awk '{print $5}')\ndisk_used=$(df -h / | tail -n 1 | awk '{print $3}')\necho \"CPU\u5229\u7528\u7387\uff1a$cpu_usage %\"\necho \"\u5185\u5b58\u4f7f\u7528\u91cf: $mem_used M\"\necho \"\u5185\u5b58\u5229\u7528\u7387\uff1a$mem_rate %\"\necho \"\u78c1\u76d8\u7a7a\u95f4\u4f7f\u7528\u91cf\uff1a$disk_used\"\necho \"\u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\uff1a$disk_usage\"\n</code></pre> <pre><code>$ bash monitor.sh\nCPU\u5229\u7528\u7387\uff1a21.70 %\n\u5185\u5b58\u4f7f\u7528\u91cf: 34114 M\n\u5185\u5b58\u5229\u7528\u7387\uff1a53 %\n\u78c1\u76d8\u7a7a\u95f4\u4f7f\u7528\u91cf\uff1a20G\n\u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\uff1a22%\n</code></pre> <p>\u7f16\u5199\u4e00\u4e2aPython\u811a\u672c\uff0c\u76d1\u63a7\u78c1\u76d8IO\u4fe1\u606f\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#!/usr/bin/python\n# -*- coding: UTF-8 -*-\nfrom __future__ import print_function\nfrom collections import namedtuple\nDisk = namedtuple('Disk', 'major_number minor_number device_name'\n' read_count read_merged_count read_sections'\n' time_spent_reading write_count write_merged_count'\n' write_sections time_spent_write io_requests'\n' time_spent_doing_io weighted_time_spent_doing_io')\ndef get_disk_info(device):\n\"\"\"\n    \u4ece/proc/diskstats\u4e2d\u8bfb\u53d6\u78c1\u76d8\u7684IO\u4fe1\u606f\n    $ cat /proc/diskstats\n     254 32 vdc 614 0 22180 408 51203 2822 1857922 1051716 0 40792 1052064\n    \"\"\"\nwith open(\"/proc/diskstats\") as f:\nfor line in f:\nif line.split()[2] == device:\nreturn Disk(*(line.split()))\nraise RuntimeError(\"device ({0}) not found !\".format(device))\ndef main():\ndisk_info = get_disk_info('sda2')\nprint(disk_info)\nprint(\"\u78c1\u76d8\u5199\u6b21\u6570\uff1a{0}\".format(disk_info.write_count))\nprint(\"\u78c1\u76d8\u5199\u5b57\u8282\u6570\uff1a{0}\".format(float(disk_info.write_sections) * 512))\nprint(\"\u78c1\u76d8\u5199\u5ef6\u65f6\uff1a{0}\".format(disk_info.time_spent_write))\nif __name__ == '__main__':\nmain()\n</code></pre> <pre><code># python monitor.py\nDisk(major_number='8', minor_number='2', device_name='sda2', read_count='50450990', read_merged_count='96507', read_sections='3060048612', time_spent_reading='109131850', write_count='52603189', write_merged_count='3237734', write_sections='1822088694', time_spent_write='589762643', io_requests='1', time_spent_doing_io='447887342', weighted_time_spent_doing_io='698890794')\n\u78c1\u76d8\u5199\u6b21\u6570\uff1a52603189\n\u78c1\u76d8\u5199\u5b57\u8282\u6570\uff1a932909411328.0\n\u78c1\u76d8\u5199\u5ef6\u65f6\uff1a589762643\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#3\u4f7f\u7528\u5f00\u6e90\u5e93\u76d1\u63a7linux","title":"3.\u4f7f\u7528\u5f00\u6e90\u5e93\u76d1\u63a7Linux","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#31-psutil\u4ecb\u7ecd","title":"3.1 psutil\u4ecb\u7ecd","text":"<p>psutil\u662f\u4e00\u4e2a\u5f00\u6e90\u4e14\u8de8\u5e73\u53f0\u7684\u5e93\uff0c\u5176\u63d0\u4f9b\u4e86\u4fbf\u5229\u7684\u51fd\u6570\u7528\u6765\u83b7\u53d6\u64cd\u4f5c\u7cfb\u7edf\u7684\u4fe1\u606f\uff0c\u6bd4\u5982CPU\uff0c\u5185\u5b58\uff0c\u78c1\u76d8\uff0c\u7f51\u7edc\u7b49\u3002\u6b64\u5916\uff0cpsutil\u8fd8\u53ef\u4ee5\u7528\u6765\u8fdb\u884c\u8fdb\u7a0b\u7ba1\u7406\uff0c\u5305\u62ec\u5224\u65ad\u8fdb\u7a0b\u662f\u5426\u5b58\u5728\u3001\u83b7\u53d6\u8fdb\u7a0b\u5217\u8868\u3001\u83b7\u53d6\u8fdb\u7a0b\u8be6\u7ec6\u4fe1\u606f\u7b49\u3002\u800c\u4e14psutil\u8fd8\u63d0\u4f9b\u4e86\u8bb8\u591a\u547d\u4ee4\u884c\u5de5\u5177\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u5305\u62ec\uff1aps\uff0ctop\uff0clsof\uff0cnetstat\uff0cifconfig\uff0c who\uff0cdf\uff0ckill\uff0cfree\uff0cnice\uff0cionice\uff0ciostat\uff0ciotop\uff0cuptime\uff0cpidof\uff0ctty\uff0ctaskset\uff0cpmap\u3002</p> <p>psutil\u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u5e93\uff0c\u652f\u6301Linux\u3001Windows\u3001OSX\u3001FreeBSD\u3001OpenBSD\u3001NetBSD\u3001Sun Solaris\u3001AIX\u7b49\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u540c\u65f6\uff0cpsutil\u4e5f\u652f\u630132\u4f4d\u4e0e64\u4f4d\u7684\u7cfb\u7edf\u67b6\u6784\uff0c\u652f\u6301Python2.6\u5230Python3.x\u4e4b\u95f4\u7684\u6240\u6709Python\u7248\u672c\u3002</p> <p>psutil\u5177\u6709\u7b80\u5355\u6613\u7528\u3001\u529f\u80fd\u5f3a\u5927\u3001\u8de8\u5e73\u53f0\u7b49\u8bf8\u591a\u4f18\u70b9\uff0c\u5e7f\u6cdb\u5e94\u7528\u4e8e\u5f00\u6e90\u9879\u76ee\u4e2d\uff0c\u6bd4\u8f83\u6709\u540d\u7684\u6709glances\u3001Facebook\u7684osquery\u3001Google\u7684grr\u7b49\u3002</p> <p>psutil\u4e0d\u4f46\u5e7f\u6cdb\u5e94\u7528\u4e8ePython\u8bed\u8a00\u5f00\u53d1\u7684\u5f00\u6e90\u9879\u76ee\u4e2d\uff0c\u8fd8\u88ab\u79fb\u690d\u5230\u4e86\u5176\u4ed6\u7f16\u7a0b\u8bed\u8a00\u4e2d\uff0c\u5982Go\u8bed\u8a00\u7684gopsutil\u3001C\u8bed\u8a00\u7684cpslib\u3001Rust\u8bed\u8a00\u7684rust-psutil\u3001Ruby\u8bed\u8a00\u7684posixpsutil\u7b49\u3002</p> <p>psutil\u662f\u4e00\u4e2a\u7b2c\u4e09\u65b9\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u56e0\u6b64\uff0c\u9700\u8981\u5148\u5b89\u88c5\u624d\u80fd\u591f\u4f7f\u7528\u3002</p> <p>\u5982\u679c\u5b89\u88c5\u4e86Anaconda\uff0cpsutil\u5c31\u5df2\u7ecf\u53ef\u7528\u4e86\u3002\u5426\u5219\uff0c\u9700\u8981\u5728\u547d\u4ee4\u884c\u4e0b\u901a\u8fc7pip\u5b89\u88c5\uff1a</p> <pre><code>$ pip install psutil\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#32-\u7efc\u5408\u6848\u4f8b-\u4f7f\u7528psutil\u5b9e\u73b0\u76d1\u63a7\u7a0b\u5e8f","title":"3.2 \u7efc\u5408\u6848\u4f8b: \u4f7f\u7528psutil\u5b9e\u73b0\u76d1\u63a7\u7a0b\u5e8f","text":"<pre><code># coding=utf-8\n# !/usr/bin/python\nimport psutil\nimport datetime\ndef bytes2human(n):\n'''\u5185\u5b58\u5355\u4f4d\u8f6c\u6362\u7684\u65b9\u6cd5'''\nsymbols = ('K', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y')\nprefix = {}\nfor i, s in enumerate(symbols):\nprefix[s] = 1 &lt;&lt; (i + 1) * 10\nfor s in reversed(symbols):\nif n &gt;= prefix[s]:\nvalue = float(n) / prefix[s]\nreturn '%.1f%s' % (value, s)\nreturn \"%sB\" % n\ndef get_cpu_info():\n'''\u83b7\u53d6CPU\u4f7f\u7528\u7387'''\ncpu_count = psutil.cpu_count()\ncpu_percent = psutil.cpu_percent(interval=1)\nreturn dict(cpu_count=cpu_count, cpu_percent=cpu_percent)\ndef get_memory_info():\n'''\u83b7\u53d6\u5185\u5b58\u4fe1\u606f'''\nvirtual_mem = psutil.virtual_memory()\nmem_total = bytes2human(virtual_mem.total)\nmem_percent = virtual_mem.percent\nmem_free = bytes2human(virtual_mem.free + virtual_mem.buffers + virtual_mem.cached)\nmem_used = bytes2human(virtual_mem.total * mem_percent / 100)\nreturn dict(mem_total=mem_total, mem_percent=mem_percent, mem_free=mem_free, mem_used=mem_used)\ndef get_disk_info():\n'''\u83b7\u53d6\u78c1\u76d8\u4fe1\u606f'''\ndisk_usage = psutil.disk_usage('/')\ndisk_total = bytes2human(disk_usage.total)\ndisk_percent = disk_usage.percent\ndisk_free = bytes2human(disk_usage.free)\ndisk_used = bytes2human(disk_usage.used)\nreturn dict(disk_total=disk_total, disk_percent=disk_percent, disk_free=disk_free, disk_used=disk_used)\ndef get_boot_info():\n'''\u83b7\u53d6\u542f\u52a8\u65f6\u95f4'''\nboot_time = datetime.datetime.fromtimestamp(psutil.boot_time()).strftime(\"%Y-%m-%d %H:%M:%S\")\nreturn dict(boot_time=boot_time)\ndef collect_monitor_data():\n'''\u96c6\u4e2d\u76d1\u63a7\u786c\u4ef6\u4fe1\u606f'''\ndata = {}\ndata.update(get_boot_info())\ndata.update(get_cpu_info())\ndata.update(get_memory_info())\ndata.update(get_disk_info())\nprint(data)\nreturn data\ncollect_monitor_data()\n</code></pre> <p>\u7efc\u5408\u6848\u4f8bdemo</p> <ul> <li> <p>\u4f7f\u7528psutil\u6536\u96c6\u76d1\u63a7\u4fe1\u606f</p> </li> <li> <p>\u4f7f\u7528Jinja:2\u6a21\u677f\u6e32\u67d3\u76d1\u63a7\u62a5\u544a\uff0c</p> </li> <li> <p>\u4f7f\u7528yagmail\u5c06\u76d1\u63a7\u62a5\u544a\u53d1\u9001\u7ed9\u7ba1\u7406\u5458\u3002\u6536\u96c6\u7cfb\u7edf\u7684\u76d1\u63a7\u4fe1\u606f\u5e76\u901a\u8fc7\u90ae\u4ef6\u7684\u5f62\u5f0f\u53d1\u9001\u7ed9\u7ba1\u7406\u5458\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u3001\u5b9e\u7528\u7684\u3001\u5177\u6709\u8f83\u9ad8\u5b66\u4e60\u4ef7\u503c\u7684\u7a0b\u5e8f\u3002\u76f8\u4fe1\u5927\u591a\u6570\u8fd0\u7ef4\u5de5\u7a0b\u5e08\u90fd\u66fe\u7ecf\u4f7f\u7528sell\u811a\u672c\u5199\u8fc7\u7c7b\u4f3c\u7684\u7a0b\u5e8f\u3002</p> </li> </ul> <p>\u5728\u6211\u4eec\u7684\u76d1\u63a7\u7a0b\u5e8f\u4e2d\uff0c\u4f7f\u7528psutil\u6536\u96c6\u4e86cpu\u7684\u4fe1\u606f\u3001\u5f00\u673a\u65f6\u95f4\u3001\u5185\u5b58\u4fe1\u606f\u4ee5\u53ca\u78c1\u76d8\u7a7a\u95f4\u7b49\u4fe1\u606f\uff0c\u8bfb\u8005\u4e5f\u53ef\u4ee5\u6839\u636e\u9700\u8981\u6536\u96c6\u78c1\u76d80\u4fe1\u606f\u4e0e\u7f51\u7edc0\u4fe1\u606f\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u7a0b\u5e8f\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\uff0c\u76d1\u63a7\u7a0b\u5e8f\u4f7f\u7528\u4e0d\u540c\u51fd\u6570\u6765\u6536\u96c6\u4e0d\u540c\u7ef4\u5ea6\u7684\u76d1\u63a7\u4fe1\u606f\uff0c\u5e76\u4ee5\u5b57\u5178\u7684\u5f62\u5f0f\u8fd4\u56de\uff0c\u4ee5\u6b64\u6765\u4fdd\u8bc1\u51fd\u6570\u77ed\u5c0f\u5355\u4e00\u7684\u76ee\u7684\u3002</p> <p>\u51fd\u6570\u4fdd\u6301\u77ed\u5c0f\u548c\u5355\u4e00\u4ee5\u540e\uff0c\u7a0b\u5e8f\u7684\u53ef\u8bfb\u6027\u4e0e\u53ef\u7ef4\u62a4\u6027\u81ea\u7136\u5c31\u589e\u52a0\u4e86\u4e0d\u5c11\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#!/usr/bin/python\n# -*- coding: UTF-8 -*-\nfrom __future__ import unicode_literals\nimport os\nimport socket\nfrom datetime import datetime\nimport jinja2\nimport yagmail\nimport psutil\nEMAIL_USER = 'joy_lmx@163.com'\nEMAIL_PASSWORD = '123456'\nRECIPIENTS = ['me@mingxinglai.com']\ndef render(tpl_path, **kwargs):\npath, filename = os.path.split(tpl_path)\nreturn jinja2.Environment(\nloader=jinja2.FileSystemLoader(path or './')\n).get_template(filename).render(**kwargs)\ndef bytes2human(n):\nsymbols = ('K', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y')\nprefix = {}\nfor i, s in enumerate(symbols):\nprefix[s] = 1 &lt;&lt; (i + 1) * 10\nfor s in reversed(symbols):\nif n &gt;= prefix[s]:\nvalue = float(n) / prefix[s]\nreturn '%.1f%s' % (value, s)\nreturn \"%sB\" % n\ndef get_cpu_info():\ncpu_count = psutil.cpu_count()\ncpu_percent = psutil.cpu_percent(interval=1)\nreturn dict(cpu_count=cpu_count, cpu_percent=cpu_percent)\ndef get_memory_info():\nvirtual_mem = psutil.virtual_memory()\nmem_total = bytes2human(virtual_mem.total)\nmem_percent = virtual_mem.percent\nmem_free = bytes2human(virtual_mem.free + virtual_mem.buffers + virtual_mem.cached)\nmem_used = bytes2human(virtual_mem.total * virtual_mem.percent)\nreturn dict(mem_total=mem_total, mem_percent=mem_percent,\nmem_free=mem_free, mem_used=mem_used)\ndef get_disk_info():\ndisk_usage = psutil.disk_usage('/')\ndisk_total = bytes2human(disk_usage.total)\ndisk_percent = disk_usage.percent\ndisk_free = bytes2human(disk_usage.free)\ndisk_used = bytes2human(disk_usage.used)\nreturn dict(disk_total=disk_total, disk_percent=disk_percent,\ndisk_free=disk_free, disk_used=disk_used)\ndef get_boot_info():\nboot_time = datetime.fromtimestamp(psutil.boot_time()).strftime(\"%Y-%m-%d %H:%M:%S\")\nreturn dict(boot_time=boot_time)\ndef collect_monitor_data():\ndata = {}\ndata.update(get_boot_info())\ndata.update(get_cpu_info())\ndata.update(get_memory_info())\ndata.update(get_disk_info())\nreturn data\ndef main():\nhostname = socket.gethostname()\ndata = collect_monitor_data()\ndata.update(dict(hostname=hostname))\ncontent = render('monitor.html', **data)\nprint(content)\nwith yagmail.SMTP(user=EMAIL_USER, password=EMAIL_PASSWORD,\nhost='smtp.163.com', port=25) as yag:\nfor recipient in RECIPIENTS:\nyag.send(recipient, \"\u76d1\u63a7\u4fe1\u606f\".encode('utf-8'), content.encode('utf-8'))\nif __name__ == '__main__':\nmain()\n</code></pre> <p>monitor.html</p> <pre><code>&lt;html&gt;\n&lt;head&gt;&lt;title&gt;\u76d1\u63a7\u4fe1\u606f&lt;/title&gt;\n&lt;body&gt;\n&lt;table border=\"1\"&gt;\n&lt;tr&gt;&lt;td&gt;\u670d\u52a1\u5668\u540d\u79f0&lt;/td&gt;&lt;td&gt;{{hostname}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u5f00\u673a\u65f6\u95f4&lt;/td&gt;&lt;td&gt;{{boot_time}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;cpu\u4e2a\u6570&lt;/td&gt;&lt;td&gt;{{cpu_count}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;cpu\u5229\u7528\u7387&lt;/td&gt;&lt;td&gt;{{cpu_percent}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u5185\u5b58\u603b\u91cf&lt;/td&gt;&lt;td&gt;{{mem_percent}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u5185\u5b58\u5229\u7528\u7387&lt;/td&gt;&lt;td&gt;{{mem_total}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u5185\u5b58\u5df2\u7528\u7a7a\u95f4&lt;/td&gt;&lt;td&gt;{{mem_used}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u5185\u5b58\u53ef\u7528\u7a7a\u95f4&lt;/td&gt;&lt;td&gt;{{mem_free}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u78c1\u76d8\u7a7a\u95f4\u603b\u91cf&lt;/td&gt;&lt;td&gt;{{disk_total}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387&lt;/td&gt;&lt;td&gt;{{disk_percent}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u78c1\u76d8\u5df2\u7528\u7a7a\u95f4&lt;/td&gt;&lt;td&gt;{{disk_used}}&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;\u78c1\u76d8\u53ef\u7528\u7a7a\u95f4&lt;/td&gt;&lt;td&gt;{{disk_free}}&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#33-psutil\u8fdb\u7a0b\u7ba1\u7406","title":"3.3 psutil\u8fdb\u7a0b\u7ba1\u7406","text":"<p>psutil\u8fd8\u63d0\u4f9b\u4e86\u4f5c\u4e3a\u8fdb\u7a0b\u7ba1\u7406\u7684\u529f\u80fd\u51fd\u6570\uff0c\u5305\u62ec\u83b7\u53d6\u8fdb\u7a0b\u5217\u8868\uff0c\u5224\u65ad\u662f\u5426\u5b58\u5728\uff0c\u4ee5\u53ca\u8fdb\u7a0b\u7ba1\u7406\u7684\u7c7b\u5c01\u88c5\u3002</p> \u51fd\u6570 \u8be6\u60c5 psutil.Process() \u5bf9\u8fdb\u7a0b\u8fdb\u884c\u5c01\u88c5\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u7c7b\u7684\u65b9\u6cd5\u83b7\u53d6\u8fdb\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u6216\u8005\u7ed9\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\u3002 psutil.pids() \u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u8fd4\u56de\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b psutil.pid_exists(1) \u5224\u65ad\u7ed9\u70b9\u5b9a\u7684pid\u662f\u5426\u5b58\u5728 psutil.process_iter() \u8fed\u4ee3\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u8fd4\u56de\u7684\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u7684Process\u5bf9\u8c61"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#1-process\u7c7b","title":"1. Process\u7c7b","text":"<p>\u5bf9\u8fdb\u7a0b\u8fdb\u884c\u5c01\u88c5\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u7c7b\u7684\u65b9\u6cd5\u83b7\u53d6\u8fdb\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u6216\u8005\u7ed9\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\u3002</p> <pre><code>In [1]: import psutil\n\nIn [2]: init_process = psutil.Process()\nIn [3]: init_process.cmdline()\nOut[3]: ['/usr/bin/python3', '/usr/bin/ipython3']\n</code></pre> <p>Process\u7c7b\u5305\u542b\u5f88\u591a\u65b9\u6cd5\u6765\u83b7\u53d6\u8fdb\u7a0b\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\u4e0b\u9762\u662f\u51e0\u4e2a\u8f83\u5e38\u7528\u7684\u65b9\u6cd5\uff1a</p> \u65b9\u6cd5 \u8bf4\u660e name \u83b7\u53d6\u8fdb\u7a0b\u7684\u540d\u79f0 cmdline \u83b7\u53d6\u542f\u52a8\u8fdb\u7a0b\u7684\u547d\u4ee4\u884c\u53c2\u6570 create_time \u83b7\u53d6\u8fdb\u7a0b\u7684\u521b\u5efa\u65f6\u95f4(\u65f6\u95f4\u6233\u683c\u5f0f) num_fds \u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u4e2a\u6570 num_threads \u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b\u4e2a\u6570 is_running \u5224\u65ad\u8fdb\u7a0b\u662f\u5426\u6b63\u5728\u8fd0\u884c send_signal \u7ed9\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\uff0c\u7c7b\u4f3c\u4e0eos.kill\u7b49 kill \u53d1\u9001SIGKILL\u4fe1\u53f7\u7ed3\u675f\u8fdb\u7a0b terminate \u53d1\u9001SIGTEAM\u4fe1\u53f7\u7ed3\u675f\u8fdb\u7a0b"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#2-pids","title":"2. pids","text":"<p>\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u8fd4\u56de\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u3002</p> <pre><code>In [1]: import psutil\n\nIn [2]: init_process = psutil.Process()\nIn [3]: init_process.cmdline()\nOut[3]: ['/usr/bin/python3', '/usr/bin/ipython3']\nIn [4]: psutil.pids()[:5]\nOut[4]: [1, 2, 3, 4, 6]\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#3-pid_exists","title":"3. pid_exists","text":"<p>\u5224\u65ad\u7ed9\u70b9\u5b9a\u7684pid\u662f\u5426\u5b58\u5728\u3002</p> <pre><code>In [5]: psutil.pid_exists(1)\nOut[5]: True\n\nIn [6]: psutil.pid_exists(100001)\nOut[6]: False\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#4process_iter","title":"4.process_iter","text":"<p>\u8fed\u4ee3\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u8fd4\u56de\u7684\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u7684Process\u5bf9\u8c61\uff0c\u800cpids\u8fd4\u56de\u7684\u662f\u8fdb\u7a0b\u7684\u5217\u8868\u3002</p> <pre><code>In [7]: len([item for item in psutil.process_iter()])\nOut[7]: 2252\n</code></pre> <p>\u6848\u4f8bdemo</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n# @auther:   18793\n# @Date\uff1a    2020/7/18 13:15\n# @filename: 01_pustil.py\n# @Email:    1879324764@qq.com\n# @Software: PyCharm\nimport psutil\nimport datetime\n# CPU\u4fe1\u606f\n# \u4f7f\u7528cpu_times\u65b9\u6cd5\u83b7\u53d6CPU\u5b8c\u6574\u4fe1\u606f\uff0c\u9700\u8981\u663e\u793a\u6240\u6709\u903b\u8f91CPU\u4fe1\u606f\uff0c\nprint(\"\u83b7\u53d6CPU\u5b8c\u6574\u4fe1\u606f:\", psutil.cpu_times())\nprint(\"\u83b7\u53d6\u5355\u9879\u6570\u636e\u4fe1\u606f\uff0c\u5982\u7528\u6237user\u7684CPU\u65f6\u95f4\u6bd4:\", psutil.cpu_times().user)\nprint(\"\u83b7\u53d6CPU\u7684\u903b\u8f91\u4e2a\u6570\uff0c\u9ed8\u8ba4logical=True4:\", psutil.cpu_count())\nprint(\"\u83b7\u53d6CPU\u7684\u7269\u7406\u4e2a\u6570:\", psutil.cpu_count(logical=False))\nprint(\"\u5206\u5272\u7ebf\".center(100, \"-\"))\n# \u5185\u5b58\u4fe1\u606f\nprint(\"psutil.virtual_memory\u65b9\u6cd5\u83b7\u53d6\u5185\u5b58\u5b8c\u6574\u4fe1\u606f:\", psutil.virtual_memory())\nmem = psutil.virtual_memory()\nprint(\"\u83b7\u53d6\u5185\u5b58\u603b\u6570:\", mem.total)\nprint(\"\u83b7\u53d6\u7a7a\u95f2\u5185\u5b58\u6570:\", mem.free)\nprint(\"\u83b7\u53d6SWAP\u5206\u533a\u4fe1\u606fsswap:\", psutil.swap_memory())\nprint(\"\u5206\u5272\u7ebf\".center(100, \"-\"))\n# \u78c1\u76d8\u4fe1\u606f\nprint(\"\u4f7f\u7528psutil.disk_partitions\u65b9\u6cd5\u83b7\u53d6\u78c1\u76d8\u5b8c\u6574\u4fe1\u606f:\", psutil.disk_partitions())\nprint(\"\u4f7f\u7528psutil.disk_usage\u65b9\u6cd5\u83b7\u53d6\u5206\u533a\uff08\u53c2\u6570\uff09\u7684\u4f7f\u7528\u60c5\u51b5:\", psutil.disk_usage(\"/\"))\nprint(\"\u4f7f\u7528psutil.disk_io_counters\u83b7\u53d6\u786c\u76d8\u603b\u7684IO\u4e2a\u6570:\", psutil.disk_io_counters())\nprint(\"perdisk=True\u201d\u53c2\u6570\u83b7\u53d6\u5355\u4e2a\u5206\u533aIO\u4e2a\u6570:\", psutil.disk_io_counters(perdisk=True))\nprint(\"\u5206\u5272\u7ebf\".center(100, \"-\"))\n# \u7f51\u7edc\u4fe1\u606f\nprint(\"\u4f7f\u7528psutil.net_io_counters\u83b7\u53d6\u7f51\u7edc\u603b\u7684IO\u4fe1\u606f:\", psutil.net_io_counters())\nprint(\"\u5206\u5272\u7ebf\".center(100, \"-\"))\n# \u5176\u4ed6\u7cfb\u7edf\u4fe1\u606f\nprint(\"\u4f7f\u7528psutil.users\u65b9\u6cd5\u8fd4\u56de\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7684\u7528\u6237\u4fe1\u606f:\", psutil.users())\nprint(\"\u4f7f\u7528psutil.boot_time\u65b9\u6cd5\u83b7\u53d6\u5f00\u673a\u65f6\u95f4\uff0c\u4ee5Linux\u65f6\u95f4\u6233\u683c\u5f0f\u8fd4\u56de:\", psutil.boot_time())\nprint(\"\u8f6c\u6362\u6210\u81ea\u7136\u65f6\u95f4\u683c\u5f0f:\", datetime.datetime.fromtimestamp(psutil.boot_time()).strftime(\"%Y-%m-%d %H:%M:%S\"))\n# \u8fdb\u7a0b\u4fe1\u606f\nprint(\"\u5217\u51fa\u6240\u6709\u8fdb\u7a0bPID:\", psutil.pids())\np = psutil.Process(408)\nprint(\"\u8fdb\u7a0b\u540d\", p.name())\nprint(\"\u8fdb\u7a0bbin\u8def\u5f84\", p.exe())\nprint(\"\u8fdb\u7a0b\u5de5\u4f5c\u76ee\u5f55\u7edd\u5bf9\u8def\u5f84\", p.cwd())\nprint(\"\u8fdb\u7a0b\u72b6\u6001:\", p.status())\nprint(\"\u8fdb\u7a0b\u521b\u5efa\u65f6\u95f4\uff0c\u65f6\u95f4\u6233\u683c\u5f0f:\", p.create_time())\nprint(\"\u8fdb\u7a0buid\u4fe1\u606f:\", p.uids())\nprint(\"\u8fdb\u7a0bgid\u4fe1\u606f:\", p.gids())\nprint(\"\u8fdb\u7a0bCPU\u65f6\u95f4\u4fe1\u606f\uff0c\u5305\u62ecuser\u3001system\u4e24\u4e2aCPU\u65f6\u95f4:\", p.cpu_times())\nprint(\"get\u8fdb\u7a0bCPU\u4eb2\u548c\u5ea6\uff0c\u5982\u8981\u8bbe\u7f6e\u8fdb\u7a0bCPU\u4eb2\u548c\u5ea6:\", p.cpu_affinity())\nprint(\"\u8fdb\u7a0b\u5185\u5b58\u5229\u7528\u7387:\", p.memory_percent())\nprint(\"\u8fdb\u7a0b\u5185\u5b58rss\u3001vms\u4fe1\u606f:\", p.memory_info())\nprint(\"\u8fdb\u7a0bIO\u4fe1\u606f\uff0c\u5305\u62ec\u8bfb\u5199IO\u6570\u53ca\u5b57\u8282\u6570:\", p.io_counters())\nprint(\"\u8fd4\u56de\u6253\u5f00\u8fdb\u7a0bsocket\u7684namedutples\u5217\u8868:\", p.connections())\nprint(\"\u8fdb\u7a0b\u5f00\u542f\u7684\u7ebf\u7a0b\u6570\", p.num_threads())\nfrom subprocess import PIPE\np = psutil.Popen([\"/usr/bin/python\", \"-c\", \"print('hello')\"], stdout=PIPE)\nprint(p.name())\nprint(p.username())\nprint(p.connections())\nprint(p.cpu_times())\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#4\u4f7f\u7528pyinotify\u76d1\u63a7\u6587\u4ef6\u7cfb\u7edf\u53d8\u5316","title":"4.\u4f7f\u7528Pyinotify\u76d1\u63a7\u6587\u4ef6\u7cfb\u7edf\u53d8\u5316","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#41-pyinotify\u6a21\u5757\u4ecb\u7ecd","title":"4.1 pyinotify\u6a21\u5757\u4ecb\u7ecd","text":"<p>pyinotify\u662f\u4e00\u4e2aPython\u6a21\u5757\uff0c\u7528\u6765\u76d1\u6d4b\u6587\u4ef6\u7cfb\u7edf\u7684\u53d8\u5316\u3002</p> <p>pyinotify\u4f9d\u8d56\u4e8eLinux\u5185\u6838inotify\u529f\u80fd\u3002</p> <p>inotify\u662f\u4e00\u4e2a\u4e8b\u4ef6\u9a71\u52a8\u7684\u901a\u77e5\u5668\uff0c\u5176\u901a\u77e5\u63a5\u53e3\u4ece\u5185\u6838\u7a7a\u95f4\u5230\u7528\u6237\u7a7a\u95f4\u901a\u8fc7\u4e09\u4e2a\u7cfb\u7edf\u8c03\u7528\u3002</p> <p>pyinotify\u7ed3\u5408\u8fd9\u4e9b\u7cfb\u7edf\u8c03\u7528\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a\u9876\u7ea7\u7684\u62bd\u8c61\u548c\u4e00\u4e2a\u901a\u7528\u7684\u65b9\u5f0f\u6765\u5904\u7406\u8fd9\u4e9b\u529f\u80fd\u3002</p> <p>pyinotify\u4f9d\u8d56Linux\u7684inotify\u529f\u80fd\uff0c\u800cLinux\u57282.6.l3\u7248\u672c\u4ee5\u540e\u624d\u63d0\u4f9b\u4e86inotify\u3002</p> <p>\u56e0\u6b64\uff0cpyinotify\u9700\u8981\u5728Linux2.6.l3\u6216\u66f4\u9ad8\u7248\u672c\u7684Linux\u7cfb\u7edf\u4e0a\u8fd0\u884c\u3002pyinotify\u662f\u7b2c\u4e09\u65b9\u6a21\u5757\uff0c\u9700\u8981\u5b89\u88c5\u4ee5\u540e\u624d\u80fd\u4f7f\u7528\u3002</p> <p>\u76f4\u63a5\u4f7f\u7528pip\u5b89\u88c5\u5373\u53ef\uff1a</p> <pre><code>pip install -i https://pypi.douban.com/simple/  pyinotify\n</code></pre> <p>pyinotify\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u4f7f\u7528\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u547d\u4ee4\u884c\u7ec8\u7aef\u6253\u5370\u76f8\u5173\u7684\u4e8b\u4ef6\u3002\u5982\u4e0b\u6240\u793a\u00b7</p> <pre><code> python3 -m pyinotify /tmp/\n&lt;Event dir=False mask=0x100 maskname=IN_CREATE name=runc-process215842680 path=/tmp pathname=/tmp/runc-process215842680 wd=1 &gt;\n&lt;Event dir=False mask=0x20 maskname=IN_OPEN name=runc-process215842680 path=/tmp pathname=/tmp/runc-process215842680 wd=1 &gt;\n&lt;Event dir=False mask=0x2 maskname=IN_MODIFY name=runc-process215842680 path=/tmp pathname=/tmp/runc-process215842680 wd=1 &gt;\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#42-pyinotify\u6a21\u5757apl","title":"4.2 pyinotify\u6a21\u5757APl","text":"<p>Notifier\u662fpyinotify\u6a21\u5757\u6700\u91cd\u8981\u7684\u7c7b\uff0c\u7528\u6765\u8bfb\u53d6\u901a\u77e5\u548c\u5904\u7406\u4e8b\u4ef6\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cNotifier\u5904\u7406\u4e8b\u4ef6\u7684\u65b9\u5f0f\u662f\u6253\u5370\u4e8b\u4ef6\u3002</p> <p>Notifier\u7c7b\u7684\u521d\u59cb\u5316\u51fd\u6570\u63a5\u53d7\u591a\u4e2a\u53c2\u6570\uff0c\u4f46\u53ea\u6709WatchManager\u5bf9\u8c61\u662f\u5fc5\u4f20\u7684\u53c2\u6570\u3002</p> <p>WatchManager\u4fdd\u5b58\u4e86\u9700\u8981\u76d1\u89c6\u7684\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u4ee5\u53ca\u76d1\u89c6\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u54ea\u4e9b\u4e8b\u4ef6\u3002</p> <p>Notifier\u6839\u636eWatchManager\u4e2d\u7684\u914d\u7f6e\u786e\u5b9a\u9700\u8981\u5904\u7406\u7684\u4e8b\u4ef6\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code># cat pyinotify-demo.py\nimport pyinotify\n# Instanciate a new WatchManager\nwm = pyinotify.WatchManager()\n# Add a new watch on /tmp for ALL_EVENTS.\nwm.add_watch('/tmp',pyinotify.ALL_EVENTS)\n# Associate this WatchManager with a Notifier\nnotifier = pyinotify.Notifier(wm)\n# Loop forever and handle events.\nnotifier.loop()\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u521b\u5efa\u4e86\u4e00\u4e2aWatchManager\u5bf9\u8c61\uff1b</p> <p>\u7136\u540e\uff0c\u4f7f\u7528WatchManager\u5bf9\u8c61\u7684add watch\u65b9\u6cd5\u6dfb\u52a0\u5bf9\u6587\u4ef6\u7684\u76d1\u89c6\u4e8b\u4ef6\uff0c\u5176\u4e2d\uff0cpyinotify.ALL_EVENTS\u8868\u793a\u6240\u6709\u4e8b\u4ef6\uff1b</p> <p>\u6700\u540e\uff0c\u521b\u5efa\u4e86\u4e00\u4e2aNotifier\u5bf9\u8c61\uff0c\u5e76\u5728\u521b\u5efa\u5bf9\u8c61\u65f6\u5c06WatchManager\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9Notifier\u5bf9\u8c61\uff0c\u5c06WatchManager\u4e0eNotifier\u5173\u8054\u8d77\u6765\u3002</p> <p>\u63a5\u7740\uff0c\u8c03\u7528notifier.loop\u5faa\u73af\u5904\u7406\u4e8b\u4ef6\u3002\u9ed8\u8ba4\u5904\u7406\u4e8b\u4ef6\u7684\u65b9\u5f0f\u662f\u6253\u5370\u4e8b\u4ef6\u3002</p> <p>\u56e0\u6b64\uff0c\u4e0a\u9762\u8fd9\u6bb5\u7a0b\u5e8f\u7684\u6548\u679c\u4e0e<code>python -m pyinotify /tmp</code>\u547d\u4ee4\u7684\u6548\u679c\u76f8\u540c\u3002</p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u76d1\u89c6\u4e86mp\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u4e8b\u4ef6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4ec5\u4ec5\u76d1\u89c6\u90e8\u5206\u4e8b\u4ef6\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4ec5\u76d1\u89c6\u521b\u5efa\u548c\u5220\u9664\u4e8b\u4ef6\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code># cat pyinotify-demo.py\nimport pyinotify\n# Instanciate a new WatchManager\nwm = pyinotify.WatchManager()\nmask =  pyinotify.IN_DELETE | pyinotify.IN_CREATE\n# Add a new watch on /tmp for ALL_EVENTS.\nwm.add_watch('/tmp',mask)\n# Associate this WatchManager with a Notifier\nnotifier = pyinotify.Notifier(wm)\n# Loop forever and handle events.\nnotifier.loop()\n</code></pre>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#43-\u4e8b\u4ef6\u6807\u5fd7\u4e0e\u4e8b\u4ef6\u5904\u7406\u5668","title":"4.3 \u4e8b\u4ef6\u6807\u5fd7\u4e0e\u4e8b\u4ef6\u5904\u7406\u5668","text":"<p>inotify\u63d0\u4f9b\u4e86\u591a\u79cd\u4e8b\u4ef6\uff0cpyinotify\u4ec5\u4ec5\u662f\u5bf9inotify\u7684Python\u5c01\u88c5\u3002\u56e0\u6b64\uff0c\u4e8b\u4ef6\u7684\u540d\u79f0\u548c\u542b\u4e49\u90fd\u4e00\u6a21\u4e00\u6837\u3002\u4e0b\u8868\u7ed9\u51fa\u4e86inotify\u63d0\u4f9b\u7684\u90e8\u5206\u4e8b\u4ef6\u3002</p> \u4e8b\u4ef6\u6807\u5fd7 \u4e8b\u4ef6\u542b\u4e49 IN_ACCESS \u88ab\u76d1\u63a7\u9879\u76ee\u6216\u8005\u88ab\u76d1\u63a7\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u88ab\u8bbf\u95ee\uff0c\u6bd4\u5982\u4e00\u4e2a\u6587\u4ef6\u88ab\u8bfb\u53d6 IN_MODIFY \u88ab\u76d1\u63a7\u9879\u76ee\u6216\u8005\u88ab\u76d1\u63a7\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u88ab\u4fee\u6539 IN_ATTRIB \u88ab\u76d1\u63a7\u9879\u76ee\u6216\u8005\u88ab\u76d1\u63a7\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u7684\u5143\u6570\u636e\u88ab\u4fee\u6539 IN_CLOSE_WRITE \u4e00\u4e2a\u6253\u5f00\u5207\u7b49\u5f85\u5199\u5165\u7684\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u88ab\u5173\u95ed IN_CLOSE_NOWRITE \u4e00\u4e2a\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6253\u5f00\u7684\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u88ab\u5173\u95ed IN_OPEN \u6587\u4ef6\u6216\u8005\u76ee\u5f55\u88ab\u6253\u5f00 IN_MOVED_FROM \u88ab\u76d1\u63a7\u9879\u76ee\u6216\u8005\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u88ab\u79fb\u9664\u76d1\u63a7\u533a\u57df IN_MOVED_TO \u6587\u4ef6\u6216\u76ee\u5f55\u88ab\u79fb\u5165\u76d1\u63a7\u533a\u57df IN_CREATE \u5728\u6240\u76d1\u63a7\u7684\u76ee\u5f55\u4e2d\u521b\u5efa\u5b50\u76ee\u5f55\u6216\u6587\u4ef6 IN_DELETE \u5728\u6240\u76d1\u63a7\u7684\u76ee\u5f55\u4e2d\u5220\u9664\u76ee\u5f55\u6216\u6587\u4ef6 IN_CLOSE* \u6587\u4ef6\u88ab\u5173\u95ed,\u7b49\u540c\u4e8eIN_CLOSE_WRITE* IN_MOVE \u6587\u4ef6\u88ab\u79fb\u52a8,\u7b49\u540c\u4e8eIN_CLOSE_NOWRITE <p>\u4e0a\u9762\u5217\u4e3e\u7684\u662f\u4e8b\u4ef6\u7684\u6807\u5fd7\u4f4d\uff0c\u6211\u4eec\u53ef\u4ee5\u7528'\u4e0e'\u6765\u5173\u8054\u76d1\u63a7\u591a\u4e2a\u4e8b\u4ef6\u3002</p> <pre><code>multi_event = pyinotify.IN_OPEN | pyinotify.IN_CLOSE_NOWRITE\u3000\u3000\n</code></pre> <p>\u524d\u9762\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u90fd\u662f\u9ed8\u8ba4\u7684\u4e8b\u4ef6\u5904\u7406\u65b9\u5f0f\uff1a\u6253\u5370\u5728\u5c4f\u5e55\u4e0a\uff0c\u800c\u5f88\u591a\u60c5\u51b5\u4e0b\u6211\u4eec\u9700\u8981\u5b9a\u5236\u4e8b\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u7279\u6b8a\u7684\u529f\u80fd\u3002</p> <p>\u5b9a\u5236\u4e8b\u4ef6\u9700\u8981\u7ee7\u627fProcessEvent\u7c7b\uff0c\u9488\u5bf9\u9700\u8981\u5904\u7406\u7684\u4e8b\u4ef6\u7f16\u5199 process_\u4e8b\u4ef6\u540d(self,event) \u51fd\u6570\u5373\u53ef</p> <pre><code>from __future__ import print_function\nimport pyinotify\nwm = pyinotify.WatchManager()\nmask = pyinotify.IN_DELETE | pyinotify.IN_CREATE\nclass EventHandler(pyinotify.ProcessEvent):\ndef process_IN_CREATE(self, event):\nprint(\"Creating:\", event.pathname)\ndef process_IN_DELETE(self, event):\nprint(\"Removing:\", event.pathname)\nhandler = EventHandler()\nnotifier = pyinotify.Notifier(wm, handler)\nwdd = wm.add_watch('/tmp', mask, rec=True)\nnotifier.loop()\n</code></pre> <p>\u6269\u5c55\u9605\u8bfb</p> <p>pyinotify\u6e90\u7801</p> <p>\u76d1\u63a7\u6587\u4ef6\u53d8\u5316\u7684Python\u795e\u5668-watchdog</p> <p>Shell \u76d1\u63a7\u6587\u4ef6\u53d8\u5316</p>"},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#5\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f","title":"5.\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f","text":""},{"location":"Python/2.%E9%AB%98%E7%BA%A7%E7%AF%87/9.%E7%9B%91%E6%8E%A7Linux/#51-python\u76d1\u63a7mongo","title":"5.1 Python\u76d1\u63a7mongo","text":"<pre><code>from __future__ import print_function\nimport pymongo\nclient = pymongo.MongoClient(host='127.0.0.1:27017')\nclient.admin.authenticate('laimingxing', 'laimingxing')\nrs = client.admin.command('replSetGetStatus')\nprint(\"set:\", rs['set'])\nprint(\"myState:\", rs['myState'])\nprint(\"num of members:\", len(rs['members']))\n</code></pre>"},{"location":"Python-vs-Go/0.%E5%AD%A6%E4%B9%A0%E7%BA%BF%E8%B7%AF/0.Python-vs-Go/","title":"Python-vs-Go","text":"<p>\u5168\u9762\u5bf9\u6bd4Python\u548cGo\u8bed\u8a00\u7684\u4f7f\u7528</p> <p></p>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/1.Hello-World/","title":"Hello-World","text":"PythonGo <pre><code>print(\"Hello world\")\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nfmt.Println(\"Hello world\")\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/10.Switch/","title":"Switch","text":"PythonGo <pre><code># -*- coding:utf8 -*-\ndef choice_input():\nprint(\"\u8bf7\u8f93\u5165\u60a8\u7684\u9009\u62e9\u6570\u5b57\u30100\u9000\u51fa\u3011\uff1a\")\nchoice = input()\nreturn int(choice)\nwhile True:\nnumber = choice_input()\nif number == 8:\nprint(\"Oxygen\")\nelif number == 1:\nprint(\"Hydrogen\")\nelif number == 2:\nprint(\"Helium\")\nelif number == 11:\nprint(\"Sodium\")\nelif number == 0:\nbreak\nelse:\nprint(\"I have no idea what %d is\" % number)\n# Alternative solution\ndb = {\n1: \"Hydrogen\",\n2: \"Helium\",\n8: \"Oxygen\",\n11: \"Sodium\",\n0: \"q\",\n}\nwhile True:\nnumber = choice_input()\nresult = db.get(number, \"I have no idea what %d is\" % number)\nif result == \"q\":\nbreak\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"strconv\"\n)\nfunc str2int(s string) int {\ni, err := strconv.Atoi(s)\nif err != nil {\npanic(\"Not a number\")\n}\nreturn i\n}\nfunc main() {\nvar number_string string\n// \u5faa\u73af\u7684\u6807\u5fd7\nloop := true\nfor {\nfmt.Print(\"\u8bf7\u8f93\u5165\u60a8\u9009\u62e9\u7684\u6570\u5b57\u30100 \u9000\u51fa\u3011\uff1a \")\nfmt.Scanln(&amp;number_string)\nnumber := str2int(number_string)\nswitch number {\ncase 8:\nfmt.Println(\"Oxygen\")\ncase 1:\nfmt.Println(\"Hydrogen\")\ncase 2:\nfmt.Println(\"Helium\")\ncase 11:\nfmt.Println(\"Sodium\")\ncase 0:\n// \u4fee\u6539\u5faa\u73af\u6807\u5fd7\uff0c\u8ba9\u5176\u9000\u51fa\u5faa\u73af\nloop = false\ndefault:\nfmt.Printf(\"I have no idea what %d is\\n\", number)\n}\nif !loop {\nbreak\n}\n}\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/11.%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0/","title":"\u53ef\u53d8\u53c2\u6570\u51fd\u6570","text":"<p>\u5728Python\u4e2d\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7somefunction(*args)\u63a5\u53d7\u5404\u79cd\u7c7b\u578b\uff0c</p> <p>\u4f46\u662fGo\u5219\u65e0\u6cd5\u5b9e\u73b0\u3002 </p> <p>\u4f46\u662f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7c7b\u578b\u6210\u4e3a\u63a5\u53e3\uff0c\u4ece\u800c\u80fd\u591f\u83b7\u5f97\u66f4\u591a\u4e30\u5bcc\u7684\u7c7b\u578b\u7ed3\u6784\u3002</p> PythonGo <pre><code>from __future__ import division\ndef average(*numbers):\nreturn sum(numbers) / len(numbers)\nprint(average(1, 2, 3, 4))  # 10/4 = 2.5\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc average(numbers ...float64) float64 {\ntotal := 0.0\nfor _, number := range numbers {\ntotal += number\n}\nreturn total / float64(len(numbers))\n}\nfunc main() {\nfmt.Println(average(1,2,3,4))   //2.5\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/12.%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97/","title":"\u65f6\u95f4\u8ba1\u7b97","text":"PythonGo <pre><code>import time\nt0 = time.time()\ntime.sleep(3.5)  # for example\nt1 = time.time()\nprint(\"Took %.2f seconds\" % (t1 - t0))\n</code></pre> <p>eg1 <pre><code>package main\nimport (\n\"fmt\"\n\"time\"\n)\nfunc main() {\nt0 := time.Now()\ntime.Sleep(time.Second)\nelapsed := time.Since(t0)\nfmt.Printf(\"Took %s\", elapsed)      //Took 1.0005267s\n}\n</code></pre></p> <p>eg2 <pre><code>package main\nimport (\n\"time\"\n\"fmt\"\n)\nfunc main() {\nstart := time.Now().Unix()\nfor num := 1; num &lt;= 80000; num++ {\nflag := true //\u5047\u8bbe\u662f\u7d20\u6570\n//\u5224\u65adnum\u662f\u4e0d\u662f\u7d20\u6570\nfor i := 2; i &lt; num; i++ {\nif num % i == 0 {//\u8bf4\u660e\u8be5num\u4e0d\u662f\u7d20\u6570\nflag = false\nbreak\n}\n}\nif flag {\n//\u5c06\u8fd9\u4e2a\u6570\u5c31\u653e\u5165\u5230primeChan\n//primeChan&lt;- num\n}\n}\nend := time.Now().Unix()\nfmt.Println(\"\u666e\u901a\u7684\u65b9\u6cd5\u8017\u65f6=\", end - start)\n}\n</code></pre></p>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/13.%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85/","title":"\u51fd\u6570\u7684\u95ed\u5305","text":"<p>\u8bf7\u6ce8\u610f\uff0c\u5728Python\u793a\u4f8b\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5728\u5185\u90e8\u51fd\u6570\u4e2d\u8bbf\u95ee\u6570\u5b57\uff0c\u4f46\u4e0d\u80fd\u66f4\u6539\u5b83\u3002\u5047\u8bbe\u60a8\u60f3\u8fd9\u6837\u505a\u3002</p> <p>\u6ce8\u610f\uff1a\u60a8\u53ef\u4ee5\u4f7f\u7528global\u8bed\u53e5\u6765\u89e3\u51b3\u8be5\u95ee\u9898\uff0c\u4f8b\u5982</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nnumber = 0\ndef increment(amount):\nglobal number\nnumber += amount\nincrement(1)\nincrement(2)\nprint(number)       //3\n</code></pre> PythonGo <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\ndef run():\ndef increment(amount):\nreturn number + amount\nnumber = 0\nnumber = increment(1)\nnumber = increment(2)\nprint(number)  # 3\nrun()\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nnumber := 0\n/* It has to be a local variable like this.\n       You can't do `func increment(amount int) {` */\nincrement := func(amount int) {\nnumber += amount\n}\nincrement(1)\nincrement(2)\nfmt.Println(number) // 3\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/14.%E9%80%80%E5%87%BA%E5%A4%84%E7%90%86/","title":"\u9000\u51fa\u5904\u7406","text":"<p>\u5728Go\u4e2d\u8fdb\u884c\u5ef6\u8fdf\u7684\u5f88\u9177\u7684\u4e8b\u60c5\u662f\uff0c\u60a8\u53ef\u4ee5\u5728\u91cd\u8981\u7684\u5730\u65b9\u952e\u5165\u8be5\u5185\u5bb9\uff0c\u7136\u540e\u8ba9\u8bfb\u8005\u6e05\u695a\u5730\u77e5\u9053\u5b83\u5c06\u5728\u4ee5\u540e\u6267\u884c\u3002</p> <p>\u5728Python\u4e2d\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5c06try:\u548cfinally\uff1a\u5757\u4e4b\u95f4\u7684\u5185\u5bb9\u4fdd\u6301\u7b80\u77ed\u6765\u5b9e\u73b0\u76f8\u540c\u7684\u76ee\u7684\u3002</p> PythonGo <pre><code>f = open(\"defer.py\", encoding=\"utf-8\")\ntry:\nf.read()\nfinally:\nf.close()\n</code></pre> <pre><code>package main\nimport \"os\"\nfunc main() {\nf,_ := os.Open(\"defer.py\")\ndefer f.Close()\n// you can now read from this\n// `f` thing and it'll be closed later\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/15.%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/","title":"\u5f02\u5e38\u6355\u83b7","text":"PythonGo <pre><code>try:\nraise Exception('Shit')\nexcept Exception as e:\nprint(\"error was:\", e)\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\n// Running this will print out:\n//    error was: Shit!\ndefer func() {\nfmt.Println(\"error was:\",recover())         //error was: Shit!\n}()\npanic(\"Shit!\")\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/16.%E5%8F%AF%E5%8F%98%E9%A1%B9/","title":"\u53ef\u53d8\u9879","text":"PythonGo <pre><code>def upone(mutable, index):\nmutable[index] = mutable[index].upper()\nlist = ['a', 'b', 'c']\nupone(list, 1)\nprint list  # ['a', 'B', 'c']\ndict = {'a': 'anders', 'b': 'bengt'}\nupone(dict, 'b')\nprint dict  # {'a': 'anders', 'b': 'BENGT'}\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"strings\"\n)\nfunc upone_list(thing []string, index int) {\nthing[index] = strings.ToUpper(thing[index])\n}\nfunc upone_map(thing map[string]string, index string) {\nthing[index] = strings.ToUpper(thing[index])\n}\nfunc main() {\n// mutable\nlist := []string{\"a\", \"b\", \"c\"}\nupone_list(list, 1)\nfmt.Println(list) // [a B c]\n// mutable\ndict := map[string]string{\n\"a\": \"anders\",\n\"b\": \"bengt\",\n}\nupone_map(dict, \"b\")\nfmt.Println(dict) // map[a:anders b:BENGT]\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/17.%E7%B1%BB/","title":"\u7c7b","text":"PythonGo <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nfrom __future__ import division\nfrom math import sqrt\nclass Point(object):\ndef __init__(self, x, y):\nself.x = x\nself.y = y\ndef distance(point1, point2):\nreturn sqrt(point1.x * point2.x + point1.y * point2.y)\np1 = Point(1, 3)\np2 = Point(2, 4)\nprint(distance(p1, p2))  # 3.74165738677\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"math\"\n)\ntype Point struct {\nx float64\ny float64\n}\nfunc distance(point1 Point, point2 Point) float64 {\nreturn math.Sqrt(point1.x*point2.x + point1.y*point2.y)\n}\n//\u7531\u4e8e\u7ed3\u6784\u4f1a\u81ea\u52a8\u590d\u5236\uff0c\n//\u6700\u597d\u5c06\u5176\u4f5c\u4e3a\u6307\u9488\u4f20\u9012\u3002\nfunc distance_better(point1 *Point, point2 *Point) float64 {\nreturn math.Sqrt(point1.x*point2.x + point1.y*point2.y)\n}\nfunc main() {\np1 := Point{\nx: 1,\ny: 3,\n}\np2 := Point{\nx: 2,\ny: 4,\n}\nfmt.Println(distance(p1, p2))               //3.7416573867739413\nfmt.Println(distance_better(&amp;p1, &amp;p2))      //3.7416573867739413\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/18.%E6%96%B9%E6%B3%95/","title":"\u65b9\u6cd5","text":"PythonGo <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nfrom __future__ import division\nfrom math import sqrt\nclass Point(object):\ndef __init__(self, x, y):\nself.x = x\nself.y = y\ndef distance(self, other):\nreturn sqrt(self.x * other.x + self.y * other.y)\np1 = Point(1, 3)\np2 = Point(2, 4)\nprint(p1.distance(p2))  # 3.74165738677\nprint(p2.distance(p1))  # 3.74165738677\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"math\"\n)\ntype Point struct {\nx float64\ny float64\n}\nfunc (this Point) distance(other Point) float64 {\nreturn math.Sqrt(this.x*other.x + this.y*other.y)\n}\n// Dince\u7ed3\u6784\u4f1a\u81ea\u52a8\u590d\u5236\uff0c\n//\u6700\u597d\u5c06\u5176\u4f5c\u4e3a\u6307\u9488\u4f20\u9012\u3002\nfunc (this *Point) distance_better(other *Point) float64 {\nreturn math.Sqrt(this.x*other.x + this.y*other.y)\n}\nfunc main() {\np1 := Point{\nx: 1,\ny: 3,\n}\np2 := Point{\nx: 2,\ny: 4,\n}\nfmt.Println(p1.distance(p2))            //3.7416573867739413\nfmt.Println(p1.distance_better(&amp;p2))    //3.7416573867739413\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/19.%E5%B9%B6%E5%8F%91/","title":"\u5e76\u53d1","text":"<p>\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd0\u884c\u8fd9\u4e9b\u547d\u4ee4\u65f6\uff0c\u7f16\u53f7\u5728\u4e24\u6b21\u8fd0\u884c\u4e4b\u95f4\u7684\u987a\u5e8f\u4e0d\u540c\u3002\u5728Python\u793a\u4f8b\u4e2d\uff0c\u5f53\u6240\u6709\u8bf7\u6c42\u5b8c\u6210\u540e\uff0c\u5b83\u5c06\u81ea\u52a8\u9000\u51fa\u3002</p> PythonGo <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nimport urllib.request\nimport urllib.error\nimport multiprocessing\ndef f(url):\ntry:\nreq = urllib.request.urlopen(url)\nprint(len(req.read()))\nfinally:\nreq.close()\nurls = (\n\"http://www.peterbe.com\",\n\"http://peterbe.com\",\n\"http://htmltree.peterbe.com\",\n\"http://tflcameras.peterbe.com\",\n)\nif __name__ == '__main__':\np = multiprocessing.Pool(3)\np.map(f, urls)\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"net/http\"\n)\nfunc f(url string) {\nresponse, err := http.Get(url)\nif err != nil {\npanic(err)\n}\ndefer response.Body.Close()\nbody, err1 := ioutil.ReadAll(response.Body)\nif err1 != nil {\npanic(err1)\n}\nfmt.Println(len(body))\n}\nfunc main() {\nurls := []string{\n\"http://www.peterbe.com\",\n\"http://peterbe.com\",\n\"http://htmltree.peterbe.com\",\n\"http://tflcameras.peterbe.com\",\n}\nfor _, url := range urls {\n// \u5f00\u542fGoroutines\ngo f(url)\n}\n// necessary so it doesn't close before\n// the goroutines have finished\nvar input string\nfmt.Scanln(&amp;input)\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/2.Print/","title":"Print","text":"PythonGo <pre><code>print(\"Some string\")\nprint(\"Some string\",end=\",\")\nprint()\nprint(\"Name : %s ,Age:%d\" % (\"hujianli\", 20))\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nfmt.Println(\"Some string\")\nfmt.Print(\"Some string\")\nfmt.Printf(\"Name\uff1a %s, Age: %d\", \"hujianli\", 21)\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/20.Args/","title":"Args","text":"<p>To run this:</p> <pre><code>go run args.go peter anders bengt\n</code></pre> <p>And it should output:</p> <pre><code>PETER\nANDERS\nBENGT\n</code></pre> PythonGo <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nimport sys\ndef transform(*args):\nfor arg in args:\nprint(arg.upper())\nif __name__ == '__main__':\ntransform(*sys.argv[1:])\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\n\"os\"\n\"strings\"\n)\nfunc transform(args []string) {\nfor _, arg := range args {\nfmt.Println(strings.ToUpper(arg))\n}\n}\nfunc main() {\nargs := os.Args[1:]\ntransform(args)\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/21.%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E5%88%AB%E5%90%8D/","title":"\u5bfc\u5165\u6a21\u5757\u522b\u540d","text":"<p>\u8fd9\u4e2a\u4f8b\u5b50\u6709\u70b9\u611a\u8822\uff0c\u56e0\u4e3a\u60a8\u901a\u5e38\u4e0d\u4f1a\u4e3a\u7b80\u77ed\u7684\u5185\u7f6e\u63d2\u4ef6\u800c\u70e6\u607c\u3002\u5b83\u9002\u5408\u4e8e\u957f\u5bfc\u5165\u540d\u7684\u5bfc\u5165\uff0c\u4f8b\u5982:</p> <pre><code>import (\n    pb \"github.com/golang/groupcache/groupcachepb\"\n)\n</code></pre> <p>\u60a8\u8fd8\u53ef\u4ee5\u5bfc\u5165\u5b9e\u9645\u4e0a\u4e0d\u4f1a\u4f7f\u7528\u7684\u8f6f\u4ef6\u5305\u3002\u4f8b\u5982:</p> <pre><code>import (\n    _ \"image/png\"  // import can do magic\n)\n</code></pre> PythonGo <pre><code>import string as s\nprint s.upper(\"world\")\n</code></pre> <pre><code>package main\nimport (\n\"fmt\"\ns \"strings\"\n)\nfunc main() {\nfmt.Println(s.ToUpper(\"world\"))\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/22.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/","title":"\u5b57\u7b26\u4e32\u683c\u5f0f\u5316","text":"<p>\u60a8\u53ef\u80fd\u5df2\u7ecf\u770b\u5230\u4e86\u8bf8\u5982fmt.Println\uff08\u201c some string\u201d\uff09\u4e4b\u7c7b\u7684\u4e1c\u897f\u53ca\u5176\u5468\u56f4\u7684\u53d8\u5316\u3002</p> <p>\u4f46\u662f\u6709\u65f6\u5019\u60a8\u53ef\u80fd\u53ea\u60f3\u4f7f\u7528\u5728fmt\u4e0b\u627e\u5230\u7684\u683c\u5f0f\u5316\u5de5\u5177\u6765\u751f\u6210\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u5fc5\u5728stdout\u4e0a\u4f7f\u7528\u3002 \u90a3\u5c31\u662f\u4e3a\u4ec0\u4e48\u4f7f\u7528fmt.Sprintf\u7684\u76ee\u7684\u3002</p> <p>== \"Python\"</p> <pre><code>```python\nmax = 10\ntry:\n    raise Exception(\"The max. number is {}\".format(max))\nexcept Exception as e:\n    print(e)\n```\n</code></pre> Go <pre><code>package main\nimport \"fmt\"\nfunc main() {\nmax := 10\ndefer func() {\nfmt.Println(\"error was:\", recover())        //error was: The max ,number is 10\n}()\npanic(fmt.Sprintf(\"The max ,number is %d\", max))\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/23.%E5%8E%BB%E9%87%8D/","title":"\u53bb\u91cd","text":"PythonGo <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\ndef uniqify(seq):\nseen = {}\nunique = []\n# \u904d\u5386\u5e8f\u5217\uff0c\u5982\u679c\u4e0d\u5728\u5b57\u5178\u4e2d\uff0c\u5148\u52a0\u5165\u5b57\u5178\uff0c\u52a0\u5165\u5217\u8868\uff0c\u5728\u5b57\u5178\u4e2d\u7684\u4e3a\u91cd\u590d\u7684\uff0c\u4e0d\u52a0\u5165\u5217\u8868\nfor item in seq:\nif item not in seen:\nseen[item] = 1\nunique.append(item)\nreturn unique\nitems = ['B', 'B', 'E', 'Q', 'Q', 'Q']\nprint(uniqify(items))  # prints ['B', 'E', 'Q']\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc uniqify(items *[]string) {\nseen := make(map[string]bool)\nj := 0\nfor i, x := range *items {\nif !seen[x] {\nseen[x] = true\n(*items)[j] = (*items)[i]\nj++\n}\n}\n*items = (*items)[:j]\n}\nfunc main() {\nitems := []string{\"B\", \"B\", \"E\", \"Q\", \"Q\", \"Q\"}\nuniqify(&amp;items)\nfmt.Println(items) // prints [B E Q]\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/24.%E5%B8%A6%E9%A2%9C%E8%89%B2%E6%89%93%E5%8D%B0/","title":"\u5e26\u989c\u8272\u6253\u5370","text":"PythonGo <pre><code>from enum import Enum\nclass FontColor(Enum):\n'''\n    \u989c\u8272\u679a\u4e3e\n    '''\n# \u9ed1\u8272\nBlack = 1\n# \u7ea2\u8272\nRed = 2\n# \u7eff\u8272\nGreen = 3\n# \u9ec4\u8272\nYellow = 4\n# \u84dd\u8272\nBlue = 5\n# \u7d2b\u8272\nPurple = 6\n# \u6df1\u7eff\u8272\nDarkGreen = 7\n# \u767d\u8272\nWhite = 8\n# \u767d\u5e95\u9ed1\u5b57\nWhiteReverse = 9\n# \u6df1\u7eff\u5e95\u7ea2\u5b57\nDarkGreenReverse = 10\n# \u7d2b\u5e95\u7eff\u5b57\nPurpleReverse = 11\n# \u84dd\u5e95\u9ec4\u5b57\nBlueReverse = 12\n# \u9ec4\u5e95\u84dd\u5b57\nYellowReverse = 13\n# \u7eff\u5e95\u7d2b\u5b57\nGreenReverse = 14\n# \u7ea2\u5e95\u6df1\u7eff\u5b57\nRedReverse = 15\n# \u9ed1\u5e95\u767d\u5b57\nBlackReverse = 16\ndef color_print(color, format, *args, **kwargs):\nmsg = format.format(*args, **kwargs)\ncolor_format1 = \"\\x1b[%dm%%s\\x1b[0m\\n\"\ncolor_format2 = \"\\x1b[%d;%dm%%s\\x1b[0m\\n\"\nif color == FontColor.Black:\nformat = color_format1 % 30\nelif color == FontColor.Red:\nformat = color_format1 % 31\nelif color == FontColor.Green:\nformat = color_format1 % 32\nelif color == FontColor.Yellow:\nformat = color_format1 % 33\nelif color == FontColor.Blue:\nformat = color_format1 % 34\nelif color == FontColor.Purple:\nformat = color_format1 % 35\nelif color == FontColor.DarkGreen:\nformat = color_format1 % 36\nelif color == FontColor.White:\nformat = color_format1 % 37\nelif color == FontColor.WhiteReverse:\nformat = color_format2 % (47, 30)\nelif color == FontColor.DarkGreenReverse:\nformat = color_format2 % (46, 31)\nelif color == FontColor.PurpleReverse:\nformat = color_format2 % (45, 32)\nelif color == FontColor.BlueReverse:\nformat = color_format2 % (44, 33)\nelif color == FontColor.YellowReverse:\nformat = color_format2 % (43, 34)\nelif color == FontColor.GreenReverse:\nformat = color_format2 % (42, 35)\nelif color == FontColor.RedReverse:\nformat = color_format2 % (41, 36)\nelif color == FontColor.BlackReverse:\nformat = color_format2 % (40, 37)\nprint(format % msg)\n# \u8fd4\u56de\u4e00\u4e2a\u521b\u9020\u6253\u5370\u6307\u5b9a\u989c\u8272\u5185\u5bb9\u5230\u7ec8\u7aef\u7684\u95ed\u5305\ndef create_color_printer(color):\ndef color_printer(format, *args, **kwargs):\ncolor_print(color,format,*args,**kwargs)\nreturn color_printer\nif __name__ == '__main__':\nerror_print = create_color_printer(FontColor.BlackReverse)\nerror_print('\u6570\u636e\u5e93\u5d29\u5566\uff01\uff01\uff01\uff01')\n</code></pre> <p><pre><code>package zzeutil\nimport (\n\"fmt\"\n)\ntype FontColor int8\nconst (\n//\u9ed1\u8272\nBlack FontColor = iota\n//\u7ea2\u8272\nRed FontColor = iota\n//\u7eff\u8272\nGreen FontColor = iota\n//\u9ec4\u8272\nYellow FontColor = iota\n//\u84dd\u8272\nBlue FontColor = iota\n//\u7d2b\u8272\nPurple FontColor = iota\n//\u6df1\u7eff\u8272\nDarkGreen FontColor = iota\n//\u767d\u8272\nWhite FontColor = iota\n//\u767d\u5e95\u9ed1\u5b57\nWhiteReverse FontColor = iota\n//\u6df1\u7eff\u5e95\u7ea2\u5b57\nDarkGreenReverse FontColor = iota\n//\u7d2b\u5e95\u7eff\u5b57\nPurpleReverse FontColor = iota\n//\u84dd\u5e95\u9ec4\u5b57\nBlueReverse FontColor = iota\n//\u9ec4\u5e95\u84dd\u5b57\nYellowReverse FontColor = iota\n//\u7eff\u5e95\u7d2b\u5b57\nGreenReverse FontColor = iota\n//\u7ea2\u5e95\u6df1\u7eff\u5b57\nRedReverse FontColor = iota\n//\u9ed1\u5e95\u767d\u5b57\nBlackReverse FontColor = iota\n)\nfunc ColorPrint(fontColor FontColor, format string, params ...interface{}) {\nmsg := fmt.Sprintf(format, params...)\ncolorFormat1 := \"\\x1b[%dm%%s\\x1b[0m\\n\"\ncolorFormat2 := \"\\x1b[%d;%dm%%s\\x1b[0m\\n\"\nswitch fontColor {\ncase Black:\nformat = fmt.Sprintf(colorFormat1, 30)\ncase Red:\nformat = fmt.Sprintf(colorFormat1, 31)\ncase Green:\nformat = fmt.Sprintf(colorFormat1, 32)\ncase Yellow:\nformat = fmt.Sprintf(colorFormat1, 33)\ncase Blue:\nformat = fmt.Sprintf(colorFormat1, 34)\ncase Purple:\nformat = fmt.Sprintf(colorFormat1, 35)\ncase DarkGreen:\nformat = fmt.Sprintf(colorFormat1, 36)\ncase White:\nformat = fmt.Sprintf(colorFormat1, 37)\ncase WhiteReverse:\nformat = fmt.Sprintf(colorFormat2, 47, 30)\ncase DarkGreenReverse:\nformat = fmt.Sprintf(colorFormat2, 46, 31)\ncase PurpleReverse:\nformat = fmt.Sprintf(colorFormat2, 45, 32)\ncase BlueReverse:\nformat = fmt.Sprintf(colorFormat2, 44, 33)\ncase YellowReverse:\nformat = fmt.Sprintf(colorFormat2, 43, 34)\ncase GreenReverse:\nformat = fmt.Sprintf(colorFormat2, 42, 35)\ncase RedReverse:\nformat = fmt.Sprintf(colorFormat2, 41, 36)\ncase BlackReverse:\nformat = fmt.Sprintf(colorFormat2, 40, 37)\n}\nfmt.Printf(format, msg)\n}\n//\u8fd4\u56de\u4e00\u4e2a\u521b\u9020\u6253\u5370\u6307\u5b9a\u989c\u8272\u5185\u5bb9\u5230\u7ec8\u7aef\u7684\u95ed\u5305\nfunc CreateColorPrinter(color FontColor) func(format string, params ...interface{}) {\nreturn func(format string, params ...interface{}) {\nColorPrint(color, format, params...)\n}\n}\n</code></pre> \u4f7f\u7528eg1 \u76f4\u63a5\u8f93\u51fa\u6307\u5b9a\u989c\u8272\u7684\u6587\u5b57\uff1a</p> <pre><code>package main\nimport \"zzeutil\"\nfunc main() {\nzzeutil.ColorPrint(zzeutil.Black, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.Red, \"Hello zze\")\nzzeutil.ColorPrint(zzeutil.Green, \"Hello zze\")\nzzeutil.ColorPrint(zzeutil.Yellow, \"Hello zze\")\nzzeutil.ColorPrint(zzeutil.Blue, \"Hello zze\")\nzzeutil.ColorPrint(zzeutil.Purple, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.DarkGreen, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.White, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.WhiteReverse, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.DarkGreenReverse, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.PurpleReverse, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.BlueReverse, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.YellowReverse, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.GreenReverse, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.RedReverse, \"Hello %s\", \"zze\")\nzzeutil.ColorPrint(zzeutil.BlackReverse, \"Hello %s\", \"zze\")\n}\n</code></pre> <p>\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\u5927\u90e8\u5206\u60c5\u51b5\u6211\u5176\u5b9e\u4ec5\u4ec5\u4f7f\u7528\u5176\u4e2d\u51e0\u4e2a\u989c\u8272\uff0c\u8fd9\u65f6\u5019\u6bcf\u6b21\u8981\u4f20\u5165\u4fe9\u53c2\u6570\u611f\u89c9\u6709\u70b9\u4e0d\u65b9\u4fbf\uff0c\u6240\u4ee5\u5c31\u6709\u4e86\u90a3\u4e2a\u95ed\u5305\u51fd\u6570\uff0c\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a <pre><code>package main\nimport \"zzeutil\"\nfunc main() {\nerrorPrint := zzeutil.CreateColorPrinter(zzeutil.Red)\nsuccessPrint := zzeutil.CreateColorPrinter(zzeutil.Green)\nwarningPrint := zzeutil.CreateColorPrinter(zzeutil.Yellow)\ndebugPrint := zzeutil.CreateColorPrinter(zzeutil.White)\nerrorPrint(\"\u51fa\u73b0\u4e25\u91cd\u9519\u8bef\uff1a%s\", \"MySQL \u88ab\u5220\u5e93\u4e86\uff01\uff01\uff01\")\nsuccessPrint(\"\u4e0a\u4f20\u6587\u4ef6\u6210\u529f~~~\")\nwarningPrint(\"\u5185\u5b58\u5df2\u4f7f\u7528 86%\uff01\uff01\uff01\uff01\")\ndebugPrint(\"\u65e0\u5173\u7d27\u8981\u7684\u4fe1\u606f~~\")\n}\n</code></pre></p>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/3.%E6%B3%A8%E9%87%8A/","title":"\u6ce8\u91ca","text":"PythonGo <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\n\"\"\"This is a doc string for the whole module\"\"\"\n# This is a inline comment\nclass Class(object):\n\"\"\"This is the doc string for the class\"\"\"\nprint(__doc__)  # This is a doc string for the whole module\nprint(Class.__doc__)  # This is the doc string for the class\n# \u5355\u884c\u6ce8\u91ca\n'''\n\u591a\u884c\u6ce8\u91ca\n\u591a\u884c\u6ce8\u91ca\n'''\n\"\"\"\n\u591a\u884c\u6ce8\u91ca\n\u591a\u884c\u6ce8\u91ca\n\"\"\"\n</code></pre> <pre><code>package main\n// This is a general comment\n/* This is also a comment\n   but on multiple lines.\n*/\n/* This is the multi-line comment for the function main().\n   To get access to this from the command line, run:\n     godoc comments.go\n*/\n//\u5355\u884c\u6ce8\u91ca\n/*\n\u591a\u884c\u6ce8\u91ca\n\u591a\u884c\u6ce8\u91ca\n*/\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/4.%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/","title":"\u591a\u884c\u5b57\u7b26\u4e32","text":"PythonGo <pre><code>#!/usr/bin/env python\n# -*- coding:utf8 -*-\nprint(\n\"\"\"This is\n    a multi-line string.\n    \"\"\")\nprint(\n\"O'word \"\n'Another \"word\" '\n\"Last word.\"\n)\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nfmt.Println(`This is\na multi-line string.`)\nfmt.Println(\n\"O'word \" +\n\"Another \\\"word\\\" \" +\n\"Last word.\")\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/5.Lists/","title":"Lists","text":"<p>\u5207\u7247\u662f\u6570\u7ec4\u7684\u4e00\u90e8\u5206\uff0c\u5176\u957f\u5ea6\u53ef\u4ee5\u66f4\u6539\u3002</p> <p>\u6570\u7ec4\u548c\u5207\u7247\u4e4b\u95f4\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff0c\u4f7f\u7528\u6570\u7ec4\u9700\u8981\u9884\u5148\u77e5\u9053\u5927\u5c0f\u3002</p> <p>\u5728Go\u4e2d\uff0c\u65e0\u6cd5\u5e73\u7b49\u5730\u5c06\u503c\u6dfb\u52a0\u5230\u73b0\u6709\u5207\u7247\u4e2d\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u8981\u8f7b\u677e\u6dfb\u52a0\u503c\uff0c\u5219\u53ef\u4ee5\u4ee5\u6700\u5927\u957f\u5ea6\u521d\u59cb\u5316\u5207\u7247\u5e76\u5c06\u5176\u589e\u91cf\u6dfb\u52a0\u3002</p> PythonGo <pre><code># -*- coding:utf8 -*-\nnumbers = [0] * 5\n# change one of them\nnumbers[2] = 100\nsome_numbers = numbers[1:3]\nprint(some_numbers)  # [0, 100]\n# length of it\nprint(len(numbers))  # 5\n# initialize another\nscores = []\nscores.append(1.1)\nscores[0] = 2.2\nprint(scores)  # [2.2]\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\n// initialized array\nvar numbers [5] int // becomes [0, 0, 0, 0, 0]\n// change one of them\nnumbers[2] = 100\n// create a new slice from an array\nsome_numbers := numbers[1:3]\nfmt.Println(some_numbers) // [0, 100]\n// length of it\nfmt.Println(len(some_numbers)) //2\n// initialize a slice\nvar scores []float64\nscores = append(scores, 1.1) // recreate to append\nscores[0] = 2.2              // change your mind\nfmt.Println(scores)          // prints [2.2]\n// when you don't know for sure how much you're going\n// to put in it, one way is to\nvar things [100]string\nthings[0] = \"Perter\"\nthings[1] = \"hujianli\"\nfmt.Println(len(things))    //100\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/6.Map/","title":"Map","text":"<p>Go\u8bed\u8a00\u4e2d\u521b\u5efa\u4e00\u4e2aMap</p> <pre><code>elements :=make(map[string]int)\n// \u6216\u8005\nelements[\"H\"] = map[string]int{\n\"protons\": 1,\n\"neutrons\": 0,\n}\n</code></pre> <p>\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u8fd9\u5c31\u662f\u60a8\u8981\u4f7f\u7528\u7684\u7ed3\u6784\u3002</p> PythonGo <pre><code># -*- coding:utf8 -*-\nelements = {}\nelements[\"H\"] = 1\nprint(elements[\"H\"])  # 1\n# remove by key\nelements[\"O\"] = 8\nelements.pop(\"O\")\n# do something depending on the being there\nif \"O\" in elements:\nprint(elements[\"O\"])\nif \"H\" in elements:\nprint(elements[\"H\"])\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nelements :=make(map[string]int)\nelements[\"H\"] = 1\nfmt.Println(elements[\"H\"])\n// remove by key\nelements[\"O\"] = 8\ndelete(elements, \"O\")\n// only do something with a element if it's in the map\nif number, ok := elements[\"O\"];ok{\nfmt.Println(number)     // won't be printed\n}\nif number, ok := elements[\"H\"];ok{\nfmt.Println(number)     // 1\n}\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/7.Booleans/","title":"Booleans","text":"<p>Go\u5e76\u6ca1\u6709\u4e00\u79cd\u5feb\u901f\u7684\u65b9\u6cd5\u6765\u8bc4\u4f30\u67d0\u4e9b\u4e1c\u897f\u662f\u5426\u201c\u771f\u5b9e\u201d\u3002</p> <p>\u4f8b\u5982\uff0c\u5728Python\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5728\u4efb\u4f55\u7c7b\u578b\u4e0a\u4f7f\u7528if\u8bed\u53e5\uff0c\u5e76\u4e14\u5927\u591a\u6570\u7c7b\u578b\u90fd\u53ef\u4ee5\u81ea\u52a8\u8f6c\u6362\u4e3aTrue\u6216False\u3002</p> <p>\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <pre><code>x = 1\nif x:\nprint(\"Yes\")\ny = []\nif y:\nprint(\"this won't be printed\")\n</code></pre> <p>\u5728Go\u4e2d\u8fd9\u662f\u4e0d\u53ef\u80fd\u7684\u3002\u60a8\u786e\u5b9e\u9700\u8981\u4e3a\u6bcf\u4e2a\u7c7b\u578b\u660e\u786e\u5730\u6267\u884c\u6b64\u64cd\u4f5c <pre><code>package main\nimport \"fmt\"\nfunc main() {\nx := 1\nif x != 0 {\nfmt.Println(\"Yes\")      //Yes\n}\nvar y []string\nif len(y) != 0 {\nfmt.Println(\"this won't be printed\")\n}\n}\n</code></pre></p> PythonGo <pre><code>print(True and False)  # False\nprint(True or False)  # True\nprint(not True)  # False\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nfmt.Println(true &amp;&amp; false) // false\nfmt.Println(true || false) // true\nfmt.Println(!true)         // false\nx := 1\nif x != 0 {\nfmt.Println(\"Yes\") //Yes\n}\nvar y []string\nif len(y) != 0 {\nfmt.Println(\"this won't be printed\")\n}\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/8.Forloop/","title":"Forloop","text":"<p>Go\u53ea\u6709\u4e00\u79cd\u7c7b\u578b\u7684\u5faa\u73af\uff0c\u90a3\u5c31\u662ffor\u5faa\u73af\u3002</p> PythonGo <pre><code># -*- coding:utf8 -*-\ni = 1\nwhile i &lt;= 10:\nprint(i)\ni += 1\n# ...or...\nfor i in range(1, 11):\nprint(i)\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\ni := 1\nfor i &lt;= 10 {\nfmt.Println(i)\ni += 1\n}\n// same thing more but more convenient\nfor i := 1; i &lt;= 10; i++ {\nfmt.Println(i)\n}\n}\n</code></pre>"},{"location":"Python-vs-Go/1.%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/9.Range/","title":"Range","text":"PythonGo <pre><code>names = [\"Peter\", \"Anders\", \"Bengt\"]\nfor i, name in enumerate(names):\nprint(\"%d. %s\" % (i + 1, name))\n# 1. Peter\n# 2. Anders\n# 3. Bengt\n</code></pre> <pre><code>package main\nimport \"fmt\"\nfunc main() {\nnames := []string{\n\"Perter\",\n\"HUjianli\",\n\"Bengt\",\n}\n/* This will print\n    1.Perter\n    2.HUjianli\n    3.Bengt\n    */\nfor i, i2 := range names {\nfmt.Printf(\"%d.%s\\n\", i+1, i2)\n}\n}\n</code></pre>"},{"location":"Python-vs-Go/2.%E8%BF%9B%E9%98%B6/1.%E4%BD%BF%E7%94%A8RPC/","title":"\u4f7f\u7528RPC","text":"PythonGo <p>py\u6846\u67b6 jsonrpclib-pelix</p> <p>\u6ce8\u610f: \u8fd9\u79cd\u65b9\u5f0f\u53ea\u9002\u7528\u4e8e\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u7a0b\u5e8f\u5747\u4e3apython</p> <ol> <li> <p>\u5b89\u88c5 <pre><code>pip install jsonrpclib-pelix\n</code></pre></p> </li> <li> <p>\u670d\u52a1\u7aef <pre><code>from jsonrpclib.SimpleJSONRPCServer import SimpleJSONRPCServer\nserver = SimpleJSONRPCServer(('localhost', 8081))\nserver.register_function(lambda x,y: x+y, 'add')\nserver.serve_forever()\n</code></pre></p> </li> <li> <p>\u5ba2\u6237\u7aef <pre><code>import jsonrpclib\nserver = jsonrpclib.ServerProxy('http://localhost:8081')\nprint(server.add(5,6))\n</code></pre></p> </li> </ol> <p></p> <p>1 \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u662fGo</p> <p>\u57fa\u4e8etcp\u5b9e\u73b0, \u53ea\u6709\u5f53\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u662fGo\u7a0b\u5e8f\u65f6\u624d\u80fd\u4f7f\u7528 golang\u5199RPC\u7a0b\u5e8f\uff0c\u5fc5\u987b\u7b26\u54084\u4e2a\u57fa\u672c\u6761\u4ef6\uff0c\u4e0d\u7136RPC\u7528\u4e0d\u4e86</p> <p>\u25cf \u7ed3\u6784\u4f53\u5b57\u6bb5\u9996\u5b57\u6bcd\u8981\u5927\u5199\uff0c\u53ef\u4ee5\u522b\u4eba\u8c03\u7528</p> <p>\u25cf \u51fd\u6570\u540d\u5fc5\u987b\u9996\u5b57\u6bcd\u5927\u5199</p> <p>\u25cf \u51fd\u6570\u7b2c\u4e00\u53c2\u6570\u662f\u63a5\u6536\u53c2\u6570\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u53c2\u6570\uff0c\u5fc5\u987b\u662f\u6307\u9488\u7c7b\u578b</p> <p>\u25cf \u51fd\u6570\u8fd8\u5fc5\u987b\u6709\u4e00\u4e2a\u8fd4\u56de\u503cerror</p> <p>(1) server.go <pre><code>package main\nimport (\n\"net\"\n\"net/rpc\"\n)\ntype HelloService struct{}\nfunc (s *HelloService) Hello(request string, reply *string) error {\n*reply = \"hello,\" + request\nreturn nil\n}\nfunc main() {\n// \u5b9e\u4f8b\u5316\u4e00\u4e2aserver\nlistener, _ := net.Listen(\"tcp\", \":12345\")\n// \u6ce8\u518c\u5904\u7406\u903b\u8f91handler\n_ = rpc.RegisterName(\"HelloService\", &amp;HelloService{})\n// \u542f\u52a8\u670d\u52a1\nfor {\nconn, _ := listener.Accept()\ngo rpc.ServeConn(conn)\n}\n}\n</code></pre> (2) client.go <pre><code>package main\nimport (\n\"fmt\"\n\"net/rpc\"\n)\nfunc main() {\n// \u5efa\u7acb\u8fde\u63a5\nclient, err := rpc.Dial(\"tcp\", \":12345\")\nif err != nil {\npanic(\"\u8fde\u63a5\u5931\u8d25\")\n}\nvar reply *string = new(string)\nerr = client.Call(\"HelloService.Hello\", \"bobby\", reply)\nif err != nil {\npanic(\"\u8c03\u7528\u5931\u8d25\")\n}\nfmt.Println(*reply)\n}\n</code></pre></p> <p>2 \u670d\u52a1\u7aef\u662fGo, \u5ba2\u6237\u7aef\u4efb\u610f\u8bed\u8a00(\u57fa\u4e8ejson)</p> <p>\u57fa\u4e8etcp\u5b9e\u73b0 \u9002\u7528\u4e8e\u670d\u52a1\u7aef\u662fgo, \u5ba2\u6237\u7aef\u53ef\u4ee5\u662f\u5176\u5b83\u8bed\u8a00\u7684\u7a0b\u5e8f</p> <p>(1) server.go  <pre><code>package main\nimport (\n\"net\"\n\"net/rpc\"\n\"net/rpc/jsonrpc\"\n)\ntype HelloService struct{}\nfunc (s *HelloService) Hello(request string, reply *string) error {\n*reply = \"hello,\" + request\nreturn nil\n}\nfunc main() {\n// \u5b9e\u4f8b\u5316\u4e00\u4e2aserver\nlistener, _ := net.Listen(\"tcp\", \":6666\")\n// \u6ce8\u518c\u5904\u7406\u903b\u8f91handler\n_ = rpc.RegisterName(\"HelloService\", &amp;HelloService{})\n// \u542f\u52a8\u670d\u52a1\nfor {\nconn, _ := listener.Accept()\ngo rpc.ServeCodec(jsonrpc.NewServerCodec(conn))\n}\n}\n</code></pre> (2) client.go <pre><code>package main\nimport (\n\"fmt\"\n\"net\"\n\"net/rpc\"\n\"net/rpc/jsonrpc\"\n)\nfunc main() {\n// \u5efa\u7acb\u8fde\u63a5\nconn, err := net.Dial(\"tcp\", \":12345\")\nif err != nil {\npanic(\"\u8fde\u63a5\u5931\u8d25\")\n}\nvar reply *string = new(string)\nclient := rpc.NewClientWithCodec(jsonrpc.NewClientCodec(conn))\nerr = client.Call(\"HelloService.Hello\", \"bobby\", reply)\nif err != nil {\npanic(\"\u8c03\u7528\u5931\u8d25\")\n}\nfmt.Println(*reply)\n}\n</code></pre></p> <p>(3) client.py</p> <pre><code>import json\nfrom socket import *\ntcp_socket = socket(AF_INET, SOCK_STREAM)\ntcp_socket.connect((\"localhost\", 6666))\nrequest = {\n\"id\": 0,\n\"params\": [\"bobby\"],\n\"method\": \"HelloService.Hello\"\n}\ntcp_socket.send(json.dumps(request).encode())\nrsp = tcp_socket.recv(4096).decode()\nrsp = json.loads(rsp)\nprint(rsp)\n</code></pre> <p>3 \u5c01\u88c5\u4ee3\u7406</p> <p></p> <p>(1) handler.go</p> <pre><code>package handler\nconst HelloServiceName = \"handler/HelloService\"\ntype NewHelloService struct {}\nfunc (s *NewHelloService) Hello(request string, reply *string) error {\n// \u8fd4\u56de\u503c\u662f\u901a\u8fc7\u4fee\u6539reply\u7684\u503c\n*reply = \"hello,\" + request\nreturn nil\n}\n</code></pre> <p>(2) server_proxy.go <pre><code>package server_proxy\n\nimport (\n    \"net/rpc\"\n    \"new_hello/handler\"\n)\n\ntype HelloServicer interface {\n    Hello(request string, reply *string) error\n}\n\nfunc RegisterHelloService(srv HelloServicer) error {\n    return rpc.RegisterName(handler.HelloServiceName, srv)\n}\n</code></pre></p> <p>(3) server.go <pre><code>package main\n\nimport (\n    \"net\"\n    \"net/rpc\"\n    \"new_hello/handler\"\n    \"new_hello/server_proxy\"\n)\n\nfunc main() {\n    listener, _ := net.Listen(\"tcp\", \":1234\")\n    _ = server_proxy.RegisterHelloService(&amp;handler.NewHelloService{})\n    for {\n        conn, _ := listener.Accept()\n        go rpc.ServeConn(conn)\n    }\n}\n</code></pre></p> <p>(4) client_proxy.go <pre><code>package client_proxy\n\nimport (\n    \"net/rpc\"\n    \"new_hello/handler\"\n)\n\ntype HelloServiceStub struct {\n    *rpc.Client\n}\n\nfunc NewHelloServiceClient(protocol, address string) HelloServiceStub {\n    conn, err := rpc.Dial(protocol, address)\n    if err != nil {\n        panic(\"connect error\")\n    }\n    return HelloServiceStub{conn}\n}\n\nfunc (c *HelloServiceStub) Hello(request string, reply *string) error {\n    err := c.Call(handler.HelloServiceName+\".Hello\", request, reply)\n    return err\n}\n</code></pre></p> <p>(5) client.go <pre><code>package main\nimport (\n\"new_hello/client_proxy\"\n\"fmt\"\n)\nfunc main() {\nclient := client_proxy.NewHelloServiceClient(\"tcp\", \":1234\")\nvar reply string\nerr := client.Hello(\"bobby\", &amp;reply)\nif err != nil {\npanic(\"\u8c03\u7528\u5931\u8d25\")\n}\nfmt.Println(reply)\n}\n</code></pre></p>"},{"location":"Python-vs-Go/2.%E8%BF%9B%E9%98%B6/2.%E4%BD%BF%E7%94%A8MySQL/","title":"\u4f7f\u7528MySQL","text":"PythonGo <p>py\u4f7f\u7528MySQL</p> <p>\u64cd\u4f5cMySQL\u6570\u636e\u5e93\u7684py\u4ee3\u7801\u6a21\u677f <pre><code>import pymysql\ndb = pymysql.connect(\nhost='localhost',\nport=3306,\nuser='ws',\npassword='123456',\ndatabase='mytest',\n)\ncursor = db.cursor()\n# \u586b\u5165\u4ee3\u7801\ncursor.close()\ndb.close()\n1 \u67e5\u8be2\n```python\n# \u6267\u884cSQL\u8bed\u53e5\ncursor.execute(\"select * from students;\")  # \u6b64\u8bed\u53e5\u8fd4\u56de\u67e5\u8be2\u5230\u7684\u6761\u6570\n# \u83b7\u53d6\u67e5\u8be2\u7ed3\u679c\nret = cursor.fetchall()  # \u8fd4\u56de \u5143\u7ec4\u91cc\u9762\u5957\u5143\u7ec4\nfor row in ret:\nprint(row)\n</code></pre></p> <p>2 \u589e\u52a0</p> <p>\u6ce8: pymysql\u9ed8\u8ba4\u4e0d\u4f1a\u63d0\u4ea4\u4e8b\u52a1, \u5373\u9ed8\u8ba4\u5f00\u542f\u4e86begin, \u6240\u4ee5\u53ea\u8981\u6267\u884ccommit()\u5c31\u53ef\u4ee5 <pre><code>sql = \"insert classes(name) values('\u5929\u5730\u65e0\u6781');\"\ntry:\n# \u6267\u884cSQL\u8bed\u53e5\ncursor.execute(sql)\n# (\u6dfb\u52a0,\u5220\u9664,\u4fee\u6539\u540e)\u8981\u63d0\u4ea4\u4fee\u6539\u5230\u6570\u636e\u5e93\ndb.commit()\nexcept:\n# \u5bf9\u4fee\u6539\u7684\u6570\u636e\u8fdb\u884c\u64a4\u9500\ndb.rollback()\n</code></pre></p> <p>3 \u4fee\u6539 <pre><code>sql = \"update classes set name='\u521d\u51fa\u8305\u5e90' where id=1;\"\ntry:\n    # \u6267\u884cSQL\u8bed\u53e5\n    cursor.execute(sql)\n    # (\u6dfb\u52a0,\u5220\u9664,\u4fee\u6539\u540e)\u8981\u63d0\u4ea4\u4fee\u6539\u5230\u6570\u636e\u5e93\n    db.commit()\nexcept:\n    # \u5bf9\u4fee\u6539\u7684\u6570\u636e\u8fdb\u884c\u64a4\u9500\n    db.rollback()\n</code></pre></p> <p>4 \u5220\u9664 <pre><code>sql = \"delete from classes where id=4;\"\ntry:\n    # \u6267\u884cSQL\u8bed\u53e5\n    cursor.execute(sql)\n    # (\u6dfb\u52a0,\u5220\u9664,\u4fee\u6539\u540e)\u8981\u63d0\u4ea4\u4fee\u6539\u5230\u6570\u636e\u5e93\n    db.commit()\nexcept:\n    # \u5bf9\u4fee\u6539\u7684\u6570\u636e\u8fdb\u884c\u64a4\u9500\n    db.rollback()\n</code></pre></p> <p>go\u4f7f\u7528MySQL</p> <p>1 \u7b80\u4ecb \u4f7f\u7528\u7b2c\u4e09\u65b9\u5f00\u6e90\u7684mysql\u5e93:  <pre><code>github.com/go-sql-driver/mysql \uff08mysql\u9a71\u52a8\uff09 github.com/jmoiron/sqlx \uff08\u57fa\u4e8emysql\u9a71\u52a8\u7684\u5c01\u88c5\uff09\n</code></pre></p> <p>\u547d\u4ee4\u884c\u8f93\u5165 \uff1a <pre><code>go get github.com/go-sql-driver/mysql go get github.com/jmoiron/sqlx\n</code></pre></p> <p>\u8fde\u63a5mysql: <pre><code>database, err := sqlx.Open(\"mysql\", \"root:XXXX@tcp(127.0.0.1:3306)/test\")\n//database, err := sqlx.Open(\"\u6570\u636e\u5e93\u7c7b\u578b\", \"\u7528\u6237\u540d:\u5bc6\u7801@tcp(\u5730\u5740:\u7aef\u53e3)/\u6570\u636e\u5e93\u540d\")\n</code></pre></p> <p>2 \u8fde\u63a5mysql <pre><code>var Db *sqlx.DB\n\n// 1 \u8fde\u63a5\nfunc init() {\n    db, err := sqlx.Open(\"mysql\", \"root:123456@tcp(47.108.170.195:3306)/test\")\n    if err != nil {\n        fmt.Println(\"open mysql failed,\", err)\n        return\n    }\n    Db = db\n}\n</code></pre></p> <p>3 \u6267\u884cSQL\u8bed\u53e5</p> <p>\u65b0\u5efatest\u6570\u636e\u5e93 <pre><code>create database test;\n</code></pre></p> <pre><code>// 2 \u6267\u884cDDL\u8bed\u53e5\nfunc ExecSQL() {\nvar sql = `\nCREATE TABLE person (\n    first_name text,\n    last_name text,\n    email text\n);`\nDb.Exec(sql)\nsql = `\nCREATE TABLE place (\n    country text,\n    city text NULL,\n    telcode integer\n);`\nDb.Exec(sql)\n}\n</code></pre> <p>4 \u589e\u5220\u6539\u67e5</p> <pre><code>type Person struct {\nFirstName string `db:\"first_name\"`\nLastName  string `db:\"last_name\"`\nEmail     string\n}\ntype Place struct {\nCountry string\nCity    sql.NullString\nTelCode int\n}\n</code></pre> <p>(1) Insert\u64cd\u4f5c</p> <pre><code>// 3 \u63d2\u5165\nfunc Insert() {\ntx := Db.MustBegin()\ntx.MustExec(\"INSERT INTO person (first_name, last_name, email) VALUES (?, ?, ?)\", \"Jason\", \"Moiron\", \"jmoiron@jmoiron.net\")\ntx.MustExec(\"INSERT INTO person (first_name, last_name, email) VALUES (?, ?, ?)\", \"John\", \"Doe\", \"johndoeDNE@gmail.net\")\ntx.MustExec(\"INSERT INTO place (country, city, telcode) VALUES (?, ?, ?)\", \"United States\", \"New York\", nil)\ntx.MustExec(\"INSERT INTO place (country, city, telcode) VALUES (?, ?)\", \"China\", \"Hong Kong\", \"852\")\ntx.MustExec(\"INSERT INTO place (country, telcode) VALUES (?, ?)\", \"Singapore\", \"65\")\n// Named queries can use structs\ntx.NamedExec(\"INSERT INTO person (first_name, last_name, email) VALUES (:first_name, :last_name, :email)\", &amp;Person{\"Jane\", \"Citizen\", \"jane.citzen@example.com\"})\ntx.Commit()\n}\n</code></pre> <p>(2) Select\u64cd\u4f5c</p> <pre><code>// 4 \u67e5\u8be2\nfunc Select() {\n// (1) \u67e5\u8be2\u6570\u636e\u5e93, \u5b58\u50a8\u7ed3\u679c\u96c6\u5728 []Person\npeople := []Person{}\nDb.Select(&amp;people, \"SELECT * FROM person ORDER BY first_name ASC\")\njason, john := people[0], people[1]\nfmt.Printf(\"%#v\\n%#v\", jason, john)\n// Person{FirstName:\"Jason\", LastName:\"Moiron\", Email:\"jmoiron@jmoiron.net\"}\n// Person{FirstName:\"John\", LastName:\"Doe\", Email:\"johndoeDNE@gmail.net\"}\n// (2) \u83b7\u53d6\u5355\u4e2a\u7ed3\u679c\njason = Person{}\nDb.Get(&amp;jason, \"SELECT * FROM person WHERE first_name=?\", \"Jason\")\nfmt.Printf(\"%#v\\n\", jason)\n// Person{FirstName:\"Jason\", LastName:\"Moiron\", Email:\"jmoiron@jmoiron.net\"}\n// (3) \u4f7f\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\u6765\u5faa\u73af\u67e5\u8be2\nplace := Place{}\nrows, _ := Db.Queryx(\"SELECT * FROM place\")\nfor rows.Next() {\nerr := rows.StructScan(&amp;place)\nif err != nil {\nlog.Fatalln(err)\n}\nfmt.Printf(\"%#v\\n\", place)\n}\n// Place{Country:\"United States\", City:sql.NullString{String:\"New York\", Valid:true}, TelCode:1}\n// Place{Country:\"Hong Kong\", City:sql.NullString{String:\"\", Valid:false}, TelCode:852}\n// Place{Country:\"Singapore\", City:sql.NullString{String:\"\", Valid:false}, TelCode:65}\n// (4) \u6279\u91cf\u63d2\u5165\npersonMaps := []map[string]interface{}{\n{\"first_name\": \"Ardie\", \"last_name\": \"Savea\", \"email\": \"asavea@ab.co.nz\"},\n{\"first_name\": \"Sonny Bill\", \"last_name\": \"Williams\", \"email\": \"sbw@ab.co.nz\"},\n{\"first_name\": \"Ngani\", \"last_name\": \"Laumape\", \"email\": \"nlaumape@ab.co.nz\"},\n}\n_, _ = Db.NamedExec(`INSERT INTO person (first_name, last_name, email)\n        VALUES (:first_name, :last_name, :email)`, personMaps)\n}\n</code></pre> <p>(3) Update\u64cd\u4f5c</p> <pre><code>// 5 \u4fee\u6539\nfunc Update() {\nres, _ := Db.Exec(\"UPDATE person set first_name=? where email=?\", \"ws\", \"sbw@ab.co.nz\")\nrow, _ := res.RowsAffected()\nfmt.Println(\"update succ:\", row)\n}\n</code></pre> <p>(4) Delete\u64cd\u4f5c</p> <pre><code>// 6 \u5220\u9664\nfunc Delete() {\nres, _ := Db.Exec(\"DELETE FROM person where first_name=?\", \"ws\")\nrow, _ := res.RowsAffected()\nfmt.Println(\"delete succ: \", row)\n}\n</code></pre>"},{"location":"Python-vs-Go/2.%E8%BF%9B%E9%98%B6/3.%E4%BD%BF%E7%94%A8Redis/","title":"\u4f7f\u7528Redis","text":"PythonGo <p>py\u4f7f\u7528Redis</p> <p>1 \u5b89\u88c5redis\u5305 \u5728ubuntu\u865a\u62df\u673a\u4e2d <pre><code>sudo pip3 install redis\n</code></pre></p> <pre><code>import redis\nif __name__ == '__main__':\nrs = redis.Redis()\n# ret = rs.set(\"name\", \"aaa\")\n# print(ret)\nname = rs.get(\"name\")\nprint(name)\n</code></pre> <p>go\u4f7f\u7528Redis</p> <p>golang\u64cd\u4f5credis\u4e3b\u8981\u6709\u4e24\u4e2a\u5e93\uff0c<code>go-redis</code>\u548c<code>redigo</code></p> <p>go-redis\u5bf9\u51fd\u6570\u7684\u5c01\u88c5\u66f4\u7b80\u6d01, \u800c\u4e14\u652f\u6301\u8fde\u63a5\u54e8\u5175\u53ca\u96c6\u7fa4\u6a21\u5f0f\u7684Redis <pre><code>import \"github.com/go-redis/redis/v8\"\n</code></pre></p> <p>1 \u8fde\u63a5redisServer</p> <p>(1) \u6cd5\u4e00 <pre><code>import \"github.com/go-redis/redis/v8\"\nrdb = redis.NewClient(&amp;redis.Options{\nAddr:     \"localhost:6379\",\nPassword: \"\", // no password set\nDB:       0,  // use default DB\n})\n</code></pre></p> <p>(1) \u6cd5\u4e8c <pre><code>opt, err := redis.ParseURL(\"redis://&lt;user&gt;:&lt;pass&gt;@localhost:6379/&lt;db&gt;\")\nif err != nil {\npanic(err)\n}\nrdb = redis.NewClient(opt)\n</code></pre></p> <p>2 set/get <pre><code>func redisExample() {\nrdb := RedisClient\nerr := rdb.Set(\"score\", 100, 0).Err()\nif err != nil {\nfmt.Printf(\"set score failed, err:%v\\n\", err)\nreturn\n}\nval, err := rdb.Get(\"score\").Result()\nif err != nil {\nfmt.Printf(\"get score failed, err:%v\\n\", err)\nreturn\n}\nfmt.Println(\"score\", val)\nval2, err := rdb.Get(\"name\").Result()\nif err == redis.Nil {\nfmt.Println(\"name does not exist\")\n} else if err != nil {\nfmt.Printf(\"get name failed, err:%v\\n\", err)\nreturn\n} else {\nfmt.Println(\"name\", val2)\n}\n}\n</code></pre></p> <p>3 zset <pre><code>func redisExample2() {\nzsetKey := \"language_rank\"\nlanguages := []redis.Z{\n{Score: 90.0, Member: \"Golang\"},\n{Score: 98.0, Member: \"Java\"},\n{Score: 95.0, Member: \"Python\"},\n{Score: 97.0, Member: \"JavaScript\"},\n{Score: 99.0, Member: \"C/C++\"},\n}\n// ZADD\nnum, err := rdb.ZAdd(zsetKey, languages...).Result()\nif err != nil {\nfmt.Printf(\"zadd failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"zadd %d succ.\\n\", num)\n// \u628aGolang\u7684\u5206\u6570\u52a010\nnewScore, err := rdb.ZIncrBy(zsetKey, 10.0, \"Golang\").Result()\nif err != nil {\nfmt.Printf(\"zincrby failed, err:%v\\n\", err)\nreturn\n}\nfmt.Printf(\"Golang's score is %f now.\\n\", newScore)\n// \u53d6\u5206\u6570\u6700\u9ad8\u76843\u4e2a\nret, err := rdb.ZRevRangeWithScores(zsetKey, 0, 2).Result()\nif err != nil {\nfmt.Printf(\"zrevrange failed, err:%v\\n\", err)\nreturn\n}\nfor _, z := range ret {\nfmt.Println(z.Member, z.Score)\n}\n// \u53d695~100\u5206\u7684\nop := redis.ZRangeBy{\nMin: \"95\",\nMax: \"100\",\n}\nret, err = rdb.ZRangeByScoreWithScores(zsetKey, op).Result()\nif err != nil {\nfmt.Printf(\"zrangebyscore failed, err:%v\\n\", err)\nreturn\n}\nfor _, z := range ret {\nfmt.Println(z.Member, z.Score)\n}\n}\n</code></pre></p>"},{"location":"Python-vs-Go/2.%E8%BF%9B%E9%98%B6/4.%E4%BD%BF%E7%94%A8MongoDB/","title":"\u4f7f\u7528MongoDB","text":"PythonGo <p>py\u4f7f\u7528mongo</p> <p>1.\u5b89\u88c5pymongo <pre><code>pip install pymongo\n</code></pre></p> <p>2 \u8fde\u63a5\u6570\u636e\u5e93 <pre><code>import pymongo\ndef mongo_init1():\ndb = pymongo.MongoClient(host='0.0.0.0', port=27017, tz_aware=True)\ndef mongo_init2():\ndb = pymongo.MongoClient('mongodb://0.0.0.0:27017', tz_aware=True)\n</code></pre></p> <p>go\u4f7f\u7528mongo</p> <p>Package mongo \u4e3a Go \u63d0\u4f9b\u4e86\u4e00\u4e2a MongoDB Driver API\u3002 <pre><code>import \"go.mongodb.org/mongo-driver/mongo\"\nimport \"go.mongodb.org/mongo-driver/mongo/options\"\n</code></pre></p> <p>1 \u4ee3\u7801\u793a\u4f8b</p> <pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"go.mongodb.org/mongo-driver/bson\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n)\ntype User struct {\nName       string `bson:\"name\"`\nAge        int    `bson:\"age\"`\nBirthMonth int    `bson:\"birth_month\"`\ngender     string `bson:\"gender\"`\n}\n// \u65b0\u5efaMongoDB\u5ba2\u6237\u7aef\u5bf9\u8c61\nfunc NewMongoClient() *mongo.Client {\nclientOptions := options.Client().ApplyURI(\"mongodb://127.0.0.1:27017\")\nvar err error\nclient, err := mongo.Connect(context.TODO(), clientOptions)\nif err != nil {\nfmt.Println(err)\nreturn nil\n}\n// \u68c0\u67e5\u662f\u5426\u8fde\u63a5\u6b63\u5e38\nerr = client.Ping(context.TODO(), nil)\nif err != nil {\nfmt.Println(err)\nreturn nil\n}\nreturn client\n}\n// \u5355\u6761\u63d2\u5165\nfunc insertOne(c *mongo.Collection) {\nres, _ := c.InsertOne(context.Background(), bson.M{\"name\": \"ws1\", \"age\": 19})\nid := res.InsertedID\nfmt.Println(id)\nres, _ = c.InsertOne(context.Background(), bson.M{\"name\": \"ws2\", \"age\": 18})\nid = res.InsertedID\nfmt.Println(id)\n}\n// \u591a\u6761\u63d2\u5165\nfunc insertMany(c *mongo.Collection) {\nc.InsertMany(context.Background(), []interface{}{\nbson.M{\"name\": \"ws3\", \"age\": 19},\nbson.M{\"name\": \"ws4\", \"age\": 18},\nbson.M{\"name\": \"ws5\", \"age\": 17},\nbson.M{\"name\": \"ws6\", \"age\": 18},\n})\n}\n// \u67e5\u627e\u5355\u6761\nfunc findOne(c *mongo.Collection) {\nsingleResult := c.FindOne(context.Background(), bson.M{\n\"name\": \"ws1\",\n})\nif singleResult == nil || singleResult.Err() != nil {\nreturn\n}\nuserData := User{}\nerr := singleResult.Decode(&amp;userData)\nif err != nil {\nreturn\n}\nfmt.Println(userData)\n}\n// \u67e5\u627e\u591a\u6761\nfunc findMany(c *mongo.Collection) {\ncursor, err := c.Find(context.Background(), bson.M{\n\"age\": bson.M{\"$lte\": 18},\n})\nif err != nil {\nreturn\n}\nfor cursor.Next(context.Background()) {\nuserData := User{}\nerr := cursor.Decode(&amp;userData)\nif err != nil {\ncontinue\n}\nfmt.Println(userData)\n}\n}\n// \u66f4\u65b0\u4e00\u6761\nfunc updateOne(c *mongo.Collection) {\nfilter := bson.M{\"name\": \"ws1\"}\nvalue := bson.M{\"$set\": bson.M{\"age\": 100}}\nc.UpdateOne(context.Background(), filter, value)\n}\n// \u66f4\u65b0\u591a\u6761\nfunc updateMany(c *mongo.Collection) {\nfilter := bson.M{\"age\": 18}\nvalue := bson.M{\"$set\": bson.M{\"age\": 22}}\nc.UpdateMany(context.Background(), filter, value)\n}\n// \u5206\u7ec4\u67e5\u8be2\nfunc findGroup(c *mongo.Collection) {\n// \u590d\u6742\u67e5\u8be2, \u5148\u5339\u914d\u540e\u5206\u7ec4\nfilter := bson.A{ // A\u8868\u793aArray\nbson.M{\n\"$group\": bson.M{\n\"_id\":           \"$gender\", // \u6309\u6027\u522b\u5206\u7ec4\n\"minAge\":        bson.M{\"$min\": \"$age\"},\n\"maxBirthMonth\": bson.M{\"$max\": \"$birth_month\"},\n},\n},\n}\ncursor, err := c.Aggregate(context.Background(), filter)\nif err != nil {\nfmt.Println(err)\nreturn\n}\nfor cursor.Next(context.Background()) {\ndoc := cursor.Current\n// LookupErr\u53d6\u51fakey\u91cc\u7684\u503c\nminAge, err2 := doc.LookupErr(\"minAge\")\nif err2 != nil {\nreturn\n}\nfmt.Println(minAge) // {\"$numberInt\":\"19\"}\nmaxBirthMonth, err3 := doc.LookupErr(\"maxBirthMonth\")\nif err3 != nil {\nreturn\n}\nfmt.Println(maxBirthMonth) // {\"$numberDouble\":\"4.0\"}\n}\n}\n// \u5206\u9875\u67e5\u8be2\nfunc findPage(c *mongo.Collection) {\nfilter := bson.M{\"age\": bson.M{\"$lt\": 50}}\ncursor, err := c.Find(context.Background(), filter,\noptions.Find().SetSort(bson.D{{\"age\", -1}}),\noptions.Find().SetLimit(4),\noptions.Find().SetSkip(1))\nif err != nil {\nreturn\n}\nvar users []User\nerr2 := cursor.All(context.Background(), &amp;users)\nif err2 != nil {\nreturn\n}\nfor _, user := range users {\nfmt.Println(user.Name, user.Age)\n}\n}\nfunc main() {\n// \u521b\u5efa\u5ba2\u6237\u7aef\u5bf9\u8c61\nclient := NewMongoClient()\n// \u521b\u5efa\u96c6\u5408\u5bf9\u8c61\nc := client.Database(\"wstest\").Collection(\"users\")\n// \u6267\u884c\u4ee3\u7801\nfindPage(c)\n}\n</code></pre> <p>2 json\u5b57\u7b26\u4e32\u8f6cbson</p> <pre><code>package main\nimport (\n\"fmt\"\n\"go.mongodb.org/mongo-driver/bson\"\n)\nfunc main() {\nvar json = \"{\\\"data\\\":1}\"\nvar workflow interface{}\ne := bson.UnmarshalExtJSON([]byte(json), false, &amp;workflow)\nif e != nil {\nfmt.Println(\"err is \", e)\nreturn\n}\nfmt.Println(workflow)\n}\n</code></pre>"}]}